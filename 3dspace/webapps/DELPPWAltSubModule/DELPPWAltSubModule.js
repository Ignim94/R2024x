define("DS/DELPPWAltSubModule/ReplaceByAlternateDialog",["UWA/Core"],function(e){"use strict";return function(t,n,i){const l=0,o=1,r=2;let a;const c=function(){let e=!1,t=!1,n=!1;if((e=>Array.isArray(e)&&e.length>0)(a.value))switch(a.value[0]){case l:e=!1,t=!1,n=!1;break;case o:e=!0,t=!0,n=!1;break;case r:e=!0,t=!1,n=!0}return{isReplaceAll:e,restrictToUnderSameParent:t,replaceAllInstances:n}},s=function(s){let u=e.createElement("div",{class:"replaceByAlternateOptions-container",styles:{padding:"10px 5px"}});(a=function(t){const a=(e=!1)=>n.create("Toggle",{type:"radio",label:i.getNLSValue("AltSub.ReplaceDialog.ReplaceSelected"),value:l,checkFlag:e}),c=(e=!1)=>n.create("Toggle",{type:"radio",label:i.getNLSValue("AltSub.ReplaceDialog.RestrictToSameParent"),value:o,checkFlag:e}),s=(...e)=>{let t=n.create("ButtonGroup",{type:"radio"});for(const n of e)t.addChild(n);return t};return(t=>e.is(t)&&"instance"===t.type)(t)||(t=>!e.is(t))(t)?s(a(!0),c(),((e=!1)=>n.create("Toggle",{type:"radio",label:i.getNLSValue("AltSub.ReplaceDialog.ReplaceAllInstances"),value:r,checkFlag:e}))()):s(a(!0),c())}(t)).inject(u);let d=e.createElement("div",{class:"replaceByAlternateOptions-content-container"});u.inject(d),function(t,l){let o=n.create("Dialog",{title:i.getNLSValue("AltSub.ReplaceDialog.Title"),domId:"replaceByAlternateOptionsDialog",identifier:"replaceByAlternateOptionsDialog",content:t,minHeight:150,minWidth:400,modalFlag:!0,resizableFlag:!0,buttons:{Cancel:n.create("Button",{onClick:function(){o.close()}}),Ok:n.create("Button",{emphasize:"primary",onClick:function(){if(e.is(l,"function")){const e=c();l(e)}o.close()}})}});o.close=function(){this.destroy()}}(d,s)};return{show:function(e){s(e)}}}}),define("DS/DELPPWAltSubModule/AltSubViewUI",["UWA/Core","DS/Utilities/Dom"],function(e,t){"use strict";return function(n,i,l,o,r,a,c){var s,u,d,g,f,m=o.getComponent("WUXDockAreaEnum"),p=o.getComponent("WUXFrameWindowsManager").getFrameWindow(n.getAppContext()).getImmersiveFrame();return s=function(t){var a=n.getElement(),c=o.createElement("div",{class:"tree-list-container"}),s=e.is(r)?r.getIconURLFromKey(t):"";g=r.getNLSValue("View.AlternatesAndSubstitutes.Title"),(f=e.createElement("div")).className="context-product-title",f.setAttribute("id","context-product-title"),f.setStyles({left:"10px",position:"relative",width:"fit-content"}),c.inject(a),i.loadDocument(l.getWUXNodeModel()),i.getContent().inject(c),(u=o.create("Panel",{header:f,position:{at:"right"},minWidth:300,minHeight:250,height:250,title:r.getNLSValue("View.AlternatesAndSubstitutes.Title"),icon:s,side:m.RightDockArea,currentDockArea:m.RightDockArea,identifier:"panel-"+d,content:a,resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!1})).close=function(){e.is(d)?n.notify("toggleCmdCheckHeaderState",{cmdName:d,cmdState:!1}):u.hide()}},{init:function(t,i){e.is(t,"string")?(d=t,s(i)):n.debug("AltSubViewUI","Command name is not defined to create UI.")},destroy:function(){l.emptyNodeModel(),e.is(u)&&(u.destroy(),u=void 0)},toggle:function(t){var n;t.state&&!u.visibleFlag?(u.immersiveFrame=p,n=p.getDockingElement(u.currentDockArea),e.is(n)&&(n.collapseDockingZoneFlag=!1),u.show()):u.hide()},updateTitle:function(t){var n=e.is(t,"string")?t:null;e.is(n)&&""!==n?u.title=g+" - "+n:u.title=g},setContextProductTitle:function(n,i){var l,o=e.createElement("div"),r=e.createElement("div"),a=e.is(i,"string")?i:null;o.className="title-base",o.setStyles({display:"flex","align-items":"center",height:"22px"}),r.className="title-text",r.setStyles({"padding-left":"10px"}),e.is(a)&&((l=t.generateIcon({iconPath:a,iconSize:{width:"22px",height:"22px"}})).className="title-icon",l.inject(o)),r.setContent(n),r.inject(o),f.setContent(o)},launchMfgItemCreateNewCmd:function(t,i,l){var o,s,u,d,g=e.is(t)&&e.is(t.arguments)?t.arguments:null,f=e.is(t)&&e.is(t.commandTitleNLSKey,"string")?t.commandTitleNLSKey:null,m=e.is(t)&&e.is(t.cmdSuccessNLSKey,"string")?t.cmdSuccessNLSKey:null,p=e.is(t)&&e.is(t.cmdFailureNLSKey,"string")?t.cmdFailureNLSKey:null,S=e.is(t)&&e.is(t.ebomPID,"string")?t.ebomPID:null,y=e.is(t)&&e.is(t.token)?t.token:null,b=e.is(t)&&e.is(t.logToken)?t.logToken:null,A=!0,h={isCreateRoot:!0,fatherReferenceID:null,linkType:null,type:null,ebomReferenceID:S,dialogBoxTitle:null,callbacks:{onSuccess:null,onFailure:null,onCancel:null},backendInfo:{url:a.get3DSpaceUrl().slice(0,-1),tenant:a.getTenant(),securityContext:a.getSecurityContext(),headers:a.getHeaders({isAuthoringCtx:!0})},oneDelmiaAggregationMode:n.getPreferenceValue("oneDelmiaAggregationMode"),isXRev:n.getPreferenceValue("isXRevisionActivated"),preferences:[n.getPreferenceValue("MASS"),n.getPreferenceValue("VOLUME"),n.getPreferenceValue("AREA"),n.getPreferenceValue("LENGTH")]};e.is(g,"array")&&g.forEach(function(t){if(e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string"))switch(t.ID){case"ReferenceType":h.type=e.is(t.Value,"string")?t.Value.split("/")[1]:null,h.dialogBoxTitle=r.getNLSValue(f,{type:r.getNLSValue(h.type)});break;case"LinkType":h.linkType=t.Value.toUpperCase()}}),h.callbacks.onSuccess=function(t){var n,o,r={createdObject:null,toObject:null,iNewLinkType:(n=h.linkType,o=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),"Resultingproduct"===o&&(o="ResultingProduct"),o),token:y,logToken:b,cmdSuccessNLSKey:m},c={onComplete:function(e){r.createdObject=e,r.toObject=a.getReference(S),i(r)},onFailure:function(){l("AltSub.FailToFetchNewReference")},forceDBMode:!0};e.is(t)&&e.is(t.result,"array")&&t.result.length>0&&(t.result[0].identifier,"string")&&t.result[0].identifier.length>0&&(A=!1,a.fetchRoot(t.result[0].identifier,c))},h.callbacks.onFailure=function(e){var t={key:"AltSub.FailToCreateNewReference",result:e,token:y,logToken:b,toObject:a.getReference(S),cmdFailureNLSKey:p};A&&l(t)},h.callbacks.onCancel=h.callbacks.onFailure,o="selectedEBOMrefId",s=e.is(S,"array")&&S.length>0?S[0]:S,u=null,d="Unkwown",e.is(s,"string")&&s.length>0?(u=a.getReference(a.getReferenceId(s)),e.is(u)&&(d=u.get("type")),n.debug(o+": "+s+", reference type: "+d)):n.debug("No "+o+" object ID"),new c(h).execute()},launchMfgItemCreateCmd:function(t,n,i){var l,a,c,s,u,d,g,f=t.arguments,m={},p=function(){e.is(l)&&(l.isVisible()&&l.destroyUI(),l=void 0)};p(),Array.isArray(f)&&(f.forEach(function(t){e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string")&&("ReferenceType"===t.ID?a=t.Value:"LinkType"===t.ID&&(c=t.Value))}),e.is(a)&&e.is(c)&&(d=a.split("/"),g=null,2===d.length&&(g=d[1]),s=g,m.cmdId="CreateMfgItemAndScope",m.onOKCallBack=function(e){var t=r.getNLSValue(m.cmdTitle,{type:r.getNLSValue(s||"",null,"Type")});i(e,c,t),p()},m.onCancelCallback=function(){p()},m.newObjType=a,m.isInstancePossible=null,m.cmdTitle=n(c),m.implementingSection=!1,m.implementedSection=!0,m.optionsSection=!1,m.checkForImplementingScope=!1,m.modalFlag=!0,m.multiSelectionOfImplementing=!1,m.multiSelectionOfImplemented=!1,l=o.create("ImplementUI",m),!0===(u=l.getSelectionsWithPaths()).bUpdateImplemented&&(l.updateImplemented(u.selNodes),l.showDCFormForCreate(!0))))}}}}),define("DS/DELPPWAltSubModule/AltSubModule",["UWA/Core","DS/DELPPWAltSubModule/AltSubViewUI","DS/DELPPWAltSubModule/ReplaceByAlternateDialog","DS/DELPPWInsertCmdPLMNewModule/InsertPLMNewCommand"],function(e,t,n,i){"use strict";var l=function(){var t=null;return{of:function(e){return t=e,this},combineWith:function(n){return e.extend(t,n,!0),this},get:function(){return t}}};return{behaviors:["TreeListViewBehavior","WUXNodeModelBehavior","AssignProductBehavior","UXFactoryBehavior","ModelBehavior","SelectionBehavior","ResourceBehavior","AltSubBehavior"],creator:function(o,r,a,c,s,u,d,g,f){var m,p,S,y,b,A,h,I,L,N,C,R,T,v,M,P={STATUS:"AltSub_status",ENG_RELATION:"AltSub_engRelation",CONTEXT:"AltSub_context"},D="AltSub_mfgItem",k="AltSub_mfgRev",V="AltSub_relType",O="AltSub_org",U=f.getLinkTypeEnum(),E=!1,F=null,w=null;return S=function(e){return e.isReference()?e.get("PLMEntity.V_Name"):e.get("PLMInstance.PLM_ExternalID")},y=function(e){var t="";return e.isReference()&&(t=e.get("revision")),t},b=function(e){var t="";return t=S(e),e.isReference()&&(t+=" "+y(e)),t},A=function(t){var n=t||{},i=e.is(n.status)?n.status:null,l=e.is(n.referenceModel)?n.referenceModel:null,o=e.is(n.instanceModel)?n.instanceModel:null,r="",a=null;e.is(i,"string")?"loading"===i?r=g.getNLSValue("loading"):"noSelection"===i&&(r=g.getNLSValue("AltSub.NoSelection")):e.is(l)||e.is(o)?(e.is(l)&&(r+=b(l),a=g.getIconURLFromKey(l.get("type"))),e.is(o)&&(r+=" ( "+b(o)+" )")):r=g.getNLSValue("AltSub.NoContextProduct"),p.setContextProductTitle(r,a)},h=function(){var t,n,i,l,r=d.getSelectionsWithPaths();E||(w=null,a.emptyNodeModel(),A({status:"loading"}),Array.isArray(r)&&r.length>1&&1===r[1].length?(l=r[1][0],e.is(l)?(t=u.getReferenceModel(l.id),F=t.get("PID"),p.updateTitle(S(t)),i=l.path,n=l.path.length>0?l.id:null,f.getEnggAlternatesAndMfgs(t.get("PID"),n,i,function(t){var l,r,c,s=t.mfgReferenceId;e.is(F)&&s===F&&(l=t.results,r=t.contextLinkNavigated,A({referenceModel:t.contextProductModel.reference,instanceModel:t.contextProductModel.instance}),Array.isArray(l)&&l.length>0&&(c=0===i.length,a.prepareUpdate(),l.forEach(function(e){N(e,r,c)}),a.pushUpdate()),w=n,o.notify("AltSubViewLoaded"))})):o.debug("No selection in mbom to load AlternateAndSubstitutes view data.")):(F=null,p.updateTitle(""),A({status:"noSelection"})))},I=function(t,n,i,l,o,r){return{label:b(t),grid:{[P.STATUS]:n,[P.ENG_RELATION]:i,[P.CONTEXT]:e.is(o)?b(o):""},restrictLinkCreation:r,substitute:(t=>{let n=null;return e.is(t)&&(n={type:t.isInstance()?"instance":"reference",context:t.get("PID")}),n})(o),engRelType:l}},L=function(t,n,i,l){return e.is(t)?{isContextMfgRoot:l,mfgReferenceId:t.get("PID"),mfgRelType:i,grid:{[D]:S(t),[k]:y(t),[V]:n,[O]:t.get("organization"),cellInfo:{IconUrl:g.getIconURLFromKey(t.get("type"))}}}:{isContextMfgRoot:l,grid:{[D]:"",cellInfo:{IconUrl:null}}}},N=function(t,n,i){var o,c,s,u,d,g,f=t.eng,m=t.mfg,p=new l;c=f.referenceModel,s=m.referenceModel,g=f.isContextProduct?n:null,u=I(c,f.status,f.engRelTypeNLS,f.engRelType,f.substituteContextModel,g),d=e.is(s)?L(s,m.mfgRelTypeNLS,m.mfgRelType,i):L(null),o=p.of(r.getReferenceNodeOptions(c)).combineWith(u).combineWith(d).get(),a.addNodeModel(o)},C=function(e){var t,n=e.options,i=n.grid;return t=Object.keys(P).reduce(function(e,t){var n=P[t];return e[n]=i[n],e},{}),{label:n.label,grid:t,restrictLinkCreation:n.restrictLinkCreation,substitute:n.substitute,engRelType:n.engRelType}},R=function(t,n,i){var o,c,s,u,d=a.getSelectedNodes();1===d.length&&(o=d[0],s=L(t,g.getNLSValue("AltSub.Link."+i),i),e.is(o.options.mfgReferenceId)?(c=C(o),u=(new l).of(r.getReferenceNodeOptions(n)).combineWith(c).combineWith(s).get(),a.addNodeModel(u)):o.updateOptions(s))},T=function(t){var n=g.getNLSValue("AltSub.CreatingMfgItem"),i=d.getSelectionsWithPaths(o.getId()),l=null,r=null,a=function(e){R(e.createdObject,e.toObject,e.iNewLinkType),o.info(g.getNLSValue(e.cmdSuccessNLSKey,{processName:e.createdObject.get("PLMEntity.V_Name"),productName:e.toObject.get("PLMEntity.V_Name")}),e.logToken),o.notify("stopProgress",e),o.notify("referenceCreated",{referencePID:e.createdObject.id}),m.removeModalLoader(n),E=!1},s=function(e){o.info(g.getNLSValue(e.cmdFailureNLSKey,{productName:e.toObject.get("PLMEntity.V_Name")}),e.logToken),o.notify("stopProgress",e),m.removeModalLoader(n),E=!1},u=function(e){return e===U.RESULTING_PRODUCT?"ImplementUI.CreateImplementingAndResultingProduct":"ImplementUI.CreateImplementingAndScope"},f=!!(e.is(t)&&e.is(t.isOldCreateCmd,"boolean")&&t.isOldCreateCmd);e.is(t.arguments,"array")&&t.arguments.forEach(function(n,i){e.is(n)&&e.is(n.ID,"string")&&e.is(n.Value,"string")&&"LinkType"===n.ID&&("Resultingproduct"===(r=n.Value.charAt(0).toUpperCase()+n.Value.slice(1).toLowerCase())&&(r="ResultingProduct"),t.arguments[i].Value=r)}),e.is(i,"array")&&i.length>0&&e.is(i[0],"array")&&i[0].length>0&&e.is(i[0][0].id,"string")&&i[0][0].id.length>0&&(l=i[0][0].id),f?p.launchMfgItemCreateCmd(t,u,function(e,t,i){var l=e.securityContextOverride,o=e.implementedIDs,r=e.newObjAttributes;E=!0,m.displayModalLoader(n,function(){var e=function(e){var i;1===e.length&&(i=e[0],R(i.createdObject,i.toObject,t)),m.removeModalLoader(n),E=!1},a=function(){m.removeModalLoader(n),E=!1};t===U.SCOPE?c.createMfgItemAndScopeLink(o,r,i,{onComplete:e,onFailure:a,securityContextOverride:l}):t===U.RESULTING_PRODUCT&&c.createMfgItemAndResultingProductLink(o,r,i,{onComplete:e,onFailure:a,securityContextOverride:l})})}):(E=!0,t.logToken=o.log(g.getNLSValue("AltSub.CreatingMfgItem")),t.commandTitleNLSKey=u(r),t.cmdSuccessNLSKey=r===U.RESULTING_PRODUCT?"createMfgItemAndResultingProductLink.Success":"CreateMfgItemAndScope.Success",t.cmdFailureNLSKey=function(e){return e===U.RESULTING_PRODUCT?"createMfgItemAndResultingProductLink.Failure":"CreateMfgItemAndScope.Failure"}(r),t.ebomPID=l,o.notify("startProgress",t),m.displayModalLoader(n,function(){p.launchMfgItemCreateNewCmd(t,a,s)}))},v=function(){var t,n=a.getSelectedNodes();1===n.length&&(t=n[0].options.mfgReferenceId,e.is(t)&&o.notify("referenceAdded",[u.getReference(t),null,{withLinksResolved:!0}]))},M=function(){const t=w;if(e.is(t)){const i=a.getSelectedNodes();if(1===i.length){const l=i[0],r=l.options.mfgReferenceId,a=l.options.substitute;e.is(r)&&new n(a,s,g).show(function(e){o.notify("doReplaceByMfgAlternate",[t,r,e,a])})}}},{listenTo:function(){return{select:h,CreateMfgItemAndLinkAltSubst:T,AddMfgItemToMBOMAltSub:v,ReplaceByAlternate:M}},onStart:function(e){var n,l,c=e||{};n=c.relatedCmdId,l=c.moduleIcon,(p=new t(o,r,a,s,g,u,i)).init(n,l),m=r.getDataGridView(),p.toggle({state:!0}),h()},onStop:function(){E=!1,e.is(p)&&(p.destroy(),p=void 0),F=null}}}}});