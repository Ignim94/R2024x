define("DS/DELPPWProductFlowSequenceModule/ProductFlowComponent",["UWA/Core"],function(e){"use strict";return function(t,n){const i=["PROCESS","SERVICE"];var o,r,a,s,l,d,c,u,p,f,m,g,h,y,P,I,w,E,v,b,k,N,C,L,x,R,A,S,D,T,V,F,O,M,_,U,B,G,W,$,j,H,z,Y,q,X,Q,K,J,Z,ee,te,ne,ie,oe,re,ae,se,le,de,ce,ue,pe,fe,me,ge,he,ye,Pe,Ie,we,Ee,ve,be,ke=t.getComponent("EGraphCore"),Ne=t.getComponent("EGraphViews"),Ce=t.getComponent("EGraphIact"),Le=t.getComponent("EGraphUtils"),xe=t.getComponent("ContextualMenuManager"),Re=t.getComponent("TooltipModel"),Ae="DELArrowDisplayExt.V_ArrowStartPosition",Se="DELArrowDisplayExt.V_ArrowEndPosition",De=!1,Te=!1,Ve=0,Fe=!1,Oe=0,Me=!1,_e=!1,Ue={},Be=!1,Ge=[],We=0;return k=!!e.is(n.readOnly)&&n.readOnly,L=e.is(n.nodes)?n.nodes:[],x=e.is(n.links)?n.links:[],N=e.is(n.nodeOptions)?n.nodeOptions:[],R=e.is(n.identifier)?n.identifier:"",A=e.is(n.getNodeContextMenu,"function")?n.getNodeContextMenu:null,S=e.is(n.getLinkContextMenu,"function")?n.getLinkContextMenu:null,D=e.is(n.getLinkedNodeContextMenu,"function")?n.getLinkedNodeContextMenu:null,V=e.is(n.onConnectingNodes)?n.onConnectingNodes:null,ee=e.is(n.onNodeDoubleClick,"function")?n.onNodeDoubleClick:null,se=e.is(n.onNodeSelectionChange,"function")?n.onNodeSelectionChange:null,a=e.is(n.onSaveAnchorPositions,"function")?n.onSaveAnchorPositions:null,s=e.is(n.onMultiplePositionChangeAlert,"function")?n.onMultiplePositionChangeAlert:null,r=function(){Ne.HTMLNodeView.call(this)},o=function(e){Ne.SVGEdgeView.call(this,e)},o.prototype.createTextEdgeView=function(e,t,n){var i,o="http://www.w3.org/2000/svg";(i=document.createElementNS(o,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.display.elt.id),i.setAttribute("startOffset","10%"),""===e.mark?i.appendChild(document.createTextNode("")):e.mark.hasOwnProperty(t)&&(i.appendChild(document.createTextNode(e.mark[t])),n++),this.display.text=document.createElementNS(o,"text"),this.display.text.setAttribute("dy",-14*(n-1)+12),this.display.text.grElt=e,Le.classListAdd(this.display.text,"edge-text"),this.display.text.appendChild(i),""!==i.innerHTML&&this.structure.root.appendChild(this.display.text)},o.prototype.oncreateDisplay=function(e){var t,n=this,i=0;Ne.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",t="Type",Array.isArray(t)||(t=[t]),t.forEach(function(t){n.createTextEdgeView(e,t,i),i++})},G=function(e){return/^(auto|0)$|^[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc|rem)$/.test(e)},Z=function(){return"SEQUENCE"===C},M=function(){var t=e.createElement("div",{class:"input-node my-node"}),n=e.createElement("img",{class:"my-node-type-img"}),i=e.createElement("div",{class:"title-container"}),o=e.createElement("div",{class:"sub-title-container"}),r=e.createElement("div",{class:"my-node-container"}),a=e.createElement("div",{class:"my-node-col left"}),s=e.createElement("div",{class:"my-node-col right"}),l=e.createElement("div",{class:"myNodeLinkEdit"}),d=e.createElement("div",{class:"my-node-text"});return t.setStyles({width:"50px",height:"50px"}),d.setStyles({top:"0px"}),r.appendChild(n),r.appendChild(o),s.appendChild(d),t.appendChild(i),t.appendChild(r),t.appendChild(a),t.appendChild(s),t.appendChild(l),t},h=function(){var t=e.createElement("div",{class:"input-node my-node"}),n=e.createElement("div",{class:"my-node-container"}),i=e.createElement("img",{class:"my-node-type-img linked-node"}),o=e.createElement("div",{class:"sub-title-container"});return t.setStyles({width:"50px",height:"50px"}),n.appendChild(i),n.appendChild(o),t.appendChild(n),t},U=function(t,n){var i,o=n.grElt,r=n.clientPos[0],a=n.clientPos[1];e.is(o)&&!k&&(o.type===ke.Type.NODE?(e.is(o.gr.selection.first)&&o.gr.selection.first.PID!==o.PID?(F.removeFromSelection(o.gr.selection.first),F.addToSelection(o)):null===o.gr.selection.first&&F.addToSelection(o),D&&e.is(o.model.link)?i=D(o.model):A&&(i=A(o.model))):o.type===ke.Type.EDGE&&e.is(o.mark)&&S&&(i=S(o.mark)),e.is(i)&&(i=Array.isArray(i)?i:[i],Array.isArray(i)&&xe.show({nodes:i},[r,a])))},Y=function(e,t,n){var i,o;return o=e===ke.BorderCstr.TOP||e===ke.BorderCstr.BOTTOM?125+70*t:45+70*t,i=new ke.Connector,!0===n&&(i.views.main=new Ne.SVGConnView("egraph_views_SVGConnView egraph_views_mySVGConnView")),i.multiset(["cstr","attach"],e,["cstr","offset"],o),i},q=function(t){e.is(t.connectors)||(t.connectors={}),Te||(t.connectors.top=Y(ke.BorderCstr.TOP,0,!0),t.connectors.top.id="top_"+t.id,t.appendConnector(t.connectors.top),t.connectors.bottom=Y(ke.BorderCstr.BOTTOM,0,!0),t.connectors.bottom.id="bottom_"+t.id,t.appendConnector(t.connectors.bottom),t.connectors.left=Y(ke.BorderCstr.LEFT,0,!0),t.connectors.left.id="left_"+t.id,t.appendConnector(t.connectors.left),t.connectors.right=Y(ke.BorderCstr.RIGHT,0,!0),t.connectors.right.id="right_"+t.id,t.appendConnector(t.connectors.right)),t.connectors.topRight=Y(ke.BorderCstr.TOP,1,!1),t.connectors.topRight.id="topRight"+t.id,t.appendConnector(t.connectors.topRight),t.connectors.bottomRight=Y(ke.BorderCstr.BOTTOM,1,!1),t.connectors.bottomRight.id="bottomRight"+t.id,t.appendConnector(t.connectors.bottomRight)},ye=function(t,n,i){var o,r,a="http://www.w3.org/2000/svg";(o=document.createElementNS(a,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+t.display.elt.id),o.setAttribute("startOffset","50%"),""===n.mark?o.appendChild(document.createTextNode("")):n.mark.linkInfo.hasOwnProperty(i)&&(r=e.is(n.mark.linkInfo[i])&&"NULL"!==n.mark.linkInfo[i]?n.mark.linkInfo[i]:"",o.appendChild(document.createTextNode(r))),t.display.text=document.createElementNS(a,"text"),t.display.text.setAttribute("dy","-5"),t.display.text.grElt=n,t.display.text.setAttribute("data-id",t.display.elt.id),t.display.text.style.cssText="text-anchor: middle;",Le.classListAdd(t.display.text,"edge-text"),t.display.text.appendChild(o),""!==o.innerHTML&&t.structure.root.appendChild(t.display.text)},X=function(t,n,i){var r,a;return e.is(i)?(a="-productFlow",e.is(i.linkInfo.flowType)?a="-productFlow-"+i.linkInfo.flowType:e.is(i.linkInfo.subType)&&("DELLmiTimeConstraintCnx_FinishToStart"===i.linkInfo.subType?a="-timeConstraint":"DELLmiTimeConstraintCnx_StartToStart"===i.linkInfo.subType?a="-timeConstraint":"DELLmiTimeConstraintCnx_FinishToFinish"===i.linkInfo.subType&&(a="-timeConstraint"))):a="-linkedObject",(r=new ke.Edge).set("geometry",new ke.AutoBezierGeometry),r.views.main=new o("egraph_views_SVGEdgeView my-sec-edge-view"+a),r.mark=i,F.addEdge(t,n,r),r},we=function(t,n){var i,o,r,a,s="headerBackgroundColor",l="headerTextColor",d="tileBackgroundColor",c="tileTextColor",u="Equal",p="NotEqual",f="LessThanOrEqual",m="GreaterThanOrEqual",g=function(t){switch(t.graphicalElement){case s:e.is(t.color)&&!i&&(i=t.color);break;case l:e.is(t.color)&&!o&&(o=t.color);break;case d:e.is(t.color)&&!r&&(r=t.color);break;case c:e.is(t.color)&&!a&&(a=t.color)}};return n.sort((e,t)=>e.ruleNumber-t.ruleNumber),n.forEach(function(n){var i;if(e.is(n.name)){if(e.is(t[n.name])&&e.is(n.attributeValue))switch(i=e.is(t[n.name],"object")?t[n.name].name:t[n.name],n.attributeCondition){case u:i===n.attributeValue&&g(n);break;case p:i!==n.attributeValue&&g(n);break;case f:parseFloat(i)<=parseFloat(n.attributeValue)&&g(n);break;case m:parseFloat(i)>=parseFloat(n.attributeValue)&&g(n)}}else e.is(n.name)||g(n)}),{headerBackgroundColor:i,headerTextColor:o,tileBackgroundColor:r,tileTextColor:a}},le=function(t,n){var i,o="",r={headerContainer:n.querySelector(".title-container"),tileContainer:n.querySelector(".my-node-container")},a=function(n,i,r,a){var s,l,d,c,u,p=Array.isArray(n)?n:[n],f=new e.Element("div",{class:"my-node-line"}),m=0,g=100/p.length;e.is(i)&&(({headerBackgroundColor:s,headerTextColor:l,tileBackgroundColor:d,tileTextColor:c}=we(t,i)),(u=p.filter(t=>e.is(t.maxWidth))).forEach(e=>m+=parseInt(e.maxWidth)),m<100&&(g=(100-m)/(p.length-u.length))),p.forEach(function(n){var i,u,p,m="",h=g,y="12px",P=new e.Element("span",{class:"my-node-word"});n.fontSize&&G(n.fontSize)&&(y=n.fontSize),n.maxWidth&&(h=n.maxWidth),s&&a.headerContainer.setStyles({backgroundColor:s}),d&&a.tileContainer.setStyles({backgroundColor:d}),r.className.contains("sub-title")?(p=n.color?n.color:c||"#3d3d3d",n.fontWeight&&(u=n.fontWeight)):(p=n.color?n.color:l||"#fff",u="bold"),i=e.is(n.dicoType)?n.dicoType+"."+n.name:n.name,e.is(t[i])&&(n.displayTitle&&(m=n.title+" : "),e.is(t[i],"object")?m+=t[i].nls:"NULL"!==t[i]?m+=t[i]:m+=""),""===m?P.destroy():(P.setText(m),P.setStyles({fontWeight:u,color:p,maxWidth:h+"%",fontSize:y}),o+=m,o+=" ",P.inject(f))}),e.is(f)&&(""!==f.innerText&&(o+="\n"),f.inject(r))};N.title&&((i=n.querySelector(".title-container")).innerHTML="",a(N.title,N.colors,i,r)),N.subtitles&&((i=n.querySelector(".sub-title-container")).innerHTML="",N.subtitles.forEach(function(e){a(e,N.colors,i,r)})),n.tooltipInfos=new Re({shortHelp:o})},y=function(t,n){var i="",o=n.querySelector(".sub-title-container");o.innerHTML="",e.is(t.name)&&function(t,n){var o=new e.Element("div",{class:"my-node-line"}),r=new e.Element("span",{class:"my-node-word linked-node"});r.setText(t),i=t,r.inject(o),o.inject(n)}(t.name,o),n.tooltipInfos=new Re({shortHelp:i})},B=function(t,n,i){var o=new ke.Node,a=t.id,s=Te?35:90;return a=a.replace(new RegExp(",","g"),"_"),o.views.main=new r,o.model=t,o.PID=t.id,o.id="node_"+a,o.multiset("left",n,"top",i,"width",250,"height",s),q(o),r.prototype.buildNodeElement=function(t){var n,i,o;return e.is(t)&&(i=t.model.tileInfo,(n=Te?h():M()).addClassName("egraph_views_HTMLNodeView_Node "+i.className+" "+t.model.id),e.is(i.icon)&&e.is(i.icon.iconPath)&&(o=n.getElementsByClassName("my-node-type-img")[0],e.is(o)&&(o.crossOrigin="Anonymous",o.src=i.icon.iconPath+"?not-from-cache-please",e.is(N.options.displayIcon)&&"Disabled"===N.options.displayIcon&&!Te&&(o.style.display="none",n.getElementsByClassName("sub-title-container")[0].style.paddingLeft="20px")))),e.is(i)&&e.is(i)&&(Te?y(i,n):le(i,n)),n},o},H=function(){var t,n,i=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","svg")),o=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","defs")),r=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","marker")),a=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","path"));i.appendChild(o),o.appendChild(r),r.appendChild(a),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("style","position:absolute;"),r.setAttribute("id","arrow-edge-end-marker"),r.setAttribute("markerWidth","10"),r.setAttribute("markerHeight","8"),r.setAttribute("refX","8"),r.setAttribute("refY","4"),r.setAttribute("orient","auto"),a.setAttribute("d","M 0 0 L 10 4 L 0 8"),a.setAttribute("fill","#777"),a.setAttribute("stroke","none"),a.setAttribute("z-index","10"),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker"),o.appendChild(t),(n=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-timeConstraintMarker"),o.appendChild(n),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-QuantityDistribution"),o.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Failed"),o.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Alternative"),o.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Scrapped"),o.appendChild(t),(W=e.createElement("div",{class:"canvas-gv",id:"canvas-"+R})).addEvent("contextmenu",function(t){e.Event.stop(t)}),W.appendChild(i)},ce=function(e){Ne.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",Te||(this.display.elt.setAttribute("data-link-type-nls",e.mark.linkInfo.NLS),this.display.elt.setAttribute("data-link-from",e.mark.fromNodeId),this.display.elt.setAttribute("data-link-to",e.mark.toNodeId),this.display.elt.setAttribute("data-link-category",e.mark.linkInfo.flowType||"Good"),this.display.elt.setAttribute("data-link-isProductFlow",e.mark.linkInfo.isProductFlow),N.options.displayInfoOnFlow&&("Disp_Info_Description"===N.options.displayInfoOnFlow?ye(this,e,"description"):"Disp_Info_ReasonCode"===N.options.displayInfoOnFlow&&ye(this,e,"reasonCode")))},Ie=function(e){var t;return(t=new Ce.StateMachine(e,null,null,e.views.main)).rootState&&(ee&&(t.rootState.doubleClickOnNode=ee),t.rootState.oncontextmenu=U,t.rootState.onmouseup=u),t.state.onwheel=function(e,t){if(t.inside){const n=e.graphView;if(n.zoominc){const e=W.getBoundingClientRect();n.zoominc(.5*t.wheelDelta,t.clientPos[0]-e.x,t.clientPos[1]-e.y)}}},t},_=function(){var e;return Le.inherit(r,Ne.HTMLNodeView),Le.inherit(o,Ne.SVGEdgeView),o.prototype.oncreateDisplay=ce,(e=new ke.EGraph).setViewOpts({addTopologicalIds:!0}),e.addView("main",new Ne.HTMLGraphView(W)),e.setZoomOpts({customMgt:!0}),e.updateLock(),e},j=function(){var e,t,n;for(n=new Le.BoundingRect,e=F.nodes.first;e;e=ke.dftNext(F,e))"node_page_aspect_ratio"!==e.id&&n.update(e,e.actualLeft-300,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);t=Le.reframeViewpoint(F.views.main.getSize(),n,{padding:15,minSize:50,horizontal:-1,vertical:-1,aliasing:0,defaultVpt:F.views.main.vpt,maxScale:1}),F.views.main.setViewpoint(t,!0)},T=function(){var t,n,o,r,d=!0,c=!1;F.addChangeListener(function(u){var p,f,m,g,h,y,P={},I=[],w=!1;if("edges"===u[0].path[0]&&!Be&&(e.is(x[0])&&"LinearProductFlowCnx"===x[0].linkType&&(w=!0),p=u[0].child.cl2.c,f=u[0].child.cl1.c,null!==p&&null!==f&&e.is(p.node.model)&&e.is(f.node.model)&&!w)){if(f.node.PID===p.node.PID&&f.id!==p.id){if(null!==(m=u[0].child.prev)){for(h=m;h;h=h.prev)h.cl2.c.id!==f.id&&h.cl1.c.id!==f.id||!e.is(h.mark)||I.push(h);1===I.length?null!==(y=I[0])&&e.is(y.mark)&&(y.mark.toNodeId===p.node.model.id?(y.join(null,u[0].child,null,f),P[Ae]=y.mark.startAnchorPos,g=l(y.mark,p.id,!1),P[Se]=g.anchorPositionValue,e.is(P)&&e.is(a,"function")&&a(y.mark.id,P,!1)):y.mark.fromNodeId===p.node.model.id&&(y.join(u[0].child,null,f,null),g=l(y.mark,p.id,!1),P[Ae]=g.anchorPositionValue,P[Se]=y.mark.endAnchorPos,e.is(P)&&e.is(a,"function")&&a(y.mark.id,P,!1))):I.length>1&&e.is(s,"function")&&s()}}else e.is(u[0].child.geometry)||!V||k||(Be=!0,V(f.node.model,p.node.model,f.id,p.id));setTimeout(function(){if(e.is(W))for(t=W.getElements("path"),n=0;n<t.length;n++)"official"!==(r=t[n]).innerHTML&&("none"===window.getComputedStyle(r).getPropertyValue("marker-end")&&(r.parentElement.id.contains("arrow-edge-end-")||r.parentElement.removeChild(t[n])))},500)}c=u.some(function(t){return"selection"===t.path[0]&&(o=t.child),"nodes"===t.path[0]&&"moved"===t.type&&(e.is(o)&&e.is(o.model)&&(i.includes(o.model.PPRType)||"RESOURCE"===o.model.PPRType)&&o.addChangeListener(function(e){e.forEach(function(e){"updated"!==e.type||Fe||(e.object[e.name]=e.oldValue)})}),!0)}),d||(d=u.some(function(e){return"selection"===e.path[0]}))}),F.addListener("update",function(){var t,n,i,r,a,s=[];if(d&&!k){if(d=!1,Me)return void(_e||(Me=!1));for(a=e.clone(Ue,!0),Ue={},t=F.selection.first;t;t=t.nextSel)n=t.model,Ue[t.PID]||(Ue[t.PID]=!0),a[t.PID]||(i=n);for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&!Ue[r]&&s.push(r);se&&(e.is(i)||s.length>0)&&se(i,s)}else{if(Fe)return void(Fe=!1);!c||Fe||k||e.is(o)&&e.is(o.model)&&e.is(o.model.linkedObjectsInfo)&&E(o)}u()})},Q=function(e){var t,n={},i=0;for(e=Array.isArray(e)?e:[e],t=F.nodes.first;t&&(e.indexOf(t.PID)>-1&&(n[t.PID]=t,i++),i!==e.length);t=ke.dftNext(F,t));return n},K=function(e){var t,n={},i=[];for(e=Array.isArray(e)?e:[e],t=F.nodes.first;t;t=ke.dftNext(F,t))e.indexOf(t.PID)>-1&&i.push(t);return i.length>0&&(n[e]=i),n},w=function(e,t){var n,i={},o=0;for(t=Array.isArray(t)?t:[t],n=F.nodes.first;n&&(t.indexOf(n.PID)>-1&&n.id.contains(e)&&(i[n.PID]=n,o++),o!==t.length);n=ke.dftNext(F,n));return i},ie=function(t){var n,i=[];for(t=Array.isArray(t)?t:[t],n=F.edges.first;n;n=n.next)e.is(n.mark)&&t.indexOf(n.mark.id)>-1&&i.push(n);return i},te=function(){x.forEach(function(t){var n,i,o,r=Q([t.fromNodeId,t.toNodeId]);o=function(e,n){switch(e){case"North":return 0===n?r[t.fromNodeId].connectors.top:r[t.toNodeId].connectors.top;case"South":return 0===n?r[t.fromNodeId].connectors.bottom:r[t.toNodeId].connectors.bottom;case"East":return 0===n?r[t.fromNodeId].connectors.right:r[t.toNodeId].connectors.right;case"West":return 0===n?r[t.fromNodeId].connectors.left:r[t.toNodeId].connectors.left;default:return 0===n?r[t.fromNodeId].connectors.right:r[t.toNodeId].connectors.left}},e.is(t.startAnchorPos)&&e.is(t.endAnchorPos)?(n=o(t.startAnchorPos,0),i=o(t.endAnchorPos,1)):(n=r[t.fromNodeId].connectors.right,i=r[t.toNodeId].connectors.left),r[t.toNodeId].model.isLoopNode&&(i=r[t.toNodeId].connectors.left),r[t.fromNodeId].model.isLoopNode&&(n=r[t.fromNodeId].connectors.right),e.is(n)&&e.is(i)&&X(n,i,t)})},ne=function(){var t,n={},i={},o=[],r=0,a={},s={},l={};x.forEach(function(t){e.is(l[t.fromNodeId])||(l[t.fromNodeId]=[]),l[t.fromNodeId].push(t.toNodeId)}),L.forEach(function(t){var a=t.xPos,s=t.yPos,l=t.id,d=a+","+s;e.is(a)&&e.is(s)&&(0===a&&0===s?(r++,e.is(n[d])?o.push(t):(n[d]=l,i[l]={vertical:a,horizontal:s})):(n[d]=l,i[l]={vertical:a,horizontal:s}))}),r===L.length&&(o=L,n={},i={}),o.forEach(function(t){!function t(n,i){var o=i;e.is(a[n])?o=a[n]:a[n]=o,e.is(l[n])&&l[n].forEach(function(n){e.is(a[n])||(t(n,o+1),s[n]=!1)}),0===o&&(s[n]=!0)}(t.id,0)}),(s=e.Object.keys(s).filter(function(e){return s[e]})).forEach(function(o){!function o(r,s){var d;for(t=a[r];e.is(n[t+","+Oe]);)Oe++;e.is(l[r])&&(d=l[r].find(function(e){return s.indexOf(e)>-1})),e.is(d)&&(L.find(function(e){return e.id===r}).isLoopNode=!0,Oe++),n[t+","+Oe]=r,i[r]={horizontal:t,vertical:Oe},e.is(d)&&Oe++,e.is(l[r])&&l[r].forEach(function(t){e.is(i[t])||o(t,s.concat([t]))})}(o,[o]),Oe++}),L.forEach(function(e){var t,n,o;o=150*i[e.id].vertical,n=450*i[e.id].horizontal,t=B(e,n,o),F.addNode(t)})},J=function(){return L.some(function(t){return-1===Ge.indexOf(t.PPRType)&&Ge.push(t.PPRType),e.is(t.parentId)})?"HIERARCHY":"SEQUENCE"},$=function(){if(!e.is(F)){F=_(),O=Ie(F),C=J();try{Z()&&ne(),te(),ue()}finally{F.updateUnlock()}T(),j()}},oe=function(t){var n,i,o,r,s,d={},c=Q([t.fromNodeId,t.toNodeId]);2===e.Object.keys(c).length&&(e.is(t.startAnchorPos)&&e.is(t.endAnchorPos)?(o=t.startAnchorPos,r=t.endAnchorPos):""!==t.startAnchorSelectedId&&""!==t.endAnchorSelectedId?(o=t.startAnchorSelectedId,r=t.endAnchorSelectedId):e.is(c[t.fromNodeId].gr.edges.last)&&e.is(c[t.toNodeId].gr.edges.last)?(o=c[t.fromNodeId].gr.edges.last.cl1.c.id,r=c[t.toNodeId].gr.edges.last.cl2.c.id):(o="West",r="East"),n=(s=l(t,o,!0)).connectorValue,d[Ae]=s.anchorPositionValue,i=(s=l(t,r,!1)).connectorValue,d[Se]=s.anchorPositionValue,e.is(n)&&e.is(i)&&e.is(d)&&e.is(a,"function")&&(X(n,i,t),e.is(t.startAnchorPos)||e.is(t.endAnchorPos)||a(t.id,d,!1))),Be=!1},re=function(t){var n,i,o;try{Z()&&(F.updateLock(),e.is(t.linkedObjectsInfo)?(i=t.yPos,o=t.xPos,Ve=0,Te=!0,t.linkedObjectsInfo.forEach(function(r,a){var s=i,l=I(a,o,r.PPRType);e.is(l)&&((n=B(r,s,l)).id+="##node_"+t.nodeId,F.addNode(n),P(n,r.PPRType,t.nodeId))})):(n=B(t,0,150*Oe),Oe++,F.addNode(n)))}finally{F.updateUnlock()}},P=function(t,n,o){var r,a,s=Q([o])[o];i.includes(n)?(r=t.connectors.bottomRight,a=s.connectors.topRight):"RESOURCE"===n&&(r=t.connectors.topRight,a=s.connectors.bottomRight),e.is(r)&&e.is(a)&&X(a,r,null)},ae=function(e){var t,n=Q([e]);for(t in n)n.hasOwnProperty(t)&&F.removeNode(n[t])},de=function(t,n){var i=Q([t]);i=i[t],e.is(i)&&(i.model=e.extend(i.model,n),le(i.model.tileInfo,i.view.elts.node))},Pe=function(t){var n,o,r=Q([t]);for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i.includes(r[n].model.PPRType)||"RESOURCE"===r[n].model.PPRType?(o=K([t]),e.is(o)&&o[n].length>0&&(Ue[n]=!0,Me=!0,o[n].forEach(function(e,t){_e=t!==o[n].length-1,F.addToSelection(e)}))):(Ue[n]=!0,Me=!0,F.addToSelection(r[n])))},ue=function(){L.forEach(function(e){e.preSelected&&Pe(e.id)}),Me=!1},z=function(){var t,n,o,r=[];for(t=F.nodes.first;t;t=ke.dftNext(F,t))o=Math.round(t.left/450),n=Math.round(t.top/150),e.is(t.model)&&!i.includes(t.model.PPRType)&&"RESOURCE"!==t.model.PPRType&&r.push({instancePID:t.model.instancePID,x:n,y:o});return r},g=function(){var t,n,o,r=[];for(t=F.nodes.first;t;t=ke.dftNext(F,t))o=t.left,n=t.top,e.is(t.model)&&!i.includes(t.model.PPRType)&&"RESOURCE"!==t.model.PPRType&&r.push({instancePID:t.model.instancePID,x:n,y:o});return r},l=function(e,t,n){var i,o,r=Q([e.fromNodeId,e.toNodeId]);return t.includes("top_node")||t.includes("North")?(i=n?r[e.fromNodeId].connectors.top:r[e.toNodeId].connectors.top,o="North"):t.includes("left_node")||t.includes("West")?(i=n?r[e.fromNodeId].connectors.left:r[e.toNodeId].connectors.left,o="West"):t.includes("bottom_node")||t.includes("South")?(i=n?r[e.fromNodeId].connectors.bottom:r[e.toNodeId].connectors.bottom,o="South"):(t.includes("right_node")||t.includes("East"))&&(i=n?r[e.fromNodeId].connectors.right:r[e.toNodeId].connectors.right,o="East"),{connectorValue:i,anchorPositionValue:o}},fe=function(){var t,n,i,o,r,a,s="",l="",d="",c="";for(e.is(F.edges)&&(l=me()),e.is(N.options.displayInfoOnFlow)&&("Disp_Info_Description"===N.options.displayInfoOnFlow?d="description":"Disp_Info_ReasonCode"===N.options.displayInfoOnFlow&&(d="reasonCode")),t=F.edges.first;t;t=t.next)e.is(t)&&(i=Math.round(t.cl1.c.left),o=Math.round(t.cl1.c.top),r=Math.round(t.cl2.c.left),a=Math.round(t.cl2.c.top),e.is(t.mark)&&(e.is(t.mark.linkInfo)&&(n=e.is(t.mark.linkInfo.flowType)?t.mark.linkInfo.flowType:e.is(t.mark.linkInfo.isProductFlow)&&!1===t.mark.linkInfo.isProductFlow?"TimeConstraint":"Good",t.mark.linkInfo.hasOwnProperty(d)&&(c=e.is(t.mark.linkInfo[d])&&"NULL"!==t.mark.linkInfo[d]?t.mark.linkInfo[d]:"")),s+=pe(i,o,r,a,n,c)));return s=l+s},me=function(){return"<defs>\n    <marker \n      id='Alternative' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#52957a\" stroke= \"#52957a\"/>\n    </marker>\n  </defs>\n  \n  <defs>\n    <marker \n      id='Scrapped' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#cfc661\" stroke= \"#cfc661\"/>\n    </marker>\n  </defs>\n\t\t\t\t\n   <defs>\n    <marker \n      id='Failed' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#bb7052\" stroke= \"#bb7052\"/>\n    </marker>\n  </defs>\n\t\t\t\t\n\t<defs>\n    <marker \n      id='Good' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"blue\" stroke= \"blue\"/>\n    </marker>\n  </defs>\n\n  <defs>\n    <marker\n      id='QuantityDistribution'\n      orient=\"auto\"\n      markerWidth='10'\n      markerHeight='8'\n      refX='10'\n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#800080\" stroke= \"#800080\"/>\n    </marker>\n  </defs>\n\n  <defs>\n    <marker \n      id='TimeConstraint' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#03e4d8\" stroke= \"#03e4d8\"/>\n    </marker>\n  </defs>"},pe=function(e,t,n,i,o,r){var a;"Alternative"===o?a="#52957a":"Scrapped"===o?a="#cfc661":"Failed"===o?a="#bb7052":"Good"===o?(o="Good",a="blue"):"QuantityDistribution"===o?a="#800080":(o="TimeConstraint",a="#03e4d8");const s=`ID_${o}_${++We}`;return`<path\n    id='${s}'\n    marker-end='url(#${o})'\n    stroke-width='3'\n    fill='${a}' stroke='${a}'  \n    d='M${e},${t}, ${n} ,${i}'/> \n    <text>\n      <textPath xlink:href='#${s}' startOffset='50%' style='text-anchor:middle' alignment-baseline='text-after-edge'>${r}</textPath>\n     </text>`},ge=function(e){var t=document.createElement("canvas");return e.crossOrigin="Anonymous",t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")},he=function(t,n){var i="",o="";return e.is(t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var r,a="";r=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,e.is(n[r])&&(t.displayTitle&&(a=t.title+" : "),e.is(n[r],"object")?a+=n[r].nls:"NULL"!==n[r]?a+=n[r]:a+="",i+=a,""!==a&&(i+=" ")),""!==a&&(o+=a,o+="\n")}),{lineText:i,tooltipSVG:o}},ve=function(t,n){var i;return e.is(n)&&(i=we(t,n)),i},Ee=function(t){var n=!0;return e.is(t.options)&&(n=!e.is(t.options.displayIcon)||"Disabled"!==t.options.displayIcon),n},be=function(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return e.replace(/[&<>"']/g,e=>t[e])},d=function(){var t,n;return F.updateLock(),c||(n=function(){Ne.HTMLNodeView.call(this)},Le.inherit(n,Ne.HTMLNodeView),(t=new ke.Node).views.main=new n,t.PID="page_aspect_ratio",t.id="node_"+t.PID,n.prototype.buildNodeElement=function(){var n=e.createElement("div");return n.addClassName("egraph_views_HTMLNodeView_Node "+t.id),n.setStyles({"pointer-events":"none","border-color":"black","border-style":"dashed","border-width":"medium","border-radius":"0",background:"0",position:"absolute"}),n},c=t),De?ae(c.PID):F.addNode(c),De=!De,F.updateUnlock(),De},u=function(){var e,t,n,i,o,r,a;if(De){for(t=new Le.BoundingRect,e=F.nodes.first;e;e=ke.dftNext(F,e))"node_page_aspect_ratio"!==e.id&&t.update(e,e.actualLeft,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);o=v/b,i=Math.abs(t.xmax-t.xmin),(n=Math.abs(t.ymax-t.ymin))>i?(r=n/o,t.xmin+r<t.xmax?n=i*o:i=r):(a=i*o,t.ymin+a<t.ymax?i=n/o:n=a),i+=40,n+=40,Number.isNaN(i)||Number.isNaN(n)||c.multiset("left",t.xmin-20,"top",t.ymin-20,"width",i,"height",n)}},p=function(e,t){isNaN(e)||isNaN(t)||(v=e,b=t,u())},E=function(t){var n,o,r,a,s,l=function(e,t){e=e.sort(function(e,n){var o;return e=e.model,n=n.model,i.includes(t)?(e=e.tileInfo.name.replace(/ *\([^)]*\) */g,""),o=(n=n.tileInfo.name.replace(/ *\([^)]*\) */g,"")).localeCompare(e)):"RESOURCE"===t&&(e=e.tileInfo.name,n=n.tileInfo.name,o=e.localeCompare(n)),o})};n=t.model.linkedObjectsInfo.map(e=>e.id),e.is(n)&&(o=Object.values(w(t.PID,n)),e.is(o)&&o.length>0&&(r=o.filter(e=>i.includes(e.model.PPRType)),a=o.filter(e=>"RESOURCE"===e.model.PPRType),e.is(r)&&r.length>0&&(l(r,s=r[0].model.PPRType),r.forEach(function(n,i){var o=I(i,t.actualTop,s),r=t.actualLeft;e.is(o)&&e.is(r)&&(Fe=!0,n.multiset("left",r,"top",o))})),e.is(a)&&a.length>0&&(l(a,"RESOURCE"),a.forEach(function(n,i){var o=I(i,t.actualTop,"RESOURCE"),r=t.actualLeft;e.is(o)&&e.is(r)&&(Fe=!0,n.multiset("left",r,"top",o))}))))},I=function(e,t,n){var o;return i.includes(n)?0===e?Ve=o=t-50:o=Ve-45*e:"RESOURCE"===n&&(0===e?Ve=o=t+105:o=Ve+45*e),o},f=function(e){e.forEach(function(e){re(e)}),Te=!1},m=function(e){e.forEach(function(e){re(e)}),Te=!1},{init:function(){H()},inject:function(e){W.inject(e)},createGraphComponent:function(){$()},refreshNodeLinks:function(e,t){var n=ie(e);this.removeLink(e),n.forEach(function(e){e.mark.startAnchorPos=t[Ae],e.mark.endAnchorPos=t[Se],oe(e.mark)})},destroy:function(){W.remove(),W.destroy(),W=void 0},addLink:function(e){oe(e)},removeLink:function(e){ie(e).forEach(function(e){e.remove()})},addNode:function(e){re(e)},removeNode:function(e){ae(e)},selectNode:function(e){Pe(e)},generateSVGForGraph:function(){var t,n,o=-1,r="",a=0,s=0,l=-50,d=-25;for(t=F.nodes.first;t;t=ke.dftNext(F,t)){var c,u,p,f,m,g,h,y,P,I,w,E,v,b,k,C,L="",x=50,R=40,A=[],S="",D="",T="",V="",O="";"node_page_aspect_ratio"!==t.id&&(i.includes(t.model.PPRType)||"RESOURCE"===t.model.PPRType||(h=Math.round(t.left),y=Math.round(t.top),I=h,w=y,l=h<l?h:l,d=y<d?y:d,a=h>a?h:a,s=y>s?y:s,o++,!0===(u=Ee(N))?(v=document.querySelectorAll(".my-node-type-img:not(.linked-node)")[o],e.is(v)&&(L=ge(v),D=`<image x="${I+5}" y="${w+25}" width="65" height="65" style="image-rendering:optimizeQuality" xlink:href="${L}"/>`)):x=10,E=t.model.id,n=t.model.tileInfo,c=ve(n,N.colors),p=e.is(c.headerBackgroundColor)?c.headerBackgroundColor:"#3d3d3d",f=e.is(c.headerTextColor)?c.headerTextColor:"#fff",m=e.is(c.tileBackgroundColor)?c.tileBackgroundColor:"#f1f1f1",g=e.is(c.tileTextColor)?c.tileTextColor:"black",N.title&&(k=he(N.title,n),e.is(k.lineText)&&(P=k.lineText,C=be(P),P.length>48&&(V="240")),e.is(k.tooltipSVG)&&(O+=be(k.tooltipSVG),O+="\n")),k="",N.subtitles&&N.subtitles.forEach(function(t){k=he(t,n),e.is(k.lineText)&&""!==(b=k.lineText)&&A.push(b),e.is(k.tooltipSVG)&&""!==k.tooltipSVG&&(O+=be(k.tooltipSVG),O+="\n")}),A.forEach(e=>{var t;T=e.length>40&&!0===u?"195":!1===u&&e.length>47?"235":"",t=be(e),S+=""!==T?`<text x="${I+x}" y="${w+R}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${g}" textLength="${T}" lengthAdjust="spacingAndGlyphs">${t}</text>`:`<text x="${I+x}" y="${w+R}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${g}">${t}</text>`,A.length<=4?R+=15:R+=10}),r=r+(`<g>\n                        <rect x="${I}" y="${w}" width="250" id="${E}" height="90" rx="3" ry="3" stroke="grey" stroke-width="1" fill="${m}" />\n                        <title>${O}</title>\n                        <rect x="${I}" y="${w}" width="250" id="${E}" height="20" rx="3" ry="3" fill="${p}" />`+(""!==V?`<text x="${I+5}" y="${w+13}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${f}" textLength="${V}" lengthAdjust="spacingAndGlyphs">${C}</text>`:`<text x="${I+5}" y="${w+13}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${f}">${C}</text>`)+`<circle cx="${I}" cy="${w+45}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                        <circle cx="${I+250}" cy="${w+45}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                        <circle cx="${I+125}" cy="${w}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                        <circle cx="${I+125}" cy="${w+90}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>`+D+S)+"</g>"))}return-1===Math.sign(l)&&(a+=Math.abs(l),l+=-30),-1===Math.sign(d)&&(s+=Math.abs(d),d+=-15),r=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="${l} ${d} ${a+500} ${s+180}">`+r+fe()+"</svg>"},unselectNode:function(t){var n,o,r=Q([t]);for(n in r)r.hasOwnProperty(n)&&(i.includes(r[n].model.PPRType)||"RESOURCE"===r[n].model.PPRType?(o=K([t]),e.is(o)&&(r[n]=o[n].filter(e=>e.isSelected()&&Ue[n]),r[n].length>0&&(Ue[n]=!1,Me=!0,r[n].forEach(function(e,t){_e=t!==r[n].length-1,F.removeFromSelection(e)})))):r[n].isSelected()&&Ue[n]&&(Ue[n]=!1,Me=!0,F.removeFromSelection(r[n])))},updateNode:function(e,t){de(e,t)},resizeTheGraph:function(){j()},getCurentTilePosition:function(){return z()},getGraphDefaultToolbar:function(t){var n;return e.is(F)&&e.is(O)&&(t=Array.isArray(t)?t:e.is(t)?[t]:[],n=O.generateToolbarModel(t)),n},togglePageAspectRatio:function(){return d()},updatePageAspectRatioValues:function(e,t){return p(e,t)},unlockEdgeCreation:function(){Be=!1},displayLinkedItemsNodes:function(e){return f(e)},displayLinkedResourcesNodes:function(e){return m(e)},getTilesPositionWithoutOffset:function(){return g()}}}}),define("DS/DELPPWProductFlowSequenceModule/GraphPanel",["UWA/Core"],function(e){"use strict";return function(t,n){var i,o,r,a,s,l,d=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext()),c=n.create("Element","div",{class:"EGraphView-panel-container"}),u=d.getImmersiveFrame(),p={};return i=function(){var e,t;o=n.create("Panel",{domId:r,identifier:"panel-EGraph"+r,position:{my:"center",at:"center"},title:a,immersiveFrame:u,content:c,minWidth:290,minHeight:250,width:700,height:400,snappableFlag:!1,resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!0}),e=(window.screen.width-o.width)/2,t=(window.screen.height-o.height)/2,o.elements.container.style.left=e+"px",o.elements.container.style.top=t+"px",o.close=function(){s?s():o.hide()}},{init:function(t){p=e.extend(p,t),r=e.is(t.identifier)?t.identifier:"",a=e.is(t.title)?t.title:"",s=e.is(t.onClose,"function")?t.onClose:null,l=e.is(t.className)?t.className:""},destroy:function(){e.is(o)&&(o.destroy(),o=void 0)},show:function(){e.is(o)&&!1===o.visibleFlag&&o.show()},hide:function(){o.hide()},getContainer:function(){return c},buildSkeleton:function(){i(),c.addClassName(l)}}}}),define("DS/DELPPWProductFlowSequenceModule/ProductFlowSequenceModule",["UWA/Core","DS/DELPPWProductFlowSequenceModule/ProductFlowComponent","DS/DELPPWProductFlowSequenceModule/GraphPanel","DS/VENPPWDomToImageModule/DOMToImage","text!DS/DELPPWProductFlowSequenceModule/assets/json/ProductFlowCustomParams.json"],function(e,t,n,i,o){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","ResourceBehavior","SelectionBehavior","EditAttributeBehavior","LinkBehavior","ProductFlowLinkBehavior","RootsBehavior","DocumentBehavior","ProcessImplementBehavior"],creator:function(i,r,a,s,l,d,c,u,p,f,m){const g=["PROCESS","SERVICE"];var h,y,P,I,w,E,v,b,k,N,C,L,x,R,A,S,D=["OPERATION","SYSTEM"],T=["DELAsmProcessCanUseCnx","ProcessImplementLinkOcc"],V=!1,F=!1,O=!1,M=!1,_=!1,U=r.getComponent("Breadcrumb"),B=r.getComponent("GeneratedToolbar"),G=r.getComponent("ModalContainer"),W=r.getComponent("TooltipModel"),$=r.create("WUXLoader",{showButtonFlag:!1}),j=e.createElement("div",{class:"pert-loading-cont"}),H=r.getComponent("WUXCommandsManager"),z=u.getProductFlowRelationTypes(),Y=function(){var t,n=new Map,o=!0;e.is(I)&&((t=I.getCurentTilePosition()).every(function(e){var t=e.x+","+e.y;return n.has(t)?(o=!1,i.warn(s.getNLSValue("ProductFlowLinkBehavior.TilePosition.Overlap")),!1):(n.set(t,!0),!0)}),o&&u.saveTilePositions(t))},q=function(e){var t,n;f.fetchDocuments(E,function(i){t=i.map(function(e){return e.get("dataelements").title}),n=t.some(function(e,n){return t.indexOf(e)!==n}),e({isValid:n,values:t,documents:i})})},X=function(){var t;e.is(I)&&(t=I.generateSVGForGraph());const n=new Blob([t],{type:'image/svg+xml;base64," + BinaryToBase64(ImageBinary)'}),o=new File([n],"Export_PFDView.svg",{type:'image/svg+xml;base64," + BinaryToBase64(ImageBinary)'});q(function(t){var n;t.isValid?i.warn(s.getNLSValue("ProductFlowView.MultipleDocIssue")):-1!==(n=t.values.indexOf("Export_PFDView"))?f.modifyFile({id:t.documents[n].get("id")},{file:o,fileName:"Export_PFDView.svg"},"Export_PFDView"):f.uploadDocument(E,{title:"Export_PFDView",policy:"Document Release",description:""},[{comments:"",file:o}],function(){var t,n;t="download",n=R,e.is(n)&&n.items.getChildren().forEach(function(e){e.options.id===t&&e.updateOptions({disabled:!1})})})})},Q=function(){q(function(e){var t;e.isValid?i.warn(s.getNLSValue("ProductFlowView.MultipleDocIssue")):-1!==(t=e.values.indexOf("Export_PFDView"))?f.downloadDocument(e.documents[t].get("id")):i.warn(s.getNLSValue("ProductFlowView.DocNotAvailableIssue"))})},K=function(){var t=[];if(e.is(I)&&e.is(C.pageAspectRatio)&&C.pageAspectRatio.length>0){let n,i=!1;e.is(sessionStorage.getItem(widget.id+"_pageAspectRatioLabel"))?(n=C.pageAspectRatio.find(e=>e.label===sessionStorage.getItem(widget.id+"_pageAspectRatioLabel")),n=e.is(n)?n:C.pageAspectRatio[0]):n=C.pageAspectRatio[0],I.updatePageAspectRatioValues(n.height,n.width),i=I.togglePageAspectRatio(),sessionStorage.setItem(widget.id+"_isPageAspectRatioEnabled",i),t=C.pageAspectRatio.map(e=>e.label),i?R.updateNodeModel("aspectRatioComboBox",{visibleFlag:!0,disabled:!1,possibleValues:t,grid:{data:n.label}}):R.updateNodeModel("aspectRatioComboBox",{visibleFlag:!1,disabled:!0})}},J=function(t){var n;e.is(C.pageAspectRatio)&&(n=C.pageAspectRatio.find(e=>e.label===t.getAttributeValue("data")),e.is(I)&&e.is(n)&&(I.updatePageAspectRatioValues(n.height,n.width),sessionStorage.setItem(widget.id+"_pageAspectRatioLabel",n.label)))},Z=function(t){var n,i=[],o=[],r=I.getTilesPositionWithoutOffset();if(e.is(y))return y.forEach(function(a){var s,l;e.is(a.linkedObjectsInfo)&&(l=a.linkedObjectsInfo.filter(function(e){return t.includes(e.PPRType)}),e.is(l)&&l.length>0&&(e.is(t,"array")&&(t=l[0].PPRType),l=l.sort(function(e,n){var i;return g.includes(t)?(e=e.tileInfo.name.replace(/ *\([^)]*\) */g,""),i=(n=n.tileInfo.name.replace(/ *\([^)]*\) */g,"")).localeCompare(e)):"RESOURCE"===t&&(e=e.tileInfo.name,n=n.tileInfo.name,i=e.localeCompare(n)),i}),e.is(r)&&(n=r.find(e=>e.instancePID===a.instancePID)),e.is(l)&&e.is(n)&&(s={nodeId:a.id,xPos:n.x,yPos:n.y,linkedObjectsInfo:[...l]},i.push(s),o.push(...l))))}),g.includes(t)||g===t?A=i:"RESOURCE"===t&&(S=i),o},ee=function(e){e.forEach(function(e){I.removeNode(e.id)})},te=function(){var t=Z(g);e.is(t)&&e.is(A)&&(A.map(e=>I.unselectNode(e.nodeId)),M?(ee(t),M=!1):(I.displayLinkedItemsNodes(A),M=!0))},ne=function(){var t=Z("RESOURCE");e.is(t)&&e.is(S)&&(S.map(e=>I.unselectNode(e.nodeId)),_?(ee(t),_=!1):(I.displayLinkedResourcesNodes(S),_=!0))},ie=function(e,t){ee(e),g.includes(t)?I.displayLinkedItemsNodes(A):"RESOURCE"===t&&I.displayLinkedResourcesNodes(S)},oe=function(t){var n,i={entries:[]},o=e.is(t)?t:{},r="DELMGA_AP"===widget.getValue("appId")||"DELMGAS_AP"===widget.getValue("appId"),a="DELRME_AP"===widget.getValue("appId")||"DELRMEC_AP"===widget.getValue("appId"),l="DELSVR_AP"===widget.getValue("appId")||"DELSVRC_AP"===widget.getValue("appId"),d=function(){return{id:"",dataElements:{typeRepresentation:"functionIcon",icon:{fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"2x",className:"action"},position:"far",category:"view"}}};we(),k=e.createElement("div",{class:"egraph-toobar"}),ae(w.id,w.path).inject(k),I&&((r||a||l)&&(i.entries.push(function(){let e=d();return e.id="displayLinkedItems",e.dataElements.icon=s.getIconURLFromKey("DisplayLinkedItems"),e.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.DisplayLinkedItems.Tooltip")}),e.dataElements.category="advancedTools",e.dataElements.value=te,e}()),i.entries.push(function(){let e=d();return e.id="displayLinkedResources",e.dataElements.icon=s.getIconURLFromKey("DisplayLinkedResources"),e.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.DisplayLinkedResources.Tooltip")}),e.dataElements.category="advancedTools",e.dataElements.value=ne,e}())),i.entries.push(function(){let e=d();return e.id="aspectRatioComboBox",e.dataElements.typeRepresentation="customEnumMember",e.dataElements.disabled=!0,e.dataElements.visibleFlag=!1,e.dataElements.category="advancedTools",e.onNodeUpdate=J,e}()),i.entries.push(function(){let t=d();return t.id="pageAspectRatio",t.dataElements.icon.iconName="group",t.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.PageAspectRatio.Tooltip")}),t.dataElements.value=K,t.dataElements.category="advancedTools",e.is(C)&&e.is(C.pageAspectRatio,"array")&&0!==C.pageAspectRatio.length||(t.dataElements.disabled=!0,t.dataElements.visibleFlag=!1),t}()),i.entries.push(function(t){var n=e.clone(t);switch(n.id){case"zoomFit":n.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.FitInAll.Tooltip")})}return n}(I.getGraphDefaultToolbar({type:"ZoomFit",position:"far"}).entries[0])),i.entries.push(function(){let e=d();return e.id="refresh",e.dataElements.icon.iconName="refresh",e.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.Refresh.Tooltip")}),e.dataElements.value=be,e}()),L||(i.entries.push(function(){let e=d();return e.id="screenshot",e.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.Capture.Tooltip")}),e.dataElements.icon.iconName="camera",e.dataElements.value=X,e}()),i.entries.push(function(){var e;e=(o.attachedDocuments||[]).map(function(e){return e.get("dataelements").title}).includes("Export_PFDView");let t=d();return t.id="download",t.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.Download.Tooltip")}),t.dataElements.icon.iconName="download",t.dataElements.value=Q,t.dataElements.disabled=!e,t}()),i.entries.push(function(){let e=d();return e.id="save",e.dataElements.icon.iconName="floppy",e.dataElements.tooltip=new W({title:s.getNLSValue("GraphView.SaveTilePosition.Tooltip")}),e.dataElements.value=Y,e}())),n=B.prototype.createTreeDocument(i),(R=new B({overflowManagement:"dropdown",direction:"horizontal",items:n})).elements.container.addClassName("graph-right-actions"),R.inject(k)),e.is(sessionStorage.getItem(widget.id+"_isPageAspectRatioEnabled"))&&"true"===sessionStorage.getItem(widget.id+"_isPageAspectRatioEnabled")&&K(),k.inject(N,"top")},re=function(t){var n=t.model,i={objectId:n.referencePID};g.includes(n.PPRType)||"RESOURCE"===n.PPRType||(e.is(x)&&(i.filterQuery=x),Ee(i).then(function(){w.id=e.is(n.instancePID)?n.instancePID:n.referencePID,w.path=n.occcurancePath,be()}))},ae=function(t,n){var o,r,l,d,c,u=e.createElement("div",{class:"egraph-navigator"}),p=[],f=function(e,t,n){l&&p.unshift({label:l.get("PLMEntity.V_Name"),icon:{iconPath:s.getIconURLFromKey(l.get("type")),iconSize:{width:"20px",height:"20px"}},id:t,path:n})};if(e.is(n,"string")&&(n=n.split(",")),0===n.length)f(0,(l=a.getReference(t)).get("PID"),[]);else for(c=n.length-1;c>=0;c--)d=n[c],l=a.getReferenceModel(d),f(0,d,n.slice(0,c+1)),0===c&&(r=a.getInstance(d),f(0,(l=a.getAggregatingReferenceModelFromInstance(r)).get("PID"),[]));return p.length>0&&(o=new U({value:p,mode:U.MODE.NAVIGATION})).addEventListener("selectionChange",function(){var e;i.notify("EGraphNodeSelect",{selectedNodeIds:[w.id]}),F=!0,e=o.selectedValues[0],w=e,be()}),o.inject(u),u},se=function(t){var n,i,o,r,l,d,c=[],u={},f="",h=!!e.is(t.get("to"),"array"),y=h?t.get("to")[t.get("to").length-1]:t.get("to"),P=function(t){var n,i;n=a.getParentInstancesFromCollection(t),e.is(n)&&n.length>0&&(i=n[0],c.unshift(i.id),e.is(i.get("isAggregatedBy"))&&P(i.get("isAggregatedBy")))};if(o=a.getReferenceModel(y),e.is(o)){if(h&&!function(t,n){var i,o,r=a.getInstance(n);if(e.is(r)&&(i=a.getAggregatingReferenceModelFromInstance(r),e.is(i)))if(o=p.getRootFilter(i.id),e.is(o)&&e.is(o.originalFilterQuery)){if(o=o.originalFilterQuery,0===a.getFilteredInstancesFromCollection(t.id,o,{sort:!0}).length)return!1}else o=void 0;return!0}(o,y))return;return g.includes(o.get("PPRTYPE"))&&(n=m.getRoleFromModelOrComputed(t.id),i=m.getQuantityFromModel(t.id),d=t.get("to"),r=l=y),"RESOURCE"===o.get("PPRTYPE")&&(P(o.id),c.length>0?(d=c,r=l=c[c.length-1]):r=o.id),e.is(n)&&(f+="("+n.nlsText+")",e.is(i)&&(f+="("+i+")")),f+=o.get("PLMEntity.V_Name")+" "+o.get("revision"),u.id=r,u.instancePID=l,u.referencePID=o.id,u.occcurancePath=d,u.PPRType=o.get("PPRTYPE"),u.tileInfo={className:" EGraph_linkedObj_"+o.get("PPRTYPE"),name:f,icon:{iconPath:s.getIconURLFromKey(o.get("type"))}},u.link={id:t.id,linkType:t.get("type")},u}},le=function(t,n){var i={},o=function(i,o){var r,a;return e.is(n)&&(r=n.get(i)),"type"===i&&(r=t.get(i),o&&(r=s.getNLSValue("Type."+r))),e.is(t.get(i),"string")&&"true"===t.get(i).toLowerCase()?r=!0:e.is(t.get(i),"string")&&"false"===t.get(i).toLowerCase()&&(r=!1),r="NULL"!==r&&e.is(r)?r:t.get(i),e.is(r)&&o&&(a=c.getAttributeNLSForUnit(i),e.is(a)&&""!==a&&(r+=" "+a)),r};return i.className=" EGraph_obj_"+t.get("PPRTYPE"),i.icon={iconPath:s.getIconURLFromKey(t.get("type"))},[v.title].concat(v.subtitles).forEach(function(t){(Array.isArray(t)?t:[t]).forEach(function(t){var n,r;r=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,n=o(r,!0),e.is(n)&&(i[r]=n)})}),e.is(C)&&e.is(C.colors)&&C.colors.colorParamsList.forEach(function(r){var s,l,d,c,u=i[r.name];e.is(r.name)&&(l=r.name,c=a.getAttributeInfo(l),e.is(c)&&e.is(c.AuthorizedValues)?(e.is(n)&&(d=n.get(l)),e.is(d)||(d=t.get(l)),c.AuthorizedValues.forEach(function(e){e.NLS===d&&(d=e.Name)})):d=o(l,!1),s=d,e.is(s)&&(e.is(u)?i[r.name]={name:s,nls:u}:i[r.name]=s))}),i},de=function(t,n,o){var r,s,l=t.get("PPRTYPE");return r={id:o.toString(),PPRType:l,type:t.get("type"),instancePID:n.get("PID"),referencePID:t.get("PID"),occcurancePath:o,tileInfo:le(t,n),linkedObjectsInfo:function(t,n){var i,o=[],r=[],s=[],l=n[n.length-1];if(e.is(t)&&r.push({id:t,path:n}),e.is(l)&&r.length>0&&(a.isNavigateOnDemand()?c.getRelations(r).then(function(){s=c.getImpactedConnections(l,!1,{relationTypes:T})}):s=c.getImpactedConnections(l,!1,{relationTypes:T})),s.length>0&&s.forEach(function(t){e.is(t.get("from"),"array")?JSON.stringify(t.get("from"))===JSON.stringify(n)&&(i=se(t),e.is(i)&&o.push(i)):(i=se(t),e.is(i)&&o.push(i))}),o.length>0)return o}(t.id,o)},s="OPERATION"===l?"DELLmiOperationInstance.":"SYSTEM"===l?"DELLmiProductionSystemInstance.":"",e.is(n.get(s+"V_X2DPos"))&&e.is(n.get(s+"V_Y2DPos"))?(r.xPos=Number(n.get(s+"V_X2DPos")),r.yPos=Number(n.get(s+"V_Y2DPos"))):(r.xPos=0,r.yPos=0,i.debug(n.get("PID")+" V_X2DPos, V_Y2DPos are missing ")),r},ce=function(t,n){var i,o,r,s,d=[],u=[],f=[],m={sort:!0},g=[];return r=function(e,t){return e.some(function(e){return e.id===t})},s=function(e){return l.getSelectedInsts().findIndex(function(t){return t.get("isAggregatedBy")===i.get("PID")&&t.get("PID")===e})>-1},i=a.getReferenceModel(t),((o=function(){var t,n,i;return e.is(x)?t=x:e.is(w)&&(0===w.path.length?n=w.id:(i=a.getInstance(w.path[0]),n=(i=a.getReference(i.get("isAggregatedBy"))).get("PID")),n&&(t=p.getRootFilter(n),t=e.is(t)&&e.is(t.originalFilterQuery)?t.originalFilterQuery:void 0)),t}())?a.getFilteredInstancesFromCollection(i.get("PID"),o,m):a.getInstancesFromCollection(i.get("PID"),m)).forEach(function(t){var i,o,r,l,c;l=t.get("PID"),c=n.concat([l]),r=a.getReferenceModelFromInstance(t),e.is(r)&&D.indexOf(r.get("PPRTYPE"))>-1&&(i=s(l),d.push(l),g.push({id:l}),(o=de(r,t,c)).preSelected=i,f.push(o))}),function(t){return a.isNavigateOnDemand()?(t.push({id:w.id,path:w.path}),c.getRelations(t)):e.Promise.resolve()}(g).then(function(){return a.getImpactedConnections(d,!1,{relationTypes:z}).forEach(function(t){var n,i,o,a,s,l;f.every(function(o){return o.id.includes(t.get("from"))?n=o.id:o.id.includes(t.get("to"))&&(i=o.id),!(e.is(n)&&e.is(i))}),a=t.get("PID"),e.is(n)&&e.is(i)&&!r(u,a)&&(o=c.getLinkInfo(t),s=t.get("DELArrowDisplayExt.V_ArrowStartPosition"),l=t.get("DELArrowDisplayExt.V_ArrowEndPosition"),u.push({id:a,fromNodeId:n,toNodeId:i,linkType:t.get("type"),linkInfo:o,startAnchorPos:s,endAnchorPos:l}))}),{nodes:f,links:u}})},ue=function(t){var n=i.getAppContext();return{icon:"url("+s.getIconURLFromKey("DisplayProperties")+")",label:s.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var i=H.getCommandCheckHeader("DisplayProperties",n),o=a.getReferenceIdFromInstance(t.instancePID);e.is(i)&&!1===i.getState()&&(i.options.node={referencePID:o,instancePID:t.instancePID,absPath:t.occcurancePath},i.toggleState())}}},pe=function(e){return[{icon:"url("+s.getIconURLFromKey("GeneralDelete")+")",label:s.getNLSValue("LinksUI.DeleteLink"),sensitivity:"LinearProductFlowCnx"!==e.linkType?"enabled":"disabled",callback:function(){var t=c.getConnection(e.id);c.deleteConnection(t,{onFailure:function(){i.warn(s.getNLSValue("LinksUI.DeleteFailure"))},onComplete:function(){i.info(s.getNLSValue("LinksUI.DeleteSuccess"))},logMessage:s.getNLSValue("LinksUI.LogMessage")})}},{icon:"url("+s.getIconURLFromKey("EditAttribute")+")",label:s.getNLSValue("LinksUI.EditAttribute"),sensitivity:d.hasEditConfiguration(e.id)?"enabled":"disabled",callback:function(){d.editConfiguredAttributes(e.id)}},{icon:"url("+s.getIconURLFromKey("EditAnchorPositions")+")",label:s.getNLSValue("LinksUI.EditAnchorPositions"),sensitivity:"LinearProductFlowCnx"!==e.linkType?"enabled":"disabled",callback:function(){u.editAnchorPositions(e.id)}}]},fe=function(t){var n=t.link,o=e.is(t.occcurancePath,"array")?t.occcurancePath.join(","):t.occcurancePath,r=i.getAppContext();return[{icon:"url("+s.getIconURLFromKey("GeneralDelete")+")",label:s.getNLSValue("LinksUI.DeleteLink"),sensitivity:T.includes(n.linkType)?"enabled":"disabled",callback:function(){var e=c.getConnection(n.id);c.deleteConnection(e,{onFailure:function(){i.warn(s.getNLSValue("LinksUI.DeleteFailure"))},onComplete:function(){i.info(s.getNLSValue("LinksUI.DeleteSuccess"))},logMessage:s.getNLSValue("LinksUI.LogMessage")})}},{icon:"url("+s.getIconURLFromKey("EditAttribute")+")",label:s.getNLSValue("LinksUI.EditAttribute"),sensitivity:d.hasEditConfiguration(n.id)?"enabled":"disabled",callback:function(){d.editConfiguredAttributes(n.id)}},{icon:"url("+s.getIconURLFromKey("DisplayProperties")+")",label:s.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var n=H.getCommandCheckHeader("DisplayProperties",r);e.is(n)&&!1===n.getState()&&(n.options.node={referencePID:t.id,instancePID:t.instancePID,absPath:o},n.toggleState())}}]},me=function(t,n,o,r){var s={allowMove:!0},l=[];t&&(s.targetInstancePID=t.instancePID,s.targetInstancePIDsArray=t.occcurancePath,s.targetReferencePID=a.getReferenceIdFromInstance(t.instancePID),s.targetRootReferencePID=a.getInstance(t.occcurancePath[0]),s.targetRootReferencePID=e.is(s.rootReferencePID)?s.rootReferencePID.get("isAggregatedBy"):null,s.startAnchorId=o),n&&(s.instancePID=n.instancePID,s.instancePIDsArray=n.occcurancePath,s.referencePID=a.getReferenceIdFromInstance(n.instancePID),s.rootReferencePID=a.getInstance(n.occcurancePath[0]),s.rootReferencePID=e.is(s.targetRootReferencePID)?s.targetRootReferencePID.get("isAggregatedBy"):null,s.endAnchorId=r),"OPERATION"!==t.PPRType&&"SYSTEM"!==t.PPRType||"OPERATION"!==n.PPRType&&"SYSTEM"!==n.PPRType||(s.linkType=u.getProductFlowRelationTypeByTypes(t.type,n.type),e.is(s.linkType)&&(s.unlockEdgeCreation=function(){I.unlockEdgeCreation()},l.push(s),i.notify("CreateLinkOrInstance",[l])))},ge=function(t,n){var o,r={};l.getSelections()[0].indexOf(w.id)>-1&&n.push(w.id),n.length>0&&(n=n.map(function(e){var t=e.split(",");return t[t.length-1]}),F=!0),r.selectedNodeIds=n,t&&(o=a.getReferenceIdFromInstance(t.instancePID),r.changed={nodeId:e.is(o)?o:t.id,childOccurencePath:e.is(t.occcurancePath)?t.occcurancePath:null,isSelected:!0},V=!0),i.notify("EGraphNodeSelect",r)},he=function(e,t,n){u.saveAnchorPositions(e,t,n)},ye=function(){i.warn(s.getNLSValue("ProductFlowLinkBehavior.AnchorPosition.MultiplePositionChange"))},Pe=function(){e.is(b)&&Re()},Ie=function(){e.is(I)&&(I.destroy(),I=void 0)},we=function(){e.is(k)&&(k.destroy(),k=void 0)},Ee=function(t){return t=t||{},new Promise(function(n){var i,o,r={};e.is(h.forceFetch)&&h.forceFetch&&e.is(t.objectId)?(i=t.objectId,o=function(){e.is(N)&&($.off(),G.removeModal(j),j.remove()),n()},e.is(N)&&(j.inject(N),G.createModal(j,$.elements.container),$.on()),e.is(h.expandLevel)&&(r.expandLevel=h.expandLevel),e.is(h.withLinks)&&(r.withLinks=h.withLinks),e.is(h.withLinksResolved)&&(r.withLinksResolved=h.withLinksResolved),e.is(h.relationTypes)&&(r.gridIDs=h.relationTypes),e.is(h.forceDBMode)&&(r.forceDBMode=h.forceDBMode),e.is(t.filterQuery)&&(r.filterQuery=t.filterQuery),a.getDescendantsFromServer([i],o,r)):n()})},ve=function(){return ce(w.id,w.path).then(function(e){y=e.nodes,P=e.links,E=a.isReference(w)?w.id:a.getReferenceIdFromInstance(w),Ie(),(I=new t(r,{nodes:y,links:P,readOnly:L,identifier:"PPR-PERTVIEW",nodeOptions:v,getNodeContextMenu:ue,getLinkContextMenu:pe,getLinkedNodeContextMenu:fe,onNodeDoubleClick:re,onConnectingNodes:me,onNodeSelectionChange:ge,onSaveAnchorPositions:he,onMultiplePositionChangeAlert:ye})).init()})},be=function(){return ve().then(function(){I.inject(N),I.createGraphComponent(),M&&(M=!1,te()),_&&(_=!1,ne()),f.fetchDocuments(E,function(e){var t={};t.attachedDocuments=e||[],oe(t)})})},ke=function(t,n,i){var o,r,s,l,d,u,p,f,m,h;O||Array.isArray(t)||T.includes(t.get("type"))?O||Array.isArray(t)||!T.includes(t.get("type"))||(u=e.is(t.get("from"),"array")?t.get("from")[t.get("from").length-1]:t.get("from"),p=a.isInstance(u)?y.find(e=>e.instancePID===u):y.find(e=>e.referencePID===u),e.is(p)&&(f=se(t),p.linkedObjectsInfo.push(f),"ProcessImplementLinkOcc"===t.get("type")?(m=Z(g),ie(m,m[0].PPRType)):"DELAsmProcessCanUseCnx"===t.get("type")&&(h=Z("RESOURCE"),ie(h,"RESOURCE")))):(y.every(function(n){var i=t.get("from"),a=t.get("to");return i=Array.isArray(i)?i.join(","):i,a=Array.isArray(a)?a.join(","):a,n.id.includes(i)?o=n.id:n.id.includes(a)&&(r=n.id),!(e.is(o)&&e.is(r))}),e.is(o)&&e.is(r)&&(s=c.getLinkInfo(t),l=t.get("DELArrowDisplayExt.V_ArrowStartPosition"),d=t.get("DELArrowDisplayExt.V_ArrowEndPosition"),I.addLink({fromNodeId:o,toNodeId:r,id:t.get("PID"),linkType:t.get("type"),linkInfo:s,startAnchorPos:l,endAnchorPos:d,startAnchorSelectedId:e.is(i.startAnchorId)?i.startAnchorId:"",endAnchorSelectedId:e.is(i.endAnchorId)?i.endAnchorId:""})))},Ne=function(t){(Array.isArray(t)?t:[t]).forEach(function(t){var n,i,o,r,s,l,d;I.removeLink(t.get("PID")),T.includes(t.get("type"))&&(i=e.is(t.get("from"),"array")?t.get("from")[t.get("from").length-1]:t.get("from"),o=e.is(t.get("to"),"array")?t.get("to")[t.get("to").length-1]:t.get("to"),r=a.isInstance(i)?y.find(e=>e.instancePID===i):y.find(e=>e.referencePID===i),e.is(r)&&(s=r.linkedObjectsInfo,e.is(s)&&-1!==(n=s.findIndex(e=>a.isInstance(o)?e.id===o:e.referencePID===o))&&(I.removeNode(s[n].id),s.splice(n,1),"ProcessImplementLinkOcc"===t.get("type")?(l=Z(g),ie(l,l[0].PPRType)):"DELAsmProcessCanUseCnx"===t.get("type")&&(d=Z("RESOURCE"),ie(d,"RESOURCE")))))})},Ce=function(t){var n,i,o,r=t.get("isInstanceOf"),s=t.get("PID"),l=a.getReferenceIdFromInstance(w.id);l||(l=w.id),t.get("isAggregatedBy")===l&&(a.isSystem(r)||a.isOperation(r))&&(n=a.getReference(r),i=w.path.concat([s]),o=de(n,t,i),I.addNode(o),y.push(e.clone(o)))},Le=function(e){(Array.isArray(e)?e:[e]).forEach(function(e){var t=w.path.concat([e.get("PID")]).toString();I.removeNode(t)})},xe=function(t){var n,i=t.changed,o=i.absPath.toString();""===o?o=i.nodeId:o.contains(",")&&(n=o.split(","),o=n[n.length-1]),e.is(I)&&(i.isSelected?(V||I.selectNode(o),V=!1):(F||I.unselectNode(o),F=!1))},Re=function(){be()},Ae=function(e){I.refreshNodeLinks(e.linkPID,e.iAnchorPositionsToSet)},Se=function(){},De=function(){we(),Ie()},Te=function(){O=!0,Ie()},Ve=function(t){(t=Array.isArray(t)?t:[t]).forEach(function(t){var n=le(t);y.forEach(function(i,o){i.referencePID===t.get("PID")&&(y[o].tileInfo=e.clone(e.extend(y[o].tileInfo,n)),I.updateNode(y[o].id,y[o]))})})},Fe=function(t){!e.is(w)||w.id!==t&&w.path[0]!==t||(O=!O&&O,a.getDescendantsFromServer([t],function(){e.is(k)||oe(),be()},{expandLevel:1,forceDBMode:!0}))},Oe=function(t){var o,a;t.showPanel&&(o=s.getNLSValue(t.titleGraph),(b=new n(i,r,s)).init({title:o,identifier:"PPR-PERTVIEW",className:"PERTVIEW-panel-container",onClose:function(){e.is(t.toggleCmdId)?i.notify("toggleCmdCheckHeaderState",{cmdName:t.toggleCmdId,cmdState:!1}):b.hide()}}),N=b.getContainer(),a=l.getSelectionsWithPaths()[0][0],w={id:a.id,path:a.path},b.buildSkeleton(),b.show(),be())},Me=function(t){var n;return t.displayAttributeName&&(t.displayTitle=!0,"type"===t.name?t.title=s.getNLSValue("Column.Type"):(n=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,t.title=s.getNLSValue(n))),t};return{name:"ProductFlowViewModule",listenTo:function(){return{select:xe,connectionAdded:ke,connectionRemoved:Ne,instanceAdded:Ce,instanceRemoved:Le,refreshImpacted:Re,ExpandFilterApplied:Re,Hide:Se,HideAll:De,refreshAll:Te,refreshProductFlowView:Pe,addRootNode:Fe,referenceChanged:Ve,refreshNodeLinks:Ae}},onStart:function(t,n){v={title:[],subtitles:[],options:[],colors:[]},h=t=t||{},function(t,n){a.webServiceGETRequest("resources/delmia/param/configuration/getAllParameters?domainID=DELUserExperience","GET",function(t){var i="DisplayInformationOnFlowCombobox",r="DisplayIconCheckbox",a="DELProcessFlowDiagramAttriutesListParam",s="DELProcessFlowDiagramColorListParam",l="DELProcessFlowDiagramAspectRatiosListParam";C={attributes:{displayInfoOnFlow:"",displayIcon:"",attributeList:[]},colors:{colorParamsList:[]},pageAspectRatio:[]},e.is(localStorage.getItem("isPO"))?C=e.Json.decode(o):e.is(t)&&t.length>0&&(t.forEach(function(t){switch(t.paramid){case i:C.attributes.displayInfoOnFlow=t.params.value;break;case r:C.attributes.displayIcon=t.params.value;break;case a:e.is(t.params.attributeName)&&t.params.attributeName.contains("BusinessType.")&&(t.params.attributeName=t.params.attributeName.slice(t.params.attributeName.indexOf(".")+1)),C.attributes.attributeList.push({rowIndex:t.params.rowIndex?t.params.rowIndex:null,mergeWithPreviousRow:t.params.mergeWithPreviousRow?t.params.mergeWithPreviousRow:null,name:t.params.attributeName?t.params.attributeName:null,displayAttributeName:t.params.displayAttribute?t.params.displayAttribute:null,maxWidth:t.params.maxWidth?t.params.maxWidth:null});break;case s:e.is(t.params.attributeName)&&(t.params.attributeName.contains("BusinessType.")&&(t.params.attributeName=t.params.attributeName.slice(t.params.attributeName.indexOf(".")+1)),"DicoType"===t.params.attributeName&&(t.params.attributeName="type")),C.colors.colorParamsList.push({graphicalElement:t.params.graphicalElement?t.params.graphicalElement:null,color:t.params.color?t.params.color:null,attributeValue:e.is(t.params.attributeValue)?t.params.attributeValue:null,ruleNumber:t.params.ruleNumber?t.params.ruleNumber:null,name:t.params.attributeName?t.params.attributeName:null,attributeCondition:t.params.attributeCondition?t.params.attributeCondition:null});break;case l:C.pageAspectRatio.push({label:t.params.aspectRatioName,width:t.params.aspectRatioWidth,height:t.params.aspectRatioHeight})}}),0===C.attributes.attributeList.length&&(C.attributes.attributeList=[{rowIndex:"1",mergeWithPreviousRow:null,name:"PLMEntity.V_Name",displayAttributeName:null,maxWidth:"90"},{rowIndex:"2",mergeWithPreviousRow:!0,name:"revision",displayAttributeName:null},{rowIndex:"3",mergeWithPreviousRow:null,name:"PLMInstance.PLM_ExternalID",displayAttributeName:null},{rowIndex:"4",mergeWithPreviousRow:null,name:"DELLmiOperationReference.V_EstimatedTime",displayAttributeName:!0}])),e.is(n,"function")&&n()},function(){var n;e.is(t.displayNodeConfigXML)&&(n=c.getXMLValues(t.displayNodeConfigXML),e.is(n.Config.Preferences)&&e.is(n.Config.Preferences.Node)&&e.is(n.Config.Preferences.Node.Lines)&&e.is(n.Config.Preferences.Node.Lines.Line)&&n.Config.Preferences.Node.Lines.Line.forEach(function(e,t){var n=Array.isArray(e.Attribute)?e.Attribute:[e.Attribute];n=n.map(Me),0===t?v.title=n:v.subtitles.push(n)})),Oe(t)})}(t,function(){var n=0,i=[];e.is(C)&&e.is(C.attributes.attributeList)&&(C.attributes.attributeList.sort((e,t)=>e.rowIndex-t.rowIndex),C.attributes.attributeList.forEach(function(e){if(e=Me(e),1===parseInt(e.rowIndex)||0===n&&e.mergeWithPreviousRow)e.index=n,v.title.push(e);else if(e.mergeWithPreviousRow)e.index=n,i.push(e),parseInt(e.rowIndex)===C.attributes.attributeList.length&&v.subtitles.push(i);else{if(0!==n&&v.subtitles.push(i),parseInt(e.rowIndex)===C.attributes.attributeList.length)return void v.subtitles.push([e]);e.index=++n,i=[e]}}),C.attributes.displayInfoOnFlow&&(v.options.displayInfoOnFlow=C.attributes.displayInfoOnFlow),C.attributes.displayIcon&&(v.options.displayIcon=C.attributes.displayIcon)),e.is(C)&&e.is(C.colors.colorParamsList)&&(v.colors=C.colors.colorParamsList),Oe(t)}),n()},onStop:function(){e.is(I)&&(I.destroy(),I=void 0),e.is(b)&&(b.destroy(),b=void 0)},createSequence:function(e){return Ee(e).then(function(){var t=e.objectId;return w={id:t,path:[]},x=e.filterQuery,ve()})},inject:function(e){N=e,I.inject(N),I.createGraphComponent(),oe()},setReadOnly:function(e){L=e}}}}});