define("DS/InstantMessagingCall/store/modules/notifSW",["DS/RTProxyDriver/RTLogger","i18n!DS/InstantMessagingCall/assets/nls/feed"],function(e,t){"use strict";window.Notification=window.Notification||window.webkitNotification||window.mozNotification;const r=()=>({serviceWorker:navigator.serviceWorker,swScriptUrl:void 0,registration:void 0,actionsAvailability:null});return{state:r(),getters:{serviceWorker:e=>e.serviceWorker,swScriptUrl:e=>e.swScriptUrl,registration:e=>e.registration,actionsAvailability:e=>e.actionsAvailability,notificationsSupported:()=>!!window.Notification,serviceWorkerSupported:()=>!!navigator.serviceWorker,badgeIcon_url:()=>window.dsDefaultWebappsBaseUrl+"/i3DXCompass/assets/small-compass.ico",loginIcon_url:(e,t)=>e=>t.swymUrl+"/api/user/getpicture/login/"+e,accept_button:()=>({action:"accept",title:t.acceptCall}),cancel_button:()=>({action:"refuse",title:t.cancel}),resume_button:()=>({action:"resume",title:t.resumeCall}),refuse_button:()=>({action:"refuse",title:t.refuseCall})},mutations:{resetNotificationsState(e){Object.assign(e,r())},serviceWorker:(e,t)=>{e.serviceWorker=t},swScriptUrl:(e,t)=>{e.swScriptUrl=t},registration:(e,t)=>{e.registration=t},actionsAvailability:(e,t)=>{e.actionsAvailability=t}},actions:{notifSW({dispatch:t,getters:r},{action:i,data:s}){if(r.isMobile||r.isIOS)return e.CallNotif("No Desktop notifications for mobile");switch(i){case"initSW":t("initNotifSW");break;case"inviteReceived":t("notifInviteReceived",s);break;case"acceptCall":case"callAccepted":t("notifCallAccepted",s);break;case"endCall":t("closeNotification",{tag:s.room_id}),t("stopFocusListener");break;case"closeNotifRoomId":t("closeNotification",{tag:s.room_id});default:e.CallNotif("unknown notifications action "+i)}},onMessageSW({dispatch:t,getters:r},i){e.CallNotif("Message from desktop notification: "+i);let s=i.data&&i.data.action,o=i.data&&i.data.room_id,a=r.room(o);switch(s){case"accept":if(e.CallNotif("Call accepted from desktop notification: "+o),!a)return e.CallNotif("SW accept - No room found for "+o);t("acceptCall",{room_id:a.room_id,type:a.type,noNotif:!0});break;case"resume":if(e.CallNotif("Call resumed from desktop notification: "+o),!a)return e.CallNotif("SW resume - No room found for "+o);t("resumeCall",a.room_id);break;case"refuse":if(e.CallNotif("Call refused from desktop notification: "+o),!a)return e.CallNotif("SW refuse - No room found for "+o);t("endCall",a);break;default:e.CallNotif("unknown SW message "+i.data)}},initNotifSW({getters:t,dispatch:r,commit:i}){e.CallNotif("Desktop notifications permission set to: "+window.Notification&&window.Notification.permission),i("swScriptUrl",t.assets_url+"notifSwScript.js"),r("registerServiceWorker")},requestNotificationPermission({getters:t}){if(t.isMobile||t.isIOS)return e.CallNotif("Desktop notifications permission set to false for mobile");window.Notification.requestPermission(t=>{e.CallNotif("Desktop notifications permission set to "+t)})},registerServiceWorker:({commit:t,getters:r,dispatch:i},s)=>r.serviceWorkerSupported?r.actionsAvailability&&r.registration?(s&&i("showNotification",s),e.CallNotif("Service Workers already registered")):(e.CallNotif("Service Workers registration ..."),r.serviceWorker.register(r.swScriptUrl,{}).then(r=>{e.CallNotif("Service Workers registration SUCCESS"),t("registration",r),t("actionsAvailability",!0)}).catch(r=>{e.CallNotif("Service worker registration FAILED: "+r),t("actionsAvailability",!1)}).then(()=>{s&&i("showNotification",s)}),r.serviceWorker.onmessage=(e=>{i("onMessageSW",e)}),void r.serviceWorker.startMessages()):(t("actionsAvailability",!1),e.CallNotif("Service Workers not supported")),showNotification:({dispatch:t,getters:r},{title:i,options:s})=>r.isHidden?i?(e.CallNotif("New browser notification: "+i+" : "+s.body),window.Notification&&"granted"===window.Notification.permission?!1===r.actionsAvailability?(s.actions=[],e.CallNotif("Cannot send notification without registered service worker"),e.CallNotif("Actions button not supported")):r.registration&&r.registration.active?(r.registration.showNotification(i,s),e.CallNotif("Notification via Service Worker: "+i)):void 0:e.CallNotif("Cannot send notification if permission not granted: "+window.Notification&&window.Notification.permission)):e.CallNotif("Cannot send notification without title"):e.CallNotif("No notification sent when tab is focused. isHidden: "+r.isHidden),closeNotification:({getters:t},{tag:r})=>r?(e.CallNotif("Close notification ("+r+")"),t.registration?void t.registration.getNotifications().then(t=>{if(!t||!t[0])return e.CallNotif("Close notification: No opened notifications found.");t.filter(e=>e.tag===r).map(e=>e.close())}):e.CallNotif("Cannot close notification without registered service worker.")):e.CallNotif("Cannot close notification without tag."),closeAllNotifications({getters:t}){if(!t.registration)return e.CallNotif("Cannot close notifications without registered service worker.");t.registration.getNotifications().then(t=>{if(!t||!t[0])return e.CallNotif("Close all notifications: No opened notifications found.");e.CallNotif("Close all notifications: "+t.length+" opened notifications found."),t.map(e=>e.close())})},notifInviteReceived({dispatch:r,getters:i},{room_id:s,username:o,login:a}){if(e.CallNotif("Invite received: "+s),!s)return e.CallNotif("Cannot send callAccepted notifications without room_id.");const n=i.room(s);let l=n&&(i.roomName(n)||n.user&&n.user.username)||o||a,d=t.incoming,c=[i.accept_button,i.refuse_button];n&&n.IamTheCaller&&(d=t.calling,c=[i.cancel_button]),i.isOpera&&(c=[]);const u={body:d,tag:s,data:{url:window.location.href},icon:i.loginIcon_url(a),badge:i.badgeIcon_url,requireInteraction:!0,actions:c};i.isElectedSocket&&r("showNotification",{title:l,options:u})},notifCallAccepted({dispatch:r,getters:i},{room_id:s}){if(e.CallNotif("Call accepted: "+s),!s)return e.CallNotif("Cannot send callAccepted notifications without room_id.");const o=i.room(s),a=o&&(i.roomName(o)||o.user&&o.user.username)||i.called_users_name(s),n=i.logins_except_myself[0];let l=t.ongoing,d=[i.refuse_button];i.is_onhold_room(s)&&(l=t.onHold,d=[i.resume_button,i.refuse_button]),i.isOpera&&(d=[]);const c={body:l,tag:s,data:{url:window.location.href},icon:i.loginIcon_url(n),badge:i.badgeIcon_url,requireInteraction:!0,actions:d};i.isElectedSocket&&r("showNotification",{title:a,options:c})}}}}),define("DS/InstantMessagingCall/components/CollabOfficeDocument/CollabOfficeDocument",["text!DS/InstantMessagingCall/components/CollabOfficeDocument/CollabOfficeDocument.html","DS/UIKIT/Input/Button","DS/UIKIT/Mask"],function(e,t,r){"use strict";var i=void 0;const s=(e,t,r,s)=>{var o={community_id:t,id_media:r};i.save({callbackUrl:e+"/api/media/editmedia",params:o,headers:{"X-DS-SWYM-CSRFTOKEN":"ode:{csrfToken}"},filenameForUpload:"userFile",firstCallUrl:e+"/api/session/info"}).then(function(e){s()},function(e){switch(e){case i.ERROR.NO_DOCUMENT_URL_PROVIDED:console.error("ODE Collab : NO_DOCUMENT_URL_PROVIDED");break;case i.ERROR.SERVICE_NOT_FOUND:console.error("ODE Collab : SERVICE_NOT_FOUND");break;default:console.error("ODE Collab : "+e)}s(e)})};return{props:["featureData","featureId","active","swymDriver"],data:()=>({skip:!0}),computed:{dmId(){return this.$store.getters.dmId||this.$store.getters.accepted_room&&this.$store.getters.accepted_room.options&&this.$store.getters.accepted_room.options.dmId},title(){var e=this.featureData;if(!e||!e.title||!this.featureId)return this.publishButton&&this.publishButton.destroy(),this.$refs.OdeContainer&&this.$refs.OdeContainer.children[0]&&"function"==typeof this.$refs.OdeContainer.children[0].destroy&&this.$refs.OdeContainer.children[0].destroy(),i&&(i=void 0),null;if(e&&e.title&&e.ext&&e.url&&this.featureId){var o=this.$store.getters.swymUrl,a=this.dmId,n=this;this.publishButton=((e,r)=>{var i=document.getElementById("im-call-lightbox");if(i)var s=i.getElementsByClassName("lightbox-bar__menu");var o=s[0].getElementsByClassName("bt_publish");o[0]&&"function"==typeof o[0].destroy&&o[0].destroy();var a=new t({value:e,className:"primary bt_publish",id:"bt_publish",events:{onClick:r}});return a.getContent().style.margin="5px",s[0].insertBefore(a.getContent(),s[0].firstChild),a})(this.$store.getters.nls("publish"),()=>{r.mask(n.publishButton.getContent(),""),s(o,a,e.mediaId,function(e){r.unmask(n.publishButton.getContent()),e?n.$store.dispatch("alert_publishDocumentError"):n.$store.dispatch("alert_publishDocument")})}),(!this.reloadFeatureODE||this.reloadFeatureODE&&this.reloadFeatureODE.reload)&&((({title:e,ext:t,url:r},s,o,a,{isMobile:n,isODEEditionSupported:l})=>{if(!(e&&t&&r&&s))return console.error("loadODE missing params");o.children[0]&&"function"==typeof o.children[0].destroy&&o.children[0].destroy(),require("DS/TopFrame/TopFrame")._loadModules(["DS/OfficeDocumentEditorClient/Editor","DS/OfficeDocumentEditorClient/Utils"]).then(function(d){i=d[0];var c=d[1];if(i){var u=UWA.extendElement(o);i.init({title:e,ext:t,url:r,readOnly:!1,docKeyToUse:"featureId"+s,useIframe:!0,rootElem:u,platformId:a}).then(function(e){const r=c.isDeviceSupportedForEditingDoc(n,(()=>{switch(t){case"docx":return c.DOCTYPE.WORD;case"pptx":return c.DOCTYPE.PRESENTATION;case"xlsx":return c.DOCTYPE.SPREADSHEET}})());l(r)},function(e){switch(e){case i.ERROR.NO_DOCUMENT_URL_PROVIDED:console.error("ODE Collab : NO_DOCUMENT_URL_PROVIDED");break;case i.ERROR.SERVICE_NOT_FOUND:console.error("ODE Collab : SERVICE_NOT_FOUND");break;default:console.error("ODE Collab : "+e)}})}})})(e,this.featureId,this.$refs.OdeContainer,this.$store.getters.tenant,{isMobile:this.$store.getters.isMobile,isODEEditionSupported:e=>this.$store.dispatch("send_isODEEditionNotSupported",e)}),this.reloadFeatureODE&&this.reloadFeatureODE.reload&&(this.$store.dispatch("reloadFeatures",{kind:"ode",reload:!1,deleteReloadData:!0}),this.$store.dispatch("removeFeatureData",this.getFeature)))}return e.title},getFeature(){return this.$store.getters.getFeatureOfKind("ode")},swymUrl(){return this.$store.getters.swymUrl},reloadFeatureODE(){return this.$store.getters.reloadFeature("ode")},reload(){var e=this;return this.reloadFeatureODE&&this.reloadFeatureODE.save&&s(e.swymUrl,e.$store.getters.oldDmId,e.featureData.mediaId,function(t){t?e.$store.dispatch("alert_publishDocumentError"):(e.$store.dispatch("alert_publishDocument"),e.$store.dispatch("reloadFeatures",{kind:"ode",forward:!0,save:!1}))}),this.reloadFeatureODE&&this.reloadFeatureODE.forward&&(e.$store.dispatch("reloadFeatures",{kind:"ode",forward:!1,reload:!0}),e.$store.commit("isPrivateConv",!1),((e,t,r,i)=>new Promise((s,o)=>e.forwardSwym(t,r.mediaId).then(t=>t?(r.model=t,r.mediaId=t.id_media,r.title=r.title||"New Document",r.ext=r.ext||t.play.download_original_url.format,e.getMediaSwym(r.mediaId).then(e=>(r.url=e.play.download_original_url.transient_url,r.reload=!0,i(r),s(r)))):o())))(e.swymDriver,e.$store.getters.dmId,e.featureData,function(t){const r={...e.getFeature,featureData:t};e.$store.dispatch("sendFeature",r),e.$store.commit("feature",r)})),this.featureData.title}},template:e}}),define("DS/InstantMessagingCall/components/PanelTimeline/PanelTimeline",["text!DS/InstantMessagingCall/components/PanelTimeline/PanelTimeline.html"],function(e){"use strict";var t,r;return{computed:{dmId(){if(this.$store.getters.accepted_room&&this.$store.getters.accepted_room.options){this.$refs.TimelineContainer.children[0]&&this.$refs.TimelineContainer.children[0].destroy();var e=this.$store.getters.dmId||this.$store.getters.accepted_room.options.dmId;e&&((e,i,s)=>{if(t=t||require("DS/i3DXCompass/i3DXCompass"),r=r||require("UWA/Core"),!t||!r)return console.error("PanelTimeline prereqs not available");var o=UWA.extendElement(e);o.getParent().style.height="100%";i=i;var a=s.toUpperCase();t.getAppInfo({appId:"X3DMCTY_AP",onComplete:function(e){if(e){var t,s,n,l={communityType:"dm",community:i,x3dPlatformId:a,leftPanelState:"closed"},d=JSON.stringify(l),c={el:o,parent:!1,preview:!1,appId:"X3DMCTY_AP",data:d,header:!1};if(!e||!(e.checksum&&e.launchInfos||e.platforms))return console.error("Could not get valid Config from MyApps for the App "+c.appId);if(e.platformId&&e.platformId.toLowerCase()===a.toLowerCase())t=e.launchInfos,s=e.isolationLevel,n=e.checksum;else{var u=e.platforms.find(e=>e.id.toLowerCase()===a.toLowerCase());if(!u)return console.error("Could not get valid Config from MyApps for the App "+c.appId);t=u.launchInfos,s=u.isolationLevel,n=u.checksum}c=r.extend(c,{widgetId:t,isolationLevel:s,token:n}),require("DS/TopFrame/TopFrame")._loadModules(["DS/UWPClientCode/WidgetFactory","DS/TopFrame/Environment"]).then(function(e){var t=e[0],r=e[1];t.load(c,function(e){},r)})}}})})(this.$refs.TimelineContainer,e,this.$store.getters.tenant)}return this.$store.getters.accepted_room&&this.$store.getters.accepted_room.options&&this.$store.getters.accepted_room.options.dmId}},template:e}}),define("DS/InstantMessagingCall/api/senders",["DS/RTProxyDriver/RTProxyDriver","DS/PlatformAPI/PlatformAPI"],function(e,t){"use strict";const r=["startCall","endCall","acceptCall","webrtcIceCandidate","SDP","callEventFromView","sendSocketIdentifier"],i={};for(let t of r)i[t]=function(r){return function(i){var s;return e.dispatch(r,[{...i,TxID:(s=`${t}`,Date.now()+"-r"+Math.floor(998*Math.random()+1)+"-"+s)}]),!0}}(t);return i.presence=(t=>{e.dispatch("SETSTATUS",[{myStatus:t,statusMsg:t}])}),i.ToSwym=(e=>{t.publish("toswym.im.ds.com",e)}),i}),define("DS/InstantMessagingCall/components/CollabWhiteBoard/CollabWhiteBoard",["text!DS/InstantMessagingCall/components/CollabWhiteBoard/CollabWhiteBoard.html","DS/RTConvAPI/drivers/Swym_driver"],function(e){"use strict";return{props:["featureData","featureId","masterUser","active","swymDriver"],data:()=>({sketchObj:null,isLoaded:!1,mediaToForward:null}),computed:{title(){if(!this.active)return this.callInactive&&this.cleanWhiteboard(),null;var e=this.featureData;return e?(!this.isLoaded&&this.loadWhiteboard(),e.title):null},masterLogin(){if(!this.active||!this.masterUser)return null;var e=this.masterUser.login,t=e==this.$store.getters.myself.login;return this.sketchObj&&"function"==typeof this.sketchObj.onChangeCollabMaster&&this.sketchObj.onChangeCollabMaster({login:e,IAmMaster:t}),e},callInactive(){return this.$store.getters.isInitial||this.$store.getters.isEnded},getFeature(){return this.$store.getters.getFeatureOfKind("whiteboard")},reloadFeatureWhiteboard(){return this.$store.getters.reloadFeature("whiteboard")},reload(){var e=this;return this.reloadFeatureWhiteboard&&this.reloadFeatureWhiteboard.save&&(this.$store.dispatch("reloadFeatures",{kind:"whiteboard",save:!1}),((e,t,r)=>new Promise((i,s)=>{e.startPublish(e=>{var o=new File([e],"3DWhiteboard.3dwb"),a=new FormData;return a.append("is_illustration",!1),a.append("community_id",r.coreview.data.communityId),a.append("title",r.title||"New Document"),a.append("fileName",o.name),a.append("userFile",o,o.name),a.append("published",1),t.addMediaSwym(a).then(e=>e?i(e):s())})}))(this.sketchObj,this.swymDriver,this.featureData).then(t=>{t?(e.mediaToForward=t,e.$store.dispatch("reloadFeatures",{kind:"whiteboard",forward:!0})):console.log("ERROR when saving")})),this.reloadFeatureWhiteboard&&this.reloadFeatureWhiteboard.forward&&(this.$store.dispatch("reloadFeatures",{kind:"whiteboard",forward:!1}),e.$store.commit("isPrivateConv",!1),((e,t,r,i,s,o)=>new Promise((s,a)=>t.forwardSwym(i,e.id_media).then(e=>e?(r.coreview.data.communityId=i,r.coreview.data.mediaId=e.id_media,r.coreview.action="initCoreview",r.model=e,r.fileUrl=e.play.download_original_url.transient_url,r.edit=!0,r.reload=!0,o(r),s(r)):a())))(this.mediaToForward,this.swymDriver,this.featureData,this.$store.getters.dmId,this.isLoaded,function(t){e.createSketch(t);const r={...e.getFeature,featureData:t};e.$store.dispatch("sendFeature",r),e.$store.commit("feature",r)}).then(t=>{t||console.log("ERROR when forwarding"),e.$store.dispatch("removeFeatureData",e.getFeature),t.title}),this.$store.dispatch("reloadFeatures",{kind:"whiteboard",deleteReloadData:!0})),this.reloadFeatureWhiteboard&&this.reloadFeatureWhiteboard.reload&&(this.$store.dispatch("reloadFeatures",{kind:"whiteboard",reload:!1,deleteReloadData:!0}),this.createSketch(this.getFeature.featureData),this.$store.dispatch("removeFeatureData",this.getFeature)),this.featureData.title}},methods:{createSketch(e){this.isLoaded=!0;var t=this.$refs.WhiteboardContainer;t.children[0]&&"function"==typeof t.children[0].destroy&&t.children[0].destroy(),require("DS/TopFrame/TopFrame")._loadModules(["DS/CAT3DSKBootstrap/CAT3DSketchBootstrap"]).then((r=>(function(i){var s=i[0];s?(r.sketchObj=new s,r.sketchObj.create(t,e)):this.isLoaded=!1}))(this))},loadWhiteboard(){this.isLoaded=!0;var e=this.featureData,t=this.$refs.WhiteboardContainer;if(!e||!t)return console.error("loadWhiteboard missing params");this.createSketch(e)},cleanWhiteboard(){this.sketchObj&&"function"==typeof this.sketchObj.destroy&&(this.sketchObj.destroy(),this.sketchObj=null,this.isLoaded=!1)}},template:e}}),define("DS/InstantMessagingCall/store/modules/focus",["DS/RTProxyDriver/RTLogger"],function(e){"use strict";return{state:{isHidden:null,hidden:null,visibilityChange:null},getters:{isHidden:e=>e.isHidden,hidden:e=>e.hidden,visibilityChange:e=>e.visibilityChange},mutations:{resetFocusState(e){Object.assign(e,{isHidden:null,hidden:null,visibilityChange:null})},isHidden:(e,t)=>{e.isHidden=!!t},hidden:(e,t)=>{e.hidden=t},visibilityChange:(e,t)=>{e.visibilityChange=t}},actions:{getFocusNavigatorValues({commit:e,getters:t}){void 0!==document.hidden?(e("hidden","hidden"),e("visibilityChange","visibilitychange")):void 0!==document.msHidden?(e("hidden","msHidden"),e("visibilityChange","msvisibilitychange")):void 0!==document.webkitHidden&&(e("hidden","webkitHidden"),e("visibilityChange","webkitvisibilitychange")),null!==t.hidden&&e("isHidden",document[t.hidden])},listenFocusEvent:({getters:t,commit:r,dispatch:i})=>void 0===document.addEventListener||null===t.hidden||null===t.visibilityChange?e.CallNotif("Browser does not support the Page Visibility API."):document[t.visibilityChange]?e.CallNotif("Focus Listener already started. isHidden: "+t.isHidden):void document.addEventListener(t.visibilityChange,function(s){r("isHidden",document[t.hidden]),e.CallNotif("Focus - Visibility change: isHidden: "+t.isHidden),t.isHidden?(t.accepted_room_id&&(e.CallNotif("Focus - Accepted room: "+t.accepted_room_id),i("notifSW",{action:"callAccepted",data:{room_id:t.accepted_room_id}})),t.invitations&&t.invitations.length>0&&(e.CallNotif("Focus - Invitations room: "+t.invitations.length),t.invitations.map(e=>{i("notifSW",{action:"inviteReceived",data:{room_id:e}})}))):i("closeAllNotifications")}),startFocusListener({dispatch:t,getters:r}){t("getFocusNavigatorValues"),t("listenFocusEvent"),e.CallNotif("Focus Listener started. isHidden: "+r.isHidden)},stopFocusListener({getters:t}){if(void 0!==t.room_id_accepted||t.room_id_invitations&&t.room_id_invitations.length>0)return e.CallNotif("Not stopping focus listeners because some calls are still running.");document.removeEventListener(t.visibilityChange,()=>{e.CallNotif("Focus Listener stopped")})}}}}),define("DS/InstantMessagingCall/components/TelephonyItem/TelephonyItem",["text!DS/InstantMessagingCall/components/TelephonyItem/TelephonyItem.html"],function(e){"use strict";return{props:[],data:()=>({srcObject:null}),methods:{onloadeddata(e){this.play()}},computed:{src(){var e=this.$store.getters.mediaSource;if(!e)return null;try{return window.URL.createObjectURL(e)}catch(e){return console.error("TelephonyItem unable to compute src from stream "+e),null}}},template:e}}),define("DS/InstantMessagingCall/components/CustomType/CustomType",["text!DS/InstantMessagingCall/components/CustomType/CustomType.html"],function(e){"use strict";return{props:["logins","isVideoMinimizeView"],computed:{users(){return this.logins&&0!=this.logins.length?this.logins.length>4?this.logins.slice(0,3):this.logins:[]},notDisplayed(){return this.logins&&0!=this.logins.length?this.logins.length<=4?0:this.logins.length-3:0}},template:e}}),define("DS/InstantMessagingCall/components/SpeakerName/SpeakerName",["text!DS/InstantMessagingCall/components/SpeakerName/SpeakerName.html"],function(e){"use strict";return{props:["user_id"],computed:{username(){return this.$store.getters.user(this.user_id).username}},template:e}}),define("DS/InstantMessagingCall/components/CollabConfetti/CollabConfetti",["text!DS/InstantMessagingCall/components/CollabConfetti/CollabConfetti.html"],function(e){"use strict";return{props:["featureData","masterUser","feature","active"],computed:{masterUsername(){return this.active?this.masterUser&&this.masterUser.username:null},IAmMaster(){return!!this.active&&(this.masterUser&&this.masterUser.login==this.$store.getters.myself.login)}},methods:{genId:function(e,t){return"confetti"+e+"-"+t},sendConfetti:function(e,t){this.IAmMaster&&!this.feature.featureData.confettis[this.genId(e,t)]&&this.$store.dispatch("send_confetti",{spanId:this.genId(e,t),feature:this.feature})}},template:e}}),define("DS/InstantMessagingCall/components/MemberItem/MemberItem",["text!DS/InstantMessagingCall/components/MemberItem/MemberItem.html"],function(e){"use strict";return{props:["user","hasJoined"],computed:{username(){return this.user.username},login(){return this.user.login},isAudioStreamer(){return this.user.stream_info.isAudioStreamer},isVideoStreamer(){return this.user.stream_info.isVideoStreamer},isAudioMuted(){return this.user.stream_info.isAudioStreamerMuted},isVideoMuted(){return this.user.stream_info.isVideoStreamerMuted},isScreenStreamer(){return this.user.stream_info.isScreenStreamer},isOnHold(){return this.user.stream_info.isOnHold},mustBeVisible(){return this.hasJoined?this.user.user_id==this.$store.getters.myself.user_id||this.$store.getters.accepters.indexOf(this.user.user_id)>-1:this.user.user_id!=this.$store.getters.myself.user_id&&!(this.$store.getters.accepters.indexOf(this.user.user_id)>-1)}},template:e}}),define("DS/InstantMessagingCall/store/modules/tracker",["DS/RTProxyDriver/RTLogger","DS/Usage/TrackerAPI","DS/InstantMessagingWebRTC/js/model/RTCallingTracker"],function(e,t,r){"use strict";const i={NotFoundError:"localMediaError_NotFoundError",SecurityError:"localMediaError_SecurityError",AbortError:"localMediaError_AbortError",NotAllowedError:"localMediaError_NotAllowedError",NotReadableError:"localMediaError_NotReadableError",OverConstrainedError:"localMediaError_OverConstrainedError",TypeError:"localMediaError_TypeError",TrackStartError:"localMediaError_NotReadableError",PermissionDeniedError:"localMediaError_NotAllowedError",InvalidStateError:"localMediaError_NotReadableError",DevicesNotFoundError:"localMediaError_NotFoundError",ConstraintNotSatisfiedError:"localMediaError_OverConstrainedError",MediaDeviceFailedDueToShutdown:"localMediaError_NotReadableError",MediaDeviceKillSwitchOn:"localMediaError_NotReadableError",InternalError:"localMediaError_NotReadableError",NotSupportedError:"localMediaError_TypeError"};return{state:{callTracker:null,date_start:0},getters:{callTracker:e=>e.callTracker},mutations:{newTracker(e,{logins:t,caller:i,swymUrl:s,type:o,dmId:a}){e.callTracker&&e.callTracker.destroy(),e.callTracker=new r({caller:i,logins:t,swymBaseUrl:s,type:o,dmId:a})},destroyTracker(e){e.callTracker&&e.callTracker.destroy(),e.callTracker=null}},actions:{offlineStartCallTracking({dispatch:e,getters:t},{logins:r,login:i,dmId:s}){e("startTracking",{logins:r||i,dmId:s}),e("tracking",{action:"ended",login:t.myself.login,reason:"offline"}),e("stopTracking",{dontSendSwymReport:!0})},startTracking({commit:e,getters:t},{logins:r,type:i,dmId:s}){if(!r&&!t.accepted_room)return console.error("Can not start Call Analytics without callees");e("newTracker",{caller:t.myself.login,logins:r||t.accepted_room.calledUsers,swymUrl:t.swymUrl,type:i,dmId:s})},stopTracking({getters:e,commit:t},{dontSendSwymReport:r}){e.callTracker&&e.callTracker.endCall(r),t("destroyTracker")},tracking({getters:t},{action:r,login:s,user_id:o,reason:a,kind:n}){if(!t.callTracker)return!0;if(!s&&o)s=t.user(o).login;switch(r){case"ended":t.callTracker.logEnded(s,a);break;case"getLocalMediaFailed":t.callTracker.logEnded(s,i[a]||a);break;case"stream":t.callTracker.logStream(s);break;case"inviteSent":t.callTracker.logInviteSent();break;case"accepted":t.callTracker.logAccepted(s);break;default:e.error("unknown tracking action "+r)}},track_event({getters:r},{action:i,eventValue:s,dimensions:o,values:a}){if(!i)return e.Call("track_event called without action");if(r.isDevEnv)return e.Call("track_event "+i+" bypassed");const n=r.myself.user_id,l=r.accepted_room&&r.accepted_room.room_id||[],d=r.accepted_room&&r.accepted_room.calledUsers||[],c=r.accepters||[],u=r.refusers||[],m=r.sip?"telephony":"webRTC";var p={appID:"X3DIMSG_AP",eventCategory:"collabexperience",eventAction:i,eventLabel:"3DMessaging collab event "+i,eventValue:"number"==typeof s?s:null,persDim:{pd1:n,pd2:l},persVal:{pv1:d.length,pv2:c.length,pv3:u.length},callback:t=>{e.Call("Analytics event sent. "+(t||""))}};if(o){var h=Object.keys(p.persDim).length;const e="string"==typeof o?[o]:o;for(let t of e)"string"==typeof t&&(7===h&&++h,p.persDim["pd"+ ++h]=t.toLowerCase())}if(p.persDim.pd8=m,a){var f=Object.keys(p.persVal).length;const e="number"==typeof a?[a]:a;for(let t of e)"number"==typeof t&&(p.persVal["pv"+ ++f]=t)}try{e.Call("Analytics event : "+JSON.stringify(p)),t.trackPageEvent(p)}catch(t){e.error("Analytics event request failed : "+t)}}}}}),define("DS/InstantMessagingCall/store/modules/messages",["i18n!DS/InstantMessagingCall/assets/nls/feed"],function(e){"use strict";const t=e;return{state:(()=>({NLS:t,connexionLost:!1,bodyAlerts:{connexionLost:{text:t.startCallAbortedBecauseOffline,type:"warning",timeout:3e3,visible:!1},connexionRetrieved:{text:t.connexionRetrieved,type:"success",timeout:3e3,visible:!1},reconnectOngoing:{text:t.reconnectOngoing,type:"warning",timeout:3e3,visible:!1},connexionNetworkLost:{text:t.connexionNetworkLost,type:"error",timeout:0,visible:!1},callUnavailablePlurial:{text:t.callUnavailablePlurial,type:"warning",timeout:3e3,visible:!1},callUnavailableSingular:{text:t.callUnavailableSingular,type:"warning",timeout:3e3,visible:!1},publishDocument:{text:t.publishDocument,type:"success",timeout:3e3,visible:!1},publishDocumentError:{text:t.publishDocumentError,type:"error",timeout:3e3,visible:!1},audiomuted:{text:t.audiomuted,type:"warning",timeout:3e3,visible:!1},mediaDeviceNotFound:{text:t.localMediaError_NotFoundError,type:"warning",timeout:3e3,visible:!1},mediaDeviceAccessDisabled:{text:t.localMediaError_SecurityError,type:"warning",timeout:3e3,visible:!1},mediaDeviceAccessAborted:{text:t.localMediaError_AbortError,type:"warning",timeout:3e3,visible:!1},mediaAccessNotAllowed:{text:t.localMediaError_NotAllowedError,type:"warning",timeout:3e3,visible:!1},mediaDeviceAccessFailed:{text:t.localMediaError_OverConstrainedError,type:"warning",timeout:3e3,visible:!1},mediaDeviceNotSupported:{text:t.localMediaError_NotReadableError,type:"warning",timeout:3e3,visible:!1},browserNotCompatible:{text:t.localMediaError_TypeError,type:"warning",timeout:3e3,visible:!1},callOnHold:{text:t.alert_callOnHold,type:"primary",visible:!1,closable:!1},alreadyOnCall:{text:t.alreadyOnCall,type:"warning",timeout:3e3,visible:!1},emptyInvitedUsers:{text:t.emptyInvitedUsers_error,type:"error",timeout:0,visible:!1},emptyTopic:{text:t.emptyTopic_error,type:"error",timeout:0,visible:!1},ODEEditionNotSupported:{text:t.ODEEditionNotSupported,type:"warning",timeout:0,visible:!1}}}))(),getters:{nls:e=>t=>e.NLS[t],bodyAlerts:e=>e.bodyAlerts},mutations:{bodyAlertVisible:(e,{key:t,visible:r})=>{e.bodyAlerts[t]?e.bodyAlerts[t].visible=r:console.error("bodyAlert not found "+t)},connexionLost:(e,t)=>{e.connexionLost=t},bodyAlertText:(e,{key:t,text:r})=>{e.bodyAlerts[t]?e.bodyAlerts[t].text=r:console.error("bodyAlert not found "+t)}},actions:{hide_bodyAlert({commit:e},t){e("bodyAlertVisible",{key:t,visible:!1})},show_bodyAlert({commit:e},t){e("bodyAlertVisible",{key:t,visible:!0})},alert_connexionLost({dispatch:e,commit:t}){t("connexionLost",!0),e("hide_bodyAlert","connexionRetrieved"),e("show_bodyAlert","connexionLost")},alert_connexionRetrieved({state:e,dispatch:t,commit:r}){e.connexionLost&&(t("hide_bodyAlert","connexionLost"),t("hide_bodyAlert","connexionNetworkLost"),t("show_bodyAlert","connexionRetrieved"),r("connexionLost",!1))},alert_reconnectOngoing({dispatch:e}){e("hide_bodyAlert","connexionLost"),e("hide_bodyAlert","connexionRetrieved"),e("hide_bodyAlert","connexionNetworkLost"),e("show_bodyAlert","reconnectOngoing")},alert_connexionNetworkLost({dispatch:e}){e("hide_bodyAlert","connexionLost"),e("hide_bodyAlert","connexionRetrieved"),e("hide_bodyAlert","reconnectOngoing"),e("show_bodyAlert","connexionNetworkLost")},alert_uncallableUsers({getters:e,dispatch:t,commit:r},{uncallableUsers:i,calledUsers:s}){var o=i.length,a=o>1?"callUnavailablePlurial":"callUnavailableSingular";r("bodyAlertText",{text:e.nls(a).replace("{0}",o).replace("{1}",s.length+o),key:a}),t("show_bodyAlert",a)},alert_publishDocument({dispatch:e}){e("show_bodyAlert","publishDocument")},alert_publishDocumentError({dispatch:e}){e("show_bodyAlert","publishDocumentError")},alert_audiomuted({dispatch:e}){e("show_bodyAlert","audiomuted")},alert_browserNotCompatible({dispatch:e}){e("show_bodyAlert","browserNotCompatible")},alert_getLocalMediaError({dispatch:e},t){switch(t.name){case"NotFoundError":case"DevicesNotFoundError":e("show_bodyAlert","mediaDeviceNotFound");break;case"SecurityError":e("show_bodyAlert","mediaDeviceAccessDisabled");break;case"AbortError":e("show_bodyAlert","mediaDeviceAccessAborted");break;case"NotAllowedError":case"PermissionDeniedError":e("show_bodyAlert","mediaAccessNotAllowed");break;case"NotReadableError":case"TrackStartError":case"InvalidStateError":case"MediaDeviceFailedDueToShutdown":case"MediaDeviceKillSwitchOn":case"InternalError":e("show_bodyAlert","mediaDeviceAccessFailed");break;case"OverConstrainedError":case"ConstraintNotSatisfiedError":e("show_bodyAlert","mediaDeviceNotSupported");break;case"TypeError":case"NotSupportedError":e("show_bodyAlert","browserNotCompatible");break;default:console.error(t)}},alert_callOnHold({dispatch:e}){e("show_bodyAlert","callOnHold")},alert_callResumed({dispatch:e}){e("hide_bodyAlert","callOnHold")},alert_alreadyOnCall({dispatch:e}){e("show_bodyAlert","alreadyOnCall")},alert_ODEEditionNotSupported({dispatch:e}){e("show_bodyAlert","ODEEditionNotSupported")},alert_addUser({dispatch:e,getters:t},r){switch(r){case"emptyTopic":e("show_bodyAlert","emptyTopic");break;case"emptyUsers":e("show_bodyAlert","emptyInvitedUsers");break;default:console.error(error)}}}}}),define("DS/InstantMessagingCall/components/ActionBarItem/ActionBarItem",["text!DS/InstantMessagingCall/components/ActionBarItem/ActionBarItem.html"],function(e){"use strict";return{props:["label","rightTooltip"],template:e}}),define("DS/InstantMessagingCall/store/modules/noises",["DS/RTProxyDriver/RTLogger","DS/InstantMessagingWebRTC/js/model/NoiseMaker"],function(e,t){"use strict";return{state:(()=>({noiseMaker:t,holdToneDisplayed:!1}))(),getters:{holdtoneURL:(e,t)=>t.assets_url+"holdtone.mp3"},mutations:{noiseURL(e,{noisename:t,url:r}){e.noiseMaker.set(t,r)},startRingtone(e){e.noiseMaker.start("ringtone",3e4)},startRingbacktone(e){e.noiseMaker.start("ringbacktone",3e4)},stopTones(e){e.noiseMaker.stop("ringtone"),e.noiseMaker.stop("ringbacktone"),e.noiseMaker.stop("holdtone")},userIn(e){e.noiseMaker.start("userin")},userOut(e){e.noiseMaker.start("userout")},startHoldtone(e){e.noiseMaker.start("holdtone",!0)},stopHoldtone(e){e.noiseMaker.stop("holdtone")}},actions:{noises({commit:t},{action:r}){switch(r){case"userIn":t("userIn");break;case"userOut":t("userOut");break;case"startRingtone":t("startRingtone");break;case"startRingbacktone":t("startRingbacktone");break;case"stopTones":t("stopTones");break;case"startHoldtone":t("startHoldtone");break;case"stopHoldtone":t("stopHoldtone");break;default:e.error("unknown noises action "+r)}},preloadNoises({state:e,commit:t,getters:r}){const i=r.assets_url;t("noiseURL",{noisename:"ringtone",url:i+"ringtone.mp3"}),t("noiseURL",{noisename:"ringbacktone",url:i+"ringbacktone.wav"}),t("noiseURL",{noisename:"userin",url:i+"userin.mp3"}),t("noiseURL",{noisename:"userout",url:i+"userout.mp3"}),t("noiseURL",{noisename:"holdtone",url:r.holdtoneURL}),e.noiseMaker.preload()}}}}),define("DS/InstantMessagingCall/components/Collab3DPlay/Collab3DPlay",["DS/3DPlayHelper/3DPlayHelper","UWA/Data","text!DS/InstantMessagingCall/components/Collab3DPlay/Collab3DPlay.html"],function(e,t,r){"use strict";var i;return{props:["featureData","featureId","masterUser","active","feature","swymDriver"],computed:{title(){if(!this.active)return null;var t=this.featureData;return t?(i&&i.isReady&&i.isReady()?console.log("Collab 3DPLay player already running"):((t,r,s,o)=>{if(!t||!r)return console.error("load3DPlay missing params");if(!t.mime)return console.error("load3DPlay missing mime");if(!t.fileName)return console.error("load3DPlay missing fileName");if(!t.path)return console.error("load3DPlay missing path");r.children[0]&&"function"==typeof r.children[0].destroy&&r.children[0].destroy();const a={collabmode:!0,container:r,input:{asset:{filename:t.path,provider:"FILE",format:t.mime,type:t.mime}},options:{loading:"autoplay",callbacks:{experience:{ExperienceReady:()=>{s&&(i.setCollabMode(!0),"function"==typeof o&&i.addCollabCB((e,t)=>{o({arg1:e,arg2:t})}))}},asset:{LoadingFinished:()=>{console.log("Collab 3DPlay LoadingFinished")}}}}};a.input.asset.originalAsset=JSON.parse(JSON.stringify(a.input.asset)),i&&"function"==typeof i.dispose&&i.dispose(),i=new e(a)})(t,this.$refs.TroisDPlayContainer,this.IAmMaster,this.collabCallback),t.title):null},IAmMaster(){return this.masterUser&&this.masterUser.login==this.$store.getters.myself.login},masterLogin(){if(!this.active||!this.masterUser)return null;var e=this.masterUser.login;return console.log("Collab 3DPLay master changed "+e),e},actions(){if(this.IAmMaster||!this.active||!this.feature||!this.feature.featureData)return null;var e=this.feature.featureData.actions;return e&&this.onCoreviewAction(e),e},reload:()=>null},methods:{collabCallback({arg1:e,arg2:t}){this.$store.dispatch("send_3DPlay_data",{room_id:this.feature.room_id,featureId:this.featureId,featureData:this.featureData,actions:{arg1:e,arg2:t}})},onCoreviewAction({arg1:e,arg2:t}){if(i&&"function"==typeof i.isReady&&i.isReady()&&"function"==typeof i.performAction)try{i.performAction(e,t)}catch(e){console.error(e)}}},template:r}}),define("DS/InstantMessagingCall/store/modules/telephony",["DS/RTProxyDriver/RTLogger","DS/DSNodeSocketioClient_4.7.4/DSNodeSocketioClient_4.7.4"],function(e,t){"use strict";window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;return{state:{mediaSource:null,telwebsocket:null,mediaRecorder:null,holdRecorder:null,sourceBuffer:null,streamTel:null,streamHold:null,streaming:!1,callOnHold:!1,audioBitsPerSecond:null,holdFramesCount:0},mutations:{resetTelephonyState(e){Object.assign(e,{mediaSource:null,telwebsocket:null,mediaRecorder:null,holdRecorder:null,sourceBuffer:null,streamTel:null,streamHold:null,streaming:!1,callOnHold:!1,audioBitsPerSecond:null,holdFramesCount:0})},telwebsocket:(e,t)=>{e.telwebsocket=t},mediaRecorder:(e,t)=>{e.mediaRecorder=t},holdRecorder:(e,t)=>{e.holdRecorder=t},mediaSource:(e,t)=>{e.mediaSource=t},streamTel:(e,t)=>{e.streamTel=t},streamHold:(e,t)=>{e.streamHold=t},sourceBuffer:(e,t)=>{e.sourceBuffer=t},streaming:(e,t)=>{e.streaming=!!t},callOnHold:(e,t)=>{e.callOnHold=!!t},audioBitsPerSecond:(e,t)=>{e.audioBitsPerSecond=t},holdFramesCount:(e,t)=>{t?e.holdFramesCount=0:e.holdFramesCount++}},getters:{mediasource:e=>e.mediaSource,mediaSource:e=>e.mediaSource,mediaRecorder:e=>e.mediaRecorder,holdRecorder:e=>e.holdRecorder,sourceBuffer:e=>e.sourceBuffer,streamTel:e=>e.streamTel,streamHold:e=>e.streamHold,telwebsocket:e=>e.telwebsocket,streaming:e=>e.streaming,callOnHold:e=>e.callOnHold,audioBitsPerSecond:e=>e.audioBitsPerSecond,holdFramesCount:e=>e.holdFramesCount},actions:{recordHoldStream({getters:t,dispatch:r},{audioBitsPerSecond:i}){e.Call("Telephony recordHoldStream");const s=new Audio(t.holdtoneURL);s.loop=!0;const o=new window.AudioContext,a=o.createMediaElementSource(s),n=o.createMediaStreamDestination();a.connect(n),s.play(),r("onHoldMediaStream",{stream:n.stream,audioBitsPerSecond:i})},onHoldMediaStream:({commit:t,getters:r,dispatch:i},{stream:s,audioBitsPerSecond:o})=>(e.Call("Telephony onHoldMediaStream"),s?(t("streamHold",s),o&&t("audioBitsPerSecond",o),t("holdRecorder",new MediaRecorder(r.streamHold,{audioBitsPerSecond:r.audioBitsPerSecond||24e3})),r.holdRecorder?(r.holdRecorder.ondataavailable=(e=>{r.holdFramesCount>1?i("sendHoldStreamWebTel",e.data):t("holdFramesCount",!1)}),r.holdRecorder.onpause=(()=>e.Call("Telephony holdRecorder onpause.")),void i("resumeHoldTrack")):console.error("Telephony failed to create holdRecorder")):e.Call("Telephony onHoldMediaStream no stream")),sendHoldStreamWebTel({getters:e},t){e.telwebsocket&&e.telwebsocket.emit("web-hold-stream",t)||console.error("cant sendHoldStreamWebTel : missing telwebsocket")},muteHoldTrack({getters:t}){if(e.Call("Telephony muteHoldTrack"),t.callOnHold||!t.holdRecorder||"inactive"===t.holdRecorder.state)return Promise.reject("muteHoldTrack failed: no holdRecorder active or call on hold.");try{return t.holdRecorder.pause()}catch(e){return Promise.reject("muteHoldTrack failed "+e)}},resumeHoldTrack({getters:t,dispatch:r}){if(e.Call("Telephony resumeHoldTrack"),!t.callOnHold)return Promise.reject("resumeHoldTrack failed: call is not on hold.");if(t.holdRecorder||r("recordHoldStream",{}),"inactive"===t.holdRecorder.state)return t.holdRecorder.start(20);try{return t.holdRecorder.resume()}catch(e){return Promise.reject("resumeHoldTrack failed "+e)}},stopHoldTrack({getters:t,commit:r}){if(e.Call("Telephony stopHoldTrack"),r("holdFramesCount",!0),!t.holdRecorder)return!0;if(t.holdRecorder.ondataavailable=null,t.holdRecorder.onpause=null,"inactive"===t.holdRecorder.state)return!0;try{return t.holdRecorder.stop()}catch(t){e.Call("Telephony stopHoldTrack failed "+t)}},stopHoldStream({getters:t}){e.Call("Telephony stopHoldStream");try{return t.streamHold.getTracks().forEach(e=>e&&e.stop&&e.stop())}catch(t){e.Call("Telephony stopHoldStream failed "+t)}},recordStream:({dispatch:t},{audioBitsPerSecond:r})=>(e.Call("Telephony recordStream"),t("getUserMedia",{audio:!0}).then(e=>t("onMediaDeviceStream",{stream:e,audioBitsPerSecond:r})).catch(function(t){e.Call("Fail to record, error in getUserMedia "+t)})),onMediaDeviceStream:({commit:t,getters:r,dispatch:i},{stream:s,audioBitsPerSecond:o})=>(e.Call("Telephony onMediaDeviceStream"),s?(t("streamTel",s),o&&t("audioBitsPerSecond",o),t("mediaRecorder",new MediaRecorder(r.streamTel,{audioBitsPerSecond:r.audioBitsPerSecond||24e3})),r.mediaRecorder?(r.mediaRecorder.ondataavailable=(e=>i("sendStreamWebTel",e.data)),r.mediaRecorder.onpause=(()=>e.Call("Telephony mediaRecorder onpause.")),void i("resumeTelTrack")):console.error("Telephony failed to create MediaRecorder")):e.Call("Telephony onMediaDeviceStream no stream")),sendStreamWebTel({getters:e},t){e.telwebsocket&&e.telwebsocket.emit("web-stream",t)||console.error("cant sendStreamWebTel : missing telwebsocket")},resumeTelTrack({getters:t,dispatch:r}){if(e.Call("Telephony resumeTelTrack"),!t.streaming||t.callOnHold)return Promise.reject("resumeTelTrack failed: call on hold or not streaming.");if(t.mediaRecorder||r("recordStream",{}),"inactive"===t.mediaRecorder.state)return t.mediaRecorder.start(20);try{return t.mediaRecorder.resume()}catch(e){return Promise.reject("resumeTelTrack failed "+e)}},muteTelTrack({getters:t}){if(e.Call("Telephony muteTelTrack"),!t.mediaRecorder||"inactive"===t.mediaRecorder.state)return Promise.reject("muteTelTrack failed: No active mediaRecorder.");try{return t.mediaRecorder.pause()}catch(e){return Promise.reject("muteTelTrack failed "+e)}},stopTelTrack({getters:t}){if(e.Call("Telephony stopTelTrack"),!t.mediaRecorder)return!0;if(t.mediaRecorder.ondataavailable=null,t.mediaRecorder.onpause=null,"inactive"==t.mediaRecorder.state)return!0;try{return t.mediaRecorder.stop()}catch(t){e.Call("Telephony stopTelTrack failed "+t)}},stopTelStream({getters:t}){e.Call("Telephony stopTelStream");try{return t.streamTel.getTracks().forEach(e=>e&&e.stop&&e.stop())}catch(t){e.Call("Telephony stopTelStream failed "+t)}},activeStreamWebTel({dispatch:t,commit:r},{onHold:i}){e.Call("Telephony activeStreamWebTel- onHold: "+i),r("callOnHold",i),t("muteHoldTrack").catch(t=>e.Call("Telephony activeStreamWebTel "+t)).then(()=>t("resumeTelTrack")).catch(t=>e.Call("Telephony activeStreamWebTel "+t))},muteStreamWebTel({dispatch:t,commit:r},{onHold:i}){e.Call("Telephony muteStreamTelWeb - onHold: "+i),r("callOnHold",i),t("muteTelTrack").catch(t=>e.Call("Telephony muteStreamTelWeb "+t)).then(()=>t("resumeHoldTrack")).catch(t=>e.Call("Telephony muteStreamTelWeb "+t))},initMediaSource({commit:t,getters:r,dispatch:i}){if(e.Call("Telephony initMediaSource"),t("mediaSource",new MediaSource),!r.mediaSource)return console.error("Telephony failed to create MediaSource");r.mediaSource.addEventListener("sourceopen",t=>{e.Call("Telephony initMediaSource sourceopen"),i("onMediaSourceOpen",t)})},onMediaSourceOpen({getters:t,commit:r,dispatch:i}){if(e.Call("Telephony onMediaSourceOpen"),!t.mediaSource)return console.error("Telephony onMediaSourceOpen no mediaSource");r("sourceBuffer",t.mediaSource.addSourceBuffer("audio/mpeg")),i("received_track_audio",{user_id:t.accepters[0]},{root:!0})},stopSourceBuffer({getters:t}){e.Call("Telephony stopSourceBuffer");try{return t.sourceBuffer&&t.sourceBuffer.abort()}catch(t){e.Call("Telephony stopSourceBuffer failed "+t)}},stopMediaSource({getters:t}){if(e.Call("Telephony stopMediaSource"),!t.mediaSource)return!0;try{if(t.mediaSource.onsourceopen=null,"open"!=t.mediaSource.readyState)return!0;t.mediaSource.endOfStream(),t.mediaSource.removeSourceBuffer(t.sourceBuffer)}catch(t){e.Call("Telephony stopMediaSource failed "+t)}},disconnectTelWS({getters:t}){e.Call("Telephony disconnectTelWS");try{return!(t.telwebsocket&&!t.telwebsocket.disconnected)||t.telwebsocket.io.disconnect()}catch(t){e.Call("Telephony disconnectTelWS failed "+t)}},connectTelWS:({commit:r,dispatch:i,getters:s},{connectionParams:o,call_id:a,url:n,cookie:l})=>o?n?a?(l||e.Call("WARNING - TelWS will be randomly chosen without cookie"),s.telwebsocket?e.Call("TelWS already exists "+(s.telwebsocket.call_id&&s.telwebsocket.call_id==a)&&"for same call"):(e.Call("connectTelWS "+n+" for call "+a),cookieStore.set({name:"TELSERVERID",value:l,path:"/",domain:"3ds.com"}),r("telwebsocket",t.connect(n,Object.assign({},o,{reconnection:!1,path:o&&o.socketioPath||"/socketio.tel"}))),s.telwebsocket?(s.telwebsocket.call_id=a,s.telwebsocket.cookie=l,s.telwebsocket.on("connect",e=>{i("onConnect",e)}),s.telwebsocket.on("connection_ok",e=>{i("onConnectionOK",e)}),s.telwebsocket.on("start-streaming",e=>{i("onStartStream",e)}),s.telwebsocket.on("stop-streaming",e=>{i("onStopStream",e)}),s.telwebsocket.on("pstn-stream",e=>{i("onPstnStream",e)}),void s.telwebsocket.on("disconnect",e=>{i("onDisconnect",e)})):e.Call("connectTelWS failed"))):e.Call("cant connectTelWS without call_id"):e.Call("cant connectTelWS without url"):e.Call("cant connectTelWS without params"),onDisconnect({dispatch:t},r){e.Call("Telephony close-ws "+r&&r.call_id),t("cleanTelephony")},onPstnStream({getters:t},r){try{if(!t.sourceBuffer)throw"no sourceBuffer.";if(!t.mediaSource||"open"!=t.mediaSource.readyState)throw"mediaSource not ready";if(t.sourceBuffer.updating)return e.Call("Telephony onPstnStream sourceBuffer is already processing another chunk");t.sourceBuffer.appendBuffer(r)}catch(t){e.Call("Telephony onPstnStream Error : "+t)}},onStartStream({dispatch:t,getters:r,commit:i},s){e.Call("Telephony start-streaming."),i("streaming",!0),r.mediaRecorder&&"inactive"!==r.mediaRecorder.state||t("recordStream",s)},onStopStream({dispatch:t,commit:r},i){e.Call("Telephony stop-streaming"),r("streaming",!1),t("muteTelTrack"),t("muteHoldTrack")},onConnectionOK({getters:t,dispatch:r},i){e.Call("Telephony connection_ok"),r("initMediaSource"),t.telwebsocket.emit("init_call",{call_id:t.telwebsocket.call_id,cookie:t.telwebsocket.cookie,allCookie:document.cookie})},onConnect({},t){e.Call("Telephony connected")},cleanTelephony({getters:t,commit:r,dispatch:i},s){i("stopTelTrack").then(()=>i("stopTelStream")).then(()=>i("stopHoldTrack")).then(()=>i("stopHoldStream")).then(()=>i("disconnectTelWS")).then(()=>i("stopMediaSource")).then(()=>i("stopSourceBuffer")).then(()=>r("resetTelephonyState")).catch(t=>{e.Call("Telephony cleanTelephony failed "+t),r("resetTelephonyState")})}}}}),define("DS/InstantMessagingCall/store/modules/usergroup",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData","DS/RTProxyDriver/RTLogger","DS/RTConvAPI/drivers/RTC_driver"],function(e,t,r,i,s){"use strict";return{state:Object.assign({odeFeature:!0,whiteboardFeature:!0,telephonyFeature:!1,troisdplayFeature:!1,addUserFeature:!0},{}),getters:{odeFeature:e=>e.odeFeature,whiteboardFeature:e=>e.whiteboardFeature,telephonyFeature:e=>e.telephonyFeature,troisdplayFeature:e=>e.troisdplayFeature,addUserFeature:e=>e.addUserFeature},mutations:{changeOdeFeature(e,t){e.odeFeature=t},changeWhiteboardFeature(e,t){e.whiteboardFeature=t},changeTelephonyFeature(e,t){e.telephonyFeature=t},change3DPlayFeature(e,t){e.troisdplayFeature=t},changeaddUserFeature(e,t){e.addUserFeature=t}},actions:{getCollaborationFeatures({dispatch:e,getters:t,commit:r}){e("getCollaborationFeature",{feature:"whiteboard",mutationMethod:"changeWhiteboardFeature",uwp:"app.swymfeature.activateWBCollab"}),e("getCollaborationFeature",{feature:"telephony",mutationMethod:"changeTelephonyFeature",uwp:"app.swymfeature.activatePhoneCall"}),e("getCollaborationFeature",{feature:"3dplay",mutationMethod:"change3DPlayFeature",uwp:"app.swymfeature.activate3DPlay"}),e("getCollaborationFeature",{feature:"ode",mutationMethod:"changeOdeFeature",uwp:"app.swymfeature.activateODECollab"}).then(()=>{t.odeFeature&&require("DS/TopFrame/TopFrame")._loadModules(["DS/OfficeDocumentEditorClient/Editor"]).then(function(e){var s=e[0];s&&"function"==typeof s.isGranted&&s.isGranted({platformId:t.tenant}).then(()=>{i.Call("Editor activated and granted")}).catch(e=>{i.Call("Editor activated but not granted "+e),r("changeOdeFeature",!1)})})}),e("getCollaborationFeature",{feature:"addUser",mutationMethod:"changeaddUserFeature",uwp:"app.swymfeature.activateAddUser"}).then(()=>{const e=s.getInstance(t.tenant);t.addUserFeature&&e&&e.checkCallAddUserActivation().then(e=>{r("changeaddUserFeature",e)})})},getCollaborationFeature({getters:e,dispatch:r,commit:s},{feature:o,mutationMethod:a,uwp:n}){if(UWA&&UWA.Utils&&UWA.Utils.getQueryString(document.URL,"activateCollab")||location&&location.href&&location.href.contains("activateCollab"))return s(a,!0);if("3dprint"==e.appName)return s(a,!1);const l=t.getApplicationConfiguration(n);return""===l||"true"===l||!0===l?s(a,!0):"false"===l?s(a,!1):void 0!==l?r("isUserInUserGroup",l).then(()=>{i.Call("Usergroup activation of feature "+o),s(a,!0)}).catch(e=>{i.Call("Usergroup deactivation of feature "+o+" : "+e),s(a,!1)}):void 0},isUserInUserGroup({getters:t},s){const o=t.tenant.toUpperCase(),a=t.myself.username;return new Promise((t,n)=>{e.getServiceUrl({serviceName:"3DSearch",platformId:o,onComplete:function(e){if(!e)return i.Call("Can't check usergroup without searchUrl"),n();r.authenticatedRequest(e+"/search",{method:"POST",type:"json",headers:{"Content-Type":"application/json"},data:JSON.stringify({with_synthesis_hierarchical:!1,with_synthesis:!1,with_synthesis_attribute:!1,source:["usersgroup"],query:'[ds6w:label]:"'+s+'"',select_predicate:["ds6w:hasMember","ds6w:responsible"],label:"bot",tenant:o}),onComplete:function(e){var r=[];return e&&e.results?(e.results.forEach(function(e){r=r.concat(e.attributes)}),r.filter(function(e){return"ds6w:hasMember"===e.name&&e.value===a||"ds6w:responsible"===e.name&&e.value===a}).length>0?t():n("not in usergroup")):n()},onFailure:function(t){return i.Call("AuthenticatedRequest on "+e+"/search failed : "+t),n("request to "+e+" failed")}})},onFailure:function(){return n("request to i3DXCompassPlatformServices failed")}})})}}}}),define("DS/InstantMessagingCall/components/VideoItem/VideoItem",["text!DS/InstantMessagingCall/components/VideoItem/VideoItem.html"],function(e){"use strict";return{props:["stream","user_id","isSpeakerView","isAudioMuted","isVideoMuted","track_id","muted","isSelfView"],data:()=>({srcObject:null}),computed:{video_track_id(){var e=this.stream&&this.stream.getVideoTracks();if(e&&e.length)return this.stream.getVideoTracks()[0].id},src(){try{try{return window.URL.createObjectURL(this.stream)}catch(e){return this.srcObject=this.stream,null}}catch(e){return console.error("VideoItem unable to compute src from stream "+e),null}}},methods:{toggleSpeaker(){if(!this.$store.getters.clickOnVideo)return!0;this.isSpeakerView?this.$store.dispatch("removeSpeaker",{user_id:this.user_id}):this.$store.dispatch("setAsSpeaker",{user_id:this.user_id,track_id:this.video_track_id})}},template:e}}),require.config({paths:{vuejs:window.dsDefaultWebappsBaseUrl+"/vuejs/2.6.10/vue.min",vuex:window.dsDefaultWebappsBaseUrl+"/vuex/3.1.1/vuex.min","vu-kit":window.dsDefaultWebappsBaseUrl+"/vuekit/vu-kit.umd.min"}}),define("DS/InstantMessagingCall/InstantMessagingCall",["vuejs","vu-kit","vuex","DS/RTVueUserPresenceAPI/RTVueUserPresenceAPI","DS/RTDialer/RTDialer","css!vuekit/vu-kit"],function(e,t,r,i,s){"use strict";return e.use(t),e.use(r),{init(e){require(["DS/InstantMessagingCall/main"],function(t){t.init(e)})}}}),define("DS/InstantMessagingCall/components/UserItem/UserItem",["text!DS/InstantMessagingCall/components/UserItem/UserItem.html","DS/InstantMessagingCall/components/VideoItem/VideoItem","DS/InstantMessagingCall/components/TelephonyItem/TelephonyItem"],function(e,t,r){"use strict";return{components:{"im-call-video-item":t,"im-tel-video-item":r},props:["user_id","track_id","isSpeakerView","room","minimized"],data:()=>({streams:[],isScreen:!1,isAudio:!1}),computed:{isSip(){return this.$store.getters.sip},asMediasource(){return!!this.$store.getters.mediasource},user(){return this.$store.getters.user(this.user_id)},isSpeaker(){return this.$store.getters.speaker_id==this.user_id},isNotLarge(){return this.$store.getters.isAvatarNotLarge},isVideo(){var e=this.user.stream_info.isVideoStreamer,t=this.user.stream_info.isAudioStreamer,r=this.user.stream_info.isScreenStreamer,i=(e||t||r)&&this.$store.getters.streams(this.user_id,this.track_id);if(e&&r&&!this.track_id&&this.isSpeaker){var s=(o=i[0]).getVideoTracks();if(s&&s.length&&1!=s.length){var o=new MediaStream,a=i[0].getAudioTracks(),n=a&&a[0];n&&o.addTrack(n);for(let e of s)if("text"!==e.contentHint){o.addTrack(e);break}i=[o]}else i=[o]}else(e||r)&&this.track_id&&this.room&&(i[0].oninactive=(()=>{this.$store.dispatch("stopTrack",{kind:"screen",room_id:this.room.room_id})}));return this.streams=i,this.isScreen=r,this.isAudio=t,e},isVideoMuted(){return this.user.stream_info.isVideoStreamerMuted},isAudioMuted(){return this.user.stream_info.isAudioStreamerMuted},isOnHold(){return this.user.stream_info.isOnHold},hasCollabExperience(){return this.$store.getters.hasFeature},showVideo(){return(this.isVideo&&!this.isVideoMuted||this.isScreen)&&(!!this.track_id||!this.track_id&&(!this.isSpeaker||this.isSpeaker&&this.isScreen&&this.isVideo&&!this.isVideoMuted))}},methods:{unlargeAvatar(){var e=this.$refs.userItemContainer,t=e&&e.offsetHeight<240;this.$store.commit("avatarNotLarge",t)}},updated(){this.unlargeAvatar()},created(){window.addEventListener("resize",this.unlargeAvatar)},destroyed(){window.removeEventListener("resize",this.unlargeAvatar)},template:e}}),define("DS/InstantMessagingCall/components/SelfView/SelfView",["text!DS/InstantMessagingCall/components/SelfView/SelfView.html","DS/InstantMessagingCall/components/VideoItem/VideoItem"],function(e,t){"use strict";return{props:["showSelfView","isInUserList"],components:{"im-call-video-item":t},data:()=>({streams:null,isSpeaker:!1}),computed:{isVideo(){var e=this.$store.getters.local_stream_info("video"),t=e&&"muted"!=e;if(this.streams)return t;var r=this.$store.getters.isLocalSpeaker,i=(t||r!=this.isSpeaker)&&this.$store.getters.local_track_of_kind("video");if(i){var s=new MediaStream;s.addTrack(i),this.streams=[s]}return this.isSpeaker=r,t},isLocalVideoMuted(){return"muted"==this.$store.getters.local_stream_info("video")},isLocalAudioMuted(){return"muted"==this.$store.getters.local_stream_info("audio")},user_id(){return this.$store.getters.myself.user_id},username(){return this.$store.getters.myself.username}},methods:{minimize(){this.$store.commit("hideSelfView")}},destroyed(){this.streams=null},deactivated(){this.streams=null},mounted(){var e=this,t=document.getElementById("im-call-lightbox");new MutationObserver(function(){if("none"==t.style.display&&!e.$store.getters.isAccepted){if(!e.streams)return;for(let t=0;t<e.streams.length;t++)e.streams[t].getTracks().forEach(e=>e.stop());e.streams=null}}).observe(t,{attributes:!0,childList:!0})},template:e}}),define("DS/InstantMessagingCall/components/VideoMinimize/VideoMinimize",["text!DS/InstantMessagingCall/components/VideoMinimize/VideoMinimize.html","DS/InstantMessagingCall/components/CustomType/CustomType"],function(e,t){"use strict";return{props:["logins"],components:{"im-call-custom-type":t},template:e}}),define("DS/InstantMessagingCall/store/modules/feature",["DS/RTProxyDriver/RTLogger","DS/InstantMessagingCall/api/senders","DS/SwymUICore/script/feature/community/media/model/media-model","vuejs"],function(e,t,r,i){"use strict";return{state:Object.assign({},{currentFeatureId:null,features:{},isODEEditionSupported:!0,reloadFeatures:{}}),mutations:{resetFeatureState(e){Object.assign(e,{currentFeatureId:null,features:{},isODEEditionSupported:!0,reloadFeatures:{}})},setMaster(e,{featureId:t,user_id:r}){e.features[t]&&i.set(e.features[t],"master",r)},featureMembers(e,{featureId:t,featureMembers:r}){e.features[t]&&i.set(e.features[t],"members",r)},featureEnded(e,{featureId:t}){},feature(e,{featureKind:t,room_id:r,featureId:s,featureData:o,master:a}){e.features[s]&&!o.reload||(delete o.reload,i.set(e.features,s,{featureKind:t,featureId:s,featureData:o,room_id:r,master:a}))},currentFeatureId(e,t){e.currentFeatureId=t},confetti:(e,{spanId:t,user_id:r,featureId:s})=>{i.set(e.features[s].featureData.confettis,t,r)},coreview_3DPlay_data:(e,{actions:t,featureId:r})=>{if(!e.features[r])return console.error("Received 3DPlay coreview data but the feature is not loaded "+r);i.set(e.features[r].featureData,"actions",t)},isODEEditionSupported(e,t){e.isODEEditionSupported=t},reloadFeatures:(e,t)=>{e.reloadFeatures={...e.reloadFeatures,...t}}},getters:{hasFeature:e=>!!e.currentFeatureId,feature:e=>t=>e.features[t],currentFeatureId:e=>e.currentFeatureId,currentFeature:(e,t)=>!!t.currentFeatureId&&t.feature(t.currentFeatureId),isODE:e=>e=>"ode"==e.featureKind,isWhiteboard:e=>e=>"whiteboard"==e.featureKind,isConfetti:e=>e=>"confetti"==e.featureKind,is3DPlay:e=>e=>"3dplay"==e.featureKind,isMaster:(e,t)=>e=>e.master==t.myself.user_id,getFeatureOfKind:(e,t)=>r=>{for(let i in e.features){let s=e.features[i];if(s.featureKind==r&&t.is_accepted_room(s.room_id))return s}return null},isODEEditionSupported:e=>e.isODEEditionSupported,reloadFeatures:e=>e.reloadFeatures,reloadFeature:e=>t=>e.reloadFeatures[t]},actions:{activateFeature({commit:t,dispatch:r,getters:i},s){if(!s.featureKind||!s.featureId||!s.featureData)return e.error("Can not init feature "+JSON.stringify(s));s.master=i.myself.user_id,t("feature",s),r("switchToFeature",{room_id:s.room_id,featureInfo:s}),r("sendCurrentFeature")},stopFeatures({dispatch:e},{room_id:t}){e("switchToFeature",{room_id:t})},newODE({dispatch:e,getters:t},{room_id:r,title:i,ext:s,media_id:o,url:a}){e("activateFeature",{room_id:r,featureKind:"ode",featureId:Date.now(),featureData:{mediaId:o,title:i,ext:s,url:a}})},newConfetti({dispatch:e},{room_id:t}){e("activateFeature",{room_id:t,featureKind:"confetti",featureId:Date.now(),featureData:{confettis:{}}})},new3DPlay({dispatch:e,getters:t},{room_id:r}){e("activateFeature",{room_id:r,featureKind:"3dplay",featureId:Date.now(),featureData:{fileName:"RadialEngine.3dxml",mime:"3dxml",path:t.assets_url+"RadialEngine.3dxml",actions:{}}})},newWhiteboard({dispatch:t,getters:i},{room_id:s}){var o=i.accepted_room&&i.accepted_room.options&&i.accepted_room.options.dmId;if(o){var a=new r;a.set("play",{}),a.set("community",{community_type:"dm",id:o}),t("activateFeature",{room_id:s,featureKind:"whiteboard",featureId:Date.now(),featureData:{model:a,whiteboard:!0,title:"New whiteboard",coreview:{action:"initCoreview",room_id:s,noCall:!0,collabExperienceOrigin:!0,logins:i.called_users_logins,threadType:"dm",threadId:o,data:{communityId:o,logins:i.called_users_logins,mediaId:"0000",room_id:s}}}})}else e.error("New whiteboard dmId is undefined")},sendCurrentFeature({dispatch:e,getters:t}){var r=t.currentFeature;r&&e("sendFeature",r)},switchToFeature({getters:e,commit:r},{featureInfo:i,room_id:s}){r("currentFeatureId",i&&i.featureId);var o=s||i&&i.room_id;t.callEventFromView({action:"switchToFeature",room_id:o,user_id:e.myself.user_id,featureInfo:i,featureId:i&&i.featureId})},sendFeature({getters:r},i){i?t.callEventFromView({action:"feature",room_id:i.room_id,user_id:r.myself.user_id,featureInfo:i}):e.error("no featureInfo in sendFeature")},setMaster({getters:e,commit:r},i){r("setMaster",{user_id:user_id,featureId:i.featureId}),t.callEventFromView({action:"masterChanged",room_id:i.room_id,user_id:e.myself.user_id,featureInfo:i,featureId:i.featureId})},received_feature({commit:e,getters:t,dispatch:r},{user_id:i,featureInfo:s,room_id:o,type:a}){s.room_id=o,s.master=i,s.featureData.coreview&&(s.featureData.coreview.action="acceptCoreview",s.featureData.coreview.room_id=o),s.featureData.coreviewData,e("feature",s),!t.hasFeature&&t.is_accepted_room(o)&&r("switchToFeature",{featureInfo:s,room_id:o})},invited_feature({dispatch:e},{type:t,featureData:r,room_id:i}){"3dplay"==t&&(r.fileName="Collab3DPlay",r.mime=r.fileExt,r.path=r.fileUrl,r.actions={}),e("activateFeature",{featureData:r,featureId:Date.now(),featureKind:"ode"==t||"whiteboard"==t||"3dplay"==t?t:null,room_id:i})},masterChanged({commit:e},{user_id:t,featureId:r}){e("setMaster",{user_id:t,featureId:r})},featureMembers({commit:e},{user_id:t,featureId:r,featureMembers:i}){e("featureMembers",{user_id:t,featureId:r,featureMembers:i})},featureEnded({commit:e},{user_id:t,featureId:r}){e("featureMembers",{user_id:t,featureId:r,featureMembers:null}),e("featureEnded",{user_id:t,featureId:r})},received_confetti({commit:e},{featureData:t,featureId:r,user_id:i,room_id:s}){e("confetti",{spanId:t.spanId,user_id:i,featureId:r})},send_confetti({getters:e,commit:r},{spanId:i,feature:s}){r("confetti",{spanId:i,user_id:e.myself.user_id,featureId:s.featureId}),t.callEventFromView({action:"confetti",room_id:s.room_id,user_id:e.myself.user_id,featureId:s.featureId,featureData:{spanId:i}}),t.callEventFromView({action:"nextMaster",room_id:s.room_id,user_id:e.myself.user_id,featureId:s.featureId})},received_3DPlay_data({getters:e,commit:t},{room_id:r,actions:i,featureData:s,featureId:o}){t("coreview_3DPlay_data",{featureId:o,actions:i})},send_3DPlay_data({getters:e,commit:r},{room_id:i,actions:s,featureData:o,featureId:a}){t.callEventFromView({action:"3DPlayData",room_id:i,user_id:e.myself.user_id,featureId:a,featureData:o,actions:s})},send_isODEEditionNotSupported({commit:e,getters:t,dispatch:r},i){e("isODEEditionSupported",i),t.isMobile||i||r("alert_ODEEditionNotSupported")},reloadFeatures({commit:e,getters:t},{save:r,forward:i,reload:s,kind:o,deleteReloadData:a}){const n={};i||(i=!1),s||(s=!1),r||(r=!1),(t.getFeatureOfKind("whiteboard")&&!o||o&&"whiteboard"==o)&&(n.whiteboard={save:r,forward:i,reload:s}),(t.getFeatureOfKind("ode")&&!o||o&&"ode"==o)&&(n.ode={save:r,forward:i,reload:s}),(t.getFeatureOfKind("3dplay")&&!o||o&&"3dplay"==o)&&(n["3dplay"]={save:r,forward:i,reload:s}),a&&o&&delete n[o],e("reloadFeatures",n)},removeFeatureData({commit:e},t){const r=t;r.featureData.save&&delete r.featureData.save,r.featureData.reload&&delete r.featureData.reload,r.featureData.forward&&delete r.featureData.forward,e("feature",r)}}}}),define("DS/InstantMessagingCall/store/modules/users",["DS/RTProxyDriver/RTLogger","vuejs","DS/InstantMessagingCall/api/senders","DS/RTConvAPI/RTConvAPI"],function(e,t,r,i){"use strict";return{state:{users:{},accepters:[],refusers:[],video_streamers:[],screen_streamers:[],audio_streamers:[],speaker:null,speaker_track_id:null,speaker_kind:null,call_speaker:null,call_speaker_kind:null,call_speaker_track_id:null,isLocalSpeaker:!1,media_id:null,local_audio:!1,local_video:!1,local_screen:!1,avatarNotLarge:!1,showUserList:!0,isShowAddUser:!1,searchUsersList:[],cusers:[]},getters:{isAvatarNotLarge:e=>e.avatarNotLarge,isTheSpeaker:e=>t=>e.call_speaker==t,accepters:e=>e.accepters,refusers:e=>e.refusers,accepters_name:e=>{var t=[];for(let r of e.accepters)t.push(e.users[r].username);return t},accepters_except_myself:(e,t)=>e.accepters.filter(e=>e!==t.myself.user_id),user:e=>t=>e.users[t],speaker_id:e=>e.speaker,speaker_track_id:e=>e.speaker_track_id,speaker_kind:e=>e.speaker_kind,call_speaker_id:e=>e.call_speaker,call_speaker_kind:e=>e.call_speaker_kind,call_speaker_track_id:e=>e.call_speaker_track_id,local_stream_info:e=>t=>e["local_"+t],called_users:(e,t)=>{if(!t.accepted_room||!t.accepted_room.calledUsers||!t.accepted_room.calledUsers.length)return e.cusers;if(0==e.cusers.length)for(let r of t.accepted_room.calledUsers)e.cusers.push(t.user(r.user_id));else e.cusers=e.cusers.map(e=>t.user(e.user_id));return e.cusers},called_users_logins:(e,t)=>{var r=[];return t.called_users.forEach(e=>e&&e.login&&r.push(e.login)),r},isLocalSpeaker:e=>e.isLocalSpeaker,login:e=>t=>e.users[t]&&e.users[t].login,logins_except_myself:(e,t)=>{var r=[];for(let e of t.called_users)e.user_id!=t.myself.user_id&&r.push(e.login);return r},showUserList:e=>e.showUserList,hasHoldCall:e=>t=>e.users[t]&&e.users[t].stream_info.isOnHold,isShowAddUser:e=>e.isShowAddUser,searchUsersList:e=>e.searchUsersList},mutations:{avatarNotLarge(e,t){e.avatarNotLarge=t},resetUsersState(e){Object.assign(e,{users:{},accepters:[],refusers:[],video_streamers:[],screen_streamers:[],audio_streamers:[],speaker:null,speaker_track_id:null,speaker_kind:null,call_speaker:null,call_speaker_kind:null,call_speaker_track_id:null,isLocalSpeaker:!1,media_id:null,local_audio:!1,local_video:!1,local_screen:!1,avatarNotLarge:!1,showUserList:!0,isShowAddUser:!1,searchUsersList:[],cusers:[]})},isLocalSpeaker(e,t){e.isLocalSpeaker=t},user(e,r){e.users[r.user_id]||(e.users[r.user_id]=r,e.users[r.user_id].stream_info=t.observable({isAudioStreamer:!1,isAudioStreamerMuted:!1,isVideoStreamer:!1,isVideoStreamerMuted:!1,isScreenStreamer:!1,isOnHold:!1,track_id_screen:null,track_id_audio:null,track_id_video:null}))},accepter(e,t){var r=e.refusers.indexOf(t);-1!=r&&e.refusers.splice(r,1),-1==e.accepters.indexOf(t)&&e.accepters.push(t)},refuser(e,t){var r=e.accepters.indexOf(t);-1!=r&&e.accepters.splice(r,1),-1==e.refusers.indexOf(t)&&e.refusers.push(t)},received_track_video(e,{user_id:t,track_id:r}){e.users[t].stream_info.isVideoStreamer=!1,e.users[t].stream_info.isVideoStreamer=!0,e.users[t].stream_info.track_id_video=r,-1==e.video_streamers.indexOf(t)&&e.video_streamers.push(t)},received_track_screen(e,{user_id:t}){e.users[t].stream_info.isScreenStreamer=!0,-1==e.screen_streamers.indexOf(t)&&e.screen_streamers.push(t)},remove_track_screen(e,{user_id:t}){e.users[t].stream_info.isScreenStreamer=!1;var r=e.screen_streamers.indexOf(t);-1!=r&&e.screen_streamers.splice(r,1)},received_track_audio(e,{user_id:t,track_id:r}){e.users[t].stream_info.isAudioStreamer=!1,e.users[t].stream_info.isAudioStreamer=!0,e.users[t].stream_info.track_id_audio=r,-1==e.audio_streamers.indexOf(t)&&e.audio_streamers.push(t)},remove_track_audio(e,{user_id:t}){e.users[t].stream_info.isAudioStreamer=!1;var r=e.audio_streamers.indexOf(t);-1!=r&&e.audio_streamers.splice(r,1)},remove_track_video(e,{user_id:t}){e.users[t].stream_info.isVideoStreamer=!1;var r=e.video_streamers.indexOf(t);-1!=r&&e.video_streamers.splice(r,1)},local_stream_info(e,{kind:t,muted:r,loaded:i,user_id:s}){e["local_"+t]=r?"muted":i,"audio"==t?e.users[s].stream_info.isAudioStreamerMuted=!1!==r:"video"==t&&(e.users[s].stream_info.isVideoStreamerMuted=!1!==r)},stream_muted(e,{kind:t,user_id:r,muted:i}){"audio"==t?e.users[r].stream_info.isAudioStreamerMuted=i:"video"==t&&(e.users[r].stream_info.isVideoStreamerMuted=i)},call_hold(e,{user_id:t,onHold:r}){e.users[t].stream_info.isOnHold=!!r},call_speaker(e,{user_id:t,speaker_track_id:r,kind:i}){e.call_speaker=t,e.call_speaker_kind=i,e.call_speaker_track_id=r},speaker(e,{user_id:t,speaker_track_id:r,kind:i}){e.speaker_track_id=r,e.speaker=t,e.speaker_kind=i},track_stopped(t,{user_id:r,track_id:i,kind:s}){switch(s){case"screen":t.users[r].stream_info.isScreenStreamer=!1,t.showUserList=!0,t.speaker==r&&(t.speaker=null,t.speaker_track_id=null,t.speaker_kind=null),t.call_speaker==r&&(t.call_speaker=null,t.call_speaker_id=null,t.call_speaker_kind=null);break;default:e.Call("stop track "+s+" but feature not implemented")}},showUserList:(e,t)=>{e.showUserList=t},showAddUser:(e,t)=>{e.isShowAddUser=t},searchUsersList:(e,{users:t})=>{e.searchUsersList=t},called_users:(e,{users:t})=>{const r=t.map(t=>e.users[t.user_id]);e.cusers=r}},actions:{setPresence({dispatch:e},t){r.presence(t)},setAsSpeaker({commit:e,getters:t},{user_id:r,track_id:i,firstSpeaker:s,kind:o}){e("speaker",{user_id:r,speaker_track_id:i,kind:o})},switchToCallSpeaker({dispatch:e,getters:t}){e("setAsSpeaker",{user_id:t.call_speaker_id,track_id:t.call_speaker_track_id,kind:t.call_speaker_kind})},removeSpeaker({commit:e,getters:t},{user_id:r}){e("speaker",{user_id:null,speaker_track_id:null}),r==t.myself.user_id&&e("isLocalSpeaker",!1)},search({commit:e},t){Object.keys(t).length>0?e("searchUsersList",{users:t}):e("searchUsersList",{users:{noResult:{userName:"No results.",userId:"noResult"}}})},addCalledUsers:({commit:e,dispatch:t,getters:r},s)=>{r.accepted_room.options.dmId!=s.options.dmId&&(r.isPrivateConv&&t("reloadFeatures",{}),e("dmId",{newDmId:s.options.dmId,room_id:s.room_id}));for(let t of s.users)e("user",t);if(s.room_id==r.accepted_room.room_id&&e("called_users",{users:[...r.called_users,...s.users]}),s.user_id==r.myself.user_id){let e=s.options.dmId.slice();e.includes(":rt:")&&(e=e.split(":").pop()),i.addMembers({platformId:r.tenant,dmId:e,logins:s.logins}),r.isPrivateConv&&t("reloadFeatures",{save:!0})}e("roomName",s)}}}}),define("DS/InstantMessagingCall/components/Collab/Collab",["text!DS/InstantMessagingCall/components/Collab/Collab.html","DS/InstantMessagingCall/components/CollabOfficeDocument/CollabOfficeDocument","DS/InstantMessagingCall/components/CollabWhiteBoard/CollabWhiteBoard","DS/InstantMessagingCall/components/CollabConfetti/CollabConfetti","DS/InstantMessagingCall/components/Collab3DPlay/Collab3DPlay"],function(e,t,r,i,s,o){"use strict";return{components:{"im-call-ode":t,"im-call-whiteboard":r,"im-call-confetti":i,"im-call-3dplay":s},props:["feature","feature_id","isODE","isWhiteboard","isConfetti","is3DPlay","isScreenShare","swymDriver"],computed:{featureData(){return this.feature&&this.feature.featureData},masterUser(){return this.feature&&this.feature.master&&this.$store.getters.user(this.feature.master)}},template:e}}),define("DS/InstantMessagingCall/components/UserVideoList/UserVideoList",["text!DS/InstantMessagingCall/components/UserVideoList/UserVideoList.html","DS/InstantMessagingCall/components/UserItem/UserItem"],function(e,t){"use strict";return{data:()=>({startIndex:0}),components:{"im-call-user-item":t},props:["users","videoDisplayNumber"],computed:{maxVideoNumber(){return this.videoDisplayNumber||6},endIndex(){return this.startIndex+this.maxVideoNumber},isScrollable(){return this.users.length>this.maxVideoNumber},isScrollableUp(){return this.isScrollable&&this.startIndex>0},isScrollableDown(){return this.isScrollable&&this.endIndex<this.users.length}},methods:{scrollUp(){this.startIndex=this.startIndex-1>0?this.startIndex-1:0},scrollDown(){this.startIndex=this.endIndex<this.users.length?this.startIndex+1:this.startIndex},isVisible(e){return this.startIndex<=e&&e<this.endIndex}},template:e}}),define("DS/InstantMessagingCall/components/MemberAdd/MemberAdd",["text!DS/InstantMessagingCall/components/MemberAdd/MemberAdd.html","DS/InstantMessagingCall/api/senders","DS/RTInterface/RTInterface"],function(e,t,r){"use strict";return{data(){return{selectUsers:{input:"",list:[],options:[],placeholder:this.$store.getters.nls("searchUser")},topic:{label:this.$store.getters.nls("setTopicLabel"),model:"",placeholder:this.$store.getters.nls("setTopic"),rules:[e=>!this.isTopicEmpty]}}},props:["showAddUser"],updated(){this.showAddUser&&(this.selectUsers.input=this.$refs.searchUsersMultipleSelect.$refs.input,this.selectUsers.input.oninput=(e=>{this.searchUsers(e.target.value),(e.target.value.length<3||""==e.target.value)&&this.sendEmptyUsersList()}),this.selectUsers.input.onblur=(e=>{this.sendEmptyUsersList(),e.target.value="",this.selectUsers.input.size=23}),this.selectUsers.input.onfocus=(e=>{this.selectUsers.input.readOnly=this.disableInput}))},computed:{called_users_logins(){return this.$store.getters.called_users_logins},isPrivateConv(){return 2==this.$store.getters.called_users_logins.length&&this.$store.getters.isPrivateConv},isTopicEmpty(){return 0==this.topic.model.trim().length},addUserLimit(){return 15-(this.called_users_logins.length+this.selectUsers.list.length)},searchUsersList(){return Object.fromEntries(Object.entries(this.$store.getters.searchUsersList).filter(([e,t])=>!this.called_users_logins.includes(e)&&!this.selectUsers.list.includes(e)))},selectHelper(){return this.addUserLimit>0?this.$store.getters.nls("addUserLimit").replace("{0}",this.addUserLimit):0==this.addUserLimit?this.$store.getters.nls("reachMaxUsersConv"):""},removeUsersRule(){return this.$store.getters.nls("removeUsersRule").replace("{0}",Math.abs(this.addUserLimit))},room_id(){return this.$store.getters.accepted_room_id},room(){return this.$store.getters.room(this.room_id)},convTopic(){return this.isPrivateConv?this.topic.model:this.$store.getters.roomName(this.room)},disableInput(){return this.addUserLimit<1}},methods:{sendInvite(){let e;0==this.selectUsers.list.length&&(this.$store.dispatch("alert_addUser","emptyUsers"),e=!0),this.isPrivateConv&&this.isTopicEmpty&&(this.$store.dispatch("alert_addUser","emptyTopic"),e=!0),e||(t.callEventFromView({action:"addUserToCall",room_id:this.room_id,logins:this.selectUsers.list,options:{topic:this.convTopic}}),this.hideAddUserModal())},hideAddUserModal(){this.$store.commit("showAddUser",!1),this.sendEmptyUsersList(),this.selectUsers.list=[],this.selectUsers.options=[],this.topic.model=""},searchUsers:e=>r.send({evenement:"SEARCHCONTACT",data:e},"fromwidgetim.ds.com"),addUser(e,t){this.selectUsers.options.push({label:e,value:t}),this.selectUsers.list.push(t),this.sendEmptyUsersList()},sendEmptyUsersList(){this.$store.commit("searchUsersList",{users:{}})}},template:e}}),define("DS/InstantMessagingCall/components/ActionBar/ActionBar",["text!DS/InstantMessagingCall/components/ActionBar/ActionBar.html","DS/InstantMessagingCall/components/ActionBarItem/ActionBarItem","DS/WAFData/WAFData","DS/UIKIT/SuperModal","DS/InstantMessagingCall/assets/CollabOfficeTemplates","DS/InstantMessagingCall/components/MemberAdd/MemberAdd"],function(e,t,r,i,s,o){"use strict";return{components:{"im-call-bar-item":t,"im-call-member-add":o},props:["room","showSelfView","showUserList","hasFeature","hasSpeaker","isWhiteboard","isODE","isTelephonySupported","isConfetti","is3DPlay"],data(){return{document:document,durationInterval:null,duration:0,ODEitems:[{text:this.$store.getters.nls("createDocument"),fonticon:"doc-text",handler:e=>this.activeODE("docx")},{text:this.$store.getters.nls("createPresentation"),fonticon:"presentation-slide-layout",handler:e=>this.activeODE("pptx")},{text:this.$store.getters.nls("createSpreadsheet"),fonticon:"table",handler:e=>this.activeODE("xlsx")}],window:window}},computed:{isConfettiSupported(){return!this.$store.getters.hideConvFeatures&&this.$store.state.call.confettiAvailable},isODESupported(){return!this.$store.getters.hideConvFeatures&&this.$store.getters.isAccepted&&this.$store.getters.odeFeature},isWhiteboardSupported(){return!this.$store.getters.hideConvFeatures&&this.$store.getters.whiteboardFeature},is3DPlaySupported(){return!this.$store.getters.hideConvFeatures&&this.$store.getters.troisdplayFeature},isSpeaker(){return!!this.$store.getters.speaker_id},isLocalVideo(){return!!this.$store.getters.local_stream_info("video")},isLocalVideoMuted(){return"muted"==this.$store.getters.local_stream_info("video")},isLocalAudio(){return!!this.$store.getters.local_stream_info("audio")},isLocalAudioMuted(){return"muted"==this.$store.getters.local_stream_info("audio")},isLocalScreen(){return!!this.$store.getters.local_stream_info("screen")},isLocalScreenMuted(){return"muted"==this.$store.getters.local_stream_info("screen")},isSip(){return!!this.$store.getters.sip},date_start(){var e=this.$store.getters.date_start;return e?this.durationInterval=setInterval(()=>{this.duration=Date.now()-e},1e3):this.durationInterval&&(clearInterval(this.durationInterval),this.durationInterval=null,this.duration=0),e},durationString(){var e=Math.floor(this.duration/1e3),t=Math.floor(e/3600),r=(e-=3600*t)%60;r<10&&(r="0"+r);var i=Math.floor(e/60);return i<10&&(i="0"+i),(t?t+":":"")+i+":"+r},isLocalScreenDisplayed(){return this.isLocalScreen&&!this.isLocalScreenMuted},isScreenDisplayed(){return this.hasSpeaker&&this.runningScreenSharingFeature&&"screen"===this.$store.getters.speaker_kind},screenSharingDisabled(){return!this.$store.getters.screenSharingAvailable||this.hasFeature},collabDisabled(){return this.isSpeaker||this.hasFeature||this.isLocalScreenDisplayed},isDialerON(){return!!this.$store.getters.showDialer},runningConfettiFeature(){return this.$store.getters.getFeatureOfKind("confetti")},running3DPlayFeature(){return this.$store.getters.getFeatureOfKind("3dplay")},runningWhiteboardFeature(){return this.$store.getters.getFeatureOfKind("whiteboard")},runningODEFeature(){return this.$store.getters.getFeatureOfKind("ode")},runningScreenSharingFeature(){return"screen"===this.$store.getters.call_speaker_kind},isOnHold(){return this.room&&this.$store.getters.is_onhold_room(this.room.room_id)},ODESetMode(){return this.isODESupported&&(!this.collabDisabled||this.isODE&&!this.isOnHold||!this.isODE&&!!this.runningODEFeature&&!this.isOnHold)},ODEAvailableMode(){return!this.isODE&&!this.runningODEFeature&&!this.isOnHold},ODEStopMode(){return this.isODE&&!this.isOnHold},ODERunningMode(){return!this.isODE&&!!this.runningODEFeature&&!this.isOnHold},ODEDisableMode(){return!this.isODE&&!this.runningODEFeature&&this.collabDisabled},displayAddUserModel(){return this.$store.getters.isShowAddUser},isRTCActivated(){return this.$store.getters.isRTCActivated},addUserFeature(){return this.$store.getters.addUserFeature},isPrivateConv(){return this.$store.getters.isPrivateConv},isSwymConv(){return this.$store.getters.isSwymConv}},methods:{endCall(){this.isLocalScreenDisplayed&&this.stopTrack("screen"),this.track_event(["handset",this.$store.getters.isAccepted],0),this.$store.dispatch("endCall",this.room)},acceptCall(){this.track_event(["handset"],1),this.$store.dispatch("acceptCall",this.room)},holdCall(){this.track_event(["track","holdCall"],1),this.$store.dispatch("holdCall",this.room.room_id)},resumeCall(){this.track_event(["track","resumeCall"],0),this.$store.dispatch("resumeCall",this.room.room_id)},activeTrack(e){this.$store.dispatch("activeTrack",{kind:e,room_id:this.room.room_id}),this.track_event(["track",e],1)},muteTrack(e){this.$store.dispatch("muteTrack",{kind:e,room_id:this.room.room_id}),this.track_event(["track",e],0)},stopTrack(e){this.$store.dispatch("stopTrack",{kind:e,room_id:this.room.room_id}),this.track_event(["track",e],0)},volumeOFF(e){this.$store.dispatch("volumeOFF",e),this.track_event(["track","volume"],e?0:1)},displayDialer(){this.$store.commit("showDialer")},hideDialer(){this.$store.commit("hideDialer")},stopFeatures(e){this.$store.dispatch("stopFeatures",{room_id:this.room.room_id}),this.track_event(["feature",e],0)},activeODE(e){if(this.runningODEFeature)return this.$store.dispatch("switchToFeature",{featureInfo:this.runningODEFeature});if(e){var t=this;new i({closable:!0,renderTo:this.document.body}).prompt({title:this.$store.getters.nls("new"+s.extensionsFormat[e].name),message:this.$store.getters.nls("enterAFileName"),required:!0,placeholder:this.$store.getters.nls("fileName"),callback:function(r){r?t.onConfirm(r,e):console.log("Prompt dismissed")}})}},onConfirm(e,t){if(e&&t){var r=e,i=this.$store.getters.accepted_room&&this.$store.getters.accepted_room.options&&this.$store.getters.accepted_room.options.dmId,s=e+"."+t,o=this;this.addmedia(i,r,s,t,function(i,s){i&&s?(console.log("Add OK : mediaId: "+i+", title: "+e),o.$store.dispatch("newODE",{room_id:o.room.room_id,title:r,ext:t,media_id:i,url:s})):console.log("Error no mediaId or url define")}),this.track_event(["feature","ode",t],1)}},addmedia(e,t,i,o,a){if((n=this.$store.getters.swymUrl)&&e&&t&&i&&o&&a){var n=this.$store.getters.swymUrl,l=this.$store.getters.tenant,d=this;require("DS/TopFrame/TopFrame")._loadModules(["DS/OfficeDocumentEditorClient/Editor"]).then(function(c){var u=c[0];u&&u.getDocumentTemplatesURL({platformId:l}).then(l=>{if(l&&l[o]){var c=l[o];if(!c)return console.log("Failed to get ODE template"),a();r.request(c,{responseType:"blob",onComplete:function(l){if(!l)return console.log("Failed to get ODE template"),a();!function(e,t,r){if(s.extensionsFormat[e]){var i=new Blob([t],{type:s.extensionsFormat[e].format});i&&r(i)}else console.error("Error loading CollabOfficeTemplates of extension "+e)}(o,l,function(s){var o=new FormData;o.append("is_illustration",!1),o.append("community_id",e),o.append("title",t),o.append("media_type","document"),o.append("published",!0),o.append("fileName",i),o.append("userFile",s,i),d.getCSRFswym(function(e){e&&r.authenticatedRequest(n+"/api/media/addmedia",{method:"POST",headers:{"X-DS-SWYM-CSRFTOKEN":e},data:o,onComplete:function(e){if(e)try{var t=(e=JSON.parse(e)).result.id_media;a(t,c)}catch(e){console.log("Failed to add media"),a()}},onFailure:function(e){console.log("Failed to add media"),a()}})})})},onFailure:function(e){console.log("Failed to get template"),a()}})}else console.log("Failed to get template")})})}},getMedia(e,t,i){var s=this.$store.getters.swymUrl,o={params:{id_media:e,detailedInfos:!0}};r.authenticatedRequest(s+"/api/media/getmedia",{method:"POST",type:"json",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":t},data:JSON.stringify(o),onComplete:function(e){e&&e.result&&e.result.play&&e.result.play.download_original_url&&e.result.play.download_original_url.transient_url_as_attachment||i();var t=e.result.play.download_original_url.transient_url_as_attachment;i(t)},onFailure:function(e){console.log("Failed to get media"),i()}})},getCSRFswym(e){var t=this.$store.getters.swymUrl;r.authenticatedRequest(t+"/api/index/tk",{method:"GET",type:"json",onComplete:function(t){t||e();try{var r=t.result.ServerToken;e(r)}catch(t){console.log("Failed to resolve CSRF Token "+t),e()}},onFailure:function(t){console.log("Failed to get CSRF Token "+t),e()}})},joinODE(){if(this.runningODEFeature)return this.$store.dispatch("switchToFeature",{featureInfo:this.runningODEFeature});console.error("Can not join unexisting ODE")},activeWhiteboard(){if(this.runningWhiteboardFeature)return this.$store.dispatch("switchToFeature",{featureInfo:this.runningWhiteboardFeature});this.$store.dispatch("newWhiteboard",{room_id:this.room.room_id}),this.track_event(["feature","whiteboard"],1)},activeConfetti(){if(this.runningConfettiFeature)return this.$store.dispatch("switchToFeature",{featureInfo:this.runningConfettiFeature});this.$store.dispatch("newConfetti",{room_id:this.room.room_id})},active3DPlay(){if(this.running3DPlayFeature)return this.$store.dispatch("switchToFeature",{featureInfo:this.running3DPlayFeature});this.$store.dispatch("new3DPlay",{room_id:this.room.room_id})},track_event(e,t){this.$store.dispatch("track_event",{action:"actionBar",dimensions:e,eventValue:t})},removeSpeaker(){this.$store.dispatch("removeSpeaker",{user_id:this.$store.getters.speaker_id})},switchToCallSpeaker(){this.$store.dispatch("switchToCallSpeaker")},showAddUserModal(){this.$store.commit("showAddUser",!0)}},template:e}}),define("DS/InstantMessagingCall/components/MemberList/MemberList",["text!DS/InstantMessagingCall/components/MemberList/MemberList.html","DS/InstantMessagingCall/components/MemberItem/MemberItem"],function(e,t){"use strict";return{props:["members"],components:{"im-call-member-item":t},computed:{},methods:{},template:e}}),define("DS/InstantMessagingCall/components/InvitationItem/InvitationItem",["text!DS/InstantMessagingCall/components/InvitationItem/InvitationItem.html","DS/InstantMessagingCall/components/ActionBar/ActionBar"],function(e,t){"use strict";return{components:{"im-call-bar":t},props:["room_id"],computed:{room(){return this.$store.getters.room(this.room_id)},isCaller(){return this.room.IamTheCaller},isMinimizedCall(){return this.$store.getters.isAccepted},labelArray(){if(this.room){if(this.$store.getters.roomName(this.room))return[this.$store.getters.roomName(this.room)];if(!this.room.IamTheCaller&&this.room.user&&this.room.user.username)return[this.room.user.username]}return this.$store.getters.called_users_name(this.room_id)},label(){return this.labelArray&&this.labelArray.toString().replaceAll(",",", ")},callerLogin(){return this.room&&this.room.user.login},subtitle(){return this.isMinimizedCall&&this.$store.getters.nls("ongoing")||this.isCaller&&this.$store.getters.nls("calling")||this.$store.getters.nls("incoming")},asDelegateOf(){return this.room&&this.room.room_id&&this.$store.getters.asDelegateOf(this.room.room_id)},simringWith(){return this.room&&this.room.room_id&&this.$store.getters.simringWith(this.room.room_id)},delegationMessage(){return!!this.asDelegateOf&&this.$store.getters.nls("invitedAsDelegate").replace("{username}",this.asDelegateOf.username)||!!this.simringWith&&1===this.simringWith.length&&this.$store.getters.nls("simringWith").replace("{username}",this.simringWith[0])||!!this.simringWith&&this.simringWith.length>1&&this.$store.getters.nls("simringWithDelegates")}},methods:{maximize(){this.$store.commit("minimize",!1),this.track_event("minimize",0)},track_event(e,t){this.$store.dispatch("track_event",{action:"topBar",dimensions:e,eventValue:t})}},template:e}}),define("DS/InstantMessagingCall/components/PanelMembers/PanelMembers",["text!DS/InstantMessagingCall/components/PanelMembers/PanelMembers.html","DS/InstantMessagingCall/components/MemberList/MemberList"],function(e,t){"use strict";return{components:{"im-call-member-list":t},computed:{called_users(){return this.$store.getters.called_users}},template:e}}),define("DS/InstantMessagingCall/components/InvitationList/InvitationList",["text!DS/InstantMessagingCall/components/InvitationList/InvitationList.html","DS/InstantMessagingCall/components/InvitationItem/InvitationItem"],function(e,t){"use strict";return{components:{"im-call-invitation-item":t},props:["rooms_id"],template:e}}),define("DS/InstantMessagingCall/components/UserList/UserList",["text!DS/InstantMessagingCall/components/UserList/UserList.html","DS/InstantMessagingCall/components/UserItem/UserItem","DS/InstantMessagingCall/components/SelfView/SelfView","DS/UIKIT/Scroller"],function(e,t,r,i){"use strict";return{data:()=>({startIndex:0}),components:{"im-call-user-item":t,"im-call-self":r},props:["hasSpeaker","showSelfView","minimized"],computed:{users(){return this.$store.getters.accepters},isScrollable(){return this.users&&this.users.length>6},isScrollableUp(){return this.isScrollable&&this.startIndex>0},isScrollableDown(){return this.isScrollable&&this.startIndex<this.users.length-6},isLightboxMinimized(){return this.sizeWH(),this.minimized}},methods:{scrollUp(){this.startIndex=0>this.startIndex-6?0:this.startIndex-6},scrollDown(){this.startIndex=this.users.length-6<this.startIndex+6?this.users.length-6:this.startIndex+6},canBeShown(e){return this.startIndex<=e&&e<this.startIndex+6},minimize(){this.$store.commit("showUserList",!1)},sizeWH(){var e,t,r,i,s,o,a=this.$refs["useritems-container"],n=a.offsetHeight,l=a.offsetWidth,d=a.childElementCount;if(this.hasSpeaker)t=1,i=l,o=r=(n-88)/(e=6),s=r*(16/9);else{switch(!0){case 1==d:t=1,e=1;break;case 2==d:t=2,e=1;break;case d<4||4==d:t=2,e=2;break;case d<6||6==d:t=3,e=2;break;case d<9||9==d:e=3,t=3;break;case d<12||12==d:t=4,e=3;break;case d<16||16==d:e=4,t=4}o=(s=(i=l/t)/(16/9)>(r=n/e)?r*(16/9):i)/(16/9)}for(var c=0;c<a.children.length;c++)a.children[c].style.height=o-5+"px",a.children[c].style.width=s-5+"px"}},updated(){this.sizeWH()},created(){window.addEventListener("resize",this.sizeWH)},destroyed(){window.removeEventListener("resize",this.sizeWH)},template:e}}),define("DS/InstantMessagingCall/store/modules/p2p",["DS/RTProxyDriver/RTLogger","DS/InstantMessagingCall/api/senders"],function(e,t){"use strict";var r=window.navigator.userAgent,i=!!r.match(/iPad/i)||!!r.match(/iPhone/i)||!!r.match(/iPadPro/i),s=!!r.match(/WebKit/i),o=i&&s&&!r.match(/CriOS/i);window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;const a={googTypingNoiseDetection:!1,googEchoCancellation:!0,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1},n={cursor:!0,logicalSurface:!0},l={mandatory:{OfferToReceiveAudio:!0,offerToReceiveAudio:!0,OfferToReceiveVideo:!0,offerToReceiveVideo:!0}},d=({room_id:t,user_id:r})=>t&&r&&"string"==typeof t&&"string"==typeof r?t+r:e.error("p2p protocol error p2pKey "+JSON.stringify(arguments[0])),c=t=>(t&&t.getVideoTracks().forEach(t=>{t.contentHint="text","contentHint"in t?"text"!==t.contentHint&&console.error("Invalid video track contentHint: text"):e.error("MediaStreamTrack contentHint attribute not supported")}),t),u=e=>"contentHint"in e&&"text"==e.contentHint,m=(e,t)=>!!e&&!!(e.kind==t&&("audio"==t||"video"==t&&!u(e))||"screen"==t&&u(e)),p=e=>{var t=e.getTracks(),r={isAudio:!1,isVideo:!1,isScreen:!1};for(let e of t)"audio"==e.kind?(r.isAudio=!0,r.isAudioMuted=!e.enabled,r.track_id_audio=e.id):"video"==e.kind&&(u(e)||r.isVideo?(r.isScreen=!0,r.isScreenMuted=!e.enabled,r.track_id_screen=e.id):(r.isVideo=!0,r.isVideoMuted=!e.enabled,r.track_id_video=e.id));return r},h=(e,t)=>{var r=e.getSenders();for(let e of r)if(e.track&&e.track.id==t)return!0;return!1},f=function(t,r){var i=t.getParameters();i.encodings||(i.encodings=[{}]),i.encodings[0]||(i.encodings[0]={}),i.encodings[0].maxBitrate=1e3*r,t.setParameters(i).then(()=>{e.Call("setBandwidth success to "+r+" kbps")},t=>{e.Call("setBandwidth failed "+t)})};var g=[];return{state:{peer_connections:{},local_stream:null,mutex_local_media:!1,remote_streams:{},video_activated:!1,audio_activated:!1,screen_activated:!1,bandwidth:500,constraintsVideo:{},constraintsAudio:{},forceTURN:!1},getters:{pc:e=>t=>e.peer_connections[d(t)],isTrackId:e=>(t,r)=>{var i=e.remote_streams[t];return!!i&&!!i.getTrackById(r)},streams:(e,t)=>(r,i,s)=>{if((s=s||e.remote_streams[r])||r!=t.myself.user_id||(s=e.local_stream),!s&&!t.sip)return console.error("can't find stream of user "+r);if(i){var o=new MediaStream,a=s.getTrackById(i);if(a)o.addTrack(a);else{var n=s.getVideoTracks(),l=void 0;n.forEach(e=>{e.contentHint&&"text"==e.contentHint&&(l=e)}),l?n&&n.length&&o.addTrack(l):n&&n.length&&o.addTrack(n[n.length-1])}return[o]}return[s]},self_stream:(e,t)=>e=>t.streams(t.myself.user_id),mutex_local_media:e=>e.mutex_local_media,local_track_of_kind:e=>t=>{if(!e.local_stream)return null;for(let r of e.local_stream.getTracks())if(m(r,t))return r;return null},bandwidth:e=>e.bandwidth,constraintsVideo:e=>e.constraintsVideo,constraintsAudio:e=>e.constraintsAudio},mutations:{resetP2PState(e){Object.assign(e,{peer_connections:{},local_stream:null,mutex_local_media:!1,remote_streams:{},video_activated:!1,audio_activated:!1,screen_activated:!1,bandwidth:500,constraintsVideo:{},constraintsAudio:{},forceTURN:!1})},pc(t,{user_id:r,room_id:i,webrtcConfig:s,p2pTentatives:o}){var a={user_id:r,room_id:i},n=d(a);if(t.peer_connections[n])return e.Call("p2p bypass PC creation : PC already exists "+r);var l=t.forceTURN?Object.assign({},s,{iceTransportPolicy:"relay"}):s;t.peer_connections[n]=Object.assign(new RTCPeerConnection(l),a),t.peer_connections[n].key=n,t.peer_connections[n].p2pTentatives=o||0},mutex_local_media(e,t){e.mutex_local_media=t},local_stream(e,t){if(e.local_stream)for(let r of t.getTracks())e.local_stream.addTrack(r);else e.local_stream=t},remote_stream(e,{stream:t,pc:r}){let i=r.user_id;e.remote_streams[i]=t},polite(t,{user_id:r,room_id:i}){var s=d({user_id:r,room_id:i});t.peer_connections[s]?t.peer_connections[s].polite=!0:e.error("polite: pc not found "+r)},stopLocalTrack(e,{kind:t}){if(!e.local_stream)return!0;for(let r of e.local_stream.getTracks())if(m(r,t)){r.stop(),e.local_stream.removeTrack(r);break}},deleteLocalStream(e){if(!e.local_stream)return!0;for(let t of e.local_stream.getTracks())t.stop();delete e.local_stream},deleteP2P(t,r){var i=t.peer_connections[r];if(!i)return e.error("failed to retrieve PC "+r);i.close(),delete t.peer_connections[r]},activated(e,{kind:t}){"video"==t?e.video_activated=!0:"screen"==t?e.screen_activated=!0:"audio"==t&&(e.audio_activated=!0)},deactivated(e,{kind:t}){"video"==t?e.video_activated=!1:"screen"==t?e.screen_activated=!1:"audio"==t&&(e.audio_activated=!1)},constraints(e,{bandwidth:t,constraintsVideo:r,constraintsAudio:i}){t&&(e.bandwidth=t),r&&r!={}&&(e.constraintsVideo=r),i&&i!={}&&(e.constraintsAudio=i)},forceTURN(e,t){e.forceTURN=t}},actions:{getUserMedia:({},t)=>navigator.mediaDevices?navigator.mediaDevices.getUserMedia(t):navigator.getUserMedia?new Promise((e,r)=>navigator.getUserMedia(t,e,r)):(e.Call("no navigator getLocalMedia method found"),Promise.reject("NotReadableError")),initP2P({commit:t,rootState:r,state:i,dispatch:s,getters:a},n){if(e.Call("iOSSafari : "+o),a.pc(n))return e.Call("p2p already exists");t("pc",Object.assign({},n,{webrtcConfig:r.webrtcConfig}));var l=a.pc(n);l.ontrack=(e=>{s("ontrack",{data:e,pc:l})}),l.onicecandidate=(e=>{s("onicecandidate",{data:e,pc:l})}),l.onnegotiationneeded=(t=>{if("stable"!=l.signalingState)return e.Call("onnegotiationneeded ignored "+l.user_id);e.Call("onnegotiationneeded "+l.user_id),s("createOffer",{data:t,pc:l})}),l.oniceconnectionstatechange=(e=>{s("oniceconnectionstatechange",{data:e,pc:l})}),l.onsignalingstatechange=(e=>{s("onsignalingstatechange",{data:e,pc:l})}),l.onicegatheringstatechange=(e=>{s("onicegatheringstatechange",{data:e,pc:l})})},sendStream({dispatch:r,getters:i},s){e.Call("sendStream to "+s.user_id),r("getLocalMedia",s).then(()=>{r("addLocalStream",i.pc(s))}).catch(e=>{console.error(e),r("alert_getLocalMediaError",e);var o=i.pc(s);t.callEventFromView({action:"reporting",reason:e,room_id:s.room_id,pcStates:o&&[o.polite,o.signalingState,o.iceConnectionState],step:"sendStream"})})},cleanAllP2P({state:e,commit:t,dispatch:r}){for(let t in e.peer_connections)r("cleanP2P",{key:t});t("deleteLocalStream")},cleanP2P({commit:t},{key:r,room_id:i,user_id:s}){e.Call("cleanP2P of "+(r||s)),t("deleteP2P",r||d({room_id:i,user_id:s}))},getLocalMedia:({state:r,commit:i,dispatch:s,getters:o},{user_id:l,type:d})=>new Promise((d,u)=>{var m,h,f,_,v,S=r.screen_activated,C=r.video_activated;if(r.local_stream){var b=p(r.local_stream);if(f=!b.isAudio,h=C&&!b.isVideo,m=S&&!b.isScreen,!f&&!h&&!m)return d()}else f=!0,h=C,m=S;if(r.mutex_local_media)return g.push(t=>{e.Call("Concurrent getLocalMedia finished, use same media for "+l),t&&u(t)||d()}),e.Call("Waiting for a concurrent getLocalMedia to finish before sending my stream to "+l);i("mutex_local_media",!0);var k=Object.assign({},o.constraintsVideo),y=Object.assign({},o.constraintsAudio);try{_=navigator.mediaDevices.getSupportedConstraints()}catch(e){_=null}if(_){for(v in k)_[v]||delete k[v];for(v in y)_[v]||delete y[v]}else k=null,y=null;k&&k!={}||y&&y!={}?(e.Call("getLocalMedia video constraints to apply : "+JSON.stringify(k)),e.Call("getLocalMedia audio constraints to apply : "+JSON.stringify(y))):e.Call("getLocalMedia no constraints to apply");var w=Object.assign({},a,{audio:f&&y,video:h&&k}),I=e=>{for(var t of(e&&i("local_stream",e),s("local_stream_info"),d(),g))t();g.length=0,i("mutex_local_media",!1)},D=e=>{for(var r of(u(e),g))r(e);g.length=0,i("mutex_local_media",!1),s("tracking",{action:"getLocalMediaFailed",reason:e,user_id:l}),s("track_event",{action:"getLocalMediaResult",dimensions:e.toString()}),t.callEventFromView({action:"reporting",reason:e,step:"getLocalMedia"})};const T=[...m?["screen"]:[],...f?["audio"]:[],...h?["video"]:[]];s("track_event",{action:"getLocalMedia",dimensions:T,eventValue:T.length}),new Promise((e,t)=>{if(!m)return e();navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(n).then(e).catch(t):navigator.getDisplayMedia(n).then(e).catch(t)}).then(e=>{w.audio||w.video?(e&&i("local_stream",c(e)),s("getUserMedia",w).then(I,D)):I(c(e))}).catch(e=>{D(e)})}),removeLocalTrackFromPC({},{pc:e,kind:t}){var r=e.getSenders();if(!r)return!0;r.forEach(r=>{m(r.track,t)&&e.removeTrack(r)})},addLocalStream({state:r,getters:i,dispatch:s},o){var a=r.local_stream;if(!a)return e.Call("no local stream");if(o.addTrack)try{var n,l=a.getTracks(),d=-1;for(n=0;n<l.length;n++)h(o,l[n].id)||(l[n].contentHint&&"text"==l[n].contentHint?d=n:o.addTrack(l[n],a));d>-1&&o.addTrack(l[d],a)}catch(r){e.error(r),t.callEventFromView({action:"reporting",reason:r,room_id:o.room_id,pcStates:[o.polite,o.signalingState,o.iceConnectionState],step:"addTrack"})}else{if(!o.addStream)return e.error("addLocalStream called but addTrack & addStream unexist");try{o.addStream(a)}catch(r){e.error("addLocalStream failed to addStream "+r),t.callEventFromView({action:"reporting",reason:r,room_id:o.room_id,pcStates:[o.polite,o.signalingState,o.iceConnectionState],step:"addStream"})}}s("sendStreamInfo",{kind:"screen",pc:o}),s("sendStreamInfo",{kind:"video",pc:o}),s("sendStreamInfo",{kind:"audio",pc:o}),s("sendStreamInfo",{kind:"hold",pc:o})},sendStreamInfo({getters:e},{kind:r,pc:i}){let s=e.local_track_of_kind(r);switch(r){case"screen":s&&t.callEventFromView({action:"speaker",type:r,room_id:i.room_id,user_id:e.myself.user_id,track_id:s.id});break;case"audio":case"video":s&&t.callEventFromView({action:"mute",type:r,muted:"muted"==e.local_stream_info(r),room_id:i.room_id,track_id:s.id});break;case"hold":t.callEventFromView({action:"hold",user_id:e.myself.user_id,onHold:e.hold&&-1!==e.hold.indexOf(i.room_id),room_id:i.room_id,sip:e.sip})}},local_stream_info({state:e,dispatch:t}){e.local_stream&&t("local_stream_changed",p(e.local_stream),{root:!0})},createOffer({dispatch:r},{pc:i}){i.makingOffer=!0,e.Call("CreateOffer"),i.createOffer(l).then(e=>i.setLocalDescription(e)).then(()=>{t.SDP({room_id:i.room_id,user_id:i.user_id,sdp:i.localDescription,isCaller:!0}),i.makingOffer=!1}).catch(s=>{e.error("failed to createOffer "+s),i.makingOffer=!1,r("track_event",{action:"webrtcIssue",dimensions:["createOffer",JSON.stringify(s),i.polite,i.signalingState,i.iceConnectionState]}),t.callEventFromView({action:"reporting",reason:s,room_id:i.room_id,pcStates:[i.polite,i.signalingState,i.iceConnectionState],step:"createOffer"})})},onAnswer({dispatch:r},{data:i,pc:s}){s.isSettingRemoteAnswerPending=!0,s.setRemoteDescription(new RTCSessionDescription(i.sdp)).then(()=>{e.Call("onAnswer setRemoteDescription success"),s.isSettingRemoteAnswerPending=!1}).catch(i=>{e.error("onAnswer failed "+i),s.isSettingRemoteAnswerPending=!1,r("track_event",{action:"webrtcIssue",dimensions:["onAnswer",JSON.stringify(i),s.polite,s.signalingState,s.iceConnectionState]}),t.callEventFromView({action:"reporting",reason:i,room_id:s.room_id,pcStates:[s.polite,s.signalingState,s.iceConnectionState],step:"onAnswer"})})},onOffer({dispatch:r,commit:i},{data:s,pc:a}){var n=!a.makingOffer&&("stable"==a.signalingState||a.isSettingRemoteAnswerPending);if(a.ignoreOffer=!a.polite&&!n,a.ignoreOffer)return e.Call("Ignoring SDP offer to avoid collision");a.setRemoteDescription(new RTCSessionDescription(s.sdp)).then(()=>(e.Call("onOffer setRemoteDescription success"),r("getLocalMedia",s))).then(()=>(e.Call("onOffer getLocalMedia resolved"),r("addLocalStream",a))).then(()=>(e.Call("onOffer localStream added"),a.createAnswer(l))).then(t=>(e.Call("onOffer answer created"),a.setLocalDescription(t))).then(()=>{e.Call("onOffer setLocalDescription success"),t.SDP({room_id:a.room_id,user_id:a.user_id,sdp:a.localDescription,isCaller:!1})}).catch(i=>{e.error("onOffer failed (polite  : "+a.polite+", iOSSafari: "+o+", signalingState : "+a.signalingState+"). Error: "+i),r("track_event",{action:"webrtcIssue",dimensions:["onOffer",JSON.stringify(i),a.polite,a.signalingState,a.iceConnectionState]}),t.callEventFromView({action:"reporting",reason:i,room_id:a.room_id,pcStates:[a.polite,a.signalingState,a.iceConnectionState],step:"onOffer"}),r("initRetryProcess",{pc:a})})},ontrack({dispatch:t,commit:r,getters:i},{data:s,pc:o}){var a=s.stream||s.streams[0],n=a.getVideoTracks();n&&i.speaker_id&&o.user_id==i.speaker_id&&1==n.length&&(n[0].contentHint="text",r("speaker",{user_id:o.user_id,speaker_track_id:n[0].id,kind:"screen"}));var l=p(a);e.Call("Track of "+o.user_id+" received "+JSON.stringify(l)),r("remote_stream",{stream:a,pc:o,info:l}),t("update_received_stream",{user_id:o.user_id,pc:o})},update_received_stream({dispatch:e,state:t},{user_id:r,pc:i}){var s=t.remote_streams[r];if(!s)return!0;var o=p(s);o.isAudio?e("received_track_audio",{user_id:i.user_id},{root:!0}):e("remove_track_audio",{user_id:i.user_id},{root:!0}),o.isVideo?e("received_track_video",{user_id:i.user_id},{root:!0}):e("remove_track_video",{user_id:i.user_id},{root:!0}),o.isScreen?e("received_track_screen",{user_id:i.user_id},{root:!0}):e("remove_track_screen",{user_id:i.user_id},{root:!0})},onicecandidate({},{data:r,pc:i}){if(!r.candidate)return e.Call("ignoring candidate "+JSON.stringify(r));t.webrtcIceCandidate({room_id:i.room_id,user_id:i.user_id,candidate:r.candidate})},oniceconnectionstatechange({getters:t},{data:r,pc:i}){e.Call("oniceconnectionstatechange : "+i.iceConnectionState),"failed"===i.iceConnectionState&&"function"==typeof i.restartIce&&i.restartIce(),"failed"===i.iceConnectionState||"disconnected"===i.iceConnectionState||"closed"===i.iceConnectionState||"connected"==i.iceConnectionState&&function(t,r){if(!t||!r)return e.error("updateSenderBandwidth bad params");if(!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters)return e.Call("updateSenderBandwidth no compatiblity");try{var i=t.getSenders();for(let e of i)e.track&&"video"==e.track.kind&&f(e,r)}catch(e){console.error(e)}}(i,t.bandwidth)},onsignalingstatechange({dispatch:t},{data:r,pc:i}){e.Call("onsignalingstatechange : "+i.signalingState),"stable"==i.signalingState&&t("update_received_stream",{user_id:i.user_id,pc:i})},onicegatheringstatechange({},{data:t,pc:r}){let i="Unknown";switch(r.iceGatheringState){case"new":case"complete":i="Idle";break;case"gathering":i="Determining route"}e.Call("ICE status : "+r.iceGatheringState)},SDP({dispatch:t,getters:r,commit:i},s){if(!s.sdp)return e.error("failed to find sdp in "+JSON.stringify(s));if(r.refusers.indexOf(s.user_id)>-1)return e.Call("SDP sender already left the call");var o=r.pc(s);if(!o){if(!r.accepted_room||s.room_id!=r.accepted_room.room_id)return e.Call("SDP received for another device");if(e.Call("SDP initP2P for mobile retrocompatibility"),i("accepter",s.user_id),t("initP2P",s),t("autoEndTimeoutOFF",{room_id:s.room_id}),!(o=r.pc(s)))return e.error("SDP failed to create pc "+JSON.stringify(s))}s.isCaller?t("onOffer",{data:s,pc:o}):t("onAnswer",{data:s,pc:o})},webrtcIceCandidate({getters:r,dispatch:i},s){if(!s.candidate)return e.Call("error no candidate in "+JSON.stringify(s));var o=r.pc(s);if(!o)return e.error("webrtcIceCandidate failed to find pc "+JSON.stringify(s));o.addIceCandidate(new RTCIceCandidate(s.candidate)).then(()=>{e.Call("addIceCandidate success")}).catch(r=>{o.ignoreOffer||(e.error("addIceCandidate failed "+r),i("track_event",{action:"webrtcIssue",dimensions:["webrtcIceCandidate",JSON.stringify(r),o.polite,o.signalingState,o.iceConnectionState]}),t.callEventFromView({action:"reporting",reason:r,room_id:o.room_id,pcStates:[o.polite,o.signalingState,o.iceConnectionState],step:"webrtcIceCandidate"}))})},activeTrack({state:e,dispatch:r,getters:i,commit:s},{kind:o,room_id:a}){s("activated",{kind:o}),i.local_track_of_kind(o)?r("muteTrack",{kind:o,room_id:a,unmute:!0}):r("getLocalMedia",{type:o,room_id:a}).then(()=>{for(let t in e.peer_connections)r("addLocalStream",e.peer_connections[t]);t.callEventFromView({type:o,action:"mute",muted:!1,room_id:a})}).catch(e=>{s("deactivated",{kind:o}),t.callEventFromView({action:"reporting",reason:e,room_id:a,step:"activeTrack"})}),i.sip&&r("activeStreamWebTel",{onHold:i.is_onhold_room(a)})},muteTrack({getters:e,dispatch:r,commit:i},{kind:s,room_id:o,unmute:a}){e.local_track_of_kind(s).enabled=!!a,r("local_stream_info"),"video"==s&&i("showSelfView"),t.callEventFromView({type:s,action:"mute",muted:!a,room_id:o}),e.sip&&r("muteStreamWebTel",{onHold:e.is_onhold_room(o)})},stopTrack({state:r,dispatch:i,commit:s,getters:o},{kind:a,room_id:n}){var l=o.local_track_of_kind(a);if(!l)return console.error("Can not find track of kind "+a);var d=l.id;e.Call("stopTrack "+a+" "+d);for(let e in r.peer_connections)i("removeLocalTrackFromPC",{pc:r.peer_connections[e],kind:a});s("stopLocalTrack",{kind:a}),i("local_stream_info"),s("deactivated",{kind:a}),t.callEventFromView({type:a,action:"stopTrack",track_id:d,room_id:n||o.accepted_room&&o.accepted_room.room_id})},restartAllP2P({dispatch:e,state:t}){for(let r in t.peer_connections)e("initRetryProcess",{pc:t.peer_connections[r]})},initRetryProcess({dispatch:r,getters:i,rootState:s},{pc:o}){if(e.Call("initRetryProcess with "+o.user_id),"number"==typeof o.p2pTentatives?o.p2pTentatives++:o.p2pTentatives=1,r("track_event",{action:"retryP2P",dimensions:"init",eventValue:o.p2pTentatives}),o.p2pTentatives>s.max_p2pTentatives)return e.Call("initRetryProcess aborted : reached max_p2pTentatives");t.callEventFromView({action:"restartP2P",user_id:i.myself.user_id,user_id_to:o.user_id,room_id:o.room_id,p2pTentatives:o.p2pTentatives})},restartP2P({rootState:r,dispatch:i,getters:s,commit:o},{user_id:a,room_id:n,p2pTentatives:l}){var d={user_id:a,room_id:n,webrtcConfig:r.webrtcConfig,p2pTentatives:l};e.Call("restartP2P asked by "+d.user_id),i("resetPC",d).then(()=>(o("polite",d),t.callEventFromView({action:"p2pRestarted",user_id:s.myself.user_id,user_id_to:d.user_id,room_id:d.room_id,p2pTentatives:l}))).catch(r=>{e.error("restartP2P failed "+r),t.callEventFromView({action:"reporting",reason:r,room_id:n,p2pTentatives:l,step:"restartP2P"})})},p2pRestarted({dispatch:r,rootState:i},{user_id:s,room_id:o,p2pTentatives:a}){var n={user_id:s,room_id:o,webrtcConfig:i.webrtcConfig,p2pTentatives:a};e.Call("p2pRestarted "+n.user_id),r("resetPC",n).then(()=>r("sendStream",{user_id:n.user_id,room_id:n.room_id})).catch(r=>{e.error("p2pRestarted failed "+r),t.callEventFromView({action:"reporting",reason:r,room_id:o,p2pTentatives:a,step:"p2pRestarted"})})},resetPC:({commit:e,dispatch:t},r)=>(e("remove_track_audio",{user_id:r.user_id}),e("remove_track_video",{user_id:r.user_id}),e("remove_track_screen",{user_id:r.user_id}),t("cleanP2P",r).then(()=>t("initP2P",r))),getStats:({state:e},{selector:t,allStats:r})=>new Promise((i,s)=>{var o=[],a=[];for(let r in e.peer_connections)o.push(e.peer_connections[r].getStats(t)),a.push(r);Promise.all(o).then(e=>{var t={},s=0;return e.forEach(e=>{t[a[s]]=[],e.forEach(e=>{("outbound-rtp"==e.type||"inbound-rtp"==e.type||r)&&t[a[s]].push(e)}),s++}),i(t)}).catch(s)})}}}),define("DS/InstantMessagingCall/components/UserCircleList/UserCircleList",["text!DS/InstantMessagingCall/components/UserCircleList/UserCircleList.html","DS/InstantMessagingCall/components/VideoMinimize/VideoMinimize"],function(e,t){"use strict";return{components:{"im-call-video-minimize":t},props:["users","myLogin","showSelfView"],computed:{},methods:{displaySelfView(){this.$store.commit("showSelfView")}},template:e}}),define("DS/InstantMessagingCall/store/modules/call",["DS/RTProxyDriver/RTLogger","DS/InstantMessagingCall/api/senders","DS/InstantMessagingCall/store/modules/users","DS/InstantMessagingCall/store/modules/p2p","DS/RTConvAPI/drivers/RTC_driver"],function(e,t,r,i,s){"use strict";const o={initial:"initial",invited:"invited",accepted:"accepted",ended:"ended"},a=()=>({callStatus:o.initial,rooms:{},room_id_accepted:null,room_id_invitations:[],room_id_hold:[],roomName:null,dmId:null,oldDmId:null,isVolumeOFF:!1,displayActionBar:!0,minimized:!1,date_start:0,showSelfView:!0,currentPanel:null,sip:!1,showInvite:!0,showDialer:!1,isHoldtoneON:!1,hideConvFeatures:!1,isPrivateConv:!1,isSwymConv:!1,isRTCActivated:!1});return{modules:{users:r,p2p:i},state:Object.assign({startMinimized:!1,timelineAvailable:!0,screenSharingAvailable:!0,confettiAvailable:!1},a()),getters:{screenSharingAvailable:e=>e.screenSharingAvailable,timelineAvailable:e=>e.timelineAvailable&&!e.hideConvFeatures,isInitial:e=>e.callStatus==o.initial,isAccepted:e=>e.callStatus==o.accepted,isInvited:e=>e.callStatus==o.invited,isEnded:e=>e.callStatus==o.ended,invitations:e=>e.room_id_invitations,room:e=>t=>e.rooms[t],accepted_room_id:e=>e.room_id_accepted,accepted_room:e=>e.rooms[e.room_id_accepted],is_accepted_room:e=>t=>!!e.room_id_accepted&&e.room_id_accepted==t,called_users_name:e=>t=>{var r=[];if(!e.rooms[t]||!e.rooms[t].calledUsers)return r;for(let i of e.rooms[t].calledUsers)r.push(i.username);return r},isVolumeOFF:e=>e.isVolumeOFF,displayActionBar:e=>e.displayActionBar,minimized:e=>e.minimized,date_start:e=>e.date_start,const_timeout_ms:e=>3e4,timeout_date_start:e=>t=>e.rooms[t].timeout_date_start,showSelfView:e=>e.showSelfView,currentPanel:e=>e.currentPanel,dmId:e=>(e.dmId||(e.dmId=e.accepted_room&&e.accepted_room.options&&e.accepted_room.options.dmId),e.dmId),oldDmId:e=>e.oldDmId,isPrivateConv:e=>e.isPrivateConv,isSwymConv:e=>e.isSwymConv,isRTCActivated:e=>e.isRTCActivated,sip:e=>e.sip,roomName:e=>t=>(e.roomName||(e.roomName=t.topic||t.options&&t.options.topic||t.orderId||t.options&&t.options.orderId),e.roomName),showInvite:e=>e.showInvite,showDialer:e=>e.showDialer,hideConvFeatures:e=>e.sip||e.hideConvFeatures,hold:e=>e.room_id_hold,is_onhold_room:e=>t=>e.room_id_hold&&e.room_id_hold.indexOf(t)>-1,isHoldtoneON:e=>e.isHoldtoneON,asDelegateOf:e=>t=>e.rooms[t].asDelegateOf,simringWith:e=>t=>e.rooms[t].simringWith},mutations:{resetCallState(e){Object.assign(e,a())},status(t,r){let i;if(r){if(!o[r])return e.Call("error callStatus unknown : "+r);i=o[r]}else switch(t.callStatus){case o.initial:i=o.invited;break;case o.invited:i=o.accepted;break;case o.accepted:i=o.ended;break;case o.ended:i=o.initial;break;default:i=o.initial}return i==t.callStatus||(i==o.invited&&t.callStatus!=o.initial&&t.callStatus!=o.ended||i==o.accepted&&t.callStatus!=o.invited||i==o.ended&&t.callStatus!=o.invited&&t.callStatus!=o.accepted?e.Call("Can not set "+i+" after "+t.callStatus):(i==o.accepted&&t.startMinimized&&(t.minimized=!0),i==o.accepted&&(t.date_start=Date.now()),e.Call("nextStatus: "+i),void(t.callStatus=i)))},room_accepted(e,t){e.room_id_accepted=t},room(e,t){e.rooms[t.room_id]?(e.rooms[t.room_id].asDelegateOf=t.asDelegateOf,e.rooms[t.room_id].simringWith=t.simringWith):e.rooms[t.room_id]=t},roomName(e,t){t.topic&&(e.rooms[t.room_id].topic=t.topic,e.roomName=t.topic),t.options&&t.options.topic&&(e.rooms[t.room_id].options.topic=t.options.topic,e.roomName=t.options.topic),t.orderId&&(e.rooms[t.room_id].orderId=t.orderId,e.roomName=t.orderId),t.options&&t.options.orderId&&(e.rooms[t.room_id].orderId=t.orderId,e.roomName=t.options.orderId)},dmId(e,{newDmId:t,room_id:r}){t&&t!=e.rooms[r].options.dmId&&(e.oldDmId=e.rooms[r].options.dmId,e.dmId=t,e.rooms[r].options.dmId=t)},invitation_del(e,t){let r=e.room_id_invitations.indexOf(t);-1!=r&&e.room_id_invitations.splice(r,1)},invitation_del_all(e){e.room_id_invitations.length=0},invitation(e,t){-1==e.room_id_invitations.indexOf(t)&&e.room_id_invitations.push(t)},volume:(e,t)=>{e.isVolumeOFF=!t},closeActionBar:e=>{e.displayActionBar=!1},openActionBar:e=>{e.displayActionBar=!0},minimize:(e,t)=>{e.minimized=t},timeout_started:(e,{room_id:t})=>{e.rooms[t].timeout_date_start=Date.now()},timeout_stopped:(e,{room_id:t})=>{e.rooms[t].timeout_date_start=0},showSelfView:e=>{e.showSelfView=!0},hideSelfView:e=>{e.showSelfView=!1},currentPanel:(e,t)=>{e.currentPanel=t},screenSharingAvailable:(e,t)=>{e.screenSharingAvailable=t},sipState:(e,t)=>{e.sip=!!(t&&t.options&&t.options.sip)&&!!t.options.sip},showInvite:e=>{e.showInvite=!0},hideInvite:e=>{e.showInvite=!1},showDialer:e=>{e.showDialer=!0},hideDialer:e=>{e.showDialer=!1},hideConvFeatures:(e,t)=>{e.hideConvFeatures=!t||!t.convId&&!t.dmId},hold:(e,t)=>{-1===e.room_id_hold.indexOf(t)&&e.room_id_hold.push(t)},resume:(e,t)=>{const r=e.room_id_hold.indexOf(t);r>-1&&e.room_id_hold.splice(r,1)},holdtoneON:(e,t)=>{e.isHoldtoneON=t},isPrivateConv:(e,t)=>{e.isPrivateConv=t},isSwymConv:(e,t)=>{const r=t.split(":").pop();e.isSwymConv=!/^[0-9]*$/.test(r)},isRTCActivated:(e,t)=>{e.isRTCActivated=t}},actions:{nextStatus({commit:e}){e("status")},endCurrentCall({dispatch:e,getters:t}){t.accepted_room&&e("endCall",t.accepted_room)},endCall({dispatch:r,getters:i},s){i.isAccepted&&(e.Call("Call Started Resumed before end"),r("resumeCall",s.room_id)),t.endCall({reason:"user_hangup",IamTheCaller:s.IamTheCaller,dontEndCallOnRoom:!1,room_id:s.room_id}),r("stopFeatures",{room_id:s.room_id}),r("autoEndTimeoutOFF",{room_id:s.room_id}),r("notifSW",{action:"endCall",data:{room_id:s.room_id}})},endAllInvitations({getters:e,dispatch:r}){for(let i of e.invitations)t.endCall({reason:"user_hangup",IamTheCaller:!1,dontEndCallOnRoom:!1,room_id:i}),r("autoEndTimeoutOFF",{room_id:i}),r("notifSW",{action:"endCall",data:{room_id:i}})},endCallMissed({dispatch:e},{room_id:r,IamTheCaller:i}){t.endCall({reason:i?"callTimeout":"callMissed",IamTheCaller:i,dontEndCallOnRoom:i,room_id:r}),e("notifSW",{action:"endCall",data:{room_id:r}})},endCallFailure({dispatch:e},{room_id:r,reason:i,IamTheCaller:s}){t.endCall({reason:i,IamTheCaller:s,dontEndCallOnRoom:!1,room_id:r}),e("autoEndTimeoutOFF",{room_id:r}),e("notifSW",{action:"endCall",data:{room_id:r}})},acceptCall({commit:e,getters:r,dispatch:i},{room_id:s,type:o,noNotif:a}){e("room_accepted",s),i("autoEndTimeoutOFF",{room_id:s}),e("status","accepted"),e("invitation_del",s),i("endAllInvitations");o=o||r.room(s).type;t.acceptCall({room_id:s,type:o,asDelegateOf:r.asDelegateOf(s),simringWith:r.simringWith(s)}),i("getLocalMedia",{type:null,user_id:r.myself.user_id}).catch(e=>{i("alert_getLocalMediaError",e),i("endCallFailure",{room_id:s,IamTheCaller:!1,reason:e})}),a||i("notifSW",{action:"acceptCall",data:{room_id:s}})},inviteSent({commit:e,dispatch:t,getters:r},i){if(t("startFocusListener"),e("status","invited"),i.IamTheCaller=!0,e("sipState",i),e("hideConvFeatures",i&&i.call),e("room",i),e("user",r.myself),t("tracking",{action:"inviteSent"}),t("isRTCActivated"),i.calledUsers)for(let t of i.calledUsers)e("user",t);r.accepted_room||(e("activated",{kind:i.type}),t("autoEndTimeoutON",{room_id:i.room_id,IamTheCaller:!0}),t("noises",{action:"startRingbacktone"})),i.options&&i.options.featureData&&t("invited_feature",{type:i.type,room_id:i.room_id,featureData:i.options.featureData}),e("room_accepted",i.room_id),e("invitation",i.room_id),e("constraints",i),t("getLocalMedia",i).catch(e=>{t("alert_getLocalMediaError",e),t("endCallFailure",{room_id:i.room_id,IamTheCaller:!0,reason:e})}),i.options&&i.options.isPrivateConv&&e("isPrivateConv",!0),i.options&&i.options.dmId&&e("isSwymConv",i.options.dmId)},inviteReceived({commit:r,state:i,getters:s,dispatch:o},a){if(o("isRTCActivated"),a.options&&a.options.isPrivateConv&&r("isPrivateConv",!0),a.options&&a.options.dmId&&r("isSwymConv",a.options.dmId),a.youHaveToAccept){if(a.room_id!=i.room_id_accepted)return e.Call("Invitation protocol error : while on "+i.room_id_accepted+", received invitation from "+a.login+" on "+a.room_id);r("user",a.user),r("accepter",a.user_id),a.room_id==s.accepted_room.room_id&&a.calledUsers&&s.called_users.length!=a.calledUsers.length&&r("called_users",{users:a.calledUsers}),o("initP2P",a),r("polite",a),o("sendStream",a),t.acceptCall({user_id:a.user_id,room_id:a.room_id,type:"audio",autoAccept:!0})}else if(s.isAccepted)e.Call("Invitation protocol error "+JSON.stringify(a));else{r("sipState",a),r("hideConvFeatures",a&&a.call),!0!==localStorage.getItem(a.room_id)&&(o("noises",{action:"startRingtone"}),localStorage.setItem(a.room_id,!0)),r("user",s.myself);for(let e of a.calledUsers)r("user",e),e.id===s.myself.user_id&&e.asDelegateOf&&(r("user",e.asDelegateOf),a.asDelegateOf=e);a.simringWith=a.calledUsers.filter(e=>e.asDelegateOf&&(e.asDelegateOf.id===s.myself.user_id||e.asDelegateOf===a.asDelegateOf)),"screen"==a.type&&(a.type="audio"),r("room",a),r("invitation",a.room_id),r("constraints",a),r("status","invited"),o("autoEndTimeoutON",{room_id:a.room_id,IamTheCaller:!1}),o("startFocusListener"),o("notifSW",{action:"inviteReceived",data:a})}},accepted({commit:r,state:i,dispatch:s,getters:o},a){if(!i.rooms[a.room_id])return e.Call("error room unknown "+a.room_id);if(i.room_id_accepted!=a.room_id&&a.user_id!=o.myself.user_id)return e.Call("someone else accepted the call and I still don't");if(s("noises",{action:"stopTones"}),e.Call("Someone joined the call "+a.user.login),r("invitation_del",a.room_id),r("user",a.user),s("autoEndTimeoutOFF",{room_id:a.room_id}),a.user_id!=o.myself.user_id)r("sipState",o.room(a.room_id)),s("noises",{action:"userIn"}),s("initP2P",a),r("status","accepted"),r("accepter",a.user_id),s("sendCurrentFeature"),a.autoAccepted?(e.Call("Another accepter's p2p is ready, send my stream"),s("sendStream",a)):(e.Call("Another user joined, tell him to start p2p with me"),(!a.clientDevice||!a.clientDevice.callVersion||a.clientDevice.platform&&"ios"==a.clientDevice.platform.toLowerCase())&&r("polite",a),t.startCall({login:a.user.login,alreadyStarted:!0,room_id:a.room_id}),s("tracking",{login:a.user.login,action:"accepted"}));else if(a.room_id==i.room_id_accepted){e.Call("I accepted the call on current device, initP2P with the caller (mobile retrocompat), waiting for other users to start P2P");var n=o.accepted_room.user.user_id;r("accepter",n),s("initP2P",Object.assign({},a,{user_id:n}))}else e.Call("I accepted the call on another device whereas I am in the room on current device"),o.invitations.length||r("status","initial"),s("notifSW",{action:"closeNotifRoomId",data:a})},cleanEverything({commit:e,dispatch:t},r){t("cleanAllP2P"),t("cleanTelephony"),e("status","ended"),e("resetUsersState"),e("resetP2PState"),e("resetFeatureState"),e("resetCallState"),r&&t("notifSW",{action:"endCall",data:{room_id:r}})},callEnded({commit:r,state:i,dispatch:s,getters:o},{room_id:a,user_id:n,login:l,reason:d}){var c=n==o.myself.user_id,u=o.room(a)&&o.room(a).user.user_id==n,m=o.room(a)&&o.room(a).IamTheCaller;return s("alert_callResumed"),s("tracking",{reason:d,login:l,action:"ended"}),s("noises",{action:"stopTones"}),localStorage.removeItem(a),a==i.room_id_accepted?(r("refuser",n),c?(e.Call("I left the call "+a),s("stopTracking",{dontSendSwymReport:!1}),s("cleanEverything",a)):(s("noises",{action:"userOut"}),o.called_users.length-1==o.refusers.length||u&&!o.accepters.length&&!m?(e.Call("I am the last one of the call "+a+(u?" and the caller left ":"")),t.endCall({reason:"user_hangup",IamTheCaller:m,dontEndCallOnRoom:!1,room_id:a}),s("stopTracking",{dontSendSwymReport:!1}),s("cleanEverything",a)):(s("cleanP2P",{room_id:a,user_id:n}),e.Call("Someone left the call "+a)))):(-1!=o.invitations.indexOf(a)&&(c||u?(e.Call((c?"I refused the invitation":"The caller stopped the invitation")+" on "+a),r("invitation_del",a),o.invitations.length||i.room_id_accepted||s("cleanEverything",a)):e.Call("Someone refused/left the call I am invited on "+a)),e.error("Received an unwanted endCall "+a))},volumeOFF({commit:e,getters:t,dispatch:r},i){e("volume",!i),t.isHoldtoneON&&r("noises",i?{action:"stopHoldtone"}:{action:"startHoldtone"})},holdCall({commit:r,getters:i,dispatch:s},o){e.Call("Call hold on "+o),s("alert_callOnHold"),r("hold",o),r("call_hold",{user_id:i.myself.user_id,onHold:!0}),t.callEventFromView({action:"hold",user_id:i.myself.user_id,onHold:!0,room_id:o,sip:i.sip}),s("volumeOFF",!0),s("muteTrack",{kind:"audio",room_id:o}),i.local_stream_info("video")&&s("muteTrack",{kind:"video",room_id:o}),i.local_stream_info("screen")&&"muted"!==i.local_stream_info("screen")&&s("stopTrack",{kind:"screen",room_id:o})},resumeCall({commit:r,getters:i,dispatch:s},o){e.Call("Call resumed on "+o),s("alert_callResumed"),r("resume",o),r("call_hold",{user_id:i.myself.user_id,onHold:!1}),t.callEventFromView({action:"hold",user_id:i.myself.user_id,onHold:!1,room_id:o,sip:i.sip}),s("volumeOFF",!1),s("activeTrack",{kind:"audio",room_id:o})},call_hold({commit:t,getters:r,dispatch:i},{room_id:s,user_id:o,onHold:a}){if(!r.user(o))return e.Call("User on hold doesn't exist.");if(t("call_hold",{user_id:o,onHold:a}),a){let e=r.accepters_except_myself.filter(e=>r.hasHoldCall(e));r.accepters_except_myself.length===e.length&&(t("holdtoneON",!0),r.isVolumeOFF||r.sip||i("noises",{action:"startHoldtone"}))}else t("holdtoneON",!1),i("noises",{action:"stopHoldtone"})},callEvent({commit:t,getters:r,dispatch:i},{room_id:s,action:o,type:a,user_id:n,track_id:l,muted:d,onHold:c,data:u,featureData:m,featureMembers:p,featureInfo:h,featureId:f,user_id_to:g,p2pTentatives:_,actions:v,users:S,topic:C,logins:b,options:k}){if(!r.isAccepted&&"notCallable"!=o&&"alreadyOnCall"!=o)return e.Call("ignoring callEvent "+o);switch(o){case"mute":t("stream_muted",{kind:a,user_id:n,muted:d});break;case"hold":i("call_hold",{room_id:s,user_id:n,onHold:c});break;case"speaker":t("call_speaker",{user_id:n,speaker_track_id:l,kind:a}),!r.currentFeature&&t("speaker",{user_id:n,speaker_track_id:l,kind:a});break;case"feature":h.featureData.reload&&n!=r.myself.user_id?(i("reloadFeatures",{kind:h.kind,reload:h.featureData.reload}),t("feature",h)):i("received_feature",{user_id:n,room_id:s,featureInfo:h});break;case"confetti":i("received_confetti",{user_id:n,room_id:s,featureData:m,featureId:f});break;case"3DPlayData":i("received_3DPlay_data",{user_id:n,room_id:s,featureData:m,featureId:f,actions:v});break;case"masterChanged":i("masterChanged",{user_id:n,featureId:f});break;case"featureEnded":i("featureEnded",{user_id:n,featureId:f});break;case"featureMembers":i("featureMembers",{user_id:n,featureId:f,featureMembers:p});break;case"stopTrack":t("track_stopped",{user_id:n,track_id:l,kind:a});break;case"notCallable":for(let e in u.uncallableUsers)i("callEnded",{login:u.uncallableUsers[e].login,user_id:u.uncallableUsers[e].user_id,room_id:s,reason:"Busy"});i("alert_uncallableUsers",{calledUsers:u.callableLogins,uncallableUsers:u.uncallableUsers});break;case"alreadyOnCall":i("alert_alreadyOnCall");break;case"addUserToCall":i("addCalledUsers",{room_id:s,users:S,logins:b,options:k,topic:C,user_id:n});break;case"restartP2P":r.is_accepted_room(s)&&g==r.myself.user_id?i("restartP2P",{room_id:s,user_id:n,p2pTentatives:_}):e.Call("ignore callEvent restartP2P from "+n+" to "+g);break;case"p2pRestarted":r.is_accepted_room(s)&&g==r.myself.user_id?i("p2pRestarted",{room_id:s,user_id:n,p2pTentatives:_}):e.Call("ignore callEvent p2pRestarted from "+n+" to "+g);break;default:e.Call("unknown callEvent "+o)}},received_track_video({commit:e,dispatch:t},{user_id:r,track_id:i}){e("received_track_video",{user_id:r,track_id:i}),t("tracking",{user_id:r,kind:"video",action:"stream"})},received_track_screen({commit:e,dispatch:t},{user_id:r}){e("received_track_screen",{user_id:r}),t("tracking",{user_id:r,kind:"screen",action:"stream"})},received_track_audio({commit:e,dispatch:t},{user_id:r,track_id:i}){e("received_track_audio",{user_id:r,track_id:i}),t("tracking",{user_id:r,kind:"audio",action:"stream"})},remove_track_screen({commit:e},{user_id:t}){e("remove_track_screen",{user_id:t})},remove_track_video({commit:e},{user_id:t}){e("remove_track_video",{user_id:t})},remove_track_audio({commit:e},{user_id:t}){e("remove_track_audio",{user_id:t})},local_stream_changed({commit:e,getters:t},r){r.isAudio&&e("received_track_audio",{user_id:t.myself.user_id,track_id:r.track_id_audio}),r.isVideo&&e("received_track_video",{user_id:t.myself.user_id,track_id:r.track_id_video}),r.isScreen?e("received_track_screen",{user_id:t.myself.user_id,track_id:r.track_id_screen}):(e("remove_track_screen",{user_id:t.myself.user_id}),e("track_stopped",{user_id:t.myself.user_id,track_id:r.track_id_screen,kind:"screen"})),e("local_stream_info",{kind:"audio",muted:r.isAudioMuted,loaded:r.isAudio,user_id:t.myself.user_id}),e("local_stream_info",{kind:"video",muted:r.isVideoMuted,loaded:r.isVideo,user_id:t.myself.user_id}),e("local_stream_info",{kind:"screen",muted:r.isScreenMuted,loaded:r.isScreen,user_id:t.myself.user_id})},autoEndTimeoutON({commit:e,getters:t,dispatch:r},{room_id:i,IamTheCaller:s}){t.room(i)&&!t.room(i).callMissed&&(e("timeout_started",{room_id:i}),t.room(i).callMissed=setTimeout(()=>{r("endCallMissed",{room_id:i,IamTheCaller:s})},3e4))},autoEndTimeoutOFF({commit:e,getters:t},{room_id:r}){e("timeout_stopped",{room_id:r}),clearTimeout(t.room(r).callMissed)},offlineStartCall({dispatch:e},t){e("offlineStartCallTracking",t),e("alert_connexionLost")},isRTCActivated({commit:e,getters:t}){s.getInstance(t.tenant).checkRTCActivation().then(t=>{e("isRTCActivated",t)})}}}}),define("DS/InstantMessagingCall/store/index",["vuejs","vuex","DS/InstantMessagingCall/store/modules/call","DS/InstantMessagingCall/store/modules/tracker","DS/InstantMessagingCall/store/modules/messages","DS/InstantMessagingCall/store/modules/noises","DS/InstantMessagingCall/store/modules/notifSW","DS/InstantMessagingCall/store/modules/feature","DS/InstantMessagingCall/store/modules/focus","DS/InstantMessagingCall/store/modules/usergroup","DS/InstantMessagingCall/store/modules/telephony","DS/RTProxyDriver/RTLogger","DS/InstantMessagingCall/api/senders"],function(e,t,r,i,s,o,a,n,l,d,c,u,m){"use strict";return u.addLevel("CallNotif","darkblue"),new t.Store({state:{tenant:"GLOBAL",webrtcConfig:null,user_id_myself:null,login_myself:null,username_myself:null,appName:null,rtcUrl:null,swymUrl:null,isConnected:!1,clientDevice:null,isIOS:!1,isMac:!1,isDesktopApp:!1,isOpera:!1,backgroundImage:!0,clickOnVideo:!1,selfViewInUserList:!0,assets_url:void 0,max_p2pTentatives:15,socketIdentifier:"",isElectedSocket:!1},modules:{call:r,tracker:i,messages:s,noises:o,notifSW:a,Feature:n,focus:l,usergroup:d,Telephony:c},getters:{rtcUrl:e=>e.rtcUrl,swymUrl:e=>e.swymUrl,tenant:e=>e.tenant,myself:e=>({user_id:e.user_id_myself,login:e.login_myself,username:e.username_myself}),isConnected:e=>e.isConnected,isIOS:e=>e.isIOS,isMac:e=>e.isMac,isDesktopApp:e=>e.isDesktopApp,isOpera:e=>e.isOpera,isDevEnv:e=>"devenv"==e.appName,selfViewInUserList:e=>e.selfViewInUserList,assets_url:e=>e.assets_url,backgroundImage:e=>e.backgroundImage,clickOnVideo:e=>e.clickOnVideo,isMobile:e=>e.isMobile,socketIdentifier:e=>e.socketIdentifier,isElectedSocket:e=>e.isElectedSocket},mutations:{tenant(e,t){e.tenant=t},user_id_myself(e,t){e.user_id_myself=t},login_myself(e,t){e.login_myself=t},username_myself(e,t){e.username_myself=t},webrtcConfig(e,t){e.webrtcConfig=t},appName(e,t){e.appName=t,"devenv"!=e.appName&&"3dprint"!=e.appName&&"ElectronCallWebview"!=e.appName||(e.call.timelineAvailable=!1),"devenv"==e.appName&&(e.call.confettiAvailable=!0),e.assets_url="devenv"==e.appName?"../../../InstantMessaging/InstantMessagingCall.mweb/src/assets/":window.dsDefaultWebappsBaseUrl+"InstantMessagingCall/assets/"},swymUrl(e,t){e.swymUrl=t},rtcUrl(e,t){e.rtcUrl=t},isConnected(e,t){e.isConnected=t},clientDevice(e,t){e.clientDevice=t},isIOS(e,t){e.isIOS=t},isMac(e,t){e.isMac=t},isDesktopApp:(e,t)=>{e.isDesktopApp=t},isOpera(e,t){e.isOpera=t},selfViewInUserList(e,t){e.selfViewInUserList=t},isMobile(e,t){e.isMobile=t},isElectedSocket(e,t){e.isElectedSocket=t}},actions:{connected({getters:e,commit:t,dispatch:r},{clientDevice:i,tenant:s,user_id_myself:o,login_myself:a,username_myself:n,appName:l}){r("alert_connexionRetrieved"),t("isConnected",!0),i&&r("clientDevice",i),s&&t("tenant",s),o&&t("user_id_myself",o),a&&t("login_myself",a),n&&t("username_myself",n),l&&t("appName",l),-1!==window.navigator.userAgent.indexOf("OPR")&&t("isOpera",!0),window&&window.ds&&"MOBILE"==window.ds.env&&t("isMobile",!0),r("notifSW",{action:"initSW"})},disconnected({commit:e}){e("isConnected",!1)},clientDevice({commit:e},t){e("clientDevice",t),void 0===t.ScreenSharingCompatible||t.ScreenSharingCompatible||e("screenSharingAvailable",!1),void 0!==t.isIOS&&e("isIOS",t.isIOS),void 0!==t.isMac&&e("isMac",t.isMac)},socketIdentifier(e,t){const{socketIdentifier:r}=t;e.socketIdentifier=r,m.sendSocketIdentifier(t)},isElectedSocket({commit:e},t){const{isElected:r}=t;e("isElectedSocket",r)}}})}),define("DS/InstantMessagingCall/components/PanelUsers/PanelUsers",["text!DS/InstantMessagingCall/components/PanelUsers/PanelUsers.html","DS/InstantMessagingCall/components/UserVideoList/UserVideoList","DS/InstantMessagingCall/components/UserCircleList/UserCircleList","DS/InstantMessagingCall/components/SelfView/SelfView"],function(e,t,r,i){"use strict";return{components:{"im-call-user-video-list":t,"im-call-user-circle-list":r,"im-call-self":i},props:["showSelfView","myLogin"],computed:{users(){return this.$store.getters.accepters.map(e=>this.$store.getters.user(e))},videoUserList(){return this.$store.getters.accepters.map(e=>this.$store.getters.user(e)).filter(e=>e.stream_info.isVideoStreamer&&!e.stream_info.isVideoStreamerMuted)},audioUserList(){return this.$store.getters.accepters.map(e=>this.$store.getters.user(e)).filter(e=>!e.stream_info.isVideoStreamer||e.stream_info.isVideoStreamerMuted)}},methods:{minimize(){this.$store.commit("showUserList",!1)}},template:e}}),define("DS/InstantMessagingCall/api/desktop/watchers",["DS/InstantMessagingCall/store/index","DS/PlatformAPI/PlatformAPI"],function(e,t){"use strict";const r=["invitation","invitation_del","room_accepted","status","minimize"],i=["inviteReceived","inviteSent","accepted","callEnded","cleanEverything"];var s;return{init:function(t){this.unsubscribe=e.subscribe(this.mutationsOccured,{prepend:!0}),this.unsubscribeAction=e.subscribeAction(this.actionsOccured,{prepend:!0}),s=t},destroy:function(){this.unsubscribe(),this.unsubscribeAction()},actionsOccured:function(e,r){-1!=i.indexOf(e.type)&&(console.log("To Electron : "+JSON.stringify(e)),t.publish(s,{data:e,state:{}}))},mutationsOccured:function(e,i){-1!=r.indexOf(e.type)&&(console.log("To Electron : "+JSON.stringify(e)),t.publish(s,e))}}}),define("DS/InstantMessagingCall/api/listeners_papi",["DS/InstantMessagingCall/store/index","DS/InstantMessagingCall/api/senders"],function(e,t){"use strict";const r={CONNECTED(t){e.dispatch("connected",{clientDevice:t.data.clientDevice,tenant:t.data.data.tenant,user_id_myself:t.data.user_id,login_myself:t.data.userId,username_myself:t.data.username,appName:t.data.appName})},startCall:r=>e.getters.isConnected?"screen"!=r.type||e.getters.screenSharingAvailable?(r.isJoinable||e.dispatch("startTracking",{logins:r.logins||r.login||r.phone,type:r.sip?"telephony":r.type,dmId:r.dmId}),e.dispatch("track_event",{action:r.isJoinable?"joinCall":"startCall",dimensions:[r.sip?"telephony":r.type,r.dmId||r.orderId],eventValue:(r.logins||[r.login]).length}),void t.startCall({login:r.login,logins:r.logins,username:r.username,type:r.type,rtconvEnable:r.rtconvEnable||!(!r.options||!r.options.rtconvEnable),options:{sip:r.sip||r.options&&r.options.sip,uri:r.uri||r.phone,orderId:r.orderId,topic:r.topic,callId:r.callId,dmId:r.subjectUri||r.dmId,dbConvId:r.subjectUri?r.dmId:r.dbConvId,swymUrl:r.swymUrl||r.options&&r.options.swymUrl,featureData:r.data}})):e.dispatch("alert_browserNotCompatible"):e.dispatch("offlineStartCall",r)};return e=>{if(e.evenement&&r[e.evenement]||e.action&&r[e.action])return r[e.evenement||e.action](e)}}),define("DS/InstantMessagingCall/api/listeners_server",["DS/InstantMessagingCall/store/index"],function(e){"use strict";const t=function(e){return Object.assign({},e,{room_id:e.room_id||e.room&&e.room.room_id||e.data&&e.data.room_id,user_id:e.user_id||e.user&&e.user.user_id,login:e.login||e.user&&e.user.login})},r=function(e){const t={};return e.forEach(e=>{t[e.userId]=e}),t},i=["inviteSent","inviteReceived","callEnded","webrtcIceCandidate","SDP","callEvent","disconnected","connectTelWS","search"],s={base_url:null,connected(t={}){this.base_url=t.options.url,e.dispatch("connected",{clientDevice:t.clientDevice,devEnv:t.options.devEnv,tenant:t.options.platformId,user_id_myself:t.user_id,login_myself:t.userId,username_myself:t.username,appName:t.appName})},callAccepted(r){e.commit("webrtcConfig",function(e,t){if(e.webrtcConfig&&e.webrtcConfig.iceServers)for(var r=0;r<e.webrtcConfig.iceServers.length;r++)e.webrtcConfig.iceServers[r].urls=e.webrtcConfig.iceServers[r].url.replace("REPLACEMEWITHRTCDNS:3478",t+"/coturn"),e.webrtcConfig.iceServers[r].url=e.webrtcConfig.iceServers[r].url.replace("REPLACEMEWITHRTCDNS:3478",t+"/coturn");return e.webrtcConfig}(r,this.base_url)),e.commit("forceTURN",r.forceTURN),e.dispatch("accepted",t(r))},getSocketIdentifier(t){e.dispatch("socketIdentifier",t)},isElectedSocket(t){e.dispatch("isElectedSocket",t)}};for(let o of i)s[o]=function(i){return function(s){"search"!=i?e.dispatch(i,t(s)):e.dispatch(i,r(s))}}(o);return s}),define("DS/InstantMessagingCall/components/LightboxContent/LightboxContent",["text!DS/InstantMessagingCall/components/LightboxContent/LightboxContent.html","DS/InstantMessagingCall/components/ActionBar/ActionBar","DS/InstantMessagingCall/components/UserList/UserList","DS/InstantMessagingCall/components/SelfView/SelfView","DS/InstantMessagingCall/components/UserItem/UserItem","DS/InstantMessagingCall/components/SpeakerName/SpeakerName","DS/InstantMessagingCall/components/Collab/Collab","DS/InstantMessagingCall/components/ActionBarItem/ActionBarItem","DS/InstantMessagingCall/components/VideoMinimize/VideoMinimize","DS/InstantMessagingCall/components/PanelUsers/PanelUsers","DS/RTConvAPI/drivers/Swym_driver"],function(e,t,r,i,s,o,a,n,l,d,c){"use strict";return{components:{"im-call-bar":t,"im-call-user-list":r,"im-call-self":i,"im-call-user-item":s,"im-call-speaker-name":o,"im-call-collaboration":a,"im-call-bar-item":n,"im-call-video-minimize":l,"im-call-panel-users":d},props:["room","isRightPanel","showUserList","userlist_at_top","showSelfView","backgroundImage","minimized"],data:function(){return{timeoutInterval:null,secondsLeftBeforeTimeout:0,timeoutMessageVisible:!1,swymDriver:c.getInstance(this.$store.getters.tenant)}},computed:{login_myself(){return this.$store.getters.myself.login},logins(){return this.$store.getters.logins_except_myself},speaker_id(){return this.$store.getters.speaker_id},feature_id(){return this.$store.getters.currentFeatureId},feature(){return!!this.feature_id&&this.$store.getters.feature(this.feature_id)},isODE(){return!!this.feature&&this.$store.getters.isODE(this.feature)},is3DPlay(){return!!this.feature&&this.$store.getters.is3DPlay(this.feature)},isWhiteboard(){return!!this.feature&&this.$store.getters.isWhiteboard(this.feature)},isConfetti(){return!!this.feature&&this.$store.getters.isConfetti(this.feature)},hasFeature(){return!!this.feature_id},hasSpeaker(){return!!this.speaker_id||!!this.feature_id},speaker_track_id(){return this.$store.getters.speaker_track_id},displayActionBar(){return this.$store.getters.displayActionBar},isDialerON(){return!!this.$store.getters.showDialer},isTelephonySupported(){return this.$store.getters.telephonyFeature}},methods:{toggleActionBar(){this.displayActionBar?this.$store.commit("closeActionBar"):this.$store.commit("openActionBar")},displaySelfView(){this.$store.commit("showSelfView"),this.$store.getters.selfViewInUserList&&this.displayUserList()},displayUserList(){this.$store.commit("showUserList",!0)},sendNbr(e){console.log("DIALER ",e)}},template:e}}),define("DS/InstantMessagingCall/api/desktop/listeners_papi",["DS/InstantMessagingCall/store/index"],function(e){"use strict";const t={},r=["setPresence","endCurrentCall","endCall","acceptCall"],i=["showInvite","hideInvite","minimize"];for(let r of i)t[r]=(t=>{e.commit(r,t)});for(let i of r)t[i]=(t=>{e.dispatch(i,t)});return e=>{if(e.evenement&&t[e.evenement]||e.action&&t[e.action])return console.log("From Electron : "+JSON.stringify(e)),t[e.evenement||e.action](e&&e.data)}}),define("DS/InstantMessagingCall/components/BaseLightbox/BaseLightbox",["text!DS/InstantMessagingCall/components/BaseLightbox/BaseLightbox.html","DS/InstantMessagingCall/components/LightboxContent/LightboxContent","DS/InstantMessagingCall/components/PanelMembers/PanelMembers","DS/InstantMessagingCall/components/PanelTimeline/PanelTimeline","DS/InstantMessagingCall/components/CustomType/CustomType"],function(e,t,r,i,s){"use strict";return{components:{"im-call-content":t,"im-call-members":r,"im-call-timeline":i,"im-call-type":s},data(){return{currentListPosition:"right",previousPanel:null,currentPanelComponent:null,sideActions:[{name:"minimize",fonticon:"resize-small",label:this.$store.getters.nls("minimize"),hidden:!1}],panel:{name:"right",show:!!this.currentPanel,fonticon:"users",showClose:!0,title:null}}},computed:{actions(){return{display_action_bar:{name:"display_action_bar",fonticon:"bottom-panel",label:this.$store.getters.nls("displayActionBar"),hidden:!0},members:{name:"members",fonticon:"users",label:this.$store.getters.nls("members")},timeline:{name:"timeline",fonticon:"chat-alt",label:this.$store.getters.nls("timeline"),hidden:!this.$store.getters.timelineAvailable},list_at_top:{name:"list_at_top",fonticon:"table-row-column",label:this.$store.getters.nls("displayListTop"),hidden:!0,isUserListAction:!0},list_at_right:{name:"list_at_right",fonticon:"table-row-column",label:this.$store.getters.nls("displayListRight"),hidden:!0,isUserListAction:!0},add_list:{name:"add_list",fonticon:"table-column-add ",label:this.$store.getters.nls("addList"),hidden:!0,isUserListAction:!0},remove_list:{name:"remove_list",fonticon:"table-column-delete",label:this.$store.getters.nls("removeList"),hidden:!0,isUserListAction:!0},remove_list_from_top:{name:"remove_list",fonticon:"table-row-delete",label:this.$store.getters.nls("removeListTop"),hidden:!0,isUserListAction:!0},add_list_at_top:{name:"add_list_at_top",fonticon:"table-row-add",label:this.$store.getters.nls("addListTop"),hidden:!0,isUserListAction:!0}}},hasSpeaker(){var e=!!this.$store.getters.speaker_id;return e||this.displayUserList(),e},backgroundImage(){return this.$store.getters.backgroundImage},actions_array(){var e=[];for(let t in this.actions)e.push(this.actions[t]);return e},room(){return this.$store.getters.accepted_room},showUserList(){return this.$store.getters.showUserList},showSelfView(){return this.$store.getters.showSelfView},labelArray(){return this.room&&this.$store.getters.roomName(this.room)?[this.$store.getters.roomName(this.room)]:this.room&&this.$store.getters.called_users_name(this.room.room_id)||this.$store.getters.accepters_name},displayActionBar(){return this.$store.getters.displayActionBar},minimized(){return this.$store.getters.minimized},logins(){return this.$store.getters.logins_except_myself},currentPanel(){var e=this.$store.getters.currentPanel;return e?(this.previousPanel&&e!=this.previousPanel&&(this.actions[this.previousPanel].selected=!1),this.actions[e].selected=!0,this.previousPanel=e,this.panel.show=!0,this.panel.title=this.$store.getters.nls(e),this.currentPanelComponent="im-call-"+e):(this.panel.show=!1,this.currentPanelComponent=null,this.previousPanel&&(this.actions[this.previousPanel].selected=!1),this.previousPanel=null),e}},methods:{endCall(){this.room&&this.$store.dispatch("endCall",this.room),this.track_event("close")},confirmEndCall(){return this.$confirm(this.$store.getters.nls("confirmEndCall"),this.$store.getters.nls("refuseCall"),{okLabel:this.$store.getters.nls("confirm"),cancelLabel:this.$store.getters.nls("cancel")})},beforeWindowUnload(){this.endCall()},closePanel(){this.$store.commit("currentPanel",null)},togglePanel(e){var t=e==this.previousPanel?null:e;this.$store.commit("currentPanel",t),t&&this.track_event(["togglePanel",e],1)},removeUserListAction(){for(let e in this.actions)this.actions[e].isUserListAction&&(this.actions[e].hidden=!0);return!0},addUserListAction(e){return this.removeUserListAction(),this.actions[e].hidden=!1,!0},userListAction(e){switch(e){case"add_list_at_top":this.displayUserList(),this.currentListPosition="top";break;case"remove_list":case"remove_list_from_top":this.hideUserList(),this.currentListPosition="hidden";break;case"add_list":this.displayUserList(),this.currentListPosition="right";break;case"list_at_top":this.currentListPosition="top";break;default:this.removeUserListAction(),this.displayUserList()}},hideUserList(){this.$store.commit("showUserList",!1)},displayUserList(){this.$store.commit("showUserList",!0)},chooseUserAction(e){e?this.showUserList?this.currentPanel?"right"==this.currentListPosition&&this.addUserListAction("remove_list")||this.addUserListAction("remove_list_from_top"):"right"==this.currentListPosition||"hidden"==this.currentListPosition?this.addUserListAction("list_at_top"):this.addUserListAction("remove_list_from_top"):!this.currentPanel&&this.addUserListAction("add_list")||this.addUserListAction("add_list_at_top"):this.removeUserListAction()},openActionBar(){this.$store.commit("openActionBar")},minimize(e,t){this.$store.commit("minimize",e),this.track_event("minimize",1)},track_event(e,t){this.$store.dispatch("track_event",{action:"topBar",dimensions:e,eventValue:t})}},created(){window.addEventListener("beforeunload",this.beforeWindowUnload)},beforeDestroy(){window.removeEventListener("beforeunload",this.beforeWindowUnload)},template:e}}),define("DS/InstantMessagingCall/api/desktop/interface",["DS/InstantMessagingCall/api/desktop/listeners_papi","DS/InstantMessagingCall/api/desktop/watchers","DS/InstantMessagingCall/store/index","DS/PlatformAPI/PlatformAPI"],function(e,t,r,i){"use strict";return{init:function(s){return r.commit("hideInvite"),i.subscribe("fromDesktopApp.ds.com",e),t.init("toDesktopApp.ds.com"),this}}}),define("DS/InstantMessagingCall/components/Base/Base",["text!DS/InstantMessagingCall/components/Base/Base.html","DS/InstantMessagingCall/components/BaseLightbox/BaseLightbox","DS/InstantMessagingCall/components/InvitationList/InvitationList"],function(e,t,r){"use strict";return{components:{"im-call-base-lightbox":t,"im-call-base-invite":r},computed:{bodyAlerts(){return this.$store.getters.bodyAlerts},isEnded(){return this.$store.getters.isEnded},isInvited(){return this.$store.getters.isInvited},isAccepted(){return this.$store.getters.isAccepted},showInvite(){return this.$store.getters.showInvite},currentBaseComponent(){return this.isAccepted&&(this.$store.getters.minimized?"im-call-base-minimized":"im-call-base-lightbox")||this.isInvited&&"im-call-base-invite"}},template:e}}),define("DS/InstantMessagingCall/api/interface",["DS/RTProxyDriver/RTProxyDriver","DS/InstantMessagingCall/api/listeners_server","DS/InstantMessagingCall/api/listeners_papi","DS/InstantMessagingCall/api/senders","DS/PlatformAPI/PlatformAPI","DS/InstantMessagingCall/store/index","DS/InstantMessagingCall/api/desktop/interface"],function(e,t,r,i,s,o,a){"use strict";return{audiovideoV2:!1,init:function(i){return this.audiovideoV2=i.audiovideoV2,this.PlatformAPI=s,t.base_url=i.base_url,e.addEvent("CONNECTED",t.connected),e.addEvent("DISCONNECTED",t.disconnected),e.addEvent("inviteSent",t.inviteSent),e.addEvent("inviteToCall",t.inviteReceived),e.addEvent("callAccepted",t.callAccepted),e.addEvent("callEnded",t.callEnded),e.addEvent("webrtcIceCandidateReceived",t.webrtcIceCandidate),e.addEvent("SDPreceived",t.SDP),e.addEvent("callEvent",t.callEvent),e.addEvent("connectTelWS",t.connectTelWS),e.addEvent("getSocketIdentifier",t.getSocketIdentifier),e.addEvent("isElectedSocket",t.isElectedSocket),e.addEvent(e.eventName.RESULTOFSEARCH,t.search),s.subscribe("towidgetim.ds.com",r),s.subscribe("im.ds.com",r),(o.getters.isDesktopApp||o.getters.isDevEnv)&&a.init(),s.publish("fromwidgetim.ds.com",{evenement:"GETLOGINOKDATA"}),this}}}),define("DS/InstantMessagingCall/main",["DS/RTProxyDriver/RTLogger","vuejs","DS/InstantMessagingCall/components/Base/Base","DS/InstantMessagingCall/store/index","DS/InstantMessagingCall/api/interface","css!DS/InstantMessagingCall/InstantMessagingCall.css"],function(e,t,r,i,s){"use strict";e.addLevel("Call","purple"),e.Call("InstantMessagingCall load 10/2023 24xFD01 service 3.4.1");const o={divID:"vue-im-call",addDiv:function(t){return document.getElementById(this.divID)?e.Call("InstantMessagingCall div already injected"):t?(this.divCall=document.createElement("div"),this.divCall.id=this.divID,void t.appendChild(this.divCall)):e.Call("InstantMessagingCall needs a div container")},initVm:function(s={}){if(this.vmCall)return e.Call("InstantMessagingCall initVm already done");this.vmCall=new t({el:"#"+this.divID,data:()=>s,components:{"im-call-base":r},store:i,template:"<im-call-base id="+this.divID+" />"})},initTransport:function(e){this.interface=s.init(e)},initStore:function(e){i.commit("tenant",e.platformId),i.commit("appName",e.appName),i.commit("swymUrl",e.swymUrl),i.dispatch("preloadNoises"),i.dispatch("getCollaborationFeatures")}};return{init:function(e){return o.initStore(e),o.addDiv(e.callContainer||document.body),o.initVm(e),o.initTransport(e),document.IMCall=document.IMCall||o,document.IMCall}}});