define("DS/ShareWidget/ShareModel",["UWA/Controls/Abstract"],function(e){return e.extend({init:function(e){this._RightList=[],this._DataList=[],this._ObjectId=e,this._ownerId="",this._projId="",this._orgId="",this._userGrpId="",this._objectType=""},setPOV:function(e,t,a,n){this._ownerId=e,this._projId=t,this._orgId=a,this._userGrpId=n},getObjectType:function(){return this._objectType},setRightList:function(e){this._RightList=e},setObjectType:function(e){this._objectType=e},getRightList:function(){return this._RightList},getDataList:function(){return this._DataList},getObjectId:function(){return this._ObjectId}})}),define("DS/ShareWidget/ShareController",["UWA/Controls/Abstract","UWA/Json","DS/ShareWidget/ShareModel","DS/WidgetServices/WidgetServices","DS/WidgetServices/CollabPerfTimer","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","i18n!DS/ShareWidget/assets/nls/langAR"],function(e,t,a,n,i,r,o,s){var c=n.getProdLevel();return e.extend({defaultOptions:{uniqueRightList:!1,wintop:!1,serverName:"",serverUri:"",isReadOnly:!1,odtMode:!1,parent:null},init:function(e,t){c=n.getProdLevel(),this.widget=e,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1,this._options=t,this._parent(t),this.accessLogicalNlsMap={},this.listOfValidIDs=[],this.listOfInvalidIDs=[],this.InvalidSelectedItemsMap=JSON.parse("[]"),this.LifecycleConfidentialityEnabled=!1,this._perfTimer=i,this.widgetSecurityContext="";var a="";if(null!=e)if(e.hasOwnProperty("pad_security_ctx"))0!=(a=e.pad_security_ctx).indexOf("ctx::")&&(a="ctx::"+a);else if("function"==typeof e.hasPreference&&null!=e.getPreference("pad_security_ctx"))a=e.getPreference("pad_security_ctx").value;else if("function"==typeof e.hasPreference&&e.hasPreference("xPref_CREDENTIAL")){var r=e.getPreference("xPref_CREDENTIAL");void 0!==r.value&&null!==r.value&&r.hasOwnProperty("value")&&(a="ctx::"+r.value)}else"function"==typeof e.hasPreference&&null!=e.getPreference("securityContext")&&(a=e.getPreference("securityContext").value);this.widgetSecurityContext=a},getRightList:function(e){var t=[];return 1==this.options.uniqueRightList?this.AccessRightModelList.length>0&&(t=this.AccessRightModelList[0].getRightList()):this.AccessRightModelList.every(function(a){return a.getObjectId()!=e||(t=a.getRightList(),!1)}),t},getFormattedRightList:function(e){var t=this.getRightList(e),a=[];return t.forEach(function(e,t){var n={label:e.nls,value:e.logical};a.push(n)}),a},getOwnership:function(e){var t=[];return this.AccessRightModelList.every(function(a){return a.getObjectId()!=e||(t=a.getDataList(),!1)}),t},isInherited:function(e,t){var a=this.getOwnershipFromOwner(e,t),n=!1;return null!=a&&a.hasOwnProperty("inheritedPath")&&a.inheritedPath.length>0&&(n=!0),n},getOwnershipFromOwner:function(e,t){this.getOwnership(e);return null},_accessListContainsAccess:function(e,t){var a=!1;0==e.length&&(a=!0);for(var n=0;n<e.length;n++)if(e[n].logical==t.logical){a=!0;break}return a},_accessListSame:function(e,t){if(returnedValue=!0,e.length!=t.length)returnedValue=!1;else{var a=t.slice(),n=!0;e.every(function(e){var t=!1;return a.every(function(n,i){return e.logical!=n.logical||(t=!0,a.splice(i,1),!1)}),0!=t||(n=!1,!1)}),0==n&&(returnedValue=!1)}return returnedValue},onLoad:function(){this.AccessRightModelList=[],this.widget=widget,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1},getCurrentSelectedItems:function(){var e=[];return this.AccessRightModelList.forEach(function(t){e.push({objectID:t.getObjectId()})}),e},_getModel:function(e){for(var t=0;t<this.AccessRightModelList.length;t++){var n=this.AccessRightModelList[t];if(n.getObjectId()==e)return n}var i=new a(e);return this.AccessRightModelList.push(i),i},flatten:function(e){var t=this;return e.reduce(function(e,a){return e.concat(Array.isArray(a)?t.flatten(a):a)},[])},parseResponse:function(e){let t=[];if(!UWA.is(e.collabspaces,"array"))return t;let a=[...new Set(this.flatten(e.collabspaces.map(e=>e.couples.map(e=>e.organization.name))))].length>1;return e.collabspaces.forEach(e=>{e.couples.forEach(n=>{var i=null==n.role.nls||""==n.role.nls?n.role.name:n.role.nls,r=n.role.name,o=n.organization.name,s=n.organization.title,c=e.name,l=e.title?e.title:e.name;let d=a?l+" ● "+s+" ● "+i:l+" ● "+i,h="ctx::"+r+"."+o+"."+c;t.push({displayName:d,ctx:h})})}),t.sort((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"}))},_createFilterPayload:function(e,t){let a={Command:t,SecurityContexts:e.map(e=>e.ctx)};return JSON.stringify(a)},isAdminCred:function(e){let t=e.match(/(ctx::)([^.]+)/);return t.length>2&&"VPLMAdmin"===t[2]},adminFilterPatch:function(e){var t=this;return e.filter(e=>!t.isAdminCred(e))},filterCredentials:function(e,t,a,n,i){var r=this,o=r._createFilterPayload(t,a);r._perfTimer.start("Share: filterValidSCs"),this._post3("/resources/lifecycle/util/filterValidSCs",o,function(e){r._perfTimer.stop("Share: filterValidSCs"),e.status&&"success"===e.status&&n(r.adminFilterPatch(e.data))},function(e){r._perfTimer.stop("Share: filterValidSCs"),i(e)})},_loadCredentials:function(e,t,a){var n=this;n._perfTimer.start("Share: person"),this._get("/resources/modeler/pno/person",{current:"true",select:"collabspaces&select=preferredcredentials"},function(e){n._perfTimer.stop("Share: person"),t(n.parseResponse(e))},function(e){n._perfTimer.stop("Share: person"),a(e)})},_fillAttributesOfSelectedItems:function(e,t,a){for(var n=this,i=[],r=e.length,o=[],s=[],c=0;c<r;c++){var l="";null!=e[c].type&&(l=e[c].type),null==e[c].type&&null!=e[c].typeDisplayName&&(l=e[c].typeDisplayName),o.push(l),s.push(e[c].physicalId)}for(var d=s.length,h=0;h<d;h++){var p=s[h];i.push({objectID:p,type:o[h]})}var m=i;n._perfTimer.start("Share: isTypeSupportedToCommand"),this._post2("/resources/accessRightServices/ar/isTypeSupportedToCommand",m,function(e,a){n._perfTimer.stop("Share: isTypeSupportedToCommand"),t(e,a)},function(e){a(e)})},_setValidInvalidIdList(e,t){if(this.listOfValidIDs=e,0==this.listOfInvalidIDs.length)this.listOfInvalidIDs=t;else{this.listOfInvalidIDs.concat(t),this.listOfInvalidIDs=this.listOfInvalidIDs.filter((e,t,a)=>t===a.findIndex(t=>t===e))}},_fillModels:function(e){for(var t=this,a=e.length,n=0;n<a;n++){var i=e[n];if(null!==i){var r=t._getModel(i.physicalId);null!=r&&(t.IdToECMap[i.physicalId]=i.v_IsEmbeddedComponent,t.SelectedItemsMap[i.physicalId]=i,t.SelectedItemsTypeMap[i.type]=i,r.setPOV(i.owner+"_PRJ",i.project,i.organization),r.setObjectType(i.type))}}if(t.SelectedItems=e.splice(0),0==t._bInitDatas){var o=[];t._bInitDatas=!0,t.AccessRightModelList.forEach(function(e){t.NonEmbeddedComponentList.push(e.getObjectId()),o.push({objectID:e.getObjectId()})}),t._getAccessListForIds(o)}},_getSecurityContext:function(e,t){var a=this;o.getInstance().getSecurityContext({onSuccess:function(t){var n="";null!=t&&null!=t.SecurityContext&&0!=(n=t.SecurityContext).indexOf("ctx::")&&(n="ctx::"+n),""!=a.widgetSecurityContext?e(a.widgetSecurityContext):e(n)},onFailure:function(n){""!=a.widgetSecurityContext?e(a.widgetSecurityContext):t(n)}})},_post2:function(e,a,i,r){var o=this;datasString=t.encode({requests:a}),this._getSecurityContext(function(t){n.get3DSpaceUrlAsync({onComplete:function(a){var c=a+e,l={Accept:"application/json","Content-Type":"application/json"};l.SecurityContext=encodeURIComponent(t),l["Accept-Language"]=widget.lang;var d=n.getTenantID();d&&0!=d.length?c+="?tenant="+d:c+="?tenant=OnPremise",n.partitionedAuthenticatedRequest(c,{method:"POST",headers:l,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:s.get(""),progressBarContext:o.options.contextArea1,progressBarWaitContext:o.options.progressBarWaitContext,data:datasString,type:"json",onComplete:function(e){i(e,a)},onFailure:function(e){r(e)},onTimeout:function(){r("timeout")}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})},function(e){r(e)})},_post3:function(e,t,a,i){var r=this;this._getSecurityContext(function(o){n.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(o);var h=n.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",n.partitionedAuthenticatedRequest(l,{method:"POST",headers:d,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:s.get(""),progressBarContext:r.options.contextArea1,progressBarWaitContext:r.options.progressBarWaitContext,data:t,type:"json",onComplete:function(e){a(e)},onFailure:function(e){i(e)},onTimeout:function(){i("timeout")}})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})},function(e){i(e)})},_get:function(e,t,a,i){var o=this;this._getSecurityContext(function(i){n.get3DSpaceUrlAsync({onComplete:function(s){var l=s+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(i);var h=n.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",t.hasOwnProperty("current")&&t.hasOwnProperty("select")&&(l+="&current="+t.current+"&select="+t.select);var p="";2==c&&(p="passport"),r.authenticatedRequest(l,{type:"json",method:"GET",headers:d,proxy:p,data:"",onComplete:function(e){a(e)},onFailure:function(e,t,a){o._onFailureAvailability(e,t,a)},onTimeout:function(){o._onTimeoutAvailability(items)}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})},function(e){i(e)})},_onFailure2:function(e){this.dispatchEvent("onError2",e)},_onFailure:function(e,t,a){var n={};n=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.dispatchEvent("onError",n)},_onTimeout:function(){var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.dispatchEvent("onError",e)},_getAccessListForIds:function(e){var a=this,i=[];if(null!=a.SelectedItemsTypeMap){Object.keys(a.SelectedItemsTypeMap).map(function(e){return a.SelectedItemsTypeMap[e]}).forEach(function(e){null!=e&&i.push({objectID:e.physicalId})})}this.options.serverName,this.options.serverUri;this._getSecurityContext(function(r){n.get3DSpaceUrlAsync({onComplete:function(o){var l="",d=n.getRealPath("assets/dataRightList.json",a.widget),h="GET",p="";2==c&&(p="passport");var m="";2==c&&(l='{ "businessObject": '+t.encode(i)+"}",a.options.hasOwnProperty("odtmode")&&a.options.odtmode?(d=o+"/resources/pno/ownership/logicalaccess",m="Share: pno logicalaccess"):i.length>0&&0===i[0].objectID.indexOf("cid:")?(d=o+"/resources/lifecycle/ownership/logicalaccess",m="Share: lifecycle logicalaccess"):(d=o+"/resources/pno/ownership/logicalaccess",m="Share: pno logicalaccess"),h="POST"),headers={Accept:"application/json"},headers["Content-Type"]="application/json",headers["Accept-Language"]=widget.lang,headers.SecurityContext=encodeURIComponent(r),a.RightList=[];var u=n.getTenantID();u&&0!=u.length?d+="?tenant="+u:d+="?tenant=OnPremise",a._perfTimer.start(m),n.partitionedAuthenticatedRequest(d,{type:"json",method:h,headers:headers,proxy:p,cancelCallback:function(){return!1},partisionedProgressLabel:s.get(""),progressBarContext:a.options.contextArea1,progressBarWaitContext:a.options.progressBarWaitContext,data:l,timeout:864e5,onComplete:function(t){a._perfTimer.stop(m),a._onCompleteGetAccessListForIds(t,e)},onFailure:function(e,t,n){a._perfTimer.stop(m),a._onFailure(e,t,n)},onTimeout:function(){a._perfTimer.stop(m),a._onTimeout()}})},serverUrl:a.options.serverUrl,wintop:a.options.wintop})},function(e){onError(e)})},_onCompleteGetAccessListForIds:function(e,t){var a=this,n=e.accessList,i=null,r=[],o=-1,s=-1;n.every(function(e,t){e.access.forEach(function(e){a.accessLogicalNlsMap[e.logical]=e.nls});var n=e.objectID,c=a.SelectedItemsMap[n],l=null;if(null!=c&&(l=c.type),a.AccessRightModelList.every(function(t,a){return s=a,t.getObjectType()!=l||(t.setRightList(e.access),itemFound=!0,!1)}),3==e.access.length&&a.LifecycleConfidentialityEnabled?(a._options.parent.container.parentElement.getParent().getParent().getParent().setStyle("height","400px"),a._options.parent.container.parentElement.setStyle("height","72.5%")):e.access.length>3&&(a._options.parent.container.parentElement.getParent().getParent().getParent().setStyle("height","450px"),a._options.parent.container.parentElement.setStyle("height","76%")),1==itemFound&&1==a.options.uniqueRightList){var d=!0;if(0==a.AccessRightModelList.length&&t>0&&o>=0?d=a._accessListSame(r[o].getRightList(),e.access):a.AccessRightModelList.length>0&&(d=a._accessListSame(a.AccessRightModelList[0].getRightList(),e.access)),0==d){for(var h=!0,p={logical:"Reader",nls:"Can Read"},m={logical:"Read",nls:"Read"},u=a._accessListContainsAccess(a.AccessRightModelList[0].getRightList(),p),g=a._accessListContainsAccess(a.AccessRightModelList[0].getRightList(),m),S=0;S<a.AccessRightModelList.length;S++)u?0==a._accessListContainsAccess(a.AccessRightModelList[S].getRightList(),p)&&(h=!1):g&&0==a._accessListContainsAccess(a.AccessRightModelList[S].getRightList(),m)&&(h=!1);return i={message:UWA.i18n("ErrorDismatchAccessList"),code:""},h?a.dispatchEvent("onWarning",i):a.dispatchEvent("onError",i),a.dispatchEvent("onDataLoaded"),!1}o=s}return a.dispatchEvent("onDataLoaded"),!0})},modifyDataWithSC:function(e,a,i){var r=this,o={Accept:"application/json","Content-Type":"application/json"};if(null!=i&&""!=i&&i.hasOwnProperty("SecurityContext")){0!=i.SecurityContext.indexOf("ctx::")&&"ctx::",o.SecurityContext=encodeURIComponent(i.SecurityContext);var s=r.getAggrItemList();if(e.length>0&&null!=s){var l=[],d=Object.keys(s);e.length>0&&d.forEach(function(t){var a={objectID:t,ownership:e[0].ownership};l.push(a),e.push(a)})}this.options.serverName,this.options.serverUri;for(var h=[],p=0;p<a.length;p++)h.indexOf(a[p])<0&&h.push(a[p]);n.get3DSpaceUrlAsync({onComplete:function(a){var s="POST",l="",d=n.getRealPath("assets/validModification.json",r.widget),p=t.encode({requests:h});2==c&&(l="passport");2==c&&(d=a+"/resources/accessRightServices/ar/getCompletedData",s="POST"),o["Accept-Language"]=widget.lang;var m=n.getTenantID();m&&0!=m.length?d+="?tenant="+m:d+="?tenant=OnPremise",r._perfTimer.start("Share: getCompletedData"),n.partitionedAuthenticatedRequest(d,{type:"json",method:s,proxy:l,headers:o,cancelCallback:function(){return!1},data:p,timeout:36e5,onComplete:function(t){r._perfTimer.stop("Share: getCompletedData");for(var a=0;a<t.results.length;a++)if(null!=t.results[a].invalidList&&t.results[a].invalidList.length>0){t.results[a].invalidList.forEach(function(t){void 0!==r.SelectedItemsMap[t]&&null!==r.SelectedItemsMap[t]&&(r.ErrorExistingECAndAggrItemsMap[t]=r.SelectedItemsMap[t]);for(var a=0;a<e.length;a++)e[a].objectID===t&&e.splice(a,1)})}else if(null!=t.results[a].validList&&t.results[a].validList.length>0){var n=[];n=t.results[a].validList,expandedOwnershipItems=[],n.forEach(function(t){null!=r.SelectedItemsMap[t]&&null!==r.SelectedItemsMap[t]||null!=r.AggrItemsMap[t]&&null!==r.AggrItemsMap[t]||e.length>0&&expandedOwnershipItems.push({objectID:t,ownership:e[0].ownership})}),expandedOwnershipItems.forEach(function(t){e.push(t)})}e.length<1?r._onFailure2(UWA.i18n("ShareNotValid")):r.getAndAddAggregatedItemsForUpdate(e,i)},onFailure:function(e,t,a){r._perfTimer.stop("Share: getCompletedData"),r._onFailure(e,t,a),r._perfTimer.stop("CommandExecutionDurationShare"),r._perfTimer.printTime("CommandUIDurationShare"),r._perfTimer.printTime("CommandExecutionDurationShare"),r._perfTimer.printTime("Share: getCompletedData")},onTimeout:function(){r._perfTimer.stop("Share: getCompletedData"),r._onTimeout(),r._perfTimer.stop("CommandExecutionDurationShare"),r._perfTimer.printTime("CommandUIDurationShare"),r._perfTimer.printTime("CommandExecutionDurationShare"),r._perfTimer.printTime("Share: getCompletedData")}})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})}else{var m={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};r.dispatchEvent("onError",m)}},getAndAddAggregatedItemsForUpdate:function(e,t){this.commitWithSCPCS(e,t)},commitWithSCPCS:function(e,a){var i=this,r={Accept:"application/json","Content-Type":"application/json"};if(null!=a&&""!=a&&a.hasOwnProperty("SecurityContext")){0!=a.SecurityContext.indexOf("ctx::")&&"ctx::",r.SecurityContext=encodeURIComponent(a.SecurityContext);this.options.serverName,this.options.serverUri;this._getSecurityContext(function(a){n.get3DSpaceUrlAsync({onComplete:function(o){var s="",l=n.getRealPath("assets/validModification.json",i.widget),d="Share: pno update";2==c&&(s="passport"),2==c&&(i.options.hasOwnProperty("odtmode")&&i.options.odtmode?l=o+"/resources/pno/ownership/update":e.length>0&&0===e[0].objectID.indexOf("cid:")?(l=o+"/resources/lifecycle/ownership/update",d="Share: lifecycle update"):l=o+"/resources/pno/ownership/update");var h='{ "ownershipVector": '+t.encode(e)+"}";console.log("<<<<<<<<<<< Data to send = "+h);r["Accept-Language"]=widget.lang,r.SecurityContext=encodeURIComponent(a);var p=n.getTenantID();p&&0!=p.length?l+="?tenant="+p:l+="?tenant=OnPremise",i._perfTimer.start(d),n.partitionedAuthenticatedRequest(l,{type:"json",method:"POST",proxy:s,headers:r,cancelCallback:function(){return!1},data:h,timeout:864e5,onComplete:function(t){i._perfTimer.stop(d),i.dispatchEvent("onModificationComplete",t);var a={ov:e};i.dispatchEvent("fireWintopNotif",a)},onFailure:function(e,t,a){i._perfTimer.stop(d),i._onFailure(e,t,a),i._perfTimer.stop("CommandExecutionDurationShare"),i._perfTimer.printTime("CommandUIDurationShare"),i._perfTimer.printTime("CommandExecutionDurationShare"),i._perftime.printTime(d)},onTimeout:function(){i._perfTimer.stop(d),i._onTimeout(),i._perfTimer.stop("CommandExecutionDurationShare"),i._perfTimer.printTime("CommandUIDurationShare"),i._perfTimer.printTime("CommandExecutionDurationShare"),i._perfTimer.printTime(d)}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})},function(e){onError(e)})}else{var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(o)}},getSelectedItemList:function(){return this.SelectedItems},getErrorSelectedItemList:function(){return this.ErrorExistingECAndAggrItemsMap},getAggrItemList:function(){return this.AggrItemsMap},fillInvalidList:function(e){for(var t=e.length,a=0;a<t;a++){var n=e[a];this.listOfInvalidIDs[a]=n}},getInvalidList:function(){return this.listOfInvalidIDs}})}),define("DS/ShareWidget/ShareWidget",["UWA/Core","UWA/Controls/Input","DS/UIKIT/Image","UWA/Controls/Abstract","UWA/Json","DS/WAFData/WAFData","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/CollabPerfTimer","DS/WarningWidget/WarningWidget","DS/ShareWidget/ShareController","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/Logger/Logger","DS/WebToWinInfra/WebToWinCom","DS/Controls/Toggle","DS/UIKIT/Input/Text","UWA/Event","DS/ReportingPanel/ReportingPanel","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","css!DS/ShareWidget/ShareWidget.css","i18n!DS/ShareWidget/assets/nls/langAR"],function(e,t,a,n,i,r,o,s,c,l,d,h,p,m,u,g,S,f,v,y,C,A,_,b,I,E,w,R){"use strict";UWA.debug=!0;var W=d.getProdLevel();return n.extend({defaultOptions:{className:"",ForbiddenChar:'"#$@%*,?\\<>[]|:',setValidButton:!0,setCloseButton:!0,showTopBar:!0,wintop:!1,topClassHeight:"SH_MasterContain",readOnly:"auto",displayWarningForAutoRO:!1,serverName:"",serverUri:"",activeMultisel:!0,activeComment:!1,serverUrl:""},init:function(e,t,a){if(this._parent(a),1==this.options.wintop&&(this.webToWinCom_Socket=C.createSocket({socket_id:"webinwinAccessRights_socket_"+Math.floor(1e5*Math.random()+1)}),void 0!==this.options.serverUrl&&this.options.serverUrl.length>0&&void 0!==this.options.serverUrl[0].platformId)){var n=this.options.serverUrl[0].platformId;d.setTenantID(n)}this.widgetSecurityContext={},this._perfTimer=p,this._perfTimer.init("Share"),this._perfTimer.start("CommandUIDurationShare");var i="";if(null!=e){if(e.hasOwnProperty("pad_security_ctx"))0!=(i=e.pad_security_ctx).indexOf("ctx::")&&(i="ctx::"+i);else if("function"==typeof e.hasPreference&&null!=e.getPreference("pad_security_ctx"))i=e.getPreference("pad_security_ctx").value;else if("function"==typeof e.hasPreference&&e.hasPreference("xPref_CREDENTIAL")){var r=e.getPreference("xPref_CREDENTIAL");void 0!==r.value&&null!==r.value&&r.hasOwnProperty("value")&&(i="ctx::"+r.value)}else"function"==typeof e.hasPreference&&null!=e.getPreference("securityContext")&&(i=e.getPreference("securityContext").value);i.length>0&&(this.widgetSecurityContext={SecurityContext:i})}this.isODT=!1,void 0!==typeof this.options&&null!==this.options&&this.options.hasOwnProperty("odtmode")&&(this.isODT=this.options.odtmode),W=d.getProdLevel(),this.options.activeMultisel=this.options.activeMultisel||d.isMultiSelODT(),this.options.activeComment=this.options.activeComment||d.isCommentODT(),this._initDataStructures(),this.isReadOnly=!1,this.listID=[],this.listOfIds=[],this.listOfAddedMembers=[],this.listOfPrivateProjects=[],this.listOfValidIDs=[],this.listOfInvalidIDs=[],this.arDone=!1,!0===this.options.readOnly&&(this.isReadOnly=!0),this.widget=e,this.parentWidget=t,this.SearchWidget_View=[];var o=UWA.i18n("AR_Status"),s=UWA.i18n("AR_Title"),c=UWA.i18n("AR_Sum_Type"),l=UWA.i18n("AR_Revision"),h=UWA.i18n("AR_Sum_Org"),m=UWA.i18n("AR_Sum_Collab"),u=UWA.i18n("AR_Sum_Resp"),g=UWA.i18n("AR_Result");this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:o,dataIndex:"Status",typeRepresentation:"icon"},{text:s,dataIndex:s},{text:c,dataIndex:c},{text:l,dataIndex:l},{text:h,dataIndex:h},{text:m,dataIndex:m},{text:u,dataIndex:u},{text:g,dataIndex:g}],this.initUI(),this._perfTimer.stop("CommandUIDurationShare"),this.trackerEventBeginTime=Date.now()},_initDataStructures:function(){this.objectIds={},this.listOfError=[],this.SelectedItemsWithEC=[],this.ctxObjectIds=[],this.SelectedItems=[],this.dumpSection=null,this.firstInit=!0,this.arDone=!1,this._bAddUserError=!1,this.listInputErrors=[],this.listInvalidPovOwnerErrorMsg=[],this.listInvalidPovCollabSpaceErrorMsg=[],this.containsInheritedAccess=!1,this.csoTableLines=[],void 0===this.commentBox&&(this.commentBox=null),void 0===this.textArea&&(this.textArea=null)},createWebInWinSocket:function(e){return C.createSocket({socket_id:e+Math.floor(1e5*Math.random()+1)})},fireWintopCommand:function(e,t,a){var n=[],i=a+"\n",r=[];if("onModificationAccessRights"===a){var o=null;t.hasOwnProperty("ov")&&(o=t.ov),o.forEach(function(e,t){e.hasOwnProperty("ownership")&&(r.indexOf(e.objectID)<0&&(r.push(e.objectID),e.ownership.forEach(function(e,t){var a,n=e.operation,r=e.access.logical;e.owner.hasOwnProperty("person")?a=e.owner.person.personID:e.owner.hasOwnProperty("collabSpace")&&(a=e.owner.collabSpace.collabSpaceID),i=i+" "+n+" "+r+" "+a+"\n"}),n.push(i)))})}var s={severity:"warning",ID:r,message:n},c=C.createJSONArrayMessage(a,s);c.length>0&&e.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayMessageODT",notif_parameters:c},"lf_web_in_win")},initData:function(e){this.trackAppContent(e),this.SelectedItems=[],this._initDataStructures(),this.ShareController.onLoad(),this.addDataPCS(e),this.getPrivateProjectList()},initDatafromWin:function(e){this.initData(e)},getPrivateProjectList:function(){var e=this;h.getInstance().getSecurityContext({onSuccess:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.getListOfPrivateCS(e.widgetSecurityContext):e.getListOfPrivateCS(t)},onFailure:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.getListOfPrivateCS(e.widgetSecurityContext):e.setError(t)}})},addDataPCS:function(e){var t=this;null==e&&(e=this.SelectedItems),"auto"==this.options.readOnly?h.getInstance().getSecurityContext({onSuccess:function(a){t.SelectedItemsList=e,0===e[0].physicalId.toString().indexOf("cid:")?t.widgetSecurityContext.hasOwnProperty("SecurityContext")?t._testAvailability(e,t.widgetSecurityContext):t._testAvailability(e,a):t.widgetSecurityContext.hasOwnProperty("SecurityContext")?t._doShareChecker(e,t.widgetSecurityContext):t._doShareChecker(e,a)},onFailure:function(a){t.SelectedItemsList=e,t.widgetSecurityContext.hasOwnProperty("SecurityContext")?0===e[0].physicalId.toString().indexOf("cid:")?t._testAvailability(e,t.widgetSecurityContext):t._doShareChecker(e,t.widgetSecurityContext):t.setError(a)}}):this._addDataPCS(e)},_addDataPCS:function(e){this._ManageValidButton(!1),this.hideMainErrorArea();var t=[],a=this;if(1==this.options.activeMultisel?(null!=e&&(t=e.slice()),d.removeDuplicate(t,function(e){return e.physicalId}),t.forEach(function(e){d.arrayContains(a.SelectedItems,e,function(e){return e.physicalId})<0&&a.SelectedItems.push(e)})):null!=e&&e.length>0&&(a.SelectedItems=[],a.SelectedItems.push(e[0]),t.push(e[0])),a.SelectedItems.length<=0)return 1==this.options.wintop?this.showMainErrorArea(UWA.i18n("NoItemToDisplay")):this.showMainErrorArea(UWA.i18n("NoItemSelected")),this.hideMainLoadingArea(),this.hideMainComponent(),void a.dispatchEvent("onChangeSize");this.displayLoadingArea();a.SelectedItems.length>0&&(this.options.hasOwnProperty("odtmode")&&(this.ShareController.options.odtmode=this.options.odtmode),this.ShareController._fillAttributesOfSelectedItems(a.SelectedItems,function(e,t){for(var n=0;n<e.results.length;n++)e.results[n].validList.length>0&&(a.listOfValidIDs=a.listOfValidIDs.concat(e.results[n].validList)),e.results[n].invalidList.length>0&&(a.listOfInvalidIDs=a.listOfInvalidIDs.concat(e.results[n].validList));if(e.hasOwnProperty("CommandAvailability")&&!1===e.CommandAvailability)a.isReadOnly=!0,a.addError(UWA.i18n("SH_PLM_SecurityDenied")),a._updateReadOnlyDisplay();else if(0==a.listOfValidIDs.length)a.isReadOnly=!0,a.addError(UWA.i18n("ShareNotSupported")),a._updateReadOnlyDisplay();else if(a.listOfInvalidIDs.length>0){for(var i="",r=0;r<a.listOfInvalidIDs.length;r++)for(var o=0;o<a.SelectedItems.length;o++)a.listOfInvalidIDs[r]===a.SelectedItems[o].physicalId&&(null==a.SelectedItems[o].name&&null==a.SelectedItems[o].name||(i=a.SelectedItems[o].name),a.SelectedItems.splice(o,1));1==a.listOfInvalidIDs.length?0!=i.length?a.addError(UWA.i18n("ShareNotSupportedFor{0}").format(i)):a.addError(UWA.i18n("ShareNotSupportedForSomeObjects{0}").format(a.listOfInvalidIDs.length)):a.listOfInvalidIDs.length>1&&a.addError(UWA.i18n("ShareNotSupportedForSomeObjects{0}").format(a.listOfInvalidIDs.length))}a.ShareController._setValidInvalidIdList(a.listOfValidIDs,a.listOfInvalidIDs),a.ShareController._fillModels(a.SelectedItems)},function(e){}))},destroy:function(){this.searchWidget&&this.searchWidget.destroy(),this._parent()},addSearchBox:function(e,t){var a=this,n=a.listOfAddedMembers.length;e="  "+e;var i=UWA.createElement("span",{id:"addedItem"+n,class:"SH_AddedItemContainer"}),r=UWA.createElement("span",{class:"SH_TextForItemContainer",text:e}).inject(i);UWA.createElement("span",{id:n,class:"SH_TextForItemContainer",text:"x"}).inject(r).addEventListener("click",function(){i.setStyle("display","none"),a.DeleteUser(this.id)}),"Viewer"===t?(a.showMember_CanView.show(),i.inject(a.showMember_CanView)):"Reader"===t?(a.showMember_CanRead.show(),i.inject(a.showMember_CanRead)):"Owner"===t?(a.showMember_CanManage.show(),i.inject(a.showMember_CanManage)):"Author"===t?(a.showMember_CanEdit.show(),i.inject(a.showMember_CanEdit)):"CanAddRemoveAttachments"===t?(a.showMember_CanAddRemoveAttachment.show(),i.inject(a.showMember_CanAddRemoveAttachment)):"Read"===t?(a.showMember_Read.show(),i.inject(a.showMember_Read)):"Add"===t?(a.showMember_Add.show(),i.inject(a.showMember_Add)):"Basic"===t?(a.showMember_Basic.show(),i.inject(a.showMember_Basic)):"ReadWrite"===t?(a.showMember_ReadWrite.show(),i.inject(a.showMember_ReadWrite)):"Remove"===t?(a.showMember_Remove.show(),i.inject(a.showMember_Remove)):"AddRemove"===t?(a.showMember_AddRemove.show(),i.inject(a.showMember_AddRemove)):"Full"===t?(a.showMember_Full.show(),i.inject(a.showMember_Full)):"Leader"===t?(a.showMember_Leader.show(),i.inject(a.showMember_Leader)):"Project Member"===t?(a.showMember_Member.show(),i.inject(a.showMember_Member)):"Project Lead"===t&&(a.showMember_ProjectLead.show(),i.inject(a.showMember_ProjectLead))},getSearchInput:function(e){var t=this;return o.getSearchWidget(o.RESTRICTED,{className:"share-item-view-wrapper",id:e,ForbiddenChar:this.options.ForbiddenChar,MaxNumber:"5",MaxSize:"300",topClassHeight:this.options.topClassHeight,position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,exttype:s.EXTTYPE_USERGRP,showEmptyCategory:!1,hint:UWA.i18n("SearchPlaceHolder"),PrivateProjectList:t.listOfPrivateProjects,odtmode:this.options.odtmode,events:{onValid:function(){t.AddUser(e)&&(t._ManageValidButton(!0),1==t.options.activeComment&&t.searchComment.show(),t.addSearchBox(this.searchInput.getValue(),this.options.id),t.dispatchEvent("onChangeSize")),this.searchInput.setValue("")},onUnvalid:function(){1==t.options.activeComment&&t.searchComment.hide(),t.dispatchEvent("onChangeSize")},onError:function(e){t.setError(e)}}})},initUI:function(){var e=this,t=this.container=UWA.createElement("div",{name:"SH_MasterContain","data-rec-id":"SH_MasterContain",class:"SH_MasterContain "+e.options.className});this.globalDiv=UWA.createElement("div",{class:"SH_GlobalContain","data-rec-id":"datarecGlobalContain"}).inject(t);var a="SH_ManageButtonDiv";this.options.wintop&&(a="SH_ManageButtonDivWintop"),this.ManageButtonDiv=UWA.createElement("table",{class:a,"data-rec-id":"datarecManageButtonDiv",html:{}}),e.ManageButtonRight=UWA.createElement("td",{class:"SH_ManageButtonRight","data-rec-id":"datarecManageButtonRight"}),e.ManageButtonLeft=UWA.createElement("td",{class:"SH_ManageButtonLeft","data-rec-id":"datarecManageButtonLeft"}),e.loadingArea=new f({visible:!1});var n=null;e.boutonValid=new g({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n("AR_mainTile"),className:"default medium AR_buttonTop primary",disabled:!0});var i=e.boutonValid.getContent();null!=i&&i.setAttribute("data-rec-id","boutonValid"),n=new g({attributes:{title:UWA.i18n(""),"data-rec-id":"datarecButtonCancel"},name:"TopButtonCancel",value:UWA.i18n("AR_CloseOverlay"),className:"default medium AR_buttonTop"}),e.boutonValid.addEvents({onClick:function(){e._perfTimer.start("CommandExecutionDurationShare"),e._ManageValidButton(!1),e.displayLoadingArea(),e.modifyDataPCS(),n.setValue(UWA.i18n("AR_Close"))}}),n.addEvents({onClick:function(){e._ManageValidButton(!1),e.dispatchEvent("onCancel"),e._perfTimer.printTime("CommandUIDurationShare")}}),e.loadingArea.inject(e.ManageButtonRight),e.mainInterface=UWA.createElement("div",{class:"SH_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),0==this.isReadOnly&&1==e.options.setValidButton&&e.boutonValid.inject(e.ManageButtonRight),1==e.options.setCloseButton&&n.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),e.options.showTopBar&&this.ManageButtonDiv.inject(e.globalDiv),e.mainInterface=UWA.createElement("div",{class:"SH_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),e.mainLoading=UWA.createElement("div",{class:"SH_MainLoading","data-rec-id":"datarecMainLoading"}).inject(this.globalDiv),e.mainError=UWA.createElement("div",{class:"SH_MainError","data-rec-id":"datarecMainError"}).inject(this.globalDiv).hide(),e.copyLink=new _({placeholder:"link",rows:1}),e.copyLink.inject(this.globalDiv).hide(),e.addMemberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-container expanded"}).inject(e.mainLoading),e.memberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-body","data-rec-id":"datarecMemberPanel"}).inject(e.addMemberPanel),e.addMemberPanel=UWA.createElement("div",{class:"share-item-view-container highlighted","data-rec-id":"c10"}).inject(e.memberPanel),e.tableAddMember=UWA.createElement("table").inject(e.addMemberPanel),e.addMEmberContainer=UWA.createElement("tbody").inject(e.tableAddMember);e.options.ForbiddenChar;this.searchIconArr=[],e.canView=UWA.createElement("tr",{class:"tr-canView"}).inject(e.addMEmberContainer),e.canViewTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canView),e.canViewLabel=UWA.createElement("span",{id:"canView-label",text:R.get("CanView")}).inject(e.canViewTD),e.canViewHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("CanViewHelp")}).inject(e.canViewTD),e.canViewLabel.setStyle("text-align","left"),e.canViewLabel.setStyle("font-family","arial"),e.canViewLabel.setStyle("font-size","12px"),e.canViewSearchTD=UWA.createElement("td").inject(e.canView),e.showMember_CanView=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.canViewSearchTD).hide(),e.searchWidget_CanView=e.getSearchInput("Viewer").inject(e.canViewSearchTD),e.searchWidget_CanView.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canRead=UWA.createElement("tr",{class:"tr-canRead"}).inject(e.addMEmberContainer),e.canReadTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canRead),e.canReadLabel=UWA.createElement("span",{id:"canRead-label",text:R.get("CanRead")}).inject(e.canReadTD),e.canReadHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("CanReadHelp")}).inject(e.canReadTD),e.canReadLabel.setStyle("text-align","left"),e.canReadLabel.setStyle("font-family","arial"),e.canReadLabel.setStyle("font-size","12px"),e.canReadSearchTD=UWA.createElement("td").inject(e.canRead),e.showMember_CanRead=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Reader"}).inject(e.canReadSearchTD).hide(),e.searchWidget_CanRead=e.getSearchInput("Reader").inject(e.canReadSearchTD),e.searchWidget_CanRead.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canEdit=UWA.createElement("tr",{class:"tr-canEdit"}).inject(e.addMEmberContainer),e.canEditTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canEdit),e.canEditLabel=UWA.createElement("span",{id:"canEdit-label",text:R.get("CanEdit")}).inject(e.canEditTD),e.canEditHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("CanEditHelp")}).inject(e.canEditTD),e.canEditLabel.setStyle("text-align","left"),e.canEditLabel.setStyle("font-family","arial"),e.canEditLabel.setStyle("font-size","12px"),e.canEditSearchTD=UWA.createElement("td").inject(e.canEdit),e.showMember_CanEdit=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Author"}).inject(e.canEditSearchTD).hide(),e.searchWidget_CanEdit=e.getSearchInput("Author").inject(e.canEditSearchTD),e.searchWidget_CanEdit.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canManage=UWA.createElement("tr",{class:"tr-canManage"}).inject(e.addMEmberContainer),e.canManageTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canManage),e.canManageLabel=UWA.createElement("span",{id:"canManage-label",text:R.get("CanManage")}).inject(e.canManageTD),e.canManageHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("CanManageHelp")}).inject(e.canManageTD),e.canManageLabel.setStyle("text-align","left"),e.canManageLabel.setStyle("font-family","arial"),e.canManageLabel.setStyle("font-size","12px"),e.canManageSearchTD=UWA.createElement("td").inject(e.canManage),e.showMember_CanManage=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Owner"}).inject(e.canManageSearchTD).hide(),e.searchWidget_CanManage=e.getSearchInput("Owner").inject(e.canManageSearchTD),e.searchWidget_CanManage.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.leader=UWA.createElement("tr",{class:"tr-leader"}).inject(e.addMEmberContainer),e.leaderTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.leader),e.leaderLabel=UWA.createElement("span",{id:"leader-label",text:R.get("Leader")}).inject(e.leaderTD),e.leaderHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("LeaderHelp")}).inject(e.leaderTD),e.leaderLabel.setStyle("text-align","left"),e.leaderLabel.setStyle("font-family","arial"),e.leaderLabel.setStyle("font-size","12px"),e.leaderSearchTD=UWA.createElement("td").inject(e.leader),e.showMember_Leader=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Leader"}).inject(e.leaderSearchTD).hide(),e.searchWidget_Leader=e.getSearchInput("Leader").inject(e.leaderSearchTD),e.searchWidget_Leader.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.projectLead=UWA.createElement("tr",{class:"tr-projectLead"}).inject(e.addMEmberContainer),e.projectLeadTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.projectLead),e.projectLeadLabel=UWA.createElement("span",{id:"projectLead-label",text:R.get("ProjectLead")}).inject(e.projectLeadTD),e.projectLeadHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("ProjectLeadHelp")}).inject(e.projectLeadTD),e.projectLeadLabel.setStyle("text-align","left"),e.projectLeadLabel.setStyle("font-family","arial"),e.projectLeadLabel.setStyle("font-size","12px"),e.projectLeadSearchTD=UWA.createElement("td").inject(e.projectLead),e.showMember_ProjectLead=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_ProjectLead"}).inject(e.projectLeadSearchTD).hide(),e.searchWidget_ProjectLead=e.getSearchInput("Project Lead").inject(e.projectLeadSearchTD),e.searchWidget_ProjectLead.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.member=UWA.createElement("tr",{class:"tr-member"}).inject(e.addMEmberContainer),e.memberTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.member),e.memberLabel=UWA.createElement("span",{id:"member-label",text:R.get("Member")}).inject(e.memberTD),e.memberHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("MemberHelp")}).inject(e.memberTD),e.memberLabel.setStyle("text-align","left"),e.memberLabel.setStyle("font-family","arial"),e.memberLabel.setStyle("font-size","12px"),e.memberSearchTD=UWA.createElement("td").inject(e.member),e.showMember_Member=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Member"}).inject(e.memberSearchTD).hide(),e.searchWidget_Member=e.getSearchInput("Project Member").inject(e.memberSearchTD),e.searchWidget_Member.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canAddRemoveAttachment=UWA.createElement("tr",{class:"tr-canAddRemoveAttachment"}).inject(e.addMEmberContainer),e.canAddRemoveAttachmentTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canAddRemoveAttachment),e.canAddRemoveAttachmentLabel=UWA.createElement("span",{id:"canAddRemoveAttachment-label",text:R.get("CanAddRemoveAttachments")}).inject(e.canAddRemoveAttachmentTD),e.canAddRemoveAttachmentHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("CanAddRemoveAttachmentHelp")}).inject(e.canAddRemoveAttachmentTD),e.canAddRemoveAttachmentLabel.setStyle("text-align","left"),e.canAddRemoveAttachmentLabel.setStyle("font-family","arial"),e.canAddRemoveAttachmentLabel.setStyle("font-size","12px"),e.canAddRemoveAttachmentSearchTD=UWA.createElement("td").inject(e.canAddRemoveAttachment),e.showMember_CanAddRemoveAttachment=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_CanAddRemoveAttachments"}).inject(e.canAddRemoveAttachmentSearchTD).hide(),e.searchWidget_CanAddRemoveAttachment=e.getSearchInput("CanAddRemoveAttachments").inject(e.canAddRemoveAttachmentSearchTD),e.searchWidget_CanAddRemoveAttachment.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.read=UWA.createElement("tr",{class:"tr-read"}).inject(e.addMEmberContainer),e.readTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.read),e.readLabel=UWA.createElement("span",{id:"read-label",text:R.get("Read")}).inject(e.readTD),e.readHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("ReadHelp")}).inject(e.readTD),e.readLabel.setStyle("text-align","left"),e.readLabel.setStyle("font-family","arial"),e.readLabel.setStyle("font-size","12px"),e.readSearchTD=UWA.createElement("td").inject(e.read),e.showMember_Read=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.readSearchTD).hide(),e.searchWidget_Read=e.getSearchInput("Read").inject(e.readSearchTD),e.searchWidget_Read.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.add=UWA.createElement("tr",{class:"tr-add"}).inject(e.addMEmberContainer),e.addTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.add),e.addLabel=UWA.createElement("span",{id:"add-label",text:R.get("Add")}).inject(e.addTD),e.addHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("AddHelp")}).inject(e.addTD),e.addLabel.setStyle("text-align","left"),e.addLabel.setStyle("font-family","arial"),e.addLabel.setStyle("font-size","12px"),e.addSearchTD=UWA.createElement("td").inject(e.add),e.showMember_Add=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.addSearchTD).hide(),e.searchWidget_Add=e.getSearchInput("Add").inject(e.addSearchTD),e.searchWidget_Add.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.basic=UWA.createElement("tr",{class:"tr-basic"}).inject(e.addMEmberContainer),e.basicTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.basic),e.basicLabel=UWA.createElement("span",{id:"basic-label",text:R.get("Basic")}).inject(e.basicTD),e.basicHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("BasicHelp")}).inject(e.basicTD),e.basicLabel.setStyle("text-align","left"),e.basicLabel.setStyle("font-family","arial"),e.basicLabel.setStyle("font-size","12px"),e.basicSearchTD=UWA.createElement("td").inject(e.basic),e.showMember_Basic=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.basicSearchTD).hide(),e.searchWidget_Basic=e.getSearchInput("Basic").inject(e.basicSearchTD),e.searchWidget_Basic.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.readWrite=UWA.createElement("tr",{class:"tr-readWrite"}).inject(e.addMEmberContainer),e.readWriteTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.readWrite),e.readWriteLabel=UWA.createElement("span",{id:"readWrite-label",text:R.get("ReadWrite")}).inject(e.readWriteTD),e.readWriteHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("ReadWriteHelp")}).inject(e.readWriteTD),e.readWriteLabel.setStyle("text-align","left"),e.readWriteLabel.setStyle("font-family","arial"),e.readWriteLabel.setStyle("font-size","12px"),e.readWriteSearchTD=UWA.createElement("td").inject(e.readWrite),e.showMember_ReadWrite=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.readWriteSearchTD).hide(),e.searchWidget_ReadWrite=e.getSearchInput("ReadWrite").inject(e.readWriteSearchTD),e.searchWidget_ReadWrite.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.remove=UWA.createElement("tr",{class:"tr-remove"}).inject(e.addMEmberContainer),e.removeTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.remove),e.removeLabel=UWA.createElement("span",{id:"remove-label",text:R.get("Remove")}).inject(e.removeTD),e.removeHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("RemoveHelp")}).inject(e.removeTD),e.removeLabel.setStyle("text-align","left"),e.removeLabel.setStyle("font-family","arial"),e.removeLabel.setStyle("font-size","12px"),e.removeSearchTD=UWA.createElement("td").inject(e.remove),e.showMember_Remove=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.removeSearchTD).hide(),e.searchWidget_Remove=e.getSearchInput("Remove").inject(e.removeSearchTD),e.searchWidget_Remove.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.addRemove=UWA.createElement("tr",{class:"tr-addRemove"}).inject(e.addMEmberContainer),e.addRemoveTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.addRemove),e.addRemoveLabel=UWA.createElement("span",{id:"addRemove-label",text:R.get("AddRemove")}).inject(e.addRemoveTD),e.addRemoveHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("addRemoveHelp")}).inject(e.addRemoveTD),e.addRemoveLabel.setStyle("text-align","left"),e.addRemoveLabel.setStyle("font-family","arial"),e.addRemoveLabel.setStyle("font-size","12px"),e.addRemoveSearchTD=UWA.createElement("td").inject(e.addRemove),e.showMember_AddRemove=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.addRemoveSearchTD).hide(),e.searchWidget_AddRemove=e.getSearchInput("AddRemove").inject(e.addRemoveSearchTD),e.searchWidget_AddRemove.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.full=UWA.createElement("tr",{class:"tr-full"}).inject(e.addMEmberContainer),e.fullTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.full),e.fullLabel=UWA.createElement("span",{id:"full-label",text:R.get("Full")}).inject(e.fullTD),e.fullHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:R.get("FullHelp")}).inject(e.fullTD),e.fullLabel.setStyle("text-align","left"),e.fullLabel.setStyle("font-family","arial"),e.fullLabel.setStyle("font-size","12px"),e.fullSearchTD=UWA.createElement("td").inject(e.full),e.showMember_Full=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.fullSearchTD).hide(),e.searchWidget_Full=e.getSearchInput("Full").inject(e.fullSearchTD),e.searchWidget_Full.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canEditSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canReadSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canViewSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canManageSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canAddRemoveAttachmentSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.readSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.addSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.basicSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.readWriteSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.removeSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.addRemoveSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.fullSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.leaderSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.memberSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.projectLeadSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canRead.hide(),e.canManage.hide(),e.canEdit.hide(),e.canView.hide(),e.leader.hide(),e.canAddRemoveAttachment.hide(),e.read.hide(),e.add.hide(),e.basic.hide(),e.readWrite.hide(),e.remove.hide(),e.addRemove.hide(),e.full.hide(),e.member.hide(),e.projectLead.hide();e.selectRightNewUser=new S({nativeSelect:!0,placeholder:!1}),e.selectRightNewUser.elements.container.setAttribute("data-rec-id","dataRecselectRightNewUserContainer"),e.selectRightNewUser.elements.content.setAttribute("data-rec-id","dataRecselectRightNewUser"),e.errorOverlay=new c(e.widget,e.container,{className:"errorComponent_AccessRight","data-rec-id":"datarecErrorComponentAccessRight"}),this.ShareController=new u(e.widget,{uniqueRightList:!this.isReadOnly,serverName:this.options.serverName,wintop:this.options.wintop,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,isReadOnly:this.isReadOnly,odtMode:this.isODT,parent:this,contextArea2:this.ManageButtonLeft,progressBarWaitContext:e.container,events:{onError:function(t){e.hideFailMainLoadingArea(),e.addError(t)},onError2:function(t){e.hideFailMainLoadingArea(),e.hideMainLoadingArea(),e.addError(t)},onWarning:function(t){e.addError(t)},onDataLoaded:function(){if(null!=e.container.getParent()){e.hideMainLoadingArea();var t=e.ShareController.getFormattedRightList();e.selectRightNewUser.add(t,!0),t.length>0&&(e.selectRightNewUser.setValue(t[0]),t.forEach(function(t){"Reader"===t.value?e.canRead.show():"Owner"===t.value?e.canManage.show():"Author"===t.value?e.canEdit.show():"Viewer"===t.value?e.canView.show():"Read"===t.value?e.read.show():"Add"===t.value?e.add.show():"Basic"===t.value?e.basic.show():"Read Write"===t.value?e.readWrite.show():"Remove"===t.value?e.remove.show():"Add Remove"===t.value?e.addRemove.show():"Full"===t.value?e.full.show():"CanAddRemoveAttachments"===t.value?e.canAddRemoveAttachment.show():"Leader"===t.value?e.leader.show():"Project Member"===t.value?e.member.show():"Project Lead"===t.value&&e.projectLead.show()}));var a=e.selectRightNewUser.elements.container.childNodes[0].childNodes;if(a.forEach)a.forEach(function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)});else Array.prototype.slice.call(a).forEach(function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)});e.searchWidget_CanView.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanRead.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanManage.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanEdit.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanAddRemoveAttachment.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Read.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Add.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Basic.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_ReadWrite.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Remove.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_AddRemove.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Full.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Leader.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Member.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_ProjectLead.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),!0===e.firstInit&&(e.dispatchEvent("onFirstBuild"),e.firstInit=!1)}},onModificationComplete:function(t){e.hideLoadingArea(),e.showErrorReporting(t,this.SelectedItems),e._ManageValidButton(!1),e._perfTimer.stop("CommandExecutionDurationShare");var a="";null!=e.widgetSecurityContext&&""!=e.widgetSecurityContext&&e.widgetSecurityContext.SecurityContext&&(a=e.widgetSecurityContext.SecurityContext);e._perfTimer.printTimeShowDialogAndProcess(["CommandUIDurationShare","CommandExecutionDurationShare","Share: isTypeSupportedToCommand","Share: filterValidSCs","Share: pno logicalaccess","Share: lifecycle logicalaccess","Share: getCompletedData","Share: pno update","Share: lifecycle update","Share: pno checkaccess","Share: lifecycle checkaccess","Share: ar shareChecker","Share: lifecycle shareChecker","Share: getPrivateProjectList","Share: person"],a)},fireWintopNotif:function(t){!0===e.options.wintop&&e.fireWintopCommand(e.webToWinCom_Socket,t,"onModificationAccessRights")}}}),this._ManageValidButton()},_updateReadOnlyDisplay:function(){1==this.isReadOnly?(null!=this.boutonValid&&this.boutonValid.hide(),null!=this.memberPanel&&this.memberPanel.hide(),this.hideLoadingArea(),this.ManageButtonRight.setStyle("display","block")):null!=this.boutonValid&&this.boutonValid.show()},_ManageValidButton:function(e){var t=this.createJSONArrayModif(),a=e;null!=e&&void 0!==typeof e||(a=t.length>0),a?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},getTopBar:function(){return this.ManageButtonDiv},showErrorReporting:function(e,t){var a=[];if(e&&e.ownershipVector)for(var n=e.ownershipVector.length,i=0;i<n;i++){var r=[],o=e.ownershipVector[i];if(o){var s=o.ownership,c="access right success",l=!1;0==this.isODT&&(c=UWA.i18n("accessRightSuccess"));for(var d=0;d<s.length;d++){var h=s[d];if(h.hasOwnProperty("result")){c="access right failure",0==this.isODT&&(c=h.result.message),l=!0;break}}for(var p=0;p<t.length;p++){var m="",u="";this.options.odtmode?(m=t[p].physicalId,u=t[p].name):(m=t[p].getID(),u=t[p].getName()),m===e.ownershipVector[i].objectID&&(t[p].status=c,r.push(m),l?(r.push(UWA.i18n("Share_Fail_Status")),r.push("Failed")):(r.push(UWA.i18n("Share_Success_Status")),r.push("Success")),r.push(u),r.push(t[p].typeDisplayName),r.push(t[p].Revision),r.push(t[p].organizationTitle),r.push(t[p].collabSpaceTitle),r.push(t[p].responsibleName),r.push(c),a.push(r))}}}var g=this.ShareController.getInvalidList();if(g.length>0)for(p=0;p<t.length;p++){r=[],m="",u="";if(this.options.odtmode?(m=t[p].physicalId,u=t[p].name):(m=t[p].getID(),u=t[p].getName()),-1!=g.indexOf(m)){c=R.get("ShareCheckerBlockedMessage");t[p].status=c,r.push(m),r.push(UWA.i18n("Share_Fail_Status")),r.push("Failed"),r.push(u),r.push(t[p].typeDisplayName),r.push(t[p].Revision),r.push(t[p].organizationTitle),r.push(t[p].collabSpaceTitle),r.push(t[p].responsibleName),r.push(c),a.push(r)}}I.launchReportingPanel(a,this.cols,null),this.dispatchEvent("onCancel")},setError:function(e){var t={};"object"==typeof e?"1500028"===e.code?(e.message=UWA.i18n("ErrorNotAccessRight"),t=e):e.hasOwnProperty("errorCode")&&"FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD"===e.errorCode?(t.code=e.errorCode,t.message=R.get("FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD")):t=e:t=e,this.addError(t)},addError:function(e){this.errorOverlay.displayJSONError(i.encode(e))},displayLoadingArea:function(){this.loadingArea.show(),this.loadingArea.elements.container.setStyle("display","flex")},hideLoadingArea:function(){this.loadingArea.hide()},hideMainComponent:function(){this.hideLoadingArea(),this.mainInterface.hide(),this.boutonValid.hide()},hideMainLoadingArea:function(){this.loadingArea.hide()},hideFailMainLoadingArea:function(){this.mainLoading.hide()},hideMainErrorArea:function(){this.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.mainError)},clearAllMainError:function(){this.mainError.setContent("")},ownerAlreadyExist:function(e){var t=[],a=!1;return this.listOfAddedMembers.every(function(n,i){var r=n.ownership.owner;if(r.hasOwnProperty("person")||e.hasOwnProperty("person")){if(!r.hasOwnProperty("person")||!e.hasOwnProperty("person"))return!0;if(r.person.personID!=e.person.personID)return!0}if(r.hasOwnProperty("collabSpace")||e.hasOwnProperty("collabSpace")){if(!r.hasOwnProperty("collabSpace")||!e.hasOwnProperty("collabSpace"))return!0;if(r.collabSpace.collabSpaceID!=e.collabSpace.collabSpaceID)return!0}if(r.hasOwnProperty("organization")||e.hasOwnProperty("organization")){if(!r.hasOwnProperty("organization")||!e.hasOwnProperty("organization"))return!0;if(r.organization.orgID!=e.organization.orgID)return!0}if(r.hasOwnProperty("group")||e.hasOwnProperty("group")){if(!r.hasOwnProperty("group")||!e.hasOwnProperty("group"))return!0;if(r.group.groupURI!=e.group.groupURI)return!0}return(r.hasOwnProperty("comment")||e.hasOwnProperty("comment"))&&r.hasOwnProperty("comment")&&e.hasOwnProperty("comment")&&r.comment==e.comment&&(a=!0),t.push({Index:i,IsSame:a}),!0}),t},modifyDataPCS:function(){var e=this,t=e.createJSONArrayModif(),a=[],n=new Array,i=e.ShareController.getSelectedItemList(),r=e.ShareController.getErrorSelectedItemList(),o=e.ShareController.getInvalidList();if(r.length!==i.length){var s=[];i.forEach(function(t){if(null==r[t]){-1==(e.options.odtmode?o.indexOf(t.physicalId):o.indexOf(t.getID()))&&s.push(t)}}),s.forEach(function(i,r){var o=new Array;i.hasOwnProperty("embeddedComp")&&!0===i.embeddedComp||(t.forEach(function(t){var a=t.operation;e.ShareController.isInherited(i.physicalId,a.owner)||o.push(a)}),n.push(i.physicalId),a.push({objectID:i.physicalId,ownership:o}))}),h.getInstance().getSecurityContext({onSuccess:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.ShareController.modifyDataWithSC(a,n,e.widgetSecurityContext):e.ShareController.modifyDataWithSC(a,n,t)},onFailure:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.ShareController.modifyDataWithSC(a,n,e.widgetSecurityContext):e.setError(t)}})}},_onFailure:function(e,t,a,n,r,o){this.hideLoadingArea(),i.isJson(t)&&(t=i.decode(t));var s={};s=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("AR_ErrorModification"),code:"ERROR"},this.setError(s)},_onTimeout:function(){this.hideLoadingArea();var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)},getListOfPrivateCS:function(e){var t=this,a={Accept:"application/json","Content-Type":"application/json"};if(null!=e&&""!=e&&e.hasOwnProperty("SecurityContext")){0!=e.SecurityContext.indexOf("ctx::")&&"ctx::",a.SecurityContext=encodeURIComponent(e.SecurityContext);this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(e){var n="",o=d.getRealPath("assets/availability.json",t.widget);2==W&&(n="passport"),2==W&&(o=e+"/resources/accessRightServices/ar/getPrivateProjectList");i.encode({requests:""});a["Accept-Language"]=widget.lang;var s=d.getTenantID();s&&0!=s.length?o+="?tenant="+s:o+="?tenant=OnPremise",t._perfTimer.start("Share: getPrivateProjectList"),r.authenticatedRequest(o,{type:"json",method:"GET",headers:a,proxy:n,data:"",onComplete:function(e){t._perfTimer.stop("Share: getPrivateProjectList"),t._onCompletePrivateProjectList(e)},onFailure:function(e,a,n){t._perfTimer.stop("Share: getPrivateProjectList"),t._onFailureAvailability(e,a,n)},onTimeout:function(){t._perfTimer.stop("Share: getPrivateProjectList"),t._onTimeoutAvailability(items)}})},serverUrl:t.options.serverUrl,wintop:t.options.wintop})}else{var n={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(n)}},_testAvailability:function(e,t){var a=this,n={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var r={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(r),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),n.SecurityContext=encodeURIComponent(t.SecurityContext);var o=[],s=e.length;s>10&&(s=10);for(var c=a.ShareController.getInvalidList(),l=0;l<s;l++){var h=e[l];-1==c.indexOf(h.physicalId)&&o.push({objectID:h.physicalId,accessRight:[{access:{physical:"changesov"}}]})}this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(t){var r="",s="GET",c="",l=d.getRealPath("assets/availability.json",a.widget);2==W&&(c="passport");var h="Share: pno checkaccess";2==W&&(a.options.hasOwnProperty("odtmode")&&a.options.odtmode?l=t+"/resources/pno/ownership/checkaccess":0===o[0].objectID.indexOf("cid:")?(l=t+"/resources/lifecycle/ownership/checkaccess",h="Share: lifecycle checkaccess"):l=t+"/resources/pno/ownership/checkaccess",s="POST",r='{ "boAccessRights": '+i.encode(o)+"}"),n["Accept-Language"]=widget.lang;var p=d.getTenantID();p&&0!=p.length?l+="?tenant="+p:l+="?tenant=OnPremise",a._perfTimer.start(h);d.partitionedAuthenticatedRequest(l,{type:"json",method:s,proxy:c,progressBarWaitContext:a.container,data:r,headers:n,onComplete:function(t){a._perfTimer.stop(h),a.reponse=t;var n=d.getTenantID(),i=a.SelectedItemsList[0].filterValidSCList;a.ShareController._loadCredentials(n,function(r){if(null!=a.SelectedItemsList[0].filterValidSCList){i.length;0==i.length?(a.isReadOnly=!0,a.addError(UWA.i18n("ShareBlockedForCurrentResponsibility")),a._updateReadOnlyDisplay()):a._onCompleteAvailability(t,e)}else a.ShareController.filterCredentials(n,r,"accessRight",function(n){n.length;0==n.length?(a.isReadOnly=!0,a.addError(UWA.i18n("ShareBlockedForCurrentResponsibility")),a._updateReadOnlyDisplay()):a._onCompleteAvailability(t,e)})})},onFailure:function(t,n,i){a._perfTimer.stop(perftType),a._onFailureAvailability(t,n,i,e)},onTimeout:function(){a._perfTimer.stop(h),a._onTimeoutAvailability(e)}})},serverUrl:a.options.serverUrl,wintop:a.options.wintop})},_doShareChecker:function(e,t){var a=this,n=e,r={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(o),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),r.SecurityContext=encodeURIComponent(t.SecurityContext);var s=[],c=e.length;c>10&&(c=10);for(var l=0;l<c;l++){var h=e[l];s.push({objectID:h.physicalId})}this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(o){var c="",l="GET",h="",p=d.getRealPath("assets/availability.json",a.widget);2==W&&(h="passport");var m="Share: ar shareChecker";2==W&&(a.options.hasOwnProperty("odtmode")&&a.options.odtmode?p=o+"/resources/accessRightServices/ar/shareChecker":0===s[0].objectID.indexOf("cid:")?(p=o+"/resources/lifecycle/ownership/checkaccess",m="Share: lifecycle shareChecker"):p=o+"/resources/accessRightServices/ar/shareChecker",l="POST",c=i.encode({requests:s})),r["Accept-Language"]=widget.lang;var u=d.getTenantID();u&&0!=u.length?p+="?tenant="+u:p+="?tenant=OnPremise",a._perfTimer.start(m);d.partitionedAuthenticatedRequest(p,{type:"json",method:l,proxy:h,progressBarWaitContext:a.container,data:c,headers:r,onComplete:function(i){if(a._perfTimer.stop(m),null!=i.results[0].invalidList&&i.results[0].invalidList.length>0){var r;if((r=i.results[0].invalidList).length==e.length){a.isReadOnly=!0,a.hideLoadingArea();var o={message:UWA.i18n("ShareCheckerBlockedMessage"),code:"TO"};return a.setError(o),void a._updateReadOnlyDisplay()}a.ShareController.fillInvalidList(r),a._testAvailability(n,t)}else a._testAvailability(n,t)},onFailure:function(t,n,i){a._perfTimer.stop(m),a._onFailureAvailability(t,n,i,e)},onTimeout:function(){a._perfTimer.stop(m),a._onTimeoutAvailability(e)}})},serverUrl:a.options.serverUrl,wintop:a.options.wintop})},_onTimeoutAvailability:function(e){this.isReadOnly=!0,this.hideLoadingArea();var t={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(t),this._updateReadOnlyDisplay(),this._addDataPCS(e)},_onFailureAvailability:function(e,t,a,n){this.isReadOnly=!0,this.hideLoadingArea();var r={};i.isJson(t)&&(t=i.decode(t)),r=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.setError(r),this._updateReadOnlyDisplay(),this._addDataPCS(n)},_onCompletePrivateProjectList:function(e){e.hasOwnProperty("PrivateProjects")&&(this.listOfPrivateProjects=e.PrivateProjects.PrivateProjectList,this.searchWidget_AddRemove.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Add.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Basic.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanAddRemoveAttachment.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanEdit.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanManage.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanRead.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_CanView.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Full.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Read.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_ReadWrite.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Remove.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Leader.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_Member.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList,this.searchWidget_ProjectLead.options.PrivateProjectList=e.PrivateProjects.PrivateProjectList)},_onCompleteAvailability:function(e,t){var a=this;if(1==e.success){this.isReadOnly=!1;var n=0;if(e.hasOwnProperty("boAccessRights")){var i=e.boAccessRights,r={};i.forEach(function(e){e.hasOwnProperty("accessRight")&&e.accessRight.forEach(function(i){if(i.hasOwnProperty("error")){n++;var o=i.error;o.type="warning";var s=UWA.i18n("an object");t.every(function(t){t.physicalId==e.objectID&&t.hasOwnProperty("name")&&(s=t.name)});var c="";switch(a.widgetSecurityContext.hasOwnProperty("SecurityContext")&&(c=a.widgetSecurityContext.SecurityContext.replace("ctx::","")),o.code+""){case"1501603":o.message=UWA.i18n("Bad credential for {0}").format(s);break;case"1501601":o.message=UWA.i18n("SH_PLM_SecurityDenied");break;case"1501602":o.message=UWA.i18n("NoCredentialAccess{0}").format(c)}r[e.objectID]=o.message,!0===a.options.displayWarningForAutoRO&&a.addError(o),y.warn("Access right : "+o.message)}})});var o=i.length;o==n?(a.isReadOnly=!0,1==o?null!=r[i[0].objectID]&&a.addError(r[i[0].objectID]):a.addError(UWA.i18n("ErrorNoAccessToSelectedObjects")),t.length>o&&(a.isReadOnly=!1,a.addError(UWA.i18n("ErrorNoAccessToAtLeast10")))):n>0&&a.addError(UWA.i18n("ErrorNoAccessToSomeObjects{0}").format(n))}a._updateReadOnlyDisplay(),a._addDataPCS(t)}else{if(this.isReadOnly=!0,e.hasOwnProperty("error")){var s=e.error;a.addError(s)}this.hideMainLoadingArea()}},_manageTableHeader:function(){var e=this.tableContainer.getElement(".SH_mainTableHeader");null!==e&&(this.table.allIsHidden()?e.hide():e.show())},AddUser:function(e){var t=!1;if(!d.isProgressBusy()){var a="";if("Reader"==e)a=this.searchWidget_CanRead.getNewOwner();else if("Author"==e)a=this.searchWidget_CanEdit.getNewOwner();else if("Owner"==e)a=this.searchWidget_CanManage.getNewOwner();else if("Viewer"==e)a=this.searchWidget_CanView.getNewOwner();else if("CanAddRemoveAttachments"==e)a=this.searchWidget_CanAddRemoveAttachment.getNewOwner();else if("Read"==e)a=this.searchWidget_Read.getNewOwner();else if("Add"==e)a=this.searchWidget_Add.getNewOwner();else if("Basic"==e)a=this.searchWidget_Basic.getNewOwner();else if("ReadWrite"==e){a=this.searchWidget_ReadWrite.getNewOwner();e="Read Write"}else if("Remove"==e)a=this.searchWidget_Remove.getNewOwner();else if("AddRemove"==e){a=this.searchWidget_AddRemove.getNewOwner();e="Add Remove"}else if("Full"==e)a=this.searchWidget_Full.getNewOwner();else if("Leader"==e)a=this.searchWidget_Leader.getNewOwner();else if("Project Member"==e)a=this.searchWidget_Member.getNewOwner();else if("Project Lead"==e)a=this.searchWidget_ProjectLead.getNewOwner();else""==e&&(a=this.searchWidget.getNewOwner());if(null===a||""===a)return t;a.hasOwnProperty("userGrp")&&(a.group={groupURI:a.userGrp.id,groupTitle:a.userGrp.label},delete a.userGrp);var n=e,i=!0,r=this.ownerAlreadyExist(a);if(r.length>0){var o=r[0],s=o.Index;1==o.IsSame?this.listOfAddedMembers[s].ownership.access.logical===n?i=!1:this.listOfAddedMembers[s].ownership.access.logical!=n&&(s+=1,this.container.getElement("#addedItem"+s).hide(),this.DeleteUser(s)):(s+=1,this.container.getElement("#addedItem"+s).hide(),this.DeleteUser(s))}if(i){var c={ownership:{InitRights:"",operation:"ADD",owner:a,access:{logical:n}},isTrueComment:!0,isTrueInheritedPath:!0};this.listOfAddedMembers.push(c),t=!0}return t}},DeleteUser:function(e){if(!d.isProgressBusy()){var t=parseInt(e)-1;this.listOfAddedMembers.splice(t,1),this._ManageValidButton()}},createJSONArrayModif:function(){var e=[];if(1==this.isReadOnly)return e;for(var t=this.listOfAddedMembers.length,a=0;a<t;a++){var n=null,r=this.listOfAddedMembers[a];n=r.ownership.owner;var o=!0,s=!0;r.hasOwnProperty("isTrueComment")&&(o=r.isTrueComment),r.hasOwnProperty("isTrueInheritedPath")&&(s=r.isTrueInheritedPath);var c="";1==this.options.activeComment&&(c=this.table.getCellValue(lines[a],"Comments"));var l=r.ownership.InitRights,d="Reader";r.hasOwnProperty("ownership")&&(d=r.ownership.access.logical);var h=!1;null!=d&&""!=d||(h=!0);var p=!1;null!=l&&""!=l||(p=!0);var m=!1;if(""!=c&&c!=n.comment&&(m=!0),1==p&&0==h&&(1==m&&(n.comment=c),e.push({operation:{operation:"ADD",owner:n,access:{logical:d}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})),0==p&&1==h&&e.push({operation:{operation:"REMOVE",owner:n,access:{logical:"Empty"}},isTrueComment:o,isTrueInheritedPath:s,action:"REMOVE"}),0==p&&0==h)if(1==m){var u=i.decode(i.encode(n));u.comment=c,e.push({operation:{operation:"ADD",owner:u,access:{logical:d}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})}else d!=l&&e.push({operation:{operation:"ADD",owner:n,access:{logical:d}},isTrueComment:o,isTrueInheritedPath:s,action:"MODIFY"})}return e},ODTGetListOfItemsInTable:function(){return this.ShareController.getSelectedItemList().length},trackAppContent:function(e){var t={UXName:"Share",models:e};this.trackerEvent=E.createInitActionEvent(t,this.trackerEvent),E.checkAndTrackPageEvent(this.trackerEvent)}})});