define("DS/ENOXCADImport/utils/XMLToJsonChekinResConversion",["UWA/Class/Options","UWA/Class"],function(e,t){return t.singleton(e,{relationshipList:null,cyclicNodes:[],cyclicNodeData:{},cyclicInsNodes:[],cyclicInsNodeData:{},compNodes:[],compInsData:{},parentNode:[],parentNodeData:{},_nodeDataArray:null,relName:null,_cyclicArrayList:null,init:function(){},xmlToJson:function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0)for(var i=0;i<e.attributes.length;i++){var n=e.attributes.item(i);t[n.nodeName]=n.nodeValue}}else 3==e.nodeType?t=e.nodeValue:4==e.nodeType&&(t=e.nodeValue);var l=[].slice.call(e.childNodes).filter(function(e){return 3===e.nodeType});if(e.hasChildNodes()&&e.childNodes.length===l.length)t=[].slice.call(e.childNodes).reduce(function(e,t){return e+t.nodeValue},"");else if(e.hasChildNodes())for(var a=0;a<e.childNodes.length;a++){var r=e.childNodes.item(a),o=r.nodeName;if(void 0===t[o])t[o]=this.xmlToJson(r);else{if(void 0===t[o].push){var s=t[o];t[o]=[],t[o].push(s)}t[o].push(this.xmlToJson(r))}}return t},transform:function(e){this._nodeDataArray=[];var t=(new DOMParser).parseFromString(e,"text/xml");return this.checkDataNodes(t)},checkDataNodes:function(e){var t,i=this,n=i.xmlToJson(e),l="",a={jsondata:{}};if(i.cyclicNodeData.cyclicNodes=new Array,i.cyclicInsNodeData.cyclicInsNodes=new Array,n.response.info.request.cadobjectlist.cadobject.length>0){i.relationshipList=n.response.info.request.relationshiplist.relationship;let e=n.response.info.request.cadobjectlist.cadobject,r=n.response.info.request.structure,o=JSON.parse(n.response.info.mappinginfo["#cdata-section"]);a.jsondata.exportmap=o;let s=o.exportdata[0].mappinginfo.mapping;l=i.jsonforGridView(s,r,e),t=n.response.result}else l=n.response.info.reason,t=n.response.result;return a.jsondata.result=t,a.jsondata.data=l,a},jsonforGridView:function(e,t,i){var n,l=this,a=l.getJsonParentChild(t,e,i);return""!=e?"FileToFile"==e?n=l.getJsonNodeStructureForGrid(a,i,"family"):"NotFileToFile"===e&&(n=l.getJsonNodeStructureForGrid(l.compInsData.compNodes,i,"instance")):n=l.getJsonNodeStructureForGrid(a,i,""),n},getJsonParentChild:function(e,t,i){var n=this,l={};l.structure=new Array,n.parentNodeData.parentNode=new Array,n._cyclicArrayList=new Array;let a=e.active.cadobject,r=e.family.cadobject;if(null!=r)n.compInsData.compNodes=new Array,"FileToFile"===t?n.familyNodeArray(r,!0,l.structure,i):"NotFileToFile"===t&&n.familyNodeArray(r,!1,l.structure,i);else if(null==a.length){var o="|"+a.cadid+"|"+Date.now();if(l.structure.push({cadid:a.cadid,parentid:"",rowId:o}),null!=a.cadobject){let e=[];e.push(a.cadid),n.parentChildArray(a,e,l.structure)}}else{let e=[];for(var s=0;s<a.length;s++){o="|"+a[s].cadid+"|"+Date.now();e.includes(a[s].cadid)||(l.structure.push({cadid:a[s].cadid,parentid:"",rowId:o}),null!=a[s].cadobject&&(e.push(a[s].cadid),n.parentChildArray(a[s],e,l.structure)))}}return n._cyclicArrayList.length>0&&n.buildCyclicNodeData(l.structure,i),console.log(l.structure),l.structure},familyNodeArray:function(e,t,i,n){var l=this;let a=[],r=[];if(null==e.length){if("true"===e.firstentry&&null==e.childrenprocessed){var o="|"+e.cadid+"|"+Date.now();if(i.push({cadid:e.cadid,parentid:"",rowId:o,familyId:""}),null!=e.cadobject){let t=[];t.push(e.cadid),a.push(e.cadid),l.parentChildArray(e,t,i)}}}else for(var s=0;s<e.length;s++)if(Boolean(t)){if("true"===e[s].firstentry&&null==e[s].childrenprocessed)if(a.length>0&&a.includes(e[s].cadobject.cadid))l.cyclicInsNodeData.cyclicInsNodes.push({id:e[s].cadobject.cadid,parent:e[s].cadid,rid:e[s].cadobject.relationship.rid,familyId:""});else{o="|"+e[s].cadid+"|"+Date.now();if(i.push({cadid:e[s].cadid,parentid:"",rowId:o}),null!=e[s].cadobject){let t=[];t.push(e[s].cadid),a.push(e[s].cadid),l.parentChildArray(e[s],t,i)}}}else if("true"===e[s].firstentry&&null!=e[s].childrenprocessed){var d=e[s].cadobject;if(r.length>0&&r.includes(d.cadid))l.cyclicInsNodeData.cyclicInsNodes.push({id:d.cadid,parent:e[s].cadid,rid:d.relationship.rid,familyId:d.familyid});else{o="|"+e[s].cadid+"|"+Date.now();l.compInsData.compNodes.push({cadid:e[s].cadid,parentid:"",rowId:o,familyId:""}),r.length>0&&r.splice(0,r.length),r.push(e[s].cadid),d.length,l.parentChildFamilyInstanceArray(e[s].cadid,d)}}l._cyclicArrayList.length>0&&l.buildCyclicNodeData(i,n)},parentChildFamilyInstanceArray:function(e,t){if(null==t.length){var i=t.relationship.rid+"|"+t.cadid+"|"+Date.now();this.compInsData.compNodes.push({cadid:t.cadid,parentid:e,rowId:i,rid:t.relationship.rid,familyId:t.familyid}),null!=t.cadobject&&this.parentChildFamilyInstanceArray(e,t)}else for(var n=0;n<t.length;n++){i=t[n].relationship.rid+"|"+t[n].cadid+"|"+Date.now();this.compInsData.compNodes.push({cadid:t[n].cadid,parentid:e,rowId:i,rid:t[n].relationship.rid,familyId:t[n].familyid}),t[n].cadobject instanceof Object&&this.parentChildFamilyInstanceArray(e,t[n])}},parentChildArray:function(e,t,i){var n=this,l=e.cadid,a=e.cadobject;if(null==a.length){let e=n.parentNodeData.parentNode.find(e=>e.childid==a.cadid);if(t.includes(a.cadid))if(null!=e&&e.parentid==l)n.buildDataStructure(a,l,i);else{n.buildDataStructure(a,l,i);let e=a.relationship.rid+"|"+a.cadid;n._cyclicArrayList.push(e)}else t.push(a.cadid),n.buildDataStructure(a,l,i);n.parentNodeData.parentNode.push({childid:a.cadid,parentid:l}),null!=a.cadobject&&n.parentChildArray(a,t,i)}else for(var r=0;r<a.length;r++){let e=n.parentNodeData.parentNode.find(e=>e.childid==a[r].cadid);if(t.includes(a[r].cadid))if(null!=e&&e.parentid==l)n.buildDataStructure(a[r],l,i);else{n.buildDataStructure(a[r],l,i);let e=a[r].relationship.rid+"|"+a[r].cadid;n._cyclicArrayList.push(e)}else t.push(a[r].cadid),n.buildDataStructure(a[r],l,i);n.parentNodeData.parentNode.push({childid:a[r].cadid,parentid:l}),a[r].cadobject instanceof Object&&n.parentChildArray(a[r],t,i)}},buildDataStructure:function(e,t,i){var n=e.relationship.rid+"|"+e.cadid+"|"+Date.now();i.push({cadid:e.cadid,parentid:t,rowId:n,rid:e.relationship.rid})},buildCyclicNodeData:function(e,t){this.buildParentChildSkeleton(e);for(let t=0;t<e.length;t++)if(""!=e[t].parentid){let i=e[t].rid+"|"+e[t].cadid;if(this._cyclicArrayList.includes(i)){let i=e.find(i=>i.rid===e[t].rid);null!=i&&(this.cyclicNodeData.cyclicNodes.push({id:i.parentid,parent:i.cadid,rid:i.rid}),e.splice(e.indexOf(i),1))}}},buildParentChildSkeleton:function(e){for(var t,i={},n=e,l=[],a=0;t=n[a++];){var r=t.cadid,o=t.parentid;r in i?i[r]=2:-1!==Object.keys(i).indexOf(o)?i[r]=2:i[r]=1}for(a=0;a<Object.entries(i).length;a++)1==Object.entries(i)[a][1]&&l.push({id:Object.entries(i)[a][0]});for(a=0;a<l.length;a++){var s=l[a].id;for(let t=0;t<e.length;t++)if(""===e[t].parentid&&e[t].cadid!==s){e.splice(e.indexOf(e[t]),1);let i=e.find(e=>e.parentid===s),n=i.rid+"|"+i.cadid;this._cyclicArrayList.includes(n)&&this._cyclicArrayList.splice(this._cyclicArrayList.indexOf(n),1)}}},getJsonNodeStructureForGrid:function(e,t,i){var n=this;let l=[];var a={mappinginfo:{}},r={};r.structure=new Array;var o={};o.nodes=new Array;var s={};s.insNodes=new Array;var d={};d.familyNodes=new Array;var c={};c.linkNodes=new Array;for(var p=0;p<e.length;p++){let a,c,u=e[p].cadid,f=e[p].rowId,h=n.relationshipList.find(t=>t.rid==e[p].rid);null!=h&&(c=h.cadrelationship,a=h.reluuid);let m="";if(""!=e[p].parentid){m=t.find(t=>t.cadid==e[p].parentid).phid}if(null!=t.length){let h=t.find(e=>e.cadid==u);if(n.buildStructureJson(h,m,f,c,a,r.structure),n.buildNodesJson(h,f,o.nodes),""!=i)if("family"===i){let e=t.find(e=>e.familyid==u),i=e.cadid+"|"+Date.now();n.buildLinkTypeJson(e,h.phid,f,i,s.insNodes),n.buildNodesJson(e,i,o.nodes)}else if("instance"===i){let i=t.find(t=>t.cadid==e[p].cadid),a=i.familyid,r=i.phid,s=t.find(e=>e.cadid==a),c=s.cadid+"|"+Date.now();n.buildLinkTypeJson(s,r,f,c,d.familyNodes),l.includes(s.phid)||(n.buildNodesJson(s,c,o.nodes),l.push(s.phid))}}else if(t.cadid==u){n.buildStructureJson(t,m,f,c,a,r.structure),n.buildNodesJson(t,f,o.nodes);break}}if(a.mappinginfo.structure=r.structure,a.mappinginfo.nodes=o.nodes,n.cyclicInsNodeData.cyclicInsNodes.length>0){for(let e=0;e<n.cyclicInsNodeData.cyclicInsNodes.length;e++){let i=n.cyclicInsNodeData.cyclicInsNodes[e],l=t.find(e=>e.cadid==i.parent),a=t.find(e=>e.cadid==i.id);i.phid=a.phid,i.parent=l.phid,delete i.id}a.mappinginfo.circularlinks=n.cyclicInsNodeData.cyclicInsNodes,c.linkNodes.push("circularlinks")}else if(n.cyclicNodeData.cyclicNodes.length>0){for(let e=0;e<n.cyclicNodeData.cyclicNodes.length;e++){let i=n.cyclicNodeData.cyclicNodes[e],l=t.find(e=>e.cadid==i.parent),a=t.find(e=>e.cadid==i.id);i.phid=a.phid,i.parent=l.phid,delete i.id}a.mappinginfo.circularlinks=n.cyclicNodeData.cyclicNodes,c.linkNodes.push("circularlinks")}return s.insNodes.length>0&&(c.linkNodes.push("instances"),a.mappinginfo.instances=s.insNodes),d.familyNodes.length>0&&(c.linkNodes.push("family"),a.mappinginfo.family=d.familyNodes),c.linkNodes.length>0&&(a.mappinginfo.additionallinks=c.linkNodes),a},buildStructureJson:function(e,t,i,n,l,a){a.push({phid:e.phid,parent:t,rowid:i,relname:n,reluuid:l,type:""})},buildNodesJson:function(e,t,i){if(!this._nodeDataArray.includes(e.phid)){this._nodeDataArray.push(e.phid);let n=widget.getValue("nls_3dexptypes");i.push({phid:e.phid,rowid:t,title:e.title,type:n[e.mx_type],cadtype:e.type,hashcode:e.hashcode,filename:e.filename,uuid:e.uuid,dirname:e.dirname})}},buildLinkTypeJson:function(e,t,i,n,l){l.push({rowid:n,noderowid:i,phid:e.phid,parent:t})}})}),define("DS/ENOXCADImport/controller/SynchronizeDataGrid",["UWA/Class","UWA/Core"],function(e,t){var i=[],n=[],l=[];return e.extend({_exportDataGrid:null,_platformDataGrid:null,_supplierDataGrid:null,_oldHeight:null,_isPlatformGridRemoved:null,init:function(e){this._exportDataGrid=e.exportDataGrid,this._platformDataGrid=e.platformDataGrid,this._supplierDataGrid=e.supplierDataGrid},hideVerticalScroll:function(){document.querySelector(".export-grid-container .wux-layouts-collectionview.wux-controls-abstract .wux-layouts-body .wux-scroller").style.overflowY="hidden",document.querySelector(".platform-grid-container .wux-layouts-collectionview.wux-controls-abstract .wux-layouts-body .wux-scroller").style.overflowY="hidden"},controlGridView:function(e){var t=this;t._isPlatformGridRemoved=e,t._exportDataGrid.getTreeDocument().onPostExpand(function(){t.expandNodes({arguments:arguments,treeDoc:"exportDocument"})}),Boolean(t._isPlatformGridRemoved)||t._platformDataGrid.getTreeDocument().onPostExpand(function(){t.expandNodes({arguments:arguments,treeDoc:"platformDocument"})}),t._supplierDataGrid.getTreeDocument().onPostExpand(function(){t.expandNodes({arguments:arguments,treeDoc:"supplierDocument"})}),t._exportDataGrid.getTreeDocument().onPostCollapse(function(){t.checkScrollView("ExportGrid",!1),t.collapseNodes({arguments:arguments,treeDoc:"exportDocument"})}),Boolean(t._isPlatformGridRemoved)||t._platformDataGrid.getTreeDocument().onPostCollapse(function(){t.checkScrollView("PlatformGrid",!1),t.collapseNodes({arguments:arguments,treeDoc:"platformDocument"})}),t._supplierDataGrid.getTreeDocument().onPostCollapse(function(){t.collapseNodes({arguments:arguments,treeDoc:"supplierDocument"})}),t._supplierDataGrid._getScroller().onScroll(function(){let e=t._supplierDataGrid.getScrollerPosition();t._exportDataGrid.setScrollerPosition({y:e.y}),Boolean(t._isPlatformGridRemoved)||t._platformDataGrid.setScrollerPosition({y:e.y})})},expandNodes:function(e){var t=this;arguments=e.arguments;let a=e.treeDoc,r=arguments[0].data.nodeModel.options.grid.phid,o=i.indexOf(r),s=n.indexOf(r),d=l.indexOf(r);o>-1&&i.splice(o,1),s>-1&&n.splice(s,1),d>-1&&l.splice(d,1);let c=arguments[0].data.nodeModel.getNodeDepth();if("exportDocument"!==a){let e=t._exportDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null!=e&&"collapseState"!==e._expandState&&(e.expandNLevels({numberOfLevelsToExpand:c}),Boolean(t._isPlatformGridRemoved)||t.checkScrollView("PlatformGrid",!0))}if("platformDocument"!==a&&!Boolean(t._isPlatformGridRemoved)){let e=t._platformDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null!=e&&"collapseState"!==e._expandState&&(e.expandNLevels({numberOfLevelsToExpand:c}),t.checkScrollView("ExportGrid",!0))}if("supplierDocument"!==a){let e=t._supplierDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null!=e&&"collapseState"!==e._expandState&&e.expandNLevels({numberOfLevelsToExpand:c})}},collapseNodes:function(e){var t=this;arguments=e.arguments;let a=e.treeDoc,r=arguments[0].data.nodeModel.options.grid.phid,o=arguments[0].data.nodeModel.getNodeDepth();if("exportDocument"===a){if(i.push(r),!Boolean(t._isPlatformGridRemoved)){let e=t._platformDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null==e||n.includes(r)||(n.push(r),e.collapse({virtualRowID:o,notify:!0}))}let e=t._supplierDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null==e||l.includes(r)||(l.push(r),e.collapse({virtualRowID:o,notify:!0}))}if("platformDocument"===a){n.push(r);let e=t._exportDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null==e||i.includes(r)||(i.push(r),e.collapse({virtualRowID:o,notify:!0}));let a=t._supplierDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null==a||l.includes(r)||(l.push(r),a.collapse({virtualRowID:o,notify:!0}))}if("supplierDocument"===a){l.push(r);let e=t._exportDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);if(null==e||i.includes(r)||(i.push(r),e.collapse({virtualRowID:o,notify:!0})),!Boolean(t._isPlatformGridRemoved)){let e=t._platformDataGrid.getTreeDocument().getAllDescendants().find(e=>e.options.grid.phid==r);null==e||n.includes(r)||(n.push(r),e.collapse({virtualRowID:o,notify:!0}))}}},checkScrollView:function(e,t){let i,n=document.querySelector(".supplier-grid-container .wux-layouts-collectionview .wux-layouts-right-poolcontainer").style.height;"ExportGrid"===e&&(i=document.querySelector(".export-grid-container .wux-layouts-collectionview .wux-layouts-gridengine-poolcontainer-rel").style.height),"PlatformGrid"===e&&(i=document.querySelector(".platform-grid-container .wux-layouts-collectionview .wux-layouts-gridengine-poolcontainer-rel").style.height),Boolean(t)?(this._oldHeight=n,parseInt(i,10)>parseInt(n,10)&&this.showViewScroller(i,t)):this.showViewScroller(i,t)},showViewScroller:function(e,t){let i=document.documentElement.clientHeight,n=document.querySelector("#topContainer"),l=i-parseInt(document.defaultView.getComputedStyle(n).height,10)-52+"px";Boolean(t)?parseInt(e,10)>=parseInt(l,10)&&(document.querySelector(".supplier-grid-container .wux-layouts-collectionview .wux-layouts-gridengine-poolcontainer-rel").style.height=e,document.querySelector(".supplier-grid-container .wux-layouts-collectionview .wux-layouts-right-poolcontainer").style.height=e):parseInt(e,10)<=parseInt(l,10)&&(document.querySelector(".supplier-grid-container .wux-layouts-collectionview .wux-layouts-gridengine-poolcontainer-rel").style.height=e,document.querySelector(".supplier-grid-container .wux-layouts-collectionview .wux-layouts-right-poolcontainer").style.height=this._oldHeight)}})}),define("DS/ENOXCADImport/view/infoPanel/InfoPanelDialog",["UWA/Class/View","DS/ENOXCADUtils/utils/XCADModelEvents","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","css!DS/ENOXCADImport/assets/css/InfoPanelDialog"],function(e,t,i,n,l){"use strict";return e.extend({slideInfoPanel:"",setup:function(){this.slideInfoPanel=UWA.createElement("div",{id:"slideInfoContent",class:"slideInfo"})},launchInfoPanelDialog:function(e,a){var r=e,o=[n.FACET_PROPERTIES],s=new i({className:"enxpropertiestab",readOnly:!0,typeOfDisplay:n.ALL,selectionType:n.NO_SELECTION,facets:o,actions:[{name:"action_close_panel",text:"Close",icon:"close",handler:function(){document.getElementById("sidebar").classList.toggle("collapsed"),document.getElementById("slideInfoContent").destroy(),t.publish({event:"info-panel-close"})}}]});if(1===r.length){var d=new l({metatype:"businessobject",objectId:r[0].options.grid.phid,source:"3DSpace"});s.initDatas([d])}else 0===r.length&&s.initDatas([]);s.inject(this.slideInfoPanel),UWA.extendElement(this.slideInfoPanel).inject(a),document.getElementsByName("EditProp_MasterContain")[0].setAttribute("id","editPropContainer"),UWA.createElement("div",{id:"resizerDiv",class:"resizer"}).inject(this.slideInfoPanel)}})}),define("DS/ENOXCADImport/controller/JSONDataMapper",["UWA/Class/Options","UWA/Class"],function(e,t){return t.singleton(e,{init:function(){},parseData:function(e){let t=e.busTypeMapping,i=e.relTypeMapping,n=e.structureArray,l=e.nodesArray,a=e.instanceArray,r=e.familyArray,o=e.circularlinksArray,s=[];for(let e=0;e<l.length;e++){if(null!=l[e].info){let t=l[e].info;delete l[e].info,Object.assign(l[e],t)}let i=l[e].cadtype,n=t.find(e=>e.type==i);l[e].typeclass=n.class}for(let e=0;e<n.length;e++){if(null!=n[e].relname){let t=i.find(t=>t.type==n[e].relname);n[e].relclass=t.class}else n[e].relclass="";let t;n[e].relicon="",t=r.length>0&&null!=n[e].type?l.find(t=>t.rowid==n[e].rowid):l.find(t=>t.phid==n[e].phid);let a=Object.assign(n[e],t);s.push(a)}if(a.length>0)for(let e=0;e<a.length;e++){let t=l.find(t=>t.phid==a[e].phid),i=Object.assign(a[e],t),n=s.find(t=>t.phid==a[e].parent);null==n.instances&&Object.assign(n,{instances:[]}),n.instances.push(i)}if(r.length>0){var d=[].concat(s);for(let e=0;e<r.length;e++){let t,i;if(null!=r[e].noderowid){let n=l.find(t=>t.rowid==r[e].rowid);t=Object.assign(r[e],n),i=s.find(t=>t.rowid==r[e].noderowid)}else{let n=l.find(t=>t.phid==r[e].phid);t=Object.assign(r[e],n),i=d.find(t=>t.phid==r[e].parent)}d.splice(d.indexOf(i),1),null==i.family&&(Object.assign(i,{family:[]}),i.family.push(t))}if(d.length>0)for(let e=0;e<d.length;e++)if(null==d[e].family){let t=s.find(t=>t.instancename==d[e].instancename),i=s.find(t=>t.phid==d[e].phid);Object.assign(t,{family:[]}),t.family=[].concat(i.family)}}if(o.length>0)for(let e=0;e<o.length;e++){let t=l.find(t=>t.phid==o[e].phid),i=Object.assign(o[e],t),n=s.find(t=>t.phid==o[e].parent);null==n.circularlinks&&Object.assign(n,{circularlinks:[]}),n.circularlinks.push(i),n.cycliclinkicon="check"}return s},createSkeletonOfDataGrid:function(e){const t=[];return e.forEach(i=>{if(!i.parent)return t.push(i);null==i.child&&(i.child=[]);const n=e.findIndex(e=>e.phid===i.parent);if(!e[n].child)return e[n].child=[i];e[n].child.push(i)}),t}})}),define("DS/ENOXCADImport/utils/CheckinResMasterArray",["UWA/Class/Options","UWA/Class","i18n!DS/ENOXCADImport/assets/nls/ImportNLS"],function(e,t,i){return t.singleton(e,{_sMappingArray:null,_pMappingArray:null,_mappingArray:null,_supplierArray:null,_mSupplierArray:null,init:function(){},_relTypeMapping:null,buildJson:function(e,t){var i=this;return i._sMappingArray=[],i._pMappingArray=[],i._mappingArray=[],i._supplierArray=[],i._mSupplierArray=[],i._relTypeMapping=widget.getValue("relTypeMapping"),i.compareSupplierData(t,e),i.buildMasterArray(),{mappingArray:i._mappingArray,supplierArray:i._mSupplierArray}},compareSupplierData:function(e,t){var n=this;let l=[].concat(t),a=[].concat(e);for(let e=0;e<t.length;e++){let r=a.find(i=>i.phid==t[e].phid);null!=r&&(l.splice(l.indexOf(t[e]),1),a.splice(a.indexOf(r),1),n.compareAdditionalLinks(r,t[e],!0,t),n._sMappingArray.push(r),t[e].hashcode===r.hashcode?t[e].status=i.status_existing:t[e].status=i.status_modified,r.purpose===i.for_edit&&(t[e].import="",t[e].filepath=t[e].dirname),n._supplierArray.push(t[e]))}if(l.length>0)for(let e=0;e<l.length;e++)l[e].status=n.checkforStatus(l[e],t,!0),l[e].import="",l[e].filepath=l[e].dirname,n.checkForAdditionalLink(l[e]),n._supplierArray.push(l[e]),n._sMappingArray.push({phid:l[e].phid,parent:l[e].parent,title:"",typeclass:"",relclass:"",purpose:""});if(a.length>0)for(let e=0;e<a.length;e++){let i=n.checkforStatus(a[e],t,!1);n._sMappingArray.push(a[e]);let l="";null!=a[e].relclass&&(l=a[e].relclass);let r=[].concat(a[e].typeclass);n._supplierArray.push({phid:a[e].phid,parent:a[e].parent,title:a[e].title,typeclass:r,relclass:l,cadtype:a[e].cadtype,status:i})}},buildMasterArray:function(){var e=this;for(let t=0;t<e._sMappingArray.length;t++){e._mappingArray.push(e._sMappingArray[t]);let i=e._pMappingArray.find(i=>i.phid==e._sMappingArray[t].phid);null!=i&&e._pMappingArray.splice(e._pMappingArray.indexOf(i),1)}if(e._pMappingArray.length>0)for(let t=0;t<e._pMappingArray.length;t++)e._mappingArray.push(e._pMappingArray[t]);let t=[].concat(e._supplierArray);for(let i=0;i<e._mappingArray.length;i++){let n=t.find(t=>t.phid==e._mappingArray[i].phid);null==n?e._mSupplierArray.push({phid:e._mappingArray[i].phid,parent:e._mappingArray[i].parent,title:"",typeclass:"",relclass:"",status:""}):(e._mSupplierArray.push(n),t.splice(t.indexOf(n),1))}},compareAdditionalLinks:function(e,t,n,l){var a=this;function r(e,t,r,o){if(Boolean(r))if(null!=e)for(let t=0;t<e.length;t++)e[t].status=i.status_existing;else for(let e=0;e<t.length;e++)t[e].status=i.status_existing;else{let r=[].concat(e),s=[].concat(t);for(let e=0;e<t.length;e++){let l=r.find(i=>i.phid==t[e].phid);null!=l&&(r.splice(r.indexOf(l),1),s.splice(s.indexOf(t[e]),1),Boolean(n)?t[e].hashcode===l.hashcode?t[e].status=i.status_existing:t[e].status=i.status_modified:t[e][t[e].keyforfilesync]===l[l.keyforfilesync]?t[e].status=i.status_existing:t[e].status=i.status_modified)}if(s.length>0)for(let e=0;e<s.length;e++){let n=t.find(t=>t.phid==s[e].phid);if(Boolean(o)){let e=l.find(e=>e.phid===n.phid);n.status=null!=e?a.checkforStatus(e,l,!0):i.status_new}else n.status=i.status_new}if(r.length>0)for(let t=0;t<r.length;t++){let n=e.find(e=>e.phid==r[t].phid);if(Boolean(o)){let e=l.find(e=>e.phid===n.phid);n.status=null!=e?a.checkforStatus(e,l,!1):i.status_deleted}else n.status=i.status_deleted}}}null!=e.circularlinks&&null!=t.circularlinks?r(e.circularlinks,t.circularlinks,!1,!0):null!=e.circularlinks&&null==t.circularlinks?r(e.circularlinks,null,!0,!0):null==e.circularlinks&&null!=t.circularlinks&&r(null,t.circularlinks,!0,!0),null!=e.family&&null!=t.family?r(e.family,t.family,!1,!1):null!=e.family&&null==t.family?r(e.family,null,!0,!1):null==e.family&&null!=t.family&&r(null,t.family,!0,!1),null!=e.instances&&null!=t.instances?r(e.instances,t.instances,!1,!1):null!=e.instances&&null==t.instances?r(e.instances,null,!0,!1):null==e.instances&&null!=t.instances&&r(null,t.instances,!0,!1)},checkForAdditionalLink:function(e){function t(e){for(let t=0;t<e.length;t++)e[t].status=i.status_new}null!=e.circularlinks&&t(e.circularlinks),null!=e.family&&t(e.family),null!=e.instances&&t(e.instances)},checkforStatus:function(e,t,n){let l,a=this._relTypeMapping.find(t=>t.type==e.relname);if(null!=a&&a.class.includes("REL_INSTANCE_LIKE")){let i=t.some(t=>t.reluuid===e.reluuid);Boolean(i)&&(l=Boolean(n)?"Instance New":"Instance Deleted")}else l=Boolean(n)?i.status_new:i.status_deleted;return l}})}),define("DS/ENOXCADImport/view/toolbar/ImportToolBar",["UWA/Class/View","DS/Handlebars/Handlebars","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADUtils/XCADNotification","text!DS/ENOXCADImport/view/toolbar/html/ImportToolBar.html","i18n!DS/ENOXCADImport/assets/nls/ImportNLS","css!DS/ENOXCADImport/assets/css/ImportToolBar","css!DS/UIKIT/UIKIT.css"],function(e,t,i,n,l,a){"use strict";var r,o=t.compile(l),s=!1;return e.extend({name:"toolbar-view",className:function(){return this.getClassNames("-container")},tagName:"div",domEvents:{"click .information-panel":"informationIconClick","click .import-panel":"importIconClick","click .link-panel":"linkIconClick","click .importzip-panel":"zipIconClick"},init:function(e){for(var t in e._self=this,this._subscribe(),this._exportModel=e.exportModel,this._platformModel=e.platformModel,this._supplierModel=e.supplierModel,e)this[t]=e[t];this._parent(e)},setup:function(e){UWA.is(e.className)&&this.container.addClassName(e.className),e.information_nls_name=a.toolbar_info,e.import_nls_name=a.toolbar_import,e.link_nls_name=a.toolbar_link,e.importzip_nls_name=a.toolbar_importzip,this.container.setHTML(o(e))},render:function(e){return this},_subscribe:function(){i.subscribe({event:"import-info-panel-close"},function(){r.classList.contains("selected")&&r.classList.remove("selected")})},informationIconClick:function(){let e=this.getSelectedNodeModel();var t=this.container.getElement(".information-panel");t&&(t=t.getElement(".fonticon"),r=t,t.classList.contains("selected")?(s=!0,t.classList.remove("selected")):(s=!1,t.classList.add("selected"))),s?(document.getElementById("sidebar").classList.toggle("collapsed"),document.getElementById("slideInfoContent").destroy(),i.publish({event:"import-info-panel-close"})):i.publish({event:"import-info-panel-open",data:e})},importIconClick:function(){let e=[];if(this.container.getElement(".import-panel")){let t=this._supplierModel.getAllDescendants(),l=this.checkSelectValidation(t,e);if(Boolean(l)&&e.length>0){let t={operation:"copyselecteddata",version:"1.0",data:{selectioninfo:e}};i.publish({event:"webinwin:web:notification",data:t}),i.publish({event:"xcad-loader-on"})}else n.warningMsg(a.copy_info)}},checkSelectValidation:function(e,t){let i=[];for(let n=0;n<e.length;n++)if(""!=e[n].options.grid.parent){let l=e.find(t=>t.options.grid.phid===e[n].options.grid.parent);if(!Boolean(l.options.grid.import)||!Boolean(e[n].options.grid.import)){i.push(!1);break}i.push(!0),t.push({phid:e[n].options.grid.phid,filepath:e[n].options.grid.filepath})}else Boolean(e[n].options.grid.import)&&t.push({phid:e[n].options.grid.phid,filepath:e[n].options.grid.filepath});return!(i.length>0&&i.includes(!1))},linkIconClick:function(){let e=this.getSelectedNodeModel();this.container.getElement(".link-panel")&&i.publish({event:"import-additional-links-panel-open",data:e})},zipIconClick:function(){if(this.container.getElement(".importzip-panel")){let e={operation:"importcriteria",version:"1.0"};i.publish({event:"webinwin:web:notification",data:e}),i.publish({event:"xcad-loader-on"})}},getSelectedNodeModel:function(){return this._exportModel.getSelectedNodes().length>0?this._exportModel.getSelectedNodes():this._platformModel.getSelectedNodes().length>0?this._platformModel.getSelectedNodes():this._supplierModel.getSelectedNodes().length>0?this._supplierModel.getSelectedNodes():void 0},getBodyContent:function(){return this.container.getElement(".body-content")}})}),define("DS/ENOXCADImport/view/additionalLinks/AdditionalLinksDialog",["UWA/Core","UWA/Class","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/ENOXCADUtils/XCADIconsPath","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","text!DS/ENOXCADImport/assets/exportColumn.json","text!DS/ENOXCADImport/assets/platformColumn.json","text!DS/ENOXCADImport/assets/supplierColumn.json","i18n!DS/ENOXCADImport/assets/nls/ImportNLS","css!DS/ENOXCADImport/assets/css/AdditionalLinks"],function(e,t,i,n,l,a,r,o,s,d,c,p,u,f){"use strict";return t.extend({additionalLinks:null,_exportDataGrid:null,_platformDataGrid:null,_supplierDataGrid:null,_exportModel:null,_platformModel:null,_supplierModel:null,_mappingData:null,_platformData:null,_supplierData:null,_columnMap:null,_isplatformDataPresent:null,init:function(){this._exportModel=new n,this._platformModel=new n,this._supplierModel=new n,this.linksPanel=new e.Element("div",{id:"linksDiv",class:"links-conatiner"})},launchDialog:function(t){var i=this;null==t.platformData?i._isplatformDataPresent=!1:i._isplatformDataPresent=!0,i.createView(),i._mappingData=t.mappingData,Boolean(i._isplatformDataPresent)&&(i._platformData=t.platformData),i._supplierData=t.supplierData,i.additionalLinks=t.additionalLinks,i.selectLinkTypeToFillGrid(i.additionalLinks[0]);let n=e.createElement("div",{class:"customize-headercontent"}).inject(this.linksPanel);i._renderComboBox(n);let l=t.title+" -  "+f.toolbar_link,a=new o({identifier:"WebUIPanelDocumentation_MaximizableDialog"}),r=new s({immersiveFrame:a,title:l,content:this.linksPanel,width:710,height:300,resizableFlag:!0,identifier:"WebUIPanelDocumentation_maximizableDialog",maximizeButtonFlag:!0,buttons:{Close:new d({onClick:function(e){r.close(),a.destroy()}})}});r.addEventListener("close",function(e){r.destroy(),a.destroy()}),a.inject(document.getElementById("mainContainer")),document.querySelector(".CustomizeProfile_Container .wux-controls-combobox-mainelement").style.width="120px",document.querySelector(".CustomizeProfile_Container .wux-controls-combobox-mainelement").style.background="white"},_renderComboBox:function(t){this.customizeProfileContainer=e.createElement("div",{class:"CustomizeProfile_Container item"}),this._profileCombobox&&this._profileCombobox.removeEventListener("change",this._handleProfileChange);for(var n=[],l=0;l<this.additionalLinks.length;l++)"instances"==this.additionalLinks[l]&&n.push(f.key_instances),"circularlinks"==this.additionalLinks[l]&&n.push(f.key_circularlinks),"family"==this.additionalLinks[l]&&n.push(f.key_family);var a={elementsList:n,enableSearchFlag:!1,selectedIndex:0,reachablePlaceholderFlag:!0,touchMode:!0};this._profileCombobox=new i(a),this._profileCombobox.addEventListener("change",this._handleProfileChange.bind(this)),this._profileCombobox.inject(this.customizeProfileContainer),this.customizeProfileContainer.inject(t)},createView:function(){var t=this;let i,n,l,a=JSON.parse(c),r=JSON.parse(p),o=JSON.parse(u);a[0].children.splice(1,1),a[0].children.splice(1,1),r[0].children.splice(1,1),r[0].children.splice(1,1),o[0].children.splice(1,1),o[0].children.splice(1,1),o.splice(1,1),Boolean(t._isplatformDataPresent)?(i=new e.Element("div",{class:"egrid-container"}),n=new e.Element("div",{class:"pgrid-container"}),l=new e.Element("div",{class:"sgrid-container"})):(i=new e.Element("div",{class:"expgrid-container"}),l=new e.Element("div",{class:"supgrid-container"})),i.inject(this.linksPanel),t._exportDataGrid=t.setDataGridView(a,i,t._exportModel),t.setColumnsNls(t._exportDataGrid),Boolean(t._isplatformDataPresent)&&(n.inject(this.linksPanel),t._platformDataGrid=t.setDataGridView(r,n,t._platformModel),t.setColumnsNls(t._platformDataGrid)),l.inject(this.linksPanel),t._supplierDataGrid=t.setDataGridView(o,l,t._supplierModel),t.setColumnsNls(t._supplierDataGrid)},setDataGridView:function(e,t,i){var n=this;n.columnsMap(e);let l=new a({identifier:"dataGridView",treeDocument:i,cellSelection:"none",rowSelection:"single",rowDragEnabledFlag:!0,columns:e,defaultColumnDef:{width:"auto",resizableFlag:!0,sortableFlag:!1},showNodeKPIColorFlag:!0,showModelChangesFlag:!0,showRowBorderFlag:!0,getCellTooltip:function(e){return e.nodeModel?n._columnMap.has(e.columnID)?{shortHelp:e.nodeModel.options.grid[n._columnMap.get(e.columnID)],updateModel:!1}:void 0:{shortHelp:e.cellModel,updateModel:!1}}});return l.layout.columnHeaderHeight=25,l.layout.cellHeight=30,l.layout.rowsHeader=!1,l.inject(t),l},setColumnsNls:function(e){let t=e.columns;for(let e=0;e<t.length;e++){let i=t[e].dataIndex;if(t[e].text=f[i],null!=t[e].children){let i=t[e].children;for(let e=0;e<i.length;e++){let t=i[e].dataIndex;i[e].text=f[t]}}}},columnsMap:function(e){this._columnMap=new Map;for(var t=0;t<e.length;t++)if(null!=e[t].children){let i=e[t].children;for(let e=0;e<i.length;e++)""!=i[e].text&&"tree"==i[e].dataIndex&&this._columnMap.set(e,"title")}},selectLinkTypeToFillGrid:function(e){var t=this;let i=[],n=[],l=[];"circularlinks"===e?(null!=t._mappingData.circularlinks&&(i=t._mappingData.circularlinks),Boolean(t._isplatformDataPresent)&&null!=t._platformData.circularlinks&&(n=t._platformData.circularlinks),null!=t._supplierData.circularlinks&&(l=t._supplierData.circularlinks)):"family"===e?(null!=t._mappingData.family&&(i=t._mappingData.family),Boolean(t._isplatformDataPresent)&&null!=t._platformData.family&&(n=t._platformData.family),null!=t._supplierData.family&&(l=t._supplierData.family)):"instances"===e&&(null!=t._mappingData.instances&&(i=t._mappingData.instances),Boolean(t._isplatformDataPresent)&&null!=t._platformData.instances&&(n=t._platformData.instances),null!=t._supplierData.instances&&(l=t._supplierData.instances)),t.fillGridData(i,t._exportModel),Boolean(t._isplatformDataPresent)&&t.fillGridData(n,t._platformModel),t.fillGridData(l,t._supplierModel),Boolean(t._isplatformDataPresent)&&t.updateCellKPIColor(t._platformDataGrid),t.updateCellKPIColor(t._supplierDataGrid);let a=document.getElementsByClassName("wux-datagridview-emptycontentmessage");if(a.length>0)for(let e=0;e<a.length;e++)a[e].innerText=""},fillGridData:function(e,t){let i=JSON.parse(document.getElementById("xcadInfra").innerText);if(e.length>0){t.prepareUpdate();for(var n=0;n<e.length;n++){let a=new l({label:e[n].title,icons:[{iconPath:r.getTypeIconPath(i.url3DSpace,e[n],widget.getValue("icons_nonPStypes"))}],grid:e[n]});t.addChild(a)}t.expandAll(),t.pushUpdate()}},updateCellKPIColor:function(e){e.getColumnOrGroup("status").getCellKPIColor=function(e){let t=e.nodeModel.getAttributeValue("status");return"New"===t?"blue":"Existing"===t?"green":"Modified"===t?"orange":"Deleted"===t?"red":void 0}},_handleProfileChange:function(){var e=this,t=e._profileCombobox.value;t==f.key_instances&&(e.clearGrid(),e.selectLinkTypeToFillGrid("instances")),t==f.key_circularlinks&&(e.clearGrid(),e.selectLinkTypeToFillGrid("circularlinks")),t==f.key_family&&(e.clearGrid(),e.selectLinkTypeToFillGrid("family"))},clearGrid:function(){let e=this._exportDataGrid.getTreeDocument().getChildren();if(e.splice(0,e.length),Boolean(this._isplatformDataPresent)){let e=this._platformDataGrid.getTreeDocument().getChildren();e.splice(0,e.length)}let t=this._supplierDataGrid.getTreeDocument().getChildren();t.splice(0,t.length)}})}),define("DS/ENOXCADImport/utils/CreateMasterArray",["UWA/Class/Options","UWA/Class","i18n!DS/ENOXCADImport/assets/nls/ImportNLS"],function(e,t,i){return t.singleton(e,{_sMappingArray:null,_pMappingArray:null,_mappingArray:null,_supplierArray:null,_mSupplierArray:null,_platformArray:null,_mPlatformArray:null,_relTypeMapping:null,init:function(){},buildJson:function(e,t,i){var n=this;return n._sMappingArray=[],n._pMappingArray=[],n._mappingArray=[],n._supplierArray=[],n._mSupplierArray=[],n._platformArray=[],n._mPlatformArray=[],n._relTypeMapping=widget.getValue("relTypeMapping"),n.compareSupplierData(t,e),n.compare3DExperienceData(t,i),n.buildMasterArray(),{mappingArray:n._mappingArray,platformArray:n._mPlatformArray,supplierArray:n._mSupplierArray}},compareSupplierData:function(e,t){var n=this;let l=[].concat(t),a=[].concat(e);for(let e=0;e<t.length;e++){let r=a.find(i=>i.phid==t[e].phid);null!=r&&(l.splice(l.indexOf(t[e]),1),a.splice(a.indexOf(r),1),n.compareAdditionalLinks(r,t[e],!0,t),n._sMappingArray.push(r),t[e].hashcode===r.hashcode?t[e].status=i.status_existing:t[e].status=i.status_modified,r.purpose===i.for_edit&&(t[e].import="",t[e].filepath=t[e].dirname),n._supplierArray.push(t[e]))}if(l.length>0)for(let e=0;e<l.length;e++)l[e].status=n.checkforStatus(l[e],t,!0),l[e].import="",l[e].filepath=l[e].dirname,n.checkForAdditionalLink(l[e],t),n._supplierArray.push(l[e]),n._sMappingArray.push({phid:l[e].phid,parent:l[e].parent,title:"",typeclass:"",relclass:"",purpose:""});if(a.length>0)for(let e=0;e<a.length;e++){let i=n.checkforStatus(a[e],t,!1);n._sMappingArray.push(a[e]);let l="";null!=a[e].relclass&&(l=a[e].relclass);let r=[].concat(a[e].typeclass);n._supplierArray.push({phid:a[e].phid,parent:a[e].parent,title:a[e].title,typeclass:r,relclass:l,cadtype:a[e].cadtype,status:i})}},compare3DExperienceData:function(e,t){var n=this;let l=[].concat(e),a=[].concat(t);for(let e=0;e<t.length;e++){let r=l.find(i=>i.phid==t[e].phid);null!=r&&(a.splice(a.indexOf(t[e]),1),l.splice(l.indexOf(r),1),n.compareAdditionalLinks(r,t[e],!1,t),n._pMappingArray.push(r),t[e][t[e].keyforfilesync]===r[r.keyforfilesync]?t[e].status=i.status_existing:t[e].status=i.status_modified,n._platformArray.push(t[e]))}if(a.length>0)for(let e=0;e<a.length;e++)a[e].status=n.checkforStatus(a[e],t,!0),n.checkForAdditionalLink(a[e],t),n._platformArray.push(a[e]),n._pMappingArray.push({phid:a[e].phid,parent:a[e].parent,title:"",typeclass:"",relclass:"",purpose:""});if(l.length>0)for(let e=0;e<l.length;e++){let i=n.checkforStatus(l[e],t,!1);n._pMappingArray.push(l[e]);let a="";null!=l[e].relclass&&(a=l[e].relclass);let r=[].concat(l[e].typeclass);n._platformArray.push({phid:l[e].phid,parent:l[e].parent,title:l[e].title,rev:l[e].rev,typeclass:r,relclass:a,cadtype:l[e].cadtype,partnumber:"",status:i})}},buildMasterArray:function(){var e=this;for(let t=0;t<e._sMappingArray.length;t++){e._mappingArray.push(e._sMappingArray[t]);let i=e._pMappingArray.find(i=>i.phid==e._sMappingArray[t].phid);null!=i&&e._pMappingArray.splice(e._pMappingArray.indexOf(i),1)}if(e._pMappingArray.length>0)for(let t=0;t<e._pMappingArray.length;t++)e._mappingArray.push(e._pMappingArray[t]);let t=[].concat(e._platformArray),i=[].concat(e._supplierArray);for(let n=0;n<e._mappingArray.length;n++){let l=t.find(t=>t.phid==e._mappingArray[n].phid),a=i.find(t=>t.phid==e._mappingArray[n].phid);null==l?e._mPlatformArray.push({phid:e._mappingArray[n].phid,parent:e._mappingArray[n].parent,title:"",typeclass:"",relclass:"",rev:"",partnumber:"",status:""}):(e._mPlatformArray.push(l),t.splice(t.indexOf(l),1)),null==a?e._mSupplierArray.push({phid:e._mappingArray[n].phid,parent:e._mappingArray[n].parent,title:"",typeclass:"",relclass:"",status:""}):(e._mSupplierArray.push(a),i.splice(i.indexOf(a),1))}},compareAdditionalLinks:function(e,t,n,l){var a=this;function r(e,t,r,o){if(Boolean(r))if(null!=e)for(let t=0;t<e.length;t++)e[t].status=i.status_existing;else for(let e=0;e<t.length;e++)t[e].status=i.status_existing;else{let r=[].concat(e),s=[].concat(t);for(let e=0;e<t.length;e++){let l=r.find(i=>i.phid==t[e].phid);null!=l&&(r.splice(r.indexOf(l),1),s.splice(s.indexOf(t[e]),1),Boolean(n)?t[e].hashcode===l.hashcode?t[e].status=i.status_existing:t[e].status=i.status_modified:t[e][t[e].keyforfilesync]===l[l.keyforfilesync]?t[e].status=i.status_existing:t[e].status=i.status_modified)}if(s.length>0)for(let e=0;e<s.length;e++){let n=t.find(t=>t.phid==s[e].phid);if(Boolean(o)){let e=l.find(e=>e.phid===n.phid);n.status=null!=e?a.checkforStatus(e,l,!0):i.status_new}else n.status=i.status_new}if(r.length>0)for(let t=0;t<r.length;t++){let n=e.find(e=>e.phid==r[t].phid);if(Boolean(o)){let e=l.find(e=>e.phid===n.phid);n.status=null!=e?a.checkforStatus(e,l,!1):i.status_deleted}else n.status=i.status_deleted}}}null!=e.circularlinks&&null!=t.circularlinks?r(e.circularlinks,t.circularlinks,!1,!0):null!=e.circularlinks&&null==t.circularlinks?r(e.circularlinks,null,!0,!0):null==e.circularlinks&&null!=t.circularlinks&&r(null,t.circularlinks,!0,!0),null!=e.family&&null!=t.family?r(e.family,t.family,!1,!1):null!=e.family&&null==t.family?r(e.family,null,!0,!1):null==e.family&&null!=t.family&&r(null,t.family,!0,!1),null!=e.instances&&null!=t.instances?r(e.instances,t.instances,!1,!1):null!=e.instances&&null==t.instances?r(e.instances,null,!0,!1):null==e.instances&&null!=t.instances&&r(null,t.instances,!0,!1)},checkForAdditionalLink:function(e,t){function n(e){for(let t=0;t<e.length;t++)e[t].status=i.status_new}null!=e.circularlinks&&n(e.circularlinks),null!=e.family&&n(e.family),null!=e.instances&&n(e.instances)},checkforStatus:function(e,t,n){let l,a=this._relTypeMapping.find(t=>t.type==e.relname);if(null!=a&&a.class.includes("REL_INSTANCE_LIKE")){let i=t.some(t=>t.reluuid===e.reluuid);Boolean(i)&&(l=Boolean(n)?"Instance New":"Instance Deletion")}else l=Boolean(n)?i.status_new:i.status_deleted;return l}})}),define("DS/ENOXCADImport/utils/XMLToJsonExpandResConversion",["UWA/Class/Options","UWA/Class"],function(e,t){return t.singleton(e,{cyclicNodes:[],cyclicNodeData:{},compInsExpandNodes:[],compInsExpandData:{},relName:null,_mapping:null,parentNode:[],parentNodeData:{},_nodeDataArray:null,_cyclicArrayList:null,init:function(){},xmlToJson:function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0)for(var i=0;i<e.attributes.length;i++){var n=e.attributes.item(i);t[n.nodeName]=n.nodeValue}}else 3==e.nodeType?t=e.nodeValue:4==e.nodeType&&(t=e.nodeValue);var l=[].slice.call(e.childNodes).filter(function(e){return 3===e.nodeType});if(e.hasChildNodes()&&e.childNodes.length===l.length)t=[].slice.call(e.childNodes).reduce(function(e,t){return e+t.nodeValue},"");else if(e.hasChildNodes())for(var a=0;a<e.childNodes.length;a++){var r=e.childNodes.item(a),o=r.nodeName;if(void 0===t[o])t[o]=this.xmlToJson(r);else{if(void 0===t[o].push){var s=t[o];t[o]=[],t[o].push(s)}t[o].push(this.xmlToJson(r))}}return t},transform:function(e){this._nodeDataArray=[];var t=(new DOMParser).parseFromString(e,"text/xml");return this.checkDataNodes(t)},checkDataNodes:function(e){var t,i=this,n=i.xmlToJson(e),l="",a={jsondata:{}},r=n.response.cse,o=n.response.expandrel;if(i.cyclicNodeData.cyclicNodes=new Array,"CATIAV5UPS"!==r&&("FileToFile"!==o?(i.compInsExpandData.compInsExpandNodes=new Array,i._mapping="NotFileToFile"):"FileToFile"===o&&(i._mapping="FileToFile")),"success"==n.response.result){var s=n.response.info.relationshiplist.relationship,d=n.response.info.cadobjectlist.cadobject,c=n.response.info.structure.cadobject,p=i.getJsonFromStructure(c,d);l=i.jsonforGridView(s,d,p),t=n.response.result}else l=n.response.info.reason,t=n.response.result;return a.jsondata.result=t,a.jsondata.data=l,a},getJsonFromStructure:function(e,t){return this.getJsonParentChild(e,t)},jsonforGridView:function(e,t,i){var n=this.buildParentChildSkeleton(i),l=this.buildComponentDataMap(n,e),a=this.checkforFamilyid(n,t);return this.getJsonNodeStructureForGrid(a,t,l)},getJsonParentChild:function(e,t){var i=this,n={};if(n.structure=new Array,i.parentNodeData.parentNode=new Array,i._cyclicArrayList=new Array,null==e.length){var l="|"+e.cadid+"|"+Date.now();if(n.structure.push({cadid:e.cadid,parentid:"",rowId:l,familyId:""}),null!=e.cadobject)(r=[]).push(e.cadid),i.parentChildArray(e,r,t,n.structure)}else for(var a=0;a<e.length;a++){var r;l="|"+e[a].cadid+"|"+Date.now();if(n.structure.push({cadid:e[a].cadid,parentid:"",rowId:l,familyId:""}),null!=e[a].cadobject)(r=[]).push(e[a].cadid),i.parentChildArray(e[a],r,t,n.structure)}return i._cyclicArrayList.length>0&&i.buildCyclicNodeData(n.structure,t),console.log(n.structure),n.structure},parentChildArray:function(e,t,i,n){var l=this;let a=e.cadid,r=e.cadobject;i.find(e=>e.cadid==a);if(null==r.length){let e=l.parentNodeData.parentNode.find(e=>e.childid==r.cadid);if(t.includes(r.cadid))if(null!=e&&e.parentid==a)l.buildDataStrcuture(r,a,n);else{l.buildDataStrcuture(r,a,n);let e=r.relationship.rid+"|"+r.cadid;l._cyclicArrayList.push(e)}else t.push(r.cadid),l.buildDataStrcuture(r,a,n);l.parentNodeData.parentNode.push({childid:r.cadid,parentid:a}),null!=r.cadobject&&l.parentChildArray(r,t,i,n)}else for(var o=0;o<r.length;o++){let e=l.parentNodeData.parentNode.find(e=>e.childid==r[o].cadid);if(t.includes(r[o].cadid))if(null!=e&&e.parentid==a)l.buildDataStrcuture(r[o],a,n);else{l.buildDataStrcuture(r[o],a,n);let e=r[o].relationship.rid+"|"+r[o].cadid;l._cyclicArrayList.push(e)}else t.push(r[o].cadid),l.buildDataStrcuture(r[o],a,n);l.parentNodeData.parentNode.push({childid:r[o].cadid,parentid:a}),r[o].cadobject instanceof Object&&l.parentChildArray(r[o],t,i,n)}},buildDataStrcuture:function(e,t,i){var n=e.relationship.rid+"|"+e.cadid+"|"+Date.now();i.push({cadid:e.cadid,parentid:t,rowId:n,rid:e.relationship.rid,familyId:""})},buildCyclicNodeData:function(e,t){var i=this;for(let n=0;n<e.length;n++)if(""!=e[n].parentid){let l=e[n].rid+"|"+e[n].cadid;if(i._cyclicArrayList.includes(l)){let l=e.find(t=>t.parentid===e[n].cadid);if(null!=l){t.find(e=>e.cadid==l.cadid);null!=i.compInsExpandData.compInsExpandNodes?(i.cyclicNodeData.cyclicNodes.push({id:l.cadid,parent:l.parentid,rid:l.rid}),i.compInsExpandData.compInsExpandNodes.push({cadid:l.cadid,parent:l.parentid,rowid:l.rowId,rid:l.rid})):i.cyclicNodeData.cyclicNodes.push({id:l.cadid,parent:l.parentid,rid:l.rid}),e.splice(n,1)}}}},buildParentChildSkeleton:function(e){for(var t,i={},n=e,l=[],a=0;t=n[a++];){var r=t.cadid,o=t.parentid;r in i?i[r]=2:-1!==Object.keys(i).indexOf(o)?i[r]=2:i[r]=1}for(a=0;a<Object.entries(i).length;a++)1==Object.entries(i)[a][1]&&l.push({id:Object.entries(i)[a][0]});var s=[];for(a=0;a<l.length;a++){var d=l[a].id,c=e.filter(e=>e.cadid===d);s.push(c[0]);var p=e.filter(e=>e.parentid===d);if(null!=p)for(var u=0;u<p.length;u++)s.push(p[u])}var f=[].concat(s);return this.childResultData(e,s,f),s},childResultData:function(e,t,i){for(var n=[],l=0;l<i.length;l++)if(""!=i[l].parentid){var a=i[l].cadid,r=e.filter(e=>e.parentid===a);if(null!=r)for(var o=0;o<r.length;o++)t.push(r[o]),n.push(r[o])}null!=n&&n.length>0&&this.childResultData(e,t,n)},buildComponentDataMap:function(e,t){var i=this;i.relName=new Map;var n={};n.structure=new Array;for(var l=[].concat(t),a=0;a<e.length;a++){var r=e[a].rid,o=e[a].cadid;if(null!=r)for(var s=0;s<l.length;s++)if(l[s].rid==r){i.relName.set(o,[l[s].cadrelationship,l[s].reluuid]),void 0===(d=l[s].attribute.find(function(e){if("componentID"==e.name)return e.value}).value["#cdata-section"])&&(d=""),n.structure.push({cadid:o,instanceName:d}),l.splice(s,1);break}}if(null!=i.compInsExpandData.compInsExpandNodes&&i.compInsExpandData.compInsExpandNodes.length>0&&l.length>0)for(a=0;a<i.compInsExpandData.compInsExpandNodes.length;a++){r=i.compInsExpandData.compInsExpandNodes[a].rid;var d,c=t.find(e=>e.rid==r);void 0===(d=c.attribute.find(function(e){if("componentID"==e.name)return e.value}).value["#cdata-section"])&&(d=""),i.compInsExpandData.compInsExpandNodes[a].relname=c.cadrelationship,i.compInsExpandData.compInsExpandNodes[a].reluuid=c.reluuid,i.compInsExpandData.compInsExpandNodes[a].instancename=d}return n.structure},checkforFamilyid:function(e,t){for(var i=0;i<e.length;i++){var n=e[i].cadid;null!=this._mapping&&("FileToFile"===this._mapping?(e[i].familyId=n,e[i].linkType="instance"):(e[i].familyId=n,e[i].linkType="family"))}return e},getJsonNodeStructureForGrid:function(e,t,i){var n=this,l={mappinginfo:{}},a={};a.structure=new Array;var r={};r.nodes=new Array;var o={};o.insNodes=new Array;var s={};s.familyNodes=new Array;var d={};d.linkNodes=new Array;for(var c=0;c<e.length;c++){let l,d,u=e[c].cadid,f=e[c].parentid,h=e[c].rowId;e[c].familyId;null!=n.relName.get(u)&&(d=n.relName.get(u)[0],l=n.relName.get(u)[1]);let m=e[c].linkType;var p="";if(null!=i)for(let e=0;e<i.length;e++)if(u==i[e].cadid){p=i[e].instanceName,i.splice(e,1);break}if(null!=t.length){let e=t.find(e=>e.cadid==u);if(n.buildStructureJson(e,f,p,d,h,l,a.structure),n.buildNodesJson(e,h,r.nodes),null!=m)if("instance"===m){let i=t.find(e=>e.familyid==u),l=i.cadid+"|"+Date.now();n.buildLinkTypeJson(i,e.cadid,l,o.insNodes),n.buildNodesJson(i,l,r.nodes)}else if("family"===m){let e=t.find(e=>e.cadid==u),i=e.familyid,l=t.find(e=>e.cadid==i),a=l.cadid+"|"+Date.now();n.buildLinkTypeJson(l,e.cadid,a,s.familyNodes),n.buildNodesJson(l,a,r.nodes)}}else if(t.cadid==u){n.buildStructureJson(t,f,p,d,h,l,a.structure),n.buildNodesJson(t,h,r.nodes);break}}if(null!=n.compInsExpandData.compInsExpandNodes&&n.compInsExpandData.compInsExpandNodes.length>0)for(c=0;c<n.compInsExpandData.compInsExpandNodes.length;c++){var u=n.compInsExpandData.compInsExpandNodes[c];""!=u.instancename&&n.buildStructureJson(u,u.parent,u.instancename,u.relname,u.rowid,u.reluuid,a.structure)}if(l.mappinginfo.structure=a.structure,l.mappinginfo.nodes=r.nodes,o.insNodes.length>0&&(l.mappinginfo.instances=o.insNodes,d.linkNodes.push("instances")),s.familyNodes.length>0&&(l.mappinginfo.family=s.familyNodes,d.linkNodes.push("family")),n.cyclicNodeData.cyclicNodes.length>0){for(let e=0;e<n.cyclicNodeData.cyclicNodes.length;e++){let t=n.cyclicNodeData.cyclicNodes[e];t.phid=t.id,delete t.id}l.mappinginfo.circularlinks=n.cyclicNodeData.cyclicNodes,d.linkNodes.push("circularlinks")}return d.linkNodes.length>0&&(l.mappinginfo.additionallinks=d.linkNodes),l},buildStructureJson:function(e,t,i,n,l,a,r){let o=e.phid;if(null==o){let e=l.substring(l.indexOf("|")+1);o=e.substring(0,e.indexOf("|"))}r.push({phid:o,parent:t,rowid:l,relname:n,reluuid:a,instancename:i})},buildNodesJson:function(e,t,i){if(!this._nodeDataArray.includes(e.phid)){this._nodeDataArray.push(e.phid);let n=widget.getValue("nls_designpolicystates"),l=widget.getValue("nls_3dexptypes"),a=e.PartNumber["#cdata-section"];null==a&&(a=""),i.push({phid:e.phid,rowid:t,title:e.Title["#cdata-section"],rev:e.Rev["#cdata-section"],type:l[e.Type["#cdata-section"]],cadtype:e.type,partnumber:a,owner:e.Owner["#cdata-section"],name:e.Name["#cdata-section"],state:n[e.State["#cdata-section"]],keyforfilesync:e.keyforfilesync,ceStamp:e.ceStamp,macroceStamp:e.macroceStamp,hashcode:e.hashcode,filename:e.filename,cadorigin:e.cadorigin})}},buildLinkTypeJson:function(e,t,i,n){n.push({rowid:i,phid:e.phid,parent:t})}})}),define("DS/ENOXCADImport/ImportCommand/DataExchangeImportCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/ENOXCADUtils/models/XCADModalView","UWA/Class/View","DS/ENOXCADImport/Views/ImportRefView","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,l,a){"use strict";var r;return t.extend({init:function(t){t=e.extend(t,{isAsynchronous:!1}),this._parent(t)},execute:function(t){r=e.createElement("div",{styles:{position:"relative",height:"100%",width:"100%"}}),this._buildImportDialog()},_buildImportDialog:function(){this.buildModal(),new l(r)},buildModal:function(){i.displayDialog({bodyDiv:r,position:{_width:"900px",_height:"400px",_top:"0px",_left:"90px"},footerStyle:i.footerStyle.none,isPaddingReq:!1,onCloseDlg:function(){}}),i.setTitle("XCAD Import")}})}),define("DS/ENOXCADImport/view/ImportDataGridView",["UWA/Class","UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/ENOXCADImport/view/toolbar/ImportToolBar","DS/ENOXCADImport/view/infoPanel/InfoPanelDialog","DS/ENOXCADImport/controller/SynchronizeDataGrid","DS/ENOXCADImport/view/additionalLinks/AdditionalLinksDialog","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADUtils/XCADIconsPath","DS/ENOXCADUtils/XCADNotification","i18n!DS/ENOXCADImport/assets/nls/ImportNLS","text!DS/ENOXCADImport/assets/exportColumn.json","text!DS/ENOXCADImport/assets/platformColumn.json","text!DS/ENOXCADImport/assets/supplierColumn.json","css!DS/ENOXCADImport/assets/css/ImportView"],function(e,t,i,n,l,a,r,o,s,d,c,p,u,f,h,m){return e.extend({_exportDataGrid:null,_platformDataGrid:null,_supplierDataGrid:null,_exportModel:null,_platformModel:null,_supplierModel:null,_infraJson:null,_selectedDataGrid:null,_columnMap:null,init:function(){this._exportModel=new i,this._platformModel=new i,this._supplierModel=new i},setUpView:function(){var e=this;e._infraJson=JSON.parse(document.getElementById("xcadInfra").innerText),e.createView(),this._synchronizeGrid=new o({exportDataGrid:e._exportDataGrid,platformDataGrid:e._platformDataGrid,supplierDataGrid:e._supplierDataGrid})},passGridData:function(e){var t=this;let i=e.mappingData,n=e.platformData,l=e.supplierData;t._platformDataGrid.show(),document.contains(document.querySelector(".export-grid-modify"))&&document.querySelector(".export-grid-container").classList.remove("export-grid-modify"),document.contains(document.querySelector(".supplier-grid-modify"))&&document.querySelector(".supplier-grid-container").classList.remove("supplier-grid-modify"),t.fillGridData(i,t._exportModel),t.fillGridData(n,t._platformModel),t.fillGridData(l,t._supplierModel),t.updateCellKPIColor(t._platformDataGrid),t.updateCellKPIColor(t._supplierDataGrid);t.controlToolBarButtons(["import_btn","info_btn","link_btn"],"auto","1.1"),this._synchronizeGrid.hideVerticalScroll(),this._synchronizeGrid.controlGridView(!1),t._platformModel.setUseChangeTransactionMode(!0);let a=t._platformModel.getAllDescendants().find(e=>"Deleted"==e.options.grid.status);null!=a&&a.remove(),t._supplierModel.setUseChangeTransactionMode(!0);let r=t._supplierModel.getAllDescendants().find(e=>"Deleted"==e.options.grid.status);function o(e){t._selectedDataGrid=e,"export"===e?t.controlGridSelection({selectedGrid:t._exportDataGrid,unselectedGridOne:t._platformDataGrid,unselectedGridTwo:t._supplierDataGrid}):"platform"===e?t.controlGridSelection({selectedGrid:t._platformDataGrid,unselectedGridOne:t._exportDataGrid,unselectedGridTwo:t._supplierDataGrid}):"supplier"===e&&t.controlGridSelection({selectedGrid:t._supplierDataGrid,unselectedGridOne:t._exportDataGrid,unselectedGridTwo:t._platformDataGrid})}null!=r&&r.remove(),t._exportDataGrid.getTreeDocument().addEventListener("select",o.bind(this,"export"),!0),t._platformDataGrid.getTreeDocument().addEventListener("select",o.bind(this,"platform"),!0),t._supplierDataGrid.getTreeDocument().addEventListener("select",o.bind(this,"supplier"),!0),t.subscribeInfoEvent(),d.subscribe({event:"import-additional-links-panel-open"},function(e){let i,n,l,a=e[0].options.grid.phid;function r(){let e,a=[];null==i.options.grid.circularlinks&&null==n.options.grid.circularlinks&&null==l.options.grid.circularlinks||a.push("circularlinks"),null==i.options.grid.instances&&null==n.options.grid.instances&&null==l.options.grid.instances||a.push("instances"),null==i.options.grid.family&&null==n.options.grid.family&&null==l.options.grid.family||a.push("family"),null!=i&&""!=i.options.label?e=i.options.label:null!=n&&""!=n.options.label?e=n.options.label:null!=l&&""!=l.options.label&&(e=l.options.label),a.length>0?t._linksDialog.launchDialog({mappingData:i.options.grid,platformData:n.options.grid,supplierData:l.options.grid,additionalLinks:a,title:e}):p.infoMsg("Additional Links Not Present")}t._linksDialog=new s,"export"===t._selectedDataGrid?(i=e[0],n=t._platformModel.getAllDescendants().find(e=>e.options.grid.phid==a),l=t._supplierModel.getAllDescendants().find(e=>e.options.grid.phid==a),r()):"platform"===t._selectedDataGrid?(i=t._exportModel.getAllDescendants().find(e=>e.options.grid.phid==a),n=e[0],l=t._supplierModel.getAllDescendants().find(e=>e.options.grid.phid==a),r()):"supplier"===t._selectedDataGrid&&(i=t._exportModel.getAllDescendants().find(e=>e.options.grid.phid==a),n=t._platformModel.getAllDescendants().find(e=>e.options.grid.phid==a),l=e[0],r())}),p.sucessMsg("Data Loaded Successfully")},passCheckinResGridData:function(e){var t=this;let i=e.mappingData,n=e.supplierData;t._platformDataGrid.hide(),t.fillGridData(i,t._exportModel),t.fillGridData(n,t._supplierModel),t.updateCellKPIColor(t._supplierDataGrid);t.controlToolBarButtons(["import_btn","info_btn","link_btn"],"auto","1.1"),this._synchronizeGrid.hideVerticalScroll(),this._synchronizeGrid.controlGridView(!0),document.querySelector(".export-grid-container").classList.add("export-grid-modify"),document.querySelector(".supplier-grid-container").classList.add("supplier-grid-modify"),t._supplierModel.setUseChangeTransactionMode(!0);let l=t._supplierModel.getAllDescendants().find(e=>"Deleted"==e.options.grid.status);function a(e){t._selectedDataGrid=e,"export"===e?t.controlGridSelection({selectedGrid:t._exportDataGrid,unselectedGridOne:t._supplierDataGrid}):"supplier"===e&&t.controlGridSelection({selectedGrid:t._supplierDataGrid,unselectedGridOne:t._exportDataGrid})}null!=l&&l.remove(),t._exportDataGrid.getTreeDocument().addEventListener("select",a.bind(this,"export"),!0),t._supplierDataGrid.getTreeDocument().addEventListener("select",a.bind(this,"supplier"),!0),t.subscribeInfoEvent(),d.subscribe({event:"import-additional-links-panel-open"},function(e){let i,n,l=e[0].options.grid.phid;function a(){let e,l=[];null==i.options.grid.circularlinks&&null==n.options.grid.circularlinks||l.push("circularlinks"),null==i.options.grid.instances&&null==n.options.grid.instances||l.push("instances"),null==i.options.grid.family&&null==n.options.grid.family||l.push("family"),null!=i&&""!=i.options.label?e=i.options.label:null!=n&&""!=n.options.label&&(e=n.options.label),l.length>0?t._linksDialog.launchDialog({mappingData:i.options.grid,supplierData:n.options.grid,additionalLinks:l,title:e}):p.infoMsg("Additional Links Not Present")}t._linksDialog=new s,"export"===t._selectedDataGrid?(i=e[0],n=t._supplierModel.getAllDescendants().find(e=>e.options.grid.phid==l),a()):"supplier"===t._selectedDataGrid&&(i=t._exportModel.getAllDescendants().find(e=>e.options.grid.phid==l),n=e[0],a())}),p.sucessMsg("Data Loaded Successfully")},subscribeInfoEvent:function(){var e=this;d.subscribe({event:"import-info-panel-open"},function(t){if(document.getElementById("sidebar").style.border="1px double lightgrey",document.getElementById("centreContainer").classList.add("divmaxwidth"),null==e._centreDivWidth&&(e._centreDivWidth="70%"),document.getElementById("centreContainer").style.width=e._centreDivWidth,"Deleted"===t[0].options.grid.status){let e=Math.random().toString();t[0].options.grid.phid=e.substr(e.indexOf(".")+1)}(new r).launchInfoPanelDialog(t,document.getElementById("sidebar")),e.resizeDivOnDrag()}),d.subscribe({event:"import-info-panel-close"},function(){document.getElementById("centreContainer").classList.remove("divmaxwidth"),document.getElementById("centreContainer").style.width="100%"})},fillGridData:function(e,t){t.prepareUpdate();for(let i=0;i<e.length;i++){c.updateGridIconPath(this._infraJson.url3DSpace,e[i]);let l=new n({label:e[i].title,icons:[{iconPath:c.getTypeIconPath(this._infraJson.url3DSpace,e[i],widget.getValue("icons_nonPStypes"))}],grid:e[i]});this.getDescendants(e[i],l),t.addChild(l)}t.pushUpdate()},getDescendants:function(e,t){if(null!=e.child)for(let i=0;i<e.child.length;i++){let n=e.child[i],l=this.childNodeGridElements(n,t);this.getDescendants(n,l)}else this.childNodeGridElements(e,t)},childNodeGridElements:function(e,t){c.updateGridIconPath(this._infraJson.url3DSpace,e);var i=new n({label:e.title,icons:[{iconPath:c.getTypeIconPath(this._infraJson.url3DSpace,e,widget.getValue("icons_nonPStypes"))}],grid:e});return t.addChild(i),i},createView:function(){var e=this;let i=JSON.parse(f),n=JSON.parse(h),l=JSON.parse(m),a=document.getElementById("centreContainer"),r=new t.Element("div",{class:"export-grid-container"});r.inject(a),e._exportDataGrid=e.setDataGridView(i,r,e._exportModel),e.setColumnsNls(e._exportDataGrid);let o=new t.Element("div",{class:"platform-grid-container"});o.inject(a),e._platformDataGrid=e.setDataGridView(n,o,e._platformModel),e.setColumnsNls(e._platformDataGrid);let s=new t.Element("div",{class:"supplier-grid-container"});s.inject(a),e._supplierDataGrid=e.setDataGridView(l,s,e._supplierModel),e.setColumnsNls(e._supplierDataGrid),e.createToolbar();let d=document.getElementsByClassName("wux-datagridview-emptycontentmessage");d[0].innerText="",d[2].innerText="",e._supplierDataGrid.addEventListener("change",e._selectAllNodes.bind(e))},_selectAllNodes:function(e,t){if(t&&"Copy"===t.cellModel){let t=!1;null!=e.target.attributes.checked&&(t=!0),this._supplierDataGrid.treeDocument.getAllDescendants().forEach(function(e){null!=e.options.grid.import&&e.updateOptions({grid:{import:t}})})}},setDataGridView:function(e,t,i){var n=this;n.columnsMap(e);let a=new l({identifier:"dataGridView",treeDocument:i,cellSelection:"none",rowSelection:"single",rowDragEnabledFlag:!0,columns:e,columnSelection:"single",defaultColumnDef:{width:"auto",resizableFlag:!0,sortableFlag:!1},showNodeKPIColorFlag:!0,showModelChangesFlag:!0,showRowBorderFlag:!0,getCellTooltip:function(e){if(e.nodeModel){if(""!=e.nodeModel.options.grid.relicon&&1==e.columnID)return{shortHelp:e.nodeModel.options.grid.relname,updateModel:!1};if(null!=e.nodeModel.options.grid.cycliclinkicon&&2==e.columnID)return{shortHelp:u.key_circularlinks,updateModel:!1};if(n._columnMap.has(e.columnID))return{shortHelp:e.nodeModel.options.grid[n._columnMap.get(e.columnID)],updateModel:!1}}else{if(""!=e.cellModel)return{shortHelp:e.cellModel,updateModel:!1};if(1==e.columnID)return{shortHelp:u.col_relType,updateModel:!1}}}});return a.layout.columnHeaderHeight=25,a.layout.cellHeight=40,a.layout.rowsHeader=!1,a.inject(t),a},setColumnsNls:function(e){let t=e.columns;for(let e=0;e<t.length;e++){let i=t[e].dataIndex;if(null!=u[i]&&(t[e].text=u[i]),null!=t[e].children){let i=t[e].children;for(let e=0;e<i.length;e++){let t=i[e].dataIndex;null!=u[t]&&(i[e].text=u[t])}}}},columnsMap:function(e){this._columnMap=new Map;for(var t=0;t<e.length;t++)if(null!=e[t].children){let i=e[t].children;for(let e=0;e<i.length;e++)""!=i[e].text&&"tree"==i[e].dataIndex&&this._columnMap.set(e,"title")}},createToolbar:function(){var e=document.getElementById("topContainer");e.classList.add("toolbar-container"),this._importToolBar=new a({exportModel:this._exportModel,platformModel:this._platformModel,supplierModel:this._supplierModel}),this._importToolBar.render().inject(e);this.controlToolBarButtons(["import_btn","info_btn","link_btn"],"none","0.3")},controlToolBarButtons:function(e,t,i){var n;for(n of e)document.getElementById(n).querySelectorAll("*")[0].style.pointerEvents=t,document.getElementById(n).querySelectorAll("*")[0].style.opacity=i},updateCellKPIColor:function(e){e.getColumnOrGroup("status").getCellKPIColor=function(e){let t=e.nodeModel.getAttributeValue("status");return t===u.status_new||"Instance New"===t?"blue":t===u.status_existing?"green":t===u.status_modified?"orange":t===u.status_deleted||"Instance Deleted"===t?"red":void 0}},controlGridSelection:function(e){e.unselectedGridOne.unselectAll(),null!=e.unselectedGridTwo&&e.unselectedGridTwo.unselectAll();let t=e.selectedGrid.getTreeDocument().getSelectedNodes(),i=document.getElementById("slideInfoContent");if(t.length>0&&document.contains(i)){if(i.destroy(),"Deleted"===t[0].options.grid.status){let e=Math.random().toString();t[0].options.grid.phid=e.substr(e.indexOf(".")+1)}(new r).launchInfoPanelDialog(t,document.getElementById("sidebar")),this.resizeDivOnDrag()}},resizeDivOnDrag:function(){var e,t,i,n,l=this,a=document.querySelector("#sidebar"),r=document.querySelector(".resizer"),o=document.querySelector(".centrepanel");function s(l){a.style.width=t-l.clientX+e+"px",a.style.left=i+l.clientX-e+"px",o.style.width=n+l.clientX-e+"px"}function d(e){document.documentElement.removeEventListener("mousemove",s,!1),document.documentElement.removeEventListener("mouseup",d,!1),l._centreDivWidth=o.style.width}r.addEventListener("mousedown",function(l){e=l.clientX,t=parseInt(document.defaultView.getComputedStyle(a).width,10),i=parseInt(document.defaultView.getComputedStyle(a).left,10),n=parseInt(document.defaultView.getComputedStyle(o).width,10),document.documentElement.addEventListener("mousemove",s,!1),document.documentElement.addEventListener("mouseup",d,!1)},!1)}})}),define("DS/ENOXCADImport/view/ImportRefView",["UWA/Class","UWA/Core","DS/WAFData/WAFData","DS/ENOXCADImport/view/ImportDataGridView","DS/ENOXCADImport/utils/XMLToJsonChekinResConversion","DS/ENOXCADImport/utils/XMLToJsonExpandResConversion","DS/ENOXCADImport/utils/CreateMasterArray","DS/ENOXCADImport/utils/CheckinResMasterArray","DS/ENOXCADImport/controller/JSONDataMapper","DS/ENOXCADUtils/loader/XCADLoader","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADUtils/XCADNotification","i18n!DS/ENOXCADImport/assets/nls/ImportNLS"],function(e,t,i,n,l,a,r,o,s,d,c,p,u){var f;return e.extend({dataGridview:null,_busTypeMapping:null,_relTypeMapping:null,_additionalLinks:null,initializeView:function(e){var t=this;f={operation:"initfordataexchange",version:"1.0",data:{}},t.setInfraData(e.json);let i=JSON.parse(document.getElementById("xcadInfra").innerText);new d({maindiv:document.getElementById("mainContainer"),url_3DSpace:i.url3DSpace});let l=null!=e.json.odtinfra&&e.json.odtinfra;Boolean(l)?(t._busTypeMapping=e.json.busTypeMapping,t._relTypeMapping=e.json.relTypeMapping,t.dataGridview=new n,t.dataGridview.setUpView()):t.callWebservice(i)},render:function(e){return this},setInfraData:function(e){let t={},i=e.data.infra;"OnPremise"!==i.tenantid&&widget.setValue("x3dPlatformId",i.tenantid),t.securitycontext=i.securitycontext,t.tenantid=i.tenantid,t.lang=i.lang,t.integration=i.integration,t.url3DSpace=i.url3DSpace;let n=document.createElement("script");n.id="xcadInfra",n.type="application/json",n.text=JSON.stringify(t),document.getElementById("mainContainer").appendChild(n)},callWebservice:function(e){var l=this;(function(e){return new t.Promise(function(t,n){i.authenticatedRequest(e,{type:"json",method:"GET",proxy:"passport",headers:{Accept:"application/json","content-type":"application/json"},timeout:6e5,onComplete:t,onFailure:n,onTimeout:n})})})(e.url3DSpace+"/resources/xcaddataexch/services/cadtypemapping?integration="+e.integration+"&tenant="+e.tenantid+"&securitycontext="+e.securitycontext).then(function(){l._busTypeMapping=arguments[0].bustype,l._relTypeMapping=arguments[0].reltype;let e=arguments[0].nls_designpolicystates,t=arguments[0].nls_3dexptypes,i=arguments[0].icons_nonPStypes;widget.setValue("relTypeMapping",l._relTypeMapping),widget.setValue("nls_designpolicystates",e),widget.setValue("nls_3dexptypes",t),widget.setValue("icons_nonPStypes",i),l.dataGridview=new n,l.dataGridview.setUpView(),f.data.status=u.success,f.data.message="Init Message",c.publish({event:"webinwin:web:notification",data:f})},function(){f.data.status=u.failure,f.data.message=arguments,c.publish({event:"webinwin:web:notification",data:f})})},passXMLData:function(e,t){var i=this;c.publish({event:"xcad-loader-off"});let n={operation:"importresults",version:"1.0",data:{}};i._additionalLinks={};let d=null,f=null,h=null,m=l.transform(e);if("success"===m.jsondata.result){let e=m.jsondata.data.mappinginfo;d=i.buildDataGridMapper(e,"supplier");let l=m.jsondata.exportmap.exportdata[0].mappinginfo;if(f=i.buildDataGridMapper(l,"export"),""!=t){let e=a.transform(t);if("success"==e.jsondata.result){let t=e.jsondata.data.mappinginfo;h=i.buildDataGridMapper(t,"platform")}let n=r.buildJson(d,f,h),l=s.createSkeletonOfDataGrid(n.mappingArray),o=s.createSkeletonOfDataGrid(n.platformArray),c=s.createSkeletonOfDataGrid(n.supplierArray);i.dataGridview.passGridData({mappingData:l,platformData:o,supplierData:c,additionalLinks:i._additionalLinks})}else{let e=o.buildJson(d,f),t=s.createSkeletonOfDataGrid(e.mappingArray),n=s.createSkeletonOfDataGrid(e.supplierArray);i.dataGridview.passCheckinResGridData({mappingData:t,supplierData:n,additionalLinks:i._additionalLinks})}n.data.status=u.success,n.data.message=u.load_data_success,p.sucessMsg(u.load_data_success)}else n.data.status=u.failure,n.data.message=m.jsondata.data,p.errorMsg(m.jsondata.data);c.publish({event:"webinwin:web:notification",data:n})},buildDataGridMapper:function(e,t){let i=e.structure,n=e.nodes,l=[],a=[],r=[];return null!=e.instances&&(l=e.instances),null!=e.family&&(a=e.family),null!=e.circularlinks&&(r=e.circularlinks),null!=e.additionallinks&&(this._additionalLinks[t]=e.additionallinks),s.parseData({busTypeMapping:this._busTypeMapping,relTypeMapping:this._relTypeMapping,structureArray:i,nodesArray:n,instanceArray:l,familyArray:a,circularlinksArray:r})}})}),define("DS/ENOXCADImport/model/ProtocolModel",["UWA/Class","DS/ENOXCADImport/view/ImportRefView","DS/ENOXCADUtils/XCADNotification","DS/ENOXCADUtils/utils/XCADModelEvents","DS/Logger/Logger","i18n!DS/ENOXCADImport/assets/nls/ImportNLS","css!DS/ENOXCADImport/assets/css/MainView"],function(e,t,i,n,l,a){"use strict";var r=l.getLogger("DS/ENOXCADImport/model/ProtocolModel");return e.extend({_view:null,init:function(){},defineProtocol:function(e){var l=this;switch(e.operation){case"initfordataexchange":l.setbodyDiv(),1==parseFloat(e.version)&&(r.info("Init Loaded"),l._view=new t,l._view.render(),l._view.initializeView({json:e}));break;case"exchangenotification":1==parseFloat(e.version)&&(n.publish({event:"xcad-loader-off"}),e.data.status===a.success?i.infoMsg(e.data.message):i.warningMsg(e.data.message));break;case"importresults":if(1==parseFloat(e.version)&&"xml"==e.data.type){let t=e.data.checkinresponse,i="";null!=e.data.expandresponse&&(i=e.data.expandresponse),l._view.passXMLData(t,i)}}},setbodyDiv:function(){this._mainContainer=UWA.createElement("div",{id:"mainContainer",html:[{tag:"div",id:"topContainer"},{tag:"div",id:"centreContainer",class:"centrepanel"},{tag:"div",id:"sidebar",class:"collapsed"}]}),widget.setBody(this._mainContainer)}})}),define("DS/ENOXCADImport/ENOXCADImport",["DS/ENOXCADImport/model/ProtocolModel","DS/ENOXCADUtils/utils/XCADModelEvents","DS/PlatformAPI/PlatformAPI"],function(e,t,i){var n;return{onLoad:function(){n=new e,this.publish(),this.subscribe();t.publish({event:"webinwin:web:notification",data:{operation:"xcadimportpageready",version:"1.0",data:{status:"success",message:"Page is ready"}}})},publish:function(){t.subscribe({event:"webinwin:web:notification"},function(e){"undefined"!=typeof dscef?dscef.sendString(JSON.stringify(e)):i.publish("webinwin:web:notification",JSON.stringify(e))})},subscribe:function(){t.subscribe({event:"webinwin:win:notification"},function(e){"string"==typeof e&&(e=JSON.parse(e)),n.defineProtocol(e)})}}});