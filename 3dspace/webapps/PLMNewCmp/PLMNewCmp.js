define("DS/PLMNewCmp/service/PLMNewCommonWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/IPClassifyActive/assets/nls/IPClassifyActive","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyActive/utils/IPClassifyActiveUtil"],function(e,t,n,i,a,o,s,r){"use strict";return{_orderField:"ds6w:label",_orderBy:"asc",getSetting:function(){return r.getSetting()},get3DSpaceUrl:function(){return new Promise(function(e,t){o.get3DSpaceUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},getSearchInfo:function(){return{with_nls:!1,with_indexing_date:!0,select_predicate:["ds6w:label","ds6w:created","ds6w:reservedBy","relcount","taxonomies","ds6w:classification","icon_2ddefaultthb.subtype"],select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25}},getShowContentInViewSetting:function(){return void 0!==window.top.showContentInView?window.top.showContentInView:this.getSetting().showContentInView},setOrder:function(e,t){this._orderField=e||this._orderField,this._orderBy=t||this._orderBy},getTenantID:function(){return window.top.tenantId||o.getTenantID()},getSecurityContext:function(){var e=i.getSetting("pad_security_ctx");if(!e&&widget.hasPreference("Current_security_credentials")){var t=widget.getPreference("Current_security_credentials");void 0!==t.defaultValueNonNls&&null!==t.defaultValueNonNls&&t.hasOwnProperty("defaultValueNonNls")&&(e="ctx::"+t.defaultValueNonNls)}return window.top.securityContext||e||this._securityContext},getSelect_bo:function(){return["ds6w:label","ds6w:what/ds6w:type","physicalid","ds6w:when/ds6w:created","ds6w:when/ds6w:modified","ds6w:how/ds6w:classification","icon_2ddefaultthb.subtype"]},_getSecurityContext:function(e){var t=this,n=e,i="/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",a="GET",o=n.tenant?n.tenant:this.getTenantID();t.get3DSpaceUrl().then(function(e){var s=e+i+"&tenant="+o,r=widget.lang?widget.lang:widget.getValue("lang");return n.method=a,n.headers={Accept:"application/json","Accept-Language":r,"Content-Type":"application/json"},n.cache=-1,n.withoutSC=!0,t._executeRequest(s,n,!0)})},expandInNewPLM:function(e){if(e.isRoot)return e.nresults=1e3,this.searchInNewPLM(e);var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.expandInNewPLM");var n=this;n.get3DSpaceUrl().then(function(i){var a=i+"/cvservlet/expand",o=widget.lang?widget.lang:widget.getValue("lang");t.payload={with_nls:!1,with_indexing_date:!0,select_predicate:["ds6w:label","ds6w:created","ds6w:reservedBy","relcount","taxonomies","ds6w:classification","icon_2ddefaultthb.subtype"],select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25},t.payload.locale=o,t.payload.tenant=n.getTenantID(),t.payload.next_start=void 0,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.label=n.getLabel(),delete t.payload.specific_source_parameter,t.payload.root_physicalid=e.pid,t.payload.type_filter_bo=n.getType_filter_bo(),t.payload.select_bo=n.getSelect_bo(),t.payload.expand_iter="All"===t.level?"-1":"1";null!=e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":o},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=12e4,n._executeRequest(a,t,"searchInFolder")})},fetchContent:function(e,t){return t.payload.specific_source_parameter=this.getSpecific_source_parameter_content(t.pid),t.payload.label=this.getLabel(),t.data=UWA.Json.encode(t.payload),this._executeRequest(e,t,"searchInFolder")},initSecurityContext:function(){var e=this;return new Promise(function(t,n){e._getSecurityContext({onComplete:function(n){var i=JSON.parse(n);e._securityContext="ctx::"+i.preferredcredentials.role.name+"."+i.preferredcredentials.organization.name+"."+i.preferredcredentials.collabspace.name,t(e._securityContext)},onFailure:function(e){console.log(e),n(e)}})})},flattenedSearch:function(e){var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.searchInActiveBookmark");var n=e.searchKey?e.searchKey:this.generateSearchQuery(e.searchKey,e.pid,e.type),i=this;new Promise(function(e,t){o.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}).then(function(a){var o=a+"/search",s=widget.lang?widget.lang:widget.getValue("lang");t.payload=i.getSearchInfo(),t.payload.locale=s,t.payload.order_by=i._orderBy,t.payload.order_field=i._orderField,t.payload.query=n,t.payload.tenant=i.getTenantID(),t.payload.resourceid_not_in=e.alreadyPresentIDs,t.payload.next_start=void 0,t.payload.nresults=void 0!==e.nresults?e.nresults:parseInt(nresults)||t.payload.nresults,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.login={"3dspace":{SecurityContext:i.getSecurityContext()}},t.payload.label=i.getLabel(),delete t.payload.specific_source_parameter,e.pid&&(t.payload.specific_source_parameter=i.getSpecific_source_parameter(e.pid,!0)),t.payload.specific_source_parameter={"3dspace":{additional_query:"AND "+i.getSearchQuery()}};null!=e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=3e6,i._executeRequest(o,t,"searchInFolder")})},updateAttributes:function(e){var t={};UWA.extend(t,e);var n={requests:[]};let i=(new Date).getTime();var o={method:"PATCH",queryParams:{select:["physicalid","modified"]}};o.path="model/bus/"+e.pid,o.body=e.requests,t.queryParams.forEach(function(e){o.queryParams.select.push("attribute["+e+"]")}),n.requests.push(o),t.method="PUT",t.data=JSON.stringify(n),t.headers={Accept:"application/json","content-type":"application/json",SecurityContext:this.getSecurityContext(),SecurityToken:window.top.dsUserLogin+"|"+this.getSecurityContext()+"|preferred"};var r=s.get3DSpaceUrl()+"/resources/v1/collabServices/attributes/op/update?tenant="+a.getPlatformId()+"&_="+i,l=this._executeRequest(r,t,"updateAttributes");return console.log(l),l},pathInNewPLM:function(e){var t=this;this.getSecurityContext()?this._pathInNewPLM(e):this.initSecurityContext().then(function(n){t._pathInNewPLM(e)})},getUserPreferences:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.getUserPreferences");var n=this,i=null;return i=o.getCompassUrlAsync({onComplete:function(e){var a=e+"/resources/AppsMngt/user/getPreferences";t.query={name:t.name},t.method="GET",t.headers={Accept:"application/json",SecurityContext:void 0},t.withoutTenant=!0;var o=n._executeRequest(a,t,"getUserPreferences");i?i.cancel=o.cancel:i=o}})},getLabel:function(e){return"IPNewPLMComponent-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},_executeRequest:function(e,i,a){var o=Math.round(1e3*Math.random()).toString(),s=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("folderRequest_begin"+o);var r={};UWA.extend(r,i),UWA.is(r.onTimeout,"function")||(r.onTimeout=function(){var e={type:"timeout",toString:function(){return n.msg_InfoAction_Timeout}};r.onFailure(e)},r.onComplete=function(e){window.top.performance.mark("folderRequest_end"+o);var t=window.top.performance.getEntriesByName("folderRequest_begin"+o);t&&1===t.length&&(window.top.performance.measure(s+"_Request"+a,"folderRequest_begin"+o,"folderRequest_end"+o),window.top.performance.clearMarks("folderRequest_end"+o),window.top.performance.clearMarks("folderRequest_begin"+o)),i.onComplete(e)}),UWA.is(r.query)||(r.query={}),r.query.tenant||!0===i.withoutTenant||(r.query.tenant=this.getTenantID());var l=e;return 0!==Object.keys(r.query).length&&(l+=(e.indexOf("?")<0?"?":"&")+UWA.Utils.toQueryString(r.query)),t.authenticatedRequest(l,r)}}}),define("DS/PLMNewCmp/utils/PLMNewClassificationFacetAccordeonView",["UWA/Core","DS/Controls/SpinBox","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/DatePicker","DS/Controls/SelectionChips","DS/Controls/Accordeon","DS/Controls/Editor"],function(e,t,n,i,a,o,s,r){return e.Class.extend({init:function(e){this.buildSkeleton(e),this.views=[],this.createAccordeonClassIDandValueMap=new Map},buildSkeleton:function(t){var n=this;this.accordeonCon=e.createElement("div",{class:"plmnew-accordeon-container"}).inject(t.container),this.classandAttriDiv=e.createElement("div",{class:"classandAttriDiv","is-visible":"true"}).addEvent("resize",function(){var e=n.classandAttriDiv.getDimensions().width,t=document.querySelectorAll(".accordeonwarningStatementDiv"),i=document.querySelectorAll(".accordeonwarningMessageHeader");e>=400?(t.forEach(function(e){e.classList.remove("blockContaccordeonwarningStatementDiv"),e.classList.add("flexContaccordeonwarningStatementDiv")}),i.forEach(function(e){e.classList.remove("blockContaccordeonwarningMessageHeader"),e.classList.add("parentContaccordeonwarningMessageHeader")})):(t.forEach(function(e){e.classList.remove("flexContaccordeonwarningStatementDiv"),e.classList.add("blockContaccordeonwarningStatementDiv")}),i.forEach(function(e){e.classList.remove("parentContaccordeonwarningMessageHeader"),e.classList.add("blockContaccordeonwarningMessageHeader")}))}),this.classandAttriDiv.inject(this.accordeonCon),this.views=[],this.simpleAccordeon=new s({items:[],style:"simple",exclusive:!1}).inject(this.classandAttriDiv)},populateAccordeonData:function(s,l,c){var d=this,u=new Map;d.attributeKeyAndValuePair=new Map;var p,m,f=d.dimensionsUnits;for(let[t,n]of d.classIdsAndClassificationAttributeNameSetMap){var v=[];t.split(",").forEach(function(e){v.push(s.get(e.toString())),v.sort()}),m=t;var h=!1,g=!0;for(let t of n){var w=d.classificationAttributeNameValuePair.get(t).value,C=d.classificationAttributeNameValuePair.get(t).type,A=d.classificationAttributeNameValuePair.get(t).dimension,y=d.classificationAttributeNameValuePair.get(t).valueType,b=d.classificationAttributeNameValuePair.get(t).multiLine;let n=d.classificationAttributeNameValuePair.get(t).NLS_range;if(n&&n.length>0)var S=n;else S=d.classificationAttributeNameValuePair.get(t).range;var N=t;"boolean"==C&&(w=w.toUpperCase());var D=!1;"TRUE"==b&&(D=!0);var I=!1;"multival"==y&&(I=!0);var P=!1;S.length>0&&(P=!0);g=d.classificationAttributeNameValuePair.get(t).dimensionUnit;var _=d.dimensionKeyValueMap.get(g);this.parentAccDiv=new e.createElement("div",{id:"parentAccDiv"}),this.warningStatement=new e.createElement("div",{id:"accordeonwarningStatementDiv",class:"accordeonwarningStatementDiv",name:m}).inject(this.parentAccDiv);var M=d.classificationAttriubteNameAndTransllatedSetMap.get(t);let i,a,o,s,r;if(this.warningMessageHeader=e.createElement("h6",{id:"accordeonwarningMessageHeader",class:"accordeonwarningMessageHeader",text:M,name:M,classIds:m}).inject(this.warningStatement),D?((a=B("multiLine",_,d.dimensionsUnits)).disabled=c,a.domId=N,a.isMultiValue=I,this.warningMessageDiv=e.createElement("div",{id:"accordeonwarningMessageDiv",content:a,name:t,value:w}).inject(this.warningStatement),(s=V(t,I)).isMultiValue&&s.addEventListener("change",function(e){var t=a.recId,n=s._items.length,i=s.domId,o=s.getAllChipsAsLabels();n>0?s.show():s.hide();var r=d.createAccordeonClassIDandValueMap.get(t);r.get(i).value=o,r.get(i).path=i}),a.addEventListener("change",function(e){var t=e.dsModel.value;if(a.isMultiValue)s.inject(e.target.getParent()),s.addChip(t),a.value="";else{var n=a.recId,i=d.createAccordeonClassIDandValueMap.get(n);e.dsModel.domId;i.get(a.domId).value=t,i.get(a.domId).path=a}})):I?(P&&(C="units"),(o=B(C,w,S)).disabled=c,o.domId=N,o.isMultiValue=I,this.warningMessageDiv=e.createElement("div",{id:"accordeonwarningMessageDiv",content:o,name:t,value:w}).inject(this.warningStatement),(r=V(t,I))&&r.isMultiValue&&r.addEventListener("change",function(e){var t=r.recId,n=r.domId,i=r._items.length,a=r.getAllChipsAsLabels();i>0?r.show():r.hide();var o=d.createAccordeonClassIDandValueMap.get(t);o.get(n).value=a,o.get(n).path=n}),"spinBox"===o.name?o.addEventListener("focusout",function(e){var t=e.target.value;if(null!=t)if(o.isMultiValue)r.inject(e.target.getParent().getParent().getParent()),r.addChip(t),o.value=null;else{var n=r.recId,i=d.createAccordeonClassIDandValueMap.get(n);i.get(o.domId).value=t,i.get(o.domId).path=o.domId}}):o.addEventListener("change",function(e){if(!d.dimensionsUnits.includes(e.dsModel.value)){var t=e.dsModel.value;if(null==t)return;if("datePicker"===e.dsModel.name&&(t=t.toGMTString()),"spinBox"===e.dsModel.name&&(t=t.toString()),o.isMultiValue)r.inject(e.target.getParent()),r.addChip(t),o.value=null;else{var n=r.recId,i=d.createAccordeonClassIDandValueMap.get(n);i.get(o.domId).value=t,i.get(o.domId).path=o.domId}}})):P?((i=B("units",w,S)).disabled=c,this.warningMessageDiv=e.createElement("div",{id:"accordeonwarningMessageDiv",content:i,name:t,value:w}).inject(d.warningStatement),i.addEventListener("change",function(e){U(e,i,!0)})):((i=B(C,w)).disabled=c,this.warningMessageDiv=e.createElement("div",{id:"accordeonwarningMessageDiv",content:i,name:t,value:w}).inject(d.warningStatement),i.addEventListener("change",function(e){U(e,i,!1)})),g){var x=B("units",_,d.dimensionsUnits);x.domId=N,this.warningMessageDivSpan=e.createElement("div",{id:"accordeonwarningMessageDivSpan",content:x,name:_,value:g}).inject(this.warningMessageDiv.getChildren()[0]),x.addEventListener("change",function(e){U(e,x,!0)})}if(h)d.parentAccDiv.inject(p.content);else{var T=[...v],E=new e.Element("div",{class:"view"+l});d.parentAccDiv.inject(E),p={header:T.join(", "),id:"accordeon",class:"classAccordeon",content:E,expandedFlag:!0,style:{"font-size":"12px"},id:l},d.views.push(p)}function L(e,t,n,i,a,o){if(!e.has(t))return e.set(t,{}),null!=i&&(e.get(t).type=i),null!=n&&(e.get(t).value=n),null!=a&&(e.get(t).dimension=a),void(null!=o&&(e.get(t).dimensionUnit=o));null!=i&&(e.get(t).type=i),null!=n&&(e.get(t).value=n),null!=a&&(e.get(t).dimension=a),null!=o&&(e.get(t).dimensionUnit=o)}function F(e,t){for(let[n,i]of e.entries())if(i===t)return n}function U(e,t,n){var i=e.dsModel.value;"spinBox"===e.dsModel.name&&(i=i.toString()),"datePicker"===e.dsModel.name&&(i=i.toGMTString());var a=t.recId,o=d.attributeKeyAndValuePair.get(e.dsModel),s=d.createAccordeonClassIDandValueMap.get(a);if(n){var r=e.dsModel.value;e.target&&e.target.id&&(i=void 0,o=e.target.id)}L(s,o,i,void 0,void 0,F(d.dimensionKeyValueMap,r))}d.attributeKeyAndValuePair.set(i,N),L(u,N,w,C,A,g),h=!0}d.createAccordeonClassIDandValueMap.set(m,u)}function V(e,t){var n=new o({domId:e,recId:m});return n.isMultiValue=t,n}function B(e,o,s=f,l){var d=null;return l&&(o=null),c&&("units"==e&&(w=o),e="string"),(d={real:lineEditor=new n({placeholder:"Enter the value",value:o,sizeInCharNumber:40,selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,disabled:!1,domId:M,recId:m,pattern:"[+-]?([0-9]*[.])?[0-9]+"}),string:stringLineEditor=new n({placeholder:"Enter the text",value:w,sizeInCharNumber:524288,selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,disabled:!1,recId:m}),boolean:booleanComboboxEditor=new i({elementsList:[{label:"True",description:"True",value:"TRUE"},{label:"False",value:"FALSE",description:"false"}],value:o,recId:m}),timestamp:timePickerEditor=new a({value:new Date(o),timePickerFlag:!0,timePickerPrecision:"sec",recId:m,placeholder:"Enter the Date"}),integer:spinboxEditor=new t({value:parseInt(o),minValue:-21474836480,stepValue:1,pageStepValue:1,width:"240px",recId:m,placeholder:"Enter an Integer"}),units:unitComboboxEditor=new i({elementsList:s,value:o,recId:m}),multiLine:new r({placeholder:"Enter the text",value:w,requiredFlag:!1,nbRows:4,newLineMode:"enter",recId:m})}[e]).getContent().getChildren()[0].style.width="100%",d.getContent().addClassName("lineEditorCustomDisplay"),d.disabled=c,d}return d.views},displayAccordeonData:function(e,t,n){let i=this.populateAccordeonData(e,t,n);this.simpleAccordeon.items=[...i]},prepareAccordeonData:function(e,t,n){var i=this,a=new Map;this.classificationAttriubteNameAndTransllatedSetMap=new Map,this.classIdsAndClassificationAttributeNameSetMap=new Map,this.classNameAndNlsLabelMap=new Map;let o=[];n&&n.rangeAttributes&&(o=n.rangeAttributes),i.classificationAttributeNameValuePair=new Map,e.attribute.forEach(function(e){for(const a in e){var t=a,n=e[a];if("name"==t&&(i.classNameAndNlsLabelMap.set(e.name,e.nls_label),l(i.classificationAttributeNameValuePair,n,e.default,e.type),e.hasOwnProperty("manipulationUnit")&&(i.classificationAttributeNameValuePair.get(n).dimensionUnit=e.manipulationUnit),i.classificationAttributeNameValuePair.get(n).dimension=e.dimension,i.classificationAttributeNameValuePair.get(n).valueType=e.valuetype,i.classificationAttributeNameValuePair.get(n).multiLine=e.multiline),"range"==t){let t=[];if(e.hasOwnProperty("range"))if(t=n.map(function(e){return e.value}),i.classificationAttributeNameValuePair.get(e.name).range=t,o[e.name]){let t=[];Object.keys(o[e.name]).forEach(n=>t.push({value:n,label:o[e.name][n]})),i.classificationAttributeNameValuePair.get(e.name).NLS_range=t}else i.classificationAttributeNameValuePair.get(e.name).NLS_range=[]}}});for(let[e,n]of i.classificationAttributeNameValuePair){a.has(e)||a.set(e,new Set),a.get(e).add(t);var s=i.classNameAndNlsLabelMap.get(e);i.classificationAttriubteNameAndTransllatedSetMap.set(e,s)}for(let[e,t]of a){var r=[...t].sort();i.classIdsAndClassificationAttributeNameSetMap.has(r.toString())||i.classIdsAndClassificationAttributeNameSetMap.set(r.toString(),new Set),i.classIdsAndClassificationAttributeNameSetMap.get(r.toString()).add(e)}function l(e,t,n,i){if(!e.has(t))return e.set(t,{}),e.get(t).type=i,void(e.get(t).value=n);e.get(t).type=i,e.get(t).value=n}},prepareUnitData:function(e){var t=this;t.dimensionKeyValueMap=new Map,t.dimensionsUnits=[];e.length&&e.forEach(function(e){e.dimensionUnits&&Object.keys(e.dimensionUnits).forEach((n,i)=>{"string"==typeof e.dimensionUnits[n]&&(t.dimensionKeyValueMap.set(n,e.dimensionUnits[n]),t.dimensionsUnits.push(e.dimensionUnits[n]))})})}})}),define("DS/PLMNewCmp/utils/PLMNewClassificationFacetData",["UWA/Core","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel"],function(e,t,n){return e.Class.extend({init:function(e){},buildSkeleton:function(e){},_generateSearchData:function(e,n,i,a){var o=this,s={0:new t};s[0].onPreExpand(function(e){e.data.onlyUI&&e.target.preExpandDone()});var r={"ds6w:label":"label","ds6w:what/ds6w:type":"type",type_icon_url:"icon",resourceid:"id","ds6w:created":"created","ds6w:modified":"modified","ds6w:when/ds6w:created":"created","ds6w:when/ds6w:modified":"modified","ds6w:how/ds6w:classification":"folderClassification","icon_2ddefaultthb.subtype":"iconType",mxid:"mxid"};return e.forEach(function(e){var t=e.attributes,l={};t.forEach(function(e){var t=r[e.name];t&&(l[t]=e.value),"type"===t&&(l.displayType=e.dispValue),"type_icon_url"===t&&(t.icon=e.value)});var c={useAsyncPreExpand:!0};c.label=l.label,c.icons=[l.icon],c.id=l.id,c.plmType=l.type,c.created=l.created,c.modified=l.modified,c.folderClassification=l.folderClassification,c.iconType=l.iconType,c.mxid=l.mxid;var d=e&&e.level?parseInt(e.level):1;c.icons=[n(l)],i(c)&&(c.children=[]),s[0].addChild(o._createTreeNodeModel(c,s[d-1],a))}),s[0]},createAutocompleteDataTree:function(e){var n=new t({shouldBeSelected:function(e){return e.isSelectable}});n.prepareUpdate();var i={useAsyncPreExpand:!0,label:"Favorites",isFavorite:!0,icons:{iconName:"open-in-a-new-window",fontIconFamily:1},children:[]};return i.id=this._favoriteSection,i.plmType=this._favoriteSection,i.getLabel=function(){return"Favorites"},this._rootNodeFavorite=this._createTreeNodeModel(i,n,e),n.prepareUpdate(),n.pushUpdate(),n.getRoots().forEach(function(e,t){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){return e.options.label.localeCompare(t.options.label)>=1?1:-1}})}),n.pushUpdate(),n},_generateExpandData:function(e,t,i,a,o,s,r){var l=a.slice();if(t.prepareUpdate(),i)t.removeChildren();else if(a.length>0)for(var c=[],d=0;d<e.length;d++){var u,p=e[d];if(p.attributes&&p.attributes.forEach(function(t){if("did"===t.name&&(u=t.value),"physicalid"===t.name&&a.indexOf(t.value)>-1){e.splice(d,1),c.push(u),d-=1;var n=l.indexOf(t.value);n>-1&&l.splice(n,1)}}),p.path){var m=p.path;c.length>0&&c.forEach(function(t){m.indexOf(parseInt(t))>-1&&(e.splice(d,1),d-=1)})}}if(t.getChildren().length>0)for(d=0;d<t.getChildren().length;d++){var f=t.getChildren()[d].id;l.indexOf(f)>-1&&(t.getChildren().splice(d,1),d-=1)}var v=this,h={"ds6w:label":"label","ds6w:type":"type",type_icon_url:"icon",physicalid:"id","ds6w:created":"created","ds6w:modified":"modified","ds6w:classification":"folderClassification","icon_2ddefaultthb.subtype":"iconType",mxid:"mxid"},g=[],w={};if(e.forEach(function(e){if(e.path)g.push(e.path);else if(e.attributes&&e.attributes.length>1){var t=e.attributes.splice(1),n={};t.forEach(function(e){var t=h[e.name];t&&(n[t]=e.value)});var i={useAsyncPreExpand:!0};i.label=n.label,i.icons=[n.icon],i.id=n.id,i.plmType=n.type,i.created=n.created,i.modified=n.modified,i.folderClassification=n.folderClassification,i.iconType=n.iconType,i.mxid=n.mxid,i.icons=[o(n)],s(i)&&(i.children=[]),w[e.attributes[0].value]=i}}),g.forEach(function(e){var i=t;e.forEach(function(e,t){if(w[e]){var a=w[e];a&&0!==t&&(a instanceof n?i.addChild(a):w[e]=v._createTreeNodeModel(a,i,r),i=w[e])}})}),t.pushUpdate(),i)for(var C in w)w[C].id!==t.id&&w[C].expand&&!w[C].isExpanded()&&w[C].expand({onlyUI:!0})},_createTreeNodeModel:function(e,i,a,o){var s=i instanceof t;delete e.publishOnConnect,delete e.folderClassification,e.useAsyncPreExpand=!0;var r=new n(e);return r.id=e.id,r.plmType=e.plmType,e.isFavorite&&(r.isFavorite=!0),(e.isPersonal||!s&&i.isPersonal)&&(r.isPersonal=!0),e.created&&(r.created=e.created),r.getID=function(){var e=this.id;return e&&""!==e||(e=this.plmType),e},r.getLabel=function(){return this.options.label},r.getType=function(){return this.plmType},r.mxid=e.mxid,r.label=e.label,r.options.oldLabel=e.label,r.pathId=(s?"root":i.pathId)+","+r.getID(),r.isSelectable=a(e.plmType),s?i.addRoot(r):i.addChild(r,o),r}})}),define("DS/PLMNewCmp/PLMNewClassificationFacet",["DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase","UWA/Class/Options","UWA/Class/Events","DS/PLMNewCmp/service/PLMNewCommonWebService","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","text!DS/PLMNewCmp/assets/classificationAppsRequire_setting.json","i18n!DS/PLMNewCmp/assets/nls/PLMNewCommCmpSel","css!DS/PLMNewCmp/PLMNewCmp.css"],function(e,t,n,i,a,o,s,r,l){return e.extend(t,n,{name:"PLMNewClassificationFacet",init:function(e){var t=e;if(this._parent(e),this.initUI(t),t.securityContext){var n=t.securityContext;o.setSetting("pad_security_ctx",n)}this.listenToPublishedInfo(function(e,t){if("currentSecurityContext"===e){let e=t.value;o.setSetting("pad_security_ctx",e)}})},initUI:function(e){var t=this;this.elements.container=UWA.createElement("div",{class:"classificationPLMNewContainer"}),promiseFactories=[function(){if(e.isBookmark)return new Promise(function(e,n){var i=JSON.parse(r).facets.bookmarks.require;require([i],function(e){t.plmNewFolderActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,objectId:"",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:t.elements.container,getClassificationAttributes:!1})});const a=setInterval(function(){t.plmNewFolderActive&&(e(),clearInterval(a))},100)})},function(){if(e.isLibrary)return new Promise(function(e,n){var i=JSON.parse(r).facets.library.require;require([i],function(e){t.plmNewLibraryActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,objectId:"",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:t.elements.container,getClassificationAttributes:!0})});const a=setInterval(function(){t.plmNewLibraryActive&&(e(),clearInterval(a))},100)})},function(){if(e.isExportControl)return new Promise(function(e,n){a.getGrantedRoles(function(e){for(var n=0;n<e.length;n++)if(e[n]&&("IPS"===e[n].id||"IPA"===e[n].id)){var i=JSON.parse(r).facets.ipexportControl.require;require([i],function(e){t.plmNewIPProtectionActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,objectId:"",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:t.elements.container,getClassificationAttributes:!0})});break}});const i=setInterval(function(){t.plmNewIPProtectionActive&&(e(),clearInterval(i))},100)})}],function(e){var t=Promise.resolve();e.forEach(function(e){t=t.then(e)})}(promiseFactories)},getUI:function(e){return this.elements.container},postCreation:function(e){var t=this;let n,a,o,s=e[0].identifier,r=[],c=new Map;var d;function u(e,t,n){e.length>0&&e.forEach(function(e){function i(e){let i=e.slice(4),a=t.get(i);c.has(n)||c.set(n.toString(),new Set),c.get(n).add(a)}"string"==typeof e&&e.startsWith("fail")?i(e):e&&e.value&&e.value.startsWith("fail")&&i(e.value)})}if(t.IDsToClassify=[],t.IDsToBookmark=[],t.IDsToProtect=[],t.plmNewIPProtectionActive&&(o=new Promise(function(e,t){d=e,t})),t.plmNewFolderActive&&t.plmNewFolderActive.saveRespectiveAssociations){t.plmNewFolderActive.folderActiveActionBar&&t.plmNewFolderActive.folderActiveActionBar.nestedMenuInContext.popover&&t.plmNewFolderActive.folderActiveActionBar.nestedMenuInContext.popover.dispatchEvent("close"),t.plmNewFolderActive.autoComplete&&t.plmNewFolderActive.autoComplete.selectedItems&&t.plmNewFolderActive.autoComplete.selectedItems.length>0&&(t.IDsToBookmark=t.plmNewFolderActive.autoComplete.selectedItems.map(function(e){return e.id}));let e=t.plmNewFolderActive.classIdAndTitleMap;a=new Promise(function(n){t.IDsToBookmark.length>0?t.plmNewFolderActive.saveRespectiveAssociations.call(null,s,t.IDsToBookmark).then(function(t){u(t,e,"BookmarksApp"),n()}):n()}).then(function(e){})}if(t.plmNewLibraryActive&&t.plmNewLibraryActive.saveRespectiveAssociations){t.plmNewLibraryActive.libraryActiveActionBar&&t.plmNewLibraryActive.libraryActiveActionBar.nestedMenuInContext.popover&&t.plmNewLibraryActive.libraryActiveActionBar.nestedMenuInContext.popover.dispatchEvent("close"),t.plmNewLibraryActive.autoComplete&&t.plmNewLibraryActive.autoComplete.selectedItems&&t.plmNewLibraryActive.autoComplete.selectedItems.length>0&&(t.IDsToClassify=t.plmNewLibraryActive.autoComplete.selectedItems.map(function(e){return e.id}));let e=t.plmNewLibraryActive.classIdAndTitleMap;n=new Promise(function(n){t.IDsToClassify.length>0?t.plmNewLibraryActive.saveRespectiveAssociations.call(null,s,t.IDsToClassify).then(function(t){u(t,e,"LibraryApp"),n()}).catch(()=>{console.log("Some save operation failed")}):n()}).then(function(e){var n=t.plmNewLibraryActive.plmNewClassificationFacetAccordeonView.createAccordeonClassIDandValueMap;for(const[e,t]of n){var a=[],o=[];for(let[e,n]of t)if(""!=n.value){var l=new Object;l.op="replace",l.path=e,l.value=n.value,void 0!==n.dimensionUnit&&(l.unitName=n.dimensionUnit),l.dimensionType=n.dimension,a.push(e),o.push(l)}r.push(new Promise(function(e,t){i.updateAttributes({requests:o,pid:s,queryParams:a,onComplete:function(t){e()},onFailure:function(e){t()}})}))}}).catch(()=>{})}return Promise.allSettled([r,n,a]).then(()=>{if(t.plmNewIPProtectionActive&&t.plmNewIPProtectionActive.saveRespectiveAssociations){t.plmNewIPProtectionActive.plmNewIPActionBar&&t.plmNewIPProtectionActive.plmNewIPActionBar.nestedMenuInContext.popover&&t.plmNewIPProtectionActive.plmNewIPActionBar.nestedMenuInContext.popover.dispatchEvent("close"),t.plmNewIPProtectionActive.autoComplete&&t.plmNewIPProtectionActive.autoComplete.selectedItems&&t.plmNewIPProtectionActive.autoComplete.selectedItems.length>0&&(t.IDsToProtect=t.plmNewIPProtectionActive.autoComplete.selectedItems.map(function(e){return e.id}));let e=t.plmNewIPProtectionActive.classIdAndTitleMap;t.IDsToProtect.length>0?t.plmNewIPProtectionActive.saveRespectiveAssociations.call(null,s,t.IDsToProtect).then(function(t){u(t,e,"ExportControlApp"),d()}):d()}}),new UWA.Promise(function(i){Promise.allSettled([a,n,o]).then(()=>{if(0!=t.IDsToBookmark.length||0!=t.IDsToClassify.length||0!=t.IDsToProtect.length){var n={level:"error",title:l.replace(l.get("classificationFailure_title"),{plmnewtype:e[0].type}),subtitle:l.replace(l.get("classificationFailure_subtitle"),{plmnewtype:e[0].type}),message:l.get("classificationFailure_message"),allowUnsafeHTML:!1,code:"error"};if(0==c.size){var a=l.replace(l.get("classificationSuccessMessage"),{plmnewtype:e[0].type});(n={}).code="200",n.message=a}i(n)}else i()})})},destroy:function(){this.options.onDestroyCallback(this.options.tabId),this._parent()}})}),define("DS/PLMNewCmp/PLMNewCommomCmpUXController",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WUXAutoComplete/AutoComplete","DS/Controls/Button","DS/Controls/TooltipModel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Loader","DS/Controls/ModalContainer","DS/PLMNewCmp/utils/PLMNewClassificationFacetAccordeonView","DS/PLMNewCmp/utils/PLMNewClassificationFacetData","DS/Tree/TreeDocument","i18n!DS/PLMNewCmp/assets/nls/PLMNewCommCmpSel","css!DS/PLMNewCmp/PLMNewCmp"],function(e,t,n,i,a,o,s,r,l,c,d,u,p,m){return e.extend(t,n,{name:"PLMNewCommomCmpUXController",classIdAndTitleMap:new Map,init:function(e){this._parent(e);this.elements.masterContainer=UWA.createElement("div",{class:"plmnew-masterContainer"}),this.counter=0,this.alreadySelectedNodes=[],this.alreadyPresentIDs=[],this.nodeRemoved,this.domaincontainer=UWA.createElement("div",{class:"plmnew-domain-container"}).inject(this.elements.masterContainer),this.container=UWA.createElement("div",{class:"plmnew-container"}).inject(this.domaincontainer);let t=e.container;this.elements.masterContainer.inject(t),this.loader=new l,this.plmNewClassificationFacetData=new u,this.plmNewClassificationFacetAccordeonView=new d({container:this.elements.masterContainer}),this.createPLMNewManagement().inject(this.container)},_closePanel:function(){this.dialog&&this.dialog.close()},createAutocompleteComponent:function(e,t,n,s){var r=this,l=UWA.createElement("div",{class:"plmnew-autocomplete-container"}),c=(UWA.createElement("div",{class:"plmnew-autocomplete-label",html:"<label>"+e+"</label>"}).inject(l),UWA.createElement("div",{class:"plmnew-autocomplete-line"}).inject(l)),d=UWA.createElement("div",{class:"plmnew-autocomplete"}).inject(c),u=UWA.createElement("div",{class:"plmnew-button-browse"}).inject(c);return(r=this).autoComplete=new i({elementsTree:new p,filterCB:function(e){e.length>=3?r.PLMNewCommonWebService.flattenedSearch({searchKey:e,alreadyPresentIDs:r.alreadyPresentIDs,nresults:500,onComplete:function(e){e.results&&(r.autoComplete.elementsTree.getAllDescendants().forEach(function(e){e._isSelected||e.isFavorite||!e.isRoot()||r.autoComplete.elementsTree.removeRoot(e)}),r.createAndInsert(r._getAutocomplete(),e.results),r.autoComplete.elementsTree.getAllDescendants({onlyVisibleNodes:!0}).forEach(function(e){if(!e._isSelected&&!e.isFavorite&&!e.isRoot()&&e.isRoot()){e.getChildren().map(e=>e.id).contains(e)||r.autoComplete.elementsTree.removeRoot(e)}}),r.alreadySelectedNodes=r.autoComplete.elementsTree.getAllDescendants({onlyVisibleNodes:!0}).map(e=>e&&e.id?e.id:0),r.alreadySelectedNodes=r.alreadySelectedNodes.filter(function(e){return void 0!==e&&0!==e}))},onFailure:function(e){console.log(e)}}):e.length>1&&e.length<=2&&r.autoComplete.elementsTree.getAllDescendants().forEach(function(e){e._isSelected||e.isFavorite||!e.isRoot()||r.autoComplete.elementsTree.removeRoot(e)})},allowFreeInputFlag:!1,class:"test",minLengthBeforeSearch:0,multiSearchMode:!0,typeDelayBeforeSearch:400,maxHeight:350,keepSearchResultsFlag:!1}).inject(d),r.autoComplete.addEventListener("change",function(e){var t=e.dsModel._model.getSelectedNodes(),n=t.map(e=>e.id);let i=!1,a=n.filter(function(e,t,n){return n.indexOf(e)!==t})[0];var o=!1;r.alreadyPresentIDs.length<n.length&&(o=!0);var s,l,c,d=(s=r.alreadyPresentIDs,l=n,c=[],s.forEach(function(e){l.includes(e)||c.push(e)}),c);d.length>1&&0==t.length&&(i=!0);var u=[...d][0];if(t.length)var p=t[t.length-1].id,m=t[t.length-1].getLabel();let f=t;if(a&&(r.autoComplete._selectionChips.removeChip(r.classIdAndTitleMap.get(a)),f.splice(t.length-1,1),r.autoComplete.selectedItems=f),!u&&o)-1==r.alreadyPresentIDs.indexOf(p)&&(r.alreadyPresentIDs.push(p),r.classIdAndTitleMap.set(p,m),r.options.getClassificationAttributes&&t&&t[t.length-1]&&r.getClassificationAttributes(p,function(e,t,n){e&&e.attribute&&e.attribute.length&&(r.plmNewClassificationFacetAccordeonView.prepareUnitData(e.attribute),r.plmNewClassificationFacetAccordeonView.prepareAccordeonData(e,p,n),r.plmNewClassificationFacetAccordeonView.displayAccordeonData(r.classIdAndTitleMap,p,t))}));else{var v=r.alreadyPresentIDs.filter(e=>e!==u),h=r.plmNewClassificationFacetAccordeonView.simpleAccordeon.items.filter(function(e){return e.id!=u});i&&(h=[],v=[]),r.plmNewClassificationFacetAccordeonView.simpleAccordeon.items=[],r.plmNewClassificationFacetAccordeonView.simpleAccordeon.items=[...h],r.plmNewClassificationFacetAccordeonView.views=[...h],r.plmNewClassificationFacetAccordeonView.createAccordeonClassIDandValueMap.delete(u),r.alreadyPresentIDs=v;var g=r.autoComplete.elementsTree.getChildren().filter(function(e){return e.id==u});g[0]&&!g[0].isFavorite&&r.autoComplete.elementsTree.removeRoot(g[0])}}),r.autoComplete.addEventListener("hide",function(e){this.dsModel._editor.valueToCommit="";let t=[];r.autoComplete.elementsTree.getAllDescendants({onlyVisibleNodes:!0}).forEach(function(e){e._isSelected||e.isFavorite||e.isRoot()?e._isSelected||!e.isRoot()||e.isFavorite||0==e.getAllDescendants({onlyVisibleNodes:!0}).length&&r.autoComplete.elementsTree.removeRoot(e):(e.isRoot()&&(t=e.getChildren().map(e=>e.id)),t.length)}),r.alreadySelectedNodes=r.autoComplete.elementsTree.getAllDescendants({onlyVisibleNodes:!0}).map(e=>e&&e.id?e.id:0),r.alreadySelectedNodes=r.alreadySelectedNodes.filter(function(e){return void 0!==e&&0!==e})}),new a({displayStyle:"lite",label:"Browse",onClick:s,icon:{iconName:"open-in-a-new-window",fontIconFamily:1},showLabelFlag:!1}).inject(u).tooltipInfos=new o({shortHelp:m.tooltip_browse}),l.inject(n),r.autoComplete},createAutocompleteDataTree:function(e){var t=this.plmNewClassificationFacetData.createAutocompleteDataTree(e);return t.onPreExpand(this._onPreExpand.bind(this)),t},setPossibleDatasAutocomplete:function(e,t){e.elementsTree=t},setPossibleDatasAutocompleteSer:function(e,t){e.elementsTree.addRoot(t)},setValuesAutocomplete:function(e,t){e.value=t},_setNodesIdTobeHighLighted:function(e){this._IdsTobeHighLighted=e},createAndInsert:function(e,t){var n=this;function i(e){return n.couldBeSelected(e)}n.plmNewClassificationFacetData.createAutocompleteDataTree(i);result=n.plmNewClassificationFacetData._generateSearchData(t,function(e){return n._getIcon(e)},function(e){return n.couldBeExpand(e)},i);let a=[];Object.assign(a,result.getChildren()),a.forEach(function(t){e.elementsTree.prepareUpdate(),e.elementsTree.addChild(t),e.elementsTree.pushUpdate()})},insertInAutocomplete:function(e,t){t.isSelectable=this.couldBeSelected(t.plmType),e.elementsTree.prepareUpdate(),e.elementsTree.getChildren().every(function(e){return void 0===e.id||(e.id!=t.id||void 0)})&&this.plmNewClassificationFacetData._createTreeNodeModel(t.options,e.elementsTree,this.couldBeSelected),e.elementsTree.pushUpdate()},_onPreExpand:function(e){return e.data.onlyUI?void e.target.preExpandDone():this._onPreExpandTreeNode(e)},_onPreExpandTreeNode:function(e){var t=e.data.nodeModel,n=[];if(t.getChildren().length>0&&t.getChildren().forEach(function(e){n.push(e.id)}),e.data.onlyUI)t.preExpandDone();else{var i=this;if(t.isFavorite)t.isFavorite?i._populateFavoriteSection({onComplete:function(){t.preExpandDone()}}):t.preExpandDone();else{var a=t.id||t._options.value;t.plmType==i._allSection&&(this._rootServiceHandler&&this._rootServiceHandler.cancel(),a=void 0);var o=t.plmType===i._allSection;i.PLMNewCommonWebService.expandInNewPLM({pid:a,level:e.data.expandLevel,isRoot:o,onComplete:function(a){var c=a.results||[];if(o){if(!t.isExpanded()){var d=i.plmNewClassificationFacetData._generateSearchData(c,s,r,l);if(t.prepareUpdate(),d.forEach(function(e){if(n.length>0)if(n.indexOf(e.id)>-1){var i=n.indexOf(e.id);i>-1&&n.splice(i,1)}else t.addChild(e);else t.addChild(e)}),n.length>0)for(var u=0;u<t.getChildren().length;u++){var p=t.getChildren()[u].id;n.indexOf(p)>-1&&(t.getChildren().splice(u,1),u-=1)}t.pushUpdate()}}else i.plmNewClassificationFacetData._generateExpandData(c,t,"All"===e.data.expandLevel,n,s,r,l);null===t.options.children&&(t.options.children=[]),t.preExpandDone()},onFailure:function(e){t.loadHasFailed=!0,t.preExpandDone()}})}}function s(e){return i._getIcon(e)}function r(e){return i.couldBeExpand(e)}function l(e){return i.couldBeSelected(e)}},createPLMNewManagement:function(){var e=UWA.createElement("div",{class:"plmnew-autocompletes-container"});this.autoCompleteName=this._autoCompleteName();this._autocompleteComponent(e);return this.loader.off(),c.removeModal(this.elements.masterContainer),e},createModal:function(e,t,n){var i=new s({});that=this,this.dialog||(this.dialog=new r({immersiveFrame:i,title:"New PLM",content:n,activeFlag:!1,height:"auto",minHeight:100,width:500,modalFlag:!0,domId:"plmnewDialog",buttons:{Cancel:this.elements.cancel,Save:this.elements.save}})),i.inject(e)},browseAssociations:function(e,t,n){this.onClickSelector()},_populateFavoriteSection:function(e){var t=this;t.getFavorites({onComplete:function(n){var i=n,a={useAsyncPreExpand:!1};t.plmNewClassificationFacetData._rootNodeFavorite.removeChildren(),i.forEach(function(e){a.label=e.name,a.isPersonal=e.isPersonal;var n=t._getIcon(e,"favorites");a.icons=[n],a.children=null,a.id=e.id,a.mxid=e.mxid,e.type?a.plmType=e.type:a.plmType="Folder",a.isFavorite=!0,t.plmNewClassificationFacetData._createTreeNodeModel(a,t.plmNewClassificationFacetData._rootNodeFavorite,t.couldBeSelected).setState({state:"noChildren"})}),e&&e.onComplete&&e.onComplete()},onFailure:function(n){t._logger.error("FolderTreeCont : unable to initialize list of Favorite Folders ",n),e&&e.onFailure&&e.onFailure(n)}})}})});