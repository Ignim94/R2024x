define("DS/ENOSpecMultiGridCommon/controller/SpecMultiGridCollectionToolBar",["UWA/Core","UWA/Class","DS/Menu/Menu","DS/ENOSpecMultiGridCommon/utils/SpecMultiGridUtil","DS/ENOSpecMultiGridCommon/utils/SpecMultiGridMask","DS/ENOSpecMultiGridCommon/utils/SpecMultiGridEvents","DS/ENOSpecMultiGridCommon/utils/Constants","DS/ENOSpecMultiGridCommon/utils/Notification","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","i18n!DS/ENOSpecMultiGridCommon/assets/nls/SpecMultiGridCommon"],function(t,e,n,i,o,r,a,s,l,c){"use strict";return e.extend({init:function(t){this.appCore=t.appCore,this.modelEvents=t.modelEvents,this.currentTabKey=t.currentTabKey,this.container=t.container,this.toolBarEvents=new r,this.hiddenCmds=[],this.currentViewType,this._subscribeEvents()},draw:function(t){t&&(this.target=t);var e={modelEvents:this.toolBarEvents,withmultisel:!0,showItemCount:!0,actions:this.actionCommands,multiselActions:null,multiselActionCallback:null,filter:{multiselect:!1,enableCache:!1},currentView:a.GRID_VIEW,currentNbitems:0,currentNbSelections:0};this.collectionToolbar=new l(e),this.collectionToolbar.inject(t),this.collectionToolbar.attachResizeSensor(),this.hideCommand("ResetChanges"),this.hideCommand("Unwraptext")},_subscribeEvents:function(t){var e=this;this.subscriptionList=[],this.modelEvents&&(this.subscriptionList.push(this.modelEvents.subscribe({event:a.UPDATE_MULIGRID_TOOLBOOR_COUNT},function(t){var n=e.currentModel?e.currentModel.getSelectedNodes().length:0;n>0?e.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_CHECKBOX_CHECK_FLAG,data:{}}):e.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_CHECKBOX_UNCHECK_FLAG,data:{}}),e.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_SELECTIONS_COUNT_UPDATE,data:n}),e.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_EVENT_UPDATE_COUNT,data:n})})),this.subscriptionList.push(e.modelEvents.subscribe({event:e.currentTabKey?"xsr-show-toolbar-reset-command-"+e.currentTabKey:"xsr-show-toolbar-reset-command"},function(){e.showCommand("ResetChanges")})),this.subscriptionList.push(e.modelEvents.subscribe({event:e.currentTabKey?"xsr-hide-toolbar-reset-command-"+e.currentTabKey:"xsr-show-toolbar-reset-command"},function(){e.hideCommand("ResetChanges")}))),e.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_ALL_SELECTED},function(t){e.currentModel.gridLayout.collectionView.selectAll(!0)}),e.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_ALL_UNSELECTED},function(t){e.currentModel.unselectAll()}),e.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_VIEW_ACTIVATED},function(t){t!==e.currentViewType&&(e.currentViewType=t,e.launchResetModelChanges(),e.switchView(t))}),e.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_SEARCH},function(t){var n=e.currentModel;n.prepareUpdate();var o=n.getChildren();(e.showAllNodes(o),t.searchValue[0]&&0!==t.searchValue.length)?(n.search({match:function(e){var n=e.nodeModel;if(!n._canBeGrouped())return!1;var o=n.getItemIDs();let r=n.getType(),a="";if(Array.isArray(o)&&o.length>0)for(let t=0;t<o.length;t++)if(n.options.grid[o[t]]){let e=n.options.grid[o[t]],s=n.getDynamicColumnValue("isGMTDate"),l=isNaN(e);!s||"string"!=r&&"timestamp"!=r||!l||isNaN(Date.parse(e))||(e=i.getDataGridformatedDate(e)),a+=e}return a&&t.searchValue[0]&&-1!==a.toUpperCase().indexOf(t.searchValue[0].toUpperCase())?(n.setSearchFilterState(!0),!1):(n.setSearchFilterState(!1),!0)}}).forEach(function(t,e){t._canBeGrouped()&&(t.unmatchSearch(),t.setSearchFilterState(!1),t.applyFilters())}),n.pushUpdate()):n.pushUpdate()})},showAllNodes:function(t){var e=this;t&&Array.isArray(t)&&t.forEach(function(t,n){t._canBeGrouped()?(t.setSearchFilterState(!0),t.applyFilters()):e.showAllNodes(t.getChildren())})},setActions:function(t){this.actionCommands=this.drawMenus(t)},setCurrentModel:function(t){this.currentModel=t},drawMenus:function(t){var e=[],n=this;t.forEach(function(t){var i={};i.id=t.key;var o=t.persistencyKey,r=t.isSelectable;if(i.text=t.text,i.title=t.text,i.fonticon=t.fonticon,o&&r){let e=n.setDefaultTooltip(t.key,t.text,o,r);i.title=i.text=e;let a=n.getCommandIcon(t.key,o,i.fonticon);i.fonticon=a}var a=t.subMenu;i.handler=a?function(t){var e=t.target.getBoundingClientRect();n.drawSubMenu(e,a,this,o,r)}:n.launchCommand.bind(n,t.key,t.text),e.push(i)});var i={id:"Export"};i.text=c.ExportCSV,i.title=c.ExportCSV,i.fonticon="export",i.handler=n.launchCommand.bind(n,"Export",c.ExportCSV),e.push(i);var o={id:"Print"};o.text=c.Print,o.title=c.Print,o.fonticon="print",o.handler=n.launchCommand.bind(n,"Print",c.Print),e.push(o);var r={id:"Wraptext"};r.text=c.Wrap,r.title=c.Wrap,r.fonticon="text-wrapping-ok",r.handler=n.launchWrapText.bind(n),e.push(r);var a={id:"Unwraptext"};a.text=c.Unwrap,a.title=c.Unwrap,a.fonticon="text-wrapping-off",a.handler=n.launchUnWrapText.bind(n),e.push(a);var s={id:"ResetChanges"};return s.text=c.ResetChanges,s.title=c.ResetChanges,s.fonticon="reset",s.handler=n.launchResetModelChanges.bind(n),e.push(s),e},launchResetModelChanges:function(){this.currentModel&&(this.currentModel.cancelChanges(),this.hideCommand("ResetChanges"))},launchWrapText:function(){o.maskLoader(this.container,c.WrapLoader);try{if(0==this.currentModel.getOriginalGridRoots().length){var t=this.appCore.triptychManager;if(t.isRightPanelVisible&&t.getCommandId()==a.TOOLBAR_CMD_MULTIGRID){var e=c.replace(c.get("Message_CmdEmptyGridCheck"),{operation:c.Wrap});s.displayNotification({eventID:"error",msg:e})}}else{this.currentModel.gridLayout.collectionView.prepareUpdateView();for(var n=this.currentModel.gridLayout.columns,i=0;i<n.length;i++){var r=n[i],l=r.dataIndex;"tree"!==r.dataIndex&&"string"!==r.typeRepresentation||(r._defaulttypeRepresentation=r.typeRepresentation,this.currentModel.gridLayout.setColumnTypeRepresentation(l,"textBlock")),this.currentModel.gridLayout.setColumnAutoRowHeightFlag(l,!0)}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),this.hideCommand("Wraptext"),this.showCommand("Unwraptext")}o.unmaskLoader(this.container)}catch(t){console.error("Wraping failed!! "+t),o.unmaskLoader(this.container)}},launchUnWrapText:function(){o.maskLoader(this.container,c.UnwrapLoader);try{this.currentModel.gridLayout.collectionView.prepareUpdateView();for(var t=this.currentModel.gridLayout.columns,e=0;e<t.length;e++){var n=t[e],i=n.dataIndex;"textBlock"===n.typeRepresentation&&(n.typeRepresentation=n._defaulttypeRepresentation),this.currentModel.gridLayout.setColumnAutoRowHeightFlag(i,!1)}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),this.hideCommand("Unwraptext"),this.showCommand("Wraptext"),o.unmaskLoader(this.container)}catch(t){console.error("Unwraping failed!! "+t),o.unmaskLoader(this.container)}},hideCommand:function(t){this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_VISIBILITY,data:{id:t,flag:!1}})},showCommand:function(t){this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_VISIBILITY,data:{id:t,flag:!0}})},disableCommands:function(t){for(var e=0;e<t.length;e++){var n=t[e];this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_DISABLE,data:n}),this.hiddenCmds.indexOf(n)>=0&&this.hideCommand(n)}},enableCommands:function(t){for(var e=0;e<t.length;e++){var n=t[e];this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_ENABLE,data:n}),this.hiddenCmds.indexOf(n)>=0&&this.hideCommand(n)}},launchCommand:function(t,e){var n=this.currentTabKey?"multigrid-toolbar-action-click-"+this.currentTabKey:"multigrid-toolbar-action-click";this.modelEvents&&this.modelEvents.publish({event:n,data:{cmdName:t,cmdNlsName:e}})},destroy:function(){this.subscriptionList&&this.modelEvents&&this.modelEvents.unsubscribeList(this.subscriptionList),this.toolBarEvents.unsubscribeAll()}})});