define("DS/ENOXSourcingRequestTemplate/helpers/RequestTemplateHelper",["DS/ENOXSourcingUXInfra/service/ENOXSourcingPlatformServices","DS/ENOXSourcingUXInfra/service/ENOXSourcingService","DS/UIKIT/Mask","DS/ENOXSourcingUXInfra/Constants/ENOXSourcingConstants","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/ENOXSourcingUXInfra/Utilities/Utility"],function(e,t,a,i,r,o,n){"use strict";var l=function(e){this.NLS=e.app.i18NProvider,this.controller=e,this.util=new n};return l.prototype.processUpdateValues=function(e){let t={data:[{...e}]};return t.data[0]["route-templates"]=[],this.getWorkflowDataByRequestCategory(e.requestCategory).forEach(a=>{e[a.stateName]?t.data[0]["route-templates"].push({updateAction:"CONNECT",id:e[a.stateName],requestState:a.stateName}):t.data[0]["route-templates"].push({updateAction:"DISCONNECT",requestState:a.stateName}),delete t.data[0][a.stateName]}),this.getAllWorkflows().forEach(e=>{t.data[0]["route-templates"].some(t=>t.requestState===e)||t.data[0]["route-templates"].push({updateAction:"DISCONNECT",requestState:e})}),t},l.prototype.processCreateValues=function(e){return{data:[{type:this.controller.app.typesConfigurator.objectTypes.template,description:e.description,title:e.title,requestCategory:e.requestCategory,Assignee_ID:e.Assignee,Classification_ID:e.classification}]}},l.prototype.processData=function(e){let t=e.data,a=e.searchData,i=e.definitions;var r={type:this.NLS[t.type],displayType:this.NLS[t.type],actualType:t.type,title:t.title,revision:t.revision,name:t.name,description:t.description,id:t.id,image:this.controller.typeConfigurator.icons.tile,typeIcon:this.controller.typeConfigurator.icons.type,state:t.state,stateDisplay:t.stateDisplay,created:t.originated,modified:t.modified,owner:t.owner,modifyAccess:t.modifyAccess,deleteAccess:t.deleteAccess,changeAccess:t.changesov,fromdisconnectAccess:t.fromdisconnectAccess?t.fromdisconnectAccess.toLowerCase():"true",requestCategory:t.requestCategory,impactedItemsRequired:"TRUE"===t.impactedItemsRequired?"Yes":"No",hasAnswerItems:t.hasAnswerItems,source:t.Source,sourceDisplay:t.sourceDisplay,classification:"",classificationId:"",supportedInProcessItemTypes:t.supportedInProcessItemTypes,collabSpace:t.collabSpace?t.collabSpace:"",organization:t.organization?t.organization:""};this.controller.typeConfigurator.includeProperties.forEach(e=>{r[e.name]=t[e.name]}),t.ownerInfo&&(r.owner=(t.ownerInfo.firstname+" "+t.ownerInfo.lastname).trim()?t.ownerInfo.firstname+" "+t.ownerInfo.lastname:t.ownerInfo.name,r.ownerIdentifier=t.ownerInfo.name),i&&(r.definitions=i);var o=t["component-classification"],n=t["route-templates"]?t["route-templates"]:[],s=t["request-assignee"];if(o.length>0)for(var c=0;c<o.length;c++){var p=o[c];if("General Class"===p.type||"Classification Proxy Item"===p.type){let e=p.Proxy_Id?p.Proxy_Id:p.physicalid,t=p.Proxy_Title?p.Proxy_Title:p.name;if(a){let i=l.prototype.getActualDataFromSearch(a,e);i&&(e=i.physicalid?i.physicalid:e,t=i["ds6w:label"]?i["ds6w:label"]:t)}r.classification?(r.classification=r.classification+","+t,r.classificationId=r.classificationId+","+e):(r.classification=t,r.classificationId=e)}}if(s.length>0){var d=s[0];"Person"===d.type||"Group"===d.type?(r.assignee=d.name,r.assigneeID=d.physicalid,r.assigneeFullName=this.getRequestAssigneeLabel(d)):"Group Proxy"===d.type&&(r.assigneeID=d.physicalid,r.assigneeUUID=d.name,r.assigneeType=d.type)}return n.length>0&&this.getWorkflowDataByRequestCategory(r.requestCategory).forEach(e=>{let t=n.filter(t=>e.stateName===t.requestState);r[e.stateName]=t[0]?t[0].name+" ("+t[0].revision+")":"",r[e.stateName+" ID"]=t[0]?t[0].id:""}),{grid:r,label:r.title,thumbnail:require.toUrl(r.image),id:r.id}},l.prototype.getWorkflowDataByRequestCategory=function(e){return(this.controller.typeConfigurator["request-category-configs"][e]?this.controller.typeConfigurator["request-category-configs"][e]:this.controller.typeConfigurator["request-category-configs"].default).workflow.map(e=>({stateName:e,labelNLSKey:e+"_label",placeholderNLSKey:e+"_placeholder"}))},l.prototype.getAllWorkflows=function(){let e=[],t=this.controller.typeConfigurator["request-category-configs"];for(let a of Object.keys(t))e.push(...t[a].workflow);return e},l.prototype.getUGLabel=function(e){let t=this,a={completePreCond:'[ds6w:resourceUid]:"<uuid:'+e+'>"',nresults:1,start:"0",with_nls:!1};return new Promise(e=>{t.controller.searchUtil.callFederatedSearch(t.controller.searchUtil.getSearchPayload([],[],[i.SOURCE_USERGROUPS],a)).then(function(a){let r=t.controller.searchUtil.processResults(a);r&&r.length>0?e(r[0]["ds6w:label"]):e(i.PRIVATE_ASSIGNMENT)})})},l.prototype.getTooltip=function(e){let t=this,{title:a,revision:i,state:r,owner:o,requestCategory:n,assigneeFullName:l}=e.options.grid,s=[{label:t.NLS.title,data:a},{label:t.NLS.revision,data:i},{label:t.NLS.maturity_state,data:r},{label:t.NLS.owner,data:o},{label:t.NLS.request_category,data:n},{label:t.NLS.request_assignee,data:l}];return e.options.grid.classification&&s.push({label:t.NLS.category_classification,data:e.options.grid.classification.replaceAll(",",", ")}),function(e){let t="";return e.forEach(function(e){""!==e.data&&void 0!==e.data&&(""!==t&&(t+="\n"),t=t+e.label+": "+e.data)}),t}(s)},l.prototype.buildGetLifecyclePayload=function(e){return{data:[{id:e.data.respParams.id,physicalid:e.data.respParams.id,type:e.data.respParams.type,identifier:e.data.respParams.id,source:"Sourcing",relativePath:"/resources/v1/modeler/dssourcing/sourcingrequesttemplates?$mask=dssourcing:RequestTemplate"}]}},l.prototype.getRequestAssigneeLabel=function(e){let t=(e.firstName+" "+e.lastName).trim()?e.firstName+" "+e.lastName:e.title;return t||(t=e.name),t},l.prototype.processForList=function(e){var a=this;return new Promise(i=>{if(e.data){var r=[];if(e.data.map(e=>{var t=e["component-classification"]?e["component-classification"][0]:null;t&&!r.includes(t.Proxy_Id)&&r.push(t.Proxy_Id)}),r.length>0){var o=a.getSearchPayload(r);t.getFederatedSearchDataPromise({searchPayLoad:o}).then(function(t){i(e.data.map(e=>a.processData({data:e,searchData:t}),a))})}else i(e.data.map(e=>a.processData({data:e}),a))}})},l.prototype.getSearchPayload=function(t){return{nresults:t.length,label:"test",locale:widget.lang,select_predicate:["ds6w:label","physicalid","name","ds6w:created","ds6w:modified","ds6w:responsible","ds6wg:revision","partnumber","ds6w:type"],select_file:["icon","thumbnail_2d"],query:'flattenedtaxonomies:"types/General Class"',source:["3dspace"],tenant:e.getPlatformId(),resourceid_in:t}},l.prototype.getActualDataFromSearch=function(e,t){if(!e.results)return{};var a=e.results.filter(e=>{return e.attributes.filter(e=>"physicalid"===e.name&&e.value===t).length>0}),i={};return a.length>0&&a[0].attributes.forEach(e=>{e.dispValue?i[e.name]=e.dispValue:i[e.name]=e.value}),i},l.prototype.createModel=function(e){let t=this;var a=t.preprocessForModelCreation(e),i=new r;return i.prepareUpdate(),a.map(function(e){let a=t.createNode(e);i.addRoot(a)}),i.pushUpdate(),i},l.prototype.preprocessForModelCreation=function(e){var t=[];return e.forEach(function(e){let a={resourceid:e.id,name:e.dataelements.name,value:e.dataelements.title?e.dataelements.title:e.dataelements.name,label:e.dataelements.title?e.dataelements.title+" ("+e.dataelements.revision+")":e.dataelements.name+" ("+e.dataelements.revision+")"};t.push(a)}),this.util.sortArrayAlphabeticallyBasedOnProperty(t,"label"),t},l.prototype.createNode=function(e){return e.grid=e,new o(e)},l.prototype.getRevisePayload=function(e){return{data:[{id:e,securityContext:t.getSecurityContext()}]}},l.prototype.getSublabel=function(e){return e.getAttributeValue("stateDisplay")+" | "+e.getAttributeValue("owner")+" | "+e.getAttributeValue("requestCategory")},l.prototype.translateRequestCategory=function(e,t){if(e===i.COMPONENT_INTRODUCTION_REQUEST)return this.NLS[i.COMPONENT_INTRODUCTION_REQUEST];var a=t.filter(t=>t.value===e)[0];return a?a.label:e},l.prototype.createNodeForCompCategory=function(e={}){let{label:t,id:a,icon:r="",type:n,name:l,state:s}=e;return new o({label:t||"Label not available",id:a,icons:[r],grid:{type:n,name:l,state:s},children:n===i.LIBRARY?[]:null})},l.prototype.processSelectedClassificationData=function(e={}){let{idList:t="",labelList:a=""}=e,i=[];var r=t.split(",");r.length>0&&a.split(",").forEach(function(e,t){i.push({value:e,id:r[t]})});return i},l.prototype.createNodesForSourceTypes=function(e){var t=function(e){return new o({label:e.sourceTypeDisplay||"Label not available",id:e.sourceType,grid:{value:e.sourceType,abstractType:"true"===e.abstractType},children:function(){let a,i=[];return 0!==e.subtypes.length?(e.subtypes.forEach(function(e){i.push(t(e))}),a=i):a=null,a}()})};return t(e)},l.prototype.getStatusbarIcons=function(e){let t=[],{assigneeFullName:a,classification:i}=e.options.grid;return a&&t.push("users"),i&&t.push("library-class"),t},l.prototype.getStatusbarIconsTooltips=function(e){let t=[],{assigneeFullName:a,classification:i}=e.options.grid;return a&&t.push(this.NLS.request_assignee+": "+a),i&&t.push(this.NLS.category_classification+": "+i.replaceAll(",",", ")),t},l.prototype.getLabel=function(e){let{title:t,revision:a}=e.options.grid;return t+" ("+a+")"},l.prototype.getSourcePropertyField=function(e){let t=this,a=e.options.data.respParams.sourceDisplay,i=e.options.data.respParams.source;return{type:"autocompleteWithSearch",label:t.NLS.source_type,placeholder:t.NLS.select_source,name:"sourceDisplay",minLengthBeforeSearch:"disable",typeDelayBeforeSearch:"disable",searchButtonNotRequired:!0,values:[{value:a,id:i}],dataFetcherMethod:function(a,i){return t.controller.getSourceTypeNodesForTree({fieldController:i,requestCategory:e.viewRef.currentRequestCategory})}}},l.prototype.getTypePropertyField=function(e){let t=e.options.data.respParams.type;return{type:"text",label:this.NLS.type,name:"type",value:this.NLS[t]?this.NLS[t]:t,disable:!0,nonEditable:!0}},l.prototype.getNamePropertyField=function(e){let t=e.options.data.respParams.name;return{type:"text",label:this.NLS.name,name:"name",value:t,disable:!0,nonEditable:!0}},l.prototype.getRequestCategoryPropertyField=function(e){let t=this,a=e.options.data.respParams.requestCategory,i=e.options.requestCategory;return{type:"select",label:t.NLS.req_category,name:"requestCategory",options:i,value:a,disable:!0,required:!0,events:{onChange:function(){let a=e.viewRef.currentRequestCategory,i=e.viewRef.currentRequestCategory=this.getValue()[0],r=t.getWorkflowDataByRequestCategory(a),o=t.getWorkflowDataByRequestCategory(i);r.forEach((t,a)=>{e.viewRef.propertiesView.container.querySelector('[name="'+t.stateName+'"]').closest(".form-group").querySelector("label").innerText=e.viewRef.controller.helper.NLS[o[a].stateName+"_label"],e.viewRef.propertiesView.container.querySelector('[name="'+t.stateName+'"]').closest(".form-group").querySelector("input").placeholder=e.viewRef.controller.helper.NLS[o[a].stateName+"_placeholder"],e.viewRef.propertiesView.container.querySelector('[name="'+t.stateName+'"]').setAttribute("name",o[a].stateName)})}}}},l.prototype.getDescriptionPropertyField=function(e){let t=e.options.data.respParams.description;return{type:"textarea",label:this.NLS.description,placeholder:this.NLS.description,name:"description",value:t,disable:!0,errorText:this.NLS.max_char_limit_err_msg,isLengthy:!0,helperText:this.NLS.length_256_limit}},l.prototype.getTitlePropertyField=function(e){let t=e.options.data.respParams.title;return{type:"text",label:this.NLS.title,placeholder:this.NLS.enter_title,name:"title",value:t,required:!0,errorText:this.NLS.max_char_limit_err_msg,isLengthy:!1,helperText:this.NLS.length_100_limit}},l.prototype.getClassificationPropertyField=function(e){let t=this,a=e.options.data.respParams.classification,r=e.options.data.respParams.classificationId,o=r?t.processSelectedClassificationData({idList:r,labelList:a}):[];return{type:"autocompleteWithSearch",label:t.NLS.category_classification,name:"Classification_ID",multiSelect:!0,placeholder:t.NLS.select_category_classification,values:o,minLengthBeforeSearch:"disable",typeDelayBeforeSearch:"disable",keepSearchResultsFlag:"disable",completePreCond:i.IP_CLASSIFICATION__SEARCH_QUERY,sources:[i.SOURCE_3DSPACE],allowFreeInput:!0,floatingSuggestions:!0,allowDrop:!1,searchButtonNotRequired:!1,dataFetcherMethod:function(e,a){return t.controller.getLibraryClassificationData({fieldController:a})}}},l.prototype.getAssigneePropertyField=function(e){let t=this,i=e.options,r=i.data.respParams.assigneeFullName?i.data.respParams.assigneeFullName:i.data.respParams.assignee,o=i.data.respParams.assigneeUUID,n=i.data.respParams.assigneeID,l=i.data.respParams.fromdisconnectAccess;return{type:"autocompleteWithSearch",label:t.NLS.assignee,name:"Assignee_ID",required:!0,multiSelect:!1,isPersonOrGroup:!0,placeholder:t.NLS.select_assignee,value:r,assigneeUUID:o,identifier:n,valueValidator:function(e,i){if(i.assigneeUUID){let r=e.getWrapperDiv();a.mask(r,t.NLS.fetching_details);let o=e.getInputField();t.getUGLabel(i.assigneeUUID).then(e=>{o.value=e;let t=widget.getElements("[name='Assignee_ID']").filter(e=>e.hasClassName("simpleText"));t[0]&&(t[0].innerText=e)}).finally(function(){a.unmask(r)})}},callback:function(e){if(n!==e.getSelectedObjectAttrValue("value")){a.mask(e.getWrapperDiv(),t.NLS.fetching_details);var i=e.getInputField();i.value="",i.id="",i.setAttribute("identifier",""),e.getSelectedObjectAttrValue("value")?t.controller.model.getPeronOrGroupActualIds({data:{phyIds:[e.getSelectedObjectAttrValue("value")]},type:e.getSelectedObjectAttrValue("type")}).then(function(t){if(t&&t.ObjIds&&t.ObjIds.length>0){i.setAttribute("identifier",t.ObjIds[0]),i.value=e.getSelectedObjectAttrValue("label");let a=widget.getElements("[name='Assignee_ID']").filter(e=>e.hasClassName("simpleText"));a[0]&&(a[0].innerText=e.getSelectedObjectAttrValue("label")),i.id=e.getSelectedObjectAttrValue("value")}}).catch(function(e){widget.notificationUtil.showError(e.Result?e.Result:t.NLS.error_getting_actual_id)}).finally(function(){a.unmask(e.getWrapperDiv())}):a.unmask(e.getWrapperDiv())}},nonEditable:!("true"===l)}},l.prototype.getApprovalWorkflowPropertyField=function(a){var o=this;let n=o.getWorkflowDataByRequestCategory(a.viewRef.currentRequestCategory).filter(e=>e.stateName===a.name)[0],l=a.options.data.respParams[a.name]?a.options.data.respParams[a.name]:"",s=a.options.data.respParams[a.name+" ID"];return{type:"autocompleteWithSearch",label:o.NLS[n.labelNLSKey],placeholder:o.NLS[n.placeholderNLSKey],accordeonHeader:{label:o.NLS.workflow_templates,value:"workflow_information"},name:a.name,completePreCond:' (flattenedtaxonomies:"types/'+i.TYPE_ROUTE_TEMPLATE+'" AND current:"Active") AND ([ds6w:fulfillsRationale]:("'+i.TYPE_ROUTE_APPROVAL+'"))',sources:[i.SOURCE_3DSPACE],value:l,identifier:s,id:s,minLengthBeforeSearch:"disable",typeDelayBeforeSearch:"disable",keepSearchResultsFlag:"disable",searchButtonNotRequired:e.getPlatformId()!==i.ONPREMISE,dataFetcherMethod:function(){let e="$type="+i.TYPE_ROUTE_TEMPLATE+"&$index=true&$where=**&$routeBasePurpose=Approval";var a={source:i.SOURCE_SOURCING,endpoint:"/resources/v1/modeler/dssourcing/search?"+e};return t.getDataPromise(a).then(function(e){var t=new r;return e.data&&(t=o.createModel(e.data)),new UWA.Promise(function(e){e({elementsTree:t})})}).catch(function(){widget.notificationUtil.showError(o.NLS.error_getting_details)})},callback:function(e){void 0===e.getSelectedObjectAttrValue("resourceid")&&e.clearIdentifier(e)},nonEditable:!("true"===a.options.data.respParams.fromdisconnectAccess)}},l.prototype.getOrganizationField=function(e){return{type:"text",label:this.NLS.organization,name:"organization",value:e.options.data.respParams.organization,disable:!0,nonEditable:!0}},l.prototype.getCollabSpaceField=function(e){return{type:"text",label:this.NLS.collab_space,name:"collabSpace",value:e.options.data.respParams.collabSpace,disable:!0,nonEditable:!0}},l.prototype.getField=function(e){let t=this,a=e.data,i=e.props,r=JSON.parse(e.props.viewConfig),o=r.attributeType?r.attributeType:r.type,n={name:i.name,label:t.NLS[e.fieldConfig.labelNLSKey]||"NLS not defined",value:a[i.name],...e.fieldConfig.placeholderNLSKey&&{placeholder:t.NLS[e.fieldConfig.placeholderNLSKey]}};if("string"===o||"select"===o)if(i.range)if(r.multivalue){n.type="autocomplete",n.showSuggestsOnFocus=!0,n.multiSelect=!0,n.className="src-multi-select-autocomplete";let e=i.range.item.map(e=>({value:e.value,label:e.display,selected:n.value?n.value.includes(e.value):!!e.default}));n.dataSet={items:e},n.tokenSeparator=", "}else{n.type="select";let e=i.range.item.map(e=>({value:e.value,label:e.display,selected:n.value?n.value.includes(e.value):!!e.default}));n.options=e}else r.multiline?(n.type="textarea",n.multiline=!0,n.errorText=t.NLS.max_char_limit_err_msg,n.isLengthy=!0,n.helperText=t.NLS.length_256_limit):(n.type="text",n.errorText=t.NLS.max_char_limit_err_msg,n.isLengthy=!1,n.helperText=t.NLS.length_100_limit);else if("real"===o||"integer"===o){if(n.type=o,r.minimum&&r.maximum){n.minValue=r.minimum,n.maxValue=r.maximum;let e=t.NLS.helper_text_number_range;e=(e=e.replace("$1",r.minimum)).replace("$2",r.maximum),n.helperText=e}}else if("timestamp"===o)n.type="date";else if("boolean"===o){n.type="select";let e=i.range.item.map(e=>({value:e.value,label:e.display,selected:n.value?n.value.includes(e.value):!!e.default}));n.options=e}return n},l.prototype.getPropertyMapper=function(e){return[{name:"type",helperMethod:"getTypePropertyField"},{name:"title",helperMethod:"getTitlePropertyField"},{name:"name",helperMethod:"getNamePropertyField"},{name:"assignee",helperMethod:"getAssigneePropertyField"},{name:"requestCategory",helperMethod:"getRequestCategoryPropertyField"},{name:"classification",helperMethod:"getClassificationPropertyField"},{name:"source",helperMethod:"getSourcePropertyField"},{name:"hasAnswerItems",labelNLSKey:"has_answer_items",placeholderNLSKey:"select_answer_items"},{name:"supportedInProcessItemTypes",labelNLSKey:"has_in_process_items",placeholderNLSKey:"select_in_process_items"},{name:"impactedItemsRequired",labelNLSKey:"req_impacted_items"},{name:"description",helperMethod:"getDescriptionPropertyField"},{name:"organization",helperMethod:"getOrganizationField"},{name:"collabSpace",helperMethod:"getCollabSpaceField"},...this.getWorkflowDataByRequestCategory(e.data.respParams.requestCategory).map(e=>({name:e.stateName,helperMethod:"getApprovalWorkflowPropertyField"})),...this.controller.typeConfigurator.includeProperties]},l.prototype.getFieldsForPropertiesPage=function(e){let t=this,a=e.data.respParams.definitions.filter(e=>e.name===i.RT_6W_XML_SERVICE_NAME)[0].items;return t.getPropertyMapper(e).filter(e=>!t.controller.typeConfigurator.excludeProperties.includes(e.name)).map(i=>{let r;return r=i.helperMethod?t[i.helperMethod]({name:i.name,options:e,viewRef:e.that}):t.getField({props:a.filter(e=>e.name===i.name)[0],data:e.data.respParams,fieldConfig:i})})},l.prototype.prepareDynamicColumn=function(e,t){return{text:this.NLS[t],dataIndex:e,minWidth:200}},l}),define("DS/ENOXSourcingRequestTemplate/views/RequestTemplate/CreateRequestTemplate",["DS/ENOXSourcingUXInfra/components/ModalWindowWrapper/ModalWindowWrapper","DS/UIKIT/Scroller","DS/ENOXSourcingUXInfra/xsourcingformview/ENOXSourcingForm","DS/UIKIT/Mask","DS/ENOXSourcingUXInfra/Constants/ENOXSourcingConstants","DS/ENOXSourcingUXInfra/service/ENOXSourcingPlatformServices"],function(e,t,a,i,r,o){"use strict";var n=function(e){this.RTController=e,this.NLS=this.RTController.app.i18NProvider};return n.prototype.render=function(n){this._container=n._container,this.router=n.router,this._applicationChannel=n._applicationChannel;var l=this,s=UWA.createElement("div",{id:"createRequestTemplate",class:"createRequestTemplate modalBodyDiv"});l.RTController.getRequestCategory(n).then(function(c){var p=[];c.data.forEach(function(e){"true"===e.defaultSelected.toLowerCase()?p.push({label:e.displayName?e.displayName:e.name,value:e.name,selected:!0}):p.push({label:e.displayName?e.displayName:e.name,value:e.name})}),l.fields=[{type:"text",label:l.NLS.title,placeholder:l.NLS.enter_title,name:"title",required:!0,errorText:l.NLS.please_enter_title,isLengthy:!1,helperText:l.NLS.length_100_limit},{type:"select",label:l.NLS.req_category,name:"requestCategory",required:!0,options:p},{type:"autocompleteWithSearch",label:l.NLS.category_classification,placeholder:l.NLS.select_category_classification,multiSelect:!0,name:"classification",minLengthBeforeSearch:"disable",typeDelayBeforeSearch:"disable",keepSearchResultsFlag:"disable",completePreCond:r.IP_CLASSIFICATION__SEARCH_QUERY,allowDrop:!1,sources:[r.SOURCE_3DSPACE],searchButtonNotRequired:!1,dataFetcherMethod:function(){return l.RTController.getLibraryClassificationData()}},{type:"autocompleteWithSearch",label:l.NLS.assignee,placeholder:l.NLS.select_assignee,required:!0,multiSelect:!1,errorText:l.NLS.please_enter_request_assignee,name:"Assignee",isPersonOrGroup:!0,callback:function(e){i.mask(e.getWrapperDiv(),l.NLS.fetching_details);var t=e.getInputField();t.value="",t.id="",t.setAttribute("identifier",""),e.getSelectedObjectAttrValue("value")?l.RTController.model.getPeronOrGroupActualIds({data:{phyIds:[e.getSelectedObjectAttrValue("value")]},type:e.getSelectedObjectAttrValue("type")}).then(function(a){a&&a.ObjIds&&a.ObjIds.length>0&&(t.setAttribute("identifier",a.ObjIds[0]),t.value=e.getSelectedObjectAttrValue("label"),t.id=e.getSelectedObjectAttrValue("value"))}).catch(function(e){widget.notificationUtil.showError(e.Result?e.Result:l.NLS.error_getting_actual_id)}).finally(function(){i.unmask(e.getWrapperDiv())}):i.unmask(e.getWrapperDiv())}},{type:"textarea",label:l.NLS.description,name:"description",placeholder:l.NLS.enter_description,errorText:l.NLS.max_char_limit_err_msg,isLengthy:!0,helperText:l.NLS.length_256_limit}];var d=new a({grid:"4,8",fields:l.fields,events:{onSubmit:function(){var e=!0,t={data:[]};if(this.texts.length>0&&(e=this.FormValidations.charLimitValidate(this.texts)),this.wuxAutocompletes.length>0&&(e=(e=d.FormValidations.wuxAutoCompleteValidation(this.wuxAutocompletes))&&d.FormValidations.wuxAutoCompleteMaskingValidation(this.wuxAutocompletes)),m&&m.destroy&&e){if(n.formValues=d.getValues(),d.getField("Assignee").value&&(n.formValues.Assignee=d.getField("Assignee").getAttribute("identifier")),n.formValues.classification={},d.wuxAutocompletes[0].selectedItems)d.wuxAutocompletes[0].selectedItems.forEach(function(e){t.data.push({id:e._options.id,type:r.CLASSIFICATION,dataelements:{"ProxyItem.Proxy_Title":e.getAttributeValue("label"),"ProxyItem.Proxy_Service":r.SOURCE_3DSPACE,"ProxyItem.Proxy_State":e.getAttributeValue("state"),"ProxyItem.Proxy_Tenant":o.getPlatformId()}})}),n.formValues.classification=t;l.RTController.create(n),m.destroy()}},onChange:function(){this.texts.length>0&&this.FormValidations.charLimitValidate(this.texts)}}}).inject(s);window.odtForm&&(window.odtForm=d);var u=UWA.createElement("span",{id:"modalButtons",class:"modal-buttons"});UWA.createElement("button",{type:"submit",name:"create",id:"createBtn",form:"myForm",class:"btn btn-primary",text:l.NLS.create,value:l.NLS.create}).inject(u),UWA.createElement("button",{type:"reset",id:"closeModalBtn",class:"btn btn-default",text:l.NLS.cancel,value:l.NLS.cancel,events:{click:function(){m.destroy()}}}).inject(u);let m=new e({app:{widget:widget},draggable:!0,resizable:!0,escapeToClose:!0,onHideCB:()=>m.destroy(),height:"480px",classNames:"create-npr-details-modal"}).getModal();m.show(),m.setHeader(l.NLS.new_request_template),s.inject(m.getBody()),u.inject(m.getFooter()),new t({element:s}).inject(m.getBody()),widget.getElement(".xSourcingForm").setAttribute("id","myForm")}).catch(function(){widget.notificationUtil.showError(l.NLS.failed_to_fetch_request_catgeory)})},n}),define("DS/ENOXSourcingRequestTemplate/components/ApplicationTopBar/ApplicationTopBarWrapper",["DS/ENOXSourcingUXInfra/InformationPanel/InformationPanelUI","DS/UIKIT/Mask"],function(e){"use strict";var t=function(){};return t.prototype.init=function(e,t,a){this._applicationChannel=e,this.triptych=t,this._subscribeToEvents(),this.NLS=a},t.prototype._subscribeToEvents=function(){var t=this,a="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(a,function(){},!1),this._applicationChannel.subscribe({event:"welcome-panel-collapse"},function(){t._applicationChannel.publish({event:"triptych-set-size",data:{size:40,side:"left"}}),t._applicationChannel.publish({event:"triptych-show-panel",data:"left"})}),this._applicationChannel.subscribe({event:"welcome-panel-expand"},function(){t._applicationChannel.publish({event:"show-welcomepanel-icon"}),t._applicationChannel.publish({event:"triptych-set-size",data:{size:350,side:"left"}}),t._applicationChannel.publish({event:"triptych-show-panel",data:"left"})}),this._applicationChannel.subscribe({event:"welcome-panel-hide"},function(){t._applicationChannel.publish({event:"hide-welcomepanel-icon"}),t._applicationChannel.publish({event:"welcome-panel-collapse"}),t._applicationChannel.publish({event:"triptych-hide-panel",data:"left"}),t._applicationChannel.publish({event:"information-panel-close"})}),this._applicationChannel.subscribe({event:"information-panel-close"},function(){t._applicationChannel.publish({event:"triptych-hide-panel",data:"right"}),widget.getElement(".xCS-triptych-wrapper-right").innerHTML=""}),this._applicationChannel.subscribe({event:"information-panel-open"},function(){t._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),t._applicationChannel.publish({event:"information-panel-visible",data:null}),t._applicationChannel.publish({event:"information-panel-add-content",data:t.selectedObject})}),this._applicationChannel.subscribe({event:"triptych-panel-hidden"},function(e){"right"===e&&(t._applicationChannel.publish({event:"information-panel-hidden",data:null}),widget.getElement(".xCS-triptych-wrapper-right").innerHTML="");var a=widget.getElement("#sourcinginfoicon");if(a){var i=a.getChildren()[0];i.className.contains("enox-collection-toolbar-filter-activated")&&i.removeClassName("enox-collection-toolbar-filter-activated")}var r=document.querySelector(".information-icon");null!==r&&r.className.contains("active")&&r.classList.remove("active"),t._applicationChannel.publish({event:"destroy-document-view"})}),this._applicationChannel.subscribe({event:"xsourcing-collectionview-selected-object-id"},function(e){e.selectedObject&&!e.fromInfoPanel&&(t.selectedObject=e,t.triptych._triptych._isRightOpen&&t._applicationChannel.publish({event:"information-panel-add-content",data:e}))}),this._applicationChannel.subscribe({event:"xsourcing-collectionview-unselected-object-id"},function(e){t.selectedObject=null,e.isDocumentView||t._applicationChannel.publish({event:"information-panel-add-content",data:t.selectedObject})}),this._applicationChannel.subscribe({event:"information-panel-add-content"},function(a){var i=widget.getElement(".xCS-triptych-wrapper-right");if(i.innerHTML="",a&&"multipleSelected"===a.selectedObject){let e=UWA.createElement("span",{styles:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},text:t.NLS.select_only_one_item});i.appendChild(e)}else if(a&&a.openDetails)a.openDetails();else if(a&&a.selectedObject){new e(a.selectedObject).init(a.selectedObject)}else{let e=UWA.createElement("div",{styles:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},text:t.NLS.no_valid_item_selected});i.appendChild(e)}}),this._applicationChannel.subscribe({event:"information-panel-reload-if-open"},function(){t._applicationChannel.publish({event:"triptych-fetch-panel-visibility-status",data:{side:"right",cbFunc:e=>{e&&t._applicationChannel.publish({event:"information-panel-open"})}}})}),this._applicationChannel.subscribe({event:"make-information-panel-disappear"},function(e){if(!e.forInfo){t._applicationChannel.publish({event:"information-panel-close"});var a=widget.getElement(".information-panel.panel-icon-wrapper");a&&(a.style.display="none")}})},t}),define("DS/ENOXSourcingRequestTemplate/components/Triptych/TriptychWrapper",["DS/ENOXTriptych/js/ENOXTriptych","css!DS/ENOXSourcingRequestTemplate/components/Triptych/TriptychWrapper.css"],function(e){"use strict";var t=function(){};return t.prototype.init=function(t,a){this._left=UWA.createElement("div"),this._left.classList.add("xCS-triptych-wrapper-left"),this._main=UWA.createElement("div"),this._main.classList.add("xCS-triptych-wrapper-middle"),this._right=UWA.createElement("div"),this._right.classList.add("xCS-triptych-wrapper-right"),this._applicationChannel=t,this._triptych=new e;var i={left:{resizable:!1,originalSize:350,originalState:widget.body.offsetWidth<550?"close":"open",overMobile:!0},right:{resizable:!0,originalSize:450,originalState:"close",withClose:!0,overMobile:!0,minWidth:406},borderRight:!0,borderLeft:!0,container:a,withtransition:!0,modelEvents:this._applicationChannel};this._triptych.init(i,this._left,this._main,this._right)},t.prototype.inject=function(e){this._triptych.inject(e)},t.prototype._getTriptych=function(){return this._triptych},t.prototype.getLeftPanelContainer=function(){return this._left},t.prototype.getRightPanelContainer=function(){return this._right},t.prototype.getMainPanelContainer=function(){return this._main},t}),define("DS/ENOXSourcingRequestTemplate/models/RequestTemplate",["DS/ENOXSourcingUXInfra/service/ENOXSourcingService"],function(e){"use strict";var t=function(e){this.controller=e,this.source="sourcing"};return t.prototype.deleteRequestTemplate=function(t){var a={endpoint:"/resources/v1/modeler/dssourcing/sourcingrequesttemplates"};return a.source=this.source,a.deleteData=t.deleteData,e.deleteServicePromise(a)},t.prototype.listRequestTemplates=function(t){return t.endpoint="/resources/v1/modeler/dssourcing/sourcingrequesttemplates?$fields=requestCategory,source&$mask=dssourcing:RequestTemplate",this.controller.app.typesConfigurator.objectTypes.template&&(t.endpoint+="&type="+this.controller.app.typesConfigurator.objectTypes.template),t.source=this.source,e.getDataPromise(t)},t.prototype.updateRequestTemplate=function(t){return t.endpoint="/resources/v1/modeler/dssourcing/sourcingrequesttemplates/"+t.id+"?$fields=requestCategory,supportedInProcessItemTypes,hasAnswerItems,source,sourceDisplay,organization,collabSpace,impactedItemsRequired&$mask=dssourcing:RequestTemplate&$definition=full",this.controller.app.typesConfigurator.objectTypes.template&&(t.endpoint+="&type="+this.controller.app.typesConfigurator.objectTypes.template),t.source=this.source,e.updateServicePromise(t)},t.prototype.createRequestTemplate=function(t){return t.endpoint="/resources/v1/modeler/dssourcing/sourcingrequesttemplates",t.source=this.source,e.createServicePromise(t)},t.prototype.getLifeCycleDataProviderPromise=function(t){return t.endpoint="/resources/lifecycle/maturity/getStateGraph",t.lifeCycleData=t.getLifecyclePayload,t.source=this.source,e.performLifeCycleAction(t)},t.prototype.performLifeCycleAction=function(t){return t.endpoint="/resources/lifecycle/maturity/promote",t.source=this.source,e.performLifeCycleAction(t)},t.prototype.getRequestTemplate=function(t){let a=t.id?t.id:t.data.params.id;return t.endpoint="/resources/v1/modeler/dssourcing/sourcingrequesttemplates/"+a+"?$fields=requestCategory,source,sourceDisplay,impactedItemsRequired,supportedInProcessItemTypes,hasAnswerItems,organization,collabSpace&$definition=full",this.controller.app.typesConfigurator.objectTypes.template&&(t.endpoint+="&type="+this.controller.app.typesConfigurator.objectTypes.template),t.source=this.controller.model.source,e.getDataPromise(t)},t.prototype.getRequestCategory=function(t){return t.endpoint="/resources/v1/modeler/dssourcing/requestCategory?type="+this.controller.app.typesConfigurator.objectTypes.request,t.source=this.source,e.getDataPromise(t)},t.prototype.getPeronOrGroupActualIds=function(t){return t.endpoint="/resources/dssourcing/GlobalToLocalObj/phyIds",t.source=this.source,t.postData=t.data,e.performPostPromise(t)},t.prototype.getProxyObjectId=function(t){return t.endpoint="/resources/dssourcing/ProxyObject",t.source=this.source,t.postData=t.data,e.performPostPromise(t)},t.prototype.getLibraries=function(t){return t.endpoint="/resources/v1/modeler/dslib/dslib:Library/search?$mask=dslib:LibraryDetailsMask&$top=1000",t.source="3DSpace",e.getDataPromise(t)},t.prototype.getClasses=function(t){return t.endpoint="/resources/v1/modeler/dslib/dslib:Library/"+t.id+"?$mask=dslib:ExpandClassesDetailsMask&$depth=20",t.source="3DSpace",e.getDataPromise(t)},t.prototype.reviseRequestTemplate=function(t){return t.endpoint="/resources/v1/modeler/dssourcing/sourcingrequesttemplates?action=Revise",t.source=this.source,e.createServicePromise(t)},t}),define("DS/ENOXSourcingRequestTemplate/views/RequestTemplate/ListRequestTemplates",["DS/ENOXSourcingRequestTemplate/models/RequestTemplate","DS/UIKIT/Mask","DS/ENOXSourcingUXInfra/xsourcingCollectionView/xsourcingCollectionView","DS/ENOXSourcingRequestTemplate/helpers/RequestTemplateHelper","DS/ENOXSourcingUXInfra/service/ENOXSourcingPlatformServices","DS/ENOXSourcingUXInfra/Constants/ENOXSourcingConstants"],function(e,t,a,i,r,o){"use strict";var n=function(e){this.controller=e,this.helper=new i(this.controller),this.NLS=this.controller.app.i18NProvider};return n.prototype.render=function(e){var t=this,i=widget.getElement(".information-panel.panel-icon-wrapper");i&&i.style.removeProperty("display"),t.controller.app._applicationChannel.publish({event:"xsourcing-collectionview-unselected-object-id",data:{selectedObjectId:null}}),t.options=e,e.hideTitle=!0,e.uniqueIdentifier="NewReqTemplate",e.itemsName=t.NLS.request_templates,e.views=["Grid","Tile"],e.enableDrag=!0;let n=[{text:t.NLS.title,dataIndex:"tree",resizableFlag:!0,sortableFlag:!0,pinned:"left",width:"130px",typeRepresentation:"url",hyperlinkTarget:"_self",hyperlinkClickCallback:function(e){var a=e.nodeModel.options.grid;t.controller.app.router.navigate("home.RequestTemplateDetails",a)},getCellValue:function(e){return{icon:{iconPath:require.toUrl(e.nodeModel.getAttributeValue("typeIcon")),iconSize:{height:"16px",width:"16px"}},label:e.nodeModel.options.label,url:"javascript:;",hyperlinkClickCallback:e.nodeModel.options.grid.grouped?void 0:this.layout.getColumnOptionValue(e.columnID,"hyperlinkClickCallback")}}},{text:t.NLS.name,dataIndex:"name"},{text:t.NLS.revision,dataIndex:"revision"},{text:t.NLS.description,dataIndex:"description"},{text:t.NLS.maturity_state,dataIndex:"stateDisplay",minWidth:125},{text:t.NLS.req_category,dataIndex:"requestCategory",minWidth:150},{text:t.NLS.category_classification,dataIndex:"classification",minWidth:150,getCellValue:function(e){let t=e.nodeModel.getAttributeValue("classification");return t?t.replaceAll(",",", "):""}},{text:t.NLS.assignee,dataIndex:"assigneeFullName",minWidth:200},...t.controller.typeConfigurator.includeProperties.length>0?t.controller.typeConfigurator.includeProperties.map(e=>t.helper.prepareDynamicColumn(e.name,e.labelNLSKey)):[],{text:t.NLS.creation_date,dataIndex:"created",minWidth:150,typeRepresentation:"datetime"},{text:t.NLS.modified_date,dataIndex:"modified",minWidth:150,typeRepresentation:"datetime"}];e.columnsConfigurations=n.filter(e=>!t.controller.typeConfigurator.excludeProperties.includes(e.dataIndex)),e.getSubLabel=this.helper.getSublabel,e.getStatusbarIcons=function(e){return t.helper.getStatusbarIcons(e)},e.getCustomTooltip=this.helper.getTooltip.bind(this.helper),e.getStatusbarIconsTooltips=function(e){return t.helper.getStatusbarIconsTooltips(e)},e.getLabel=function(e){return t.helper.getLabel(e)},e.showToolbar=!0,e.showToolbarInfoIcon=!0,e.showMobileWelcomePanelIcon=!0,e.toolbarActions=[],e.toolbarActions.push({id:"routeTemplate",text:t.NLS.view_route_templates,fonticon:"route",handler:function(){o.ONPREMISE===r.getPlatformId()?(widget.setValue("HomePage","route_templates"),window.open(r.getServiceURL("3DDashboard")+"#dashboard:/tab:/app:ENXROUT_AP","_top")):window.open(r.getServiceURL("sourcing")+"/common/emxNavigator.jsp?collabSpace=Common+Space&appName=ENOBUPS_AP&tenant="+r.getPlatformId())}}),e.toolbarActions.push({id:"createNPRTemplate",text:t.NLS.new_request_template,fonticon:"plus",handler:function(){t.controller.createView(e)}},{id:"reviseRTemplate",text:t.NLS.revise,fonticon:"flow-line-add",disabled:!0,handler:function(){t.controller.reviseRequestTemplateItem(t,e)}},{id:"delete",text:t.NLS.delete,fonticon:"trash",disabled:!0,handler:function(){t.deleteRT(t,e)}}),e.onContextualEventCallback=function(a){var i=[];if(a){var r=a.cellInfos&&a.cellInfos.nodeModel?a.cellInfos.nodeModel:null;if(-1===(a.cellInfos?a.cellInfos.rowID:null)||!r)return this._contextualMenuBuilder?this._contextualMenuBuilder.buildMenu(a,e):[];var n=a.cellInfos.nodeModel?a.cellInfos.nodeModel:a.cellInfos.cellModel,l=n.options.grid;let s=l.state;n&&i.push({id:"OpenItem",type:"PushItem",title:t.NLS.open,fonticon:{content:"wux-ui-3ds wux-ui-3ds-open"},action:{callback:function(){t.controller.app.router.navigate("home.RequestTemplateDetails",l)}}},{type:"PushItem",title:t.NLS.revise,state:s===o.RELEASED||s===o.OBSOLETE?"enabled":"disabled",fonticon:{content:"wux-ui-3ds wux-ui-3ds-flow-line-add"},action:{callback:function(){e.contextualNode=[r],t.controller.reviseRequestTemplateItem(t,e)}}},{type:"PushItem",title:t.NLS.delete,fonticon:{content:"wux-ui-3ds wux-ui-3ds-trash"},action:{callback:function(){e.contextualNode=[r],t.deleteRT(t,e)}}})}return i};var l=new a;e.container=e.externalContainer?e.externalContainer:t.controller.app._triptychWrapper.getMainPanelContainer(),e.applicationChannel=t.controller.app._applicationChannel,e.sort=[{id:"title",text:t.NLS.title,type:"string"}],e.applicationChannelEvents=[],e.applicationChannelEvents.push({eventName:"add-model"}),l.init(e),t.xsourcingCollectionView=l,t.controller.setDataForTagger(e.data,t.xsourcingCollectionView),l.collectionViewEvents.subscribe({event:"xsourcing-collectionview-cell-dblclick"},function(e){t.controller.app.router.navigate("home.RequestTemplateDetails",e)}),l.collectionViewEvents.subscribe({event:"xsourcing-collectionview-selection-updated"},function(e){if(e.selectedItems.length>0){l.collectionViewEvents.publish({event:"xsourcing-collectionview-enable-toolbar-button",data:"delete"});var a=event&&event.dsModel&&event.dsModel.activeNode?event.dsModel.activeNode:{options:e.selectedItems[e.selectedItems.length-1]};t.nodeData=a;1===e.selectedItems.length?(t.controller.app._applicationChannel.publish({event:"xsourcing-collectionview-selected-object-id",data:{selectedObject:a.options.grid,openDetails:function(){var e={};e.data={params:{id:a.options.grid.id}},e.detailsContainer=t.controller.app._triptychWrapper.getRightPanelContainer(),e.detailsContainer.empty&&e.detailsContainer.empty(),e._mediator=t.controller.app._mediator,e._triptychWrapper=t.controller.app._triptychWrapper,e.router=t.controller.app.router,e.applicationChannel=t.controller.app._applicationChannel,e.forInfo=!0,e.platformServices=t.controller.app.platformServices,e.updateRTList=function(e,a){var i=l._gridModel.getAllDescendants().filter(t=>t._options.grid.id===e.grid.id);e.grid.requestCategory=t.helper.translateRequestCategory(e.grid.requestCategory,a.requestCategory),i&&1===i.length&&(e.grid.assigneeUUID?t.helper.getUGLabel(e.grid.assigneeUUID).then(t=>{e.grid.assigneeFullName=t,i[0].updateOptions(e)}):i[0].updateOptions(e))},t.controller.showDetails(e)}}}),a.options.grid.state!==o.RELEASED&&a.options.grid.state!==o.OBSOLETE||l.collectionViewEvents.publish({event:"xsourcing-collectionview-enable-toolbar-button",data:"reviseRTemplate"})):(t.controller.app._applicationChannel.publish({event:"xsourcing-collectionview-selected-object-id",data:{selectedObject:"multipleSelected"}}),l.collectionViewEvents.publish({event:"xsourcing-collectionview-disable-toolbar-button",data:"reviseRTemplate"}))}else l.collectionViewEvents.publish({event:"xsourcing-collectionview-disable-toolbar-button",data:"delete"}),t.controller.app._applicationChannel.publish({event:"xsourcing-collectionview-unselected-object-id",data:{selectedObject:null}}),l.collectionViewEvents.publish({event:"xsourcing-collectionview-disable-toolbar-button",data:"reviseRTemplate"})}),t.controller.app._initDroppable(l._xsourcingCollectionViewUI.viewContainer)},n.prototype.deleteRT=function(e,t){e.xsourcingCollectionView._xsourcingCollectionViewUI.checkIfExceedsDeleteLimit(e.xsourcingCollectionView._gridModel.getSelectedNodes())||require(["DS/UIKIT/SuperModal"],function(a){if(t.selectedNodes=e.xsourcingCollectionView._gridModel.getSelectedNodes(),t.contextualNode&&(t.selectedNodes=t.contextualNode.slice()),t.contextualNode=void 0,t.selectedNodes.length>0){var i=new a({renderTo:widget.body,okButtonText:e.NLS.delete}),r=1===t.selectedNodes.length?t.selectedNodes[0].options.label:t.selectedNodes.length+" "+e.NLS.request_templates_small;i.confirm(e.NLS.delete_confirmation,e.NLS.delete+" - "+r,function(a){a&&(t.thatObj=e,e.controller.delete(t))})}})},n}),define("DS/ENOXSourcingRequestTemplate/views/RequestTemplate/OpenRequestTemplate",["DS/ENOXSourcingRequestTemplate/models/RequestTemplate","DS/UIKIT/Mask","DS/ENOXSourcingUXInfra/DetailsView/DetailsView","DS/ENOXSourcingUXInfra/PropertiesView/PropertiesView","DS/ENOXSourcingUXInfra/LifeCycleView/LifeCycleViewBis","DS/ENOXSourcingUXInfra/MembersView/MembersView","DS/ENOXSourcingRequestTemplate/helpers/RequestTemplateHelper","DS/ENOXSourcingUXInfra/service/ENOXSourcingPlatformServices","DS/ENOXSourcingUXInfra/Constants/ENOXSourcingConstants","DS/ENOXSourcingUXInfra/CommonUtils/CommonUtils"],function(e,t,a,i,r,o,n,l,s,c){"use strict";var p=function(e){this.controller=e,this.helper=new n(this.controller),this.NLS=this.controller.app.i18NProvider};return p.prototype.render=function(r){var n=this;if(!r.detailsContainer){var p=widget.getElement(".information-panel.panel-icon-wrapper");p&&(p.style.display="none"),n.controller.app._applicationChannel.publish({event:"welcome-panel-hide"})}n.options=r;var d=new e;n.controller.getRequestCategory(r).then(function(p){n.currentRequestCategory=r.data.respParams.requestCategory;var u=[];p.data.forEach(function(e){u.push({label:e.displayName?e.displayName:e.name,value:e.name})}),r.requestCategory=u,r.that=n;var m=new UWA.Class.Model({modifyAccess:r.data.respParams.modifyAccess,stateAccess:!0,currentState:r.data.respParams.state,fields:n.controller.helper.getFieldsForPropertiesPage(r),save:function(e){if(!e.title.getValue()||!e.title.getValue().trim())return void widget.notificationUtil.showError(n.NLS.title_empty);if(!e.Assignee_ID.fieldController.getIdentifier())return void widget.notificationUtil.showError(n.NLS.req_assignee_empty);for(var t in r.id=r.data.respParams.id,r.formValues={},e)e.hasOwnProperty(t)&&!e[t].options.nonEditable&&(e[t].elements.content||e[t].elements.input)&&(r.formValues[t]=e[t].elements.content?e[t].elements.content.value:e[t].elements.input.value);let a=[];for(let t in e)"autocompleteWithSearch"===e[t].options.type&&e[t].options.accordeonHeader&&"workflow_information"===e[t].options.accordeonHeader.value&&a.push({field:e[t],stateName:t,value:e[t].fieldController.getIdentifier()});n.helper.getWorkflowDataByRequestCategory(r.formValues.requestCategory).forEach((e,t)=>{r.formValues[e.stateName]=a[t].value}),e.Assignee_ID.options.nonEditable||(r.formValues.Assignee_ID=e.Assignee_ID.fieldController.getIdentifier()),r.formValues.hasAnswerItems=e.hasAnswerItems.getSelection(),r.formValues.hasAnswerItems.length&&(r.formValues.hasAnswerItems=e.hasAnswerItems.getSelection().map(e=>e.value)),r.formValues.supportedInProcessItemTypes=e.supportedInProcessItemTypes.getSelection(),r.formValues.supportedInProcessItemTypes.length&&(r.formValues.supportedInProcessItemTypes=e.supportedInProcessItemTypes.getSelection().map(e=>e.value)),r.formValues.Classification_ID={};var i=e.Classification_ID.selectedItems;if(i){var o={data:[]};i.forEach(function(e){o.data.push({id:e._options.id,type:s.CLASSIFICATION,dataelements:{"ProxyItem.Proxy_Title":e.getAttributeValue("label"),"ProxyItem.Proxy_Service":s.SOURCE_3DSPACE,"ProxyItem.Proxy_State":e.getAttributeValue("state"),"ProxyItem.Proxy_Tenant":n.controller.app.platformServices.platformId}})}),r.formValues.Classification_ID=o}n.controller.typeConfigurator.excludeProperties.includes("source")||(r.formValues.sourceDisplay=e.sourceDisplay.selectedItems?e.sourceDisplay.selectedItems.getAttributeValue("value"):""),n.controller.update(r)}});n.propertiesModel=m;var g=new i({model:m});n.propertiesView=g,window.odtProp&&(window.odtProp=g);var f=new UWA.Class.Model({modelEvent:n.controller.app._mediator.createNewChannel(),id:r.data.respParams.id,dataProviderPromise:(new e).getLifeCycleDataProviderPromise(r),relativePath:"/resources/v1/modeler/dssourcing/sourcingrequesttemplates?$mask=dssourcing:RequestTemplate",callBackForExecuteCmd:function(){d.getRequestTemplate.call(n,r).then(function(e){r.openRTEvent.publish({event:"update-id-card-rt",data:n.helper.processData({data:e.data[0],definitions:e.definitions})})})}});n.lifeCycleModel=f,r.lifeCycleModel=f;var h=new UWA.Class.Model({id:r.data.respParams.id,changeAccess:r.data.respParams.changeAccess,excludeQuery:'AND NOT [ds6w:identifier]:("'+r.data.respParams.ownerIdentifier+'")',mediator:n.controller.app._mediator,modelEvent:n.controller.app._mediator.createNewChannel(),infoContainer:n.controller.app._triptychWrapper.getRightPanelContainer()}),y=new o({model:h}),S=r.data?r.data:{},v={showTabView:!0};v.tabConfiguration=[{label:n.NLS.properties,content:g.render(),index:"1",value:"properties",isSelected:!0,icon:{iconName:"attributes",fontIconFamily:1},events:{click:function(){},change:function(){}}},{label:n.NLS.members,content:y.render(),index:"2",value:"access",icon:{iconName:"users",fontIconFamily:1},events:{click:function(){},change:function(){}}}];let b=!1,_=S.respParams.id,C=S.respParams.name;b=S.respParams.state===s.RELEASED||S.respParams.state===s.OBSOLETE,n.attributeMap=[{name:n.NLS.maturity_state,value:"",type:"type-text",id:"maturityState",editable:!0,displayWhenMinified:!0},{name:n.NLS.owner,value:S.respParams.owner,displayWhenMinified:!0},{name:n.NLS.name,value:S.respParams.name,displayWhenMinified:!0},{name:n.NLS.revision,value:S.respParams.revision},{name:n.NLS.creation_date,value:c.getDateStringForDisplay(S.respParams.created)},{name:n.NLS.modified_date,value:c.getDateStringForDisplay(S.respParams.modified)}],v.idCardDetails={name:S.respParams.title,thumbnail:S.respParams.image?require.toUrl(S.respParams.image):"",attributes:n.attributeMap,dropdown:{items:[{text:n.NLS.view_route_templates,name:"routeTemplate",fonticon:"route "},{text:n.NLS.revise,name:"revise",fonticon:"flow-line-add",disabled:!b}],events:{onClick:function(e,t){"routeTemplate"===t.name?"OnPremise"===l.getPlatformId()?window.open(l.getServiceURL("3DDashboard")+"#dashboard:/tab:/app:ENXROUT_AP","_top"):window.open(l.getServiceURL("sourcing")+"/common/emxNavigator.jsp?collabSpace=Common+Space&appName=ENOBUPS_AP&tenant="+l.getPlatformId()):"revise"===t.name&&n.controller.confirmRevisionAction(r,_,C)}}}},r.callback=function(){t.unmask(widget.body)},r.forInfo||(r.idCardConfigs={},r.idCardConfigs.withInformationButton=!1,r.idCardConfigs.withHomeButton=r.idCardConfigs.showBackButton=!0),n.detailsViewOptions=r.detailsViewOptions=v;var N=new a;N.init(r),r.openRTEvent.subscribe({event:"update-id-card-rt"},function(e){var t=N.mIDCardContainer;t._idCard.model.set("name",e.grid.title),N.updateWidgetObject.updateTitle(e.grid.title?e.grid.title:e.grid.name),n.attributeMap=[{name:n.NLS.maturity_state,value:"",id:"maturityState",type:"type-text",editable:!0,displayWhenMinified:!0},{name:n.NLS.owner,value:e.grid.owner,displayWhenMinified:!0},{name:n.NLS.name,value:e.grid.name,displayWhenMinified:!0},{name:n.NLS.revision,value:e.grid.revision},{name:n.NLS.creation_date,value:c.getDateStringForDisplay(e.grid.created)},{name:n.NLS.modified_date,value:c.getDateStringForDisplay(e.grid.modified)}],t&&t._idCard&&(t._idCard.model.unset("attributes"),t._idCard.model.set("attributes",n.attributeMap)),N.lifeCycleView.model.unset("maturityContainer"),N.lifeCycleView.model.set("maturityContainer",t),b=e.grid.state===s.RELEASED||e.grid.state===s.OBSOLETE;var a={items:[{text:n.NLS.view_route_templates,name:"routeTemplate",fonticon:"route ",className:"OnPremise"===l.getPlatformId()?"cloudDisable":""},{text:n.NLS.revise,name:"revise",fonticon:"flow-line-add",disabled:!b}],events:{onClick:function(e,t){"routeTemplate"===t.name?window.open(l.getServiceURL("sourcing")+"/common/emxNavigator.jsp?collabSpace=Common+Space&appName=ENOBUPS_AP&tenant="+l.getPlatformId()):"revise"===t.name&&n.controller.confirmRevisionAction(r,_,C)}}};t._idCard.model.set("dropdown",a);var i={};i.platformServices=r.platformServices,i.data={respParams:e.grid},i.requestCategory=u,i.that=n;var o=n.controller.helper.getFieldsForPropertiesPage(i);m.unset("fields"),m.set({fields:o,modifyAccess:e.grid.modifyAccess}),r.updateRTList&&r.updateRTList(e,i)})}).catch(function(e){widget.notificationUtil.showError(n.NLS.failed_to_fetch_request_catgeory),n.controller.app.logger.error(e.message?e.message:e.toString())})},p}),define("DS/ENOXSourcingRequestTemplate/controllers/RequestTemplateController",["DS/UIKIT/Mask","DS/ENOXSourcingRequestTemplate/models/RequestTemplate","DS/ENOXSourcingRequestTemplate/views/RequestTemplate/OpenRequestTemplate","DS/ENOXSourcingRequestTemplate/helpers/RequestTemplateHelper","DS/ENOXSourcingRequestTemplate/views/RequestTemplate/ListRequestTemplates","DS/ENOXSourcingRequestTemplate/views/RequestTemplate/CreateRequestTemplate","DS/ENOXSourcingUXInfra/Constants/ENOXSourcingConstants","DS/ENOXSourcingUXInfra/Search/SearchUtility","DS/UIKIT/SuperModal","DS/TreeModel/TreeDocument","DS/ENOXSourcingUXInfra/components/CreateRequestForm/SourcingInformationHelper"],function(e,t,a,i,r,o,n,l,s,c,p){"use strict";var d=function(e){this.app=e.app,this.NLS=this.app.i18NProvider,this.model=new t(this),this.helper=new i(this),this.searchUtil=new l,this.typeConfigurator=this.app.typesConfigurator[this.app.typesConfigurator.objectTypes.template]};return d.prototype.list=function(t){var a=this;e.mask(widget.body,a.NLS.loading_request_templates),a.model.listRequestTemplates(t).then(function(i){a.getRequestCategory(t).then(function(o){var l={};l[n.COMPONENT_INTRODUCTION_REQUEST]=a.NLS[n.COMPONENT_INTRODUCTION_REQUEST],o.data.forEach(function(e){l[e.name]=e.displayName?e.displayName:e.name}),i.data.forEach(function(e){e.requestCategory&&(e.requestCategory=l[e.requestCategory]?l[e.requestCategory]:e.requestCategory)}),a.helper.processForList(i).then(function(i){var o=new r(a);let l=0,s="";if(i.forEach(function(e){e.grid.assigneeType===n.TYPE_GROUP_PROXY&&(s+='[ds6w:resourceUid]:"<uuid:'+e.grid.assigneeUUID+'>" OR ',l++)}),l>0){var c={completePreCond:s=s.substring(0,s.length-3),nresults:l,start:"0",with_nls:!1};a.searchUtil.callFederatedSearch(a.searchUtil.getSearchPayload([],[],[n.SOURCE_USERGROUPS],c)).then(function(e){let r=a.searchUtil.processResults(e);i.forEach(function(t){t.grid.assigneeType===n.TYPE_GROUP_PROXY&&(0!==e.infos.nmatches&&r.some(e=>e.resourceid==="<uuid:"+t.grid.assigneeUUID+">")?t.grid.assigneeFullName=r.filter(e=>e.resourceid==="<uuid:"+t.grid.assigneeUUID+">")[0]["ds6w:label"]:t.grid.assigneeFullName=n.PRIVATE_ASSIGNMENT)}),t.data=i,o.render(t)}).finally(function(){e.unmask(widget.body)})}else t.data=i,o.render(t),e.unmask(widget.body)})}).catch(function(){widget.notificationUtil.showError(a.NLS.failed_to_fetch_request_catgeory)})},function(e){widget.notificationUtil.showError(e.internalError?e.internalError:a.NLS.error_while_listing_request_templates)}).catch(function(e){widget.notificationUtil.showError(e.message?e.message:a.NLS.error_while_listing_request_templates)}).finally(function(){})},d.prototype.closeTagger=function(){this.app.taggerProxy.onCloseTagger()},d.prototype.setDataForTagger=function(e,t){var a=n.TAGGER_COMPONENT_REQUEST_TEMPLATE;this.app.taggerProxy.setTaggerProxyOpts(e,t,a)},d.prototype.createView=function(e){new o(this).render(e)},d.prototype.create=function(t){var a=this;e.mask(widget.body,a.NLS.creating_request_template);var i=t.formValues.classification;a.model.getProxyObjectId({data:i}).then(function(e){if(e){let a="";for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];0===a.length?a=r:a+=","+r}t.formValues.classification=a}else t.formValues.classification="";t.addData=a.helper.processCreateValues(t.formValues),a.model.createRequestTemplate(t).then(function(e){var t=e.data[0];if(!0===e.success){var i=a.helper.processData({data:t});a.app.router.navigate("home.RequestTemplateDetails",{id:t.id,title:i.grid.title}),a.app._applicationChannel.publish({event:"add-model",data:i}),widget.notificationUtil.showSuccess('"'+i.grid.title+'" '+a.NLS.request_template_created_successfully)}},function(e){widget.notificationUtil.showError(e.internalError?e.internalError:a.NLS.error_while_creating_request_template)})}).catch(function(e){widget.notificationUtil.showError(e&&e.message?e.message:a.NLS.error_while_creating_request_template)}).finally(function(){e.unmask(widget.body)})},d.prototype.showDetails=function(t){var i=this;e.mask(t.detailsContainer?t.detailsContainer:widget.body,i.NLS.opening_req_temp),t.id=t.data.id?t.data.id:t.data.params.id,i.model.getRequestTemplate(t).then(function(e){var r=i.helper.processData({data:e.data[0],definitions:e.definitions});t.data.respParams=r.grid,t.getLifecyclePayload=i.helper.buildGetLifecyclePayload(t),t.openRTEvent=i.app._mediator.createNewChannel();var o=new a(i);i.closeTagger(),o.render(t)},function(){widget.notificationUtil.showError(i.NLS.error_getting_rt_details)}).catch(function(){widget.notificationUtil.showError(i.NLS.error_getting_rt_details)}).finally(function(){e.unmask(t.detailsContainer?t.detailsContainer:widget.body)})},d.prototype.update=function(t){var a=this;e.mask(widget.body,a.NLS.updating_request_template);var i=t.formValues.Classification_ID;a.model.getProxyObjectId({data:i}).then(function(e){if(e){let a="";for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];0===a.length?a=r:a+=","+r}t.formValues.Classification_ID=a}else t.formValues.Classification_ID="";t.addData=a.helper.processUpdateValues(t.formValues);var o=t.addData.data[0];Object.keys(o).forEach(e=>void 0===o[e]&&delete o[e]),a.model.updateRequestTemplate(t).then(function(e){var i=a.helper.processData({data:e.data[0],definitions:e.definitions});widget.notificationUtil.showSuccess(a.NLS.req_temp+' "'+i.grid.title+'" '+a.NLS.updated_successfully),t.openRTEvent.publish({event:"update-id-card-rt",data:i})},function(e){widget.notificationUtil.showError(e.internalError?e.internalError:e.error?e.error:e.message)})}).catch(function(e){widget.notificationUtil.showError(e.message?e.message:e.toString())}).finally(function(){e.unmask(widget.body)})},d.prototype.delete=function(t){let a=this;var i=[],r=[];t.selectedNodes.forEach(e=>{i.push({id:e.getAttributeValue("id")}),r.push(e.getAttributeValue("id"))}),t.deleteData={data:i},e.mask(widget.body,a.NLS.deleting_request_template),a.model.deleteRequestTemplate(t).then(function(){t.data=t.data.filter(e=>{if(!r.includes(e.grid.id))return e}),a.setDataForTagger(t.data,t.thatObj.xsourcingCollectionView),t.selectedNodes.forEach(e=>e.getTreeDocument().removeRoot(e)),t.collectionViewEvents.publish({event:"xsourcing-collectionview-update-count"}),widget.notificationUtil.showSuccess(t.selectedNodes.length>1?a.NLS.request_templates_deleted_successfully:a.NLS.request_template_deleted_successfully)},function(e){widget.notificationUtil.showError(e.internalError?e.internalError:e.error?e.error:a.NLS.error_while_deleting_request_template)}).catch(function(e){widget.notificationUtil.showError(e.error?e.error:a.NLS.error_while_deleting_request_template)}).finally(function(){a.app._applicationChannel.publish({event:"information-panel-close",data:{selectedObject:null}}),e.unmask(widget.body)})},d.prototype.getRequestCategory=function(e){return this.model.getRequestCategory(e)},d.prototype.confirmRevisionAction=function(e,t,a){var i=this;e.addData=i.helper.getRevisePayload(t),new s({renderTo:widget.body,className:"revise-dialog"}).dialog({body:i.NLS.requestTemplate_revise_confirmation,title:i.NLS.revise+" - "+a,buttons:[{className:"primary",value:i.NLS.Yes,action:function(t){t.hide(),i.reviseRequestTemplate(e)}},{className:"default",value:i.NLS.No,action:function(e){e.hide()}}]})},d.prototype.reviseRequestTemplate=function(t){var a=this;e.mask(widget.body,a.NLS.creating_rt_revision),this.model.reviseRequestTemplate(t).then(function(e){if(!0===e.success){var t=a.helper.processData({data:e.data[0]});widget.notificationUtil.showSuccess(a.NLS.req_temp+' "'+t.grid.title+'" '+a.NLS.revised_successfully),a.app.router.navigate("home.RequestTemplateDetails",{id:t.grid.id,name:t.grid.name},{reload:!0})}},function(e){widget.notificationUtil.showError(e.internalError?e.internalError:e.error?e.error:a.NLS.error_while_revising_requestTemplate)}).catch(function(e){widget.notificationUtil.showError(e.message?e.message:e.toString())}).finally(function(){e.unmask(widget.body)})},d.prototype.reviseRequestTemplateItem=function(e,t){if(t.selectedNodes=e.xsourcingCollectionView?e.xsourcingCollectionView._gridModel.getSelectedNodes():e.tableView._gridModel.getSelectedNodes(),t.contextualNode&&(t.selectedNodes=t.contextualNode.slice()),t.contextualNode=void 0,t.selectedNodes.length>0){let a=t.selectedNodes[0].options.grid.state;if(a!==n.RELEASED&&a!==n.OBSOLETE)widget.notificationUtil.showError(e.NLS.qual_released_obsolete_msg);else{let e=t.selectedNodes[0].getAttributeValue("id"),a=t.selectedNodes[0].options.label;this.confirmRevisionAction(t,e,a)}}},d.prototype.getLibraryClassificationData=function(e={}){var t=this;t.fieldController=e.fieldController,t.fieldController&&(t.selectionIndexData=t.fieldController.autocompleteField.selectedItems?t.fieldController.autocompleteField.selectedItems.map(e=>e.getAttributeValue("label")):[]);var a=new c({shouldBeSelected:function(e){return e.options.grid.type===n.CLASS},useAsyncPreExpand:!0});return t.model.getLibraries({}).then(function(e){var i=e.member;return a.prepareUpdate(),i.forEach(function(e){var i=t.helper.createNodeForCompCategory({label:e.title,id:e.id,icon:"library",type:n.LIBRARY,name:e.name,state:e.state});a.addRoot(i)}),a.onPreExpand(function(e){var i=e.data.nodeModel;i.hasChildren()?e.target.preExpandDone():t.model.getClasses({id:i.options.id}).then(function(i){var r=i.member[0].ChildClasses.member;a.prepareUpdate(),r.forEach(function(a){if(a.state!==n.OBSOLETE&&a.state!==n.INACTIVE){var i=""!==a.title?a.title:a.name,r=t.helper.createNodeForCompCategory({label:i,id:a.id,icon:"library-class",type:n.CLASS,name:a.name,state:a.state});e.target.addChild(r);var o=function(e,a){e.ChildClasses&&e.ChildClasses.member&&e.ChildClasses.member.forEach(function(i){if(i.state!==n.OBSOLETE&&i.state!==n.INACTIVE&&e.state!==n.INACTIVE){var r=""!==i.title?i.title:i.name,l=t.helper.createNodeForCompCategory({label:r,id:i.id,icon:"library-class",type:n.CLASS,name:i.name,state:i.state});a.addChild(l),o(i,l)}})};o(a,r)}}),t.fieldController&&t.fieldController.autocompleteField.selectedItems&&a.getAllDescendants().forEach(function(e){e.getAttributeValue("type")===n.CLASS&&t.fieldController.autocompleteField.selectedItems.forEach(function(a){if(a._options.id===e._options.id){t.fieldController.autocompleteField._selectionChips.removeChip(e._options.label),t.fieldController.autocompleteField.selectedItems=t.fieldController.autocompleteField.selectedItems.filter(t=>t._options.id!==e._options.id),e.select();var i=t.fieldController.autocompleteField._selectionChips.getAllChipsOptions().filter(t=>t.label===e._options.label);i[0].index=t.selectionIndexData.indexOf(e._options.label),t.fieldController.autocompleteField._selectionChips.updateChipOptions(i[0].label,i[0]);let a=t.fieldController.autocompleteField.selectedItems.findIndex(t=>t._options.label===e._options.label);var r=t.fieldController.autocompleteField.selectedItems[a];t.fieldController.autocompleteField.selectedItems.splice(a,1),t.fieldController.autocompleteField.selectedItems.splice(i[0].index,0,r)}})}),a.pushUpdate()}).finally(function(){e.target.preExpandDone()})}),a.pushUpdate(),new UWA.Promise(function(e){e({elementsTree:a})})}).catch(function(){widget.notificationUtil.showError(t.NLS.error_getting_details)})},d.prototype.getSourceTypeNodesForTree=function(e){var t=this;return new UWA.Promise(function(a){new p({}).getSourceTypeAttributes({sourceType:"SRCREQUEST SOURCE",filterType:e.requestCategory}).then(function(i){var r=new c({shouldBeSelected:function(e){return!e.options.grid.abstractType}});r.prepareUpdate();var o=t.helper.createNodesForSourceTypes(i);r.addRoot(o),r.pushUpdate();let n=[];try{r.getAllDescendants().forEach(function(t){e.fieldController.autocompleteField.selectedItems._options.id===t._options.id&&t.select()})}catch(e){n.push(e)}a({elementsTree:r})})})},d});