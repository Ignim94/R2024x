define("DS/ENOCharacteristicsWebApp/models/CompositeItemModel",["UWA/Core","UWA/Class/Model","DS/UIKIT/Mask","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/ENOCharacteristicsWebApp/utils/Constants","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/ENOCharacteristicsWebApp/utils/RequestUtils","DS/ENOCharacteristicsWebApp/models/DimensionSetModel","DS/ENOCharacteristicsWebApp/models/CharacteristicsModel","DS/ENOCharacteristicsWebApp/models/CharacteristicsCategoryModel","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS","DS/UIKIT/Tooltip"],function(e,t,r,i,o,s,a,d,n,l,h,c,m){"use strict";return t.extend({urlRoot:d.getGLSWebServiceURL()+s.CHARACTERISTICS_ENDPOINT,mWebAppViewContainer:null,mTreeDocument:null,mObjectId:null,mPID:null,mTreeNodeModel:null,mIsRoot:!1,mIsConsolidatedView:!1,mDimensionModel:null,setup:function(e){this.mObjectId=e.id,this.mPID=e.pid,window.ObjectId=e.id,this.charContainer=e.charContainer,this.mChildrenItemList=[],this.mCharCategoryList=[],this.mTreeNodeModel=new o({label:"",grid:{Title:"",current:""}}),this.mTreeNodeModel.setLabel(e.title),this.mTreeNodeModel.setAttribute("ownerModel",this),this.mTreeNodeModel.setAttribute("modelType",s.COMPOSITE_ITEM_MODEL_TYPE),this.mTreeNodeModel.onPostExpand(function(){void 0!==this&&this!==window&&this.hasChildren()&&this.getChildren().forEach(function(e){e.options.grid.ownerModel instanceof h&&e.getChildren().forEach(function(t){e.isExpanded()||t.reverseExpand()})})})},setAsRootItem:function(){this.mIsRoot=!0,this.mTreeDocument=new i({useAsyncPreExpand:!0}),this.mTreeDocument.addRoot(this.mTreeNodeModel);var e={charContainer:this.charContainer};this.mDimensionModel=new n(e)},getLabel:function(){return this.mTreeNodeModel.getAttributeValue("Title")+"-"+this.mTreeNodeModel.getAttributeValue("itemRevision")},getType:function(){return this.mTreeNodeModel.getAttributeValue("itemType")},getTitle:function(){return this.mTreeNodeModel.getAttributeValue("Title")},getRevision:function(){return this.mTreeNodeModel.getAttributeValue("itemRevision")},getMaturity:function(){return this.mTreeNodeModel.getAttributeValue("current")},getOriginatedDate:function(){return this.mTreeNodeModel.getAttributeValue("itemOriginated")},getModifedDate:function(){return this.mTreeNodeModel.getAttributeValue("lastModified")},getDescription:function(){return this.mTreeNodeModel.getAttributeValue("description")},getItemOwner:function(){return this.mTreeNodeModel.getAttributeValue("itemOwner")},getThumbnail:function(){return d.getAppsBaseUrl()+"/snresources/images/icons/large/I_VPMNavProduct108x144.png"},setIsConsolidatedRootItem:function(e){this.mIsConsolidatedView=e},setCharatersticsViewContainer:function(e){this.mWebAppViewContainer=e},emptyTreeDocument:function(){this.mTreeNodeModel.removeChildren(),this.mTreeDocument=new i({useAsyncPreExpand:!0}),this.mTreeDocument.addRoot(this.mTreeNodeModel),this.mCharCategoryList=[],this.mChildrenItemList=[]},addChildItem:function(e){this.mChildrenItemList.push(e),this.mTreeNodeModel.addChild(e.mTreeNodeModel)},deleteAllSelectedCharacteristics:function(e,t){for(var r=[],i=[],o=this,n=e.length-1;n>=0;n--)r[n]={itemId:e[n].options.grid.itemId,charId:e[n].options.grid.id,charTitle:e[n].options.grid.Title};var l=JSON.stringify(r);d.send3DSpaceRequest(o.urlRoot+s.CHARACTERISTICS_DELETE_ALL_SELECTED,"POST",{type:"text",headers:{"Content-type":"application/json; charset=UTF-8"},data:l},function(r){var s=JSON.parse(r),d=s.successCharIds,n=s.failedCharIds,l=s.failedCharMsgs,h=c.CharacteristicDeleteError,m=[];o.mTreeDocument.prepareUpdate();for(var u=e.length-1;u>=0;u--){if(-1!==d.indexOf(e[u].options.grid.id))-1===i.indexOf(e[u].options.grid.itemId)&&(m.push(e[u].getParent().getParent()),i.push(e[u].options.grid.itemId)),e[u].options.grid.ownerModel.deleteCharacteristic()}o.mTreeDocument.pushUpdate(),n.length>0&&e.length>d.length&&(n.length>1&&(h=c.CharacteristicsDeleteError),h+=l,a.displayAlert(t.mAlert,h,1)),o.dispatchEvent("DS.GLS.syncModel"),m.forEach(function(e){var r={rootNode:e,reOrderAcrossCategory:!1};t.updateSequenceOrder(r)})},function(e,r){a.displayErrorResponse(t.mAlert,r)})},loadCharacteristics:function(e){console.time("loadCharacteristics AddNodes");for(var t=[],r=0;r<e.length;r++){for(var i=d.getMandatoryIcon(),o=null,s=0;s<this.mCharCategoryList.length;s++)if(this.mCharCategoryList[s].mCharCategory===e[r].charCategory){o=this.mCharCategoryList[s],(a=new l({Category:o})).fromJSON(e[r]),o.characteristicsModels.push(a.mTreeNodeModel),o=this.mCharCategoryList[s];break}if(null===o){var a,n={iCharCategory:e[r].charCategory,iOwnerItem:this};o=new h(n),(a=new l({Category:o})).fromJSON(e[r]),o.characteristicsModels=[],o.characteristicsModels.push(a.mTreeNodeModel),this.mCharCategoryList.push(o),t.push(o.mTreeNodeModel)}o.mNumNodes+=1;var c=e[r].charCategory+" ("+o.mNumNodes+")";if(o.mTreeNodeModel.setLabel(c),o.mTreeNodeModel.setAttribute("charCategory",c),a.mTreeNodeModel.setAttributeWithLabel("charCategory",""),"Yes"==a.mTreeNodeModel.options.grid.mandatoryCharacteristic){var m="<img src="+i+">";a.mTreeNodeModel.options.grid.charCategory=m,a.mTreeNodeModel.options.translatedValues.charCategory=m,a.mTreeNodeModel.options.icons.push(i)}}this.mTreeNodeModel.addChild(t),this.mCharCategoryList.forEach(function(e){e.mTreeNodeModel.addChild(e.characteristicsModels)}),console.timeEnd("loadCharacteristics AddNodes")},addCharacteristics:function(e){for(var t=d.getMandatoryIcon(),r=null,i=0;i<this.mCharCategoryList.length;i++)if(this.mCharCategoryList[i].mCharCategory===e.charCategory){r=this.mCharCategoryList[i];break}if(null===r){var o={iCharCategory:e.charCategory,iOwnerItem:this};r=new h(o),this.mCharCategoryList.push(r),this.mTreeNodeModel.addChild(r.mTreeNodeModel)}var s=new l(o={Category:r});s.fromJSON(e),r.mTreeNodeModel.addChild(s.mTreeNodeModel),r.mNumNodes+=1;var a=e.charCategory+" ("+r.mNumNodes+")";if(r.mTreeNodeModel.setLabel(a),r.mTreeNodeModel.setAttribute("charCategory",a),s.mTreeNodeModel.setAttributeWithLabel("charCategory",""),"Yes"==s.mTreeNodeModel.options.grid.mandatoryCharacteristic){var n="<img src="+t+">";s.mTreeNodeModel.options.grid.charCategory=n,s.mTreeNodeModel.options.translatedValues.charCategory=n,s.mTreeNodeModel.options.icons.push(t)}return{Category:r,Characteristic:s}},destroy:function(){this.mChildrenItemList=[],this.mCharCategoryList=[],this.stopListening(),this._parent()}})});