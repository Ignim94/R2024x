define("DS/ENOCharacteristicsWebApp/controls/TextFilterBox",["UWA/Core","DS/UIKIT/Input/Text","DS/ENOFrameworkPlugins/jQuery","DS/ENOCharacteristicsWebApp/utils/Constants","DS/ENOCharacteristicsWebApp/utils/UIUtil","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS"],function(t,e,o,i,n,r){"use strict";function a(t){t.hasChildren()&&t.getChildren().forEach(function(t){if(t.options.grid.ownerModel.hasOwnProperty("mCharCategory")){var e=t.getChildren().length,o=t.options.grid.charCategory,i=o.indexOf("(");t.options.grid.charCategory=o.substring(0,i)+"("+e+")",!0===t.isHidden()&&(t.show(),t.reverseExpand()),t.getChildren().forEach(function(t){t.show(),t.reverseExpand()})}else a(t)})}return e.extend({mControlContext:null,mCharWindow:null,mSearchTimer:null,mSearchPrevText:null,mWindowTitle:null,mFilterText:null,init:function(t){this.mControlContext=t.CharacteristicsControl,this.mCharWindow=t.CharacteristicsWindow,this.mWindowTitle=this.mCharWindow?this.mCharWindow.title:null;var e=this;return this._parent({name:"TextFilterBox",defaultOptions:{className:"eno-gls-TextFilterBox"},styles:{margin:"0px 0px 0px 0px",padding:"0px"},placeholder:r.Filter,id:e.mControlContext.mIsConsolidatedView?"searchConsText":"searchText",events:{onKeyDown:function(t){var s=e.mControlContext.mRootItem.mTreeDocument;clearTimeout(e.mSearchTimer),e.mSearchTimer=setTimeout(function(t){var l=e.mControlContext.mIsConsolidatedView?o("#searchConsText").val():o("#searchText").val();l!==e.mSearchPrevText?(e.mSearchPrevText=l,s.withTransactionUpdate(function(){if(l.length<3){if("All"!==e.mFilterText)e.mFilterText="All",s.getRoots().forEach(function(t){a(t)}),e.mControlContext.hideRootNodeflatView(),e.mControlContext.isInstantiatedIn3DD?e.mCharWindow.title=e.mWindowTitle+" | "+r.Filter+": "+e.mFilterText:o("#charFilterText").html(e.mFilterText)}else{e.mFilterText=l,e.mControlContext.isInstantiatedIn3DD?e.mCharWindow.title=e.mWindowTitle+" | "+r.Filter+": "+e.mFilterText:o("#charFilterText").html(l);var t=e.mControlContext.mViewCharacteristics.getManager(),h=t.getColumns(),d=[];h.forEach(function(t){d.splice(0,0,t.dataIndex)});var c=s.search({match:function(e){var o="";o=e.nodeModel.options.grid.modelType==i.CHARACTERISTICS_MODEL_TYPE?e.nodeModel.options.translatedValues:e.nodeModel.options.label;var r=[],a=l.toLowerCase();for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)&&-1!=d.indexOf(s)){var h=t.getColumnOptions(s);0!=h.isVisible&&(r.push(o[s]),n.isMultivalueSupported(h.dataIndex,o.valuationType,o.dimensionName)&&r.push(n.getMultivaluesAsString(o.multipleValues)))}return r.some(function(t){var e=!1;return void 0!==t&&(t instanceof Array?t.some(function(t){return e=!!t.name&&-1!=t.name.toLowerCase().indexOf(a)}):e="function"==typeof t.toLowerCase&&t.length>=l.length&&-1!=t.toLowerCase().indexOf(a)),e})}}),m=[];c.forEach(function(t){m.push(t.options.grid.id)}),s.getRoots().forEach(function(t){!function t(e,i){e.getChildren().forEach(function(e){if(e.options.grid.ownerModel.hasOwnProperty("mCharCategory")){var n=0;if(e.getChildren().forEach(function(t){-1==o.inArray(t.options.grid.id,i)?!1===t.isHidden()&&(t.unmatchSearch(),t.hide()):(!0===t.isHidden()&&(t.show(),t.reverseExpand(),t.matchSearch()),n+=1)}),0==n)!1===e.isHidden()&&e.hide();else{var r=e.options.grid.charCategory,a=r.indexOf("(");e.options.grid.charCategory=r.substring(0,a)+"("+n+")",!0===e.isHidden()&&(e.show(),e.reverseExpand())}}else t(e,i)})}(t,m)})}}),e.mControlContext.hideRootNodeflatView()):e.mControlContext.hideRootNodeflatView()},50)}}}),this},setFilter:function(t){this.mControlContext.mIsConsolidatedView?o("#searchConsText").val(t):o("#searchText").val(t);var e=this.mControlContext.mRootItem.mTreeDocument;e.withTransactionUpdate(function(){e.getRoots().forEach(function(t){a(t)})}),this.mControlContext.hideRootNodeflatView(),this.mFilterText=r.All,this.mCharWindow.title=this.mWindowTitle+" | "+r.Filter+": "+this.mFilterText}})});