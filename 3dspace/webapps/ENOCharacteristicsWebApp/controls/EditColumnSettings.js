define("DS/ENOCharacteristicsWebApp/controls/EditColumnSettings",["DS/UIKIT/Input/Text","UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/UIKIT/Modal","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/Controls/Toggle","DS/Controls/LineEditor","DS/ENOCharacteristicsWebApp/utils/TableViewPreference","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/UIKIT/Alert"],function(e,t,i,n,l,o,a,s,r,d,c,u,h){return EditColumnSettings=i.extend({mEditColumnViewPreferences:null,mEditColumnViewModal:null,mAlert:null,init:function(e){this.charControl=e,this.mCharColumnPreferences=e.mCharColumnPreferences,this.elements=this.elements||{},this.elements.container=t.createElement("div",{class:"GLS-EditViewColumnSettings"}),this.pushFormContent(this.charControl)},createBody:function(e){var t,i=this,n=e.isInstantiatedIn3DD?"view-preferences-toggle":"view-preferences-toggle view-preferences-toggle-3DSpace",l=e.isInstantiatedIn3DD?"view-preferences-linecontrol":"view-preferences-linecontrol view-preferences-linecontrol-3DSpace",d={columns:[{dataIndex:"dataIndex",width:0,isHidden:!0},{text:o.HeaderName,dataIndex:"header",width:"auto"},{text:o.IsVisible,dataIndex:"colVisibility",width:"20%"},{text:o.ColumnWidth,dataIndex:"width",width:"20%"},{text:o.MinWidth,dataIndex:"minWidth",width:"20%"}],allowUnsafeHTMLContent:!1};d.charControl=e,d.showVerticalLines=!0,d.isSortable=!1,d.isDraggable=!0,d.isEditable=!0,d.apiVersion=2,d.defaultCellHeight=40,d.enableScrollOnDrag=!0,d.selection={cells:!1,canMultiSelect:!1,columnHeaders:!1},d.resize={columns:!0,rows:!0},d.isEditable={switchToWriteView:{event:"dbclick",callback:function(e){}},switchToReadView:{callback:function(e){this.switchToReadView()},view:function(e){switch(e.dataIndex){case"header":return e.cellView.getContent().setStyles({textAlign:"center"}),e.cellModel.getCellContent();case"colVisibility":var t,o;return(t=new r({type:"switch",label:"",allowUnsafeHTMLLabel:!1})).elements.container.addClassName(n),t.addEventListener("buttonclick",function(t){var i=t.dsModel.value;"string"===UWA.typeOf(i)&&(i=UWA.Json.decode(i)),i.isVisible=t.dsModel._properties.checkFlag.value,e.nodeModel.updateOptions({grid:{colVisibility:{isVisible:i.isVisible}}})}),o=e.cellModel.getCellContent(),"string"===UWA.typeOf(o)&&(o=UWA.Json.decode(o)),!0===o.isVisible&&(t.checkFlag=!0),"true"===o.mandatory&&(t.disabled=!0),t.value=o,t;case"width":return i.buildFields(e,"width",l);case"minWidth":return i.buildFields(e,"minWidth",l);default:return e.cellModel.getCellContent()}}}},d.onDragStartCell=function(e,t){var i=[];t.nodeModel.isSelected()||t.nodeModel.select(),t.manager.getDocument().getXSO().get().forEach(function(e){i.push(e.dump())}),this.serializeDragAndDropEvent(e,{data:{"dswebux/x-tree.treenodemodel+json":i,"dswebux/x-tree.treenodemodel+number":t.nodeModel._getID()}}),e.dataTransfer.effectAllowed="move"},d.onDropCellDefault=function(e,t){var i,n,l,o,a;if(e.preventDefault(),i=this.unserializeDragAndDropEvent(e)){if(n=i.data["dswebux/x-tree.treenodemodel+number"],l=i.data["dswebux/x-tree.treenodemodel+json"],t.nodeModel._getID()===n)return;l&&l.forEach(function(e,i){if(o=new s(e),t.cellView){if(a=t.nodeModel,t.manager.getDocument().options.shouldAcceptDrop({parentTreeNodeModel:a,draggedTreeNodeModel:o,dropPosition:t.dropPosition})){if(t.manager.getDocument().prepareUpdate(),t.manager.getDocument().getXSO().get().forEach(function(e){e.remove()}),t.manager.getDocument().pushUpdate(),-1!==t.virtualRowID){switch(t.dropPosition){case"top":a.getParent().insertBefore(o,a);break;default:case"middle":a.getParent().addChild(o,t.virtualRowID);break;case"bottom":a.getParent().addChild(o,a.getParent().getChildren().indexOf(a)+1)}return!1}return!0}return!1}})}},d.shouldDisplayTooltip=function(e){return"tree"===e.dataIndex&&e.isHeader?{longHelp:o.Order}:("tree"!==e.dataIndex||e.isHeader)&&e.cellModel.options.value?"colVisibility"!==e.dataIndex||e.isHeader?"string"==typeof e.cellModel.options.value?{longHelp:e.cellModel.options.value}:e.cellModel.options.value.toString?{longHelp:e.cellModel.options.value.toString()}:{longHelp:""}:{longHelp:o[e.cellModel.options.value.isVisible.toString().toUpperCase()]}:{longHelp:""}},this.preferences_grid=new a(d),this.preferences_grid.getManager().onColumnHeaderRequest(function(e){e.isHeader&&("tree"==e.dataIndex&&(e.cellModel.options.value=o.Order),e.cellView.getContent().setText(e.cellView.getCellInfos().cellModel.options.value),e.cellView.getContent().setStyles({textAlign:"center"}))}),this.preferences_grid.getManager().setColumnWidth("tree","10%"),this.preferences_grid.getManager().onCellRequest(function(e){"tree"==e.dataIndex&&(e.cellView.getContent().setText(e.nodeModel.options.label),e.cellView.getContent().setStyles({textAlign:"center",paddingLeft:"0px"}))});var c=i.charControl.mViewCharacteristics.options.columns,u=1;return c.forEach(function(e){if("tree"!=e.dataIndex&&"selection"!=e.dataIndex&&"charCategory"!=e.dataIndex){UWA.is(e.isVisible)?e.isVisible=e.isVisible.toString()===(!0).toString():e.isVisible=!0,UWA.is(o[e.text.replace(/\s/g,"")])&&(e.text=o[e.text.replace(/\s/g,"")]);var n={colVisibility:{isVisible:e.isVisible,mandatory:!!UWA.is(e.mandatory)&&e.mandatory},header:e.text,dataIndex:e.dataIndex,width:UWA.is(e.width)?e.width:"auto",minWidth:UWA.is(e.minWidth)?e.minWidth:"100"};t=new s({label:u++,grid:n}),i.preferences_grid.addRoot(t)}}),i.injectAlertBox(document.getElementsByClassName("editTableViewSettings")[0]),this.preferences_grid},pushFormContent:function(e){var t=this;this.mEditColumnViewModal=new l({closable:!0,className:"editTableViewSettings",animate:!1,header:"<h4>"+o.EditViewColumns+"</h4>",body:this,footer:[this.doneButton(),this.cancelButton()],events:{onHide:function(){t.mEditColumnViewModal.destroy(),t.mEditColumnViewModal=null,t.mAlert=null}}}),this.mEditColumnViewModal.inject(document.body),this.mEditColumnViewModal.show(),this.mEditColumnViewPreferences=this.createBody(e),this.elements.container.setContent(this.mEditColumnViewPreferences);var i=this.elements.container.getElement("div.wux-datagrid");i.addClassName("characteristics-view-height"),i.getElement("div.wux-layouts-gridengine").addClassName("characteristics-view-height")},doneButton:function(){var e=this;return new n({value:o.OK,className:"info",events:{onClick:function(){var t=e.charControl.mViewCharacteristics.options.columns,i=c.getColumnOrder(t,e.preferences_grid.getManager(),e.charControl.mIsConsolidatedView);c.setWidgetPreferences(e.mCharColumnPreferences,i.Columns,e.charControl.isInstantiatedIn3DD),!0===i.isChanged&&c.sortViewColumns(i.Columns,e.charControl.mViewCharacteristics.getManager(),e.charControl.mIsConsolidatedView),e.onClose()}}})},cancelButton:function(){var e=this;return new n({value:o.Cancel,className:"default",events:{onClick:function(){e.onClose()}}})},onClose:function(){this.mEditColumnViewModal.destroy(),this.mEditColumnViewModal=null,this.mAlert=null},injectAlertBox:function(e){var t=new h({className:"enogls-charactcs-alert",animate:!0,closable:!0,visible:!1,autoHide:!0,closeOnClick:!0,hideDelay:5e3,icon:!0,maximumVisibleMessages:5});this.mAlert=t,this.mAlert.inject(e,"top")},buildFields:function(e,t,i){var n=this,l=new d({value:e.cellModel.getCellContent()});return l.addEventListener("change",function(i){i.stopPropagation(),e.cellModel.setCellContent(i.dsModel.value);var l=n.validateWidths(i.dsModel.value,e,t);void 0!==l&&(i.dsModel.value=l)}),l.elements.container.addClassName(i),l},validateWidths:function(e,t,i){if(!("auto"===e||e>=1)){"minWidth"===i?u.displayAlert(this.mAlert,o.MinWidthNumeric,2,document.getElementsByClassName("editTableViewSettings")[0]):"width"===i&&u.displayAlert(this.mAlert,o.WidthNumeric,2,document.getElementsByClassName("editTableViewSettings")[0]);var n=t.cellModel.options.oldValue;return t.cellModel.setCellContent(n),n}if("minWidth"===i){var l=t.nodeModel.options.grid.width;"auto"===l&&(l=100),"auto"===e&&(e=100),e=Math.round(e),parseInt(l)>=parseInt(e)?t.nodeModel.options.grid[i]=e:u.displayAlert(this.mAlert,o.MinWidthGreaterThanWidthAlert,2,document.getElementsByClassName("editTableViewSettings")[0])}else if("width"===i){var a=t.nodeModel.options.grid.minWidth,s=!1;"auto"===a&&(a=100),"auto"===e&&(e=100,s=!0),e=Math.round(e),parseInt(a)<=parseInt(e)?t.nodeModel.options.grid[i]=s?"auto":e:u.displayAlert(this.mAlert,o.WidthLessThanMinWidthAlert,2,document.getElementsByClassName("editTableViewSettings")[0])}t.nodeModel.updateOptions(t.nodeModel.options)}}),EditColumnSettings});