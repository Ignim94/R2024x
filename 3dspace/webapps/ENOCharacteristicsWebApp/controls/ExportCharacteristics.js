define("DS/ENOCharacteristicsWebApp/controls/ExportCharacteristics",["UWA/Core","DS/Controls/Abstract","DS/ENOCharacteristicsWebApp/utils/RequestUtils","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS","DS/ENOCharacteristicsWebApp/utils/Constants","DS/ENOCharacteristicsWebApp/utils/UIUtil"],function(e,t,o,s,n,a){return this.ExportUtil=e.Class.singleton({init:function(e){return this},downloadVisibleContentAsCSV:function(e){var t=o.getFieldSeparator(),n="";n=t.toUpperCase()==="Comma".toUpperCase()?",":t.toUpperCase()==="Semicolon".toUpperCase()?";":",";var r,l,c,d,p=[],C=e.mViewCharacteristics.getManager(),u=C.getNumberOfRows();d="\ufeff";var m=[];C.options.columns.forEach(function(e,t){null!=e.isVisible&&e.isVisible&&m.splice(t,0,e)}),m.forEach(function(e,t){p[t]=e.dataIndex});var g="",h=1;!0===e.mIsConsolidatedView?g=s.Item+n:!0!==e.mIsConsolidatedView&&(g="",h=p.indexOf("charCategory")+1);var f=(d=d+'"'+s.Level+'"'+n+g+'"'+s.Category+'"'+n+'"'+s.Mandatory+'"').split(n);for(f.forEach(function(e,t){f[t]=f[t].split('"').join("")}),f=f.concat(p.slice(h,p.length)),l=h;l<m.length;l++)d+=n+'"'+m[l].text+'"';for(d+="\r\n",r=0;r<u;r++)if("Characteristics"===(c=C.getTreeNodeModelFromRowID(r)).options.grid.modelType){for(!0!==e.mIsConsolidatedView?d+=c._nodeDepth-1:d+=c._nodeDepth,l=1;l<f.length;l++)if(f[l]===s.Item)d+=n+'"'+c.getParent().getParent().options.label+'"';else if(f[l]===s.Category)d+=n+'"'+c.options.grid.categoryName+'"';else if(f[l]===s.Mandatory)"Yes"===c.options.grid.mandatoryCharacteristic?d+=n+'"'+s.Yes+'"':d+=n+'" "';else if("testMethods"===f[l]){var b=c.options.grid[f[l]],v="";for(i=0;i<b.length;i++)v+=b[i].name+"|";d+=n+v}else if(c&&a.isMultivalueSupported(f[l],c.options.grid.valuationType,c.options.grid.dimensionName)){d+=n+('"'+a.getMultivaluesAsString(c.options.grid.multipleValues)+'"')}else{var w=c.options.translatedValues[f[l]];w.contains('"')?d+=n+'"'+(w=w.replace('"','"""')):d+=n+'"'+w+'"'}d+="\r\n"}var S=document,y=S.createElement("a"),E=e.mRootItem.mTreeNodeModel.options.grid,N=E.Title+"_"+E.current+"_Characteristics_"+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv";document.documentMode||!parent.isIE&&window.StyleMedia?(blobObject=new Blob([d]),window.navigator.msSaveOrOpenBlob(blobObject,"Characteristics"+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv")):"download"in y&&(y.href="data:text/csv,"+encodeURIComponent(d),y.download=N,y.style.cssText="visibility: hidden",S.body.appendChild(y),setTimeout(function(){y.click(),S.body.removeChild(y)},66))}}),ExportUtil});