define("DS/ENOCharacteristicsWebApp/controls/CharacteristicsControl",["UWA/Core","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/Controls/Abstract","DS/ENOCharacteristicsWebApp/controls/CharacteristicsToolbarControl","DS/UIKIT/Spinner","DS/ENOCharacteristicsWebApp/views/CharacteristicsView","DS/ENOCharacteristicsWebApp/utils/RequestUtils","DS/ENOCharacteristicsWebApp/utils/ComponentUtil","DS/ENOCharacteristicsWebApp/utils/UIUtil","DS/UIKIT/Mask","DS/ENOFrameworkPlugins/jQuery","DS/PlatformAPI/PlatformAPI","DS/ENOCharacteristicsWebApp/utils/Constants","DS/Core/PointerEvents","DS/Controls/Toggle","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/ENOCharacteristicsWebApp/models/CharacteristicsModel","DS/ENOCharacteristicsWebApp/models/CharacteristicsCategoryModel","DS/ENOCharacteristicsWebApp/models/CompositeItemModel","DS/ENOCharacteristicsWebApp/utils/TableViewPreference","DS/ENOCharacteristicsWebApp/views/IdCard/CharacteristicsIdCard","DS/UIKIT/Alert","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS"],function(e,t,i,o,n,s,a,r,l,d,c,m,h,u,C,p,g,I,v,w,f,b,D,M,S,A){"use strict";return i.extend({name:"CharacteristicsControl",urlRoot:a.getGLSWebServiceURL()+h.CHARACTERISTICS_ENDPOINT,mRootItem:null,mFrameWindow:null,mViewCharacteristics:null,mViewPreferences:null,mCharacteristicsApp:null,mObjectId:null,mPID:null,mRootItemModelObserver:null,isInstantiatedIn3DD:!1,mArrDirtyCellList:[],mArrOldValues:[],mIsCharWindowShow:!1,mIsConsolidatedView:void 0,mSelectedMGAObjectId:void 0,mIsMGAObjectSelected:void 0,mCharColumnPreferences:void 0,mAccess:{},mPrevCellnodeModel:null,mWidgetPrefData:[],mAlert:null,init:function(e){this._parent(e),this.mCharacteristicsApp=e,this.mRootItemActualType=e.objActualType,this.mRootItemType=e.objType,this.mRootItemRevision=e.objRevision,this.mRootItemMaturity=e.objMaturity,this.mRootItemOriginated=e.objOriginated,this.mRootItemLastModified=e.objLastModified,this.mRootItemDescription=e.objDescription,this.mRootItemOwner=e.objOwner,this.mRootItemTitle=e.objTitle,this.mRootItem=e.mRootModel,this.mParentApp=e.mParentApp,this.isInstantiatedIn3DD=this.mCharacteristicsApp.isInstantiatedIn3DDashboard(),this.mIsConsolidatedView=this.mCharacteristicsApp.isConsolidatedView(),this.mCharColumnPreferences=this.mIsConsolidatedView?"consCharacteristicsColumnPreferences":"characteristicsColumnPreferences",this._buildControlSkeleton(),this._setSelectionCallbacks()},_buildControlSkeleton:function(){var t="enogls-chrsts-CharacteristicsView";document.documentMode&&!this.isInstantiatedIn3DD?t="ie-characteristics-container":this.isInstantiatedIn3DD&&this.mParentApp==h.DELMIA_APP?t="enogls-chrsts-CharacteristicsView_3DD":this.isInstantiatedIn3DD&&this.mRootItemActualType==h.TYPE_VPMREFERENCE&&(t="enogls-chrsts-CharacteristicsView_3DDXSR"),this.elements.container=new e.Element("div",{class:"enogls-chrsts-editor-container"});this.elements.container;!0===this.isInstantiatedIn3DD&&this.mRootItemActualType==h.TYPE_VPMREFERENCE?(widget.body,this.elements.containerIdCardview=e.createElement("div",{class:"charIdCardViewClass"}).inject(this.elements.container),this.elements.CharacteristicsToolbarControl=new o({objectId:this.mRootItem.mObjectId,manager:this}).inject(this.elements.container)):this.elements.CharacteristicsToolbarControl=new o({objectId:this.mRootItem.mObjectId,manager:this}).inject(this.elements.container),this.elements.containerview=e.createElement("div",{class:t}).inject(this.elements.container)},_setSelectionCallbacks:function(){!0===this.isInstantiatedIn3DD&&(m.subscribe("DS.MGA.Selection.SelectionModified",this.onMGASelectionModified.bind(this)),m.subscribe("DS.MFN.Selection.SelectionModified",this.onMGASelectionModified.bind(this)),this.mIsConsolidatedView?(m.subscribe("DS.ShowConsolidatedCharactscsCmd.CharWindowShow",this.onCharWindowShow.bind(this)),m.subscribe("DS.ShowConsolidatedCharactscsCmd.CharWindowHide",this.onCharWindowHide.bind(this))):(m.subscribe("DS.ShowCharacteristicsCmd.CharWindowShow",this.onCharWindowShow.bind(this)),m.subscribe("DS.ShowCharacteristicsCmd.CharWindowHide",this.onCharWindowHide.bind(this))))},onCharWindowShow:function(e){if(widget.id===e.widgetId){this.mIsCharWindowShow=!0;var t={modifiedObjectPID:e.selectedMGAObjectId,modifiedObjectSelectionState:!0};this.onMGASelectionModified(t)}},onCharWindowHide:function(e){widget.id===e.widgetId&&(this.mIsCharWindowShow=!1)},setOwnerItemRootModelId:function(e){this.mRootItem.mObjectId=e.ownerItemRootId,this.mObjectId=e.ownerItemRootId,!1===this.isInstantiatedIn3DD?(this.elements.CharacteristicsToolbarControl.mObjectId=this.mObjectId,this.elements.CharacteristicsToolbarControl.render()):this.mRootItemActualType==h.TYPE_VPMREFERENCE&&this.elements.CharacteristicsToolbarControl.render()},setModelEventsCallback:function(){null===this.mRootItemModelObserver&&(this.mRootItemModelObserver=new e.Class.Listener,this.mRootItemModelObserver.listenTo(this.mRootItem,"onCharacteristicsIdCardLoad",this.createIdCardView.bind(this)),this.mRootItemModelObserver.listenTo(this.mRootItem,"onCharacteristicsLoad",this.createView.bind(this)),this.mRootItemModelObserver.listenTo(this.mRootItem,"onCharacteristicsLoadFinished",this.onCharacteristicsLoadFinished.bind(this)),this.mRootItemModelObserver.listenTo(this.mRootItem,"DS.GLS.syncModel",this.syncModel.bind(this)),this.mRootItemModelObserver.listenTo(this.mRootItem,"DS.GLS.itemIDUpdated",this.setOwnerItemRootModelId.bind(this)))},syncModel:function(){var e=this.mViewCharacteristics.getManager();e.syncModel(),this.mIsConsolidatedView||e.hideRow(0)},setViewPreferences:function(i){var o=this,n=o.isInstantiatedIn3DD?h.CHARACTERISTICS_GET_COLUMN_PREFERENCES:h.CHARACTERISTICS_GET_COLUMN_PREFERENCES_IN_3DSPACE;a.send3DSpaceRequest(this.urlRoot+n,"GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:{objectId:i,isInstantiatedIn3DD:o.isInstantiatedIn3DD,preferenceName:o.mCharColumnPreferences}},function(t){var i=t.columnPreferences,n=t.hasGLSLicense,s=t.objectAccess;o.mViewPreferences=e.Json.xmlToJson(i),o.mViewPreferences.Root.ColumnDefinition.forEach(function(t){e.is(A[t.text.replace(/\s/g,"")])&&(t.text=A[t.text.replace(/\s/g,"")]),(void 0===e.typeOf(t.isEditable)||"string"===e.typeOf(t.isEditable)&&"TRUE"===t.isEditable.toUpperCase())&&(t.isEditable=!0),"false"!==n&&"false"!==s.hasModifyAccess||(t.isEditable=!1),"testMethods"===t.dataIndex&&(t.isEditable=!0)}),"true"===n&&(o.mAccess={Modify:"false"!==s.hasModifyAccess,FromConnect:"false"!==s.hasFromConnectAccess,FromDisconnect:"false"!==s.hasFromDisconnectAccess}),"false"!==n&&"false"!==s.hasFromConnectAccess&&"false"!==s.hasFromDisconnectAccess&&"false"!==s.hasModifyAccess||(c("#createCharacteristicsLink").hide(),c("#createFromMasterLink").hide(),c("#evaluateCriteriaLink").hide(),c("#deleteCharacteristicsLink").hide(),c("#saveEdit").hide(),c("#cancelEdit").hide(),c("#updateCharacteristicsLink").hide(),c("#addTestMethodLink").hide(),c("#removeTestMethodLink").hide());var a=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),r=navigator.platform.toUpperCase().indexOf("MAC")>=0;(a||!r&&a||navigator.maxTouchPoints&&0!=navigator.maxTouchPoints&&10!=navigator.maxTouchPoints)&&c("#exportCharacteristicsLink").hide();for(var d,m,h=o.mViewPreferences.Root.ColumnDefinition,u=0;u<h.length;u++)(d=h[u]).width=l.getValidColumnWidth(d.width),d.minWidth=l.getValidColumnMinWidth(d.minWidth),"tree"===d.dataIndex&&(m=d.text,h.splice(0===u?u:u-1,1));o.mIsConsolidatedView&&l.removeColumnByDataIndex(h,"charCategory");var C={isSortable:!1,text:A[m],dataIndex:"tree",width:200,minWidth:150,isVisible:!0};if(h.splice(0,0,C),h.splice(0,0,{isSortable:!1,text:"",dataIndex:"selection",type:"selection",width:40,minWidth:30}),o.isInstantiatedIn3DD&&"undefined"!=typeof widget){var p=widget.getValue(o.mCharColumnPreferences);e.is(p)&&p.length>0&&(o.mWidgetPrefData=JSON.parse(p))}else e.is(t.WidgetColumnPreferencesIn3DSpace)&&""!==t.WidgetColumnPreferencesIn3DSpace&&(o.mWidgetPrefData=JSON.parse(t.WidgetColumnPreferencesIn3DSpace))},function(e,i){t.displayErrorResponse(o.mAlert,i)})},onMGASelectionModified:function(e){void 0!==e.widgetId&&widget.id!==e.widgetId||(e.modifiedObjectSelectionState?(this.mRootItem.mPID=e.modifiedObjectPID,this.mIsCharWindowShow&&(null!==this.mViewCharacteristics&&(this.mViewCharacteristics=null),this.refreshCharacteristicView(this.mRootItem,!0))):this.mRootItem.emptyTreeDocument())},refreshCharacteristicView:function(e,i){if(void 0!==e.mPID){if(null===e.mPID)return void t.displayAlert(this.mAlert,A.SelectAnItem,2);this.setViewPreferences(e.mPID)}var o=this.elements.containerview;d.mask(o),r.fetchCharacteristicStructure(e,i)},injectAlertBox:function(e){var t=new S({className:"enogls-charactcs-alert",animate:!0,closable:!0,visible:!1,autoHide:!0,closeOnClick:!0,hideDelay:5e3,icon:!0,maximumVisibleMessages:5});this.mAlert=t,this.mAlert.inject(e,"top")},createIdCardView:function(){var e={rootItem:this.mRootItem,idCardClass:this.elements.containerIdCardview};this.mRootItemActualType===h.TYPE_VPMREFERENCE&&new M(e).build()},createView:function(){if(null===this.mViewCharacteristics){var e=this,t=e.mViewPreferences.Root.ColumnDefinition;this.mViewCharacteristics=new s({charControl:e,columns:t,defaultCellHeight:30,apiVersion:2,height:"auto"}),this.injectAlertBox(this.elements.container),this.mViewCharacteristics.elements.container.inject(this.elements.containerview);var i=this.mViewCharacteristics.getManager();i.registerReusableCellContent({id:"_toggle",buildContent:function(){return new C({checkFlag:!1,allowUnsafeHTMLLabel:!1})}}),i.registerReusableCellContent({id:"_lineEditor",buildContent:function(){return new g({displayStyle:"text",sizeInCharNumber:40,selectAllOnFocus:!0})}}),this.mRootItem.setCharatersticsViewContainer(this.elements.containerview),this.mViewCharacteristics.setCharacteristicsDimensionModel(this.mRootItem.mDimensionModel),this.mViewCharacteristics.options.columns.forEach(function(t){"tree"!==t.dataIndex&&(t.onCellRequest=e.onCellRequest.bind(e))});this.mViewCharacteristics.elements.container.getElement("div.wux-datagrid")}},onCellRequest:function(e){var t=e.dataIndex,i=(e.view,!1);if("selection"===t){var o,n=e.manager;if(e.isHeader)n.options.selection.canMultiSelect&&((o=new C({checkFlag:n.isEveryVisibleNodeSelected()||n.getDocument().getXSO().get().length>0&&!n.isEveryVisibleNodeSelected(),mixedState:n.getDocument().getXSO().get().length>0&&!n.isEveryVisibleNodeSelected(),allowUnsafeHTMLLabel:!1})).getContent().addEventListener(u.POINTERDOWN,function(e){e.stopPropagation()}),o.getContent().addEventListener("focus",function(e){e.preventDefault(),e.stopPropagation()}),o.getContent().addEventListener("change",function(e){e.dsModel.checkFlag||e.dsModel.mixedState?n.selectAllVisibleNodes():n.unselectAll(),n._giveFocus()}),e.cellView.getContent().setHTML(o));else{var s=e.cellView.reuseCellContent("_selection");s&&(s.checkFlag=!!e.nodeModel.isSelected()),e.cellView.getContent().removeClassName("cellUsageCharHighlight"),e.view.setAttribute("tabindex","-1")}}else if(!e.isHeader){var a=e.cellModel,r=e.nodeModel,d=r.options.grid,c=d.id;if(a){var m=e.cellView,p=a.getCellContent();if(a.addClass("cellCharctsFont"),m.getContent().addClassName("cellCharctsFont"),c){var g;i=!1;a.options.columnID;var I=d.relationship,v=e.nodeModel.options.grid.overwriteAllowedOnChild,w=e.nodeModel.options.grid.overwriteAllowedOnChildFromMaster,f=e.nodeModel.options.grid.characteristicMasterName,b="TRUE"===e.nodeModel.options.grid.isDescriptionEditable,D="TRUE"===e.nodeModel.options.grid.isTitleEditable,M=e.nodeModel.options.grid.valuationType,S=e.nodeModel.options.grid.dimensionName;if(this.cellInfos=e,"minIncluded"!==t&&"maxIncluded"!==t||((g=new C({checkFlag:r.options.grid[t],allowUnsafeHTMLLabel:!1})).addEventListener("change",function(e){}),g.checkFlag="true"===r.options.grid[t],g.disabled=!1,this.mAccess.Modify||(g.disabled=!0)),"ParameterUsage"!==I&&"FALSE"!==w||"sequenceOrder"===t||"testMethods"===t||"tree"===t)if("testMethods"===t)if(a.options.value.length>0){var A=a.options.value.length-1;A>0?(A="+"+A,m.getContent().setContent("<p title="+a.options.value[0].name+",("+A+')><button id = "test-Methods" title= "Show Test Methods" value='+this.mObjectId+">...</button>"+a.options.value[0].name+", ("+A+")</p>")):m.getContent().setContent("<p title="+a.options.value[0].name+'><button id= "test-Methods" title="Show Test Methods">...</button>'+a.options.value[0].name+"</p>"),e.view.setAttribute("tabindex","-1")}else m.getContent().setContent('<p><button id= "test-Methods" title="">...</button></p>');else if("FALSE"===v&&"overwriteAllowedOnChild"===t||0===M&&"nominal"===t){m.getContent().addClassName("cellRowGroupingHeader");var R="";R=e.nodeModel.options.grid.modelType==h.CHARACTERISTICS_MODEL_TYPE?e.nodeModel.options.translatedValues[t]:e.nodeModel.options.label[t],m.getContent().setContent(R),a.options.value=p}else if(""!==f&&("Title"===t&&!1===D||"description"===t&&!1===b))m.getContent().addClassName("cellRowGroupingHeader"),m.getContent().setContent(p),e.view.setAttribute("tabindex","-1");else{if("minIncluded"===t||"maxIncluded"===t)"BooleanParameter"!==S&&"StringParameter"!==S&&"SubjectivityParameter"!==S||(g.disabled=!0),g.disabled||g.addEventListener("click",function(i){r.options.grid[t]=g.checkFlag,m.getGridEngine()._modelEvents.publish({event:"cell:read-only",data:e}),g.checkFlag="true"===r.options.grid[t]}),e.cellView.getContent().setHTML(g),e.view.setAttribute("tabindex","-1");else if(l.isMultivalueSupported(t,M,S))e.cellView.getContent().setContent(e.nodeModel.options.grid.multipleValues.join(", ").toLocaleString());else{m.getContent().removeClassName("cellRowGroupingHeader");R="";R=e.nodeModel.options.grid.modelType==h.CHARACTERISTICS_MODEL_TYPE?e.nodeModel.options.translatedValues[t]:e.nodeModel.options.label[t],e.cellView.getContent().setContent(R),e.view.setAttribute("tabindex","0"),e.cellModel.options.value=p}e.view.addEventListener?e.view.addEventListener("keyup",this.keyHandler,!0):e.view.attachEvent&&e.view.attachEvent("onkeyup",this.keyHandler)}else e.cellView.getContent().setContent(p),m.getContent().addClassName("cellUsageCharHighlight"),i=!0,"minIncluded"!==t&&"maxIncluded"!==t||(g.disabled=!0,e.cellView.getContent().setHTML(g))}else e.cellView.getContent().setContent(p),m.getContent().addClassName("cellRowGroupingHeader"),e.view.setAttribute("tabindex","-1");i||m.getContent().removeClassName("cellUsageCharHighlight")}}},getNLSValue:function(e,t){var i;return-1!==["missedTargetAction","overwriteAllowedOnChild","displayUnit","dimension"].indexOf(t)&&(i=e.replace(/\s/g,""),A[i])?A[i]:e},keyHandler:function(e){var t=this;9===e.keyCode&&(e.shiftKey&&(t=t.previousSibling),"minIncluded"!==t.dataset.index&&"maxIncluded"!==t.dataset.index?t.click():t.children[0].focus())},recursiveExpand:function(e){var t=this;e.hasChildren()&&e.getChildren().forEach(function(e){e.options.grid.ownerModel instanceof f?e.hasChildren()&&e.getChildren().forEach(function(t){e.isExpanded()||t.reverseExpand()}):t.recursiveExpand(e)})},onCharacteristicsLoadFinished:function(){var t=this;this.mRootItem.mTreeDocument.getRoots().forEach(function(e){t.recursiveExpand(e)});var i=null;if(null!==this.mViewCharacteristics&&((i=this.mViewCharacteristics.getManager()).onAddRow(function(e){t.hideRootNodeflatView()}),i.sortColumnContent=function(t,i){this.prepareUpdateView(),"string"!=typeof t&&(t=this.getDataIndexFromColumnID(t));var o=this.getColumnIDFromDataIndex(t),n=this.getColumnOptions(o);i=e.extend({sortOrder:"asc",sortFunction:n.sortFunction||function(e,i){return"tree"===t?e.options.label<i.options.label?-1:1:"number"===n.dataType?e.options.grid[t]-i.options.grid[t]>0?1:-1:e.options.grid[t]<i.options.grid[t]?-1:1}},i),this._setColumnState(o,"sort:"+i.sortOrder);for(var s=0;s<this.getRow(-1).length;s++)if(s!==o){var a=this.getRow(-1)[s];a._view&&(a._view.getContent().removeClassName("wux-ui-sort-desc"),a._view.getContent().removeClassName("wux-ui-sort-asc")),a.removeClass("wux-ui-sort-desc"),a.removeClass("wux-ui-sort-asc")}this.getCell(-1,o).removeClass("wux-ui-sort-desc"),this.getCell(-1,o).removeClass("wux-ui-sort-asc"),this.getCell(-1,o).addClass("wux-ui-sort-"+i.sortOrder),this.getDocument()._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(e,t){return("asc"===i.sortOrder?1:-1)*i.sortFunction(e,t)}}),this._reflectView(),this.pushUpdateView(!0),this._modelEvents.publish({event:"sort",data:{columnID:o,columnDataIndex:t,sortOrder:i.sortOrder}})},null!==(i=this.mViewCharacteristics.getManager()))){if(i.loadDocument(t.mRootItem.mTreeDocument),i._modelEvents.subscribe({event:"cell:read-only"},t.onCellReadOnly.bind(t)),i._modelEvents.subscribe({event:"cell:write"},t.onCellWrite.bind(t)),t.mWidgetPrefData.length>0)D.sortViewColumns(t.mWidgetPrefData,i,t.mIsConsolidatedView);else for(var o,n=t.mViewCharacteristics.options.columns,s=2;s<n.length;s++)!1===(o=n[s]).isVisible||o.isVisible===(!1).toString()?i.hideColumn(o.dataIndex):i.showColumn(o.dataIndex);t.mIsConsolidatedView||i.hideColumn("tree")}var a=this.elements.containerview;d.unmask(a),this.mRootItem.dispatchEvent("DS.GLS.syncModel")},onCellReadOnly:function(e){if("selection"!==e.dataIndex&&"tree"!==e.dataIndex){var t=e.cellModel,i=e.cellView,o=e.nodeModel,n=e.dataIndex,s=t.options.prevValue,a=t.options.value,r="";if(s!==a&&void 0!==s&&("description"===n||"notes"===n?r=h.BAD_CHARS_FOR_DESC.replace(/\s/g,""):"Title"===n&&(r=h.BAD_CHARS.replace(/\s/g,"")),!l.checkForBadCharacter(a,r)))return t.options.prevValue=t.options.value,this.resetDirtyCellChanges(e,s),!1;if("minIncluded"===n||"maxIncluded"===n)a=new C({checkFlag:o.options.grid[n],allowUnsafeHTMLLabel:!1}).checkFlag,e.value=a,"minIncluded"===n?o.options.grid.minIncluded=!0===a?"true":"false":"maxIncluded"===n&&(o.options.grid.maxIncluded=!0===a?"true":"false"),s=!a;if(void 0!==s&&s!==a&&!0===this.validateRequiredCell(e,s,a)){var d=-1;if(this.mArrDirtyCellList.forEach(function(t,i,o){e.virtualRowID===t.virtualRowID&&e.virtualColumnID===t.virtualColumnID&&(d=i)}),-1===d){if(t.setCellStyle({color:"red",backgroundColor:"#FFC8B3"}),this.mArrDirtyCellList.push(e),"displayUnit"===n){var m=[];m[n]=e.cellModel.options.prevValue,["nominal","minimal","maximal","lowerSpecificationLimit","lowerRoutineReleaseLimit","upperRoutineReleaseLimit","upperSpecificationLimit"].forEach(function(t){var i=e.manager.getColumnIDFromDataIndex(t),o=e.manager.getCellModel(e.rowID,i);m[t]=o.options.oldValue,o.options.isReset=!1}),e.cellModel.options.isReset=!1,this.mArrOldValues.push(m)}else this.mArrOldValues.push(s),t.options.isReset=!1;t._manager.getCell(e.virtualRowID,e.virtualColumnID).getView().updateView(),this.enableEditCommands()}else"minIncluded"!==n&&"maxIncluded"!==n||this.resetDirtyCellChanges(e,a)}else{var u=e.virtualColumnID,p=t.options.manager.options.columns;if(p[u])"true"===p[u].required&&s===a&&c("[wux-uuid="+i._uxid+"]").css("background-color","")}}},resetDirtyCellChanges:function(e,t){if("minIncluded"===e.dataIndex||"maxIncluded"===e.dataIndex){var i=new C({checkFlag:t,allowUnsafeHTMLLabel:!1});e.cellView.getContent().setHTML(i)}else e.nodeModel.setAttributeWithLabel(e.dataIndex,t);e.cellModel.setCellStyle({color:"black",backgroundColor:""}),e.manager.updateView();var o=-1;this.mArrDirtyCellList.forEach(function(t,i,n){e.virtualRowID===t.virtualRowID&&e.virtualColumnID===t.virtualColumnID&&(o=i)}),-1!==o&&this.mArrDirtyCellList.splice(o,1),this.mArrDirtyCellList.length<=0&&this.disableEditCommands()},onCellWrite:function(t){var i=!1,o=null,n=t.cellModel;n.options.prevValue=n.options.value;var s=n.options.manager;e.is(s)&&(this.mPrevCellnodeModel&&this.mPrevCellnodeModel===t.cellModel._getID()||(this.mPrevCellnodeModel=t.cellModel._getID()),o=s.options.columns);var a=t.virtualColumnID;null!==o&&(i=o[a].required);var r=t.cellView;"true"===i&&c("[wux-uuid="+r._uxid+"]").css("background-color","#F69797")},commitCellChanges:function(){for(var e,i=this.mArrDirtyCellList,o=i.length,n=new Array(o),s=this,r=0;r<o;r++){var d=i[r].nodeModel.options.grid.id,c=i[r].dataIndex,m=i[r].nodeModel.options.grid.valuationType,u=i[r].nodeModel.options.grid.dimensionName,C=i[r].nodeModel.options.grid[c];e=i[r].nodeModel.options.grid.itemId;var p=[];if("displayUnit"===c&&!s.isInstantiatedIn3DD){var g=i[r].nodeModel.options.grid.nominal;p.push({id:d,attribute:"nominal",value:g});var I=i[r].nodeModel.options.grid.minimal;p.push({id:d,attribute:"minimal",value:I});var v=i[r].nodeModel.options.grid.maximal;p.push({id:d,attribute:"maximal",value:v});var w=i[r].nodeModel.options.grid.lowerSpecificationLimit;p.push({id:d,attribute:"lowerSpecificationLimit",value:w});var f=i[r].nodeModel.options.grid.lowerRoutineReleaseLimit;p.push({id:d,attribute:"lowerRoutineReleaseLimit",value:f});var b=i[r].nodeModel.options.grid.upperRoutineReleaseLimit;p.push({id:d,attribute:"upperRoutineReleaseLimit",value:b});var D=i[r].nodeModel.options.grid.upperSpecificationLimit;p.push({id:d,attribute:"upperSpecificationLimit",value:D})}n[r]={id:d,attribute:c,value:C},l.isMultivalueSupported(c,m,u)&&(n[r].valuation=m),p.length>0&&p.forEach(function(e){n.push(e)})}var M={objectId:e,cellData:n},S=JSON.stringify(M),R=null;return a.send3DSpaceRequest(this.urlRoot+h.CHARACTERISTICS_UPDATE,"POST",{type:"text",headers:{"Content-type":"application/json; charset=UTF-8"},data:S},function(e){var n=i[0].manager,a=n.options.columns,r=i[0].dataIndex,d=a.filter(function(e){return r===e.dataIndex})[0].text,c=A[d],m=null;if(c=c||i[0].dataIndex,o>0){var h={color:"black",backgroundColor:""},u=JSON.parse(e),C={};u.forEach(function(e,t,i){var o=e.id;C[o]=e}),i.forEach(function(e,i,o){e.dataIndex;var n=e.nodeModel.options.grid.id;if(void 0!==n&&void 0!==C[n]){var a=C[n];for(var r in a)a.hasOwnProperty(r)&&"charCategory"!==r&&"warning"!==r&&e.nodeModel.setAttributeWithLabel(r,a[r]),"warning"===r&&"true"===a[r]&&t.displayAlert(s.mAlert,a.Title+": "+A.LimitsBeyondParent,1);C[n]=void 0}e.cellModel.setCellStyle(h),"displayUnit"===e.dataIndex&&(e.manager.getCellModel(e.rowID,e.manager.getColumnIDFromDataIndex("nominal")).setCellStyle(h),e.manager.getCellModel(e.rowID,e.manager.getColumnIDFromDataIndex("minimal")).setCellStyle(h),e.manager.getCellModel(e.rowID,e.manager.getColumnIDFromDataIndex("maximal")).setCellStyle(h),e.manager.getCellModel(e.rowID,e.manager.getColumnIDFromDataIndex("lowerSpecificationLimit")).setCellStyle(h),e.manager.getCellModel(e.rowID,e.manager.getColumnIDFromDataIndex("lowerRoutineReleaseLimit")).setCellStyle(h),e.manager.getCellModel(e.rowID,e.manager.getColumnIDFromDataIndex("upperRoutineReleaseLimit")).setCellStyle(h),e.manager.getCellModel(e.rowID,e.manager.getColumnIDFromDataIndex("upperSpecificationLimit")).setCellStyle(h))}),n.updateView(),m=i[0].nodeModel.options.grid[r],s.mArrDirtyCellList=[],s.mArrOldValues=[],s.disableEditCommands()}R=!0,!0===s.isInstantiatedIn3DD?(l.isMultivalueSupported(r,i[0].nodeModel.options.grid.valuationType,i[0].nodeModel.options.grid.dimensionName)&&(m=l.getMultivaluesAsString(i[0].nodeModel.options.grid.multipleValues)),t.displayAlert(s.mAlert,A.CommitCellChangesSuccessAlert+" : "+c+" = "+m,0)):t.displayAlert(s.mAlert,A.CommitCellChangesSuccessAlert,0)},function(e,i){var o=JSON.parse(i);t.displayAlert(s.mAlert,o.message,2),!0===s.isInstantiatedIn3DD&&s.resetCellChanges(),R=!1}),R},resetCellChanges:function(){for(var e=this.mArrDirtyCellList,i=this.mArrOldValues,o=e.length,n={color:"black",backgroundColor:""},s=0;s<o;s++){var a=e[s].dataIndex;if("minIncluded"===a||"maxIncluded"===a){var r=e[s].cellView.reuseCellContent("_toggle");r&&(r.checkFlag=i[s],"minIncluded"===a&&(e[s].nodeModel.options.grid.minIncluded=!0===i[s]?"true":"false"),"maxIncluded"===a&&(e[s].nodeModel.options.grid.maxIncluded=!0===i[s]?"true":"false"))}else{if("displayUnit"===a){for(var d in i[s])if(i[s].hasOwnProperty(d)){var c=e[s].rowID,m=e[s].manager.getColumnIDFromDataIndex(d),h=e[s].manager.getCellModel(c,m);h.options.isReset||(e[s].nodeModel.setAttributeWithLabel(d,i[s][d]),h.setCellStyle(n),h.options.isReset=!0)}e[s].nodeModel.setAttributeWithLabel("multipleValues",e[s].nodeModel.options.grid.multipleValuesOld)}else e[s].cellModel.options.isReset||(e[s].nodeModel.setAttributeWithLabel(a,i[s]),e[s].nodeModel.options&&l.isMultivalueSupported(a,e[s].nodeModel.options.grid.valuationType,e[s].nodeModel.options.grid.dimensionName)&&e[s].nodeModel.setAttributeWithLabel("multipleValues",i[s]));e[s].cellModel.options.isReset=!0}e[s].cellModel.setCellStyle(n)}o>0&&(e[0].manager.updateView(),!0===this.isInstantiatedIn3DD?t.displayAlert(this.mAlert,A.SingleUpdateRevert,1):t.displayAlert(this.mAlert,A.ResetCellChangesAlert,0)),this.mArrDirtyCellList=[],this.mArrOldValues=[],this.disableEditCommands()},validateRequiredCell:function(e,i,o){var n=e.cellModel,s=(e.cellView,e.dataIndex),a=e.virtualColumnID;if("true"===n.options.manager.options.columns[a].required&&(!o||""===o.trim()))return e.nodeModel.setAttributeWithLabel(s,i),n.options.value=i,n.setCellStyle({color:"black",backgroundColor:""}),n._manager.getCell(e.virtualRowID,e.virtualColumnID).getView().updateView(),t.displayAlert(this.mAlert,A.ValidateRequiredCellWarning,1),!1;return!0},enableEditCommands:function(){if(!0===this.isInstantiatedIn3DD)this.commitCellChanges();else{var e=c(this.elements.CharacteristicsToolbarControl.elements.container).find("#saveEdit"),t=c(this.elements.CharacteristicsToolbarControl.elements.container).find("#cancelEdit");e.prop("disabled",!1).removeClass("disabled"),t.prop("disabled",!1).removeClass("disabled")}},disableEditCommands:function(){if(!1===this.isInstantiatedIn3DD){var e=c(this.elements.CharacteristicsToolbarControl.elements.container).find("#saveEdit"),t=c(this.elements.CharacteristicsToolbarControl.elements.container).find("#cancelEdit");e.addClass("disabled").prop("disabled",!0),t.addClass("disabled").prop("disabled",!0)}},destroy:function(){this.stopListening(),this._parent()},updateSequenceOrder:function(i){var o=this,n=[],s=[],r=[],l=o.mViewCharacteristics.getManager(),d=i.rootNode;if(i.reOrderAcrossCategory&&d.getChildren().forEach(function(e){e.options.grid.modelType===h.CHARACTERISTICS_CATEGORY_MODEL_TYPE&&e.options.grid.ownerModel.updateCategory()}),o.mRootItem.mTreeDocument.getRoots().forEach(function(e){o.recursiveExpand(e)}),d.hasChildren()&&(d.getChildren().forEach(function(e){e.options.grid.modelType===h.CHARACTERISTICS_CATEGORY_MODEL_TYPE&&e.hasChildren()&&e.getChildren().forEach(function(e){s.push(e),n.push(e.options.grid)})}),i.reOrderAcrossCategory&&e.is(i.droppedNodes)&&i.droppedNodes.forEach(function(e){e.grid.categoryName!==i.targetCategoryNode.options.grid.ownerModel.mCharCategory&&r.push(e.grid.id)}),0!==n.length)){this.hideRootNodeflatView();var c={allCharsArray:n,reOrderAcrossCategory:i.reOrderAcrossCategory};i.reOrderAcrossCategory&&(c.updateCategoryOnChars=r,c.targetCategory=i.targetCategoryNode.options.grid.ownerModel.mCharCategory);var m=JSON.stringify(c);a.send3DSpaceRequest("resources/v1/characteristicmodeller/characteristics/updateCharacteristicSequence","POST",{type:"text",headers:{"Content-type":"application/json; charset=UTF-8"},data:m},function(e){var t=JSON.parse(e)[0];s.forEach(function(e){t.hasOwnProperty(e.options.grid.id)&&e.setAttributeWithLabel("sequenceOrder",t[e.options.grid.id])}),i.reOrderAcrossCategory&&d.getChildren().forEach(function(e){e.options.grid.modelType===h.CHARACTERISTICS_CATEGORY_MODEL_TYPE&&e.options.grid.ownerModel.updateCategory()}),o.hideRootNodeflatView()||l.updateView()},function(e,i){var n=JSON.parse(i);t.displayAlert(o.mAlert,A.OperationFailed+": "+n.message,2),t.displayAlert(o.mAlert,A.RefreshingCharView,2),o.refreshCharacteristicView(o.mRootItem,!1)})}},hideRootNodeflatView:function(){if(this.mIsConsolidatedView)return!1;var t=e.is(this.mViewCharacteristics)?this.mViewCharacteristics.getManager():null;return!!t&&(t.hideRow(0),t.updateView(),!0)}})});