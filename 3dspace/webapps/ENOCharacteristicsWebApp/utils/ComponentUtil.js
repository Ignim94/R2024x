define("DS/ENOCharacteristicsWebApp/utils/ComponentUtil",["UWA/Core","UWA/Class","DS/ENOCharacteristicsWebApp/models/CompositeItemModel","DS/ENOCharacteristicsWebApp/utils/RequestUtils","DS/ENOCharacteristicsWebApp/utils/Constants","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS"],function(e,t,i,r,a,s,o,d,n){"use strict";var c=t.singleton({urlRoot:r.getGLSWebServiceURL()+a.CHARACTERISTICS_ENDPOINT,init:function(){return this},getItemModel:function(e){return new i({id:e.M1ObjectId,pid:e.pid,title:e.title,current:e.current,charContainer:e.charContainer})},getCharacteristicIdCardDetails:function(e,t){e.emptyTreeDocument(),e.mTreeNodeModel.setAttribute("current",t.objMaturity),e.mTreeNodeModel.setAttribute("Title",t.objTitle),e.mTreeNodeModel.setAttribute("description",t.objDescription),e.mTreeNodeModel.setAttribute("itemRevision",t.objRevision),e.mTreeNodeModel.setAttribute("itemOriginated",t.objOriginated),e.mTreeNodeModel.setAttribute("lastModified",t.objLastModified),e.mTreeNodeModel.setAttribute("itemType",t.objType),e.mTreeNodeModel.setAttribute("itemOwner",t.objOwner),e.dispatchEvent("onCharacteristicsIdCardLoad")},fetchCharacteristicStructure:function(e,t){var i=this,o=a.CHARACTERISTICS_LIST_ENDPOINT,n=e.mObjectId;t&&(n=e.mPID);var c={objectId:n,isPID:t};e.mIsConsolidatedView&&(o=a.CHARACTERISTICS_LIST_STRUCT_ENDPOINT,c={objectId:e.mPID,isPID:!0,iExpandLevel:0,iOrdered:!0}),r.send3DSpaceRequest(this.urlRoot+o,"GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:c},function(r){var a=r[0],s={ownerItemRootId:a.M1ObjectId};t&&(e.dispatchEvent("DS.GLS.itemIDUpdated",s),d.publish("DS.GLS.UpdateWindowTitle",{title:r[0].Title})),i.getCharacteristicsFromJSON(a,!0,e)},function(e,t){s.displayErrorResponse(null,t)})},getCharacteristicsFromJSON:function(e,t,i){if(!0===t&&i.emptyTreeDocument(),i.dispatchEvent("onCharacteristicsLoad"),i.mTreeNodeModel.setLabel(e.Title),i.mTreeNodeModel.options.grid.current=e.current,i.mTreeNodeModel.options.grid.Title=e.Title,i.loadCharacteristics(e.Characteristics),void 0!==e.Item_Childrens)for(var r=0;r<e.Item_Childrens.length;r++)this.addChildItemRecursively(e.Item_Childrens[r],i);i.dispatchEvent("onCharacteristicsLoadFinished")},addChildItemRecursively:function(e,t){var i={id:e.M1ObjectId,pid:e.PID,title:e.Title,current:e.current},r=c.getItemModel(i);if(r.loadCharacteristics(e.Characteristics),t.addChildItem(r),void 0!==e.Item_Childrens)for(var a=0;a<e.Item_Childrens.length;a++)this.addChildItemRecursively(e.Item_Childrens[a],r)},evaluateCriteria:function(e){var t=this,i=e.mRootItem;r.send3DSpaceRequest(this.urlRoot+a.CHARACTERISTICS_EVALUATE_CRITERIA,"POST",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:{objectId:i.mObjectId}},function(i,r){t.getCharacteristicsFromEvaluateCriteria(i,e)},function(t,r){var a=i.mWebAppViewContainer;o.unmask(a),s.displayErrorResponse(e.mAlert,r)})},getCharacteristicsFromEvaluateCriteria:function(e,t){var i=t.mRootItem,r=i.mWebAppViewContainer;if(o.unmask(r),null!==e){e.NewCharacteristics?(i.loadCharacteristics(e.NewCharacteristics),s.displayAlert(t.mAlert,e.NewCharacteristicsCount+" "+n.NewCharacteristicsCreated,3)):(e.Title=i.mTreeNodeModel.getLabel(),this.getCharacteristicsFromJSON(e,!0,i),s.displayAlert(t.mAlert,n.EvaluationComplete,3));var a={rootNode:i.mTreeNodeModel,reOrderAcrossCategory:!1};t.updateSequenceOrder(a)}else s.displayAlert(t.mAlert,n.NoCriteriaMatchedMessage,1)}});return c});