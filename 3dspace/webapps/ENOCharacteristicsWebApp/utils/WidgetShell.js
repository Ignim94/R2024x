define("DS/ENOCharacteristicsWebApp/utils/WidgetShell",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/ENOCharacteristicsWebApp/utils/RequestUtils"],function(t,e,i){"use strict";return t.Class.extend({mApplication:null,mTenantList:[],mCharColumnPreferences:void 0,init:function(t){if(this.options=t,this.mCharColumnPreferences=t.isConsolidatedView?"consCharacteristicsColumnPreferences":"characteristicsColumnPreferences",this.options.target&&this.options.app&&this.options.app.module){if(this.options.app.module||(this.options.app.options={}),widget)return this;console.log("ERROR: Not in a widget environement.")}else console.log("ERROR: Widget shell call incorrect.")},runApp:function(t){var e=this;this._initEvents(),this._loadUrls(function(i){e._setTenantList(i),e._createApp(t)}),i.setInitializedin3DD(!0)},_createApp:function(t){this.options.target.empty(),this._initPreferences();var e=this;require([this.options.app.module],function(i){e.options.app.options={ObjectID:e.options.physicalid,InstantiatedIn:"3DDashboard",isConsolidatedView:e.options.isConsolidatedView,ObjectActualType:e.options.itemActualType,ObjectType:e.options.itemType,ObjectMaturity:e.options.itemMaturity,ObjectRevision:e.options.itemRevision,ObjectOriginated:e.options.itemOriginated,ObjectLastModified:e.options.itemLastModified,ObjectDescription:e.options.itemDescription,ObjectOwner:e.options.itemOwner,ObjectTitle:e.options.itemTitle,ParentApp:e.options.parentApp},e._updateActiveTenant(function(){e.mApplication=new i(e.options.app.options).inject(e.options.target),t&&t(e.mApplication)})})},_loadUrls:function(t){console.log("_loadUrls");var n=e.getApplicationConfiguration("app.urls.myapps");if(n){var o=n+"/resources/AppsMngt/environment";i.sendDataRequest(o,{timeout:15e3,method:"get",data:{type:"CollaborativeStorage"},type:"json",proxy:"passport",headers:{Accept:"application/json"},onComplete:function(e){t(e.cstorage)},onFailure:function(t){}})}},_setTenantList:function(t){if(0!==t.length){this.mTenantList=t;var e=widget.getValue("Tenant"),i=[],n=t[0].id,o=widget.getValue("x3dPlatformId");!e&&o&&(n=o);for(var a=0;a<t.length;a++){e&&e.toLowerCase()===t[a].id.toLowerCase()&&(n=e);var s={label:t[a].displayName,value:t[a].id};i.push(s)}var r={type:"list",name:"Tenant",label:"Tenant Enovia",defaultValue:n,options:i};widget.addPreference(r),widget.addPreference({name:this.mCharColumnPreferences,type:"hidden",defaultValue:[]}),widget.setValue("Tenant",n)}},_updateActiveTenant:function(t){for(var e=widget.getValue("Tenant"),n=0;n<this.mTenantList.length;n++)if(this.mTenantList[n].id.toLowerCase()===e.toLowerCase()){i.m3DSpaceURL=this.mTenantList[n].url?this.mTenantList[n].url:this.mTenantList[n].URL;break}this._initContext(function(){t()})},_initContext:function(t){var e=widget.getValue("Tenant");i.send3DSpaceRequest(i.getGLSWebServiceURL()+"application/context/init?tenant="+e,"GET",{type:"json"},function(){t()},function(){t()})},_initPreferences:function(){for(var t=widget.getPreferences(),e=0;e<t.length;e++)"Tenant"===t[e].name&&(t[e].label="Enovia tenant");widget.setPreferences(t)},_initEvents:function(){widget.addEvent("onDataReady",function(){}),widget.addEvent("onRefresh",this.onRefreshEvent.bind(this)),widget.addEvent("onSearch",this.onSearchEvent.bind(this)),widget.addEvent("onResetSearch",this.onResetSearchEvent.bind(this))},onRefreshEvent:function(){if(this.mApplication){for(var t=this,e={},i=widget.getPreferences(),n=0;n<i.length;n++){var o=i[n];e[o.name]=o.value}this._updateActiveTenant(function(){t.mApplication.dispatchEvent("onContextChange",e)})}},onSearchEvent:function(t){this.mApplication&&this.mApplication.dispatchEvent("onSearch",t)},onResetSearchEvent:function(){this.mApplication&&this.mApplication.dispatchEvent("onSearch","")}})});