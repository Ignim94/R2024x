define("DS/ENOCharacteristicsWebApp/views/CharacteristicsView",["DS/Tree/TreeListView","DS/Spreadsheet/CellModel","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/SelectionChips","DS/Controls/Editor","DS/Controls/Button","DS/Controls/TooltipModel","DS/Utilities/KeyboardUtils","DS/Utilities/Dom","DS/UIKIT/Input/Select","DS/TreeModel/TreeNodeModel","DS/ENOCharacteristicsWebApp/utils/AlertManager","DS/ENOCharacteristicsWebApp/utils/UIUtil","DS/ENOCharacteristicsWebApp/utils/DnDUtil","DS/ENOCharacteristicsWebApp/utils/Constants","DS/UIKIT/Modal","DS/ENOCharacteristicsWebApp/controls/CharacteristicTestMethod","DS/ENOCharacteristicsWebApp/utils/RequestUtils","DS/UIKIT/Mask","i18n!DS/ENOCharacteristicsWebApp/assets/nls/ENOCharacteristicsWebAppNLS","DS/UIKIT/Tooltip","DS/Core/PointerEvents"],function(e,t,i,n,l,o,a,s,r,d,u,c,p,m,h,C,g,f,M,S,v,A,b){"use strict";return e.extend({mContainer:null,mDimensionModel:null,mPrevCellnodeModel:null,mLineEditor:null,mSelections:null,mMultiValueTextArea:null,mCellInfos:null,init:function(e){var t=this;this.charControl=e.charControl,e.apiVersion=2,e.useAsyncPreExpand=!0,e.allowUnsafeHTMLContent=!1,e.isEditable={switchToWriteView:{event:b.POINTERHIT,view:function(l){if(!l.isHeader){l.cellModel.getCellContent();var o=l.dataIndex,a=l.cellView,s=l.nodeModel,r=s.options.grid,d=[],u=[];if(void 0===r.id||""===r.id)return;var c=new UWA.Element("span",{id:"nodeDiv"}),h=r.relationship,C=r.overwriteAllowedOnChild,g=r.overwriteAllowedOnChildFromMaster,f=r.characteristicMasterName,M="TRUE"===r.isDescriptionEditable,S="TRUE"===r.isTitleEditable,A=r.valuationType;if(("ParameterUsage"===h||"FALSE"===g)&&"sequenceOrder"!==o)return;switch(o){case"tree":return;case"Title":if(""!==f&&!1===S)return;break;case"lowerSpecificationLimit":case"lowerRoutineReleaseLimit":case"minimal":if("BooleanParameter"===r.dimensionName||"StringParameter"===r.dimensionName||"SubjectivityParameter"===r.dimensionName)return;break;case"nominal":if(0===A)return;var b=r.multipleValues;if("BooleanParameter"===r.dimensionName?(d=[v.TRUE,v.FALSE],u=["TRUE","FALSE"]):void 0!==b&&b.length>0&&(d=b,u=b),m.isMultivalueSupported(o,A,r.dimensionName))return void t.showMultipleValues(u,l);break;case"maximal":case"upperRoutineReleaseLimit":case"upperSpecificationLimit":if("BooleanParameter"===r.dimensionName||"StringParameter"===r.dimensionName||"SubjectivityParameter"===r.dimensionName)return;break;case"displayUnit":if("BooleanParameter"===r.dimensionName||"StringParameter"===r.dimensionName)return;var E=r.dimensionName;if("IntegerParameter"!==E&&"RealParameter"!==E){var D=t.mDimensionModel.getDisplayUnitForDiemension(E),I=-1,T=D.map(function(e,t){var i=e[t];return i[2]&&(I=t),i[0]}),L=-1,y=D.map(function(e,t){var i=e[t];return i[2]&&(L=t),i[1]});d=T.length>0?T:[""],u=y.length>0?y:[""];var w=L>0&&I>0&&L===I;if(UWA.is(d,"array")&&UWA.is(u,"array")&&w&&d.length>0&&u.length>0){var V=d[I];d.splice(I,1),d.splice(0,0,V);var x=u[L];u.splice(L,1),u.splice(0,0,x)}}break;case"precision":if("BooleanParameter"===r.dimensionName||"StringParameter"===r.dimensionName)return;d=["","0.1","0.01","0.001","0.0001","0.00001"],u=["","0.1","0.01","0.001","0.0001","0.00001"];break;case"priority":break;case"description":if(""!==f&&!1===M)return;break;case"notes":break;case"missedTargetAction":d=[v.NoActionRequired,v.HoldandRetest,v.ShipandMonitor],u=["No Action Required","Hold and Retest","Ship and Monitor"];break;case"overwriteAllowedOnChild":if("FALSE"===C)return;case"appliesToBulk":case"appliesToInProcess":case"appliesToFinalPackage":d=[v.TRUE,v.FALSE],u=["TRUE","FALSE"];break;case"testMethods":t.showTestMethods(s)}var N=e.columns.filter(e=>e.dataIndex===o)[0];if(N&&N.rangeDisplay&&N.rangeValues&&(d=N.rangeDisplay.contains("|")?N.rangeDisplay.split("|"):N.rangeDisplay,u=N.rangeValues.contains("|")?N.rangeValues.split("|"):N.rangeValues),d.length>0){var O=new i({elementList:["dummy"]});O.inject(c);var R=r[o],U=u.map(function(e){return"function"==typeof e.toUpperCase?e.toUpperCase():e}),P=d.map(function(e){return"function"==typeof e.toUpperCase?e.toUpperCase():e});R="function"==typeof R.toUpperCase?R.toUpperCase():R;var _=U.indexOf(R);return-1===_&&(_=P.indexOf(R)),O.actionOnClickFlag=!1,O.mainElementVisibleFlag=!0,O.expanderVisibleFlag=!1,-1===_&&-1===d.indexOf("")&&d.splice(0,0,""),O.elementsList=d,O.elementsListActual=u,O.selectedIndex=_,O.enableSearchFlag=!1,O.elements.container.addClassName("cellDropDownComboBox"),O.addEventListener("change",function(e){O.selectedIndex=O.elementsList.indexOf(O.currentValue),s.setAttributeWithLabel(o,O.elementsListActual[O.selectedIndex]),l.cellModel.setCellContent(O.currentValue),l.cellModel.options.value=O.elementsListActual[O.selectedIndex],"displayUnit"!==o||t.options.charControl.isInstantiatedIn3DD||t.updateValuesForDisplayUnit(l),a.getGridEngine()._modelEvents.publish({event:"cell:read-only",data:l}),e.stopPropagation()}),O.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),O.addEventListener("DSpointerdown",function(e){e.preventDefault(),e.stopPropagation()}),O.addEventListener("DSpointerup",function(e){e.preventDefault(),e.stopPropagation()}),c.focus=function(){O.disabled||(O._popupOpened?O._hidePopup(1):O._showPopup())},a.getContent().addClassName("cellZeroPadding"),c}a=l.cellView;return t.mPrevCellnodeModel&&t.mPrevCellnodeModel===l.cellModel._getID()?(t.mLineEditor=new n({displayStyle:"text",sizeInCharNumber:40,selectAllOnFocus:!0,value:l.cellModel.getCellContent().toString()}),a.isInEditionMode()&&(t.mLineEditor.focus=function(){this._myInput.removeClassName("wux-controls-lineeditor-hideCursor"),!this.disabled&&this.selectAllOnFocus&&this._myInput.select()})):(t.mPrevCellnodeModel=l.cellModel._getID(),t.mLineEditor=[],t.mLineEditor=new n({displayStyle:"text",sizeInCharNumber:40,selectAllOnFocus:!0}),t.mLineEditor.selectAllOnFocus=!0,t.mLineEditor.value=l.cellModel.getCellContent().toString(),a.getContent().setContent(t.mLineEditor)),a.getContent().addClassName("cellCharctsFont"),a.getContent().addClassName("cellZeroPadding"),t.mLineEditor.addEventListener("change",function(i){var n=i.dsModel.value;if(["lowerSpecificationLimit","lowerRoutineReleaseLimit","minimal","nominal","maximal","upperRoutineReleaseLimit","upperSpecificationLimit"].indexOf(l.dataIndex)>-1&&!r.dimensionName.contains("String")&&isNaN(n)){var a=v.replace(v.get("AlphaNumericNotAllowedWarning"),{dimension:r.dimension});p.displayAlert(e.charControl.mAlert,a,1)}else l.cellModel.options.value=n,l.nodeModel.setAttributeWithLabel(o,n),t.mLineEditor=null;i.stopPropagation()}),"nominal"===o&&"0"===A&&(p.displayAlert(e.charControl.mAlert,v.ValuationTypeNoneWarning,1),t.mLineEditor.disabled=!0),c.focus=function(){t.mLineEditor._myInput.removeClassName("wux-controls-lineeditor-hideCursor"),!t.mLineEditor.disabled&&t.mLineEditor.selectAllOnFocus&&t.mLineEditor._myInput.select()},t.mLineEditor.inject(c),c}}}},e.onDragStartColumnHeader=function(e,t){if("charCategory"!==t.dataIndex&&"tree"!==t.dataIndex)return t.manager.__draggedColumnID=t.virtualColumnID,!0},e.onDragStartCell=function(t,i){if(!h.authorizeDrag(i,e.charControl))return!1;var n=[],l=i.nodeModel.options.grid.modelType;i.nodeModel.isSelected()||i.nodeModel.select(),i.manager.getDocument().getXSO().get().forEach(function(e){e.options.grid.modelType===l&&n.push(e.dump())}),this.serializeDragAndDropEvent(t,{data:{"dswebux/x-tree.treenodemodel+json":n,"dswebux/x-tree.treenodemodel+number":i.nodeModel._getID(),draggedObjModelType:l}}),t.dataTransfer.effectAllowed="move"},e.onDropBlankDefault=function(t,i){p.displayAlert(e.charControl.mAlert,v.DropNotAuthorizedHere,1)},e.onDropCellDefault=function(t,i){var n,l,o,a,s;if(t.preventDefault(),n=this.unserializeDragAndDropEvent(t)){if(l=n.data["dswebux/x-tree.treenodemodel+number"],o=n.data["dswebux/x-tree.treenodemodel+json"],(a=n.data.draggedObjModelType)===C.CHARACTERISTICS_MODEL_TYPE&&o.sort(function(e,t){return e.grid.sequenceOrder>t.grid.sequenceOrder?1:t.grid.sequenceOrder>e.grid.sequenceOrder?-1:0}),i.nodeModel._getID()===l)return;if(o&&i.cellView){if(!(s=h.authorizeDrop(e.charControl,o,i)).authorizeDrop)return;var r={droppedNodes:o,dndInfos:i,charControl:e.charControl,reOrderAcrossCategory:s.reOrderAcrossCategory,draggedObjModelType:a};s.reOrderAcrossCategory?m.getSuperModal().confirm(v.ConfirmOnDnDAcrossCategories,v.CharacteristicsReOordering,function(e){e&&h.processDropEffect(r)}):h.processDropEffect(r)}}},e.shouldDisplayTooltip=function(e){var t=e.cellView.getContent(),i="";if(i=e.isHeader?e.cellModel.options.value:"charCategory"!==e.dataIndex&&"tree"!==e.dataIndex||"Yes"!==e.nodeModel.options.grid.mandatoryCharacteristic?e.nodeModel.options.grid.modelType==C.CHARACTERISTICS_MODEL_TYPE?e.nodeModel.options.translatedValues[e.dataIndex]:e.nodeModel.options.label[e.dataIndex]:v.Mandatory,UWA.is(i)||(i="","charCategory"===e.dataIndex&&"Characteristics Category"===e.nodeModel.options.grid.modelType&&(i=e.nodeModel.options.label)),e.nodeModel.options&&m.isMultivalueSupported(e.dataIndex,e.nodeModel.options.grid.valuationType,e.nodeModel.options.grid.dimensionName)){var n=m.getMultivaluesAsString(e.nodeModel.options.grid.multipleValues);if(document.documentMode){return{longHelp:""}}return{longHelp:n}}if(""!==i&&"testMethods"!==e.dataIndex){if(document.documentMode){new A({position:"bottom left",animate:!1,delay:{},target:t,body:i});return{longHelp:""}}return{longHelp:i}}},e.resize={columns:!0,rows:!0},this._parent(e),this.render()},render:function(){this.mContainer=UWA.createElement("div",{class:"enogls-chrts-TableView"})},showMultipleValues:function(e,t){this.mCellInfos=t,this.mCellInfos.initialValues=e,t.cellModel.options.value=e;var i=UWA.createElement("div",{class:"enogls-chrts-MultiValue"}),n=UWA.createElement("div",{class:"enogls-chrts-MultiValue-First"}),l=UWA.createElement("div",{class:"enogls-chrts-MultiValue-Second",style:{height:"20%"}});this._buildMultiValueTextArea(),this.mMultiValueTextArea.inject(n),this._buildSelectionChips(e),this.mSelections.inject(l),this._buildAddButton(),this.addMultiValueButton.inject(n),n.inject(i),l.inject(i);var o=new g({className:"multiValueModal",closable:!0,header:t.nodeModel.options.grid.Title+" | "+v.LabelMultipleValues,body:i,events:{onHide:this._updateModelWithSelection.bind(this)}});o.inject(document.body).show(),this.multipleValueModal=o},_buildAddButton:function(){this.addMultiValueButton=new a({allowUnsafeHTMLLabel:!1,domId:"MultipleValuesAddButton",label:"",icon:"plus"}),this.addMultiValueButton.tooltipInfos=new s({shortHelp:v.Tooltip_MultiValButton}),this.addMultiValueButton.addEventListener("click",this.addSelectionChip.bind(this))},addSelectionChip:function(e){var t=this.mMultiValueTextArea.value;if(""!==t){if(this.mSelections.getAllChipsAsLabels().indexOf(t)>-1)return void alert(v.Alert_DupMultiVal)}else if(""===t)return void alert(v.Alert_UpdateMultiVal);var i={label:t,value:t},n=this.mSelections.getSelectedChipsOptions();n.length>0?(this.mSelections.updateChipOptions(n[0].label,i),this.mSelections.unselectAllChips()):this.mSelections.addChip(i),this.mMultiValueTextArea.value=""},_buildMultiValueTextArea:function(){this.mMultiValueTextArea=new o({placeholder:v.PlaceHolder_MultiVal,value:"",widthInCharNumber:60,nbRows:3,newLineMode:"shiftEnter",domId:"MultipleValuesTextEditor"}),d.addEventOnElement(this.mMultiValueTextArea,this.mMultiValueTextArea,"keydown",function(e){e.stopPropagation(),e.keyCode===r.ENTER&&this.addSelectionChip()}.bind(this))},_buildSelectionChips:function(e){var t=[];e.forEach(function(e){""!==e&&t.push({label:e,value:e})}),this.mSelections=new l({height:"auto",domId:"MultipleValuesSelectionChip",placeholder:"Enter Values"});this.mSelections.addEventListener("selectionChange",function(){var e=this.mSelections.getSelectedChipsOptions();e.length>0&&(this.mMultiValueTextArea.value=e[0].value)}.bind(this)),this.mSelections.onDragStartCell=function(){return!1},t.length>0&&this.mSelections.addChips(t)},_updateModelWithSelection:function(){if(this.multipleValueModal.destroy(),!this.mCellInfos.initialValues.equals(this.mSelections.getAllChipsAsLabels())){var e=this.mCellInfos.data.rowID,t=this.mCellInfos.data.columnID,i=this.mCellInfos.manager.getCellModel(e,t);i.options.value=this.mSelections.getAllChipsAsLabels(),this.mCellInfos.nodeModel.setAttributeWithLabel("nominal",this.mSelections.getAllChipsAsLabels()),this.mCellInfos.nodeModel.setAttributeWithLabel("multipleValues",this.mSelections.getAllChipsAsLabels()),i.addClass("cellCharctsFont"),i.setCellStyle({color:"red",backgroundColor:"#FFC8B3"}),this.mCellInfos.cellModel._manager.getCell(e,t).getView().updateView(),this.charControl.onCellReadOnly(this.mCellInfos)}},showTestMethods:function(e){var t=e.options.grid.id;this.mTestMethodsSkeletonContainer=new g({closable:!0,animate:!0,className:"testMethods-Skeleton",header:e.options.grid.Title+" | "+v.TestMethodsPageHeader,events:{onHide:this.updateTestMethodsField.bind(this,e)}}),this.mTestMethodsSkeletonContainer.inject(document.body).show();new f(t,this.mTestMethodsSkeletonContainer.elements.body,this.options.charControl.mAccess)},updateTestMethodsField:function(e){var t=this,i=e.options.grid.id,n=M.getGLSWebServiceURL()+C.CHARACTERISTICS_ENDPOINT+C.CHARACTERISTICS_GET_CONNECTED_TM+"?objectId="+i;M.send3DSpaceRequest(n,"GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"}},function(t){e.prepareUpdate(),e.setAttribute("testMethods",t),e.pushUpdate()},function(e){p.displayErrorResponse(t.charControl.mAlert,e)})},setCharacteristicsDimensionModel:function(e){this.mDimensionModel=e},updateValuesForDisplayUnit:function(e){var t=this;t.cellInfos=e,t.cellInfos.oldValues=[],t.nominal=null,t.minimal=null,t.maximal=null,t.lowerSpecificationLimit=null,t.lowerRoutineReleaseLimit=null,t.upperRoutineReleaseLimit=null,t.upperSpecificationLimit=null;var i=M.getGLSWebServiceURL()+C.CHARACTERISTICS_ENDPOINT;M.send3DSpaceRequest(i+"getValuesForDisplayUnit","GET",{type:"json",headers:{"Content-type":"application/x-www-form-urlencoded"},data:{displayUnit:e.nodeModel.options.grid.displayUnit,id:e.nodeModel.options.grid.id}},function(e){var i=t.mContainer;S.mask(i);var n=t.cellInfos.rowID;if(["nominal","minimal","maximal","lowerSpecificationLimit","lowerRoutineReleaseLimit","upperRoutineReleaseLimit","upperSpecificationLimit"].forEach(function(i){var l=t.cellInfos.manager.getColumnIDFromDataIndex(i),o=t.cellInfos.manager.getCellModel(n,l);(t.cellInfos.oldValues[i]=o.options.value,""!==e[i])&&(o.options.value=e[i],t.cellInfos.nodeModel.setAttributeWithLabel(i,e[i]),o.addClass("cellCharctsFont"),o.setCellStyle({color:"red",backgroundColor:"#FFC8B3"}),t.cellInfos.cellModel._manager.getCell(n,l).getView().updateView())}),void 0===t.cellInfos.nodeModel.options.grid.multipleValuesChanged){t.cellInfos.nodeModel.options.grid.multipleValuesChanged=!0;var l=t.cellInfos.nodeModel.options.grid.multipleValues;t.cellInfos.nodeModel.options.grid.multipleValuesOld=l}t.cellInfos.nodeModel.setAttributeWithLabel("multipleValues",e.multipleValues)},function(e){S.unmask(t.mContainer),p.displayErrorResponse(options.charControl.mAlert,v.DisplayUnitChangeError)})}})});