define("DS/ClassificationsFacet/InitClassificationCmpUI",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Class","text!DS/ClassificationsFacet/assets/classificationAppsRequire_setting.json"],function(e,t,i){"use strict";return t.extend({init:function(){this.container=UWA.createElement("div",{class:"classificationPLMNewContainer"}),this.controller={}},setObjectId:function(e){this.objectId=e},getUI:function(t){var o=this;return function(e){var t=Promise.resolve();e.forEach(function(e){t=t.then(e)})}([function(){if(t.isBookmark)return new Promise(function(e,n){var s=JSON.parse(i).facets.bookmarks.require;require([s],function(e){o.plmNewFolderActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,appId:"Bookmarks",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:o.container,getClassificationAttributes:!1,isInformationPanel:t.isInformationPanel,objectId:o.objectId,securityContext:t.securityContext})});const a=setInterval(function(){o.plmNewFolderActive&&(e(),clearInterval(a))},100)})},function(){if(t.isLibrary)return new Promise(function(e,n){var s=JSON.parse(i).facets.library.require;require([s],function(e){o.plmNewLibraryActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,appId:"Libraries",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:o.container,getClassificationAttributes:!0,attributesReadOnly:!1,isInformationPanel:t.isInformationPanel,objectId:o.objectId,securityContext:t.securityContext})});const a=setInterval(function(){o.plmNewLibraryActive&&(e(),clearInterval(a))},100)})},function(){if(t.isExportControl)return new Promise(function(n,s){e.getGrantedRoles(function(e){for(var n=0;n<e.length;n++)if(e[n]&&("IPS"===e[n].id||"IPA"===e[n].id)){var s=JSON.parse(i).facets.ipexportControl.require;require([s],function(e){o.plmNewIPProtectionActive=new e({dialogButtons:!0,selectionMode:"ONLYSingle",favoriteButton:!0,appId:"IPExportControl",handleClassification:!0,OKButtonLabel:"OK",componentTitle:"OK",isRootSelectable:!0,isClassifyMultiEveDispatch:!1,isonSetActiveEveDispatch:!0,container:o.container,getClassificationAttributes:!0,attributesReadOnly:!0,isInformationPanel:t.isInformationPanel,objectId:o.objectId,securityContext:t.securityContext})});break}});const a=setInterval(function(){o.plmNewIPProtectionActive&&(n(),clearInterval(a))},100)})}]),this.container},getController:function(){return this.controller.plmNewFolderActive=this.plmNewFolderActive,this.controller.plmNewLibraryActive=this.plmNewLibraryActive,this.controller.plmNewIPProtectionActive=this.plmNewIPProtectionActive,this.controller}})}),define("DS/ClassificationsFacet/service/PLMNewCommonWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/IPClassifyActive/assets/nls/IPClassifyActive","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyActive/utils/IPClassifyActiveUtil","DS/IPClassifyUXUtil/CredentialsView"],function(e,t,i,o,n,s,a,r,l){"use strict";return{_orderField:"ds6w:label",_orderBy:"asc",getSetting:function(){return r.getSetting()},get3DSpaceUrl:function(){return new Promise(function(e,t){s.get3DSpaceUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},getSearchInfo:function(){return{with_nls:!1,with_indexing_date:!0,select_predicate:["ds6w:label","ds6w:created","ds6w:reservedBy","relcount","taxonomies","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:type","physicalid","ds6w:classificationUsage"],select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25}},getShowContentInViewSetting:function(){return void 0!==window.top.showContentInView?window.top.showContentInView:this.getSetting().showContentInView},setOrder:function(e,t){this._orderField=e||this._orderField,this._orderBy=t||this._orderBy},getTenantID:function(){return window.top.tenantId||s.getTenantID()},getSecurityContext:function(){var e=o.getSetting("pad_security_ctx");if(!e&&widget.hasPreference("Current_security_credentials")){var t=widget.getPreference("Current_security_credentials");void 0!==t.defaultValueNonNls&&null!==t.defaultValueNonNls&&t.hasOwnProperty("defaultValueNonNls")&&(e="ctx::"+t.defaultValueNonNls)}return window.top.securityContext||e||this._securityContext},getSelect_bo:function(){return["ds6w:label","ds6w:what/ds6w:type","physicalid","ds6w:when/ds6w:created","ds6w:when/ds6w:modified","ds6w:how/ds6w:classification","icon_2ddefaultthb.subtype"]},_getSecurityContext:function(e){var t=this,i=e,o="/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",n="GET",s=i.tenant?i.tenant:this.getTenantID();t.get3DSpaceUrl().then(function(e){var a=e+o+"&tenant="+s,r=widget.lang?widget.lang:widget.getValue("lang");return i.method=n,i.headers={Accept:"application/json","Accept-Language":r,"Content-Type":"application/json"},i.cache=-1,i.withoutSC=!0,t._executeRequest(a,i,!0)})},fetchContent:function(e,t){return t.payload.specific_source_parameter=this.getSpecific_source_parameter_content(t.pid),t.payload.label=this.getLabel(),t.data=UWA.Json.encode(t.payload),this._executeRequest(e,t,"searchInFolder")},fetch2:function(e){var t=["type","label","ds6w:classification","icon_2ddefaultthb.subtype"],i={};UWA.extend(i,e);var o=e.ids,n=this;o.length&&n.get3DSpaceUrl().then(function(s){console.log(s);var a=s+"/cvservlet/fetch/v2",r=l.getCredential(),c=widget.lang?widget.lang:widget.getValue("lang");i.payload={physicalid:o,label:e.label},i.payload.select_predicate=t,i.query={SecurityContext:r},i.method="POST",i.headers={SecurityToken:window.top.dsUserLogin+"|"+r+"|preferred",Accept:"application/json","content-type":"application/json","Accept-Language":c},i.type="json",i.data=UWA.Json.encode(i.payload);n._executeRequest(a,i,"fetch")})},flattenedSearch:function(e){var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.searchInActiveBookmark");var i=e.searchKey?e.searchKey:this.generateSearchQuery(e.searchKey,e.pid,e.type),o=this;new Promise(function(e,t){s.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}).then(function(n){var s=n+"/search",a=widget.lang?widget.lang:widget.getValue("lang");t.payload=o.getSearchInfo(),t.payload.locale=a,t.payload.order_by=o._orderBy,t.payload.order_field=o._orderField,t.payload.query='[ds6w:label]:("*'+i+'*")',t.payload.tenant=o.getTenantID(),t.payload.resourceid_not_in=e.alreadyPresentIDs,t.payload.next_start=void 0,t.payload.nresults=void 0!==e.nresults?e.nresults:parseInt(nresults)||t.payload.nresults,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.login={"3dspace":{SecurityContext:o.getSecurityContext()}},t.payload.label=o.getLabel(),delete t.payload.specific_source_parameter,e.pid&&(t.payload.specific_source_parameter=o.getSpecific_source_parameter(e.pid,!0)),t.payload.specific_source_parameter={"3dspace":{additional_query:"AND "+o.getSearchQuery()}},o.getRefineSearch&&(t.payload.refine=o.getRefineSearch()),console.log(t.payload.specific_source_parameter);null!=e.next_start?t.payload.next_start=e.next_start:t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":a},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=3e6,o._executeRequest(s,t,"searchInFolder")})},getLabel:function(e){return"IPNewPLMComponent-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},getClassPaths:function(e){var t={};if(UWA.extend(t,e),!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.searchInActiveBookmark");var i=this;i.get3DSpaceUrl().then(function(s){console.log(s);var a=s+"/cvservlet/navigate",r=widget.lang?widget.lang:widget.getValue("lang"),l=null;e.plmNewContextProvider&&(l=e.plmNewContextProvider),t.payload={},t.payload.locale=r,t.payload.tenant=n.getPlatformId(),t.query={SecurityContext:l||o.getSetting("pad_security_ctx"),tenant:n.getPlatformId()},t.payload.input_physical_ids=e.id,t.payload.attributes=["ds6w:label","physicalid","ds6w:type","ds6w:classification"],t.payload.version=3,t.payload.primitives=[{navigate_to_rel:{id:1}},{navigate_from_rel:{id:2}}],t.payload.patterns={GET_PARENT:[{id:2,iter:-1}]},t.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},t.payload.source=["3dspace"];var c=new Date;t.payload.label=("PlmNewClassificationFacetNavigate"+c.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.timeout=12e4,t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r},t.type="json",t.data=UWA.Json.encode(t.payload);i._executeRequest(a,t,"getClassPaths")})},constructPath:function(e,t="idPathMap"){var i=[];const o=new Map,n=new Map;var s;return e.result.forEach(e=>{var t,a={label:(t=e.outputs.GET_PARENT?e.outputs.GET_PARENT[0]:e.input_object)["ds6w:label"],physicalid:t.physicalid,type:t["ds6w:type"]};i=this.constructPathChain(a,t.paths?t.paths[0]:void 0),s=this.extractPath(i),n.set(i[i.length-1].physicalid,i),o.set(i[i.length-1].physicalid,s)}),"idPathChainMap"===t?n:o},constructPathChain:function(e,t){var i=[];if(i.push(e),null==t||null==t||0==t.length)return i;for(let e=t.length-1;e>=0;e--){var o={label:t[e]["ds6w:label"],physicalid:t[e].physicalid,type:t[e]["ds6w:type"]};i.push(o)}return i},extractPath:function(e){var t=e[0].label;for(let i=1;i<e.length;i++)t=t+" > "+e[i].label;return t},_executeRequest:function(e,o,n){this.requestList||(this.requestList={}),"getClassPaths"!=n&&"getClassPaths"!=n||(this.requestList[n]&&this.requestList[n].cancel(),this.requestList[n]=null);var s=Math.round(1e3*Math.random()).toString(),a=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("folderRequest_begin"+s);var r={};UWA.extend(r,o),UWA.is(r.onTimeout,"function")||(r.onTimeout=function(){var e={type:"timeout",toString:function(){return i.msg_InfoAction_Timeout}};r.onFailure(e)},r.onComplete=function(e){window.top.performance.mark("folderRequest_end"+s);var t=window.top.performance.getEntriesByName("folderRequest_begin"+s);t&&1===t.length&&(window.top.performance.measure(a+"_Request"+n,"folderRequest_begin"+s,"folderRequest_end"+s),window.top.performance.clearMarks("folderRequest_end"+s),window.top.performance.clearMarks("folderRequest_begin"+s)),o.onComplete(e)}),UWA.is(r.query)||(r.query={}),r.query.tenant||!0===o.withoutTenant||(r.query.tenant=this.getTenantID());var l=e;return 0!==Object.keys(r.query).length&&(l+=(e.indexOf("?")<0?"?":"&")+UWA.Utils.toQueryString(r.query)),this.requestList[n]=t.authenticatedRequest(l,r),this.requestList[n]}}}),define("DS/ClassificationsFacet/utils/PLMNewClassificationFacetData",["UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/TooltipModel","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel"],function(e,t,i,o,n){return e.Class.extend({init:function(e){},buildSkeleton:function(e){},_generateSearchData:function(e,i,o){var s=this,a={0:new t};a[0].onPreExpand(function(e){e.data.onlyUI&&e.target.preExpandDone()});var r={"ds6w:label":"label","ds6w:what/ds6w:type":"type",type_icon_url:"icon",resourceid:"id","ds6w:created":"created","ds6w:modified":"modified","ds6w:when/ds6w:created":"created","ds6w:when/ds6w:modified":"modified","ds6w:how/ds6w:classification":"folderClassification","icon_2ddefaultthb.subtype":"iconType",mxid:"mxid","ds6w:what/ds6w:classificationUsage":"classUsage"};return e.forEach(function(e){var t=e.attributes,l={};t.forEach(function(e){var t=r[e.name];t&&(l[t]=e.value),"type"===t&&(l.displayType=e.dispValue),"type_icon_url"===t&&(t.icon=e.value)});var c={useAsyncPreExpand:!0};c.value={label:l.label,subLabel:n.loading,icon:[l.icon]},c.label=l.label,c.id=l.id,c.plmType=l.type,c.created=l.created,c.modified=l.modified,c.folderClassification=l.folderClassification,c.iconType=l.iconType,c.mxid=l.mxid,c.classUsage=l.classUsage;var d=e&&e.level?parseInt(e.level):1;c.icons=[i(l)],a[0].addChild(s._createTreeNodeModel(c,a[d-1],o))}),a[0]},createAutocompleteDataTree:function(e){var i=new t({shouldBeSelected:function(e){return e.isSelectable}});return i.getRoots().forEach(function(e,t){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){return e.options.label.localeCompare(t.options.label)>=1?1:-1}})}),i.pushUpdate(),i},_createTreeNodeModel:function(e,n,s,a,r){var l=n instanceof t;e&&e.publishOnConnect&&delete e.publishOnConnect,e&&e.folderClassification&&delete e.folderClassification,e&&e.children&&(e.children=[]),e.useAsyncPreExpand=!0;var c=new i(e);return c.id=e.id,c.plmType=e.plmType,e.isFavorite&&(c.isFavorite=!0),(e.isPersonal||!l&&n.isPersonal)&&(c.isPersonal=!0),e.isExisting&&(c.isExisting=e.isExisting),e.created&&(c.created=e.created),c.getID=function(){var e=this.id;return e&&""!==e||(e=this.plmType),e},c.getLabel=function(){return this.options.label},c.getType=function(){return this.plmType},c.mxid=e.mxid,c.label=e.label,c.options.oldLabel=e.label,c.pathId=(l?"root":n.pathId)+","+c.getID(),c.isSelectable=s(e.plmType),n.prepareUpdate(),l?n.addRoot(c):n.addChild(c,a),n.pushUpdate(),c.updateOptions({tooltip:new o({title:c.options.value?c.options.value.label:c.options.label,shortHelp:r||c.options.label,mouseRelativePosition:!0})}),c}})}),define("DS/ClassificationsFacet/ClassificationFacet",["DS/EditPropWidget/facets/Common/FacetsBase","DS/ClassificationsFacet/InitClassificationCmpUI","DS/ClassificationProp/utils/ClassifPropControl","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,i,o){"use strict";return e.extend({init:function(e){var t=this;this._parent(e);var n={};for(var s in e)n[s]=e[s];n.events=n.events?n.events:{},n.events.refreshActions=function(e){t.refreshActions()},o.get3DSpaceUrl(),null!=this.options.securityContextFromAppPreference&&null!=this.options.securityContextFromAppPreference?this.securityContext=this.options.securityContextFromAppPreference:this.options.securityContext?this.securityContext=this.options.securityContext:this.securityContext=widget.data.pad_security_ctx,i.setContext(this.securityContext),this.tenant=widget.data.x3dPlatformId,this.options=e,this.options.isBookmark=void 0===this.options.isBookmark||this.options.isBookmark,void 0===this.options.isLibrary||!0===this.options.isLibrary?(this.options.isLibrary=!0,i.setSearchQueryFilter(!0,!0)):this.options.isLibrary&&i.setSearchQueryFilter(this.options.isLibrary.definitionPurpose,this.options.isLibrary.categorizationPurpose),this.options.isExportControl=void 0===this.options.isExportControl||this.options.isExportControl,this.options.isInformationPanel=!0,i.setInformationPanel(!0),this.elements.container=UWA.createElement("div",{class:"classificationInformationContainer"}),this.options.isExternal&&(this.getModel=function(){return t._internalModel})},updateFacet:function(){this.elements&&this.elements.plmContainer&&this.elements.plmContainer.destroy();var e=this.getModel();(e&&e._attributes&&"relationship"==!e._attributes.metatype||e&&!e._innerModels)&&(e&&e._attributes&&e._attributes.selReferenceID?this.objectId=e._attributes.selReferenceID:e&&e._attributes&&(this.objectId=e._attributes.objectId)),this.initUI=new t,this.initUI.setObjectId(this.objectId),i.setObjectId(this.objectId),this.elements.plmContainer=this.initUI.getUI(this.options),this.elements.plmContainer.inject(this.elements.container)},updateFacetExternal(e){this.setModel(e),this.updateFacet()},setModel:function(e){this._internalModel=e}})}),define("DS/ClassificationsFacet/PLMNewCommomCmpUXController",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WUXAutoComplete/AutoComplete","DS/Controls/Button","DS/Controls/TooltipModel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Loader","DS/Controls/ModalContainer","DS/Controls/Accordeon","DS/ClassificationsFacet/utils/PLMNewClassificationFacetData","DS/TreeModel/TreeDocument","DS/Controls/Popup","DS/ClassificationProp/facets/Properties/Properties","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/ClassifPropWidget","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/comm/EventManager","DS/PADUtils/PADSettingsMgt","DS/ClassificationProp/utils/ClassifPropControl","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/IPClassifyAlert","css!DS/ClassificationsFacet/ClassificationsFacet.css"],function(e,t,i,o,n,s,a,r,l,c,d,p,u,f,m,h,C,g,w,v,y,P,I,A){return e.extend(t,i,{name:"PLMNewCommomCmpUXController",classIdAndTitleMap:new Map,apiAttributesCall:[],_isProcessing:!1,securityContextMethod:null,init:function(e){this._parent(e);var t=this;this.elements.masterContainer=UWA.createElement("div",{class:"plmnew-masterContainer",id:e.appId}),t.counter=0,t.alreadySelectedNodes=[],t.alreadyPresentIDs=[],t.nodeRemoved,y.setProvider(t),"function"==typeof t.updateAttribute&&y&&y.setIPClassifyAlertProvider(A),this.domaincontainer=UWA.createElement("div",{class:"plmnew-domain-container"}).inject(this.elements.masterContainer),this.container=UWA.createElement("div",{class:"plmnew-container",id:e.appId+"plmnew-container"}).inject(this.domaincontainer);let i=e.container;this.elements.masterContainer.inject(i),this.isInformationPanel=e.isInformationPanel,this.loader=new l,t.plmNewClassificationFacetData=new p,t.accordeonCon=UWA.createElement("div",{class:"plmnew-accordeon-container"}),this.isInformationPanel||t.accordeonCon.inject(t.elements.masterContainer);var o={className:"classification_attributes"};t.classifPropertiesUI=new m(o,{readOnly:!0}).inject(this.elements.masterContainer);var n=null;e.securityContext&&"string"==typeof e.securityContext&&(n=e.securityContext),n=n||v.getSetting("pad_security_ctx"),t.classifPropertiesView=new C({typeOfDisplay:g.ALL,selectionType:g.NO_SELECTION,readOnly:e.attributesReadOnly,setEditButton:!1,context:{getSecurityContext:function(){return{SecurityContext:n}}}}),t.classifPropertiesView.inject(t.accordeonCon),t.classifPropModels=[],this.storageContainer=new u,t.previousPresentIds=[];var s=t._getComponentName();if(!0===e.isRefreshContainer&&this.isInformationPanel){let i=document.getElementById(t.options.appId+"-autocomplete-container");i&&i.remove();let o=document.getElementById(e.appId+"plmnew-container");o&&(o.removeChild(o.firstChild),t.container=o)}if(this.isInformationPanel){var a;let e=!0;I.get(s+"_accordeonPreference",i=>{e=!i||"collapse"!=i.type,(a=new d({items:[{header:s,content:this.createPLMNewManagement(t.accordeonCon),expandedFlag:e}],style:"filled-separate"}).inject(this.container)).addEventListener("expand",function(e){I.set(e.options.expanderTarget.header+"_accordeonPreference",{type:e.type},!0)}),a.addEventListener("collapse",function(e){I.set(e.options.expanderTarget.header+"_accordeonPreference",{type:e.type},!0)})})}else this.createPLMNewManagement().inject(this.container)},_closePanel:function(){this.dialog&&this.dialog.close()},createAutocompleteComponent:function(e,t,i,a){var r=this,l=UWA.createElement("div",{class:"plmnew-autocomplete-container"});if(!r.isInformationPanel)UWA.createElement("div",{class:"plmnew-autocomplete-label",html:'<label id="plmnewLabel">'+e+"</label>"}).inject(l);var c=UWA.createElement("div",{class:"plmnew-autocomplete-line"}).inject(l),d=UWA.createElement("div",{class:"plmnew-autocomplete"}).inject(c),p=UWA.createElement("div",{class:"plmnew-button-browse"}).inject(c);r=this;function m(){if(!r.autoComplete.selectedItems||!r.autoComplete.selectedItems.length)return[];var e=[];return r.autoComplete.selectedItems.forEach(t=>{e.push(t.id)}),e}let C=new u;if(r.autoComplete=new o({elementsTree:C,placeholder:P.search,typeDelayBeforeSearch:400,keepSearchResultsFlag:!1,multiSearchMode:!0,minLengthBeforeSearch:0,allowFreeInputFlag:!1,selectedItems:[],popupSizeAdjustPolicy:f.SizeAdjustPolicyEnum.NoAdjust,columnOptions:{autoRowHeightFlag:!0,typeRepresentation:"detailedUser"}}).inject(d),r.autoComplete.elementsTree=function(e){return e=e.trim().replace(/^\s+/g,""),r.autoComplete.customFilterMessage=P.autoCompleteFilterMessage.no_objects_found,function(e){return!!/[*+?()[\]"]/g.test(e)&&(r.autoComplete.customFilterMessage='Special Characters * ( ) [ ] +  ? " are not allowed',!0)}(e)?new Promise(e=>{r.autoComplete.customFilterMessage='Special Characters * ( ) [ ] +  ? " are not allowed',e(new u)}):e.length>=3?new Promise(t=>{r.storageContainer.removeRoots(),r.PLMNewCommonWebService.flattenedSearch({searchKey:e,alreadyPresentIDs:m(),nresults:5,//!
onComplete:function(i){if(i.results){if(r.storageContainer.prepareUpdate(),r.createAndInsert(r.storageContainer,i.results),i.infos.nmatches>5){var o=r.enableBrowseOptionInList(e);r.storageContainer.addRoot(o)}r.storageContainer.pushUpdate();var n=[];i.results.forEach(e=>{const t=e.attributes.find(e=>"physicalid"===e.name).value;n.push(t)}),r.PLMNewCommonWebService.getClassPaths({id:n,plmNewContextProvider:r.options.securityContext,onComplete:function(e,t){const o=r.PLMNewCommonWebService.constructPath(e,"idPathMap");r.storageContainer.prepareUpdate(),r.storageContainer.getAllDescendants().forEach(e=>{o.has(e.id)&&e.updateOptions({tooltip:new s({title:e.options.value.label,shortHelp:o.get(e.id),mouseRelativePosition:!0}),value:{subLabel:o.get(e.id)}})}),r.setClassNameForSearchData(i),"function"==typeof r.setClassUsageForSearchData&&(r.setClassPathForSearchData(i),r.setClassUsageForSearchData(o),r.classifPropertiesUI.setClassPath(r.getClassPath()),r.classifPropertiesUI.setClassUsage(r.getClassUsage())),r.storageContainer.pushUpdate()},onFailure:function(e){console.error(e)}})}t(r.storageContainer)},onFailure:function(e){console.error(e)}})}):new Promise(e=>{r.autoComplete.customFilterMessage=P.autoCompleteFilterMessage.minimum_3_characters_search,e(new u)})},"function"==typeof r.getAdditionalNodesAtInit){let e=r.options.isInformationPanel;r.getAdditionalNodesAtInit(C,e,r.options.objectId).then(e=>{e&&e.forEach(e=>{"function"==typeof r.getInitIcon&&(e.icons=[r.getInitIcon(e)]),e.isExisting=!0,function(e){let t=r.plmNewClassificationFacetData._createTreeNodeModel(e,C,r.couldBeSelected,null,r._classPathMap&&r._classPathMap.get(e.id));r.saveNodes&&r.saveNodes(t);C.pushUpdate(),C.value=t;var i=C.getChildren().length;C.getNthRoot(i-1).select()}(e)})}),"function"==typeof r.getAttributesandClassPathsForExistingClasses&&r.options.isInformationPanel&&(r.classifPropertiesUI.setClassPath(r.getClassPath()),r.classifPropertiesUI.setClassUsage(r.getClassUsage()),r.classifPropertiesUI.setClassPath(r.getAttribute()))}async function g(e,t,i){await e.forEach(e=>{r.addToProcessingCall(v.bind(this,e,t,i.get(e)))})}var v=function(e,t,i){r.autoComplete.selectedItems;if(t)return new Promise(t=>{if(r.options.getClassificationAttributes){var o=new h({objectId:e});r.classifPropModels.push(o),w.publish("getnoClassificationAttribute",e,!0),r.classifPropertiesUI.setClassIDandTitle(e,i),w.subscribe("getAttributesDone",function(e){t()}),r.classifPropModels.length>0&&r.classifPropertiesView.initDatas(r.classifPropModels,"classificationAttiProp")}else t()});var o=r.classifPropertiesView.controller._getModel(e);w.publish("getnoClassificationAttribute",e,!1);var n=r.classifPropModels.indexOf(o);-1!=n&&r.classifPropModels.splice(n,1);var s=r.classifPropertiesUI.getAccordeonFromID(e);r.classifPropModels.length>0&&r.classifPropertiesView.initDatas(r.classifPropModels,"classificationAttiProp"),s&&s._removeSection(e)};return r.autoComplete.addEventListener("change",function(e){let t,i,o=r.isInformationPanel;if(e.dsModel._model.nodeModel_reset)e.dsModel._model.nodeModel_reset=!1;else{var n=e.dsModel._model.getSelectedNodes(),s=n[n.length-1];if(s){const e=s.getID();if(null!=e&&"Browse"===e)return s._isSelected=!1,r.autoComplete.selectedItems=r.autoComplete.selectedItems.filter(e=>"Browse"!=e.getID()),void r.browseAssociations();t=!!s.isExisting&&s.isExisting}var a=m(),l=function(){if(!r.autoComplete.selectedItems||!r.autoComplete.selectedItems.length)return new Map;var e=new Map;return r.autoComplete.selectedItems.forEach(t=>{e.set(t.getID(),t.getLabel())}),e}(),c=!1;if(r.previousPresentIds.length<a.length){c=!0;var d=u(a,r.previousPresentIds);if(i=d,!d)return;r.saveNodes&&n.forEach(e=>{r.saveNodes(e)}),1==d.length?r.addToProcessingCall(v.bind(this,d[0],c,l.get(d[0]))):g(d,c,l)}else if(a.length<r.previousPresentIds.length){!0;var p=u(r.previousPresentIds,a);if(i=p,!p)return;r.isConfirmModel&&o&&r.isResetInProgress&&1!=r.isResetInProgress()?r.isConfirmModel({removedIds:p,isNodeAdded:c,selectedIdsLabelMap:l}):1==p.length?v(p[0],c,l.get(p[0])):g(p,c,l)}!t&&o&&i?r.isResetInProgress&&r.isResetInProgress()||function(e,t){let i={};i.classId=e,i.IDs=[r.options.objectId],t?"function"==typeof r.addContents&&r.addContents(i):"function"==typeof r.removeContents&&r.removeContents(i,{nodeHandler:v,multiNodeHandler:g})}(i,c):s&&(s.isExisting=!1),r.previousPresentIds=m()}function u(e,t){return e.filter(e=>!t.includes(e))}}),new n({displayStyle:"lite",label:P.tooltip_browse,onClick:a,icon:{iconName:"open-in-a-new-window",fontIconFamily:1},showLabelFlag:!1}).inject(p).tooltipInfos=new s({shortHelp:P.tooltip_browse}),l.inject(i),r.autoComplete},createAndInsert:function(e,t){var i=this;result=i.plmNewClassificationFacetData._generateSearchData(t,function(e){return i._getIcon(e)},function(e){return i.couldBeSelected(e)});let o=[];Object.assign(o,result.getChildren()),o.forEach(function(t){e.prepareUpdate(),e.addChild(t),e.pushUpdate()})},_processHandler:async function(e){await e.call(),console.log("api call success")},addToProcessingCall:function(e){this.apiAttributesCall.push(e),0==this._isProcessing&&(this._isProcessing=!0,this.processCalls())},processCalls:async function(){if(0!=this.apiAttributesCall.length)try{for(this._isProcessing=!0;this.apiAttributesCall.length>0;){let e=this.apiAttributesCall.shift();await this._processHandler(e)}}finally{this._isProcessing=!1}else this._isProcessing=!1},createAutocompleteDataTree:function(e){return this.plmNewClassificationFacetData.createAutocompleteDataTree(e)},insertInAutocomplete:function(e,t){if(t.isSelectable=this.couldBeSelected(t.plmType),this.autoComplete.selectedItems.every(function(e){if(e.id!=t.id)return!0}))return this.plmNewClassificationFacetData._createTreeNodeModel(t.options,e._model,this.couldBeSelected)},setPossibleDatasAutocomplete:function(e,t){e.elementsTree=t},setPossibleDatasAutocompleteSer:function(e,t){e.elementsTree.addRoot(t)},setValuesAutocomplete:function(e,t){e.value=t},_setNodesIdTobeHighLighted:function(e){this._IdsTobeHighLighted=e},enableBrowseOptionInList:function(e){var t={useAsyncPreExpand:!0};return t.label=P.browse_more+" "+e,t.value={label:P.browse_more,subLabel:'There are some more results containing "'+e+'"',icon:"open-in-a-new-window"},t.id="Browse",t.plmType="Browse",t.enableBrowse=!0,t._isSelected=!0,t.getLabel=function(){return"Browse"},this.plmNewClassificationFacetData._createTreeNodeModel(t,new u,function(e){return!0})},createPLMNewManagement:function(e){var t=UWA.createElement("div",{class:"plmnew-autocompletes-container",id:this.options.appId+"-autocomplete-container"});this.autoCompleteName=this._autoCompleteName();this._autocompleteComponent(t);return void 0!==e&&e.inject(t),this.loader.off(),c.removeModal(this.elements.masterContainer),t},browseAssociations:function(e,t,i){this.onClickSelector()}})}),define("DS/ClassificationsFacet/PLMNewClassificationFacet",["DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/PADUtils/PADSettingsMgt","DS/ClassificationProp/models/ClassifPropModel","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/ClassificationsFacet/InitClassificationCmpUI","DS/IPClassifyUtil/IPClassifyUtility","css!DS/ClassificationsFacet/ClassificationsFacet.css"],function(e,t,i,o,n,s,a,r,l){return e.extend(i,o,{name:"PLMNewClassificationFacet",securityContext:null,init:function(e){var t=e;this._parent(e),l.get3DSpaceUrl(),this.initUI=new r,this.elements.container=this.initUI.getUI(e),t.securityContext&&(securityContext=t.securityContext),this.listenToPublishedInfo(function(e,t){if("currentSecurityContext"===e){let e=t.value;securityContext=e}})},plmNewContextProvider:function(){return securityContext},getUI:function(e){return this.elements.container},postCreation:function(e){var i=this;let o,n,r,l=e[0].identifier,c=new Map;var d;function p(e,t,i){e.length>0&&e.forEach(function(e){function o(e){let o=e.slice(4),n=t.get(o);c.has(i)||c.set(i.toString(),new Set),c.get(i).add(n)}"string"==typeof e&&e.startsWith("fail")?o(e):e&&e.value&&e.value.startsWith("fail")&&o(e.value)})}if(i.IDsToClassify=[],i.IDsToBookmark=[],i.IDsToProtect=[],i.controller=this.initUI.getController(),i.plmNewFolderActive=i.controller.plmNewFolderActive,i.plmNewIPProtectionActive=i.controller.plmNewIPProtectionActive,i.plmNewLibraryActive=i.controller.plmNewLibraryActive,i.plmNewIPProtectionActive&&(r=new Promise(function(e,t){d=e,t})),i.plmNewFolderActive&&i.plmNewFolderActive.saveRespectiveAssociations){i.plmNewFolderActive.folderActiveActionBar&&i.plmNewFolderActive.folderActiveActionBar.nestedMenuInContext.popover&&i.plmNewFolderActive.folderActiveActionBar.nestedMenuInContext.popover.dispatchEvent("close"),i.plmNewFolderActive.autoComplete&&i.plmNewFolderActive.autoComplete.selectedItems&&i.plmNewFolderActive.autoComplete.selectedItems.length>0&&(i.IDsToBookmark=i.plmNewFolderActive.autoComplete.selectedItems.map(function(e){return e.id}));let e=i.plmNewFolderActive.classIdAndTitleMap;n=new Promise(function(t){i.IDsToBookmark.length>0?i.plmNewFolderActive.saveRespectiveAssociations(l,i.IDsToBookmark,i.plmNewContextProvider).then(function(i){p(i,e,"BookmarksApp"),t()}):t()}).then(function(e){})}if(i.plmNewLibraryActive&&i.plmNewLibraryActive.saveRespectiveAssociations){i.plmNewLibraryActive.libraryActiveActionBar&&i.plmNewLibraryActive.libraryActiveActionBar.nestedMenuInContext.popover&&i.plmNewLibraryActive.libraryActiveActionBar.nestedMenuInContext.popover.dispatchEvent("close"),i.plmNewLibraryActive.autoComplete&&i.plmNewLibraryActive.autoComplete.selectedItems&&i.plmNewLibraryActive.autoComplete.selectedItems.length>0&&(i.IDsToClassify=i.plmNewLibraryActive.autoComplete.selectedItems.map(function(e){return e.id}));let e=i.plmNewLibraryActive.classIdAndTitleMap;o=new Promise(function(t){i.IDsToClassify.length>0?i.plmNewLibraryActive.saveRespectiveAssociations.call(null,l,i.IDsToClassify,i.plmNewContextProvider).then(function(i){p(i,e,"LibraryApp"),t()}).catch(()=>{console.log("Some save operation failed")}):t()}).then(function(e){var t=new s({objectId:l});[].push(t),i.plmNewLibraryActive.classifPropertiesView.controller.skeleton.saveClassificationFacet(l,i.plmNewLibraryActive.classifPropModels,t,i.plmNewContextProvider())}).catch(e=>{console.log("data issue")})}return Promise.allSettled([[],o,n]).then(()=>{if(i.plmNewIPProtectionActive&&i.plmNewIPProtectionActive.saveRespectiveAssociations){i.plmNewIPProtectionActive.plmNewIPActionBar&&i.plmNewIPProtectionActive.plmNewIPActionBar.nestedMenuInContext.popover&&i.plmNewIPProtectionActive.plmNewIPActionBar.nestedMenuInContext.popover.dispatchEvent("close"),i.plmNewIPProtectionActive.autoComplete&&i.plmNewIPProtectionActive.autoComplete.selectedItems&&i.plmNewIPProtectionActive.autoComplete.selectedItems.length>0&&(i.IDsToProtect=i.plmNewIPProtectionActive.autoComplete.selectedItems.map(function(e){return e.id}));let e=i.plmNewIPProtectionActive.classIdAndTitleMap;i.IDsToProtect.length>0?i.plmNewIPProtectionActive.saveRespectiveAssociations.call(null,l,i.IDsToProtect).then(function(t){p(t,e,"ExportControlApp"),d()}):d()}}),new t.Promise(function(t){Promise.allSettled([n,o,r]).then(()=>{var o={level:"error",title:a.replace(a.get("classificationFailure_title"),{plmnewtype:e[0].type}),subtitle:a.replace(a.get("classificationFailure_subtitle"),{plmnewtype:e[0].type}),message:[a.get("classificationFailure_message")],allowUnsafeHTML:!1,code:"error"};if(0==c.size){var n=a.replace(a.get("classificationSuccessMessage"),{plmnewtype:e[0].type});(o={}).code="200",o.message=[n]}0==i.IDsToBookmark.length&&0==i.IDsToClassify.length&&0==i.IDsToProtect.length&&(o=null),t(o)})})},destroy:function(){t.is(this.options.onDestroyCallback,"function")&&this.options.onDestroyCallback(this.options.tabId),this._parent()}})});