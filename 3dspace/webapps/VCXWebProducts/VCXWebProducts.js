define("DS/VCXWebProducts/VCXSelectSimilarInstanceActionBar",["DS/ApplicationFrame/CommandCheckHeader","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebProperties/VCXColor","DS/CoreEvents/Events"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{}),this.onStateChange(()=>{this.getState()&&this.beginExecute()}),this.wuxTokens={}},DoSelection(){var e=this.getFrameWindow()._experienceBase,n=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt");let i=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map(e=>e._reference).filter(e=>!!e);n=n.filter(e=>i.includes(e._reference));var o=new t(e.getManager("VCXSelectionManager"));o.SetComponentsSelection(n),e.getManager("VCXCommandManager").Do(o)},unsubscribeEvents:function(){for(let e in this.wuxTokens)this.wuxTokens.hasOwnProperty(e)&&i.unsubscribe(this.wuxTokens[e])},beginExecute:function(){console.log("Begin Execute"),this.getFrameWindow()._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").length?(this.DoSelection(),this.endExecute()):(this.wuxTokens.COMPONENTSLIST_ADD_Token=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},()=>{this.DoSelection(),console.log("Selection Added"),this.endExecute()}),this.wuxTokens.COMPONENTSLIST_REMOVE_Token=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},()=>{console.log("Selection Removed"),this.endExecute()}),this.wuxTokens.COMPONENTSLIST_EMPTY_Token=i.subscribe({event:"VCX_SELECTED_ACTORS_EMPTY"},()=>{console.log("Selection Empty"),this.cancelExecute()}))},execute:function(){console.log("Execute")},endExecute:function(){this.unsubscribeEvents(),this.setState(!1),console.log("End Execute")},cancelExecute:function(){this.unsubscribeEvents(),this.setState(!1),console.log("Cancel Execute")}})}),define("DS/VCXWebProducts/VCXCameraPlayModeCmd",["DS/ApplicationFrame/CommandCheckHeader"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{});var t=this;this.onStateChange(function(){var e=t.getFrameWindow()._experienceBase;if(e){var n=e.getManager("VCXVisuManager");n&&(t.getState()?n.setUpdateViewport(!0):n.setUpdateViewport(!1))}}),this.setState(!0)}})}),define("DS/VCXWebProducts/VCXSelectGeometries",["DS/ApplicationFrame/CommandCheckHeader","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebProperties/VCXColor","DS/CoreEvents/Events"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{}),this.setState(!0,!1),this.onStateChange(()=>{this.execute()})},beginExecute:function(){console.log("BEGIN EXECUTE")},execute:function(){const e=this.getFrameWindow();if(e&&e._experienceBase){const t=e._experienceBase.getManager("VCXSelectionManager");t&&(t.excludeParts=!this.getState())}},endExecute:function(){console.log("END EXECUTE")}})}),define("DS/VCXWebProducts/VCXPreviewPlayCmd",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return n.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){},execute:function(){this.onResume(function(){}),this.onPause(function(){})},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXShowSelectionCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),o=[],r=0;r<i.length;++r){var a=i[r].QueryInterface("VCXIVisibility");a&&(a.GetVisibility()!==n.EVisState.Hidden||o.push(i[r]))}if(0!==o.length){var s=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));s.ChangeVisibility(o,n.EVisState.Visible),e.getManager("VCXCommandManager").Push(s)}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXTransformFreeDragCmd",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS"],function(e,t,n,i,o,r,a){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this._tokens=null},beginExecute:function(){this._experienceBase=this.getFrameWindow()._experienceBase;this._experienceBase.getManager("VCXContextManager");this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer(),this._tokens||(this._tokens={}),this._tokens.pointerDownToken=r.addEvent(this._viewer.div,"onPrimaryPointerDownUnique",this._onPointerDownCB()),this._tokens.pointerMovePlainToken=t.subscribe({event:"/VISU/onPrimaryPointerMove"},this._onPointerMoveCB())},_onPointerDownCB:function(){var e=this,n=this._experienceBase.getManager("VCXGUIManager");return s=>{const c=this._experienceBase.getManager("VCXManipulatorManager");if(!(c&&c.manipulatorPreActivated||e._tokens.pointerUpToken)){var u,l=e._viewer.getMousePosition(s.from[0].getCurrentPosition(e._viewer.div)),d=e._viewer.pick(l,"mesh",!0);d&&d.path&&d.path.length>0&&(u=d.path[0].clone());var C=u&&i.GetModifiableFromPathElement(u,e._experienceBase);if(C){var g=e._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection("VCXComponentOccurrenceExt");if(!C.GetObject().IsKindOf("VCXComponentOccurrenceExt"))return;var h=[];if(C.GetObject().IsKindOf("VCXComponentOccurrenceExt"))h=g.map(function(e){return e.QueryInterface("VCXIModifiable")}),0!==(h=o.filterChildrenOfModsFromArray(h)).length&&e.checkPickedComponentHasAncestorInArray(C,h)||C.GetObject().IsKindOf("VCXComponentOccurrenceExt")&&(h=[C]);e._viewer.currentViewpoint.setControlActive({viewpoint:!1}),e._viewer.setPrePicking({activated:!1});var p=d.position.clone(),m=(new a.Vector3).subVectors(e._viewer.currentViewpoint.target,e._viewer.currentViewpoint.position).normalize(),f=new a.Plane(m,0).setFromNormalAndCoplanarPoint(m,p);e._initInfos={data:s,pickInfo:d,modifiablesArray:h,plane3D:f,mousePos:l},e._isDragging=!1,e._lastPosition=p,n.SetCursor("grabbing"),e._experienceBase.getManager("VCXCommandManager").StartTransaction(),e._tokens.pointerMoveDragToken||(e._tokens.pointerMoveDragToken=t.subscribe({event:"/VISU/onPrimaryPointerMove"},e._translate())),e._tokens.pointerUpToken||(e._tokens.pointerUpToken=r.addEvent(e._viewer.div,"onPrimaryPointerUpUnique",e._disposeEvents()))}}}},_onPointerMoveCB:function(){var e=this;const t=this._experienceBase.getManager("VCXGUIManager");return n=>{const o=this._experienceBase.getManager("VCXManipulatorManager");if(!(o&&o.manipulatorPreActivated||e._initInfos)){var r,a=e._viewer.getMousePosition(n.from[0].getCurrentPosition(e._viewer.div)),s=e._viewer.pick(a,"mesh",!0);s&&s.path&&s.path.length>0&&(r=s.path[0].clone());var c=r&&i.GetModifiableFromPathElement(r,e._experienceBase);c&&c.GetObject().IsKindOf("VCXComponentOccurrenceExt")?t.SetCursor("grab"):t.SetCursor("default")}}},_translate:function(){var e=this;return function(t){if(e._initInfos&&e._lastPosition){var n=e._viewer.getMousePosition(t.from[0].getCurrentPosition(e._viewer.div));if(!e._isDragging){var i=e._initInfos.mousePos;if(Math.max(Math.abs(n.xPix-i.xPix),Math.abs(n.yPix-i.yPix))<3)return;e._isDragging=!0}var o=e._viewer.pick(n,"mesh",!1).ray.intersectPlane(e._initInfos.plane3D),r=e._initInfos.modifiablesArray;e._translateFromOriginToTarget(e._lastPosition,o,r),e._lastPosition=o.clone()}}},_translateFromOriginToTarget:function(e,t,i){for(var r=(new a.Vector3).subVectors(t,e),s=new n(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager")),c=0;c<i.length;++c){var u=i[c];if(u){var l=o.buildPropertyLocationWithTranslationInWCS(u,r);s.ChangeProperty(i[c],l)}}this._experienceBase.getManager("VCXCommandManager").Push(s)},_disposeEvents:function(){var e=this,n=this._experienceBase.getManager("VCXGUIManager");return function(i){if(t.unsubscribe(e._tokens.pointerMoveDragToken),e._tokens.pointerMoveDragToken=null,r.removeEventFromToken(e._tokens.pointerUpToken),e._tokens.pointerUpToken=null,e._experienceBase.getManager("VCXCommandManager").EndTransaction("Free Drag"),n.SetCursor("grab"),e._viewer.currentViewpoint.setControlActive({viewpoint:!0}),e._viewer.setPrePicking({activated:!0}),"record"===e._experienceBase.odt&&e._isDragging){var o={commandName:"VCXTransformFreeDragCmd",componentsIDs:e._initInfos.modifiablesArray.map(function(e){return e.GetObject().GetID()}),origin:e._initInfos.pickInfo.position.createJSON(),target:e._lastPosition.createJSON()};e._experienceBase.getManager("VCXODTManager").LogAPI("VCXExecuteFreeDrag",o)}e._initInfos=null,e._translateCB=null,e._disposeCB=null,e._isDragging=!1}},endExecute:function(){this._experienceBase.getManager("VCXGUIManager").SetCursor("default"),this._tokens&&(this._tokens.pointerDownToken&&r.removeEventFromToken(this._tokens.pointerDownToken),this._tokens.pointerMovePlainToken&&t.unsubscribe(this._tokens.pointerMovePlainToken)),this._tokens={},this._lastPosition=null,this._viewer=null,this._experienceBase=null},checkPickedComponentHasAncestorInArray:function(e,t){if(t.includes(e))return!0;for(var n=e.QueryInterface("VCXIModelNavigable"),i=0;i<t.length;++i){if(t[i].QueryInterface("VCXIModelNavigable").isAncestorOf(n))return!0}return!1},executeFreeDragODT:function(e){var t=e.origin,n=e.target,i=this._experienceBase.ComponentsMap.GetComponentsFromIDs(e.componentsIDs).map(function(e){return e.QueryInterface("VCXIModifiable")});this._translateFromOriginToTarget(t,n,i)}})}),define("DS/VCXWebProducts/VCXTransformCmd",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/Visualization/ThreeJS_DS","DS/Robot/Robot","DS/CoreEvents/Events"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),t.getCommand("VCXTransformHackCmd",e.context)||(t._commands[e.context].VCXTransformHackCmd=this,this._hackEvent=o.subscribe({event:this._evtID.replace("VCXTransformCmd","VCXTransformHackCmd")},()=>{this._ignoreBeginCtx||(this._comeFromCtxBar=!0,this.begin(),this._comeFromCtxBar=!1)}));this._bChangePositionAtCmdBeginning=!0,this._tokenSelectionAdd=null,this._tokenSelectionRemove=null,this._tokenSelectionEmpty=null,o.subscribe({event:"VCX_DONT_CHNG_ROBOT_POS_AT_TRANSFORM_BEGIN"},e=>{this._bChangePositionAtCmdBeginning=!1,this._targetsAtBeginning=e&&e.targets,this._matrixAtBeginning=e&&e.matrix})},destroy:function(){this._hackEvent&&o.unsubscribe(this._hackEvent)},beginExecute:function(){this._experienceBase=this.getFrameWindow()._experienceBase,this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer(),this._ignoreBeginCtx=!0,o.publish({event:this._evtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/BEGIN",data:this}),o.publish({event:this._globalEvtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/BEGIN",data:this}),this._ignoreBeginCtx=!1,this._comeFromCtxBar&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.hideContextualBar();var e=this;this._tokenSelectionAdd=o.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(){e.isRunning()&&e._displayPivot()}),this._tokenSelectionRemove=o.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(){e.isRunning()&&e._displayPivot()}),this._tokenSelectionEmpty=o.subscribe({event:"VCX_SELECTED_ACTORS_EMPTY"},function(){e.isRunning()&&e._displayPivot()}),this._displayPivot(),this._bChangePositionAtCmdBeginning||this.changeRobotPosAtCmdBeginning(!0)},endExecute:function(){if(this._experienceBase){o.publish({event:this._evtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/END",data:this}),o.publish({event:this._globalEvtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/END",data:this}),null!==this._tokenSelectionAdd&&(o.unsubscribe(this._tokenSelectionAdd),this._tokenSelectionAdd=null),null!==this._tokenSelectionRemove&&(o.unsubscribe(this._tokenSelectionRemove),this._tokenSelectionRemove=null),null!==this._tokenSelectionEmpty&&(o.unsubscribe(this._tokenSelectionEmpty),this._tokenSelectionEmpty=null);var e=this._viewer.getRobot();if(!(e instanceof i))return;e.target=null,e.setConnectionState(!1),e.CallBackEventHandlerViewPoint();var n=this._experienceBase.getManager("VCXContextManager").getContext();t.getCommand("VCXMoveRobotOnBBoxCenterCmd",n).disable(),this._experienceBase.getManager("VCXRobotAdapter").displayRobot(!1,!0),this._viewer.render()}this._viewer=null,this._experienceBase=null},cancelExecute:function(){this.changeRobotPosAtCmdBeginning(!0)},_displayPivot:function(){if(!(this._bChangePositionAtCmdBeginning||this._targetsAtBeginning&&this._matrixAtBeginning))return;var e=this._viewer.getRobot();if(!(e instanceof i))return console.error("No robot found.."),void this.end();this._targetsAtBeginning&&this._experienceBase.getManager("VCXSelectionManager").addComponentsToSelection(this._targetsAtBeginning);const n=[];for(var o=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO"),r=0;r<o.length;++r)if(o[r].IsKindOf("VCXWebComponentOccurrence")&&!o[r].IsDressup){var a=o[r].QueryInterface("VCXIModifiable");a&&n.push(a)}var s=this._experienceBase.getManager("VCXContextManager").getContext(),c=t.getCommand("VCXMoveRobotOnBBoxCenterCmd",s);if(Array.isArray(n)&&n.length>0){let t;e.setConnectionState(!0),e.fixedSizeNode3D.setRatio(7),e.target=n[0].QueryInterface("W3AISGNodeHolder").getPathElement(),(t=this._matrixAtBeginning?this._matrixAtBeginning:this._getNewRobotFrame(n))&&(e.setRobotMatrix(t),e.setVisibility(!0),c.isEnabled()||c.enable())}else c.isEnabled()&&c.disable(),e.setVisibility(!1),e.target=null,e.setConnectionState(!1),e.CallBackEventHandlerViewPoint();this._viewer.render()},_getNewRobotFrame:function(e){if(0!==e.length){if(1===e.length&&"VCX_Root"!==e[0].GetObject()._ID){var t=e[0].GetProperty("Actor.Position").GetPropertyValue().GetPivot().GetValue(),i=e[0].QueryInterface("W3AISGNodeHolder").getPathElement().getParentPath().getWorldMatrix(this._viewer);return a=(new n.Matrix4).copy(i).multiply(t)}var o,r=null;for(o=0;o<e.length;++o)if("VCX_Root"!==e[o].GetObject()._ID){t=e[o].GetProperty("Actor.Position").GetPropertyValue().GetPivot().GetValue(),i=e[o].QueryInterface("W3AISGNodeHolder").getPathElement().getParentPath().getWorldMatrix(this._viewer);var a=(new n.Matrix4).copy(i).multiply(t);if(null!==r){if(!this._equalMatrices(a,r))break}else r=a.clone()}return o===e.length?r:(new n.Matrix4).setPosition(this._getBBoxInWCS(e).center())}console.error("No modifiable specified in the array parameter")},changeRobotPosAtCmdBeginning:function(e){"boolean"==typeof e?(this._bChangePositionAtCmdBeginning=e,this._matrixAtBeginning=null,this._targetsAtBeginning=null):console.error("A boolean is needed as parameter")},_equalMatrices:function(e,t){if(e instanceof n.Matrix4&&t instanceof n.Matrix4){var i;for(i=0;i<16&&!(Math.abs(e.elements[i]-t.elements[i])>.001);++i);return 16===i}console.error("2 THREE.Matrix4 objects are needed as parameters")},_getBBoxInWCS:function(e){for(var t=new n.Box3,i=0;i<e.length;i++){var o=e[i].QueryInterface("W3AISGNodeHolder"),r=o.getPathElement().getBoundingBox(null,this._viewer);r.applyMatrix4(o.getWorldMatrix(this._viewer)),t.union(r)}return t}})}),define("DS/VCXWebProducts/VCXIsolateCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),o=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");if(o.forEach(e=>{e.QueryInterface("VCXIModelNavigable").traverse(e=>o.push(e.GetObject()))}),0!==(i=i.filter(e=>e.IsKindOf("VCXDressup_Spec")||e.IsKindOf("VCXComponentOccurrenceExt")&&e.IsMesh())).length){var r=i.filter(e=>o.includes(e)),a=i.filter(e=>!o.includes(e)),s=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));s.ChangeVisibility(a,n.EVisState.Hidden),console.log(a),a.forEach(e=>{console.log(e._name)});var c=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));c.ChangeVisibility(r,n.EVisState.Visible),console.log(r),r.forEach(e=>{console.log(e._name)}),e.getManager("VCXCommandManager").StartTransaction(),e.getManager("VCXCommandManager").Push(s),e.getManager("VCXCommandManager").Push(c),e.getManager("VCXCommandManager").EndTransaction()}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXSelectMarkups",["DS/ApplicationFrame/CommandCheckHeader"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{}),this.setState(!0,!1),this.onStateChange(()=>{this.execute()})},beginExecute:function(){console.log("BEGIN EXECUTE")},execute:function(){const e=this.getFrameWindow();if(e&&e._experienceBase){const t=e._experienceBase.getManager("VCXSelectionManager");t&&(t.excludeDressups=!this.getState())}},endExecute:function(){console.log("END EXECUTE")}})}),define("DS/VCXWebProducts/VCXSelectSimilarColorActionBar",["DS/ApplicationFrame/CommandCheckHeader","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebProperties/VCXColor","DS/CoreEvents/Events"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{}),this.onStateChange(()=>{this.getState()&&this.beginExecute()}),this.wuxTokens={}},DoSelection(){var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt");let o=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map(e=>{if(!e.IsKindOf("VCXComponentOccurrenceExt")||!e.IsMesh())return!1;let t=e.GetCurrentMaterial();if(t)return t;let n=e.QueryInterface("VCXIModifiable"),i=n&&n.GetProperty("Actor.Color");return i&&i.GetPropertyValue().GetValue()}).filter(e=>!!e);i=i.filter(e=>{if(!e.IsMesh())return!1;let t=e.GetCurrentMaterial();if(t&&o.includes(t))return!0;let i=e.QueryInterface("VCXIModifiable"),r=i&&i.GetProperty("Actor.Color"),a=r&&r.GetPropertyValue().GetValue();return a&&o.find(e=>e instanceof n&&e.equals(a))});var r=new t(e.getManager("VCXSelectionManager"));r.SetComponentsSelection(i),e.getManager("VCXCommandManager").Do(r)},unsubscribeEvents:function(){for(let e in this.wuxTokens)this.wuxTokens.hasOwnProperty(e)&&i.unsubscribe(this.wuxTokens[e])},beginExecute:function(){console.log("Begin Execute"),this.getFrameWindow()._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").length?(this.DoSelection(),this.endExecute()):(this.wuxTokens.COMPONENTSLIST_ADD_Token=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},()=>{this.DoSelection(),console.log("Selection Added"),this.endExecute()}),this.wuxTokens.COMPONENTSLIST_REMOVE_Token=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},()=>{console.log("Selection Removed"),this.endExecute()}),this.wuxTokens.COMPONENTSLIST_EMPTY_Token=i.subscribe({event:"VCX_SELECTED_ACTORS_EMPTY"},()=>{console.log("Selection Empty"),this.cancelExecute()}))},execute:function(){console.log("Execute")},endExecute:function(){this.unsubscribeEvents(),this.setState(!1),console.log("End Execute")},cancelExecute:function(){this.unsubscribeEvents(),this.setState(!1),console.log("Cancel Execute")}})}),define("DS/VCXWebProducts/VCXInvertVisibilityCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),o=[],r=[],a=0;a<i.length;++a){var s,c=i[a].IsKindOf("VCXDressup_Spec");if(i[a].IsKindOf("VCXComponentOccurrenceExt")&&i[a].IsMesh())(s=i[a].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()===n.EVisState.Hidden?o.push(i[a]):r.push(i[a]));if(c)(s=i[a].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()===n.EVisState.Hidden?o.push(i[a]):r.push(i[a]))}var u=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));u.ChangeVisibility(r,n.EVisState.Hidden),console.log(r),r.forEach(e=>{console.log(e._name)}),e.getManager("VCXCommandManager").Do(u);var l=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));l.ChangeVisibility(o,n.EVisState.Visible),console.log(o),o.forEach(e=>{console.log(e._name)}),e.getManager("VCXCommandManager").Do(l)},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXShowAllGeometriesCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt"),o=[],r=0;r<i.length;++r){var a=i[r];if(!a.IsKindOf("VCXComponentCompositePmi")){var s=a.QueryInterface("VCXIVisibility");s&&(s.GetVisibility()!==n.EVisState.Hidden||o.push(i[r]))}}if(0!==o.length){var c=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));c.ChangeVisibility(o,n.EVisState.Visible),e.getManager("VCXCommandManager").Push(c)}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXRestoreActiveViewVisibilityCmd",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,t=e.getManager("VCXScenarioManager").GetCurrentScenario(),n=e.ComponentsMap.GetComponentFromID(t);e.getManager("VCXScenarioManager").ApplyVisibility(n)},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXMousePositionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/VCXWebVisu/VCXModifiablesAccess","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/VCXWebVisu/VCXVisuTools","DS/VCXWebSystem/VCXMathTools","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXWebSystem/VCXMeshServices","DS/SceneGraphNodes/FixedSizeArrowNode"],function(e,t,n,i,o,r,a,s,c,u,l){"use strict";return t.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){this._containDiv=e.createElement("div",{styles:{position:"absolute",paddingTop:"10px",paddingLeft:"20px",top:"0px",left:"0px",pointerEvents:"none","background-color":"aliceblue"}});var t=this.getFrameWindow().getUIFrame();this._containDiv.inject(t),this._token=i.addEvent(this.getFrameWindow().getViewer().div,"onPrimaryPointerMoveUnique",this.onPointerMove.bind(this))},endExecute:function(){i.removeEventFromToken(this._token),this._containDiv.remove()},onPointerMove:function(e){let t=e=>{e.setRenderPasses([p.getRenderList("VCXPre3DManipulators"),p.getRenderList("VCX3DManipulators")]),e.setFrustumCulled&&e.setFrustumCulled(!1),e.setShadow&&e.setShadow(!1,!1),e.setMirror&&e.setMirror(!1),e.exludeFromBounding&&e.exludeFromBounding(!0),e.setPickable(c.PICKTHROUGH),this._fbNode.addChild(e)},i=event.clientX,d=event.clientY,C=this.getFrameWindow()._experienceBase,g="x:"+i+" / y:"+d;this._containDiv.setStyle("top",d+"px"),this._containDiv.setStyle("left",i+"px");let h=this.getFrameWindow().getViewer(),p=C.getManager("VCXVisuManager");var m=h.getMousePosition(e.from[0].getCurrentPosition(h.div)),f=h.pick(m,"primHybrid",!0);if(this._fbNode||(this._fbNode=new s,h.addNode(this._fbNode)),this._fbNode.removeChildren(),f.path.length){let i=n.GetModifiableFromEvent(e,C);if(i){let e,n=!1,s=[];const d=new o.Ray;if(r.traverseAll(i,{processPathElement:({object:t})=>{e=t.getWorldMatrix(h)},filterPrimitiveGroup:({object:e})=>4===e.glType,filterPrimitive:({object:e})=>"primitive"===f.path[0].getLastElement().getType()&&f.path[0].getLastElement().getPrimitives()[0].isEqual(e),processTriangle:({object:i,index:r,parentObject:u})=>{if(i.points&&i.points.forEach(t=>{t.ray||(t.ray=new o.Ray,i.buffers.geometry.getVertexPosition(t.index,t.ray.origin),i.buffers.geometry.getVertexNormal(t.index,t.ray.direction),t.ray.direction.normalize(),t.ray.applyMatrix4(e))}),a.pointOnTriangle(f.position,i.points[0].ray,i.points[1].ray,i.points[2].ray,d)){let e=u.parentObject.parentObject.parentObject.parentObject.object.getLastElement(!0).id+"/"+u.parentObject.parentObject.parentObject.parentObject.index+"/"+u.parentObject.parentObject.parentObject.index+"/"+u.parentObject.parentObject.index+"/"+u.parentObject.index+"/"+u.index+"/"+r;s.push({path:e,triangle:i,intersection:d.clone()});let C=new l({name:"Intersection",arrowWidth:1,arrowLength:100,headLength:32,headWidthToHeightRatio:.4,color:new c.Color(1,1,0),pickable:!1});C.setMatrix(a.getMatrixFromOVz(d.origin,d.direction||new o.Vector3(1,0,0))),t(C),n=!0}},postProcessTriangle:()=>!n}),s.length){let e=s[0],n=Number.MAX_VALUE;s.forEach(t=>{let i=f.ray.origin.distanceTo(t.intersection.origin);i<n&&(n=i,e=t)});let i=e.triangle;g+="<BR>\r\n"+e.path,g+=":["+i.points[0].index+","+i.points[1].index+","+i.points[2].index+"]",i.points&&i.points.forEach((e,n)=>{let i=new l({name:e.index,arrowWidth:1,arrowLength:100,headLength:32,headWidthToHeightRatio:.4,color:new c.Color(0===n?1:0,1===n?1:0,2===n?1:0),pickable:!1});i.setMatrix(a.getMatrixFromOVz(e.ray.origin,e.ray.direction)),t(i)});let o=u.buildLineStripSet([i.points[0].ray.origin.x,i.points[0].ray.origin.y,i.points[0].ray.origin.z,i.points[1].ray.origin.x,i.points[1].ray.origin.y,i.points[1].ray.origin.z,i.points[2].ray.origin.x,i.points[2].ray.origin.y,i.points[2].ray.origin.z],[4],[0,1,2,0],null,2,null);t(o),h.render()}}}this._containDiv.setHTML(g)}})}),define("DS/VCXWebProducts/VCXShowAllCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),o=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence",!0),r=[],a=0;a<i.length;++a){(s=i[a].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()!==n.EVisState.Hidden||r.push(i[a]))}for(a=0;a<o.length;++a){var s;(s=o[a].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()!==n.EVisState.Hidden||r.push(o[a]))}if(0!==r.length){var c=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));c.ChangeVisibility(r,n.EVisState.Visible),e.getManager("VCXCommandManager").Push(c)}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXHideSelectionCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){this._hideSelection()},endExecute:function(){this._experienceBase=null},_hideSelection:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase;var t=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();this._hideElementsFromArray(t)},_hideElementsFromArray:function(e){if(Array.isArray(e)){for(var i,o=[],r=0;r<e.length;++r){var a=e[r].QueryInterface("VCXIVisibility");a&&((i=a.GetVisibility())!==n.EVisState.Visible&&void 0!==i||o.push(e[r]))}if(0!==o.length){var s=new t(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager"));s.ChangeVisibility(o,n.EVisState.Hidden),this._experienceBase.getManager("VCXCommandManager").Push(s)}}}})}),define("DS/VCXWebProducts/VCXPlayGuidedTourUI",["UWA/Class","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","i18n!DS/VCXWebProducts/assets/nls/VCXWebProducts","css!DS/VCXWebProducts/VCXWebProducts.css"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){this._modelEvent=new n,this.buttonsTooltipsStr={terminate:i.GuidedTourTerminateButton}},destroy:function(){this.terminateUI(),this.buttonsTooltipsStr=null,this._modelEvent=null},setplayGuidedTourUI:async function(e){var n=e._experienceBase.getManager("VCXGUIManager").getGUIServices();this.preHidingConfig=await n.hideDockingElements(e),e.getActionBar().hide(),this._setImmersiveUICustomization(!0),this.frmWindow=e;var i=this.frmWindow.getUIFrame();this._container=UWA.createElement("div",{html:"",class:"guidedTourGUI pauseOnClickCurtain atCmdLaunch paused"}),this._playPauseButton=UWA.createElement("div",{html:"",class:"guidedTourGUI__playPauseButton playIcon"}),this._playPauseButton.inject(this._container),this._terminateButton=UWA.createElement("div",{html:"",class:"guidedTourGUI__terminateButton",title:this.buttonsTooltipsStr.terminate}),this._terminateButton.inject(this._container);var o=document.getElementById("PlayWeb-TopMenu");o&&o.classList.add("shifted"),this._waitingContainer=UWA.createElement("div",{html:"",class:"pauseWaitingContainer"});for(var r=0;r<4;++r){UWA.createElement("div",{html:"",class:"pauseWaitingBar"}).inject(this._waitingContainer)}this.terminateUICB=this._publishEvent.bind(this,"terminate"),this.togglePlayPauseCB=this._togglePlayPauseUI.bind(this),this._terminateButton.addEventListener("click",this.terminateUICB),this._playPauseButton.addEventListener("click",this.togglePlayPauseCB),this._container.addEventListener("click",this.togglePlayPauseCB);var a=this;this.tokenSubscribeEnd=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_END"},function(e){a._setPauseWaitingAnimation(!1),a._container.classList.contains("playing")&&a.displayUI(),a._deactivateCustoImmersiveUIArrow()}),this.tokenSubscribeGoToScen=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_GOTOSCENARIO"},function(e){a._activateCustoImmersiveUIArrow(e.currentScenarioIdx<e.nextScenarioIdx)}),this.tokenSubscribeGoToScen=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_GOTOSCENARIO_END"},function(e){a._deactivateCustoImmersiveUIArrow()}),this._container.inject(i)},terminateUI:function(e){if(e&&e.stopPropagation(),this.frmWindow){var n=this.frmWindow._experienceBase.getManager("VCXGUIManager").getGUIServices();if(this.preHidingConfig=n.restoreDockingElements(this.frmWindow,this.preHidingConfig),this.frmWindow.getActionBar().show(),this._container){this.tokenSubscribeEnd&&t.unsubscribe(this.tokenSubscribeEnd),this.tokenSubscribeEnd=null,this._terminateButton.removeEventListener("click",this.terminateUICB),this._playPauseButton.removeEventListener("click",this.togglePlayPauseCB),this._container.removeEventListener("click",this.togglePlayPauseCB),this.terminateUICB=null,this.togglePlayPauseCB=null,this.togglePlayPauseCB=null;for(var i=this._waitingContainer.getChildren(),o=0;o<i.length;++o){var r=i[o];r&&r.destroy()}this._waitingContainer.destroy(),this._terminateButton.destroy();var a=document.getElementById("PlayWeb-TopMenu");a&&a.classList.contains("shifted")&&a.classList.remove("shifted"),this._playPauseButton.destroy(),this._container.destroy()}this.frmWindow=null}else console.log("No Framewindow available anymore..")},displayUI:function(){this._playPauseButton.classList.contains("pauseIcon")&&(this._userInteraction?(this._setPauseWaitingAnimation(!0),this._userInteraction=!1):(this._playPauseButton.classList.remove("pauseIcon"),this._playPauseButton.classList.add("playIcon"))),this._container.classList.contains("pauseOnClickCurtain")&&this._container.classList.remove("pauseOnClickCurtain"),this._container.classList.contains("playing")&&this._container.classList.replace("playing","paused"),this._setImmersiveUICustomization(!1)},hideUI:function(){this._container.classList.contains("atCmdLaunch")&&this._container.classList.remove("atCmdLaunch"),this._playPauseButton.classList.contains("playIcon")&&this._playPauseButton.classList.replace("playIcon","pauseIcon"),this._container.classList.contains("pauseOnClickCurtain")||this._container.classList.add("pauseOnClickCurtain"),this._container.classList.contains("paused")&&this._container.classList.replace("paused","playing"),this._setImmersiveUICustomization(!0),this._userInteraction=!1},subscribe:function(e,t){if(this._modelEvent)return this._modelEvent.subscribe({event:e},t)},unsubscribe:function(e){this._modelEvent&&this._modelEvent.unsubscribe(e)},togglePlayPauseUIODT:function(e){"replay"===e.odt&&(this._playPauseButton.classList.contains("playIcon")||this._playPauseButton.classList.contains("pauseIcon"))&&(this._userInteraction=!0,this._publishEvent("togglePlayPause"))},_activateCustoImmersiveUIArrow:function(e){this._toggleActivationCustoImmersiveUIArrow(!0,{ibNextArrow:e})},_deactivateCustoImmersiveUIArrow:function(){this._toggleActivationCustoImmersiveUIArrow(!1)},_toggleActivationCustoImmersiveUIArrow:function(e,t){for(var n=document.getElementsByClassName("VCXScenarioUI_loading"),i=0;i<n.length;++i){var o=n[i],r=o.closest(".forPlayGuidedTourCmd");if(r)if(e){var a=t.ibNextArrow;if(a&&r.hasClassName("VCXRightArrow")||!a&&r.hasClassName("VCXLeftArrow")){o.removeClassName("hide"),r.addClassName("inTransition");break}}else o.addClassName("hide"),r.removeClassName("inTransition")}},_togglePlayPauseUI:function(e){e&&e.currentTarget===this._playPauseButton&&e.stopPropagation(),(this._playPauseButton.classList.contains("playIcon")||this._playPauseButton.classList.contains("pauseIcon"))&&(this._userInteraction=!0,this._publishEvent("togglePlayPause"))},_setPauseWaitingAnimation:function(e){!this._waitingContainer&&this._playPauseButton||(e?(this._waitingContainer&&this._waitingContainer.inject(this._playPauseButton),this._playPauseButton.classList.replace("pauseIcon","pauseInWait")):(this._waitingContainer&&this._waitingContainer.remove(),this._playPauseButton.classList.remove("pauseInWait"),this._playPauseButton.classList.add("playIcon")))},_setImmersiveUICustomization:function(e){var t=document.getElementsByClassName("VCXScenariosUIArrow"),n=0;for(n=0;n<t.length;++n){var i=t[n];e?i.addClassName("forPlayGuidedTourCmd"):i.removeClassName("forPlayGuidedTourCmd")}var o=document.getElementsByClassName("VCXScenariosUIDots_container");for(n=0;n<o.length;++n){var r=o[n];e?r.addClassName("forPlayGuidedTourCmd"):r.removeClassName("forPlayGuidedTourCmd")}},_publishEvent:function(e){this._modelEvent.publish({event:e,data:{eventChannel:e}})}})}),define("DS/VCXWebProducts/VCXCloseExperienceCmd",["DS/ApplicationFrame/Command","DS/VCXWebEWS/VCXExperienceServices"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){},execute:function(){var e=this;this.doClose().then(function(){e.end()}).catch(function(t){console.log(new Error(t)),e.end()})},doClose:async function(){var e=this.getFrameWindow()._experienceBase;e.getManager("VCXGUIManager").getGettingStartedUI();e.getManager("VCXExperience").ClearTimerScenarioUpdate();var n=e.getManager("VCXContextManager"),i=n.getPlayerMode(),o=n.getCat3DXIntegration();if(i||!o){return await t.CloseExperienceAndReset(e)}return t.DisplaySaveBeforeCloseModal(e)},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXRedoCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return n.extend({init:function(t){this._parent(t,{});var n=this;e.Element.addEvent.call(document,"keydown",function(t){"ctrl+y"===e.Event.whichKey(t)&&n.begin()})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,t=function(){e.getManager("VCXCommandManager").Redo()};e.getManager("VCXExperience")._bPreviewMode&&e.getManager("VCXPulseManager")?e.getManager("VCXPulseManager").StopPulse(t):t()},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXSelectSimilarColor",["DS/ApplicationFrame/Command","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebProperties/VCXColor","DS/CoreEvents/Events"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{})},DoSelection:function(){var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt");let o=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map(e=>{if(!e.IsKindOf("VCXComponentOccurrenceExt")||!e.IsMesh())return!1;let t=e.GetCurrentMaterial();if(t)return t;let n=e.QueryInterface("VCXIModifiable"),i=n&&n.GetProperty("Actor.Color");return i&&i.GetPropertyValue().GetValue()}).filter(e=>!!e);i=i.filter(e=>{if(!e.IsMesh())return!1;let t=e.GetCurrentMaterial();if(t&&o.includes(t))return!0;let i=e.QueryInterface("VCXIModifiable"),r=i&&i.GetProperty("Actor.Color"),a=r&&r.GetPropertyValue().GetValue();return a&&o.find(e=>e instanceof n&&e.equals(a))});var r=new t(e.getManager("VCXSelectionManager"));r.SetComponentsSelection(i),e.getManager("VCXCommandManager").Do(r)},beginExecute:function(){this.DoSelection()},execute:function(){},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXUndoCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return n.extend({init:function(t){this._parent(t,{});var n=this;e.Element.addEvent.call(document,"keydown",function(t){"ctrl+z"===e.Event.whichKey(t)&&n.begin()})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,t=function(){e.getManager("VCXCommandManager").Undo()};e.getManager("VCXExperience")._bPreviewMode&&e.getManager("VCXPulseManager")?e.getManager("VCXPulseManager").StopPulse(t):t()},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXSelectSimilarInstance",["DS/ApplicationFrame/Command","DS/VCXWebKernel/VCXCmdChangeSelection","DS/CoreEvents/Events"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},DoSelection:function(){var e=this.getFrameWindow()._experienceBase,n=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt");let i=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map(e=>e._reference).filter(e=>!!e);n=n.filter(e=>i.includes(e._reference));var o=new t(e.getManager("VCXSelectionManager"));o.SetComponentsSelection(n),e.getManager("VCXCommandManager").Do(o)},beginExecute:function(){this.DoSelection()},execute:function(){},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXInvertSelectionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n,i){"use strict";return t.extend({init:function(t){this._parent(t,{});var n=this;e.Element.addEvent.call(document,"keydown",function(t){"ctrl+i"===e.Event.whichKey(t)&&n.begin()})},beginExecute:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase},execute:function(){for(var e=this._experienceBase.getManager("VCXSelectionManager"),t=[],i=this._experienceBase.ComponentsMap.GetComponentsFromFilterMethod(this._isComponentVisibleInTheScene),o=(t=[],0);o<i.length;++o){var r=i[o];e.isIn(r)||t.push(r)}var a=new n(e);a.SetComponentsSelection(t),this._experienceBase.getManager("VCXCommandManager").Do(a)},endExecute:function(){this._experienceBase=null},_isComponentVisibleInTheScene:function(e){var t=e.QueryInterface("VCXIVisibility");if(!t||t.GetVisibility()!==i.EVisState.Visible)return!1;if(e.IsDressup){return!e.IsKindOf(["VCXBOM_Spec","CXPCameraActor_Spec","VCXCompass_Spec","VCXDigger_Spec","VCXComponentGround","VCXViewport_Spec"])}return!(!e.IsKindOf("VCXComponentOccurrenceExt")||!e.IsRenderable())}})}),define("DS/VCXWebProducts/VCXApplyToAmbienceCmd",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/VCXWebKernelCommands/VCXCmdApplyTo"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},execute:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase;var t=this._experienceBase.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID(),i=t&&this._experienceBase.ComponentsMap.GetComponentFromID(t);const o=this._experienceBase.getManager("VCXCommandManager");let r={};let a=[];const s=this._experienceBase.getManager("VCXScenarioManager").GetScenarios();for(let e in s)s.hasOwnProperty(e)&&a.push(s[e]);r.availability=!0,r.scenario=a,r.dressups=[i],r.parts=[],r.propagateCamera=!1,r.propagateViewport=!1;const c=new n(this._experienceBase,r,"all");o.Push(c)}})}),define("DS/VCXWebProducts/VCXMoveRobotOnBBoxCenterCmd",["DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/Robot/Robot"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!0}),this._vcxExperience=null,this.disable()},execute:function(){this._vcxExperience=this.getFrameWindow()._experienceBase,this._displayBBoxCenter()},pauseExecute:function(){},resumeExecute:function(){this.isRunning()||this.end()},endExecute:function(){this._vcxExperience=null},_displayBBoxCenter:function(){var e=this._vcxExperience.getManager("VCXContextManager").getMainViewer(),o=this._vcxExperience.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");if(o.filter(function(e){return e.IsKindOf("VCXWebComponentOccurrence")&&!e.IsDressup}),o.length>0){var r=e.getRobot();if(!(r instanceof i))return console.error("No robot found.."),void this.end();r.connect(),r.fixedSizeNode3D.setRatio(7);var a=n.getBBoxInWorldFromComponents(o).center(),s=(new t.Matrix4).setPosition(a);r.setRobotMatrix(s),e.render()}this.end()}})}),define("DS/VCXWebProducts/VCXPlayGuidedTourModel",["UWA/Class","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdPlayScenario"],function(e,t,n,i){"use strict";return e.extend({init:function(){this._pauseRequested=!1,this.setGuidedTourOccurring(!1),this._listAllScenario=null,this._nbSecsForWaiting=5;var e=this;this.tokenSubscribeEnd=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_END"},function(t){e._listAllScenario=null,e._pauseRequested=!1,e.setGuidedTourOccurring(!1)})},destroy:function(){this._listAllScenario=null,this._pauseRequested=null,this._guidedTourOccurring=null,t.unsubscribe(this.tokenSubscribeEnd)},setSecondsForWaiting:function(e){this._nbSecsForWaiting=e},setPauseRequested:function(e){this._pauseRequested=!0;for(var t=e.getManager("VCXScenarioManager"),n=Object.keys(t._scenariosToPlay).length-1;n>=0;--n){var i=t._scenariosToPlay[n];t.StopPlayingScenario(i)}},getPauseRequested:function(){return this._pauseRequested},setGuidedTourOccurring:function(e){this._guidedTourOccurring=e},getGuidedTourOccurring:function(){return this._guidedTourOccurring},checkScenarioPresence:function(e){var t=e.getManager("VCXSequenceManager");if(!t)return!1;for(var n=t.GetListSequencesFromType(0),i=0;i<n.length;i++){var o=n[i];o.QueryInterface("VCXIModifiable");if(o.GetListScenariosId().length>0)return!0}return!1},getListAllScenarios:function(e){if(!this._listAllScenario){var t=e.getManager("VCXSequenceManager"),n=e.getManager("VCXScenarioManager"),i=t.GetListSequencesFromType(0);n.GetCurrentScenario();this._listAllScenario=[];for(var o=0;o<i.length;o++)for(var r=i[o],a=(r.QueryInterface("VCXIModifiable"),r.GetListScenariosId()),s=0;s<a.length;s++){var c=a[s],u=n.GetScenarios()[c];u&&this._listAllScenario.push(u)}}return this._listAllScenario},getIdxNextScenToPlay:function(e){var t=e.getManager("VCXScenarioManager").GetCurrentScenario();if(""===t)return 0;for(var n=e.getManager("VCXSequenceManager").GetListSequencesFromType(0),i=0,o=0;o<n.length;++o){var r=n[o],a=r.GetListScenariosId().length,s=r.GetIndexOfScenario(t);if(-1!==s){if(o===n.length-1&&s===a-1)return 0;i+=s+1;break}i+=a}return i},runGuidedTour:function(e){var t=this.getIdxNextScenToPlay(e),o=e.getManager("VCXScenarioManager"),r=(e.getManager("VCXSequenceManager"),e.getManager("VCXCommandManager")),a=this.getListAllScenarios(e),s=this,c=function(t){if(s._publishGuidedTourEvent("goToScenario_End",{currentScenarioIdx:0===t?a.length-1:t-1,nextScenarioIdx:t}),t>=a.length||s._pauseRequested)s._publishGuidedTourEvent("end");else{var n=new i(o,e.ComponentsMap,r);n.PlayScenario(a[t]),n.SetCallback(u,t),r.Do(n)}},u=function(t){if(s._pauseRequested)s._publishGuidedTourEvent("end");else{var n=t+1;n>=a.length&&(n=0),s.idxOfScenToPlayFirst=n;var c=e.Factory.BuildComponent("VCXScenario");c.SetPersistency(2),c.SetApplyNeutralAtGoToScenario(!1),c.SetMaxFrame(o.GetFPS()*s._nbSecsForWaiting),c._bWait=!0;var u=new i(o,e.ComponentsMap,r);u.PlayScenario(c),u.SetCallback(l,n),r.Do(u)}},l=function(t){if(s._pauseRequested)s._publishGuidedTourEvent("end");else{s._publishGuidedTourEvent("goToScenario",{currentScenarioIdx:0===t?a.length-1:t-1,nextScenarioIdx:t});var i=c,u=t;if(t>=a.length&&(i=s._publishGuidedTourEvent.bind(s),u="end"),s.customGoToScenario)s.customGoToScenario(a[t],i,u);else{var l=new n(o,e.ComponentsMap,r);l.BuildTransitionTo(a[t]),l.SetCallback(i,u),r.Do(l)}}};this._publishGuidedTourEvent("begin"),this.setGuidedTourOccurring(!0),l(t)},_publishGuidedTourEvent:function(e,n){t.publish({event:"VCX_PLAY_GUIDED_TOUR_"+e.toUpperCase(),data:n})}})}),define("DS/VCXWebProducts/VCXHideDressupsCmd",["DS/VCXWebProducts/VCXHideSelectionCmd"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{})},execute:function(){this._hideAllDressups()},_hideAllDressups:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase;var t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXDressup_Spec");this._hideElementsFromArray(t),this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.hideContextualBar()}})}),define("DS/VCXWebProducts/VCXPlayGuidedTourCmd",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/VCXWebProducts/VCXPlayGuidedTourModel","DS/VCXWebProducts/VCXPlayGuidedTourUI"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.tokenUISubs=null,this.playGuidedTourUI=null,this.playGuidedTourModel=new n},destroy:function(){this.isRunning()&&this.end(),this.playGuidedTourModel&&(this.playGuidedTourModel.destroy(),this.playGuidedTourModel=null),this.playGuidedTourUI&&(this.playGuidedTourUI.destroy(),this.playGuidedTourUI=null),this._parent()},beginExecute:function(){var e=this.getFrameWindow();if(this._experienceBase=e._experienceBase,!this.playGuidedTourModel.checkScenarioPresence(this._experienceBase))return console.log("No scenario available to create a tour... Ending command PlayGuidedTour."),this._experienceBase=null,void this.end();this.playGuidedTourUI=new i(this.getFrameWindow()),this.playGuidedTourUI&&(this.playGuidedTourUI.setplayGuidedTourUI(e),this.tokenUISubs=[this.playGuidedTourUI.subscribe("togglePlayPause",this._togglePlayPause.bind(this)),this.playGuidedTourUI.subscribe("terminate",this.end.bind(this))])},execute:function(){},endExecute:function(){if(this.playGuidedTourUI&&(this.playGuidedTourUI.terminateUI(),this.tokenUISubs))for(var e=0;e<this.tokenUISubs.length;++e)this.playGuidedTourUI.unsubscribe(this.tokenUISubs[e]);this.playGuidedTourModel.getGuidedTourOccurring()&&this.playGuidedTourModel.setPauseRequested(this._experienceBase),this.playGuidedTourModel._publishGuidedTourEvent("end"),this.playGuidedTourUI=null,this._experienceBase=null},_togglePlayPause:function(){this.playGuidedTourModel.getGuidedTourOccurring()?this.pause():this.play()},pause:function(){this.playGuidedTourUI.displayUI(),this.playGuidedTourModel.setPauseRequested(this._experienceBase)},play:function(){this.playGuidedTourUI.hideUI(),this.playGuidedTourModel.runGuidedTour(this._experienceBase)},executeGuidedTourODT:function(){if("replay"===this._experienceBase.odt){var e=this;return[function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),setTimeout(function(){t(!0)},2e3)},function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),t(!0)},function(e,t){setTimeout(function(){e(!0)},6e3)},function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),setTimeout(function(){t(!0)},2e3)}]}}})});