define("DS/DMUPersistence/DMUMarkupContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];return e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&("DMUMarkup"===e.getType()?t.push(e.getType()):e.isReadOnly()||t.push(e.getType()))}),1===t.length&&"DMUMarkup"===t[0]?this.getContextualMenuCommandList(e):[]},getContextualMenuCommandList:function(){return this.getMarkupOwner()&&!this.getMarkupOwner().isReadOnly()||!this.getMarkupOwner()&&!this.isReadOnly()?[{line:1,name:"DMUReviewMarkupStr",hdr_list:["DMUReviewMarkupHdr"]},{line:1,name:"DMURenameMarkupStr",hdr_list:["DMURenameMarkupHdr"]},{line:1,name:"DMUEditPropertiesStr",hdr_list:["DMUEditPropertiesHdr"]},{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]:[{line:1,name:"DMUEditPropertiesStr",hdr_list:["DMUEditPropertiesHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:"DMUMarkup",module:"DMUPersistence",workbenchName:"DMUPersistenceCtxCmds"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:"DMUMarkup",module:"DMUPersistence",workbenchName:"DMUPersistenceCtxCmds"}})}})}),define("DS/DMUPersistence/DMURenameMarkupCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUBaseUIControllers/DMUReviewController","DS/Selection/CSOManager"],function(e,t,o,r,i,n){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var a=this;this.beginExecute=function(){var e=n.get(),s=t.getReviewContext({viewer:a.getFrameWindow().getViewer()});if(s){if(1===e.length&&e[0].pathElement.getLastElement(!0).getDMUType&&"DMUMarkup"===e[0].pathElement.getLastElement(!0).getDMUType()){let t,n=s.getValidation();if(n&&n.getMarkups().some(o=>{let r=o.getRepRef();if(r.getMarkupContent()&&r.getMarkupContent().getNode()===e[0].pathElement.getLastElement(!0))return t=r,!0}),t){var l=o.giveDMUSlidesController({context:a.getFrameWindow()});l&&l.editMarkupName(t);const e=i.giveDMUReviewController({context:a.getFrameWindow()});e&&e.editMarkupName(t);let n=r.giveDMUCommentsController({context:a.getFrameWindow()});n&&n.editMarkupName(t)}}a.end()}else a.end()}}})}),define("DS/DMUPersistence/DMUAuthPersistenceUtils",["UWA/Utils","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet"],function(e,t,o,r,i){"use strict";return{getTransientMarkersAndOverloads:async function(e,i,n){var a={overloads:[],markers:[]};if(!i||!n)return a;let s=r.giveEventsController({viewer:i.getViewer()});s&&s.fireEvent("onBeginDMUObjectDuplication");var l=o.getDMUSceneDisplayController({context:i});if((!e||e&&!e.getCurrentSessionMarkup()||e&&e.getCurrentSessionMarkup()&&!e.getCurrentSessionMarkup().isVisible())&&(a.overloads=l.getDisplayedAndHiddenOccurrences(n)),e){var d=e.getTransientReviewBag(),c=d.getDMUObjects("DMUCompare3D");if(c.length||(c=d.getDMUObjects("DMUCompare2D")),c.length>=1){let t=(c=c[0]).getParent().getAttribute("oLinksManager"),o=c.getAttribute("oSelections"),r=[],a=l.getCurrentCompareBalance();if(t&&o){for(let e=0;e<o.length;e++){let n=t.getChildWithID(o[e].id);if(n){let e=n.idPath&&n.idPath.length?n.idPath:t.getOccurrenceIdPath(n.path);if(e&&e.length){let t=i.getController().isFiltered(e[0]);r.push(t&&t.hasFilter&&t.filterId?t.filterId:e[0])}}}let s=e.getReviewCtxInformation()?e.getReviewCtxInformation().contextId:null;i.getApplicativeData()&&i.getApplicativeData().getLoadedItfData&&i.getApplicativeData().getLoadedItfData()&&i.getApplicativeData().getLoadedItfData().data&&i.getApplicativeData().getLoadedItfData().data.length&&(s=i.getApplicativeData().getLoadedItfData().data[0].prd[0]?i.getApplicativeData().getLoadedItfData().data[0].prd[0]:s),-1===r.indexOf(n)&&-1===r.indexOf(s)?d.removeDMUObjects("DMUCompare3D"):r[1]===n&&(c.setAttribute("oSelections",[o[1],o[0]]),a=100-a)}c.setAttribute("fBalance",a),c.setAttribute("bLocalAxis",l.getCurrentLocalAxisValue())}var p=d.getDMUObjects();if(p)for(var g=0;g<p.length;g++)if(p[g]){let e=await t.getObjectDefinition(p[g]);a.markers.push(e)}}return o.unreferenceDMUSceneDisplayController({context:i}),a},copyTransientMarkersAndOverloads:async function(t,n,a,s,l){if(!t||!n||!a)return;if(s.length){var d=i.getManager({name:"DMUUserExperienceManager",context:a.getFrameWindow()});d&&await d.duplicateDMUElements({elementDefinitions:s,parent:n,cb:function(o){if(o&&o.duplicatedElements)for(var r=0;r<o.duplicatedElements.length;r++)o.duplicatedElements[r].setAttributes([{name:"sID",value:t.computeNewID()},{name:"sUuid",value:e.getUUID()}])}})}var c=o.giveDMUSceneDisplayController({context:a});if(l&&c){var p,g,u=[],h=function(e,o){(p=t.getOrCreateOccurrenceOverloader(e,!0))&&(u.push({target:p,state:{bVisible:o}}),n.addObjectOverload({target:p,state:{bVisible:o}}))};l.hidden&&(l.hidden.paths.forEach(function(e){h({pathElement:e},!1)}),l.hidden.idPaths.forEach(function(e){(g=e.slice())[0]===a.getController().getRootBagId()&&g.splice(0,1),h({idPath:g},!1)})),l.shown&&(l.shown.paths.forEach(function(e){h({pathElement:e},!0)}),l.shown.idPaths.forEach(function(e){(g=e.slice())[0]===a.getController().getRootBagId()&&g.splice(0,1),h({idPath:g},!0)})),u.length&&n.fireEvent("onDMUOverloadPropertiesChanged",{overloads:u})}let D=r.giveEventsController({viewer:a.getViewer()});D&&D.fireEvent("onDMUObjectDuplicated")}}}),define("DS/DMUPersistence/DMUExportServices",["require","exports","UWA/Core","DS/Controls/ProgressBar","DS/Controls/Button","DS/DMUBaseExperience/EXPToolsVisualization","i18n!DS/DMUPersistence/assets/nls/DMUPersistence"],function(e,t,o,r,i,n,a){"use strict";const s={DMUMarker3DRectangle:"Square",DMUMarker3DCircle:"Circle",DMUMarker3DText:"FreeText",DMUMarker3DEllipse:"Circle",DMUMarker3DLine:"Line",DMUMarker3DSpline:"Ink",DMUMarker3DFreehand:"Ink",DMUMarker3DCloud:"Polygon",DMUMarker3DArrow:"Line",DMUCommentHighlight:"Highlight",DMUCommentPositioned:"Text",DMUMarker3DPicture:"FileAttachment"};let l;const d=function(e){const t=`<p>${window.require("DS/DMUBaseUIComponents/DMURichTextServices").formatRichTextToExportToPDF(e)}</p>`;let o=document.createElement("div");o.innerHTML=t;const r=o.innerText;return{richContent:`<?xml version="1.0"?><body xmlns="http://www.w3.org/1999/xhtml" xmlns:xfa="http://www.xfa.org/schema/xfa-data/1.0/" xfa:APIVersion="3DExperience:24.1" xfa:spec="2.4" xfa:contentType="text/html">${o.innerHTML}</body>`,flatContent:r}};let c=function(e,t,o){var r,i;let n;if(o){let a={x:0,y:0},s={x:0,y:0},d=Math.atan2(o.y-e.leaderPosition[1],o.x-e.leaderPosition[0]),c=8;a.x=e.leaderPosition[0]+c*Math.cos(d-Math.PI/6),a.y=e.leaderPosition[1]+c*Math.sin(d-Math.PI/6),s.x=e.leaderPosition[0]+c*Math.cos(d+Math.PI/6),s.y=e.leaderPosition[1]+c*Math.sin(d+Math.PI/6);let p=e.leaderEndType,g=e.hasLeader;if("OpenArrow"===p&&l&&g)n=[l.setGraphicsState("GS0"),l.setFillingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setStrokingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setLineWidth(t.border?t.border.thickness:1),l.setDashPattern(t.border&&t.border.pattern?t.border.pattern:[],0),l.moveTo(e.leaderPosition[0],e.leaderPosition[1]),l.lineTo(a.x,a.y),l.lineTo(s.x,s.y),l.lineTo(e.leaderPosition[0],e.leaderPosition[1]),l.closePath(),l.fill()].filter(Boolean);else if("Square"===p&&l&&g){let o=(null===(r=t.border)||void 0===r?void 0:r.thickness)?t.border.thickness+5:5;n=l.drawRectangle({x:e.leaderPosition[0]-o/2,y:e.leaderPosition[1]-o/2,width:o,height:o,borderWidth:0,borderColor:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,rotate:l.radians(0),xSkew:l.radians(0),ySkew:l.radians(0),color:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,graphicsState:"GS0"})}else if("Bubble"===p&&l&&g){let o=(null===(i=t.border)||void 0===i?void 0:i.thickness)?t.border.thickness:2.5;(n=l.drawEllipse({x:e.leaderPosition[0],y:e.leaderPosition[1],xScale:o,yScale:o,borderColor:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,borderWidth:0,color:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,graphicsState:"GS0"})).splice(n.length-2,0,l.closePath())}else"Cross"===p&&l&&g?(n=[l.setGraphicsState("GS0"),l.setFillingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setStrokingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setLineWidth(1),l.setDashPattern([],0),l.moveTo(e.leaderPosition[0]-5,e.leaderPosition[1]-5),l.lineTo(e.leaderPosition[0]+5,e.leaderPosition[1]+5),l.moveTo(e.leaderPosition[0]-5,e.leaderPosition[1]+5),l.lineTo(e.leaderPosition[0]+5,e.leaderPosition[1]-5),l.stroke()].filter(Boolean)).splice(n.length-2,0,l.closePath()):n=[]}else n=[];return n};class p{static prepareAnnotationDefinition(e,t,o){let r=n.getMMPerPtRatio();o.border&&(o.border={...o.border,thickness:o.border.thickness*r,pattern:o.border.pattern?o.border.pattern.map(e=>e*r):void 0});let i=0,a=0;const s=e.getRotation();s&&s.angle&&(a="degrees"===s.type?s.angle*Math.PI/180:s.angle);const l=e.getHeight()*(Math.cos(a)-Math.sin(a)+1)/2,d=e.getWidth()*(1-Math.cos(a)-Math.sin(a))/2;switch("position"in t&&(t.position={x:(t.position.x*Math.cos(a)-t.position.y*Math.sin(a))*r+d,y:(t.position.x*Math.sin(a)+t.position.y*Math.cos(a))*r+l}),"rotationAngle"in t&&(t.rotationAngle=(t.rotationAngle||0)+a),t.type){case"DMUMarker3DRectangle":t.width=t.width*r,t.height=t.height*r;break;case"DMUMarker3DText":t.fontSize=t.fontSize*r,t.width=t.width*r,t.height=t.height*r,t.offwidth=t.offwidth*r,t.offheight=t.offheight*r,i=t.leaderPosition[0],t.leaderPosition[0]=(t.leaderPosition[0]*Math.cos(a)-t.leaderPosition[1]*Math.sin(a))*r+d,t.leaderPosition[1]=(i*Math.sin(a)+t.leaderPosition[1]*Math.cos(a))*r+l,i=t.leaderPosition[2],t.leaderPosition[2]=(t.leaderPosition[2]*Math.cos(a)-t.leaderPosition[3]*Math.sin(a))*r+d,t.leaderPosition[3]=(i*Math.sin(a)+t.leaderPosition[3]*Math.cos(a))*r+l,i=t.leaderPosition[4],t.leaderPosition[4]=(t.leaderPosition[4]*Math.cos(a)-t.leaderPosition[5]*Math.sin(a))*r+d,t.leaderPosition[5]=(i*Math.sin(a)+t.leaderPosition[5]*Math.cos(a))*r+l,i=t.leaderPosition[6],t.leaderPosition[6]=(t.leaderPosition[6]*Math.cos(a)-t.leaderPosition[7]*Math.sin(a))*r+d,t.leaderPosition[7]=(i*Math.sin(a)+t.leaderPosition[7]*Math.cos(a))*r+l;break;case"DMUMarker3DPicture":t.width=t.width*r,t.height=t.height*r,t.offwidth=t.offwidth*r,t.offheight=t.offheight*r,i=t.leaderPosition[0],t.leaderPosition[0]=(t.leaderPosition[0]*Math.cos(a)-t.leaderPosition[1]*Math.sin(a))*r+d,t.leaderPosition[1]=(i*Math.sin(a)+t.leaderPosition[1]*Math.cos(a))*r+l,i=t.leaderPosition[2],t.leaderPosition[2]=(t.leaderPosition[2]*Math.cos(a)-t.leaderPosition[3]*Math.sin(a))*r+d,t.leaderPosition[3]=(i*Math.sin(a)+t.leaderPosition[3]*Math.cos(a))*r+l,i=t.leaderPosition[4],t.leaderPosition[4]=(t.leaderPosition[4]*Math.cos(a)-t.leaderPosition[5]*Math.sin(a))*r+d,t.leaderPosition[5]=(i*Math.sin(a)+t.leaderPosition[5]*Math.cos(a))*r+l;break;case"DMUMarker3DCircle":t.radius=t.radius*r;break;case"DMUMarker3DEllipse":t.xLength=t.xLength*r,t.yLength=t.yLength*r;break;case"DMUCommentHighlight":t.selection=t.selection.map(e=>({width:e.width*r,height:e.height*r,rotationAngle:(e.rotationAngle||0)-a,position:{x:(e.position.x*Math.cos(a)-e.position.y*Math.sin(a))*r+d,y:(e.position.x*Math.sin(a)+e.position.y*Math.cos(a))*r+l}}));break;case"DMUMarker3DArrow":t.pointing={x:(t.pointing.x*Math.cos(a)-t.pointing.y*Math.sin(a))*r+d,y:(t.pointing.x*Math.sin(a)+t.pointing.y*Math.cos(a))*r+l},t.ending={x:(t.ending.x*Math.cos(a)-t.ending.y*Math.sin(a))*r+d,y:(t.ending.x*Math.sin(a)+t.ending.y*Math.cos(a))*r+l},t.points=t.points.map(e=>({x:(e.x*Math.cos(a)-e.y*Math.sin(a))*r+d,y:(e.x*Math.sin(a)+e.y*Math.cos(a))*r+l}));break;case"DMUCommentPositioned":t.radius=t.radius*r,t.width=t.width*r,t.height=t.height*r;break;case"DMUMarker3DLine":t.points={start:{x:(t.points.start.x*Math.cos(a)-t.points.start.y*Math.sin(a))*r+d,y:(t.points.start.x*Math.sin(a)+t.points.start.y*Math.cos(a))*r+l},end:{x:(t.points.end.x*Math.cos(a)-t.points.end.y*Math.sin(a))*r+d,y:(t.points.end.x*Math.sin(a)+t.points.end.y*Math.cos(a))*r+l}};break;case"DMUMarker3DSpline":case"DMUMarker3DFreehand":t.rect.width=t.rect.width*r,t.rect.height=t.rect.height*r,t.points=t.points.map(e=>({x:(e.x*Math.cos(a)-e.y*Math.sin(a))*r+d,y:(e.x*Math.sin(a)+e.y*Math.cos(a))*r+l}));break;case"DMUMarker3DCloud":t.rect.width=t.rect.width*r,t.rect.height=t.rect.height*r,t.points=t.points.map(e=>({x:(e.x*Math.cos(a)-e.y*Math.sin(a))*r+d,y:(e.x*Math.sin(a)+e.y*Math.cos(a))*r+l})),t.arcPoints=t.arcPoints.map(e=>({x:(e.x*Math.cos(a)-e.y*Math.sin(a))*r+d,y:(e.x*Math.sin(a)+e.y*Math.cos(a))*r+l}))}}static getAnnotationAppearance(e,t,{rect:o,definition:r,material:i}){var a;if(!l)return;let s;if("DMUMarker3DRectangle"===r.type)s=[l.setGraphicsState("GS0"),i.fill&&l.setFillingColor(l.rgb(i.fill.color.r,i.fill.color.g,i.fill.color.b)),i.border&&l.setStrokingColor(l.rgb(i.border.color.r,i.border.color.g,i.border.color.b)),l.setLineWidth(i.border?i.border.thickness:0),l.setDashPattern(i.border&&i.border.pattern?i.border.pattern:[],0),l.translate(r.position.x,r.position.y),l.rotateRadians(r.rotationAngle||0),l.moveTo(-r.width/2,-r.height/2),l.lineTo(-r.width/2,r.height/2),l.lineTo(r.width/2,r.height/2),l.lineTo(r.width/2,-r.height/2),l.closePath(),i.fill&&i.border?l.fillAndStroke():i.fill?l.fill():l.stroke()].filter(Boolean);else if("DMUMarker3DPicture"===r.type){const e=t.getRotation();let o=0;e&&e.angle&&(o="degrees"===e.type?e.angle*-Math.PI/180:-e.angle),r.leaderPosition[6]>r.leaderPosition[7]&&(o+=Math.PI);let n={x:0,y:0},a={x:0,y:0},d=.75*r.width,c=.625*r.width/2*.5,p=d/2*.5,g=Math.atan2(r.leaderPosition[3]-r.leaderPosition[1],r.leaderPosition[2]-r.leaderPosition[0]),u=8;n.x=r.leaderPosition[0]+u*Math.cos(g-Math.PI/6),n.y=r.leaderPosition[1]+u*Math.sin(g-Math.PI/6),a.x=r.leaderPosition[0]+u*Math.cos(g+Math.PI/6),a.y=r.leaderPosition[1]+u*Math.sin(g+Math.PI/6);let h=Number(r.linethickness);s=[...[l.setGraphicsState("GS0"),l.setFillingRgbColor(.21176470588235294,.5568627450980392,.7686274509803922),l.setStrokingRgbColor(r.borderColor.r,r.borderColor.g,r.borderColor.b),l.setLineWidth(h),l.setDashPattern(i.border&&i.border.pattern?i.border.pattern:[],0),l.rotateRadians(0),l.moveTo(r.leaderPosition[0],r.leaderPosition[1]),l.lineTo(n.x,n.y),l.moveTo(n.x,n.y),l.lineTo(a.x,a.y),l.moveTo(a.x,a.y),l.lineTo(r.leaderPosition[0],r.leaderPosition[1]),l.moveTo(r.leaderPosition[0],r.leaderPosition[1]),l.lineTo(r.leaderPosition[2],r.leaderPosition[3]),l.moveTo(r.leaderPosition[2],r.leaderPosition[3]),l.lineTo(r.leaderPosition[4],r.leaderPosition[5]),l.stroke()],...[l.setGraphicsState("GS0"),l.setFillingRgbColor(.21176470588235294,.5568627450980392,.7686274509803922),l.setStrokingRgbColor(r.borderColor.r,r.borderColor.g,r.borderColor.b),l.setLineWidth(h),l.setDashPattern(i.border&&i.border.pattern?i.border.pattern:[],0),l.translate(r.leaderPosition[4],r.leaderPosition[5]),l.rotateRadians(-o||0),l.moveTo(-p/2,0),l.lineTo(-p/4,0+c/2),l.lineTo(p/2,0+c/2),l.lineTo(p/2,0-c/2),l.lineTo(-p/4,0-c/2),l.lineTo(-p/2,0),l.fillAndStroke(),l.setLineWidth(0),l.setStrokingRgbColor(0,0,0),l.moveTo(-p/6,0+c/4),l.lineTo(p/2*.75,0+c/4),l.moveTo(-p/6,0),l.lineTo(p/2*.75,0),l.moveTo(-p/6,0-c/4),l.lineTo(p/2*.75,0-c/4),l.stroke()]].filter(Boolean)}else if("DMUMarker3DCircle"===r.type){let e=r.radius;(s=l.drawEllipse({x:r.position.x,y:r.position.y,xScale:e,yScale:e,borderDashArray:i.border&&i.border.pattern?i.border.pattern:void 0,borderColor:i.border?l.rgb(i.border.color.r,i.border.color.g,i.border.color.b):void 0,borderWidth:i.border?i.border.thickness:0,color:i.fill?l.rgb(i.fill.color.r,i.fill.color.g,i.fill.color.b):void 0,graphicsState:"GS0"})).splice(s.length-2,0,l.closePath())}else if("DMUMarker3DEllipse"===r.type)(s=l.drawEllipse({x:r.position.x,y:r.position.y,xScale:r.xLength/2,yScale:r.yLength/2,borderDashArray:i.border&&i.border.pattern?i.border.pattern:void 0,rotate:l.radians(r.rotationAngle||0),borderColor:i.border?l.rgb(i.border.color.r,i.border.color.g,i.border.color.b):void 0,borderWidth:i.border?i.border.thickness:0,color:i.fill?l.rgb(i.fill.color.r,i.fill.color.g,i.fill.color.b):void 0,graphicsState:"GS0"})).splice(s.length-2,0,l.closePath());else if("DMUMarker3DLine"===r.type)s=l.drawLine({start:{x:r.points.start.x,y:r.points.start.y},end:{x:r.points.end.x,y:r.points.end.y},dashArray:i.border&&i.border.pattern?i.border.pattern:void 0,color:i.border?l.rgb(i.border.color.r,i.border.color.g,i.border.color.b):void 0,thickness:i.border?i.border.thickness:0,graphicsState:"GS0"});else if("DMUMarker3DText"===r.type){let e=[];for(let t=0;t<r.textContent.length;t++)e.push(l.PDFString.of(r.textContent[t]));let t,o,n=r.offwidth,a=r.offheight,d=Math.max(r.lineThickness/2,r.fontSize/3);if("rotationAngle"in r&&r.rotationAngle){let e,i,s={x:n/2,y:a/2},l={x:n/2-d,y:-a/2+d+r.fontSize};e={x:s.x*Math.cos(r.rotationAngle)-s.y*Math.sin(r.rotationAngle),y:s.x*Math.sin(r.rotationAngle)+s.y*Math.cos(r.rotationAngle)},o={x:-(i={x:l.x*Math.cos(r.rotationAngle)-l.y*Math.sin(r.rotationAngle),y:l.x*Math.sin(r.rotationAngle)+l.y*Math.cos(r.rotationAngle)}).x+r.position.x,y:-i.y+r.position.y},t={x:-e.x+r.position.x,y:-e.y+r.position.y}}else o={x:r.leaderPosition[2]-n/2+d,y:r.leaderPosition[3]+a/2-d-r.fontSize},t={x:r.leaderPosition[2]-n/2,y:r.leaderPosition[3]-a/2};let p=l.drawLinesOfText(e,{x:o.x,y:o.y,font:l.StandardFonts.Helvetica,lineHeight:1.2*r.fontSize,size:.97*r.fontSize,rotate:l.radians(r.rotationAngle||0),xSkew:l.radians(0),ySkew:l.radians(0),color:l.rgb(r.fontColor.r,r.fontColor.g,r.fontColor.b),graphicsState:"GS0"}),g=l.drawRectangle({x:t.x,y:t.y,width:n,height:a,borderWidth:r.hasBorder?r.lineThickness:0,borderColor:i.border&&r.hasBorder?l.rgb(i.border.color.r,i.border.color.g,i.border.color.b):void 0,rotate:l.radians(r.rotationAngle||0),borderDashArray:i.border&&r.hasBorder&&i.border.pattern?i.border.pattern:[],borderDashPhase:i.border&&r.hasBorder?Number(r.lineType):void 0,xSkew:l.radians(0),ySkew:l.radians(0),color:i.fill?l.rgb(i.fill.color.r,i.fill.color.g,i.fill.color.b):void 0,graphicsState:"GS0"}),u={x:r.leaderPosition[4],y:r.leaderPosition[5]},h={x:r.leaderPosition[6],y:r.leaderPosition[7]},D=c(r,i,u),M=[];u&&h&&(M=[l.setGraphicsState("GS0"),l.setStrokingRgbColor(r.borderColor.r,r.borderColor.g,r.borderColor.b),l.setLineWidth(r.lineThickness),l.setDashPattern(i.border&&i.border.pattern?i.border.pattern:[],0),l.moveTo(r.leaderPosition[0],r.leaderPosition[1]),l.lineTo(u?u.x:r.leaderPosition[2],u?u.y:r.leaderPosition[3]),l.moveTo(u?u.x:r.leaderPosition[2],u?u.y:r.leaderPosition[3]),l.lineTo(h?h.x:r.leaderPosition[2],h?h.y:r.leaderPosition[3]),l.stroke()]),s=[...D,...M,...g,...p].filter(Boolean)}else if("DMUMarker3DSpline"===r.type){let e={x:0,y:0};s=[l.setGraphicsState("GS0"),i.border&&l.setStrokingColor(l.rgb(i.border.color.r,i.border.color.g,i.border.color.b)),l.setLineWidth(i.border?i.border.thickness:0),l.setDashPattern(i.border&&i.border.pattern?i.border.pattern:[],0),...r.points.map((t,o,r)=>{if(!l)return;if(0===o)return l.moveTo(t.x,t.y);let i=e.x,n=e.y,a=r[o+1],s=r[o-1];if(a){let t={x:a.x-s.x,y:a.y-s.y};e={x:t.x/6,y:t.y/6}}else{let o={x:t.x-s.x,y:t.y-s.y};e={x:o.x/3,y:o.y/3}}return l.appendBezierCurve(s.x+i,s.y+n,t.x-e.x,t.y-e.y,t.x,t.y)}),l.stroke()].filter(Boolean)}else if("DMUMarker3DArrow"===r.type)s=[l.setGraphicsState("GS0"),i.fill&&l.setFillingRgbColor(i.fill.color.r,i.fill.color.g,i.fill.color.b),i.border&&l.setStrokingRgbColor(i.border.color.r,i.border.color.g,i.border.color.b),l.setLineWidth(i.border?i.border.thickness:0),l.setDashPattern(i.border&&i.border.pattern?i.border.pattern:[],0),...r.points.map((e,t)=>{if(l)return 0===t?l.moveTo(e.x,e.y):l.lineTo(e.x,e.y)}),l.closePath(),i.fill&&i.border?l.fillAndStroke():i.fill?l.fill():l.stroke()].filter(Boolean);else if("DMUCommentPositioned"===r.type){const e=t.getRotation();let o=0;e&&e.angle&&(o="degrees"===e.type?e.angle*Math.PI/180:e.angle);let n=r.radius,a=.75*r.width,d=.625*r.width,c=.5519150244935106*n,p=d/2,g=a/2;s=[l.setGraphicsState("GS0"),i.fill&&l.setFillingRgbColor(i.fill.color.r,i.fill.color.g,i.fill.color.b),i.border&&l.setStrokingRgbColor(i.border.color.r,i.border.color.g,i.border.color.b),l.setLineWidth(i.border?i.border.thickness:0),l.translate(r.position.x,r.position.y),l.rotateRadians(o),l.moveTo(-g,-p+n),l.lineTo(-g,p-n),l.appendBezierCurve(-g,p-n+c,-g+n-c,p,-g+n,p),l.lineTo(g-n,p),l.appendBezierCurve(g-n+c,p,g,p-n+c,g,p-n),l.lineTo(g,-p+n),l.appendBezierCurve(g,-p+n-c,g-n+c,-p,g-n,-p),l.lineTo(.45*a-g,-p),l.lineTo(.1*a-g,-p-.3*d),l.lineTo(-g+n,-p),l.appendBezierCurve(-g+n-c,-p,-g,-p+n-c,-g,-p+n),l.closePath(),i.border?l.fillAndStroke():l.fill(),i.border&&l.moveTo(.2*a-g,.7*d-p),i.border&&l.lineTo(.8*a-g,.7*d-p),i.border&&l.stroke(),i.border&&l.moveTo(.2*a-g,.4*d-p),i.border&&l.lineTo(.65*a-g,.4*d-p),i.border&&l.stroke()].filter(Boolean)}else if("DMUMarker3DCloud"===r.type)s=[l.setGraphicsState("GS0"),i.border&&l.setStrokingColor(l.rgb(i.border.color.r,i.border.color.g,i.border.color.b)),i.fill&&l.setFillingColor(l.rgb(i.fill.color.r,i.fill.color.g,i.fill.color.b)),l.setLineWidth(i.border?i.border.thickness:0),...r.arcPoints.map((e,t,o)=>{let r=t%15;if(l){if(0===t)return l.moveTo(e.x,e.y);if(0===r&&void 0===i.fill&&0===t)return l.moveTo(e.x,e.y);if(0===r&&void 0===i.fill){let e=o[t-3];return l.moveTo(e.x,e.y)}return t+1===o.length?l.lineTo(o[0].x,o[0].y):l.lineTo(e.x,e.y)}}),i.fill&&i.border?l.fillAndStroke():i.fill?l.fill():l.stroke()].filter(Boolean);else if("DMUMarker3DFreehand"===r.type&&0===r.rect.width&&0===r.rect.height){let e=n.getMMPerPtRatio(),t=.5;i.border&&i.border.thickness/e==9&&(t=.5);let a=o[2]-o[0];(s=l.drawEllipse({x:r.position.x,y:r.position.y,xScale:a*t,yScale:a*t,borderDashArray:void 0,borderColor:void 0,borderWidth:0,color:i.border?l.rgb(i.border.color.r,i.border.color.g,i.border.color.b):void 0,graphicsState:"GS0"})).splice(s.length-2,0,l.closePath())}if(s&&s.length){let t=e.context.formXObject(s,{BBox:o,Matrix:[1,0,0,1,-o[0],-o[1]],Resources:e.context.obj({ExtGState:e.context.obj({GS0:e.context.obj({Type:"ExtGState",ca:i.fill?i.fill.opacity:"DMUMarker3DFreehand"===r.type&&0===r.rect.width&&0===r.rect.height?null===(a=i.border)||void 0===a?void 0:a.opacity:1,CA:i.border?i.border.opacity:1})})})}),n=e.context.register(t);return e.context.obj({N:n})}}static getAnnotationRect(e,t){let o={x:0,y:0},r={x:0,y:0};if("rotationAngle"in e&&e.rotationAngle){let t="DMUMarker3DRectangle"===e.type?e.width:"DMUMarker3DEllipse"===e.type?e.xLength:"DMUMarker3DText"===e.type?e.offwidth:e.rect.width,i="DMUMarker3DRectangle"===e.type?e.height:"DMUMarker3DEllipse"===e.type?e.yLength:"DMUMarker3DText"===e.type?e.offheight:e.rect.height,n={x:t/2,y:i/2},a={x:-t/2,y:i/2},s={x:n.x*Math.cos(e.rotationAngle)-n.y*Math.sin(e.rotationAngle),y:n.x*Math.sin(e.rotationAngle)+n.y*Math.cos(e.rotationAngle)},l={x:a.x*Math.cos(e.rotationAngle)-a.y*Math.sin(e.rotationAngle),y:a.x*Math.sin(e.rotationAngle)+a.y*Math.cos(e.rotationAngle)},d={x:-s.x,y:-s.y},c={x:s.x,y:s.y},p={x:l.x,y:l.y},g={x:-l.x,y:-l.y};if(o.x=Math.min(d.x,g.x,c.x,p.x)+e.position.x,o.y=Math.min(d.y,g.y,c.y,p.y)+e.position.y,r.x=Math.max(d.x,g.x,c.x,p.x)+e.position.x,r.y=Math.max(d.y,g.y,c.y,p.y)+e.position.y,"DMUMarker3DText"===e.type&&e.hasLeader){let t={x:e.leaderPosition[0],y:e.leaderPosition[1]};o.x=Math.min(o.x,t.x)-5,o.y=Math.min(o.y,t.y)-5,r.x=Math.max(r.x,t.x)+5,r.y=Math.max(r.y,t.y)+5}else if("DMUMarker3DCloud"===e.type){const t=15;o.x=Math.min(d.x,g.x,c.x,p.x)+e.position.x-t,o.y=Math.min(d.y,g.y,c.y,p.y)+e.position.y-t,r.x=Math.max(d.x,g.x,c.x,p.x)+e.position.x+t,r.y=Math.max(d.y,g.y,c.y,p.y)+e.position.y+t}}else if("DMUMarker3DRectangle"===e.type||"DMUCommentPositioned"===e.type||"DMUMarker3DCircle"===e.type||"DMUMarker3DEllipse"===e.type||"DMUMarker3DSpline"===e.type||"DMUMarker3DFreehand"===e.type||"DMUMarker3DCloud"===e.type){let t="DMUMarker3DRectangle"===e.type||"DMUCommentPositioned"===e.type?e.width:"DMUMarker3DCircle"===e.type?2*e.radius:"DMUMarker3DEllipse"===e.type?e.xLength:e.rect.width,i="DMUMarker3DRectangle"===e.type||"DMUCommentPositioned"===e.type?e.height:"DMUMarker3DCircle"===e.type?2*e.radius:"DMUMarker3DEllipse"===e.type?e.yLength:e.rect.height;if(o.x=e.position.x-t/2,o.y=e.position.y-i/2,r.x=e.position.x+t/2,r.y=e.position.y+i/2,"DMUMarker3DCloud"===e.type){const n=15;o.x=e.position.x-t/2-n,o.y=e.position.y-i/2-n,r.x=e.position.x+t/2+n,r.y=e.position.y+i/2+n}}else"DMUMarker3DLine"===e.type?(o.x=Math.min(e.points.start.x,e.points.end.x),o.y=Math.min(e.points.start.y,e.points.end.y),r.x=Math.max(e.points.start.x,e.points.end.x),r.y=Math.max(e.points.start.y,e.points.end.y)):"DMUMarker3DArrow"===e.type?(o.x=1/0,o.y=1/0,r.x=-1/0,r.y=-1/0,e.points.forEach(e=>{o.x=Math.min(o.x,e.x),o.y=Math.min(o.y,e.y),r.x=Math.max(r.x,e.x),r.y=Math.max(r.y,e.y)})):"DMUCommentHighlight"===e.type?(o.x=1/0,o.y=1/0,r.x=-1/0,r.y=-1/0,e.selection.forEach(e=>{o.x=Math.min(o.x,e.position.x),o.y=Math.min(o.y,e.position.y-e.height),r.x=Math.max(r.x,e.position.x+e.width),r.y=Math.max(r.y,e.position.y)})):"DMUMarker3DText"===e.type?e.hasLeader?(o.x=Math.min(e.leaderPosition[0],e.leaderPosition[2]-e.offwidth/2,e.leaderPosition[2]+e.offwidth/2)-5,o.y=Math.min(e.leaderPosition[3]-e.offheight/2,e.leaderPosition[1],e.leaderPosition[3]+e.offheight/2)-5,r.x=Math.max(e.leaderPosition[2]+e.offwidth/2,e.leaderPosition[0],e.leaderPosition[2]-e.offwidth/2)+5,r.y=Math.max(e.leaderPosition[3]+e.offheight/2,e.leaderPosition[1],e.leaderPosition[3]-e.offheight/2)+5):(o.x=e.leaderPosition[2]-e.offwidth/2,o.y=e.leaderPosition[3]-e.offheight/2,r.x=e.leaderPosition[2]+e.offwidth/2,r.y=e.leaderPosition[3]+e.offheight/2):"DMUMarker3DPicture"===e.type&&(o.x=Math.min(e.leaderPosition[4]-.75*e.width/4,e.leaderPosition[5]-.625*e.width/8,e.leaderPosition[0])-5,o.y=Math.min(e.leaderPosition[5]-.625*e.width/8,e.leaderPosition[1])-5,r.x=Math.max(e.leaderPosition[0],e.leaderPosition[4]+.75*e.width/4,e.leaderPosition[2],e.leaderPosition[0])+5,r.y=Math.max(e.leaderPosition[1],e.leaderPosition[5]+.625*e.width/8)+5);return[o.x-t/2,o.y-t/2,r.x+t/2,r.y+t/2]}static createAnnotation(e,{definition:t,subject:o,material:r,comments:i,pageNumber:a}){if(l&&t.type in s){let c=e.getPage(a-1);if(c){let a=p.getAnnotationRect(t,r.border?r.border.thickness:1),g=e.context.obj({Type:"Annot",Subtype:s[t.type],NM:l.PDFString.of(t.id),Rect:a,F:t.visible?4:2,P:c.ref,IC:r.fill?[r.fill.color.r,r.fill.color.g,r.fill.color.b]:void 0,C:r.border?[r.border.color.r,r.border.color.g,r.border.color.b]:void 0,CA:r.border?r.border.opacity:1,AP:p.getAnnotationAppearance(e,c,{rect:a,definition:t,material:r}),BS:e.context.obj({Type:"Border",W:"DMUCommentPositioned"!==t.type&&r.border?r.border.thickness:0,S:r.border&&r.border.pattern?"D":"S",D:r.border&&r.border.pattern?r.border.pattern:void 0}),Subj:o}),u=e.context.register(g);if(c.node.addAnnot(u),"DMUCommentPositioned"===t.type)r.fill&&(g.set(l.PDFName.of("C"),e.context.obj([r.fill.color.r,r.fill.color.g,r.fill.color.b])),g.set(l.PDFName.of("CA"),l.PDFNumber.of(r.fill.opacity))),g.set(l.PDFName.of("Name"),l.PDFName.of("Comment"));else if("DMUCommentHighlight"===t.type){r.fill&&(g.set(l.PDFName.of("C"),e.context.obj([r.fill.color.r,r.fill.color.g,r.fill.color.b])),g.set(l.PDFName.of("CA"),l.PDFNumber.of(r.fill.opacity)));let o=t.selection.map(e=>{let t=e.position.x,o=e.position.x+(e.width*Math.cos(e.rotationAngle||0)-e.height*Math.sin(e.rotationAngle||0)),r=e.position.y,i=e.position.y-(e.width*Math.sin(e.rotationAngle||0)+e.height*Math.cos(e.rotationAngle||0));return[t,r,o,r,t,i,o,i]});g.set(l.PDFName.of("QuadPoints"),e.context.obj(o.flat()))}else if("DMUMarker3DLine"===t.type)g.set(l.PDFName.of("L"),e.context.obj([t.points.start.x,t.points.start.y,t.points.end.x,t.points.end.y]));else if("DMUMarker3DSpline"===t.type)g.set(l.PDFName.of("InkList"),e.context.obj([t.points.map(e=>[e.x,e.y]).flat()]));else if("DMUMarker3DFreehand"===t.type)g.set(l.PDFName.of("InkList"),e.context.obj([t.points.map(e=>[e.x,e.y]).flat()]));else if("DMUMarker3DCloud"===t.type)g.set(l.PDFName.of("BE"),e.context.obj({I:l.PDFNumber.of(2),S:l.PDFName.of("C")})),g.set(l.PDFName.of("IT"),l.PDFName.of("PolygonCloud")),g.set(l.PDFName.of("Vertices"),e.context.obj(t.points.map(e=>[e.x,e.y]).flat()));else if("DMUMarker3DArrow"===t.type)g.set(l.PDFName.of("IT"),l.PDFName.of("LineArrow")),g.set(l.PDFName.of("L"),e.context.obj([t.pointing.x,t.pointing.y,t.ending.x,t.ending.y]));else if("DMUMarker3DPicture"===t.type){let o=t.imagedata;e.attach(o,"Test.PNG",{mimeType:"image/png"});let r=e.embeddedFiles.at(-1).ref;g.set(l.PDFName.of("FS"),r)}if(i&&i.length){let t;if(i.length>1){let o="";i.forEach(e=>{o+=`<p>${e.owner}&nbsp;&nbsp;${e.lastModificationDate.toLocaleString()}</p><p>${e.content}</p>`,e.replies&&e.replies.forEach(e=>{o+=`<p>&nbsp;&nbsp;&nbsp;${e.owner}&nbsp;&nbsp;${e.lastModificationDate.toLocaleString()}</p><p>&nbsp;&nbsp;&nbsp;${e.content}</p>`}),o+="<p>\n</p>"});const{richContent:r,flatContent:n}=d(o),s=l.PDFHexString.fromText(n),c=l.PDFHexString.fromText(r);t=e.context.obj({Type:"Annot",Subtype:"Popup",Contents:s,RC:c,Parent:u,Rect:a}),g.set(l.PDFName.of("Contents"),s),g.set(l.PDFName.of("RC"),c)}else{const{richContent:o,flatContent:s}=d(i[0].content),h=l.PDFHexString.fromText(s),D=l.PDFHexString.fromText(o),M=l.PDFHexString.fromText(i[0].owner);if(t=e.context.obj({Type:"Annot",Subtype:"Popup",Contents:h,CreationDate:l.PDFString.fromDate(i[0].creationDate),T:M,M:l.PDFString.fromDate(i[0].lastModificationDate),Parent:u,Rect:a,RC:D}),g.set(l.PDFName.of("Contents"),h),g.set(l.PDFName.of("RC"),D),g.set(l.PDFName.of("T"),M),g.set(l.PDFName.of("CreationDate"),l.PDFString.fromDate(i[0].creationDate)),g.set(l.PDFName.of("M"),l.PDFString.fromDate(i[0].lastModificationDate)),i[0].replies){let t=0;i[0].replies.forEach(o=>{if(!l)return;let i=n.getMMPerPtRatio();const s=5*i;t-=4*i;let g=[a[2]-s,a[1]+t,a[2],a[1]+t+s];const{richContent:h,flatContent:D}=d(o.content),M=l.PDFHexString.fromText(D),f=l.PDFHexString.fromText(h),m=l.PDFHexString.fromText(o.owner);let b=e.context.obj({Type:"Annot",Subtype:"Text",NM:l.PDFString.of(o.id),Name:"Comment",Contents:M,RC:f,T:m,CreationDate:l.PDFString.fromDate(o.creationDate),M:l.PDFString.fromDate(o.creationDate),Rect:g,F:4,P:c.ref,C:r.border?[r.border.color.r,r.border.color.g,r.border.color.b]:r.fill?[r.fill.color.r,r.fill.color.g,r.fill.color.b]:void 0,BS:e.context.obj({Type:"Border",W:0,S:"S"}),AP:p.getAnnotationAppearance(e,c,{rect:g,definition:{id:"",visible:!0,type:"DMUCommentPositioned",position:{x:g[0]+s/2,y:g[1]+s/2},width:s-1,height:s-1,radius:.5},material:{border:void 0,fill:{color:r.fill?r.fill.color:r.border?r.border.color:{r:0,g:0,b:0},opacity:1}}}),IRT:u}),x=e.context.register(b);c.node.addAnnot(x);let y=e.context.obj({Type:"Annot",Subtype:"Popup",Parent:x,Rect:a}),C=e.context.register(y);c.node.addAnnot(C),b.set(l.PDFName.of("Popup"),C)})}}let o=e.context.register(t);c.node.addAnnot(o),g.set(l.PDFName.of("Popup"),o)}}}}}class g{static displayLoadingDiv(e,t){let n,s,l;t&&(l=window&&window.widget?window.widget.getView().type:null)&&"maximized"!==l&&window.widget.requestView({type:"maximized"}),n=o.createElement("div",{class:"DMUExportMainDiv",styles:{zIndex:1e5,width:"100%",height:"100%",backgroundColor:"#F9F9F9",position:"absolute",top:0,left:0,padding:"0px 25%",display:"flex",flexDirection:"column",justifyContent:"center",background:"linear-gradient(0deg, #E2E4E3 0%, #F9F9F9 100%);"}}),s=o.createElement("span",{class:"DMUExportLabel",styles:{margin:"10px 0px"}}).inject(n);let d=o.createElement("div",{styles:{display:"flex",gap:"10px",alignItems:"center"}}).inject(n),c=new r;c.inject(d);let p=new i({label:a.exportCancelButtonLabel,emphasize:"secondary"}).inject(d);const g=()=>{p&&(p.disabled=!0),c.emphasize="high-attention",c.infiniteFlag=!0,s&&(s.innerText=a.exportAbortingLabel),e()};p.getContent().addEventListener("buttonclick",g);let u=o.createElement("div",{styles:{position:"absolute",top:30,right:30}}).inject(n),h=new i({displayStyle:"lite",label:a.exportCancelButtonLabel,icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"3x"},showLabelFlag:!1}).inject(u);return h.getContent().addEventListener("buttonclick",g),{loadingDivView:n,updateLoadingValue:e=>{c&&"number"==typeof e.value&&(c.value=e.value),s&&"string"==typeof e.label&&(s.innerText=e.label)},destroyLoadingDiv:()=>{t&&l&&"maximized"!==l&&window.widget.requestView({type:l}),p&&p.destroy(),h&&h.destroy(),c&&c.destroy(),n&&n.destroy()}}}static abortExport(){g.isAborted=!0}static exportAnnotationsAsPdf({baseDocumentBuffer:e,annotations:t,fileName:o,metadata:r,onProgressChange:i}){return g.isAborted=!1,e?new Promise((n,a)=>{if(g.isAborted)return n();i&&i(0),window.require(["DS/PDFLib/PDFLib"],s=>{if(g.isAborted)return n();!async function(){try{if(g.isAborted)return n();l=s;const d=await l.PDFDocument.load(e,{ignoreEncryption:!0});if(d.setTitle(r.title),d.setAuthor(r.author),d.setSubject(r.subject),d.setCreator(r.creator),d.setCreationDate(new Date),d.setModificationDate(new Date),d.setProducer("3DEXPERIENCE - Dassault Systèmes®"),g.isAborted)return n();if(i&&i(10),t.forEach((e,o)=>{i&&i(10+o/t.length*80);const r=d.getPage(e.pageNumber-1);r&&p.prepareAnnotationDefinition(r,e.definition,e.material),p.createAnnotation(d,e)}),g.isAborted)return n();i&&i(90);const c=await d.save();if(g.isAborted)return n();i&&i(100);let u=new Blob([c],{type:"application/pdf;base64"});if(g.isAborted)return n();let h=window.URL.createObjectURL(u);const D=document.createElement("a");D.href=h,D.download=o+".pdf",D.click(),window.URL.revokeObjectURL(h),l=null,g.isAborted=!1,n()}catch(e){window.console.log(e),a(new Error("Error during exporting document"))}}()},e=>{window.console.log(e),a(new Error("LIBs not found"))})}):Promise.reject(new Error("No document to export"))}}return g.isAborted=!1,g}),define("DS/DMUPersistence/DMUPrintCmd",["require","exports","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/EXPManagerSet","DS/WAFData/WAFData","DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/DMUCommandsManager"],function(e,t,o,r,i,n,a,s){"use strict";return class extends n{constructor(e){e.mode="shared",super(e);let t=e.frameWindow||this.getFrameWindow(),n=t.getViewer();this.beginExecute=(()=>{var e;super.beginExecute();let l,d=a.getContextViewer({viewer:n}),c=d.getRootBagPath().externalPath[0].path.getChildrenPathes().length;c&&(l=d.getRootBagPath().externalPath[0].path.getChildrenPathes()[c-1]);let p=o.getNodeType(l.getLastElement(!0)),g=function(){};if("Drawing"===p){let n=r.getManager({name:"DMU2DSheetManager",context:d.getFrameWindow()}),a=s.getCommand("Print2DRealSize",d.getCommandContext?d.getCommandContext():null),c=o.getNodeID(l.getLastElement(!0));null==n||n.load2DDocument(c,p,d.getRootBagPath().getChildrenPathes()[d.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0));let u=n.getLoadedDocuments(),h=u[0].sheetNodes.findIndex(e=>e.modelID===u[0].activatedSheet),D={tenant:window.require("DS/PADUtils/PADSettingsMgt").getSetting("x3dPlatformId"),physicalid:u[0].parentID};if(u[0]&&(null===(e=u[0])||void 0===e?void 0:e.svg))d.getController().getAttributes({ids:[c],attributes:["svg"],callbacks:{onComplete:function(e){if(e[c]){let o={method:"GET",authentication:"passport",proxy:"none",type:"text",timeout:6e4,cache:3600,onComplete:function(e){let o={currentSheetIndex:h,numberOfSheets:u[0].sheetNodes.length,svgStream:e};t.drawingPrintInfo=o,t.assetInfo=D,null==a||a.begin()},onCancel:g,onFailure:g};i.handleRequest(e[c].svg,o)}},onFailure:g}});else{let e=u[0].activatedSheet,o=u[0].UDLLoader.getSheetSize(e),r={currentSheetIndex:h,numberOfSheets:u[0].sheetNodes.length,svgStream:null,currentSheetSize:o};t.drawingPrintInfo=r,t.assetInfo=D,null==a||a.begin()}}null==t||delete t.drawingPrintInfo,null==t||delete t.assetInfo,this.end?this.end():this.done()})}}}),define("DS/DMUPersistence/DMUSaveServices",["require","exports","DS/DMUReadPersistence/DMUReviewPersistenceServices","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/DMUModelServices"],function(e,t,o,r,i,n){"use strict";let a,s;return class{static isCreatingAMarkup(e){a=e}static isProcessing(){return a||s}static saveCurrent3DMarkup(e){return new Promise((t,a)=>{e&&e.frmWindow&&i.isPersistenceAllowed({onPersistenceAllowed:async function(){var i;s=!0;let l=0,d=null,c=r.getReviewContext({viewer:e.frmWindow.getViewer()}),p=c?c.getCurrentSessionMarkup():null;if(p)if(p.isDirty()){let t;if(l=1,e.superType&&("SIMItfSimulation"===e.superType||"Document"===e.superType)||"Specification Report"===e.superType){t={Version:"1.0",Contexts:[],Model:[]};let o=await n.getObjectDefinition(p);t.Model.push(o),null===(i=t.Contexts)||void 0===i||i.push({superType:e.superType,documentType:e.documentType,listData:e.listData,loadingInfos:e.loadingInfos,documentVersionInfos:e.documentVersionInfos})}else{t={Version:"1.0",Model:[]},p.getApplicativeContext()&&Object.keys(p.getApplicativeContext()).length>0&&(t.ApplicativeContext=p.getApplicativeContext());let e=await n.getObjectDefinition(p);t.Model.push(e)}d=JSON.stringify(t)}else l=2;if(1===l&&d){let r=new o,i=null==c?void 0:c.getReviewCtxInformation();if(i){let o,n={json:d,reviewPhysicalId:i.reviewId,markupName:i.reviewName,markupType:i.reviewType,newFile:"boolean"==typeof e.newFile?e.newFile:void 0};(o="Markup"===i.reviewType?r.updateReviewAndJSONFile:r.updateMarkupStream)(n,function(e){i&&(null==c||c.setReviewCtxInformation({contextId:i.contextId,subContext:i.subContext,subContextId:i.subContextId,reviewId:e.reviewId,reviewName:e.reviewName,reviewDescription:i.reviewDescription,reviewType:e.reviewType,modifiable:i.modifiable,owner:i.owner,tempObjectInfo:i.tempObjectInfo})),null==p||p.setDirtyFlag(!1),s=!1,t()},function(){s=!1,a(new Error("Error at save current markup"))})}else s=!1,t()}else s=!1,t()},onPersistenceNotAllowed:function(){a(new Error("Error at save current markup: Persistence is not allowed"))}})})}}}),define("DS/DMUPersistence/DMUMarkupMaturityChangeCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/DMUBaseExperience/DMUContextManager"],function(e,t,o,r,i){"use strict";return class extends o{beginExecute(){const e=this.getFrameWindow().getViewer();let t=this,o=i.getReviewContext({viewer:e});const n=o&&o.getReviewCtxInformation();let a=o&&o.getCurrentSessionMarkup();if(!a||!n)return void(this.end?this.end():this.done());let s=i.getEventsController({viewer:e});window.require(["DS/MaturityWidget/MaturityWidget"].concat([]),function(e){let o;o&&o.dialog&&o.dialog.destroy(),(o=new e({externalSettings:r.getOption("platform_services")})).addEvent("onMaturityCanceled",function(){t.cancel()}),o.addEvent("onMaturityTransitionEnd",function(e){if(e&&e.data&&e.data.length>0&&a){for(let t=0;t<e.data.length;t++)if(e.data[t]&&e.data[t].physicalid===n.reviewId&&e.data[t].tostate){a.setMaturityState(e.data[t].tostate),s&&s.fireEvent("onMarkupObjectAttributesModified",{object:a,attr:[{currentState:e.data[t].tostate}]});break}t.end()}else t.end()}),r.getServerContext({onComplete:function(e){o.executeCmd([{physicalid:n.reviewId,tenant:r.getTenant()}],{context:{getSecurityContext:()=>({SecurityContext:e})}},()=>{})},onFailure:function(){}})}),this.done()}}}),define("DS/DMUPersistence/DMUDOSThumbnailServices",["DS/WAFData/WAFData","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting"],function(e,t){"use strict";return class{static saveObjectThumbnail(o,r,i){return new Promise(n=>{const a=i+"_thb";(function(o,r){return new Promise((i,n)=>{t.sendWebServiceCall({url:"resources/markup/service/getDosUploadTicket",config:{verb:"POST",data:JSON.stringify({sBucketName:o,sTenant:t.getTenant(),sFileId:r})},onSuccess:function(t){e.authenticatedRequest(JSON.parse(t).result,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(e){i(JSON.parse(e))},onFailure:function(e){n(e)}})}})})})(o,a).then(e=>{const o=e.ticket,i=e.url;if(o&&i){const e=new Image;e.src=r,e.onload=function(){const r=document.createElement("canvas"),s=r.getContext("2d");r.width=144,r.height=108,s.drawImage(e,0,0),r.toBlob(function(e){var r;(r={file:e,ticket:o,URL:i,fileName:a},new Promise(function(e){var t=new FormData;t.append("__fcs__jobTicket",r.ticket),t.append("imageFile",r.file,r.fileName);var o=new XMLHttpRequest;o.open("POST",r.URL,!0),o.onload=function(){200===o.status&&e(o.responseText)},o.send(t)})).then(function(e){e&&function(e){return new Promise(o=>{t.sendWebServiceCall({url:"resources/markup/service/getDosCommit",config:{verb:"POST",data:JSON.stringify({sTenant:t.getTenant(),sReceipt:e})},onSuccess:function(e){o(e)}})})}(e.replace(/\n/g,"")).then(()=>{n()})})})}}}).catch(e=>{window.console.log(e)})})}static deleteMarkupThumbnail(e,o){!function(e,o){new Promise(r=>{t.sendWebServiceCall({url:"resources/markup/service/deleteFile",config:{verb:"POST",data:JSON.stringify({sBucketName:e,sFileId:o,sTenant:t.getTenant()})},onSuccess:function(e){r(e)}})})}(e,o+"_thb")}}}),define("DS/DMUPersistence/DMUPersistence",[],function(){}),define("DS/DMUPersistence/DMUExportReviewAsPdfCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUPersistence/DMUExportServices","DS/DMUPlayComment/DMUComment","DS/DMUPlayMarker/DMUMarker","DS/DMUPlayMarker/DMUCommentAnnotationBase","DS/DMUBaseUI/DMUToolsUsers","i18n!DS/DMUPersistence/assets/nls/DMUPersistence","DS/CATWebUXPreferences/CATWebUXPreferencesUtils"],function(e,t,o,r,i,n,a,s,l,d,c){"use strict";const p={ENOR3D_AP:"ENOVIA - 3D Markup",ENOR3R_AP:"ENOVIA - Design Review",ENOR3V_AP:"ENOVIA - Design Validation"};return class extends o{constructor(e){e.mode="shared",super(e);let t=(e.frameWindow||this.getFrameWindow()).getViewer();this.beginExecute=(async()=>{var e,o;super.beginExecute();let g=r.getContextViewer({viewer:t}),u=r.getReviewContext({context:g});if(!u)return this.done();let h,D=[],M=u.getValidation();if(M)null===(e=M.getMarkups())||void 0===e||e.forEach(e=>{var t;let o=e.getRepRef(),r=null==o?void 0:o.getMarkupContent();r&&D.push({content:r,name:e.getName()}),null===(t=e.getReplies())||void 0===t||t.forEach(t=>{let r=null==(o=t.getRepRef())?void 0:o.getMarkupContent();r&&D.push({content:r,name:e.getName()})})}),h=M.getName()||"";else{const e=u.getCurrentSessionMarkup();D.push({content:e,name:e.getAttribute("sName")||""}),h=e.getAttribute("sName")||""}let f=!1;const{loadingDivView:m,updateLoadingValue:b,destroyLoadingDiv:x}=i.displayLoadingDiv(()=>{f=!0,i.abortExport()});let y;try{y="true"===(await c.readPreferences([{Repository:"DMURepository",PreferenceNames:["ExportPersonalData"]}])).repositories[0].preferences[0].value}catch(e){y=!1,window.console.warn("Could not get server value, default value set instead.",e)}const C=u.getReviewCtxInformation()||{owner:"",tempObjectInfo:{title:""},reviewDescription:""};let v=y?await l.getUserName(C.owner):C.owner;const P=`${null===(o=C.tempObjectInfo)||void 0===o?void 0:o.title}-${h}-${(new Date).toLocaleDateString().replace(/\//g,"-")}`;try{m.inject(g.elements.main),b({value:0,label:d.initializingExport});const e=window.require("DS/WebDocumentVisualization/WebDocumentVisualizationController"),[t,o]=await new Promise(e=>window.require(["DS/DMUComment/DMUCommentExport","DS/DMUMarker/DMUMarkerExport"],(t,o)=>e([t,o])));if(f)return;let r=e.giveWebDocumentVisualizationController({context:g}).getDocumentBuffer(),l=[];for(let e=0;e<D.length;e++){const{content:o}=D[e];let r=o.getComments();if(r)for(const e of r)if(e instanceof n){if(f)return;l.push(await t.getCommentExportDefinition(e,y))}}const c=[];for(let e=0;e<D.length;e++){const{content:r,name:i}=D[e];let n=r.getSlides();if(n.length){let r=n[0].getDMUObjects();for(let n=0;n<r.length;n++){if(f)return;b({label:`${d.exportPreparingMarkersMessage}: ${n+1} / ${r.length}`,value:10+n/r.length/((e+1)/D.length)*60});const p=r[n];let g;try{p instanceof a?g=await o.getExportDefinition(p,y):p instanceof s&&(g=await t.getExportDefinition(p,y))}catch(e){window.console.warn(e)}g&&(g.subject=i,g.comments&&g.comments.forEach(e=>{let t=l.filter(t=>t.parentCommentId===e.id);e.replies=t}),c.push(g))}}}if(f)return;b({label:d.exportPreparingDocumentMessage}),await i.exportAnnotationsAsPdf({baseDocumentBuffer:r,annotations:c,fileName:P,metadata:{author:v||"",title:h,creator:window.widget&&window.widget.getValue("appId")?p[window.widget.getValue("appId")]:"",subject:C.reviewDescription||""},onProgressChange:e=>{b({value:70+30*e})}})}catch(e){window.console.error(e),g.displayNotification({msg:d.exportError,eventID:"error"})}finally{x()}this.end?this.end():this.done()})}}}),define("DS/DMUPersistence/DMUAuthPersistenceServices",["UWA/Utils","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUPlayMarkup/DMUMarkup","DS/DMUBaseExperience/DMULinksManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUBaseUIControllers/DMUReqCompareController","i18n!DS/DMUPersistence/assets/nls/DMUPersistence"],function(e,t,o,r,i,n,a,s,l,d,c,p,g,u,h){"use strict";return{createSessionMarkup:async function(a,p,D,M,f){if(a){var m=a.getViewer(),b=a.getFrameWindow(),x=t.getReviewContext({context:a}),y=null,C=null,v={entities:null,occurrences:null};if(x&&((y=x.getTransientReviewBag())&&"DMUTemporaryBag"===y.getType()&&(C=y.getAttribute("oLinksManager")),C&&C.exportLinksManagerData(v)),x||(x=await o.createReviewContext({context:a})),y=new r(m,x),C=new i(m,y),(v.entities&&v.entities.length>0||v.occurrences&&v.occurrences.length>0)&&C.importLinksManagerData(v),y.setAttributes([{name:"oLinksManager",value:C},{name:"sName",value:p}]),y.setMaturityState("IN_WORK"),x.setCurrentSessionMarkup(y),n.setSlidePreferences({context:b,preferences:{panelTitle:p}}),f){let o,r=1,i=u.giveReqCompareController({context:a});i&&i.isRequirementCompareActive()&&(r=2);for(let i=0;i<r;i++){const r=x.getCurrentSessionMarkup();(o=new s(m,r)).setAttributes([{name:"sID",value:y.computeNewID()},{name:"sUuid",value:e.getUUID()}]),o.updateEnvironmentOverload({target:x.getEnvironment(),state:x.getEnvironment().getEnvironmentInfo()}),r.addSlide(o);var P=null,S=l.giveDMUApplicativeContextManager({context:t.getContextViewer({viewer:m})});if(S){var w,U,k=S?S.getApplicativeControllers():[];let e=[];for(var T=0;T<k.length;T++){U=k[T].getApplicativeContainerID();var I=S.getVerifiedApplicativeContainerState(U);if(I){let t;o.setSlideApplicativeContext(U,I),null,(w=k[T].getCurrentAppContainerStateTitle())&&(P?P+=" - ":P="",P+=w);try{t="true"===(await g.readPreferences([{Repository:"DMURepository",PreferenceNames:["SlideNameFromFeature"]}])).repositories[0].preferences[0].value}catch(e){t=!0,window.console.warn("Could not get server value, default value set instead.",e)}if(t&&k[T]&&k[T].getFeatureInformation){let t=k[T].getFeatureInformation();t&&t.name&&e.push(t.name)}}o.setSlideApplicativeContext(U,I)}1===e.length&&e[0]&&(P=e[0])}P&&!P.length&&(P=null),o.setAttribute("sName",y.computeNewName({object:o,prefix:P||h.createMarkup.slideTitle,noSuffixIfPossible:null!==P,separator:null!==P?"parenthesis":null})),o.fireEvent("onDMUObjectInitialized",{dmuObject:o})}await d.copyTransientMarkersAndOverloads(y,o,a,D,M),x.getTransientReviewBag().removeDMUObjects();var A=c.giveDMUSlidesController({context:b});A&&A.setActiveSlide(o,{duration:0})}return y}},getPossibleRootContexts:function(e){if(!e)return[];var t=e.getRootBagPath().getChildrenPathes();if(t.length>1){var o=p.getDMUSceneDisplayController({context:e});if(o){let e=o.getCurrentComparedObjectIDPaths();if(e&&e.firstObject&&e.secondObject)for(let o=t.length-1;o>=0;o--)if(e.secondObject[0]===a.getNodeID(t[o].getLastElement(!0))){t.splice(o,1);break}}let r=u.giveReqCompareController({context:e});if(r){let e=r.getCurrentComparedObjectIDPaths();if(e&&e.firstObject&&e.secondObject)for(let o=t.length-1;o>=0;o--)if(e.secondObject===a.getNodeID(t[o].getLastElement(!0))){t.splice(o,1);break}}}return t}}}),define("DS/DMUPersistence/DMUCreateMarkupCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUPersistence/DMUSaveServices","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/Editor","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUReadPersistence/DMULoadingContextController","DS/Windows/Dialog","DS/Controls/Button","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/DMUPersistence/DMUAuthPersistenceServices","DS/DMUPersistence/DMUAuthPersistenceUtils","i18n!DS/DMUPersistence/assets/nls/DMUPersistence","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","css!DS/DMUPersistence/DMUPersistence.css"],function(e,t,o,r,i,n,a,s,l,d,c,p,g,u,h,D,M,f,m){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);var b,x,y,C,v,P,S,w,U,k,T=this,I=t.frameWindow||this.getFrameWindow(),A=I.getViewer(),E=[];let R,F,L=null,N=!1;var O=[],B=[];function j(){S=null,w=null,k&&(k.destroy(),k=null),E=[],x&&x.destroy(),b&&b.destroy(),x=b=null,C=v=P=void 0,S=w=void 0,T.end?T.end():T.done()}function W(e){x||(x=new o),x.build({type:"error",autoHide:!0,message:f.createMarkup.errorMessage,body:I.getUIFrame()});var t=r.giveEventsController({viewer:A});t&&t.fireEvent("onDMUMarkupCreationFailed"),window.console.error(e),j()}async function V(){if(y){var e=await D.createSessionMarkup(y,S,O,B,R);if(e){var t,o,a;if(t=P?P.value:E[0].valueItem,L){let e=L.getSubContextInformations(t);e&&e.id&&(o=e)}w&&(a=(a=JSON.stringify(w)).substring(1,a.length-1));const s=y.getController().getRootStats(t)&&y.getController().getRootStats(t).serviceId?y.getController().getRootStats(t).serviceId:"";!function(e){var t=r.getReviewContext({viewer:A});if(t){i.isCreatingAMarkup(!0);var o=[];e.parentID&&o.push(e.parentID),e.subContext&&e.subContext.id&&o.push(e.subContext.id),n.sendWebServiceCall({url:"resources/markup/service/createmarkup",config:{verb:"POST",data:{sTitle:e.reviewName,sContextIds:o,sDescription:e.reviewDescription?e.reviewDescription:"",sServiceId:e.serviceID,sExternalID:U,strURI:e.strURI?e.strURI:"",appData:e.appData?e.appData:""}},onSuccess:function(o){var r=JSON.parse(o);L||(L=c.getLoadingContextController({context:y})),t.setReviewCtxInformation({contextId:e.parentID,subContext:e.subContext,subContextId:e.subContext&&e.subContext.id?e.subContext:void 0,reviewId:r.pId,reviewName:e.reviewName,modifiable:!0,reviewDescription:e.reviewDescription?e.reviewDescription:"",reviewType:"DMUMarkupRepReference",owner:r.owner,tempObjectInfo:L?L.getTempObjectInformations():void 0}),e.onMarkupCreationCompleted(o),i.isCreatingAMarkup(!1)},onFailure:function(o){e.onMarkupCreationFailed(o),i.isCreatingAMarkup(!1),t.getCurrentSessionMarkup()&&t.getCurrentSessionMarkup().setActiveFlag(!1)}})}}({reviewName:S,reviewDescription:a,parentID:t,subContext:o,subContextId:o?o.id:void 0,serviceID:s,onMarkupCreationCompleted:function(){if(k&&(k.destroy(),k=null),"r2vsurvey"===s){y.toggleSOITimelinesUsability(!1);const e=r.giveEventsController({viewer:A});e&&e.fireEvent("onR2VMarkupCreationSuccess")}e.fireEvent("onDMUObjectInitialized",{dmuObject:e}),e.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e}),require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateMarkup")}),setTimeout(function(){j()})},onMarkupCreationFailed:W})}}}r.setAuthoringFeatureTypes("Markup"),this.beginExecute=function(){N||(N=!0,setTimeout(function(){N=!1},500),new Promise(e=>{n.sendWebServiceCall({url:"resources/markup/service/generateName",config:{verb:"POST",data:JSON.stringify({sType:"DMUMarkupRepReference"})},onSuccess:function(t){e(t?{markupName:JSON.parse(t).title,externalID:JSON.parse(t).name}:{})}})}).then(t=>{var o;if(U=t.externalID,y=r.getContextViewer({viewer:A})){var n,x,T,N=D.getPossibleRootContexts(y),G=[],H=[];for(o=0;o<N.length;o++){var z=y.getController().isFiltered(d.getNodeID(N[o].getLastElement(!0)));if(y.getApplicativeData&&y.getApplicativeData().getLoadedItfData&&y.getApplicativeData().getLoadedItfData().data.length){y.getApplicativeData().getLoadedItfData().data.forEach(function(e){G.push({rootID:e.isrID,type:"ISR"})});break}if(z.filterId)G.push({rootID:z.filterId,type:"Filter"});else{const e=d.getNodeID(N[o].getLastElement(!0));""!==e&&G.push({rootID:e,type:y.getController().getRootStats(e)&&"r2vsurvey"===y.getController().getRootStats(e).serviceId?"R2V_FeatureState":d.getNodeType(N[o].getLastElement(!0))})}}G.length&&new Promise(function(e){var t=0;G.forEach(function(o){if("R2V_FeatureState"===o.type){L||(L=c.getLoadingContextController({context:y})),L.getLoadedR2VInformations().forEach(r=>{r.id===o.rootID&&(t++,E.push({labelItem:r.info[0]["ds6w:label"],iconItem:r.info[0].icon,valueItem:o.rootID,type:T}),t===G.length&&e())})}else y.getController().getAttributes({ids:[o.rootID],attributes:["ds6w:label","ds6wg:revision","type_icon_url","ds6w:type"],callbacks:{onComplete:function(r){t++,r[o.rootID]&&(n=r[o.rootID].type_icon_url,x=r[o.rootID]["ds6w:label"],T=r[o.rootID]["ds6w:type"],r[o.rootID]["ds6wg:revision"]&&(x+=" "+r[o.rootID]["ds6wg:revision"]),H.push(x),"R2V_FeatureState"!==T&&E.push({labelItem:x,iconItem:n,valueItem:o.rootID,type:T}),t===G.length&&e())},onFailure:function(){t++;[{type:"Filter",label:"Filter"},{type:"Document",label:"Document"},{type:"ISR",label:"Iterference Simulation"},{type:"PLMPIMMetricReference",label:"Iterference Metric"},{type:"DesignSight",label:"Physics Simulation"},{type:"Requirement",label:"Requirement"},{type:"Requirement Specification",label:"Requirement Specification"}].some(r=>{if(o.type===r.type)return H.push(r.label),E.push({labelItem:r.label+t,valueItem:o.rootID,type:r.type}),e(),!0})}}})})}).then(async function(){try{let e=(await m.readPreferences([{Repository:"DMURepository",PreferenceNames:["CreateFirstSlide","DisplayMarkupCreationDialog"]}])).repositories[0].preferences;for(let t=0;t<e.length;t++)"CreateFirstSlide"===e[t].name?(R="true"===e[t].value,G[0]&&G[0].type&&("Document"===G[0].type||"Requirement"===G[0].type||"Requirement Specification"===G[0].type)&&(R=!0)):"DisplayMarkupCreationDialog"===e[t].name&&(F="true"===e[t].value)}catch(e){R=!0,F=!0,window.console.warn("Could not get server value, default value set instead.",e)}S||(S=t.markupName);var o=r.getReviewContext({context:y}),n=function(){b&&b.destroy(),async function(){let e;if((k=new h).display({modal:!0,frmWindow:I,type:"load",message:f.createMarkup.loadingMessage}),e=P?P.value:E[0].valueItem,R){let t=await M.getTransientMarkersAndOverloads(o,y,e);B=t.overloads,O=t.markers}o&&o.getCurrentSessionMarkup()?i.saveCurrent3DMarkup({frmWindow:I}).then(V,W):V()}()};if(F||E.length>1||o&&o.getCurrentSessionMarkup()){var d,D,x,U=e.createElement("div",{class:"DMUCreateMarkupPanelMainDiv"});if(E.length>1){var T=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(U);T.setStyles({width:"calc(100% - 20px)",paddingLeft:"10px",paddingRight:"10px",margin:0}),T.innerText=f.createMarkup.multipleRootsLabel,(P=new a({elementsList:E,selectedIndex:0,enableSearchFlag:!0,actionOnClickFlag:!1}).inject(U)).elements.container.setStyles({width:"calc(100% - 10px)",margin:"5px"}),P.addEventListener("change",function(){v.value=P.label})}var N=function(){var t=""===C.value;d.disabled=t,d.disabled||(S=C.value,w=v.value),D.innerHTML="",x.innerHTML="";var o=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});o.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"});var r=e.createElement("span",{class:"condBadString"});r.innerHTML=f.createMarkup.condBadString,r.setStyles({color:"#E87B00",display:"inline","font-weight":"bold","font-style":"italic"}),t&&o.inject(D),D.setStyle("display",""!==D.innerHTML?"":"none"),x.setStyle("display",""!==x.innerHTML?"":"none")},H=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(U);H.setStyles({paddingTop:"0px"});var z=e.createElement("div").inject(H),q=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(z);q.setStyles({marginRight:"5px"}),(D=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(z)).setStyles({color:"#E87B00",display:"none"}),q.innerHTML=f.createMarkup.nameLabel,(C=new s({placeholder:f.createMarkup.namePlaceholder,value:S,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(H)).elements.container.setStyles({width:"100%"}),C.elements.container.childNodes[0].setStyles({width:"100%"}),C.addEventListener("change",N);var _=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(U),X=e.createElement("div").inject(_),$=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(X);if((x=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(X)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),!w)if("Specification Report"===E[0].type){if(L||(L=c.getLoadingContextController({context:y})),L){let e=L.getSubContextInformations(E[0].valueItem);e&&e.id&&(w=e.label)}}else w=E[0].labelItem;if($.innerHTML=f.createMarkup.descriptionLabel,(v=new l({nbRows:5,newLineMode:"shiftEnter",placeholder:f.createMarkup.descriptionPlaceholder,value:w,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(_)).elements.container.setStyles({width:"100%"}),v.elements.container.childNodes[0].setStyles({width:"100%"}),v.addEventListener("change",N),o&&o.getCurrentSessionMarkup()){var J=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(U);J.innerHTML=f.createMarkup.warningMessage,J.setStyles({color:"#e87b00","font-weight":"normal","font-style":"italic",margin:"0","margin-top":"10px"})}(d=new g({emphasize:"primary",label:f.createMarkup.createMarkupButton,onClick:n})).getContent().addClassName("markupCreationButton");var K=new g({label:f.createMarkup.cancelButton,onClick:function(){var e=r.giveEventsController({viewer:A});e&&e.fireEvent("onDMUMarkupCreationCancelled"),b&&b.destroy(),j()}});b=new p({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:f.createMarkup.panelTitle,resizableFlag:!0,immersiveFrame:I.getImmersiveFrame(),position:u.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:d,Cancel:K},width:400,content:U}),o&&o.getCurrentSessionMarkup()&&(d.emphasize="medium-attention",d.icon={iconName:"warning",fontIconFamily:WUXManagedFontIcons.font3DS}),b.addEventListener("close",function(){let e=r.giveEventsController({viewer:A});e&&e.fireEvent("onDMUMarkupCreationCancelled"),j()}),N()}else n()})}else j()}))},this.cancelExecute=function(){j()},this.setDefaultInfo=function(e){S=e.title,w=e.description}}})});