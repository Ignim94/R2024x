define("DS/DELPPWMILModule/ManageInconsistentLinksBaseUI",["UWA/Core"],function(e){"use strict";return function(t,n,o,a,i,l){var s,c,r,u={className:""},d=null;return s=function(s){var p,g,I=n.create("Element","div",{class:"mil-panel-container"}),f=n.create("Element","div",{class:"mil-tree-container"}).inject(I),m=n.getComponent("Button"),L=s.cancelButtonLabel||i.getNLSValue("PanelButton.Cancel"),h=s.manageInconsistentLinksCmdId;r=e.is(s.cleanup,"function")?s.cleanup:null,p=a.getWUXNodeModel(),o.loadDocument(p),o.getContent().inject(f),g={shouldBeSelected:function(t){const n=t.options.milStatus;let o=!0;return e.is(n)&&(o="success"!==n),o}},e.extend(p.options,g),(d=n.create("Dialog",{identifier:"MIL-UI",domId:"MILUI-dialog",title:i.getNLSValue("ManageInconsistentLinksUI.PanelTitle"),resizableFlag:!0,visibleFlag:!1,modalFlag:!0,content:I,height:315,width:600,snappableFlag:!1,buttons:{Ok:new m({disabled:!0,label:i.getNLSValue("MIL.PanelApplyButton"),emphasize:"primary",onClick:function(){e.is(u.onApplyCallBack,"function")&&u.onApplyCallBack()}}),Cancel:new m({label:L,onClick:function(){d.close()}})}})).close=function(){l.getBICmdState()||l.resetBIModelCollection(),e.is(h)?t.notify("toggleCmdCheckHeaderState",{cmdName:h,cmdState:!1}):c()}},c=function(){d.hide()},{buildSkeleton:function(t){u=e.extend(u,t),s(u)},destroy:function(t){e.is(t,"boolean")&&t?e.is(r,"function")&&r():this.isActive()&&c(),e.is(a)&&a.emptyNodeModel(),e.is(d)&&(d.destroy(),d=null)},isActive:function(){return!!e.is(d)&&d.visibleFlag},loadUI:function(){e.is(d)&&!1===d.visibleFlag&&d.show()},setApplyButtonState:function(){var e=!1;a.getSelectedNodesInfo().length>0&&(e=!0),d.buttons.Ok.disabled=!e}}}}),define("DS/DELPPWMILModule/MFNChangeImpactMgmtUI",["UWA/Core","DS/DELPPWMILModule/ManageInconsistentLinksBaseUI"],function(e,t){"use strict";const n=function(t,n){const o=n||null;let a=new Map;return(...n)=>{const i=e.is(o,"function")?o(...n):n[0];let l;return a.has(i)?l=a.get(i):(l=t(...n),a.set(i,l)),l}},o=function(e){return Array.isArray(e)&&e.length>1},a=function(e,t=null){const n=e.length;return n>0?e[n-1]:t},i=function(e,t=null){return e.length>0?e[0]:t},l=function(e,t){return e.add(t)},s=function(e,t){let n=new Set(e);for(const e of t)n.add(e);return n},c=(...e)=>t=>e.reduce((e,t)=>t(e),t),r=(e=>t=>t.split(e))(","),u=c(r,a),d=c(r,i),p=e=>(...t)=>t.join(e),g=p(" "),I=p(","),f=function(e){let t,n=new Map;return{from(e){return t=e,this},addDefaultOption(){return n.set(t.value,{labelItem:t.label,valueItem:t.value,tooltipItem:t.tooltip}),this},addReplaceByBranchOption(){return n.set(e.Replace_By_NewBranch.value,{labelItem:e.Replace_By_NewBranch.label,valueItem:e.Replace_By_NewBranch.value,tooltipItem:e.Replace_By_NewBranch.tooltip}),this},addReplaceByNewOption(){return n.set(e.Replace_By_New.value,{labelItem:e.Replace_By_New.label,valueItem:e.Replace_By_New.value,tooltipItem:e.Replace_By_New.tooltip}),this},addDeleteOption(){return n.set(e.Delete.value,{labelItem:e.Delete.label,valueItem:e.Delete.value,tooltipItem:e.Delete.tooltip}),this},addMadeFromUseCaseAssembly(){n.set(e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value,{labelItem:e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.label,valueItem:e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value,tooltipItem:e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.tooltip})},addMadeFromUseCaseFabrication(){return n.set(e.MadeFrom_UseCase_Att_Add.value,{labelItem:e.Delete.label,valueItem:e.Delete.value,tooltipItem:e.Delete.tooltip}),this},addRerouteOption(){return n.set(e.Reroute_ImplementAndScopeLink.value,{labelItem:e.Reroute_ImplementAndScopeLink.label,valueItem:e.Reroute_ImplementAndScopeLink.value,tooltipItem:e.Reroute_ImplementAndScopeLink.tooltip}),this},addReplaceByNewRevisionOption(){return n.set(e.Replace_By_NewRev.value,{labelItem:e.Replace_By_NewRev.label,valueItem:e.Replace_By_NewRev.value,tooltipItem:e.Replace_By_NewRev.tooltip}),this},addEvolveInstanceOption(){return n.set(e.Evolve_Instance.value,{labelItem:e.Evolve_Instance.label,valueItem:e.Evolve_Instance.value,tooltipItem:e.Evolve_Instance.tooltip}),this},addRerouteOnlyOption(){return n.set(e.Reroute_ImplementLink.value,{labelItem:e.Reroute_ImplementLink.label,valueItem:e.Reroute_ImplementLink.value,tooltipItem:e.Reroute_ImplementLink.tooltip}),this},addAdditionalOptions(){switch(t){case e.Replace_By_NewRev:this.addReplaceByNewOption().addReplaceByBranchOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Replace_By_NewBranch:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Replace_By_New:this.addReplaceByNewRevisionOption().addReplaceByBranchOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Replace_By_Existing:case e.Reroute_ImplementAndScopeLink:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addReplaceByBranchOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Reroute_ImplementLink:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addReplaceByBranchOption().addDeleteOption().addEvolveInstanceOption();break;case e.Evolve_Instance:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addReplaceByBranchOption().addDeleteOption().addRerouteOnlyOption();break;case e.MadeFrom_UseCase_Att_Add:this.addMadeFromUseCaseAssembly()}return this},addIgnoreOption(){return n.set(e.Ignore.value,{labelItem:e.Ignore.label,valueItem:e.Ignore.value}),this},removeOptions(e){for(const t of e)n.delete(t);return this},toArray:()=>Array.from(n.values())}};return function(p,m,L,h,M,v,P,_,R,b){let S,k,y,N=null,O=null;const A={Reroute_ScopeLink:{label:P.getNLSValue("MIL.Reroute.ScopeLink"),value:1,tooltip:P.getNLSValue("MIL.ToolTip.RerouteScope"),getLabel:function(){return this.tooltip}},Reroute_ImplementAndScopeLink:{label:P.getNLSValue("MIL.Reroute.ImplementAndScopeLink"),value:2,tooltip:P.getNLSValue("MIL.ToolTip.Reroute"),getLabel:function(){return this.tooltip}},Reroute_ImplementLink:{label:P.getNLSValue("MIL.Reroute.ImplementLink"),value:3,tooltip:P.getNLSValue("MIL.ToolTip.RerouteImplement"),getLabel:function(){return this.tooltip}},Replace_By_Existing:{label:P.getNLSValue("MIL.ReplaceByExisting"),value:5,tooltip:P.getNLSValue("MIL.ToolTip.ReplaceByExisting"),getLabel:function(){return this.tooltip}},Delete:{label:P.getNLSValue("MIL.Delete"),value:6,tooltip:P.getNLSValue("MIL.ToolTip.Delete"),getLabel:function(){return this.tooltip}},Ignore:{label:P.getNLSValue("MIL.Ignore"),value:7,getLabel:function(){return this.label}},Ambiguous:{label:P.getNLSValue("MIL.Ambiguous"),value:8,getLabel:function(){return this.label}},Replace_By_NewRev:{label:P.getNLSValue("MIL.ReplaceByNewRevision"),value:9,tooltip:P.getNLSValue("MIL.ToolTip.ReplaceByNewRev"),getLabel:function(){return this.tooltip}},Replace_By_New:{label:P.getNLSValue("MIL.ReplaceByNew"),value:10,tooltip:P.getNLSValue("MIL.ToolTip.ReplaceByNew"),getLabel:function(){return this.tooltip}},Replace_By_NewBranch:{label:P.getNLSValue("MIL.ReplaceByNewBranch"),value:11,tooltip:P.getNLSValue("MIL.ToolTip.ReplaceByNewBranch"),getLabel:function(){return this.tooltip}},Evolve_Instance:{label:P.getNLSValue("MIL.EvolveInstance"),value:12,tooltip:P.getNLSValue("MIL.ToolTip.EvolveInstance"),getLabel:function(){return this.tooltip}},MadeFrom_UseCase_Att_Add:{label:P.getNLSValue("MIL.MadeFrom_UseCase_Att_Add.ManufacturingMadeFrom"),value:13,tooltip:P.getNLSValue("BI.MfgStatus.MadeFrom_UseCase_Att_Good.ManufacturingMadeFrom"),getLabel:function(){return this.tooltip}},MadeFrom_UseCase_Att_Add_ManufacturingAssembly:{label:P.getNLSValue("MIL.MadeFrom_UseCase_Att_Add.ManufacturingAssembly"),value:14,tooltip:P.getNLSValue("BI.MfgStatus.MadeFrom_UseCase_Att_Good.ManufacturingAssembly"),getLabel:function(){return this.tooltip}},MadeFrom_UseCase_Att_Remove:{label:P.getNLSValue("MIL.MadeFrom_UseCase_Att_Remove"),value:15,tooltip:P.getNLSValue("BI.MfgStatus.MadeFrom_UseCase_Att_Remove"),getLabel:function(){return this.tooltip}}},D="ReplaceByNewRev",B="ReplaceByExisting",U="ReplaceByNew",w="ReplaceByNewBranch",E="RerouteIL",C="ReconnectSLnIL",V="ReconnectSL",T="Delete",F="EvolveInstance",x="ManufacturingMadeFrom",j="ManufacturingAssembly",W="RemoveUseCase",z=function(t,n){let o=g(t.get("PLMEntity.V_Name"),t.get("revision"));return e.is(n)&&(o+="("+n.get("PLMInstance.PLM_ExternalID")+")"),o},K=e=>!v.isReference(e),X=e=>!v.isInstance(e),G=function(e){e.data.nodeModel.select()},q=function(t){return e.is(t.options.unselectEventToken)},H=function(e){return e.options.grid.MIL_suggestion},J=t=>n=>{let o=!1;const a=H(n);return e.is(a)&&(o=a.value===t),o},Q=function(t){let n=!1;if(function(t){let n=!1;const o=(e=>e.options.defaultMILSuggestionValue)(t);return e.is(o)&&(n=J(o)(t)),n}(t)){const o=H(t);e.is(o)&&(n=[A.Replace_By_NewRev,A.Replace_By_NewBranch,A.Reroute_ScopeLink].some(e=>e.value===o.value))}return n},Y=function(e){if(!q(e)){e.isSelected()||e.select();const t=e.onUnselect(G);e.options.unselectEventToken=t}},Z=function(e){q(e)&&(e.removeEventListener(e.options.unselectEventToken),e.options.unselectEventToken=null)},$=function(e){return e.getAttributeValue("cellInfo")},ee=function(e){return d(e)},te=function(t,n){const o=(e,t)=>({invalidNodes:e,errorMessage:t}),a=t=>{let n=null;const a=t.filter(t=>((e=>"partiallyExpanded"===e.getState())(t)||(e=>"collapsed"===e.getState())(t))&&function(t){let n=!1;return(t=>{let n=!1;const o=$(t);return e.is(o)&&(n=o.isLeaf),n})(t)||(n=Q(t)),n}(t));if(a.length>0){const e=P.getNLSValue("MIL.expandNeeded");n=o(a,e)}return n},i=t=>{let n=null;const a=t.filter(t=>(t=>{let n=!1;const o=H(t);if(o.value!==A.Delete.value&&o.value!==A.MadeFrom_UseCase_Att_Remove.value&&o.value!==A.MadeFrom_UseCase_Att_Add.value&&o.value!==A.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value){const o=$(t);if(e.is(o)){const t=o.candidateId;n=!e.is(t)}}return n})(t));if(a.length>0){const e=P.getNLSValue("MIL.candidateNeeded");n=o(a,e)}return n},l=(t=>{let n=a(t);return e.is(n)||(n=i(t)),n})(t),s=e.is(l);return s&&m.showWithMessage("",l.errorMessage,{messages:l.invalidNodes.map(e=>e.getLabel()),token:n}),!s},ne=function(t){return e.owns(t,"isRef")&&!0===t.isRef},oe=function(t){return e.owns(t,"isLeaf")&&!0===t.isLeaf},ae=e=>o(e),ie=function(t){const o=J(A.Ignore.value),l=n(t=>{let n={};if(!o(t)){const o=$(t);if(e.is(o)){let i,s=e.clone(o.inconsistentObject);if(ae(o.candidateEntries)){const{candidatePathStr:t,candidateProductRefId:n}=(t=>{let n={candidatePathStr:null,candidateProductRefId:null};if(e.owns(t,"candidateOccPath")&&Array.isArray(t.candidateOccPath)){const o=t.candidateOccPath;if(n.candidatePathStr=o.join(","),ne(t.inconsistentObject))n.candidateProductRefId=a(o);else{const t=v.getInstance(a(o));e.is(t)&&(n.candidateProductRefId=t.get("isInstanceOf"))}}return n})(o);e.is(t)&&e.is(n)&&(s.candidatePaths=[t],e.owns(s,"candidateProduct")&&(s.candidateProduct=n))}if(s=((e,t)=>{let n=e;switch(t){case A.Replace_By_Existing.value:n.MbomUpdateAction=B,Array.isArray(n.candidateScopedMfgItem)&&1===n.candidateScopedMfgItem.length&&(n.referecePID=n.candidateScopedMfgItem[0]);break;case A.Reroute_ImplementLink.value:n.MbomUpdateAction=E;break;case A.Evolve_Instance.value:n.MbomUpdateAction=F,n.referecePID=n.isInstanceOf;break;case A.Reroute_ImplementAndScopeLink.value:n.MbomUpdateAction=C,n.referecePID=n.isInstanceOf;break;case A.Replace_By_New.value:n.MbomUpdateAction=U,n.referecePID=n.isInstanceOf;break;case A.Replace_By_NewBranch.value:n.MbomUpdateAction=w,n.referecePID=n.isInstanceOf;break;case A.Delete.value:n.MbomUpdateAction=T;break;case A.Replace_By_NewRev.value:n.MbomUpdateAction=D,n.referecePID=n.isInstanceOf;break;case A.Reroute_ScopeLink.value:n.MbomUpdateAction=V;break;case A.MadeFrom_UseCase_Att_Add.value:n.MbomUpdateAction="ManufacturingMadeFrom";break;case A.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value:n.MbomUpdateAction="ManufacturingAssembly";break;case A.MadeFrom_UseCase_Att_Remove.value:n.MbomUpdateAction="RemoveUseCase"}return n})(s,o.action),e.owns(s,"aggregatedByPath")&&(s.rootMfgItemPID=ee(s.aggregatedByPath)),s.MbomUpdateAction===V?s.referecePID=s.id:(s.instancePID=u(s.id),s.mfgOccPathPIDs=s.id),s.brokenMfgPID=o.mbomId,i=s.MbomUpdateAction!==T&&s.MbomUpdateAction!==x&&s.MbomUpdateAction!==j&&s.MbomUpdateAction!==W?I(s.candidatePaths):s.id,t.hasChildren()){let e={};for(const n of t.getChildren(!0)){const t=l(n);e={...e,...t}}s.children=e}n[i]=[s]}}return n}),s=(t,n)=>{let o={...t};const a=(t=>Object.values(t).reduce((t,n)=>{const o=n.reduce((t,n)=>(e.owns(n,"children")&&(t=t.concat(n.children)),t),[]);return t.concat(o)},[]))(n);a.length>0&&a.forEach(e=>{Object.keys(e).forEach(e=>{delete o[e]})});const i=Object.entries(n).reduce((t,[n,a])=>(t[n]=e.owns(o,n)?o[n].concat(a):a,t),{});return{...o,...i}},c=n(n=>{let o=t.filter(e=>e.isRoot()).find(e=>e.getReferencePID()===n);return e.is(o)||(o=null),o}),r=t=>{let n=null;if((t=>e.is(c(t)))(t)){const o=c(t),{candidateId:a}=(t=>{let n={candidateId:null,candidateOccPath:null};const o=$(t);return e.is(o)&&(n.candidateId=o.candidateId,n.candidateOccPath=o.candidateOccPath),n})(o);n=a}else n=function(e){let t=null;const n=b.getScopeLinksOfImplementing(e);return 1===n.length&&(t=i(n).get("to")),t}(t);let o="";return e.is(n)&&e.owns(y,n)&&(o=y[n]),o},d=(t,n)=>{let o;if(e.owns(n,"engConfigFilter")&&e.owns(n,"mfgConfigFilter"))o=n;else{const a=(t=>e.owns(k,t)?k[t]:"")(t),i=r(t);o={...n,engConfigFilter:i,mfgConfigFilter:a}}return o},p=e=>(e=>{let t;return t=e.MbomUpdateAction===V?e.brokenMfgPID:e.rootMfgItemPID})(i(e)),g=new Set(t),f=t.filter(e=>e.getParents().every(e=>!g.has(e))).reduce((e,t)=>{const n=l(t);return e=s(e,n)},{});var m;return m=f,Object.entries(m).reduce((t,[n,o])=>{const a=p(o),i={brokenMfgItems:{[n]:o}};if(e.owns(t,a)){const e=t[a];t[a]={...e,brokenMfgItems:{...e.brokenMfgItems,...i.brokenMfgItems}}}else t[a]=i;return t[a]=d(a,t[a]),t},{})},le=function(){const t=(t,n)=>t.filter(t=>{let o=!1;const a=$(t);return e.is(a)&&(o=n(a)),o}),n=h.getSelectedNodes();if(n.length>0){const o=P.getNLSValue("MIL.LogMessage"),a=p.log(o);te(n,a)?(t=>new Promise((n,o)=>{let a=!1;const i=t.filter(e=>q(e));if(i.length>0){const t=A.Ignore.value,l=i.filter(e=>H(e).value===t);if(l.length>0){a=!0;const t=P.getNLSValue("MIL.confirmIgnoreToLooseIL.Title"),i=P.getNLSValue("MIL.confirmIgnoreToLooseIL"),s=l.map(e=>v.getReference(e.getReferencePID()));m.showConfirmation(t,i,{attributes:["PLMEntity.V_Name","revision"],models:s},function(t){e.is(t,"boolean")?n(t):o("Unknown value")})}}a||n(!0)}))(n).then(function(i){if(i){const i=n.filter(t=>e.is($(t)));(t=>new Promise((n,o)=>{M.webservice("rerouteLink",null,t,function(t){e.is(t)?n(t):o()})}))(ie(i)).then(function(n){h.prepareUpdate();const l=n.succeeded;if(e.is(l)){const e=Object.values(l);if(e.length>0){const n=e.reduce((e,t)=>{const n=Object.keys(t).map(e=>u(e));return s(e,new Set(n))},new Set),o=t(i,e=>n.has(e.mbomId)),l=(e=>t=>{let n=t;const o=function(e){return e.getInstancePID()||e.getReferencePID()}(n);h.unSelectNode(o),n.options.grid.MIL_status=P.getNLSValue("MIL.Status.Success"),n.options.milStatus="success",n.updateOptions(n.options);const a=n.options.grid,i=P.getNLSValue("MIL.Message.Success",{suggestion:a.MIL_suggestion.label,mfg:n.getLabel()});p.log(i,e)})(a);o.forEach(l)}}const c=n.failed;e.is(c)&&Object.values(c).forEach(e=>{const n=Object.keys(e).reduce((e,t)=>{const n=u(t);return e.set(n,t)},new Map),o=t(i,e=>n.has(e.mbomId)),l=(e=>(t,n)=>{let o=t;o.options.grid.MIL_status=n,o.options.milStatus="fail",o.options.grid.cellInfo.inconsistentObject.MbomUpdateAction=null,o.updateOptions(o.options);const a=o.options.grid,i=P.getNLSValue("MIL.Message.Failure",{suggestion:a.MIL_suggestion.label,mfg:o.getLabel(),failureMsg:n});p.log(i,e)})(a);o.forEach(t=>{const o=$(t).mbomId,a=n.get(o),i=P.getNLSValue(e[a].message,null,"MIL","FailureMessage");l(t,i)})}),h.pushUpdate(),(t=>{let n=!1;return e.is(t.failed,"object")&&(n=Object.keys(t.failed).length>0),n})(n)?p.warn(P.getNLSValue("MIL.Failure"),a):p.info(P.getNLSValue("MIL.Success"),a),p.log(g(o,P.getNLSValue("completed")),a,"completed")}).catch(function(){p.log("rerouteLink webservice failed"),p.log(g(o,P.getNLSValue("failed")),a,"failed")})}else p.log(g(o,P.getNLSValue("failed")),a,"failed")}):p.log(g(o,P.getNLSValue("failed")),a,"failed")}},se=function(t,n){const o=t=>new Promise((o,a)=>{if(n.size>0){const i=t.filter(function(t){return!e.owns(t._attributes,"isInstanceOf")}).map(e=>e.get("PID"));if(i.length===n.size&&i.every(e=>n.has(e)))o();else{const e=new Set(i),t=function(e,t){const n=e.size<t.size;let o=new Set(e);for(const e of t)if(o.delete(e),n&&0===o.size)break;return o}(n,e);t.size>0?v.fetchRoot(Array.from(t),{forceDBMode:!0,silent:!0,onComplete:o,onFailure:a}):o()}}else o()});return(t=>new Promise((n,o)=>{t.length>0?v.fetchInstancesAndTheirReferences(t,{onComplete:function(t){e.owns(t,"instancesAndReferences")?n(t.instancesAndReferences):o("callbackResult.instancesAndReferences is not valid")},onFailure:o}):n([])}))(Array.from(t)).then(function(e){return o(e)})},ce=function(t){const n=e.owns(t,"candidatePaths"),o=t.status;let a=null;if(n){const n=e.owns(t,"candidateScopedMfgItem");switch(t.status){case"ImplCandidatePrdOccWithScopeToOldRev":case"ImplCandPrdOccToOtherRev":a=n?A.Replace_By_Existing:A.Replace_By_NewRev;break;case"ImplCandidatePrdOccButNotCorrespondingScope":case"ImplCandPrdOccToDiffPrd":a=n?A.Replace_By_Existing:A.Replace_By_New;break;case"ImplCandidatePrdOccWithGoodScope":a=A.Reroute_ImplementLink;break;case"ImplCandPrdOccToSamePrdEvolveInstance":case"ImplCandidatePrdOccWithGoodScopeEvolveInstance":a=A.Evolve_Instance;break;case"ImplCandPrdOccToSamePrd":a=A.Reroute_ImplementAndScopeLink;break;case"ImplNoProductOccurence":a=A.Delete;break;case"ScopeToAncestorBranch":case"ScopeToOldRev":case"ScopeToNew":a=A.Reroute_ScopeLink;break;case"ImplCandPrdOccToAncestorBranch":case"ImplCandidatePrdOccWithScopeToAncestorBranch":a=n?A.Replace_By_Existing:A.Replace_By_NewBranch}}else a="MadeFrom_UseCase_Att_Add"===o?A.MadeFrom_UseCase_Att_Add:"MadeFrom_UseCase_Att_Remove"===o?A.MadeFrom_UseCase_Att_Remove:A.Delete;return a},re=t=>n=>{let o=null;if(e.owns(n,"pointedPaths")){const e=u(n.pointedPaths);o=t(e)}return o},ue=re(e=>v.getInstance(e)),de=re(e=>v.getReference(e)),pe=function(e){return e.get("type")},ge=c(pe,P.getIconURLFromKey),Ie=function(t,n){const a=t=>{let n={productName:null,iconURL:null};const o=de(t);return e.is(o)&&(n.productName=z(o,null),n.iconURL=ge(o)),n},l=(e,t)=>({productName:e,candidatePath:t}),s=t=>{const n=ne(t)?t=>{let n=null;const o=v.getReference(u(t));return e.is(o)&&(n=z(o,null)),l(n,t)}:t=>{let n=null;const o=v.getInstance(u(t));if(e.is(o)){const t=v.getReferenceModelFromInstance(o);e.is(t)&&(n=z(t,o))}return l(n,t)};let o=[];return Array.isArray(t.candidatePaths)&&(o=t.candidatePaths.map(e=>n(e))),o},c=e=>({labelItem:e.productName,valueItem:e.candidatePath.toString()}),d=e=>({candidateEntries:[(()=>({labelItem:P.getNLSValue("MIL.SelectCandidate"),valueItem:"#SELECT"}))(),...e],firstCandidateProduct:(()=>{const e=P.getNLSValue("MIL.SelectCandidate");return l(e,"#SELECT")})()}),p=(e,t)=>{const n=e=>({label:e.labelItem,value:e.valueItem,tooltip:e.labelItem,getLabel:function(){return this.label}});let o;if(e.length>0)o=n(c(t));else{const e=P.getNLSValue("MIL.RerouteNone");o=n({labelItem:e,valueItem:e})}return o},g=(t,n,o,a,i,l,s,c,d)=>{const g=e.is(n)?n:null,I=ge(t),f=(t=>{let n=null;return e.is(t)&&e.owns(t,"candidatePath")&&"#SELECT"!==t.candidatePath&&(n=t.candidatePath),n})(a);return{label:z(t,g),icons:[I],useAsyncPreExpand:!0,referencePID:t.get("PID"),referenceType:pe(t),instancePID:e.is(g)?g.get("PID"):null,mfgOccPathArr:e.is(g)?r(d.id):[],defaultMILSuggestionValue:s.value,milStatus:null,children:[],grid:{MIL_suggestion:s,MIL_rerouting:p(o,a),MIL_previous:e.owns(l,"productName")?l.productName:P.getNLSValue("MIL.PrevisionUnknown"),MIL_status:"",cellInfo:{mbomId:e.is(g)?g.get("PID"):t.get("PID"),candidateId:e.is(f)?u(f):null,candidateOccPath:e.is(f)?r(f):null,action:s.value,candidateEntries:i,suggestionToPerformEntries:c,PreviousProdIconUrl:e.owns(l,"iconURL")?l.iconURL:null,MfgItemIconUrl:I,inconsistentObject:e.clone(d),isLeaf:oe(d)}}}},I=n||{},m=Array.isArray(I.forbiddenSuggestions)?I.forbiddenSuggestions:[];let L;if(ne(t)){const n=v.getReference(t.id),o=a(t),l=s(t);let r=l.map(e=>c(e)),u=i(l,null),p=ce(t);if(e.is(p)){let e=new f(A);e.from(p).addDefaultOption().addAdditionalOptions(),ae(l)&&({candidateEntries:r,firstCandidateProduct:u}=d(r)),e.addIgnoreOption(),L=g(n,null,l,u,r,o,p,e.toArray(),t)}}else{const n=u(t.id),l=v.getInstance(n),r=v.getReferenceModelFromInstance(l),p=(t=>{let n={productName:null,iconURL:null};const o=ue(t);if(e.is(o)){const t=v.getReferenceModelFromInstance(o);e.is(t)&&(n.productName=z(t,o),n.iconURL=ge(t))}else if(e.owns(t,"isInstanceOf")){const o=M.getBIModel(t.isInstanceOf);if(e.is(o)&&ne(o._attributes)){const e=o._attributes;n=a(e)}}return n})(t),I=s(t);let h=I.map(e=>c(e)),P=i(I,null),_=ce(t);if(e.is(_)){let e=new f(A);e.from(_).addDefaultOption().addAdditionalOptions(),o(I)&&({candidateEntries:h,firstCandidateProduct:P}=d(h)),e.addIgnoreOption(),e.removeOptions(m),L=g(r,l,I,P,h,p,_,e.toArray(),t)}}return L},fe=function(t,n,o,a){const l=e=>v.isReferencesHasReadOnlyType(e.referenceType),s=e=>o.some(t=>u(t.id)===e),c=(t,n=null)=>{let o=null;const a=h.getNodeModel(t);if(Array.isArray(a))if(1===a.length)o=i(a);else if(a.length>1)if(Array.isArray(n)){const t=a.find(t=>e.equals(t.options.mfgOccPathArr,n));e.is(t)&&(o=t)}else o=i(a);return o},d=(t,n=null)=>e.is(c(t,n));let p=a||{};if(!e.is(p.considerInstancesOnly,"boolean")||!p.considerInstancesOnly){const o=t.reduce((e,t)=>e.set(t.id,t),new Map),a=n.reduce((e,t)=>{const n=t.isInstanceOf;if(o.has(n)){const t=o.get(n);e.add(t)}return e},new Set);(a.size>0?t.filter(e=>!a.has(e)):t).forEach(t=>{const n=Ie(t,p);if(e.is(n)&&function(e){let t,n=!1;const o=_.getRoots();return 2===o.length&&(t=o[1]),Array.isArray(t)&&(n=t.includes(e)),n}(n.referencePID)&&!l(n)){const e=(e=>h.addNodeModel(e))(n),o=oe(t)?"noChildren":"partiallyExpanded";h.updateNodeState(e,o)}})}(t=>t.map(t=>{const n=u(t.id),o=v.getInstance(n);let a=e.clone(t);return a.V_TreeOrder=o.get("V_TreeOrder"),a}).slice().sort((e,t)=>Number(e.V_TreeOrder)-Number(t.V_TreeOrder)))(n).forEach(t=>{if(e.owns(t,"aggregatedByPath")){const n=e.owns(t,"aggregatedByPathTillRoot")?t.aggregatedByPathTillRoot:t.aggregatedByPath,o=ee(n);let a=d(o)?c(o):(e=>{const t=v.getReference(e),n={label:z(t,null),icons:[ge(t)],useAsyncPreExpand:!0,referencePID:t.id,referenceType:pe(t),instancePID:null,mfgOccPathArr:[],defaultMILSuggestionValue:null,grid:{},children:[],milStatus:"success",cellInfo:{mbomId:null,candidateId:null,candidateOccPath:null,action:null,candidateEntries:null,suggestionToPerformEntries:null,PreviousProdIconUrl:null,MfgItemIconUrl:null,inconsistentObject:null}};return h.addNodeModel(n)})(o),i=!e.is(a.options.defaultMILSuggestionValue);const u=r(t.id),g=u.length>0?u.slice(0,u.length-1):u;if(g.length>0){const e=g.length;for(let t=0;t<e;t++){const e=g[t];if(!s(e)){const n=g.slice(0,t+1);d(e,n)&&(a=c(e,n))}}}let I=!1;if(i||t.status.startsWith("MadeFrom_UseCase_Att")&&(I=!0),e.is(a)&&!I){const n=Ie(t,p);if(e.is(n)&&!l(n)){const e=((e,t)=>h.addNodeModel(t,e))(a,n),o=oe(t)?"noChildren":"partiallyExpanded";h.updateNodeState(e,o)}}}})},me=function(t,n,o){const a=t=>n=>{let o=[];const a=u(n.id);if(t(a)&&o.push(a),Array.isArray(n.candidatePaths)){const e=n.candidatePaths.map(e=>u(e)).filter(t);o=o.concat(e)}if(e.owns(n,"pointedPaths")){const e=u(n.pointedPaths);t(e)&&o.push(e)}return o},i=a(K),l=a(X);return new Promise((e,a)=>{if(Array.isArray(t)){const c=function(e,t){let n=new Map;n.set(!0,[]),n.set(!1,[]);for(const o of e){const e=t(o),a=o;n.set(e,n.get(e).concat(a))}return n}(t.map(e=>e._attributes),e=>ne(e)),r=c.get(!0),u=c.get(!1),d=r.reduce((e,t)=>{const n=i(t);return n.length>0&&(e=s(e,new Set(n))),e},new Set),p=u.reduce((e,t)=>{const n=l(t);return n.length>0&&(e=s(e,new Set(n))),e},new Set);se(p,d).then(function(){fe(r,u,n,o),e()}).catch(function(e){a(e)})}else a("brokenMfgItems is not a valid array")})},Le=function(t,n){return new Promise((o,i)=>{const s=M.getPhantomNodeItems(),c=t.map(t=>(t=>{let n=null;if(ne(t)){if(e.owns(t,"pointedPaths")){const e=r(t.pointedPaths);n=a(e)}}else{const o=ue(t);e.is(o)&&(n=o.get("isInstanceOf"))}return n})(t._attributes)).filter(t=>e.is(t)).reduce(l,new Set);(e=>new Promise((t,n)=>{e.length>0?v.fetchRoot(e,{forceDBMode:!0,silent:!0,onComplete:t,onFailure:n}):t()}))(Array.from(c).filter(K)).then(function(){me(t,s,n).then(o,i)})})},he=function(e){let t=!1;return e.isRoot()||(t=q(e.getParent())),t},Me=function(e){return e.getBrothers().some(e=>q(e))},ve=function(t){let n=!1;return t.isRoot()&&(n=e.is(H(t))),n},Pe=function(t){const n=(t,n,o)=>{t.preExpandDone(),t.pushUpdate(),e.is(o)&&""!==o&&h.updateNodeState(t,o),p.notify("stopProgress",n)},o=e=>e.options.grid.cellInfo.inconsistentObject,a=t=>new Promise(function(n,a){let i={};const l=t.getReferencePID(),s=(t=>{const n=o(t);let a=null;return a=e.owns(n,"candidateProduct")?n.candidateProduct:(e=>e.options.grid.cellInfo.candidateId)(t)})(t);if(e.is(l)&&e.is(s)){const c=o(t);let r={rootEBOM:[s],rootMBOM:[l],areRootsBroken:!0,rootMBOMConfigFilter:k,rootEBOMConfigFilter:y,forceBIComputation:!0};e.owns(c,"aggregatedByPath")&&(r.prefix={mfgAggByPath:c.aggregatedByPath,mfgOccPath:c.id,mfgInstanceLID:c.instanceLID}),p.notify("startProgress",i),M.getBrokenMfgItemStatus(r,function(e){Le(e,{considerInstancesOnly:!0}).then(function(){t.hasChildren()?(t.getChildren(!0).forEach(function(e){Y(e)}),Y(t)):(he(t)||Me(t))&&Y(t),p.notify("stopProgress",i),n()}).catch(function(e){p.notify("stopProgress",i),a(e)})})}else a()});if(e.is(t)&&e.owns(t,"data")&&e.owns(t.data,"nodeModel")){let e=t.data.nodeModel,o={};((e,t)=>{p.notify("startProgress",t),e.prepareUpdate()})(e,o),e.isRoot()||q(e)&&(he(e)||Me(e)||Z(e)),(e=>{let t=!1;return e.isRoot()&&!ve(e)||Q(e)&&(t=!0),t})(e)?a(e).then(function(){n(e,o)}).catch(function(){n(e,o)}):n(e,o)}},_e=function(t){const n=e=>{e.hasChildren()&&(e.getAllDescendants(null,!0).forEach(e=>{Z(e),e.isSelected()&&e.unselect()}),e.removeChildren())};if(e.is(t)&&e.owns(t,"data")&&e.owns(t.data,"nodeModel")){let e=t.data.nodeModel;e.isRoot()?ve(e)&&(n(e),q(e)&&Z(e)):(n(e),q(e)&&(he(e)||Z(e))),(e=>Q(e))(e)&&h.updateNodeState(e,"partiallyExpanded")}},Re=function(){const t=h.getSelectedNodes();Array.isArray(t)&&t.length>0&&t.forEach(e=>Z(e)),e.is(N)&&(h.removeEventListener(N),N=null),e.is(O)&&(h.removeEventListener(O),O=null),R.clearPseudoBIStatus()};return S=new t(p,m,L,h,P,R),e.extend(S,{init(t){const n=e=>Array.isArray(e)&&e.length>0;let o=t||{},a=h.getWUXNodeModel();h.removePreExpandListener(),N=a.onPreExpand(Pe),O=a.onPostCollapse(_e);const{rootProducts:i,rootProcesses:l}=function(){let e=null,t=null;const n=_.getRoots();return 2===n.length&&(e=n[0],t=n[1]),{rootProducts:e,rootProcesses:t}}();if(((e,t)=>n(e)&&n(t))(i,l)){const t=_.getCompatibleConfigurationFilters(l),n=_.getCompatibleConfigurationFilters(i);if(e.is(t)&&e.is(n)){k=t,y=n,this.buildSkeleton({manageInconsistentLinksCmdId:o.manageInconsistentLinksCmdId,onApplyCallBack:le,cancelButtonLabel:P.getNLSValue("MIL.PanelCloseButton"),cleanup:Re});let e={};p.notify("startProgress",e),M.getBrokenMfgItemStatus({rootEBOM:i,rootMBOM:l,rootMBOMConfigFilter:k,rootEBOMConfigFilter:y,forceBIComputation:!0},function(t){Le(t).then(function(){p.notify("stopProgress",e),p.notify("CIMLoaded")})})}else p.warn(P.getNLSValue("BI.Computation.IncompatibleFilter"))}}})}}),define("DS/DELPPWMILModule/MILModule",["UWA/Core","DS/DELPPWMILModule/MFNChangeImpactMgmtUI"],function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","TreeListViewBehavior","WUXNodeModelBehavior","MfgItemBehavior","ModelBehavior","ResourceBehavior","RootsBehavior","BIBehavior","ProductImplementBehavior"],creator:function(e,n,o,a,i,l,s,c,r,u){var d=null,p=function(){d.setApplyButtonState()};return{name:"MILModule",listenTo:function(){return{select:p}},onStart:function(p){let g=p||{};(d=new t(e,n,o,a,i,l,s,c,r,u)).init(g),d.loadUI()},onStop:function(){d.destroy(!0),d=void 0}}}}}),define("DS/DELPPWMILModule/MILMfgProcessNItemUI",["UWA/Core","DS/DELPPWMILModule/ManageInconsistentLinksBaseUI"],function(e,t){"use strict";return function(n,o,a,i,l,s,c,r,u,d){var p,g,I,f,m,L,h,M,v,P,_,R=new t(n,o,a,i,c,u),b={className:""},S=[],k=[],y={},N=[];return g=function(){var e;return e=r.getRoots(),S=e[0],k=e[1],!(!S||Array.isArray(S)&&S.length<=0||!k||Array.isArray(k)&&k.length<=0)},I=function(){p={Reroute_ScopeLink:{label:c.getNLSValue("MIL.Reroute.ScopeLink"),value:1,tooltip:c.getNLSValue("MIL.ToolTip.RerouteScope"),getLabel:function(){return this.tooltip}},Delete_ScopeLink:{label:c.getNLSValue("MIL.Delete.ScopeLink"),value:7,tooltip:c.getNLSValue("MIL.ToolTip.DeleteScope"),getLabel:function(){return this.tooltip}},Reroute_ImplementLink:{label:c.getNLSValue("MIL.Reroute.ImplementLink"),value:2,tooltip:c.getNLSValue("MIL.ToolTip.RerouteImplement"),getLabel:function(){return this.tooltip}},Add_ImplementLink:{label:c.getNLSValue("MIL.Add.ImplementLink"),value:6,tooltip:c.getNLSValue("MIL.ToolTip.AddImplement"),getLabel:function(){return this.tooltip}},RemoveLink:{label:c.getNLSValue("MIL.RemoveLink"),value:3,tooltip:c.getNLSValue("MIL.ToolTip.RemoveLink"),getLabel:function(){return this.tooltip}},Reroute_UsagePointLink:{label:c.getNLSValue("MIL.Reroute.UsagePointLink"),value:8,tooltip:c.getNLSValue("MIL.ToolTip.RerouteUsagePoint"),getLabel:function(){return this.tooltip}},Delete_UsagePointLink:{label:c.getNLSValue("MIL.Delete.UsagePointLink"),value:9,tooltip:c.getNLSValue("MIL.ToolTip.DeleteUsagePoint"),getLabel:function(){return this.tooltip}},Delete:{label:c.getNLSValue("MIL.Delete"),value:4,tooltip:c.getNLSValue("MIL.ToolTip.Delete"),getLabel:function(){return this.tooltip}},Ignore:{label:c.getNLSValue("MIL.Ignore"),value:5,getLabel:function(){return this.label}}}},m=function(t,n,o,a){var l=[],r=[],u={labelItem:p.Reroute_ScopeLink.label,valueItem:p.Reroute_ScopeLink.value,tooltip:p.Reroute_ScopeLink.tooltip},d={labelItem:p.Delete_ScopeLink.label,valueItem:p.Delete_ScopeLink.value,tooltip:p.Delete_ScopeLink.tooltip},g={labelItem:p.Reroute_ImplementLink.label,valueItem:p.Reroute_ImplementLink.value,tooltip:p.Reroute_ImplementLink.tooltip},I={labelItem:p.Add_ImplementLink.label,valueItem:p.Add_ImplementLink.value,tooltip:p.Add_ImplementLink.tooltip},f={labelItem:p.Reroute_UsagePointLink.label,valueItem:p.Reroute_UsagePointLink.value,tooltip:p.Reroute_UsagePointLink.tooltip},m={labelItem:p.Delete_UsagePointLink.label,valueItem:p.Delete_UsagePointLink.value,tooltip:p.Delete_UsagePointLink.tooltip},L={labelItem:p.Delete.label,valueItem:p.Delete.value,tooltip:p.Delete.tooltip},M={labelItem:p.RemoveLink.label,valueItem:p.RemoveLink.value,tooltip:p.RemoveLink.tooltip},v={labelItem:p.Ignore.label,valueItem:p.Ignore.value};i.emptyNodeModel(),i.prepareUpdate(),Object.values(t).forEach(function(t){var n,o,a,l,r,g,I,f,m,L,M=[],P=[];t.candidates.length>0?(P.push(u,d,v),f=p.Reroute_ScopeLink,t.candidates.forEach(function(t){var n=s.getReference(t.candidateRefPID);a=e.is(n)?h(n,null):t.candidateRefPID,M.push({labelItem:a,valueItem:t.candidateRefPID,tooltip:a})})):(P.push(d,v),f=p.Ignore,a=c.getNLSValue("MIL.RerouteNone"),M.push({labelItem:a,valueItem:"",tooltip:a})),m=s.getReference(t.pointedRefPID),e.is(m)?(g=h(m,null),I=c.getIconURLFromKey(m.get("type"))):g=t.pointedRefPID,L=s.getReference(t.implementedRefPID),e.is(L)&&(l=h(L,null),r=c.getIconURLFromKey(L.get("type"))),n={MIL_suggestion:f,MIL_rerouting:M[0],MIL_previous:e.is(g)?g:c.getNLSValue("MIL.PrevisionUnknown"),MIL_manufactured:l,MIL_status:"",cellInfo:{suggestionToPerformEntries:P,candidateEntries:M,PreviousProdIconUrl:I,MfgItemIconUrl:r,action:f.value,mfgprocessId:t.implementedRefPID,pointedPaths:t.pointedRefPID}},o={referencePID:t.linkPID,linkPID:t.linkPID,linkInfos:t,linkType:"ScopeLink",grid:n,milStatus:null},i.addNodeModel(o)}),Object.values(n).forEach(function(t){var n,o,a,u,d,f,m,P,_,R,b,S,k,y,N,O,A,D,B,U,w,E,C,V,T=[],F=[],x=!0;if(N=(y=t.implementedOccPath.split(","))[y.length-1],O=s.getInstance(N),(C=!!e.is(t.isLinkBroken)&&t.isLinkBroken)||(U=t.pointedOccPath.split(","),w=s.getInstance(U[0]),e.is(w)&&(E=w.get("isAggregatedBy"))),t.candidates.length>0){if(F.push(g,M,L,v),_=p.Reroute_ImplementLink,D=s.getImpactedConnections([N],null,{relationTypes:["ProcessImplementLinkOcc"]}),B=[],D.forEach(function(e){B.push(e.get("to").toString())}),t.candidates.forEach(function(t){var n,o,a,i=t.candidateOccPath.split(","),l=i[i.length-1],c=s.getInstance(l);!C&&x&&(o=s.getInstance(i[0]),e.is(o)&&(a=o.get("isAggregatedBy")),E!==a&&(x=!1)),B.indexOf(t.candidateOccPath)>-1||(e.is(c)?(n=s.getReferenceModelFromInstance(c),u=h(n,c)):u=t.candidateOccPath,T.push({labelItem:u,valueItem:t.candidateOccPath,tooltip:u}))}),0===T.length)return;!C&&x&&(F.unshift(I),_=p.Add_ImplementLink)}else F.push(M,L,v),_=p.RemoveLink,u=c.getNLSValue("MIL.RerouteNone"),T.push({labelItem:u,valueItem:"",tooltip:u});b=(R=t.pointedOccPath.split(","))[R.length-1],S=s.getInstance(b),e.is(S)?(k=s.getReferenceModelFromInstance(S),m=h(k,S),P=c.getIconURLFromKey(k.get("type"))):m="",e.is(O)&&(A=s.getReferenceModelFromInstance(O),d=h(A,O),f=c.getIconURLFromKey(A.get("type"))),V=e.is(t.custorole)&&""!==t.custorole?c.getNLSValue("Role."+t.custorole):e.is(t.role)?t.role:"",o={MIL_suggestion:_,MIL_rerouting:T[0],MIL_previous:e.is(m)?m:c.getNLSValue("MIL.PrevisionUnknown"),MIL_manufactured:d,MIL_role:V,MIL_status:"",cellInfo:{suggestionToPerformEntries:F,candidateEntries:T,PreviousProdIconUrl:P,MfgItemIconUrl:f,action:_.value,mfgprocessId:N,mfgProcessOccPath:t.implementedOccPath,linkPID:t.linkPID,pointedPaths:t.pointedOccPath}},a={referencePID:t.linkPID,linkPID:t.linkPID,linkInfos:t,linkType:"OccOccIMplementLink",grid:o,milStatus:null},n=i.addNodeModel(a),_===p.Delete&&(l.push(n),r.push(t.linkPID))}),Object.values(o).forEach(function(t){var n,o,a,u,d,f,m,P,_,R,b,S,k,y,N,O,A,D,B,U,w,E,C=[],V=[],T=!0;if(y=t.implementedOccPath,N=s.getReference(y),(w=!!e.is(t.isLinkBroken)&&t.isLinkBroken)||(D=t.pointedOccPath.split(","),B=s.getInstance(D[0]),e.is(B)&&(U=B.get("isAggregatedBy"))),t.candidates.length>0){if(V.push(g,M,L,v),_=p.Reroute_ImplementLink,O=s.getImpactedConnections([y],null,{relationTypes:["ProcessImplementLinkOcc"]}),A=[],O.forEach(function(e){A.push(e.get("to").toString())}),t.candidates.forEach(function(t){var n,o,a,i=t.candidateOccPath.split(","),l=i[i.length-1],c=s.getInstance(l);!w&&T&&(o=s.getInstance(i[0]),e.is(o)&&(a=o.get("isAggregatedBy")),U!==a&&(T=!1)),A.indexOf(t.candidateOccPath)>-1||(e.is(c)?(n=s.getReferenceModelFromInstance(c),u=h(n,c)):u=t.candidateOccPath,C.push({labelItem:u,valueItem:t.candidateOccPath,tooltip:u}))}),0===C.length)return;!w&&T&&(V.unshift(I),_=p.Add_ImplementLink)}else V.push(M,L,v),_=p.RemoveLink,u=c.getNLSValue("MIL.RerouteNone"),C.push({labelItem:u,valueItem:"",tooltip:u});b=(R=t.pointedOccPath.split(","))[R.length-1],S=s.getInstance(b),e.is(S)?(k=s.getReferenceModelFromInstance(S),m=h(k,S),P=c.getIconURLFromKey(k.get("type"))):m="",e.is(N)&&(d=h(N),f=c.getIconURLFromKey(N.get("type"))),E=e.is(t.custorole)&&""!==t.custorole?c.getNLSValue("Role."+t.custorole):e.is(t.role)?t.role:"",o={MIL_suggestion:_,MIL_rerouting:C[0],MIL_previous:e.is(m)?m:c.getNLSValue("MIL.PrevisionUnknown"),MIL_manufactured:d,MIL_role:E,MIL_status:"",cellInfo:{suggestionToPerformEntries:V,candidateEntries:C,PreviousProdIconUrl:P,MfgItemIconUrl:f,action:_.value,mfgprocessId:y,mfgProcessOccPath:t.implementedOccPath,linkPID:t.linkPID,pointedPaths:t.pointedOccPath}},a={referencePID:t.linkPID,linkPID:t.linkPID,linkInfos:t,linkType:"OccOccIMplementLink",grid:o,milStatus:null},n=i.addNodeModel(a),_===p.Delete&&(l.push(n),r.push(t.linkPID))}),Object.values(a).forEach(function(t){var n,o,a,l,r,u,d,g,I,L,M,P,_=[],R=[];t.candidates.length>0?(t.pointedOccPath&&(M=t.pointedOccPath.split(","),R.push(f,m,v),g=p.Reroute_UsagePointLink,L=s.getInstance(M[M.length-1])),t.candidates.forEach(function(t){var n,o,i;t.candidateInstPID&&(o=t.candidateInstPID.split(","),i=s.getInstance(o[o.length-1]),n=e.is(i)?s.getReference(i.get("isInstanceOf")):null,a=e.is(i)&&e.is(n)?h(n,i):t.candidateItemInst,_.push({labelItem:a,valueItem:t.candidateInstPID,tooltip:a}))})):(R.push(m,v),g=p.Delete_UsagePointLink,a=c.getNLSValue("MIL.RerouteNone"),_.push({labelItem:a,valueItem:"",tooltip:a})),e.is(L)?(I=s.getReference(L.get("isInstanceOf")),u=e.is(I)?h(I,L):t.pointedInstPID,d=e.is(I)?c.getIconURLFromKey(I.get("type")):null):u="",P=s.getReference(t.implementedRefPID),e.is(P)&&(l=h(P,null),r=c.getIconURLFromKey(P.get("type"))),n={MIL_suggestion:g,MIL_rerouting:_[0],MIL_previous:e.is(u)?u:c.getNLSValue("MIL.PrevisionUnknown"),MIL_manufactured:l,MIL_status:"",cellInfo:{suggestionToPerformEntries:R,candidateEntries:_,PreviousProdIconUrl:d,MfgItemIconUrl:r,action:g.value,mfgprocessId:t.implementedRefPID,pointedPaths:t.pointedRefPID,pointedOccPaths:t.pointedOccPath}},o={referencePID:t.linkPID,linkPID:t.linkPID,linkInfos:t,linkType:"UsagePoint",grid:n,milStatus:null},i.addNodeModel(o)}),i.getAllDescendants().forEach(function(e){var t;-1===r.indexOf(e.options.linkPID)&&"OccOccIMplementLink"===e.options.linkType&&(t=e.options.linkInfos.implementedOccPath.split(","),l.some(function(n){var o,a=n.options.linkInfos.implementedOccPath.split(","),l=a[a.length-1],s=t.indexOf(l);return s>-1&&s<t.length?(e.options.grid.MIL_status=c.getNLSValue("MIL.Status.Ignore.ImpactedObjDelete",{objectTitle:n.options.grid.MIL_manufactured}),e.options.grid.MIL_suggestion=p.Ignore,e.options.milStatus="ignore",i.updateNode(e.options.linkPID,e.options),o=!0):o=!1,o}))}),i.pushUpdate()},L=function(t){var n=[],o=[],a={},i={},l={},c={},r=[];t.forEach(function(t){t.has("impactedScopes")&&t.get("impactedScopes").forEach(function(t){var o=s.getReference(t.implementedRefPID);e.is(o)&&(t.candidates.forEach(function(t){var o=s.getReference(t.candidateRefPID);e.is(o)||n.push(t.candidateRefPID)}),a[t.linkPID]=t)}),t.has("impactedOccOccImplementLinks")&&t.get("impactedOccOccImplementLinks").forEach(function(t){var n=t.implementedOccPath.split(","),a=n[n.length-1],l=s.getInstance(a);e.is(l)&&(t.candidates.forEach(function(t){var n=t.candidateOccPath.split(","),a=n[n.length-1],i=s.getInstance(a);e.is(i)||o.push(a)}),i[t.linkPID]=t)}),t.has("impactedRefOccImplementLinks")&&t.get("impactedRefOccImplementLinks").forEach(function(t){var n=t.implementedOccPath.split(","),a=n[n.length-1],i=s.getReference(a);e.is(i)&&(t.candidates.forEach(function(t){var n=t.candidateOccPath.split(","),a=n[n.length-1],i=s.getInstance(a);e.is(i)||o.push(a)}),l[t.linkPID]=t)}),t.has("impactedUsagePoints")&&t.get("impactedUsagePoints").forEach(function(t){var n=s.getReference(t.implementedRefPID);e.is(n)&&(t.candidates.forEach(function(t){var n,a=t.candidateInstPID.split(","),i=a[a.length-1];i&&(n=s.getInstance(i),e.is(n)||o.push(t.candidateInstPID))}),c[t.usagePointSID]=t)})}),n.length>0&&r.push(new Promise(function(e,t){s.fetchRoot(n,{silent:!0,onComplete:e,onFailure:t})})),o.length>0&&r.push(new Promise(function(e,t){s.fetchInstancesAndTheirReferences(o,{silent:!0,onComplete:e,onFailure:t})})),e.Promise.allSettled(r).then(function(){m(a,i,l,c)}).catch(function(){})},f=function(){var t,o,a=i.getSelectedNodes(),s=[],r=c.getNLSValue("MIL.LogMessage"),u=!1,g="RerouteIL",I="AddIL",f="RerouteSL",m="DeleteSL",L="RerouteUP",h="DeleteUP",M="Delete",v="RemoveLink";a.forEach(function(n){var o;switch((t=n.options.grid.cellInfo).action){case p.Reroute_ScopeLink.value:o=f;break;case p.Delete_ScopeLink.value:o=m;break;case p.Reroute_UsagePointLink.value:o=L;break;case p.Delete_UsagePointLink.value:o=h;break;case p.RemoveLink.value:o=v;break;case p.Delete.value:o=M;break;case p.Reroute_ImplementLink.value:o=g;break;case p.Add_ImplementLink.value:o=I}e.is(o)&&"ignore"!==n.options.milStatus&&(s.push({MfgProcessUpdateAction:o,mfgProcessOccPath:e.is(t.mfgProcessOccPath)?t.mfgProcessOccPath:t.mfgprocessId,pointedPaths:t.pointedPaths,pointedOccPaths:t.pointedOccPaths,candidatePaths:n.options.grid.MIL_rerouting.valueItem,custoRole:d.getCustoRoleFromNLS(n.options.grid.MIL_role),role:d.getOotbRoleFromCustoRole(n.options.grid.MIL_role),linkPID:n.options.linkPID,dimension:n.options.linkInfos.dimension,quantity:n.options.linkInfos.quantity}),o===L&&(u=!0))}),o=n.log(r),l.webservice("rerouteLink",null,s,function(t){var l,s,d;i.prepareUpdate(),l=t.succeeded,s=t.failed,d=t.deletedConnections,a.forEach(function(e){var t,a,r=e.options.linkPID,u=d.indexOf(r);u>-1&&d.splice(u,1),l.indexOf(r)>-1?(e.options.grid.MIL_status=c.getNLSValue("MIL.Status.Success"),e.options.milStatus="success",i.unSelectNode(r),i.updateNode(r,e.options),t=c.getNLSValue("MIL.Message.Success",{suggestion:e.options.grid.MIL_suggestion.label,mfg:e.options.grid.MIL_manufactured}),n.log(t,o)):s.indexOf(r)>-1&&(e.options.milStatus="fail",i.updateNode(r,e.options),a=c.getNLSValue("MIL.Message.Failure",{suggestion:e.options.grid.MIL_suggestion.label,mfg:e.options.grid.MIL_manufactured}),n.log(a,o))}),e.is(d)&&d.length>0&&i.removeNodes(d),i.pushUpdate(),s.length>0?n.warn(c.getNLSValue("MIL.Failure"),o):(n.info(c.getNLSValue("MIL.Success"),o),u&&n.info(c.getNLSValue("MIL.Success.RerouteUsagePoint"),o)),n.log(r+" "+c.getNLSValue("completed"),o)})},h=function(t,n){var o=t.get("PLMEntity.V_Name")+" "+t.get("revision");return e.is(n)&&(o=o+"("+n.get("PLMInstance.PLM_ExternalID")+")"),o},M=function(t){var n,o,a=t.data.nodeModel;"MIL_suggestion"===t.data.changedAttribute&&e.is(a.options.linkInfos.implementedOccPath)&&(n=a.options.linkInfos.implementedOccPath.split(","),o=n[n.length-1],i.prepareUpdate(),t.data.nodeModel.getBrothers().forEach(function(n){var l,s=n.options.linkInfos.implementedOccPath.split(","),r=s.indexOf(o);r>-1&&r<s.length&&(t.data.changedAttributeValue.label===p.Delete.label&&null===n.options.milStatus?l="applyIgnore":"ignore"===n.options.milStatus&&(l="removeIgnore")),e.is(l)&&("applyIgnore"===l?(n.options.grid.MIL_status=c.getNLSValue("MIL.Status.Ignore.ImpactedObjDelete",{objectTitle:a.options.grid.MIL_manufactured}),n.options.grid.MIL_suggestion=p.Ignore,n.options.milStatus="ignore"):(n.options.grid.MIL_status="",n.options.milStatus=null),i.unSelectNode(n.options.linkPID),i.updateNode(n.options.linkPID,n.options))}),i.pushUpdate())},v=function(){N.push(i.addEventListener("attributeChanged",M))},P=function(){N.forEach(function(e){i.removeEventListener(e)})},_=R.destroy,e.extend(R,{init:function(t){(b=e.extend(b,t)).onApplyCallBack=f,g()&&(I(),this.buildSkeleton(b),n.notify("startProgress",y),l.getBrokenMfgProcessStatus({rootSystems:k,rootItems:S},function(e){L(e),v(),n.notify("stopProgress",y)}))},destroy:function(){_.call(this),P()}})}}),define("DS/DELPPWMILModule/MILMfgProcessNItemModule",["DS/DELPPWMILModule/MILMfgProcessNItemUI"],function(e){"use strict";return{behaviors:["UXFactoryBehavior","TreeListViewBehavior","WUXNodeModelBehavior","MfgProcessBehavior","ModelBehavior","ResourceBehavior","RootsBehavior","BIBehavior","ProcessImplementBehavior"],creator:function(t,n,o,a,i,l,s,c,r,u){var d=null,p=function(){d.setApplyButtonState()};return{name:"MILMfgProcessNItemModule",listenTo:function(){return{select:p}},onStart:function(p){(d=new e(t,n,o,a,i,l,s,c,r,u)).init(p),d.loadUI()},onStop:function(){d.destroy(),d=void 0}}}}});