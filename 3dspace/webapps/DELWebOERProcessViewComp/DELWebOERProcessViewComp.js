define("DS/DELWebOERProcessViewComp/mixins/ProcessToolbarMixin",["UWA/Core","DS/DELWebOERCommonUtils/utils/CommonUtils"],function(e,t){"use strict";const o="PERTView",i="SwitchMode",n="WorkInstructions",s="defaultViewerMode",a="BuildUp";return{getToolbarDefination:function(o){let i=this;return{entries:[{id:"PERTView",dataElements:{typeRepresentation:"PERTview",value:!1,onNodeUpdate:i.onPERTViewChange.bind(i),position:"far",category:"1"}},{id:"SwitchMode",dataElements:{typeRepresentation:"switchMode",value:!e.is(o.SwitchMode)||o.SwitchMode,onNodeUpdate:i.onSwitchModeChange.bind(i),disabled:!0,position:"far",category:"2"}}],typeRepresentations:{switchMode:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:{iconPath:t.getAssetsUrl("DELWebOERProcessViewComp","icons/22/I_DELSwitchToProductBuildUp.png")},tooltip:{shortHelp:i._nls.get("Toolbar.SwitchToProductBuildUp.ToolTip.shortHelp")}},{value:"false",icon:{iconPath:t.getAssetsUrl("DELWebOERProcessViewComp","icons/22/I_DELSwitchToWKIView.png")},tooltip:{shortHelp:i._nls.get("Toolbar.SwitchToWKIView.ToolTip.shortHelp")}}]}},PERTview:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:{iconPath:t.getAssetsUrl("DELWebOERProcessViewComp","icons/32/I_DEL_ProductFlow.png"),className:"del-toolbarcommand-active"},tooltip:{shortHelp:i._nls.get("Toolbar.PERTView.ToolTip")}},{value:"false",icon:{iconPath:t.getAssetsUrl("DELWebOERProcessViewComp","icons/32/I_DEL_ProductFlow.png")},tooltip:{shortHelp:i._nls.get("Toolbar.PERTView.ToolTip")}}]}}}}},onPERTViewChange:async function(e,t={}){await this.getCommandHandler().setCheckState({id:"DELWebOERTogglePERTViewCmd",state:t.data})},onSwitchModeChange:function(e,t={}){let o=this,i=t.data;!0===i?o.executeCommand({handlerId:"DELWebOERSetMode",args:{mode:n}}):!1===i&&o.executeCommand({handlerId:"DELWebOERSetMode",args:{mode:a}})},onDELWebOERPERTViewCmdClose:function(){this.getTableView().getToolbar().updateNodeModel(o,{grid:{data:!1}})},onModeChange:function(e={}){let t=e.data,o=this.getTableView()||{},n=o&&o.getToolbar?o.getToolbar():null,s={disabled:!0};if(n){switch(t){case"BuildUp":s={disabled:!1,grid:{data:!1}};break;case"WorkInstructions":s={disabled:!1,grid:{data:!0}}}n.updateNodeModel(i,s)}},buildToolbar:function(e){let t=this.getComponentConfig()||{};this.toolbarDiv=this.getTableView().setToolbar(this.getToolbarDefination({[i]:t[s]===n})),this.toolbarDiv.inject(e)},destroyToolbar:function(){this.toolbarDiv&&(this.toolbarDiv.destroy(),this.toolbarDiv=null)}}}),define("DS/DELWebOERProcessViewComp/model/DELWebOERProcessDocument",["UWA/Core","DS/DELWebOERTableViewComp/model/DELWebPPRNode","DS/Logger/Logger","DS/DELWebOERTableViewComp/model/DELWebOERItemDocument","text!DS/DELWebOERProcessViewComp/assets/json/ProcessExpandConfig.json"],function(e,t,o,i,n){"use strict";var s=JSON.parse(n),a=s.ENUMS,r=s.occurrences,l=s.references,c=s.instances;return i.extend({init:function(e={}){if(this._parent(e),!e.executionContext)throw new Error("Execution Context is not provided, it is mandatory to provide exeuctionContext");this._executionContext=e.executionContext,this._logger=o.getLogger("DELWebOERProcessDocument")},_createProcessTree:function(o={}){var i,n,d=this._executionContext.getComponent("Store"),u=d.useDispatch(),p=[],m=[],{response:h,filter:g}=o||{},f=h.member[0],b=e.is(o.installPath,"array")&&o.installPath.length>0?o.installPath:null,C=b?b[b.length-1]:"",E=b?b.slice(0,-1):[],D=function(e){return b&&Array.isArray(e)&&e.length>0&&C===e[0]&&(e=E.concat(e)),e},P=function(e={}){let{id:t,from:o,to:i=[]}=e;u(d.actions.addConnection({id:t,from:o,to:i.join("/")}))},I=function(e){var i=e.id?e.id:"",n=e[a.Taxonomies]||"",r={grid:{buildUp:function(e={}){let i=!0===o.usePublishedContent?"PublishedBuildUpNotRequiredTypes":"DynamicBuildUpNotRequiredTypes",n=s[i],r=e[a.Taxonomies],l=t.prototype.ENUM_BUILDUP.DEACTIVATE;r&&!0===n.some(e=>r.contains(e))&&(l=null);return l}(e)},referenceId:i,label:e[a.Title]?e[a.Title]:"",type:e[a.Type]?e[a.Type]:"",icons:e[a.Icon]?[e[a.Icon]]:[],isWorkplan:n.contains(a.WorkplanType)};return Object.keys(e).forEach(t=>{-1!==p.indexOf(t)&&(r.grid[t+".reference"]=e[t])}),function(e={}){u(d.actions.addReference(e))}({id:e.id,type:e[a.Type],label:e[a.Title]}),function(e,t){t.consumedMfgItems=[],t.consumedCapableResource=[],t.hasScope=!1,e[a.ItemSpecification]&&e[a.ItemSpecification].totalItems>0&&e[a.ItemSpecification].member.forEach(function(e){let o=D([e.itemRef]);t.consumedMfgItems.push(o),t.hasScope=e.isScope,P({id:e.id,from:e.composer,to:o})}),e[a.CapableResources]&&e[a.CapableResources].totalItems>0&&e[a.CapableResources].member.forEach(function(e){t.consumedCapableResource.push(e.resource?e.resource:"")}),e[a.PrimaryCapableResource]&&e[a.PrimaryCapableResource].totalItems>0&&e[a.PrimaryCapableResource].member.forEach(function(e){t.consumedCapableResource.push(e.resource?e.resource:"")}),e[a.SecondaryCapableResource]&&e[a.SecondaryCapableResource].totalItems>0&&e[a.SecondaryCapableResource].member.forEach(function(e){t.consumedCapableResource.push(e.resource?e.resource:"")})}(e,r),r},R=function(e){var t={grid:{},instanceId:e.id,instanceType:e.type};return Object.keys(e).forEach(o=>{-1!==m.indexOf(o)&&(t.grid[o+".instance"]=e[o])}),function(e={}){u(d.actions.addInstance(e))}({id:e.id,type:e[a.Type],label:e[a.Title],from:e.from,to:e.to}),t};e.is(o.Columns,"array")&&o.Columns.forEach(function(e){!function(e,t,o){if(o){let i=o.split(".");"reference"===i[1]?e.push(i[0]):"instance"===i[1]&&t.push(i[0])}}(p,m,e.dataIndex)}),f?((i=I(f)).grid.buildUp=-1,n=new t(e.merge(i,{badges:g?this.getBadgeOptions("filter"):null})),this._model.addRoot(n),this._model.prepareUpdate(),function o(i,n){var s=function(n){var s=function(t){var o={path:t.id?t.id.split("/"):[],grid:{}};return c.forEach(function(i){t[a[i]]&&e.extend(o,R(t[a[i]]),!0)}),l.forEach(function(i){t[a[i]]&&e.extend(o,I(t[a[i]]),!0)}),t[a.ItemSpecificationOcc]&&t[a.ItemSpecificationOcc].totalItems>0&&(o.consumedMfgItems=[],t[a.ItemSpecificationOcc].member.forEach(function(e){let i=D(e.itemOcc);o.consumedMfgItems.push(i),P({id:e.id,from:t.id,to:i})})),o}(n),r=new t(s);i.addChild(r),o(r,n)};n[a.MfgProcess]&&n[a.MfgProcess][a.MfgOperationOcc]&&n[a.MfgProcess][a.MfgOperationOcc].totalItems>0&&n[a.MfgProcess][a.MfgOperationOcc][a.Member].forEach(e=>{s(e)}),r.forEach(function(e){n[a[e]]&&n[a[e]].totalItems>0&&n[a[e]][a.Member].forEach(e=>{s(e)})})}(n,f),this._model.pushUpdate()):this._logger.error("Process data not found")},loadData:function(e){this._createProcessTree(e)},hasIntermediateScope:function(e){let t=this,o=!1,i=this.getNodeFromID(e);return i&&i.processDescendants({processNode:function(e={}){let i={stopProcessing:!1,shouldProcessDescendants:!0};return t.hasScope(e.nodeModel)?(o=!0,i.stopProcessing=!0):t.isWorkplan(e.nodeModel)||(i.shouldProcessDescendants=!1),i}}),o},hasScope:function(e={}){let t=!1;return e.options&&(t=e.options.hasScope),t},isWorkplan:function(e={}){let t=!1;return e.options&&(t=e.options.isWorkplan),t}})}),define("DS/DELWebOERProcessViewComp/commands/DELWebOERPERTViewCmd",["DS/DELPPWProductFlowFacet/facets/ProductFlowSequenceFacet","DS/DELWebCommonControls/DELWebPanel","DS/DELWebOERCommonUtils/utils/CommonUtils","i18n!DS/DELWebOERProcessViewComp/assets/nls/ProcessViewComp","css!DS/DELWebOERProcessViewComp/assets/css/ProcessViewComp.css"],function(e,t,o,i){"use strict";let n;return{open:function(s,a){let r,l=a.executionContext,c=l.getComponent(WAfrStandardComponentKey.ModelEvents),d=UWA.createElement("div",{class:"del-pertview-container"}),u=l.getComponent("PROCESS").getRoots();n=new t({identifier:"pertView",domId:"pertView",title:i.get("PERTView.title"),immersiveFrame:l.getComponent(WAfrStandardComponentKey.UIFrame).getImmersiveFrame(),content:d,resizableFlag:!0,verticallyStretchableFlag:!0,horizontallyStretchableFlag:!0,width:300,height:300}),(r=new e({})).inject(d),r.updateFacet({objectId:u[0].id,filterQuery:u[0].withFilter?o.getValue(u[0].filter,"config_filter"):null}),c.publish({event:"onDELWebOERPERTViewCmdOpen"}),n.addEventListener("close",function(){n.destroy(),c.publish({event:"onDELWebOERPERTViewCmdClose"})}),s()},close:function(e){n&&(n.destroy(),n=null),e()}}}),define("DS/DELWebOERProcessViewComp/mixins/BuildUpColumnHandlerMixin",["DS/DELWebOERCommonUtils/utils/TrackUtils"],function(e){"use strict";const t="buildUp";var o;return{_buildUpColumnBehavior:function(){let e,o;return{updateState:function(i){let n=this.getComponentConfig()||{};UWA.is(i.isProcessLoaded,"boolean")&&(e=i.isProcessLoaded),UWA.is(i.is2DStructureLoaded,"boolean")&&(o=i.is2DStructureLoaded),UWA.is(e,"boolean")&&o&&(function(e){var t,o=this._model.getTreeDocument();o&&(t=o.getRoots())&&t.length>0&&t.forEach(t=>{t.updateOptions({grid:e})})}.call(this,{[t]:e?n.usePublishedContent?null:0:-1}),function(e){let o=this.getTableView();o&&o.updateColumn(t,e)}.call(this,i&&i.eventparams?i.eventparams:{visibleFlag:e,disabled:!e}),e=o=null)},reset:function(){e=o=null}}}(),updateBuildColumn:function(t){var i,n,s=this.getWidgetComponent();if(t&&((i=t.getAttributeValue("buildUp"))===t.ENUM_BUILDUP.ACTIVATE||i===t.ENUM_BUILDUP.DEACTIVATE)){let a=i===t.ENUM_BUILDUP.ACTIVATE?"DeactivateBuildup":"ActivateBuildup";e.trackChanges({executionContext:this.getExecutionContext(),category:"Buildup",action:a,label:a,dims:{pd1:s.getValue("defaultViewerMode"),pd2:s.getValue("usePublishedContent")?"True":"False"}}),n=i===t.ENUM_BUILDUP.ACTIVATE?t.ENUM_BUILDUP.DEACTIVATE:t.ENUM_BUILDUP.ACTIVATE,o&&o.setAttribute("buildUp",t.ENUM_BUILDUP.DEACTIVATE),t.setAttribute("buildUp",n),function(e,t){(!o||o.getRirPath().toString()!==e.getRirPath().toString()&&t)&&(o=e)}(t,n)}},onBuildUpActivated:function(e={}){let t=e.data||{},o=this.getModel().getNodeFromPath(t.path),i=this,n=function(e){i._tableView.ensureNodeModelVisible(e,!1,!0),e.getAttributeValue("buildUp")===e.ENUM_BUILDUP.DEACTIVATE&&i.updateBuildColumn.call(i,e)};if(o)n(o);else{let e=t&&UWA.is(t.path,"array")&&t.path[0]||"",s=this.subscribe({event:"on2DRootAdded"},function(a){a&&a.data&&a.data.id===e&&((o=i.getModel().getNodeFromPath(t.path))&&n(o),i.unsubscribe(s),s=null)})}},onBuildUpDeactivated:function(e={}){let t=e.data||{},o=this.getModel().getNodeFromPath(t.path);o&&o.getAttributeValue("buildUp")===o.ENUM_BUILDUP.ACTIVATE&&this.updateBuildColumn.call(this,o)},updateBuildupColumn:function(e){this._buildUpColumnBehavior.updateState.call(this,e)}}}),define("DS/DELWebOERProcessViewComp/actions/StandardActions",["DS/Logger/Logger"],function(e){"use strict";const t=e.getLogger("DS/DELWeb3DOpersReviewAppCommands/DELWebOERHomeCmd");return{toggleBuildUp:async function(e,o){let i,{executionContext:n}=o,s=n.getComponent(WAfrStandardComponentKey.HandlerComponent),{node:a,activateBuildUpHandlerId:r,deactivateBuildUpHandlerId:l}=o.args||{};if(a){switch(a.getAttributeValue("buildUp")){case a.ENUM_BUILDUP.ACTIVATE:i=l;break;case a.ENUM_BUILDUP.DEACTIVATE:i=r}i&&(s.hasHandler(i)?await s.executeHandler({id:i,args:{path:a.getRirPath()}}):t.warn(`${i} Handler not found, please include correct package in your app id card`))}e()}}}),define("DS/DELWebOERProcessViewComp/model/DELWebOERProcessViewModel",["UWA/Core","UWA/Class","DS/DELWebOERTableViewComp/model/DELWebOERTableViewModel","DS/DELWebOERProcessViewComp/model/DELWebOERProcessDocument","DS/DELWebOERCommonUtils/utils/CommonUtils","text!DS/DELWebOERProcessViewComp/assets/json/ProcessExpandConfig.json"],function(e,t,o,i,n,s){"use strict";const a="scopedMfg",r="resource",l="dsprcs:MfgProcessOcc",c="dsprcs:CapableResources";return o.extend({init:function(e){this._parent(e)},createDocument:function(){this._document=new i({executionContext:this.executionContext})},getCommonServices:function(){return this.executionContext.getComponent("DELCommonUtilsServices")},get3DSpaceUrl:function(){return this.executionContext.getComponent("DELCommonUtilsServices").get3DSpaceUrl()},_prepareData:function(e,t,o){if(o){let i=o.split(".");"reference"===i[1]?e.push(i[0]):"instance"===i[1]&&t.push(i[0])}},_getProcessPayload:function(t){var o,i=this,a=JSON.parse(s),r=a.payload,l=a.references,c=a.instances;return r.id=t.id?t.id:"",e.is(t.Columns,"array")&&t.Columns.forEach(function(e){l.forEach(function(t){i._prepareData(r.dynamicMask["dsprcs:"+t],[],e.dataIndex)}),c.forEach(function(t){i._prepareData([],r.dynamicMask["dsprcs:"+t],e.dataIndex)})}),t.filter&&(r.config_filter=n.getValue(t.filter,"config_filter"),(o=n.getValue(t.filter,"config_filter_id"))&&(r.config_filter_id=o.physical_id)),t.scopedMfg&&t.scopedMfg.id&&(r.parameters.mfgItemId=t.scopedMfg.id),r},getData:function(t){var o,i=this;return t&&t.id?(n.markStart("processExpand"),o=new e.Promise(function(e,o){i.webservices.executeRequestPromise(`${i.get3DSpaceUrl()}/resources/v1/modeler/dsprcs/invoke/dsprcs:expand`,{method:"POST",payload:i._getProcessPayload(t)}).then(function(t){n.markEnd("processExpand","Advanced process expand completed in"),e(t)}).fail(o)})):o=e.Promise.reject("Invalid Input Provided"),o},loadModel:async function(t={}){let o=t[a]?t[a].occurrence:null,i=this.getContextId(t);t.id=i;let n=await this.getData(t);if(t.occurrence&&t.occurrence.length>0){let o={};!function t(o,i,n){let s,a;if(o.member){let r=o.member.findIndex(e=>i.includes(e.id));r>=0&&(n.totalItems=1,n.member=[],e.extend(n.member,[o.member[r]],!0),s=o.member[r][l],a=n.member[0][l],s&&t(s,i,a))}}(n,t.occurrence.join("/"),o),n=o}var s;return(s=n)&&s.member[0]&&t[r]&&(s.member[0][c]={totalItems:1,member:[{resource:t[r].id}]}),this._document.removeRoot(t.id),await this._document.loadData({...t,response:n,installPath:o}),t},getMfgItems:function(e={}){let t=this,o=e.path,i={path:[]};return o&&o.forEach(e=>{let o=(t.getNodeFromPathV2(e).getConsumedItems()||{}).MfgItems||[];i.path.push(...o)}),i},getCapableResources:function(e={}){let t=this,o=e.path,i={path:[]};return o&&o.forEach(e=>{let o=(t.getNodeFromPathV2(e).getConsumedItems()||{}).Resources||[],n=[];o.forEach(e=>{let t=this.executionContext.getComponent("PROCESS_RESOURCE");if(t){let o=t.getPathFromId(e);n.push(o)}}),i.path.push(...n)}),i},getTextualInstructionInstances:function(e={}){let t=this,o=e.path,i=[],n=t.getCommonServices();return o&&o.forEach(e=>{let o=t.getNodeFromPathV2(e);o.getReferenceType&&n.isWKIType(o.getReferenceType())&&i.push(o.getInstanceId())}),{pid:i}},getRelations:function(e={}){let t=this.getMfgItems(e),o=this.getCapableResources(e);return{path:[...t.path,...o.path],doNotProcessDrills:!0}},hasIntermediateScope:function(e){return this._document.hasIntermediateScope(e)}})}),define("DS/DELWebOERProcessViewComp/ProcessViewComp",["DS/DELWebOERTableViewComp/TableViewComp","DS/DELWebOERProcessViewComp/model/DELWebOERProcessViewModel","DS/DELWebOERProcessViewComp/mixins/ProcessToolbarMixin","DS/DELWebOERProcessViewComp/mixins/BuildUpColumnHandlerMixin","DS/DELWebOERCommonUtils/mixins/IndexServicesMixin","DS/DELWebOERCommonUtils/utils/CommonUtils","css!DS/DELWebOERProcessViewComp/assets/css/ProcessViewComp.css"],function(e,t,o,i,n,s){"use strict";class a extends e{constructor(e){super(e)}async initialize(){await super.initialize(),this._buildupRetryCount=0,[{eventName:{event:"onModelChange:mode"},callback:this.onModeChange},{eventName:{event:"onDELWebOERPERTViewCmdClose"},callback:this.onDELWebOERPERTViewCmdClose},{eventName:{event:"onBuildUpActivated"},callback:this.onBuildUpActivated},{eventName:{event:"onBuildUpDeactivated"},callback:this.onBuildUpDeactivated},{eventName:{event:"onProcessLoadCompleted"},callback:this.updateBuildupColumn.bind(this,{isProcessLoaded:!0})},{eventName:{event:"onProcessLoadFailed"},callback:this.updateBuildupColumn.bind(this,{isProcessLoaded:!1})},{eventName:{event:"onBuildupInitializeComplete"},callback:this._onBuildupInitialized},{eventName:{event:"onBuildupInitializeFailed"},callback:this._onBuildupInitializationFailed},{eventName:{event:"onBuildupConnectionFailed"},callback:this._onBuildupConnectionFailed},{eventName:{event:"on2DRootAdded"},callback:this.on2DRootAdded},{eventName:{event:"DS/DELWebViewer/onSelectView"},callback:this.highlightLinkedInstructions}].forEach(e=>{this.subscribe(e.eventName,e.callback.bind(this))})}_onBuildupConnectionFailed(e){let t,o=this,i=this.getComponentFromIdentifier("WidgetLinkManager"),n=this.getComponentFromIdentifier("SessionModel"),s=this.getComponentFromIdentifier(WAfrStandardComponentKey.HandlerComponent),a=function(e){o.getNotificationManager().addNotif({level:"warning",message:o._nls.get(e)})};i.isLinked()||(s.executeHandler({id:"DELWeb3DViewerDeactivateBuildUp",args:e.data}),3===o._buildupRetryCount?(o.updateBuildupColumn({isProcessLoaded:!1,is2DStructureLoaded:!0}),a("BuildupFailed.Error.Message"),o._buildupRetryCount=0):(t=n.get("roots")[0],o.updateBuildupColumn({isProcessLoaded:!1,is2DStructureLoaded:!0,eventparams:{disabled:!0}}),s.executeHandler({id:"DELWeb3DViewerInitializeBuildUp",args:t}),a("BuildupActivate.Retry.Message"),t.buildupFailedOperation=e.data,o._buildupRetryCount++,n.set("roots",[t])))}_onBuildupInitialized(){let e,t=this.getComponentFromIdentifier("SessionModel"),o=this.getComponentFromIdentifier(WAfrStandardComponentKey.HandlerComponent);this.updateBuildupColumn({isProcessLoaded:!0,is2DStructureLoaded:!0}),e=t.get("roots")[0].buildupFailedOperation,o.executeHandler({id:"DELWeb3DViewerActivateBuildUp",args:e})}_onBuildupInitializationFailed(){this.updateBuildupColumn({isProcessLoaded:!1,is2DStructureLoaded:!0})}getNls(){return this._nls}on2DRootAdded(e){if(e.origin&&e.origin===this.getRegisteredIdentifier()){let e=this,t=this.getRoots()||[],o=this.getComponentConfig()||{};if(this.updateBuildupColumn({is2DStructureLoaded:!0}),!1===o.usePublishedContent){if(t.some(t=>e.getModel().hasIntermediateScope(t.id))){let t=e.getNls();e.getNotificationManager().addNotif({level:"warning",message:t.get("IntermediateScopeFound.Warn.Message"),title:t.get("DynamicMode.Title")})}}}}createModel(e){this._model=new t({executionContext:this.getExecutionContext(),enableCrossPreHighlight:e.enableCrossPreHighlight,webservices:s.bindComponentToMixin(this,n)})}setContainer(e){super.setContainer(e),this.buildToolbar(e)}async addRoots(e={}){let t=this;(e.items||[]).forEach(async e=>{if(t._compConfig.authorizedPPRTypes.includes(e.pprType)&&!e.scopedMfg){t.getNotificationManager().addNotif({level:"error",message:t._nls.get("ScopedMfgNotFound.Error.Message")})}}),await super.addRoots(e)}async removeRoots(e){await super.removeRoots(e)}async empty(){let e=this.getComponentFromIdentifier("Store"),t=e.useDispatch();await super.empty(),this.destroyToolbar(),t(e.actions.removeAll())}getModel(){return this._model}highlightLinkedInstructions(e={}){let t=this.getModel(),o=e.data;if(t.clearSelection(),t.clearHighlight(),o&&UWA.is(o.textualInstructionPIds,"array")){let e=o.textualInstructionPIds.map(e=>t.getPathFromId(null,e));t.highlight({path:e})}}getExposedComponent(){return this.publicAPI=super.getExposedComponent(),this.publicAPI.getMfgItems=this._model.getMfgItems.bind(this._model),this.publicAPI.getCapableResources=this._model.getCapableResources.bind(this._model),this.publicAPI.getTextualInstructionInstances=this._model.getTextualInstructionInstances.bind(this._model),this.publicAPI.getRelations=this._model.getRelations.bind(this._model),this.publicAPI}}return a.prototype.mixinProperties(a,o),a.prototype.mixinProperties(a,i),a});