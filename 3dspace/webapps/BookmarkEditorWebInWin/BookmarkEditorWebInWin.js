define("DS/BookmarkEditorWebInWin/BookmarkWebInWin",["DS/i3DXCompass/Data","DS/WAFData/WAFData","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/PADServices/utils/WidgetProxy","UWA/Drivers/Alone","DS/BksStandalone/Ajax"],function(e,t,n,o,i,s,a,r){var d=window.bookmark.params;console.log("Inside BookmarkWebInWin"),widget.setValue("noCompass",!0),widget.setValue("x3dAppId","ENOFOL3_AP");var l="boolean"==typeof d.standalone&&d.standalone;widget.setValue("standalone",l),widget.id=Math.round(1e3*Math.random()).toString(),widget.setValue("x3dSharedId",widget.id),d.userId&&(window.top.dsUserLogin=d.userId);var c=d.tenantId||d.tenant;window.bookmark.params.tenant=c,(c=c||o.getTenantId())&&(widget.setValue("x3dPlatformId",c),n.setSetting("x3dPlatformId",c),s.setValue("x3dPlatformId",c));let u=["folderTreeSelectedNode","FolderCusto_treelistview","vMigration","folderTreeStructure"],m="ENOFOL3AP_Preferences";function f(){let e=localStorage.getItem(m),t=JSON.parse(e);for(var n in t)widget.setValue(n,t[n]);widget.addEvent("onUpdateValue",e=>{u.indexOf(e)>=0&&function(){let e={};u.forEach(t=>{let n=widget.getValue(t);e[t]=n}),localStorage.setItem(m,JSON.stringify(e))}()})}function p(){return new Promise(async e=>{var n=await new Promise(e=>{i.get3DSpaceUrlAsync({onComplete:e})});if(n){var o=n+"/resources/modeler/pno/person?current=true&select=firstname&select=lastname",s={type:"json",method:"GET",headers:{Accept:"application/json"}};s.onComplete=e,s.onFailure=e.bind(null,!1),s.onTimeout=e.bind(null,!1),t.authenticatedRequest(o,s)}else e(null)})}return new Promise(async t=>{f();var n=!widget.body;widget.body=widget.body?widget.body:UWA.createElement("div"),widget.body.addClassName("FolderEditor"),widget.body.setStyles({height:"100%",width:"100%",position:"relative","text-align":"initial","z-index":0}),window.COMPASS_CONFIG=window.COMPASS_CONFIG?window.COMPASS_CONFIG:{myAppsBaseUrl:d.myAppsUrl,userId:d.userId,lang:d.lang},e.initialize({myAppsBaseUrl:d.myAppsUrl,userId:d.userId,passportUrl:"",proxyTicketUrl:""});let o=await p();widget.userId=o.userId||o.name,widget.fullName=o.firstname+" "+o.lastname,widget.userId&&(window.top.dsUserLogin=widget.userId),document.body.getElement("#tempDiv").remove(),n&&widget.body.inject(document.body,"top"),window.top.performance.mark("createWidget_begin");var i=new FolderEditor({widget:widget,defaultSelectionPath:d.defaultSelectionPath,contextID:d.contextID,launchWithReadMode:d.launchWithReadMode,folderToOpen:d.folderToOpen,multiselection:!1!==d.multiselection,nativeAuthMode:d.switchtoAuthoringMode});1==window.Odt&&(window.swFolderEditor=i),widget.dispatchEvent("onResize"),t(i)})});let prereqCEF="DS/WebInWinUtils/dscef",prereqList=["i18n!DS/BookmarkEditorWebInWin/assets/nls/BookmarkWebInWin"];window.dscef||prereqList.push(prereqCEF),define("DS/BookmarkEditorWebInWin/BookmarkEditorWebInWin",prereqList,e=>{require(["DS/UWPClientCode/PublicAPI"]);var t=null;let n={},o=0,i={},s={refreshSession:function(){Object.keys(i).length>0&&require(["DS/IPClassifyUtil/IPClassifyCommunication"],e=>{e.publish("refreshSession",{mapIds:i}),i={}})},onObjectInSessionCheck:function(t){let o=t.objectsMatched,s=t.inSessionIds,a=t.commId,r=n[a],d=r.promiseResolve;r&&delete n[a],o&&(i={...i,...s},require(["DS/IPClassifyUtil/IPClassifyAlert"],t=>{let n=UWA.createElement("a",{styles:{cursor:"pointer"},text:e.refresh,onmouseup:"window.refreshSession()"});t.displayNotification({...e.sessionRefreshNeeded,messageHtml:n})})),d()},onModifiedObjectsCheck:function(t){let o=t.objectsMatched,i=t.inSessionIds,s=t.commId,a=n[s],r=a.promiseResolve;a&&delete n[s];require(["DS/IPClassifyUXUtil/IPConfirmationDialog","DS/FolderEditor/utils/FolderLoaderGlobal"],(t,n)=>{if(o){n.removeComponentToLoad("global","checkInSession");let o=a.nlsInfo.title?a.nlsInfo.title:"";o&&(o+=" - ");let s=Object.keys(a.mapObjects).length;if(s>1)o+=e.replace(e.titleNbObject,{nb:s});else{o+=Object.values(i)[0]}t.confirmDialog({className:"updateConfirmation",immersiveFrame:widget.immersiveFrame,title:o,message:e.confirmUpdateMsg,details:e.confirmationMsg,type:"warning",buttonLabels:{Yes:a.nlsInfo.button?a.nlsInfo.button:e.continueUpdate,No:e.cancelUpdate}}).then(()=>{r({continue:!0})}).catch(e=>{e&&console.log(e),r({continue:!1})})}else n.removeComponentToLoad("global","checkInSession"),r({continue:!0})})},confirmModifiedInSession:async function(t,{title:i,button:s}){return new Promise(a=>{require(["DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/utils/FolderLoaderGlobal"],(r,d)=>{let l={isCancelled:!1,cancel:function(){this.isCancelled=!0,a({continue:!1})}};d.addComponentsToLoad("global",{checkInSession:e.checkInSession},{withCancel:!0,cancelObject:l}),n[++o]={promiseResolve:function(e){l.isCancelled||a(e)},mapObjects:t,nlsInfo:{title:i,button:s}},r.publish("checkModifyStatus",{mapIds:t,commId:o},!0)})})},warnRefreshIfNeeded:async function(e){return new Promise(t=>{require(["DS/IPClassifyUtil/IPClassifyCommunication"],i=>{n[++o]={promiseResolve:function(e){t(e)},mapObjects:e},console.log("commId : "+o),i.publish("checkObjectsInSession",{mapIds:e,commId:o},!0)})})}};for(var a in window.availableMethods={...s,onReady:function(){require(["DS/BookmarkEditorWebInWin/BookmarkWebInWin","DS/IPClassifyUtil/IPClassifyCommunication","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/MessageBus/MessageBus"],function(e,n){e.then(e=>{t=e,n.publish("bookmarkEditorReady","",!0),console.log("onReady")})})},jsFunction:function(e){if(console.log(e),window.bookmark="string"==typeof e?JSON.parse(e):e,!e.params.sessionManagement)for(let e in s)delete window[e];console.log("jsFunction"),onReady()},setCtxMenu:function(e,n,o){t&&t.setCtxMenu(e,n,o)},onClearSelection:function(){t&&t.onClearSelection()},SelectSearchObjs:function(e){t&&t.insertSelectedSearchObjs(e)}},window.exportCmd={onWebInWinFilterChange:function(e){t&&t.onWebInWinFilterChange(e)},expandToBookmark:function(e){if(t&&e){var n="string"==typeof e?JSON.parse(e):e;t.expandToBookmarkExternally(n)}},setFilterOnContent:function(e){if(t){var n=null;n="object"==typeof e?e:n,t.applyExclusiveFilterAndLoadContent(n)}}},exportCmd)window[a]=window.exportCmd[a];for(var a in availableMethods)window[a]=window.availableMethods[a];var r=function(){"undefined"!=typeof dscef&&(dscef.sendString('{"operation":"readyForInit"}'),dscef.sendString("isReadyForInit"))},d={onLoad:function(){(location.search.contains("test=true")||window.odt)&&require(["DS/BksStandalone/Standalone"],e=>{e({launchWithReadMode:!0,standalone:!0,folderToOpen:"",multiselection:!0,sessionManagement:!0}).then(e=>{r(),jsFunction({params:e})})}),r()}};require(["UWA/Widget"],function(e){var t=window.widget=new e;t.addEventOnce("onLoad",d.onLoad.bind(this)),t.launch()})}),require(["DS/BookmarkEditorWebInWin/BookmarkEditorWebInWin"]);