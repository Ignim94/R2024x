define("DS/CompareWidget2/CompareWidgetInit",[],function(){"use strict";function e(e,t){var i="2",n=new URLSearchParams(window.location.search);if(n&&n.has("widgetDomain")){var r=n.get("widgetDomain"),o=new URLSearchParams(r.substring(r.indexOf("?")));o&&o.has(e)&&o.get(e).indexOf("true")>=0&&(i=t)}return i}return function(){setTimeout(function(){var t="2";let i=null,n=null;try{var r=widget.data.X3DContentId||widget.getValue("__X3DContentId");i=JSON.parse(r),widget.data.X3DContentId&&widget.setValue("__X3DContentId",widget.data.X3DContentId)}catch(e){console.log("X3DContentId is not a json object")}i&&(n=i.runOptions)&&n.version&&(t=n.version),require(["DS/CompareCommon/Utils","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],function(i,r,o){var s=widget.getValue("x3dPlatformId");o.app_initialization(function(){r.getSecurityContextPromise(s,null).then(function(r){var a={url3DSpace:o.get3DSpaceBaseUrl(s),tenant:s,securityContext:r};i.getExpressionPromise("CompareWidgetUseCompareV1",a).then(i=>{null!=i&&!0===i.available&&"true"===i.expressionValue?t="1":"1"!==t&&(t=e("CompareV1","1"));var r="DS/CompareWidget2/CompareWidget2";"1"===t&&(r="DS/CompareWidget/CompareWidget",widget.compareV1=!0),widget.recordForODT=!0===e("recordForCV2ODT",!0),widget.CV2Debug=!0===e("CV2Debug",!0),widget.CV2Timing=!0===e("CV2Timing",!0),widget.CV2EnableCustomProfile=!0,require([r],function(e){widget.addEvents({onLoad:function(t){e.onLoad.call(null,n)},onViewChange:function(t){e.onViewChange.call(null,t)},onRefresh:function(t){e.onRefresh.call(null,t)},onResize:function(t){e.onResize.call(null,arguments)},onEdit:function(t){e.onEdit.apply(null,arguments)},endEdit:function(t){t.submitted&&e.endEdit.apply(null,arguments)}})})})})})})},500)}}),define("DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,i,n,r){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._dataSource="PORTFOLIO_SERVICE",this._dbFallback=!1},execute:function(e,r){var o=this;o._parent(e,r),function(e,r){var o=this;return new Promise(function(s,a){o._lastReqStart=o._plugSvcs.nowMS();var l=o._lastReqStart;o._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var u=e.length,c=[];for(let d of e)t.doExpand(d,"PORTFOLIO_SERVICE","-1",o._plugSvcs,r).then(function(t){var p=t,h=i.convert(d,p,o._plugSvcs,r);if(h.setDataSource(p._dataSource),h.sortChildren(),o.dbgout("%% STRUCTURAL DATA EXPANDED by: "+h._dataSource),l==o._lastReqStart){var _={securityContext:d._securityContext,tenant:d._tenant,serviceName:d._serviceName};n.augment(h,_,o._plugSvcs).then(function(t){if(l==o._lastReqStart){var i,n,r,a=t;if(c.push(a),c.length>=u){var d=(i=e,n=[],r={},c.forEach(function(e){var t=e.getObjIDSpec().getUniqueID();r[t]=e}),i.forEach(function(e){var t=e.getUniqueID(),i=r[t];n.push(i)}),n);if(l!=o._lastReqStart)return;s(d)}}},function(e){o._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),a(e)})}},function(e){o._plugSvcs.errout("Failed to expand using service: "+e),a(e)})})}.call(o,e,r).then(function(e){var t=e;o.reportOK(t)},function(e){o.reportKO()})}})}),define("DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","DS/CompareCommon/CompareMetaData","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/ViewDefModules/ViewDefOptions","UWA/Json"],function(e,t,i,n,r,o,s,a){function l(e){var i=e.attributes.revision,n={};if(t.isRevBranchRevPattern(i,n)){for(var r=e.attributes.name,o=n.branches.length-1;o>=0;--o)r+="_"+n.branches[o].branchId,0!==o&&(r+="_"+n.branches[o].revisionId);e.attributes.name=r}e.logicalid="NoDupes"}return{jsName:"PORTFOLIO_EXPAND",doExpand:function(e,a,u,c,d){return new Promise(function(u,d){(function(e,t,i,r){return new Promise(function(t,i){var r="objectIds="+e.getPhysID(),o=e.getTenant(),s=e.getServiceName();n.makeAuthHttpsCall("/3dportfolio/fetchObjs","GET",r,"json",o,s,null,!1).then(function(e){t(e)},function(e){i(e)})})})(e).then(function(n){var p=n[0];for(var h of(p._dataSource=a,p.nodes))void 0!==h.serviceId&&null!==h.serviceId&&"3dportfolio"===h.serviceId.toLowerCase()&&l(h);(function(e,n,a,l){return new Promise(function(l,u){if(null!=n){var c={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext},d={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext};for(var p of n.nodes)p.nodeid!==n.rootoccurrence&&void 0!==p.proxySpec&&null!==p.proxySpec&&(-1!==p.proxySpec.serviceURL.search(/^3DSpace/i)?(c.objectIds.push(p.physicalid),c.objectTypes.push(p.type),c.serviceIds.push(p.proxySpec.serviceURL)):(d.objectIds.push(p.physicalid),d.objectTypes.push(p.type),d.serviceIds.push(p.proxySpec.serviceURL)));var h=0,_=0;function f(){_===h&&l(n)}if(0===d.objectIds.length&&0===c.objectIds.length&&f(),d.objectIds.length>0&&(++h,t.getFederatedAttributesPromise(d).then(function(e){++_;for(let t of n.nodes)for(let n of e.results)if(t.physicalid===n.physicalID){let e=n.data.findIndex(e=>"ds6w:label"===e.name);-1!==e&&(t.Title=n.data[e].value),t.icon=n.type_icon_url,""===t.attributes.name&&(t.attributes.name=t.physicalid),""===t.attributes.derivedFromId&&(t.attributes.derivedFromId=t.physicalid),t.logicalid=t.physicalid,i.typeInfo[t.type]&&i.typeInfo[t.type].icon||(i.typeInfo[t.type]=i.typeInfo[t.type]||{},i.typeInfo[t.type].icon=n.type_icon_url,null==i.typeInfo[t.type].serviceId&&void 0!==n.sourceID&&null!==n.sourceID&&(i.typeInfo[t.type].serviceId=n.sourceID.split(":")[0]))}f()})),c.objectIds.length>0){++h;let e=[];for(let t=0;t<c.objectIds.length;++t){let i=new r(c.objectIds[t],c.objectTypes[t],c.securityContext,c.tenant,c.serviceIds[t]);e.push(i)}let t="CV_SERVICE",i="0",l=s.STRUCT_FETCH_OPTIONS;l.USE_MCS=!1,o.doExpandN(e,t,i,a,l).then(function(e){++_;for(let o of e)if(null!=o){var t=o.rootoccurrence,i=parseInt(o.occurrences[t].nodeid),r=o.nodes[i].physicalid;for(let e of n.nodes)if(e.physicalid===r){let t=o.nodes[i];e.icon=t.icon,e.name=t.attributes.name,e.revision=t.revision,e.attributes=t.attributes,e.logicalid=t.attributes.name;let n=t.attributes["PLMReference.V_DerivedFrom"];e.attributes.derivedFromId=null!=n&&""!==n?n:t.physicalid,"Products"===t.type&&(e.name=t.versionid,e.attributes.derivedFromId=t.attributes.name),"VPMReference"===t.type&&(e.versionid=t.versionid,e.logicalid=t.logicalid)}}f()})}}})})(e,p,c).then(function(e){u(e)},function(e){c.errout(e),d(e)})},function(e){c.errout(e),d(e)})})}}}),define("DS/CompareWidget2/viewComponents/MainToolbar",["UWA/Class","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/Tweakers/GeneratedToolbar"],function(e,t,i,n){"use strict";return e.extend({init:function(){},createToolbar:function(e,n,r,o,s,a,l){var u=this;(this._eventMgr=n,this._isToolbarCreated&&this.mainToolbar&&this.destroyToolbar(),this._isToolbarCreated=!1,this.resultFrame=e,this.toolbarContainer=r,this.mainToolbarOptions=s,o)&&require(["text!"+o],function(e){var n=JSON.parse(e);n.entries.forEach(function(e){!0===e.hasTooltip&&(e.tooltipInfos=t.generateTooltip("CompareWidget2/Tooltips",e.id)),"object"==typeof e.dataElements.value?(e.dataElements.value.argument={},e.dataElements.value.argument.objects=u):"customEnumMember"===e.dataElements.typeRepresentation?e.dataElements.label=i[e.id]:"string"==typeof e.dataElements.value&&"color"!==e.dataElements.typeRepresentation&&(e.dataElements.value=i[e.id]),s.forEach(function(t){var i=t.replace(/\s+/g,"");e.id.toLowerCase().indexOf(i.toLowerCase())>=0&&(e.dataElements.visibleFlag=!1)})}),u.buildToolbar(n,a,l),u.resultFrame.setToolbarCreated(),u.updateToolbar()})},buildToolbar:function(e,t,r){this._isToolbarCreated=!0,this._toolbarObjTypes=[],this._customConfigActive=r;let o=e.entries.findIndex(e=>"mainToolbarProfile"===e.id),s=e.entries.findIndex(e=>"mainToolbarEditCustomization"===e.id),a=e.entries[o]||null,l=e.entries[s];if(a&&l)if(!0===r){let e=null,n="";if(void 0!==this.resultFrame&&null!==this.resultFrame&&void 0!==this.resultFrame._CCM&&null!==this.resultFrame._CCM&&null!=t&&void 0!==t.typeInfoArray&&void 0!==t.typeInfoArray&&t.typeInfoArray.length>0){let i=t.typeInfoArray.map(e=>e.type);e=this.resultFrame._CCM.getProfileNames({getTemplates:!1,objTypes:i}),n=this.resultFrame._CCM.getUserPreferredProfileName(t),this._toolbarObjTypes=i}null!=e&&e.length>0?(e.unshift(i.mainToolbarProfileDefault),null!=n&&a.dataElements.value!==n&&(a.dataElements.value=n)):e=[i.mainToolbarProfileDefault],a.dataElements.possibleValues=e,a.visibleFlag=!0,l.visibleFlag=!0}else a.visibleFlag=!1,l.visibleFlag=!1;this._replaceLeftAndRightColorWithOptionsColors(e),this.toolbarModel=n.prototype.createTreeDocument(e),this.mainToolbar=new n({items:this.toolbarModel}),this.mainToolbar._eventMgr=this._eventMgr,this.mainToolbar.inject(this.toolbarContainer)},updateToolbar:function(){this.mainToolbar&&(this.mainToolbar.prepareUpdateView(),this.mainToolbar.updateNodeModel("mainToolbarDisplayViews",{disabled:this.resultFrame._layout.getViews().length<2||null!=this.resultFrame._layout.maximizedPanel}),this.mainToolbar.pushUpdateView())},updateComparisonProfileDropdownUI:function(){if(!0===this._customConfigActive){let e=null,t=null;if(this.mainToolbar){let n=n=>{this.mainToolbar.prepareUpdateView(),(t=null!=n&&n.length>0)?(n.unshift(i.mainToolbarProfileDefault),e=!0):(n=[i.mainToolbarProfileDefault],e=!0),this.mainToolbar.updateNodeModel("mainToolbarEditCustomization",{visibleFlag:e});let r={visibleFlag:e};e&&null!=n&&(r.possibleValues=n),this.mainToolbar.updateNodeModel("mainToolbarProfile",r),this.mainToolbar.pushUpdateView()};this.resultFrame._CCM.getProfileNames({getTemplates:!1,objTypes:this._toolbarObjTypes,callBackAfterProfilesUpdated:n})}}},destroyToolbar:function(){this.mainToolbar.destroy(),this.mainToolbar=null,this._isToolbarCreated=!1},_replaceLeftAndRightColorWithOptionsColors:function(e){if(null!=this.resultFrame._panelSpecSet.STRUCT_VIEW&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR){let t=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,i=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,n=e.entries.findIndex(e=>"mainToolbarLeftObjectColor"===e.id),r=e.entries.findIndex(e=>"mainToolbarRightObjectColor"===e.id);-1!==n&&""!==t&&(e.entries[n].dataElements.value=t),-1!==r&&""!==i&&(e.entries[r].dataElements.value=i)}}})}),define("DS/CompareWidget2/widget/controls/splitContainer",["UWA/Controls/Abstract"],function(e){return e.extend({init:function(e){this.splitContainerMinWidth=e.splitContainerMinWidth,this._parent({}),this.options=e,this.elements.panels=e.panels,e.panels.length>1?this.panelWidth=e.panels.map(t=>"calc("+100/e.panels.length+"% - 3px)"):this.panelWidth="100%",this.buildUI()},buildUI:function(){if(this.elements.container=UWA.createElement("div"),this.elements.container.setStyles({display:"flex",position:"relative",width:this.splitContainerMinWidth>0?(this.splitContainerMinWidth*this.elements.panels.length).toString()+"px":"100%",height:"100%"}),this.elements.panels.length>1){this.elements.splitters=[];for(var e=0,t=this.elements.panels.length;e<t;e++)if(this.elements.panels[e].setStyles({width:this.panelWidth[e],position:"relative"}),this.elements.panels[e].inject(this.elements.container),e<t-1){var i=UWA.createElement("div",{styles:{width:"6px",cursor:"col-resize",position:"relative"}});this.elements.splitters.push(i),i.inject(this.elements.container)}}else this.elements.panels[0].inject(this.elements.container)}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,r,o,s){return e.extend({init:function(e,r){this._parent({}),this.attrComparePanel=e,this.onClickOkCallback=r,this.content=this._buildContent(),this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.dialog=new i({title:o.selectPropertiesToDisplay,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,buttons:{Reset:new n({label:o.resetProperties,domId:"compare_attrchooser_Reset",onClick:this._onClickReset.bind(this),disabled:this.attrComparePanel.showDefaultPropsOnly(),emphasize:"secondary"}),Ok:new n({label:s.ok,domId:"compare_attrchooser_OK",onClick:this._onClickOk.bind(this),disabled:!0,emphasize:"primary"}),Cancel:new n({label:s.ko,domId:"compare_attrchooser_Cancel",onClick:this._onClickCancel.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._onDialogClose.bind(this))},_enableOK:function(e){this.dialog.buttons.Ok.disabled=!e},_enableReset:function(e){this.dialog.buttons.Reset.disabled=!e},_onDialogClose:function(){this.dialog.removeEventListener("close",this._onDialogClose.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_onClickOk:function(){this._save(function(){this.onClickOkCallback(),this.dialog.close()}.bind(this))},_onClickCancel:function(){this.dialog.close()},_onClickReset:function(){this._resetToDefaultAttrs()},_resetToDefaultAttrs:function(){var e=this,t=this.attrComparePanel.defaultAttrs;this.allPropertyCheckboxes.forEach(function(i){var n=-1!=t.indexOf(i.value)||e.attrComparePanel.isTitleAttr(i);i.checkFlag=n}),e._updateAllCheck(),e._enableReset(!1),e._enableOK(!0)},onClickDisplayAll:function(e){let t=this.displayAllCheckbox.checkFlag;for(let e=0;e<this.allPropertyCheckboxes.length;e++)this.attrComparePanel.isTitleAttr(this.allPropertyCheckboxes[e])?this.allPropertyCheckboxes[e].checkFlag=!0:this.allPropertyCheckboxes[e].checkFlag=t;this._enableReset(!0),this._enableOK(!0)},_save:function(e){let t=[];if(this.dialog.buttons.Reset.disabled)t.push("__showDefault__");else if(!this.displayAllCheckbox.checkFlag)for(let e=0;e<this.allPropertyCheckboxes.length;e++){let i=this.allPropertyCheckboxes[e];if(0==i.checkFlag){let e=i.value;t.push(e)}}this.attrComparePanel.savePropsDisplayOptions(t),e()},_buildPropertyCheckboxes:function(e,t,i){var n=this;n.allPropertyCheckboxes=[];for(let o=0;o<t.length;o++){let s=t[o],a=new r({label:s.displayName,value:s.name}),l=-1==i.indexOf(s.name);a.checkFlag=l,n.attrComparePanel.isTitleAttr(s)?(a.disabled=!0,a.checkFlag=!0,a.addEventListener("buttonclick",function(){n._enableOK(!1),n._enableReset(!1),n._updateAllCheck()}.bind(n)),a.inject(e),n.allPropertyCheckboxes.unshift(a)):(a.addEventListener("buttonclick",function(){n._enableOK(!0),n._enableReset(!0),n._updateAllCheck()}.bind(n)),a.inject(e),n.allPropertyCheckboxes.push(a))}},_updateAllCheck:function(){for(var e=!0,t=this.allPropertyCheckboxes.length,i=0;i<t;i++){if(1!=this.allPropertyCheckboxes[i].checkFlag){e=!1;break}}this.displayAllCheckbox.checkFlag=e},_buildDisplayAllCheckbox:function(e){this.displayAllCheckbox=new r({label:o.displayAllProperties,value:"all",checkFlag:this.attrComparePanel.showAllProps()}),this.displayAllCheckbox.getContent().setStyle("border-bottom","1px solid lightgrey"),this.displayAllCheckbox.inject(e),this.displayAllCheckbox.addEventListener("buttonclick",this.onClickDisplayAll.bind(this))},_buildContent:function(){var e=this.attrComparePanel.compareResult;for(let i=0;i<e.length;i++)if(this.attrComparePanel.isTitleAttr(e[i])){e.unshift(e[i]);var t=i+1;e.splice(t,1)}var i=e.findIndex(e=>"thumbnailimage"===e.name);if(-1!=i&&0!=i){e.unshift(e[i]);var n=i+1;e.splice(n,1)}let r=UWA.createElement("div",{id:"attr-choose-dialog"});return this._buildDisplayAllCheckbox(r),this._buildPropertyCheckboxes(r,e,this.attrComparePanel.getPropsToHide(e)),r}})}),define("DS/CompareWidget2/widget/resultFrame",["UWA/Controls/Abstract","DS/CustomizableLayout/Layout","DS/CompareWidget2/viewComponents/MainToolbar","DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,r,o,s){"use strict";return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this._runOptions=t,this._eventTokens={},this._layout=null,this._panelSpecSet={},this._swapIsEnabled=!0,this._isToolbarCreated=!1,this._CCM=i,this.elements.container=UWA.createElement("div",{class:"compare-result-frame",id:"compare-result-frame"}),this._layout=null},_createLayoutPromise:function(e){var i={container:this.elements.container,tabOnlyDocking:"smartphone"===r.getDeviceType(),resultFrame:this};let n=new t(i);n.onViewOpened(this.onViewOpenedCB.bind(this)),n.onViewClosed(this.onViewClosedCB.bind(this));let s=e+"_"+r.getDeviceType();return o.loadSettingsPromise([s]).then(()=>(o.savePrefsTimestampAndEnableUpdate(),o.sync(n,s,"layout",null)))},onViewOpenedCB:function(e){console.log("VIEW "+e.getName()+" OPENED"),this._eventMgr.publish({event:"VIEW_OPENED",data:{eventName:"VIEW_OPENED",view:e}})},onViewClosedCB:function(e){console.log("VIEW "+e.getName()+" CLOSED"),this._eventMgr.publish({event:"VIEW_CLOSED",data:{eventName:"VIEW_CLOSED",view:e}})},_createLayout:function(e){var i={name:e,container:this.elements.container};return new t(i)},getLayout:function(){return this._layout},update:function(e,t,r,o){this.elements.container.innerHTML="",null==this._runOptions||"MERGE"!==this._runOptions.app&&"NRF"!==this._runOptions.app||(this._useDatabaseSelected=!widget.getBool("useIndexForMerge")),this.MainToolbarModule||(this.MainToolbarModule=new i),this._isToolbarCreated||(this.toolbarContainer=UWA.createElement("div",{class:"compare-main-toolbar-container"}),this.toolbarContainer.inject(this.elements.container),this.MainToolbarModule.createToolbar(this,this._eventMgr,this.toolbarContainer,e,t,r,o),this._isToolbarCreated=!0),this._layout.buildUI();let a=this._layout.buildUI();a.length&&n.showAlertBox("NEW_VIEWS_MESSAGE",s,"info",!1,{newViews:a.reduce((e,t,i,n)=>e+(i<n.length-1?",":"")+t,"")}),this._isToolbarCreated&&this.MainToolbarModule&&this.MainToolbarModule.updateToolbar()},setToolbarCreated:function(){this._isToolbarCreated=!0},addPanel:function(e,t){(this._createLayout&&void 0===this._layout||null===this._layout)&&(this._layout=this._createLayout("Layout-"+e.name)),this._panelSpecSet[e.name]=e,this._layout.addRow(e.panel),this.update()},setAllPanels:function(e,t,i,n,o,s,a,l){var u=this;u._panelSpecSet=n,this._createLayoutPromise(e+"_"+t).then(e=>{if(this._layout=e,"smartphone"===r.getDeviceType())u._layout.addRow(Object.keys(u._panelSpecSet).map(e=>u._panelSpecSet[e].panel));else if(null!=i)!function e(t,i){var r="ROW"===Object.keys(t)[0].toUpperCase()?"addRow":"addCol";(Object.values(t)[0].constructor!==Array?[Object.values(t)[0]]:Object.values(t)[0]).forEach(t=>{t.constructor===String?null!=n[t]&&i[r](n[t].panel):t.constructor===Array?i[r](t.map(e=>n[e].panel)):t.constructor===Object&&e(t,i[r]())})}(i,u._layout);else{Object.keys(u._panelSpecSet).forEach(function(e){var t=u._panelSpecSet[e].panel;u._layout.addRow(t)})}u.update(o,s,a,l)})},updateToolbarCustomProfile:function(){this.MainToolbarModule.updateComparisonProfileDropdownUI()},refreshFrame:function(){this.updateToolbarCustomProfile()},applyDefaultLayout:function(){this._layout.applyDefaultLayout()},onPanelMaximized:function(){this.MainToolbarModule.updateToolbar()},onPanelRestoredFromMaximized:function(){this.MainToolbarModule.updateToolbar()},onProfileManagerDone:function(){void 0!==this.MainToolbarModule&&null!==this.MainToolbarModule&&this.MainToolbarModule.updateComparisonProfileDropdownUI()},destroy:function(){for(var e in this._eventTokens)this._eventMgr.unsubscribe(this._eventTokens[e]),this._eventTokens[e]=null;this._eventMgr=null,this._ccm=null,this._isToolbarCreated=!1,this._panelSpecSet={},this.MainToolbarModule.destroyToolbar(),this._parent()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu",["UWA/Class","WebappsUtils/WebappsUtils","DS/i3DXCompassServices/i3DXCompassPubSub","DS/CompareCommon/launchTree","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i,n,r,o){"use strict";var s=[];function a(e){if(e.widgetId===widget.id){for(var t=[],n=0;n<e.data.items.length;n++)t.push(e.data.items[n].path);var r=null;for(n=0;null==r&&n<s.length;)r=s[n].buildLaunchJSON(t),n++;if(null==r)return void console.error("Cannot find selection in either tree (this should not happen)");var o={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:r};i.publish("launchApp",o)}}return e.extend({init:function(e){this._structComparePanel=e.structComparePanel,i.subscribe("setTypesCallback",a)},getOpenWithMenuPromise:function(e,t,i){var r=this;return new Promise(function(o){var a=e.cellInfos.nodeModel.getRoot(),l=!1;for(const e of s)a.options.data.getPath()===e._pathWithStrArray[0]&&(l=!0);if(!l){for(var u=(a=e.cellInfos.nodeModel._getTrueRoot()).getAllDescendants().map(function(e){return e.options.data.getPath()}),c=new n([]),d=0;d<u.length;++d){var p=u[d].split("/");c._pathWithArray.push(p),c._pathWithStrArray.push(p.join(","))}s.push(c)}require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADProbes"],function(n,s,a){n.app_initialization(function(){var n=[];for(var a of t){let e=a.options.data.getObjIDSpec_REF();null!=e&&n.push(e.getObjType())}s.retrieveHierarchy(n,function(s){for(var a=[],l=0;l<n.length;++l)a[l]=n[l],null!=s&&void 0!==s[n[l]]&&null!==s[n[l]]&&(a[l]=s[n[l]]);for(var u=t.map(function(e){return e.options.data.getPath()}),c=[],d=0;d<t.length;++d){var p=u[d].split("/").map(function(e){return{resourceid:e}});let e=[p[p.length-1]];var h=t[d].options.data._objIDSpecREF;c.push({contextId:h.getSecurityContext(),envId:h.getTenant(),objectId:h.getPhysID(),objectTaxonomies:a[d],objectType:h.getObjType(),path:!0===i.useSelectionInContext?p:e,serviceId:h.getServiceName()})}var _={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:c}};r._getOpenWithMenuPromise(e,_).then(function(e){o(e)})})})})})},_getOpenWithMenuPromise:function(e,i){return new Promise(function(n){var s=[];e.cellInfos.nodeModel.options.data._objIDSpecREF;if("3DShape"===function(e){for(var t=e.cellInfos.nodeModel;0!==t._nodeDepth;)t=t._parentNode;return t.options.data._objIDSpecREF}(e).getObjType()||widget.isWebInWin)n(s);else{var a=new r;a.set3DXContent(i,!0),UWA.is(a.retrieveCompatibleApps,"function")?a.retrieveCompatibleApps(function(e){var i=[];if(e.forEach(function(e){i.push({type:"PushItem",title:e.text,fonticon:void 0!==e.fonticon&&null!==e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:void 0!==e.icon&&null!==e.icon&&e.icon.length>0?e.icon:"",action:{callback:function(){e.handler()}}})}),i.length>0)var r={type:"PushItem",icon:"url("+t.getWebappsAssetUrl("ENXNav","icons/32/I_OpenWith.png")+")",title:o.OpenWith,submenu:i};n(r)}):n(s)}})},clearLaunchTreeArray:function(){s=[]}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu",["UWA/Class","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";return e.extend({init:function(e){this._structComparePanel=e.structComparePanel},getExpandCollapseContextMenu:function(e,t){var i=this.getExpandCollapseMenu(t);return function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.nodeModel||null===e.cellInfos.nodeModel||void 0===e.cellInfos.nodeModel._options||null===e.cellInfos.nodeModel._options||void 0===e.cellInfos.nodeModel._options.children||null===e.cellInfos.nodeModel._options.children}(e)?null:UWA.extend({...i.find(e=>e.id===t)},{type:"PushItem",submenu:i})},getExpandCollapseMenu:function(){var e=this;return[{id:"expandAll",icon:"flow-tree-expand-down",title:i.ExpandAll,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ExpandAll")},{id:"expandNLevels",icon:"flow-tree-expand-down-cog",title:i.ExpandNLevels,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ExpandNLevels")},{id:"collapseAll",icon:"flow-tree-expand-up",title:i.CollapseAll,tooltip:t.generateTooltip("CompareWidget2/Tooltips","CollapseAll")}].map(t=>({type:"CheckItem",id:t.id,icon:t.icon,title:t.title,tooltip:t.tooltip,state:e._structComparePanel.getActiveExpandMenuId()===t.id?"selected":"",action:{callback:()=>e._structComparePanel.handleToolbarCommands({event:t.id,data:{icon:t.icon}})}}))}})}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t){var i=function(i,n){var r;this._dbObj_REF=null,this._dbObj_INST=null,this._childArray=[],this._parent=null,this._dbContext={},r=i,ret=!0,null!=r&&r.constructor!=t&&(e.errout("[INVALID] refInst_node receives unexpected type"),ret=!1),ret&&(this._dbObj_REF=i),this._dbObj_INST=n,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node"};return i.prototype.makeDupe=function(){var e=this,t=e._dbObj_REF.makeDupe(),n=null!=e._dbObj_INST?e._dbObj_INST.makeDupe():null,r=new i(t,n);return r._parent=e._parent,r._dbContext=JSON.parse(JSON.stringify(e._dbContext)),r._childArray=[],e._childArray.forEach(function(e){var t=e.makeDupe();t._parent=r,r._childArray.push(t)}),r._reqModforODT=e._reqModforODT,r},i.prototype.visit_subtreeAndFN=function(e){var t=e(this);if(null!=this._childArray)for(var i=this._childArray.length,n=0;n<i&&1==t;n++){var r=this._childArray[n];null!=r&&(t=r.visit_subtreeAndFN(e))}return t},i.prototype.set_dbObj_INST=function(e){this._dbObj_INST=e},i.prototype.setDBContext=function(e){this._dbContext=e},i.prototype.getDBContext=function(){return this._dbContext},i.prototype.setParent=function(t,i){var n=!1;1==i?n=!0:null==t?e.errout("refInst_node's parent cannot be set to null... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's parent can only be another refInst_node... ignored"):null!=this._parent&&this._parent!=t?e.errout("Changing parent node of a refInst_node (unexpectedly)... ignored"):n=!0,1==n&&(this._parent=t)},i.prototype.getParent=function(){return this._parent},i.prototype.addChild=function(t){null==t?e.errout("refInst_node cannot have a null child... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's child must be another refInst_node... ignoring"):this._childArray.push(t)},i.prototype.rmChild=function(e){var t=[];this._childArray.forEach(function(i){i.getAttr("INST.physicalid")!=e&&t.push(i)}),this._childArray=t},i.prototype.rmAllChildren=function(){this._childArray=[]},i.prototype.getChildArray=function(){return this._childArray},i.prototype.sortChildArray=function(){var e=this._childArray.sort(function(e,t){return e.getAttr("INST.ro.plminstance.v_treeorder")-t.getAttr("INST.ro.plminstance.v_treeorder")});this._childArray=e},i.prototype.findChid=function(e,t){for(var i=null,n=this._childArray.length,r=0;r<n;r++){var o=this._childArray[r];if(e==o.getAttr("INST.physicalid")&&t==o.getAttr("REF.physicalid")){i=o;break}}return i},i.prototype.isRoot=function(){return null==this.getParent()},i.prototype.isLeaf=function(){return 0==this._childArray.length},i.prototype.get_dbObj_REF=function(){return this._dbObj_REF},i.prototype.get_dbObj_INST=function(){return this._dbObj_INST},i.prototype.getAttr=function(t){var i=null,n=t.indexOf("."),r=t.substring(0,n),o=t.substring(n+1);return"REF"==r?i=this._dbObj_REF.getAttr(o):"INST"==r?null!=this._dbObj_INST&&(i=this._dbObj_INST.getAttr(o)):e.errout("unexpected qualifier in name: "+r),i},i.prototype.setAttr=function(t,i){var n=null,r=t.indexOf("."),o=t.substring(0,r),s=t.substring(r+1);return"REF"==o?n=this._dbObj_REF.setAttr(s,i):"INST"==o?null!=this._dbObj_INST&&(n=this._dbObj_INST.setAttr(s,i)):e.errout("unexpected qualifier in name: "+o),n},i}),define("DS/CompareWidget2/userSettings/UserSettingsManager",["UWA/Core","DS/CompareCommon/Utils","DS/CompareCommon/WidgetPreferences","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i,n){"use strict";function r(e,i,n,r){var o={callbackList:[]};return((s,a,l)=>{let u=i;Object.defineProperty(o,"value",{enumerable:!0,configurable:!1,get:function(){return u},set:function(i){if(u!==i)if(u=i,o.callbackList.forEach(e=>e(u)),!0===widget.getValue("saveToWidgetOnly"))widget.setValue(n+"["+e+"]",u);else{t.savePrefToSession(`${l}[${s}]`,u);let e=Date.now();r.__updateSessionCacheTimestamp__&&t.savePrefTimestampToSession(l,e),!widget._isODTMode()&&t.saveUserPreferencesPromise(`${l}[${s}]`,u).then(()=>{r.__updateSessionCacheTimestamp__&&t.savePrefTimestampToDashboardPromise(l,e).then(()=>{})})}}})})(e,0,n),o}function o(e,n){this.disablePrefsTimestampUpdate();let o=Object.keys(e);var s;!0===widget.getValue("saveToWidgetOnly")?(o.forEach(t=>{this.userSettings[t]=r(t,widget.getValue(this.namespace+"["+t+"]"),this.namespace,this),e[t].widgetSetting&&i.addWidgetPreference(t,e[t].widgetSetting,this.get(t))}),n()):(s=this.namespace,new Promise((e,i)=>{let n=t.getPrefTimestampFromSession(s);Number.isNaN(n)||n<=0?e(!1):t.getPrefLastSavedTimestampFromDashboardPromise(s).then(t=>{e(!(Number.isNaN(t)||t>n))})})).then(s=>{Promise.allSettled(o.map(e=>t[s?"getPrefFromSessionPromise":"getUserPreferencesPromise"](`${this.namespace}[${e}]`))).then(s=>{for(var a=0,l=s.length;a<l;a++){let n=s[a];"rejected"!==n.status&&null!==n.value&&void 0!==n.value&&""!==n.value?this.userSettings[o[a]]=r(o[a],n.value,this.namespace,this):(this.userSettings[o[a]]=r(o[a],null,this.namespace,this),this.set(o[a],e[o[a]].value)),t.savePrefToSession(`${this.namespace}[${o[a]}]`,this.get(o[a])),e[o[a]].widgetSetting&&i.addWidgetPreference(o[a],e[o[a]].widgetSetting,this.get(o[a])),widget.setValue(this.namespace+"["+o[a]+"]",this.get(o[a]))}n()})})}return e.Class.singleton({init:function(){this.namespace="",this.userSettings={},this.__updateSessionCacheTimestamp__=!0},get:function(e){return this.userSettings[e].value},set:function(e,t){this.userSettings[e].value=t},hasPref:function(e){return this.userSettings.hasOwnProperty(e)},sync:function(e,t,i,n){let r=this;return r.hasPref(t)&&(i=i||t,"function"==typeof n&&r.userSettings[t].callbackList.push(n),Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:function(){return r.get(t)},set:function(e){r.set(t,e)}})),e},unsync:function(e,t,i,n){let r=e[i=i||t];delete e[i],e[i]=r;var o="function"==typeof n?this.userSettings[t].callbackList.indexOf(n):-1;return o>=0&&this.userSettings[t].callbackList.splice(o,1),e},loadSettingsFromConfigPromise:function(e){return i.addWidgetPrefs("V2"),new Promise((s,a)=>{function l(){i.addWidgetPreference("saveToWidgetOnly",{type:"boolean",label:n.saveToWidgetOnly,defaultValue:!1}),s()}require([e.configPath],e=>{this.namespace=e.namespace;var n=function(e,t){var i={};return function e(n,r){for(let s of Object.keys(n))if("namespace"!==s)if(n[s].hasOwnProperty("value")){var o=null!=r&&r.constructor===String?r+t+s:s;i[o]={value:n[s].value},n[s].hasOwnProperty("V1Preference")&&(i[o].V1Preference=n[s].V1Preference),n[s].hasOwnProperty("widgetSetting")&&(i[o].widgetSetting=n[s].widgetSetting)}else e(n[s],null!=r&&r.constructor===String?r+t+s:s)}(e),i}(e,".");i.isV1ToV2PrefMigrationComplete(this.namespace,()=>{o.bind(this)(n,l)},()=>{i.addWidgetPrefs("V2Migrate"),i.loadDefaults("compare_widget_default_prefs",()=>t.setPreferencesToWidget(["compare_viewer_selectmode","compare_attributes_display_option","compare_attributes_not_shown","compare_attributes_not_shown_INST","compare_attributes_not_shown_EFF"],["viewer_display_mode","attributes_display_option","attributes_not_shown","attributes_not_shown_INST","attributes_not_shown_EFF"],()=>{this.disablePrefsTimestampUpdate(),Object.keys(n).forEach(e=>{if("string"==typeof n[e].V1Preference&&n[e].V1Preference.length){let t=widget.getValue(n[e].V1Preference);this.userSettings[e]=r(e,null,this.namespace,this),this.set(e,t||n[e].value)}else if(Array.isArray(n[e].V1Preference)&&n[e].V1Preference.length){var t=n[e].V1Preference.reduce((e,t)=>{let i=Object.keys(t)[0];return widget.getValue(i)===t[i].oldValue&&e.push(t[i].newValue),e},[]);this.userSettings[e]=r(e,null,this.namespace,this),this.set(e,t.length?t:n[e].value)}else if("object"==typeof n[e].V1Preference){let t=n[e].V1Preference,i=Object.keys(t)[0],o=void 0;for(let e=0;e<t[i].length;e++)if(widget.getValue(i)===t[i][e].oldValue){o=t[i][e].newValue;break}this.userSettings[e]=r(e,null,this.namespace,this),this.set(e,void 0!==o?o:n[e].value)}else this.userSettings[e]=r(e,null,this.namespace,this),this.set(e,n[e].value);n[e].widgetSetting&&i.addWidgetPreference(e,n[e].widgetSetting,this.get(e)),widget.setValue(this.namespace+"["+e+"]",this.get(e))}),i.setV1ToV2PrefMigrationCompletedFlag(this.namespace).then(l)}))})})})},loadSettingsPromise:function(e){let t=this;return new Promise(i=>{let n={};e.forEach(e=>n[e]={value:null}),o.bind(t)(n,i)})},disablePrefsTimestampUpdate:function(){this.__updateSessionCacheTimestamp__=!1},enablePrefsTimestampUpdate:function(){this.__updateSessionCacheTimestamp__=!0},savePrefsTimestampAndEnableUpdate:function(){let e=Date.now();t.savePrefTimestampToDashboardPromise(this.namespace,e).then(()=>{t.savePrefTimestampToSession(this.namespace,e),this.enablePrefsTimestampUpdate()},()=>{})},resetSettings:function(){this.init()}})}),define("DS/CompareWidget2/viewComponents/ContextMenuBase",["UWA/Class"],function(e){"use strict";return e.extend({createContextMenu:function(){return[]}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr",["DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,r,o,s,a,l){var u={CV_DIRECT:{expander:e,adapter:s},CV_SERVICE:{expander:n,adapter:o},DB_SERVICE:{expander:n,adapter:o},CV_PROGRESSIVE:{expander:t,adapter:a},LC_IDX_SERVICE:{expander:r,adapter:s},LC_AUTH_SERVICE:{expander:r,adapter:s},FILE_EXPAND:{expander:i,adapter:o}};return{expandUsingType:function(e,t,i,n,r){return new Promise(function(o,s){var a=u[t];if(null==a){var c="UNKNOWN EXPAND TYPE: '"+t+"'";n.errout(c),s(c)}return a.expander.doExpand(e,t,i,n,r).then(function(i){var u=i;if(r._ODT_FailFirstFetch&&s("ODT: failing initial fetch"),null==u||0==u.length)n.showAlertBox("RETURN_IS_BLANK",l,"warning"),s("Object query returned blank - was the root filtered out?");else{n.dbgout("Expand via '"+t+"' successful for ID: "+e.getPhysID());var c=null;null==(c=null!=a.adapter?a.adapter.convert(e,u,n,r):u)?s("Adapter has failed..."):(c.sortChildren(),o(c))}},function(e){n.warnout("Failed to expand using "+t+" ::"+e),s(e)})})},doExpand:function(e,t,i,n,r,o){var s=this;return new Promise(function(a,l){s.expandUsingType(e,t,n,r,o).then(function(e){a(e)},function(t){r.warnout("Primary expansion failed: "+t),null==i?(r.errout("No secondary expand Type; can't continue!"),l(t)):(r.warnout("Attempting to expand using secondary expandType"),s.expandUsingType(e,i,n,r,o).then(function(e){r.warnout("Secondary expansion success"),a(e)},function(e){r.warnout("Secondary expansion failed: "+e),l(e)}))})})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayDataItem",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e){return function(e,t,i,n){let r=null!=e&&null!=n&&null!=t?e[n][t]:null,o=null==r?"":r.TOOLTIP_MODULE_PATH,s=null==r?"":r.COLOR;"IDENTICAL"!=t&&""==s&&(console.warn("Missing COLOR definition; using RED (by default) for :"+t),s="#ff0000"),this.id=t,this.label=i,this.tooltip={title:i},this.modulePath=o,this.color=s,this.description="",this.flagName=t,this.NLS=i,this.matchedPairs=[],this.legendGrouping=0,this.visibleFlag=!1,this.checked=!0,this.reset=function(){this.matchedPairs=[],this.visibleFlag=!1,this.checked=!0}}}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,r,o,s,a){return e.extend({init:function(e){this._parent({}),this.OKfn=e.OKfn,this.statusVisibility={},Object.keys(e.statuses).forEach(t=>"IDENTICAL"!==t&&(this.statusVisibility[t]=e.statuses[t].visibleFlag)),this.content=this._buildContent(e.statuses),this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.dialog=new i({title:s.chooseStatusToDisplay,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,width:230,buttons:{Ok:new n({label:a.ok,onClick:this._OKfn.bind(this),disabled:!1,emphasize:"primary"}),Cancel:new n({label:a.ko,onClick:this._close.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._close.bind(this))},_buildContent:function(e){function t(e){let t=e.checkFlag;e.elements.checkSign.setStyles({"background-color":!0===t?e.color:"","border-color":!0===t?e.color:""})}let i=new o({type:"checkbox"});return Object.keys(this.statusVisibility).forEach(n=>{let o=e[n],s=new r({type:"switch",label:o.label,value:o.name,checkFlag:o.visibleFlag});s.color=o.color,s.id=n,t(s),s.addEventListener("buttonclick",()=>{t(s),this.statusVisibility[s.id]=s.checkFlag}),i.addChild(s)}),i},_close:function(){this.dialog.removeEventListener("close",this._close.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_OKfn:function(){this._close(),setTimeout(()=>{this.OKfn(this.statusVisibility)},20)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,i,n){var r=function(e){this._objIDSpec=e,this._dbObjREFByNodeID={},this._occurByID={},this._occurRelArray=[],this._rootOccurID=0,this._refInstNodeByOccurID={}};return r.prototype.addNodes=function(e,t,i,n){var r=this;e.forEach(function(e){var o=t;void 0!==e.serviceId&&null!==e.serviceId&&""!==e.serviceId&&(o=e.serviceId),void 0!==e.proxySpec&&null!==e.proxySpec&&""!==e.proxySpec&&void 0!==e.proxySpec.serviceURL&&null!==e.proxySpec.serviceURL&&""!==e.proxySpec.serviceURL&&(o=e.proxySpec.serviceURL);var s=r.node2dbObjREF(e,o,i,n);r._dbObjREFByNodeID[e.nodeid]=s})},r.prototype.setRootOccurID=function(e){this._rootOccurID=e},r.prototype.node2dbObjREF=function(e,t,i,r){var o=function(e,n,o){if("icon"==n){var s={smallURL:r.makeServiceURL(t,i,o,null),largeURL:""};e.setAttr("typeIcons",s)}else if("cgrurl"==n&&o){var a=o.indexOf("?"),l=o.substr(0,a),u=o.substr(a+1),c=r.makeServiceURL(t,i,l,u);e.setAttr("thumbnail_3d",c),e.addAttr("ds6w:globaltype","ds6w:Document")}else{var d={"PLMEntity.V_Name":"ds6w:label",revision:"ds6wg:revision",type:"ds6w:type","PLMReference.V_DerivedFrom":"dfr"}[n];null==d&&(d=n),e.setAttr(d,o)}},s=new n;return Object.keys(e).forEach(function(t){if("attributes"==t){Object.keys(e.attributes).forEach(function(t){var i=e.attributes[t];o(s,t,i)})}else{var i=e[t];o(s,t,i)}}),null==s.getAttr("ds6w:globaltype")&&s.addAttr("ds6w:globaltype","ds6w:Part"),s},r.prototype.addOccurs=function(e,t){var i=this;e.forEach(function(e){var t={};Object.keys(e).forEach(function(i){var n=e[i];!function(e,t,i){if("xform"==t){var n=JSON.parse(JSON.stringify(i));n.splice(15,1),n.splice(11,1),n.splice(7,1),n.splice(3,1);for(var r=n.length,o=0;o<r;o++){var s=n[o];Number.isInteger(s)&&(n[o]=s.toFixed(1))}e.matrixtxt=attrVal2use=n.join(),e.matrixtxt=e.matrixtxt.replace(/e/g,"E")}else{var a={"logicalid[connection]":"logicalid"}[t];null==a&&(a=t),e[a]=i}}(t,i,n)}),i._occurByID[e.occurrenceid]=t})},r.prototype.addOccurRels=function(e){this._occurRelArray=e},r.prototype.buildTree=function(){var e=this,r=e._occurByID[e._rootOccurID].nodeid,o=e._dbObjREFByNodeID[r],s=new i(o,null);e._refInstNodeByOccurID[e._rootOccurID]=s,this._occurRelArray.forEach(function(t){var r=t.child,o=e._occurByID[r],s=new n,a=t.relationship;s.addAttr("ds6w:type",a),Object.keys(o).forEach(function(e){var t=o[e];s.addAttr(e,t)}),s.addAttr("physicalid",t.physicalid),s.addAttr("ds6w:globaltype","Instance"),s.addAttr("ro.plminstance.v_treeorder",t.treeOrder);var l=o.nodeid,u=e._dbObjREFByNodeID[l],c=new i(u,s);e._refInstNodeByOccurID[r]=c});var a=new t(e._objIDSpec),l=e._refInstNodeByOccurID[e._rootOccurID];return a.setRoot(l),this._occurRelArray.forEach(function(t){var i=t.parent,n=e._refInstNodeByOccurID[i],r=t.child,o=e._refInstNodeByOccurID[r];n.addChild(o),o.setParent(n)}),a},e.singleton({jsClass:"NODE_OCCUR_REL2REFINST_TREE",convert:function(e,t,i,n){var o=new r(e);o.addNodes(t.nodes,e.getServiceName(),e.getTenant(),i),o.addOccurs(t.occurrences,i),o.addOccurRels(t.occurrencerelationships),o.setRootOccurID(t.rootoccurrence);var s=o.buildTree();return o=null,s}})}),define("DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,n){var r=e.extend({init:function(e){this._parent({}),this.rels=e,this.idObjMap=this.buildIdObjMap(e),this.formated=this.format(e)},addTo:function(e){for(var t=this.newAsm(e),i=Object.keys(this.formated),n=0;n<i.length;n++)this.addSourceToAsm(i[n],t)},addRootSourceToAttributes:function(e){for(var t=this.rels.New.Objects,i=0;i<t.length;i++){var n=t[i],r=e[n.id];null!=r&&(n.rootSource=r.rootSource)}},getLinkedObjectIds:function(){for(var e=[],t=(this.rels.New.Objects,this.rels.New.Links),i=0;i<t.length;i++){var n=t[i].target;-1==e.indexOf(n)&&e.push(n)}return e},format:function(e){for(var t={},i=0;i<e.New.Links.length;i++){var n=e.New.Links[i];null==t[n.source]&&(t[n.source]={});var r=t[n.source],o=n.type+"."+n.name;null==r[o]&&(r[o]=[]),r[o].push(n.target)}return t},buildIdObjMap:function(e){for(var t={},i=e.New.Objects,n=0;n<i.length;n++){var r=i[n];t[r.id]=r}return t},addSourceToAsm:function(e,t){for(var i=t.getOccs(e),n=0;n<i.length;n++)this.addSourceToOcc(e,i[n],t)},addSourceToOcc:function(e,t,i){for(var n=this.formated[e],r=Object.keys(n),o=0;o<r.length;o++){var s=r[o];this.addCategoryToSourceOcc(n,s,t,i)}},addCategoryToSourceOcc:function(e,t,i,n){var o=r.relationLabels[t];if(null!=o)for(var s=this.addToOcc(t,{Title:o.label,icon:o.icon,physicalid:t,attributes:{revision:" "}},i,n),a=e[t],l=0;l<a.length;l++){var u=a[l],c=this.idObjMap[u],d={Title:c["ds6w:label"],icon:c.icon_url,physicalid:c.id,type:c["ds6w:type"],attributes:{revision:c.revision,name:c["ds6w:identifier"],"revision-physicalid":c.id,"PLMReference.V_DerivedFrom":c.rootSource}};this.addToOcc(u,d,s,n)}},addToOcc:function(e,t,i,n){var r=n.addNode(e,t),o=n.addOcc(r.nodeid);return n.addRel(i.occurrenceid,o.occurrenceid),o},newAsm:function(e){return{asm:e,getOccs:function(e){if(this.pidOccsMap=this.pidOccsMap||{},void 0===this.pidOccsMap[e]){this.pidOccsMap[e]=[];for(var t=0;t<this.asm.occurrences.length;t++){var i=this.asm.occurrences[t];e==this.asm.nodes[i.nodeid].physicalid&&this.pidOccsMap[e].push(i)}}return this.pidOccsMap[e]},getChildOcc:function(e,t){for(var i=0;i<this.asm.occurrencerelationships.length;i++){var n=this.asm.occurrencerelationships[i];if(n.parent==e){var r=this.asm.occurrences[n.child];if(this.asm.nodes[r.nodeNdx].physicalid==t)return r}}return null},getNode:function(e){if(this.pidNodeMap=this.pidNodeMap||{},void 0===this.pidNodeMap[e]){for(var t=0;t<this.asm.nodes.length;t++){var i=this.asm.nodes[t];i.physicalid==e&&(this.pidNodeMap[e]=i)}void 0===this.pidNodeMap[e]&&(this.pidNodeMap[e]=null)}return this.pidNodeMap[e]},addNode:function(e,t){var i=this.getNode(e);return null!=i?i:((i=t).nodeid=this.asm.nodes.length,this.asm.nodes.push(i),this.pidNodeMap[e]=i,i)},addOcc:function(e){var t={occurrenceid:this.asm.occurrences.length,nodeid:e,xform:["n/a"]};return this.asm.occurrences.push(t),t},addRel:function(e,t){var i={parent:e,child:t};this.asm.occurrencerelationships.push(i)}}}});function o(e,n,r,o){var s=widget.getValue("x3dPlatformId"),a=t.get3DSpaceWSUrl(s,e);i.authenticatedRequest(a,{method:"POST",type:"json",timeout:12e4,data:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:r,onFailure:o})}return r.docRels=["v6_specdoc_to","v6_annexdoc_to"],r.otherRels=["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"],r.relationLabels={"SpaceAssignment_to.472":{label:n.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:n.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:n.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:n.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:n.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:n.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:n.specificationDocuments,icon:""}},r.get=function(e,t,i,n){null!=e&&t.length>0?function(e,t,i,n){var s={relations:t,countmanagement:!1,debug:!1,trueREST:!0,widgetId:widget.id,timeout:"6000",ids:e};"compareWidgetOdtId"==widget.id&&(s=null),o("/resources/enorelnav/navigate/getecosystem",s,function(e){var t=new r(e);i(t)}.bind(this),n)}(e,t,function(e){var t=e.getLinkedObjectIds();t.length>0?function(e,t,i){for(var n=[],r=0;r<e.length;r++)n.push({id:e[r]});o("/resources/compare/index/fetchRootSource",{data:n},t,i)}(t,function(t){e.addRootSourceToAttributes(t),i(e)},n):i(e)},n):i(null)},r}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager",["DS/Selection/CSOManager","DS/Selection/HSOManager","DS/ApplicationFrame/CommandsManager"],function(e,t,i){var n=function(e){this._plugSvcs=e,this._onPostAddCSOManagerToken=null,this._onPostRemoveCSOManagerToken=null,this._updateState="NONE",this.hookupCrossSelectionCallbacks()};function r(){const e=i.getCommand("PAD3DViewerNavigateOnSelectionHdr",null);return e&&Array.isArray(e._selection)&&e._selection.length}return n.prototype.destroy=function(){null!=me._onPostAddCSOManagerToken&&(e.unsubscribe(me._onPostAddCSOManagerToken),me._onPostAddCSOManagerToken=null),null!=me._onPostRemoveCSOManagerToken&&(e.unsubscribe(me._onPostRemoveCSOManagerToken),me._onPostRemoveCSOManagerToken=null)},n.prototype.getUpdateState=function(){return this._updateState},n.prototype.setUpdateState=function(e){this._updateState=e},n.prototype.hookupCrossSelectionCallbacks=function(){var t=this;null!=t._onPostAddCSOManagerToken&&e.unsubscribe(t._onPostAddCSOManagerToken),t._onPostAddCSOManagerToken=e.onPostAdd(function(n){if("FOCUSON"!==t.getUpdateState()&&r()&&t.setUpdateState("FOCUSON"),"NONE"===t.getUpdateState()||"FOCUSON"===t.getUpdateState()){"NONE"==t.getUpdateState()&&t.setUpdateState("INTERNAL");let r=e.get();if(r.length>2){const e=i.getCommand("LevelSelectorHdr",null);null!=e&&e.endExecute()}t._onViewerSelection(n,r,t._plugSvcs)}}),null!=t._onPostRemoveCSOManagerToken&&e.unsubscribe(t._onPostRemoveCSOManagerToken),t._onPostRemoveCSOManagerToken=e.onPostRemove(function(i){if("EXTERNAL"!=t.getUpdateState()){let n=e.get().splice();t._onViewerSelection(i,n,t._plugSvcs)}})},n.prototype.notifyClearHighlights=function(){e.empty(),t.empty()},n.prototype.notifyNewHighlights=function(i,n){try{var o=this;if("FOCUSON"!==o.getUpdateState()||r()||o.setUpdateState("INTERNAL"),"NONE"==o.getUpdateState()){o.setUpdateState("EXTERNAL");e.get();e.empty(),t.empty(),i.length>0&&!1!==n&&(e.add(i),t.add(i)),o.setUpdateState("NONE")}else"FOCUSON"==o.getUpdateState()?(t.empty(),i.length>0&&t.add(i)):o.setUpdateState("NONE")}catch(e){o._plugSvcs.errout("EXCEPTION working with CSO/HSO managers: "+e)}},n.prototype._onViewerSelection=function(e,t){var i=t.length;if(i>0){this._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection "+i+" selections");var n=function(e){var t=[];return e.forEach(function(e){for(var i="",n=e.pathElement.externalPath,r=1;r<n.length;r++){var o=n[r].modelIdentification;if(null!=o){var s=o.lastIndexOf(".");i+="/"+o.substr(0,s)}}t.push(i)}),t}(t);this._plugSvcs.postEvent("3DVIEW_NODES_SELECTED_EVENT",{nodePathArray:n})}else this._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection 0 selections (clear)"),this._plugSvcs.postEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",{})},n}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList",[],function(){var e=function(e,t){this._nodePair_byIndexArray=[],this._riNodeArray_base=e,this._riNodeArray_comp=t,this.indexMax_base=e.length,this.indexMax_comp=t.length};return e.prototype.destroy=function(){this._nodePairIndexArray=null,this._riNodeArray_base=null,this._riNodeArray_comp=null},e.prototype.add=function(e,t,i,n,r,o,s){var a=this,l={index_base:e,index_comp:t,relIndex:i,relName:n,adjIndex:r,adjFlagArray:o,instFlagNdxs:s||[]};null==a._nodePair_byIndexArray[i]&&(a._nodePair_byIndexArray[i]=[]),null==a._nodePair_byIndexArray[i][r]&&(a._nodePair_byIndexArray[i][r]=[]),a._nodePair_byIndexArray[i][r].push(l)},e.prototype.getResult=function(){var e=this,t=new Array(e.indexMax_base),i=new Array(e.indexMax_comp),n=[];e._nodePair_byIndexArray.forEach(function(r,o){r.forEach(function(r,o){r.forEach(function(r){var s=r.index_base,a=r.index_comp;if(null==t[s]&&null==i[a]){t[s]="X",i[a]="X";var l={riNode_base:e._riNodeArray_base[s],riNode_comp:e._riNodeArray_comp[a],relName:r.relName,adjustment:o,adjFlagArray:r.adjFlagArray,instFlagNdxs:r.instFlagNdxs||[]};n.push(l)}})})});for(var r=[],o=t.length,s=0;s<o;s++)null==t[s]&&r.push(e._riNodeArray_base[s]);for(var a=[],l=i.length,u=0;u<l;u++)null==i[u]&&a.push(e._riNodeArray_comp[u]);return{riMatchedNodePairArray:n,riUnmatchedNodeArray_base:r,riUnmatchedNodeArray_comp:a}},e}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView",["UWA/Controls/Abstract","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t){return e.extend({init:function(e){this._baselineColor=e.colorLeft,this._compareColor=e.colorRight,this.displayMode=e.displayMode,this.STRUCT_COMPARE_PANEL_LEFT="struct-tree-"+this.displayMode.id+"-left",this.STRUCT_COMPARE_PANEL_RIGHT="struct-tree-"+this.displayMode.id+"-right"},createTreeNodeModel:function(){console.error("This method must be filled in by a derived class")},getColDefs:function(){console.error("This method must be filled in by a derived class")},getViewID:function(){return this.displayMode.id},getDisplayMode:function(){return this.displayMode},getDGVContainersConfig:function(){return[{id:this.STRUCT_COMPARE_PANEL_LEFT,panelCaption:t.Left,panelAddClass:"treePanel-cmpBase",panelCollapseable:!0,initSize50pct:!0,color:this._baselineColor,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+this._baselineColor,width:"50%"}},{id:this.STRUCT_COMPARE_PANEL_RIGHT,panelCaption:t.Right,panelAddClass:"treePanel-cmpCmp",panelCollapseable:!1,initSize50pct:!0,color:this._compareColor,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+this._compareColor,padding:"0px 3px",width:"50%"}}]}})}),define("DS/CompareWidget2/userSettings/SettingsBase",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e){"use strict";return{namespace:"",compareSettings:{},viewSettings:{PROP_VIEW:{showOnlyDifferences:{value:!1},attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option"},default_attributes:{value:["label","owner","current","modified","type","originated","revision"]},attributes_always_shown:{value:["label"]},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown"}},STRUCT_VIEW:{display_mode:{value:"tree"},currentViewID_MULTI:{value:""},statuses_to_hide:{value:[],V1Preference:[{openness_revisions:{oldValue:!0,newValue:"REVISION"}},{openness_duplicates:{oldValue:!0,newValue:"DUPE"}}]},statuses_unchecked:{value:[]},multi_statuses_to_hide_and:{value:!1,widgetSetting:{type:"boolean",label:e.uncheckBothPrimaryAndSecondary,defaultValue:!1}},show_3dshape_of_3dpart:{value:!1,widgetSetting:{type:"boolean",label:e.show3dShapeOf3dPart,defaultValue:!1}}}},exportSettings:{exportOldFormat:{value:!1,widgetSetting:{type:"boolean",label:e.exportOldFormat,defaultValue:!1}}}}}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor",["DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e){function t(t,i,n,r,o){var s=!1,a=!1,l=null;return null==r?a=!0:null!=(l=function(e,t,i){var n=function(e,t,i){var n=[];return e.visit_riTreeAndFN(function(e){if(e.getAttr("INST.physicalid")==i){var r=e.getParent();(null!=r?r.getAttr("REF.physicalid"):null)==t&&n.push(r)}return!0}),n}(e,t,i);return n.forEach(function(e){e.rmChild(i)}),n}(t,n,r))&&(a=!0),1==a&&(s=null==o||function(t,i,n,r,o){var s=!1;null==o&&(o=function(e,t){var i=[];return e.visit_riTreeAndFN(function(e){e.getAttr("REF.physicalid")==t&&i.push(e)}),i}(t,n));var a=null;return i.forEach(function(e){e.getObjIDSpec().getPhysID()!=r||(a=e)}),null!=a&&(o.forEach(function(t){var i=new e;i.setAttr("did",null),i.setAttr("ds6w:type","VPMInstance"),i.setAttr("logicalid","00000000000000000000000000000001"),i.setAttr("matrixtxt","1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),i.setAttr("physicalid","00000000000000000000000000000001");var n=a.getRoot();n.set_dbObj_INST(i),t.addChild(n),n.setParent(t)}),s=!0),s}(t,i,n,o,l)),s&&a}return{applyCommands:function(e,t,i,n,r){var o=this,s=!1;if(1==e.get_editsHaveBeenApplied())o._plugSvcs.errout("Edit commands already applied to assembly... ignoring...");else{var a=!1;t.forEach(function(t){if(0==o.applyCommand(e,t,i,n)){a=!0;var s="refInstTreeEditor: Command '"+JSON.stringify(t)+"' failed :: ";if(1==r)return void o._plugSvcs.errout(s+" edits to structure aborted at point of failure.");o._plugSvcs.errout(s+" edits to structure continue, skipping this command...")}}),s=!a}return s},applyCommand:function(e,i,n,r){var o=!1,s=null;if(null==i)s="refInstTreeEditor given null command; skipping";else{var a=i.parent,l=null,u=null;switch(i.op){case"INSERT":null==(l=i.inNode)&&(s="Op is INSERT, but inNode is missing");break;case"REMOVE":null==(u=i.rmNode)&&(s="Op is REMOVE, but rmNode is missing");break;case"REPLACE":null==(l=i.inNode)&&(s="Op is REPLACE, but inNode is missing"),null==(u=i.rmNode)&&(s="Op is REPLACE, but rmNode is missing");break;default:s="UNSUPPORTED command in edits list: '"+i.op+"', skipping..."}}return null!=s?me._plugSvcs.errout(s):o=t(e,n,a,u,l),o}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand",[],function(){return{jsName:"FILE_EXPAND",doExpand:function(e,t,i,n,r){return new Promise(function(t,i){var r=e._moduleName;n.dbgout("  ... loading file: "+r);try{require([r],function(e){t(e)},function(e){i(e)})}catch(e){n.errout("Exception trying to load data file:: "+modulePath+"::"+e)}})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_CUST_ATTRS_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/Utils/MaturityUtils"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},execute:function(e,i){var n=this;n._parent(e,i);let r=e.crTreeArray,o=[];r.forEach(function(e){o.push(t.prepTreeForMaturityAndPolicyPromise(e,n._plugSvcs))}),Promise.all(o).then(()=>{null!=e?n.reportOK(e):n.reportKO()})}})}),define("DS/CompareWidget2/widget/controls/TreesContainer",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({name:"treesContainer",init:function(e){this._panels=[],this._parent(e),this._buildLayout()},addPanel:function(e){e.inject(this.getContent()),this._panels.push(e),e.addEvent("collapseChange",this._updateLayout.bind(this))},setPanelCaption:function(e,t){this._panels.find(t=>t.options.contentId===e).setCaption(t)},_updateLayout:function(){var e=this._panels.length,t=this._panels.reduce(function(e,t){return e+(t.isCollapsed()?0:1)},0);2===e&&t>0&&this._panels.forEach(function(e){e.isCollapseable()&&2===t&&e.setSize50pct()}),3!==t&&4!==t||this._panels.forEach(function(e){e.isCollapseable()&&(3===t?e.setSize50pct():e.setSize33pct())})},_buildLayout:function(){var e={class:this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,e)),this._render()},_render:function(){}})}),define("DS/CompareWidget2/plugins/STRUCTURE/Utils/MaturityUtils",[],function(){return{_maturityStatesInfo:null,_createCSSClass:function(e,t,i){if(null===document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.id=e;let r=i||"."+e;n.innerHTML=r+t,document.getElementsByTagName("head")[0].appendChild(n)}},_cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},_getMaturityClass:function(e,t){return"lc-status-"+this._cleanStatusForCSS(e)+(t?"-withClass":"")},_addCSSMaturityClasses:function(e,t){var i=this;void 0!==e&&e.forEach(function(e){let n=e.policyName;e.states.forEach(function(e){let r=e.activeColor,o="{color:"+("#FFFFFF"===r?"#000000":"#FFFFFF")+" ; background-color:"+r+";}",s=i._cleanStatusForCSS(e.stateSysName),a="lc-status-"+i._cleanStatusForCSS(n)+"-"+s+(t?"-withClass":""),l="."+a+(t?" ."+t:"");i._createCSSClass(a,o,l)})})},_getMaturityStateUserNameFromCRNode(e){var t="",i=this._getMaturityStateInfoFromCRNode(e);return i&&(t=i.stateUserName),t},_getPolicyUserNameFromCRNode(e){this._getMaturityStateInfoFromCRNode(e)},_getMaturityStateActiveColorFromCRNode(e){var t="#FFFFFF",i=this._getMaturityStateInfoFromCRNode(e);return i&&(t=i.activeColor),t},_getMaturityStateCSSClassFromCRNode(e,t,i){var n="",r=e.getAttr(t||"policy"),o=this._getMaturityStateInfoFromCRNode(e,t,i);if(o){var s=r+"."+o.stateSysName;n=this._getMaturityClass(s,"wux-controls-label")}return n},_getMaturityStateInfoFromCRNode(e,t,i){var n=null;i=i||"last.current",t=t||"policy";var r="",o="";if(e)if(e.getAttr(i))o=e.getAttr(t),r=e.getAttr(i);else{var s=e.getMatchInfo();if(s){var a=s.getBaseNode();if(a.getAttr(i))o=a.getAttr(t),r=a.getAttr(i);else{var l=s.getCompNode();l.getAttr(i)&&(o=l.getAttr(t),r=l.getAttr(i))}}}var u=this._maturityStatesInfo.policies.find(e=>e.policyName===o);return u&&(n=u.states.find(e=>e.stateSysName===r)),n},_getMaturityStatesAttributes:function(e,t){var i=this;return new UWA.Class.Promise(function(n,r){var o=new Set;if(e.visitAll_treeAndFN(0,function(e){var i=e.getAttr(t||"policy");i&&o.add(i)}),e.visitAll_treeAndFN(1,function(e){var i=e.getAttr(t||"policy");i&&o.add(i)}),o.size){var s={policies:Array.from(o)},a=e.getRoot(0).getObjIDSpec_REF(),l=a.getTenant(),u=a.getServiceName(),c=a.getSecurityContext(),d=i._plugSvcs.nowMS();i._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/maturity/getStatesAttributes","POST",s,"json",l,u,c).then(function(e){i._plugSvcs.reportTime(d,"getStatesAttributes request OK.");var t="string"==typeof e?JSON.parse(e):e;n(t)},function(e){i._plugSvcs.reportTime(d,"getStatesAttributes request failed."),i._plugSvcs.showAlertBox("getStatesAttributes request unsuccessful.",null,"error"),i._plugSvcs.errout("Failure of getStatesAttributes request: "+e)})}else n(null)})},_getPolicyAttributes:function(e,t){return new Promise((i,n)=>{require(["DS/LifecycleServices/TranslationService"],function(r){let o=new r({handleError:!0});e.visitAll_treeAndFN(0,function(e){var i=e.getAttr(t||"policy");i&&o.addPolicy(i)});var s=e.getRoot(0).getObjIDSpec_REF().getTenant();o.initAsync(s).then(()=>i(o),()=>n())})})},prepTreeForMaturityAndPolicyPromise:function(e,t){let i=this;return i._plugSvcs=t,new Promise((t,n)=>{for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,e=>{let t=e.getAttr("REF.ds6w:status");t?(t=t.split("."),e.addAttr("policy",t[0]),e.addAttr("last.current",t[1])):null!=e.getAttr("REF.ds6w:policy")&&e.addAttr("policy",e.getAttr("REF.ds6w:policy"))});Promise.all([i._getMaturityStatesAttributes(e),i._getPolicyAttributes(e)]).then(n=>{null!=n[0]&&(i._maturityStatesInfo=n[0],i._addCSSMaturityClasses(i._maturityStatesInfo.policies,"wux-controls-label")),null!=n[1]&&(i._translationService=n[1]);for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,e=>{if(i._maturityStatesInfo){let t=i._getMaturityStateUserNameFromCRNode(e,n);t&&(e.addOrSetCustAttr("REF.ds6w:status",t),e.addOrSetCustAttr("maturity.class",i._getMaturityStateCSSClassFromCRNode(e)))}i._translationService&&null!=e.getAttr("REF.ds6w:policy")&&e.addOrSetCustAttr("REF.ds6w:policy",i._translationService.translatePolicy(e.getAttr("REF.ds6w:policy")))});t(e)},()=>{n(e)})})}}}),define("DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV",[],function(){var e={encoding:"UTF-8",kind:"InstRef",version:"1.1"};function t(e,t,i,n){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":i,boundingbox:n}}function i(i,n,r){var o,s=null,a=[],l=0,u=0,c=!1;i.visit_riTreeAndFN(function(e){var i=null,o=e.isLeaf();let d=e.isRoot();var p=e.get_dbObj_REF(),h=p.getAttr("physicalid")+"."+n,_=p.getAttr("ds6w:type"),f=p.getAttr("ds6w:globaltype"),g=p.getAttr("boundingbox"),m=p.getAttr("ds6wg:XCADOrientationExt.V_WorldOrientation");if(null!=m&&""!==m||(m=p.getAttr("vWorldOrientation")),null!=m&&""!==m||(m="0"),o){var S=p.getAttr("thumbnail_3d");if(null==S&&(0==c&&(c=!0,r.dbgout("Thumbnail_3d visuals not yet available; using CGRs")),S=p.getAttr("cgr")),null!=S)u++,i=function(e,i,n,r,o){var s=t(e,i,n,r);return s.thumbnail_3d=o,s}(h,_,f,g,S);else{if(!d)return r.dbgout("NO VISUAL // excluded from viewerJSON ID:: "+h+"("+p.getAttr("ds6w:label")+")"),!0;(i=t(h,_,f,g))["ds6wg:XCADOrientationExt.V_WorldOrientation"]=m}}else i=t(h,_,f,g),d&&(i["ds6wg:XCADOrientationExt.V_WorldOrientation"]=m);if(l++,a.push(i),1==d)null!=s?r.errout("ERROR - TREE has more than ONE root"):s=i;else{var T=e.get_dbObj_INST(),C=T.getAttr("physicalid")+"."+n,E=T.getAttr("ds6w:type"),v=(T.getAttr("ds6w:globalType"),function(e,t,i,n,r,o){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":i,matrixtxt:n,from:r,to:o}}(C,E,"ds6w:Instance",T.getAttr("matrixtxt"),e.getParent().get_dbObj_REF().getAttr("physicalid")+"."+n,h));a.push(v)}return!0}),o=a.length;var d=function(t,i,n,r){var o=JSON.parse(JSON.stringify(t));return{infos:e,results:[o,{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:i}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:n}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:r}}]}}(s,o,l,u);s.resourceid;return{rootStats:d,infos:e,results:a}}return{refInstTree2ViewerJSON:function(e,t){var n=[];return e.forEach(function(e,r){var o=i(e,r,t);if(null==o)throw new Error("Failure creating view3DJSON");var s=e.getRoot().getAttr("REF.physicalid")+"."+r;n.push({rootID:s,structure:o})}),n}}}),define("DS/CompareWidget2/support/cw2Utils",["DS/WidgetServices/WidgetServices"],function(e){var t={},i=["     ","    ","   ","  "," ",""];return{jsClass:"CW2UTILS",createRandomString:function(e,t,i){if(null==i&&(i=t),t>i){this.errout("MIN/MAX values reversed... switching");var n=t;t=i,i=n}var r=Math.random()*(i-t)+t;return e+Math.random().toString(36).substring(r)},dupeJson:function(e){var t=null;if(null!=e)try{t=JSON.parse(JSON.stringify(e))}catch(t){this.errout("Exception duping JSON: "+this.stringify(e)),this.errout(t)}return t},stringify:function(e){var t=null;if(null!=e){e.constructor==String&&(t=e);try{t=JSON.stringify(e)}catch(i){t=e.toString()}}return t},nowMS:function(){return(new Date).getTime()},reportTime:function(e,t){if(!widget||widget.CV2Timing){var n=t.indexOf("[");(-1==n||n>3)&&(t="[FRMWRK]"+t);var r=((this.nowMS()-e)/1e3).toString(),o=r.length,s=r.indexOf(".");-1==s&&(s=1);(s<i.length?i[s]:"").length;var a=r;console.log("[C2.TIME]"+t+"   //  {"+a+" seconds}  \\\\ ")}},enableDebugLabel:function(e){t[e]=!0},disableDebugLabel:function(e){t[e]=!1},dbgout:function(e,t){this.dbgout2(!1,e,t)},dbgout2:function(e,i,n){try{if(null!=widget&&!widget.CV2Debug)return}catch(e){return void console.error("EXCEPTION trying to output message: "+e+", continuing")}var r=null!=n?n:i,o=null!=n?i:null;if(null!=o){if(1!=t[o])return;r="["+o+"] "+r}var s="";"["!=r.charAt(0)&&(s=" "),r="[C2.DBG ]"+(r=e?"[PLUGIN]"+s+r:"[FRMWRK]"+s+r),console.log(r)},warnout:function(e){console.error("[C2.WRN]"+e)},errout:function(e){console.error("[C2.ERR]"+e)},splitSvcType:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),name:e.substring(t+1),asStr:e},ret},splitSvcName:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),name:e.substring(t+1),asStr:e},ret},splitSvcConfig:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),configName:e.substring(t+1),asStr:e},ret},getCurrentTenant:function(){var e=null;try{e=widget.getValue("x3dPlatformId")}catch(e){this.dbgout("attempted to get tenant information from widget and failed... must be running an ODT... using 'OnPremise'")}return null==e&&(e="OnPremise"),e},getViewDefs:function(e){var t=[];return function e(i){Object.values(i).forEach(i=>{(i.constructor!==Array?[i]:i).forEach(i=>{i.constructor===String?t.push(i):i.constructor===Array?i.forEach(e=>{e.constructor===String&&t.push(e)}):null!=i&&e(i)})})}(e),t},checkViewConfig:function(e){return function e(t,i){var n=1===Object.keys(t).length&&(null==i&&("ROW"===Object.keys(t)[0].toUpperCase()||"COL"===Object.keys(t)[0].toUpperCase())||"ROW"===i&&"COL"===Object.keys(t)[0].toUpperCase()||"COL"===i&&"ROW"===Object.keys(t)[0].toUpperCase());for(var[r,o]of Object.entries(t))n=n&&(o.constructor!==Array?[o]:o).every(t=>t.constructor===String||t.constructor===Array&&t.every(e=>e.constructor===String)||null!=t&&t.constructor!==Array&&t.constructor!==String&&e(t,r));return n}(e)},getDeviceType:function(){let e="desktop",t="ontouchstart"in document.documentElement&&/mobi/i.test(navigator.userAgent),i=window.matchMedia("(max-width: 480px) and (orientation:portrait)"),n=window.matchMedia("(max-height: 480px) and (orientation:landscape)"),r=i.matches||n.matches;return t&&r?e="smartphone":t&&!r&&(e="tablet"),e},csValsEquivalent:function(e,t){var i=!1;if(e==t)i=!0;else if(null!=e&&null!=t){var n=e.split(",");n.forEach(function(e,t){n[t]=e.trim()});var r=t.split(",");r.forEach(function(e,t){r[t]=e.trim()});var o=n.length;if(o==r.length){for(var s=n.sort(),a=r.sort(),l=!1,u=0;u<o;u++)if(s[u]!=a[u]){l=!0;break}i=!l}}return i},formatDate:function(t){var i=e.formatDate(t,!0);if(0==i.localeCompare(t)){var n=new Date(t);i=e.formatDate(n,!0)}return i}}}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTreesViewActions",["UWA/Controls/Abstract"],function(e){return e.extend({init:function(e,t,i){this.structComparePanelCBs=i,this._plugSvcs=t,this._fvpTrees=e},_buildSelectedDataArray_list:function(e,t){var i=[];return[e,t].forEach(function(e,t){var n=[];e.forEach(function(e){var i=e.options.data;if(!i.isDummy()){var r=i.getAttr("physicalID_REF"),o=i.getAttr("physicalID_INST");me._crTree.visitVisible_treeAndFN(t,function(e){if(e.getAttr("physicalID_REF")==r){var t=e.getDBContext(),i=new ObjIDSpec(r,e.getAttr("type"),t.securityContext,t.tenant,t.serviceName),s=null;null!=o&&(s=new ObjIDSpec(o,e.getAttr("type"),t.securityContext,t.tenant,t.serviceName));var a={ObjIDSpec:i,IDPath:e.getPath(),instObjIDSpec:s};n.push(a)}return!0})}}),i.push(n)}),i},_buildSelectItem:function(e){var t=null;if(null!=e&&!e.isDummy()){var i=e.getObjIDSpec_REF();if(null!=i){var n=e.getPath();t={ObjIDSpec:i,instObjIDSpec:e.getObjIDSpec_INST(),IDPath:n}}}return t},_buildSelectedDataArray_tree:function(e,t){var i=[],n=[],r=[];return e.forEach((i,o)=>{var s=e[o].options.data;null!=s&&(null!=(a=this._buildSelectItem(s))&&n.push(a));var a,l=o<t.length?t[o].options.data:null;null!=l&&(null!=(a=this._buildSelectItem(l))&&r.push(a))}),i.push(n),i.push(r),i},_buildSelectedDataArray:function(e){var t=this._fvpTrees.getNTHGridSelectedNodes(0),i=this._fvpTrees.getNTHGridSelectedNodes(1);return!e||0!=t.length&&0!=i.length?this._buildSelectedDataArray_tree(t,i):null},onTreesSelectRow:function(e){var t=this._buildSelectedDataArray(e);null!=t&&(this._plugSvcs.postEvent("NEW_CURRENT_SELECTION_EVENT",{isAsync:!0,selectedData:t,crTree:this._crTree,structDisplayMode:"STRUCT"}),this.structComparePanelCBs.syncOverview())},onTreesUnselectRow:function(){this._syncOverview(),this.onTreesSelectRow(!0)},onTreesPreCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesPreExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.structComparePanelCBs.doExpandCollapseUpdates()},onTreesExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.structComparePanelCBs.doExpandCollapseUpdates()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/flagInfo",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e){function t(e,t,i){let n={title:e.NLS};void 0!==e.tooltipCustomRule&&null!==e.tooltipCustomRule&&e.tooltipCustomRule.length>0&&(n.shortHelp=e.tooltipCustomRule);let r="",o=-1;void 0!==e.legendPosition&&null!==e.legendPosition&&(r=e.legendPosition.grouping,o=e.legendPosition.position);let s=1,a=0;return"left"===r?(s=0,a=o):"right"===r?(s=2,a=o):1===i&&(s=2),{id:e.flagName,label:e.NLS,tooltip:n,modulePath:e.modulePath,color:e.color,description:"",checked:!0,matchedPairs:[],visibleFlag:t,legendGrouping:s,legendSubGrouping:a}}var i=function(t,i){var n,r;this.statusIDFlagData_all=(n=t,r={},["SYSTEM_RULE_ID_FLAGS","CUSTOM_RULE_ID_FLAGS","CUSTOM_MATCH_ADJ_FLAGS","BUBBLE_FLAGS"].forEach(function(t){var i=n[t];null!=i&&Object.keys(i).forEach(function(i){var o=n[t][i].NLS,s=e[o];null!=s&&0!=s.length||(s=o),r[i]={color:n[t][i].COLOR,flagName:i,NLS:s,modulePath:n[t][i].TOOLTIP_MODULE_PATH},void 0!==n[t][i].TOOLTIP_CUSTOM_RULE&&null!==n[t][i].TOOLTIP_CUSTOM_RULE&&n[t][i].TOOLTIP_CUSTOM_RULE.length>0&&(r[i].tooltipCustomRule=n[t][i].TOOLTIP_CUSTOM_RULE),void 0!==n[t][i].LEGEND_POSITION&&null!==n[t][i].LEGEND_POSITION&&(r[i].legendPosition=n[t][i].LEGEND_POSITION)})}),r),this._plugSvcs=i,this.inUse={},this.inUse.active={}};return i.prototype.setActive=function(e){this.inUse[e]=this.inUse[e]||{},this.inUse.active=this.inUse[e]},i.prototype.getActiveFlagDisplayData=function(e){var t=this.inUse.active.flagDisplayData;return null!=e&&null!=t&&(t=t[e]),t},i.prototype.getActiveFlagDisplayData_excludeFilteredByTypeAttr=function(){var e=this.inUse.active.flagDisplayData,t={};return Object.keys(e).forEach(function(i){for(var n=e[i],r=n.matchedPairs,o=!1,s=0;s<r.length;s++){if(0==r[s].getIsHidden_byTypeAttr()){o=!0;break}}o&&(t[i]=n)}),t},i.prototype.getActiveMaxFlags=function(){return this.inUse.active.maxFlags},i.prototype.get_statusIDFlag=function(e){var t=this.statusIDFlagData_all[e];return null==t&&(this._plugSvcs.errout("view def options missing RULE_ID_FLAG definition for: "+e+"; using default color RED"),this.statusIDFlagData_all[e]={color:"#ff0000",NLS:e,flagName:e},t=this.statusIDFlagData_all[e]),t},i.prototype.createFlagDisplayData=function(e,i,n){for(var r={},o=0,s=i.length,a=0;a<s;a++){let e=i[a];var l=!0===e.qtyIsDiffFlag,u=e.getAllStatusArray(!0)||[],c=u.length,d=c+(l?1:0);d>o&&(o=d);for(var p=0;p<c;p++){var h=u[p];if(null!=h&&""!=h&&("UNRELATED"!=h||n)){if(null==r[h]){let e=this.get_statusIDFlag(h);r[h]=t(e,!0,p)}r[h].matchedPairs.push(e)}}if(l){if(null==r.QUANTITY){var _=this.get_statusIDFlag("QUANTITY");r.QUANTITY=t(_,!0)}r.QUANTITY.matchedPairs.push(e)}}if(null==r.IDENTICAL){var f=this.get_statusIDFlag("IDENTICAL");r.IDENTICAL=t(f,!1)}this.inUse[e]={flagDisplayData:r,maxFlags:o}},i}),define("DS/CompareWidget2/Customization/viewConfigMangler",[],function(e){"use strict";return{applyCustomProfileToViewConfig:function(e,t){for(var i=JSON.parse(JSON.stringify(t)),n={},r={},o=[],s={},a=[],l={},u={},c=e.UseCustomMatchingRules?e.MatchingRules.length:0,d=0;d<c;d++){let t=e.MatchingRules[d],i=t.name,a=t.color;"#"!=a.charAt(0)&&(a="#"+a);t.description;let u=t.attributes;o[d]=i,l[i]={COLOR:a,TOOLTIP_MODULE_PATH:"",NLS:i};let c=[];for(var p of u){let e=p.name,t=p.objType[0],i=p.icon,o="Instance"===t.substr(t.length-8)?"INST":"REF",a=o+"_"+e+"_"+"ATTR",l=o+"."+e;n[a]=l,r[a]={name:l,objType:t,icon:i,origin:"matching_rule"},c.push({info:0===c.length?"same":"and",name:l});let u="COMP_"+o+"_"+e;null==s[u]&&(s[u]=[],s[u][0]=[a,a],s[u][1]=[]),s[u][1][d]="EQ"}l[i].TOOLTIP_CUSTOM_RULE=c,l[i].LEGEND_POSITION={grouping:"left",position:d}}Object.keys(s).forEach(function(e){for(var t=0;t<c;t++)null==s[e][1][t]&&(s[e][1][t]="N/A")});let h=e.AdditionalStatuses.length;for(var _=0;_<h;_++){let t=e.AdditionalStatuses[_];if(""!==t.name&&t.attributes.length>0){let e=t.name,i=t.color;"#"!=i.charAt(0)&&(i="#"+i);t.description;let o=t.attributes,s={NAME:e,PROPS:[],PROPSET:[],FLAG_ON:"NEQ",IS_VISIBLE:!0,MATCH_ADJ:0},l=[];for(var p of o){let e=p.name,i=p.objType[0],o=p.icon,a="Instance"===t.facet?"INST":"REF",u=a+"_"+e+"_"+"ATTR",c=a+"."+e;n[u]=c,void 0!==r[u]&&null!==r[u]||(r[u]={name:c,objType:i,icon:o,origin:"additional_status"}),l.push({info:0===l.length?"different":"or",name:c}),s.PROPSET.push(u)}a.push(s),u[e]={COLOR:i,TOOLTIP_MODULE_PATH:"",NLS:e},u[e].TOOLTIP_CUSTOM_RULE=l,u[e].LEGEND_POSITION={grouping:"right",position:_}}}if(i.customProfileName=e.Name,Object.assign(i.PLUGDEFS.StructFetch.Options.CV_PROPS,n),i.PLUGDEFS.StructFetch.Options.DB_PROPS={},i.PLUGDEFS.StructFetch.Options.DB_FALLBACK=!1,i.PLUGDEFS.StructFetch.Options.MULTI_VALUE_ATTRS=e.MULTI_VALUE_ATTRS,Object.assign(i.PLUGDEFS.StructCompare.Options.PROPS,n),c>0){i.PLUGDEFS.StructCompare.Options.CUSTOM_RELATIONSHIP_NAMES=o,i.PLUGDEFS.StructCompare.Options.CUSTOM_COMPARISONS=s,i.PLUGDEFS.StructCompare.Options.CUSTOM_MATCH_ADJUSTMENTS=a;let e=["LEFT_ONLY","RIGHT_ONLY","QUANTITY","UNRELATED"],t=i.PLUGDEFS.StructCompare.Options.SYSTEM_RELATIONSHIP_NAMES.filter(t=>e.includes(t));i.PLUGDEFS.StructCompare.Options.SYSTEM_RELATIONSHIP_NAMES=t,i.PLUGDEFS.StructCompare.Options.COMPUTE_DIFFERENT=!0}else for(var f of a)i.PLUGDEFS.StructCompare.Options.CUSTOM_MATCH_ADJUSTMENTS.push(f);if(i.PLUGDEFS.StructCompare.Options.CUSTOM_PROFILE_IN_USE=!0,c>0){i.PLUGDEFS.StructDisplay.Options.CUSTOM_RULE_ID_FLAGS=l;let e=["LEFT_ONLY","RIGHT_ONLY","QUANTITY","UNRELATED"];!0===i.PLUGDEFS.StructCompare.Options.CUSTOM_PROFILE_IN_USE&&e.push("DIFFERENT");let t=Object.keys(i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS).filter(t=>e.includes(t)).reduce((e,t)=>(e[t]=i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS[t],e),{});i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS=t}return h>0&&Object.assign(i.PLUGDEFS.StructDisplay.Options.CUSTOM_MATCH_ADJ_FLAGS,u),i.PLUGDEFS.StructDisplay.Options.CUSTOM_PROFILE_IN_USE=!0,i.PLUGDEFS.StructDisplay.Options.PROPS=r,i.PLUGDEFS.StructListViewPrep.Options={isCustomMatching:o.length>0},i}}}),define("DS/CompareWidget2/Customization/Profile",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){var e=null,t=null,i=null,n=null,r=!1;let o="";if(1==arguments.length)e=arguments[0];else if(3==arguments.length)t=arguments[0],i=arguments[1],n=arguments[2];else{if(5!=arguments.length)throw new Error("Illegal initial state for new PROFILE");e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3],o=arguments[4],r=!0}this.Facets=[],this.AllowCustomMatchingRules=!1,this.Interfaces=[],this.SelectedTypes=[],this.UseCustomMatchingRules=!1,this.UserOverrideOK=!0,this.MatchingRules=[],this.AdditionalStatuses=[],this.Name="Default",this.Creator="unknown",this.isAdminUser=!1,this.companyId="",null!=e&&this._initFrom(e,r),null!=t&&(this.Name=t,this.NameNLS=null),null!=i&&(this.Creator=i),null!=n&&(this.isAdminUser=n),null!=o&&""!==o&&(this.companyId=o),this.Type="customization"},_initFrom:function(e,t){var i=this,n=Object.keys(e);let r="template"===e.Type;n.filter(e=>["_CustomTypesInfo","_CustomInterfacesInfo","_TypesInfo"].every(t=>e!==t)).forEach(function(n){if(i[n]=JSON.parse(JSON.stringify(e[n])),r&&t&&"Facets"===n){let t=JSON.parse(JSON.stringify(e[n])),r=[],o=[];for(let e of t){for(let t of e.ObjectTypes)r.push(t);if(void 0!==e.Interfaces&&null!==e.Interfaces)for(let t of e.Interfaces)o.push(t)}i.SelectedTypes=r,i.Interfaces=o}}),i.fromTemplateProfile=i.fromTemplateProfile||(r?e.Name:"EngineeringItemProfile")},setMatchingRules:function(e){var t=e||[];t=JSON.parse(JSON.stringify(t));this.MatchingRules=t},setAdditionalStatuses:function(e){var t=e||[];t=JSON.parse(JSON.stringify(t));this.AdditionalStatuses=t}})}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug",[],function(){function e(e,t,i){i.dbgout("------------[ A U G M E N T   T R E E   N O D E S    B E G I N ] -----------");let n=function(e,t){var i=[];return e.visit_riTreeAndFN(function(e){var t=e.get_dbObj_REF();if(null==t.getAttr("dfr")){var n=t.getAttr("physicalid"),r=t.getAttr("dfr_bootstrapID");null!=t.getAttr("dfr_in_progress")||(null==r?t.setAttr("dfr",n):(t.setAttr("dfr_in_progress",r),t.rmAttr("dfr_bootstrapID"),i.push(t)))}return!0}),i}(e);return function e(t,i,n,r){return new Promise(function(o,s){if(i.length>0){let a=function(e){var t=[];return e.forEach(function(e){t.push(e.getAttr("dfr_in_progress"))}),t}(i);(function(e,t,i){var n=widget._isODTMode()?"":i.createRandomString("Compare2-",8),r={physicalid:e,select_predicate:["bo.plmreference.v_derivedfrom"],with_synthesis:!1,label:n};return i.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",r,"json",t.tenant,t.serviceName,t.securityContext)})(a,n,r).then(function(a){let l=a.results,u=function(e,t){var i=[];if(null!=e&&e.length>0){var n={};t.forEach(function(e){var t=e.getAttr("dfr_in_progress");n[t]=e}),e.forEach(function(e){var t=null,r=null;e.attributes.forEach(function(e){"bo.plmreference.v_derivedfrom"==e.name?r=e.value:"resourceid"==e.name&&(t=e.value)});var o=n[t];if(null==r){var s=o.getAttr("dfr_in_progress");o.setAttr("dfr",s),o.rmAttr("dfr_in_progress")}else o.setAttr("dfr_in_progress",r),i.push(o)})}return i}(l,i);0==u.length?(t.visit_riTreeAndFN(function(e){let t=e.get_dbObj_REF(),i=t.getAttr("dfr_in_progress");return null!=i&&(t.setAttr("dfr",i),t.rmAttr("dfr_in_progress")),!0}),o(t)):e(t,u,n,r).then(o,s)},function(e){r.errout("GOT A KO TRYING TO AUG TREE"),s()})}else o(t)})}(e,n,t,i).then(function(t){return i.dbgout("------------[ A U G M E N T   T R E E   N O D E S    E N D  ] -----------"),e},function(e){})}return{jsClass:"REFINST_TREE_AUGMENTER",augment:function(t,i,n){var r=n.nowMS();t.visit_riTreeAndFN(function(e){return e.setDBContext(i),!0});var o=e(t,i,n);return n.reportTime(r,"--\x3e Augment tree with 'derived from root' "),o}}}),define("DS/CompareWidget2/widget/controls/TreePanel",["UWA/Controls/Abstract","DS/Core/PointerEvents"],function(e,t){"use strict";return e.extend({name:"treePanel",defaultOptions:{caption:"-",addClass:"",collapseable:!1,UIcollapseable:!0},init:function(e){this._parent(e),this._isCollapsed=!1,this._isMaximized=!1,e.initSize50pct?this.setSize50pct():this.setSize33pct(),this._buildLayout()},_buildLayout:function(){var e=this,t=" ";this.options.collapseable&&(t+=this.expandClass);var i={class:this.getClassNames("-root")+t+" "+this.options.addClass};this.elements.container=new UWA.Element("div",i);var n=new UWA.Element("div",{class:this.getClassNames("-panelHeader")});n.inject(this.elements.container),this.options.colorIndicator&&(this.elements.colorIndicator=new UWA.Element("div",{class:"fonticon fonticon-stop",styles:{color:this.options.colorIndicator,"margin-left":"10px"}}),this.elements.colorIndicator.inject(n)),this.elements.headerText=new UWA.Element("div",{class:this.getClassNames("-headerText"),html:[{tag:"section",html:this.options.caption},{tag:"section",html:""},{tag:"section",html:""},{tag:"section",html:[{tag:"div",html:""}]}]}),this.elements.headerText.inject(n),this.elements.contentContainer=new UWA.Element("div",{id:this.options.contentId,class:this.getClassNames("-contentContainer"),styles:{"border-top":this.options.contentBorderTop}}),this.elements.contentContainer.inject(this.elements.container);var r="";this.options.collapseable&&(r="treePanel-content-hide-expander"),this.elements.contentHide=new UWA.Element("div",{class:this.getClassNames("-content-hide")+" "+r,events:{click:function(){e.options.UIcollapseable&&e.options.collapseable&&e.toggleCollapsed()}}}),this.elements.contentHide.inject(this.elements.contentContainer),this.elements.captionCollapsed=new UWA.Element("span",{class:this.getClassNames("-caption-collapsed"),html:this.options.caption}),this.elements.captionCollapsed.inject(this.elements.contentHide),this.elements.content=new UWA.Element("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.contentContainer),this.options.collapseable&&(this.elements.headerBtn=new UWA.Element("div",{class:"wux-controls-button wux-controls-abstract wux-ui-state-secondary wux-ui-style-normal "+this.getClassNames("-headerButton"),events:{click:function(){e.toggleCollapsed()}}}),this.elements.headerBtnIcon=new UWA.Element("div",{class:"fonticon fonticon-expand-left treePanel-headerButtonIcon"}),this.elements.headerBtnIcon.inject(this.elements.headerBtn),this.elements.headerBtn.inject(n)),this._render()},_render:function(){},isCollapsed:function(){return this._isCollapsed},isCollapseable:function(){return this.options.collapseable},setUICollapseable:function(e){this.options.UIcollapseable!==e&&((this.options.UIcollapseable=e)?(this.elements.headerBtn.removeClassName("treePanel-hidden"),this.elements.contentHide.addClassName("treePanel-content-hide-expander")):(this.elements.headerBtn.addClassName("treePanel-hidden"),this.elements.contentHide.removeClassName("treePanel-content-hide-expander")))},empty:function(){},hide:function(){this.elements.container.addClassName("treePanel-hidden")},show:function(){this.elements.container.removeClassName("treePanel-hidden")},_setCollapsed:function(e){this._isCollapsed=e,this.dispatchEvent("collapseChange",{isCollapsed:e})},setSize33pct:function(){this._setSizepct("treePanel-expandedPanel33")},setSize50pct:function(){this._setSizepct("treePanel-expandedPanel50")},_setSizepct:function(e){this.expandClass!==e&&(!this.isCollapsed()&&this.elements.container&&this.elements.container.removeClassName(this.expandClass),this.expandClass=e,!this.isCollapsed()&&this.elements.container&&this.elements.container.addClassName(this.expandClass))},setCaption:function(e){if("string"==typeof e)this.elements.headerText.childNodes[0].setHTML(e),this.elements.captionCollapsed.setHTML(e);else{let n="";for(var i=0;i<this.elements.headerText.childNodes.length;++i)if(i===this.elements.headerText.childNodes.length-1)this.elements.headerText.childNodes[i].addClassName("treePanel-caption-dropdown-container"),this.elements.headerText.childNodes[i].childNodes[0].classList.add("fonticon","fonticon-down-open","treePanel-caption-dropdown"),this.elements.headerText.childNodes[i].childNodes[0].removeEvent(t.POINTERDOWN),this.elements.headerText.childNodes[i].childNodes[0].addEvent(t.POINTERDOWN,e.dropDown.onClick),this.elements.headerText.childNodes[i].childNodes[0].id=e.dropDown.id;else if(i<e.label.length){let r=2===i?"["+e.label[i].text+"]":e.label[i].text,o=UWA.String.escapeHTML(r);this.elements.headerText.childNodes[i].setHTML(o),this.elements.headerText.childNodes[i].addClassName("treePanel-caption-item"),void 0!==e.label[i].onClick&&null!==e.label[i].onClick&&"function"==typeof e.label[i].onClick&&(this.elements.headerText.childNodes[i].removeEvent(t.POINTERDOWN),this.elements.headerText.childNodes[i].addEvent(t.POINTERDOWN,e.label[i].onClick),this.elements.headerText.childNodes[i].id=e.label[i].id,this.elements.headerText.childNodes[i].addClassName("treePanel-caption-item-clickable")),0===i?n=r:n+=" "+r}else this.elements.headerText.childNodes[i].setHTML("");let r=UWA.String.escapeHTML(n);this.elements.captionCollapsed.setHTML(r)}},collapse:function(){this.isCollapseable()&&(this.isCollapsed()||(this.elements.container.removeClassName(this.expandClass),this.elements.container.addClassName("treePanel-collapsedPanel"),this.elements.contentHide.show(),this.elements.headerText.hide(),this.elements.headerBtnIcon.removeClassName("fonticon-expand-left"),this.elements.headerBtnIcon.addClassName("fonticon-expand-right"),this._setCollapsed(!0)))},expand:function(){this.isCollapseable()&&this.isCollapsed()&&(this.elements.headerText.show(),this.elements.container.addClassName(this.expandClass),this.elements.container.removeClassName("treePanel-collapsedPanel"),this.elements.contentHide.hide(),this.elements.headerBtnIcon.addClassName("fonticon-expand-left"),this.elements.headerBtnIcon.removeClassName("fonticon-expand-right"),this._setCollapsed(!1))},toggleCollapsed:function(){this.isCollapsed()?this.expand():this.collapse()},maximize:function(){this._isMaximized||(this._isMaximized=!0,this.elements.container.addClassName("treePanel-maximized"))},restore:function(){this._isMaximized&&(this._isMaximized=!1,this.elements.container.removeClassName("treePanel-maximized"))}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,n,r){var o=function(e,t){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByPhysicalID={},this._plugSvcs=t,this._pathArrayArray=[],this._typeIconsArrayArray=[]};return o.prototype.build_dbObj=function(e,t){var i=new r;Object.keys(e).forEach(function(n){var r=e[n];"bo.plmreference.v_derivedfrom"==n&&(n="dfr_bootstrapID"),"Matrixtxt"==n&&(n="matrixtxt"),"matrixtxt"==n&&"1,0,0,0,1,0,0,0,1,0,0,0"==r&&(r="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),"resourceid"==n&&(n="physicalid"),r="string"==typeof r&&r.length&&Array.isArray(t)&&t.length&&-1!==t.indexOf(n)?r.split(",").sort().join(","):r,i.addAttr(n,r)});var n={smallURL:e.icon,largeURL:e.thumbnail_2d};return i.addAttr("typeIcons",n),i},o.prototype.add_dbObj=function(e){var t=!0;return null==this._dbObjByPhysicalID[e.getAttr("physicalid")]?(this._dbObjByPhysicalID[e.getAttr("physicalid")]=e,this._dbObjArray.push(e)):(this._plugSvcs.errout("new node already in tree (byPhysID)"),t=!1),t},o.prototype.add_path=function(e){null==e||0==e.length?this._plugSvcs.errout("Attempt to add null or empty path to tree"):e.length%2!=1?this._plugSvcs.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},o.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},o.prototype._isTreeNodeRefInstID=function(e,t,i){var n=!1;e.getAttr("REF.physicalid")==t&&(e.getAttr("INST.physicalid")==i&&(n=!0));return n},o.prototype.buildTree=function(){var e=this,r=new t(this._objIDSpec);try{e._pathArrayArray.forEach(function(t){var o=t.length,s=r.getRoot(),a=null,l=0,u=t[0],c=null,d=null;if(null!=s&&e._isTreeNodeRefInstID(s,u,c)){for(d=s,l=1,i=1;i<o;i+=2){c=t[i],u=t[i+1];for(var p=s.getChildArray(),h=p.length,_=!1,f=0;f<h;f++){var g=p[f];if(e._isTreeNodeRefInstID(g,u,c)){_=!0,d=g,s=g;break}}if(0==_)break}a=d,l=i}for(i=l;i<o;){var m=0==i;c=m?null:t[i++],u=t[i++];var S=e._get_dbObjByPhysicalID(u),T=null;0==m&&(T=e._get_dbObjByPhysicalID(c));var C=new n(S,T);m?r.setRoot(C):(a.addChild(C),C.setParent(a)),a=C}})}catch(e){this._plugSvcs.errout("Failure building riTree (from paths): "+e),r=null}return r},o.prototype._get_dbObjByPhysicalID=function(e){return this._dbObjByPhysicalID[e]},e.singleton({jsClass:"PE2REFINST_TREE",convert:function(e,t,i,n){for(var r=new o(e),s=t.length,a=0;a<s;a++){var l=t[a];if(null!=l.resourceid){var u=r.build_dbObj(l,n.MULTI_VALUE_ATTRS);r.add_dbObj(u)}else null!=l.Path?r.add_path(l.Path):null!=l.icon__default_thumbnail_2d?r.add_typeIcons(l.icon__default_thumbnail_2d):i.errout("Unknown entry in input:"+JSON.stringify(l)+", skipping...")}var c=r.buildTree();return r=null,c}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,n,r){var o=function(e,t){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByDID={},this._dbObjByPhysID={},this._plugSvcs=t,this._pathArrayArray=[],this._typeIconsArrayArray=[]};return o.prototype.build_dbObj=function(e,t){var i=new r;Array.isArray(t)&&t.length&&t.forEach(t=>{mvAttrs=[];let i=-1;for(;(i=e.findIndex(e=>e.name===t))>-1;)mvAttrs.push(e.splice(i,1)[0]);mvAttrs.length&&e.push({name:t,value:mvAttrs.map(e=>e.value).sort().join(",")})});for(var n=e.length,o=0;o<n;o++){var s=e[o],a=s.name,l=s.value;"bo.plmreference.v_derivedfrom"==a&&(a="dfr_bootstrapID"),"matrixtxt"==a&&"1,0,0,0,1,0,0,0,1,0,0,0"==l&&(l="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),"resourceid"==a&&i.addAttr("physicalid",l),i.addAttr(a,l)}return i},o.prototype.add_dbObj=function(e){var t=!0;return null==this._dbObjByDID[e.getAttr("did")]?this._dbObjByDID[e.getAttr("did")]=e:(this._plugSvcs.errout("new node already in tree (byDID)"),t=!1),1==t&&null==this._dbObjByPhysID[e.getAttr("physicalid")]?this._dbObjByPhysID[e.getAttr("physicalid")]=e:(this._plugSvcs.errout("new node already in tree (byPhysID)"),t=!1),t&&this._dbObjArray.push(e),t},o.prototype.add_path=function(e){null==e||0==e.length?this._plugSvcs.errout("Attempt to add null or empty path to tree"):e.length%2!=1?this._plugSvcs.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},o.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},o.prototype._isTreeNodeRefInstID=function(e,t,i){var n=!1;e.getAttr("REF.did")==t&&(e.getAttr("INST.did")==i&&(n=!0));return n},o.prototype.buildTree=function(){var e=this,r=new t(this._objIDSpec);try{e._pathArrayArray.forEach(function(t){var o=t.length,s=r.getRoot(),a=null,l=0,u=t[0],c=null,d=null;if(null!=s&&e._isTreeNodeRefInstID(s,u,c)){for(d=s,l=1,i=1;i<o;i+=2){c=t[i],u=t[i+1];for(var p=s.getChildArray(),h=p.length,_=!1,f=0;f<h;f++){var g=p[f];if(e._isTreeNodeRefInstID(g,u,c)){_=!0,d=g,s=g;break}}if(0==_)break}a=d,l=i}for(i=l;i<o;){var m=0==i;c=m?null:t[i++],u=t[i++];var S=e._get_dbObjByDID(u),T=null;0==m&&(T=e._get_dbObjByDID(c));var C=new n(S,T);m?r.setRoot(C):(a.addChild(C),C.setParent(a)),a=C}})}catch(e){this._plugSvcs.errout("Exception while building riTree: "+e),r=null}return r},o.prototype.attachIconsToNodes=function(){var e=this,t=!1;try{this._typeIconsArrayArray.forEach(function(t){t.forEach(function(t){for(var i=t.did,n={smallURL:t.icon,largeURL:t.thumbnail_2d},r=i.length,o=0;o<r;o++){var s=i[o];e._get_dbObjByDID(s).setAttr("typeIcons",n)}})}),t=!0}catch(e){this._plugSvcs.errout("Failure attaching icons to tree: "+e)}return t},o.prototype._getObjByPhysID=function(e){return this._dbObjByPhysID[e]},o.prototype._get_dbObjByDID=function(e){return this._dbObjByDID[e]},o.prototype._visit_dbObjsAndFN=function(e){for(var t=this._dbObjArray.length,i=!0,n=0;1==i&&n<t;n++){i=e(this._dbObjArray[n])}return i},e.singleton({jsClass:"CV2REFINST_TREE",convert:function(e,t,i,n){for(var r=new o(e,i),s=t.length,a=0;a<s;a++){var l=t[a];if(null!=l.attributes){var u=r.build_dbObj(l.attributes,n.MULTI_VALUE_ATTRS);null!=l.boundingbox&&u.addAttr("boundingbox",l.boundingbox),r.add_dbObj(u)}else null!=l.path?r.add_path(l.path):null!=l.icon__default_thumbnail_2d?r.add_typeIcons(l.icon__default_thumbnail_2d):i.errout("Unknown entry in input:"+JSON.stringify(l)+", skipping...")}0==r.attachIconsToNodes()&&this._plugSvcs.warnout("Failed to attach icons");var c=r.buildTree();return r=null,c}})}),define("DS/CompareWidget2/widget/compareCustomizationFrame",["UWA/Controls/Abstract","DS/CompareWidget2/Customization/CompareCustomization"],function(e,t){return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this._options=null!=t?JSON.parse(JSON.stringify(t)):{},this._CCM=i,this.elements.container=UWA.createElement("div",{id:"initial-drop",styles:{height:"100%"}})},show:function(e){var i=this;this._parent(),this._CCM.loadCustomizations().then(function(n){void 0!==i._compareCustomizationPage&&null!==i._compareCustomizationPage||(i._compareCustomizationPage=new t(i._CCM)),i._compareCustomizationPage.show(i.elements.container,e,i.onDone.bind(i))},function(n){console.error("FAILED to load customizations..."),void 0!==i._compareCustomizationPage&&null!==i._compareCustomizationPage||(i._compareCustomizationPage=new t(i._CCM)),i._compareCustomizationPage.show(i.elements.container,e,i.onDone.bind(i))})},onDone:function(e){this._eventMgr.publish({event:"Event_controlCustomizationDone",data:e})},refreshFrame:function(){null!=this._compareCustomizationPage&&this._compareCustomizationPage.reset(),this.show()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],function(e,t){return e.extend({convert:function(e){return t.errout("Abstract base class called; requires implementation"),null}})}),define("DS/CompareWidget2/Customization/getProfileNameDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Label","DS/Controls/LineEditor","i18n!DS/CompareCommon/assets/nls/CompareCustomization"],function(e,t,i,n,r,o,s){"use strict";return e.extend({init:function(e,r){this._parent({}),this.options=e,this.onClickOkCallback=r,this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.content=this._buildContent(),this.dialog=new i({title:e.dialogTitle,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,buttons:{Ok:new n({label:e.okLabel,domId:"compare_getprofname_OK",onClick:this._onClickOk.bind(this),disabled:!1,emphasize:"primary"}),Cancel:new n({label:e.cancelLabel,domId:"compare_getprofname_Cancel",onClick:this._onClickCancel.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._onDialogClose.bind(this))},_buildContent:function(){var e=this;let t=UWA.createElement("div",{id:"compare_getprofname_dialog"}),i=UWA.createElement("div",{}).inject(t);i.setStyle("display","inline-flex"),i.setStyle("width","100%");let n=new r({value:s.get("ProfileTitleLabel")+"*"}).inject(i);return n.getContent().style.fontWeight="bold",n.getContent().style.background="white",this.nameEditor=new o({placeholder:s.get("ProfileTitlePlaceholder"),maxLength:100,requiredFlag:!0}).inject(i),this.nameEditor.addEventListener("uncommittedChange",function(t){e.messageLabel.setText(t.options.uncommittedValue.length>99?s.get("PROFILE_TITLE_LONG"):"")}),this.nameEditor.getContent().style.width="100%",this.messageLabel=UWA.createElement("div",{id:"compare_getprofname_message",html:[]}).inject(t),this.messageLabel.setStyles({color:"red","margin-top":"6px"}),t},_onDialogClose:function(){this.dialog.removeEventListener("close",this._onDialogClose.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_onClickOk:function(){if(this.nameEditor.validFlag)if(void 0!==this.options.existingNames&&null!==this.options.existingNames&&this.options.existingNames.includes(this.nameEditor.value)){let e=s.get("PROFILE_TITLE_ALREADY_EXISTS").replace("{msgData}",this.nameEditor.value);this.messageLabel.setText(e)}else this.onClickOkCallback(this.nameEditor.value),this.dialog.close();else""===this.nameEditor.value?this.messageLabel.setText(s.get("PROFILE_TITLE_REQUIRED")):this.messageLabel.setText(s.get("PROFILE_TITLE_INVALID_CHARS"))},_onClickCancel:function(){this.dialog.close()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController",[],function(){var e=function(e,t,i){this._getActiveTreeCB=e,this._isListCB=t,this.dbgout=i};return e.prototype.destroy=function(){this._getActiveTreeCB=null,this._isListCB=null},e.prototype.setSelectedNodes=function(e){return this._selectNodes(e)},e.prototype.clearSelectedNodes=function(){this._clearSelections()},e.prototype._selectNodes=function(e){var t=this,i=t._getActiveTreeCB();i.withUpdateLocked(()=>{var n=[];i.dataGridViews.forEach((i,r)=>{t.dbgout("XSELECT","   structComparePanel._selectNodes dataGrid # "+r),e.forEach(function(e,r){t.dbgout("XSELECT","      structComparePanel._selectNodes selection # "+r);var o=t._find_nodes_from_path(i,e);o.length>0&&(t.dbgout("XSELECT","      structComparePanel._selectNodes _find_nodes_from_path found "+o.length+" nodes"),o.forEach((e,i)=>{n.push(e);var r=e.getAttr("title"),o=e.getAttr("type");t.dbgout("XSELECT","        "+r+" "+o)}))})}),t.dbgout("XSELECT","   structComparePanel._selectNodes calling selectByCrNodes with "+n.length),i.selectByCrNodes(n)})},e.prototype._clearSelections=function(){var e=this._getActiveTreeCB();e.withUpdateLocked(()=>{e.dataGridViews.forEach((t,i)=>{e.clearNTHGridSelection(i)})})},e.prototype._find_nodes_from_path=function(e,t){var i=this,n=[],r=[];"/"==t[0]&&(t=t.substr(1));var o=t.split("/");if(null!=o&&Array.isArray(o)&&o.length>0){var s=o.length,a=Math.floor(s/2)+1,l=o[0];for(const t of e.model){let e=t.options.data;if(null!=e){var u=e.getObjIDSpec_REF(),c=e.getObjIDSpec_INST();if(null!=u)if(i._isListCB())null==c?1===a&&u.getPhysID()===o[0]&&(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),n.push(e)):a>1&&c.getPhysID()===o[s-2]&&u.getPhysID()===o[s-1]?(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),n.push(e)):a>2&&c.getPhysID()===o[s-4]&&u.getPhysID()===o[s-3]&&(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),r.push(e));else if(u.getPhysID()===l)if(1===a)i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (root node)"),n.push(e);else{i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - searching thru root "+l);i._find_node_from_path(e,2,o,n)}}}return 0===n.length&&r.length>0?r:n}},e.prototype._find_node_from_path=function(e,t,i,n){var r=this;e.getChildArray().forEach((e,o)=>{var s=e.getObjIDSpec_REF(),a=null!=s?s.getPhysID():"null",l=e.getObjIDSpec_INST(),u=null!=l?l.getPhysID():"null",c=i[2*(t-1)-1],d=i[2*(t-1)];if(u===c&&a===d){var p=Math.floor(i.length/2+1);t===p?(n.push(e),r.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (under root)")):t<p&&(++t,r._find_node_from_path(e,t,i,n),--t)}})},e}),define("DS/CompareWidget2/ViewDefModules/DSColors",[],function(){var e={colorDef:{BLUE1:"#009DDB",ORANGE:"#FF8A2E",VIOLET:"#9B2C98",GREEN1:"#00AA86",PINK:"#F564A3",BLUE2:"#8DDEE4",RED:"#CC092F",GREY1:"#E2D5CC",GREEN2:"#6FBC4B",PURPLE:"#70036B",BLUE3:"#002596",BEIGE:"#C6C68B",GREY2:"#7F7F7F",BLUE4:"#4EA8B7",GREEN3:"#007A4C",GREY3:"#ADADAD",BLUE5:"#127277",RED2:"#6D2815",BLACK:"#000000",BLUE6:"#4D62BA",YELLOW:"#FEE000",WHITE:"#FFFFFF",NONE:"",LIGHT_TAN:"#EEEEEE",V1DIFF_STATUS:"#D2B48C",V1REV_STATUS:"#982C98",V1MOVE_STATUS:"#FFCC00",V1QTY_STATUS:"#1494DE"}};return e.colorSeq=[e.colorDef.BLUE1,e.colorDef.ORANGE,e.colorDef.VIOLET,e.colorDef.GREEN1,e.colorDef.PINK,e.colorDef.BLUE2,e.colorDef.RED,e.colorDef.GREY1,e.colorDef.GREEN2,e.colorDef.PURPLE,e.colorDef.BLUE3,e.colorDef.BEIGE,e.colorDef.GREY2,e.colorDef.BLUE4,e.colorDef.GREEN3,e.colorDef.GREY3,e.colorDef.BLUE5,e.colorDef.RED2,e.colorDef.BLACK,e.colorDef.BLUE6,e.colorDef.YELLOW,e.colorDef.WHITE,e.colorDef.NONE],e}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN",["DS/CompareWidget2/plugins/plugin"],function(e){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},execute:function(e,t){this._parent(e,t),e.crTreeArray.forEach(function(e){e.niceUp(!0,!0,t&&!0===t.isCustomMatching)}),null!=e?this.reportOK(e):this.reportKO()}})}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController",["UWA/Class","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/SceneGraphUtils","DS/Visualization/IdPath","DS/PADUtils/PADSettingsMgt"],function(e,t,i,n,r,o){return e.extend({init:function(e){this._hideShowController=e,this._xShowSGOS=null,this._isLightNodeModel=o.getSetting("enopad3dviewer_lightNodeModel")},_getPAD3DViewer:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._context),e},_getSceneGraphOverrideSet:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._sceneGraphOverrideSet),e},_createOverrideSet:function(){null!=this._hideShowController&&(delete this._hideShowController._sceneGraphOverrideSet,this._hideShowController.createOverrideSet())},_publish:function(e){null!=this._hideShowController&&this._hideShowController.publish(e)},subscribe:function(e,t){if(null!=this._hideShowController)return this._hideShowController.subscribe(e,t)},unsubscribe:function(e){null!=this._hideShowController&&this._hideShowController.unsubscribe(e)},_getViewer:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getViewer()),e},_getSceneGraphOverrideSetManager:function(){var e=null,t=this._getViewer();return null!=t&&(e=t.getSceneGraphOverrideSetManager()),e},_getPAD3DController:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getController()),e},_asyncRender:function(){var e=this;setTimeout(function(){e._getViewer().render({updateInfinitePlane:!0})})},hide:function(e){this._hideShowController.hide(e)},show:function(e){this._hideShowController.show(e)},exclusiveShow:function(e){if("object"!=typeof e)throw new Error("No parameter defined");if(!Array.isArray(e.paths))throw new Error("No paths to be shown defined");var i=this;if(i._isLightNodeModel){i._resetExclusiveShow();var o=i._getPAD3DController().getRoots(),s=e.paths.length,a=2==s;if(1==a)for(var l=0;l<s;l++)if(1!=e.paths[0].length){a=!1;break}var u=[];for(l=0;l<o.length;l++){var c=t.getNodeID(o[l]);c&&u.push(new r([i._getPAD3DController().getRootBagId(),c]))}if(u.length){var d=i._xShowSGOS.createIdPathOverride({idPathes:u,propagateUntilRepRefs:!0});d&&d.setVisibility(1==a)}if(0==a){var p=[];for(l=0;l<e.paths.length;l++)p.push(new r([i._getPAD3DController().getRootBagId()].concat(e.paths[l])));if(p.length){var h=i._xShowSGOS.createIdPathOverride({idPathes:p,propagateUntilRepRefs:!0});h&&h.setVisibility(!0);var _=i._xShowSGOS.createIdPathOverride({idPathes:p,propagateToParents:!0});_&&_.setVisibility(!0)}}i._asyncRender(),i._publish({event:"onExclusiveShow",data:e})}else{i._resetExclusiveShow();var f=i._getPAD3DController()._model._nodeIndex,g=Object.getOwnPropertyNames(f),m=i._getPAD3DController()._model.getRootBag();g.forEach(function(e){f[e].is3DLeaf&&f[e].is3DLeaf()&&n.buildPathesLeadingToNode(f[e],m).forEach(function(e){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!1)})}),e.paths.forEach(function(e){if(t.isAModelPath(e)){var r=e.getLastElement(!0);if(r.is3DLeaf&&r.is3DLeaf()){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)}else{var o=[],s={};r.traverse(function(t){t.is3DLeaf&&t.is3DLeaf()&&!s[t.getID()]&&(s[t.getID()]=!0,n.buildPathesLeadingToNode(t,m).forEach(function(t){e.isAParentOf(t)&&o.push(t)}))}),o.forEach(function(e){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)})}}});var S=i._getSceneGraphOverrideSetManager();S&&(S.removeSceneGraphOverrideSet(i._getSceneGraphOverrideSet()),S.pushSceneGraphOverrideSet(i._getSceneGraphOverrideSet())),i._asyncRender(),i._publish({event:"onExclusiveShow",data:e})}},_resetExclusiveShow:function(){var e=this;if(e._isLightNodeModel){(t=e._getSceneGraphOverrideSetManager())&&(null!=e._xShowSGOS&&(t.removeSceneGraphOverrideSet(e._xShowSGOS),delete e._xShowSGOS),e._xShowSGOS=new i(e._getPAD3DController().getRootBag(),e._getPAD3DController().getRootBagId(),!0),t.pushSceneGraphOverrideSet(e._xShowSGOS)),e._asyncRender()}else{var t,n=e._getSceneGraphOverrideSet();if(null!=n)(t=e._getSceneGraphOverrideSetManager())&&t.removeSceneGraphOverrideSet(n),e._createOverrideSet(),e._asyncRender()}}})}),define("DS/CompareWidget2/viewComponents/MainToolbarEvents",["DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";function n(e,n,r,o,s,a){var l={id:e,type:n,title:i[e],tooltip:t.generateTooltip("CompareWidget2/Tooltips",e)};return"function"==typeof o&&(l.state=!0===o.bind(l)()?"selected":""),null!=r&&(l.icon=r),"function"==typeof s&&(l.action={callback:s.bind(l)}),null!=a&&(l.submenu=a),l}var r=Object.create(null);return r.onClickSwap=function(e){e.objects._eventMgr.publish({event:"Event_CW2_SWAP"})},r.onClickRefresh=function(e){e.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})},r.onClickX=function(e){e.objects._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"})},r.onClickExport=function(e){e.objects._eventMgr.publish({event:"EXECUTE_EXPORT_EVENT"})},r.onProfileUpdate=function(e){void 0!==e.context&&null!==e.context&&null!=e.context.value&&(console.log("COMPARE RESULTS main toolbar - profile changed to ",e.context.value),e.context.toolbar._eventMgr.publish({event:"Event_CW2_SELECT_PROFILE",data:e.context.value}))},r.onEditCustomization=function(e){let t=e.objects.mainToolbar.elements.farContainer.getElement("#compare-main-customization-profile .wux-controls-combobox .wux-controls-combobox-mainelement"),i="";null!=t&&(i=t.getText()),e.objects._eventMgr.publish({event:"Event_showControlCenter",data:{profileName:i}})},r.createViewDropdown=function(e){var t=e.objects.resultFrame._layout;if(!t.maximizedPanel){for(var i=t.getViews(),n=[],r=0;r<i.length;r++){var o=i[r],s={type:"CheckItem",title:o.getLabel(),uid:o.getName(),state:t.isViewOpen(o)?"selected":"",action:{callback:function(){t.onClickShowHideViewCmd(this)},this:o}};n.push(s)}var a=e.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-eye-cog").getBoundingClientRect();require(["DS/Menu/Menu"],e=>e.show(n,{position:{x:a.right,y:a.bottom},layout:"topright"}))}},r.createAdditionalMenu=function(o){var s=[n("compareSettings.includeFacets.externalRelations","PushItem","object-related-cog",null,null,[n("compareSettings.includeFacets.externalRelations.showDocs","CheckItem","doc",function(){return"true"===e.get(this.id)||!0===e.get(this.id)},function(){e.set(this.id,!e.get(this.id)),o.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})}),n("compareSettings.includeFacets.externalRelations.showOtherRels","CheckItem","object-related",function(){return"true"===e.get(this.id)||!0===e.get(this.id)},function(){e.set(this.id,!e.get(this.id)),o.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})})]),{id:"closeAllObjects",type:"PushItem",title:i.closeAllObjects,tooltip:t.generateTooltip("CompareWidget2/Tooltips","closeAllObjects"),icon:"close",action:{callback:function(){r.onClickX(o)}}},{id:"mainToolbarRestoreLayout",tooltip:t.generateTooltip("CompareWidget2/Tooltips","mainToolbarRestoreLayout"),type:"PushItem",icon:"reset",title:i.restoreLayout,action:{callback:function(){o.objects.resultFrame.applyDefaultLayout()}}}];o.objects.mainToolbarOptions.forEach(function(e){for(var t=e,i=0;i<s.length;i++)s[i].id.indexOf(t)>=0&&(s.splice(i,1),i--)});var a=o.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-menu-dot").getBoundingClientRect();require(["DS/Menu/Menu"],e=>e.show(s,{position:{x:a.right,y:a.bottom},layout:"topright"}))},r}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",["UWA/Core","DS/CompareWidget2/viewComponents/ContextMenuBase","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu"],function(e,t,i,n){"use strict";return t.extend({init:function(e){this._structComparePanel=e.structComparePanel,this._expandCollapseMenu=new i(e),this._openWithMenu=new n(e)},createContextMenu:function(e){var t=this;return new Promise(function(i){var n=[];if(null!=e&&void 0!==e.collectionView&&null!==e.collectionView)if(function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.cellModel||null===e.cellInfos.cellModel}(e))i(n);else{var r=e.cellInfos.nodeModel.getTreeDocument().getSelectedNodes(),o={useSelectionInContext:null==t._structComparePanel.isList||!t._structComparePanel.isList()};t._openWithMenu.getOpenWithMenuPromise(e,r,o).then(function(r){null!=r&&n.push(r);var o=t._expandCollapseMenu.getExpandCollapseContextMenu(e,t._structComparePanel.getActiveExpandMenuId());o&&(n.length>0&&n.push({type:"SeparatorItem"}),n.push(o)),i(n)})}else i(n)})},onComparePanelUpdated:function(){void 0!==this._openWithMenu&&null!==this._openWithMenu&&this._openWithMenu.clearLaunchTreeArray()}})}),define("DS/CompareWidget2/plugins/plugin",["UWA/Class","DS/CompareWidget2/userSettings/UserSettingsManager"],function(e,t){return e.extend({setOutputFn:function(e){this._outputFn=e},updateOutput:function(e){null==this._outputFn?this._plugSvcs.warnout("PLUGIN trying to set new output, but no output fn set"):this._outputFn(e)},reportOK:function(e){this.dbgout("------------------------------------------------------------"),0!=this._startMS&&this._plugSvcs.reportTime(this._startMS," Plugin '"+this._plugPath+"' execution "),this.dbgout("->->-> Plugin '"+this._plugPath+"' reports success <<<"),this.dbgout("------------------------------------------------------------"),this.updateOutput(e)},reportKO:function(e){this._plugSvcs.errout("<<< Plugin '"+this._plugPath+"' reports failure:: "+e)},subscribeEvent:function(e,t){if(null==this._subscribeTokens[e]){var i=this._plugSvcs.subscribe(e,t);this._subscribeTokens[e]=i}},unsubscribeEvent:function(e){null!=this._subscribeTokens[e]&&(this._plugSvcs.unsubscribe(e),delete this._subscribeTokens[e])},unsubscribeAllEvents:function(){var e=this,t=!0;try{Object.keys(e._subscribeTokens).forEach(function(t){var i=e._subscribeTokens[t];e._plugSvcs.unsubscribe(i)})}catch(i){this._plugSvcs.warnout("problem unsubscribing events in plugin "+e.getName()),t=!1}return e._subscribeTokens={},t},postEvent:function(e,t){this._plugSvcs.postEvent(e,t)},isEnabled:function(){return this._enabled},enable:function(){return this._enabled=!0,this.onEnabled()},disable:function(){this._enabled=!1,this.onDisabled()},disconnect:function(){this.onDisconnect(),this.unsubscribeAllEvents(),this.unsyncAllSettings(),this._outputFn=null,this.disable()},destroy:function(){this.onDestroy(),this.disconnect(),this._plugPath=null,this._plugSvcs=null,this._type=null,this._parent()},onLoad:function(){return!0},onEnabled:function(){return!0},onDisabled:function(){},onDisconnect:function(){},onDestroy:function(){},execute:function(e,t){null!=t&&Object.assign(this._pluginOptions,t,this._pluginOptions),this.dbgout("~~~~ "+this.getPath()+".execute() running... "),this._startMS=this._plugSvcs.nowMS()},enableDebugLabel:function(e){this.dbgout=this._plugSvcs.dbgout,null!=e&&this._plugSvcs.enableDebugLabel(e)},dbgout:function(e){},init:function(e,t,i,n){this._parent(),this._pluginOptions=i||{},this._plugPath=e,this._name=t,this._plugSvcs=n,this._outputFn=null,this._type="PLUGIN",this._subscribeTokens={},this._syncTokens={},this._enabled=!1,this._startMS=0},getPath:function(){return this._plugPath},getName:function(){return this._name},getType:function(){return this._type},syncSetting:function(e,i,n,r){t.hasPref(e)&&(i=i||e,null==this._syncTokens[i]&&(this._syncTokens[i]={settingKey:e,callback:n,object:r},t.sync(r||this,e,i,n)))},unsyncAllSettings:function(){for([key,value]of Object.entries(this._syncTokens))t.unsync(value.object||this,value.settingKey,key,value.callback);this._syncTokens={}}})}),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV"],function(e,t){return e.extend({execute:function(e,i){this._parent(e,i);var n=e,r=t.refInstTree2ViewerJSON(n,this._plugSvcs);null!=r?this.reportOK(r):this.reportKO()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin",["DS/CompareWidget2/plugins/plugin"],function(e){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},applyAdditionalStatusFlags:function(e,t,i){return new Promise(function(i,n){e.forEach(function(e){e.visitVisible_treeAndFN(0,function(e){var i=e.getMatchInfo();let n=!1;return null!=i&&(t.ADD_STATUSES.forEach(function(e){e.PROPS.forEach(function(t){i.isAttributeValueEqual(t)!=(1==e.FLAG_ON)||i.addAdditionalStatus(e.NAME)})}),n=!0),n})}),i(e)})},execute:function(e,t){var i=this;i._parent(e,t);var n=e.crTreeArray;null==t?i.reportOK(e):i.applyAdditionalStatusFlags(n,t,this._plugSvcs).then(function(t){var n=e;i.reportOK(n)},function(e){i.reportKO("FAILURE performing struct augment: "+e)})}})}),define("DS/CompareWidget2/support/DataCenter",["UWA/Class","DS/WidgetServices/WidgetServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/CompareWidget2/support/cw2Utils"],function(e,t,i,n,r){var o=e.singleton({init:function(){this._parent({})},makeAuthHttpsCall:function(e,o,s,a,l,u,c,d,p,h){return new Promise(function(_,f){null!=e&&e.constructor==String&&0!=e.length||f("BAD svcPath format:"+e),"GET"!=o&&"POST"!=o&&f("Method type: "+o+" is not supported"),null==c&&r.warnout("Call to "+e+" is missing securityContext");var g=u||"3DSpace",m=l||"OnPremise",S=e,T=null;"POST"==o&&null!=s&&(T=!0===p?s:UWA.Json.encode(s),s=null),"3dspace"==g.toLowerCase()&&"3DSpace"!=g&&(r.errout("Correcting malforded service '"+g+"' to '3DSpace'"),g="3DSpace");var C=i.getPlatformWSUrl(g,m,S,h||s),E={Accept:"application/json","Accept-Language":t.getLanguage(),"Content-Type":!0===p?"text/plain":"application/json",SecurityContext:null!=c?c:void 0},v=1!=d;n.authenticatedRequest(C,{method:o,type:a,timeout:48e4,data:T,headers:E,proxy:"passport",cache:v,onComplete:function(e){null!=e&&null!=e.STATUS?"OK"==e.STATUS?_(e.RESULT):(r.errout("**** SERVER ERROR calling: "+C),r.errout("**** MSG: "+e.MSG),f(e.MSG)):null==e?(r.errout("**** SERVER ERROR calling: "+C),r.errout("**** RESPONSE IS null"),f("null response")):_(e)},onFailure:function(e){r.errout("**** HTTPS ERROR calling: "+C),r.errout("**** MSG: "+e),null!=c&&""!=c||r.errout("**** Probably related to blank security context in request"),f(e)}})})},loadPageObject:function(e,t,i){var n="/resources/collabCommon/settings/getComparePageObj/"+e;return this.makeAuthHttpsCall(n,"GET",null,"json",t,"3DSpace",i,!0)},savePageObject:function(e,t,i,n){var r="/resources/collabCommon/settings/updateComparePageObj/"+e;return this.makeAuthHttpsCall(r,"POST",{settings:{content:t}},"json",i,"3DSpace",n,!0)},loadPrefPromise:function(e,t){return this.makeAuthHttpsCall("/resources/AppsMngt/user/getPreferences","GET","name="+e,"text","__NOTENANT__",null,null,t)},savePrefs:function(e,t){this.makeAuthHttpsCall("/resources/AppsMngt/user/setPreferences","GET","name="+e+"&value="+encodeURI(t),"text","__NOTENANT__",null,null).then(()=>{},()=>{})},fetchFilterDefinition:function(e){return new Promise(function(t,i){var n="filterId="+e.getPhysID();o.makeAuthHttpsCall("/resources/FilterBIAPI/Filter/getFilterFromId","GET",n,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(e){var i=e.ENOStrSpecDesc;t(i)},function(e){i(e)})})}});return o}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","UWA/Json"],function(e,t,i){var n="/resources/compare/index/postFetchModelsFromIndex",r="/resources/compare/fetchModels";function o(e,i,o,s){return new Promise(function(a,l){var u=null,c=null,d=null,p="";null!=s.DB_PROPS&&Object.keys(s.DB_PROPS).forEach(function(e){var t=s.DB_PROPS[e];"REF.dfr"==t&&(t="REF.attribute[PLMReference.V_DerivedFrom]"),p+=t+","});var h=encodeURIComponent(p),_=void 0!==s.USE_MCS&&null!==s.USE_MCS&&!1===s.USE_MCS?"":"USE_MCS";if("CV_SERVICE"==i){u=n,c="POST";let t=[];if(Array.isArray(e))for(let i of e)t.push({type:"IDSPEC",spec:i.getPhysID()});else t.push({type:"IDSPEC",spec:e.getPhysID()});d={objSpecList:t,depth:o,compareOption:_,PROPS:h}}else if("DB_SERVICE"==i){if(u=r,c="GET",Array.isArray(e))for(let t=0;t<e.length;++t)0===t&&(d="objectIds="),d+=e[t].getPhysID(),t<e.length-1&&(d+=",");else d="objectIds="+e.getPhysID();d+="&compareOption="+_,d+="&PROPS="+h}else{var f=plugSvcs.errout("UNEXPECTED data source: "+i);l(f)}var g=Array.isArray(e)?e[0].getTenant():e.getTenant(),m=Array.isArray(e)?e[0].getSecurityContext():e.getSecurityContext(),S=Array.isArray(e)?e[0].getServiceName():e.getServiceName();t.makeAuthHttpsCall(u,c,d,"json",g,S,m,!0).then(function(e){a(e)},function(e){l(e)})})}return{jsName:"COMPARE_SVC_EXPAND",doExpand:function(e,t,i,n,r){return new Promise(function(s,a){o(e,t,i,r).then(function(e){var i=e[0];if(null!=i.Failed_idlist){var r=i.Failed_idlist[0].error;n.errout("Error retrieving data:: "+r),a(r)}else i._dataSource=t,s(i)},function(e){n.errout(e),a(e)})})},doExpandN:function(e,t,i,n,r){return new Promise(function(s,a){o(e,t,i,r).then(function(i){if(Array.isArray(e)){for(let e of i)e._dataSource=t;s(i)}else{var n=i[0];n._dataSource=t,s(n)}},function(e){n.errout(e),a(e)})})}}}),define("DS/CompareWidget2/Customization/CompareCustomization",["UWA/Core","DS/Core/Core","DS/Utilities/Dom","DS/Controls/Button","DS/Controls/Label","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/WUXAutoComplete/AutoComplete","DS/Controls/Expander","DS/Utilities/WebUXColorEnums","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/UIKIT/Mask","DS/CompareCommon/Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/Customization/getProfileNameDialog","DS/CompareWidget2/Customization/Profile","i18n!DS/UIKIT/assets/nls/UIKIT","i18n!DS/CompareCommon/assets/nls/CompareCustomization","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,r,o,s,a,l,u,c,d,p,h,_,f,g,m,S,T,C,E,v,D){"use strict";function I(e){let t=e.getChildren();for(var i=0;i<t.length;++i)t[i].options.grid.MR_Order=i+1}function y(e,t,i){return t.prepareUpdate(),t.addRoot(e),!0===i&&I(t),t.pushUpdate(),t.getChildren().length}const R=27,A=26;function b(e,t){let i=(R+(e<1?1:e)*A).toString()+"px";t.setStyles({height:i})}var O=function(e){if(null==e)throw Error("CompareCustomization: Compare customizations are not loaded");this._CCM=e,this.initModel()};function N(e){return new h({label:v.get("template"===e?"TemplateProfiles":"admin"===e?"AdminProfiles":"MyProfiles"),ccId:"template"===e?"templates":"admin"===e?"adminprofiles":"userprofiles",comboBoxSemantics:"section",description:v.get("template"===e?"TemplateProfilesDescription":"admin"===e?"AdminProfilesDescription":"MyProfilesDescription")})}return O.prototype.initModel=function(){this._currentProfile=null,this._currentProfileOrg=null,this._TypesInfo={},this._CustomTypesInfo={},this._CustomInterfacesInfo={},this._RolesInfo={},this._manipulatingProfileFromUI=!0,this._profileNameDlg=null},O.prototype.show=function(e,t,i){this.doneCB=i,this.buildSkeleton(e),this._initialProfileIn="",this._initialProfileInChanged=!0,null!=t&&void 0!==t.profileName&&null!==t.profileName&&""!==t.profileName&&(this._initialProfileIn=t.profileName,this._initialProfileInChanged=!1),this.initUI(t)},O.prototype.buildSkeleton=function(t){void 0!==this.customizationRoot&&null!==this.customizationRoot||(this.customizationRoot=e.createElement("div",{id:"compare-customization-root",html:[]}),this.customizationRoot.inject(t),this.buildSkeleton_Header(),this.buildSkeleton_Body(),this.buildSkeleton_Footer())},O.prototype.buildSkeleton_Header=function(){},O.prototype.buildSkeleton_Body=function(){this.customizationBody=e.createElement("div",{id:"compare-customization-body",html:[]}).inject(this.customizationRoot),this.buildSkeleton_Section_Profile(),this.buildSkeleton_Section_Rules()},O.prototype.buildSkeleton_Section_Profile=function(){this.profileContent=e.createElement("div",{class:"compare-customization-exp-cont"});new u({header:v.get("ComparisonProfileLabel"),body:this.profileContent,expandedFlag:!0}).inject(this.customizationBody);this.profileRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),this.profileRow.setStyle("margin-top","0px"),new r({value:v.get("ProfileTitleLabel")}).inject(this.profileRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","ProfilesTitleTooltips")}).inject(this.profileRow).classList.remove("wux-ui-3ds-lg"),this.profilesCombo=new o({placeholder:v.get("NoProfileSpecified"),reachablePlaceholderFlag:!0,elementsTree:null,enableSearchFlag:!1,domId:"compare-customization-profile"}).inject(this.profileRow),this.profilesCombo.getContent().style.width="300px",this.profilesCombo.addEventListener("change",this.onProfileSelected.bind(this)),this.profilesDuplicate=new n({displayStyle:"icon",icon:{iconName:"duplicate",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,domId:"compare-customization-duplicate",tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","DuplicateProfileTooltips")}).inject(this.profileRow),this.profilesDuplicate.getContent().setStyles({"min-height":"16px","line-height":"16px","margin-left":"10px"}),this.profilesDuplicate.addEventListener("buttonclick",this.onDuplicateProfile.bind(this)),this.profilesDelete=new n({displayStyle:"icon",icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,domId:"compare-customization-delete",tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","DeleteProfileTooltips")}).inject(this.profileRow),this.profilesDelete.getContent().setStyles({"min-height":"16px","line-height":"16px"}),this.profilesDelete.addEventListener("buttonclick",this.onDeleteProfile.bind(this)),this.typesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),new r({value:v.get("ObjectTypesLabel")}).inject(this.typesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","ObjectTypesTooltips")}).inject(this.typesRow).classList.remove("wux-ui-3ds-lg"),this.typesLabelsContainer=e.createElement("div",{class:"compare-customization-row-chips-cont"}).inject(this.typesRow),this.typesLabels=[];this.typesCustomRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),new r({value:v.get("ObjectTypesCustomLabel")}).inject(this.typesCustomRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","ObjectTypesCustomTooltips")}).inject(this.typesCustomRow).classList.remove("wux-ui-3ds-lg"),this.typesCustomLabelsContainer=e.createElement("div",{class:"compare-customization-row-chips-cont"}).inject(this.typesCustomRow),this.typesCustomLabels=[],this.typesCustomRow.hide();this.interfacesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),new r({value:v.get("InterfacesLabel")}).inject(this.interfacesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","InterfacesTooltips")}).inject(this.interfacesRow).classList.remove("wux-ui-3ds-lg"),this.interfacesLabelsContainer=e.createElement("div",{class:"compare-customization-row-chips-cont"}).inject(this.interfacesRow),this.interfacesLabels=[];this.interfacesCustomRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),new r({value:v.get("InterfacesCustomLabel")}).inject(this.interfacesCustomRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","InterfacesCustomTooltips")}).inject(this.interfacesCustomRow).classList.remove("wux-ui-3ds-lg"),this.interfacesCustomLabelsContainer=e.createElement("div",{class:"compare-customization-row-chips-cont"}).inject(this.interfacesCustomRow),this.interfacesCustomLabels=[],this.interfacesCustomRow.hide();this.profileInformationLabel=new r({value:"",emphasize:"Highlight"}).inject(this.profileRow)},O.prototype.buildSkeleton_Section_Rules=function(){this.rulesContent=e.createElement("div",{class:"compare-customization-exp-cont"}),this.rulesExpander=new u({header:v.get("RulesLabel"),body:this.rulesContent,expandedFlag:!0}),this.rulesExpander.inject(this.customizationBody),this.buildSkeleton_Group_MatchingRules(),this.buildSkeleton_Group_AdditionalStatuses()},O.prototype.buildSkeleton_Group_MatchingRules=function(){this.rulesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.rulesContent),this.rulesRow.setStyles({"margin-top":"0px"}),new r({value:v.get("MatchingRulesLabel")}).inject(this.rulesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","MatchingRuleTooltips")}).inject(this.rulesRow).classList.remove("wux-ui-3ds-lg");let t=new a({type:"radio"});this.useDefaultRulesBtn=new s({type:"radio",label:v.get("UseDefaultRules"),checkFlag:!0,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","UseDefaultMatchingRulesTooltips")}),this.useCustomRulesBtn=new s({type:"radio",label:v.get("UseCustomRules"),checkFlag:!1,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","UseCustomMatchingRulesTooltips")}),t.addChild(this.useDefaultRulesBtn),t.addChild(this.useCustomRulesBtn),this.useDefaultRulesBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.useCustomRulesBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.useDefaultRulesBtn.elements.label.setStyles({"margin-right":"6px","margin-left":"6px"}),this.useCustomRulesBtn.elements.label.setStyles({"margin-right":"6px","margin-left":"6px"}),t.getContent().setStyles({display:"flex","margin-right":"10px","margin-left":"16px"}),t.inject(this.rulesRow),t.addEventListener("change",this.onChangeUseDefaultCustomMatchingRules.bind(this)),this.matchingRulesAdd=new n({label:v.get("AddMatchingRule"),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"icon",domId:"compare-customization-add-MR",tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","AddMatchingRuleTooltips")}).inject(this.rulesRow),this.matchingRulesAdd.getContent().setStyles({"min-height":"16px","line-height":"16px","margin-left":"10px"}),this.matchingRulesAdd.addEventListener("buttonclick",this.onAddMatchingRule.bind(this)),this.buildSkeleton_RulesTable("MatchingRulesDataGridViewId")},O.prototype.buildSkeleton_RulesTable=function(t){var i=this,n=e.createElement("div",{class:"compare-customization-table",id:"MatchingRulesDataGridViewId"===t?"compare-customization-MR-table":"compare-customization-AS-table"}).inject(this.rulesContent);const r=R.toString()+"px";n.setStyles({position:"relative",height:r});var o=new _,s=new p({dataModelSet:o});s.prepareUpdate(),s.expandAll(),s.pushUpdate();var a=[];"MatchingRulesDataGridViewId"===t&&a.push({dataIndex:"MR_Order",text:v.get("MatchingRulesOrder"),typeRepresentation:"number",width:"24px",editableFlag:!1,sortableFlag:!1}),"AdditionalStatusesDataGridViewId"===t&&a.push({dataIndex:"AS_Facet",text:v.get("StatusNameColumnHeader"),typeRepresentation:"string",width:"200px",editableFlag:!1,sortableFlag:!1}),"MatchingRulesDataGridViewId"===t&&a.push({dataIndex:"MR_StatusName",text:v.get("StatusNameColumnHeader"),typeRepresentation:"string",width:"200px",sortableFlag:!1,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{placeholder:v.get("StatusNameColumnHeader")}},getCellClassName:function(e){return e.nodeModel?"MatchingRulesDataGridViewId"===t&&""===e.cellModel?"compare-customization-needvalue":"":"headerClass"}}),a.push({dataIndex:"MatchingRulesDataGridViewId"===t?"MR_Color":"AS_Color",text:v.get("StatusColor"),typeRepresentation:"color",width:28,minWidth:28,sortableFlag:!1,editionPolicy:"EditionOnOver"}),a.push({dataIndex:"MatchingRulesDataGridViewId"===t?"MR_Attribute":"AS_Attribute",text:v.get("AttributeColumnHeader"),typeRepresentation:"url",sortableFlag:!1,editionPolicy:"EditionOnOver",getCellSemantics:function(e){return{possibleValues:function(t){let n=e.nodeModel.options.grid.AS_Facet;return i._getPossibleAttributesDisplay(i._currentProfile,n,!0)},allowMultipleValuesFlag:!0,viewOptions:{multipleValuesSeparator:"MatchingRulesDataGridViewId"===t?v.get("RuleAnd"):v.get("RuleOr")}}},getCellClassName:function(e){return e.nodeModel?"MatchingRulesDataGridViewId"!==t||void 0!==e.cellModel&&null!==e.cellModel&&0!==e.cellModel.length?"":"compare-customization-needvalue":"headerClass"}});var l=new d({identifier:t,treeDocument:s,columns:a,placeholder:v.get("MatchingRulesDataGridViewId"===t?"MatchingRulesPlaceholder":"AdditionalStatusesPlaceholder"),defaultColumnDef:{editableFlag:!0},showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1,showRowHeaderBackgroundFlag:!1,layoutOptions:{rowsHeader:!1,cellHeight:A},showContextualMenuColumnFlag:"MatchingRulesDataGridViewId"===t,showOutlineFlag:!0,columnDragEnabledFlag:!1,showColumnBorderFlag:!0,onContextualEvent:function(e){if("AdditionalStatusesDataGridViewId"!==t){var n=[];if(e.cellInfos&&e.cellInfos.rowID>-1&&e&&e.collectionView){n=e.collectionView.buildDefaultContextualMenu(e,{insertRow:!1,expandCollapse:!1});var r=e.cellInfos.nodeModel,o=r.getNextBrother(),s=r.getPreviousBrother();n.push({type:"PushItem",title:v.get("InsertItemAbove"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-level-up"},action:{callback:function(){console.log("CompareCustomization Insert Row Above this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.addMatchingRuleBefore(r)}}}),n.push({type:"PushItem",title:v.get("InsertItemBelow"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-level-down"},action:{callback:function(){console.log("CompareCustomization Insert Row Below this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.addMatchingRuleBefore(o)}}}),null!=s&&n.push({type:"PushItem",title:v.get("IncreaseItemPriority"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-up"},action:{callback:function(){console.log("CompareCustomization Increase Priority of this item clicked"),"MatchingRulesDataGridViewId"===t&&i.moveMatchingRuleUp(e.cellInfos.nodeModel)}}}),null!=o&&n.push({type:"PushItem",title:v.get("DecreaseItemPriority"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-down"},action:{callback:function(){console.log("CompareCustomization Decrease Priority of this item clicked"),"MatchingRulesDataGridViewId"===t&&i.moveMatchingRuleDown(e.cellInfos.nodeModel)}}}),n.push({type:"PushItem",title:v.get("RemoveItem"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-remove"},action:{callback:function(){console.log("CompareCustomization Remove this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.removeMatchingRule(e.cellInfos.nodeModel)}}})}return n}},getCellTooltip:function(e){let n="MatchingRulesDataGridViewId"===t?i.matchingRulesDGV:i.additionalStatusesDGV;return"MatchingRulesDataGridViewId"===t&&0===e.columnID?{getAllInformationCB:()=>({model:i.matchingRulesOrderTooltipModel})}:n.getCellDefaultTooltip(e)}}).inject(n);"MatchingRulesDataGridViewId"===t?(this.matchingRulesOrderTooltipModel=g.generateTooltip("CompareWidget2/Tooltips","RuleOrderTooltips"),this.matchingRulesTable=n,this.matchingRulesModel=s,this.matchingRulesDGV=l):(this.additionalStatusesTable=n,this.additionalStatusesModel=s,this.additionalStatusesDGV=l)},O.prototype.buildSkeleton_Group_AdditionalStatuses=function(){this.additionalStatusesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.rulesContent),new r({value:v.get("AdditionalStatusesLabel")}).inject(this.additionalStatusesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","AdditionalStatusTooltips")}).inject(this.additionalStatusesRow).classList.remove("wux-ui-3ds-lg"),this.buildSkeleton_RulesTable("AdditionalStatusesDataGridViewId")},O.prototype.buildSkeleton_Footer=function(){this.customizationFooter=e.createElement("div",{id:"compare-customization-footer",html:[]}).inject(this.customizationRoot),this.saveBtn=new n({label:v.get("SaveCustomizationTitle"),domId:"compare-customization-button-save",tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","SaveCustomizationTooltips")}),this.cancelBtn=new n({label:E.ko,domId:"compare-customization-button-cancel",tooltipInfos:g.generateTooltip("CompareWidget2/Tooltips","CancelCustomizationTooltips")});let t=(new a).inject(this.customizationFooter);t.addChild(this.saveBtn),t.addChild(this.cancelBtn),t.getContent().setStyles({float:"right"}),this.saveBtn.getContent().addClassName("compare-customization-footerbutton"),this.cancelBtn.getContent().addClassName("compare-customization-footerbutton"),this.saveBtn.getContent().setStyles({"margin-right":"10px","border-radius":"4px"}),this.cancelBtn.getContent().setStyles({"border-radius":"4px"}),this.saveBtn.addEventListener("buttonclick",this.onSaveCustomization.bind(this)),this.cancelBtn.addEventListener("buttonclick",this.onCancelCustomization.bind(this))},O.prototype._getProfileTreeDocument=function(e){let t=this._CCM.getProfileNames({getTemplates:null!=e&&1==e.getTemplates,asTree:!0});var i=new p({shouldBeSelected:function(e){return"section"!==e.options.comboBoxSemantics}});if(void 0!==t.templates&&null!==t.templates&&t.templates.length>0){let e=N("template");for(var n of(i.addRoot(e),t.templates)){let t=new h({label:n,comboBoxSemantics:"leaf"});e.addChild(t)}}if(void 0!==t.adminProfiles&&null!==t.adminProfiles&&t.adminProfiles.length>0){let e=N("admin");for(var n of(i.addRoot(e),t.adminProfiles)){let t=new h({label:n,comboBoxSemantics:"leaf"});e.addChild(t)}}if(void 0!==t.userProfiles&&null!==t.userProfiles&&t.userProfiles.length>0){let e=N("user");for(var n of(i.addRoot(e),t.userProfiles)){let t=new h({label:n,comboBoxSemantics:"leaf"});e.addChild(t)}}return i.expandAll(),i},O.prototype._getDefaultSelection=function(){let e=-1,t="",i=0,n=this.profilesCombo.elementsTree.getChildren();for(var r of n){let n=r.getChildren();Array.isArray(n)&&n.length>0&&(i+=n.length,e=n[0]._rowID,t=n[0].options.label)}return 1===i?{index:e,label:t}:{index:-1,label:""}},O.prototype.initUI=function(e){this._manipulatingProfileFromUI=!1,this.profilesCombo.elementsTree=this._getProfileTreeDocument({getTemplates:!0});let t=null;null!=e&&void 0!==e.profileName&&null!==e.profileName&&""!==e.profileName&&(t=e.profileName),null===t&&void 0!==this._currentProfile&&null!==this._currentProfile&&(t=this._currentProfile.Name);let i=this._CCM.getProfileNames({getTemplates:!0});if((null==t||""===t||!i.includes(t))&&(t="",1===i.length)){let e=this._getDefaultSelection();void 0!==e.label&&null!==e.label&&(t=e.label)}null!=t&&""!==t&&(this.profilesCombo.value=t),this._manipulatingProfileFromUI=!0,this.setProfileIntoSkeleton(null==t?"":t,!1,"ignore")},O.prototype.setProfileIntoSkeleton=function(e,t,i){let n=this,r=!0;return!1===t||n.validateProfileRules(!0,!0)?n._checkChanges(i,"",function(t){if(t.status&&"save"===t.action)n._setProfileRules(),n._saveToDatabase({silent:!1,name:n._currentProfile.Name});else if(t.status&&"discard"===t.action){if(!0===n._currentProfileOrg.NeverBeenSaved){let e=n._currentProfile.Name;n._CCM.removeProfile(e),n.profilesCombo.elementsTree.prepareUpdate();let t=n.profilesCombo.elementsTree.getChildren().find(e=>"userprofiles"===e.options.ccId);if(null!=t){let i=t.getChildren(),r=1===i.length,o=i.find(t=>t.options.label===e);t.removeChild(o),r&&n.profilesCombo.elementsTree.removeRoot(t)}n.profilesCombo.elementsTree.pushUpdate()}n._currentProfile.UseCustomMatchingRules=n._currentProfileOrg.UseCustomMatchingRules}else if(t.status&&"cancel"===t.action)return n._manipulatingProfileFromUI=!1,n.profilesCombo.value=n._currentProfile.Name,n._manipulatingProfileFromUI=!0,r;n._setProfileIntoSkeleton(e)}):r=!1,r},O.prototype.validateProfileRules=function(e,t){let i=!0;if(this._CCM.isCustomizationProfile(this._currentProfile)){let l=["MatchingRulesDataGridViewId","AdditionalStatusesDataGridViewId"];!0===e&&this.removeEmptyMatchingRules();var n=!1,r=!1,o=!1,s=[];for(var a of l){let e="MatchingRulesDataGridViewId"===a?this.matchingRulesModel.getRoots():this.additionalStatusesModel.getRoots();for(let t of e){let e=t.getReferenceValue("MatchingRulesDataGridViewId"===a?"MR_StatusName":"AS_Facet"),i=t.getReferenceValue("MatchingRulesDataGridViewId"===a?"MR_Attribute":"AS_Attribute");("MatchingRulesDataGridViewId"===a||i.length>0)&&(n=!0,""===e||0===i.length?"MatchingRulesDataGridViewId"===a&&(o=!0):s.includes(e)?r=!0:s.push(e))}}if(o&&(console.log("CompareCustomization Profile - Rules did not validate.  A Matching Rule Name or Attribute field is empty."),g.showAlertBox(v.get("EMPTY_PROFILE_RULES_MR"),null,"error"),i=!1),r&&(console.log("CompareCustomization Profile - Duplicate rule name found."),g.showAlertBox(v.get("DUPLICATE_RULE_NAME"),null,"error"),i=!1),t&&!n){console.log("CompareCustomization Profile - No rules have been specified.");let e=v.get(this._currentProfile.AllowCustomMatchingRules?"NO_PROFILE_RULES":"NO_ADDITIONAL_STATUS_RULES").replace("{msgData}",this._currentProfile.Name);g.showAlertBox(e,null,"error"),i=!1}}return i},O.prototype._checkChanges=function(e,t,i){let n={status:!0};if("ignore"===e)i(n);else if(void 0!==this._currentProfile&&null!==this._currentProfile)if(this._CCM.isCustomizationProfile(this._currentProfile))if("force"===e||this._hasProfileChanged())if("force"===e)n.action="save",i(n);else{let e=!0===this._currentProfileOrg.NeverBeenSaved,r="duplicate"===t?e?"SAVE_PROFILE_UNSAVED_DUPLICATE":"SAVE_PROFILE_CHANGES_DUPLICATE":e?"SAVE_PROFILE_UNSAVED":"SAVE_PROFILE_CHANGES";g.confirmDialog2({message:v.get(r).replace("{msgData}",this._currentProfile.Name),title:v.get("CompareProfilePageDialogHeader").replace("{msgData}",this._currentProfile.Name),iconpath:"https://vdevpril3265am.dsone.3ds.com/3DSpace/webapps/IterationsWidget/assets/images/warning.png",okButton:{label:v.get("SaveChanges"),callback:function(){n.action="save",i(n)}},koButton:{label:v.get("duplicate"===t?"CancelOperation":"DiscardChanges"),callback:function(){n.action="duplicate"===t?"cancel":"discard",i(n)}},closeX:{callback:function(){n.action="cancel",i(n)}}})}else i(n);else i(n);else i(n)},O.prototype._hasProfileChanged=function(){if(void 0===this._currentProfile||null===this._currentProfile)return!1;if("template"===this._currentProfile.Type||this._currentProfile.Creator!==this._CCM.getUserName())return!1;let e=!0===this._currentProfileOrg.NeverBeenSaved,t=this._currentProfileOrg.UseCustomMatchingRules!==this._currentProfile.UseCustomMatchingRules,i=!1,n=!1;if(!e||!t){i=!0;let e=this._retrieveProfileRulesFromModel("MatchingRulesDataGridViewId");if(void 0===e||null===e&&void 0===this._currentProfile.MatchingRules||null===this._currentProfile.MatchingRules)i=!1;else if(null!=e&&void 0!==this._currentProfile.MatchingRules&&null!==this._currentProfile.MatchingRules)if(i=!1,e.length===this._currentProfile.MatchingRules.length)for(let t=0;t<e.length;++t){let n=e[t],r=this._currentProfile.MatchingRules[t];if(n.color===r.color&&n.description===r.description&&n.name===r.name&&n.attributes.length===r.attributes.length)for(let e=0;e<n.attributes.length;++e){let t=n.attributes[e],o=r.attributes[e];t.name!==o.name&&(i=!0)}else i=!0}else i=!0;n=!0;let t=this._retrieveProfileRulesFromModel("AdditionalStatusesDataGridViewId");if(void 0===t||null===t&&void 0===this._currentProfile.AdditionalStatuses||null===this._currentProfile.AdditionalStatuses)n=!1;else if(null!=t&&void 0!==this._currentProfile.AdditionalStatuses&&null!==this._currentProfile.AdditionalStatuses)if(n=!1,t.length===this._currentProfile.AdditionalStatuses.length)for(let e=0;e<t.length;++e){let i=t[e],r=this._currentProfile.AdditionalStatuses[e];if(i.color===r.color&&i.description===r.description&&i.facet===r.facet&&i.name===r.name&&i.attributes.length===r.attributes.length)for(let e=0;e<i.attributes.length;++e){let t=i.attributes[e],o=r.attributes[e];t.name!==o.name&&(n=!0)}else n=!0}else n=!0}return e||t||i||n},O.prototype._saveToDatabase=function(e){let t=this._CCM.saveCustomizations();return e.name===this._initialProfileIn&&(this._initialProfileInChanged=!0),!1===t?(console.log("CompareCustomization saving custom profiles - failed"),e.silent||(e.delete?g.showAlertBox(v.get("DELETE_PROFILE_FAILED").replace("{msgData}",e.name),null,"warning"):g.showAlertBox(v.get("SAVE_PROFILES_FAILED").replace("{msgData}",e.name),null,"warning"))):(console.log("CompareCustomization saving custom profiles - success"),e.silent||(e.delete?g.showAlertBox(v.get("DELETE_PROFILE_SUCCESS").replace("{msgData}",e.name),null,"success"):g.showAlertBox(v.get("SAVE_PROFILES_SUCCESS").replace("{msgData}",e.name),null,"success"))),t},O.prototype._validateProfileBeforeSetting=function(e){let t=this._CCM.getProfile(e);if(null!=t&&""!==t){if(!(t&&this._CCM.isTemplateProfile(t))){let i=[];for(let e of[t.MatchingRules,t.AdditionalStatuses])if(null!=e&&e.length>0)for(let t of e)for(let e of t.attributes){let t=e.objType,n=this._TypesInfo[t[0]];if(null!=n){-1===n.attributes.findIndex(t=>t.uri===e.name)&&i.push(e.name)}}if(i.length>0){let t=i.toString();console.log("Attribute "+t+"not found in "+e+".  Have these attributes been deleted?"),g.showAlertBox(D.get("CUSTOM_ATTRIBUTE_DELETED").replace("{msgData}",t),null,"warning")}}}},O.prototype._setProfileIntoSkeleton=function(e){f.mask(this.customizationRoot.parentElement),this._currentProfile=this._CCM.getProfile(e);let t=!(void 0===this._currentProfile||null===this._currentProfile),i=t&&this._CCM.isTemplateProfile(this._currentProfile);this._currentProfileOrg=null,t&&(this._currentProfileOrg={UseCustomMatchingRules:this._currentProfile.UseCustomMatchingRules});let n=!1;t&&!i&&(n=this._currentProfile.Creator===this._CCM.getUserName());let o=!0;t&&!i&&(o=this._currentProfile.UserOverrideOK),t?this.profilesDuplicate.show():this.profilesDuplicate.hide(),this.saveBtn.disabled=!(t&&!i&&!n),t&&n?this.profilesDelete.show():this.profilesDelete.hide(),t?i?(this.profileInformationLabel.value=v.get("THIS_IS_A_TEMPLATE_PROFILE"),this.profileInformationLabel.show(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"):this._currentProfile.isAdminUser?this._CCM.getIsAdminUser()?(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!1,this.saveBtn.emphasize="primary"):(this.profileInformationLabel.value=v.get("THIS_IS_AN_ADMIN_PROFILE"),this.profileInformationLabel.show(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"):(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!1,this.saveBtn.emphasize="primary"):(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"),this._getObjTypesInfo(i).then(()=>{var s=[],a=[];if(t){var l=this._currentProfile.Facets;for(var u of l){for(let e of u.ObjectTypes)s.push(this._TypesInfo[e].displayName);if(void 0!==u.Interfaces&&null!==u.Interfaces)for(let e of u.Interfaces)a.push(this._TypesInfo[e].displayName)}}var c=t?this._currentProfile.SelectedTypes:[],d=[];for(var p of(d=null==c?s:c.map(e=>this._TypesInfo[e].displayName),this.typesLabels)){let e=p.getContent();null!=e&&e.remove()}this.typesLabels=[];let h=[];for(var _ of d){let e=this._getTypeNameFromDisplayName(_);h.push(e);let t=new r({value:_,appearance:"chip",icon:""!==e?this._TypesInfo[e].icon:null}).inject(this.typesLabelsContainer);t.getContent().getElement(".wux-controls-label-icon").setStyle("color","#77797C"),this.typesLabels.push(t)}for(var g of this.interfacesLabels){let e=g.getContent();null!=e&&e.remove()}for(var m of(this.interfacesLabels=[],a)){let e=this._getTypeNameFromDisplayName(m),t=new r({value:m,appearance:"chip",icon:""!==e?this._TypesInfo[e].icon:null}).inject(this.interfacesLabelsContainer);t.getContent().getElement(".wux-controls-label-icon").setStyle("color","#77797C"),this.interfacesLabels.push(t)}for(var S of this.typesCustomLabels){let e=S.getContent();null!=e&&e.remove()}for(var T of this.interfacesCustomLabels){let e=T.getContent();null!=e&&e.remove()}if(this.typesCustomLabels=[],this.interfacesCustomLabels=[],t&&Object.keys(this._CustomTypesInfo).length>0){for(const[e,t]of Object.entries(this._CustomTypesInfo))if(h.includes(t.parentType)){let i=new r({value:this._TypesInfo[e].displayName,appearance:"chip",icon:this._TypesInfo[t.parentType].icon}).inject(this.typesCustomLabelsContainer);i.getContent().getElement(".wux-controls-label-icon").setStyle("color","#77797C"),this.typesCustomLabels.push(i)}this.typesCustomRow.show()}else this.typesCustomRow.hide();if(t&&Object.keys(this._CustomInterfacesInfo).length>0){for(const[e,t]of Object.entries(this._CustomInterfacesInfo))if(h.includes(t.parentType)){let i=new r({value:this._TypesInfo[e].displayName,appearance:"chip",icon:this._TypesInfo[t.parentType].icon}).inject(this.interfacesCustomLabelsContainer);i.getContent().getElement(".wux-controls-label-icon").setStyle("color","#77797C"),this.interfacesCustomLabels.push(i)}this.interfacesCustomRow.show()}else this.interfacesCustomRow.hide();this._getRolesInfo().then(()=>{let r=t&&void 0!==this._currentProfile.Roles&&null!==this._currentProfile.Roles;var s=r?this._currentProfile.Roles:[],a=[];if(r)for(var l of s)a.push(this._RolesInfo[l].displayName);var u=r?this._currentProfile.SelectedRoles:[];if(null==u?a:u.map(e=>this._RolesInfo[e].displayName),this._validateProfileBeforeSetting(e),this.matchingRulesModel.removeRoots(),this.additionalStatusesModel.removeRoots(),t&&!0===this._currentProfile.AllowCustomMatchingRules){this.matchingRulesModel.prepareUpdate(),this.rulesRow.show();let e=this._currentProfile.MatchingRules;null!=e&&e.length>0?(this.addMatchingRule(e),this._currentProfile.UseCustomMatchingRules?this.matchingRulesTable.show():this.matchingRulesTable.hide()):this.matchingRulesTable.hide(),this._setMatchingRulesState(i,n,o),this.matchingRulesModel.pushUpdate()}else this.rulesRow.hide(),this.matchingRulesTable.hide();if(t){this.additionalStatusesModel.prepareUpdate(),this.additionalStatusesRow.show(),this.additionalStatusesRow.setStyle("margin-top",!0===this._currentProfile.AllowCustomMatchingRules?"20px":"0px"),this._setAdditionalStatusesState(i,n);let e=this._currentProfile.AdditionalStatuses;null!=e&&e.length>0?(this.addAdditionalStatus(e),this.additionalStatusesTable.show()):i?this.additionalStatusesTable.hide():(this.addAdditionalStatus(this._currentProfile),this.additionalStatusesTable.show()),this.additionalStatusesModel.pushUpdate()}else this.additionalStatusesRow.hide(),this.additionalStatusesTable.hide();f.unmask(this.customizationRoot.parentElement)})})},O.prototype._setMatchingRulesState=function(e,t,i){this.useCustomRulesBtn.disabled=e||!t||!i,this.useDefaultRulesBtn.disabled=e||!t||!i;let n=!0===this._currentProfile.UseCustomMatchingRules?this.useCustomRulesBtn:this.useDefaultRulesBtn;if(n.fireOnlyFromUIInteractionFlag=!0,n.checkFlag=!0,n.fireOnlyFromUIInteractionFlag=!1,e||this.useDefaultRulesBtn.checkFlag)this.matchingRulesAdd.hide();else{for(var r of(this.matchingRulesAdd.show(),this.matchingRulesAdd.disabled=!t||!i,this.matchingRulesDGV.columns))r.editableFlag="MR_Order"!==r.dataIndex&&t&&i;this.matchingRulesDGV.showContextualMenuColumnFlag=t&&i}},O.prototype._setAdditionalStatusesState=function(e,t){if(e);else for(var i of this.additionalStatusesDGV.columns)"AS_Facet"!==i.dataIndex&&(i.editableFlag=t)},O.prototype._setProfileRules=function(){if(this._CCM.isCustomizationProfile(this._currentProfile)){this._currentProfileOrg={UseCustomMatchingRules:this._currentProfile.UseCustomMatchingRules};let t=["MatchingRulesDataGridViewId","AdditionalStatusesDataGridViewId"];for(var e of t){let t=this._retrieveProfileRulesFromModel(e);"MatchingRulesDataGridViewId"===e?this._currentProfile.setMatchingRules(t):this._currentProfile.setAdditionalStatuses(t)}}},O.prototype._retrieveProfileRulesFromModel=function(e){let t=[],i="MatchingRulesDataGridViewId"===e?this.matchingRulesModel.getRoots():this.additionalStatusesModel.getRoots();for(let n of i)if("MatchingRulesDataGridViewId"===e)t.push({name:n.getReferenceValue("MR_StatusName"),attributes:this._getMatchingRuleFromMatchingRuleDisplay(n.getReferenceValue("MR_Attribute")),color:n.getReferenceValue("MR_Color"),description:""});else{let e=n.getReferenceValue("AS_Facet"),i=n.getReferenceValue("AS_Attribute");t.push({facet:n.getReferenceValue("AS_Facet"),name:e,attributes:this._getMatchingRuleFromMatchingRuleDisplay(i),color:n.getReferenceValue("AS_Color"),description:""})}return t},O.prototype.onProfileSelected=function(){if(this._manipulatingProfileFromUI){let e=this.profilesCombo.currentLabel;console.log("CompareCustomization Profile was selected: "+e),this.setProfileIntoSkeleton(e,!0,"user")||(this._manipulatingProfileFromUI=!1,this.profilesCombo.value=this._currentProfile.Name,this._manipulatingProfileFromUI=!0)}},O.prototype.onDuplicateProfile=function(){let e=this,t=this.profilesCombo.currentLabel;console.log("CompareCustomization Duplicate Profile button was clicked: "+t),e.validateProfileRules(!0,!0)&&e._checkChanges("user","duplicate",function(i){let n=t;if(i.status&&"save"===i.action)e._setProfileRules(),e._saveToDatabase({silent:!1,name:n});else if(i.status&&"cancel"===i.action)return;let r=e.profilesCombo.elementsTree.getAllDescendants(),o={dialogTitle:v.get("DuplicateProfileTitle"),okLabel:v.get("DuplicateProfileOkayButton"),cancelLabel:v.get("DuplicateProfileCancelButton"),existingNames:r.map(e=>e.options.label)};e._profileNameDlg=new T(o,t=>{e._CCM.duplicateProfile(n,t);e.profilesCombo.elementsTree.prepareUpdate();let i=new h({label:t,comboBoxSemantics:"leaf"}),r=e._CCM.getIsAdminUser()?"adminprofiles":"userprofiles",o=e.profilesCombo.elementsTree.getChildren().find(e=>e.options.ccId===r);null==o&&(o=N("adminprofiles"===r?"admin":"user"),e.profilesCombo.elementsTree.addRoot(o)),o.addChild(i),e.profilesCombo.elementsTree.expandAll(),e.profilesCombo.elementsTree.pushUpdate(),e._profileNameDlg=null,e.profilesCombo.value=t,e._currentProfileOrg.NeverBeenSaved=!0})})},O.prototype.onDeleteProfile=function(){var e=this;let t=this.profilesCombo.currentLabel;console.log("CompareCustomization Delete Profile button was clicked: "+t),g.confirmDialog2({message:v.get("CONFIRM_DELETE_PROFILE").replace("{msgData}",t),title:v.get("CompareProfilePageDialogHeader").replace("{msgData}",t),iconpath:"https://vdevpril3265am.dsone.3ds.com/3DSpace/webapps/IterationsWidget/assets/images/warning.png",okButton:{label:v.get("DELETE_PROFILE_OK"),callback:function(){let i=e._CCM.getProfileNames({getTemplates:!1});e._CCM.removeProfile(t),e.profilesCombo.elementsTree.prepareUpdate();let n=e._CCM.getIsAdminUser()?"adminprofiles":"userprofiles",r=e.profilesCombo.elementsTree.getChildren().find(e=>e.options.ccId===n);if(null!=r){let i=r.getChildren(),n=1===i.length,o=i.find(e=>e.options.label===t);r.removeChild(o),n&&e.profilesCombo.elementsTree.removeRoot(r)}e.profilesCombo.elementsTree.pushUpdate(),i.includes(t)?e._saveToDatabase({silent:!1,delete:!0,name:t}):g.showAlertBox(v.get("DELETE_PROFILE_SUCCESS").replace("{msgData}",t),null,"success"),e._resetCurrentUI()}},koButton:{label:E.ko,callback:function(){}}})},O.prototype._resetCurrentUI=function(){this._manipulatingProfileFromUI=!1;let e="",t=this._getDefaultSelection();void 0!==t.index&&null!==t.index&&(this.profilesCombo.selectedIndex=t.index,e=t.label),this._manipulatingProfileFromUI=!0,this.setProfileIntoSkeleton(e,!1,"ignore")},O.prototype.onChangeUseDefaultCustomMatchingRules=function(e){var t="1"===e.dsModel.value.toString();let i=!0;t||(i=this.validateProfileRules(!0,!1)),i?(this._currentProfile&&(this._currentProfile.UseCustomMatchingRules=t),t?this.matchingRulesAdd.show():this.matchingRulesAdd.hide(),t?this.matchingRulesTable.show():this.matchingRulesTable.hide(),t&&this._currentProfile&&0===this.matchingRulesModel.getChildren().length&&this.addMatchingRule()):this.useCustomRulesBtn.checkFlag=!0},O.prototype.onAddMatchingRule=function(){let e=this.profilesCombo.currentLabel;console.log("CompareCustomization Add Matching Rule button was clicked: "+e),this.addMatchingRule(),this.useCustomRulesBtn.checkFlag=!0},O.prototype.addMatchingRule=function(e){var t;if(Array.isArray(e))for(var i of(t=[],e)){let e=new h({grid:{MR_Order:-1,MR_StatusName:i.name,MR_Attribute:this._getMatchingRuleDisplayFromMatchingRule(i.attributes,!1),MR_Color:i.color}});t.push(e)}else t=new h({grid:{MR_Order:-1,MR_StatusName:e&&e.name?e.name:"",MR_Attribute:e&&e.attributes?this._getMatchingRuleDisplayFromMatchingRule(e.attributes,!1):[],MR_Color:e&&e.color?e.color:this._getNextColor("matching_rule")}});let n=y(t,this.matchingRulesModel,!0);b(n,this.matchingRulesTable),1===n&&!0===this._currentProfile.UseCustomMatchingRules&&this.matchingRulesTable.show()},O.prototype.addMatchingRuleBefore=function(e){b(function(e,t,i,n){return i.prepareUpdate(),i.insertBefore(e,t),!0===n&&I(i),i.pushUpdate(),i.getChildren().length}(new h({grid:{MR_Order:-1,MR_StatusName:"",MR_Attribute:[],MR_Color:this._getNextColor("matching_rule")}}),e,this.matchingRulesModel,!0),this.matchingRulesTable)},O.prototype.moveMatchingRuleUp=function(e){!function(e,t,i){t.prepareUpdate();let n=e.getPreviousBrother();if(null!=n){let i=t.removeRoot(e);t.insertBefore(i,n)}!0===i&&I(t),t.pushUpdate()}(e,this.matchingRulesModel,!0)},O.prototype.moveMatchingRuleDown=function(e){!function(e,t,i){t.prepareUpdate();let n=e.getNextBrother();if(null!=n){let i=t.removeRoot(e),r=n.getNextBrother();null!=r?t.insertBefore(i,r):t.addRoot(i)}!0===i&&I(t),t.pushUpdate()}(e,this.matchingRulesModel,!0)},O.prototype.removeMatchingRule=function(e){let t=function(e,t,i){return t.prepareUpdate(),t.removeRoot(e),!0===i&&I(t),t.pushUpdate(),t.getChildren().length}(e,this.matchingRulesModel,!0);b(t,this.matchingRulesTable),0===t&&(this.useDefaultRulesBtn.checkFlag=!0)},O.prototype.removeEmptyMatchingRules=function(){if(this._CCM.isCustomizationProfile(this._currentProfile)){let t=this.matchingRulesModel.getRoots();for(var e=t.length-1;e>=0;--e){let i=t[e],n=i.getReferenceValue("MR_StatusName"),r=this._getMatchingRuleFromMatchingRuleDisplay(i.getReferenceValue("MR_Attribute"));""!==n||null!=r&&0!==r.length||this.removeMatchingRule(i)}}},O.prototype._getPossibleAttributesDisplay=function(e,t,i){let n=[],r=e.SelectedTypes.map(e=>({name:e,grouping:-1})),o=[];void 0!==e.Interfaces&&null!==e.Interfaces&&(o=e.Interfaces.map(e=>({name:e,grouping:-1})));let s=r.concat(o);for(var a of s)for(var l=0;l<e.Facets.length;++l){let t=e.Facets[l];for(let e=0;e<t.ObjectTypes.length;++e)a.name===t.ObjectTypes[e]&&(a.grouping=l);if(void 0!==t.Interfaces&&null!==t.Interfaces)for(let e=0;e<t.Interfaces.length;++e)a.name===t.Interfaces[e]&&(a.grouping=l)}var u=[];for(var a of s){for(const[e,t]of Object.entries(this._CustomTypesInfo))t.parentType===a.name&&u.push({name:e,grouping:a.grouping});for(const[e,t]of Object.entries(this._CustomInterfacesInfo))t.parentType===a.name&&u.push({name:e,grouping:a.grouping})}let c=s.concat(u);for(var d=[],p=0,h=0;h<e.Facets.length;++h){let i=this._CCM.getFacetNameNLS(e.NLSPath,e.Facets[h].Name);if(null==t||t===i){d[p]=[];for(var _=0;_<c.length;++_)c[_].grouping===h&&d[p].push(c[_].name);++p}}for(var f of d){let e=[];for(var g of f){var m=this._TypesInfo[g].displayName,S=this._TypesInfo[g].icon;for(var T of this._TypesInfo[g].attributes){let t=e.findIndex(e=>e.value.attrName===T.uri);if(-1!==t){if(-1===e[t].value.objType.findIndex(e=>e===g)){e[t].value.objType.push(g);{let i=e[t].value.label.replace(")",","+m+")");e[t].value.label=i}}else console.log("CompareCustomization - Multiple attributes with same name in object type")}else{let t={value:{icon:S,attrName:T.uri,objType:[g]}};t.value.label=T.nlsName,i&&(t.value.label+=" ("+m+")"),e.push(t)}}}for(var a of e)n.push(a)}return n},O.prototype._getMatchingRuleDisplayFromMatchingRule=function(e,t,i){let n=[];for(let t of e){let e=t.objType,r=this._TypesInfo[e[0]],o=t.name;if(void 0===r)null!=(r=this._CustomTypesInfo[e[0]])&&(o=r.attributes[t.name].Name);else{let e=r.attributes.findIndex(e=>e.uri===t.name);o=-1===e?t.name:r.attributes[e].nlsName}let s=r.icon;void 0===s&&null!=r.parentType&&(s=this._TypesInfo[r.parentType].icon);let a=t.objType.map(e=>r.displayName).join(","),l={icon:s,attrName:t.name,objType:t.objType};l.label=o,i&&(l.label+=" ("+a+")"),n.push(l)}return n},O.prototype._getMatchingRuleFromMatchingRuleDisplay=function(e){return e.map(e=>({objType:e.objType,name:e.attrName,icon:e.icon}))},O.prototype._getTypeNameFromDisplayName=function(e){let t="";for(const[i,n]of Object.entries(this._TypesInfo))if(n.displayName===e){t=i;break}return t},O.prototype.addAdditionalStatus=function(e){var t;if(Array.isArray(e))for(var i of(t=[],e)){let e=i.facet,n=new h({grid:{AS_Facet:e,AS_Attribute:this._getMatchingRuleDisplayFromMatchingRule(i.attributes,!1),AS_Color:i.color}});t.push(n)}else if("object"==typeof e){t=[];let i=[];for(var n=0;n<e.Facets.length;++n){let r=this._getNextColor("additional_status",i);i.push(r);let o=this._CCM.getFacetNameNLS(this._currentProfile.NLSPath,e.Facets[n].Name),s=new h({grid:{AS_Facet:o,AS_Attribute:[],AS_Color:r}});t.push(s)}}else{let i="";e&&e.facet&&(i=e.facet),t=new h({grid:{AS_Facet:i,AS_Attribute:e&&e.attributes?this._getMatchingRuleDisplayFromMatchingRule(e.attributes,!1):[],AS_Color:e&&e.color?e.color:this._getNextColor("additional_status")}})}let r=y(t,this.additionalStatusesModel);b(r,this.additionalStatusesTable),1===r&&this.additionalStatusesTable.show()},O.prototype._getNextColor=function(e,t){t=t||[];let i=this.matchingRulesModel.getRoots().map(e=>e.getReferenceValue("MR_Color")),n=this.additionalStatusesModel.getRoots().map(e=>e.getReferenceValue("AS_Color")),r=[S.colorDef.BLUE1,S.colorDef.ORANGE,S.colorDef.BEIGE,S.colorDef.BLUE2],o="additional_status"===e?[S.colorDef.VIOLET,S.colorDef.GREEN2,S.colorDef.RED,S.colorDef.PINK,S.colorDef.YELLOW]:[],s=t.concat(i,n,r,o);return S.colorSeq.find(e=>!s.includes(e))||S.colorDef.BLACK},O.prototype._getObjTypesInfo=function(e){var t=this;return new Promise(function(i,n){if(t._currentProfile){let n=e?t._currentProfile:t._CCM.getProfile(t._currentProfile.fromTemplateProfile);t._CustomTypesInfo=n._CustomTypesInfo||{},t._CustomInterfacesInfo=n._CustomInterfacesInfo||{},(t._CCM.areAllAttrsLoaded()?Promise.resolve():t._CCM.getAllAttributes()).then(()=>{t._TypesInfo=n._TypesInfo,i()})}else i()})},O.prototype._getRolesInfo=function(){var e=this;return new Promise(function(t,i){var n=[];if(void 0!==e._currentProfile&&null!==e._currentProfile&&void 0!==e._currentProfile.Roles&&null!==e._currentProfile.Roles&&(n=e._currentProfile.Roles),0===n.length)e._RolesInfo={},t();else{for(var r of n)e._RolesInfo[r]={displayName:r.toLowerCase()};t()}})},O.prototype.onSaveCustomization=function(){var e=this;console.log("CompareCustomization Save button was clicked"),this.validateProfileRules(!0,!0)&&e._checkChanges("force","",function(t){t.status&&"save"===t.action&&(e._setProfileRules(),e._saveToDatabase({silent:!1,name:e._currentProfile.Name})),e._doClose({status:!0})})},O.prototype.onCancelCustomization=function(){console.log("CompareCustomization Cancel button was clicked"),void 0!==this._currentProfileOrg&&null!==this._currentProfileOrg&&!0===this._currentProfileOrg.NeverBeenSaved&&this._CCM.removeProfile(this._currentProfile.Name),this._doClose({status:!0})},O.prototype._doClose=function(e){this._resetCurrentUI(),this._CustomTypesInfo={},this._CustomInterfacesInfo={},this._RolesInfo={},""!==!this._initialProfileIn&&(e.inProfileChanged=this._initialProfileInChanged),this.doneCB(e)},O.prototype.reset=function(){this._resetCurrentUI(),this.initModel()},O}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i){var n={select_bo:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],compute_select_bo:["cgr","thumbnail_3d","icon"],select_rel:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},r={...n,...{select_bo:["relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_rel:["matrixtxt"]}};function o(t,i,o){var s=null!=o&&0!=o.length,u=s?n:r,c=e.dupeJson(u);return i&&(c=a(c)),s&&(c=l(c,o)),c.label="ComparefilterQuery-"+e.nowMS(),null!=t.CVQuery3D?c.union=t.CVQuery3D.union:null!=t.CVQuery?c.union=t.CVQuery.union:c=null,c}function s(t,i,o,s){var u=null!=s&&0!=s.length,c=u?n:r,d=e.dupeJson(c);return d.no_type_filter_bo=["PLMPort","PLMConnection"],o&&(d=a(d)),u&&(d=l(d,s)),d.root_physicalid=t,d.expand_iter=i||"-1",d.label=widget._isODTMode()?"":"Compare2-"+e.nowMS(),d}function a(e){return e.fcs_url_mode="REDIRECT",e.boundingbox=!0,e.with_synthesis=!0,e}function l(e,t){return Object.keys(t).forEach(function(i){var n=t[i],r=n.indexOf(".");if(-1==r)e.select_bo.push(n);else{var o=n.substr(0,r),s=n.substr(r+1);"REF"==o?("dfr"==s&&(s="bo.plmreference.v_derivedfrom"),-1==e.select_bo.indexOf(s)&&e.select_bo.push(s)):"INST"==o?-1==e.select_rel.indexOf(s)&&e.select_rel.push(s):KOfn("UNKNOWN specifier in PROPS definition")}}),e}function u(e,i,n,r,a){return new Promise(function(l,u){r.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),function(e,i){return new Promise(function(n,r){var o={};if("DELLmiGeneralSystemReference"==e.getObjType())o.name="EXPAND",o.url="/cvservlet/expand",n(o);else if(null!=e.getExternalFilterSpec())i.forEach(function(e){"Filter"!=e.name||(o=e)}),null==o?r("URL for filter missing from viewDef/options"):n(o);else{var s=e.getPhysID(),a=e.getTenant(),l=e.getServiceName(),u=e.getSecurityContext(),c={queryPhysID:s,catSpec:i};t.makeAuthHttpsCall("/resources/compare2/IDCat/","POST",c,"json",a,l,u).then(function(e){n(e)},function(e){r("Failure determining expand type")})}})}(e,a.CVURL_BY_TYPE).then(function(c){var d=c,p=d.url,h=d.name;r.dbgout("cvExpand on id: "+e.getPhysID()+" on service   : "+e.getServiceName()+" with expand type: "+h+" with URL     : "+p);var _=!1;"3D"!=h&&"Filter"!=h||(_=!0),function(e,i,n,r){let a=r.CV_PROPS;return new Promise(function(l,u){if("ENOStrRefinementSpecification"==e.getObjType())t.fetchFilterDefinition(e).then(function(e){var t=o(JSON.parse(e.filterCVQuery),n,a);l(t)},function(e){u(e)});else{var c=e.getExternalFilterSpec(),d=null;null!=c?"DELLmiGeneralSystemReference"==e.getObjType()?(d=s(e.getPhysID(),i,n,a)).config_filter=c.CVQuery.union.expand[0].config_filter:d=o(c,n,a):d=s(e.getPhysID(),i,n,a),r.EXPAND_V1_OPTIONS&&r.EXPAND_V1_OPTIONS.no_type_filter_bo&&(d.no_type_filter_bo=r.EXPAND_V1_OPTIONS.no_type_filter_bo),l(d)}})}(e,n,_,a).then(function(n){var o=n;t.makeAuthHttpsCall(p,"POST",o,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(e){if(null!=e.error){let i=!1;for(var t of(r.dbgout("expand success, but with errors: "+e.error.errorMessage),e.error.errors))"CLOUDVIEW_ERROR__UNKNOWN_META"===t.errorCode?r.dbgout("   "+t.errorContextualMessage):i=!0;(i||void 0===e.results||null===e.results||0===e.results.length)&&u(e.error)}var n=e.results;n._dataSource=i,r.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),l(n)},function(e){u(e)})},function(e){u(e)})},function(e){u(e)})})}return{jsClass:"CVEXPAND",doExpand:function(e,t,i,n,r){return u(e,t,i,n,r)}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/LifecycleServices/LifecycleServicesSettings","UWA/Json"],function(e,t,i,n){var r="/resources/lifecycle/expand/federated";return{jsName:"LIFECYCLE_SVC_EXPAND",doExpand:function(e,n,o,s,a){return me=this,new Promise(function(o,l){(function(e,i,n,o){var s=this;return new Promise(function(n,a){var l=null,u=null,c=null,d=[],p=[],h="",_="";null!=o.CV_PROPS&&Object.keys(o.CV_PROPS).forEach(function(e){var t=o.CV_PROPS[e];"REF.dfr"==t&&(t="REF.bo.plmreference.v_derivedfrom"),-1==t.indexOf(".")&&d.push(t),t.startsWith("REF.")?d.push(t.substring(4)):t.startsWith("INST.")&&p.push(t.substring(5))});var f=e.getExternalFilterSpec();null!=f&&null!=f.CVQuery&&((h={}).CVQuery=f.CVQuery),null!=f&&null!=f.CVQueryV2&&(null!=f.CVQueryV2.filter?(_={}).filter=f.CVQueryV2.filter:(_={}).filter=f.CVQueryV2.batch.expands[0].filter),d.includes("bo.plmentity.v_usage")&&d.splice(d.indexOf("bo.plmentity.v_usage"),1,"bo.PLMEntity.V_usage"),p.includes("ro.plminstance.V_treeorder")||p.push("ro.plminstance.V_treeorder");var g=o.COMMAND_CONTEXT?o.COMMAND_CONTEXT:"compare";if("LC_IDX_SERVICE"==i||"LC_AUTH_SERVICE"==i){l=r;var m="LC_AUTH_SERVICE"==i;u="POST",c={ids:[e.getPhysID()],authoring:m,command:g,enableProto:!0,select_bo:d,select_rel:p,filter:h,filterV2:_}}else{var S="UNEXPECTED data source: "+i;s.plugSvcs.errout(S),a(S)}var T=e.getTenant(),C=e.getSecurityContext(),E=e.getServiceName();t.makeAuthHttpsCall(l,u,c,"json",T,E,C,!0).then(function(e){n(e)},function(e){a(e)})})})(e,n,0,a).then(function(e){var t=e.errorCode;if(t){var r=e.errorMessage;return s.errout("Lifecycle federated expand via "+n+" failed; errorCode:"+t+" errorMessage:"+r),void l(e)}if(!me._responseValidityCheck(e))return s.errout("Lifecycle federated expand via "+n+" failed; response deemed invalid."),void l(e);var a=e.results;a.forEach(function(e){e.attributes&&(e.attributes=e.attributes.filter(e=>""!==e.value),e.attributes.forEach(function(e){"bo.PLMEntity.V_usage"===e.name&&(e.name="bo.plmentity.v_usage")}))}),a.forEach(function(e){if(e.icon__default_thumbnail_2d){var t=i.getTenant(),n=i.get3DSpaceBaseUrl(t);e.icon__default_thumbnail_2d.forEach(function(e){e.icon&&e.icon.startsWith("/")&&(e.icon=n+e.icon)})}}),a._dataSource=n,o(a)},function(e){s.errout(e),l(e)})})},_responseValidityCheck:function(e){if(!e.results)return!1;var t=e.results;if(!Array.isArray(t))return!1;if(!t.find(e=>e.attributes&&e.attributes.length>0))return!1;var i=t.find(e=>e.path&&e.path.length>0);if(!i)return!1;var n=i.path[0];return!!t.find(e=>e.attributes&&Array.isArray(e.attributes)&&e.attributes.find(e=>"did"===e.name&&e.value==n))}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],function(e,t,i){var n={format:"entity_relation_occurrence",hits:{predefined_computation:["boundingbox","cgr","thumbnail_3d","icons"]},select_object:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],select_relation:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},r={format:n.format,hits:n.hits,select_object:[...n.select_object,"relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_relation:[...n.select_relation,"Matrixtxt"]};function o(e,i,o,s){var a=null!=s&&0!=s.length,l=a?n:r,u={batch:{expands:[{label:"TBD_LABEL",root:{physical_id:e},filter:{all:1},aggregation_processors:[]}]},outputs:t.dupeJson(l)};return a&&(u=function(e,t){return Object.keys(t).forEach(function(i){var n=t[i],r=n.indexOf(".");if(-1==r)e.select_bo.push(n);else{var o=n.substr(0,r),s=n.substr(r+1);if("REF"==o)"dfr"==s&&(s="bo.plmreference.v_derivedfrom"),-1==e.outputs.select_object.indexOf(s)&&e.outputs.select_object.push(s);else{if("INST"!=o)throw new Error("UNKNOWN specifier in PROPS definition");"matrixtxt"==s&&(s="Matrixtxt"),-1==e.outputs.select_relation.indexOf(s)&&e.outputs.select_relation.push(s)}}}),e}(u,s)),u}function s(t,n,r,s,a){return new Promise(function(r,l){var u="/cvservlet/progressiveexpand/v2";s.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),s.dbgout("cvExpand on id: "+t.getPhysID()+"\n on service   : "+t.getServiceName()+"\n with expand type: cvProgressiveExpand\n with URL     : "+u);(function(t,i,n,r){return new Promise(function(i,n){var s=o(t.getPhysID(),0,0,r.CV_PROPS),a=t.getExternalFilterSpec();null!=a&&(s=function(e,t){return null!=t.CVQueryV2.filter?e.batch.expands[0].filter=t.CVQueryV2.filter:e.batch=t.CVQueryV2.batch,e}(s,a)),null!=r.PROGRESSIVE_EXPAND_OPTIONS&&e.extend(s.batch.expands[0],r.PROGRESSIVE_EXPAND_OPTIONS),i(s)})})(t,0,0,a).then(function(e){var o=e;i.makeAuthHttpsCall(u,"POST",o,"text/plain",t.getTenant(),t.getServiceName(),t.getSecurityContext(),!1,!1,"output_format=cvjson").then(function(e){var t=e;"string"==typeof t&&(t=t.replace("{}",""),t=JSON.parse(t)),null!=t.errors&&0!=t.errors.length?l(t.errors):((t=t.results)._dataSource=n,s.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),r(t))},function(e){l(e)})},function(e){l(e)})})}return{jsClass:"CV_PROGRESSIVE_EXPAND",doExpand:function(e,t,i,n,r){return s(e,t,0,n,r)}}}),define("DS/CompareWidget2/support/objIDSpec",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(t,i,n,r,o,s,a,l,u,c,d){this._physID=t?e.dupeJson(t):null,this._objType=i?e.dupeJson(i):null,this._securityContext=n?e.dupeJson(n):null,this._tenant=r?e.dupeJson(r):e.getCurrentTenant(),this._serviceName=o?e.dupeJson(o):"3DSpace",this._externalFilterSpec=s?e.dupeJson(s):null,this._idType=a?e.dupeJson(a):"modelID",this._commands=l?e.dupeJson(l):null,void 0!==u&&(this._supportsRevisions=!1!==u),void 0!==c&&(this._supportsFilters=!1!==c),this._interfaces=d||[],this._reqModforODT="DS/CompareWidget2/support/objIDSpec"};return t.prototype.destroy=function(){delete this._physID,delete this._objType,delete this._securityContext,delete this._tenant,delete this._serviceName,delete this._externalFilterSpec,delete this._idType,delete this._commands,delete this._supportsRevisions,delete this._supportsFilters,delete this._interfaces},t.prototype.makeDupe=function(){return new t(this._physID,this._objType,this._securityContext,this._tenant,this._serviceName,this._externalFilterSpec,this._idType,this._commands,this._supportsRevisions,this._supportsFilters,this._interfaces)},t.prototype.getUniqueID=function(){var e="NO_FILTER";null!=this._externalFilterSpec&&(e=this._externalFilterSpec.filterTitle);var t="NO_COMMANDS";return null!=this._commands&&(t=this._commands),this.getPhysID()+"-"+this.getObjType()+"-"+this.getSecurityContext()+"-"+this.getTenant()+"-"+this.getServiceName()+"-"+e+"-"+t+"-"+this.getInterfacesString()},t.prototype.isEqual=function(e){return this.getUniqueID()==e.getUniqueID()},t.prototype.getPhysID=function(){return this._physID},t.prototype.getObjType=function(){return this._objType},t.prototype.getSecurityContext=function(){return this._securityContext},t.prototype.getTenant=function(){return this._tenant},t.prototype.getServiceName=function(){return this._serviceName},t.prototype.getExternalFilterSpec=function(){return this._externalFilterSpec},t.prototype.getIDType=function(){return this._idType},t.prototype.getCommands=function(){return this._commands},t.prototype.hasCommands=function(){var e=!1;return null!=this._commands&&this._commands.constructor==Array&&this.commands.length>0&&(e=!0),e},t.prototype.isFiltered=function(){return null!=this._externalFilterSpec||"ENOStrRefinementSpecification"==this._objType},t.prototype.getSvcType=function(){return this._serviceName+"."+this._objType},t.prototype.getTenantSvcType=function(){return this._tenant+"."+this.getSvcType()},t.prototype.getInterfaces=function(){return this._interfaces},t.prototype.getInterfacesString=function(){return Array.isArray(this._interfaces)?this._interfaces.join("|"):""},t}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(e,t,i,n,r){this._relName=e,this._adjFlagArray=t||[],this._additionalStatusArray=[],this._bubbledStatusArray_static=[],this._bubbledStatusArray_dynamic=[],null!=r&&r.length>0&&(this._instFlagNdxs=r),this._baseNode=i,this._compNode=n,this._treeNodeArray=[],this._depth="",this._level=-1,this._isHidden_byStatusFilter=!1,this._isHidden_byTypeAttr=!1,this._showHideNodeByTypeAndAttrParam=NaN,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"};return t.prototype.getRelName=function(){return this._relName},t.prototype.getBaseNode=function(){return this._baseNode},t.prototype.getCompNode=function(){return this._compNode},t.prototype.getOtherNode=function(e){return this._baseNode===e?this._compNode:this._baseNode},t.prototype.resetRelName=function(e){this._relName=e},t.prototype.resetBaseNode=function(e){this._baseNode=e},t.prototype.resetCompNode=function(e){this._compNode=e},t.prototype.isBaseDummy=function(){return this._baseNode.isDummy()},t.prototype.isCompDummy=function(){return this._baseNode.isDummy()},t.prototype.getAdjFlagArray=function(){return this._adjFlagArray},t.prototype.getInstFlagNdxs=function(){return this._instFlagNdxs},t.prototype.qtyIsDiff=function(){return this.qtyIsDiffFlag},t.prototype.setDepth=function(e){this._depth=e},t.prototype.getDepth=function(){return this._depth},t.prototype.setLevel=function(e){this._level=e},t.prototype.getLevel=function(){return this._level},t.prototype.setIsHidden_byStatusFilter=function(e){this._isHidden_byStatusFilter=e},t.prototype.setIsHidden_byTypeAttr=function(e){this._isHidden_byTypeAttr=e},t.prototype.getIsHidden_byStatusFilter=function(){return this._isHidden_byStatusFilter},t.prototype.getIsHidden_byTypeAttr=function(){return this._isHidden_byTypeAttr},t.prototype.getIsHidden_byAnyFilter=function(){return this._isHidden_byTypeAttr||this._isHidden_byStatusFilter},t.prototype.setShowHideNodeByTypeAndAttrParamIndex=function(e){this._showHideNodeByTypeAndAttrParam=e},t.prototype.getShowHideNodeByTypeAndAttrParamIndex=function(){return this._showHideNodeByTypeAndAttrParam},t.prototype.addTreeNode=function(e){this._treeNodeArray.push(e)},t.prototype.getTreeNodes=function(){return this._treeNodeArray},t.prototype.addBubbledStatus=function(e,t){var i=this.hasStatus(e);if(null==i)t?this._bubbledStatusArray_dynamic.push(e):this._bubbledStatusArray_static.push(e);else if("DYNAMIC"==i&&0==t){this._bubbledStatusArray_static.push(e);var n=this._bubbledStatusArray_dynamic.indexOf(e);this._bubbledStatusArray_dynamic.splice(n,1)}},t.prototype.addAdditionalStatus=function(e){this._additionalStatusArray.push(e)},t.prototype.getAllStatusArray=function(e){var t=[];return t=null!=this._bubbledStatusArray_static?[this._relName,...this._adjFlagArray,...this._bubbledStatusArray_static]:[this._relName,...this._adjFlagArray],null!=this._additionalStatusArray&&(t=[...t,...this._additionalStatusArray]),this.qtyIsDiffFlag&&t.push("QUANTITY"),1==e&&this._bubbledStatusArray_dynamic.length>0&&(t=[...t,...this._bubbledStatusArray_dynamic]),t},t.prototype.hasStatus=function(e){var t=null;return this._relName==e?t="PRIMARY":null!=this.additionalStatusArray&&this.additionalStatusArray.contains(e)?t="ADDITIONAL":null!=this._adjFlagArray&&this._adjFlagArray.includes(e)?t="SECONDARY":null!=this._bubbledStatusArray_static&&this._bubbledStatusArray_static.includes(e)?t="STATIC":null!=this._bubbledStatusArray_dynamic&&this._bubbledStatusArray_dynamic.includes(e)&&(t="DYNAMIC"),t},t.prototype.shallowDupe=function(){var e=this._relName.repeat(1),i=null==this._adjFlagArray?[]:JSON.parse(JSON.stringify(this._adjFlagArray)),n=null==this._additionalStatusArray?[]:JSON.parse(JSON.stringify(this._additionalStatusArray)),r=this._bubbledStatusArray_dynamic?[]:JSON.parse(JSON.stringify(this._bubbledStatusArray_dynamic)),o=this._bubbledStatusArray_static?[]:JSON.parse(JSON.stringify(this._bubbledStatusArray_static)),s=null;null!=this._instFlagNdxs&&this._instFlagNdxs.length>0&&(s=JSON.parse(JSON.stringify(this._instFlagNdxs)));var a=this._baseNode.shallowDupe(),l=this._compNode.shallowDupe(),u=new t(e,i,a,l,s);return u._isHidden_byStatusFilter=this._isHidden_byStatusFilter,u._isHidden_byTypeAttr=this._isHidden_byTypeAttr,u._additionalStatusArray=n,u._bubbledStatus_dynamic=r,u._bubbledStatus_static=o,a.setMatchInfo(u),l.setMatchInfo(u),u},t.prototype.isAttributeValueEqual=function(e){return this.getBaseNode().getAttr(e)===this.getCompNode().getAttr(e)},t}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],function(e,t,i){function n(e){var i=!1;return e instanceof r?e==this?t.errout("Cannot attach an CRNode to itself... ignoring"):i=!0:t.errout("CRNode.validateCRNodeToAdd:Cannot attach an object that is not a CRNode... ignored"),i}var r=function(e,t,i,n,r,o,s,a,l,u,c,d){if(this._attrList={},this._childArray=[],this._parent=null,this._matchInfo=null,this._dbContext={},this._path=null,this._objIDSpecREF=null,this._objIDSpecINST=null,this._expandCollapseState="expanded",this._isVisible=!0,this._externalFilterName=null,this._attrList={name:e,title:t,type:i,physicalID_REF:r,physicalID_INST:n,revision:o,displayOrder:s,typeIconSmallURL:a,typeIconLargeURL:l,thumbnail_3d:u},this._customRuleAttrs={},null!=d){const e=(e,t)=>void 0===t?null:t;this._customRuleAttrs=JSON.parse(JSON.stringify(d,e))}this._riNode=c,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"};return r.prototype.sortChildren=function(){var e=this._childArray.sort(function(e,t){return e.getAttr("displayOrder")-t.getAttr("displayOrder")});this._childArray=e},r.prototype.getRefInstNode=function(){return this._riNode},r.prototype.isDummy=function(){return null==this._attrList.physicalID_REF},r.prototype.setDBContext=function(e){this._dbContext=e},r.prototype.hasExternalFilter=function(){return null!=this._externalFilterName},r.prototype.getExternalFilterName=function(){return this._externalFilterName},r.prototype.setExternalFilterName=function(e){this._externalFilterName=e},r.prototype.getObjIDSpec_REF=function(){return null==this._objIDSpecREF&&void 0!==this._attrList.physicalID_REF&&null!==this._attrList.physicalID_REF&&(this._objIDSpecREF=new i(this._attrList.physicalID_REF,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecREF},r.prototype.getObjIDSpec_INST=function(){return null==this._objIDSpecINST&&null!=this._attrList.physicalID_INST&&(this._objIDSpecINST=new i(this._attrList.physicalID_INST,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecINST},r.prototype.getDBContext=function(){return this._dbContext},r.prototype.getTitle=function(){return this._attrList.title},r.prototype.getType=function(){return this._attrList.type},r.prototype.getCustomRuleAttrs=function(){return this._customRuleAttrs},r.prototype.addAttr=function(e,t){this._attrList[e]=t},r.prototype.addOrSetCustAttr=function(e,t){this._customRuleAttrs[e]=t},r.prototype.getAttr=function(e){let t=void 0;return null==(t=this._attrList[e])&&(e.indexOf("REF.")>=0||e.indexOf("INST.")>=0)&&this._riNode&&(t=this._riNode.getAttr(e)),null==t&&null!=this._customRuleAttrs&&(t=this._customRuleAttrs[e]),t},r.prototype.addChild=function(e){n(e)&&this._childArray.push(e)},r.prototype.getChildArray=function(){return this._childArray},r.prototype.findChildByID=function(e,t){for(var i=this._childArray.length,n=null,r=0;r<i;r++){var o=this._childArray[r],s=o.getAttr("physicalID_INST"),a=o.getAttr("physicalID_REF");if(e==s&&t==a){n=o;break}}return n},r.prototype.getPath=function(){if(null==this._path){for(var e=[],t=this;null!=t&&"object"==typeof t;){var i=t.getAttr("physicalID_INST"),n=t.getAttr("physicalID_REF");if(null==n)break;e.unshift(n),null!=i&&""!==i&&e.unshift(i),t=t.getParent()}this._path=e.join("/")}return this._path},r.prototype.setParent=function(e){n(e)&&(null!=this._parent&&t.errout("CRNode's parent is being reassigned (this is unexpected)."),this._parent=e)},r.prototype.getParent=function(){return this._parent},r.prototype.setMatchInfo=function(e){this._matchInfo=e},r.prototype.isRoot=function(){return null==this._parent},r.prototype.isHeaderRow=function(){return"relations"==this._attrList.type},r.prototype.isBlank=function(){return null==this._attrList.type},r.prototype.isDraggable=function(){return!(this.isBlank()||this.isHeaderRow())},r.prototype.getMatchInfo=function(){return this._matchInfo},r.prototype.destroy=function(){this._parent=null,this._matchInfo="",this._attrList=null;for(var e=0;e<this._childArray.length;e++)null!=this._childArray[e]&&(this._childArray[e].destroy(),this._childArray[e]=null)},r.prototype.shallowDupe=function(){let t=new r(this._attrList.name,this._attrList.title,this._attrList.type,this._attrList.physicalID_INST,this._attrList.physicalID_REF,this._attrList.revision,this._attrList.displayOrder,this._attrList.typeIconSmallURL,this._attrList.typeIconLargeURL,this._attrList.thumbnail_3d,this._riNode,this._customRuleAttrs);t.setDBContext(e.clone(this.getDBContext()));var i=this.getExternalFilterName();return t.setExternalFilterName(i),t},r.prototype.getExpandCollapseState=function(){return Array.isArray(this._childArray)&&this._childArray.length?this._expandCollapseState||"expanded":"noExpandState"},r.prototype.setExpandCollapseState=function(e){this._expandCollapseState=e},r.prototype.visitVisible_nodesAndFN=function(e){return this.visit_nodesAndFN(!0,e)},r.prototype.visitAll_nodesAndFN=function(e){return this.visit_nodesAndFN(!1,e)},r.prototype.removeChild=function(e){for(var t=0;t<this._childArray.length;t++){if(this._childArray[t]===e){this._childArray.splice(t,1);break}}},r.prototype.visit_nodesAndFN=function(e,i){var n=!1;if(1==e&&1==this._isVisible||0==e)try{var r=[];for(r.push(this);r.length>0;){var o=r.pop();if(0!=(n=i(o))&&(1==e&&1==this._isVisible||0==e))for(var s=o.getChildArray(),a=s.length-1;a>=0;a--){var l=s[a],u=!(l.getMatchInfo()&&l.getMatchInfo().getIsHidden_byStatusFilter());(1==e&&1==u||0==e)&&r.push(l)}}}catch(e){n=!1,t.errout("EXCEPTION in 'visit_nodesAndFN':: "+e)}return n},r.prototype.areAnyChildrenVisible=function(){var e=!1;if("expanded"==this.getExpandCollapseState()){var t=this.getChildArray();if(null!=t)for(var i=0;i<t.length;i++){if(0==t[i].getMatchInfo().getIsHidden_byAnyFilter()){e=!0;break}}}return e},r}),define("DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"],function(e,t,i){"use strict";const n=50;function r(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t}function o(e){let t=e.getChildArray();var i=[],o=1;let s=e.getObjIDSpec_REF().getPhysID();for(s&&i.push(s);o<=n&&t.length>0;)t.forEach(function(e){let t=e.getObjIDSpec_REF().getPhysID();t&&i.push(t)}),o++,t=r(t);return i}function s(e,t,i){for(var o=1,s=t,u=t[0];o<=n&&s.length>0;)s.forEach(function(t){if(null!=t.getObjIDSpec_REF().getPhysID()){var n=t.getObjIDSpec_REF().getPhysID(),r=[];e.formated[n]&&(r=Object.keys(e.formated[n]));for(var o=0;o<r.length;o++){var s=e.formated[n][r[o]],u=i[r[o]].label,c=a(t,r[o],u);s.forEach(function(i){var n=e.idObjMap[i],r=l(c,n);c.addChild(r),r.setDBContext(t._dbContext)}),t.addChild(c)}}}),s=r(s),o++;return u}function a(e,t,n){var r=new i(n,n,"relations","",t,"","","","","");return r.setParent(e),r.addAttr("REF.ds6w:type","relations"),r.addAttr("REF.physicalid",t),r.addAttr("REF.logicalid",t),r.addAttr("REF.versionid",t),r.addAttr("REF.name",n),r.addAttr("REF.dfr",t),r.addAttr("REF.ds6wg:revision",""),r.addAttr("REF.thumbnail_3d",""),r._extRelNLS=!0,r}function l(e,t){var n=new i(t.name,t.name,t.type,"",t.id,t.revision,"",t.icon_url,t.icon_url,t.thumbnail);return n._path=t.id,n.setParent(e),n.addAttr("REF.ds6w:type",t.type),n.addAttr("REF.physicalid",t.id),n.addAttr("REF.logicalid",t.id),n.addAttr("REF.versionid",t.revision),n.addAttr("REF.name",t.name),n.addAttr("REF.dfr",t.id),n.addAttr("REF.ds6wg:revision",t.revision),n.addAttr("REF.thumbnail_3d",t.thumbnail),n}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this.relationLabels=i.RELATION_LABELS},onEnabled:function(){return this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels"),!0},execute:function(e,i){var n=this;n._parent(e,i);var r=[];!0!==this.showDocs&&"true"!==this.showDocs||(r=i.DOCS_RELS);var a=[];!0!==this.showOtherRels&&"true"!==this.showOtherRels||(a=i.OTHER_RELS),n.rels=r.concat(a);var l=e.crTreeArray[0];n._objIn=e,n.rels.length>0?function(e,i){var n=this;return new Promise(function(e,i){var r=n.rels,a=n.relationLabels=n.relationLabels||n._pluginOptions.RELATION_LABELS;n._lastReqStart=n._plugSvcs.nowMS(),n._plugSvcs.postEvent("GET_RELATIONS_IN_PROGRESS_EVENT",null);var l=n._objIn.crTreeArray[0].getRoot(0),u=n._objIn.crTreeArray[0].getRoot(1),c=o(l),d=o(u),p=c.concat(d);t.get(p,r,function(t){if(null!=t){var i=[];i.push(l),s(t,i,a);var r=[];r.push(u),s(t,r,a)}e(n._objIn)})})}.call(n,l,i).then(function(e){var t=e;n.reportOK(t)},function(e){n.reportKO()}):n.reportOK(e)}})}),define("DS/CompareWidget2/support/cw2CacheMgr",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],function(e,t){var i=function(){this.data={},this.putEntry=function(e,t){this.data[e]=t},this.getEntry=function(e){return this.data[e]},this.flush=function(){this.data={}},this.getSize=function(){return Object.keys(this.data).length},this.putArray=function(e){for(var t=e.length,i=0;i<t;i++){var n=e[i],r=n.name;this.putEntry(r,n)}}};return e.singleton({init:function(){this._cacheSet={}},flushAll:function(){this._cacheSet={}},flushCache:function(e){null!=this._cacheSet[e]&&(this._cacheSet[e]={})},getCache:function(e,t){return null==this._cacheSet[e]&&0!=t&&(this._cacheSet[e]=new i),this._cacheSet[e]},putCacheObj:function(e,t,i){this.getCache(e,!0).putEntry(t,i)},putCacheObjArray:function(e,t){for(var i=t.length,n=0;n<i;n++){var r=t[n],o=r.name;this.putCacheObj(e,o,r)}},getCacheObj:function(e,t){var i=this.getCache(e,!1);return ret=null!=i?entry=i.getEntry(t):void 0,ret},getSize:function(e){if(null==e)return Object.keys(this._cacheSet).length;var i=this.getCache(e,!1);return null==i?(t.errout("Cache '"+e+"' not found);"),null):i.getSize()},getTotalCachesSize:function(){return t.sizeof(this._cacheSet)}})}),define("DS/CompareWidget2/support/typeHierMgr",["UWA/Class","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t){return e.singleton({init:function(){this._cache=t.getCache("typeHier",!0)},flush:function(){this._cache.flush()},isKindOf_withLookup:function(e,t){var i=this;return new Promise(function(n,r){var o=i.isKindOf(e,t);null!=o?n(o):i.loadUp([e]).then(function(r){var o=i.isKindOf(e,t);n(o)},function(t){r("Failed to find type hierarchy for "+e+": "+t)})})},isKindOf:function(e,t){var i=null;if(e==t)i=!0;else{var n=this._cache.getEntry(e);n&&(i=1==n[t])}return i},loadUp:function(e){var t=this,i=[];return e.forEach(function(e){null==t._cache.getEntry(e)&&i.push(e)}),new Promise(function(e,n){0==i.length?e():function(e){var t=this;return new Promise(function(i,n){require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(t,r){t.app_initialization(function(){r.getTypesHierarchy({types:e,onComplete:function(e){let t=JSON.parse(e).types_hierarchies;i(t)},onFailure:function(e){console.error("Cannot retrieve hierarchies"),n(e)}})})},function(e){t.errout("Failed on load of modules for getTypesHiers() call: "+e),n(e)})})}(i).then(function(i){i.forEach(function(e){for(var i=e.type,n=e.hierarchy,r=null==n?0:n.length,o={},s=0;s<r;s++){o[n[s]]=!0}t._cache.putEntry(i,o)}),e()},function(e){n("Failed to loadUp type hierarchies in typeHierMgr... :"+e)})})}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/typeHierMgr","i18n!DS/CompareCommon/assets/nls/CompareCommon","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,r,o,s,a,l,u){function c(e){var t,i,n;!1===o.get("compareSettings.dataSource.useIndex")&&(e||(t="INDEX_REQ_ENABLING",i="compare-alert-warning",require(["DS/CompareCommon/CompareAlert"],function(e){var r=null==t?a["MISSING ALERT MESSAGE"]:null!=a[t]?a[t]:t,o=null!=n&&""!==n?r.replace("{msgData}",n):r;e.doAlert({msg:o,alertStyle:i})},function(e){console.log("%%%% CompareWidget:: Failed to show "+i+": '"+t+"', error:"+e)})),widget.setValue("compareSettings.dataSource.useIndex",!0),o.set("compareSettings.dataSource.useIndex",!0))}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._expanders={byIndex:"CV_DIRECT",byDB:null},this.setExpandMethods(i.DATA_SOURCE,i.DB_FALLBACK)},onEnabled:function(){return this.syncSetting("compareSettings.dataSource.useIndex","_useIndex",function(e){this.postEvent({event:"Event_CW2_REFRESH"})}.bind(this)),!0},setExpandMethods:function(e,t){var i=this;null!=e&&""!==e&&(i._expanders.byIndex=e),null==t||""==t||0==t?i._expanders.byDB=null:1==t?"CV_SERVICE"==e||"CV_DIRECT"==e?i._expanders.byDB="DB_SERVICE":"LC_IDX_SERVICE"==e?i._expanders.byDB="LC_AUTH_SERVICE":(i._plugSvcs.warnout("DB FALLBACK DISABLED, as there is no default DB fallback for an expand of type: "+i._expanders.byIndex),i._expanders.byDB=null):i._expanders.byDB=t},execute:function(e,o){var a=this;a._parent(e,o);var d=e,p=d.some(e=>e.isFiltered());a.setExpandMethods(o.DATA_SOURCE,o.DB_FALLBACK),(p||null==a._expanders.byDB&&0==a._useIndex)&&c.call(a,!1),function(e,n){var o=this;return new Promise(function(s,a){o._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var l=[];e.forEach(function(e){if(null!=e.getCommands){var t=e.getCommands();null!=t&&t.forEach(function(t){var i=t.inNode;if(null!=i){var n=new r(i,"UNKNOWN",e.getSecurityContext(),e.getTenant(),e.getServiceName());l.push(n)}})}});for(var u=[...e,...l],c=[],d=u.length,p={securityContext:e[0]._securityContext,tenant:e[0]._tenant,serviceName:e[0]._serviceName},h=0;h<d;h++){var _=null,f=null,g=u[h],m=g.isFiltered();if(0==o._useIndex&&0==m?_=o._expanders.byDB:(_=o._expanders.byIndex,f=m?null:o._expanders.byDB),"CV_DIRECT"==_){var S=g.getExternalFilterSpec();null!=S&&null!=S.CVQueryV2&&"DELLmiGeneralSystemReference"!=g.getObjType()&&(_="CV_PROGRESSIVE")}t.doExpand(g,_,f,"-1",o._plugSvcs,n).then(function(e){var t=e;i.augment(t,p,o._plugSvcs).then(function(e){var t=e;c.push(t),c.length>=d&&s(c)},function(e){o._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),a(e)})},function(e){o._plugSvcs.errout("FAILURE EXPANDING TREE: "+e),a(e)})}})}.call(a,d,o).then(function(e){var t,i,r,o=function(e,t){var i=[],n=[],r=[],o={};return t.forEach(function(e){var t=e.getObjIDSpec().getUniqueID();null==o[t]&&(o[t]=[]),o[t].push(e)}),e.forEach(function(e){var t=e.getUniqueID(),n=o[t].pop();i.push(n),r.push(t)}),Object.keys(o).forEach(function(e){o[e].forEach(function(e){n.push(e)})}),{orderedTrees:i,extraTrees:n}}(d,e);o.orderedTrees.forEach(function(e){var t=e.getEditCommands();null!=t&&n.applyCommands(e,t,o.extraTrees,a._plugSvcs,!0)}),t=o.orderedTrees,i=a._plugSvcs,r=i.nowMS(),t.forEach(function(e){var t=0,n=0;e.visit_riTreeAndFN(function(e){var i=e.getAttr("REF.cgr"),r=e.getAttr("REF.thumbnail_3d");return null!=i&&""!=i&&n++,null!=r&&""!=r&&t++,!0});var r=t<n,o=r?i.warnout:i.dbgout;o("===->"),o("===-> Input assembly has "+n+" CGRs and "+t+" thumbnail_3ds"),o("===->"),r&&o("===-> expect 3DRendering to be significantly slower")}),i.reportTime(r,"Time to verify assemblies have bitmaps"),function(e){var t={};e.forEach(function(e){e.visit_riTreeAndFN(function(e){var i=e.getAttr("REF.ds6w:type"),n=e.getAttr("INST.ds6w:type");return t[i]=!0,null!=n&&(t[n]=!0),!0})});var i=Object.keys(t);return s.loadUp(i)}(o.orderedTrees).then(function(e){a.reportOK(o.orderedTrees)},function(e){a._plugSvcs.warnout("failed to load type hierarchies:: "+e),a._plugSvcs.warnout("continuing..."),a.reportOK(o.orderedTrees)})},function(e){a._plugSvcs.confirmDialog(u.FETCH_FAIL_DEFAULT,{label:l.Close,callback:function(){a._plugSvcs.postEvent("Event_CW2_RESET_TO_INPUT")}},null),a.reportKO(e)})}})}),define("DS/CompareWidget2/ViewDefModules/ViewDefOptions",["DS/CompareWidget2/ViewDefModules/DSColors","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid",DFR:"REF.dfr",INST_LOGID:"INST.logicalid",XFORM:"INST.matrixtxt",USAGE:"REF.bo.plmentity.v_usage"},n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},r={...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform",USAGE:"REF.attribute[PLMEntity.V_Usage]"},o={BASELINE:e.colorDef.ORANGE,COMPARE:e.colorDef.BLUE1},s={DB_PROPS:r,CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"},{name:"3D",url:"/cvservlet/expand3d",typeList:["LPAbstract3DRepReference","LPAbstractReference","MCAD Component","CATIA V4 Model","CATIA CGR","CATShape"]},{name:"Filter",url:"/cvservlet/multiexpand",typeList:["ENOStrRefinementSpecification"]}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!0},a={PROPS:i,COMPUTE_DIFFERENT:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE","REPLACED"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ","NEQ"]],COMP_DFR:[["DFR","DFR"],["N/A","N/A","N/A","EQ","NEQ"]],COMP_INST_LOGID:[["INST_LOGID","INST_LOGID"],["N/A","N/A","N/A","N/A","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",IS_VISIBLE:!0,MATCH_ADJ:-1},{NAME:"NON_MATCHING_INSTANCE",PROPS:["INST_LOGID","INST_LOGID"],FLAG_ON:"NEQ",IS_VISIBLE:!1,MATCH_ADJ:-2}]},l={PROPS:n,RELATION_LABELS:{"SpaceAssignment_to.472":{label:t.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:t.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:t.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:t.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:t.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:t.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:t.specificationDocuments,icon:""}},DOCS_RELS:["v6_specdoc_to","v6_annexdoc_to"],OTHER_RELS:["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"]},u={PROPS:n,COMPUTE_DIFFERENT:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},c={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:o.BASELINE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"LO"},RIGHT_ONLY:{COLOR:o.COMPARE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"RO"},UNRELATED:{COLOR:e.colorDef.BLACK,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"UNRELATED"},DIFFERENT:{COLOR:e.colorDef.BEIGE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"DIFFERENT"},QUANTITY:{COLOR:e.colorDef.BLUE2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:e.colorDef.NONE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"SM"},REVISION:{COLOR:e.colorDef.VIOLET,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REV"},BRANCH:{COLOR:e.colorDef.GREEN2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"BRANCHED"},DUPE:{COLOR:e.colorDef.RED,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"DUPLICATED"},REPLACED:{COLOR:e.colorDef.PINK,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:e.colorDef.YELLOW,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"MOVED"},NON_MATCHING_INSTANCE:{COLOR:e.colorDef.BLUE6,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"NON_MATCHING_INSTANCE"}},BUBBLE_FLAGS:{},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0,SHOW_HIDE_NODE_PARAMS:[{CHILD:{TYPE:["PLMPort","PLMConnection"]},SHOW:!1},{CHILD:{TYPE:["3DShape"]},PARENT:{TYPE:["VPMReference"],ATTRIBUTES:{[`${i.USAGE}`]:"3DPart"}},SHOW:"viewSettings.STRUCT_VIEW.show_3dshape_of_3dpart"}]};return{RUN_OPTIONS:{},DB_PROPS:r,CV_PROPS:i,STRUCT_COLORS:o,REL_PROPS:n,BUBBLE_OPTIONS:{BUBBLE_DOWN_ENABLED:!1,BUBBLE_UP_ENABLED:!1,BUBBLED_STATUS_CONFIG:[]},ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:o.BASELINE,colorRight:o.COMPARE},INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0,colorLeft:o.BASELINE,colorRight:o.COMPARE},STRUCT_FETCH_OPTIONS:s,STRUCT_COMPARE_OPTIONS:a,STRUCT_DISPLAY_OPTIONS:c,EFFECTIVITY_FETCH_OPTIONS:{isEffectivity:!0},EFFECTIVITY_DISPLAY_OPTIONS:{isEffectivity:!0,colorLeft:o.BASELINE,colorRight:o.COMPARE},GET_RELATIONS_OPTIONS:l,COMPARE_REL_OPTIONS:u}}),define("DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},GetRelations:{Path:"DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",Options:e.GET_RELATIONS_OPTIONS},CompareRels:{Path:"DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",Options:e.COMPARE_REL_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},StructCustAttrsPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_CUST_ATTRS_PREP_plugin"},EffectivityFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.EFFECTIVITY_FETCH_OPTIONS},EffectivityCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},EffectivityDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.EFFECTIVITY_DISPLAY_OPTIONS},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_STRUCT_INSTANCE:{ROW:["STRUCT_VIEW",{COL:["PROP_VIEW","INSTANCE_VIEW"]}]},STRUCT_PROPS_INST_PAD3D:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},STRUCT_PROPS_INST_EFF_PAD3D:{ROW:["STRUCT_VIEW_WITH_CUSTOM_ATTRS",{COL:[["PROP_VIEW","INSTANCE_VIEW","EFFECTIVITY_VIEW"],"PAD3D_VIEW"]}]},STRUCT_PROPS_INST_EFF:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW","EFFECTIVITY_VIEW"]]}]},STRUCT_PROPS_EFF:{COL:["STRUCT_VIEW",["PROP_VIEW","EFFECTIVITY_VIEW"]]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],EFFECTIVITY_VIEW:["EffectivityFetch","EffectivityCompare","EffectivityDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","GetRelations","CompareRels","StructListViewPrep","StructDisplay","Exporter"],STRUCT_VIEW_WITH_CUSTOM_ATTRS:["StructFetch","StructCompare","GetRelations","CompareRels","StructCustAttrsPrep","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/ViewDefModules/TNR_viewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){var i={PHYSICALID:"REF.physicalid",NAME:"REF.name",TYPE:"REF.ds6w:type",DFR:"REF.dfr",XFORM:"INST.matrixtxt",REVISION:"REF.ds6wg:revision"},n={...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"};e.STRUCT_FETCH_OPTIONS.CV_PROPS=i,e.STRUCT_FETCH_OPTIONS.DB_PROPS=n;var r={PROPS:i,CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","SIMILAR"],CUSTOM_COMPARISONS:{COMP_TYPE:[["TYPE","TYPE"],["EQ","EQ","EQ"]],COMP_DFR:[["DFR","DFR"],["EQ","EQ","EQ"]],COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ"]],COMP_REV:[["REVISION","REVISION"],["EQ","NEQ","N/A"]]}};UWA.extend(e.STRUCT_COMPARE_OPTIONS,r);var o={CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},SIMILAR:{COLOR:t.colorDef.GREEN2,NLS:"SIMILAR"}}};return UWA.extend(e.STRUCT_DISPLAY_OPTIONS,o),e}),define("DS/CompareWidget2/ViewDefModules/develViewDef",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){UWA.extend(e.VIEWDEFS,{DEVEL_VIEW:["StructFetch","StructCompare","StructDisplay"]});return UWA.extend(e.VIEWSETS,{DEVEL_VIEWSET:[["DEVEL_VIEW","PROP_VIEW"],["PAD3D_VIEW"]]}),e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.DIFFERENT.COLOR=t.colorDef.GREEN3,e.STRUCT_DISPLAY_OPTIONS.FORCE_ROOTS_TOGETHER=!0,e.STRUCT_COMPARE_OPTIONS.COMPUTE_DIFFERENT=!0,e}),define("DS/CompareWidget2/plugins/displayPlugin",["DS/CompareWidget2/plugins/plugin","DS/UIKIT/Mask"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._type="DISPLAY_PLUGIN",this._frame=null,this._outputPanel=null,this._messagePanel=null},createViewPanelObject:function(e,t){throw new Error("Abstract class called")},getViewPanel:function(){return this._outputPanel},showMessage:function(e){null!=this._frame&&(t.isMasked(this._frame)&&this.showNotBusy(),t.mask(this._frame,e),this._frame.getElement(".spinner").destroy(),this._frame.getElement(".mask").setStyle("background-color","rgba(255, 255, 255, 1)"))},removeMessage:function(){this.showNotBusy()},showBusy:function(){null!=this._frame&&t.mask(this._frame)},showNotBusy:function(){null!=this._frame&&t.isMasked(this._frame)&&t.unmask(this._frame)},reportKO:function(e){null!=e?this.showMessage(e):this.showNotBusy(),this._parent(e)},buildViewPanel:function(e,t,i,n){var r=this;this.hideCloseButton=t&&!0===t.hideCloseButton,r._frame=widget._isODTMode()&&!widget.isCompareFrameworkTest?(document.body.innerHTML="",document.body):r._plugSvcs.requestFrame(e),r.showBusy(),r._outputPanel=r.createViewPanelObject(r._frame,t),(widget._isODTMode()&&widget.isCompareFrameworkTest||!widget._isODTMode())&&r._plugSvcs.addPanel(e,r._outputPanel,r,i,n)},destroyDisplayPanel:function(){var e=this;null!=e._outputPanel&&"function"==typeof e._outputPanel.destroy&&e._outputPanel.destroy(),e._outputPanel=null,e._frame=null},onClearView:function(){null!=this._outputPanel&&this._outputPanel.clearView()},onUpdateInProgress:function(){this.onClearView(),this.showBusy()},enable:function(){return this._parent()},disable:function(){this._parent()},disconnect:function(){this.destroyDisplayPanel(),this._parent()},destroy:function(){this.destroyDisplayPanel(),this._parent()}})}),define("DS/CompareWidget2/viewComponents/StandardCompareToolbar",["UWA/Core","UWA/Class","DS/Tweakers/GeneratedToolbar","DS/Core/PointerEvents","DS/Menu/Menu","DS/Tweakers/TypeRepresentationFactory","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!DS/CompareWidget2/assets/css/Controls/Toolbar.css"],function(e,t,i,n,r,o,s,a,l){"use strict";return t.extend({init:function(e,t,i){this.container=e,this.options=i,this.view=t,this._buildView()},_buildView:function(){var t=this;this.toolbarContainer=e.createElement("div",{class:"compare-view-toolbar-container"}).inject(this.container),!0===this.options.navigateDifferences&&(this.toolbarNavigate=new i({overflowManagement:"dropdown",direction:"horizontal",items:i.prototype.createTreeDocument({entries:[{id:"navigatePrevious",dataElements:{domId:"compare-navigate-previous-button",typeRepresentation:"functionIcon",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","PreviousDifference"),icon:{iconName:"chevron-left",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigatePrevious"}),priority:100}},{id:"numDifferencesCommand",dataElements:{domId:"compare-navigate-differences-button",typeRepresentation:"functionMenuIconCount",label:"Differences",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","NumberOfDifferences"),value:{menu:[{icon:"double-chevron-up",title:l.FirstDifference,tooltip:a.generateTooltip("CompareWidget2/Tooltips","FirstDifference"),domId:"compare-navigate-first-button",event:"navigateFirst"},{icon:"double-chevron-down",title:l.LastDifference,tooltip:a.generateTooltip("CompareWidget2/Tooltips","LastDifference"),domId:"compare-navigate-last-button",event:"navigateLast"}].map(e=>({type:"PushItem",title:e.title,domId:e.domId,tooltip:e.tooltip,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.icon},action:{callback:i=>{t.view.handleToolbarCommands({event:e.event})}}}))},category:1,overflowPriority:"never",priority:100,count:1}},{id:"navigateNext",dataElements:{domId:"compare-navigate-next-button",typeRepresentation:"functionIcon",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","NextDifference"),icon:{iconName:"chevron-right",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigateNext"}),priority:100}}]})}),this.toolbarNavigate.inject(this.toolbarContainer),this.toolbarNavigate.elements.container.addClassName("compare-view-toolbar-navigate"),"desktop"!==s.getDeviceType()&&this.toolbarNavigate.elements.container.setAttribute("touch-mode",""),this.onReadyLeftToken||(this.onReadyLeftToken=t.toolbarNavigate.getContent().addEvent("onReady",function(){var e=t.toolbarNavigate.getNodeModelByID("numDifferencesCommand")._associatedView;e&&e.getContent().addClassName("compare-toolbar-differences")})));var n=Array.isArray(this.options.otherMenuItems)&&this.options.otherMenuItems.length?this.options.otherMenuItems:[];if(this.options.showCompareLegend){this.toolbar=new i({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:i.prototype.createTreeDocument({entries:[]})}),this.toolbar.elements.container.addClassName("compare-view-toolbar-legend"),this.toolbar.inject(this.toolbarContainer),this.onReadyLegendToken||(this.onReadyLegendToken=t.toolbar.getContent().addEvent("onReady",function(){if(t.legendItems)for(var e in t.legendItems){var i=t.legendItems[e],n=t.toolbar.getNodeModelByID(e);if(n){let s=n._associatedView;if(s){s.getContent().getParent(".wux-generated-toolbar-items").addClassName("compare-toolbar-legend"),s.getContent().id="compare-legend-status-"+i.label;var r=s.getContent().getChildren();r[0].addClassName("compare-toolbar-legend-item"),r[0].setStyles({"text-align":"left",color:"#3d3d3d"});var o=r[0].getChildren();o[0].setStyles({"background-color":"IDENTICAL"===e&&""===i.color?"#FFFFFF":i.color,"border-color":"IDENTICAL"===e&&""===i.color?"grey":i.color}),"IDENTICAL"===e&&""===i.color&&o[0].addClassName("compare-gray-check-for-white-status"),t.toolbar.elements.popupContent.setStyles({"padding-right":"10px","padding-left":"10px","padding-top":"2px","padding-bottom":"2px"})}}}})),0==this.options.CUSTOM_PROFILE_IN_USE&&n.unshift({id:"chooseStatusToDisplay",dataElements:{domId:"compare-choose-statuses-display-button",typeRepresentation:"functionIcon",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","chooseStatusToDisplay"),icon:{iconName:"menu-eye",fontIconFamily:1},overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyVisibility"}),position:"far",priority:1}})}Array.isArray(n)&&n.length&&(this.toolbarOtherItems=new i({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:i.prototype.createTreeDocument({entries:n})}),this.toolbarOtherItems.inject(this.toolbarContainer),this.toolbarOtherItems.elements.container.addClassName(this.options.showCompareLegend?"compare-view-toolbar-right-fixed-width":"compare-view-toolbar-right"))},update:function(e){let t=this,n=["toolbarNavigate","toolbar","toolbarOtherItems"],r=(e,t)=>{n.forEach(i=>{this[i]&&this[i][e].apply(this[i],t)})};r("prepareUpdateView");for(let n in e)switch(n){case"legend":{null!=this.legendItems&&Object.keys(this.legendItems).forEach(e=>{this.toolbar.items&&Array.isArray(this.toolbar.items.getRoots())&&this.toolbar.items.getRoots().filter(t=>t._ID.indexOf(e)>=0).forEach(e=>e.remove(!0))}),this.legendItems=e[n];var o={entries:[]};let r=0;for(var s=0;s<=r;++s)for(let[e,i]of Object.entries(this.legendItems)){let n=null!=i.legendGrouping?i.legendGrouping:0;if(n>s)n>r&&(r=n);else if(n===s){let n=i.tooltip;""!==i.modulePath&&Object.entries(l).map(([e,t])=>{t===i.label&&(n=a.generateTooltip(i.modulePath,e))}),o.entries.push({id:e,tooltipInfos:n,dataElements:{typeRepresentation:"bool",label:i.label,value:i.checked,color:this.legendItems[e].color,visibleFlag:i.visibleFlag},onNodeUpdate:function(e){var n=e.getAttributeValue("data");i.checked=n,t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyFilter",toolbar:t.toolbar})}})}}[...i.prototype.createTreeDocument(o).getRoots()].forEach(function(e){t.toolbar.items.addRoot(e)});break}case"numDifferences":null!=t.toolbarNavigate&&(t.toolbarNavigate.getNodeModelByID("numDifferencesCommand").options.count=e[n]);break;case"enableDisableCommands":e[n].forEach(e=>{r("updateNodeModel",[e.id,{disabled:e.disabled}])});break;case"showHideCommands":e[n].forEach(e=>{r("updateNodeModel",[e.id,{visibleFlag:e.visibleFlag}])});break;case"displayIcon":e[n].forEach(e=>{r("updateNodeModel",[e.id,{grid:{semantics:{icon:{iconName:e.icon}}}}])})}r("pushUpdateView")},destroy:function(){}})}),define("DS/CompareWidget2/support/tenantServiceContext_IDList",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],function(e,t){return function(){this._data={},this.addObjIDSpec=function(e){var t=e.getTenant(),i=e.getServiceName(),n=e.getSecurityContext(),r=e.getPhysID();null==this._data[t]&&(this._data[t]={}),null==this._data[t][i]&&(this._data[t][i]={}),null==this._data[t][i][n]&&(this._data[t][i][n]=[]),this._data[t][i][n][r]=e.getObjType()},this.visitEach_doFunc=function(e){var t=this;Object.keys(t._data).forEach(function(i){Object.keys(t._data[i]).forEach(function(n){Object.keys(t._data[i][n]).forEach(function(r){Object.keys(t._data[i][n][r]).forEach(function(o){var s=t._data[i][n][r][o];e(i,n,r,o,s)})})})})},this.getList=function(){var e=[];return this.visitEach_doFunc(function(i,n,r,o,s){var a=new t(o,s,i,n,r);return e.push(a),!0}),e}}}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel",["UWA/Core","UWA/Json","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!DS/CompareWidget2/assets/css/attrComparePanel/attrComparePanel.css"],function(e,t,i,n,r,o,s,a,l,u,c,d,p){return i.extend({init:function(e,t,i){this._parent(),this.device=u.getDeviceType(),this._colorLeft=null!=i&&i.colorLeft?i.colorLeft:"#ff8a2e",this._colorRight=null!=i&&i.colorRight?i.colorRight:"#009ddb",this._plugSvcs=t,this.buildSkeleton(e),this.showDiffOnly=!1,this.toClear=[],this.currentDisplayMode=""},getLabel:function(){return"undefined_TITLE"},getName:function(){return"undefined_VIEW"},getDomId:function(){return"undefined_ID"},isTitleAttr:function(e){return c.isTitleAttr(e,!1)},generateId:function(e){return"viewSettings."+this.getName()+"."+e},buildSkeleton:function(t){this.singleColView=!1,this.elements.container=t;var i=this.getToolbarItems(),n=i.find(e=>e.id.indexOf("showOnlyDifferences")>0);n&&l.sync(n.dataElements,n.id,"value",null),this.standardToolbar=new a(t,this,{navigateDifferences:!1,showCompareLegend:!1,otherMenuItems:i}),this.dataGridViewContainer=e.createElement("div",{styles:{flex:"1",position:"relative","border-top":"1px solid #f4f5f6"},id:"ATTR_DISPLAY_CONTAINER"}).inject(this.elements.container)},getToolbarItems:function(){return[this.getShowOnlyDifferencesItem(),this.getChooseAttributesToDisplayItem()]},getShowOnlyDifferencesItem:function(){var e=this;return{id:this.generateId("showOnlyDifferences"),dataElements:{typeRepresentation:"independantBoolean",priority:3,domId:"compare-"+this.getDomId()+"-diffs-only",label:d.attrShowDiffOnly,tooltipInfos:c.generateTooltip("CompareWidget2/Tooltips","attrShowDiffOnly"),position:"near"},onNodeUpdate:function(t){e.showDiffOnlyClicked(t)}}},getChooseAttributesToDisplayItem:function(){return{id:this.generateId("chooseAttributesToDisplay"),dataElements:{typeRepresentation:"functionIcon",priority:10,domId:"compare-"+this.getDomId()+"-to-display",tooltip:c.generateTooltip("CompareWidget2/Tooltips","selectPropertiesToDisplay"),icon:{iconName:"attributes-cog",fontIconFamily:1},position:"far",value:this.customizeRows.bind(this)}}},showDiffOnlyClicked:function(e){this.showDiffOnly=e.options.grid.data,this.update()},destroy:function(){this.elements.container=null,this.dataGridViewContainer=null},showResults:function(e){var t=this;return new Promise(function(i,n){var r=!1;t.compareResult=e,t.names=[];for(let i=0;i<e.length;i++)t.names.push(e[i].name),e[i].valuesRight.length>0&&(r=!0);var o=!0;this.comparedWithObjects=e[0].valuesRight.length,this.comparedWithObjects>1&&(o=!1),t.standardToolbar.update({showHideCommands:[{id:t.generateId("showOnlyDifferences"),visibleFlag:r},{id:"attrViewSelector",visibleFlag:o}]}),i(!0)})},isDiff:function(e){let t=e.valuesRight;if(!t.length)return!0;if(e.valueLeft||t.some(e=>e))for(let i=0;i<t.length;i++)if(e.valueLeft!=t[i])return!0;return!1},filterOutNoDiff:function(e){let t=[];for(let i=0;i<e.length;i++){let n=e[i];this.isDiff(n)&&t.push(n)}return t},filterOutPropertiesToHide:function(e){var t=[];for(let i=0;i<this.compareResult.length;i++){let n=this.compareResult[i];-1==e.indexOf(n.name)&&(this.isTitleAttr(n)?t.unshift(n):t.push(n))}var i=t.findIndex(e=>"thumbnailimage"===e.name);if(-1!=i&&0!=i){t.unshift(t[i]);var n=i+1;t.splice(n,1)}return t},getAttributeDisplayOptions:function(){let e=l.get(this.generateId("attributes_not_shown"));this.defaultAttrs=l.get(this.generateId("default_attributes"));try{this.propsToHide=t.decode(e)}catch(t){e.constructor===String&&(this.propsToHide="__showall__"===e?[]:""===e?["__showDefault__"]:e.split(","))}},getPropsToHide:function(e){return null!=this.propsToHide&&this.propsToHide.length?1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]?e.reduce((e,t)=>(-1===this.defaultAttrs.indexOf(t.name)&&!this.isTitleAttr(t)&&e.push(t.name),e),[]):[...this.propsToHide]:[]},showDefaultPropsOnly:function(){return 1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]},showAllProps:function(){return 0===this.propsToHide.length},savePropsDisplayOptions:function(e){this.propsToHide=e,this.saveAttributeSettings()},update:function(){var e=this;if(Array.isArray(e.compareResult))if(this.compareTwo=e.compareResult.length&&1===e.compareResult[0].valuesRight.length,null==this.currentDisplayMode||""===this.currentDisplayMode)e.onResize();else{e.getAttributeDisplayOptions();var t=e.filterOutPropertiesToHide(e.getPropsToHide(e.compareResult));e.showDiffOnly&&(t=e.filterOutNoDiff(t)),e.clearView(),e.buildDataGridView(t,this.currentDisplayMode),e.elements.dataGridView.inject(e.dataGridViewContainer)}return!0},clearView:function(){null!=this.elements.dataGridView&&(this.clear(this.elements.dataGridView),this.dataGridViewContainer.empty())},clear:function(e){var t=this;null!=e&&(t.toClear.push(e),setTimeout(function(){for(var e=t.toClear.length,i=0;i<e;i++)try{null!=t.toClear[i]&&(t.toClear[i].destroy(),t.toClear[i]=null)}catch(e){t._plugSvcs.errout("Exception while clearing panels: '"+e+", continuing...")}t.toClear=[]},0))},createColumnOptions:function(e){var t=this,i={width:"auto",onCellRequest:function(e){t.onCellRequest(e,this)}};for(var n in e)i[n]=e[n];return i},buildViewModel:function(e){let t=this,i=[],n=e.length>0?e[0].valuesRight.length:0;for(let r=0,o=e.length;r<o;r++){let o=e[r],s={title:o.displayName,left:{value:o.valueLeft,COLOR:1===n&&!0===o.highlightRight[0]?t._colorLeft:""},right:o.valuesRight.map((e,i)=>({value:e,COLOR:1===n&&!0===o.highlightRight[0]?t._colorRight:"",highlightRightText:n>1&&!0===o.highlightRight[i]})),data:{isThumbnail:"thumbnailimage"===o.name}};n>0&&0===o.valuesRight.length&&(s.left.COLOR=t._colorLeft,s.right.push({COLOR:t._colorRight})),i.push(s)}return i},buildDataGridView:function(t,i){let n=this,a=t.length>0?t[0].valuesRight.length:0,l=n.buildViewModel(t),u=new r,c=void 0;switch(i){case"threeColumn":for(let t=0,i=l.length;t<i;t++){let i=l[t],n={label:i.title,grid:{left:i.left.value,COLOR_LEFT:i.left.COLOR},data:e.extend(i.data,{family:t,titleColumnID:0})};for(let e=0;e<a;e++)n.grid["right_"+e.toString()]=i.right[e].value,1===a?n.grid.COLOR_RIGHT=i.right[0].COLOR:a>1&&(n.grid["highlightRightText_"+e.toString()]=i.right[e].highlightRightText);u.addChild(new o(n))}c=[this.createColumnOptions({dataIndex:"tree"}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(var h=0;h<a;h++)c.push(this.createColumnOptions({dataIndex:"right_"+h,typeRepresentation:"textBlock",autoRowHeightFlag:!0}));c.forEach(e=>e.getCellClassName=this._getCellClassName);break;case"twoColumn":for(let t=0,i=l.length;t<i;t++){let i=l[t];u.addChild(new o({grid:{left:i.title,COLOR_LEFT:"",COLOR_RIGHT:""},data:{family:t,titleColumnID:1===a?2:0}}));let n={grid:{left:i.left.value,COLOR_LEFT:i.left.COLOR},data:e.extend(i.data,{family:t})};e.extend(n.grid,i.right.reduce((e,t,r)=>(e["right_"+r.toString()]=t.value,1===a?e.COLOR_RIGHT=i.right[0].COLOR:a>1&&(n.grid["highlightRightText_"+r.toString()]=i.right[r].highlightRightText),e),{})),u.addChild(new o(n))}c=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(h=0;h<a;h++){var _={dataIndex:"right_"+h,typeRepresentation:"textBlock",autoRowHeightFlag:!0};c.push(this.createColumnOptions(_))}c.forEach(e=>e.getCellClassName=this._getCellClassName);break;case"oneColumn":for(let t=0,i=l.length;t<i;t++){let i=l[t];u.addChild(new o({grid:{left:i.title,COLOR:""},data:{family:t,titleColumnID:1===a?2:0}})),u.addChild(new o({grid:{left:i.left.value,COLOR:i.left.COLOR},data:e.extend(i.data,{family:t})})),a>0&&i.left.COLOR!==i.right[0].COLOR&&u.addChild(new o({grid:{left:i.right[0].value,COLOR:i.right[0].COLOR},data:e.extend(i.data,{family:t})}))}(c=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0})]).forEach(e=>e.getCellClassName=this._getCellClassName)}var f=e.createElement("span",{class:"attr-table-no-diffs-found",html:p.NO_DIFFERENCES_FOUND});this.elements.dataGridView=new s({identifier:"ComparePropertyView",treeDocument:u,columns:c,rowSelection:"single",cellSelection:"none",columnSelection:"none",defaultColumnDef:{minWidth:8.5},placeholder:f,getCellTooltip:function(e){var t=e.cellModel;return{title:("#ff8a2e"===t?d.mainToolbarLeftObjectString:"#009ddb"===t?d.mainToolbarRightObjectString:"")||"",updateModel:!1}}}),this.elements.dataGridView.registerReusableCellContent({id:"renderThumbnail",buildContent:function(){return new e.Element("img").inject(new e.Element("div",{class:"thumbnail-div"}))}}),this.elements.dataGridView.showCellActivationFlag=!1,this.elements.dataGridView.layout.columnsHeader=!1,this.elements.dataGridView.layout.rowsHeader=!1,this.elements.dataGridView.layout.useLastColumnWidthAutoFlag=!0,this.elements.dataGridView.layout.getRowHeightFunction=function(e){let t=n.elements.dataGridView.layout.getRowHeightFromCellContents(e);return!0===u.getNthRoot(e).options.data.isThumbnail?75:t}},_getCellClassName:function(e){var t;t=e.nodeModel.options.data.family%2==0?"compareGreyRow":e.nodeModel.options.grid.family%2==0?"compareGreyRow":"compareWhiteRow";var i=e.nodeModel.options.data.titleColumnID;return null!=i&&e.columnID===i&&(t+=" compare-attr-title-cell"),t},onCellRequest:function(e,t){t.defaultOnCellRequest(e),!0===e.nodeModel.options.data.isThumbnail&&null!=e.cellModel&&(e.cellModel.indexOf("http://")>=0||e.cellModel.indexOf("https://")>=0||e.cellModel.indexOf("data:image")>=0)?this.renderThumbnail(e,t):this.renderCellTextColor(e,this.currentDisplayMode,t)},renderThumbnail:function(e,t){let i=t.reuseCellContent("renderThumbnail");i.setAttribute("src",e.cellModel),e.cellView.setReusableContent(i.getParent())},renderCellTextColor:function(e,t,i){if(!this.compareTwo&&"oneColumn"!==t){let t=i.getColumnOrGroup(e.columnID);t.dataIndex.indexOf("right_")>=0&&!0===e.nodeModel.options.grid["highlightRightText_"+t.dataIndex.split("_")[1]]?e.cellView.elements.container.style.color="red":e.cellView.elements.container.style.color=""}},customizeRows:function(){new n(this,function(){this.update()}.bind(this))},saveAttributeSettings:function(){l.set(this.generateId("attributes_not_shown"),t.encode(this.propsToHide))},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],n=>{var r=t.getBoundingClientRect(),o={position:{x:r.right,y:r.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,o)})},handleToolbarCommands:function(e){switch(e.event){case"displayView":this._displayMode!==e.data.mode&&("singleColDisplay"===e.data.mode?this.singleColView=!0:this.singleColView=!1,this.update(),this.standardToolbar.update({displayIcon:[{id:"attrViewSelector",icon:e.data.icon}]}),this._displayMode=e.data.mode)}},onResize:function(){setTimeout(()=>{let e=this.elements&&this.elements.container?this.elements.container.getBoundingClientRect().width:0;if(e<100)return;let t="";t=e>640?"threeColumn":e>=320&&e<=640?"twoColumn":"boolean"==typeof this.compareTwo?!0===this.compareTwo?"oneColumn":"twoColumn":"",this.currentDisplayMode!==t&&(this.currentDisplayMode=t,this.update())},0)},onActivate:function(){this.onResize()}})}),define("DS/CompareWidget2/support/attrNLS_mgr",["DS/CompareWidget2/support/cw2CacheMgr","DS/CompareCommon/Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2Utils","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,r){function o(e,t){e.forEach(function(e){t.putEntry(e.uri,e.nlsName)})}return{getObjAttrCache:function(t,r,s,a){return new Promise(function(l,u){let c=t+"."+s+"."+a,d=e.getCache(c,!0);if(0==d.getSize()){let e=[t];null!=r&&r.length>0?e=r:"VPMReference"===t&&(e=["ds6wg:VPMReference","ds6wg:VPMRepReference","ds6wg:EnterpriseExtension","ds6wg:VPMInstance","ds6wg:VPMRepInstance"]);let u=e.join("\n");i.makeAuthHttpsCall("/resources/6WVocab/access/Predicates","POST",u,"json",s,"3DSpace",a,!0,!0).then(function(e){for(var t of e.classPredicates){o(t.vocabularyPredicateInfo,d)}l(d)},function(e){n.errout("failed getting predicates... can't lookup NLS for attrs... continuing"),l(d)})}else l(d)})},getAttrNLS:function(e,i,n,o,s){let a={},l=JSON.parse(JSON.stringify(e));return this.getObjAttrCache(i,n,o,s).then(function(e){let i=e;return Object.keys(l).forEach(function(e){let n=l[e],o=function(e){let t=e,i=["REF.","INST."].find(function(t){return e.startsWith(t)});if(null!=i){let n=i.length;t=e.substring(n)}return t}(n),s=i.getEntry(o);null==s&&(s="_#_DELETED_#_",t.showAlertBox(r.get("CUSTOM_ATTRIBUTE_DELETED").replace("{msgData}",o),null,"warning")),a[n]=s}),a})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview",["UWA/Controls/Abstract","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){function i(e,i,r,o,s,a){for(var l=s,u=o-r,c=0,d=[],p=0;p<i.length;p++){null==a[i[p].flagName]?console.error("ASKING FOR FLAG NAME: "+i[p].flagName+" but is unfound in allflagDefs"):1==a[i[p].flagName].visibleFlag&&(c++,d.push(p))}for(var h=u/c,_=0;_<c;_++){var f=r+_*h,g=f+h,m=i[d[_]].color;null==a||null==a[i[d[_]].flagName]||a[i[d[_]].flagName].visibleFlag||(m=null!=a.IDENTICAL?a.IDENTICAL.color:""),""!==m&&m!=t.colorDef.WHITE&&n(e,m,f,g,l)}}function n(e,t,i,n,r){e.strokeStyle=t,e.beginPath(),e.moveTo(i,r),e.lineTo(n,r),e.stroke()}function r(e,t){let i=null;if(null==this._structComparePanelRight){i="div#compare-"+(t?"list":"tree")+"-right"}else i="div#"+this._structComparePanelRight;let n=""!==jQuery(i+" div.compare_tree_list_view div.wux-layouts-header").first().attr("empty");e.setStyle("top",n?"118px":"92px");let r="true"===jQuery(i+" div.compare_tree_list_view div.wux-layouts-gridengine-scroller-container").first().attr("has-overflow-x");e.setStyle("bottom",r?"36px":"17px")}return e.extend({init:function(e){var t=this;t._parent(e),t._structComparePanelRight=null!=e?e.structComparePanelRight:null,t._canvasID="compareV2-OverviewCanvas",t._containerID="compareV2-overview-container",null!=e&&null!=e.viewID&&(t._canvasID+="_"+e.viewID,t._containerID+="_"+e.viewID),t._gap=5,t._lineLength=23,t._selectedByID={},t._keyList=[],t._allFlagDefs={},t.buildSkeleton()},drawAllLines:function(){var e=this;if(null==e._keyList);else{var r=e._keyList.length,o=10+e._lineLength-12,s=Math.floor(1+.5*e._gap),a=10+e._lineLength-6,l=document.getElementById(e._canvasID);if(null==l)return;var u=l.getContext("2d");u.clearRect(0,0,l.width,l.height),u.lineWidth=l.height/3>r?2:1;for(var c=0;c<r;c++){var d=e._keyList[c].flagDefArray;1==e._selectedByID[c]?(u.lineWidth++,1!=d.length||""!=d[0].color&&d[0].color!=t.colorDef.WHITE?i(u,d,1,a,s,e._allFlagDefs):n(u,t.colorDef.BLACK,1,a,s),u.lineWidth--):i(u,d,10,o,s,e._allFlagDefs),s+=e._gap}}},doResize:function(){var e=this;let t=null;if(null==this._structComparePanelRight){t="compare-"+(this._isListView?"list":"tree")+"-right"}else t=this._structComparePanelRight;if(null!=jQuery("div#"+t)[0]){var i=jQuery("div#"+this._containerID)[0];r.call(e,i,e._isListView);var n=i.clientHeight,o=i.clientWidth,s=jQuery("#"+e._canvasID)[0];null!=s&&(s.width=o,s.height=n,0==e._keyList.length||(e._gap=(n-2)/e._keyList.length))}},buildSkeleton:function(){var e=this;e.targetElement=this.elements.container=UWA.createElement("div",{id:e._containerID,class:"compareV2-overview-container"}),r.call(e,e.targetElement,this._isListView),e.rootElement=UWA.createElement("div",{id:"compareV2-overview-toplevel",html:[{tag:"div",id:"compareV2-overview",html:[{tag:"div",id:"compareV2-canvas-buffer",html:[{tag:"canvas",id:e._canvasID,class:"compareV2-OverviewCanvas"}]}]}]}),e.rootElement.inject(e.targetElement),jQuery(document).ready(function(){var t=null,i=!1,n=300;function r(){new Date-t<n?setTimeout(r,n):(i=!1,"none"!==jQuery("#"+e._containerID).css("display")&&e._syncIt(!0))}jQuery(window).resize(function(){t=new Date,!1===i&&(i=!0,setTimeout(r,n))})})},onResize:function(){var e=this;setTimeout(function(){e._syncIt(!0)},0)},destroy:function(e){this.rootElement&&(this.rootElement.destroy(),this.rootElement=null),this._selectedByID=null,this._keyList=null,this._allFlagDefs=null},_createSelectedByID:function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},_syncIt:function(e){1==e&&this.doResize(),this.drawAllLines()},syncWithNewData:function(e,t,i,n,r){this._keyList=t,this._allFlagDefs=n,this._selectedByID=this._createSelectedByID(i),this._isListView=r,this._syncIt(e)}})}),define("DS/CompareWidget2/plugins/DATA/attrValObj",["DS/CompareWidget2/support/cw2Utils"],function(e){function t(e){var t=void 0!==e.selectable?e.selectable:e.name;return"timestamp"===e.type||"modified"===t||"originated"===t||-1!==t.indexOf("ds6w:created")||-1!==t.indexOf("ds6w:modified")}var i=function(e,t,i,n,r){this.name=e,this.nls=t,this.value=i,this.type=n,this.UIPosition=r,this._reqModforODT="DS/CompareWidget2/plugins/DATA/attrValObj"};return i.prototype.getFormattedValue=function(){var i=this,n="";if(null!=i.value){if(i.value.constructor==Array)if(i.value.length>1)for(var r=0;r<i.value.length;++r){n+=t(i)&&!widget._isODTMode()?e.formatDate(i.value[r]):i.value[r],r!==i.value.length-1&&(n+=", ")}else n=t(i)&&!widget._isODTMode()?e.formatDate(i.value[0]):i.value[0];else n=t(i)&&!widget._isODTMode()?e.formatDate(i.value):i.value;var o=i.dimension;null!=o&&(n+=" "+o)}return n},i}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/instanceAttrComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.CompareInstancePanelTitle},getName:function(){return"INSTANCE_VIEW"},getDomId:function(){return"instattr"},isTitleAttr:function(e){return t.isTitleAttr(e,!0)}})}),define("DS/CompareWidget2/userSettings/PLMReference",["UWA/Core","DS/CompareWidget2/userSettings/SettingsBase","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";return e.extend(t,{namespace:"",compareSettings:{dataSource:{useIndex:{value:!0,V1Preference:"useIndex",widgetSetting:{type:"boolean",label:i.useIndex,defaultValue:!0}}},includeFacets:{externalRelations:{showDocs:{value:!1,V1Preference:"showDocs"},showOtherRels:{value:!1,V1Preference:"showOtherRels"}}}},viewSettings:{INSTANCE_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option_INST"},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown_INST"}}),EFFECTIVITY_VIEW:{attributes_display_option:{value:""},default_attributes:{value:["Effectivity","VariantOption","CurrentEvolution","ProjectedEvolution"]},attributes_always_shown:{value:""},attributes_not_shown:{value:""}}}},!0)}),define("DS/CompareWidget2/userSettings/VPMReference",["UWA/Core","DS/CompareWidget2/userSettings/PLMReference","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";return e.extend(t,{namespace:"",viewSettings:{PAD3D_VIEW:{view3D:{isolate:{value:!0,V1Preference:{viewer_display_mode:[{oldValue:"isolate",newValue:!0},{oldValue:"select",newValue:!1}]},widgetSetting:{type:"boolean",label:i.viewerIsolate,defaultValue:!1}}}}}},!0)}),define("DS/CompareWidget2/widget/inputFrame",["UWA/Controls/Abstract","DS/CompareCommon/Input/CompareInput","DS/CompareWidget2/support/objIDSpec"],function(e,t,i){return e.extend({init:function(e,i,n){this._parent({}),this._eventMgr=e,this.elements.container=UWA.createElement("div",{id:"initial-drop",styles:{height:"100%"}}),this.compareInput=new t(i,n);var r=this;this._eventTokens=[],this._eventTokens.push(this._eventMgr.subscribe({event:"Event_controlCustomizationDone"},this._handler_controlCenterDone.bind(this))),setTimeout(function(){r.compareInput.doInput(r.elements.container,i,r.onInputsReady.bind(r),r.onShowControlCenter.bind(r))})},onShowControlCenter:function(){this._eventMgr.publish({event:"Event_showControlCenter"})},_handler_controlCenterDone:function(e){!0===e.status&&this.compareInput.updateComparisonProfileDropdownUI()},onInputsReady:function(e){let t=[];for(let s of e.idDataList.items){var n=s.objectServices,r=null;void 0!==s.filterData&&null!==s.filterData?r=s.filterData:void 0!==s.queryDef&&null!==s.queryDef&&(r=s.queryDef);var o=new i(n.objectId,n.objectType,n.contextId,n.envId,n.serviceId,r,n.idType,n.commands,s.supportsRevisions,s.supportsFilters,e&&e.validateObj_stateData&&e.validateObj_stateData[n.objectId]&&e.validateObj_stateData[n.objectId].interfaces);t.push(o)}this._eventMgr.publish({event:"Event_inputUpdate",data:t})},clearPersistedInputs:function(){this.compareInput.clearItem("all")},applyNGFilter:function(e,t){this.compareInput.onApplyNGFilter(e,t)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/support/attrNLS_mgr"],function(e,t,i,n,r){return e.extend({init:function(e,t){let i=this;this._parent(e,t),this._systemPropNLS={};let n=e.DISPLAY_PROPS||{};this._DISPLAY_PROPS={fixed:n.fixed||[],scrollable:n.scrollable||[]},this._customPropNLS={},this._CUSTOM_PROPS=e.CUSTOM_PROPS||{},Object.keys(this._CUSTOM_PROPS).forEach(function(e){let t=i._CUSTOM_PROPS[e],n=t.NAME,r=t.NLS_RESOLVED||t.NAME;i._customPropNLS[n]=r})},createTreeNodeModel:function(e,t){let i=this,n=e.isDummy()?1:1==e._riNode.getAttr("REF.hideNode")?0:1,r={data:e,label:e.getAttr("title"),icons:[e.getAttr("typeIconSmallURL")],NLS_RESOLVED:{},grid:{rev:e.getAttr("revision"),type:e.getAttr("type"),showByStatusFilter:1,showByTypeAttrFilter:n}},o=e.getRefInstNode();if(null!=o){let e=this._DISPLAY_PROPS;e.fixed.forEach(function(e){var t=o.getAttr(e)||"",n=i._customPropNLS[e];null==n?r.grid[e]=t:(r.grid["synthProp_"+e]=t,r.NLS_RESOLVED["synthProp_"+e]=n)}),e.scrollable.forEach(function(e){var t=o.getAttr(e)||"",n=i._customPropNLS[e];null==n?r.grid[e]=t:(r.grid["synthProp_"+e]=t,r.NLS_RESOLVED["synthProp_"+e]=n)})}return"relations"!==e.getAttr("type")&&(r.grid.qty=e.qty),e.hasExternalFilter()&&(r.badges={bottomRight:"filter wux-layouts-treeview-badge compare-badge"}),e.getMatchInfo().getAllStatusArray(!0).forEach(function(e,i){var n=t.getFlagDisplayDataItem(e);r.grid["FLAG_"+i]=n.color}),r},getColDefs:function(e,t,i){let n=this;return new Promise(function(r,o){n._lookupSystemPropNLS(e).then(function(e){let o=n._getColDefs_NLS_loaded(t,i);r(o)},function(e){o("FAILED to getColDef:: "+e)})})},_getColDefs_NLS_loaded:function(e,t){let i=[],n=this;for(let a=0;a<2;a++){let l=[],u=0==a?n._baselineColor:n._compareColor,c={text:n._systemPropNLS["REF.ds6w:label"],icon:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"tree",typeRepresentation:"string",width:"auto",resizableFlag:!1,minWidth:200,pinned:"left",sortableFlag:!1,resizableFlag:!0,getCellKPIColor:function(e){let t=null;return this._flagPropDiff("title",e)&&(t=u),t}.bind(this),onCellRequest:function(t){return e(a,t)}};l.push(c);var r=this._DISPLAY_PROPS,o=r.scrollable.length>0;if(r.fixed.forEach(function(e){let t=n._createColSpec(u,e);o&&(t.pinned="left"),l.push(t)}),r.scrollable.forEach(function(e){let t=n._createColSpec(u,e);l.push(t)}),a>0){var s=this._getColorColumnsDef(t);l=s.concat(l)}i.push(l)}return i},_lookupSystemPropNLS:function(e){let t=this,i=[];return this._DISPLAY_PROPS.fixed.forEach(function(e){null==t._customPropNLS[e]&&i.push(e)}),this._DISPLAY_PROPS.scrollable.forEach(function(e){null==t._customPropNLS[e]&&i.push(e)}),null==t._customPropNLS["REF.ds6w:label"]&&i.push("REF.ds6w:label"),new Promise(function(n,o){if(0==i.length)n(t._customPropNLS);else{let o=e.getObjType(),s=e.getSecurityContext(),a=e.getTenant();r.getAttrNLS(i,o,[],a,s).then(function(e){t._systemPropNLS=e,n()},function(e){console.error("Failed to perform NLS lookup: "+e),i.forEach(function(e){t._systemPropNLS[e]=e}),n()})}})},_specializeCol:function(e,t){switch(e){case"REF_ds6w:status_ATTR":delete(t=UWA.extend(t,{typeRepresentation:"tag",width:90,hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return e.nodeModel.options.data.getAttr("maturity.class")}})).getCellKPIColor;break;case"REF_ds6wg:revision_ATTR":t=UWA.extend(t,{width:80})}return t},_flagPropDiff:function(e,t){let i=!1,n=t.nodeModel.options.data,r=n.getMatchInfo();return r.getBaseNode().isDummy()||r.getCompNode().isDummy()||r.isAttributeValueEqual(e)||null==n.getAttr(e)||""===n.getAttr(e)||(i=!0),i},_createColSpec:function(e,t){let i=t.startsWith("REF")?"product":"flow-cascade",n=t,r=this._systemPropNLS[t];null==r&&(r=this._customPropNLS[t],n="synthProp_"+n);var o={text:r,icon:{iconName:i,fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:n,width:150,minWidth:25,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0,getCellKPIColor:function(i){let n=null;return this._flagPropDiff(t,i)&&(n=e),n}.bind(this)};return o=this._specializeCol(t,o)},_getColorColumnsDef:function(e){for(var t=[],i=e.getMaxFlagsPerEntry(),n=0;n<i;n++){let i="FLAG_"+n.toString();var r=this,o={typeRepresentation:"color",dataIndex:i,width:8.5,minWidth:8.5,pinned:"left",resizableFlag:!1,sortableFlag:!1,hasCellValue:function(t){return r._hasCellValue(t,e,i)},getCellTooltip:function(t){return r._getFlagTooltip(t,e)},onCellRequest:this._onCellRequest};t.push(o)}return t},_hasCellValue:function(e,t,i){var r=!1;if(i.startsWith("FLAG_")){var o=Number(i.split("_")[1]),s=e.nodeModel.options.data,a=s.areAnyChildrenVisible(),l=s.getMatchInfo().getAllStatusArray(!a);if(Array.isArray(l)&&o<l.length){var u=l[o],c=t.getFlagDisplayDataItem(u);if(null!=c){var d=c.color,p=c.visibleFlag;null!=d&&d!==n.colorDef.WHITE&&1==p&&(r=!0)}}}return r},_getFlagTooltip:function(e,n){var r=[],o=null==e.nodeModel?null:e.nodeModel.options.data.getMatchInfo();o&&(r=o.getAllStatusArray(!0));var s,a=Number(e.columnID);if(Array.isArray(r)&&a<r.length&&r.length>0){var l=r[a],u=n.getFlagDisplayDataItem(l);if(null!=u.color&&u.visibleFlag){var c=u.label,d=u.modulePath;Object.entries(i).map(([e,i])=>{i===c&&(s=t.generateTooltip(d,e))})}}return s},_onCellRequest:function(e){this.defaultOnCellRequest(e),e.cellView.getContent().addClassName("compare-color-column")}})}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_list",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree","DS/CompareCommon/Utils"],function(e){return e.extend({init:function(e,t){this._parent(e,t)},createTreeNodeModel:function(e,t){return this._parent(e,t)},getColDefs:function(e,t,i){return this._parent(e,t,i)}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(e,t,i){this.visible=e,this.displayName=null==t||""===t?i:t,this.name=i,this.valueLeft="",this.valuesRight=[],this.highlightRight=[],this._reqModforODT="DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj"};return t.prototype.setLeftVal=function(e){this.valueLeft=e},t.prototype.setRightVal=function(e,t){this.valuesRight[e]=t},t.prototype.setRightValHighlight=function(e,t){this.highlightRight[e]=t},t}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj","DS/CompareCommon/Utils"],function(e,t,i){return e.extend({execute:function(e,i){this._parent(e,i);var n=function(e){var i={},n=[],r=[],o=[],s=[],a=[],l=[];if(e.length>0)for(var u=0;u<e.length;u++)l.push(e[u].objType);if(l.every((e,t,i)=>e===i[0])){e.forEach((e,t)=>{e.attrVals.forEach((e,a)=>{var l=e.name,u=e.nls,c=e.getFormattedValue();null!=c&&c.constructor==Array&&1==c.length&&(c=c[0]),null==i[l]&&(i[l]=[]),i[l][t]=c,isNaN(e.UIPosition)?o.includes(l)||(o.push(l),s.push(u)):(n[e.UIPosition]=l,r[e.UIPosition]=u)})}),n.push(...o),r.push(...s);for(var c=[],d=n.length,p=0;p<d;p++){var h=n[p],_=r[p];if(null!=h){var f=new t(!0,_,h);c.push(f);var g=(C=i[h])[0];f.setLeftVal(g);for(var m=C.length,S=1;S<m;S++){var T=C[S];this._plugSvcs.csValsEquivalent(g,T)?(f.setRightVal(S-1,g),f.setRightValHighlight(S-1,!1)):(f.setRightVal(S-1,T),f.setRightValHighlight(S-1,!0))}}}return c}for(e.forEach((e,t)=>{if(null!=e.attrVals&&null!=e.attrVals)for(var n=0;n<e.attrVals.length;++n){var r=e.attrVals[n].nls||e.attrVals[n].name;if(null==i[r]&&(i[r]=[],t>0))for(var o=0;o<t;o++)i[r][o]=null;null!=e.attrVals[n].value?i[r][t]=e.attrVals[n].getFormattedValue():i[r][t]=null,-1===a.findIndex(e=>e.attrKey===r)&&a.push({attrNLS:e.attrVals[n].nls||e.attrVals[n].displayName,attrType:e.attrVals[n].type,attrKey:r,attrName:e.attrVals[n].name})}}),c=[],d=a.length,p=0;p<d;p++)if(h=a[p].attrName,_=a[p].attrNLS,null!=h){f=new t(!0,_,h),c.push(f);var C=i[_];for(u=0;u<e.length;u++)void 0!==C[u]&&""!==C[u]||(C[u]=null);for(g=C[0],f.setLeftVal(g),m=C.length,S=1;S<m;S++)T=C[S],this._plugSvcs.csValsEquivalent(g,T)?(f.setRightVal(S-1,g),f.setRightValHighlight(S-1,!1)):(f.setRightVal(S-1,T),f.setRightValHighlight(S-1,!0))}return c}.call(this,e);null!=n?this.reportOK(n):this.reportKO()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/statusBubbler",["UWA/Class","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/support/typeHierMgr"],function(e,t,i){var n=e.extend({init:function(e){this._parent({}),this._plugSvcs=e},doBubble:function(e,t){var i=this;return!0===t.BUBBLE_UP_ENABLED&&i.setup_bubbleUpStatus_lut(t.BUBBLE_STATUS_CONFIG),e.forEach(function(e){i.bubbleTree(e,t)}),e}});return n.prototype.bubbleTree=function(e,t){for(var i=e.getMatchPairArray(),n=i.length,r=!1,o=1;o<n;o++){var s=i[o];if(1!=s.DELETED){if(!0===t.BUBBLE_UP_ENABLED){var a=this.computeBubbleUpsForMatchPair(s);0!=a&&(r|=this.bubbleUp(s,a))}!0===t.BUBBLE_DOWN_ENABLED&&this.isBubbleDownTarget(s)&&(r|=this.bubbleDown(s))}}r&&e.reNice()},n.prototype.setup_bubbleUpStatus_lut=function(e){var t=this;t._bubbleAction_LUT={},t._conditionTable={PARENT:{ON_STATUS:{vals:{},baUsed:0,baUnused:0},TYPE:{vals:{},baUsed:0,baUnused:0},ATTRIBUTES:{nameVals:{},baUsed:0,baUnused:0}},CHILD:{ON_STATUS:{vals:{},baUsed:0,baUnused:0},TYPE:{vals:{},baUsed:0,baUnused:0},ATTRIBUTES:{nameVals:{},baUsed:0,baUnused:0}}};var i=0;e.forEach(function(e,n){i=Math.pow(2,n),t._bubbleAction_LUT[i]={BUBBLED_STATUS:e.BUBBLE_STATUS,BUBBLE_TO:e.BUBBLE_TO},e.CONDITIONS.CHILD&&t.addConditionEntries(i,e.CONDITIONS.CHILD,t._conditionTable.CHILD),e.CONDITIONS.PARENT&&t.addConditionEntries(i,e.CONDITIONS.PARENT,t._conditionTable.PARENT)});var n=2*i-1;t._conditionTable.CHILD.ON_STATUS.baUnused=n&~t._conditionTable.CHILD.ON_STATUS.baUsed,t._conditionTable.CHILD.TYPE.baUnused=n&~t._conditionTable.CHILD.TYPE.baUsed,t._conditionTable.CHILD.ATTRIBUTES.baUnused=n&~t._conditionTable.CHILD.ATTRIBUTES.baUsed,t._conditionTable.PARENT.ON_STATUS.baUnused=n&~t._conditionTable.PARENT.ON_STATUS.baUsed,t._conditionTable.PARENT.TYPE.baUnused=n&~t._conditionTable.PARENT.TYPE.baUsed,t._conditionTable.PARENT.ATTRIBUTES.baUnused=n&~t._conditionTable.PARENT.ATTRIBUTES.baUsed,t._allBubblesAvail_bitmask=Math.pow(2,Object.keys(t._bubbleAction_LUT).length)-1},n.prototype.addConditionEntries=function(e,t,i){(t.ON_STATUS&&(t.ON_STATUS.forEach(function(t){null==i.ON_STATUS.vals[t]&&(i.ON_STATUS.vals[t]=0),i.ON_STATUS.vals[t]|=e}),i.ON_STATUS.baUsed|=e),t.TYPE&&(t.TYPE.forEach(function(t){null==i.TYPE.vals[t]&&(i.TYPE.vals[t]=0),i.TYPE.vals[t]|=e}),i.TYPE.baUsed|=e),t.ATTRIBUTES)&&(Object.keys(t.ATTRIBUTES).forEach(function(n){var r=t.ATTRIBUTES[n];null==i.ATTRIBUTES.nameVals[n]&&(i.ATTRIBUTES.nameVals[n]={}),null==i.ATTRIBUTES.nameVals[n][r]&&(i.ATTRIBUTES.nameVals[n][r]=0),i.ATTRIBUTES.nameVals[n][r]|=e}),i.ATTRIBUTES.baUsed|=e)},n.prototype.computeBitmaskForTypeOf=function(e,t){var n=0;return Object.keys(t.vals).forEach(function(r){i.isKindOf(e,r)&&(n|=t.vals[r])}),n|=t.baUnused},n.prototype.computeBitmaskForMPStatus=function(e,t){var i=0;return e.getAllStatusArray(!0).forEach(function(e){var n=t.vals[e];i|=n}),i|=t.baUnused},n.prototype.computeBitmaskForAttributes=function(e,t){var i=0;return Object.keys(t.nameVals).forEach(function(n){var r=e.getAttr(n);if(null!=r){var o=t.nameVals[n];Object.keys(o).forEach(function(e){r!=e||(i|=t.nameVals[n][e])})}}),i|=t.baUnused},n.prototype.computeBubbleUpsFor_crNode=function(e,t){var i=this._allBubblesAvail_bitmask,n=e.getMatchInfo();if(0==(i&=this.computeBitmaskForMPStatus(n,t.ON_STATUS)))return 0;var r=e.getType();return 0==(i&=this.computeBitmaskForTypeOf(r,t.TYPE))?0:i&=this.computeBitmaskForAttributes(e,t.ATTRIBUTES)},n.prototype.computeBubbleUpsForMatchPair=function(e){var t=this._allBubblesAvail_bitmask,i="LEFT_ONLY"==e.getRelName()?e.getBaseNode():e.getCompNode(),n=i.getParent();0!=(t&=this.computeBubbleUpsFor_crNode(i,this._conditionTable.CHILD))&&(t&=this.computeBubbleUpsFor_crNode(n,this._conditionTable.PARENT));return t},n.prototype.bubbleUp=function(e,t){var i=!1,n=1;do{if(t&n){var r=this._bubbleAction_LUT[n];i|=this.bubbleUp_byBubbleRule(e,r)}n<<=1}while(n<=t);return i},n.prototype.bubbleUp_byBubbleRule=function(e,t){for(var n=e.getBaseNode(),r=n.getParent(),o=t.BUBBLE_TO,s="FVP"==t.BUBBLE_TO?"FVP0":"STATIC",a=null!=r,l=!isNaN(parseInt(o)),u=l?parseInt(o):null,c=null!=u,d=!1,p="root"!=o&&"FVP"!=o&&0==l?o:null;a;){r=(n=r).getParent();var h=n.getMatchInfo();if(null!=h){d|=!0;var _=!1;"FVP0"==s?s="FVP1":"FVP1"==s&&(_=!0),h.addBubbledStatus(t.BUBBLED_STATUS,_)}if(null==r)a=!1;else if(c)a=--u>0;else if(null!=p){var f=h.getBaseNode().getType(),g=h.getCompNode().getType();a=!(i.isKindOf(f,p)||i.isKindOf(g,p))}}return d},n.prototype.isBubbleDownTarget=function(e){var t=!1;if(null!=e.hasStatus("REPLACED")){var i=e.getBaseNode();if("VPMReference"==i.getAttr("type"))"3DPart"==i.getRefInstNode().getAttr("REF.bo.plmentity.v_usage")&&(t=!0)}return t},n.prototype.findChild3DShape=function(e){for(var t=null,n=e.getChildArray(),r=n.length,o=0;o<r;o++){var s=n[o],a=s.getAttr("type");if(i.isKindOf(a,"3DShape")){t=s;break}}return t},n.prototype.bubbleDown=function(e){var t=!1,i=e.getBaseNode(),n=e.getCompNode(),r=this.findChild3DShape(i);if(null!=r){var o=this.findChild3DShape(n);if(null!=o){var s=r.getMatchInfo(),a=o.getMatchInfo();if(null==s||null==a)this._plugSvcs.errout("bubbleDown:: Unexpected! matchPair missing! bubbleDown being skipped for node... continuing");else{t=!0;var l=s.getCompNode();s.resetRelName("REPLACED"),s.resetCompNode(o),o.setMatchInfo(s);var u=a.getBaseNode();i.removeChild(u),n.removeChild(l),a.DELETED=!0}}}return t},n}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_BUBBLER_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/statusBubbler"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._bubbler=null},onDestroy:function(){this._bubbler=null},execute:function(e,i){var n=this;if(n._parent(e,i),!0===i.BUBBLE_UP_ENABLED||!0===i.BUBBLE_DOWN_ENABLED){var r=this._plugSvcs.nowMS();let o=e.crTreeArray;null==n._bubbler&&(n._bubbler=new t(this._plugSvcs)),n._bubbler.doBubble(o,i),this._plugSvcs.reportTime(r,"TIME TO BUBBLE")}null!=e?n.reportOK(e):n.reportKO()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"],function(e,t){var i=function(e,t){this._listMatchPairArray=[],this._lut=[],e&&this.build_listMatchedPairArray(e,t),this._lut=[],this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"};return i.prototype.build_listMatchedPairArray=function(e,t){var i=this;e.forEach(function(e){i._addMatchedPair(e,t)}),i._listMatchPairArray.forEach(function(e){var t=e.getRelName();if("LEFT_ONLY"!=t&&"RIGHT_ONLY"!=t){var i=e.getBaseNode(),n=e.getCompNode();e.qtyIsDiffFlag=i.qty!=n.qty}})},i.prototype.getMatchPairArray=function(){return this._listMatchPairArray},i.prototype.generateDisplayLists=function(){var t=[[],[]];return this._listMatchPairArray.forEach(function(i){var n=i.getBaseNode();null==n&&(n=new e);var r=i.getCompNode();null==r&&(r=new e),t[0].push(n),t[1].push(r)}),t},i.prototype._addMatchedPair=function(i,n){var r=i.getRelName();if("UNRELATED"==r||"DIFFERENT"==r){var o=i.getBaseNode(),s=i.getCompNode(),a=new e,l=new e,u=new t("LEFT_ONLY",null,o,l),c=new t("RIGHT_ONLY",null,a,s);this._addListMatchedPair(u,n),this._addListMatchedPair(c,n)}else{var d=i.shallowDupe(),p=d.getAdjFlagArray()||[];(d.getInstFlagNdxs()||[]).forEach(function(e,t){p.splice(e-t,1)}),this._addListMatchedPair(d,n)}},i.prototype._addListMatchedPair=function(e,t){var i=e.getBaseNode(),n=null==i||i.isDummy(),r=n?"":i.getAttr("physicalID_REF"),o=e.getCompNode(),s=null==o||o.isDummy(),a=s?"":o.getAttr("physicalID_REF"),l=r+"."+a,u=this._lut[l],c=!1;if(null!=u){var d=u.getBaseNode(),p=u.getCompNode();0==n&&(null==d.qty||(d.qty.length=0)?d.qty=1:d.qty++),0==s&&(null==p.qty||(p.qty.length=0)?p.qty=1:p.qty++),c=!0}else if(0==n&&0==s){var h=r+".",_=this._lut[h];if(null!=_&&_.getCompNode().isDummy()){_.getBaseNode().qty++,(C=o.shallowDupe()).qty=1,C._matchInfo=_,_._compNode=C,_._relName=e._relName,this._lut[l]=_,this._lut["."+a]=_,c=!0}else{var f="."+a,g=this._lut[f];if(null!=g&&g.getBaseNode().isDummy())g.getCompNode().qty++,(m=i.shallowDupe()).qty=1,m._matchInfo=g,g._baseNode=m,g._relName=e._relName,this._lut[l]=g,this._lut[r+"."]=g,c=!0;else(D=e.shallowDupe()).getBaseNode().qty=1,D.getCompNode().qty=1,this._listMatchPairArray.push(D),this._lut[l]=D,this._lut[r+"."]=D,this._lut["."+a]=D,c=!0}}else if(!t)if(s){var m,S="."+r,T=this._lut[S];if(null!=T)(m=i.shallowDupe()).setMatchInfo(T),m.qty=1,T._baseNode=m,T._relName="IDENTICAL",this._lut[r+"."]=T,this._lut[r+"."+r]=T,c=!0}else if(n){var C,E=a+".",v=this._lut[E];if(null!=v)(C=o.shallowDupe()).setMatchInfo(v),C.qty=1,v._compNode=C,v._relName="IDENTICAL",this._lut["."+a]=v,this._lut[a+"."+a]=v,c=!0}if(0==c){var D=e.shallowDupe();this._lut[l]=D,D.getBaseNode().qty=n?"":1,D.getCompNode().qty=s?"":1,this._listMatchPairArray.push(D)}},i}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"],function(e,t,i,n){function r(e){var i=new t;return i.setParent(e),i}function o(e,t,n){var s=t.getChildArray(),a=n.getChildArray(),l=s.length,u=a.length,c=[],d=[],p=0;for(p=0;p<u;p++)a[p].touched=!1;for(p=0;p<l;p++){let t=s[p],a=null;if(null==t._matchInfo){a=r(n),n.addChild(a);let e=new i("LEFT_ONLY",null,t,a);t._matchInfo=e,a._matchInfo=e}else a=t._matchInfo.getCompNode();c.push(t),d.push(a),a.touched=!0,o(e,t,a)}for(p=0;p<u;p++){let n=a[p];if(0==n.touched&&null==n._matchInfo){let s=r(t);t.addChild(s);let a=new i("RIGHT_ONLY",null,s,n);n._matchInfo=a,s._matchInfo=a,c.push(s),d.push(n),n.touched=!0,o(e,s,n)}else n.touched=!0}t._childArray=c,n._childArray=d}function s(e){var t=[],i=[];i.push(e.getRoot(0));for(var n=!0;i.length>0;){var r=i.pop(),o=r.getMatchInfo(),s=!1;if(n)if(o.getBaseNode().isDummy())o.getCompNode().isDummy()&&(s=!0);0==s&&t.push(o);for(var a=r.getChildArray(),l=a.length-1;l>=0;l--){var u=a[l];i.push(u)}n=!1}return t}function a(e){!function e(t,i,n,r){i[n]=r;var o=i.join(".");var s=t.getMatchInfo();s.setDepth(o);s.setLevel(i.length-1);var a=t.getChildArray();var l=a.length;for(var u=0;u<l;u++){var c=a[u];e(c,i,n+1,u+1)}i.pop()}(e.getRoot(0),[],0,1)}var l=function(){this._rootSet=[],this._matchPairArray=[],this._crList=null,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree"};return l.prototype.niceUp=function(e,t,l){!function(e,t){var n=e.getRoot(0),s=e.getRoot(1),a=!1,l=n.getMatchInfo();if("UNRELATED"!=l.getRelName()&&l.getCompNode()==s&&(a=!0),a||t)o(e,n,s);else{var u=r(null),c=new i("LEFT_ONLY",null,n,u);n.setMatchInfo(c),u.setMatchInfo(c),o(e,n,u),u.addChild(s);var d=r(null);c=new i("RIGHT_ONLY",null,d,s),d.setMatchInfo(c),s.setMatchInfo(c),o(e,d,s),n.addChild(d),e.resetDisplayRoot(1,u)}}(this,e),a(this),this._matchPairArray=s(this),0!=t&&(this._crList=new n(this._matchPairArray,l))},l.prototype.reNice=function(){delete this._matchPairArray,delete this._crList,this._matchPairArray=s(this),this._crList=new n(this._matchPairArray)},l.prototype.getMatchPairArray=function(){return this._matchPairArray},l.prototype.getCRList=function(){return this._crList},l.prototype.getRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_root),t},l.prototype.getRootArray=function(){return this._rootSet},l.prototype.getDisplayRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_displayRoot),t},l.prototype.getRootObjIDSpec=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].root_objIDSpec),t},l.prototype.resetDisplayRoot=function(e,t){null!=this._rootSet[e]&&(this._rootSet[e].CRNode_displayRoot=t)},l.prototype.setRoot=function(e,t,i){this._rootSet[e]={root_objIDSpec:t,CRNode_displayRoot:i,CRNode_root:i}},l.prototype.destroy=function(){for(var e=0;e<this._rootSet.length;e++){var t=this._rootSet[e];null!=t&&(t.root_objIDSpec.destroy(),delete t.root_objIDSpec,t.CRNode_displayRoot.destroy(),delete t.CRNode_displayRoot,delete t.CRNode_root,delete this._rootSet[e])}},l.prototype.sortTreeNodes=function(){for(var e=this._rootSet.length,t=0;t<e;t++)this.visitAll_treeAndFN(t,function(e){e.sortChildren()})},l.prototype.findNodeByIDPath=function(e,t){var i=t.split("/"),n=this.getRoot(e),r=null,o="",s=n.getAttr("physicalID_REF");if(i[0]==n.getAttr("physicalID_REF")){for(var a=1;null!=n&&a<i.length;a+=2){o=i[a],s=i[a+1];n=n.findChildByID(o,s)}r=n}return r},l.prototype.visitVisible_treeAndFN=function(e,t){this.visit_treeAndFN(!0,e,t)},l.prototype.visitAll_treeAndFN=function(e,t){this.visit_treeAndFN(!1,e,t)},l.prototype.visit_treeAndFN=function(t,i,n){var r=!1,o=this.getRoot(i);return null==o?e.errout("'visit_treeAndFN()' called, but tree has no root set"):r=o.visit_nodesAndFN(t,n),r},l}),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",NAME:"REF.name",REVISION:"REF.ds6wg:revision",DERIVEDFROMID:"REF.derivedFromId",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid"},n={CV_PROPS:i},r={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ"]],COMP_DERIVEDFROMID:[["DERIVEDFROMID","DERIVEDFROMID"],["EQ","EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},o={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:r,STRUCT_DISPLAY_OPTIONS:o,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:o.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:o.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions"],function(e){"use strict";var t={AttrFetchPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrComparePort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplayPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetchPort:{Path:"DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructComparePort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplayPort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PORTFOLIO_STANDARD:{COL:["PORTFOLIO_STRUCT_VIEW","PORTFOLIO_PROP_VIEW"]}},VIEWDEFS:{PORTFOLIO_PROP_VIEW:["AttrFetchPort","AttrComparePort","AttrDisplayPort"],PORTFOLIO_STRUCT_VIEW:["StructFetchPort","StructComparePort","StructListViewPrep","StructDisplayPort","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/DATA/attrValObjSet",["DS/CompareWidget2/plugins/DATA/attrValObj"],function(e){var t=function(e,t,i,n){this.physicalID=e,this.objType=t,this.iconURLLarge=i,this.iconURL=n,this.dbContext={},this.attrVals=[],this.byName={},this._reqModforODT="DS/CompareWidget2/plugins/DATA/attrValObjSet"};return t.prototype.add=function(t,i,n,r,o){var s=new e(t,i,n,r,o);this.attrVals.push(s),this.byName[t]=s},t.prototype.setDBContext=function(e,t,i){this.dbContext={securityContext:e,serviceName:t,tenant:i}},t.prototype.getDBContext=function(){return this.dbContext},t.prototype.getPhysicalID=function(){return this.physicalID},t.prototype.getObjType=function(){return this.objType},t.prototype.getIconURLLarge=function(){return this.iconURLLarge},t.prototype.getIconURL=function(){return this.iconURL},t.prototype.getAttrCount=function(){return this.attrVals.length},t.prototype.getAttr=function(e){return this.attrVals[e]},t.prototype.getAttrByName=function(e){return this.byName[e]},t}),define("DS/CompareWidget2/ViewDefModules/FlexibleViewDefOptions",["DS/CompareWidget2/ViewDefModules/ViewDefOptions","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/FlexibleView"],function(e,t,i,n){"use strict";var r={DESCRIPTION:"INST.Description",REVISION:"REF.ds6wg:revision",INST_TITLE:"INST.ds6w:label"},o={QUANT:{NAME:"REF.Quant",ICON:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS},NLS_RESOLVED:n.Quant},COUNT:{NAME:"REF.Count",ICON:null,NLS_RESOLVED:n.Count}},s={QUANT_STATUS:{COLOR:t.colorDef.GREEN2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS_RESOLVED:n.QUANT_STATUS},COUNT_STATUS:{COLOR:t.colorDef.GREEN3,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS_RESOLVED:n.COUNT_STATUS}};UWA.extend(e.CV_PROPS,r);var a={SHOW_HIDE_NODE_PARAMS:e.STRUCT_DISPLAY_OPTIONS.SHOW_HIDE_NODE_PARAMS},l={ROLLUP_PROPS:[{SOURCE_NAME:null,DEST_NAME:o.COUNT.NAME}],SHOW_HIDE_NODE_PARAMS:e.STRUCT_DISPLAY_OPTIONS.SHOW_HIDE_NODE_PARAMS},u={ROLLUP_PROPS:[{SOURCE_NAME:r.DESCRIPTION,DEST_NAME:o.QUANT.NAME}],SHOW_HIDE_NODE_PARAMS:e.STRUCT_DISPLAY_OPTIONS.SHOW_HIDE_NODE_PARAMS},c={ADD_STATUSES:[{NAME:"QUANT_STATUS",PROPS:[o.QUANT.NAME],FLAG_ON:"NEQ"}]},d={ADD_STATUSES:[{NAME:"COUNT_STATUS",PROPS:[o.COUNT.NAME],FLAG_ON:"NEQ"}]},p={gridViewAMDPath:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree",colorLeft:e.STRUCT_COLORS.BASELINE,colorRight:e.STRUCT_COLORS.COMPARE,ADDITIONAL_STATUS_FLAGS:s,CUSTOM_PROPS:o,displayMode:{id:"tree",icon:"tree-view-all",title:n.StructureViewTitle,tooltip:i.generateTooltip("CompareWidget2/Tooltips","StructureView"),expandCollapseEnabled:!0,rowSelection:"multiple"},DISPLAY_PROPS:{fixed:[r.INST_TITLE,r.REVISION],scrollable:null}};UWA.extend(p,e.STRUCT_DISPLAY_OPTIONS);var h={gridViewAMDPath:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_list",colorLeft:e.STRUCT_COLORS.BASELINE,colorRight:e.STRUCT_COLORS.COMPARE,ADDITIONAL_STATUS_FLAGS:s,CUSTOM_PROPS:o,displayMode:{id:"list",icon:"view-list",title:n.ListViewTitle,tooltip:i.generateTooltip("CompareWidget2/Tooltips","ListView"),expandCollapseEnabled:!1,rowSelection:"single"},DISPLAY_PROPS:{fixed:[r.REVISION,o.COUNT.NAME],scrollable:null}};UWA.extend(h,e.STRUCT_DISPLAY_OPTIONS);var _={gridViewAMDPath:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_list",colorLeft:e.STRUCT_COLORS.BASELINE,colorRight:e.STRUCT_COLORS.COMPARE,ADDITIONAL_STATUS_FLAGS:s,CUSTOM_PROPS:o,displayMode:{id:"XEN-demo",icon:"view-list",title:n.XENDemoListTitle,tooltip:i.generateTooltip("CompareWidget2/Tooltips","ListView"),expandCollapseEnabled:!1,rowSelection:"single"},DISPLAY_PROPS:{fixed:[r.REVISION,o.QUANT.NAME],scrollable:null}};UWA.extend(_,e.STRUCT_DISPLAY_OPTIONS);var f={PROPS:e.CV_PROPS,AGGREGATION_PROPS:o};return UWA.extend(f,e.STRUCT_DISPLAY_OPTIONS),{STRUCT_DISPLAY_PREP_TREE:p,STRUCT_DISPLAY_PREP_LIST_XEN_DEMO:_,STRUCT_AGG_TREE:a,STRUCT_AGG_LIST:l,STRUCT_AGG_LIST_XEN_DEMO:u,STRUCT_ADD_STATUS_LIST:d,STRUCT_ADD_STATUS_LIST_XEN_DEMO:c,STRUCT_DISPLAY_PREP_LIST:h,STRUCT_FLEX_DISPLAY:f}}),define("DS/CompareWidget2/ViewDefModules/FlexibleViewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/FlexibleViewDefOptions"],function(e,t){var i={structAgg_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_TREE_plugin",Options:t.STRUCT_AGG_TREE},structAgg_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_LIST_plugin",Options:t.STRUCT_AGG_LIST},structAgg_LIST_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_LIST_plugin",Options:t.STRUCT_AGG_LIST_XEN_DEMO},StructCompare_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructCompare_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructCompare_LIST_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},structAddStatus_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin"},structAddStatus_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin",Options:t.STRUCT_ADD_STATUS_LIST},structAddStatus_List_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin",Options:t.STRUCT_ADD_STATUS_LIST_XEN_DEMO},structDisplayPrep_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",Options:t.STRUCT_DISPLAY_PREP_TREE},structDisplayPrep_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",Options:t.STRUCT_DISPLAY_PREP_LIST},structDisplayPrep_LIST_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",Options:t.STRUCT_DISPLAY_PREP_LIST_XEN_DEMO},structFlexDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_FLEXIBLE_VIEW_plugin",Options:t.STRUCT_FLEX_DISPLAY},ExporterMulti:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:t.STRUCT_FLEX_DISPLAY}};UWA.extend(e.PLUGDEFS,i);UWA.extend(e.VIEWDEFS,{STRUCT_VIEW_TREE:["StructFetch","structAgg_TREE","StructCompare_TREE","structAddStatus_TREE","structDisplayPrep_TREE","structFlexDisplay"],STRUCT_VIEW_LIST:["StructFetch","structAgg_LIST","StructCompare_LIST","structAddStatus_LIST","structDisplayPrep_LIST","structFlexDisplay"],STRUCT_VIEW_XEN_DEMO:["StructFetch","structAgg_LIST_XEN_DEMO","StructCompare_LIST_XEN_DEMO","structAddStatus_List_XEN_DEMO","structDisplayPrep_LIST_XEN_DEMO","structFlexDisplay","ExporterMulti"]});return UWA.extend(e.VIEWSETS,{XEN_VIEWSET:{ROW:[{COL:["STRUCT_VIEW_TREE","STRUCT_VIEW_LIST","STRUCT_VIEW_XEN_DEMO"]},{COL:["PROP_VIEW","INSTANCE_VIEW"]}]}}),e}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.ComparePropertiesPanelTitle},getName:function(){return"PROP_VIEW"},getDomId:function(){return"propattr"}})}),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},r={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},o={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:r,STRUCT_DISPLAY_OPTIONS:o,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:o.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:o.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefs_V2",["DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayData",["i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayDataItem"],function(e,t){var i=function(e){this._flagDisplayDataMap=this.buildFlagDisplayData(e)};return i.prototype.buildFlagDisplayData=function(i){var n={};return["SYSTEM_RULE_ID_FLAGS","CUSTOM_RULE_ID_FLAGS","CUSTOM_MATCH_ADJ_FLAGS","BUBBLE_FLAGS","ADDITIONAL_STATUS_FLAGS"].forEach(function(r){var o=i[r];null!=o&&Object.keys(o).forEach(function(o){var s=i[r][o].NLS_RESOLVED;if(null==s){var a=i[r][o].NLS;null!=(s=e[a])&&0!=s.length||(s=a)}n[o]=new t(i,o,s,r)})}),n},i.prototype.reset=function(){var e=this;Object.keys(this._flagDisplayDataMap).forEach(function(t){e._flagDisplayDataMap[t].reset()})},i.prototype.updateFlagDisplayData=function(e){var t=0,i=e[0]._trueRoot.getAllDescendants();this.reset();for(var n=i.length,r=0;r<n;r++){let e=i[r].__MATCH_PAIR__;var o=!0===e.qtyIsDiffFlag,s=e.getAllStatusArray(!0)||[],a=s.length,l=a+(o?1:0);l>t&&(t=l);for(var u=0;u<a;u++){var c=s[u];if(null==c||""==c)continue;this.getFlagDisplayDataItem(c).matchedPairs.push(e)}if(o){this.getFlagDisplayDataItem("QUANTITY").matchedPairs.push(e)}}this.getFlagDisplayDataItem("IDENTICAL"),this._maxFlagsPerEntry=t,this.resetTypeFiltersOn(),this.setVizNoViz([])},i.prototype.resetTypeFiltersOn=function(){let e=this;Object.keys(this._flagDisplayDataMap).forEach(function(t){e._flagDisplayDataMap[t].checked=!0})},i.prototype.setVizNoViz=function(e){let t=this,i=!1;for(var n=Object.keys(this._flagDisplayDataMap),r=0;r<n.length;r++){let e=n[r],t=this._flagDisplayDataMap[e];t.matchedPairs.length>0?t.visibleFlag=!0:t.visibleFlag=!1}e.forEach(function(e){1==t._flagDisplayDataMap[e].visibleFlag&&(i=!0),t._flagDisplayDataMap[e].visibleFlag=!1});let o=this._flagDisplayDataMap.IDENTICAL;o&&0==o.visibleFlag&&(o.matchedPairs.length>0||1==i)&&(o.visibleFlag=!0)},i.prototype.getFlagDisplayData_excludeFilteredByTypeAttr=function(){var e=this._flagDisplayDataMap,t={};return Object.keys(e).forEach(function(i){for(var n=e[i],r=n.matchedPairs,o=!1,s=0;s<r.length;s++){if(0==r[s].getIsHidden_byTypeAttr()){o=!0;break}}o&&(t[i]=n)}),t.IDENTICAL=e.IDENTICAL,t},i.prototype.getMaxFlagsPerEntry=function(){return this._maxFlagsPerEntry},i.prototype.getFlagDisplayDataItem=function(e){this._flagDisplayDataMap=this._flagDisplayDataMap||{};var i=this._flagDisplayDataMap;return null!=e&&null==(i=i[e])&&(this._flagDisplayDataMap[e]=new t(null,e,e,null),i=this._flagDisplayDataMap[e]),i},i.prototype.getFDDItem_lut=function(){var e=this;this._flagDisplayDataMap=this._flagDisplayDataMap||{};var t={};return Object.keys(this._flagDisplayDataMap).forEach(function(i){var n=e._flagDisplayDataMap[i],r=n.id;t[r]=n}),t},i.prototype.getFDDItemArray_active=function(){var e=this;this._flagDisplayDataMap=this._flagDisplayDataMap||{};var t=[];return Object.keys(this._flagDisplayDataMap).forEach(function(i){var n=e._flagDisplayDataMap[i];n.matchedPairs.length>0&&t.push(n)}),t},i.prototype.getStatusONOFF=function(){var e=[],t=[],i=this._flagDisplayDataMap.IDENTICAL.checked,n=Object.keys(this._flagDisplayDataMap);let r=this;return n.forEach(function(n){var o=r._flagDisplayDataMap[n];0==o.checked||0==i&&0==o.visibleFlag?e.push(n):t.push(n)}),{offFlags:e,onFlags:t}},i}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayData","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],function(e,t,i,n){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._gridView=null,this._forceRootsTogether=!0,this._compareTreeDocuments=[]},_crNode2tNode:function(e,t,i,r){var o=this;if(null==t)throw new Error("crNode2tNode: Parent node is null");var s=i(e,r),a=new n(s);t.addChild(a),e.__TREENODE__=a;var l=e.getMatchInfo();l.addTreeNode(a),a.__MATCH_PAIR__=l;let u=e.getChildArray();a.setState({state:Array.isArray(u)&&u.length?"expanded":"noChildren"}),e.setExpandCollapseState(a.getState()),Array.isArray(u)&&u.forEach(function(e){o._crNode2tNode(e,a,i,r)})},_crTree2trTree:function(e,t,n){var r=new i,o=!1,s=e.getMatchInfo();s.getBaseNode().isDummy()&&(s.getCompNode().isDummy()&&(o=!0));if(o)for(var a=e.getChildArray(),l=null==a?0:a.length,u=0;u<l;u++)this._crNode2tNode(a[u],r,t,n);else this._crNode2tNode(e,r,t,n);return r},_loadGridView:function(e){var t=this;return new Promise(function(i,n){null!=t._gridView?i(t._gridView):require([e],function(e){t._gridView=new e(t._pluginOptions),i(t._gridView)},function(e){var i="CANNOT LOAD gridView: "+t._gridViewAMDPath+" ::"+e;n(i)})})},_doDisplayPrep:function(e,t,i){var n=[];return null==t?console.error("No crNode2tNodeFN defined... cannot convert"):(n[0]=this._crTree2trTree(e.getRoot(0),t,i),n[0].__CRTREE__=e,n[1]=this._crTree2trTree(e.getRoot(1),t,i),n[1].__CRTREE__=e),n},execute:function(e,i){let n=this;n._parent(e,i);let r=e.crTreeArray,o=new t(i,r[0]);this._loadGridView(i.gridViewAMDPath).then(function(e){let t=e;r.forEach(function(e){e.niceUp(n._forceRootsTogether,!1)});let i=n._doDisplayPrep(r[0],t.createTreeNodeModel.bind(t),o);o.updateFlagDisplayData(i,[]);var s={compareTreeDocumentArray:i,flagDisplayData:o,gridView:t};n.reportOK(s)},function(e){n.reportKO("FAILURE is STRUCT_DISPLAY_PREP: "+e)})}})}),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!1,COMMAND_CONTEXT:"compare",USE_MCS:!1},r={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},o={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{RUN_OPTIONS:{customCompareActive:!0},CV_PROPS:i,STRUCT_FETCH_OPTIONS_REQ:n,STRUCT_COMPARE_OPTIONS_REQ:r,STRUCT_DISPLAY_OPTIONS_REQ:o,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:o.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:o.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDef",["DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetchReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS_REQ},StructCompareReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS_REQ},StructDisplayReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS_REQ},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD_REQ:{COL:["STRUCT_VIEW_REQ","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY_REQ:{ROW:"STRUCT_VIEW_REQ"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW_REQ:["StructFetchReq","StructCompareReq","StructListViewPrep","StructDisplayReq","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/framework/svcNode",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Cycle"],function(e,t){function i(t){var i=this,n=i.getName();e.dbgout("@@@@ SERVICE NODE "+n+" notified of input object update...");var r=t.obj,o=null==r?"[NO OBJ]":e.stringify(r).substr(0,100)+" ...";e.dbgout("@@@@ ++++++++++++++++++++  RUNNING  PLUGIN  +++++++++++++++++++++++++"),e.dbgout("@@@@ ++ PLUGIN: "+n),e.dbgout("@@@@ ++    OBJ: "+o),e.dbgout("@@@@ ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++");try{if(widget.recordForODT){let e=this.getName(),t=null==r?"null":JSON.stringify(JSON.decycle(r)),i=null==this._pluginOptions?"null":JSON.stringify(JSON.decycle(this._pluginOptions));console.log("COMPARE PLUGIN EXECUTE: "+e),console.log("[CV2ODT] "+e+" INSTRING: "+t),console.log("[CV2ODT] "+e+" INOPTIONS: "+i)}0==i.isEnabled()?(null!=i._deferredObjIn?e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is DISABLED, and is UPDATING to a NEW DEFERRED OBJ"):e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is DISABLED, and is deferring processing of an object"),i._deferredObjIn=r):(e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is ENABLED and processing"),i._plugin.execute(r,i._pluginOptions))}catch(t){e.errout("EXCEPTION in Plugin '"+i.getName()+"'.execute(): "+t.stack)}}var n=function(t,i,n,r,o,s){e.dbgout("INIT","Creating svcNode for plugin: "+i),this._name=t,this._pluginOptions=n,this._plugin=r,this._plugSvcs=o,this._eventMgr=s,this._subscribedTokens={},this._plugin.setOutputFn(this.updateOutput.bind(this)),this._outputEventName=i+"."+this._name+".updated",this._outputObj={},"DISPLAY_PLUGIN"==this._plugin._type&&this._subscribe("Event_clearView",this._handler_clearView),this._viewName=null,this._deferredObjIn=null,this._network={upstream:{},downstream:{}}};return n.prototype.destroy=function(){this._name=null,this._pluginOptions=null,null!=this._plugin&&(this._plugin.disconnect(),this._plugin=null),this._pluginService=null,this._unsubscribeAll(),this._eventMgr=null,this._outputEventName=null,null!=this._outputObj&&("function"==typeof this._outputObj.destroy&&this._outputObj.destroy(),this._outputObj=null),null!=this._viewName&&(this._viewName=null),this._network.upstream={},this._network.downstream={}},n.prototype.setViewName=function(e){this._viewName=e},n.prototype.getViewName=function(){return this._viewName},n.prototype.getPluginType=function(){return this._plugin.getType()},n.prototype.updateOutput=function(e){if(this._outputObj=e,widget.recordForODT){let e=this.getName(),t=null==this._outputObj?"null":JSON.stringify(JSON.decycle(this._outputObj));console.log("COMPARE PLUGIN OUTPUT: "+e),console.log("[CV2ODT] "+e+" OUTSTRING: "+t)}this._eventMgr.publish({event:this._outputEventName,data:{eventName:this._outputEventName,obj:this._outputObj}})},n.prototype.getOutputEventName=function(){return this._outputEventName},n.prototype.subscribeToInputEvent=function(e){this._subscribe(e,i)},n.prototype._subscribe=function(t,i){if(null==this._subscribedTokens[t]){e.dbgout("INIT","SvcNode '"+this._name+"' will now listen to update event '"+t+"'");var n=this._eventMgr.subscribe({event:t},i.bind(this));this._subscribedTokens[t]=n}else e.dbgout("INIT","SvcNode '"+this._name+"' already listens to event '"+t+"'; ignoring (this is OK)...")},n.prototype._unsubscribeAll=function(){var e=this;Object.keys(e._subscribedTokens).forEach(function(t){var i=e._subscribedTokens[t];e._eventMgr.unsubscribe(i)}),this._subscribedTokens={}},n.prototype._handler_clearView=function(){1==this.isEnabled()&&this._plugin.onClearView()},n.prototype.refresh=function(){1==this.isEnabled()&&this.updateOutput(this._outputObj)},n.prototype.isEnabled=function(){return this._plugin.isEnabled()},n.prototype.enable=function(){var t=null;if(1==this.isEnabled())t=!0;else if(e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is being turned ON"),1==(t=this._plugin.enable())){if(null!=this._deferredObjIn){e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' has deferred input object, and is now processing it...");var i=this._deferredObjIn;this._deferredObjIn=null,this._plugin.execute(i,this._pluginOptions)}this._notifyEnabledStateChange()}return t},n.prototype.disable=function(){1==this.isEnabled()&&(e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is being turned OFF"),this._plugin.disable(),this._notifyEnabledStateChange())},n.prototype._notifyEnabledStateChange=function(){var e=this;null!=e._network.upstream&&Object.keys(e._network.upstream).forEach(function(t){e._network.upstream[t]._updateEnabledState()})},n.prototype._updateEnabledState=function(){var t=this;e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is evaluating its enabled state (because a downstream svcNode changed its enabled state)");var i="disabled";if(null==t._network.downstream)i="enabled";else{var n=!1;Object.keys(t._network.downstream).forEach(function(e){t._network.downstream[e].isEnabled()&&(n=!0)}),n&&(i="enabled")}"enabled"==i&&0==t.isEnabled()?t.enable():"disabled"==i&&1==t.isEnabled()&&t.disable()},n.prototype.getViewPanel=function(){var e=null;return"DISPLAY_PLUGIN"==this._plugin.getType()&&(e=this._plugin.getViewPanel()),e},n.prototype.addUpstreamNode=function(e){this._network.upstream[e.getName()]=e},n.prototype.addDownstreamNode=function(e){this._network.downstream[e.getName()]=e},n.prototype.buildViewPanel=function(t,i){null==this._viewName?e.warnout("buildViewPanel called on svcNode with no view"):this._plugin.buildViewPanel(this._viewName,this._pluginOptions,t,i)},n.prototype.getName=function(){return this._name},n.prototype._debug_dump=function(){},n}),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},r={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},o={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:r,STRUCT_DISPLAY_OPTIONS:o,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:o.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:o.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PRODUCTS_PROPS_AND_STRUCT:{COL:["PRODUCTS_STRUCT_VIEW","PRODUCTS_PROP_VIEW"]},PRODUCTS_PROPS_ONLY:{ROW:"PRODUCTS_PROP_VIEW"},PRODUCTS_STRUCT_ONLY:{ROW:"PRODUCTS_STRUCT_VIEW"}},VIEWDEFS:{PRODUCTS_PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],PRODUCTS_STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList","DS/CompareWidget2/support/typeHierMgr"],function(e,t,i,n,r){var o=function(e){var t=this;t._plugSvcs=e,t._COMPUTE_DIFFERENT=null,t._FORCE_ROOTS_TOGETHER=!0,t._RELATIONSHIP_NAMES=null,t._RelName2Index={},t._attrNameArray_base=[],t._attrNameArray_comp=[],t._adjArray=[],t._maxAdjScore=0,t._missingAttrVals=!1,t._score2CompareIndex={},t._score2CompareIndex_root={}};function s(e,t){for(var i=t.toString(),n=e-i.length,r="",o=0;o<n;o++)r+=" ";return r+i}return o.prototype._iiGatherTypes=function(e){var t={};return(e||[]).forEach(function(e){var i=e.CONDITIONS;null!=i&&i.TYPE.forEach(function(e){t[e]=!0})}),Object.keys(t)},o.prototype._createCRNode=function(e){var i=e.getAttr("REF.ds6w:identifier");null!=i&&""!==i||(i=e.getAttr("REF.name"));var n=e.getAttr("REF.ds6w:label");null!=n&&""!==n||(n=e.getAttr("REF.Title"));var r=e.getAttr("REF.typeIcons"),o=null!=r?r.smallURL:null,s=null!=r?r.largeURL:null,a=e.getAttr("INST.ro.plminstance.v_treeorder");null!=a&&""!==a||(a=e.getAttr("INST.ro.plminstance.V_treeorder")),null!=a&&""!==a||(a=e.getAttr("INST.TreeOrder"));var l=null;if(this._options.CUSTOM_PROFILE_IN_USE){null!=this._attrNameArray_base&&(l={},this._attrNameArray_base.forEach(function(t){var i=e.getAttr(t);l[t]=i}));let t=this;this._options.CUSTOM_MATCH_ADJUSTMENTS&&this._options.CUSTOM_MATCH_ADJUSTMENTS.forEach(function(i){null!=i.PROPSET&&i.PROPSET.forEach(function(i){var n=t._options.PROPS[i],r=e.getAttr(n);l[n]=r})})}var u=new t(i,n,e.getAttr("REF.ds6w:type"),e.getAttr("INST.physicalid"),e.getAttr("REF.physicalid"),e.getAttr("REF.ds6wg:revision"),a,o,s,e.getAttr("REF.thumbnail_3d"),e,l);u.setDBContext(UWA.clone(e.getDBContext()));var c=e.getAttr("REF.proxySpec");return null!=c&&""!==c.serviceURL&&(u._dbContext.serviceName=c.serviceURL),u},o.prototype._addMatchInfoToCRNodes=function(e,t,n,r,o){var s=new i(e,t,n,r,o);return n.setMatchInfo(s),r.setMatchInfo(s),s},o.prototype._iiLoadHierCache=function(e){var t=this._iiGatherTypes(e);return r.loadUp(t)},o.prototype._initInternals=function(e){var t=this;t._COMPUTE_DIFFERENT=e.COMPUTE_DIFFERENT,t._FORCE_ROOTS_TOGETHER=!0,t._RELATIONSHIP_NAMES=[...e.CUSTOM_RELATIONSHIP_NAMES,...e.SYSTEM_RELATIONSHIP_NAMES],t._RelName2Index={},t._RELATIONSHIP_NAMES.forEach(function(e,i){t._RelName2Index[e]=i});var i=e.CUSTOM_MATCH_ADJUSTMENTS,n=e.PROPS,r=e.CUSTOM_COMPARISONS;t._score2CompareIndex={},t._score2CompareIndex_root={};var o=Object.keys(r);e.CUSTOM_RELATIONSHIP_NAMES.forEach(function(i,s){var a=0,l=0,u=[],c=[];o.forEach(function(t,i){var o=r[t][1][s],d=1<<i;"EQ"==o?a+=d:"N/A"==o&&u.push(d),n[e.CUSTOM_COMPARISONS[t][0][1]].startsWith("INST")?c.push(d):"EQ"==o?l+=d:"N/A"==o&&c.push(d)}),t._iiCalcScoreSet(a,u).forEach(function(e){null==t._score2CompareIndex[e]&&(t._score2CompareIndex[e]=s)}),t._iiCalcScoreSet(l,c).forEach(function(e){null==t._score2CompareIndex_root[e]&&(t._score2CompareIndex_root[e]=s)})});var s={},a={};t._attrNameArray_base=[],t._attrNameArray_comp=[],Object.keys(r).forEach(function(e){var t=r[e][0],i=t[0],o=t[1],l=n[i],u=n[o];s[l]=!0,a[u]=!0}),t._attrNameArray_base=Object.keys(s),t._attrNameArray_comp=Object.keys(a),t._adjArray=[];for(var l=null==i?0:i.length,u=0;u<l;u++){var c=i[u],d=null,p=null,h=[],_=[];let e=!1;if(null!=c.PROPS&&c.PROPS.length>0){var f=c.PROPS;let t=f[0],i=f[1];d=n[t],p=n[i],null==d?_.push(t):d.startsWith("INST")&&(e=!0),null==p?_.push(i):p.startsWith("INST")&&(e=!0)}else{if(!(null!=c.PROPSET&&c.PROPSET.length>0)){t._plugSvcs.errout("Adjustment rule '"+c.NAME+"' malformed; rule is skipped.");continue}c.PROPSET.forEach(function(t){let i=n[t];null==i?_.push(t):(h.push(i),i.startsWith("INST")&&(e=!0))})}if(_.length>0)t._plugSvcs.errout("Cannot evaluate adjustment rule '"+c.NAME+"'; references undeclared variable(s):"+_.join(", "));else{var g=c.MATCH_ADJ;let i={NAME:c.NAME,propName0:d,propName1:p,propNameList:h,FLAG_ON:c.FLAG_ON,adjScore:g,CONDITIONS:c.CONDITIONS,usesInstProp:e,IS_VISIBLE:null==c.IS_VISIBLE||c.IS_VISIBLE};t._adjArray.push(i),g>0&&(t._maxAdjScore+=g)}}return t._iiLoadHierCache(e.CUSTOM_MATCH_ADJUSTMENTS)},o.prototype._iiCalcScoreSet=function(e,t){for(var i=[],n=Math.pow(2,t.length),r=0;r<n;r++){for(var o=e,s=0;s<r;s++)0!=(r&1<<s)&&(o+=t[s]);i.push(o)}return i},o.prototype._buildAttrValLUT=function(e,t){var i=this,n={};return t.forEach(function(t){n[t]={},e.forEach(function(e,r){var o=e.getAttr(t);null!=o?(null==n[t][o]&&(n[t][o]=[]),n[t][o].push(r)):0==e.isRoot()&&1!=i._missingAttrVals&&(i._missingAttrVals=!0,i._plugSvcs.errout("Assembly being tested is MISSING REQUIRED values for the current ruleset ("+t+")"))})}),n},o.prototype._findMatches=function(e,t){var i=this,r=!1,o=1==e.length&&e[0].isRoot()&&1==t.length&&t[0].isRoot(),s=i._buildAttrValLUT(e,i._attrNameArray_base),a=new n(e,t);return t.forEach(function(t,n){var l={};i._attrNameArray_comp.forEach(function(e,i){var n=t.getAttr(e),r=s[e][n];if(null!=r){var o=1<<i;r.forEach(function(e){null==l[e]&&(l[e]=0),l[e]+=o})}});var u=Object.keys(l);i._FORCE_ROOTS_TOGETHER&&o&&0==u.length&&(r=!0),u.forEach(function(s){var u=l[s],c=o?i._score2CompareIndex_root[u]:i._score2CompareIndex[u];if(null!=c){i._stats.totalMatchedFoundCount++;var d=e[s],p=i._evalAdjustment(d,t);a.add(s,n,c,i._RELATIONSHIP_NAMES[c],p.adjIndex,p.adjFlagArray,p.instFlagNdxs)}else o&&i._FORCE_ROOTS_TOGETHER&&(r=!0)}),r&&(i._stats.rootWasForced=!0,a.add(0,0,i._RelName2Index.UNRELATED,"UNRELATED",0,[],[]))}),a.getResult()},o.prototype.isKindOfAny=function(e,t){for(var i=!1,n=e.getAttr("REF.ds6w:type"),o=t.length,s=0;s<o;s++){var a=t[s];if(r.isKindOf(n,a)){i=!0;break}}return i},o.prototype.attrVals_asSpecified=function(e,t){for(var i=!0,n=Object.keys(t),r=n.length,o=0;o<r;o++){var s=n[o],a=t[s];if(e.getAttr(s)!=a){i=!1;break}}return i},o.prototype.conditionsMatchType=function(e,t){return null==t||0==t.length||this.isKindOfAny(e,t)},o.prototype.conditionsMatchAttrs=function(e,t){return null==t||this.attrVals_asSpecified(e,t)},o.prototype.conditionsMatch=function(e,t,i){return null==i||(this.conditionsMatchType(e,i.TYPE)||this.conditionsMatchType(t,i.TYPE))&&(this.conditionsMatchAttrs(e,i.ATTRIBUTES)||(this.conditionsMatchAttrs(t),i.ATTRIBUTES))},o.prototype._evalAdjustment=function(e,t){let i=this,n=0,r=[],o=[],s=e.isRoot()||t.isRoot();for(let l=0;l<i._adjArray.length;l++){let u=i._adjArray[l],c=!1,d="EQ"==u.FLAG_ON,p=u.propNameList;if(null!=p&&p.length>0)for(var a=0;a<p.length;a++){let i=p[a];if((!s||!u.usesInstProp)&&1==(c=e.getAttr(i)==t.getAttr(i)==d))break}else{let i=u.propName0,n=u.propName1;if(s&&u.usesInstProp)continue;c=e.getAttr(i)==t.getAttr(n)==d}c&&1==i.conditionsMatch(e,t,u.CONDITIONS)&&(u.IS_VISIBLE&&(r.push(u.NAME),u.usesInstProp&&o.push(l)),n+=u.adjScore)}return r.length>0&&i._plugSvcs.dbgout("EVAL","----\x3e>> [ADJUSTMENT] : Adj: "+n+", FLAGS: "+r.join(",")),{adjIndex:i._maxAdjScore-n,adjFlagArray:r,instFlagNdxs:o}},o.prototype._addCRNodes=function(e){var t=this;e.forEach(function(e){var i=t._createCRNode(e);if(e._crNode=i,null!=e.getParent()){var n=e.getParent()._crNode;n.addChild(i),i.setParent(n)}})},o.prototype._processNodeSets=function(e,t){var i=this;i._stats.processedNodeSetCount++,i._plugSvcs.dbgout("EVAL","PROCESSING "+e.length+" x "+t.length+" nodes...");var n=1==e.length&&e[0].isRoot();n||(this._addCRNodes(e),this._addCRNodes(t));var r=i._findMatches(e,t);i._stats.unmatchedCount+=r.riUnmatchedNodeArray_base.length+r.riUnmatchedNodeArray_comp.length,i._stats.totalMatchedUsedCount+=r.riMatchedNodePairArray.length;var o=r.riMatchedNodePairArray,s=r.riUnmatchedNodeArray_base,a=r.riUnmatchedNodeArray_comp;o.forEach(function(e){var t=e.riNode_base,r=e.riNode_comp,o=t._crNode,s=r._crNode;if(i._addMatchInfoToCRNodes(e.relName,e.adjFlagArray,o,s,e.instFlagNdxs),n&&"UNRELATED"==e.relName&&0==i._COMPUTE_DIFFERENT)return i._addCRNodesForUnmatchedChildren([t]),void i._addCRNodesForUnmatchedChildren([r]);i._markParentsDiff(o,s);var a=t.getChildArray(),l=r.getChildArray();(a.length>0||l.length>0)&&i._processNodeSets(a,l)}),(s.length>0||a.length>0)&&(1==i._COMPUTE_DIFFERENT?i._processUnmatchedChildren_forDiff(s,a):(i._addCRNodesForUnmatchedChildren(s),i._addCRNodesForUnmatchedChildren(a)))},o.prototype._addCRNodesForUnmatchedChildren=function(e){if(null!=e){var t=[];e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),this._addCRNodes(t),t.length>0&&this._addCRNodesForUnmatchedChildren(t)}},o.prototype._processUnmatchedChildren_forDiff=function(e,t){var i=[],n=[];e.forEach(function(e){e.getChildArray().forEach(function(e){i.push(e)})}),t.forEach(function(e){e.getChildArray().forEach(function(e){n.push(e)})}),this._processNodeSets(i,n)},o.prototype._markParentsDiff=function(e,t){if(null!=e&&null!=t){var i=e.getParent(),n=t.getParent(),r=0;if(r+=null!=i?1:0,0!=(r+=null!=n?1:0))if(1!=r){var o=i.getMatchInfo(),s=i.getMatchInfo(),a=0;if(a+=null!=o?1:0,0==(a+=null!=s?1:0)){this._addMatchInfoToCRNodes("DIFFERENT",[],i,n,[]),this._stats.diffCount++,this._markParentsDiff(i,n)}else{if(1==a)return void console.error("MarkParentsDiff() failed sanity check - one parent already assigned");if(o==s&&"UNRELATED"==o.getRelName())return o.resetRelName("DIFFERENT"),void this._stats.diffCount++}}else console.error("MarkParentsDiff() failed sanity check - one node is root")}else console.error("markParentsDiff() fails sanity check: one of these nodes is null")},o.prototype._compareTrees=function(t,i){this._missingAttrVals=!1;var n=new e,r=t.getRoot(),o=i.getRoot(),s=this._createCRNode(r);r._crNode=s,n.setRoot(0,t.getObjIDSpec(),s);var a=t.getObjIDSpec().isFiltered();let l=t.getObjIDSpec().getExternalFilterSpec();if(a)if(null!=l){let e=l.filterTitle;s.setExternalFilterName(e)}else s.setExternalFilterName("");var u=this._createCRNode(o);o._crNode=u,n.setRoot(1,i.getObjIDSpec(),u);let c=i.getObjIDSpec().isFiltered(),d=i.getObjIDSpec().getExternalFilterSpec();if(c)if(null!=d){let e=d.filterTitle;u.setExternalFilterName(e)}else u.setExternalFilterName("");return this._processNodeSets([r],[o]),n},o.prototype._cleanup=function(e){var t=this;e.forEach(function(e,i){var n=0;e.visit_riTreeAndFN(function(e){return n++,delete e._crTree,!0}),t._plugSvcs.dbgout(" --\x3e Tree #"+i+" node count      : "+s(7,n))})},o.prototype._initTreeCompareStats=function(){this._stats={processedNodeSetCount:0,totalMatchedFoundCount:0,totalMatchedUsedCount:0,unmatchedCount:0,diffCount:0,rootWasForced:!1,dump:function(e){var t=this;e(" Total node sets processed   : "+s(7,t.processedNodeSetCount)),e(" Total matches found         : "+s(7,t.totalMatchedFoundCount));var i="";t.rootWasForced&&(i=" (+ 1 b/c root was forced)"),e(" Total matches Used          : "+s(7,t.totalMatchedUsedCount)+i),e(" Unmatched Nodes             : "+s(7,t.unmatchedCount)),e(" Unmatched Changed to 'diff' : "+s(7,t.diffCount))}}},o.prototype.doCompare=function(e,t,i){var n=this;return n._plugSvcs=i,n._options=t,new Promise(function(i,r){var o=n._plugSvcs.nowMS();n._initInternals(t).then(function(t){var r=[],s=e[0],a=s.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==a&&(a=s.getRoot().get_dbObj_REF().getAttr("Title"));for(var l=e.length,u=1;u<l;u++){var c=e[u],d=c.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==d&&(d=c.getRoot().get_dbObj_REF().getAttr("Title")),n._initTreeCompareStats(),n._plugSvcs.dbgout("vvvvvvvvvvvvvvvvvvvvv  COMPARING TREES  vvvvvvvvvvvvvvvvvvvvv <<<<"),n._plugSvcs.dbgout(" Roots are                   : '"+a+"' & '"+d+"'");var p=n._compareTrees(s,c);p.sortTreeNodes(),n._stats.dump(n._plugSvcs.dbgout),r[u-1]=p,l>2&&n._plugSvcs.dbgout("------------------------------------------------------------------")}n._cleanup(e),n._plugSvcs.dbgout("^^^^ ^^^^^^^^^^^^^^^^  COMPARING TREES  ^^^^^^^^^^^^^^^^^^^^^ <<<<"),n._plugSvcs.reportTime(o,"----ALL tree structure comparisons are done----: "),i(r)},function(e){n._plugSvcs.errout("Failed comparing structures: "+e),r(e)})})},o}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._engine=null},onLoad:function(){return this._engine=new t(this._plugSvcs),!0},onDestroy:function(){this._engine=null},execute:function(e,t){var i=this;i._parent(e,t);var n=e;i._engine.doCompare(n,t,this._plugSvcs).then(function(e){if(null!=e){var n={crTreeArray:e,ruleNames:t.CUSTOM_RELATIONSHIP_NAMES,destroy:function(){Array.isArray(this.crTreeArray)&&(this.crTreeArray.forEach(function(e){e.destroy()}),this.crTreeArray=null)}};i.reportOK(n)}else i.reportKO("FAILURE performing struct compare: 'null crTree returned'")},function(e){i.reportKO("FAILURE performing struct compare: "+e)})}})}),define("DS/CompareWidget2/framework/svcNodeNet",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/svcNode"],function(e,t){var i=function(e,t){this._eventMgr=t,this._plugSvcs=e,this._inputEventName="DEFAULT_INPUT",this._svcNodeSet={},this._viewSvcNodeArray=[],this._viewSvcNodeByView=null,this._lastObjSent=null,this._subscribeTokens={},this._beginTimeMS=0,this._waitingCount=0,this._subscribeTokens.VIEW_CLOSED=this._eventMgr.subscribe({event:"VIEW_CLOSED"},this._handleViewClosed.bind(this)),this._subscribeTokens.VIEW_OPENED=this._eventMgr.subscribe({event:"VIEW_OPENED"},this._handleViewOpened.bind(this))};return i.prototype.getViewSvcNodeNames=function(){var e=[];return this._viewSvcNodeArray.forEach(function(t){var i=t.getName();e.push(i)}),e},i.prototype.getSvcNodeForView=function(e){var t=null,i=this;return null==i._viewSvcNodeByView&&(i._viewSvcNodeByView={},i._viewSvcNodeArray.forEach(function(e){var t=e.getViewPanel();if(null!=t){var n=e.getName();i._viewSvcNodeByView[n]=t}})),Object.keys(this._viewSvcNodeByView).forEach(function(n){i._viewSvcNodeByView[n]!==e||(t=i._svcNodeSet[n])}),t},i.prototype._handleViewClosed=function(t){e.dbgout("svcNodeNetwork is handling frameMinimized..."),this.getSvcNodeForView(t.view).disable()},i.prototype._handleViewOpened=function(t){e.dbgout("svcNodeNetwork is handling frameRestored..."),this.getSvcNodeForView(t.view).enable()},i.prototype.destroy=function(){var e=this;e._unsubscribeAllEvents(),e._eventMgr=null,e._plugSvcs=null,Object.keys(e._svcNodeSet).forEach(function(t){e._svcNodeSet[t].destroy()}),e._svcNodeSet=null,e._viewSvcNodeArray=[]},i.prototype.updateInput=function(t){this._beginTimeMS=this._plugSvcs.nowMS(),this._waitingCount=Object.keys(this._subscribeTokens).length,e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------[ P R O C E S S I N G    I D S   B E G I N  ] -----------"),e.dbgout("---------------------------------------------------------------------"),e.dbgout("svcNodeNet updating input... raising event '"+this._inputEventName+"'"),this._lastObjSent=t,this._eventMgr.publish({event:this._inputEventName,data:{eventName:this._inputEventName,obj:t}})},i.prototype.buildViewPanels=function(t,i){e.dbgout("INIT","------------[ B U I L D   V I E W S   B E G I N ] -----------");var n=this._plugSvcs.nowMS();this._viewSvcNodeArray.forEach(function(n){e.dbgout("INIT","Building view: "+n.getViewName()),n.buildViewPanel(t,i)}),this._plugSvcs.reportTime(n," views built"),e.dbgout("INIT","------------[ B U I L D   V I E W S   E N D     ] -----------")},i.prototype.build=function(i){var n=this;e.dbgout("INIT","------------[ C R E A T E   S v c   N o d e   N E T W O R K   B E G I N ] -----------");var r=n._plugSvcs.nowMS(),o=i.PLUGSLOADED,s=i.PLUGDEFS;Object.keys(s).forEach(function(e){var i=s[e],r=i.Path,a=i.Options,l=o[e],u=new t(e,r,a,l,n._plugSvcs,n._eventMgr);n._svcNodeSet[e]=u});i.VIEWSET;var a=i.VIEWDEFS;(l=Object.keys(a)).forEach(function(e){var t=a[e],i=t[0],r=n._svcNodeSet[i];r.subscribeToInputEvent(n._inputEventName);for(var o=r,s=t.length,l=1;l<s;l++){var u=t[l],c=n._svcNodeSet[u];o.addDownstreamNode(c),c.addUpstreamNode(o);var d=o.getOutputEventName();c.subscribeToInputEvent(d),o=c}var p=o.getOutputEventName();n._addToFinishedEventList(p)});var l=Object.keys(a),u={};l.forEach(function(e){for(var t=a[e],i=0;i<t.length;i++){var r=t[i],o=n._svcNodeSet[r];"DISPLAY_PLUGIN"==o.getPluginType()&&null==u[r]&&(o.setViewName(e),n._viewSvcNodeArray.push(o),u[r]=!0)}}),n._plugSvcs.reportTime(r," svcNodeNet built"),e.dbgout("INIT","------------[ C R E A T E   S v c   N o d e   N E T W O R K   E N D ] -----------")},i.prototype.enableAll=function(){var t=this._setNetEnable(!0);return 0==t&&e.errout("There was a problem enabling the service nodes"),t},i.prototype.disableAll=function(){return this._setNetEnable(!1)},i.prototype._setNetEnable=function(e){var t=this,i=!1;return Object.keys(t._svcNodeSet).forEach(function(n){var r=t._svcNodeSet[n];i|=1==e?r.enable():r.disable()}),i},i.prototype._handleFinishedEvent=function(){this._waitingCount>0&&(this._waitingCount--,0==this._waitingCount&&(e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------- [ P R O C E S S I N G    I D S   E N D  ] -------------"),e.dbgout("---------------------------------------------------------------------"),e.reportTime(this._beginTimeMS," svcNodeNetwork completes; async ops may still be processing")))},i.prototype._addToFinishedEventList=function(e){this._subscribeTokens[e]=this._eventMgr.subscribe({event:e},this._handleFinishedEvent.bind(this))},i.prototype._unsubscribeAllEvents=function(){var e=this;Object.keys(e._subscribeTokens).forEach(function(t){var i=e._subscribeTokens[t];e._eventMgr.unsubscribe(i)}),e._subscribeTokens={}},i}),define("DS/CompareWidget2/Customization/DictionaryServices",["DS/CompareWidget2/support/DataCenter"],function(e){let t=null,i=!1,n=(t,n)=>Promise.allSettled(t.map(t=>new Promise(function(r,o){let s=[];if(Object.keys(t._TypesInfo).forEach(e=>{0===t._TypesInfo[e].attributes.length&&s.push("ds6wg:"+e)}),0===s.length)r();else{let a=s.join("\n");e.makeAuthHttpsCall("/resources/6WVocab/access/Predicates","POST",a,"json",n.tenant,"3DSpace",n.securityContext,!0,!0).then(function(e){for(var n of(console.log("CompareCustomization._getObjTypesAttrs: OK retrieving attributes for "+e.classPredicates.length+" object types"),e.classPredicates)){let e=n.className.slice(6);if(t._TypesInfo[e]=t._TypesInfo[e]||{attributes:[]},0===t._TypesInfo[e].attributes.length)for(var o of n.vocabularyPredicateInfo)t._TypesInfo[e].attributes.push({name:o.name,uri:o.uri,nlsName:o.nlsName})}i=!0,r()},function(e){console.log("CompareCustomization._getObjTypesAttrs: KO retrieving object type attributes: "+e),o()})}}))).then(()=>t);return{getAllTypesAndInterfacesInfos:async function(i,r){return i=await(async(i,n)=>(t?Promise.resolve(t):e.makeAuthHttpsCall("/resources/dictionary/DictionaryCUSTO","GET","","json",n.tenant,"3DSpace",n.securityContext,!0,!1)).then(function(e){return t!==e&&e&&e.Dictionary&&(t=e.Dictionary),console.log("CompareCustomization._getCustomTypesAndInterfaces: OK retrieving dictionary custom information: "),i.forEach(e=>{if(!e._CustomTypesInfo||!e._CustomTypesInfo){e._CustomTypesInfo={},e._CustomInterfacesInfo={},["Types","Relationships"].forEach(i=>{for(const[n,r]of Object.entries(t[i]))e.SelectedTypes.includes(r.FirstOOTB)&&(e._CustomTypesInfo[n]={parentType:r.Parent,attributes:r.Attributes})});let i=e.SelectedTypes.concat(Object.keys(e._CustomTypesInfo));for(const[n,r]of Object.entries(t.Interfaces)){let t=null;Array.isArray(r.ScopeTypes)&&r.ScopeTypes.length&&r.ScopeTypes.some(e=>(t=i.indexOf(e),-1!=t))&&(e._CustomInterfacesInfo[n]={parentType:i[t],attributes:r.Attributes})}}}),i},function(e){return console.log("CompareCustomization._getCustomTypesAndInterfaces: KO retrieving dictionary custom information: "),i}))(i,r),i=await(async(t,i)=>Promise.allSettled(t.map(t=>null!=t._TypesInfo?Promise.resolve(t):new Promise(function(n,r){t._TypesInfo={};let o={"ds6w:type":t.SelectedTypes.concat(t.Interfaces,Object.keys(t._CustomTypesInfo),Object.keys(t._CustomInterfacesInfo))};e.makeAuthHttpsCall("/resources/6WVocab/access/PredicateValue","POST",o,"json",i.tenant,"3DSpace",i.securityContext,!0).then(function(e){for(const[i,n]of Object.entries(e["ds6w:type"]))t._TypesInfo[i]={displayName:n,icon:void 0,attributes:[]};n()},function(e){console.log("CompareCustomization: Failed to retrieve object type display names: "+e),r()})}))).then(()=>t))(i,r),i=await(async(t,i)=>Promise.allSettled(t.map(t=>new Promise(function(n,r){let o=[];function s(e){return"VPM"===e.substr(0,3)&&"Instance"===e.substr(e.length-8)?"flow-cascade":"VPM"===e.substr(0,3)&&"Reference"===e.substr(e.length-9)?"product":""}for(var a of t.Facets)["ObjectTypes","Interfaces"].forEach(e=>{if(a[e])for(var i of a[e])a.Icon?t._TypesInfo[i].icon=a.Icon:t._TypesInfo[i].icon=s(i),void 0!==t._TypesInfo[i].icon&&null!==t._TypesInfo[i].icon&&""!==t._TypesInfo[i].icon||o.push(i)});(o.length>0?e.makeAuthHttpsCall("/resources/dictionary/getTypeInfo","POST",o,"json",i.tenant,"3DSpace",i.securityContext,!0,!1):Promise.resolve()).then(function(e){console.log("CompareCustomization._getObjTypesIcon: OK retrieving object type icon information: ");for(const[e,i]of Object.entries(t._TypesInfo))void 0===i.icon&&(void 0!==t._CustomTypesInfo[e]?i.icon=t._TypesInfo[t._CustomTypesInfo[e].parentType].icon:void 0!==t._CustomInterfacesInfo[e]&&(i.icon=t._TypesInfo[t._CustomInterfacesInfo[e].parentType].icon));n()},function(e){console.log("CompareCustomization._getObjTypesIcon: KO retrieving object type icon information: "),n()})}))).then(()=>t))(i,r),n(i,r),i},getFacetAttrs:async function(e,t){return await n(e,t)},areAllAttrsLoaded:function(){return i}}}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees",["UWA/Controls/Abstract","UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/widget/controls/TreesContainer","DS/CompareWidget2/widget/controls/TreePanel"],function(e,t,i,n,r,o,s){"use strict";return e.extend({init:function(e){this.dataGridConfigArray=e.dataGridConfigArray,this._parent({}),this.onSelectRow=e.onSelectRow,this.onUnselectRow=e.onUnselectRow,this.cols=e.cols,this._eachGridColorColumns=[];let t=this;this._currentlySelectedRowIDs=[],this.treeContainers=[],this.onContextMenu=e.onContextMenu,this.rowSelection=e.rowSelection,this.cellDragEnabledFlag=e.cellDragEnabledFlag,this.dataGridConfigArray.forEach((e,i)=>{var n=e.cols.find(e=>"tree"===e.dataIndex),r=n.onCellRequest;n.onCellRequest=(e=>{t.onCellRequest(e,t.dataGridViews[i]),"function"==typeof r&&r(e)})}),this.onScroll=e.onScroll,this.onExpand=e.onExpand,this.onCollapse=e.onCollapse,this.onPreExpand=e.onPreExpand,this.onPreCollapse=e.onPreCollapse,this.treeContainers=[],this.treePanels=[],this.treesContainer=new o,e.dataGridConfigArray.forEach(function(e,i){var n=e.gridViewContainerParams,r=new s({caption:n.panelCaption,addClass:n.panelAddClass,contentId:n.id,contentBorderTop:n.styles["border-top"],collapseable:n.panelCollapseable,initSize50pct:!!n.initSize50pct&&n.initSize50pct,colorIndicator:e.colorIndicator});t.treePanels.push(r),t.treeContainers.push(r.elements.content),t.treesContainer.addPanel(r)}),this.elements.container=this.treesContainer.elements.container},show:function(){this.getContent().style.display="flex"},restorePreviousSelection:function(){var e=this,t=this.getNTHGridSelectedNodes(0);this.clearNTHGridSelection(0);var i=!1;if(t.forEach(t=>{var n=t._rowID,r=e.dataGridViews[0].model.find(e=>e._rowID===n&&e.isVisible());r&&(r.select(),i=!0)}),!i){var n=e.dataGridViews[0].model.find(e=>e.isVisible());n&&n.select()}},onDataGridViewsReady:function(e){let t=this;this.dataGridViews.forEach(e=>{t.syncScrolling(e),t.syncExpandCollapse(e.getTreeDocument()),t.subscribeForTreeSync(e)}),e()},clear:function(){this.treeContainers.forEach(e=>e.empty())},update:function(e,n,o,s){this.clear();var a=this;Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach(e=>e.destroy()),Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[],this.dataGridConfigArray.forEach((e,n)=>{var s=t.createElement("div",{class:"compare_tree_list_view"});s.inject(a.treeContainers[n]);for(var l=e.cols.length-1;l>=0;--l){let t=e.cols[l];var u=t.text;if(null!=u){var c=o[u];null!=c&&("_#_DELETED_#_"===c?e.cols.splice(l,1):t.text=c)}}if(1===e.cols.length&&"left"===e.cols[0].pinned)for(var d of(e.cols[0].pinned="",a._eachGridColorColumns))for(var p of d)"left"===p.pinned&&(p.pinned="");var h=new r({enableListSelection:!0,columnDragEnabledFlag:!1,treeDocument:new i({}),columns:a._eachGridColorColumns[n].concat(e.cols),cellDragEnabledFlag:a.cellDragEnabledFlag,defaultColumnDef:{minWidth:8.5},layoutOptions:{rowsHeader:0===n},rowSelection:a.rowSelection,selectionBehavior:{unselectAllOnEmptyArea:!1,selectOnContextualEvent:!0},onContextualEvent:function(e){return new Promise(function(t){a.onContextMenu(e).then(function(e){t(e)})})}});h.onDragStartCell=function(e,t){this.draggingFromCompare=!0;var i=[],n=t.nodeModel._options.data,r=n._attrList,o=n.getDBContext();if(!n.isDraggable())return e.preventDefault(),!1;var s=n.getPath().split("/").map(function(e){return{resourceid:e}});i.push({contextId:o.securityContext,envId:o.tenant,objectId:r.physicalID_REF,objectType:r.type,path:s,serviceId:o.serviceName});var a={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:i}};return e.dataTransfer.setData("Text",JSON.stringify(a)),!0},h.onDragOverCell=function(e,t){return!0},h.onDragEndCell=function(e,t){return this.draggingFromCompare=!1,!0},a.dataGridViews.push(h),h.inject(s)}),Promise.all(this.dataGridViews.map(e=>new Promise(t=>e.onPostUpdateViewOnce(()=>t())))).then(()=>a.onDataGridViewsReady(s)),this.withUpdateLocked(function(){a.dataGridViews.forEach((t,i)=>{a.buildDataGridView(t,e[i],i,n),t.getTreeDocument().getRoots()[0].select()}),"function"==typeof a.onSelectRow&&a.onSelectRow()})},buildDataGridView:function(e,t,i,n){t.constructor!=Array&&(t=[t]),e.getNodesXSO().empty(),e.getTreeDocument().empty();var r=this;this.dbgcnt=0,this.asRoot=0,this.asChild=0;var o=e.getTreeDocument();o.withTransactionUpdate(function(){t.forEach(function(e){r.asRoot++,r.crNode2tNode(e,o,i)})}),e.elements.container.style.top="4px",e.layout.columnsHeader=n,e.layout.rowsHeader=!1,e.cellSelection="none",e.showCellActivationFlag=!1,e.selected=[]},crNode2tNode:function(e,t,i){this.dbgcnt++;var r=this,o=null;if("function"!=typeof r.dataGridConfigArray[i].createTreeNodeConfig)throw Error("Trees:crNode2tNode - createTreeNodeConfig not defined");if(o=new n(r.dataGridConfigArray[i].createTreeNodeConfig(e)),null==t)throw new Error("crNode2tNode: Parent node is null");t.addChild(o),e.__TREENODE__=o,e.getMatchInfo().addTreeNode(o);let s=e.getChildArray();o.setState({state:Array.isArray(s)&&s.length?"expanded":"noChildren"}),e.setExpandCollapseState(o.getState()),Array.isArray(s)&&s.length&&s.forEach(function(e){r.asChild++,r.crNode2tNode(e,o,i)})},hasNextNonEmptyBrother:function(e){for(var t=!1,i=e.getNextBrother();null!=i&&!(t=""!=i.getLabel());)i=i.getNextBrother();return t},hideParentLinks:function(e,t,i){},drawDiffFlags:function(e,i){var n=i.cellView.elements.tags;if(null==n){n=t.createElement("div",{styles:{display:"flex",width:5*this._maxFlagsPerDiff+"px"}});var r=i.cellView.elements.container;r.insertBefore(n,r.children[0]),i.cellView.elements.tags=n}n.innerHTML="";for(var o=0;o<e.length;o++){var s=e[o];t.createElement("span",{styles:{width:"5px",background:s.COLOR}}).inject(n)}},drawLinks:function(e,t){var i=this.hasNextNonEmptyBrother(e.nodeModel),n=e.cellView.elements.linksContainer.getChildren()[0];if(null!=n){var r=n.getChildren();if(!i){var o=r[r.length-1];null==e.nodeModel.getLabel()?o.setStyle("visibility","hidden"):o.setStyle("height","50%")}this.hideParentLinks(e.nodeModel,r,1)}null==e.nodeModel.getLabel()?e.cellView.elements.expanderContainer.hide():(e.cellView.elements.expanderContainer.show(),e.cellView.elements.expanderContainer.setStyle("visibility","visible"),e.cellView.elements.linksContainer.setStyle("visibility","visible"))},onCellRequest:function(e,t){t.defaultOnCellRequest(e),this.drawLinks(e,t)},isScrollbarShown:function(){if(null!=this.dataGridViews){var e=this.dataGridViews[0].elements,t=this.dataGridViews[1].elements;return e.poolContainer.clientHeight>e.container.clientHeight&&t.poolContainer.clientHeight>t.container.clientHeight}return!1},syncExpandCollapse:function(e){function t(t,i){var n=this;return r=>{if(null!=r.data.virtualRowID){for(var o=n.dataGridViews.reduce((t,i)=>i.getTreeDocument()!==e?(t.push(i),t):t,[]),s=0;s<o.length;++s){var a=o[s];if(null!=a){if(!0===a._isSyncing)return;a._isSyncing=!0;let e=a.model.find(({_rowID:e})=>e===r.data.virtualRowID);null==e||void 0===e[t]||null===e[t]?console.log("expandOrCollapse failure"):e[t](),a._isSyncing=!1}}"function"==typeof n[i]&&n[i](r.data)}}}var i=this;e.onPostExpand(t.bind(this)("expand","onExpand")),e.onPostCollapse(t.bind(this)("collapse","onCollapse")),e.onPreExpand(function(e){i.onPreExpand(e.data)}),e.onPreCollapse(function(e){i.onPreCollapse(e.data)})},syncScrolling:function(e){var t=this,i=t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]),n=e._getScroller();n.onScrollBegin(i=>{t._activeScrollingGrid||(t._activeScrollingGrid=e)}),n.onScroll(n=>{t._activeScrollingGrid===e&&setTimeout(()=>{var n=e.getScrollerPosition();i.forEach(e=>e.setScrollerPosition(n)),"function"==typeof t.onScroll&&t.onScroll(n,e)},0)}),n.onScrollEnd(i=>{t._activeScrollingGrid===e&&(t._activeScrollingGrid=null)})},selectByCrNodes:function(e){var t=this;t.withUpdateLocked(()=>{e.forEach((e,i)=>{for(var n=e.__TREENODE__;null!=n&&!n._isVisible();)n=n.getParent();var r=n._getRowID();t.dataGridViews.forEach((e,t)=>{var n=e.model.find(({_rowID:e})=>e===r);if(null!=n&&!n.isSelected()){0===i&&0===t&&e.ensureNodeModelVisible(n,!0,!1,.5),e.selectNodeModel(n,!0,!1)}})})})},subscribeForTreeSync:function(e){var t=this;e.getTreeDocument().subscribe({event:"select"},function(i){var n=i.data.nodeModel._getRowID();t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]).forEach(e=>{var t=e.model.find(({_rowID:e})=>e===n);null==t||t.isSelected()||e.selectNodeModel(t,!0,!1)}),-1===t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.push(n),"function"==typeof t.onSelectRow&&t.onSelectRow())}),e.getTreeDocument().subscribe({event:"unselect"},function(i){var n=i.data.nodeModel._getRowID(),r=t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]),o=!1;r.forEach(e=>{var t=e.model.find(({_rowID:e})=>e===n);null!=t&&t.isSelected()&&(o=!0,e.unselectNodeModel(t))}),1==o&&-1!==t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.splice(t._currentlySelectedRowIDs.indexOf(n),1),"function"==typeof t.onUnselectRow&&t.onUnselectRow())})},prepareUpdateView:function(){this.dataGridViews.forEach(e=>e.prepareUpdateView())},pushUpdateView:function(){this.dataGridViews.forEach(e=>e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0))},withUpdateLocked:function(e){this.prepareUpdateView(),e(),this.pushUpdateView()},setEachGridColorColumns:function(e){this._eachGridColorColumns=e},getNTHGridSelectedNodes:function(e){return this.dataGridViews[e].getNodesXSO().get()},getNTHGrid:function(e){return this.dataGridViews[e]},clearNTHGridSelection:function(e){this.dataGridViews[e].getNodesXSO().empty()},setPanelCaption:function(e,t){this.treesContainer.setPanelCaption(e,t)},destroy:function(){Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&(this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[]),this.clear()},applyFilterModelToTrees:function(e){let i=this,n=!t.equals(e,i.dataGridViews[0].getTreeDocument().getFilterManager().filterModel);this.withUpdateLocked(()=>{i.dataGridViews.forEach(i=>{n?i.getTreeDocument().setFilterModel(t.clone(e,!0)):i.getTreeDocument().reapplyFilterModel()})})}})}),define("DS/CompareWidget2/framework/pluginServices",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareCommon/Utils","DS/CompareWidget2/userSettings/UserSettingsManager","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,i,n,r){return function(o,s,a){this._viewPanelMgr=o,this._eventMgr=s,this._userRunOptions=a,this.makeAuthHttpsCall=function(e,i,n,r,o,s,a){return t.makeAuthHttpsCall(e,i,n,r,o,s,a)},this.getUserRunOptions=function(){return this._userRunOptions},this.loadPref=function(e,i){return t.loadPref(e,i)},this.savePref=function(e,i){return t.savePref(e,i)},this.subscribe=function(e,t){return this._eventMgr.subscribe({event:e},t)},this.unsubscribe=function(e){return this._eventMgr.unsubscribe(e)},this.postEvent=function(e,t){var i=t||{},n=i.isAsync,r=i.catchExceptions;if(widget.recordForODT){let t=null==i?"null":JSON.stringify(JSON.decycle(i));console.log("COMPARE EVENT INPUT: "+e),console.log(e+" DATA: "+t)}this._eventMgr.publish({event:e,data:null==t?null:t,propagate:!0,target:this,isAsync:n,catchExceptions:r})},this.requestFrame=function(e){return this._viewPanelMgr.requestFrame(e)},this.addPanel=function(e,t,i,n,r){return this._viewPanelMgr.addPanel(e,t,i,n,r)},this.makeServiceURL=function(e,t,i,n){return"https:"===i.substring(0,6)?i:r.getPlatformWSUrl(e,t,i,n)},this.createRandomString=function(t,i,n){return e.createRandomString(t,i,n)},this.dbgout=function(t,i){e.dbgout2(!0,t,i)},this.warnout=function(t){e.warnout("[PLUGIN] "+t)},this.errout=function(t){e.errout("[PLUGIN] "+t)},this.enableDebugLabel=function(t){e.enableDebugLabel(t)},this.disableDebugLabel=function(t){e.disableDebugLabel(t)},this.showAlertBox=function(e,t,n,r){return i.showAlertBox(e,t,n,r)},this.confirmDialog=function(e,t,n){return i.confirmDialog(e,"fonticon-attention",t,n)},this.nowMS=function(){return e.nowMS()},this.reportTime=function(t,i){e.reportTime(t,"[PLUGIN]"+i)},this.csValsEquivalent=function(t,i){return e.csValsEquivalent(t,i)},this.getUserSetting=function(e){var t=null;try{t=JSON.parse(n.get(e))}catch{this._plugSvcs.warnout("Failed to retrieve user setting for "+e+"; returning empty string")}return t}}}),define("DS/CompareWidget2/Customization/CompareCustomizationManager",["UWA/Core","DS/CompareWidget2/Customization/Profile","DS/CompareWidget2/support/DataCenter","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/Customization/viewConfigMangler","DS/CompareWidget2/Customization/DictionaryServices","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,r,o,s,a,l){"use strict";const u="/resources/compare2/compareModelerProfiles",c=(e,t,i)=>`${e}_${i}_${t}`,d=(e,t)=>c("profiles",e,t),p=(e,t)=>c("preferred",e,t);function h(e,t){var i=e.findIndex(e=>e.Name===t);return-1===i&&(i=e.findIndex(e=>e.NameNLS===t)),i}function _(e,n,r,o){var s=[];return i.loadPageObject(d(e,o),n,r).then(e=>{if(1==e.success){let o=e.settings.content;if(null!==o)for(var i=0;i<o.length;i++){var n=o[i],r=new t(n);s.push(r)}}return s},e=>s)}function f(e,t){var n=p(e.userName,e.companyId);return i.savePageObject(n,t,e.tenant,e.securityContext)}function g(e,t,n){var r=d(t,e.companyId);return i.savePageObject(r,n,e.tenant,e.securityContext)}var m=function(){this._modelerTemplates=null,this._adminProfiles=[],this._userProfiles=[],this._userPreferred={},this._runContext={},this._profileFacetNLSMap={}};return m.prototype.init=function(e){var t=this;return this.loadCustomizations().then(()=>!e&&t.loadFacetNamesNLS()||Promise.resolve())},m.prototype.areCustomTypesSupported=function(){return!0},m.prototype.loadCustomizations=function(){var e,t=this;return t.profilesLoadCompleted=!1,(e={userName:"",isAdminUser:!1,securityContext:"",tenant:widget.getValue("x3dPlatformId"),companyId:"",customTypeSupport:!1},new Promise(function(t,i){n.getSecurityContextPromise(e.tenant,e.securityContext).then(function(i){e.securityContext=i,e.companyId=i.split(".")[1],r.checkIsAdminUserPromise().then(function(i){e.userName=i.id,e.isAdminUser=i.isAdminUser,t(e)},function(i){console.error("Failed to get Admin/User info: "+i+"... continuing..."),t(e)})},function(i){console.error("Failed to get security context: "+i+"... continuing..."),t(e)})})).then(e=>(t._runContext=e,t._runContext.customTypeSupport=t.areCustomTypesSupported(),null!=t._modelerTemplates?Promise.resolve(t._modelerTemplates):function(e){var t=[];return i.makeAuthHttpsCall(u,"GET",null,"json",e.tenant,"3DSpace",e.securityContext,!0).then(e=>(e.results.forEach(function(e){for(var i of e.data.templates)i.Type="template",i.NameNLS=i.Name,void 0!==i.NLSPath&&null!==i.NLSPath&&""!==i.NLSPath?require([i.NLSPath],function(e){i.NameNLS=e.get(i.Name)},function(e){console.log("COMPARE CUSTOMIZATION - Localization name missing for profile "+i.Name)}):console.log("COMPARE CUSTOMIZATION - Localization path missing for profile "+i.Name),null!=i.Facets&&(i.SelectedTypes=i.Facets.reduce((e,t)=>e.concat(t.ObjectTypes),[]),i.Interfaces=i.Facets.reduce((e,t)=>e.concat(Array.isArray(t.Interfaces)?t.Interfaces:[]),[])),t.push(i)}),Promise.resolve(t)),e=>Promise.resolve(t)).then(t=>t=e.customTypeSupport?a.getAllTypesAndInterfacesInfos(t,e):Promise.resolve(t))}(t._runContext))).then(e=>(t._modelerTemplates=e,function(e){return _("admin",e.tenant,e.securityContext,e.companyId)}(t._runContext))).then(e=>(t._adminProfiles=e,function(e){return _(e.userName,e.tenant,e.securityContext,e.companyId)}(t._runContext))).then(e=>(t._userProfiles=e,function(e){var t={};return i.loadPageObject(p(e.userName,e.companyId),e.tenant,e.securityContext).then(e=>(1==e.success&&(t=e.settings.content),t),e=>t)}(t._runContext))).then(e=>{t._userPreferred=e,t.profilesLoadCompleted=!0})},m.prototype.saveCustomizations=function(){let e={status:!0};var t,i,n=[];this._runContext.isAdminUser&&n.push((t=this._runContext,i=this._adminProfiles,g(t,"admin",i))),n.push(function(e,t){return g(e,e.userName,t)}(this._runContext,this._userProfiles)),n.push(f(this._runContext,this._userPreferred));var r=n.length;return Promise.allSettled(n).then(t=>{for(var i=0,n=t.length;i<n;i++){let n=3===r?i:i+1;"rejected"===t[i].status?(e.status=!1,0===n?console.log("COMPARE CUSTOMIZATION - Save Admin Profiles FAILED"):1===n?console.log("COMPARE CUSTOMIZATION - Save User Profiles FAILED"):2===n&&console.log("COMPARE CUSTOMIZATION - Save preferred profile FAILED")):0===n?console.log("COMPARE CUSTOMIZATION - Save Admin Profiles successful"):1===n?console.log("COMPARE CUSTOMIZATION - Save User Profiles successful"):2===n&&console.log("COMPARE CUSTOMIZATION - Save preferred profile successful")}}),e},m.prototype.cancelCustomizations=function(){return console.log("Canceling profile edits"),this.loadCustomizations().then(function(e){console.log("COMPARE CUSTOMIZATION - Cancel and reload - customizations loaded")},function(e){console.log("COMPARE CUSTOMIZATION - Cancel and reload - failed to load customizations")}),{status:!1}},m.prototype.isTemplateProfile=function(e){return null!=e&&"template"===e.Type},m.prototype.isCustomizationProfile=function(e){return null!=e&&"customization"===e.Type},m.prototype.getTenant=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.tenant:"onPremise"},m.prototype.getSecurityContext=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.securityContext:null},m.prototype.getUserName=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.userName:null},m.prototype.getIsAdminUser=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.isAdminUser:null},m.prototype.getProfileNames=function(e){let t=null,i=this;if(null!=e.objTypes){for(var n=0;n<e.objTypes.length-1;++n)if(e.objTypes[n]!==e.objTypes[n+1])return console.log("LOOKING for profile names that address type '"+e.objTypes[n]+"' and '"+e.objTypes[n+1]+"'. Not supported."),ret;t=e.objTypes[0],console.log("LOOKING for profile names that address type '"+t+"'")}else null!=e.objType?(t=e.objType,console.log("LOOKING for profile names that address type '"+t+"'")):console.log("LOOKING for ALL profile names");function r(e){let n=[];return e.forEach(function(e){var r=!1;if(null==t)r=!0;else{let n=e.fromTemplateProfile?i.getProfile(e.fromTemplateProfile):null;e.SelectedTypes.concat(n?Object.keys(n._TypesInfo):[]).some(function(e){if(t==e)return r=!0,!0})}r&&n.push(null!=e.NameNLS?e.NameNLS:e.Name)}),n}let o=()=>{let t=null!=e&&!0===e.asTree?null:[],i=[],n=null!=e&&1==e.getTemplates?r(this._modelerTemplates):[],o=r(this._adminProfiles),s=r(this._userProfiles);if(null!=e&&!0===e.asTree)t={},n.length>0&&(t.templates=n),o.length>0&&(t.adminProfiles=o),s.length>0&&(t.userProfiles=s);else{let e=o.concat(s);t=i.concat(n,e)}return t};if("function"!=typeof e.callBackAfterProfilesUpdated)return o();if(this.profilesLoadCompleted)e.callBackAfterProfilesUpdated(o());else{let t=setInterval(()=>{this.profilesLoadCompleted&&(clearInterval(t),e.callBackAfterProfilesUpdated(o()))},200)}},m.prototype.getUserPreferredProfileName=function(e){e.getRoles();var t=(e.getTypeArray()||[])[0];return"COMPARE"===e.app?this._userPreferred[t]:null},m.prototype.setUserPreferredProfileName=function(e,t){let i="function"==typeof e.stringify?e.stringify():e;this.isDefaultProfile(t)&&(delete this._userPreferred[i],t="__|DEFAULT|__"),this._userPreferred[i]=t,f(this._runContext,this._userPreferred)},m.prototype.doesUseCaseTemplateProfileExist=function(e){e.getRoles();var t=(e.getTypeArray()||[])[0];return this._modelerTemplates.some(e=>e.SelectedTypes.concat(e._CustomTypesInfo?Object.keys(e._CustomTypesInfo):[]).includes(t))},m.prototype.profileExists=function(e){return-1!=h(this._modelerTemplates,e)||-1!=h(this._adminProfiles,e)||-1!=h(this._userProfiles,e)},m.prototype.isDefaultProfile=function(e){return!this.profileExists(e)},m.prototype.getProfile=function(e){let t=null;if(null!=e&&""!==e){var i=h(this._modelerTemplates,e);if(-1!=i)t=this._modelerTemplates[i];else{var n=h(this._adminProfiles,e);if(-1!=n)t=this._adminProfiles[n];else{var r=h(this._userProfiles,e);-1!=r&&(t=this._userProfiles[r])}}}return t},m.prototype.duplicateProfile=function(e,i){let n=this.getProfile(e),r=new t(n,i,this._runContext.userName,this._runContext.isAdminUser,this._runContext.companyId);return this._runContext.isAdminUser?this._adminProfiles.push(r):this._userProfiles.push(r),r},m.prototype.removeProfile=function(e){let t=h(this._userProfiles,e),i=!1;if(-1!==t)this._userProfiles.splice(t,1),i=!0;else if(this._runContext.isAdminUser){let t=h(this._adminProfiles,e);-1!==t&&(this._adminProfiles.splice(t,1),i=!0)}if(i){let t="";for(const[i,n]of Object.entries(this._userPreferred))if(n===e){t=i;break}""!==t&&this.setUserPreferredProfileName(t,"__|DEFAULT|__")}},m.prototype.applyCustomProfileToViewConfig=async function(t,i){let n=this;try{var a=this.getProfile(t);if(null!=a){let r=["MatchingRules","AdditionalStatuses"].reduce((e,t)=>e.concat((a[t]||[]).reduce((e,t)=>e.concat(t.attributes.map(e=>({uri:e.name,objType:e.objType}))),[])),[]),o=n.getProfile(a.fromTemplateProfile),l=["_CustomTypesInfo","_CustomInterfacesInfo"].reduce((t,i)=>e.extend(t,o[i]||{}),{});return(n.areAllAttrsLoaded()?Promise.resolve():n.getAllAttributes()).then(()=>{let n=r.filter(e=>{let t=!1,i=o._TypesInfo&&o._TypesInfo[e.objType[0]].attributes.find(t=>t.uri===e.uri);if(i){let n=l[e.objType[0]]&&l[e.objType[0]].attributes[i.name];t=n&&"Yes"===n.MultiValuated}return t}).map(e=>e.uri);return i=s.applyCustomProfileToViewConfig(e.merge({MULTI_VALUE_ATTRS:Array.from(new Set(n))},a),i),console.log("VIEWSETMRG-----\x3e>>>>   viewSetMgr is using CUSTOM PROFILE '"+t+"'"),i})}o.errout("Cannot retrieve custom profile '"+t+"', using default configuration"),r.showAlertBox("CUSTOMIZATION_FAILED",l,"error")}catch(e){o.errout("Failed to apply profile customizations; using default configuration"),r.showAlertBox("CUSTOMIZATION_FAILED",l,"error")}},m.prototype.loadFacetNamesNLS=function(){var e=this;let t=[];for(var i of e._modelerTemplates)void 0!==i.NLSPath&&null!==i.NLSPath&&""!==i.NLSPath?t.push(new Promise((t,n)=>{require([i.NLSPath],function(n){for(var r of(e._profileFacetNLSMap[i.NLSPath]={},e._profileFacetNLSMap[i.NLSPath].facet={},i.Facets))e._profileFacetNLSMap[i.NLSPath].facet[r.Name]=n.get(r.Name);t()},function(e){n(),console.log("COMPARE CUSTOMIZATION - Localization path failed to load for profile "+i.Name)})})):console.log("COMPARE CUSTOMIZATION - Localization path missing for profile "+i.Name);return Promise.allSettled(t)},m.prototype.getFacetNameNLS=function(e,t){let i=t;if(null!=e&&""!==e&&void 0!==this._profileFacetNLSMap[e]&&null!==this._profileFacetNLSMap[e]){let n=this._profileFacetNLSMap[e].facet;null!=n&&void 0!==n[t]&&null!==n[t]&&""!==n[t]&&(i=n[t])}return i},m.prototype.areAllAttrsLoaded=function(){return a.areAllAttrsLoaded()},m.prototype.getAllAttributes=async function(){return a.getFacetAttrs(this._modelerTemplates,this._runContext)},m}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel",["DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareCommon/CompareIdDataListItem","DS/CompareCommon/Input/RevisionsManager","DS/CompareCommon/Input/FilterManager","DS/CompareCommon/Input/SearchManager","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController","DS/UIKIT/Mask","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/flagInfo","DS/CompareWidget2/support/typeHierMgr","DS/CompareWidget2/support/attrNLS_mgr","DS/CompareWidget2/support/cw2Utils","i18n!DS/CompareCommon/assets/nls/CompareInput","i18n!DS/CompareCommon/assets/nls/CompareCustomization","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,r,o,s,a,l,u,c,d,p,h,_,f,g,m,S,T,C,E,v){"use strict";const D=["REF_ds6w:label_ATTR"];function I(e,t,i){let n=[];if(null==t||""===t){if(null!=e)for(const[t,r]of Object.entries(e))i&&-1!==r.name.indexOf("INST")||n.push(t),n=n.filter(e=>!D.includes(e))}else{let o="string"==typeof t?[t]:t;for(var r of o)if(null!=e&&null!==r&&""!==r)for(const[t,o]of Object.entries(e))o.origin===r&&(i&&-1!==o.name.indexOf("INST")||n.push(t),n=n.filter(e=>!D.includes(e)))}return 0!=n.length?n:null}return s.extend({init:function(e,i,n,o){this._parent(n),this._plugSvcs=i;let s=[];null!=o&&(s=Object.keys(o)),this._isCustomCompare=s.length>0,this._customAttrNames=o||{},this._statusFilterHideChildIfParentIsHidden=!0,this._skeletonBuilt=!1,this._OKfn_forShowResults=null,this.cellDragEnabledFlag=!!n.CELL_DRAG_ENABLED_FLAG,this._forceRootsTogether=!0,this.elements.container=e,this._showHideNodeParamsOnTypeAndAttribute=n.SHOW_HIDE_NODE_PARAMS,this._aggVisibilityFilterModels={showByStatusFilter:{filterId:"set",filterModel:[1]}},this._allowedDisplayModes=[{id:"tree",icon:"tree-view-all",title:E.StructureView,tooltip:t.generateTooltip("CompareWidget2/Tooltips","StructureView"),expandCollapseEnabled:!0},{id:"list",icon:"view-list",title:E.ListView,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ListView"),expandCollapseEnabled:!1}],this._displayMode="tree",this._multiStatusesToHideAnd=!1,this._statusesHidden=[],this._statusesUnchecked=[],this._structMatchPairArray=[],this._listMatchPairArray=[],this._listIsComputed=!1,this._structIsComputed=!1,this._currentExpandMenuId="expandAll",this._activeColData=null,this._flagInfo=new f(n,i),this._activeTrees=null,this._activeMatchPairArray=[],this._suspendExpandUpdates=!1;var a=n.CONTEXT_MENU_PLUGIN||"DS/CompareWidget2/viewComponents/ContextMenuBase",l=this;require([a],function(e){l._contextMenuPlugin=new e({structComparePanel:l}),l.buildSkeleton(n,l._customAttrNames)},function(e){console.error("FAILED TO LOAD "+a+": msg:"+e)}),this._externalController=new h(this._getActiveTree.bind(this),this.isList.bind(this),i.dbgout),r.setApplyCallback(this,[{whichOne:"left"},{whichOne:"right"}],this.onApplyNGFilter)},getExternalController:function(){return this._externalController},_getActiveTree:function(){return this._activeTrees},buildSkeleton:function(e,t){var i=this.elements.container;this._expandCollapseMenu=new d({structComparePanel:this}),this.standardToolbar=new c(i,this,{navigateDifferences:!0,showCompareLegend:!0,otherMenuItems:this.applyOtherMenuCommands(),CUSTOM_PROFILE_IN_USE:!0===this.options.CUSTOM_PROFILE_IN_USE});var n=e.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,r=e.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR;if(this._structTrees=new l({dataGridConfigArray:this.generateDataGridConfig({baselineColor:n,compareColor:r,displayView:"tree",customAttrNames:t}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),onCollapse:this.onTreesCollapse.bind(this),onExpand:this.onTreesExpand.bind(this),onPreCollapse:this.onTreesPreCollapse.bind(this),onPreExpand:this.onTreesPreExpand.bind(this),baselineColor:n,compareColor:r,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"multiple",cellDragEnabledFlag:this.cellDragEnabledFlag,showNodeKPIColorFlag:null!=t&&Object.keys(t).length>0}),this._structTrees.inject(i),this._listTrees=new l({dataGridConfigArray:this.generateDataGridConfig({baselineColor:n,compareColor:r,displayView:"list",customAttrNames:t}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),baselineColor:n,compareColor:r,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"single",cellDragEnabledFlag:this.cellDragEnabledFlag,showNodeKPIColorFlag:Object.keys(t).length>0}),this._listTrees.inject(i),this._listTrees.hide(),this._skeletonBuilt=!0,null!=this._OKfn_forShowResults){var o=this._OKfn_forShowResults;this._OKfn_forShowResults=null,this._doShowResults(o)}},dragEnterPanel:function(e){var t=this._activeTrees.dataGridViews.every(function(e){return!e.draggingFromCompare});void 0!==e.currentTarget&&null!==e.currentTarget&&t&&e.currentTarget.parentElement.addClassName("ft-drop-cue-on")},dragLeavePanel:function(e){void 0!==e.currentTarget&&null!==e.currentTarget&&e.currentTarget.parentElement.removeClassName("ft-drop-cue-on")},dropHandler:function(n,r,o){if(this._activeTrees.dataGridViews.every(function(e){return!e.draggingFromCompare})){if(r.objArray.length>1)return void this._plugSvcs.showAlertBox("DROP_1_OBJ_REPLACE",v,"error");for(var s=t.fetchPersistedIDs(),a=r.objArray,l=a.map(function(e){return e.objectId}),c=a.map(function(e){var t={};for(var i in e)t[i]=e[i];return t}),d=l.length,p=0;p<d;++p){var h=new i(l[p],c[p]);"drop-left"===o?s.items[0]=h:"drop-right"===o&&(s.items[1]=h)}t.persistIDs(s);var _="drop-left"===o?0:1,f=[];r.objArray.forEach(function(e){var t=new u(e.objectId,e.objectType,e.contextId,e.envId,e.serviceId);f.push(t)}),this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:_,objIDSpecArray:f})}this._activeTrees.dataGridViews.forEach(e=>e.draggingFromCompare=!1),e.reset()},generateDataGridConfig:function(e){return[{cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](e,"baseline"),createTreeNodeConfig:this.createTreeNodeConfig.bind(this),colorIndicator:e.baselineColor,gridViewContainerParams:{id:"tree"===e.displayView?"compare-tree-left":"compare-list-left",panelCaption:"Left",panelAddClass:"treePanel-cmpBase",panelCollapseable:!0,initSize50pct:!0,color:e.baselineColor,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+e.baselineColor,width:"50%"}}},{cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](e,"compare"),createTreeNodeConfig:this.createTreeNodeConfig.bind(this),colorIndicator:e.compareColor,gridViewContainerParams:{id:"tree"===e.displayView?"compare-tree-right":"compare-list-right",panelCaption:"Right",panelAddClass:"treePanel-cmpCmp",panelCollapseable:!1,initSize50pct:!0,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+e.compareColor,padding:"0px 3px",width:"50%"}}}]},getTreeCols:function(e,t,i){let n=this,r=[],o={dataIndex:"tree",typeRepresentation:"string",width:"auto",resizableFlag:!1};if(1==this._isCustomCompare){let s=I(e.customAttrNames,"matching_rule",i),a=I(e.customAttrNames,"additional_status",i);o.text=E.get("TitleColumnHeader"),o.icon={iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS},null!==a&&(o.minWidth=200,o.pinned="left",o.sortableFlag=!1,o.resizableFlag=!0),o.getCellKPIColor=function(i){let n=i.nodeModel.options.data;return n.getMatchInfo().getBaseNode().isDummy()||n.getMatchInfo().getCompNode().isDummy()?null:n.getMatchInfo().isAttributeValueEqual("title")||null==n.getAttr("title")||""===n.getAttr("title")?null:e[`${t}Color`]},o.onCellRequest=function(e){let t=e.cellView.getContent(),i=t.getElement(".wux-layouts-datagridview-kpi-color");if(null!=i){t.removeChild(i);let e=t.getElement(".wux-layouts-datagridview-tweaker-container");i.setStyle("outline-width","2px"),i.setStyle("margin-left","2px"),t.insertBefore(i,e)}},r.push(o),null!==s&&s.forEach(function(i,o){var s={text:e.customAttrNames[i].name,icon:{iconName:e.customAttrNames[i].icon,fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"custAttr_"+e.customAttrNames[i].name,width:150,minWidth:25,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0};null!==a&&(s.pinned="left"),s.getCellKPIColor=function(i){let n=this.columns[i.columnID].dataIndex.split("custAttr_").pop(),r=i.nodeModel.options.data;return r.getMatchInfo().getBaseNode().isDummy()||r.getMatchInfo().getCompNode().isDummy()||"tree"===n?null:r.getMatchInfo().isAttributeValueEqual(n)||null==r.getAttr(n)||""===r.getAttr(n)?null:e[`${t}Color`]},s=n._specializeCol(i,s),r.push(s)}),null!==a&&a.forEach(function(i,o){var s={text:e.customAttrNames[i].name,icon:{iconName:e.customAttrNames[i].icon,fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"custAttr_"+e.customAttrNames[i].name,width:150,minWidth:25,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0,getCellKPIColor:function(i){let n=this.columns[i.columnID].dataIndex.split("custAttr_").pop(),r=i.nodeModel.options.data;return r.getMatchInfo().getBaseNode().isDummy()||r.getMatchInfo().getCompNode().isDummy()||"tree"===n?null:r.getMatchInfo().isAttributeValueEqual(n)||null==r.getAttr(n)||""===r.getAttr(n)?null:e[`${t}Color`]}};s=n._specializeCol(i,s),r.push(s)})}else{r.push(o);let e={dataIndex:"rev",typeRepresentation:"string",width:35,minWidth:25,sortableFlag:!1,resizableFlag:!0};r.push(e)}return r},_specializeCol:function(e,t){switch(e){case"REF_ds6w:status_ATTR":delete(t=UWA.extend(t,{typeRepresentation:"tag",width:90,hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return e.nodeModel.options.data.getAttr("maturity.class")}})).getCellKPIColor;break;case"REF_ds6w:reserved_ATTR":case"INST_ds6w:reserved_ATTR":t=UWA.extend(t,{typeRepresentation:"icon",width:80,getCellValue:function(t){let i=t.nodeModel.options.grid["REF_ds6w:reserved_ATTR"===e?"custAttr_REF.ds6w:reserved":"custAttr_INST.ds6w:reserved"];return"TRUE"===i?"lock":"FALSE"===i?"lock-open":null}});break;case"REF_ds6wg:revision_ATTR":t=UWA.extend(t,{width:80})}return t},getListCols:function(e,t){let i=this.getTreeCols(e,t,!0),n={dataIndex:"qty",width:1==this._isCustomCompare?50:30};return 1==this._isCustomCompare&&null!=I(e.customAttrNames,"additional_status",!0)&&(n.pinned="left",n.sortableFlag=!1,n.resizableFlag=!0,n.minWidth="30"),1==this._isCustomCompare&&(n.text=E.get("QuantityColumnHeader")),i.unshift(n),i},getEachGridColorColumns:function(){for(var e=this,i=[[]],n=[],r=e._flagInfo.getActiveMaxFlags(),o=0;o<r;o++){var s={typeRepresentation:"color",dataIndex:"FLAG_"+o.toString(),width:8.5,minWidth:8.5,hasCellValue:function(t){var i=!1,n=t.columnID,r=this.columns[n].dataIndex;if(r.startsWith("FLAG_")){var o=Number(r.split("_")[1]),s=t.nodeModel.options.data,a=e._areAnyMatchPairChildrenVisible(s),l=s.getMatchInfo().getAllStatusArray(!a);if(Array.isArray(l)&&o<l.length){var u=l[o],c=e._flagInfo.getActiveFlagDisplayData(u);if(null!=c){var d=c.color,h=c.visibleFlag;null!=d&&d!==p.colorDef.WHITE&&1==h&&(i=!0)}}}return i},getCellTooltip:function(i){var n,r,o=null==i.nodeModel?null:i.nodeModel.options.data.getMatchInfo();o&&(r=o.getAllStatusArray(!0));var s,a=Number(i.columnID),l=e._flagInfo.getActiveFlagDisplayData();if(Array.isArray(r)&&a<r.length&&r.length>0){var u=l[r[a]];if(null!=u.color&&u.visibleFlag){n=u.label;var c=u.modulePath;Object.entries(E).map(([e,i])=>{i===n&&(s=t.generateTooltip(c,e))})}}return s}};this._isCustomCompare&&null!=I(this._customAttrNames,"additional_status",this.isList())&&(s.pinned="left",s.resizableFlag=!1,s.sortableFlag=!1),s.onCellRequest=function(e){this.defaultOnCellRequest(e),e.cellView.getContent().addClassName("compare-color-column")},n.push(s)}return i.push(n),i},createTreeNodeConfig:function(e){var t={data:e,label:e.getAttr("title"),icons:[e.getAttr("typeIconSmallURL")],grid:{rev:e.getAttr("revision"),type:e.getAttr("type"),showByStatusFilter:1}},i=e.getCustomRuleAttrs();(null!=i?Object.keys(i):[]).forEach(function(e,n){["ds6w:created","ds6w:modified"].some(t=>-1!==e.indexOf(t))?t.grid["custAttr_"+e]=S.formatDate(i[e]):t.grid["custAttr_"+e]=i[e]});var n=e.getMatchInfo(),r=this;return t.grid.showHideNodeOnTypeAndAttribute=n.getShowHideNodeByTypeAndAttrParamIndex(),"relations"!==e.getAttr("type")&&(t.grid.qty=e.qty),e.hasExternalFilter()&&(t.badges={bottomRight:"filter wux-layouts-treeview-badge compare-badge"}),n.getAllStatusArray(!0).forEach(function(e,i){var n=r._flagInfo.get_statusIDFlag(e);t.grid["FLAG_"+i]=n.color}),t},applyOtherMenuCommands:function(){var e=this,i=[];return this._allowedDisplayModes.some(e=>e.expandCollapseEnabled)&&i.push({id:"expandCollapse",dataElements:{domId:"compare-struct-expansion-button",typeRepresentation:"functionIcon",label:E.chooseTreeExpansion,tooltipInfos:t.generateTooltip("CompareWidget2/Tooltips","chooseTreeExpansion"),position:"far",priority:1,overflowPriority:"never",icon:{iconName:"expandAll"===e._currentExpandMenuId?"flow-tree-expand-down":"flow-tree-expand-up",fontIconFamily:1},value:t=>e._displayMenu(e._expandCollapseMenu.getExpandCollapseMenu(),t.dsModel.elements.container)}}),e._allowedDisplayModes.length>1&&i.push({id:"structPanelViewSelector",dataElements:{domId:"compare-struct-display-style-button",typeRepresentation:"functionIcon",label:E.chooseTreeOrListView,tooltipInfos:t.generateTooltip("CompareWidget2/Tooltips","chooseTreeOrListView"),position:"far",icon:{iconName:e._allowedDisplayModes.find(t=>t.id===e._displayMode).icon,fontIconFamily:1},priority:1,overflowPriority:"never",value:t=>{e._displayMenu(e._allowedDisplayModes.map(t=>({type:"RadioItem",title:t.title,id:t.id,tooltip:t.tooltip,icon:t.icon,state:e._displayMode===t.id?"selected":"unselected",action:{callback:()=>e.handleToolbarCommands({event:"displayView",data:{mode:t.id,tooltip:t.tooltip,icon:t.icon}})}})),t.dsModel.elements.container)}}}),i},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],n=>{var r=t.getBoundingClientRect(),o={position:{x:r.right,y:r.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,o)})},destroy:function(){this._externalController.destroy(),this._externalController=null,this.elements.container=null,this._activeTrees=null,null!=this._structTrees&&(this._structTrees.destroy(),this._structTrees=null),null!=this._listTrees&&(this._listTrees.destroy(),this._listTrees=null),this.overview=null,this._plugSvcs=null,this._structMatchPairArray=null,this._listMatchPairArray=null,this._activeMatchPairArray=null},handleToolbarCommands:function(e){switch(e.event){case"legendApplyFilter":this.applyStatusFilters(),this._updateToolbarDiffCount(),this._updateUserFilterSettings("legendFilter");break;case"legendApplyVisibility":this._showStatusChooserDialog(e);break;case"navigatePrevious":case"navigateFirst":case"navigateLast":case"navigateNext":this.onNavigate(e.event);break;case"displayView":this._displayMode!==e.data.mode&&(this.showResults(e.data.mode),this.standardToolbar.update({displayIcon:[{id:"structPanelViewSelector",icon:e.data.icon}],enableDisableCommands:[{id:"expandCollapse",disabled:this.isList()}]}));break;case"expandAll":case"collapseAll":case"expandNLevels":this.standardToolbar.update({displayIcon:[{id:"expandCollapse",icon:e.data.icon}]}),this._currentExpandMenuId=e.event,"expandNLevels"===e.event?this._expandNLevels_showPopup():this._expandCollapse("collapseAll"!==e.event,-1);break;case"revisionsDlg":this._displayHistoryGraph(e.data.whichSide,e.data.objIDSpecREF);break;case"filterPanel":this._displayFilterPanel(e.data.whichSide,e.data.objIDSpecREF)}},_updateUserFilterSettings:function(e){let t=this;function i(e,i,n){let r=t._flagInfo.getActiveFlagDisplayData();for(let[o,s]of Object.entries(r))o!==n&&(!0===s[e]&&t[i].indexOf(o)>=0?t[i]=t[i].filter(e=>e!==o):!1===s[e]&&-1===t[i].indexOf(o)&&(t[i]=[...t[i],o]))}switch(e){case"legendFilter":i("checked","_statusesUnchecked");break;case"legendVisibility":i("visibleFlag","_statusesHidden","IDENTICAL")}},_expandNLevels_showPopup:function(e){var t=this;require(["DS/PADUtils/views/PADLevelSel"],function(i){new i({current_level:1,events:{onApply:function(e){t._expandCollapse(!0,parseInt(e)||-1)}}});if(null!=e&&void 0!==e.position&&null!==e.position&&e.position.x>0&&e.position.y>0){var n=jQuery(".pad_level_sel_modal > .modal-wrap");null!=n&&n.length>0&&(n[0].setStyle("padding-top","0px"),n[0].setStyle("margin-top",e.position.y+"px"),n[0].setStyle("margin-left",e.position.x+"px"))}})},_expandCollapse:function(e,t){var i=this;"tree"===this._displayMode&&(this._activeTrees.withUpdateLocked(()=>{i.beginSuspendExpandUpdates(),i._activeTrees.dataGridViews.forEach((n,r)=>{i._activeTrees.getNTHGridSelectedNodes(r).forEach(i=>{if(i.hasChildren()){var n={};-1==t?n.expandAll=!0:n.numberOfLevelsToExpand=t;try{e?-1==t?i.expandAll():(i.collapseAll(),i.expandNLevels(n)):i.collapseAll()}finally{}}else i.options.data.setExpandCollapseState("noExpandState")})}),i.endSuspendExpandUpdates()}),this.applyCurrentFilterToTrees())},getStatusFilterInfo:function(){var e=[],t=[],i=this._flagInfo.getActiveFlagDisplayData(),n=i.IDENTICAL.checked;return Object.keys(i).forEach(function(r){var o=i[r];0==o.checked||0==n&&0==o.visibleFlag?e.push(r):t.push(r)}),{offFlags:e,onFlags:t}},applyStatusFilters:function(){var e=this;0==_.isMasked(e.elements.container)&&_.mask(e.elements.container),setTimeout(()=>{let t=e.isList(),i=e.getStatusFilterInfo();e._updateMatchPairHiddenFlags_AND_ApplyToTreeNode(t,i.offFlags,e._multiStatusesToHideAnd),e._activeTrees.applyFilterModelToTrees(e._aggVisibilityFilterModels),e.doExpandCollapseUpdates(),e.onTreesSelectRow(),_.unmask(e.elements.container)},0)},_updateMatchPairHiddenFlags_AND_ApplyToTreeNode:function(e,t,i){let n=i?"both":"either",r={};t.forEach(function(e){r[e]=!0});let o=e?this._crTree.getCRList().getMatchPairArray():this._crTree.getMatchPairArray(),s=o.length;for(let t=e?0:1;t<s;t++){let i=o[t],s=i.getRelName(),a=1==r[s];"both"==n?a&&e&&i.qtyIsDiffFlag&&(a&=1==r.QUANTITY):a||e&&i.qtyIsDiffFlag&&r.QUANTITY&&(a=!0),"both"==n?a&&i.getAdjFlagArray().forEach(function(e){a&=1==r[e]}):a||i.getAdjFlagArray().forEach(function(e){r[e]&&(a=!0)});let l=i.getBaseNode().getParent(),u=i.getCompNode().getParent(),c="object"!=typeof l||"object"!=typeof u,d=!0;if(this.isList()||c||!this._statusFilterHideChildIfParentIsHidden)d=!a;else{let e=l.getMatchInfo();d=this._statusFilterHideChildIfParentIsHidden&&!a&&e&&!e.getIsHidden_byStatusFilter()}i.setIsHidden_byStatusFilter(!d);let p=Number(d);i.getTreeNodes().forEach(e=>e.options.grid.showByStatusFilter=p)}},legendApplyVisibility:function(e){let t=this._flagInfo.getActiveFlagDisplayData(),i=[];var n=!0;for(let[r,o]of Object.entries(e))n=n&&o,t[r].visibleFlag!==o&&(t[r].visibleFlag=o,i.push({id:r,visibleFlag:o}));return i.length&&(t.IDENTICAL.matchedPairs.length||i.push({id:"IDENTICAL",visibleFlag:!n}),this.standardToolbar.update({showHideCommands:i}),this.doExpandCollapseUpdates()),{bAtLeastOneHidden:!n,bApplyChanges:i.length>0}},_showStatusChooserDialog:function(){var e=this._flagInfo.getActiveFlagDisplayData(),t=this;require(["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog"],i=>{new i({statuses:e,OKfn:e=>{let i=this.legendApplyVisibility.bind(this)(e);i.bApplyChanges&&(this._updateUserFilterSettings("legendVisibility"),this._updateToolbarDiffCount()),i.bAtLeastOneHidden&&t._plugSvcs.showAlertBox(v.HIDDEN_STATUSES_IDENTICAL,null,"info")}})})},getDifferenceCount:function(){let e=this._flagInfo.getActiveFlagDisplayData();return this._activeMatchPairArray.filter(t=>t.getAllStatusArray().some(t=>"IDENTICAL"!==t&&e[t].checked&&e[t].visibleFlag)&&t.getBaseNode().__TREENODE__.isVisible()).length},clearView:function(){this._activeTrees&&this._activeTrees.clear()},getAttrNLS:function(e,t){let i={},n=[];for(const[t,r]of Object.entries(e))i[t]=r.name,void 0!==r.objType&&(n.includes(r.objType)||n.push(r.objType));var r=t.getRootObjIDSpec(0),o=r.getObjType(),s=r.getTenant(),a=r.getSecurityContext();return m.getAttrNLS(i,o,n,s,a)},updateResults:function(e,t){var i=this;return i._crTree=t,i._listIsComputed=!1,i._structIsComputed=!1,i._plugSvcs.postEvent("COMPARE_PANEL_UPDATED_EVENT",{}),i.showResults()},_resetTypeFiltersOn:function(e){Object.keys(e).forEach(function(t){e[t].checked=!0})},_applyStatusDisplaySettings:function(e){for(let[t,i]of Object.entries(e))i.visibleFlag="IDENTICAL"===t?i.matchedPairs.length>0||Array.isArray(this._statusesHidden)&&this._statusesHidden.length>0&&this._statusesHidden.some(t=>null!=e[t]&&e[t].matchedPairs.length):Array.isArray(this._statusesHidden)&&-1===this._statusesHidden.indexOf(t)},showResults:function(e){var t=this;return t._allowedDisplayModes.findIndex(t=>t.id===e)>=0&&(t._displayMode=e),new Promise(function(e,i){0==t._skeletonBuilt?t._OKfn_forShowResults=e:t._doShowResults(e)})},_setupDnD:function(){var t=this;e.attachObject("compare-tree-left",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler),e.attachObject("compare-tree-right",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler),e.attachObject("compare-list-left",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler),e.attachObject("compare-list-right",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler)},_placeAttrNLSinTooltips:function(e,t){for(const[n,r]of Object.entries(e))if(void 0!==r.tooltip.shortHelp&&null!==r.tooltip.shortHelp&&r.tooltip.shortHelp.length>0){let o="";for(var i of r.tooltip.shortHelp){let e=i.name;"and"===i.info?o+=" "+C.get("RuleAnd")+" ":"or"===i.info&&(o+=" "+C.get("RuleOr")+" "),void 0!==t[e]&&null!==t[e]&&""!==t[e]?o+=t[e]:o+=e}let s=E.get("same"===r.tooltip.shortHelp[0].info?"CustomMatchingRuleShortHelp":"CustomAdditionalStatusShortHelp").replace("{msgData}",o);e[n].tooltip.shortHelp=s,e[n].tooltip.longHelp=E.get("CustomLegendLongHelp")}},_updateTrees:function(e,t,i,n){var r=this;r._activeTrees.update(e,t,i,function(){r._setupDnD();var e=r._flagInfo.getActiveFlagDisplayData_excludeFilteredByTypeAttr();void 0===r.options.PROPS||null===r.options.PROPS?r._updateTrees_finish(e,n):r.getAttrNLS(r.options.PROPS,r._crTree).then(function(i){t&&r._placeAttrNLSinTooltips(e,i),r._updateTrees_finish(e,n)},function(t){console.error("Failed to retrieve NLS values for attributes in legend tooltips. Continuing..."),r._updateTrees_finish(e,n)})}.bind(r))},_updateTrees_finish:function(e,t){this.onTreesReady(e),this.onResize(),this._syncOverview(),this._updateToolbarDiffCount(),_.unmask(this.elements.container),t()},_doShowResults:function(e){var t=this;0==_.isMasked(t.elements.container)&&_.mask(t.elements.container),"tree"===t._displayMode?t.setup_tree():t.setup_list(),t._applyStatusDisplaySettings(t._flagInfo.getActiveFlagDisplayData()),t._resetTypeFiltersOn(t._flagInfo.getActiveFlagDisplayData()),t._activeTrees.setEachGridColorColumns(t.getEachGridColorColumns()),1==t.options.CUSTOM_PROFILE_IN_USE?t.getAttrNLS(t.options.PROPS,t._crTree).then(function(i){var n=i;t._updateTrees(t._activeColData,!0,n,e)},function(e){console.error("Failed to retrieve NLS header values for attrs. Continuing..."),t._updateTrees(t._activeColData,!0,{},OKfb)}):t._updateTrees(t._activeColData,!1,{},e)},setup_tree:function(){var e=this;e._structIsComputed||(e._structMatchPairArray=e._crTree.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._structMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("tree",e._structMatchPairArray,e._forceRootsTogether),e._structIsComputed=!0),e._listTrees&&e._listTrees.hide(),e._structTrees&&e._structTrees.show(),e._activeColData=[e._crTree.getRoot(0),e._crTree.getRoot(1)],e._activeMatchPairArray=e._structMatchPairArray,e._flagInfo.setActive("tree"),e._activeTrees=e._structTrees},setup_list:function(){var e=this;e._listIsComputed||(e._crList=e._crTree.getCRList(),e._listMatchPairArray=e._crList.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._listMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("list",e._listMatchPairArray,e._forceRootsTogether),e._listColData=e._crList.generateDisplayLists(),e._listIsComputed=!0),e._listTrees&&e._listTrees.show(),e._structTrees&&e._structTrees.hide(),e._activeColData=e._listColData,e._activeMatchPairArray=e._listMatchPairArray,e._flagInfo.setActive("list"),e._activeTrees=e._listTrees},onResize:function(){null!=this.overview&&(this.overview.onResize(),this.updateOverviewVisibility())},updateOverviewVisibility:function(){this._activeTrees.isScrollbarShown()?this.overview.show():this.overview.hide()},determineNodesToShow:function(e,t,i,n){var r="select"===i||null===e?t:e,o=this._flagInfo.getActiveFlagDisplayData(),s=!0,a=!0;for(var l in o)o[l].checked||(s=!1),o[l].checked&&(a=!1);if(a);else if(s){var u=r.getPath();""!==u&&n.push({IDPath:u})}else this._filterForStatusFlags(r,r===t,n)},_buildHideList:function(){for(var e={},t=this._listMatchPairArray,i=t.length,n=0;n<i;n++){var r=t[n],o="",s=r.getBaseNode();0==s.isDummy()&&(o=s.getAttr("physicalID_REF"));var a="",l=r.getCompNode();0==l.isDummy()&&(a=l.getAttr("physicalID_REF")),t[n].getIsHidden_byStatusFilter()&&(""!=o&&(e[o]=!0),""!=a&&(e[a]=!0))}return e},_filterForStatusFlags:function(e,t,i){var n=this._buildHideList(),r=this.isList();e.visitVisible_nodesAndFN(function(o){var s=!1;if(o!==e||!t){var a=o.getMatchInfo(),l="",u=a.getBaseNode();0==u.isDummy()&&(l=u.getAttr("physicalID_REF"));var c="",d=a.getCompNode();0==d.isDummy()&&(c=d.getAttr("physicalID_REF")),(""!=l&&1==n[l]||""!=c&&1==n[c])&&(s=!0)}var p=0!=o.getChildArray().length;if(0==s){if(!p){var h=o.getPath();return""!==h&&i.push({IDPath:h}),!1}return!0}return r})},onTreesSelectRow:function(e){var t=this;let i=!0===this._viewerDisplayModeIsolate?"isolate":"select";var n=this._activeTrees.getNTHGridSelectedNodes(0),r=this._activeTrees.getNTHGridSelectedNodes(1);if(!e||0!=n.length&&0!=r.length){var o=[],s=[],a=this.isList();if(a){[n,r].forEach(function(e,n){var r=[],a=[];e.forEach(function(e){var o=e.options.data;if(!o.isDummy()){var s=o.getAttr("physicalID_REF"),l=o.getAttr("physicalID_INST");t._crTree.visitVisible_treeAndFN(n,function(e){if(e.getAttr("physicalID_REF")==s){"isolate"===i&&t.determineNodesToShow(e,t._crTree.getDisplayRoot(n),i,a);var o=e.getDBContext(),c=new u(s,e.getAttr("type"),o.securityContext,o.tenant,o.serviceName),d=null;null!=l&&(d=new u(l,e.getAttr("type"),o.securityContext,o.tenant,o.serviceName));var p={ObjIDSpec:c,IDPath:e.getPath(),instObjIDSpec:d};r.push(p)}return!0})}}),"select"!==i&&0!==e.length||t.determineNodesToShow(null,t._crTree.getDisplayRoot(n),i,a),o.push(r),s.push(a)})}else{var l=[],c=[],d=[],p=[];n.forEach((e,n)=>{var o=e.options.data,s=null,a=null,u=o.getPath();"isolate"===i&&this.determineNodesToShow(o,t._crTree.getDisplayRoot(0),i,d),null==o||o.isDummy()||(s=o.getObjIDSpec_REF(),a=o.getObjIDSpec_INST()),null!=s&&l.push({ObjIDSpec:s,IDPath:u,instObjIDSpec:a});var h=n<r.length?r[n].options.data:null,_=null!==h?h.getPath():null;if("isolate"===i&&this.determineNodesToShow(h,t._crTree.getDisplayRoot(1),i,p),null!=h&&!h.isDummy()){var f=h.getObjIDSpec_REF(),g=null;g=h.getObjIDSpec_INST()}null!=f&&c.push({ObjIDSpec:f,IDPath:_,instObjIDSpec:g})}),"select"!==i&&0!==n.length||(this.determineNodesToShow(null,t._crTree.getDisplayRoot(0),i,d),this.determineNodesToShow(null,t._crTree.getDisplayRoot(1),i,p)),o.push(l),o.push(c),s.push(d),s.push(p)}t._plugSvcs.postEvent("NEW_CURRENT_SELECTION_EVENT",{isAsync:!0,selectedData:o,crTree:t._crTree,structDisplayMode:a?"LIST":"STRUCT"}),this._syncOverview()}},onTreesUnselectRow:function(){this._syncOverview(),this.onTreesSelectRow(!0)},onTreesPreCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesPreExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},onTreesExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},beginSuspendExpandUpdates:function(){this._suspendExpandUpdates=!0},endSuspendExpandUpdates:function(){this._suspendExpandUpdates=!1,this.doExpandCollapseUpdates()},doExpandCollapseUpdates:function(){0==this._suspendExpandUpdates&&(this.onResize(),this._syncOverview(),setTimeout(()=>{this._updateToolbarDiffCount()},0))},onTreesExpandAll:function(e){this._expandCollapse(!0,-1)},buildOverviewKeyDiffArray:function(e){for(var t=this,i=[],n=e.getTreeDocument().getAllDescendants(),r=0;r<n.length;r++){var o=n[r];if(o.isVisible()){var s=[],a=o.options.data._matchInfo;if(a){var l=a.getBaseNode(),u=t._areAnyMatchPairChildrenVisible(l);a.getAllStatusArray(!u).forEach(function(e){let i=t._flagInfo.get_statusIDFlag(e);s.push(i)})}else{let e=t._flagInfo.get_statusIDFlag("IDENTICAL");s.push(e)}var c={objKey:r,flagDefArray:s,qtyDiff:!1};i.push(c)}}return i},onTreesReady:function(e){var t=this;this._applyShowHideNodesByTypeAndAttributes(),this._updateTreePanelCaptions(),null==this.overview&&(this.overview=new a,this.overview.inject(this.elements.container)),this.dispatchEvent("onTreesLoaded"),this._syncOverview(),this.standardToolbar.update({legend:e,enableDisableCommands:[{id:"expandCollapse",disabled:!this._allowedDisplayModes.find(e=>t._displayMode===e.id).expandCollapseEnabled},{id:"chooseStatusToDisplay",disabled:1===Object.keys(e).length&&null!=e.IDENTICAL&&e.IDENTICAL.visibleFlag}],modulePath:"CompareWidget2/Tooltips"})},_updateToolbarDiffCount:function(){let e=this.getDifferenceCount();this.standardToolbar.update({numDifferences:e})},_syncOverview:function(){if(void 0!==this.overview&&null!==this.overview){var e=this.buildOverviewKeyDiffArray(this._activeTrees.dataGridViews[1]);this.updateOverviewVisibility();var t=this._activeTrees.getNTHGridSelectedNodes(0),i=[];t.forEach(function(e){var t=e._getRowID();i.push(t)});var n=this._flagInfo.getActiveFlagDisplayData();this.overview.syncWithNewData(!0,e,i,n,this.isList())}},_displayHistoryGraph:function(e,i){var r=this;let o={objId:i.getPhysID(),objType:i.getObjType(),tenant:i.getTenant(),securityContext:i.getSecurityContext()};n.displayHistoryGraph(o,null,{allowDuplicates:!0},function(i){let n="left"===e?0:1,o=t.fetchPersistedIDs();o.items[n].objectId=i.physicalid,o.items[n].objectServices.objectId=i.physicalid,o.items[n].objectServices.objectType=i.type,o.items[n].objectServices.contextId=i.contextId,o.items[n].objectServices.displayName=i.displayName,o.items[n].objectServices.serviceId=i.serviceId,t.persistIDs(o);let s=new u(i.physicalid,i.type,i.contextId,i.envId);r._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:n,objIDSpecArray:[s]})})},_displayFilterPanel:function(e,t){var i={objId:t.getPhysID(),objType:t.getObjType(),tenant:t.getTenant(),securityContext:t.getSecurityContext(),serviceName:t.getServiceName()};r.activateProxy(e),r.executeFilterCmd(e,i)},onApplyNGFilter:function(e){const i=e.appId.startsWith("CompareWidget_right")?"right":"left",n="left"===i?0:1;let o=e.empty?null:e;var s=t.fetchPersistedIDs();s.items[n].filterData=o,e.empty?(s.items[n].filterSpec=null,t.persistIDs(s)):r.getFilterSpecificationPromise(i,o.filterRootIds[0]).then(function(e){1===e.status&&(s.items[n].filterSpec=e.publicSpec),t.persistIDs(s)},function(){t.persistIDs(s)});let a=s.items[n].objectServices;var l=new u(a.objectId,a.objectType,a.contextId,a.envId,a.serviceId,o);this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:n,objIDSpecArray:[l]})},_displaySearchPanel:function(e,i){var n=this,r=i.getTenant(),s=i.getSecurityContext(),a="left"===e?0:1;o.displaySearchPanel(r,!1,function(e){let i=e[0];if(null!=i){var o=i.id;[].push(o);var l=i.sourceid_value.split(":"),c={contextId:s,displayName:i["ds6w:label_value"],displayType:i["ds6w:type"],envId:l.length>1?l[1]:r,objectId:i.id,objectType:i["ds6w:type_value"],serviceId:l[0],preview_url:i.preview_url_value,type_icon_url:i.type_icon_url_value};[].push(c);var d=t.fetchPersistedIDs();d.items[a].objectId=c.objectId,d.items[a].objectServices.objectId=c.objectId,d.items[a].objectServices.objectType=c.objectType,d.items[a].objectServices.contextId=c.contextId,d.items[a].objectServices.displayName=c.displayName,d.items[a].objectServices.serviceId=c.serviceId,t.persistIDs(d);var p=new u(c.objectId,c.objectType,c.contextId,c.envId,c.serviceId);n._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:a,objIDSpecArray:[p]})}})},getTreePanelCaptions:function(){function e(e,t,i,n){var r=null;return t&&((r={}).label=[],r.label.push({text:t.getAttr("title")}),r.label.push({text:t.getAttr("revision"),id:"treePanel-caption-revision-"+n,onClick:function(){e._displayHistoryGraph(n,i)}}),t.hasExternalFilter()&&r.label.push({text:t.getExternalFilterName(),id:"treePanel-caption-filter-"+n,onClick:function(){e._displayFilterPanel(n,i)}}),r.dropDown={id:"treePanel-caption-dropdown-"+n,onClick:function(){e._displayMenu(r.dropDown.item.map(e=>({type:"PushItem",title:e.text,icon:e.icon,action:{callback:e.onClick}})),this)}},r.dropDown.item=[],!1!==i._supportsRevisions&&r.dropDown.item.push({text:T.get("revisionCM"),icon:"flow-branch-list",onClick:function(){e._displayHistoryGraph(n,i)}}),!1!==i._supportsFilters&&r.dropDown.item.push({text:T.get("filterCM"),icon:"filter",onClick:function(){e._displayFilterPanel(n,i)}}),r.dropDown.item.push({text:T.get("openCM"),icon:"open",onClick:function(){e._displaySearchPanel(n,i)}})),r}var t=[],i=this._crTree.getRoot(1).getMatchInfo();if(i){let n=this._crTree.getRootObjIDSpec(0),r=this._crTree.getRootObjIDSpec(1),o=e(this,i.getBaseNode(),n,"left"),s=e(this,i.getCompNode(),r,"right");o&&s&&(t.push({panelContentId:this.isList()?"compare-list-left":"compare-tree-left",panelCaption:o}),t.push({panelContentId:this.isList()?"compare-list-right":"compare-tree-right",panelCaption:s}))}return t},_updateTreePanelCaptions:function(){var e=this;this.getTreePanelCaptions(this._addedEvents).forEach(function(t){e._activeTrees.setPanelCaption(t.panelContentId,t.panelCaption)})},onNavigate:function(e){var t=this._activeTrees.dataGridViews[0].getNodesXSO().get(),i=this._activeMatchPairArray;var n=-2;if("navigateFirst"===e)n=-1,e="navigateNext";else if("navigateLast"===e)n=i.length,e="navigatePrevious";else if(Array.isArray(t)&&t.length){var r=(t=t[t.length-1]).options.data.getMatchInfo();n=i.findIndex(e=>r===e)}if(-2!==n){var o=function(e,t,n){for(var r="navigateNext"===t?1:-1,o=e+r,s=i.length;"navigateNext"===t?o<s:o>=0;o+=r)if(i[o].getBaseNode().__TREENODE__.isVisible())for(let e of i[o].getAllStatusArray(!0))if("IDENTICAL"!==e&&n[e].visibleFlag)return i[o];return null}(n,e,this._flagInfo.getActiveFlagDisplayData());null!=o&&this._activeTrees.withUpdateLocked(function(){this._activeTrees.clearNTHGridSelection(0),o.getBaseNode().__TREENODE__.select(),this._activeTrees.dataGridViews[0].ensureNodeModelVisible(o.getBaseNode().__TREENODE__,!0,1)}.bind(this))}},getActiveExpandMenuId:function(){return this._currentExpandMenuId},isList:function(){return"list"===this._displayMode},getLabel:function(){return E.CompareStructurePanelTitle},getName:function(){return"structures"},onComparePanelUpdated:function(){void 0!==this._contextMenuPlugin&&null!==this._contextMenuPlugin&&this._contextMenuPlugin.onComparePanelUpdated()},onActivate:function(){setTimeout(()=>{this.onResize(),this._syncOverview()},0)},_setupShowHideNodesByTypeAndAttributeFilterModel:function(){Array.isArray(this._showHideNodeParamsOnTypeAndAttribute)&&this._showHideNodeParamsOnTypeAndAttribute.length?this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute={filterId:"set",filterModel:this._showHideNodeParamsOnTypeAndAttribute.reduce((e,t,i)=>(!0===t.show&&e.push(i),e),[-1])}:delete this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute},_applyShowHideNodesByTypeAndAttributes:function(){this._setupShowHideNodesByTypeAndAttributeFilterModel(),this._activeTrees.applyFilterModelToTrees(this._aggVisibilityFilterModels)},applyCurrentFilterToTrees:function(){this._activeTrees.applyFilterModelToTrees(this._aggVisibilityFilterModels),this._syncOverview()},_setup_allMatchPair_hiddenByTypeAttr:function(e){function t(e,t){return Array.isArray(t.TYPE)&&null!=e&&-1!==t.TYPE.findIndex(t=>e.getAttr("REF.ds6w:type")===t||g.isKindOf(e.getAttr("REF.ds6w:type"),t))&&(null==t.ATTRIBUTES||null!=t.ATTRIBUTES&&Object.keys(t.ATTRIBUTES).every(i=>t.ATTRIBUTES[i]===e.getAttr(i)))}this._setupShowHideNodesByTypeAndAttributeFilterModel();var i=this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute,n=this;e.forEach(function(e){isNaN(e.getShowHideNodeByTypeAndAttrParamIndex())&&(Array.isArray(n._showHideNodeParamsOnTypeAndAttribute)&&n._showHideNodeParamsOnTypeAndAttribute.length?e.setShowHideNodeByTypeAndAttrParamIndex(n._showHideNodeParamsOnTypeAndAttribute.findIndex(i=>{var n=i.CHILD,r=i.PARENT,o=e.getBaseNode();(null==o||o.isDummy())&&(o=e.getCompNode());let s=o.getRefInstNode(),a=null!=s?s.getParent():null,l=t(s,n),u=null!=a&&(!r||null!=r&&t(a,r));return l&&u})):e.setShowHideNodeByTypeAndAttrParamIndex(-1))}),e.forEach(function(e){var t=e.getShowHideNodeByTypeAndAttrParamIndex(),n=null==i||i.filterModel.indexOf(t)>=0;e.setIsHidden_byTypeAttr(!n)})},_areAnyMatchPairChildrenVisible:function(e){var t=!1;if("expanded"==e.getExpandCollapseState()){var i=e.getChildArray();if(null!=i)for(var n=0;n<i.length;n++){if(0==i[n].getMatchInfo().getIsHidden_byAnyFilter()){t=!0;break}}}return t}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel"],function(e,t){"use strict";return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},onEnabled:function(){var e=this;return e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("3DVIEW_NODES_SELECTED_EVENT",function(e){var t=e.data.nodePathArray;this._outputPanel._viewerDisplayModeIsolate||this._outputPanel.getExternalController().setSelectedNodes(t)}.bind(this)),e.subscribeEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",function(e){if(!this._outputPanel._viewerDisplayModeIsolate){var t=this._outputPanel.getExternalController();t&&t.clearSelectedNodes(),this._plugSvcs.postEvent("NO_CURRENT_SELECTION_EVENT",{})}}.bind(this)),e.subscribeEvent("COMPARE_PANEL_UPDATED_EVENT",function(e){this._plugSvcs.dbgout("Struct Plugin handling compare panel updated"),this._outputPanel.onComparePanelUpdated()}.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",e._outputPanel.onTreesSelectRow.bind(e._outputPanel),e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.multi_statuses_to_hide_and","_multiStatusesToHideAnd",null,e._outputPanel),this._pluginOptions&&this._pluginOptions.SHOW_HIDE_NODE_PARAMS&&this._pluginOptions.SHOW_HIDE_NODE_PARAMS.forEach(t=>{t.hasOwnProperty("SHOW")&&"string"==typeof t.SHOW?e.syncSetting(t.SHOW,"show",e._outputPanel._applyShowHideNodesByTypeAndAttributes.bind(e._outputPanel),t):t.hasOwnProperty("SHOW")&&"boolean"==typeof t.SHOW?t.show=t.SHOW:t.show=!0}),e._parent()},createViewPanelObject:function(e,i){var n={};return i.CUSTOM_PROFILE_IN_USE&&(n=i.PROPS),new t(e,this._plugSvcs,i,n)},execute:function(e,t){var i=this;i._parent(e,t);var n=e.crTreeArray;i._outputPanel.updateResults(t,n[0]).then(function(e){i.showNotBusy(),i.reportOK(n)},function(e){i.reportKO(e)})}})}),define("DS/CompareWidget2/ViewDefModules/PartViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.ds6wg:revision",NAME:"REF.name",DFR:"REF.dfr",XFORM:"INST.matrixtxt"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1},r={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",MATCH_ADJ:-1}]},o={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:t.colorDef.YELLOW,NLS:"MOVED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0},s={colorLeft:o.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:o.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR};return{CV_PROPS:i,ATTRIBUTE_DISPLAY_OPTIONS:s,INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0,colorLeft:s.colorLeft,colorRight:s.colorRight},STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:r,STRUCT_DISPLAY_OPTIONS:o}}),define("DS/CompareWidget2/ViewDefModules/PartViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PartViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/framework/useCase",["DS/CompareWidget2/support/cw2Utils"],function(e){"use strict";var t=function(e,t,i){this.app=e,this.roles=t,this.typeInfoArray=i.map(e=>({type:e.getObjType(),service:e.getServiceName(),interfaces:e.getInterfaces()}));var n=i[0].getSecurityContext();Object.defineProperty(this,"securityContext",{enumerable:!1,get:()=>n})};return t.prototype.getApp=function(){return this.app},t.prototype.getRoles=function(){return this.roles},t.prototype.getSvcArray=function(){return this.typeInfoArray.map(e=>e.service)},t.prototype.getTypeArray=function(){return this.typeInfoArray.map(e=>e.type)},t.prototype.getSvcTypeArray=function(){return this.typeInfoArray.map(e=>e.service+e.type)},t.prototype.equals=function(t){return e.stringify(this)==e.stringify(t)},t.prototype.stringify=function(){return e.stringify(this)},t}),define("DS/CompareWidget2/ViewDefModules/CATProductViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid",DFR:"REF.dfr",INST_LOGID:"INST.logicalid",XFORM:"INST.matrixtxt"},n={DB_PROPS:{...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"},CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!0,USE_MCS:!1},r={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},o={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!1},s={colorLeft:o.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:o.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:r,STRUCT_DISPLAY_OPTIONS:o,ATTRIBUTE_DISPLAY_OPTIONS:s}}),define("DS/CompareWidget2/ViewDefModules/CATProductViewDefs",["DS/CompareWidget2/ViewDefModules/CATProductViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"]]}]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTrees",["UWA/Controls/Abstract","UWA/Core","DS/DataGridView/DataGridView","DS/CompareWidget2/widget/controls/TreesContainer","DS/CompareWidget2/widget/controls/TreePanel","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTreesViewActions","DS/CompareWidget2/support/typeHierMgr"],function(e,t,i,n,r,o,s){"use strict";return e.extend({init:function(e){this._parent({});let t=this;this._options=e.options,this._plugSvcs=e.plugSvcs,this._flagDD=e.flagDD,this._gridView=e.gridView,this._structComparePanelCBs=e.structComparePanelCBs,this._flagDD.updateFlagDisplayData(e.compareTreeDocumentArray),this._currentlySelectedRowIDs=[],this.treeContainers=[],this.onContextMenu=this._structComparePanelCBs.onContextMenu,this._viewActions=new o(this,this._plugSvcs,this._structComparePanelCBs),this.treeContainers=[],this.treePanels=[],this.treesContainer=new n,this._gridView.getDGVContainersConfig().forEach(function(e){var i=new r({caption:e.panelCaption,addClass:e.panelAddClass,contentId:e.id,contentBorderTop:e.styles["border-top"],collapseable:e.panelCollapseable,initSize50pct:!!e.initSize50pct&&e.initSize50pct,colorIndicator:e.color});t.treePanels.push(i),t.treeContainers.push(i.elements.content),t.treesContainer.addPanel(i)}),this.elements.container=this.treesContainer.elements.container},destroy:function(){Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&(this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[]),this.clear()},getDisplayMode:function(){return this._gridView.getDisplayMode()},getFlagDisplayData:function(){return this._flagDD},getGridView:function(){return this._gridView},getMatchPairArray:function(){return this._compareTreeDocumentArray[0].__CRTREE__.getMatchPairArray()},show:function(){this.getContent().style.display="flex"},clear:function(){this.treeContainers.forEach(e=>e.empty()),Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[]},withUpdateLocked:function(e){this._prepareUpdateView(),e(),this._pushUpdateView()},getNTHGridSelectedNodes:function(e){return this.dataGridViews[e].getNodesXSO().get()},getNTHGrid:function(e){return this.dataGridViews[e]},clearNTHGridSelection:function(e){this.dataGridViews[e].getNodesXSO().empty()},setPanelCaption:function(e,t){this.treesContainer.setPanelCaption(e,t)},isScrollbarShown:function(){if(null!=this.dataGridViews){var e=this.dataGridViews[0].elements,t=this.dataGridViews[1].elements;return e.poolContainer.clientHeight>e.container.clientHeight&&t.poolContainer.clientHeight>t.container.clientHeight}return!1},updateTrees:function(e,t){var i=this;this._compareTreeDocumentArray=e,i._flagDD.updateFlagDisplayData(e);let n=this._compareTreeDocumentArray[0].__CRTREE__.getRootObjIDSpec(0);this.clear(),this.show(),i._gridView.getColDefs(n,i.renderTreeCB.bind(i),i._flagDD).then(function(e){let n=e;i._updateTreesWithGridColumnDefs(n,t)},function(e){console.error("FAILED: "+e)})},onSelectRow:function(){this._viewActions.onTreesSelectRow()},_onDragStartCell:function(e,t){this.draggingFromCompare=!0;var i=[],n=t.nodeModel._options.data,r=n._attrList,o=n.getDBContext();if(!n.isDraggable())return e.preventDefault(),!1;var s=n.getPath().split("/").map(function(e){return{resourceid:e}});i.push({contextId:o.securityContext,envId:o.tenant,objectId:r.physicalID_REF,objectType:r.type,path:s,serviceId:o.serviceName});var a={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:i}};return e.dataTransfer.setData("Text",JSON.stringify(a)),!0},_onDragOverCell:function(){return!0},_onDragEndCell:function(){return this.draggingFromCompare=!1,!0},renderTreeCB:function(e,t){this.dataGridViews[e].defaultOnCellRequest(t),this._drawLinks(t),this._adjustTitleKPIPosition(t)},_drawLinks:function(e){var t=this._hasNextNonEmptyBrother(e.nodeModel),i=e.cellView.elements.linksContainer.getChildren()[0];if(null!=i){var n=i.getChildren();if(!t){var r=n[n.length-1];null==e.nodeModel.getLabel()?r.setStyle("visibility","hidden"):r.setStyle("height","50%")}}null==e.nodeModel.getLabel()?e.cellView.elements.expanderContainer.hide():(e.cellView.elements.expanderContainer.show(),e.cellView.elements.expanderContainer.setStyle("visibility","visible"),e.cellView.elements.linksContainer.setStyle("visibility","visible"))},_adjustTitleKPIPosition:function(e){let t=e.cellView.getContent(),i=t.getElement(".wux-layouts-datagridview-kpi-color");if(null!=i){t.removeChild(i);let e=t.getElement(".wux-layouts-datagridview-tweaker-container");i.setStyle("outline-width","2px"),i.setStyle("margin-left","2px"),t.insertBefore(i,e)}},_hasNextNonEmptyBrother:function(e){for(var t=!1,i=e.getNextBrother();null!=i&&!(t=""!=i.getLabel());)i=i.getNextBrother();return t},onDataGridViewsReady:function(e){let t=this;this.dataGridViews.forEach(e=>{t.syncScrolling(e),t.syncExpandCollapse(e.getTreeDocument()),t.subscribeForTreeSync(e)}),e()},syncExpandCollapse:function(e){function t(t,i){var n=this;return r=>{if(null!=r.data.virtualRowID){for(var o=n.dataGridViews.reduce((t,i)=>i.getTreeDocument()!==e?(t.push(i),t):t,[]),s=0;s<o.length;++s){var a=o[s];if(null!=a){if(!0===a._isSyncing)return;a._isSyncing=!0;let e=a.model.find(({_rowID:e})=>e===r.data.virtualRowID);null==e||void 0===e[t]||null===e[t]?console.log("expandOrCollapse failure"):e[t](),a._isSyncing=!1}}null!=i&&i(r.data)}}}var i=this;e.onPostExpand(t.bind(this)("expand",i._viewActions.onTreesExpand.bind(i._viewActions))),e.onPostCollapse(t.bind(this)("collapse",i._viewActions.onTreesCollapse.bind(i._viewActions))),e.onPreExpand(function(e){i._viewActions.onTreesPreExpand(e.data)}),e.onPreCollapse(function(e){i._viewActions.onTreesPreCollapse(e.data)})},syncScrolling:function(e){var t=this,i=t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]),n=e._getScroller();n.onScrollBegin(i=>{t._activeScrollingGrid||(t._activeScrollingGrid=e)}),n.onScroll(n=>{t._activeScrollingGrid===e&&setTimeout(()=>{var n=e.getScrollerPosition();i.forEach(e=>e.setScrollerPosition(n)),"function"==typeof t.onScroll&&t.onScroll(n,e)},0)}),n.onScrollEnd(i=>{t._activeScrollingGrid===e&&(t._activeScrollingGrid=null)})},subscribeForTreeSync:function(e){var t=this;e.getTreeDocument().subscribe({event:"select"},function(i){var n=i.data.nodeModel._getRowID();t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]).forEach(e=>{var t=e.model.find(({_rowID:e})=>e===n);null==t||t.isSelected()||e.selectNodeModel(t,!0,!1)}),-1===t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.push(n),"function"==typeof t._viewActions.onTreesSelectRow&&t._viewActions.onTreesSelectRow())}),e.getTreeDocument().subscribe({event:"unselect"},function(i){var n=i.data.nodeModel._getRowID(),r=t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]),o=!1;r.forEach(e=>{var t=e.model.find(({_rowID:e})=>e===n);null!=t&&t.isSelected()&&(o=!0,e.unselectNodeModel(t))}),1==o&&-1!==t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.splice(t._currentlySelectedRowIDs.indexOf(n),1),"function"==typeof t._viewActions.onUnselectRow&&t._viewActions.onUnselectRow())})},applyFilters:function(e,t){null!=t.statusFilterArgs&&this._applyStatusFilters(t.statusFilterArgs),this._applyFilterModels_toDataGridViews(e)},_applyStatusFilters:function(e){let t=e.hiddenStatusArray,i=e.filterOnState;this._plugSvcs.dbgout("Applying status filter; filterOn: "+i+", hide: {"+t.join(", ")+"}");let n={};t.forEach(function(e){n[e]=!0});let r=this.getMatchPairArray(),o=r.length,s=0;r[0].getBaseNode().getChildArray().length>0&&(s=1);for(let e=s;e<o;e++){let t=r[e],o=t.getAllStatusArray(),s=!1,u=!0,c=o.length;for(var a=0;a<c;a++){let e=o[a];if(1==n[e]){if(s=!0,"ANY"==i)break}else u=!1}var l=1==s&&"ANY"==i||1==u&&"ALL"==i;let d=t.getBaseNode().getParent(),p=t.getCompNode().getParent();if("object"==typeof d&&"object"==typeof p&&1==this._statusFilterHideChildIfParentIsHidden){1==d.getMatchInfo().getIsHidden_byStatusFilter()&&(l=!0)}t.setIsHidden_byStatusFilter(l);let h=1==l?0:1;t.getTreeNodes().forEach(e=>e.options.grid.showByStatusFilter=h)}},_applyFilterModels_toDataGridViews:function(e){let i=this,n=!t.equals(e,i.dataGridViews[0].getTreeDocument().getFilterManager().filterModel);this.withUpdateLocked(()=>{i.dataGridViews.forEach(i=>{n?i.getTreeDocument().setFilterModel(t.clone(e,!0)):i.getTreeDocument().reapplyFilterModel()})})},_updateTreesWithGridColumnDefs:function(e,n){let r=this;for(var o=0;o<e.length;o++){let n=e[o];var s=t.createElement("div",{class:"compare_tree_list_view"});s.inject(this.treeContainers[o]);var a=new i({enableListSelection:!0,columnDragEnabledFlag:!1,treeDocument:this._compareTreeDocumentArray[o],columns:n,cellDragEnabledFlag:this._options.CELL_DRAG_ENABLED_FLAG,defaultColumnDef:{minWidth:8.5},layoutOptions:{rowsHeader:0===o},rowSelection:this._gridView.getDisplayMode().rowSelection,onContextualEvent:function(e){return new Promise(function(t){r.onContextMenu(e).then(function(e){t(e)})})},onDragStartCell:this._onDragStartCell,onDragOverCell:this._onDragOverCell,onDragEndCell:this._onDragEndCell(),selectionBehavior:{unselectAllOnEmptyArea:!1,selectOnContextualEvent:!0}});a.elements.container.style.top="4px",a.layout.columnsHeader=!0,a.layout.rowsHeader=!1,a.cellSelection="none",a.showCellActivationFlag=!1,a.selected=[],this.dataGridViews.push(a),a.inject(s)}Promise.all(this.dataGridViews.map(e=>new Promise(t=>e.onPostUpdateViewOnce(()=>t())))).then(()=>this.onDataGridViewsReady(n)),this.withUpdateLocked(function(){r.dataGridViews.forEach((e,t)=>{e.getTreeDocument().getRoots()[0].select()}),"function"==typeof r._viewActions.onSelectRow&&r._viewActions.onSelectRow()})},selectByCrNodes:function(e){var t=this;t.withUpdateLocked(()=>{e.forEach((e,i)=>{for(var n=e.__TREENODE__;null!=n&&!n._isVisible();)n=n.getParent();var r=n._getRowID();t.dataGridViews.forEach((e,t)=>{var n=e.model.find(({_rowID:e})=>e===r);if(null!=n&&!n.isSelected()){0===i&&0===t&&e.ensureNodeModelVisible(n,!0,!1,.5),e.selectNodeModel(n,!0,!1)}})})})},_prepareUpdateView:function(){this.dataGridViews.forEach(e=>e.prepareUpdateView())},_pushUpdateView:function(){this.dataGridViews.forEach(e=>e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0))}})}),define("DS/CompareWidget2/support/EventManager",["DS/CoreEvents/ModelEvents","DS/CompareWidget2/support/cw2Utils"],function(e,t){return e.extend({init:function(e){var t=e||{};this._parent(t)},publish:function(e){var i=e.isAsync,n=e.catchExceptions,r=this,o=r._parent;try{1==i?setTimeout(function(){o.call(r,e)},0):o.call(r,e)}catch(i){if(t.warnout("EXCEPTION publishing event '"+e.event+"' : "+i.stack),1!=n)throw i}}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/effectivityComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.CompareEffectivityPanelTitle},getName:function(){return"EFFECTIVITY_VIEW"},getDomId:function(){return"effectivity"}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/instanceAttrComparePanel","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/effectivityComparePanel","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,r){return e.extend({onEnabled:function(){var e=this;return{instProps:[{eventName:"INST_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"INST_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(r.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"INST_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"INST_PROPS_OFF_DURING_LIST_COMPARE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"INST_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}],effectivity:[{eventName:"EFFECTIVITY_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"EFFECTIVITY_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(r.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"EFFECTIVITY_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_NONE_AVAILABLE_MSG")}},{eventName:"EFFECTIVITY_OFF_DURING_LIST_COMPARE",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"EFFECTIVITY_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}],refProps:[{eventName:"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"REF_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(r.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"REF_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"REF_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}]}["InstAttrDisplay"===this._name?"instProps":"EffectivityDisplay"===this._name?"effectivity":"refProps"].forEach(function(t){e.subscribeEvent(t.eventName,t.fn.bind(e))}),e._parent()},showMessageAndSignalOK:function(e){this.showMessage(r[e]),this.reportOK()},onAttrFetchFailure:function(){this.showNotBusy()},createViewPanelObject:function(e,r){let o=null;return o=null!=r&&!0===r.isEffectivity?new n(e,this._plugSvcs,r):null!=r&&!0===r.isInstance?new i(e,this._plugSvcs,r):new t(e,this._plugSvcs,r)},execute:function(e,t){var i=this;i._parent(e,t),i._outputPanel.showResults(e).then(function(e){i.showNotBusy(),i.reportOK(e)},function(e){i.reportKO(e)})}})}),define("DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList"],function(e,t,i,n,r){var o=function(){this._opCount=0,this._descendantEvals=0,this._matchCount=0,this._propCompArray=[],this._adjArray=[],this._masked_lut={},this._RELATIONSHIP_NAMES=null,this._CUSTOM_MATCH_ADJUSTMENTS=null,this._COMPUTE_DIFFERENT=null,this._maxAdjScore=0};function s(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t}return o.prototype._evalAdjustment=function(e,t){for(var i=0,n=[],r=0;r<this._adjArray.length;r++){var o=this._adjArray[r],s=o.propName0,a=o.propName1,l=e.getAttr(s),u=t.getAttr(a),c="EQ"==o.flagOn;if(null!=l&&null!=u)if(l==u==c){o.MATCH_ADJ;n.push(o.adjName),i+=o.adjScore}}return 0!=i&&this._plugSvcs.dbgout("EVAL","----\x3e>> [ADJUSTMENT] : Adj: "+i+", FLAGS: "+n),{adjIndex:this._maxAdjScore-i,adjFlagArray:n}},o.prototype._evalOnDescendants=function(e,t){for(var i=this,n=e.getChildArray(),r=t.getChildArray(),o=null,a=1;null==o&&a<=1e3&&n.length>0&&r.length>0;)this._plugSvcs.dbgout("EVAL"," Looking in child generation "+a),n.forEach(function(e){r.forEach(function(t){var n=i._eval(e,t);if(i._descendantEvals++,null!=n){var r=i._evalAdjustment(e,t);(null==o||n<o.relIndex||n==o.relIndex&&r.adjIndex<o.adj.adjIndex)&&(o={generation:a,relIndex:n,adj:r})}})}),null==o&&(a++,n=s(n),r=s(r));return o},o.prototype._buildRelListArray=function(e,t,i){var n=this;n._plugSvcs.dbgout("EVAL"," >>> buildRelLists() is looking for all matches among ("+e.length+" x "+t.length+") nodes");for(var o=new r(e,t),s=0;s<e.length;s++)for(var a=e[s],l=0;l<t.length;l++){var u=t[l],c=null;if(i){n._plugSvcs.dbgout("EVAL"," evaluating descendants of nodes ("+s+","+l+")");var d=n._evalOnDescendants(a,u);if(null==d)n._plugSvcs.dbgout("EVAL"," Descendants of nodes ("+s+","+l+") have nothing in common");else{c=d.relIndex;var p=d.adj;o.add(s,l,c,n._RELATIONSHIP_NAMES[c],p.adjIndex,p.adjFlagArray)}}else if(null!==(c=n._eval(a,u))){p=n._evalAdjustment(a,u);o.add(s,l,c,n._RELATIONSHIP_NAMES[c],p.adjIndex,p.adjFlagArray)}}return o},o.prototype._eval=function(e,t){for(var i=this,n=null,r=0,o=i._propCompArray.length,s=0;s<o;s++){var a=i._propCompArray[s],l=a.propName0,u=a.propName1,c=e.getAttr(l),d=t.getAttr(u);i._opCount++,null!=c&&c==d&&(r+=a.truthBit)}var p=i._masked_lut.length;for(s=0;s<p;s++){var h=i._masked_lut[s];(r&h.mask)==h.maskedScore&&(n=h.relIndex)}if(null!==n){i._matchCount++;var _=i._RELATIONSHIP_NAMES[n];i._plugSvcs.dbgout("EVAL"," ----\x3e>> rel: "+_+",    SCORE: "+r+":      "+e.getAttr("REF.ds6w:label")+"  <vs>  "+t.getAttr("REF.ds6w:label"))}return n},o.prototype._evalNodeSet=function(e,t,i){var n={};if(0==e.length)this._plugSvcs.dbgout("EVAL"," evalNodeSets() has "+t.length+" nodes that are 'RIGHT-ONLY'"),n={riMatchedNodePairArray:[],riUnmatchedArray_base:[],riUnmatchedArray_comp:t};else if(0==t.length)this._plugSvcs.dbgout("EVAL"," evalNodeSets() has "+e.length+" nodes that are 'LEFT-ONLY'"),n={riMatchedNodePairArray:[],riUnmatchedArray_base:e,riUnmatchedArray_comp:[]};else{var r=" evalNodeSets() is LOOKING for BEST matches among ("+e.length+" x "+t.length+") nodes";i&&(r+=" // evaluating based on child rels..."),this._plugSvcs.dbgout("EVAL",r);var o=this._buildRelListArray(e,t,i),s=o.getResult();n={riMatchedNodePairArray:s.riMatchedNodePairArray,riUnmatchedArray_base:s.riUnmatchedNodeArray_base,riUnmatchedArray_comp:s.riUnmatchedNodeArray_comp},o.destroy(),o=null,s=null}return n},o.prototype._evalChildNodes=function(e,t){var i={},n=this._evalNodeSet(e,t,!1);0==n.riMatchedNodePairArray.length&&this._plugSvcs.dbgout("EVAL"," <<< there were NO MATCHES among the nodes >>>");var r=null;if(1==this._COMPUTE_DIFFERENT){var o=n.riUnmatchedArray_base,s=n.riUnmatchedArray_comp;o.length>0&&s.length>0&&(this._plugSvcs.dbgout("EVAL"," >>> looking for diff..."),r=this._evalNodeSet(o,s,!0))}if(null!=r){for(var a=0;a<r.riMatchedNodePairArray.length;a++){var l=r.riMatchedNodePairArray[a];l.relIndex=this._RelName2Index.DIFFERENT,l.relName="DIFFERENT"}i={riMatchedNodePairArray:[...n.riMatchedNodePairArray,...r.riMatchedNodePairArray],riUnmatchedArray_base:r.riUnmatchedArray_base,riUnmatchedArray_comp:r.riUnmatchedArray_comp}}else i=n;return i},o.prototype._initInternals=function(e){var t=this;t._CUSTOM_MATCH_ADJUSTMENTS=e.CUSTOM_MATCH_ADJUSTMENTS,t._COMPUTE_DIFFERENT=e.COMPUTE_DIFFERENT,t._maxAdjScore=0;var i=e.PROPS,n=e.CUSTOM_COMPARISONS,r=e.CUSTOM_RELATIONSHIP_NAMES,o=e.SYSTEM_RELATIONSHIP_NAMES;t._RELATIONSHIP_NAMES=[...r,...o],t._RelName2Index={},t._RELATIONSHIP_NAMES.forEach(function(e,i){t._RelName2Index[e]=i}),t._adjArray=[];for(var s=null==t._CUSTOM_MATCH_ADJUSTMENTS?0:t._CUSTOM_MATCH_ADJUSTMENTS.length,a=0;a<s;a++){var l=t._CUSTOM_MATCH_ADJUSTMENTS[a],u=l.PROPS,c=u[0],d=u[1],p=i[c],h=i[d],_=l.MATCH_ADJ;t._adjArray[a]={adjName:l.NAME,propName0:p,propName1:h,flagOn:l.FLAG_ON,adjScore:_,truthBit:1<<a},_>0&&(t._maxAdjScore+=_)}var f=[];a=0;Object.keys(n).forEach(function(e){var r=n[e],o=r[1].length;if(0==f.length)for(var s=0;s<o;s++)f[s]={val:0,mask:0};var l=r[0],u=l[0],c=l[1],d=i[u],p=i[c];t._propCompArray[a]={compName:e,propName0:d,propName1:p,truthBit:1<<a};var h=r[1],_=h.length;for(s=0;s<_;s++)"EQ"==h[s]&&(f[s].val+=1<<a),"N/A"==h[s]&&(f[s].mask+=1<<a);a++});var g=[],m=f.length;for(a=0;a<m;a++){f[a].val;var S=-1;0!=f[a].mask&&(S=~f[a].mask),g.push({relIndex:a,maskedScore:f[a].val,mask:S})}t._masked_lut=g},o}),define("DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/support/tenantServiceContext_IDList"],function(e,t,i,n){return e.extend({onLoad:function(){return this._engine=new t,!0},onEnabled:function(){return this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels"),!0},onDestroy:function(){this._engine=null},getAllChildren:function(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t},compareChildrenNodes:function(e,t){var n=[],r=[];e.forEach(function(e){null==e._matchInfo&&n.push(e)}),t.forEach(function(e){null==e._matchInfo&&r.push(e)});for(var o=this._engine._evalChildNodes(n,r,!0),s=o.riMatchedNodePairArray.length,a=0;a<s;a++){var l=o.riMatchedNodePairArray[a],u=l.adjFlagArray,c=l.relName,d=l.riNode_base,p=l.riNode_comp,h=new i(c,u,d,p);d.setMatchInfo(h),p.setMatchInfo(h)}},compareAllGenerationChildren:function(e,t){for(var i=1,n=e,r=t;i<=50&&n.length>0;)this.compareChildrenNodes(n,r),n=this.getAllChildren(n),r=this.getAllChildren(r),i++},execute:function(e,t){var i=this;if(i._objIn=e,!0===this.showDocs||"true"===this.showDocs||!0===this.showOtherRels||"true"===this.showOtherRels){i._parent(e,t),i._engine._plugSvcs=i._plugSvcs,i._engine._initInternals(t),i._engine._COMPUTE_DIFFERENT=!0,i._objIn=e;var n=i._objIn.crTreeArray[0].getRoot(0),r=i._objIn.crTreeArray[0].getRoot(1),o=n.getChildArray(),s=r.getChildArray();i.compareAllGenerationChildren(o,s)}var a=i._objIn;null!=a?i.reportOK(a):i.reportKO()}})}),define("DS/CompareWidget2/widget/mainFrame",["UWA/Controls/Abstract","DS/CompareWidget2/widget/inputFrame","DS/CompareWidget2/widget/resultFrame","DS/CompareWidget2/widget/compareCustomizationFrame","DS/UIKIT/Mask","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,r){return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this.elements.container=UWA.createElement("div",{id:"main-frame",styles:{height:"100%"}}),this._ccm=i,this._frameSet=[],this._eventTokens=[],this._lastFrameIndex=-1,this._currFrameIndex=-1,this._buildSkeleton(this._eventMgr,t,i)},_buildSkeleton:function(e,r,o){this._frameSet[0]=this._buildViewFrame(t,e,r,o),this._frameSet[1]=this._buildViewFrame(i,e,r,o),this._frameSet[2]=this._buildViewFrame(n,e,r,o),this._showFrame(0),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_resetToDropFrame"},this._handler_resetToInputframe.bind(this))),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_showControlCenter"},this._handler_showControlCenter.bind(this))),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_controlCustomizationDone"},this._handler_controlCenterDone.bind(this)))},destroy(){this._destroyAllFrames(),this._stopAllListening()},_destroyAllFrames:function(){for(var e=0;e<this._frameSet.length;e++){var t=this._frameSet[e].destroy;null!=t&&"function"==typeof t&&t()}this._frameSet=null},_stopAllListening:function(){for(var e=0;e<this._eventTokens.length;e++)this._eventMgr.unsubscribe(this._eventTokens[e]),this._eventTokens[e]=null;this._eventTokens=null},_buildViewFrame:function(e,t,i,n){var r=new e(t,i,n);return r.inject(this.elements.container),r},_showFrame:function(e,t){this._lastFrameIndex=this._currFrameIndex,this._currFrameIndex=e;for(var i=0;i<this._frameSet.length;i++)i==e?this._frameSet[i].show(t):this._frameSet[i].hide();r.unmask(this.elements.container)},_handler_resetToInputframe:function(){this.showInputFrame(!0)},_handler_showControlCenter:function(e){this.showControlCenterFrame(e)},_handler_controlCenterDone:function(e){if(this._showFrame(this._lastFrameIndex),!0===e.status){let e=this.getResultFrame();null!=e&&e.onProfileManagerDone()}},resetResultFrame:function(){let e=this._frameSet[1]._runOptions,t=this._frameSet[1]._CCM;this._frameSet[1].destroy(),this._frameSet[1]=this._buildViewFrame(i,this._eventMgr,e,t)},getResultFrame:function(){return this._frameSet[1]},getInputFrame:function(){return this._frameSet[0]},getCustomizationFrame:function(){return this._frameSet[2]},hideAllShowBusy:function(){this._frameSet[0].hide(),r.mask(this.elements.container)},showInputFrame:function(e){e&&this._frameSet[0].clearPersistedInputs(),this._showFrame(0)},showResultFrame:function(){this._showFrame(1)},showControlCenterFrame:function(e){this._showFrame(2,e)},refreshFrame:function(){this._frameSet[this._currFrameIndex]&&"function"==typeof this._frameSet[this._currFrameIndex].refreshFrame&&this._frameSet[this._currFrameIndex].refreshFrame()},isResultViewActive:function(){return 1===this._currFrameIndex}})}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel",["DS/CustomizableLayout/View","DS/ENOPAD3DViewer/PAD3DViewer","DS/DMU3DCompareAPI/DMU3DCompareAPI","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController","DS/UIKIT/Mask","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i,n,r,o){"use strict";return e.extend({init:function(e,t,i){this._parent(),this.__startTime=t.nowMS(),t.reportTime(this.__startTime,"[3DVIEW] Creating new view3DComparePanel"),this._plugSvcs=t,this._viewer3D=null,this._compareAPI3D=null,this._colors={BASELINE:i.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,COMPARE:i.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,COMMON:"#EEEEEE"},this._viewerIsLoaded=!1,this._initialCompareDone=!1,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.buildSkeleton(e),t.reportTime(this.__startTime,"[3DVIEW] view3DComparePanel construction finished")},buildSkeleton:function(e){this.elements.container=e,this._viewer3D=this._buildPAD3DViewer()},destroy:function(){null!=this._viewer3D&&(this._viewer3D.empty(),null!=this._viewer3D.flushModel&&this._viewer3D.flushModel(),this._viewer3D.destroy(),this._viewer3D=null),this._compareAPI3D=null,this._plugSvcs=null,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.elements=null},_buildPAD3DViewer:function(){var e=this,i={widget:widget,css_view_class:"windowed",visuProgressiveTileModel:!0,allowAuthoring:!1,activateProbes:!1,actionbar_corrected:!0,interwidgetComAvailability:!1,supportWorldOrientation:!0,windowOptions:{workbench:"CompareViewerCmd.xml",workbenchModule:"CompareWidget",robotVisibility:!1,automaticReframePolicy:!0,allowDnD:!1,defaultStatusBarVisibility:!1,defaultContextualMenuVisibility:!0,defaultContextualBarVisibility:!0,viewerOptions:{highlight:{activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!0,primitive:!1,trapSelection:!0,trapGPU:!0,trapPrimitive:!1}},contextualMenuContent:{workbenchName:"CompareViewerContextualBar",module:"CompareWidget",fileName:"CompareViewerContextualBar.xml",geometry:{firstLevel:["CompareViewerFocusOnHdr","ReframeOnHdr"],toggleVisu:null}}}};e._plugSvcs.reportTime(e.__startTime,"[3DVIEW] Creating PAD3DViewer");var n=new t(i);e._plugSvcs.reportTime(e.__startTime,"[3DVIEW] PAD3DViewer created");var r=n.subscribe({event:"onReady"},function(){n.unsubscribe(r),e._plugSvcs.reportTime(e.__startTime,"[3DVIEW] pad3DViewer reports ready"),e._padReadyCB()});return n},_padReadyCB:function(){var e=this,t=!1,r=widget.getPreferences();r.forEach(e=>{"xPref_3DEXPERIENCE_PLATFORM"!==e.name&&"pad_security_ctx"!==e.name||"hidden"===e.type||(e.type="hidden",t=!0)}),t&&widget.setPreferences(r),e._viewer3D.render().inject(e.elements.container);var o=e._viewer3D.getHideShowController();e._exclusiveHideShowController=new n(o);if(e._compareAPI3D=new i(e._viewer3D._frmWindow,{activateXHighlight:!0,ctxViewer:e._viewer3D}),e._compareAPI3D.setLegendVisibleFlag(!1),e._viewerIsLoaded=!0,null!=e._deferred_showResultsArg){var s=e._deferred_showResultsArg;e._deferred_showResultsArg=null,e._doShowResults(s)}},showResults:function(e){var t=this;return new Promise(function(i,n){t._compareOKFn=i,t._compareKOfn=n,0==t._viewerIsLoaded?t._deferred_showResultsArg=e:(t._initialCompareDone=!1,t._doShowResults(e))})},_doShowResults:function(e){this.__startTime=this._plugSvcs.nowMS(),this._plugSvcs.reportTime(this.__startTime,"[3DVIEW] view3DComparePanel._doShowResults() called");var t=this;t._loadViewerJSONS(e).then(function(i){if(t._do3DCompare(e),t._initialCompareDone=!0,t._deferred_updateSelectedArg){var n=t._deferred_updateSelectedArg;t._deferred_updateSelectedArg=null,setTimeout(function(){t._doUpdateSelected(n,!1),t._signalCompareDone(!0)},0)}else t._signalCompareDone(!0)},function(e){t._signalCompareDone(!1)})},_signalCompareDone:function(e){var t=this,i=null;t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] Signaling compare is done"),i=1==e?t._compareOKFn:t._compareKOFn,t._compareOKFn=null,t._compareKOFn=null,null==i?this._plugSvcs.errout("trying to signal 3DCompare done but no report function available"):i()},_loadViewerJSONS:function(e){var t=this;return new Promise(function(i,n){var r=t._viewer3D.subscribe({event:"onLoadingComplete"},function(){t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] EVENT: PAD3DViewer.onLoadingComplete"),t._viewer3D.unsubscribe(r),t._viewer3D.reframe(),i()}),o=t._viewer3D.subscribe({event:"onEndProgressiveLoad"},function(e){t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] EVENT: PAD3DViewer.onEndProgressiveLoad"),1==e.memoryFull&&t._plugSvcs.showAlertBox("Load Failed / Out of Memory",null,"error"),t._viewer3D.unsubscribe(o)});t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] will now call PAD3DViewer.loadJSON()"),t._viewer3D.loadJSON({data:e})})},_do3DCompare:function(e){var t=this;try{t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] Will now call DMU3DCompareAPI.compare()");var i=t._getViewerPath(e[0].rootID),n=t._getViewerPath(e[1].rootID),r=t._buildDMUOptions(i,n);null!=t._compareAPI3D&&t._compareAPI3D.compare(r),t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] DMU3DCompareAPI.compare() now finished")}catch(e){t._plugSvcs.showAlertBox("3DComparison failed",null,"error"),t._plugSvcs.errout("Exception performing 3D Compare: "+e.stack)}},updateSelected:function(e,t){var i=this;i._deferred_CrossHighlight=t,0==i._initialCompareDone?i._deferred_updateSelectedArg=e:setTimeout(function(){i._doUpdateSelected(e,!0)},0)},_doUpdateSelected:function(e,t){this._plugSvcs.reportTime(this.__startTime,"[3DVIEW] BEGIN doUpdateSelected()");for(var i=this,n=[],o=[],s=e.length,a=0;a<s;a++){var l=e[a];null!=l&&(n[a]=[],l.forEach(function(e){var t=i._getViewerPath(e);if(null!=t){n[a].push(t);var r=e.split("/");o.push(r)}}))}r.mask(i.elements.container),i.elements.container.getElement(".spinner").addClassName("in"),setTimeout(function(){i._updateViewer("update",o).then(function(e){if(null!=i._compareAPI3D){if(i._plugSvcs.reportTime(i.__startTime,"[3DVIEW] BEGIN DMU3DCompareAPI.updateCompareModel()"),1==t){var o=i._buildDMUOptions(n[0],n[1]);i._compareAPI3D.updateCompareModel(o)}i._plugSvcs.reportTime(i.__startTime,"[3DVIEW] END DMU3DCompareAPI.updateCompareModel() ")}null!=i._deferred_CrossHighlight&&i._deferred_CrossHighlight.status&&i._deferred_CrossHighlight.doneCB(i._deferred_CrossHighlight),i._deferred_CrossHighlight=null,r.isMasked(i.elements.container)&&r.unmask(i.elements.container)},function(e){i._plugSvcs.errout("Cannot update View3D:: "+e)})},0)},_updateViewer:function(e,t){var i=this,n=null,r=null;return"hide"==e?(n=i._exclusiveHideShowController.hide,r="onHide"):"show"==e?(n=i._exclusiveHideShowController.show,r="onShow"):"update"==e&&(n=i._exclusiveHideShowController.exclusiveShow,r="onExclusiveShow"),new Promise(function(e,o){if(null==n)o("bad opName in 'doUpdate'");else{var s=i._exclusiveHideShowController.subscribe({event:r},function(){try{i._exclusiveHideShowController.unsubscribe(s),i._plugSvcs.reportTime(i.__startTime,"[3DVIEW] END _exclusiveHideShowController.doUpdateSelected("+r+")"),e()}catch(e){i._plugSvcs.errout("Failure performing explusive show"),o()}});i._plugSvcs.reportTime(i.__startTime,"[3DVIEW] BEGIN _exclusiveHideShowController.doUpdateSelected("+r+")"),n.call(i._exclusiveHideShowController,{paths:t})}})},_getViewerPath:function(e){var t="";try{var i=null!=e?e.split("/"):[];t=this._viewer3D.getController().buildPathFromArray(i)}catch(e){this._plugSvcs.warnout("EXCEPTION trying to get viewer path: "+e)}return t},_makeTreeEntry:function(e,t,i,n){var r={};return null==n||n.constructor==Array&&null==n[0]?r=null:(r={name:e,nls:t,color:i},n.constructor==Array?r.pathElements=n:r.pathElement=n),r},_buildDMUOptions:function(e,t){var i=null==e||e.constructor==Array&&0==e.length,n=null==t||t.constructor==Array&&0==t.length,r=this._colors.BASELINE,o=this._colors.COMPARE,s={panel:"reduce",TitleNls:"NLS_TITLE",Common:{nls:"NLS_Common",color:n?r:i?o:this._colors.COMMON}};return s.Old=this._makeTreeEntry("L","NLS_LEFT",r,i?t:e),s.New=this._makeTreeEntry("R","NLS_RIGHT",o,n?e:t),s},clearView:function(e){null!=this._viewer3D&&this._viewer3D.empty()},getLabel:function(){return o.Compare3DPanelTitle},getName:function(){return"view3d"}})}),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager"],function(e,t,i){"use strict";function n(e,t){for(var i=[],n=t.length,r=0;r<n;r++)for(var o=t[r],s=o.length,a="."+r,l=0;l<s;l++){for(var u=(d=o[l].IDPath.split("/")).length,c=0;c<u;c++){let e=d[c].length;d[c].substring(e-2)!=a&&(d[c]+=a)}o[l].IDPath=d.join("/")}for(const n of t)if(null!=n){var d=[];for(const t of n){var p=t.IDPath;if("IDPATH"==e)d.includes(p)||d.push(p);else{if("VIEWERPATH"!=e)return this._plugSvcs.errout("INVALID RETURN TYPE request: "+e),[];var h=this._outputPanel._getViewerPath(p);null!=h&&i.push({pathElement:h})}}"IDPATH"==e&&i.push(d)}return i}function r(e){for(var t={},i=e.length,n=0;n<i;n++){var r=e[n];if(0==r.getIsHidden_byStatusFilter()){var o=r.getBaseNode(),s=o.isDummy()?"":o.getAttr("physicalID_REF")+".0",a=r.getCompNode(),l=a.isDummy()?"":a.getAttr("physicalID_REF")+".1";t[s+"_"+l]=!0,1==r.qtyIsDiff()&&(t[s+"_"]=!0,t["_"+l]=!0)}}return t}function o(e,t,i,n){var r={viewableRootSet:[],allVisible:!1},s=!0,a=t.getMatchInfo();if(i){var l=a.getBaseNode(),u=l.isDummy()?"":l.getAttr("physicalID_REF")+".0",c=a.getCompNode(),d=c.isDummy()?"":c.getAttr("physicalID_REF")+".1";s=1!=n["DIFFERENT"==a.getRelName()?0==e?u+"_":"_"+d:u+"_"+d]}else s=a.getIsHidden_byStatusFilter();if(s){if(i)for(var p=(_=t.getChildArray()).length,h=0;h<p;h++){(f=o(e,_[h],i,n)).viewableRootSet.forEach(function(e){r.viewableRootSet.push(e)})}}else{var _;p=(_=t.getChildArray()).length;if(r.allVisible=!0,0==p){g=(g=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(r.viewableRootSet=[g])}else{for(h=0;h<p;h++){var f;0==(f=o(e,_[h],i,n)).allVisible&&(r.allVisible=!1),f.viewableRootSet.forEach(function(e){r.viewableRootSet.push(e)})}var g;if(1==r.allVisible)g=(g=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(r.viewableRootSet=[g])}}return r}function s(e){try{var t=this;let S=this.viewerDisplayMode;if(void 0===t._outputPanel||null===t._outputPanel)return;t._attrUpdateStartMS=t._plugSvcs.nowMS();var i=e.data.selectedData,s=e.data.crTree,a=[],l=[];if(null!=i){var u="LIST"==e.data.structDisplayMode;if("isolate"===S)a=function(e,t,i){var n=[[],[]],s=null;i&&(s=r(e.getCRList().getMatchPairArray()));for(var a=e.getRootArray().length,l=0;l<a;l++)for(var u=t[l].length,c=t[l].sort(function(e,t){return e.IDPath>t.IDPath}),d="XXX",p=0;p<u;p++){var h=c[p].IDPath;if(h.startsWith(d));else{d=h;var _=e.findNodeByIDPath(l,h);if(_){var f=o(l,_,i,s).viewableRootSet;n[l]=n[l].concat(f)}}}return n}(s,i,u);else{if("select"!==S)return void t._plugSvcs.errout("INVALID - expected 'isolate' or 'select', was given: '"+S+"'");a=function(e,t){var i=[],n=null;t&&(n=r(e.getCRList().getMatchPairArray()));for(var s=e.getRootArray(),a=s.length,l=0;l<a;l++){var u=o(l,s[l].CRNode_root,t,n).viewableRootSet;i.push(u)}return i}(s,u),l=n.call(t,"VIEWERPATH",i)}var c={status:!1};try{"isolate"==S&&"select"==this._lastViewDisplayMode&&t._XSelectManager.notifyClearHighlights();var d="isolate"==S,p="select"==S,h="none"==this._lastViewDisplayMode,_="isolate"==this._lastViewDisplayMode,f=1==a[0].length&&-1==a[0][0].indexOf("/"),g=1==a[1].length&&-1==a[1][0].indexOf("/"),m=f&&g;(d||p&&(h||_||!m||!this._lastWasRootsOnly))&&(c={status:!0,viewerPaths:l,doneCB:function(e){"select"===S&&require(["DS/Selection/CSOManager","DS/Selection/HSOManager"],function(e,r){t._XSelectManager.setUpdateState("INTERNAL");let o=n.call(t,"VIEWERPATH",i);e.add(o),r.add(o),t._XSelectManager.setUpdateState("NONE")},function(e){})}},t._outputPanel.updateSelected(a,c),this._lastIDPAAS=a),this._lastViewDisplayMode=S,this._lastWasRootsOnly=m}catch(e){this._plugSvcs.errout("EXCEPTION updating selected in output panel")}"select"===S&&t._XSelectManager.notifyNewHighlights(l,!c.status)}}catch(e){this._plugSvcs.errout("EXCEPTION updating selected in 3DView output panel")}}return e.extend({onEnabled:function(){var e=this;return e._lastViewDisplayMode="none",e._lastWasRootsOnly=!1,e._lastIDPAAS=[],e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",s.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",()=>this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select"),this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select",null==e._XSelectManager&&(e._XSelectManager=new i(e._plugSvcs)),e._parent()},destroy:function(){this._XSelectManager.destroy(),this._XSelectManager=null,this._parent()},createViewPanelObject:function(e,i){return new t(e,this._plugSvcs,i)},execute:function(e,t){var i=this;i._parent(e,t);var n=e;null==n[0].structure.results[0]["ds6w:globaltype"]||null==n[1].structure.results[0]["ds6w:globaltype"]?i.reportKO("no viewable present for at least one object"):i._outputPanel.showResults(n).then(function(e){i.showNotBusy(),i.reportOK(e)},function(e){i.reportKO(e)})}})}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_TREE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/userSettings/UserSettingsManager"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},doAugment:function(e,t,i){return new Promise(function(t,i){t(e)})},doAggregate:function(e,t,i){return new Promise(function(t,i){t(e)})},doesNodeConform:function(e,t){let i=!1;if(null==t.TYPE?i=!0:t.TYPE.includes(e.getAttr("REF.ds6w:type"))&&(i=!0),1==i)if(null==t.ATTRIBUTES)i=!0;else{let r=Object.keys(t.ATTRIBUTES),o=r.length;for(var n=0;n<o;n++){let o=r[n];if(t.ATTRIBUTES[o]!=e.getAttr(o)){i=!1;break}}}return i},markAsFiltered:function(e,i){let n=this,r=!1,o=i.length;for(var s=0;s<o;s++){let o=i[s],a=null==o.SHOW||o.SHOW;if(0==("boolean"==typeof a?a:"string"!=typeof a||t.get(a))){let t=!1,i=!1;if(1==(i=null==o.CHILD||null!=e&&n.doesNodeConform(e,o.CHILD))){let s=e.getParent();if(t=null==o.PARENT||null!=s&&n.doesNodeConform(s,o.PARENT),i&&t){r=!0;break}}}}return r},setHideNodeFlags:function(e,t){if(null!=t){let i=this;e.forEach(function(e){let n=0;e.visit_riTreeAndFN(function(e){return i.markAsFiltered(e,t)&&(n++,e.setAttr("REF.hideNode",!0)),!0}),i._plugSvcs.dbgout("refInst tree has "+n+" nodes marked as hidden my SHOW_HIDE_NODE_PARAMS")})}},execute:function(e,t){var i=this;i._parent(e,t);var n=[];e.forEach(function(e){let t=e.makeDupe();n.push(t)}),i.setHideNodeFlags(n,t.SHOW_HIDE_NODE_PARAMS),i.doAugment(n,t,this._plugSvcs).then(function(e){var n=e;i.doAggregate(n,t,this._plugSvcs).then(function(e){var t=e;i.reportOK(t)},function(e){i.reportKO("FAILURE performing struct aggregate: "+e)})},function(e){i.reportKO("FAILURE performing struct augment: "+e)})}})}),define("DS/CompareWidget2/widget/viewPanelMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/widget/mainFrame"],function(e,t){return function(e,i,n,r){this._panelSpecSet={},this._expectedViewCount=-1,this._mainFrame=new t(i,n,r),widget._isODTMode()?e.setContent(this._mainFrame):this._mainFrame.inject(e),this.addPanel=function(e,t,i,n,r){var o=[];"function"==typeof t.getWidgetButtons&&(o=t.getWidgetButtons());var s={name:e,panel:t,plugin:i,buttonSpecArray:o},a=this._mainFrame.getResultFrame();this._panelSpecSet[e]=s,-1==this._expectedViewCount?a.addPanel(s,!0):Object.keys(this._panelSpecSet).length==this._expectedViewCount&&a.setAllPanels(this._viewDefModPath,this._viewSetName,this._defaultViewConfig,this._panelSpecSet,this._mainToolbarConfigPath,this._mainToolbarOptions,n,r)},this.setDefaultViewConfig=function(e,t,i,n,r,o){this._viewSetName=t,this._viewDefModPath=e,this._defaultViewConfig=i.VIEWSET,this._mainToolbarConfigPath=n,this._mainToolbarOptions=r,this._expectedViewCount=o.length},this.showResultFrame=function(){this._mainFrame.showResultFrame()},this.releaseViewPanels=function(){this._mainFrame.resetResultFrame(),this._panelSpecSet={},this._expectedViewCount=-1},this.showInputFrame=function(){this._mainframe.showInputFrame()},this.hideAllShowBusy=function(){this._mainFrame.hideAllShowBusy()},this.requestFrame=function(e){return UWA.createElement("div",{id:e,styles:{position:"relative",display:"flex","flex-direction":"column",height:"100%"}})},this.refreshFrame=function(){this._mainFrame.refreshFrame()},this.isResultViewActive=function(){return this._mainFrame.isResultViewActive()}}}),define("DS/CompareWidget2/ViewDefModules/VPMRef_Options",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],function(e,t){return e.merge({RUN_OPTIONS:{customCompareActive:!0}},e.clone(t,!0))}),define("DS/CompareWidget2/ViewDefModules/VPMRef_ViewDefs",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/VPMRef_Options"],function(e,t,i){let n=e.clone(t.PLUGDEFS,!0);return n.StructFetch.Options=i.STRUCT_FETCH_OPTIONS,e.merge({VIEWDEFS:t.VIEWDEFS,VIEWSETS:t.VIEWSETS,PLUGDEFS:n},i)}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/structFlexibleViewPanel",["UWA/Class","DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareCommon/CompareIdDataListItem","DS/CompareCommon/Input/RevisionsManager","DS/CompareCommon/Input/FilterManager","DS/CompareCommon/Input/SearchManager","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTrees","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController","DS/CompareWidget2/userSettings/UserSettingsManager","DS/UIKIT/Mask","i18n!DS/CompareCommon/assets/nls/CompareInput","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,r,o,s,a,l,u,c,d,p,h,_,f,g,m){"use strict";return e.extend({init:function(e,t,i,n,r,s,a){this._parent(i),this._myContent=UWA.createElement("div",{id:"FLEX_VIEW-"+n.getDisplayMode().id,class:"struct_flexible_view",styles:{height:"100%","flex-direction":"column",display:"flex"}}),this._myContent.inject(e),this._plugSvcs=t,this._options=i,this._viewCallbacks=s,this._compareTreeDocumentArray=a,this._gridView=n,this._flagDD=r,this._statusesHidden=[],this._statusesUnchecked=[],this._displayMode=this._gridView.getDisplayMode(),this._statusFilterHideChildIfParentIsHidden=!0,this._expandCollapseMenu=null,this._fvpTrees=null,this._overview=null,this._standardToolbar=null,this._allowedDisplayModes=[n.getDisplayMode()],this._myViewID=n.getViewID(),this._currentViewID=this._myViewID,this._currentExpandMenuId="expandAll",this._suspendExpandUpdates=!1,this._aggVisibilityFilterModels={},o.setApplyCallback(this,[{whichOne:"left"},{whichOne:"right"}],this._onApplyNGFilter),this.buildSkeleton(this._myContent,i)},buildSkeleton:function(e,t){var i=this;this._loadContextMenu(t.CONTEXT_MENU_PLUGIN),this._expandCollapseMenu=new d({structComparePanel:this});let n=this.buildOtherMenuItems();this._standardToolbar=new c(e,this,{navigateDifferences:!0,showCompareLegend:!0,otherMenuItems:n,CUSTOM_PROFILE_IN_USE:1==t.CUSTOM_PROFILE_IN_USE});var r={doExpandCollapseUpdates:this._doExpandCollapseUpdates.bind(this),onContextMenu:this._onContextMenu.bind(this),syncOverview:this._syncOverview.bind(this)};this._fvpTrees=new l({options:t,plugSvcs:i._plugSvcs,gridView:i._gridView,flagDD:i._flagDD,structComparePanelCBs:r,compareTreeDocumentArray:this._compareTreeDocumentArray}),this._fvpTrees.inject(e);let o=this._gridView.STRUCT_COMPARE_PANEL_RIGHT;this._overview=new a({viewID:this._myViewID,structComparePanelRight:o}),this._overview.inject(e),this._setupDnD(i._gridView.STRUCT_COMPARE_PANEL_LEFT,i._gridView.STRUCT_COMPARE_PANEL_RIGHT)},show:function(){this._myContent.show();var e="#FLEX_VIEW-"+this._myViewID,t=jQuery(e+" .compare-view-toolbar-container")[0].clientHeight;if(t>8){var i="calc(100% - "+t+"px)";this._myContent.setStyle("height",i)}},hide:function(){this._myContent.hide()},destroy:function(){null!=this._externalController&&(this._externalController.destroy(),this._externalController=null),null!=this._fvpTrees&&(this._fvpTrees.destroy(),this._fvpTrees=null),null!=this._overview&&(this._overview.destroy(),this._overview=null),null!=this._standardToolbar&&(this._standardToolbar.destroy(),this._standardToolbar=null),this._expandCollapseMenu=null,this._contextMenuPlugin=null,this._plugSvcs=null},_loadContextMenu:function(e){var t=this,i=e||"DS/CompareWidget2/viewComponents/ContextMenuBase";require([i],function(e){t._contextMenuPlugin=new e({structComparePanel:t})},function(e){console.error("FAILED TO LOAD "+i+": msg:"+e)})},handleToolbarCommands:function(e){switch(e.event){case"legendApplyFilter":this._applyFiltersCB(),this._updateToolbarDiffCount(),this._updatePersistedUserPref("legendFilter");break;case"legendApplyVisibility":this._showStatusChooserDialog(e);break;case"navigatePrevious":case"navigateFirst":case"navigateLast":case"navigateNext":this._onNavigate(e.event);break;case"displayView":this._viewCallbacks.reqChangeCurrentViewID(e.data.mode);break;case"expandAll":case"collapseAll":case"expandNLevels":this._standardToolbar.update({displayIcon:[{id:"expandCollapse",icon:e.data.icon}]}),this._currentExpandMenuId=e.event,"expandNLevels"===e.event?this._expandNLevels_showPopup():this._expandCollapse("collapseAll"!==e.event,-1);break;case"revisionsDlg":this._displayHistoryGraph(e.data.whichSide,e.data.objIDSpecREF);break;case"filterPanel":this._displayFilterPanel(e.data.whichSide,e.data.objIDSpecREF)}},_applyFiltersCB:function(){var e=this;0==_.isMasked(e._myContent)&&_.mask(e._myContent),setTimeout(()=>{let t=e._flagDD.getStatusONOFF(),i=e._getFilterOnState();e._fvpTrees.applyFilters(e._aggVisibilityFilterModels,{statusFilterArgs:{hiddenStatusArray:t.offFlags,filterOnState:i}}),e._doExpandCollapseUpdates(),e._fvpTrees.onSelectRow(),_.unmask(e._myContent)},0)},_updateToolbarDiffCount:function(e){let t=e;null==t&&(t=this._getDifferenceCount()),this._standardToolbar.update({numDifferences:t})},_updatePersistedUserPref:function(e){let t=this;function i(e,i,n){let r=t._flagDD.getFDDItemArray_active();for(let[o,s]of Object.entries(r))o!==n&&(!0===s[e]&&t[i].indexOf(o)>=0?t[i]=t[i].filter(e=>e!==o):!1===s[e]&&-1===t[i].indexOf(o)&&(t[i]=[...t[i],o]))}switch(e){case"legendFilter":i("checked","_statusesUnchecked");break;case"legendVisibility":i("visibleFlag","_statusesHidden","IDENTICAL")}},_showStatusChooserDialog:function(){var e=this._flagDD.getFDDItemArray_active().filter(function(e){return"IDENTICAL"!=e.id}),t=this;require(["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog"],i=>{new i({statuses:e,OKfn:i=>{let n=this.statusChooserCB.bind(this)(e,i);n.bApplyChanges&&(this._updatePersistedUserPref("legendVisibility"),this._updateToolbarDiffCount()),n.bAtLeastOneHidden&&t._plugSvcs.showAlertBox(m.HIDDEN_STATUSES_IDENTICAL,null,"info")}})})},_onNavigate:function(e){var t=this._fvpTrees.dataGridViews[0].getNodesXSO().get();let i=this._fvpTrees.getMatchPairArray();var n=-2;if("navigateFirst"===e)n=-1,e="navigateNext";else if("navigateLast"===e)n=i.length,e="navigatePrevious";else if(Array.isArray(t)&&t.length){var r=(t=t[t.length-1]).options.data.getMatchInfo();n=i.findIndex(e=>r===e)}if(-2!==n){var o=function(e,t,n){for(var r="navigateNext"===t?1:-1,o=e+r,s=i.length;"navigateNext"===t?o<s:o>=0;o+=r)if(i[o].getBaseNode().__TREENODE__.isVisible())for(let e of i[o].getAllStatusArray(!0))if("IDENTICAL"!==e&&n.getFlagDisplayDataItem(e).visibleFlag)return i[o];return null}(n,e,this._flagDD);null!=o&&this._fvpTrees.withUpdateLocked(function(){this._fvpTrees.clearNTHGridSelection(0),o.getBaseNode().__TREENODE__.select(),this._fvpTrees.dataGridViews[0].ensureNodeModelVisible(o.getBaseNode().__TREENODE__,!0,1)}.bind(this))}},_expandNLevels_showPopup:function(e){var t=this;require(["DS/PADUtils/views/PADLevelSel"],function(i){new i({current_level:1,events:{onApply:function(e){t._expandCollapse(!0,parseInt(e)||-1)}}});if(null!=e&&void 0!==e.position&&null!==e.position&&e.position.x>0&&e.position.y>0){var n=jQuery(".pad_level_sel_modal > .modal-wrap");null!=n&&n.length>0&&(n[0].setStyle("padding-top","0px"),n[0].setStyle("margin-top",e.position.y+"px"),n[0].setStyle("margin-left",e.position.x+"px"))}})},_expandCollapse:function(e,t){var i=this;this._fvpTrees.withUpdateLocked(()=>{i._beginSuspendExpandUpdates(),i._fvpTrees.dataGridViews.forEach((n,r)=>{i._fvpTrees.getNTHGridSelectedNodes(r).forEach(i=>{if(i.hasChildren()){var n={};-1==t?n.expandAll=!0:n.numberOfLevelsToExpand=t;try{e?-1==t?i.expandAll():(i.collapseAll(),i.expandNLevels(n)):i.collapseAll()}finally{}}else i.options.data.setExpandCollapseState("noExpandState")})}),i._endSuspendExpandUpdates()}),this._fvpTrees.applyFilters(i._aggVisibilityFilterModels),this._syncOverview()},_getDifferenceCount:function(){let e=this,t=this._flagDD,i=this._fvpTrees.getMatchPairArray();var n=0;return i.forEach(function(i){1==e._checkForVisibleDiff(t,i)&&n++}),n},_checkForVisibleDiff:function(e,t){let i=!1;try{let a=t.getBaseNode();if(1==a.__TREENODE__.isVisible()){var n=0==a.areAnyChildrenVisible();let l=t.getAllStatusArray(n);for(var r=0;r<l.length;r++){var o=l[r];if("IDENTICAL"!=o){var s=e.getFlagDisplayDataItem(o);if(1==s.checked&&1==s.visibleFlag){i=!0;break}}}}}catch(e){console.error("error checking for visible diff flags: "+e)}return i},statusChooserCB:function(e,t){let i=this._flagDD,n=[],r=[];var o=!0;for(let[a,l]of Object.entries(t)){o=o&&l;var s=e[a].id;i.getFlagDisplayDataItem(s).visibleFlag!==l&&n.push({id:s,visibleFlag:l}),0==l&&r.push(s)}return i.setVizNoViz(r),n.unshift({id:"IDENTICAL",visibleFlag:i.getFlagDisplayDataItem("IDENTICAL").visibleFlag}),n.length>0&&(this._standardToolbar.update({showHideCommands:n}),this._doExpandCollapseUpdates()),{bAtLeastOneHidden:!o,bApplyChanges:n.length>0}},_onContextMenu:function(e){return this._contextMenuPlugin.createContextMenu(e)},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],n=>{var r=t.getBoundingClientRect(),o={position:{x:r.right,y:r.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,o)})},buildOtherMenuItems:function(){var e=this,t=[];if(1==this._displayMode.expandCollapseEnabled&&t.push({id:"expandCollapse",dataElements:{domId:"compare-struct-expansion-button",typeRepresentation:"functionIcon",label:g.chooseTreeExpansion,tooltipInfos:i.generateTooltip("CompareWidget2/Tooltips","chooseTreeExpansion"),position:"far",priority:1,overflowPriority:"never",value:t=>e._displayMenu(e._expandCollapseMenu.getExpandCollapseMenu(),t.dsModel.elements.container),icon:{iconName:"expandAll"===e._currentExpandMenuId?"flow-tree-expand-down":"flow-tree-expand-up",fontIconFamily:1}}}),this._allowedDisplayModes.length>0){let n={id:"structPanelViewSelector",dataElements:{domId:"compare-struct-display-style-button",typeRepresentation:"functionIcon",label:g.chooseTreeOrListView,tooltipInfos:i.generateTooltip("CompareWidget2/Tooltips","chooseTreeOrListView"),position:"far",priority:1,overflowPriority:"never",icon:{iconName:e._allowedDisplayModes.find(t=>t.id===e._currentViewID).icon,fontIconFamily:1},value:t=>{e._displayMenu(e._allowedDisplayModes.map(t=>({type:"RadioItem",title:t.title,id:t.id,tooltip:t.tooltip,icon:t.icon,state:e._currentViewID===t.id?"selected":"unselected",action:{callback:()=>e.handleToolbarCommands({event:"displayView",data:{mode:t.id,tooltip:t.tooltip,icon:t.icon}})}})),t.dsModel.elements.container)}}};t.push(n)}return t},_beginSuspendExpandUpdates:function(){this._suspendExpandUpdates=!0},_endSuspendExpandUpdates:function(){this._suspendExpandUpdates=!1,this._doExpandCollapseUpdates()},_doExpandCollapseUpdates:function(){0==this._suspendExpandUpdates&&(this.onResize(),this._syncOverview(),setTimeout(()=>{this._updateToolbarDiffCount()},0))},_setupDnD:function(e,i){var n=this;t.attachObject(e,n,n._dragEnterPanel,n._dragLeavePanel,n._dropHandler,null,"drop-left"),t.attachObject(i,n,n._dragEnterPanel,n._dragLeavePanel,n._dropHandler,null,"drop-right")},_dragEnterPanel:function(e){var t=this._fvpTrees.dataGridViews.every(function(e){return!e.draggingFromCompare});void 0!==e.currentTarget&&null!==e.currentTarget&&t&&e.currentTarget.parentElement.addClassName("ft-drop-cue-on")},_dragLeavePanel:function(e){void 0!==e.currentTarget&&null!==e.currentTarget&&e.currentTarget.parentElement.removeClassName("ft-drop-cue-on")},_dropHandler:function(e,r,o){if(this._fvpTrees.dataGridViews.every(function(e){return!e.draggingFromCompare})){if(r.objArray.length>1)return void this._plugSvcs.showAlertBox("DROP_1_OBJ_REPLACE",m,"error");for(var s=i.fetchPersistedIDs(),a=r.objArray,l=a.map(function(e){return e.objectId}),c=a.map(function(e){var t={};for(var i in e)t[i]=e[i];return t}),d=l.length,p=0;p<d;++p){var h=new n(l[p],c[p]);"drop-left"===o?s.items[0]=h:"drop-right"===o&&(s.items[1]=h)}i.persistIDs(s);var _="drop-left"===o?0:1,f=[];r.objArray.forEach(function(e){var t=new u(e.objectId,e.objectType,e.contextId,e.envId,e.serviceId);f.push(t)}),this._requestRecompareWithNewID(_,f)}this._fvpTrees.dataGridViews.forEach(e=>e.draggingFromCompare=!1),t.reset()},_updateTreePanelCaptions:function(){var e=this;this._getTreePanelCaptions().forEach(function(t){e._fvpTrees.setPanelCaption(t.panelContentId,t.panelCaption)})},_getTreePanelCaptions:function(){function e(e,t,i){var n=null;let r=t.getObjIDSpec_REF();return t&&((n={}).label=[],n.label.push({text:t.getAttr("title")}),n.label.push({text:t.getAttr("revision"),id:"treePanel-caption-revision-"+i,onClick:function(){e._displayHistoryGraph(i,r)}}),t.hasExternalFilter()&&n.label.push({text:t.getExternalFilterName(),id:"treePanel-caption-filter-"+i,onClick:function(){e._displayFilterPanel(i,r)}}),n.dropDown={id:"treePanel-caption-dropdown-"+i,onClick:function(){e._displayMenu(n.dropDown.item.map(e=>({type:"PushItem",title:e.text,icon:e.icon,action:{callback:e.onClick}})),this)}},n.dropDown.item=[],!1!==r._supportsRevisions&&n.dropDown.item.push({text:f.get("revisionCM"),icon:"flow-branch-list",onClick:function(){e._displayHistoryGraph(i,r)}}),!1!==r._supportsFilters&&n.dropDown.item.push({text:f.get("filterCM"),icon:"filter",onClick:function(){e._displayFilterPanel(i,r)}}),n.dropDown.item.push({text:f.get("openCM"),icon:"open",onClick:function(){e._displaySearchPanel(i,r)}})),n}var t=[];let i=function(e){e=e||[];let t={crNode_base:null,crNode_comp:null};for(let i=0;i<e.length;i++){let n=e[i];if(null==t.crNode_base){let e=n.getBaseNode();0==e.isDummy()&&(t.crNode_base=e)}if(null==t.crNode_comp){let e=n.getCompNode();0==e.isDummy()&&(t.crNode_comp=e)}if(null!=t.crNode_base&&null!=t.crNode_comp)break}return t}(this._compareTreeDocumentArray[0].__CRTREE__.getMatchPairArray()),n=e(this,i.crNode_base,"left"),r=e(this,i.crNode_comp,"right");return t.push({panelContentId:this._gridView.STRUCT_COMPARE_PANEL_LEFT,panelCaption:n}),t.push({panelContentId:this._gridView.STRUCT_COMPARE_PANEL_RIGHT,panelCaption:r}),t},_displayHistoryGraph:function(e,t){var n=this;let o={objId:t.getPhysID(),objType:t.getObjType(),tenant:t.getTenant(),securityContext:t.getSecurityContext()};r.displayHistoryGraph(o,null,{allowDuplicates:!0},function(t){let r="left"===e?0:1,o=i.fetchPersistedIDs();o.items[r].objectId=t.physicalid,o.items[r].objectServices.objectId=t.physicalid,o.items[r].objectServices.objectType=t.type,o.items[r].objectServices.contextId=t.contextId,o.items[r].objectServices.displayName=t.displayName,o.items[r].objectServices.serviceId=t.serviceId,i.persistIDs(o);let s=new u(t.physicalid,t.type,t.contextId,t.envId);n._requestRecompareWithNewID(r,[s])})},_displayFilterPanel:function(e,t){var i={objId:t.getPhysID(),objType:t.getObjType(),tenant:t.getTenant(),securityContext:t.getSecurityContext(),serviceName:t.getServiceName()};o.activateProxy(e),o.executeFilterCmd(e,i)},_displaySearchPanel:function(e,t){var n=this,r=t.getTenant(),o=t.getSecurityContext(),a="left"===e?0:1;s.displaySearchPanel(r,!1,function(e){let t=e[0];if(null!=t){var s=t.id;[].push(s);var l=t.sourceid_value.split(":"),c={contextId:o,displayName:t["ds6w:label_value"],displayType:t["ds6w:type"],envId:l.length>1?l[1]:r,objectId:t.id,objectType:t["ds6w:type_value"],serviceId:l[0],preview_url:t.preview_url_value,type_icon_url:t.type_icon_url_value};[].push(c);var d=i.fetchPersistedIDs();d.items[a].objectId=c.objectId,d.items[a].objectServices.objectId=c.objectId,d.items[a].objectServices.objectType=c.objectType,d.items[a].objectServices.contextId=c.contextId,d.items[a].objectServices.displayName=c.displayName,d.items[a].objectServices.serviceId=c.serviceId,i.persistIDs(d);var p=new u(c.objectId,c.objectType,c.contextId,c.envId,c.serviceId);n._requestRecompareWithNewID(a,[p])}})},_requestRecompareWithNewID:function(e,t){this.clearView(),this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:e,objIDSpecArray:t})},_onTreesReady:function(e){this._updateTreePanelCaptions(),this._syncOverview(),this._standardToolbar.update({legend:e,enableDisableCommands:[{id:"expandCollapse",disabled:!this._displayMode.expandCollapseEnabled},{id:"chooseStatusToDisplay",disabled:1===Object.keys(e).length&&null!=e.IDENTICAL&&e.IDENTICAL.visibleFlag}],modulePath:"CompareWidget2/Tooltips"})},_getFilterOnState:function(){let e=h.get("viewSettings.STRUCT_VIEW.multi_statuses_to_hide_and");return ret=1==e?"ALL":"ANY",ret},clearView:function(){this._fvpTrees&&this._fvpTrees.clear()},onResize:function(){null!=this._overview&&(this._overview.onResize(),this._updateOverviewVisibility())},onActivate:function(){setTimeout(()=>{this.onResize(),this._syncOverview()},0)},getLabel:function(){return g.CompareStructurePanelTitle},getName:function(){return this._gridView.VIEWID},showResults:function(e,t,i){var n=this;n._flagDD=t,this._compareTreeDocumentArray=e,this._aggVisibilityFilterModels=n.buildFilterModels(),n._fvpTrees.updateTrees(e,function(){let e=n._flagDD.getStatusONOFF(),r=n._getFilterOnState();n._fvpTrees.applyFilters(n._aggVisibilityFilterModels,{statusFilterArgs:{hiddenStatusArray:e.offFlags,filterOnState:r}});var o=t.getFlagDisplayData_excludeFilteredByTypeAttr();n._onTreesReady(o),n.onResize(),n._syncOverview(),this._updateToolbarDiffCount(),i()}.bind(n))},updateViewDropDowns(e){this._allowedDisplayModes=e;let t=this.buildOtherMenuItems();this._standardToolbar.update({otherMenuItems:t})},setCurrentViewID:function(e){this._currentViewID=e},onComparePanelUpdated:function(){void 0!==this._contextMenuPlugin&&null!==this._contextMenuPlugin&&this._contextMenuPlugin.onComparePanelUpdated()},getActiveExpandMenuId:function(){return this._currentExpandMenuId},getFlagDisplayData:function(e){return this.Trees.getFlagDisplayData(e)},updateHiddenStatuses:function(e){this._statusesHidden=e},updateUncheckedStatuses:function(e){this._statusesUnchecked=e},_updateOverviewVisibility:function(){this._fvpTrees.isScrollbarShown()?this._overview.show():this._overview.hide()},_syncOverview:function(){if(void 0!==this._overview&&null!==this._overview){var e=this._buildOverviewKeyDiffArray(this._fvpTrees.dataGridViews[1]);this._updateOverviewVisibility();var t=this._fvpTrees.getNTHGridSelectedNodes(0),i=[];t.forEach(function(e){var t=e._getRowID();i.push(t)});var n=this._flagDD.getFDDItem_lut();this._overview.syncWithNewData(!0,e,i,n)}},_buildOverviewKeyDiffArray:function(e){for(var t=this,i=[],n=e.getTreeDocument().getAllDescendants(),r=0;r<n.length;r++){var o=n[r];if(o.isVisible()){var s=[],a=!1,l=o.options.data._matchInfo;if(l){var u=l.getBaseNode().areAnyChildrenVisible();if(l.getAllStatusArray(!u).forEach(function(e){let i=t._flagDD.getFlagDisplayDataItem(e);s.push(i)}),a=o.options.data._matchInfo.qtyIsDiffFlag){let e=t._flagDD.getFlagDisplayDataItem("QUANTITY");s.push(e)}}else{let e=t._flagDD.getFlagDisplayDataItem("IDENTICAL");s.push(e)}var c={objKey:r,flagDefArray:s,qtyDiff:a};i.push(c)}}return i},buildFilterModels:function(){return{showByStatusFilter:{filterId:"set",filterModel:[1]},showByTypeAttrFilter:{filterId:"set",filterModel:[1]}}},_onApplyNGFilter:function(e){const t=e.appId.startsWith("CompareWidget_right")?"right":"left",n="left"===t?0:1;let r=e.empty?null:e;var s=i.fetchPersistedIDs();s.items[n].filterData=r,e.empty?(s.items[n].filterSpec=null,i.persistIDs(s)):o.getFilterSpecificationPromise(t,r.filterRootIds[0]).then(function(e){1===e.status&&(s.items[n].filterSpec=e.publicSpec),i.persistIDs(s)},function(){i.persistIDs(s)});let a=s.items[n].objectServices;var l=new u(a.objectId,a.objectType,a.contextId,a.envId,a.serviceId,r);this._requestRecompareWithNewID(n,[l])}})}),define("DS/CompareWidget2/plugins/EXPORT/exFormatter",["DS/CompareCommon/Utils","DS/CompareWidget2/plugins/DATA/attrValObj","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i,n){function r(e,t){var i=!1;if(null==e&&null!=t||null!=e&&null==t)i=!0;else if(e.length!=t.length)i=!0;else if(e.constructor!=t.constructor)i=!0;else if(e.constructor!=Array)e!=t&&(i=!0);else for(var n=0;n<e.length;n++)e[n]!=t[n]&&(i=!0);return i}function o(e){let t=Array.isArray(e)?e.length:0;e=e||[];for(var i={},n=0;n<t;n++)if(!e[n]||"thumbnail"!=e[n].type){var r=e[n]?e[n].getFormattedValue():null;i[`${e[n].name}`]=r}return i}function s(e,t){let n="",o=Array.isArray(e)?e.length:Array.isArray(t.length)?t.length:0;e=e||[],t=t||[];for(var s=0;s<o;s++){if(e[s]&&"thumbnail"==e[s].type||t[s]&&"thumbnail"==t[s].type)continue;var a=e[s]?e[s].nls:null,l=t[s]?t[s].nls:null,u=e[s]?e[s].getFormattedValue():null,c=t[s]?t[s].getFormattedValue():null;if(r(u,c))""!==n&&(n+="\r\n"),n+=i.replace(i.get("ReferenceAttribute"),{attributeName:a,attributeValue:u})+", "+i.replace(i.get("ComparedAttribute"),{attributeName:l,attributeValue:c})}return n}function a(t,i){var n="";let r=e.intersectionDifference(t,i,(e,t)=>e.name===t.name),o=r[0].intersection,a=r[1].intersection,l=r[0].difference,u=r[1].difference;return n+=s(o,a)+s(l,null)+s(null,u)}function l(e,t){if(relName="",null!=t){let i=t[e];if(null!=i&&""!==i){let e=n[i.NLS];null!=e&&""!==e&&(relName=e)}}return relName}function u(e,t){var i=l(e,t.CUSTOM_MATCH_ADJ_FLAGS);return""===i&&""===(i=l(e,t.CUSTOM_RULE_ID_FLAGS))&&(i=l(e,t.SYSTEM_RULE_ID_FLAGS)),i}var c={createOutputTables:function(e,i,n,r,o,s,l){var c=[],d="list"==e;return n.forEach(function(n){var p=null;d?p=n.getCRList().getMatchPairArray():p=n.getMatchPairArray();p.forEach(function(n){var p="",h="",_="",f="",g="",m="",S="",T="",C="onPremise",E="",v="",D=[],I=[],y=[],R="",A="",b="",O="",N="",P="",w="",L="",U="onPremise",F="",M="",V=[],x=[],W=[],j=n.getBaseNode();if(0==j.isDummy()){try{if(null!=j.__TREENODE__){let e=j.__TREENODE__._options.grid,i=j.__TREENODE__._options.NLS_RESOLVED;Object.keys(e).forEach(function(n){if(n.startsWith("synthProp_")){let r=n,o=e[n],s=new t(r,i[r],o);y.push(s)}})}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}_=(p=j.getObjIDSpec_REF()).getPhysID(),f=(h=j.getObjIDSpec_INST())?h.getPhysID():null,g=j.getTitle(),null!=(m=j.getAttr("revision"))&&""!==m&&(g+=" "+m),S=j.getType(),T=j.qty,C=p.getTenant(),E=p.getServiceName(),v=p.getSecurityContext();let e=i.REFERENCE._getFromCache(C,E,v,_);if(null!==e){D=e.attrVals;let t=e.getAttrByName("type");null!=t&&(S=t.value)}if(h&&null!=i.INSTANCE){let e=i.INSTANCE._getFromCache(C,E,v,f);null!==e&&(I=e.attrVals)}}var B=n.getCompNode();if(0==B.isDummy()){try{if(null!=j.__TREENODE__){let e=B.__TREENODE__._options.grid,i=j.__TREENODE__._options.NLS_RESOLVED;Object.keys(e).forEach(function(n){if(n.startsWith("synthProp_")){let r=n,o=e[n],s=new t(r,i[r],o);W.push(s)}})}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}b=(R=B.getObjIDSpec_REF()).getPhysID(),O=(A=B.getObjIDSpec_INST())?A.getPhysID():null,N=B.getTitle(),null!=(P=B.getAttr("revision"))&&""!==P&&(N+=" "+P),w=B.getType(),L=B.qty,U=R.getTenant(),F=R.getServiceName(),M=R.getSecurityContext();let e=i.REFERENCE._getFromCache(U,F,M,b);if(null!==e){V=e.attrVals;let t=e.getAttrByName("type");null!=t&&(w=t.value)}if(A&&null!=i.INSTANCE){let e=i.INSTANCE._getFromCache(U,F,M,O);null!==e&&(x=e.attrVals)}}var k=n.getRelName();Array.isArray(o)&&o.indexOf(k)>=0&&(k="IDENTICAL");var G=u(k,r);""!==G&&(k=G);var H=n.getDepth(),Y=S||w,z=B.isDummy()||j.isDummy(),X=z?"":a(D,V),q=z?"":a(I,x);let K=[];if("MULTI"==e){let e="",t="",i=[],n=[];if(1==l){for(let t=0;t<y.length;t++){let n=y[t],r=n.name.toUpperCase();r.endsWith("QUANT")||r.endsWith("COUNT")?e=n.value:i.push(n)}let n=[];for(let e=0;e<W.length;e++){let i=W[e],r=i.name.toUpperCase();r.endsWith("QUANT")||r.endsWith("COUNT")?t=i.value:n.push(i)}}else i=y,n=W;let r=z?"":a(i,n);r.length>0&&(X=X.length>0?r+"\r\n"+X:r),s&&K.push(H),l&&K.push(e),K.push(g),l&&K.push(t),K.push(N,Y,k,X)}else K=d?[T,g,L,N,Y,k,X]:[H,g,N,Y,k,X,q];c.push(K)})}),c},createOutputTablesNewFormat:function(e,t,i,n,r,s,a){var l=[];l.push(...s);var c=[],d="list"==e;return i.forEach(function(e){var i=null;d?i=e.getCRList().getMatchPairArray():i=e.getMatchPairArray();i.forEach(function(e){var i="",s="",p="",h="",_="",f="onPremise",g="",m="",S=[],T=[],C=[],E={},v="",D="",I="",y="",R="",A="onPremise",b="",O="",N=[],P=[],w=[],L={},U=e.getBaseNode();if(0==U.isDummy()){try{if(null!=U.__TREENODE__){let e=U.__TREENODE__._options.grid;Object.keys(e).forEach(function(t){if(t.startsWith("synthProp_")){let i=t,n=e[t];E[i]=n}})}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}p=(i=U.getObjIDSpec_REF()).getPhysID(),h=(s=U.getObjIDSpec_INST())?s.getPhysID():null,baseTitle=U.getTitle(),_=U.qty,f=i.getTenant(),g=i.getServiceName(),m=i.getSecurityContext();let e=t.REFERENCE._getFromCache(f,g,m,p);if(null!==e&&(S=e.attrVals),s){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(f,g,m,h);null!==e&&(T=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(f,g,m,h);null!==e&&(C=e.attrVals)}}}var F=e.getCompNode();if(0==F.isDummy()){try{if(null!=U.__TREENODE__){let e=F.__TREENODE__._options.grid;Object.keys(e).forEach(function(t){if(t.startsWith("synthProp_")){let i=t,n=e[t];L[i]=n}})}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}I=(v=F.getObjIDSpec_REF()).getPhysID(),y=(D=F.getObjIDSpec_INST())?D.getPhysID():null,compTitle=F.getTitle(),R=F.qty,A=v.getTenant(),b=v.getServiceName(),O=v.getSecurityContext();let e=t.REFERENCE._getFromCache(A,b,O,I);if(null!==e&&(N=e.attrVals),D){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(A,b,O,y);null!==e&&(P=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(A,b,O,y);null!==e&&(w=e.attrVals)}}}var M=e.getRelName();Array.isArray(r)&&r.indexOf(M)>=0&&(M="IDENTICAL");var V=u(M,n);""!==V&&(M=V);var x=e.getDepth(),W=e.getLevel(),j="",B="",k="",G="";U.isDummy()||(j=o(S),B=o(T),k=o(C),G=E);var H="",Y="",z="",X="";F.isDummy()||(H=o(N),Y=o(P),z=o(w),X=L);var q=[],K=!1;if((U.isHeaderRow()||F.isHeaderRow())&&(q.push(""),q.push(""),q.push(""),q.push(U._attrList.title),q.push(F._attrList.title),K=!0),!1===K){q.push(M),d?(q.push(_),q.push(R)):1==a&&(q.push(W),q.push(x));for(var Q=q.length;Q<l.length;Q++)l[Q].isLeftSide?"INST"==l[Q].attrType?q.push(B[l[Q].name]):"REF"==l[Q].attrType?q.push(j[l[Q].name]):"EFF"==l[Q].attrType?q.push(k[l[Q].name]):"CUST"==l[Q].attrType?q.push(G[l[Q].name]):console.error("UNKNOWN ATTR TYPE IN EXPORT... skipping"):"INST"==l[Q].attrType?q.push(Y[l[Q].name]):"REF"==l[Q].attrType?q.push(H[l[Q].name]):"EFF"==l[Q].attrType?q.push(z[l[Q].name]):"CUST"==l[Q].attrType?q.push(X[l[Q].name]):console.error("UNKNOWN ATTR TYPE IN EXPORT... skipping")}q.forEach((e,t)=>{void 0===e&&(q[t]="")}),c.push(q)})}),c},getHeaderRow:function(e,t,i,n,r){var o=[];return Object.keys(n).forEach(function(e){-1==n[e].indexOf("thumbnailimage")&&n[e].push("thumbnailimage")}),c.createHeaderRow(e,t,i,n,o,r),o},createHeaderRow:function(e,t,n,r,o,s){var a=[],l=[],u=[],d=r.REF,p=r.INST,h=r.EFF;n.forEach(function(i){var n=null;"list"==e?n=i.getCRList().getMatchPairArray():n=i.getMatchPairArray();n.forEach(function(i){var n="",r="",o="",s="",_="onPremise",f="",g="",m=[],S=[],T=[],C="",E="",v="",D="",I="onPremise",y="",R="",A=[],b=[],O=[],N=i.getBaseNode();if(0==N.isDummy()){o=(n=N.getObjIDSpec_REF()).getPhysID(),s=(r=N.getObjIDSpec_INST())?r.getPhysID():null,_=n.getTenant(),f=n.getServiceName(),g=n.getSecurityContext();let e=t.REFERENCE._getFromCache(_,f,g,o);if(null!==e&&(m=e.attrVals),r){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(_,f,g,s);null!==e&&(S=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(_,f,g,s);null!==e&&(T=e.attrVals)}}}var P=i.getCompNode();if(0==P.isDummy()){v=(C=P.getObjIDSpec_REF()).getPhysID(),D=(E=P.getObjIDSpec_INST())?E.getPhysID():null,I=C.getTenant(),y=C.getServiceName(),R=C.getSecurityContext();let e=t.REFERENCE._getFromCache(I,y,R,v);if(null!==e&&(A=e.attrVals),E){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(I,y,R,D);null!==e&&(b=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(I,y,R,D);null!==e&&(O=e.attrVals)}}}if("MULTI"==e){let e=N.__TREENODE__;c.gatherSyntheticPropHeaders(a,e)}c.gatherHeaderAttrs(a,m,d,"REF"),c.gatherHeaderAttrs(a,A,d,"REF"),c.gatherHeaderAttrs(l,S,p,"INST"),c.gatherHeaderAttrs(l,b,p,"INST"),c.gatherHeaderAttrs(u,T,h,"EFF"),c.gatherHeaderAttrs(u,O,h,"EFF")})}),"list"==e?(o.push(...a),o.unshift({name:"compQty",displayName:`${i.Quantity+" 2"}`,isLeftSide:!1}),o.unshift({name:"baseQty",displayName:`${i.Quantity+" 1"}`,isLeftSide:!0})):(o.push(...a,...l,...u),1==s&&(o.unshift({name:"depth",displayName:i.Depth}),o.unshift({name:"level",displayName:i.Level}))),o.unshift({name:"relName",displayName:i.ComparisonStatus})},gatherSyntheticPropHeaders:function(e,t){if(null!=t){let r=t._options.grid||{},o=Object.keys(r);for(var i=0;i<o.length;i++){let r=o[i];if(r.startsWith("synthProp_")&&!e.some(e=>e.name===r)){let i="";i=null!=t._options&&null!=t._options.NLS_RESOLVED?t._options.NLS_RESOLVED[r]:r.slice("synthProp_".length);for(var n=1;n<3;n++)e.push({name:r,displayName:`${i+" "+n}`,isLeftSide:1==n,attrType:"CUST"})}}}},gatherHeaderAttrs:function(t,n,r,o){let s="INST"==o;n.forEach(n=>{if(n.hasOwnProperty("name")&&!r.includes(n.name)&&!t.some(e=>e.name===n.name)){var a=s?i.InstanceAttrDiapNamePostfix:"";e.isTitleAttr(n,s)?(t.unshift({name:n.name,displayName:`${n.nls+" 2"+a}`,isLeftSide:!1,attrType:o}),t.unshift({name:n.name,displayName:`${n.nls+" 1"+a}`,isLeftSide:!0,attrType:o})):(t.push({name:n.name,displayName:`${n.nls+" 1"+a}`,isLeftSide:!0,attrType:o}),t.push({name:n.name,displayName:`${n.nls+" 2"+a}`,isLeftSide:!1,attrType:o}))}})},stripHeaderData:function(e){strippedHeaderRow=[];for(var t=0;t<e.length;t++)strippedHeaderRow.push(e[t].displayName);return strippedHeaderRow}};return c}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj",["DS/CompareWidget2/support/cw2Utils"],function(e){function t(t){var i=!1;return null!=t&&0!=t.length?i=!0:e.errout("Invalid string (null or zero length)"),i}var i=function(){this._attrList={},this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"};return i.prototype.makeDupe=function(){var e=new i;return e._attrList=JSON.parse(JSON.stringify(this._attrList)),e._reqModforODT=this._reqModforODT,e},i.prototype.isREF=function(){var e=!1;return null==this._attrList.matrixtxt&&(e=!0),e},i.prototype.isINST=function(){return!isREF},i.prototype.addAttr=function(i,n,r){t(i)&&(0!=r&&null!=this._attrList[i]&&this._attrList[i]!=n&&e.warnout("New attr value is overwriting an existing attr value for '"+i+"'"),this._attrList[i]=n)},i.prototype.setAttr=function(e,t){this.addAttr(e,t,!1)},i.prototype.rmAttr=function(e){delete this._attrList[e]},i.prototype.getAttrList=function(){return this._attrList},i.prototype.getAttr=function(e){return ret=null,t(e)&&(ret=this._attrList[e]),ret},i}),define("DS/CompareWidget2/plugins/EXPORT/exManager",["DS/CompareWidgetUtils/CompareExporter","DS/CompareWidget2/plugins/EXPORT/exFormatter","DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport"],function(e,t,i,n){var r=function(e){this._plugSvcs=e,this._exportInProgress=!1,this._exportInProgressDisplayed=!1};return r.prototype._safeGetSettingJSONArray=function(e){var t=[];try{t=JSON.parse(i.get(e))}catch{this._plugSvcs.warnout("Failed to retrieve user setting for "+e+"; returning empty string")}return t},r.prototype.displayExportInProgress=function(){this._exportInProgressDisplayed||(this._exportInProgressDisplayed=!0,this._plugSvcs.showAlertBox(n.CompareExportRunning,null,"warning"))},r.prototype.doExport=function(i,r,o,s,a,l,u){if(this._exportInProgress)this.displayExportInProgress();else{this._exportInProgress=!0;let f=!0;if("MULTI"==o){f=!1;let e=r[0].getMatchPairArray();for(var c=0;c<e.length;c++){if(1!=e[c].getLevel()){f=!0;break}}}var d={columns:[],tables:[{rows:[]}]};if(!1===s){let e={REF:this._safeGetSettingJSONArray("viewSettings.PROP_VIEW.attributes_not_shown"),INST:this._safeGetSettingJSONArray("viewSettings.INSTANCE_VIEW.attributes_not_shown"),EFF:this._safeGetSettingJSONArray("viewSettings.EFFECTIVITY_VIEW.attributes_not_shown")};var p=t.getHeaderRow(o,i,r,e,f);d.columns=t.stripHeaderData(p),d.tables[0].rows=t.createOutputTablesNewFormat(o,i,r,u,a,p,f)}else{let n=!f;var h={structDisplayStyle:o,outputAttributeDifferences:!0,showLevel:f,showQuant:n};e.outHeader(h,d.columns),d.tables[0].rows=t.createOutputTables(o,i,r,u,a,f,n)}if(null==d.tables[0].rows)this._plugSvcs.showAlertBox(n.CompareExportFailure,null,"error");else{var _={csv_base_file_name:n.BaseFilenameExport};switch(l){case"csv":e.generateCsv(d,_);break;case"html":e.printHtml(d,_);break;case"console":e.consoleOutput(d,_)}this._plugSvcs.showAlertBox(n.CompareExportComplete,null,"success",!0)}this._exportReq=null,this._exportInProgress=!1,this._exportInProgressDisplayed=!1}},r}),define("DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/EXPORT/exManager","DS/CompareWidget2/support/tenantServiceContext_IDList"],function(e,t,i){return e.extend({init:function(e,i,n,r){this._parent(e,i,n,r),this.exManager=new t(r),this._propLoadResponders={},this._attrCache={},this._crTreeArray_multiview=null,this._displayMode="unknown",this._useOldExportFormat=!1,this._statusesHidden=!1},onEnabled:function(){var e=this;return e.enableDebugLabel("EXPORT"),e.subscribeEvent("EXECUTE_EXPORT_EVENT",e.handle_EXECUTE_EXPORT_EVENT.bind(e)),e.subscribeEvent("PROPERTIES_LOAD_IN_PROGRESS_EVENT",e.handle_PROPERTIES_LOAD_IN_PROGRESS_EVENT.bind(e)),e.subscribeEvent("PROPERTIES_CACHE_LOADED_EVENT",e.handle_PROPERTIES_CACHE_LOADED_EVENT.bind(e)),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null),e.syncSetting("exportSettings.exportOldFormat","_useOldExportFormat",null),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null),e.syncSetting("viewSettings.STRUCT_VIEW.currentViewID_MULTI","_currentViewID_MULTI",null),e._parent()},handle_EXECUTE_EXPORT_EVENT:function(e){this._plugSvcs.dbgout("EXPORT","exporting... "+this._displayMode),this.exManager.displayExportInProgress();let t=this._crTreeArray;null!=this._crTreeArray_multiview&&(t=this._crTreeArray_multiview[this._currentViewID_MULTI]),this._sendPropLoadRequest(t)},handle_PROPERTIES_LOAD_IN_PROGRESS_EVENT:function(e){this._plugSvcs.dbgout("EXPORT","Received load in progress notification for "+e.data.type),this._propLoadResponders[e.data.type]=!0},handle_PROPERTIES_CACHE_LOADED_EVENT:function(e){var t=this;if(1!=t._propLoadResponders[e.data.type])t._plugSvcs.errout("Received unexpected property update from: "+e.data.type);else{t._plugSvcs.dbgout("EXPORT","Received properties cache loaded notification for "+e.data.type),delete t._propLoadResponders[e.data.type];var i=Object.keys(t._propLoadResponders).length;if(this._attrCache[e.data.type]=e.data.props,0==i){let e=t._crTreeArray,i=t._displayMode;if(null!=t._crTreeArray_multiview){let n=t._currentViewID_MULTI;e=t._crTreeArray_multiview[n],i="MULTI"}t.exManager.doExport(t._attrCache,e,i,t._useOldExportFormat,t._statusesHidden,"csv",this._pluginOptions)}else t._plugSvcs.dbgout("EXPORT","Still waiting on responses from: "+i)}},_sendPropLoadRequest:function(e){var t=new i,n=new i,r=new i,o=new i;e[0].visitAll_treeAndFN(0,function(e){var i=e.getMatchInfo(),s=null==i||"IDENTICAL"!=i.getRelName(),a=s?t:n,l=s?r:o;if(0==e.isDummy()){var u=e.getObjIDSpec_REF(),c=e.getObjIDSpec_INST();if("relations"==u.getObjType())return!0;null!=u&&a.addObjIDSpec(u),null!=c&&l.addObjIDSpec(c)}if(null!=i){var d=i.getCompNode();if(null!=d&&0==d.isDummy()){var p=d.getObjIDSpec_REF(),h=d.getObjIDSpec_INST();null!=p&&a.addObjIDSpec(p),null!=h&&l.addObjIDSpec(h)}}return!0}),e[0].visitAll_treeAndFN(1,function(e){if(null==e.getMatchInfo()){var i=e.getObjIDSpec_REF(),n=e.getObjIDSpec_INST();null!=i&&t.addObjIDSpec(i),null!=n&&r.addObjIDSpec(n)}return!0});var s={loadPropIDS_REF:{diff:t,nodiff:n},loadPropIDS_INST:{diff:r,nodiff:o}};this._plugSvcs.postEvent("LOAD_PROPS_FOR_EXPORT",s),t=null,n=null,r=null,o=null,s=null},onDestroy:function(){return this._parent()},execute:function(e,t){try{var i=this;i._parent(e,t),null!=e.viewID?(null==this._crTreeArray_multiview&&(this._crTreeArray_multiview={}),this._crTreeArray_multiview[e.viewID]=e.crTreeArray):this._crTreeArray=e,i.reportOK(null)}catch(t){i._plugSvcs.dbgout("EXPORT","reports exception:: "+t),i.reportKO(e)}}})}),define("DS/CompareWidget2/framework/viewSetMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,i){function n(e,i,n){return t.makeAuthHttpsCall("/resources/compare2/SelectViewSet/","POST",n,"json",i,e,n.securityContext)}function r(t){return new Promise(function(r,o){var s=e.stringify(t),a=i.getCacheObj("viewSetCache",s);if(null!=a)r(a);else{(function(t,i,r){return new Promise(function(o,s){var a=e.getCurrentTenant();n(t,a,r).then(function(s){var l=s;e.dbgout("INIT","<><> ---\x3e Eval from service "+t+" is "+JSON.stringify(l)),t==i?o(l):n(i,a,r).then(function(t){var n=t;e.dbgout("INIT","<><> ---\x3e Eval from service "+i+" is "+JSON.stringify(n));var r=null;r=l.eval<n.eval?l:n,e.dbgout("INIT","<><> ---\x3e Best is: "+JSON.stringify(r)),o(r)},function(t){e.dbgout("INIT","<><> ---\x3e using: "+JSON.stringify(l)),o(l)})},function(e){t==i?s("failed to find appropriate viewDef: "+e):n(serviceName2,a,r).then(function(e){o(e)},function(e){s("failed to find appropriate viewDef on either service... giving up ("+e+")")})})})})("3DSpace","3DSpace",t).then(function(e){i.putCacheObj("viewSetCache",s,e),r(e)},function(t){e.errout("Failure:: "+t),o(t)})}})}function o(t,i,n,r,o){var s=n.VIEWSETS[i],a={};if(!e.checkViewConfig(s))throw Error("The view set is not properly defined. Please check...");!function(t,i,n){e.getViewDefs(i).forEach(e=>{if(null==t.VIEWDEFS[e])throw Error("extractViewDefs: View def for "+e+" not found");n[e]=t.VIEWDEFS[e]})}(n,s,a);var l=a,u=function(t,i){var n={};return Object.keys(i).forEach(function(r){i[r].forEach(function(i){var r=t.PLUGDEFS[i],o={Path:e.dupeJson(r.Path)};null!=r.Options&&(o.Options=e.dupeJson(r.Options)),n[i]=o})}),n}(n,l);return{RUN_OPTIONS:n.RUN_OPTIONS,viewDefModPath:t,viewSetName:i,VIEWSET:s,VIEWDEFS:l,PLUGDEFS:u,mainToolbarConfigPath:r,mainToolbarOptions:o||[]}}var s=function(){};return s.prototype.loadViewConfig=function(t,i,n,r){return new Promise(function(s,a){require([t],function(a){e.dbgout("INIT","Successfully loaded viewSet '"+i+"' from module '"+t+"'");var l=o(t,i,a,n,r);s(l)},function(i){e.errout("FAILED to load viewDefMod '"+t+"'"),a("LOAD FAILURE")})})},s.prototype.getViewConfig=function(t){var i=this;return new Promise(function(n,o){r(t).then(function(t){if(Array.isArray(t.results)&&t.results.length){let u=t.results[0];var r=u.viewSetMod,s=u.viewSetName,a=u.mainToolbarConfig[0].Location,l=u.mainToolbarConfig[0].DoNotInclude;e.dbgout("INIT","<><> BEST viewSet for usecase is: '"+s+"' from viewDefModule '"+r+"'"),i.loadViewConfig(r,s,a,l).then(function(e){n(e)},function(t){e.errout("Cannot return viewConfigFailure loading fetching viewSet:: "+t),o(t)})}else o(t)},function(t){e.errout("Failure fetching viewSet:: "+t),o(t)})})},s}),define("DS/CompareWidget2/framework/pluginMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,i){function n(t,i,n,r){return new Promise(function(o,s){e.dbgout("INIT","  ... loading plugin: "+t);try{require([t],function(s){var a=new s(t,i,n,r);a.onLoad(),e.dbgout("INIT","  ... loading plugin OK: "+t),o(a)},function(i){e.warnout("Failed to load plugin "+t+":: "+i.message),s(i.message)})}catch(i){e.warnout("Exception trying to load plugin "+t)}})}return{getPlugins:function(t,r){return new Promise(function(o,s){e.dbgout("INIT","------------[ L O A D   P L U G I N S     B E G I N ] -----------");var a={},l=[];Object.keys(t).forEach(function(n){var r=t[n].Path,o=t[n].Options,s=i.getCacheObj("pluginCache",n);null==s?l.push({plugName:n,plugPath:r,pluginOptions:o}):(e.dbgout("Plugin "+r+" found in cache; load not required"),a[n]=s)});var u=l.length;if(e.dbgout("INIT","Must load "+u+" plugins..."),0==u)o(a);else{var c=[];for(let e=0;e<u;e++){var d=l[e].plugPath,p=l[e].plugName,h=l[e].pluginOptions;c.push(n(d,p,h,r))}Promise.allSettled(c).then(function(t){let n=0;for(let e=0;e<t.length;e++)if("rejected"!==t[e].status&&null!=t[e].value){var r=t[e].value,u=(r.getPath(),r._name);a[u]=r,i.putCacheObj("pluginCache",u,r),n++}else s("Failed to find plugin '"+l[e]);n===l.length&&(e.dbgout("INIT","------------[ L O A D   P L U G I N S     E N D    ] -----------"),o(a))})}})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(e){this._objIDSpec=e,this._rootRefInstNode=null,this._pathArray=[],this._dataSource="UNKNOWN",this._editsApplied=!1,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree"};return t.prototype.makeDupe=function(){var e=this._objIDSpec.makeDupe(),i=this._rootRefInstNode.makeDupe(),n=new t(e);return n._rootRefInstNode=i,n._pathArray=JSON.parse(JSON.stringify(this._pathArray)),n._dataSource=this._dataSource,n._editsApplied=this._editsApplied,n._reqModforODT=this._reqModforODT,n},t.prototype.getEditCommands=function(){var e=null;return null!=this._objIDSpec&&(e=this._objIDSpec.getCommands()),e},t.prototype.get_editsHaveBeenApplied=function(){return this._editsApplied},t.prototype.set_editsHaveBeenApplied=function(){this._editsApplied=!0},t.prototype.getObjIDSpec=function(){return this._objIDSpec},t.prototype.setDataSource=function(e){null!=e&&0!=e.length&&(this._dataSource=e)},t.prototype.setRoot=function(e){this._rootRefInstNode=e},t.prototype.getRoot=function(){return this._rootRefInstNode},t.prototype.setPathArray=function(e){this._pathArray=e},t.prototype.getPathArray=function(){return this._pathArray},t.prototype.sortChildren=function(){this.visit_riTreeAndFN(function(e){e.sortChildArray()})},t.prototype.findNodeByPhysIDPath=function(e){var t=e.split("/");if(this._rootRefInstNode.get_dbObj_REF().getAttr("REF.physicalid")!=t[0]);else for(var i=this._rootRefInstNode,n=t.length,r=1;r<n;r+=2){var o=t[r],s=t[r+1];if(null==(i=i.findChild(o,s)))break}return i},t.prototype.visit_riTreeAndFN=function(t){return null==this._rootRefInstNode?e.errout("'visit_riTreeAndFN()' called, but tree has no root"):this._rootRefInstNode.visit_subtreeAndFN(t),!0},t}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_LIST_plugin",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_TREE_plugin","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree"],function(e,t,i,n){return e.extend({_makeDummyRoot:function(){var e=new t;return new i(e,null)},_splitString_QuantUnit:function(e){var t=null;if(null!=e&&0!=e.length){var i=e.split(" ");if(i.length>0){var n=Number.parseFloat(i[0]);0==Number.isNaN(n)&&(t={number:n,unit:""},i.length>1&&(t.unit=i[1]))}}return t},doAggregate:function(e,t,i){var r=this,o=[];return new Promise(function(i,s){e.forEach(function(e){var i=[],s={};e.visit_riTreeAndFN(function(e){try{var n=e.getAttr("REF.physicalid"),o=s[n],a=null==o;a&&(i.push(e),s[n]=e,o=e);let h=null!=t.ROLLUP_PROPS?t.ROLLUP_PROPS.length:0;for(var l=0;l<h;l++){let i=t.ROLLUP_PROPS[l],n=i.SOURCE_NAME,s=i.DEST_NAME,h="";var u=1,c="";if(null!=n&&""!=n){var d=e.getAttr(n),p=r._splitString_QuantUnit(d);u=null==p?1:null==p.number?1:p.number,c=null==p?"":null==p.unit?"":p.unit}if(1==a)h=u.toString(),null!=c&&""!=c&&(h+=" "+c);else{let e=o.getAttr(s),t=r._splitString_QuantUnit(e),i=t.number,n=t.unit;n!=c&&r._plugSvcs.errout("Unit mismatch while aggregating: Existing units are: "+n+"; new units are: "+c),h=(Number.parseFloat(i)+u).toString(),null!=c&&""!=c&&(h+=" "+c)}o.setAttr(s,h)}e.set_dbObj_INST(null)}catch(e){console.error("EXCEPTION AGGREGATING: "+e)}return!0});var a=r._makeDummyRoot();i.forEach(function(e){e.rmAllChildren(),e.setParent(a,!0),a.addChild(e)});var l=e.getObjIDSpec().makeDupe(),u=new n(l);u.setRoot(a),o.push(u)}),i(o)})}})}),define("DS/CompareWidget2/framework/CPF",["DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/useCase","DS/CompareWidget2/framework/viewSetMgr","DS/CompareWidget2/framework/svcNodeNet","DS/CompareWidget2/framework/pluginMgr","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,i,n,r,o,s,a,l){var u=function(e,i,r,o,s){this._viewPanelMgr=e,this._viewSetMgr=new n,this._plugSvcs=r,this._eventMgr=i,this._svcNodeNet=null,this._ccm=s,this._currentUseCase=null,t.enableDebugLabel("INIT"),t.enableDebugLabel("PROC_CONTROL"),this._okToUseVars=null,null!=o&&1==o.isODT&&(this,this.forODT=c)};u.prototype._filter_ID_2_ID_w_filter=function(e){var i=this;return new Promise(function(n,r){s.fetchFilterDefinition(e).then(function(o){var l=o,u=JSON.parse(l.filterCVQuery),c=l.rootPhysicalId;if(null==c&&(c=u.CVQuery.union.expand[0].root_path_physicalid[0][0]),null==c){let e="DataCenter.fetchFilterDefinition: Failed to get the root of the filter definition";t.errout(e),r(e)}var d={physicalid:[c],label:widget._isODTMode()?"":"CompareFindFilteredObject-"+t.nowMS(),select_predicate:["ds6w:label","physicalid","ds6w:type","interface"]};s.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",d,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(t){let i={};t.results[0].attributes.forEach(function(e){i[e.name]=e.value});var r={...u,empty:!1,appId:"CompareWidget",widget:widget.id,filterRootIds:[c],filterRootAlias:[i["ds6w:label"]],filterTitle:l.filterTitle,hideChildren:!1},o=new a(c,i["ds6w:type"],e.getSecurityContext(),e.getTenant(),e.getServiceName(),r,"modelID",null,!0,!0,[i.interface]);n(o)},function(e){i._plugSvcs("EXCEPTION doing simple expand: "+e),r(e)})},function(e){i._plugSvcs("EXCEPTION getting filter defn: "+e),r(e)})})},u.prototype._massageObjIDs=function(e){var i=this;return new Promise(function(n,r){!function(e){for(var i=e.length,n=!1,r=!1,o=0;o<i;o++)null!=(u=(d=e[o]).getSecurityContext())&&""!=u||(n=!0),null!=(c=d.getTenant())&&""!=c||(r=!0);if(n||r){var s=null,a=null;for(o=0;o<i;o++){var l=e[o];if(n&&null!=(u=l.getSecurityContext())&&""!=u&&(n=!1,s=u),r&&null!=(c=l.getTenant())&&""!=c&&(r=!1,a=c),0==n&&0==r)break}for(o=0;o<i;o++){var u,c;null!=(u=(d=e[o]).getSecurityContext())&&""!=u||(null==s?t.errout("Missing security context in request (can not repair)..."):(t.warnout("Missing security context in request (repairing)..."),d._securityContext=s)),null!=(c=d.getTenant())&&""!=c||(null==s?t.errout("Missing tenant in request (can not repair)..."):(t.warnout("Missing tenant in request (repairing)..."),d._tenant=a))}}for(o=0;o<i;o++){var d,p=(d=e[o]).getServiceName();"3dspace"==p.toLowerCase()&&"3DSpace"!=p&&(t.warnout("Correcting malformed service name '"+p+"' to '3DSpace'"),d._serviceName="3DSpace")}}(e);var o=[],s=[];e.forEach(function(e,t){"ENOStrRefinementSpecification"!=e.getObjType()?o[t]=e:s.push(t)});var a=s.length;0==a?n(e):s.forEach(function(o){let s=o,l=e[o];i._filter_ID_2_ID_w_filter(l).then(function(t){console.debug("TEST NEW: "+JSON.stringify(t)),e[s]=t,--a<=0&&n(e)},function(e){t.errout("Failure comparing with use case: "+e),r(e)})})})},u.prototype.compareObjs=function(e,n){var r=this;return r._printStartMsg(n),r._viewPanelMgr.hideAllShowBusy(),new Promise(function(o,s){return new Promise((e,t)=>{l.getGrantedRoles(e)}).then(a=>{let l=a.map(e=>e.id).filter(e=>null!=e);l.push("*"),r._massageObjIDs(n).then(function(a){n=a;let u=r._currentUseCase=new i(e.app,l,n);r._compareObjsWithUseCase(n,u,e.noViewDefMatchDefaultToCompare).then(function(e){o(e)},function(e){t.errout("Failure comparing with use case: "+e),s(e)})},function(e){t.errout("Failure massaging ObjIDSpecs: "+e+"; cannot create use case for comparison"),s(e)})})})},u.prototype.compareObjsWithViewSetName=function(e,i,n,r,o){var s=this;return new Promise(function(a,l){s._printStartMsg(e),s._viewPanelMgr.hideAllShowBusy(),s._viewSetMgr.loadViewConfig(i,n,r,o).then(function(i){var n=i;s._compareObjsWithViewConfig(e,n).then(function(e){t.dbgout("INIT","compare with viewSetName is OK!"),a(e)},function(e){t.errout("compare with viewSetName FAILURE!!!"),l(e)})},function(e){t.errout("Failure to load view config: "+e),l(e)})})},u.prototype._sendUpdatedInputToSvcNodeNet=function(e){var i=!1;this._viewPanelMgr.showResultFrame();var n=t.nowMS();return null==this._svcNodeNet?t.errout("No svcNodeNet to update"):(this._svcNodeNet.updateInput(e),i=!0),t.reportTime(n," ##### update input"),i},u.prototype._compareObjsWithUseCase=function(i,n,r){var o=this;t.dbgout("INIT","<><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><> USE CASE     APP: "+n.getApp()),t.dbgout("INIT","<><> USE CASE    ROLE: "+n.getRoles().join("~")),n.getSvcTypeArray().forEach(function(e){t.dbgout("INIT","<><> USE CASE svcType: "+e)}),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><>");var s=t.nowMS();let a=function(r,a){t.reportTime(s,"get viewConfig for use case");let l=r,u=!1,c=null;if(null!=l.RUN_OPTIONS&&!0===l.RUN_OPTIONS.customCompareActive&&!0===widget.CV2EnableCustomProfile){u=!0;var d=o._ccm.getUserPreferredProfileName(n);null==d||o._ccm.isDefaultProfile(d)?(u=o._ccm.doesUseCaseTemplateProfileExist(n),c=[Promise.resolve(null)]):(t.dbgout("INIT","<><> using CUSTOM PROFILE: '"+d+"'"),(c=e.forceIndex_DisableOtherRelations_ForCustomProfilePromiseArray()).push((async()=>{l=await o._ccm.applyCustomProfileToViewConfig(d,l)})()))}else c=[Promise.resolve(null)];Promise.allSettled(c).then(()=>{o._compareObjsWithViewConfig(i,l,n,u).then(function(e){t.dbgout("INIT","compare with useCase is OK!"),a(e)},function(e){t.errout("compare with useCase FAILURE!!!"),KOfn(e)})})};return new Promise(function(e,i){o._viewSetMgr.getViewConfig(n).then(t=>{a(t,e)},function(s){console.log(`View Def not found for Use Case:${n.stringify()}`),Array.isArray(s.errors)&&s.errors.length&&s.errors.some(e=>-1!==e.indexOf("NO MATCHES FOUND"))&&!0===r?(n.app="COMPARE",console.log(`Requesting view def with the use case:${n.stringify()}`),o._viewSetMgr.getViewConfig(n).then(t=>{a(t,e)},function(e){t.errout("FAILED getting viewConfig for use case"),i(e)})):(t.errout(`FAILED getting viewConfig for use case:${n.stringify()}`),i(s))})})},u.prototype._buildSvcNodeNet=function(e){var t=new r(this._plugSvcs,this._eventMgr);return t.build(e),t},u.prototype._okToReuse=function(e){var t=!1,i=JSON.stringify(e);return null!=this._okToUseVars&&(t=this._okToUseVars.lastViewDef_str==i),0==t&&(this._okToUseVars={lastViewDef_str:i}),t},u.prototype._compareObjsWithViewConfig=function(e,i,n,r){var s=this;return new Promise(function(a,l){var u=i.viewDefModPath,c=i.viewSetName,d=i.mainToolbarConfigPath,p=i.mainToolbarOptions;if(t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><> USING viewDefMod: "+u),t.dbgout("INIT","<><> USING    viewSet: "+c),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>"),s._okToReuse(i))t.dbgout("INIT","<><> --\x3e viewSet still the same... reusing existing viewConfig"),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),s._sendUpdatedInputToSvcNodeNet(e),a();else{var h=t.nowMS();o.getPlugins(i.PLUGDEFS,s._plugSvcs).then(function(o){t.reportTime(h,"--\x3e load all plugins"),i.PLUGSLOADED=o,t.dbgout("INIT","<><> --\x3e viewSet is new... building new svcNodeNet..."),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),null!=s._svcNodeNet&&(s._svcNodeNet.destroy(),s._viewPanelMgr.releaseViewPanels(),s._svcNodeNet=null),s._svcNodeNet=s._buildSvcNodeNet(i);var l=s._svcNodeNet.getViewSvcNodeNames();s._viewPanelMgr.setDefaultViewConfig(u,c,i,d,p,l),s._svcNodeNet.buildViewPanels(n,r),s._svcNodeNet.enableAll(),s._sendUpdatedInputToSvcNodeNet(e),a()},function(e){t.errout("INIT","Error loading plugins:: "+t.stringify(e)),l(e)})}})},u.prototype._printStartMsg=function(e){if(t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><><><><><><><><><>   BEGIN NEW COMPARE  <><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),null!=e[0].objAMDName)for(var i=0;i<e.length;i++)t.dbgout("INIT","<><> ID ["+i+"]: AMD Module Name : "+e[i].objAMDName);else for(i=0;i<e.length;i++)t.dbgout("INIT","<><> ID ["+i+"]: SERVICE : "+e[i].getServiceName()),t.dbgout("INIT","<><> ID ["+i+"]:      ID : "+e[i].getPhysID()),t.dbgout("INIT","<><> ID ["+i+"]: OBJTYPE : "+e[i].getObjType()),t.dbgout("INIT","<><> ID ["+i+"]:   TENANT: "+e[i].getTenant()),t.dbgout("INIT","<><> ID ["+i+"]: SEC CTXT: "+e[i].getSecurityContext()),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>");t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>")};var c={};return u}),define("DS/CompareWidget2/plugins/DATA/attrCache",["DS/CompareWidget2/plugins/DATA/attrValObjSet","DS/CompareWidget2/support/tenantServiceContext_IDList","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,n){function r(e){for(var t={data:[],tn:e.dbContext.tenant,sc:e.dbContext.securityContext,sn:e.dbContext.serviceName,i1:e.iconURL,i2:e.iconURLLarge,id:e.physicalID,ty:e.objType},i=e.attrVals.length,n=0;n<i;n++){var r=e.attrVals[n],o=[r.name,r.nls,JSON.stringify(r.value),r.type,r.UIPosition];t.data.push(o)}return t}var o=function(e,t,i){this._cacheType=e?"(INST)":t?"(EFFECTIVITY)":"(REF)",this._isInstance=e,this._isEffectivity=t,this._plugSvcs=i,this._dbgout=i.dbgout,this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1};return o.prototype.isFullyLoaded=function(){return this._cacheIsLoaded},o.prototype.flushCache=function(){var e=JSON.stringify(this._theCache).length;e>2&&(this._plugSvcs.dbgout("ATTR_CACHE",this._cacheType+" Property value cache (current size: "+e+" characters) is being flushed ..."),this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1)},o.prototype.getAttrData=function(e){var i=this,n=[];return new Promise(function(r,o){var s=new t;e.forEach(function(e){s.addObjIDSpec(e)}),i._updateCache(s,!0).then(function(t){0==t?r(null):(e.forEach(function(e){var t=e.getTenant(),r=e.getServiceName(),o=e.getSecurityContext(),s=e.getPhysID(),a=i._getFromCache(t,r,o,s);a&&(void 0===a.objType||null===a.objType&&""===a.objType)&&(a.objType=e.getObjType()),n.push(a)}),r(n))},function(e){var t=i._cacheType+" fetch data failed:: "+e;o(t)})})},o.prototype._getFromCache=function(t,i,n,r){var o=null;if(null!=t&&null!=i&&null!=n&&null!=r&&""!==r){var s=this._theCache[t][i][n][r];null!=s?o=function(t){var i=t.tn,n=t.sc,r=t.sn,o=t.i1,s=t.i2,a=t.id,l=t.ty,u=new e(a,l,s,o);return u.setDBContext(n,r,i),t.data.forEach(function(e){var t=e[0],i=e[1],n=null==e[2]?null:JSON.parse(e[2]),r=e[3],o=e[4];u.add(t,i,n,r,o)}),u}(s):this._dbgout("ATTR_CACHE","_getFromCache() "+r+" not in cache!")}return o},o.prototype.doPreload=function(e){var t=this;return new Promise(function(i,n){try{t._cacheIsLoaded?i(t):t._preloadInProgress?n(t._cacheType+" doPreload() is already in progress... ignoring request"):(t._preloadInProgress=!0,t._dbgout("ATTR_CACHE",t._cacheType+" PRELOADING 'diff'"),t._updateCache(e.diff,!1).then(function(r){0==r||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheType+" load aborted / data is no longer relevant."),t._preloadInProgress=!1,n("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheType+" PRELOADING 'nodiff'"),t._updateCache(e.nodiff,!1).then(function(e){0==e||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheType+" load aborted / data is no longer relevant."),n("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheType+" *CACHE FULLY LOADED* for current model"),t._cacheIsLoaded=!0,t._preloadInProgress=!1,i(t))},function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheType+" LOAD 'nodiffs' FAILED: "+e),n(e)}))},function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheType+" LOAD 'diffs' FAILED: "+e),n(e)}))}catch(e){t._preloadInProgress=!1,t.me._plugSvcs.errout("EXCEPTION while loading cache... aborted:: "+e),n(e)}})},o.prototype._updateCache=function(e,t){var i=this,n=0,r=0,o=0;return new Promise(function(s,a){i._dbgout("ATTR_CACHE",i._cacheType+" Looking for objects in ATTR_FETCH cache...");var l=[];Object.keys(e._data).forEach(function(s){null==i._theCache[s]&&(i._theCache[s]={}),Object.keys(e._data[s]).forEach(function(a){null==i._theCache[s][a]&&(i._theCache[s][a]={}),Object.keys(e._data[s][a]).forEach(function(u){null==i._theCache[s][a][u]&&(i._theCache[s][a][u]={});var c=Object.keys(e._data[s][a][u]),d=[];if(c.forEach(function(e){if(void 0===i._theCache[s][a][u][e]||null===i._theCache[s][a][u][e]&&1==t){if(r++,d.push(e),i._theCache[s][a][u][e]=null,d.length>=10){var c={reqTenant:s,reqServiceName:a,reqSecurityContext:u,reqIDArray:d};l.push(c),d=[]}}else 0==t&&null==i._theCache[s][a][u][e]?o++:n++}),d.length>0){var p={reqTenant:s,reqServiceName:a,reqSecurityContext:u,reqIDArray:d};l.push(p)}})})});var u=r>0?", must fetch...":"";i._dbgout("ATTR_CACHE",i._cacheType+" HIT: "+n+", MISS: "+r+u),0==l.length?s(0==o):(i._dbgout("ATTR_CACHE",i._cacheType+" *FETCHING PROPS* for "+r+" objects using "+l.length+" request set(s)"),i._doBigFetch(l).then(function(e){s(e)},function(e){a(e)}))})},o.prototype._doBigFetch=function(t){var i=this;return new Promise(function(o,s){var a=0,l=t.length,u=l;function c(d){var p=d;if(--u>0){var h=p.result.results.length;i._dbgout("ATTR_CACHE",i._cacheType+" ...processing returned data set ("+h+" items in set); still have "+u+" requests to go...")}else i._dbgout("ATTR_CACHE",i._cacheType+" processing returned data...");for(var _=function(t,i){for(var r=[],o=t.length,s=0;s<o;s++)for(var a=t[s],l=a.result.results.length,u=0;u<l;u++){var c=a.result.results[u],d=new e(c.physicalID,c.type,c.type_icon_large_url,c.type_icon_url);if(d.setDBContext(a.securityContext,a.serviceName,a.tenant),i||d.add("thumbnailimage",n.thumbnailimage,c.thumbnail,"thumbnail",0),void 0!==c.basicData&&null!==c.basicData&&c.basicData.length>0)for(let e of c.basicData){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;d.add(e.name,t,e.value,e.type,e.UIPosition)}if(void 0!==c.data&&null!==c.data&&c.data.length>0)for(let e of c.data){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;d.add(e.name,t,e.value,e.type,e.UIPosition)}r.push(d)}return r}([p],i._isEffectivity),f=_.length,g=0;g<f;g++){var m=_[g],S=m.getPhysicalID(),T=m.dbContext.tenant,C=m.dbContext.serviceName,E=m.dbContext.securityContext,v=r(m);i._theCache[T][C][E][S]=v}if(a<l){var D=t[a++];i._dbgout("ATTR_CACHE",i._cacheType+" sending request #"+a+" of "+l+"("+D.reqIDArray.length+" objects)"),i._fetchReqSet(D).then(function(e){null==e?i._dbgout("ATTR_CACHE","Data discarded"):c(e)},function(e){s(e)})}else u<=0&&o(!0)}for(a=0;a<2&&a<l;a++){var d=t[a];i._dbgout("ATTR_CACHE",i._cacheType+" sending request #"+(a+1)+" of "+l+" ("+d.reqIDArray.length+" objects)"),i._fetchReqSet(d).then(function(e){c(e)},function(e){s(e)})}})},o.prototype._fetchReqSet=function(e){var t=this;return new Promise(function(i,n){setTimeout(()=>{var r=t._plugSvcs.nowMS(),o=t._theCache;t._getAttrs(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext).then(function(s){if(o!==t._theCache)t._dbgout("ATTR_CACHE",t._cacheType+" Cache was flushed; incoming data ignored"),i(null);else{var a=s;if(Array.isArray(a.result.results)&&a.result.results.every(e=>!1!==e.success)){var l=e.reqIDArray.length,u="[ATTR_CACHE]"+t._cacheType+" FETCHED PROPS for "+l+" OBJECTS";if(t._plugSvcs.reportTime(r,u),"3dspace"===a.serviceName.toLowerCase())if(t._isInstance)a.result.results.forEach(e=>e.thumbnail=e.preview_url.length?e.preview_url:e.type_icon_large_url),i(a);else if(t._isEffectivity)i(a);else{var c=t._plugSvcs.nowMS();t._getThumbnails(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext,a.result.results).then(function(n){t._plugSvcs.reportTime(c,"[CACHE]"+t._cacheType+" "+e.reqIDArray.length+" thumbnails loaded");var r=n;t._mergeInThumbInfo(a,r),i(a)},function(e){var n="attr fetch was OK (but missing thumbnails) :: "+e;t._plugSvcs.errout(n),i(a)})}else{for(let e of a.result.results)if(e.hasOwnProperty("preview_url")&&""!==e.preview_url)e.thumbnail=e.preview_url;else{var d=e.data.findIndex(function(e){return"preview_url"===e.name});if(d>=0){let t=e.data.splice(d,1);e.thumbnail=t[0].value}}i(a)}}else n("Failure getting Attributes: ")}},function(e){var i="Failure getting Attributes: "+e;t._plugSvcs.errout(i),n(i)})},1)})},o.prototype._getAttrs=function(e,t,n,r){var o=this;if(o._isEffectivity)return new Promise(function(o,s){i.getEffectivityPromise2({objectIds:e,serviceIds:[t],tenant:n,securityContext:r}).then(function(e){o({serviceName:t,tenant:n,securityContext:r,result:e})})});if("3dportfolio"===t.toLowerCase()||"3dspace"===t.toLowerCase()){let i="",s="",a="";return"3dportfolio"===t.toLowerCase()?(i="/"+t+"/getAttrs",s="GET",a="objectIds="+e.join(",")):"3dspace"===t.toLowerCase()&&(i="/resources/v1/collabServices/attributes/op/read/",s="POST",a=!0===o._isInstance?{debug_properties:"",plmparameters:"true",relIDs:e,lIds:[]}:{debug_properties:"",readonly:"false",navigateToMain:"true",attributes:"true",plmparameters:"true",busIDs:e,relIDs:[],lIds:[]}),new Promise(function(e,l){o._plugSvcs.makeAuthHttpsCall(i,s,a,"json",n,t,r).then(function(i){e({serviceName:t,tenant:n,securityContext:r,result:i})},function(e){o._plugSvcs.errout("Failure retrieving attributes for object"),l(null)})})}return new Promise(function(o,s){i.getFederatedAttributesPromise({objectIds:e,serviceIds:[t],tenant:n,securityContext:r}).then(function(e){o({serviceName:t,tenant:n,securityContext:r,result:e})})})},o.prototype._getThumbnails=function(e,t,i,n,r){var o=this,s=[],a=e.length,l=0;return new Promise(function(u,c){e.forEach(function(e){let d=r.find(t=>t.physicalID===e),p=void 0!==d?d.preview_url:"";if(null!=p&&""!==p)s[e]=p,++l>=a&&u(s);else{var h="/resources/compare/thumbnailUrl/"+e;o._plugSvcs.makeAuthHttpsCall(h,"GET",null,"text",i,t,n).then(function(n){var r=n;0==r.startsWith("http")&&(r=o._plugSvcs.makeServiceURL(t,i,r,null)),s[e]=r,++l>=a&&u(s)},function(e){c(e)})}})})},o.prototype._mergeInThumbInfo=function(e,t){e.result.results.forEach(function(e){var i=e.physicalID,n=t[i];e.thumbnail=n})},o}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/DATA/attrCache"],function(e,t){return e.extend({init:function(e,i,n,r){this._parent(e,i,n,r),this.enableDebugLabel("ATTR_CACHE"),this._isInstance=this._pluginOptions.isInstance,this._isEffectivity=this._pluginOptions.isEffectivity,this._DEBUG_isInstTxt=this._isInstance?"(INST)":this._isEffectivity?"(EFFECTIVITY)":"REF)",this._attrCache=new t(this._isInstance,this._isEffectivity,r),this._comparisonInProgress=!1},onEnabled:function(){var e=this;return e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",function(e){var t=this,i=e.data.selectedData;t._plugSvcs.dbgout("A new row has been selected..."),t._attrUpdateStartMS=t._plugSvcs.nowMS();var n=[];if(e.data.selectedData){var r=i[0].length>i[1].length?i[0]:i[1];if(0===r.length)return;if(t._isInstance){if("LIST"==e.data.structDisplayMode)return void t.postEvent("INST_PROPS_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=r.length)return void t.postEvent("INST_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else if(t._isEffectivity){if("LIST"==e.data.structDisplayMode)return void t.postEvent("EFFECTIVITY_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=r.length)return void t.postEvent("EFFECTIVITY_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else{var o=!0;if("LIST"!=e.data.structDisplayMode)1!=r.length&&(o=!1);else{var s=r[0].ObjIDSpec.getPhysID();r.forEach(function(e){e.ObjIDSpec.getPhysID()!=s&&(o=!1)})}if(!o)return void t.postEvent("REF_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}i.forEach(function(e){if(null!=e&&e.length>0){var i=e[0],r=t._isInstance||t._isEffectivity?i.instObjIDSpec:i.ObjIDSpec;null!=r&&n.push(r)}});let a=0;for(let e of n){let t=e.getPhysID();null!=t&&""!==t&&++a}if(0==a)t._plugSvcs.postEvent(t._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":t._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"});else{if("relations"===n[0].getObjType())return void t.postEvent("GROUP_PLACEHOLDER_SELECTED",{id:"attrFetch"});t._plugSvcs.postEvent(t._isInstance?"INST_PROPS_UPDATE_IN_PROGRESS_EVENT":t._isEffectivity?"EFFECTIVITY_UPDATE_IN_PROGRESS_EVENT":"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),t._attrCache.getAttrData(n).then(function(e){if(null!=e){for(var i=!0,n=0;n<e.length;n++)if(null!=e[n]){i=!1;break}i?t._plugSvcs.postEvent(t._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":t._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):t.updateOutput(e)}},function(e){var i="getAttrData() failed:: "+e;t._plugSvcs.dbgout("ATTR_CACHE",t._DEBUG_isInstTxt+i)})}}}.bind(this)),e.subscribeEvent("LOAD_PROPS_FOR_EXPORT",function(e){var t=this,i=t._isInstance?"INSTANCE":t._isEffectivity?"EFFECTIVITY":"REFERENCE";let n={type:i};t._plugSvcs.postEvent("PROPERTIES_LOAD_IN_PROGRESS_EVENT",n);let r=this._isInstance?e.data.loadPropIDS_INST:this._isEffectivity?e.data.loadPropIDS_INST:e.data.loadPropIDS_REF;t._attrCache.doPreload(r).then(function(e){let n={type:i,props:e};t._plugSvcs.postEvent("PROPERTIES_CACHE_LOADED_EVENT",n)},function(e){this._plugSvcs.errout("FAILED to load props: "+e)})}.bind(this)),e.subscribeEvent("EVENT_FLUSH_DATA_CACHES",function(e){this._attrCache.flushCache()}.bind(e)),e._parent()},onDestroy:function(){return this._parent()},execute:function(e,t){var i=this;i._parent(e,t),this._comparisonInProgress=!0;let n=e;i._isInstance?i.postEvent("INST_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):i._isEffectivity?i.postEvent("EFFECTIVITY_OFF_NONE_AVAILABLE",{id:"attrFetch"}):(i._plugSvcs.postEvent("REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),i._plugSvcs.dbgout("Performing initial ATTR_FETCH"),i._attrCache.getAttrData(n).then(function(e){null!=e&&i.reportOK(e)},function(e){i._plugSvcs.showAlertBox("Failed to retrieve properties",null,"error"),i._plugSvcs.postEvent(i._isInstance?"INST_PROPS_FETCH_FAILED":i._isEffectivity?"EFFECTIVITY_FETCH_FAILED":"REF_PROPS_FETCH_FAILED"),i.reportKO(e)}))}})}),define("DS/CompareWidget2/ViewDefModules/CreateAssembly_Options",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],function(e,t){"use strict";let i={STRUCT_FETCH_OPTIONS:{PROGRESSIVE_EXPAND_OPTIONS:{graph:{descending_condition_relation:{uql:"(flattenedtaxonomies:reltypes/DELFmiFunctionIdentifiedInstance)"}}},EXPAND_V1_OPTIONS:{no_type_filter_bo:["PLMPort","PLMConnection","VPMReference"]}}};return e.extend(i.STRUCT_FETCH_OPTIONS,t.STRUCT_FETCH_OPTIONS),e.merge(i,t),i}),define("DS/CompareWidget2/ViewDefModules/CreateAssembly_ViewDefs",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/CreateAssembly_Options"],function(e,t,i){"use strict";let n={PLUGDEFS:{StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:i.STRUCT_FETCH_OPTIONS}}};return e.merge(n.PLUGDEFS,t.PLUGDEFS),e.merge(n,t),e.extend(n,i),n}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/multiViewPanel",["DS/CustomizableLayout/View","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/structFlexibleViewPanel","DS/UIKIT/Mask","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n){"use strict";return e.extend({init:function(e,t,i){this._parent(i),this.elements.container=e,this.elements.container.addClassName("multi-view-panel"),this._plugSvcs=t,this._structFlexViewPanels={},this._currentViewPanel=null,this._multiStatusesToHideAnd=!1,this.buildSkeleton(),this._displayModes={}},buildSkeleton:function(e){},clearView:function(){var e=this;Object.keys(this._structFlexViewPanels).forEach(function(t){e._structFlexViewPanels[t].clearView()})},destroy:function(){var e=this;e.elements.container=null,e._plugSvcs=null,e._currentViewPanel=null,Object.keys(this._structFlexViewPanels).forEach(function(t){e._structFlexViewPanels[t].destroy(),delete e._structFlexViewPanels[t]})},_updateViewDropDowns:function(e){let t=this;var i=[];Object.keys(e).forEach(function(t){i.push(e[t])}),Object.keys(this._structFlexViewPanels).forEach(function(e){t._structFlexViewPanels[e].updateViewDropDowns(i)})},_setCurrentViewID:function(e){let t=this;t.showView(e),Object.keys(this._structFlexViewPanels).forEach(function(i){t._structFlexViewPanels[i].setCurrentViewID(e)})},reqChangeCurrentViewID:function(e){this._setCurrentViewID(e)},showResults:function(e,n,r,o){let s=this;return new Promise(function(a,l){var u=n.getViewID();s._displayModes[u]=n.getDisplayMode();var c=s._structFlexViewPanels[u];if(0==i.isMasked(s.elements.container)&&i.mask(s.elements.container),null==c){let i={reqChangeCurrentViewID:s.reqChangeCurrentViewID.bind(s)};c=new t(s.elements.container,s._plugSvcs,e,n,r,i,o),s._structFlexViewPanels[u]=c,null==s._currentViewID_MULTI||""==s._currentViewID_MULTI||u==s._currentViewID_MULTI?s._setCurrentViewID(u):c.hide(),s._updateViewDropDowns(s._displayModes)}c.showResults(o,r,a),a()})},showView:function(e){var t=this._structFlexViewPanels[e];null!=t&&t!=this._currentViewPanel&&(null!=this._currentViewPanel&&this._currentViewPanel.hide(),t.show(),this._currentViewPanel=t),this._currentViewID_MULTI=e},onResize:function(){null!=this._currentViewPanel&&this._currentViewPanel.onResize()},getLabel:function(){return n[this.elements.container.id]},getName:function(){return this.elements.container.id},onComparePanelUpdated:function(){null!=this._currentViewPanel&&this._currentViewPanel.onComparePanelUpdated()},onActivate:function(){null!=this._currentViewPanel&&this._currentViewPanel.onActivate()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_FLEXIBLE_VIEW_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/multiViewPanel"],function(e,t){"use strict";return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},_setFilterOnStateCB:function(e){this._outputPanel.setFilterOnState(e)},onEnabled:function(){var e=this;return e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.syncSetting("viewSettings.STRUCT_VIEW.currentViewID_MULTI","_currentViewID_MULTI",null,e._outputPanel),e._parent()},createViewPanelObject:function(e,i){return new t(e,this._plugSvcs,i)},execute:function(e,t){var i=this;i._parent(e,t);var n=e.compareTreeDocumentArray,r=e.gridView,o=e.flagDisplayData;i._outputPanel.showResults(t,r,o,n).then(function(e){i.showNotBusy();var t=n[0].__CRTREE__;i.reportOK({viewID:r.getViewID(),crTreeArray:[t]})},function(e){i.reportKO(e)})}})}),define("DS/CompareWidget2/cw2",["DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/CPF","DS/CompareWidget2/framework/pluginServices","DS/CompareWidget2/widget/viewPanelMgr","DS/CompareWidget2/support/EventManager","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/Customization/CompareCustomizationManager","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,r,o,s,a,l){var u={getAck:function(){return"Ack"}},c=function(e,l){(l=l||{}).viewDefType=null!=l.viewSetMod&&null!=l.viewSetName?"AS_GIVEN":"LOOKUP";this._runOptions={app:"COMPARE",viewDefType:"LOOKUP",viewSetName:"STRUCT_ONLY",viewSetMod:"DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",isODT:!1},Object.assign(this._runOptions,l,this._runOptions);let c=t.dupeJson(this._runOptions.user)||{};var d=this;this._eventMgr=new o,this._ccm=new a,this._ccm.init().then(t=>{d._viewPanelMgr=new r(e,d._eventMgr,d._runOptions,d._ccm);var o=new n(d._viewPanelMgr,d._eventMgr,c);if(d._CPF=new i(d._viewPanelMgr,d._eventMgr,o,d._runOptions,d._ccm),d._eventTokens=[],d._eventTokens.push(d._eventMgr.subscribe({event:"Event_inputUpdate"},d._handler_inputUpdate.bind(d))),d._eventTokens.push(d._eventMgr.subscribe({event:"Event_replaceCompare"},d._handler_replaceCompare.bind(d))),d._eventTokens.push(d._eventMgr.subscribe({event:"Event_CW2_SWAP"},d._handler_CW2_SWAP.bind(d))),d._eventTokens.push(d._eventMgr.subscribe({event:"Event_CW2_REFRESH"},d._handler_CW2_REFRESH.bind(d))),d._eventTokens.push(d._eventMgr.subscribe({event:"Event_CW2_RESET_TO_INPUT"},d._handler_CW2_RESET_TO_INPUT.bind(d))),d._eventTokens.push(d._eventMgr.subscribe({event:"Event_CW2_SELECT_PROFILE"},d._handler_CW2_SELECT_PROFILE.bind(d))),d._eventTokens.push(d._eventMgr.subscribe({event:"Event_controlCustomizationDone"},d._handler_POST_EDIT_CUSTOMIZATION.bind(d))),null!=d._runOptions.objAMDNameArray){var a=new s("FILE_0","UNKNOWN",null);a.objAMDName=d._runOptions.objAMDNameArray[0];var l=new s("FILE_1","UNKNOWN",null);l.objAMDName=d._runOptions.objAMDNameArray[1];var p=[a,l];d.compareObjsWithViewSetName(p,d._runOptions.viewSetMod,d._runOptions.viewSetName)}1==d._runOptions.isODT&&(d.forODT=u,widget.dispatchEvent("ENOLCM/CompareWidget/endLoadingWidget"))})};return c.prototype._handler_inputUpdate=function(e){if(!this.compareIsRunning&&null!=e&&e.length>0){if(this.compareIsRunning=!0,"AS_GIVEN"==this._runOptions.viewDefType){var t=this._runOptions.viewSetMod,i=this._runOptions.viewSetName,n=this._runOptions.MainToolbarConfig[0].Location,r=this._runOptions.MainToolbarConfig[0].DoNotInclude;this.compareObjsWithViewSetName(e,t,i,n,r)}else this.compareObjs(e);this._currObjIDSpecArray=e,setTimeout(()=>{this.compareIsRunning=!1},2e3)}},c.prototype._handler_replaceCompare=function(e){if(null==this._currObjIDSpecArray||this._currObjIDSpecArray.constructor!=Array||this._currObjIDSpecArray.length<2)t.errout("dropCompare called  without prior comparison");else{var i=null==e?null:null==e.data?null:e.data.objIDSpecArray;if(null==i||i.constructor!=Array||i.length<1)t.errout("bad call to dropCompare");else{for(var n=this._currObjIDSpecArray.length,r=e.data.targetIndex,o=[],s=0;s<n;s++)s==r?i.forEach(function(e){o.push(e)}):o.push(this._currObjIDSpecArray[s]);this._handler_inputUpdate(o)}}},c.prototype._handler_CW2_SWAP=function(){this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"});var t=e.fetchPersistedIDs();if(null!=t&&void 0!==t.items&&null!==t.items&&t.items.length>1){var i=t.items.shift();t.items.push(i),e.persistIDs(t)}var n=this._currObjIDSpecArray.shift();this._currObjIDSpecArray.push(n),this._handler_inputUpdate(this._currObjIDSpecArray)},c.prototype._handler_CW2_REFRESH=function(){this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray)},c.prototype._handler_CW2_RESET_TO_INPUT=function(){this._eventMgr.publish({event:"Event_clearView"}),this._eventMgr.publish({event:"Event_resetToDropFrame"}),this._currObjIDSpecArray=null},c.prototype._handler_CW2_SELECT_PROFILE=function(e){if(null!=e&&null!=this._currObjIDSpecArray[0]){var t=this._currObjIDSpecArray[0].getObjType();this._ccm.setUserPreferredProfileName(t,e)}this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray)},c.prototype._handler_POST_EDIT_CUSTOMIZATION=function(e){!0===e.status&&(this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray))},c.prototype.refresh=function(){this._viewPanelMgr.isResultViewActive()&&this._handler_CW2_REFRESH(),this._viewPanelMgr.refreshFrame()},c.prototype.getAppName=function(){return this._runOptions.app},c.prototype.getWidgetTitle=function(){return this._runOptions.widgetTitle},c.prototype.compareObjs=function(i){var n=this,r=[];i.forEach(function(e){var t=e.makeDupe();r.push(t)}),this._CPF.compareObjs(this._runOptions,r).then(function(e){t.dbgout("CW2 reports build/drop IDs successful."),n._eventMgr.publish({event:"Event_disableSwap",data:r.length>2})},function(i){t.errout("CW2 reports failure :"+i),null!=i.stack&&t.errout("Stack trace:"+i.stack),n._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"}),e.showAlertBox("COMPARE_FAILED",l,"error",!0)})},c.prototype.compareObjsWithViewSetName=function(i,n,r,o,s){t.dbgout("Comparing with named viewSet '"+r+"' from viewDefModule '"+n+"'");var a=this;this._CPF.compareObjsWithViewSetName(i,n,r,o,s).then(function(e){t.dbgout("CW2 reports build/drop IDs successful.")},function(i){t.errout("CW2 reports  build/drop IDs FAILED :"+i.stack),a._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"}),e.showAlertBox("Compare failed",l,"error",!0)})},c.prototype.onWidgetPrefsUpdate=function(){null!=this._ccm&&this._ccm.init(!0)},c}),define("DS/CompareWidget2/CompareWidget2",["DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/cw2","DS/CompareWidget2/userSettings/UserSettingsManager","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils"],function(e,t,i,n,r){"use strict";var o=null,s={onLoad:function(i){i=i||{},widget._isODTMode=(()=>"cw2_unittest_client"===widget.id),e.app_initialization(function(){widget.body.innerHTML="";let a=widget.body;i.isODT=widget._isODTMode();var l={configPath:"DS/CompareWidget2/userSettings/VPMReference"};"MERGE"!==i.app&&"NRF"!==i.app||(l.configPath="DS/CompareMergePlugin/userSettings/Merge"),require(["DS/CompareWidget2/userSettings/UserSettingsManager"],e=>{e.loadSettingsFromConfigPromise(l).then(()=>{var e=(o=new t(a,i)).getWidgetTitle();if(null==e||0==e.length){var n=o.getAppName();e="COMPARE"!=n?" ("+n+")":""}widget._isODTMode()&&Object.assign(s,{_getCW2ODTAck:function(){return o.forODT.getAck()},_getCPF:function(){return o._CPF},_getcw2:function(){return o}}),widget.setTitle(e)},()=>{console.error("COMPARE widget failed to load user settings... cannot continue.")})}),widget.isWebInWin;var u=e.getOption("platform_services",null);null!=u&&u.length>0&&Array.isArray(u)&&u.forEach(function(e){null!=e&&e.hasOwnProperty("platformId")&&n.getSecurityContextList(e.platformId,function(){var e=widget.getValue("X3DContentId");if(null!=e&&""!==e){var t=JSON.parse(e);void 0!==t.appContextId&&null!==t.appContextId&&""!==t.appContextId&&r.setCredentialsToWidget(t.appContextId)}})})})},onResize:function(){},onViewChange:function(e){},onRefresh:function(e){null!=o&&o.refresh()},onEdit:function(){},endEdit:function(){var e=widget.getPreferences();o.onWidgetPrefsUpdate(),e.forEach(e=>{i.hasPref(e.name)&&i.get(e.name)!==widget.getValue(e.name)&&i.set(e.name,widget.getValue(e.name))})}};return s});