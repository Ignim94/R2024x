define("DS/ENOSpecManagementApp/view/WrapperView",["UWA/Core","UWA/Class","UWA/Promise","DS/PlatformAPI/PlatformAPI","DS/XSRCommonComponents/utils/Utils","DS/ENOSpecManagementApp/util/SpecUtil","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/service/XSpecsMenuBuilder","DS/XSRCommonComponents/service/SpecSearchService","DS/XSRCommonComponents/utils/Notification","DS/SpecViewer/model/SpecTreeModel","DS/ENOSpecManagementApp/view/SpecToolBar","DS/ENOSpecManagementApp/model/SpecTreeDocument","DS/ENOSpecManagementApp/model/SearchNodeModel","DS/Controls/TooltipModel","DS/ENOSpecManagementApp/control/ViewerNavigation","i18n!DS/ENOSpecManagementApp/assets/nls/ENOSpecManagementApp"],function(e,t,i,o,n,s,r,a,c,d,l,p,u,m,h,E,g){"use strict";return t.extend({init:function(t){this._parent(t),this.appCore=t.appCore,this.basicModelEvents=this.appCore.basicModelEvents;var m=this.appCore.specViewerContainer;m.empty(),this.data=t.data,this.specTagger=this.appCore.specTagsFilter,this.initialView=widget.getValue("xsrLandingPageView")||"Tile",this.initialSort=widget.getValue("xsrLandingPageSortData")||{id:"lastmodified",order:"DESC"};var h=this,E=e.createElement("div",{class:r.XSPECS_ACTIONBAR_CONTAINER}).inject(m),v=e.createElement("div",{class:r.XSPECS_CONTENT_CONTAINER}).inject(m);this.contentDiv=v,this.specWidgetPref=this.appCore.specWidgetPreferences,this.searchService=new c({appCore:this.appCore});var N=this;this.basicModelEventArr=[],this._subsEvent(),N.treeDocument=(new u).getTreeDocuments(),N.addSpecRootNodes(this.data),N.addEventOnTreeDoc(),t.onCellDoubleClick=function(e){if(N.appCore&&N.appCore.triptychManager&&N.appCore.triptychManager.isRightPanelVisible&&N.appCore.triptychManager.hideRightPanel(),N.appCore.currentView!==r.VIEW_MULTI_EDIT){document.querySelector("#enox-search").classList.contains("enox-collection-toolbar-filter-activated")&&(document.querySelector(".enox-collection-toolbar-v2-container").classList.add("xsr-toolbarV2"),document.querySelector(".enox-basic-filter-autocomplete-wrapper").classList.add("xsr-searchbar"));var t={data:{itemPid:e.nodeModel.getID()}};s.checkForObjectExistence(t).then(function(t){t.objectExists&&N.basicModelEvents.publish({event:r.OPEN_SPECIFICATION_VIEW,data:{typeActual:e.nodeModel.getTypeActualName(),kindOf:e.nodeModel.getKindOf(),itemPid:e.nodeModel.getID(),isMEI:e.nodeModel.getAttributeValue("isMEI")}})}).catch(function(e){console.log("error occured:"+e)})}},t.onContextualEvent={callback:function(e){var t,o=h.appCore.triptychManager;if(!(o.isRightPanelVisible&&o.getCommandId()==r.TOOLBAR_CMD_MULTIGRID||h.appCore.viewerNav.enabled)){if(e.cellInfos?t=e.cellInfos.nodeModel:e.nodeModel&&(t=e.nodeModel),h.treeDocument.getSelectedNodes().length>1)return d.clearNotifications(),void d.displayNotification({eventID:"error",msg:g.SelectOneItem});if(void 0!==t){return function(){var e=t.getID(),o=t.getTypeActualName(),s=h.treeDocument.getSelectedNodes();let r=t.getAttributeValue("isMEI");return new i(function(t,i){var c=new l({id:e,type:o,isMEI:r});if(c.appCore=h.appCore,c.firstObject=!1,c.lastObject=!1,s&&1==s.length&&s[0].getID()==e){var d=n.getValidPreviousorNextNode(s[0],"previous"),p=n.getValidPreviousorNextNode(s[0],"next");d||(c.firstObject=!0),p||(c.lastObject=!0)}c.syncModel({onComplete:function(e){var i={data:c},o=a.getSpecListMenuView(i);t(o)}.bind(this),onFailure:function(e){console.log(e),N.refreshCurrentView()}.bind(this)})})}()}}}},N.specToolBar=new p({appCore:N.appCore,initialView:N.initialView,initialSort:N.initialSort,treeDocument:N.treeDocument,currentView:N.currentView});N.specToolBar.getActionBar(E,function(i){require(["DS/ENOSpecManagementApp/view/"+i],function(o){v.empty(),N.currentView&&N.currentView.destroy(),t.treeDocument=N.treeDocument;var n=new o(t);n.render().inject(v),N.currentView=n,"List"==i&&N.currentView.collectionView.getCellsXSO().onPostAdd(function(t){t&&e.is(t,"array")&&1==t.length&&(N.currentView.collectionView.unselectAll(),t[0].nodeModel.select())}),N.initialView=i,widget.setValue("xsrLandingPageView",i),N.specToolBar.applySort(N.initialSort)})}),this.platFormSusbcribtion=o.subscribe(r.CROSS_APP_SELECTION_EVENT,function(e){if(e.metadata&&e.metadata.appid==="ENOSPEC_AP_"+widget.id)return;var t=N.appCore.triptychManager;if(t.isRightPanelVisible&&t.getCommandId()==r.TOOLBAR_CMD_MULTIGRID)return;var i=[];e.data.paths.forEach(function(e){let t=e.length,o=1==t?e[0]:t>1?e[t-1]:e(e[2]);i.push(o)}),N.notApplyXhightlight=!0,i.length>=1&&N.treeDocument.unselectAll();for(var o=N.treeDocument.getAllDescendants(),n=0;n<o.length;n++){var s=o[n];if(0===i.length)break;-1!==i.indexOf(s.getID())&&(i.splice(i.indexOf(s.getID()),1),s.select())}N.notApplyXhightlight=!1})},_subsEvent:function(){var e=this;this.basicModelEventArr.push(this.basicModelEvents.subscribe({event:"xsr-item-delete-success"},function(t){e.removeSpecRootNodes(t)})),this.basicModelEventArr.push(this.basicModelEvents.subscribe({event:r.XSR_ITEM_DROP},function(t){let i=t.typeActual,o=t.itemPid;e.searchService.getSearchData(i,o).then(function(t){let n=t[0].isMEI;e.basicModelEvents.publish({event:r.OPEN_SPECIFICATION_VIEW,data:{itemPid:o,typeActual:i,isMEI:n}})}).catch(function(e){console.error(e)})})),e.basicModelEventArr.push(e.basicModelEvents.subscribe({event:r.EVENT_GRID_NODE_SELORDESELECT},function(t){t.nodes&&t.nodes.length>0&&t.nodes.forEach(function(i){let o=e.getNodesById(i);o&&o[0]&&("remove"==t.operation?o[0].unselect():"add"==t.operation&&o[0].select())})})),e.basicModelEventArr.push(e.basicModelEvents.subscribe({event:r.EVENT_GRID_VALUES_UPDATE},function(t){if(t.itemId){let i=e.getNodesById(t.itemId);i&&i[0]&&("PLMEntity.V_Name"==t.attrName?i[0].setTitle(t.newVal):"PLMEntity.V_description"==t.attrName&&i[0].setDescription(t.newVal),t.modifiedTime&&(i[0].setModifiedTime(n.formatDate(t.modifiedTime,!0)),i[0].setNodeDescription()),i[0].updateOptions(i[0].options))}})),e.basicModelEventArr.push(e.basicModelEvents.subscribe({event:r.EVENT_GRID_ADD_REMOVE_EXT},function(t){if(t.interfaceName==r.INTERFACE_ENTERPRISE_EXT&&"remove"==t.operation){let i=e.getNodesById(t.itemId);i&&i[0]&&(i[0].setPartNumber(""),i[0].setSubLabel(""),i[0].updateOptions(i[0].options))}})),this.basicModelEventArr.push(this.basicModelEvents.subscribe({event:r.EVENT_LAUNCH_PREV_NEXT_COMMAND},function(t){var i=t.commandId,o=t.move,s=t.itemId,a=t.callBackAction,c=e.treeDocument.getSelectedNodes();if(c&&!c||!(c.length<=0||c.length>1)?(c=Array.isArray(c)?c[0]:c)&&c.getID()!==s&&(c=e.getNodesById(s)):c=e.getNodesById(s),(c=Array.isArray(c)?c[0]:c)&&c.getID()===s){var d=n.getValidPreviousorNextNode(c,o);if(d){e.treeDocument.unselectAll(),a&&a(),e.currentView.collectionView.ensureNodeModelVisible(d,!0),d.select(),d.appCore=t.appCore,d.firstObject=!1,d.lastObject=!1;var l=n.getValidPreviousorNextNode(d,"previous"),p=n.getValidPreviousorNextNode(d,"next");l||(d.firstObject=!0),p||(d.lastObject=!0),e.basicModelEvents.publish({event:r.EVENT_LAUNCH_COMMAND,data:{commandId:i,context:{item:{data:d}}}})}}})),e.basicModelEventArr.push(e.basicModelEvents.subscribe({event:r.EVNT_ID_BACK},function(t){e.selectSpecification(t.itemPid,t.typeActual,t.isMEI)}))},refreshCurrentView:function(){this.basicModelEvents.publish({event:r.WELCOMEPANEL_EVENT_ActionSelected,data:{id:this.appCore.welcomePanelInstance.selectedItem}})},removeSpecRootNodes:function(e){var t=this.getNodesById(e);if(t){var i=this;Array.isArray(t)?t.forEach(function(e){i.treeDocument.removeRoot(e),i.updateUserDataCount("remove")}):(i.treeDocument.removeRoot(t),i.updateUserDataCount("remove")),0==i.treeDocument.getChildren().length&&0==this.specWidgetPref.userDataCount&&i.welcomeNoteVisibility("grid")}},addSpecRootNodes:function(e,t,i){if(e){var o=this,n=function(e){var n=new m(e);o.treeDocument.addRoot(n,t),i&&n.select(),o.treeDocument.getChildren().length>0&&(o.welcomeNoteVisibility("none"),0==o.specWidgetPref.userDataCount&&o.updateUserDataCount("add"))};if(Array.isArray(e))for(var s=0;s<e.length;s++)n(e[s]);else n(e);this._addItemsToTagger()}},getNodesById:function(e){if(this.treeDocument){var t=this.treeDocument.getChildren();return Array.isArray(t)?t.filter(function(t){return t.getID()===e}):[]}return""},_addItemsToTagger:function(){var e=this.treeDocument.getRoots();this.specTagger.setWorkingContainer(this.contentDiv),this.specTagger.addItemsToTagger(e)},_displayMsg:function(e,t){d.displayNotification({eventID:e,msg:t})},_processSearchNodeModel:function(e){var t=this;let i=e.getID(),o=e.getTypeActualName();t.specNodeModel=new l({id:i,type:o}),t.specNodeModel.appCore=t.appCore,t.specNodeModel.firstObject=!1,t.specNodeModel.lastObject=!1;let s=n.getValidPreviousorNextNode(e,"previous"),r=n.getValidPreviousorNextNode(e,"next");s||(t.specNodeModel.firstObject=!0),r||(t.specNodeModel.lastObject=!0),t.specNodeModel.syncModel({onComplete:t._renderInformationpanel.bind(this),onFailure:function(e){console.log(e),t._displayMsg("error",e)}})},_renderInformationpanel:function(){this.appCore.basicModelEvents.publish({event:r.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{count:this.selectedNodescount,commandId:this.appCore.triptychManager.commandId,currentModel:this.specNodeModel,parentModel:void 0}})},_manageMultiGrid:function(e,t){var i=this.appCore.triptychManager;this.appCore.basicModelEvents.publish({event:r.EVENT_GRID_NODES_SELECTION,data:{operation:e,commandId:i.commandId,contextNodeModels:t}})},_manageTriptychRightPanel:function(e,t){var i=this.treeDocument.getSelectedNodes(),o=this.appCore.triptychManager;if(o.setLaunchFromIcon(!1),i&&o.isRightPanelVisible)if(o.getCommandId()==r.TOOLBAR_CMD_MULTIGRID)this._manageMultiGrid(e,t);else if(this.selectedNodescount=i.length,this.selectedNodescount>1)this.appCore.basicModelEvents.publish({event:r.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{count:this.selectedNodescount,commandId:o.commandId,currentModel:void 0}});else if(1==this.selectedNodescount){!i[0]._canBeGrouped()||this._processSearchNodeModel(i[0])}else this.appCore.basicModelEvents.publish({event:r.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{count:this.selectedNodescount,commandId:o.commandId,currentModel:void 0,parentModel:void 0}})},addEventOnTreeDoc:function(){var e=this,t=function(){var t=e.treeDocument.getSelectedNodes(),i=t.length;if(e.specToolBar.toolbarModelEvents.publish({event:r.UPDATE_ITEMVIEW_TOOLBOOR_COUNT,data:i}),!e.notApplyXhightlight){var o=s.getCrossHLdata(t);n.publishCrossWidgetHighlightEvent(n.uid(),o),1==i&&e.appCore.viewerNav.enabled&&new E(e).update(t[0])}};this.treeDocument.getXSO().onPostAdd(function(i){for(var o=0;o<i.length;o++){i[o];t()}e._manageTriptychRightPanel("add",i)}),this.treeDocument.getXSO().onPostRemove(function(i){for(var o=0;o<i.length;o++){i[o];t()}e._manageTriptychRightPanel("remove",i)})},destroy:function(){this.specToolBar&&this.specToolBar.destroy(),this.currentView&&this.currentView.destroy(),this.basicModelEventArr&&this.basicModelEvents.unsubscribeList(this.basicModelEventArr),this.platFormSusbcribtion&&o.unsubscribe(this.platFormSusbcribtion),this.specTagger&&this.specTagger.resetFilterData()},updateUserDataCount:function(e){"add"===e?this.specWidgetPref.userDataCount=this.specWidgetPref.userDataCount+1:"remove"===e&&this.specWidgetPref.userDataCount>0&&(this.specWidgetPref.userDataCount=this.specWidgetPref.userDataCount-1)},renderWelcomeNote:function(){var t=document.querySelector("#"+r.ID_SpecsContainer),i=e.createElement("div",{id:"no-items-container"}).inject(t),o=e.createElement("div",{class:"no-items-message col-xs-8 col-md-7"}).inject(i);e.createElement("h3",{html:g.WelcomeTextHead,class:"text-center"}).inject(o);var s=[{id:r.WELCOMEPANEL_ID_CREATEENG,note:g.WelcomeNoteEngItem,text:g.CreateEngItem,fonticon:"plus"},{id:r.WELCOMEPANEL_ID_CREATESPEC,note:g.WelcomeNoteDocItem,text:g.CreateSpecification,fonticon:"doc-add"}];n.getCreatePrdSpecAdminConfig()||this.welcomeNoteWithCommand(s[0]).inject(o),this.welcomeNoteWithCommand(s[1]).inject(o)},welcomeNoteVisibility:function(e){var t=document.getElementById("no-items-container");t?t.setStyles({display:e}):t||"grid"!==e||this.renderWelcomeNote()},welcomeNoteWithCommand:function(t){var i=g.replace(g.get("Text_ToCreateA"),{type:t.text});return e.createElement("p",{html:[i+" ",this.addCommandInWelcomeNote(t),{tag:"ul",html:"<li>"+t.note+"</li>"}]})},addCommandInWelcomeNote:function(t){var i=this,o=e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+t.fonticon});return o.addEvent("click",function(){i.basicModelEvents.publish({event:r.WELCOME_NOTE_ICON_EVENT,data:{id:t.id}})}),o.tooltipInfos=new h({shortHelp:t.text,allowUnsafeHTMLShortHelp:!1,initialDelay:500,mouseRelativePosition:!1,position:"top"}),o},selectSpecification:function(e,t,i){let o=this.getNodesById(e);o&&o[0]?(this.treeDocument.unselectAll(),o[0].select()):(this.treeDocument.unselectAll(),new E(this).update({id:e,type:t,isMEI:i}))}})});