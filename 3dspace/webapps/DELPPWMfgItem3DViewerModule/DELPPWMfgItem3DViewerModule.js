define("DS/DELPPWMfgItem3DViewerModule/ScopedProductSelectionUI",["UWA/Core"],function(e){"use strict";return function(t,n,i){var o,s,c,r,l=1,a=2,d=n.getComponent("Element"),u=n.getComponent("Accordeon"),f=n.getComponent("Button"),g=n.getComponent("ComboBox"),p=n.getComponent("TooltipModel"),h=null,m=null,v=null;return o=function(o){var s,c,r;s=function(n){switch(n){case l:return function(){m.close()};case a:return function(){var t=v.rootField,n=v.occField,i=v.scopedMfgItemField;e.is(o,"function")&&e.is(t)&&e.is(n)&&e.is(i)&&o(t.value,n.value,i.value),m.close()};default:t.log("wrong option")}},c={No:new f({label:i.getNLSValue("ScopedProductSelectionUI.Close.Title"),onClick:s(l)}),Yes:new f({disabled:!1,label:i.getNLSValue("ScopedProductSelectionUI.Load.Title"),onClick:s(a)})},e.is(n)?(r={title:i.getNLSValue("ScopedProductSelectionUI.Dialog.Title"),domId:"ScopedProductSelectionUI-dialog",content:h,resizableFlag:!0,modalFlag:!1,minWidth:290,width:400,buttons:c,visibleFlag:!1},(m=n.create("Dialog",r)).close=function(){e.is(h)&&h.destroy(),this.destroy(),m=null,v=null}):t.debug("uxFactoryBehavior is not available.")},s=function(t){var n,i;return n=new e.Element("div",{class:"accordeon-section-container"}),i=new d("div",{class:"section-container"}),n.inject(h),new u({items:[{header:t,content:i,expandedFlag:!0}],style:"filled-separate"}).inject(n),i.addEvent("resize",function(){var t,n,o;o=i.getElements(".wux-field-container"),i.clientWidth<290?(t="inline-container",n="block-container"):(t="block-container",n="inline-container"),e.is(o)&&o.forEach(function(e){e.removeClassName(t),e.addClassName(n)})}),i},c=function(t,n){t.forEach(function(t){var i,o;i=new e.Element("div",{class:"wux-field-container inline-container"}),new e.Element("h6",{class:"wux-textElement",text:t.label}).inject(i).tooltipInfos=new p({shortHelp:t.label}),o=new g({elementsList:t.elementsList,actionOnClickFlag:!1,enableSearchFlag:!1,value:t.value,disabled:t.disabled}),e.is(t.onChange,"function")&&o.addEventListener("change",t.onChange.bind(null,v)),v[t.name]=o,o.inject(i),i.inject(n)})},r=function(t){var n,o,r,l,a,d={},u={};Array.isArray(t)&&t.length>0&&(r={name:"rootField",label:i.getNLSValue("ScopedProductSelectionUI.Field.Root.Title"),elementsList:[],disabled:!0,onChange:function(t){var n,i,o,s,c,r,l;n=t.rootField,o=t.occField,r=t.scopedMfgItemField,e.is(n)&&e.is(o)&&e.is(r)&&(i=n.value,e.is(d[i])&&(c=(s=d[i])[0].valueItem,o.setProperties({elementsList:s,value:c}),e.is(u[c])&&(l=u[c],r.setProperties({elementsList:l,value:l[0].valueItem}))))}},l={name:"occField",label:i.getNLSValue("ScopedProductSelectionUI.Field.Occurence.Title"),elementsList:[],disabled:!0,onChange:function(t){var n,i,o,s;n=t.occField,o=t.scopedMfgItemField,e.is(n)&&e.is(o)&&(i=n.value,e.is(u[i])&&(s=u[i],o.setProperties({elementsList:s,value:s[0].valueItem})))}},a={name:"scopedMfgItemField",label:i.getNLSValue("ScopedProductSelectionUI.Field.ScopedMfgItem.Title"),elementsList:[],disabled:!0},t.forEach(function(e){var t=[];e.occurences.forEach(function(e){var n=[];t.push({labelItem:e.label,valueItem:e.pid}),e.scopedPrd.forEach(function(e){n.push({labelItem:e.label,valueItem:e.pid})}),u[e.pid]=n}),d[e.pid]=t}),o=t[0],r.disabled=!1,r.value=o.pid,r.elementsList=t.map(function(e){return{labelItem:e.label,valueItem:e.pid}}),e.is(d[r.value])&&(l.disabled=!1,l.elementsList=d[r.value],l.value=l.elementsList[0].valueItem,e.is(u[l.value])&&(a.disabled=!1,a.elementsList=u[l.value],a.value=a.elementsList[0].valueItem)),v=[],n=s(i.getNLSValue("ImplementUI.Implementing")),c([r,l],n),n=s(i.getNLSValue("Type.VPMReference")),c([a],n))},{createDialog:function(t){!e.is(m)&&e.is(t)&&e.is(t.data)&&e.is(t.onSelectCallback)&&(h=new d("div",{class:"ScopedProductSelectionUI-Container"}),o(t.onSelectCallback),r(t.data),m.show())},isActive:function(){return!!e.is(m)&&m.visibleFlag},destroyUI:function(){e.is(m)&&m.close()}}}}),define("DS/DELPPWMfgItem3DViewerModule/MfgItem3DViewerModule",["UWA/Core","DS/TransientWidget/TransientWidget","DS/DELPPWMfgItem3DViewerModule/ScopedProductSelectionUI"],function(e,t,n){"use strict";return{behaviors:["InterWidgetComBehavior","UXFactoryBehavior","ResourceBehavior","ModelBehavior","RootsBehavior","ProductImplementBehavior","Viewer3DBehavior"],creator:function(i,o,s,c,r,l,a,d){const u="VPMInstance",f="VPMReference";var g,p,h,m,v,I,P,b,D,S,L,E,w,y,V,C,R,M,F,W,O,A,k,U,N,x,T,j,B,_,H=o.isCloud()?"DELOERC_AP":"DELOER_AP",z={};return V=function(){o.isWidgetLinked(H)?i.warn(c.getNLSValue("MfgItem3DOperationViewer.IsAlreadyAvailable")):t.showWidget(H,{})},j=function(){var t,n,i,s;const c=t=>{if(n=h(),i=n.loadedObjInfos,e.is(t.occurences)&&1===t.occurences.length){const n=t.occurences[0];if(e.is(n.scopedPrd)&&1===n.scopedPrd.length)return n.scopedPrd[0].pid===i.scopedPrdPID}return!1};if(o.isOpsViewerWidgetLinked())if(t=l.getRoots()[0],s=P(t)){const t=s.find(c);e.is(t)?L(t.pid,t.occurences[0].scopedPrd[0].pid):I()}else I()},C=function(t){var n,i;o.isOpsViewerWidgetLinked()&&(i=h(),e.is(i)||(n=P([t]),D(n)))},A=function(e){var t;if(o.isWidgetLinked(H)){const n=e.absPath;if(n.length>0){const e=n[0],i=r.getInstance(e);t=r.getAggregatingReferenceModelFromInstance(i)}else t=r.getReference(e.nodeId);const i=[t.get("PID")],o=P(i);D(o)}},k=function(t){if(o.isWidgetLinked(H)){const n=h();if(e.is(n)&&e.is(t.impactedChildren)){const i=t.impactedChildren,o=n.loadedObjInfos;if(e.is(i)&&e.is(o)){const e=i[i.length-1];e!==o.rootPID&&e!==o.scopedPrdPID||L(o.rootPID,o.scopedPrdPID)}}}},h=function(){return d.getPreferences()},v=function(e,t){var n={loadedObjInfos:{rootPID:e,scopedPrdPID:t}};widget.setValue("MfgItem3DViewerModule_Preferences",n),d.updatePreferences(n),i.notify("set3DVisibilityState",[{isVisible:!0,parentPID:t}])},I=function(){var t;m=h(),d.updatePreferences(),widget.setValue("MfgItem3DViewerModule_Preferences"),e.is(m)&&(t=m.loadedObjInfos,e.is(t)&&i.notify("set3DVisibilityState",[{isVisible:!1,parentPID:t.scopedPrdPID}]))},O=function(e){var t,n=[];if(1===e.length)n=e;else for(t=0;t<e.length;t++)t%2==1&&n.push(e[t]);return n},P=function(t){let n=[];return Array.isArray(t)&&t.length>0&&t.forEach(function(t){let i;const o=r.getReference(t),s=a.getScopeLinksOfImplementing(t);if(s.length>0){const e=s[0].get("to");let n=[];const c=r.getReference(e);n.push({pid:e,label:c.get("PLMEntity.V_Name")}),i={pid:t,label:o.get("PLMEntity.V_Name"),occurences:[{pid:t,label:o.get("PLMEntity.V_Name"),scopedPrd:n}]}}e.is(i)&&n.push(i)}),n},D=function(t){var o;if(o=function(){var t,n;t=h(),e.is(t)&&(n=t.loadedObjInfos,e.is(n.scopedPrdPID)&&N(n.scopedPrdPID))},t.length>0){if(1===t.length){const n=t[0];if(e.is(n.occurences)&&1===n.occurences.length){const t=n.occurences[0];if(e.is(t.scopedPrd)&&1===t.scopedPrd.length){const e=t.scopedPrd[0].pid;return o(),void L(n.pid,e)}}}(p=new n(i,s,c)).createDialog({data:t,onSelectCallback:function(t,n,i){e.is(t)&&e.is(n)&&e.is(i)&&(o(),L(t,i))}})}},S=function(t,n){e.is(t)&&o.publishEvent("DS/DELExternalWidgetCom/"+t,n)},L=function(t,n){const i=r.getReferenceModel(t);e.is(i)&&(v(t,n),S("Remove2DStructure"),S("LoadData",{items:[{id:n}]}))},E=function(){setTimeout(function(){S("GetAppStatus")},10)},w=function(){e.is(p)&&p.isActive()&&p.destroyUI(),I(),i.notify("widgetUnlinked")},y=function(){var e,t;t=l.getRoots()[0],e=P(t),S("Remove2DStructure"),e.length>0&&D(e),i.notify("widgetLinked")},R=function(t,n){let i=!1;const o=n.loadedObjInfos;return e.is(o.rootPID)&&(i=t===o.rootPID||t===o.scopedPrdPID||r.getInstancesFromCollection(t).some(function(e){let t=!1;return r.getReferenceModelFromInstance(e).get("PID")===o.rootPID&&(t=!0),t})),i},_=function(t){var n=[];return Array.isArray(t)&&t.forEach(function(t){var i=t.join(","),o=z[i];e.is(o)&&n.push(o)}),n},M=function(t){var n,o,s,c,l,a,d={};if(n=this.isSelected,o=n?"selectNodes":"unSelectNodes",e.is(t.path))if(s=t.path,c=[],l=[],a=[],s.forEach(function(i){var o=!1,s=i.join(","),d=i.filter(function(i,s){var l,a,d=s%2!=0,g=!1,p=!1;return l=d?r.getInstance(i):r.getReferenceModel(i),e.is(l)?a=l.get("type"):e.is(t.attributes)&&e.is(t.attributes[i])&&(a=t.attributes[i].type),e.is(a)&&(p=r.isAKindOf(a,f),g=r.isAKindOf(a,u)),n&&!e.is(l)&&(p||g)&&(c.push(i),o=!0),d&&g});o&&l.push(i),0===d.length&&(d=i),n?z[s]=d:e.is(z[s])&&delete z[s],a.push(d)}),l.length>0){let e=function(){let e=_(l);e.length>0&&(i.notify("addOccurrece",[l]),i.notify(o,[e])),i.notify("stopProgress",d)},t=function(){i.debug("Fetching getDescendantsFromServer for missing occurence failed."),i.notify("stopProgress",d)};i.notify("startProgress",d),r.getDescendantsFromServer(c,e,{onFailure:t,silentMode:!0,expandLevel:0,forceDBMode:!0})}else i.notify(o,[a])},F=function(e){var t=[],n=[];o.isOpsViewerWidgetLinked()&&((e=Array.isArray(e)?e:[e]).forEach(function(e){e.isVisible?n.push(e.rirPath):t.push(e.rirPath)}),t.length>0&&S("Hide",{path:t}),n.length>0&&S("Show",{path:n}))},W=function(t){var n,o=this.isDisplayed,s={},c=[];e.is(t.attributes)&&(t.path.forEach(function(e){n=O(e),s={absPath:n,isVisible:o},c.push(s)}),i.notify("update3DVisibilityState",[c]))},b=function(e){var t,n,i,s;o.isOpsViewerWidgetLinked()&&(n=e.changed.isSelected?"Highlight":"UnHighlight",i=e.changed.absPath,t=[],s=r.transformToRIROccurrencePath(i.length>0?i:e.changed.nodeId),t.push(s),t.length>0&&S(n,{path:t}))},U=function(t){var n,i;n=h(),e.is(n)&&t.some(function(e){return R(e.get("PID"),n)})&&(i=n.loadedObjInfos,N(i.scopedPrdPID))},N=function(t){var n=r.getReferenceModel(t);e.is(n)&&"PRODUCT"===r.getPPRType(n)&&(I(),S("RemoveRoots",{items:[{id:t}]}))},x=function(){T()},T=function(){S("RemoveAll")},B=function(e){var t=[],n=e.absPath;o.isOpsViewerWidgetLinked()&&(t.push(r.transformToRIROccurrencePath(n.length>0?n:e.nodeId)),t.length>0&&S("Reframe",{path:t}))},{listenTo:function(){return{select:b,addRootNode:C,hideRootNode:U,Show3DViewerCmd:V,change3DVisibilityfromEBOMview:F,LoadIn3DViewer:A,refreshImpacted:k,HideAll:x,highlightIn3D:b,onRecentContentLoaded:j,ReframeIn3DViewer:B}},onStart:function(t,n){g=e.extend(g,t),o.isOpsViewerWidgetLinked()&&(i.notify("widgetLinked"),S("Remove2DStructure")),o.subscribeEvent("DS/DELExternalWidgetCom/onGetAppStatus",function(e){!0===e.status?y():o.subscribeEvent("DS/DELExternalWidgetCom/onAppReady",y)}),o.addEventListener("link",E),o.addEventListener("unlink",w),o.subscribeEvent("DS/DELExternalWidgetCom/onSelect",M.bind({isSelected:!0})),o.subscribeEvent("DS/DELExternalWidgetCom/onUnSelect",M.bind({isSelected:!1})),o.subscribeEvent("DS/DELExternalWidgetCom/onShow",W.bind({isDisplayed:!0})),o.subscribeEvent("DS/DELExternalWidgetCom/onHide",W.bind({isDisplayed:!1})),n()},onStop:function(){}}}}});