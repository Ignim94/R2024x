define("DS/ENOXSourcingAddAttributeGroup/AddAttributeGroupView",["UWA/Controls/Abstract","UWA/Core","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/UIKIT/Mask","DS/Controls/Button","DS/UIKIT/Autocomplete","DS/UIKIT/Accordion","DS/UIKIT/Scroller","DS/UIKIT/Input/Text","DS/UIKIT/Input/Number","DS/UIKIT/Input/Date","DS/UIKIT/Input/Select","i18n!DS/ENOXSourcingUXInfra/assets/nls/ENOXSourcingUXInfra","css!DS/ENOXSourcingAddAttributeGroup/AddAttributeGroupView.css"],function(e,t,a,n,i,r,s,o,l,c,d,u,p,m){"use strict";var f=e.extend({context:null,init:function(e){this.callerModel=e.callerModel,this.qualificationId=e.qualificationId,this.setDataSetForAutocomplete=h.bind(this),this.dataSet=this.setDataSetForAutocomplete(e),this.autocompltAccord={},this.trackAttrValUpdates=this.dataSet.items,this.addAGController=e.addAGController},showDialog:function(e){var i=this,c=new a;this.extensionsToDelete=[],c.inject(widget.body),c.addEventListener("removeWindow",function(){c.destroy()});var d=t.createElement("div",{styles:{width:"100%",height:"100%",position:"relative",background:"white",overflow:"visible",padding:"32px"}}),u=new n({title:m.APPLY_ATTRIBUTE_GROUP,content:d,buttons:{Close:new r({label:m.cancel,onClick:function(){c.destroy()}}),Ok:new r({id:"createBtn",label:m.CREATE_BUTTON})},width:550,height:500,immersiveFrame:c,resizableFlag:!0,modalFlag:!0,touchMode:!0});u.elements._buttonsDiv.addClassName("xsrc-dialog-buttons");var p=t.createElement("div",{id:"autoComplete",styles:{overflow:"visible",padding:"15px"}}).inject(d),f=new s({name:"autoCompleteExtensions",showSuggestsOnFocus:!0,multiSelect:!0,placeholder:m.SEARCH_AG,autofocus:"autofocus",events:{onSelect:function(e){i.updateView(i,e,!0)},onUnselect:function(e){i.updateView(i,e,!1)}},style:{width:"100%",overflow:"visible"}}).inject(p);f.addDataset(this.dataSet),u.buttons.Ok.addEventListener("click",this.applyAttributeGroups.bind(this,f,this.attrAccordeon,e,c));var h=t.createElement("table",{class:"table table-hover",width:"100%"});this.attrAccordeon=new o({items:[],className:"filled filled-separate"}).inject(d),new o({className:"filled filled-separate",items:[{title:m.attached_extension,content:h,name:m.attached_extension}]}).inject(d);var g=t.createElement("tbody").inject(h);e.attachedExtensions&&e.attachedExtensions.forEach(function(e){var a=t.createElement("tr").inject(g);t.createElement("p",{title:e.name,text:e.displayName}).inject(t.createElement("td",{align:"left",width:"80%"}).inject(a));var n=t.createElement("span",{styles:{cursor:"pointer;"},id:e.name,title:m.remove_extension});n.className="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-exchange-delete",n.inject(t.createElement("td",{align:"center",width:"20%"}).inject(a)),n.onclick=function(e){var t=e.target;i.changeClass(t,i.extensionsToDelete)}});new l({element:d})},applyAttributeGroups:function(e,t,a,n){n.destroy();var i=this.trackAttrValUpdates,r=e.getValue();if(a.qualificationId=this.qualificationId,a.callerModel=this.callerModel,r.length>0||this.extensionsToDelete.length>0){if(a.selectedInterfaces=[],a.extensionsToDelete=this.extensionsToDelete,r.length>0){var s=r.split(";");a.selectedInterfaces=s;var o=[];i.forEach(function(e){e.selected&&o.push(e.attributes)}),a.selectedAttributes=o}this.addAGController.apply(a)}},changeClass:function(e,t){var a=e.getParent().getParent();if("warning"!==a.className){a.className="warning",e.className="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-reset",e.title=m.cancelRemove;let n=e.getAttribute("id");t.push(n)}else{a.className="",e.className="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-exchange-delete",e.title=m.remove_extension;let n=e.getAttribute("id"),i=t.indexOf(n);i>-1&&t.splice(i,1)}},updateView:function(e,a,n){var i=this.attrAccordeon,r=this.trackAttrValUpdates,s=t.createElement("div",{class:"outerDiv xSourcingForm"}),o=t.createElement("div",{id:"no-object-found",class:"emptyContainerStyle",html:m.NO_ATTRIBUTES_PRESENT,styles:{position:"relative","font-family":"3ds","font-size":"17px",color:"#368ec4",margin:"8px 1px 0px 8px","font-weight":"bold","align-self":"center","text-align":"center","justify-content":"center","align-items":"center",display:"flex","flex-direction":"column"}});n?(0!==a.attributes.length?a.attributes.forEach(function(n){var i=t.createElement("div",{}).inject(s),r=t.createElement("div",{}).inject(i);e.createInputFieldsUI(n,a.label).inject(r)}):o.inject(s),i.addItem({title:t.String.escapeHTML(a.label),content:s,name:a.label}),r.forEach(function(e){e.name===a.name&&0!==e.attributes.length&&(e.selected=!0)})):(i.removeItem(a.label),r.forEach(function(e,t){var n=t;e.value===a.value&&0!==r[n].attributes.length&&(r[n].selected=!1,e.attributes.forEach(function(e,t){r[n].attributes[t].value=""}))}))},createInputFieldsUI:function(e,a){var n=this,i="xsrc-add-attributegroup-field",r=t.createElement("div",{}),s=e.displayName?e.displayName:e.name;t.createElement("label",{html:s,styles:{"padding-top":"10px"}}).inject(r);var o=t.createElement("div",{}).inject(r),l=[{label:m.TRUE,value:"True"},{label:m.False,value:"False"}],f="";switch(e.type){case"string":case"String":f=new c({placeholder:e.displayName?e.displayName:e.name,name:e.name,className:i}).inject(o);break;case"real":case"integer":case"Double":case"Integer":f=new d({placeholder:e.displayName?e.displayName:e.name,className:i,name:e.name,step:1,max:9999999999,min:-9999999999}).inject(o);break;case"date":case"timestamp":case"Date":f=new u({placeholder:e.displayName?e.displayName:e.name,name:e.name,className:i}).inject(o);break;case"boolean":case"Boolean":f=new p({custom:!1,placeholder:!1,name:e.name,options:l,className:i}).inject(o);break;case"select":var h=e.range,g=e.displayRange,E=h;h.constructor!==Array&&(E=(h=h.substring(1,h.length-1)).split(",")),g&&g.constructor!==Array&&(g=(g=g.substring(1,g.length-1)).split(","));var y=[],v=e.defaultValue;E.forEach(function(e,t){var a=e.trim();let n;g&&g.length>0&&(n=g[t]);var i={label:m[a]?m[a]:n||a,value:a};a===v&&(i.selected="true"),y.push(i)}),f=new p({custom:!1,placeholder:!1,name:e.name,options:y,className:i}).inject(o)}return f.addEvent("onChange",function(){n.dispatchEvent("onChange",[this.getName(),this.getValue(),n])}),f.onChange=function(){n.trackAttributeUpdations(this.elements,this.getName(),this.getValue(),n)},r},trackAttributeUpdations:function(e,t,a,n){var i=n.trackAttrValUpdates,r=t,s=a,o=void 0;i.forEach(function(t,a){o=a,t.attributes.forEach(function(t,a){if(r===t.name){var n=i[o].attributes[a].type;"date"!==n&&"Date"!==n&&"timestamp"!==n||(s=new Date(e.picker.getDate().getTime()).toDateString()),i[o].attributes[a].value=s}})})}}),h=function(e){var t=[],a=e.extensionData;return a?a.forEach(function(e,a){e.name&&(t.push({name:e.name,value:e.name,label:e.displayName?e.displayName:e.description?e.description:e.name,attributes:e.attributes,selected:!1}),t[a].attributes.forEach(function(t){t.parentInterface=e.name}))}):widget.notificationUtil.showWarning(m.no_ext_available),this.dataSet={name:"Extensions",items:t},this.showDialog(e),this.dataSet};return f}),define("DS/ENOXSourcingAddAttributeGroup/AddAttributeGroupModel",["DS/ENOXSourcingUXInfra/Constants/ENOXSourcingConstants","DS/ENOXSourcingUXInfra/service/ENOXSourcingService","DS/ENOXSourcingUXInfra/service/ENOXSourcingPlatformServices"],function(e,t,a){"use strict";var n=function(){this.source="sourcing"};return n.prototype.init=function(){},n.prototype.listInterfaces=function(e){return e.source=e.callerSource?e.callerSource:this.source,e.endpoint=e.endPoints.ListApplicableExtensions.replace("${OBJECTTYPE}",e.qualType),t.getDataPromise(e)},n.prototype.getAttachedExtensions=function(e){return e.source=e.callerSource?e.callerSource:this.source,e.endpoint=e.endPoints.GetAttachedExtensions.replace("${OBJECTID}",e.qualificationId),t.getDataPromise(e)},n.prototype.getDictionaryObjectInterfaces=function(n){let i={};return i.source=e.SERVICE_3DSPACE,i.endpoint="/resources/dictionary/object/interfaces?tenant="+a.getPlatformId()+"&customerOnly=true&isRoleChecked=true",i.postData={objects:[n.qualificationId]},t.performPostPromise(i)},n.prototype.getDictionaryInterfaces=function(n){let i={};return i.source=e.SERVICE_3DSPACE,i.endpoint="/resources/dictionary/interfaces?tenant="+a.getPlatformId()+"&customerOnly=true&displayAttributes=true&noDeprecated=true&noAbstract=true",i.postData={classes:[n.type]},t.performPostPromise(i)},n.prototype.apply=function(a){let n={};return!a.type||a.type!==e.VPMREFERENCE&&a.type!==e.MEI_PROXY?(n.source=a.callerSource?a.callerSource:this.source,n.endpoint=a.endPoints.ApplyExtension.replace("${OBJECTID}",a.qualificationId),n.addData=a.addData,t.updateServicePromise(n)):this.callDictionaryAddInterface(a)},n.prototype.callDictionaryAddInterface=function(n){let i={};return i.source=e.SERVICE_3DSPACE,i.endpoint="/resources/dictionary/object/addInterfaces?tenant="+a.getPlatformId(),i.postData=n.addData,t.performPostPromise(i)},n.prototype.callDictionaryRemoveInterface=function(n){let i={};return i.source=e.SERVICE_3DSPACE,i.endpoint="/resources/dictionary/object/removeInterfaces?tenant="+a.getPlatformId(),i.postData=n.addData,t.performPostPromise(i)},n}),define("DS/ENOXSourcingAddAttributeGroup/AddAttributeGroupController",["DS/UIKIT/Mask","DS/ENOXSourcingUXInfra/Constants/ENOXSourcingConstants","DS/ENOXSourcingAddAttributeGroup/AddAttributeGroupView","DS/ENOXSourcingAddAttributeGroup/AddAttributeGroupModel","DS/ENOXSourcingUXInfra/CommonUtils/CommonUtils","i18n!DS/ENOXSourcingUXInfra/assets/nls/ENOXSourcingUXInfra"],function(e,t,a,n,i,r){"use strict";var s=function(){this.model=new n(this)};return s.prototype.view=function(e,t,a,n,i,s){var o=this;e.qualificationId=a,e.qualType=n,e.callerModel=i,e.callerController=s,e.addAGController=t,o.model.getAttachedExtensions(e).then(t=>{let a=o.processAttachedExtensions(t);e.attachedExtensions=a.data,e.attachedExtensionList=a.extensionList,o.listInterfaces(e)}).catch(function(t){widget.notificationUtil.showError(t.internalError?t.internalError:r.error_retrieving_extensions_applied),o.listInterfaces(e)})},s.prototype.listInterfaces=function(e){var t=this;t.model.listInterfaces(e).then(n=>{var i={};i.respData=n,i.attachedExtensions=e.attachedExtensionList?e.attachedExtensionList:[],e.extensionData=t.processInterface(i);new a(e)})},s.prototype.processInterface=function(e){let t=[],a=e.respData,n=e.attachedExtensions;return a.data&&a.data.length>0&&a.data.forEach(e=>{let a=e.dataelements?e.dataelements:e;if(!n.includes(a.name)){let n={name:a.name,description:a.description,displayName:a.displayName,attributes:[]};t.push(n),e.children&&e.children.length>0?e.children.forEach(function(e){let t=e.dataelements?e.dataelements:e;var a={name:t.Name,type:t.Type,defaultValue:t["Default Value"],displayName:t.displayName};"timestamp"===t.Type&&t.displayRanges&&(t.displayRanges=t.displayRanges.replace(/[[\]']+/g,"").split(","),t.displayRanges.forEach((e,t,a)=>{let n=i.getDateStringForDisplay(e.trim());a[t]=n.substring(0,n.lastIndexOf(","))})),t.Range&&(a.type="select",a.range=t.Range),t.displayRanges&&(a.displayRange=t.displayRanges),n.attributes.push(a)}):e.category_attributes&&e.category_attributes.length>0&&e.category_attributes.forEach(function(e){var t={name:e.name,type:e.type,defaultValue:e.default,displayName:e.displayName};e.range&&(t.type="select",t.range=e.range),n.attributes.push(t)})}}),t},s.prototype.apply=function(a){e.mask(widget.body,r.APPLYING_EXTENSION),a.source===t.SOURCE_SOURCING?this.applyExtensionToSourcingObjects(a):this.applyExtensionToMEI(a)},s.prototype.applyExtensionToSourcingObjects=function(e){var t=this;e.addData=this.addInterfacePayload(e),this.model.apply(e).then(function(){t.processAppliedExtension(e),widget.notificationUtil.showSuccess(r.APPLY_EXT_SUCCESSFUL),e.applyExtensionCallback&&e.applyExtensionCallback(e)}).catch(function(e){t.handleApplyExtensionError(e)})},s.prototype.applyExtensionToMEI=function(e){var t=this;e.addData=this.addInterfacePayloadForMei(e);var a=[];e.selectedInterfaces.length>0&&a.push(this.model.apply(e)),e.extensionsToDelete.length>0&&(e.addData=this.removeInterfacePayloadForMei(e),a.push(this.model.callDictionaryRemoveInterface(e))),Promise.all(a).then(function(){t.processAppliedExtension(e),widget.notificationUtil.showSuccess(r.APPLY_EXT_SUCCESSFUL),e.applyExtensionCallback&&e.applyExtensionCallback()}).catch(function(e){t.handleApplyExtensionError(e)})},s.prototype.processAppliedExtension=function(t){var a={};a.source=t.source,a.data=t.data,a.id=t.id,a.callerModel=t.callerModel,t.callerController.model.getDetails(a).then(function(n){if(a.callerModel._attributes){var i=a.callerModel._attributes.fields;t.extensionsToDelete.length>0&&(i=i.filter(e=>!(e.interFaceField&&t.extensionsToDelete.includes(e.interFaceField)||e.accordeonHeader&&t.extensionsToDelete.includes(e.accordeonHeader.label)||e.accordeonHeader&&t.extensionsToDelete.includes(e.accordeonHeader.value))));for(var r=i.length;r--;)i[r]&&i[r].hasOwnProperty("from")&&"interface"===i[r].from&&i.splice(r,1);n.member&&n.member[0]&&n.member[0]["interface-details"]?(n.member[0].cestamp&&(t.data.respParams.cestamp=n.member[0].cestamp),t.addAGController.processInterfaceDetailsFromMember(n,i)):(n.data[0].relateddata||n.data[0]["interface-details"])&&t.addAGController.processInterfaceDetailsFromRelatedData(n,i),a.callerModel.unset("fields"),a.callerModel.set("fields",i);var s=a.callerModel.get("interfaceChangeLogger");s+=1,a.callerModel.set("interfaceChangeLogger",s)}e.unmask(widget.body)}).catch(function(t){widget.notificationUtil.showError(t.internalError?t.internalError:r.APPLY_EXT_FAILED),e.unmask(widget.body)})},s.prototype.handleApplyExtensionError=function(t){t.error&&t.error.MessageException&&t.error.MessageException.contains("already exists")&&(t.internalError=r.extension_already_applied),widget.notificationUtil.showError(t.internalError?t.internalError:r.APPLY_EXT_FAILED),e.unmask(widget.body)},s.prototype.addInterfacePayload=function(e){var a={data:[{dataelements:{extensionsToAdd:e.selectedInterfaces,extensionsToRemove:e.extensionsToDelete}}]};return e.selectedAttributes&&e.selectedAttributes.forEach(function(n){0!==n.length&&n.forEach(function(n){var i=n.name,r=Array.isArray(n.value)?n.value[0]:n.value;a.data[0].dataelements[i]=""===r||void 0===r?n.defaultValue:r,e.type===t.VPMREFERENCE&&(a.data[0].dataelements[n.parentInterface+"."+i]=a.data[0].dataelements[i])})}),a},s.prototype.processInterfaceDetailsFromMember=function(e,a){let n=a.filter(e=>e.ClassID);e.member[0]["interface-details"].forEach(e=>{e.name&&e.name!==t.MEI_EXTENSION&&(n.some(t=>t.ClassID===e.name)||a.some(t=>t.interFaceField===e.name)||e.attributes.forEach(t=>{var n={type:t.type,label:t.nlsName?t.nlsName:t.name,interFaceField:e.nlsName?e.nlsName:e.name,name:t.path,interfaceName:e.name,value:t.value?t.value:"",disable:!0,negativeAllowed:!0,nonEditable:"true"===t.readOnly,accordeonHeader:{label:e.nlsName?e.nlsName:e.name,value:e.name}};if(t.range){n.type="select";var i=t.range.replace(/[[\]']+/g,"").split(","),r=t.rangeNls,s=[],o=t.default;i.forEach(function(e,t){var a=e.trim(),i={label:r[t]?r[t]:a,value:a};void 0===n.value&&a===o&&(n.selected="true"),s.push(i),n.options=s})}a.push(n)}))})},s.prototype.processInterfaceDetailsFromRelatedData=function(e,a){(e.data[0].relateddata?e.data[0].relateddata["interface-details"]:e.data[0]["interface-details"]).forEach(function(e){if(!t.REQUEST_CATEGORIES_ACTUAL.includes(e.id)){let t=e.dataelements?e.dataelements:e;var n=t.displayName?t.displayName:t.description?t.description:e.id;e.children.forEach(function(t){if(!a.find(e=>e.name===t.id)){let d=t.dataelements?t.dataelements:t;if("timestamp"===d.type&&d.displayRanges){let e=i.getDateStringForDisplay(d.value);d.value=e.substring(0,e.lastIndexOf(",")),d.displayRanges.forEach((e,t)=>{let a=i.getDateStringForDisplay(e);d.displayRanges[t]=a.substring(0,a.lastIndexOf(","))})}var r=d.displayName?d.displayName:t.id,s={type:d.type,label:r,name:t.id,value:d.value,from:"interface",disable:!0,accordeonHeader:{label:n,value:e.id}};if(d.range){s.type="select";var o=d.range,l=[],c=d.default;o.forEach(function(e,t){var a=e.trim(),n={label:d.displayRanges[t]?d.displayRanges[t]:a,value:a};void 0===s.value&&a===c&&(n.selected="true"),l.push(n),s.options=l})}a.push(s)}})}})},s.prototype.addInterfacePayloadForMei=function(e){let t;if(e.selectedAttributes){let a={};e.selectedAttributes.forEach(function(e){if(0!==e.length){let t={};e.forEach(function(e){let n=e.path?e.path:e.name,i=Array.isArray(e.value)?e.value[0]:e.value,r=e.parentInterface;t[n]=""===i||void 0===i?e.defaultValue:i,a[r]=t})}t=a})}return{interfaces:t,phyIDS:[e.id?e.id:e.data.params.id]}},s.prototype.removeInterfacePayloadForMei=function(e){return{interfaces:e.extensionsToDelete,phyIDS:[e.id?e.id:e.data.params.id]}},s.prototype.show=function(e){let t=this,a=e.options,n=e.addAGController;a.qualificationId=e.id,a.type=e.type,a.callerModel=e.callerModel,a.callerController=e.callerController,a.addAGController=n,t.model.getDictionaryObjectInterfaces(a).then(e=>{let n=t.processAttachedExtensions(e);a.attachedExtensions=n.data,a.attachedExtensionList=n.extensionList,t.getDictionaryInterfaces(a)}).catch(function(e){widget.notificationUtil.showError(e.internalError?e.internalError:r.error_retrieving_extensions_applied),t.getDictionaryInterfaces(a)})},s.prototype.getDictionaryInterfaces=function(e){var t=this;t.model.getDictionaryInterfaces(e).then(n=>{var i={};i.respData=n,i.attachedExtensions=e.attachedExtensionList?e.attachedExtensionList:[],e.extensionData=t.processDicoInterfaceList(i);new a(e)})},s.prototype.processAttachedExtensions=function(e){let t={},a=[],n=[];return e.results&&e.results[0]&&e.results[0].interfaces.length>0?e.results[0].interfaces.forEach(e=>{let t={name:e.name,displayName:e.nameNLS};a.push(t),n.push(e.name)}):e.data&&e.data[0]&&e.data[0].relateddata&&e.data[0].relateddata["interface-details"].length>0?e.data[0].relateddata["interface-details"].forEach(e=>{let t={name:e.id,displayName:e.dataelements.displayName?e.dataelements.displayName:e.id};a.push(t),n.push(e.id)}):e.data&&e.data[0]&&e.data[0]["interface-details"]&&e.data[0]["interface-details"].length>0&&e.data[0]["interface-details"].forEach(e=>{let t={name:e.id,displayName:e.displayName?e.displayName:e.id};a.push(t),n.push(e.id)}),t.data=a,t.extensionList=n,t},s.prototype.processDicoInterfaceList=function(e){let t=[],a=e.respData,n=e.attachedExtensions;return a.results[0]&&a.results[0].interfaces.length>0&&a.results[0].interfaces.forEach(e=>{if(!n.includes(e.name)){let a={name:e.name,displayName:e.nlsName,attributes:[]};e.attributes.forEach(function(e){var t={name:e.name,type:e.Primitive,defaultValue:e.default,displayName:e.nlsName,path:e.path?e.path:""};e.hasRange&&(t.type="select",t.range=e.ranges,t.displayRange=e.rangesNls),a.attributes.push(t)}),t.push(a)}}),t},s});