define("DS/CATRgrApp/outputformat/commands/Duplicate",["require","exports","DS/ApplicationFrame/Command","DS/CATRgnWidgetCommons/restClient/OutputFormatServices","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/RGNServices/Alert"],function(e,t,o,i,n,r){"use strict";return o.extend({execute:async function(){try{const e=this,t=await n.service3DSpace(e.viewManager.ofViewer.ofLibrary.webClientOptions),o=await n.createHeaders(e.viewManager.ofViewer.ofLibrary.webClientOptions,!0),a=e.viewManager.ofViewer.ofLibrary.getSelectedOutPutFormats().map(async e=>await async function(e,t,o){const n=(await i.getOutputFormat(e,t,o)).outputFormat;return{description:n.description,policy:n.policy,title:n.title}}(t,o,e.id)),s=await i.createOutputFormats(t,o,await Promise.all(a));e.viewManager.ofViewer.ofLibrary.addFromIds(s.outputFormats.map(e=>e.id))}catch(e){console.error(e),r.error(e)}}})}),define("DS/CATRgrApp/report/commands/Generate",["require","exports","DS/ApplicationFrame/Command","UWA/Core","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/RGNServices/Alert"],function(e,t,o,i,n,r,a){"use strict";const s={execute:async function(){let e=[];const t=this.options.libraryManager.modelManager.getModel();t&&(e=t.getSelectedNodes());const o=e.map(e=>e.options.grid),i=this.options.libraryManager,s=await r.createHeaders(i.webClientOptions,!0);o.forEach(async t=>{var o,r;try{const d=e.find(e=>e.options.grid.id===t.id);null==d||d.updateOptions({grid:{generation:{status:void 0,message:"",remainingTime:0}}}),await n.generateReports(i.service,s,null!==(o=this.options.withChanges)&&void 0!==o&&o,!0,[t.id]),this.options.libraryManager.updateReportInfos({id:t.id,generation:{status:"",message:"",running:void 0}}),i.autoRefresh({timer:void 0,libraryManager:i},3e3,i.service,0)}catch(e){const t=null!==(r=e.response.status.message)&&void 0!==r?r:e;throw console.log(t),a.error(t),e}})}},d=o.extend(s);return i.namespace("GenerateReport",d)}),define("DS/CATRgrApp/report/ReportTaggerProxyFilter",["require","exports","DS/CATRgnWidgetCommons/TaggerProxyFilter","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons"],function(e,t,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReportTaggerProxyFilter=void 0;t.ReportTaggerProxyFilter=class extends o.TaggerProxyFilter{constructor(e,t,o){super(e,t),this.reportLibrary=o}async addDataToProxy(e){e.forEach(e=>{var t,o,n,r,a,s;this._cachedSubjects[e.id]=[],null===(t=this._cachedSubjects[e.id])||void 0===t||t.push({sixw:`ds6w:what/${i.outputFormat}`,object:e.outputFormat.title},{sixw:`ds6w:what/${i.template}`,object:e.template.title},{sixw:"ds6w:what/ds6w:status",object:`Report Model.${e.current}`,dispValue:i[`lifeCycle.${e.current.toUpperCase()}`]},{sixw:"ds6w:who/ds6w:responsible",object:e.ownerFullName}),e.targetDocument&&(null===(o=this._cachedSubjects[e.id])||void 0===o||o.push({sixw:"ds6w:what/ds6w:docExtension",object:null!==(s=null===(a=/\.(.*)/.exec(null!==(r=null===(n=e.targetDocument.reportFile)||void 0===n?void 0:n.fileName)&&void 0!==r?r:""))||void 0===a?void 0:a[1])&&void 0!==s?s:""}))}),this._cachedSubjects=await this.filterFacets(e,this._cachedSubjects),this._proxy.setSubjectsTags(this._cachedSubjects)}async modifyDataInProxy(e,t){let o,n,r;e.forEach(e=>{var a,s,d,l,c,u;if("current"==e)o="ds6w:what/ds6w:status",n=`Report Model.${t.current}`,r=i[`lifeCycle.${t.current.toUpperCase()}`];else if("generation"==e){o=`ds6w:what/${i.generationStatus}`;const e=this.reportLibrary.getGenerationStatusCellValue(t).label;n=null!=e?e:""}else if("targetDocument"==e&&"targetDocument"in t){o="ds6w:what/ds6w:docExtension";const e=/\.(.*)/.exec(null!==(d=null===(s=null===(a=t.targetDocument)||void 0===a?void 0:a.reportFile)||void 0===s?void 0:s.fileName)&&void 0!==d?d:"");n=null!==(l=null==e?void 0:e[1])&&void 0!==l?l:""}if(n&&o){const e=null===(c=this._cachedSubjects[t.id])||void 0===c?void 0:c.find(e=>e.sixw===o);e?(e.object=n,e.dispValue=r):null===(u=this._cachedSubjects[t.id])||void 0===u||u.push({sixw:o,object:n})}}),this._proxy.setSubjectsTags(this._cachedSubjects)}}}),define("DS/CATRgrApp/report/commands/Remove",["require","exports","UWA/Core","DS/ApplicationFrame/Command","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","DS/CATRgnWidgetCommons/restClient/CommonServices"],function(e,t,o,i,n,r,a,s){"use strict";const d=i.extend({execute:async function(){let e=[];const t=this.viewManager.getReportLibraryManager(),i=this.viewManager.getModel().getSelectedNodes();if(i&&(e=i.map(e=>e.options.grid.id)),e.length<1)return;let s=a.removeReportsMessage;s+="<ol>";for(const e of i)s+="<li>"+l.call(this,e.options.grid)+"</li>";s+="</ol>";const d=new o.Element("div",{class:"rgr-remove-container",html:s}),c=new n({title:a.removeReports,content:d,buttons:{Yes:new r({onClick:function(){t.removeReports(e),c.close()}}),Cancel:new r({onClick:function(){c.close()}})}})}});function l(e){var t;return`<strong>${null!==(t=e.title)&&void 0!==t?t:e.name}</strong> | ${s.getNLSType(e.type,this.viewManager.reportViewer.widgetSettings.dictionaryLoaded)} | ${e.revision} | ${e.name}`}return o.namespace("RGR/report/command/Remove",d)}),define("DS/CATRgrApp/interfaces/RgrInterfaces",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/CATRgrApp/utils/UploadUI",["require","exports","DS/TreeModel/TreeDocument","DS/CATRgnWidgetCommons/TableView","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/utils/RGNConstants","DS/CATRgnWidgetCommons/ModelElement","UWA/Core"],function(e,t,o,i,n,r,a,s,d,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadUI=t.getUniqueIdForFile=void 0;const p="UploadImmersiveFrame",g="UploadPanel";function m(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}t.getUniqueIdForFile=m;t.UploadUI=class{constructor(e){this.settings=e;const t=document.querySelector(`[wux-identifier="${p}"]`);if(t)this.frame=t.dsModel,this.model=t.querySelector(`[wux-identifier="${l.RGN_GRID_VIEW}"]`).dsModel.getTreeDocument();else{this.frame=new r({reactToPointerEventsFlag:!1,identifier:p}),this.model=new o({useAsyncPreExpand:!0});const t={columns:[{text:n.fileName,dataIndex:"tree",alwaysVisibleFlag:!0,typeRepresentation:"url",editableFlag:!1,getCellValue:e=>{var t;return{label:null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.title,icon:"doc-text wux-ui-3ds"}}},{text:n.uploadStatus,dataIndex:"success",alwaysVisibleFlag:!0,typeRepresentation:"icon",editableFlag:!1,getCellValue:e=>{var t;const o=null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.uploadStatus;return o?"fonticon fonticon-checkbox-on":0==o?"fonticon fonticon-error":"fonticon fonticon-upload"}}],identifier:"UploadView",defaultColumnDef:{editableFlag:!1},showContextualMenuColumnFlag:!1,treeDocument:this.model,cellDragEnabledFlag:!1,workbenchName:"CATRgrWebApp",workbenchModule:"CATRgrApp",model:this.model};this.fillContainer(new i(this.model,t,e,!1,!1),this.frame,e)}}displayUploadUI(e,t){const o=[];for(let e=0;e<t.length;e++){const i=t[e],n=m();i&&o.push({title:i.name,id:n,file:i})}return this.addToModel(o,this.model),o}addToModel(e,t){t.prepareUpdate();let o=[];o=e.map(e=>new s.ModelElement({title:e.title,success:void 0,id:e.id,owner:"",ownerFullName:"",revision:"",name:"",type:"file",current:"",metaType:c.MetaType.Upload,description:""},{},new d.WidgetClientFactory).getNode()),t.addChild(o),t.pushUpdate()}updateNode(e,t){const o=this.model.getRoots().find(t=>t.options.grid.id===e);null==o||o.updateOptions({grid:{uploadStatus:t}})}fillContainer(e,t,o){t.inject(o.widgetBody);const i=new u.Element("div",{id:"uploadingPanel"});e.inject(i),new a({position:{my:"bottom right",at:"bottom right",of:t},immersiveFrame:t,title:n.uploadManagement,content:i,height:200,width:500,resizableFlag:!0,identifier:g}).addEventListener("close",()=>{t.destroy()})}}}),define("DS/CATRgrApp/outputformat/OutputFormatLibrary",["require","exports","DS/CATRgnWidgetCommons/restClient/OutputFormatServices","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/ModelManager","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgnWidgetCommons/RecentsManager","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/LoaderManager","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons","DS/CATRgnWidgetCommons/ListManager","DS/CATRgnWidgetCommons/TaggerProxyFilter"],function(e,t,o,i,n,r,a,s,d,l,c,u,p){"use strict";async function g(e){const t=new d.WidgetClientFactory,o=await i.service3DSpace(t);return{metaType:a.MetaType.OutputFormat,id:e.id,type:e.type,name:e.name,title:e.title,description:e.description,current:e.current,revision:e.revision,owner:e.owner,fileName:e.fileName,ownerFullName:await i.getPersonFullName(o,(new i.HeadersBuilder).createHeader(t.getSecurityContext()),e.owner),fileVersion:null==e?void 0:e.fileVersion}}function m(e,t){return t.indexOf(e.type)>=0}return class{constructor(e,t,o,i){this.ofView=e,this.options=i;const r=new d.WidgetClientFactory;this.modelManager=new n(u.RGR_OUTPUFORMATS,new s.RecentsManager("RGR",r),r,o),this.modelManager.setTaggerProxyFilter(new p.TaggerProxyFilter({model:this.modelManager.model,widgetSettings:o},r)),this.webClientOptions=r,this.service=t,this.widgetSettings=o,this.modelManager.getModel().setFilterModel({tree:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:""},operator:"or",condition2:{type:"contains",filter:""}}},name:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:""},operator:"or",condition2:{type:"contains",filter:""}}},dispType:{filterId:"set"},ownerFullName:{filterId:"set"},revision:{filterId:"set"},current:{filterId:"set"}})}getModel(){return this.modelManager.getModel()}getSelectedOutPutFormats(){let e=[];const t=this.modelManager.getModel();t&&(e=t.getSelectedNodes());const o=[];return e.forEach(e=>{const t=e.options.grid;o.push(t)}),o}addOutputFormats(e,t){var o;this.modelManager.addToModel(e,this.ofView.getOptionsForNode(this.ofView),t,this.widgetSettings.dictionaryNls),null===(o=this.modelManager.tagger)||void 0===o||o.addDataToProxy(e)}removeOutputFormats(e){const t=this.modelManager.getModel().getRoots().filter(t=>e.find(e=>e==t.options.grid.id));this.modelManager.removeFromModel(t)}async addFromIds(e,t){const n=new l(this.widgetSettings.widgetBody.getElement("#output-formats-container"));n.displayLoader(c.LOADING);try{e=e.filter(e=>-1===this.getModel().getRoots().map(e=>{var t;return null===(t=e.getAttributeValue)||void 0===t?void 0:t.call(e,"id")}).indexOf(e));const a=10,s=[];for(let t=0;t<e.length;t+=a)s.push(e.slice(t,t+a));const d=(new i.HeadersBuilder).createHeader(this.webClientOptions.getSecurityContext());for(const e of s){const n=await o.getOutputFormatsBulk(this.service,d,e);if(this.addOutputFormats(await Promise.all(n.outputFormats.filter(async e=>{var t;return m(e,null!==(t=await this.widgetSettings.acceptedOFTypes)&&void 0!==t?t:[""])}).map(g)),t),i.isBulkGetPartialSucessStatus(n.status)){const e=n.status.details.map(e=>`${e.message}: ${e.reference.id}`).concat("\n");r.info(e)}}}catch(e){console.log(e),r.error(e)}finally{n.hideLoader()}}}}),define("DS/CATRgrApp/utils/RGRConstants",["require","exports"],function(e,t){"use strict";return Object.freeze({CREATE_OF:"CreateOutputFormat",CREATE_REPORT:"CreateReport",OPEN_OF:"OpenOutputFormat",OPEN_REPORT:"OpenReport",VIEW_HOME:"Home",VIEW_LIST_OF:"MyOutputFormats",VIEW_LIST_REPORT:"MyReports",VIEW_RECENT_OBJECTS:"RecentObjects",REPORT_SELECTOR:"Report_Selector",TEMPLATE_SELECTOR:"Template_Selector",ASSIGN_INPUTS:"Assign_Inputs",REPORT_PROPERTIES:"Report_Properties",RGR_DISPLAY_VIEW:"RGR_DisplayView",REPORT_TABLE:"report_table",REPORT_TILE:"report_tile",OF_TABLE:"of_table",OF_TILE:"of_tile",WELCOME_PAGE:"welcomePage"})}),define("DS/CATRgrApp/report/commands/Create",["require","exports","UWA/Core","DS/ApplicationFrame/Command","DS/CATRgrReportWizard/wizard/ReportWizard","DS/CATRgrReportWizard/utils/RGRWizardModes"],function(e,t,o,i,n,r){"use strict";const a=i.extend({execute:function(){new n.ReportWizard(void 0,r.RGRWizardModes.ADD_REPORT,this.isRGWidget)}});return o.namespace("RGR/report/command/Create",a)}),define("DS/CATRgrApp/utils/GenerationProgressBar",["require","exports","DS/Controls/ProgressBar"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showProgressBar=void 0,t.showProgressBar=function(e){var t,i,n,r,a,s;if("number"==typeof e.progress)new o({shape:"linear",value:e.progress,statusFlag:!0,emphasize:"info"}).inject(e.container);else{const d=null===(n=null===(i=null===(t=e.progress)||void 0===t?void 0:t.running)||void 0===i?void 0:i.timeRemaining)||void 0===n?void 0:n.seconds,l=null===(s=null===(a=null===(r=e.progress)||void 0===r?void 0:r.running)||void 0===a?void 0:a.progession)||void 0===s?void 0:s.percent;new o({shape:"linear",value:null!=d&&d>=0?l:90,statusFlag:null!=d&&d>=0,emphasize:null!=d&&d>=0?"info":"warning"}).inject(e.container)}}}),define("DS/CATRgrApp/report/commands/Export",["require","exports","DS/ApplicationFrame/Command","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/CATRgnWidgetCommons/restClient/DocumentServices","DS/CATRgnWidgetCommons/restClient/CommonServices","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","DS/CATRgnWidgetCommons/interfaces/Facade"],function(e,t,o,i,n,r,a,s,d){"use strict";return o.extend({execute:async function(){var e;const t=new d.WidgetClientFactory,o=this.viewManager.getModel(),l=await a.service3DSpace(t),c=(new a.HeadersBuilder).createHeader(t.getSecurityContext()),u=(null!==(e=o.getSelectedNodes())&&void 0!==e?e:[]).map(e=>e.options.grid.id);u.length<1?i.info(s.SELECT_AT_LEAST_ONE):(await n.generationStatus(l,c,u)).reports.forEach(e=>{e.targetDocument&&e.targetDocument.id?r.download(l,t.getSecurityContext(),e.targetDocument.id,e.targetDocument.reportFile.id):i.info(s.NO_FILE_TO_DOWNLOAD)})}})}),define("DS/CATRgrApp/utils/FileVersionsManagement",["require","exports","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/restClient/DocumentServices","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/ModelElement","DS/Windows/Dialog","DS/Controls/Button","DS/TreeModel/TreeDocument","DS/CATRgnWidgetCommons/TableView","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","DS/Windows/ImmersiveFrame"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileVersionsManagementWidget=t.FromView=void 0;const m="fileVersionImmersiveFrame";var v;!function(e){e[e.Report=0]="Report",e[e.OutputFormat=1]="OutputFormat"}(v=t.FromView||(t.FromView={}));t.FileVersionsManagementWidget=class{constructor(e,t,n,s){this.widgetSettings=n,this.model=new c({useAsyncPreExpand:!0}),this.frame=new g({reactToPointerEventsFlag:!1,identifier:m}),this.frame.inject(n.widgetBody),this.fromView=t;const w={columns:(h=this,[{text:p.versions,dataIndex:"tree",pinned:"left",alwaysVisibleFlag:!0,editableFlag:!1,width:70,getCellValue:e=>{var t;return null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.revision}},{text:h.fromView===v.OutputFormat?p.uploadedBy:p.generatedBy,dataIndex:"ownerFullName",editableFlag:!1},{text:h.fromView===v.OutputFormat?p.uploadedOn:p.generatedOn,dataIndex:"uploadedOn",getCellValue:e=>{var t,o;if(null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.uploadedOn){const t=new Date(null===(o=e.nodeModel)||void 0===o?void 0:o.options.grid.uploadedOn);return`${t.toLocaleDateString(h.widgetSettings.language)} ${t.getHours()}:${t.getMinutes()}`}}},{text:p.action,dataIndex:"action",typeRepresentation:"url",pinned:"right",getCellValue:()=>({label:p.download,func:async e=>{const t=new r.WidgetClientFactory,n=await a.service3DSpace(t);i.download(n,t.getSecurityContext(),e.context.nodeModel.options.grid.id).catch(e=>{o.error(e.data[0].updateMessage),console.log(e)})}})}]),identifier:"fileVersionView",defaultColumnDef:{editableFlag:!1},showContextualMenuColumnFlag:!1,treeDocument:this.model,cellDragEnabledFlag:!1,workbenchName:"CATRgrWebApp",workbenchModule:"CATRgrApp",model:this.model};var h;new d({immersiveFrame:this.frame,title:p.fileVersions,resizableFlag:!0,width:500,height:200,modalFlag:!0,content:new u(this.model,w,n,!1,!1),buttons:{Close:new l({onClick:()=>{this.frame.destroy()}})}}).addEventListener("close",()=>{this.frame&&this.frame.destroy()}),this.results=i.getDocumentsVersion(e,{getVersions:!0,tenantUrl:s.url,tenant:s.tenant})}async displayVersions(){const e=await this.getDocumentVersion();e&&this.addToModel(e,{})}async addToModel(e,t){this.model.prepareUpdate();let o=[];o=e.map(e=>new n.ModelElement(e,t,new r.WidgetClientFactory).getNode()),this.model.addChild(o),this.model.pushUpdate()}async getDocumentVersion(){var e,t,i,n;try{const r=await this.results,a=null===(i=null===(t=null===(e=null==r?void 0:r.data)||void 0===e?void 0:e[0])||void 0===t?void 0:t.relateddata.files)||void 0===i?void 0:i[0];let d=a?[a]:[];return(null==a?void 0:a.relateddata.versions)&&(d=d.concat(null==a?void 0:a.relateddata.versions)),d.map(e=>{var t,o,i,n,r,a,d,l,c,u,p;return{id:e.id,uploadedBy:null!==(o=null===(t=e.relateddata.ownerInfo[0])||void 0===t?void 0:t.dataelements.name)&&void 0!==o?o:"",owner:null!==(r=null===(n=null===(i=e.relateddata.ownerInfo)||void 0===i?void 0:i[0])||void 0===n?void 0:n.dataelements.name)&&void 0!==r?r:"",ownerFullName:`${null!==(l=null===(d=null===(a=e.relateddata.ownerInfo)||void 0===a?void 0:a[0])||void 0===d?void 0:d.dataelements.firstname)&&void 0!==l?l:""} ${null!==(p=null===(u=null===(c=e.relateddata.ownerInfo)||void 0===c?void 0:c[0])||void 0===u?void 0:u.dataelements.lastname)&&void 0!==p?p:""}`,uploadedOn:e.dataelements.originated,revision:e.dataelements.revision,title:e.dataelements.title,name:e.dataelements.name,type:e.dataelements.fileType,current:"",metaType:s.MetaType.FileVersions,description:""}})}catch(e){const t=null!==(n=e.error)&&void 0!==n?n:e;return void o.error(t)}}}}),define("DS/CATRgrApp/report/commands/Duplicate",["require","exports","DS/ApplicationFrame/Command","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/RGNServices/Alert"],function(e,t,o,i,n,r){"use strict";function a(e){const t={title:e.title,description:e.description,outputFormat:{id:e.outputFormat.id},template:{id:e.template.id}};return e.inputs&&(t.inputs=e.inputs.map(e=>({values:e.values}))),e.targetDocument&&(t.targetDocument={id:e.targetDocument.id}),e.configuration&&(t.configuration=e.configuration),t}return o.extend({execute:async function(){const e=this;try{const t=e.viewManager.getLibraryManager().getSelectedReports().map(e=>e.id),o=await i.service3DSpace(e.viewManager.getLibraryManager().webClientOptions),s=await i.createHeaders(e.viewManager.getLibraryManager().webClientOptions,!0),d=(await n.getReportsBulk(o,s,t)).reports.map(a),l=await n.createReports(o,s,d);e.viewManager.getLibraryManager().addFromIds(l.reports.map(e=>e.id),!0)}catch(e){r.error(e)}}})}),define("DS/CATRgrApp/outputformat/commands/Upload",["require","exports","UWA/Core","DS/ApplicationFrame/Command","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons","DS/CATRgnWidgetCommons/LoaderManager","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/DocumentServices","DS/CATRgnWidgetCommons/restClient/OutputFormatServices","DS/RGNServices/Alert"],function(e,t,o,i,n,r,a,s,d,l){"use strict";function c(e,t,i,c,u){const p=new o.Element("div",{}).inject(u.widgetBody),g=new o.Element("input",{type:"file",styles:{display:"none"},accept:t.join(",")}).inject(p);return g.click(),g.addEventListener("change",t=>{const o=null==t?void 0:t.target;if(o&&o.files&&o.files[0]){const t=null==o?void 0:o.files[0];new r(c.widgetSettings.widgetBody.getElement("#output-formats-container")).showLoader(()=>(async function(e,t,o,i){var r;try{const c=i.webClientOptions,u=await a.service3DSpace(c);if(o){o.fileName?await s.replaceFile(u,c.getSecurityContext(),t,e.name,e):o.fileName||await s.addFileToDocument(u,c.getSecurityContext(),t,e),l.info(n.uploadSuccessMessage);const r=await d.getOutputFormatsBulk(u,(new a.HeadersBuilder).createHeader(c.getSecurityContext()),[o.id]),p=i.getModel().getRoots().find(e=>e.options.grid.id===t);if(!r.outputFormats[0])throw new Error("Output format not found");null==p||p.updateOptions({grid:{fileName:e.name,fileVersion:r.outputFormats[0].fileVersion}})}}catch(e){l.error(null!==(r=e.error)&&void 0!==r?r:e)}})(t,e,i,c),n.uploading)}}),p}return i.extend({execute:async function(){const e=this,t=e.outputFormatLibrary.getModel();if(t){const o=t.getSelectedNodes();if(o&&1===o.length){const t=o[0].options.grid.id;c(t,d.supportedExtensions().map(e=>"."+e),e.outputFormatLibrary.modelManager.getCollection().getElementById(t),e.outputFormatLibrary,e.widgetSettings)}else alert(n.SELECT_ONE_OUTPUT_FORMAT)}}})}),define("DS/CATRgrApp/outputformat/commands/Export",["require","exports","DS/ApplicationFrame/Command","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/DocumentServices","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/interfaces/Facade"],function(e,t,o,i,n,r,a){"use strict";return o.extend({execute:async function(){const e=this.outputFormatLibrary.getModel(),t=new a.WidgetClientFactory;if(e){const o=e.getSelectedNodes();if(o.length<1)return;const a=await i.service3DSpace(t);o.forEach(async e=>{try{n.download(a,t.getSecurityContext(),e.getAttributeValue("id"))}catch(e){r.error(e)}})}}})}),define("DS/CATRgrApp/report/commands/Edit",["require","exports","UWA/Core","DS/ApplicationFrame/Command","DS/RGNServices/Alert","DS/CATRgrReportWizard/wizard/ReportWizard","DS/CATRgrReportWizard/utils/RGRWizardModes","i18n!DS/CATRgrApp/assets/nls/CATRgrApp"],function(e,t,o,i,n,r,a,s){"use strict";const d=i.extend({execute:function(){let e=[];const t=this.viewManager.getModel();if(t&&(e=t.getSelectedNodes()),e.length<1)return void n.info(s.SELECT_AT_LEAST_ONE);const o=e[0].options.grid,i={getID:()=>o.id},d=[];d.push(i),new r.ReportWizard(d,a.RGRWizardModes.EDIT_REPORT,this.isRGWidget)}});return o.namespace("RGR/report/command/EditProperties",d)}),define("DS/CATRgrApp/outputformat/UI/CreateOutputFormat",["require","exports","UWA/Core","DS/Controls/Loader","DS/Controls/Button","DS/Controls/Expander","DS/CATRgnWidgetCommons/UI/BasicUIElements","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/OutputFormatServices","DS/RGNServices/Alert","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons","DS/CATRgnWidgetCommons/interfaces/Facade","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","css!DS/CATRgrApp/outputformat/UI/css/CreateOutputFromatStyle"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOutputFormatUI=void 0,t.createOutputFormatUI=async function(e,t){const v={title:"",policy:"Report Model"},w=new p.WidgetClientFactory,h=await s.service3DSpace(w),C=e.getOutputFormatLibraryManager();async function f(){var e,p,f,R;const y=new o.Element("div",{id:"output-format-form",class:"output-format-form"});try{const S=(new i).inject(y),A={container:y,label:c.title,placeholder:c.title,requiredFlag:!0,onChange:e=>{v.title=e.target.dsModel.valueToCommit.trim(),""!==v.title?W.disabled=!1:W.disabled=!0}};a.InputEditor(A,"uncommittedChange");const b={container:y,label:c.description,placeholder:c.description,onChange:e=>v.description=e.target.dsModel.value};a.TextAreaEditor(b);const T=(new s.HeadersBuilder).createHeader(w.getSecurityContext()),D=await d.getOutputFormatLibrary(h,T),M=[u.NONE].concat(D.outputFormats),F={container:y,label:c.predefinedFile,elementsList:M,onChange:e=>{const t=e.target.dsModel.value;M.includes(t)?v.libraryFilename=t:delete v.libraryFilename}};a.ComboBox(F);const x=o.createElement("div"),E={container:x,label:c.policy,elementsList:c.policyList,onChange:e=>v.policy=e.target.dsModel.value};a.ComboBox(E);const O={container:x,label:c.name,placeholder:c.blankAutoName,onChange:e=>v.name=e.target.dsModel.value.trim()};a.InputEditor(O,"change"),new r({header:c.showMore,expandedFlag:!1,body:x}).inject(y);const I=new m({});I.elements.container.setStyle("pointer-events","none"),I.inject(t.widgetBody);const W=new n({label:c.create,emphasize:"primary",domId:"submitButtonOFID",disabled:!0}),L=new g({immersiveFrame:I,title:c.newOutputFormat,content:y,buttons:{Yes:W,Cancel:new n({onClick:function(){L.close()}})},resizableFlag:!0,width:550});L.minHeight=320,L.buttons.Yes.addEventListener("buttonclick",()=>{!async function(e,t,o){var i,n;t.on(c.loader);try{const r=(new s.HeadersBuilder).createHeaderWithCsrfToken(o.getSecurityContext(),await s.getCSRFToken()),a=(await d.createOutputFormats(h,r,[v])).outputFormats[0];e.destroy(),C.addFromIds([null!==(i=null==a?void 0:a.id)&&void 0!==i?i:""],!0)}catch(e){if(t.off(c.loader),(null===(n=e.response.status.details[0])||void 0===n?void 0:n.message)===c.errrorResponse)return void setTimeout(()=>{l.error(c.uniqueError)},500);console.error(e),setTimeout(()=>{l.error(c.errorMessage)},500)}}(L,S,w)}),L.show()}catch(t){console.error(t);const o=null!==(R=null!==(f=null===(p=null===(e=t.response)||void 0===e?void 0:e.status)||void 0===p?void 0:p.message)&&void 0!==f?f:t.message)&&void 0!==R?R:"Creation Failed";throw l.error(o),t}}return f(),f}}),define("DS/CATRgrApp/outputformat/commands/Remove",["require","exports","UWA/Core","DS/ApplicationFrame/Command","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/restClient/CommonServices"],function(e,t,o,i,n,r,a,s,d){"use strict";function l(e){return`<strong>${e.title}</strong> | ${d.getNLSType(e.type,this.outputFormatLibrary.widgetSettings.dictionaryLoaded)} | ${e.revision} | ${e.name}`}const c=i.extend({execute:function(){const e=this.outputFormatLibrary;let t=[];const i=this.outputFormatLibrary.getModel().getSelectedNodes();if(i&&(t=i.map(e=>e.options.grid.id)),t.length<1)return;let d=a.removeOutputFormatsMessage;d+="<ol>";for(const e of i)d+="<li>"+l.call(this,null==e?void 0:e.options.grid)+"</li>";d+="</ol>";const c=new o.Element("div",{class:"rgr-remove-container",html:d}),u=new n({title:a.removeOutputFormats,content:c,buttons:{Yes:new r({onClick:function(){try{e.removeOutputFormats(t),u.close()}catch(e){s.error(e)}}}),Cancel:new r({onClick:function(){u.close()}})}})}});return o.namespace("RGR/outputformat/command/Remove",c)}),define("DS/CATRgrApp/utils/ReportGenerationActions",["require","exports","DS/ApplicationFrame/CommandsManager","UWA/Core","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgrReportPostEditing/PostEditing","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/restClient/InternalServices","DS/CATRgnWidgetCommons/utils/RGNConstants"],function(e,t,o,i,n,r,a,s,d,l){"use strict";var c;Object.defineProperty(t,"__esModule",{value:!0}),t.executeAction=t.Actions=void 0,function(e){e[e.PROCESS_POST_EDITION=0]="PROCESS_POST_EDITION",e[e.GENERATE_REPORT=1]="GENERATE_REPORT",e[e.ABORT_REPORT_GENERATION=2]="ABORT_REPORT_GENERATION",e[e.DOWNLOAD_FILE=3]="DOWNLOAD_FILE"}(c=t.Actions||(t.Actions={})),t.executeAction=async function(e){switch(e.action){case c.PROCESS_POST_EDITION:!async function(e){var t,o,d;const c=e.reportLibrary.service,u=(new r.HeadersBuilder).addSecurityContext(null===(t=e.reportLibrary)||void 0===t?void 0:t.webClientOptions.getSecurityContext()).build();(await n.generationStatus(c,u,[null!==(d=null===(o=e.report)||void 0===o?void 0:o.id)&&void 0!==d?d:""])).reports.forEach(async t=>{var o,n,r,d;const u=l.ReportStatus[null===(o=t.generation)||void 0===o?void 0:o.status];try{if(u===l.ReportStatus.NeedPostEdition||u===l.ReportStatus.NeedPostEditionAndWithChanges){const o=u===l.ReportStatus.NeedPostEditionAndWithChanges,s={id:t.id,service:c,securityContext:null!==(r=null===(n=e.reportLibrary)||void 0===n?void 0:n.webClientOptions.getSecurityContext())&&void 0!==r?r:"",withChanges:o};e.reportLibrary&&a.openPostEditingView(null===(d=e.settings)||void 0===d?void 0:d.widgetBody,s,async t=>{var o;i.extend(t,{generation:{status:"Running",message:"",remainingTime:void 0}}),null===(o=e.reportLibrary)||void 0===o||o.updateReportInfos(t),e.reportLibrary.autoRefresh({timer:void 0,libraryManager:e.reportLibrary},3e3,c,0)})}}catch(e){throw console.log(e),s.error(e),e}})}(e);break;case c.GENERATE_REPORT:!function(e){const t=o.getCommand("GenerateReport",e.reportLibrary.options.workbenchName);t.options.withChanges=!1,t.options.libraryManager=e.reportLibrary,t.options.displayer=e.reportLibrary.options.displayer,t.begin()}(e);break;case c.ABORT_REPORT_GENERATION:!async function(e){var t,o;const i=(new r.HeadersBuilder).addSecurityContext(e.reportLibrary.webClientOptions.getSecurityContext()).add3DSpaceCsrfToken(await r.getCSRFToken()).build();d.abortJob(e.reportLibrary.service,i,null!==(o=null===(t=e.report)||void 0===t?void 0:t.id)&&void 0!==o?o:"")}(e);break;case c.DOWNLOAD_FILE:!function(e){const t=o.getCommand("ExportReport",e.reportLibrary.options.workbenchName);t.viewManager=e.reportLibrary.viewManager,t.begin()}(e)}}}),define("DS/CATRgrApp/outputformat/commands/Create",["require","exports","UWA/Core","DS/ApplicationFrame/Command","DS/CATRgrApp/outputformat/UI/CreateOutputFormat"],function(e,t,o,i,n){"use strict";const r=i.extend({execute:async function(){const e={fileEvent:void 0},t=this.options.fileEvent;t&&(this.options.fileEvent=void 0,e.fileEvent=t),await n.createOutputFormatUI(this.viewManager,this.widgetSettings)}});return o.namespace("RGR/outputformat/commands/Create",r)}),define("DS/CATRgrApp/report/ReportLibrary",["require","exports","DS/CoreEvents/Events","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/RGNServices/RGNServices","DS/CATRgnWidgetCommons/ModelManager","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/RecentsManager","DS/CATRgnWidgetCommons/LoaderManager","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgnWidgetCommons/ListManager","DS/CATRgrApp/report/ReportTaggerProxyFilter","DS/CATRgnWidgetCommons/utils/RGNConstants","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","DS/CATRgrApp/utils/ReportGenerationActions"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m,v,w,h){"use strict";var C;t.autoRefresh=t.getActionCellValue=void 0,function(e){e.REDO_ICON="redo wux-ui-3ds",e.ALERT_ICON="alert wux-ui-3ds",e.DOWNLOAD_ICON="download wux-ui-3ds",e.HOURGLASS_ICON="hourglass wux-ui-3ds",e.CHECK_ICON="check wux-ui-3ds",e.WRONG_ICON="wrong wux-ui-3ds",e.EXCHANGE_ICON="exchange wux-ui-3ds",e.ERROR_ICON="error wux-ui-3ds",e.WALK_ICON="transportation-walk wux-ui-3ds",e.STOP_ICON="stop wux-ui-3ds"}(C||(C={}));const f="generationStatus",R="action";function y(e,t){var o,i,n;const r=null===(o=t.targetDocument)||void 0===o?void 0:o.reportFile;let a="",s="",d=void 0;const l=v.ReportStatus[null===(i=t.generation)||void 0===i?void 0:i.status];if(!(null===(n=t.generation)||void 0===n?void 0:n.status))return s="hourglass wux-ui-3ds",d=void 0,{label:a=w.loader,icon:{iconName:s,fontIconFamily:1},column:R,id:t.id,func:d};switch(l){case v.ReportStatus.Succeeded:case v.ReportStatus.Completed:r&&r.fileName&&r.fileVersion&&r.id?(s="download wux-ui-3ds",a=w.downloadReport,d=(t=>{var o;return(0,h.executeAction)({action:h.Actions.DOWNLOAD_FILE,reportLibrary:e,settings:e.widgetSettings,report:null===(o=t.context.nodeModel)||void 0===o?void 0:o.options.grid})})):(a=w.generateReport,s="redo wux-ui-3ds",d=(t=>{var o;return(0,h.executeAction)({action:h.Actions.GENERATE_REPORT,reportLibrary:e,settings:e.widgetSettings,report:null===(o=t.context.nodeModel)||void 0===o?void 0:o.options.grid})}));break;case v.ReportStatus.NeedPostEdition:case v.ReportStatus.NeedPostEditionAndWithChanges:s="alert wux-ui-3ds",a=w.postEdit,d=(t=>{var o;return(0,h.executeAction)({action:h.Actions.PROCESS_POST_EDITION,reportLibrary:e,settings:e.widgetSettings,report:null===(o=t.context.nodeModel)||void 0===o?void 0:o.options.grid})});break;case v.ReportStatus.Running:s="stop wux-ui-3ds",a=w.abort,d=(t=>{var o;return(0,h.executeAction)({action:h.Actions.ABORT_REPORT_GENERATION,reportLibrary:e,settings:e.widgetSettings,report:null===(o=t.context.nodeModel)||void 0===o?void 0:o.options.grid})});break;default:a=w.generateReport,s="redo wux-ui-3ds",d=(t=>{var o;return(0,h.executeAction)({action:h.Actions.GENERATE_REPORT,reportLibrary:e,settings:e.widgetSettings,report:null===(o=t.context.nodeModel)||void 0===o?void 0:o.options.grid})})}return{label:a,icon:{iconName:s,fontIconFamily:1},column:R,id:t.id,func:d}}function S(e,t){var o,i,n,r;const a=null==e?void 0:e.getRoots().find(e=>e.options.grid.id===t.id);a&&(e.prepareUpdate(),(null===(i=null===(o=t.generation)||void 0===o?void 0:o.running)||void 0===i?void 0:i.timeExceeded)&&(t.generation.running.timeRemaining=void 0),(null===(r=null===(n=t.generation)||void 0===n?void 0:n.running)||void 0===r?void 0:r.timeRemaining)&&(t.generation.running.timeExceeded=void 0),null==a||a.updateOptions({grid:t}),e.pushUpdate())}async function A(e,t,o,r=0,a=0){const d=[v.ReportStatus.Submitted,v.ReportStatus.Created,v.ReportStatus.Running,v.ReportStatus.Aborted];e&&r<1e3&&(clearInterval(e.timer),e.timer=setTimeout(async()=>{var t,l,c;try{const u=(new s.HeadersBuilder).createHeader(e.libraryManager.webClientOptions.getSecurityContext());let p=e.libraryManager.modelManager.getCollection().getElements();r>0&&(p=p.filter(e=>{var t;return d.includes(v.ReportStatus[null===(t=e.generation)||void 0===t?void 0:t.status])}));const g=[];for(let e=0;e<p.length;e+=10)g.push(p.slice(e,e+10));const m=[],h=[];let C=!1;for(const i of g)try{const r=await n.generationStatus(o,u,i.map(e=>e.id));for(const o of r.reports){const i=p.find(e=>e.id===o.id);if(i){const n=d.includes(v.ReportStatus[null===(t=i.generation)||void 0===t?void 0:t.status]);i.generation=o.generation;const r=d.includes(v.ReportStatus[null===(l=i.generation)||void 0===l?void 0:l.status]);C||(C=r),n||r||null!=i.uptodate||h.push(i),S(e.libraryManager.getModel(),{id:i.id,generation:i.generation,uptodate:null!==(c=i.uptodate)&&void 0!==c&&c,targetDocument:o.targetDocument}),n&&!r&&h.push(i)}}}catch(e){m.push(e)}m.length>0&&a>=5?(console.log(m),i.info(w.failedStatus)):m.length>0?A(e,r<20?2e3:3e4,o,r,a+1):C&&A(e,r<20?5e3:3e4,o,r+1),e.libraryManager.refreshUpToDateStatusInfo(h)}catch(t){clearInterval(e.timer)}},t))}async function b(e,t){const o=new d.WidgetClientFactory,i=await s.service3DSpace(o);return{metaType:p.MetaType.Report,id:t.id,type:t.type,name:t.name,title:t.title,description:t.description,current:t.current,revision:t.revision,owner:t.owner,ownerFullName:t.owner?await s.getPersonFullName(i,(new s.HeadersBuilder).createHeader(o.getSecurityContext()),t.owner):"",template:{id:t.template.id,name:t.template.name,title:t.template.title,type:t.template.type,revision:t.template.revision},outputFormat:{id:t.outputFormat.id,name:t.outputFormat.name,title:t.outputFormat.title,type:t.outputFormat.type,revision:t.outputFormat.revision,filename:t.outputFormat.fileName},inputs:t.inputs,action:t=>{var o,i;if(!(null===(o=t.context.nodeModel)||void 0===o?void 0:o.options.grid))throw console.log("No report found"),Error("No report found");const n=y(e,null===(i=t.context.nodeModel)||void 0===i?void 0:i.options.grid);n.func&&n.func(t)}}}function T(e,t){return e.type.length>0&&t.indexOf(e.type)>=0}return class{constructor(e,t,i,n,s){this.service=n,this.viewManager=t,this.options=e,this.modelManager=new a(g.RGR_REPORTS,new l.RecentsManager("RGR",i),i,s),this.modelManager.setTaggerProxyFilter(new m.ReportTaggerProxyFilter({model:this.modelManager.model,widgetSettings:s},i,this)),this.webClientOptions=i,this.widgetSettings=s,this.modelManager.getModel().setFilterModel({name:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:""},operator:"or",condition2:{type:"contains",filter:""}}},dispType:{filterId:"set"},ownerFullName:{filterId:"set"},revision:{filterId:"set"},current:{filterId:"set"},templateInfo:{filterId:"set"},outputFormatTitle:{filterId:"set"},generationStatus:{filterId:"set"},action:{filterId:"set"}}),o.subscribe({event:"CATRgrReportWizard/closed"},e=>(function(e,t){void 0!==t.report&&(e.addFromIds([t.report.id],!0),e.viewManager.hideWelcomeScreen({view:"REPORT"}))})(this,e)),async function(e){e.serviceUrl=await r.getServiceURL("3DSearch",e.webClientOptions.getTenant())}(this)}getModel(){return this.modelManager.getModel()}getReports(){return this.modelManager.getCollection().getElements()}getSelectedReports(){return this.modelManager.getModel().getSelectedNodes().map(e=>e.options.grid)}async addReports(e,t){var o;e&&(this.modelManager.addToModel(e,this.viewManager.reportViewer.getOptionsForNode(this,this.options),t,this.widgetSettings.dictionaryNls),null===(o=this.modelManager.tagger)||void 0===o||o.addDataToProxy(e))}removeReports(e){const t=this.modelManager.getModel().getRoots().filter(t=>e.find(e=>e==t.options.grid.id));this.modelManager.removeFromModel(t)}async addFromIds(e,t){var o,r,a,d,l,p,g,m;const v=new c(this.widgetSettings.widgetBody.getElement("#reports-container"));v.displayLoader(u.LOADING);const h=await this.widgetSettings.acceptedReportTypes;let C=0;try{const c=10,u=[];for(let t=0;t<e.length;t+=c)u.push(e.slice(t,t+c));const f=(new s.HeadersBuilder).createHeader(this.webClientOptions.getSecurityContext());for(const e of u){const o=await n.getReportsBulkDetails(this.service,f,e),r=o.reports.filter(e=>T(e,h));if(C+=o.reports.length-r.length,this.addReports(await Promise.all(r.map(e=>b(this,e))),t),s.isBulkGetPartialSucessStatus(o.status)){const e=o.status.details.map(e=>`${e.message}: ${e.reference.id}`).concat("\n");i.info(e)}A({libraryManager:this,timer:0},1e3,this.service,0)}C&&i.error(w.missingReportNumber.replace("{0}",C))}catch(e){console.error(e);const t=null!==(m=null!==(g=null!==(d=null===(a=null===(r=null===(o=e.response)||void 0===o?void 0:o.status)||void 0===r?void 0:r.details)||void 0===a?void 0:a.map(e=>`${e.message}: ${e.reference.id}`).concat("\n"))&&void 0!==d?d:null===(p=null===(l=e.response)||void 0===l?void 0:l.status)||void 0===p?void 0:p.message)&&void 0!==g?g:e.message)&&void 0!==m?m:"Failed to get reports";i.error(t)}finally{v.hideLoader()}}async refreshUpToDateStatusInfo(e){if(e.length>0){const t=(new s.HeadersBuilder).createHeader(this.webClientOptions.getSecurityContext()),o=[];for(let t=0;t<e.length;t+=5)o.push(e.slice(t,t+5));for(const e of o){const o=e.map(async e=>this.widgetSettings.asyncExecutor.submit(async()=>{var o;const i=v.ReportStatus[null===(o=e.generation)||void 0===o?void 0:o.status];if(i===v.ReportStatus.Succeeded||i===v.ReportStatus.Completed){const o=n.getStatus(this.service,t,e.id);e.uptodate=(await o).uptodate,S(this.getModel(),{id:e.id,generation:e.generation,uptodate:e.uptodate})}}));(await Promise.allSettled(o)).filter(e=>"rejected"===e.status).map(e=>e.reason)}}}async autoRefresh(e,t,o,i=0,n=0){A(e,t,o,0,0)}updateReportInfos(e){S(this.getModel(),e)}getActionCellValue(e){return y(this,e)}getGenerationStatusCellValue(e){return function(e){var t,o,i,n,r,a,s;const d=null===(t=e.targetDocument)||void 0===t?void 0:t.reportFile,l=null==e?void 0:e.uptodate;let c="",u="";const p=v.ReportStatus[null===(o=e.generation)||void 0===o?void 0:o.status];if(!(null===(i=e.generation)||void 0===i?void 0:i.status))return{icon:"wux-ui-3ds-lg wux-ui-3ds-hourglass wux-ui-3ds",label:w.loader,column:f,id:e.id};switch(p){case v.ReportStatus.None:u="wux-ui-3ds-lg wux-ui-3ds-wrong wux-ui-3ds",c=w.noGeneration;break;case v.ReportStatus.Succeeded:case v.ReportStatus.Completed:d&&d.fileName&&d.fileVersion&&d.id?l?(c=w.generationCompleted,u="wux-ui-3ds-lg wux-ui-3ds-check wux-ui-3ds"):(c=w.notUptodate,u="wux-ui-3ds-lg wux-ui-3ds-exchange wux-ui-3ds"):(u="wux-ui-3ds-lg wux-ui-3ds-error wux-ui-3ds",c=w.noGeneration);break;case v.ReportStatus.NeedPostEdition:case v.ReportStatus.NeedPostEditionAndWithChanges:u="wux-ui-3ds-lg wux-ui-3ds-alert wux-ui-3ds",c=w.needPostEdition;break;case v.ReportStatus.Aborted:u="wux-ui-3ds-lg wux-ui-3ds-error wux-ui-3ds",c=w.aborted;break;case v.ReportStatus.Failed:u="wux-ui-3ds-lg wux-ui-3ds-error wux-ui-3ds",c=w.failed;break;case v.ReportStatus.Created:case v.ReportStatus.Submitted:c="Completed"!==(null===(n=e.generation)||void 0===n?void 0:n.message)&&""!==(null===(r=e.generation)||void 0===r?void 0:r.message)?null!==(s=null===(a=e.generation)||void 0===a?void 0:a.message)&&void 0!==s?s:"":w.running,u="wux-ui-3ds-lg wux-ui-3ds-transportation-walk wux-ui-3ds";break;case v.ReportStatus.Running:}return{icon:u,label:c,column:f,id:e.id}}(e)}}}),define("DS/CATRgrApp/RgrWidgetSettings",["require","exports","DS/CATRgnWidgetCommons/RgnWidgetSettings","DS/CATRgnWidgetCommons/restClient/DictionnaryServices","DS/CATRgrApp/utils/RGRConstants"],function(e,t,o,i,n){"use strict";async function r(e,t){const o=await i.getTypeInfo([t],e);return Object.keys(o)}return class extends o{constructor(e){super(),this.acceptedReportTypes=r(e,"CATReportReference"),this.acceptedOFTypes=r(e,"Report Template")}getDisplaySettings(){return this.widget.getValue(n.RGR_DISPLAY_VIEW)}setDisplaySettings(e){this.widget.setValue(n.RGR_DISPLAY_VIEW,e)}}}),define("DS/CATRgrApp/utils/JobMonitoringUI",["require","exports","DS/TreeModel/TreeDocument","DS/CATRgnWidgetCommons/TableView","DS/UIKIT/SuperModal","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","UWA/Core","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/restClient/InternalServices","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgnWidgetCommons/restClient/InternalServices","DS/CATRgrApp/utils/GenerationProgressBar"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobMonitoringWidget=void 0;t.JobMonitoringWidget=class{constructor(e,t){this.model=new o({useAsyncPreExpand:!0}),this.modal=new n({renderTo:e.widgetSettings.widgetBody,className:"JobMonitoringModal",closable:!0,escapeToClose:!0,overlay:!0}),this.widgetSettings=e.widgetSettings,this.service=e.reportLibrary.service,this.headers=t;const s={columns:function(e){return[{text:r.name,dataIndex:"tree",typeRepresentation:"url",editableFlag:!1,width:100,getCellValue:e=>{var t;return{label:null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.name,icon:"task"}}},{text:r.startDate,dataIndex:"start",width:160,editableFlag:!1},{text:r.owner,dataIndex:"owner",editableFlag:!1},{text:r.state,dataIndex:"current",editableFlag:!1,width:80},{text:r.progress,dataIndex:"progress",editableFlag:!1,reportLibrary:e.reportLibrary,width:200,onCellRequest:function(t){var o;const i=new a.Element("div",{class:"statusGenerationContainer"});i.setAttribute("style","display : flex"),(0,m.showProgressBar)({container:i,progress:Number(null===(o=t.nodeModel)||void 0===o?void 0:o.options.grid.progress),reportViewer:e}),t.cellView.getContent().setContent(i)}},{text:r.reportInfos,dataIndex:"reportInfos",editableFlag:!1},{text:r.action,dataIndex:"action",width:100,typeRepresentation:"function",editionPolicy:"EditionInPlace",editableFlag:!1,showTextFlag:!1,pinned:"right",className:"actionColumn",getCellSemantics(e){var t,o,i,n;return(null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.reportInfos)&&(null===(o=e.nodeModel)||void 0===o?void 0:o.options.grid.reportInfos.length)>0?{label:r.abort,icon:{iconName:"stop wux-ui-3ds",fontIconFamily:1},id:null===(i=e.nodeModel)||void 0===i?void 0:i.options.grid.id}:{label:"",id:null===(n=e.nodeModel)||void 0===n?void 0:n.options.grid.id}}}]}(e),identifier:"JobMonitoringView",defaultColumnDef:{editableFlag:!1},showContextualMenuColumnFlag:!1,treeDocument:this.model,cellDragEnabledFlag:!1,workbenchName:"CATRgrWebApp",workbenchModule:"CATRgrApp",model:this.model};this.tableView=new i(this.model,s,e.widgetSettings,!1,!1),this.modal.dialog({title:r.jobMonitoring,body:this.tableView,closable:!0,buttons:[{value:r.close,action:function(e){e.hide()}}]})}async displayJobs(){try{const e=await this.getJobs();e&&(this.addToModel(e,{}),this.refreshMonitoring())}catch(e){console.log(e)}}async addToModel(e,t){this.model.prepareUpdate();let o=[];o=e.map(e=>new s.ModelElement(e,t,new d.WidgetClientFactory).getNode()),this.model.addChild(o),this.model.pushUpdate()}updateJobs(e){for(const t of this.model.getRoots()){const o=e.find(e=>e.id==t.options.grid.id);o?t.updateOptions({grid:{progress:o.progress}}):t.remove()}}addNewJobs(e){for(const t of e)this.model.getRoots().find(e=>e.options.grid.id==t.id)||this.addToModel([t],{})}async refreshMonitoring(){setTimeout(async()=>{const e=await this.getJobs();e.length>0?(this.updateJobs(e),this.addNewJobs(e),this.refreshMonitoring()):this.model.removeRoots()},5e3)}fromService(e){var t;const o=new Date(e["Start Date"]);return{id:e.physicalid,owner:null!==(t=e.owner)&&void 0!==t?t:"",revision:"",title:e.Title,progress:e["Progress Percent"],start:`${o.toLocaleDateString(this.widgetSettings.language,{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}`,name:e.name,type:"",current:e.current,metaType:p.MetaType.Jobs,description:"",ownerFullName:"",reportInfos:e.reportName&&e.reportExternalId?`${e.reportName} (${e.reportExternalId})`:void 0,reportId:e.reportId,action:e=>{var t,o;(null===(t=e.context.nodeModel)||void 0===t?void 0:t.options.grid.reportId)?l.abortJob(this.service,this.headers,null===(o=e.context.nodeModel)||void 0===o?void 0:o.options.grid.reportId):c.error("Error while stopping the job")}}}async getJobs(){const e=await(0,g.getRunningJobList)(this.service,this.headers,!0),t=await(0,g.getRunningJobList)(this.service,this.headers,!1);for(const o of e){const e=t.find(e=>e.physicalid==o.physicalid);e&&(e.owner&&(o.owner=await u.getPersonFullName(this.service,this.headers,e.owner)),o.reportName=e.reportName,o.reportExternalId=e.reportExternalId,o.reportId=e.reportId)}return e.map(e=>this.fromService(e))}}}),define("DS/CATRgrApp/outputformat/OutputFormatViewer",["require","exports","UWA/Core","DS/ApplicationFrame/CommandsManager","DS/UIKIT/Iconbar","DS/CATRgnWidgetCommons/DisplayManager","DS/RGNServices/Alert","DS/RGNServices/FederatedSearch","DS/CATRgrApp/outputformat/OutputFormatLibrary","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","DS/Controls/TooltipModel","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/OutputFormatServices","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons","DS/CATRgrApp/utils/FileVersionsManagement"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m){"use strict";async function v(e,t,r){const a=new o.Element("header",{class:"toolbar-container"}).inject(t);new o.Element("h3",{html:l.viewOFList,styles:{margin:"10px 30px"}}).inject(a),function(e){e.menu.items.forEach(e=>{if("divider"==e.name)return;const t=e,o=t.elements.container;o.tooltipInfos=new c({allowUnsafeHTMLLongHelp:!0,mouseRelativePosition:!1,position:"bottom"}),o.tooltipInfos.loadFromHelpRscFile("CATRgrApp/help",e.name)})}(new n({renderTo:a,items:function(e,t){return[{name:"Home",fonticon:"home",text:"",handler:()=>{e.viewManager.showWelcomeScreen()}},{name:"CreateOutputFormat",fonticon:"new-create",text:"",handler:()=>{const o=i.getCommand("CreateOutputFormat","CATRgdWebApp");o&&(o.options.ofDisplayer=e.ofDisplayer,o.options.ofLibrary=e.ofLibrary,o.viewManager=e.viewManager,o.widgetSettings=t,o.begin())}},{name:"InsertOutputFormats",fonticon:"search",text:"",handler:()=>{s.search({precond:'type:"Report Template"',multiSel:!0,mode:"furtive"},t=>w(e,t),h)}},{name:"SwitchViewOF",fonticon:"list",text:"",handler:()=>{e.viewManager.switchView({view:"REPORT",content:"noContent"})}}]}(e,r)}))}async function w(e,t){const o=t.map(e=>e.id);e.ofLibrary.addFromIds(o,!0).catch(e=>{a.error(e)})}async function h(){}return class{constructor(e,t,n,a,s){this.viewManager=n,this.service=a,this.widgetSettings=s,this.ofLibrary=new d(this,a,s,t),this.ofDisplayer=new r.QueryDisplayer({...t,model:this.ofLibrary.getModel(),placeholderText:l.ofPlaceholder,placeholderButtonLabel:l.ofPlaceholderButtonLabel,placeholderPrecond:{precond:'type:"Report Template"',multiSel:!0,mode:"furtive"},onFederatedSearchComplete:e=>w(this,e),onFederatedSearchCancel:h,getCellTooltip(e){if(!e.nodeModel)return n.getDisplayer().tableView.getDataGrid().getCellDefaultTooltip(e)},columns:[{text:l.title,description:l.title,dataIndex:"tree",pinned:"left",alwaysVisibleFlag:!0,editionPolicy:"EditionOnDoubleClick",editableFlag:!0,getCellValue:e=>{var t,o,i;return null!==(i=null===(o=null===(t=e.nodeModel)||void 0===t?void 0:t.getAttributeValue)||void 0===o?void 0:o.call(t,"title"))&&void 0!==i?i:""}},{text:l.description,description:l.description,dataIndex:"description",editionPolicy:"EditionOnDoubleClick",editableFlag:!0},{text:l.name,description:l.name,dataIndex:"name",width:100},{text:l.revision,description:l.revision,typeRepresentation:"url",dataIndex:"revision",width:40,getCellValue:e=>{var o,n;return{label:null===(o=e.nodeModel)||void 0===o?void 0:o.options.grid.revision,column:"maturity",id:null===(n=e.nodeModel)||void 0===n?void 0:n.options.grid,func:function(){i.getCommand("Lifecycle_Revision",t.workbenchName).begin()}}}},{text:l.type,description:l.type,dataIndex:"dispType",width:130},{text:l.maturity_state,description:l.maturity_state,dataIndex:"current",width:90,typeRepresentation:"url",getCellValue:e=>{var o,n;return{label:l[`lifeCycle.${null===(o=e.nodeModel)||void 0===o?void 0:o.options.grid.current.toUpperCase()}`],column:"maturity",id:null===(n=e.nodeModel)||void 0===n?void 0:n.options.grid,func:function(){i.getCommand("Lifecycle_Maturity",t.workbenchName).begin()}}}},{text:l.owner,description:l.owner,dataIndex:"ownerFullName"},{text:l.fileName,description:l.fileName,dataIndex:"fileName",getCellValue:e=>{var t;return null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.fileName}},{text:l.fileVersion,description:l.fileVersion,typeRepresentation:"url",dataIndex:"fileVersion",visibleFlag:!1,getCellValue(e){var t,o,i;return{label:null!==(o=null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.fileVersion)&&void 0!==o?o:void 0,id:null===(i=e.nodeModel)||void 0===i?void 0:i.options.grid.id,func:async function(e){var t;const o=null===(t=e.context.nodeModel.options.grid)||void 0===t?void 0:t.id;o&&new m.FileVersionsManagementWidget(o,m.FromView.OutputFormat,s,a).displayVersions()}}}}]},s),this.ofContainer=new o.Element("div",{id:"output-formats-container",class:"main-container"}).inject(e),this.inject(this.ofContainer)}async inject(e){await Promise.all([v(this,e,this.widgetSettings),async function(e,t){const i=new o.Element("main",{class:"displayer-container"}).inject(t);e.ofDisplayer.build(i),e.ofDisplayer.switchView("table")}(this,e)])}getModel(){return this.ofLibrary.getModel()}getLibraryManager(){return this.ofLibrary}getDisplayer(){return this.ofDisplayer}getOptionsForNode(e){return{...e.ofLibrary.options,picture:`${e.ofLibrary.service.url}/snresources/images/icons/large/iconLargeDefault.png`,imageUrl:`${e.ofLibrary.service.url}/common/images/I_RGNReportOutputFormat.png`,contextualActions:["details","delete","upload","download"],getContextualMenu:t=>(function(e,t){return[{id:"details",title:g.INFORMATION,type:"PushItem",icon:"info-open-in-a-new-window",action:{callback:function(){i.getCommand("ENO_Properties",t.workbenchName).begin()}}},{id:"remove",title:g.REMOVE,type:"PushItem",icon:"eye-delete",action:{callback:function(){const o=i.getCommand("RemoveOutputFormat",t.workbenchName);o.outputFormatLibrary=e,o.begin()}}},{id:"upload",title:g.UPLOAD,type:"PushItem",icon:"upload",action:{callback:function(){const o=i.getCommand("UploadOutputFormat",t.workbenchName);o.widgetSettings=t.widgetSettings,o.outputFormatLibrary=e,o.begin()}}},{id:"download",title:g.DOWNLOAD,type:"PushItem",icon:"download",action:{callback:function(){const o=i.getCommand("ExportOutputFormat",t.workbenchName);o.outputFormatLibrary=e,o.begin()}}},{id:"lifecycle",title:g.LIFE_CYCLE,type:"PushItem",icon:"collaborative-lifecycle-management",submenu:[{id:"maturityState",title:g.MATURITY,type:"PushItem",icon:"promote",action:{callback:function(){i.getCommand("Lifecycle_Maturity",t.workbenchName).begin()}}},{id:"ReviseHdr",title:g.REVISE,type:"PushItem",icon:"flow-line-add",action:{callback:function(){i.getCommand("Lifecycle_Revision",t.workbenchName).begin()}}},{id:"DeleteHdr",title:g.DELETE,type:"PushItem",icon:"doc-delete",action:{callback:async function(){const o=e.getModel().getSelectedNodes().map(e=>e.options.grid.id),n=(new u.HeadersBuilder).createHeader(e.webClientOptions.getSecurityContext()),r=await p.areOfsUsed(e.service,n,o);if(-1==Object.values(r).indexOf(!0))i.getCommand("Lifecycle_Delete",t.workbenchName).begin();else{let t="";Object.keys(r).forEach(o=>{const i=e.modelManager.getCollection().getElementById(o);!0===r[o]&&(null==i?void 0:i.title)&&(0!==t.length&&(t+=", "),t+=`${i.title}`)}),a.error(l.ofUsed.replace("${0}",t))}}}},{id:"HistoryHdr",title:g.REVISIONS,type:"PushItem",icon:"flow-tree-ordered",action:{callback:function(){i.getCommand("Lifecycle_History",t.workbenchName).begin()}}}]}]})(e.ofLibrary,t)}}}}),define("DS/CATRgrApp/report/ReportViewer",["require","exports","UWA/Core","DS/ApplicationFrame/CommandsManager","DS/UIKIT/Iconbar","DS/CATRgrApp/report/ReportLibrary","DS/Controls/TooltipModel","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons","DS/CATRgrApp/utils/JobMonitoringUI","DS/TransientWidget/TransientWidget","DS/i3DXCompassPlatformServices/OpenWith","DS/CATRgnWidgetCommons/interfaces/Facade","DS/RGNServices/Alert","DS/RGNServices/FederatedSearch","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/DisplayManager","DS/CATRgnWidgetCommons/utils/RGNConstants","DS/CATRgrApp/report/ReportLibrary","DS/CATRgrApp/utils/FileVersionsManagement","DS/CATRgrApp/utils/GenerationProgressBar"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m,v,w,h,C,f,R){"use strict";const y="CATRTW_AP",S="RGW_BackgroundJobs_UI";function A(e){if(!e)return"";const t=null==(e=(null==e?void 0:e.endsWith(".zip"))?e.slice(0,-4):e)?void 0:e.lastIndexOf(".");return t>=0?null==e?void 0:e.slice(t+1).toUpperCase():""}function b(e,t,i){var n,r,l,c,u,p,g,m;{const C=w.getDataIndex(t);try{if(!t.nodeModel)return e.getCellDefaultTooltip(t);switch(C){case"tree":{const e=t.nodeModel.options.grid,u=e.template,p=e.outputFormat,g=e.inputs,m=e.targetDocument,w=o.createElement("div",{class:"reportTooltip",styles:{width:"auto",height:"auto",margin:"0.1em"}});if(E(i,w,null!==(n=v.getNLSType(e.type,i.dictionaryLoaded))&&void 0!==n?n:"Report",e),E(i,w,null!==(r=u.type)&&void 0!==r?r:v.getNLSType("Report Model",i.dictionaryLoaded),u),E(i,w,null!==(l=p.type)&&void 0!==l?l:v.getNLSType("Report Template",i.dictionaryLoaded),p),E(i,w,null!==(c=null==m?void 0:m.type)&&void 0!==c?c:s.targetDocument,m),g&&i.dictionaryLoaded){const e=o.createElement("p",{class:"inputInfos"}).inject(w);o.createElement("span",{html:`${s.inputs}:`,class:"bold"}).inject(e),g.forEach(async t=>{o.createElement("br").inject(e),o.createElement("span",{html:`  -${t.name} | ${v.getNLSTypeFromInput(t,i.dictionaryLoaded)}`}).inject(e)})}return new a({title:d.details,shortHelp:w,allowUnsafeHTMLShortHelp:!0})}case"templateInfo":{const e=t.nodeModel.options.grid,o=e.template;if(o.type&&o.name&&o.revision&&o.title){let t=`${o.title} | ${v.getNLSType(o.type,i.dictionaryLoaded)} | ${o.name} | ${o.revision}`;if(e.inputs&&e.inputs.length>0){let o=`\n ${s.parameters} :\n`;e.inputs.forEach(e=>o=o.concat(`  -${e.name} : ${v.getNLSType(e.type,i.dictionaryLoaded)}`)),t=t.concat(o)}return new a({title:t})}return}case"generationStatus":return{getAllInformationCB(){var e,o,i,n,r;const a=null!==(i=null===(o=null===(e=t.nodeModel)||void 0===e?void 0:e.options.grid.generation)||void 0===o?void 0:o.message)&&void 0!==i?i:"",s=h.ReportStatus[null===(r=null===(n=t.nodeModel)||void 0===n?void 0:n.options.grid.generation)||void 0===r?void 0:r.status];if(s===h.ReportStatus.Failed||s===h.ReportStatus.Running||s===h.ReportStatus.None)return{model:{title:a,reshowDelay:0}}}};case"action":{const e=h.ReportStatus[null===(p=null===(u=t.nodeModel)||void 0===u?void 0:u.options.grid.generation)||void 0===p?void 0:p.status];let o="";return e!==h.ReportStatus.Succeeded&&e!==h.ReportStatus.Completed||(o=(null===(m=null===(g=t.nodeModel)||void 0===g?void 0:g.getAttributeValue)||void 0===m?void 0:m.call(g,"uptodate"))?s.downloadReport:s.generateReport),e!==h.ReportStatus.None&&e!==h.ReportStatus.Failed||(o=s.generateReport),e!==h.ReportStatus.NeedPostEdition&&e!==h.ReportStatus.NeedPostEditionAndWithChanges||(o=s.postEdit),new a({shortHelp:o})}default:return}}catch(e){return void console.error(e)}}}function T(e,t){const i=(null==e?void 0:e.template).title,n={label:null!=i?i:s.not_found,column:"templateInfo",id:null==e?void 0:e.id};return i&&o.extend(n,{func:async function(){const o={templateToShow:null==e?void 0:e.template.id},i=await v.service3DSpace(t),n=(new v.HeadersBuilder).createHeader(t.getSecurityContext());!0===await v.hasRgdLicense(i,n)?c.showWidget(y,void 0,o):g.error(d.licenseRGDMissing)}}),n}function D(e,t){var o;const n=[{id:"details",title:d.INFORMATION,type:"PushItem",icon:"info-open-in-a-new-window",action:{callback:function(){i.getCommand("ENO_Properties",t.workbenchName).begin()}}},{id:"remove",title:d.REMOVE,type:"PushItem",icon:"eye-delete",tooltip:d.REMOVE_TOOLTIP,action:{callback:function(){const o=i.getCommand("RemoveReport",t.workbenchName);o.viewManager=e.viewManager,o.begin()}}},{id:"edit",title:d.EDIT,type:"PushItem",icon:"pencil",action:{callback:function(){const o=i.getCommand("EditReport",t.workbenchName);o.viewManager=e.viewManager,o.isRGWidget=!0,o.widgetSettings=t.widgetSettings,o.begin()}}},{id:"duplicate",title:d.DUPLICATE,type:"PushItem",icon:"duplicate",tooltip:d.DUPLICATE_TOOLTIP,action:{callback:function(){const o=i.getCommand("DuplicateReport",t.workbenchName);o.viewManager=e.viewManager,o.begin()}}},{id:"download",title:d.DOWNLOAD,type:"PushItem",icon:"download",tooltip:d.DOWNLOAD_TOOLTIP,action:{callback:function(){const o=i.getCommand("ExportReport",t.workbenchName);o.viewManager=e.viewManager,o.begin()}}},{id:"lifecycle",title:d.LIFE_CYCLE,type:"PushItem",icon:"collaborative-lifecycle-management",submenu:async()=>Promise.resolve([{id:"maturityState",title:d.MATURITY,type:"PushItem",icon:"promote",action:{callback:function(){i.getCommand("Lifecycle_Maturity",t.workbenchName).begin()}}},{id:"DeleteHdr",title:d.DELETE,type:"PushItem",icon:"doc-delete",action:{callback:function(){i.getCommand("Lifecycle_Delete",t.workbenchName).begin()}}}])},{id:"generate",options:e,title:d.GENERATE,type:"PushItem",icon:"doc-update",tooltip:d.GENERATE_TOOLTIP,action:{callback:function(){const o=i.getCommand("GenerateReport",t.workbenchName);o.options.libraryManager=e,o.options.displayer=t.displayer,o.begin()}}},{id:"generateWithChanges",options:t,title:d.GENERATE_WITH_CHANGES,type:"PushItem",icon:"doc-update",tooltip:d.GENERATE_TOOLTIP,action:{callback:function(){var o;const n=i.getCommand("GenerateReport",t.workbenchName);n.options.id=null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.id,n.options.withChanges=!0,n.options.libraryManager=e,n.options.displayer=t.displayer,n.begin()}}}];switch(null==t?void 0:t.dataIndex){case"action":case"targetDocument":case"filename":if((null===(o=t.data)||void 0===o?void 0:o.targetDocument)&&1==e.getModel().getSelectedNodes().length){const t=function(e){let t={};const o=e.getModel().getSelectedNodes().map(t=>{const o=null==t?void 0:t.options.grid.targetDocument;return{envId:e.widgetSettings.platformId,serviceId:"3DSpace",contextId:e.webClientOptions.getSecurityContext(),objectId:null==o?void 0:o.id,objectType:null==o?void 0:o.policy,objectTaxonomies:["DOCUMENTS",null==o?void 0:o.policy],displayName:null==o?void 0:o.title,displayType:null==o?void 0:o.policy,path:[{resourceid:null==o?void 0:o.id,type:null==o?void 0:o.policy}]}});return t={protocol:"3DXContent",version:"1.1",source:e.widgetSettings.appId,widgetId:e.widgetSettings.widgetId,data:{items:o}}}(e);t&&n.unshift({id:"openWith",title:d.openWith,type:"PushItem",icon:"open-eye",submenu:async()=>(function(e){return new Promise(t=>{(new u).set3DXContent(e,!0).retrieveCompatibleApps(o=>{const i=[];for(const t of o)i.push({id:t.name,title:t.text,type:"PushItem",icon:t.icon,action:{callback:function(){c.showWidget(t.name,"",{X3DContentId:JSON.stringify(e)})}}});t(i)})}).catch(e=>(g.error(e),[]))})(t)})}}return n}async function M(e,t){const r=new o.Element("header",{class:"toolbar-container"}).inject(t);new o.Element("h3",{html:s.viewReportsList,styles:{margin:"10px 30px"}}).inject(r),function(e){e.menu.items.forEach(e=>{var t;if("divider"==e.name)return;const o=e,i=o.elements.container;i.tooltipInfos=new a({allowUnsafeHTMLLongHelp:!0,mouseRelativePosition:!1,position:"bottom"}),i.tooltipInfos.loadFromHelpRscFile("CATRgrApp/help",null!==(t=e.name)&&void 0!==t?t:"")})}(new n({renderTo:r,items:function(e,t){var o;const n=[{name:"Home",fonticon:"home",text:"",handler:()=>{e.viewManager.showWelcomeScreen()}},{name:"AddReport",fonticon:"plus",text:"",handler:()=>{const e=i.getCommand("CreateReport","CATRgrWebApp");e&&(e.isRGWidget=!0,e.widgetSettings=t,e.begin())}},{name:"InsertReports",fonticon:"search",text:"",handler:()=>{m.search({precond:"CATReportReference",multiSel:!0,mode:"furtive"},t=>F(e,t),()=>void 0)}},{name:"SwitchViewReports",fonticon:"list",text:"",handler:()=>{e.viewManager.switchView({view:"OUTPUT FORMAT",content:"noContent"})}}];"true"==(null!==(o=localStorage.getItem(S))&&void 0!==o?o:"false").toLowerCase()&&n.push({name:"jobMonitoring",fonticon:"progress-bars-windowed",text:"",handler:async()=>{new l.JobMonitoringWidget(e,await v.createHeaders(e.reportLibrary.webClientOptions,!0)).displayJobs()}});return n}(e,e.widgetSettings)}))}async function F(e,t){const o=t.map(e=>e.id);e.reportLibrary.addFromIds(o,!0).catch(e=>{g.error(e)})}function x(){}function E(e,t,i,n){let r;if(n&&e.dictionaryLoaded){const a=o.createElement("p",{}).inject(t);n.name&&n.title&&n.type&&n.revision?(o.createElement("span",{html:`${v.getNLSType(n.type,e.dictionaryLoaded)}: `,class:"bold"}).inject(a),r=`${n.title} | ${v.getNLSType(n.type,e.dictionaryLoaded)} | ${n.revision} | ${n.name}\n`,o.createElement("span",{html:r}).inject(a)):(o.createElement("span",{html:`${s.type_not_found.replace("{type}",i)}: `,class:"bold ObjectNotFound"}).inject(a),o.createElement("span",{html:`${n.id} `,class:"gray"}).inject(a))}}return class{constructor(e,t,n,a,l){this.widgetSettings=a,this.viewManager=t,this.reportLibrary=new r(l,this.viewManager,new p.WidgetClientFactory,n,a),this.reportDisplayer=new w.QueryDisplayer({...l,model:this.reportLibrary.getModel(),placeholderText:s.reportPlaceholder,placeholderButtonLabel:s.reportPlaceholderButtonLabel,placeholderPrecond:{precond:'type:"CATReportReference"',multiSel:!0,mode:"furtive"},onFederatedSearchComplete:e=>F(this,e),onFederatedSearchCancel:x,getCellTooltip:e=>b(t.reportViewer.reportDisplayer.tableView.getDataGrid(),e,a),columns:function(e,t){return[{text:s.title,description:s.title,dataIndex:"tree",pinned:"left",alwaysVisibleFlag:!0,editionPolicy:"EditionOnDoubleClick",editableFlag:!0,getCellValue:e=>{var t,o;return null===(o=null===(t=e.nodeModel)||void 0===t?void 0:t.getAttributeValue)||void 0===o?void 0:o.call(t,"title")}},{text:s.description,description:s.description,dataIndex:"description",editionPolicy:"EditionOnDoubleClick",editableFlag:!0},{text:s.name,description:s.name,dataIndex:"name",width:100},{text:s.revision,description:s.revision,dataIndex:"revision",width:40},{text:s.type,description:s.type,dataIndex:"dispType",width:60},{text:s.maturity_state,description:s.maturity_state,typeRepresentation:"url",dataIndex:"current",width:90,getCellValue:e=>{var o,n;return{label:s[`lifeCycle.${null===(o=e.nodeModel)||void 0===o?void 0:o.options.grid.current.toUpperCase()}`],column:"maturity",id:null===(n=e.nodeModel)||void 0===n?void 0:n.options.grid,func:function(){i.getCommand("Lifecycle_Maturity",t.workbenchName).begin()}}}},{text:s.owner,description:s.owner,dataIndex:"ownerFullName",width:150},{text:s.template,description:s.template,typeRepresentation:"url",dataIndex:"templateInfo",reportLibrary:e.reportLibrary,getCellValue(e){var t;return T(null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid,new p.WidgetClientFactory)}},{text:d.outputFormat,description:s.outputFormat,dataIndex:"outputFormatTitle",typeRepresentation:"string",visibleFlag:!1,getCellValue(e){var t;return A(null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.outputFormat.filename)}},{text:s.targetDocument,description:s.targetDocument,typeRepresentation:"url",dataIndex:"targetDocument",visibleFlag:!1,reportLibrary:e.reportLibrary,getCellValue(e){var t,o,i,n,r,a;return(null===(i=null===(o=null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid)||void 0===o?void 0:o.targetDocument)||void 0===i?void 0:i.reportFile)?{label:null===(n=e.nodeModel)||void 0===n?void 0:n.options.grid.targetDocument.title,id:null===(r=e.nodeModel)||void 0===r?void 0:r.options.grid.id,icon:"survey"}:{label:void 0,id:null===(a=e.nodeModel)||void 0===a?void 0:a.options.grid.id,icon:void 0}}},{text:s.fileName,description:s.fileName,typeRepresentation:"url",dataIndex:"filename",visibleFlag:!1,reportLibrary:e.reportLibrary,getCellValue(e){var t,o,i,n;const r=null===(i=null===(o=null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.targetDocument)||void 0===o?void 0:o.reportFile)||void 0===i?void 0:i.fileName;return{label:r,id:null===(n=e.nodeModel)||void 0===n?void 0:n.options.grid.id,icon:r?"doc-text wux-ui-3ds":void 0}}},{text:s.fileVersion,description:s.fileVersion,typeRepresentation:"url",dataIndex:"fileVersion",visibleFlag:!1,reportLibrary:e.reportLibrary,getCellValue(t){var o,i,n,r,a,s,d,l;return(null===(n=null===(i=null===(o=t.nodeModel)||void 0===o?void 0:o.options.grid.targetDocument)||void 0===i?void 0:i.reportFile)||void 0===n?void 0:n.fileVersion)?{label:null===(s=null===(a=null===(r=t.nodeModel)||void 0===r?void 0:r.options.grid.targetDocument)||void 0===a?void 0:a.reportFile)||void 0===s?void 0:s.fileVersion,id:null===(d=t.nodeModel)||void 0===d?void 0:d.options.grid.id,func:async function(t){var o,i;const n=null===(i=null===(o=t.context.nodeModel.options.grid)||void 0===o?void 0:o.targetDocument)||void 0===i?void 0:i.id;n&&new f.FileVersionsManagementWidget(n,f.FromView.Report,e.widgetSettings,e.getLibraryManager().service).displayVersions()}}:{label:"",id:null===(l=t.nodeModel)||void 0===l?void 0:l.options.grid.id}}},{text:s.generation_status,description:s.generation_status,dataIndex:"generationStatus",reportLibrary:e.reportLibrary,onCellRequest:function(t){var i,n,r,a,s,d;if(!t.nodeModel)throw console.error("Report not found"),new Error("Report not found");const l=null!==(r=null===(n=null===(i=t.nodeModel)||void 0===i?void 0:i.options.grid.generation)||void 0===n?void 0:n.status)&&void 0!==r?r:"",c=e.reportDisplayer.tableView.getDataGrid().reuseCellContent("generationStatus");switch(c.empty(),h.ReportStatus[l]){case h.ReportStatus.Running:(null===(a=t.nodeModel)||void 0===a?void 0:a.options.grid.generation)?((0,R.showProgressBar)({container:c,progress:null===(s=t.nodeModel)||void 0===s?void 0:s.options.grid.generation,reportViewer:e}),t.cellView._updateTooltip(b(e.reportDisplayer.tableView.getDataGrid(),t,e.widgetSettings))):console.warn("error: generation field missing.");break;default:{const i=e.reportLibrary.getGenerationStatusCellValue(null===(d=t.nodeModel)||void 0===d?void 0:d.options.grid);new o.Element("span",{class:i.icon}).inject(c),new o.Element("label",{html:i.label,class:"generationStatusLabel"}).inject(c)}}t.cellView.setReusableContent(c)}},{text:s.action,description:s.action,dataIndex:"action",typeRepresentation:"function",editionPolicy:"EditionInPlace",reportLibrary:e.reportLibrary,editableFlag:!1,showTextFlag:!1,pinned:"right",className:"actionColumn",getCellSemantics(t){var o,i;if(!(null===(o=t.nodeModel)||void 0===o?void 0:o.options.grid))throw console.log("Report not fourd"),Error("Report not fourd");return e.reportLibrary.getActionCellValue(null===(i=t.nodeModel)||void 0===i?void 0:i.options.grid)}}]}(this,l)},a),this.reportsContainer=new o.Element("div",{id:"reports-container",class:"main-container"}).inject(e),this.inject(this.reportsContainer)}async inject(e){await Promise.all([M(this,e),async function(e,t){const i=new o.Element("main",{class:"displayer-container"}).inject(t);e.reportDisplayer.build(i),e.reportLibrary.options.displayer=e.reportDisplayer,e.reportDisplayer.switchView("table")}(this,e)])}getModel(){return this.reportLibrary.getModel()}getLibraryManager(){return this.reportLibrary}getDisplayer(){return this.reportDisplayer}getOptionsForNode(e,t){return{...t,picture:`${e.service.url}/snresources/images/icons/large/I_CDM_Document108x144.png`,imageUrl:`${e.service.url}/common/images/I_RGNReport.png`,contextualActions:["details","delete","edit","download","reload","reloadWithChanges"],titleAttribute:"title",getContextualMenu:t=>D(e,t),getAttributeValueForFiltering(t,o){var i,n;const r=e.modelManager.collection.getElementById(null!==(n=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.id)&&void 0!==n?n:null==t?void 0:t.grid.id);if(!r)throw console.log("Report not found"),Error("Report not found");switch(o){case"current":return s[`lifeCycle.${t.data[o].toUpperCase()}`];case"generationStatus":return e.getGenerationStatusCellValue(r).label;case"action":return(0,C.getActionCellValue)(e,r).label;case"templateInfo":return T(e.modelManager.collection.getElementById(t.data.id),e.webClientOptions).label;case"outputFormatTitle":return A(r.outputFormat.filename);default:return t.data[o]}}}}}}),define("DS/CATRgrApp/utils/RGRViewManager",["require","exports","DS/DataDragAndDrop/DataDragAndDrop","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/restClient/OutputFormatServices","DS/CATRgnWidgetCommons/restClient/DocumentServices","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgrApp/CATRgrWelcomePage","DS/CATRgrApp/utils/UploadUI","DS/CATRgrReportWizard/utils/RGRWizardModes","DS/CATRgnWidgetCommons/ListManager","DS/ApplicationFrame/CommandsManager","DS/CATRgrApp/outputformat/OutputFormatViewer","DS/CATRgrApp/report/ReportViewer","i18n!DS/CATRgrApp/assets/nls/CATRgrApp","UWA/Core","DS/CATRgrApp/utils/RGRConstants"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m,v,w,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGRViewManager=t.processItems=t.createOutputFormatWithFile=t.manageFileDrop=void 0;const C="rgr_welcome_panel",f="REPORT",R="OUTPUT FORMAT",y="HOME PAGE",S=["application/msword","application/zip","application/x-zip-compressed","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/xml","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];async function A(e,t,o){if(t.dataTransfer){const i=t.dataTransfer.files;e.hideWelcomeScreen({view:"OUTPUT FORMAT"});const n=new l.UploadUI(e.getOutputFormatLibraryManager().widgetSettings),r=n.displayUploadUI(e.getOutputFormatLibraryManager().widgetSettings,i);for(let t=0;t<r.length;t++){const i=r[t];if(!i)throw new Error("The selected file is undefined");o.asyncExecutor.submit(()=>b(e,i.file).then(()=>n.updateNode(i.id,!0)).catch(()=>n.updateNode(i.id,!1)))}}else console.error("no file dropped")}async function b(e,t){var o,i,d,l,c;let u=void 0;const p=e.getOutputFormatLibraryManager();if(!t||!S.includes(t.type))throw new Error(`${v.INVALID_FILE_FORMAT}:\n${null==t?void 0:t.type}`);{const e=new s.WidgetClientFactory,g=await a.service3DSpace(e),m=(new a.HeadersBuilder).createHeaderWithCsrfToken(e.getSecurityContext(),await a.getCSRFToken()),v=t.name.lastIndexOf("."),w=-1==v?t.name:t.name.substring(0,v),h=await n.createOutputFormats(g,m,[{title:w,policy:"Report Model"}]);if(u=null===(i=null===(o=h.outputFormats)||void 0===o?void 0:o[0])||void 0===i?void 0:i.id,p.addFromIds([null!==(c=null===(l=null===(d=h.outputFormats)||void 0===d?void 0:d[0])||void 0===l?void 0:l.id)&&void 0!==c?c:""],!0),!u)throw new Error("Error while creating the Output format");{await r.addFileToDocument(g,e.getSecurityContext(),u,t);const o=await n.getOutputFormat(g,m,u),i=p.getModel().getRoots().find(e=>e.options.grid.id===u);null==i||i.updateOptions({grid:{fileName:o.outputFormat.fileName,fileVersion:o.outputFormat.fileVersion}})}}}async function T(e,t,o,i){var n,r;const a=[],d=[],l=[],u=t.acceptedOFTypes,g=t.acceptedReportTypes,m=new s.WidgetClientFactory;for(const e of o){const t=e.objectType,o=e.objectId;(null===(n=await u)||void 0===n?void 0:n.includes(t))?a.push(o):(null===(r=await g)||void 0===r?void 0:r.includes(t))?d.push(o):l.push(e)}if(0===a.length&&0===d.length&&0===l.length)throw new Error(v.INVALID_DATA);if(0===d.length&&0===l.length&&e.showOutputFormats(),0===a.length&&e.showReports(),e.getOutputFormatLibraryManager().addFromIds(a,!1).catch(e=>{console.error(e)}),e.getReportLibraryManager().addFromIds(d,!1).catch(e=>{console.error(e)}),l.length>0){const e=[];let t="";l.forEach(o=>{t="Report Model"===o.objectType?c.RGRWizardModes.DROP_TEMPLATE:c.RGRWizardModes.DROP_OBJECTS,e.push({getID:()=>o.objectId||o.oid,getTenant:()=>m.getTenant(),getLabel:()=>o.displayName,getType:()=>o.objectType})});const o=p.getCommand("ReportWizard",i.workbenchName);o.options.userSelection=e,o.options.mode=t,o.options.isRGWidget=!0,o.begin()}}let D;t.manageFileDrop=A,t.createOutputFormatWithFile=b,t.processItems=T;const M=window.document;t.RGRViewManager=class{constructor(e,t,o,i){this.widgetDiv=e,this.widgetSettings=t,this.context=o,this.welcomeContext=new d.WelcomePageContext(t,this,i)}async buildUI(){var e,t;const{widgetDiv:n,context:r,widgetSettings:l}=this,c=await async function(e){return w.createElement("div",{class:C,id:C,styles:{height:"100%",width:"100%"}}).inject(e)}(n);o.droppable(c,{drop:(e,t,o)=>(async function(e,t,o,n,r,a){try{if(n.length>0){const i=JSON.parse(n);i.data&&i.data.items?T(t,o,i.data.items,e):i.objects&&T(t,o,i.objects,e)}else A(t,a,o)}catch(e){i.error(e||"Invalid data")}finally{r.classList.remove("ondragover")}})(r,this,l,e,t,o)}),await Promise.all([async function(e,t,o,i){const n=await a.service3DSpace(new s.WidgetClientFactory),r=new m(o,t,n,i,e);t.reportViewer=r}(r,this,c,l),async function(e,t,o,i){const n=await a.service3DSpace(new s.WidgetClientFactory),r=new g(o,e,t,n,i);t.ofViewer=r}(r,this,c,l)]),D=await d.createWelcomePage(this.welcomeContext,r),n.appendChild(D.getDOM());const u=M.getElementById(C);u&&(u.style.display="none");const p=l.getValue(h.RGR_DISPLAY_VIEW);if(null===(e=l.getValue)||void 0===e?void 0:e.call(l,"X3DContentId")){const e=function(e){const t=[],o=[],i=["CATReportReference"],n=["Report Template"];return e.data.items.filter(e=>i.indexOf(e.objectType)>-1).forEach(e=>t.push(e.objectId)),e.data.items.filter(e=>n.indexOf(e.objectType)>-1).forEach(e=>o.push(e.objectId)),{reports:t,ofs:o}}(JSON.parse(null===(t=l.getValue)||void 0===t?void 0:t.call(l,"X3DContentId")));this.reportViewer.getLibraryManager().addFromIds(e.reports,!0),this.ofViewer.getLibraryManager().addFromIds(e.ofs,!0),this.hideWelcomeScreen({view:e.reports.length>=e.ofs.length?f:R})}else null!=p&&"welcomePage"!=p?p===h.OF_TABLE?this.hideWelcomeScreen({view:R}):p===h.REPORT_TABLE&&this.hideWelcomeScreen({view:f}):l.setValue(h.RGR_DISPLAY_VIEW,h.WELCOME_PAGE)}homePageSearch(e){T(this,this.widgetSettings,e,this.context)}showPlaceholder(){this.ofViewer.ofContainer.hidden=!0,this.reportViewer.reportsContainer.hidden=!0,this.currentViewer=this.reportViewer}showReportTable(){this.ofViewer.ofContainer.hidden=!0,this.reportViewer.reportsContainer.hidden=!1,this.currentViewer=this.reportViewer}showOutputFormatTable(){this.reportViewer.reportsContainer.hidden=!0,this.ofViewer.ofContainer.hidden=!1,this.currentViewer=this.ofViewer}hideWelcomeScreen(e){D&&D.hide();const t=M.getElementById(C);t&&(t.style.display="block"),this.switchView(e)}showWelcomeScreen(){const e=M.getElementById(C);D&&D.show(),d.setMRU(this.welcomeContext,D),this.widgetSettings.setValue(h.RGR_DISPLAY_VIEW,h.WELCOME_PAGE),e&&(e.style.display="none")}switchView(e){switch(e.view){case f:this.showReports(),this.widgetSettings.setValue(h.RGR_DISPLAY_VIEW,h.REPORT_TABLE);break;case R:this.showOutputFormats(),this.widgetSettings.setValue(h.RGR_DISPLAY_VIEW,h.OF_TABLE);break;case y:default:this.showPlaceholder()}}async showReports(){var e,t;this.showReportTable();const o=this.getReportDisplayer().model.getRoots().length;if(null===(e=this.ofViewer.ofLibrary.modelManager.tagger)||void 0===e||e._proxy.deactivate(),null===(t=this.reportViewer.reportLibrary.modelManager.tagger)||void 0===t||t._proxy.activate(),!o){const e=await this.widgetSettings.listManager.getList(u.RGR_REPORTS,this.widgetSettings);e&&e.length&&await this.reportViewer.reportLibrary.addFromIds(e,!1)}}async showOutputFormats(){var e,t;this.showOutputFormatTable();const o=this.getOutputFormatDisplayer().model.getRoots().length;if(null===(e=this.reportViewer.reportLibrary.modelManager.tagger)||void 0===e||e._proxy.deactivate(),null===(t=this.ofViewer.ofLibrary.modelManager.tagger)||void 0===t||t._proxy.activate(),!o){const e=await this.widgetSettings.listManager.getList(u.RGR_OUTPUFORMATS,this.widgetSettings);e&&e.length&&this.ofViewer.ofLibrary.addFromIds(e,!1)}}getModel(){var e;return null===(e=this.currentViewer)||void 0===e?void 0:e.getModel()}getLibraryManager(){return this.currentViewer.getLibraryManager()}getDisplayer(){return this.currentViewer.getDisplayer()}getOutputFormatLibraryManager(){return this.ofViewer.getLibraryManager()}getOutputFormatDisplayer(){return this.ofViewer.getDisplayer()}getReportLibraryManager(){return this.reportViewer.getLibraryManager()}getReportDisplayer(){return this.reportViewer.getDisplayer()}}}),define("DS/CATRgrApp/CATRgrApp",["require","exports","module","DS/Logger/Logger","DS/ApplicationFrame/ActionBar","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/LifecycleCmd/MessageMediator","DS/PADUtils/PADContext","DS/PADUtils/PADCommandProxy","UWA/Core","DS/CATRgrApp/utils/RGRViewManager","DS/RGNServices/FederatedSearch","DS/CATRgnWidgetCommons/skeleton/SkeletonHelper","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgrApp/RgrWidgetSettings","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/CATRgnWidgetCommons/restClient/OutputFormatServices","DS/WebUAUtils/WebUAUtils","DS/CATRgnWidgetCommons/LoaderManager","i18n!DS/CATRgrApp/assets/nls/CATRgrApp"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m,v,w,h,C,f,R){"use strict";const y=i.getLogger(o),S="CATRgrWebApp";async function A(e){const t=l.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}}),o=new f(t);o.displayLoader(R.loader);try{const i=new g.WidgetClientFactory;await b(i,e);const u={workbenchName:S,workbenchModule:"CATRgrApp"};e.widgetSettings.widgetBody.empty(),await Promise.all([async function(){r.addCredentialPreferenceToWidget({usePreferredCredentials:!0},1)}(),async function(e,t,o,i){try{const r=new p({hideLeftPanel:!0,hideRightPanel:!0,hideNavigationBar:!0,hideIDCard:!0,hideStatusBar:!0});r.setCenterContent(t),r.getSkeleton().inject(e.widgetSettings.widgetBody),e.viewManager=new c.RGRViewManager(t,e.widgetSettings,o,i),await e.viewManager.buildUI(),await Promise.all([async function(e){d.create({events:{onRefresh:async function(t){(function(e){return"string"==typeof e})(t)||l.is(t.authored.deleted,"array")&&t.authored.deleted.length>0&&t.authored.deleted.map(t=>{const o=e.viewManager.getModel(),i=o.getRoots().find(e=>e._options.grid.id===t);void 0!==i&&o.removeRoot(i)});const o=l.is(t,"object")?t:JSON.parse(t),i=o.authored,n=e.viewManager.getModel().getSelectedNodes(),r=n.map(e=>{var t;return null===(t=e.getAttributeValue)||void 0===t?void 0:t.call(e,"id")}),a=n.map(e=>{var t;return null===(t=e.getAttributeValue)||void 0===t?void 0:t.call(e,"dispType")}),s=Object.values(a).every(e=>"Report"===e);if(JSON.stringify(i.modified.sort())===JSON.stringify(r.sort())&&i&&i.modified){const t=(new m.HeadersBuilder).createHeader((new g.WidgetClientFactory).getSecurityContext());let o,i;o=s?await(0,w.getReportsBulkDetails)(e.viewManager.getLibraryManager().service,t,r):await(0,h.getOutputFormatsBulk)(e.viewManager.getLibraryManager().service,t,r),n.forEach(async e=>{s&&"reports"in o?i=o.reports.find(t=>t.id===e.options.grid.id):!s&&"outputFormats"in o&&(i=o.outputFormats.find(t=>t.id===e.options.grid.id)),e.updateOptions({grid:{title:null==i?void 0:i.title}})})}}}})}(e),async function(e){a.addEvent("onModification",t=>{const o=e.viewManager.getOutputFormatLibraryManager(),i=e.viewManager.getReportLibraryManager();t.deleted.length>0&&t.deleted.forEach(e=>{const t=o.getModel().getRoots().find(t=>t.options.grid.id===e.physicalid);t&&o.getModel().removeRoot(t);const n=i.getModel().getRoots().find(t=>t.options.grid.id===e.physicalid);n&&i.getModel().removeRoot(n)});t.created.length>0&&t.created.forEach(t=>{const n=o.getModel().getRoots().find(e=>e.options.grid.id===t.sourceObjectId);n&&e.viewManager.getLibraryManager().addFromIds([t.physicalid],!0);const r=i.getModel().getRoots().find(e=>e.options.grid.id===t.sourceObjectId);r&&e.viewManager.getLibraryManager().addFromIds([t.physicalid],!0)});t.modified.length>0&&t.modified.forEach(e=>{if("Promote"===e.operation){const t=o.getModel().getRoots().find(t=>t.options.grid.id===e.physicalid);null==t||t.updateOptions({grid:{current:e.state}});const n=i.getModel().getRoots().find(t=>t.options.grid.id===e.physicalid);null==n||n.updateOptions({grid:{current:e.state}})}})})}(e)]),C.setPanelHelpMode({container:t}),function(e){const t=e.viewManager,o={getSelectedNodes:()=>{var e,o;const i=t.getModel();return null!==(o=null===(e=null==i?void 0:i.getSelectedNodes())||void 0===e?void 0:e.map(e=>{var t,o;return{getID:()=>{var t;return null===(t=e.getAttributeValue)||void 0===t?void 0:t.call(e,"id")},getTenant:()=>(new g.WidgetClientFactory).getTenant(),getDisplayName:()=>{var t;return null===(t=null==e?void 0:e.getAttributeValue)||void 0===t?void 0:t.call(e,"title")},getLabel:()=>{var t;return null===(t=null==e?void 0:e.getAttributeValue)||void 0===t?void 0:t.call(e,"title")},object:{revision:null===(t=null==e?void 0:e.getAttributeValue)||void 0===t?void 0:t.call(e,"revision"),type:null===(o=null==e?void 0:e.getAttributeValue)||void 0===o?void 0:o.call(e,"type")}}}))&&void 0!==o?o:[]},getSecurityContext:()=>{const e=(new g.WidgetClientFactory).getSecurityContext();return{SecurityContext:e}},getPADTreeDocument:()=>t.getModel(),addEvent:(e,t)=>{console.debug("RgrApp eventListener",e,t)},getEditMode:()=>!0,options:{arguments:[]}};s.set(o)}(e),new n({file:`${S}.xml`,module:"CATRgrApp"})}catch(e){console.error(e),alert(e)}}(e,t,u,i)])}catch(e){console.error("initialization failed",e)}finally{o.hideLoader()}}async function b(e,t){try{t.widgetSettings=new v(e),await t.widgetSettings.loadDictionary()}catch(e){y.debug("AcceptedTypes not initialized",e),t.widgetSettings.acceptedOFTypes=Promise.resolve(["Report Template"]),t.widgetSettings.acceptedReportTypes=Promise.resolve(["CATReportReference"])}}return class{constructor(){this.init()}async init(){const e=new g.WidgetClientFactory;var t;await b(e,this),(t=this).widgetSettings.addEvent("onLoad",()=>{A(t)}),t.widgetSettings.addEvent("onRefresh",()=>{t.widgetSettings.widgetBody.empty(),A(t)}),t.widgetSettings.addEvent("onSearch",e=>{t.viewManager.getDisplayer().searchInWidget(e)}),t.widgetSettings.addEvent("onResetSearch",()=>{t.viewManager.getDisplayer().resetSearchInWidget()}),m.listenLifeCycleEvents(t.widgetSettings.widgetId,"RGR"),u.init(this.widgetSettings.widgetId,!0),this.widgetSettings.onDestroy=(()=>{u.destroy()})}}}),define("DS/CATRgrApp/CATRgrWelcomePage",["require","exports","UWA/Core","DS/WelcomeScreenView/WelcomeScreen","DS/WelcomeScreenView/WelcomeScreenButtonController","DS/WelcomeScreenView/WelcomeScreenMRUController","DS/ApplicationFrame/CommandsManager","DS/WebappsUtils/WebappsUtils","i18n!DS/CATRgrApp/assets/nls/WelcomePage","DS/RGNServices/Alert","DS/CATRgrApp/utils/RGRViewManager","DS/RGNServices/FederatedSearch","DS/CATRgnWidgetCommons/RecentsManager","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgrApp/utils/RGRViewManager","DS/WebUAUtils/WebUAUtils"],function(e,t,o,i,n,r,a,s,d,l,c,u,p,g,m,v){"use strict";function w(e,t,o){t.setMRU({items:o,controller:new r({simpleHit:!0,onHit(t){!async function(e,t){switch(t.custom.rgnRecentKind){case g.MetaType.OutputFormat:await e.viewManager.ofViewer.ofLibrary.addFromIds([t.id],!0),e.viewManager.hideWelcomeScreen({view:"OUTPUT FORMAT"});break;default:console.warn("Unexpected recent kind",t.id,t.custom.rgnRecentKind),l.info("Unexpected recent item");case g.MetaType.Report:await e.viewManager.reportViewer.reportLibrary.addFromIds([t.id],!0),e.viewManager.hideWelcomeScreen({view:"REPORT"})}}(e,t)}})})}async function h(e,t){try{w(e,t,[]);const o="RGR",i=[g.MetaType.Report,g.MetaType.OutputFormat],{withFacets:n,withoutFacets:r}=await new p.RecentsManager(o,e.webClientOptions).loadItemsWithFacets(i);r.length>1&&console.warn(`Cannot load details for ${o} recents`,r),w(e,t,n.map(e=>({id:e.id,title:e.title,modified:e.modified,type:e.type,image:function(e){switch(e){case g.MetaType.Report:return s.getWebappsAssetUrl("CATRgrApp","images/Report160x120.png");case g.MetaType.OutputFormat:return s.getWebappsAssetUrl("CATRgrApp","images/ReportOutputFormat160x120.png");default:throw new Error("Unexpected recent type")}}(e.kind),custom:{tooltip:[{key:"Type",value:e.dispType}],rgnRecentKind:e.kind}})))}catch(e){console.error("Failed to load recents",e),l.error("Failed to load recents")}}Object.defineProperty(t,"__esModule",{value:!0}),t.createWelcomePage=t.WelcomePageContext=t.setMRU=void 0,t.setMRU=h;const C=async function(e,t){if(o.is(t,"array")&&t.length>0){const o=t.map(e=>e.id),i=e.viewManager.getReportLibraryManager();try{await i.addFromIds(o,!0)}catch(e){console.error("Failed to add object from ids",e),l.error(e)}e.viewManager.hideWelcomeScreen({view:"REPORT"})}};async function f(){}t.WelcomePageContext=class{constructor(e,t,o){this.viewManager=t,this.webClientOptions=o,this.widgetSettings=e}},t.createWelcomePage=async function(e,t){const{viewManager:o,widgetSettings:r}=e,p=new i({title:d.get("WelcomeScreen.Title"),subtitle:" ",background:s.getWebappsAssetUrl("CATRgrApp","images/CATRGW_AP_LandingPage.jpg"),linksCategories:[{id:"ContentAndKnowledge",i18n:{title:d.get("WelcomeScreen.linksCategories.ContentAndKnowledge")},links:[{id:"UserAssistance",i18n:{title:d.get("WelcomeScreen.ContentAndKnowledge.linkText")},icon:"i-question",url:v.getHelpFullPath("CATRgwUserMap/CATRgw-c-ov.htm")},{id:"WhatsNew",i18n:{title:d.get("WelcomeScreen.WhatsNew.linkText")},icon:"i-question",url:v.getEmbeddedHelpFullPath("WNApps/CATRGW_AP-index.html")}]},{id:"SocialNetworks",i18n:{title:d.get("WelcomeScreen.linksCategories.SocialNetworks")},links:[{id:"Communities",i18n:{title:d.get("WelcomeScreen.SocialNetworks.linkText")},icon:"topbar-users",url:"https://r1132100503382-eu1-3dswym.3dexperience.3ds.com/#community:6"}]}],buttons:{items:[{id:"AddReport",i18n:{title:d.get("WelcomeScreen.Buttons.AddReport")},icon:"plus",controller:new n({onAction:async function(){const e=a.getCommand("CreateReport","CATRgrWebApp");e.widgetSettings=r,e.isRGWidget=!0,e.begin()}})},{id:"OpenReport",i18n:{title:d.get("WelcomeScreen.Buttons.Open")},icon:"folder-open",controller:new n({onAction:()=>(function(e){return u.search({precond:'flattenedtaxonomies:"types/CATReportReference"',multiSel:!0,mode:"furtive"},t=>C(e,t),f),Promise.resolve()})(e)})},{id:"MyReports",i18n:{title:d.get("WelcomeScreen.Buttons.Reports")},icon:"view-list",controller:new n({onAction:async()=>{o.hideWelcomeScreen({view:"REPORT"})}})},{id:"MyOutputFormats",i18n:{title:d.get("WelcomeScreen.Buttons.OutputFormats")},icon:"view-list",controller:new n({onAction:async()=>{o.hideWelcomeScreen({view:"OUTPUT FORMAT"})}})}]},dragAndDrop:{callbacks:{onDragEnter:()=>Promise.resolve(),onDrop:async e=>{var i,n;const a=(null===(i=e.dataTransfer)||void 0===i?void 0:i.getData("text"))||(null===(n=e.dataTransfer)||void 0===n?void 0:n.getData("text/searchitems"));try{if(a&&a.length>0){const e=JSON.parse(a);e.data&&e.data.items?c.processItems(o,r,e.data.items,t):e.objects&&c.processItems(o,r,e.objects,t);const i=e.data.items[0].objectType;"CATReportReference"==i?o.hideWelcomeScreen({view:"REPORT"}):"Report Template"==i&&o.hideWelcomeScreen({view:"OUTPUT FORMAT"})}else(0,m.manageFileDrop)(o,e,r)}catch(e){l.error(e||"Invalid data")}}}}});return await h(e,p),p}});