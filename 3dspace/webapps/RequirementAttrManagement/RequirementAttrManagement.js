define("DS/RequirementAttrManagement/views/actions/RemoveAttributesHandler",[],function(){"use strict";return{execute:function(e){require(["DS/TraceableRequirementsUtils/utils/RequirementAlertManager","i18n!DS/RequirementAttrManagement/assets/nls/RequirementAttrManagement.json"],function(t,n){let i=e,o=i.options.attrModel.getSelectedNodes();if(Array.isArray(o)&&1===o.length){let t=o[0];if(t.options.grid.layout&&!1===t.options.grid.layout.removable)return;e.options.attrModel.removeRoot(t)}i.options.attrModel.withTransactionUpdate(function(){for(const e of o)if(e.options.grid.layout&&!1===e.options.grid.layout.removable){e.unselect();let i=n.replace(n.attributesCustomization.cannotRemove,{attr:e.getReferenceValue("attrTitle")});t.warningAlert(i)}else i.options.attrModel.removeRoot(e)})})}}}),define("DS/RequirementAttrManagement/views/AttributesContants",[],function(){"use strict";return{COLUMNS_EXPORT:"export",TOOLBAR_ACTION_MORE_ATTRIBUTES:"moreAttributes",TOOLBAR_ACTION_DIVISER:"diviser",TOOLBAR_ACTION_MOVE_UP:"moveUp",TOOLBAR_ACTION_MOVE_DOWN:"moveDown",TOOLBAR_ACTION_MOVE_TOP:"moveFirst",TOOLBAR_ACTION_MOVE_BOTTOM:"moveLast",TOOLBAR_ACTION_CHANGE_COLOR:"changeColor",TOOLBAR_ACTION_REMOVE:"trash",TOOLBAR_DEFAULT_ACTIONS:["moreAttributes","diviser","trash"]}}),define("DS/RequirementAttrManagement/views/private/WizardSteps",["text!DS/RequirementAttrManagement/assets/templates/WizardSteps.html","css!DS/RequirementAttrManagement/RequirementAttrManagement.css","i18n!DS/RequirementAttrManagement/assets/nls/RequirementAttrManagement.json","UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars","DS/Core/Core","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,o,s,a,r){"use strict";var l=s.compile(e);return s.registerHelper("getlabel",function(e){for(var t=require("i18n!"+this.label.file),n=this.label.key.split("."),i=t,o=0;o<n.length;o++)i=i[n[o]];return i}),o.extend({name:"enx-wizard-container",defaultOptions:{subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeStep:null},init:function(e){this._parent(e),this.elements.container=i.createElement("div",{class:this.getClassNames()}),this.options.steps&&this.elements.container.setContent(l(this.options.steps)),this.options.renderTo&&this.elements.container.inject(this.options.renderTo),this.options.rope=this.elements.container.getElement("div.enx-wizard-rope"),this.options.navigator=this.elements.container.getElement("nav.enx-view-navigator");var t=this.elements.container.getElement("a.nav-item.active");if(t){var n=t.id;this._render2ActiveStep(n)}for(var o=this,s=this.options.navigator.getElements("a"),a=0;a<s.length;a++)s[a].addEventListener("click",function(e){var t=e.currentTarget.id;o.changeStep(t)});this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/changeStep"},function(e){var t=e.stepId;o.changeStep(t)}))},changeStep:function(e){this._render2ActiveStep(e),this.options.modelEvents.publish({event:"ENXViews/WizardSteps/stepChanged",data:{stepId:e}})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this._parent()},_render2ActiveStep:function(e){for(var t,n=this.options.navigator.getElements("a"),i=!1,o=0;o<n.length;o++){var s=n[o];if(!1===i?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===this.options.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");s.getElement(".view-icon.enx-icon");var a="100%";o<n.length-1&&(a=Math.floor(100/(n.length+1))*(o+1)+"%"),this.options.rope.setStyles({width:a,height:"2px"}),t=s.id,i=!0}}this.options.activeView=t}})}),define("DS/RequirementAttrManagement/views/private/SearchInput",["css!DS/RequirementAttrManagement/RequirementAttrManagement","i18n!DS/RequirementAttrManagement/assets/nls/RequirementAttrManagement.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Event","DS/Controls/ButtonGroup","DS/Controls/Button"],function(e,t,n,i,o,s,a,r){"use strict";return i.extend(o,{name:"enx-search-input",init:function(e){this._parent(e);this.elements.container=UWA.createElement("div",{class:this.getClassNames(e.className?e.className:"")}),this.elements.inner=UWA.createElement("div",{class:this.getClassNames("-inner")}).inject(this.elements.container);var n=UWA.createElement("div",{class:this.getClassNames("-input-container")}).inject(this.elements.inner);this.elements.input=UWA.createElement("input",{class:this.getClassNames("-input"),type:"text",placeholder:this.options.placeholder?this.options.placeholder:t.searchInput.placeholder}).inject(n);var i=UWA.createElement("div",{class:this.getClassNames("-right")}).inject(this.elements.inner),o=UWA.createElement("div",{class:this.getClassNames("-clear")+this.getClassNames("-btn")}).inject(i);this.elements.clearBtn=UWA.createElement("div",{class:this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clear"),title:t.searchInput.clear}).inject(o),this.elements.clearBtn.hide();var s=UWA.createElement("div",{class:this.getClassNames("-search")+this.getClassNames("-btn")}).inject(i);this.elements.searchBtn=UWA.createElement("div",{class:this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search"),title:t.searchInput.search}).inject(s),this.elements.searchBtn.setStyle("opacity","0.1"),this.elements.searchBtn.addEventListener("click",this._onSearch.bind(this)),this.elements.clearBtn.addEventListener("click",this._onClearSearch.bind(this)),this.elements.input.addEventListener("keyup",this._onSearchInputKeyUp.bind(this)),this.elements.input.addEventListener("paste",this._onSearchInputPaste.bind(this)),this.elements.input.addEventListener("keydown",this._onSearchInputKeyDown.bind(this))},clear:function(e){this._onClearSearch(null,e)},_onSearch:function(e){this.elements.input.blur(),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onClearSearch:function(e,t){this.elements.input.value="",this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),!0!==t&&this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onSearchInputKeyUp:function(e){this.elements.input.value?(this.elements.searchBtn.setStyle("opacity","1"),this.elements.clearBtn.setStyle("display","inline-block"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})):(this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value}))},_onSearchInputPaste:function(e){var t=this;setTimeout(function(){t._onSearchInputKeyUp()}.bind(this),200)},_onSearchInputKeyDown:function(e){"return"!==s.whichKey(e)&&"Enter"!==e.keyIdentifier&&"return"!==e.keyIdentifier||this._onSearch(),s.stopPropagation(e)}})}),define("DS/RequirementAttrManagement/views/AttributesCommons",["i18n!DS/RequirementAttrManagement/assets/nls/RequirementAttrManagement.json","UWA/Core","DS/TreeModel/TreeNodeModel"],function(e,t,n){"use strict";let i={specificColumns:["selection","hide_show","find_in_ctx","instanceName","instanceMatrix","thumbnail"],dumpProp:{properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){let e={property:"text",value:void 0};return(void 0===this.options.grid.hasTitle||this.options.grid.hasTitle)&&(e.value=this.options.grid.attrTitle),e},function(){return{property:"dataIndex",value:this.options.columnIndex}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"attrDim",value:this.options.grid.attrDim}},function(){return{property:"provider",value:this.options.grid.provider}},function(){return{property:"attrUnit",value:this.options.grid.attrUnit}},function(){return{property:"ds6w",value:this.options.grid.attrName}},function(){return{property:"hasNLS",value:void 0===this.options.grid.hasTitle||this.options.grid.hasTitle}},function(){return{property:"noTitleColumn",value:void 0!==this.options.grid.hasTitle&&!this.options.grid.hasTitle}},function(){return{property:"kind",value:this.options.kind}},function(){return{property:"ds6wFrom",value:"Instance"===this.options.grid.attrParent?"rel":void 0}},function(){return{property:"isAdditionalColumn",value:this.options.grid.isAdditionalColumn}},function(){return{property:"attrVisible",value:this.options.grid.attrVisible}},function(){return{property:"internalName",value:this.options.grid.internalName}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){let e=!!this.options.grid&&this.options.grid.canBeGrouped,n=t.clone(this.options.grid.layout||{});return e&&(n.canBeGrouped=!0),{property:"customisation",value:{layout:n}}},function(){return{property:"nature",value:this.options.grid.nature}}]},columnActionsMapping:{attrRemove:"trash"},actionsMeta:{moreAttributes:{executor:"DS/RequirementAttrManagement/views/actions/MoreAttributesHandler"},trash:{executor:"DS/RequirementAttrManagement/views/actions/RemoveAttributesHandler"}},toolbarActionsDefinition:{moreAttributes:function(t){return{fonticon:"attributes-add",title:e.attributesCustomization.moreAttributes,name:"moreAttributes",handler:function(e,n){i.invokeActionByID({actionId:"moreAttributes",context:t}),require(["DS/RequirementAttrManagement/views/actions/MoreAttributesHandler"],function(e){e.execute(t)})}}},diviser:function(){return{className:"divider"}},trash:function(t){return{fonticon:"remove",title:e.attributesCustomization.remove,name:"remove",handler:function(e,n){i.invokeActionByID({actionId:"trash",context:t})}}}},required:{columns:[],ActionsColumn:[{icon:{iconName:"remove",fontIconFamily:1},dataIndex:"attrRemove",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,sortableFlag:!1,resizableFlag:!1,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":e.nodeModel&&e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable?"actionNotRemove":"actionRemove"},getCellSemantics:function(e){if(e.nodeModel&&e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable)return{disabled:!0}}}]},getToolbarActionView:function(e,t){let n=i.toolbarActionsDefinition[e];return"function"==typeof n?n(t):null},invokeActionByColumnID:function(e){if(!e||!e.columnID||!e.context)return console.error("invalid input");let t=i.columnActionsMapping[e.columnID];t?(e.actionId=t,i.invokeActionByID(e)):console.error(e.columnID+" don't have a mapped action")},invokeActionByID:function(e){if(!e||!e.actionId||!e.context)return console.error("invalid input");if(i.actionsMeta[e.actionId]){let t=i.actionsMeta[e.actionId];require([t.executor],function(t){t.execute(e.context,e.input)})}else console.error(e.actionId+" action not found")},createAttributeNode:function(e){let t={columnIndex:e.dataIndex,label:e.label,kind:e.kind?e.kind:"string",icons:e.icons||[],grid:{attrTitle:e.label,attrVisible:void 0===e.attrVisible||e.attrVisible,canBeGrouped:void 0!==e.canBeGrouped&&e.canBeGrouped,attrName:e.attrName,nature:e.attrNature,attrDim:e.attrDim,attrUnit:e.attrUnit,internalName:e.internalName,provider:e.provider&&e.provider.length>0?e.provider:void 0,layout:e.layout,isAdditionalColumn:void 0!==e.isAdditionalColumn&&e.isAdditionalColumn,attrRemove:!0,attrParent:e.attrInstRef||"Reference",attrInstRef:e.attrInstRef||"Reference",attrAlert:null},children:null};return new n(t)}};return i}),define("DS/RequirementAttrManagement/views/private/Iconbar",["css!DS/RequirementAttrManagement/RequirementAttrManagement.css","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Event","UWA/Utils","UWA/Controls/Abstract","DS/UIKIT/Menu","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu"],function(e,t,n,i,o,s,a,r,l){"use strict";var d=n.Utils.Client.Features.touchEvents;var c,u=(c=/^(divider)$/,function(e){var t,n,i=!1;if(!e)return!1;for(t=e.split(" "),n=0;n<t.length&&!1===i;n++)c.test(t[n])&&(i=!0);return i}),p=a.extend({name:"iconbar-items",templateClassname:"iconbar-template"}),m=l.extend({show:function(){document.body.style.overflow="hidden",this._parent(),document.body.style.overflow="auto"}});return s.extend({name:"iconbar",menu:null,overflowMenu:null,overflowMenuTrigger:null,init:function(e){if(void 0===e.renderTo)throw new Error("renderTo options is Mandatory");this._parent(e),this.buildSkeleton(),this.handleEvents(),this.show()},buildSkeleton:function(){var e=this.elements,t=this.options;e.container||(this.menu=new p({multiSelect:t.multiSelect}),this.addItem(t.items),e.container=this.menu.elements.container,e.container.className=this.getClassNames(),e.container.addClassName("enx-iconbar"),t.renderTo&&1===t.renderTo.nodeType&&(e.container.inject(t.renderTo),delete t.renderTo))},buildOverflowMenu:function(){var e,t,i=[];this.overflowMenuTrigger||(this.overflowMenuTrigger=n.createElement("li",{class:this.name+"-overflow-menu-trigger item",html:{tag:"span",class:"fonticon fonticon-menu-dot"}})),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenu=null,this.menu.items.forEach(function(n){n.content&&"dropdown"===n.content.type||(t=!0,e={className:(n.id+" "+(n.className?n.className:"")).trim(),fonticon:n.fonticon,text:n.text,name:n.name,handler:n.handler,selectable:n.selectable,selected:n.selected,disabled:n.disabled},n.content&&n.content.options.items&&"icondropdown"!==n.content.type?e.items=n.content.options.items.map(function(e){return e.className=(n.id+" "+(e.className?e.className:"")).trim(),e.selectable=!0,e}):n.content&&"icondropdown"===n.content.type&&(t=!1,n.content.options.items&&n.content.options.items.forEach(function(e){i.push({className:(n.id+" "+(e.className?e.className:"")).trim(),fonticon:e.fonticon,icon:e.icon,handler:e.handler,text:e.description})})),t&&i.push(e))}),this.overflowMenu=new m({multiSelect:this.options.multiSelect,items:i,target:this.overflowMenuTrigger,events:this.options.events})},getItem:function(e){var t,n,i,o=!1;for(t=0,n=this.menu.items.length;t<n;t++){if(o=this.menu.items[t],e&&e.nodeType){if(i=e.hasClassName("item")?e:e.getParent(),o.id===i.id)break}else if(t===e||o.id===e||o.name===e)break;o=!1}return o},handleEvents:function(){var e,t,n,o;this.events={container:{click:function(e){var t=i.getElement(e),n=this.getItem(t);n.selectable&&this.select(n.name,!n.selected),n&&(n.content&&(window.requestAnimationFrame?window.requestAnimationFrame(this.displayContent.bind(this,n)):this.displayContent(n)),n.tooltip&&n.tooltip.isVisible&&!d&&n.tooltip.hide(),this.dispatchEvent("onClick",[e,n],this),"function"==typeof n.handler&&n.handler.call(this,e,n))}.bind(this)}},this.elements.container.addEvents(this.events.container),this.events.window={resize:(e=this.resize,t=100,function(){var i,s=this,a=arguments;i=n&&!o,clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(s,a)},t),i&&e.apply(s,a)}).bind(this)},window.addEventListener("resize",this.events.window.resize)},addItem:function(e){return o.splat(e).forEach(function(e){this._addItem(e)},this),this.buildOverflowMenu(),this},_addItem:function(e){var t=this.menu._addItem(e);t.content=t.innerComponent||t.content,!u(e.className)&&t.text&&(t.tooltip=new r({target:t.elements.container,body:t.text,trigger:t.tooltipTrigger||this.options.tooltipsTrigger||"hover focus"}),t.tooltip.getContent().addClassName("enx-tooltip-iconbar"),t.elements.container.getElement(".item-text").remove())},isOverflowing:function(){return this.menu.items.some(function(e){return!e.elements.container.isInViewport(this.elements.container,!0,!0)}.bind(this))},isInjected:function(){if(this.elements&&this.elements.container)return this.elements.container.isInjected()},resize:function(){function e(e){this.overflowMenu.items.forEach(function(t){e.some(function(e){return!!t.className&&(t.className&&-1!==t.className.indexOf(e))})?t.elements.container.removeClassName("hidden"):t.elements.container.addClassName("hidden")})}return function(){var t,n;if(this.overflowMenuTrigger&&this.overflowMenuTrigger.isInjected()&&this.overflowMenuTrigger.remove(),this.overflowMenu.isVisible&&this.overflowMenu.hide(),(!this.elements.container||this.isOverflowing())&&(n=(t=function(){var e=this.elements.container.getBoundingClientRect();return this.menu.items.filter(function(t){var n=t.elements.container.getBoundingClientRect();return n.top+n.height>e.bottom||n.left+n.width>e.right},this)}.call(this)).map(function(e){return e.id}),e.call(this,n),t.length))for(this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,t[0].elements.container);!this.overflowMenuTrigger.isInViewport(this.elements.container,!0,!0)&&this.overflowMenuTrigger.previousSibling;)this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,this.overflowMenuTrigger.previousSibling),t.push(this.overflowMenuTrigger.nextSibling),this.overflowMenuTrigger.nextSibling.id&&n.push(this.overflowMenuTrigger.nextSibling.id),e.call(this,n)}}(),displayContent:function(e){var t=n.clone(e.content.options);if(t.target=e.elements.container,e.content.created)e.content.component&&e.content.component.show();else{if("dropdown"===e.content.type)require(["DS/UIKIT/Dropdown"],function(n){e.content.component=new n(t).show()});else if("icondropdown"===e.content.type)require(["DS/UIKIT/IconDropdown"],function(n){e.content.component=new n(t).show()});else{if("dropdownmenu"!==e.content.type)return;e.content.component=new l(t).show(),e.content.component.getContent().addClassName("enx-dropdown-iconbar")}e.content.created=!0}},select:function(){var e,t,n,i,o=arguments;void 0!==o[0]&&null!==o[0]&&(t=void 0===o[1]||o[1],!0!==this.options.multiSelect&&(t&&function(e,t){for(var n=e.length,i=0;i<n;i++)t(e[i],i)}(this.elements.container.querySelectorAll(".selected"),function(e){e.removeClassName&&e.removeClassName("selected")}),t&&this.overflowMenu.getSelectedItems().forEach(function(e){this.overflowMenu.menus[0].toggleSelection(e),e.elements.container.removeClassName("selectable")},this)),(e=this.getItem(o[0])).selected=t,e&&!e.elements.container.hasClassName("divider")&&(e.elements.container[t?"addClassName":"removeClassName"]("selected"),n=e.elements.container.id,1===(i=this.overflowMenu.items.filter(function(e){return e.elements.container.hasClassName(n)})).length&&(this.overflowMenu.menus[0].toggleSelection(i[0]),i[0].elements.container.addClassName("selectable"),i[0].selected=t)))},enableItem:function(e){this.menu.enableItem(e);var t=this.getItem(e);t&&(t.disabled=!1)},disableItem:function(e){this.menu.disableItem(e);var t=this.getItem(e);t&&(t.disabled=!0)},show:function(){this.isInjected()&&(this._injectionObserver&&this._injectionObserver.disconnect(),this._injectionObserver=null,this._parent(),window.requestAnimationFrame?window.requestAnimationFrame(this.resize.bind(this)):this.resize())},destroy:function(){window.removeEventListener("resize",this.events.window.resize),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenuTrigger&&this.overflowMenuTrigger.destroy(),this.elements.container.removeEvents(this.events.container),this.menu.items.forEach(function(e){e.tooltip&&e.tooltip.destroy()}),this._parent()}})}),define("DS/RequirementAttrManagement/views/private/MoreAttributesWizard",["css!DS/RequirementAttrManagement/RequirementAttrManagement","i18n!DS/RequirementAttrManagement/assets/nls/RequirementAttrManagement.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/RequirementAttrManagement/views/private/WizardSteps","text!DS/RequirementAttrManagement/assets/init/MoreAttrWizardSteps.json","DS/RequirementAttrManagement/views/private/SearchInput","DS/RequirementAttrManagement/views/private/Iconbar","DS/RequirementAttrManagement/views/AttributesCommons","DS/TraceableRequirementsUtils/Dictionary/TRMDictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/Tree/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/PADContext","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/TraceableRequirementsUtils/Utils","DS/Utilities/Utils"],function(e,t,n,i,o,s,a,r,l,d,c,u,p,m,h,v,g,f,b,w){"use strict";var y=JSON.parse(a),C={properties:[function(){return{property:"dataIndex",value:this.options.grid.dataIndex}},function(){return{property:"attrName",value:this.options.grid.attrName}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"attrDim",value:this.options.grid.attrDim}},function(){return{property:"attrUnit",value:this.options.grid.attrUnit}},function(){return{property:"internalName",value:this.options.grid.internalName}},function(){return{property:"label",value:this.options.label}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){return{property:"attrNature",value:this.options.grid.attrNature}}]},I={"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"},M=["ds6w:globalType"];return i.extend({name:"more-attr",defaultOptions:{baseTypes:[],baseInstanceTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,maps:{referenceTypes:[],instanceTypes:[]},views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:!0,alternateBackgroundFlag:!1,columns:[{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:!0,width:40,resizableFlag:!1,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){var t=!0;return e.nodeModel&&e.nodeModel.getReferenceValue("attrRO")&&(t=!1),t}},{dataIndex:"tree",text:t.moreAttributesWizard.attrTitle}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}},init:function(e){this._parent(e),this._realInit(e)},_realInit:function(){var e=this;e.elements.container=n.createElement("div",{class:e.getClassNames("-immersivePanel")}),e.instanceMgt=e.options.baseInstanceTypes&&e.options.baseInstanceTypes.length>0,e._buildBody().then(e._buildFooter.bind(e)).done(function(){e.switchView(y.activeStep),e.options.subscribeTokens.push(e.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/stepChanged"},function(t){var n=t.stepId;e.switchView(n)})),e.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),e.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"moreAttr",html:e.elements.container}})})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy();var t=this;Object.keys(t.options.grids).forEach(function(e){t.options.grids[e].destroy(),t.options.grids[e]=null}),this._parent()},_buildBody:function(){var e=this;return new o(function(t,i){e.elements.wizard=n.createElement("div",{class:e.getClassNames("-wizard")}).inject(e.elements.container),e.options.wizard=new s({modelEvents:e.options.modelEvents,renderTo:e.elements.wizard,steps:y});var o=n.createElement("div",{class:e.getClassNames("-toolbar-container")}).inject(e.elements.container);e.elements.content=n.createElement("div",{class:e.getClassNames("-content")}).inject(e.elements.container),e._generateToolbar({renderTo:o}),t()})},_buildFooter:function(){var e=this;return new o(function(i,o){e.elements.footer=n.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container);var s=e.elements.nextButton=new u({label:t.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:!0});s.addEventListener("click",function(){if("typesView"===e.options.activeView)e.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"extensionsView"}});else if("extensionsView"===e.options.activeView)e.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"attributesView"}});else if("attributesView"===e.options.activeView){var t=e.options.models.attributesView.search({match:function(e){return!0===e.nodeModel.options.grid.attrSel}}).map(function(e){return e.dump(C)}),n=[].concat(e.options.selectedExtensions).concat(e.options.automaticExtensions);e.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:t,selectedTypes:e.options.selectedTypes,selectedExtensions:n}}),e.destroy()}}),s.inject(e.elements.footer);var a=e.elements.closeButton=new u({label:t.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:!0});a.addEventListener("click",function(){e.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/closeWizard"}),e.destroy()}),a.inject(e.elements.footer),i()})},switchView:function(e){if(this.options.activeView!==e)if(this.elements.toolbarSearch.clear(!0),this.__setToolbarCmds(e),this.options.previousView=this.options.activeView,this.options.activeView=e,null===this.options.views[e]){(c=this.elements.content.getElement("div.more-attr-chooser-view"))&&this.elements.content.removeChild(c),n.is(this.elements.loader)||(this.elements.loaderDiv=n.createElement("div",{class:this.getClassNames("-loader")}).inject(this.elements.content),this.elements.loader=(new p).inject(this.elements.loaderDiv),this.elements.loader.getContent().addClassName("enx-loader")),this.elements.loaderDiv.removeClassName("hidden"),this.elements.loader.on();var i=this,s=[],a=null,r=0,l=y.steps.length;do{y.steps[r].id===e&&(a=y.steps[r]),r++}while(r<l||null===a);if(a.prerequisiteViews)for(var d=0;d<a.prerequisiteViews.length;d++)null===this.options.views[a.prerequisiteViews[d]]&&s.push(this["_build"+a.prerequisiteViews[d]](!0));o.all(s).then(function(){this["_build"+e]().then(function(e){i.elements.loaderDiv.addClassName("hidden"),i.elements.loader.off(),i.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:i.options.activeView}})})}.bind(this))}else{var c;i=this;if((c=this.elements.content.getElements("div.more-attr-chooser-view"))&&Array.isArray(c)&&c.forEach(function(e){i.elements.content.removeChild(e)}),this.options.views[e].inject(this.elements.content),!0===this.typesUpdated&&"extensionsView"===this.options.activeView)this.__updateExtensionsView().then(function(){delete i.typesUpdated,i.extensionsUpdated=!0,i.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:i.options.activeView}})});else if(!0!==this.typesUpdated&&!0!==this.extensionsUpdated||"attributesView"!==this.options.activeView){i.options.grids[this.options.activeView].getContent().removeClassName("loading"),"extensionsView"===this.options.activeView||"typesView"===this.options.activeView?i.elements.nextButton.label=t.moreAttributesWizard.next:i.elements.nextButton.label=t.moreAttributesWizard.done,this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})}else this.__updateAttributesView().then(function(){delete i.typesUpdated,delete i.extensionsUpdated,i.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:i.options.activeView}})})}},_buildtypesView:function(e){var i=this;return new o(function(o,s){i.elements.nextButton.label=t.moreAttributesWizard.next,i.elements.nextButton.disabled=!0;i.options.wizard.getContent().addClassName("disabled"),i.options.views.typesView=n.createElement("div",{class:i.getClassNames("-typesView more-attr-chooser-view")});var a=n.createElement("div",{class:i.getClassNames("-typesViewDgv more-attr-dgv-container")}).inject(i.options.views.typesView),r=n.extend({identifier:"MoreAttrWizard-"+b.uid()},n.clone(i.options.dgvOptions));r.layout=new f(i.options.dgvLayoutOptions);var l=i.options.grids.typesView=new g(r);i._declareInstRefTypeReps(l),l.onContextualEvent=function(){return[]},l.getCellTooltip=function(e){var n=i.options.grids.typesView.getColumnOrGroup(e.columnID).dataIndex;if(e.dataIndex=n,-1===e.rowID)return{shortHelp:t.moreAttributesWizard[n],updateModel:!1}}.bind(this),l.mandatorySelected=i.options.defaultTypes,i.options.models.typesView=new m({}),l.treeDocument=i.options.models.typesView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(a),i.options.views.typesView.inject(i.elements.content),l.onReady(function(){i.__updateTypesViewModel(!0).finally(function(){!0!==e&&(l.getContent().removeClassName("loading"),i.elements.nextButton.disabled=!1,i.options.wizard.getContent().removeClassName("disabled")),o()}),l.addEventListener("change",i._changeType.bind(i))})})},_changeType:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){var i=t.nodeModel.getReferenceValue("attrName"),o=this.options.selectedTypes.indexOf(i);!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedTypes.push(i):-1!==o&&this.options.selectedTypes.splice(o),this.typesUpdated=!0}},_buildextensionsView:function(e){var i=this;return new o(function(o,s){i.elements.nextButton.label=t.moreAttributesWizard.next,i.elements.nextButton.disabled=!0;i.options.wizard.getContent().addClassName("disabled"),i.options.views.extensionsView=n.createElement("div",{class:i.getClassNames("-extensionsView more-attr-chooser-view")});var a=n.createElement("div",{class:i.getClassNames("-extensionsView-Dgv more-attr-dgv-container")}).inject(i.options.views.extensionsView),r=n.extend({identifier:"MoreAttrWizard-"+b.uid()},n.clone(i.options.dgvOptions));r.layout=new f(i.options.dgvLayoutOptions);var l=i.options.grids.extensionsView=new g(r);i._declareInstRefTypeReps(l),l.onContextualEvent=function(){return[]},l.getCellTooltip=function(e){var n=i.options.grids.extensionsView.getColumnOrGroup(e.columnID).dataIndex;return e.dataIndex=n,-1===e.rowID?{shortHelp:t.moreAttributesWizard[n],updateModel:!1}:e.nodeModel?{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:e.nodeModel.getReferenceValue("attrInTypeNLS").join("\n")}),updateModel:!1}:void 0}.bind(this),l.mandatorySelected=i.options.defaultExtensions,i.options.models.extensionsView=new m({}),l.treeDocument=i.options.models.extensionsView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(a),i.options.views.extensionsView.inject(i.elements.content),l.onReady(function(){i.__updateExtensionsViewModel(!0).finally(function(){!0!==e&&(l.getContent().removeClassName("loading"),i.elements.nextButton.disabled=!1,i.options.wizard.getContent().removeClassName("disabled")),o({})}),l.addEventListener("change",i._changeExtension.bind(i))})})},_changeExtension:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){var i=t.nodeModel.getReferenceValue("attrName"),o=this.options.selectedExtensions.indexOf(i);!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedExtensions.push(i):-1!==o&&this.options.selectedExtensions.splice(o),this.extensionsUpdated=!0}},_buildattributesView:function(e){var i=this;return new o(function(s){i.elements.nextButton.label=t.moreAttributesWizard.done,i.elements.nextButton.disabled=!0;i.options.wizard.getContent().addClassName("disabled"),i.options.views.attributesView=n.createElement("div",{class:i.getClassNames("-attributesView more-attr-chooser-view")});var a=n.createElement("div",{class:i.getClassNames("-attributesView-Dgv more-attr-dgv-container")}).inject(i.options.views.attributesView),r=n.extend({identifier:"MoreAttrWizard-"+b.uid()},n.clone(i.options.dgvOptions));r.layout=new f(i.options.dgvLayoutOptions);var l=i.options.grids.attributesView=new g(r);l.onContextualEvent=function(){return[]},l.getCellTooltip=function(e){var n=i.options.grids.attributesView.getColumnOrGroup(e.columnID).dataIndex;if(e.dataIndex=n,-1===e.rowID)return{shortHelp:t.moreAttributesWizard[n],updateModel:!1};if(e.nodeModel){var o=e.nodeModel.getReferenceValue("attrInTypeNLS");return{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:o?o.join("\n"):""}),updateModel:!1}}}.bind(this),l.mandatorySelectedWithParent={Reference:["ds6w:label","ds6w:type"]},i.options.models.attributesView=new m({}),l.treeDocument=i.options.models.attributesView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(a),i.options.views.attributesView.inject(i.elements.content),l.onReady(function(){void 0===i.options.grids.extensionsView&&[].push(i._buildextensionsView(!0));var t=[];t.push(i.__updateAttributesViewModel(!0)),o.all(t).then(function(){!0!==e&&(l.getContent().removeClassName("loading"),i.elements.nextButton.disabled=!1,i.options.wizard.getContent().removeClassName("disabled")),s({})}),l.addEventListener("change",i._changeAttributes.bind(i))})})},_changeAttributes:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){for(var i=-1,o=0,s=this.options.selectedAttributes.length;-1===i&&o<s;)this.options.selectedAttributes[o].name===t.nodeModel.getReferenceValue("attrName")&&this.options.selectedAttributes[o].instRef===t.nodeModel.getReferenceValue("attrParent")&&(i=o),o++;var a=t.nodeModel.getReferenceValue("attrName");!0===t.nodeModel.options.grid.attrSel?-1===i&&this.options.selectedAttributes.push({name:a,instRef:t.nodeModel.getReferenceValue("attrParent")}):-1!==i&&this.options.selectedAttributes.splice(i)}},_generateToolbar:function(e){var t=this,i=w.debounce(function(e){t.options.models[t.options.activeView].withTransactionUpdate(function(){var n=e.searchStr,i=!0;t.options.filterInProgress=!0,t.options.models[t.options.activeView].search({match:function(e){(function(e,t){var n=!1,i=new RegExp(e,"i");return(i.test(t.nodeModel.options.grid.attrTitle)||i.test(t.nodeModel.getLabel()))&&(n=!0),n})(n,e)&&t._isNodeVisible(e.nodeModel)?(e.nodeModel.show(),n.length>0&&i?(e.nodeModel.select(!0),e.nodeModel.matchSearch(),i=!1):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect())):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect(),e.nodeModel.hide())}}),t.options.filterInProgress=!1}),t.options.models[t.options.activeView].getXSO().onPostAdd(function(){}),t.options.models[t.options.activeView].getXSO().onPostRemove(function(){})},500);this.elements.toolbar=n.createElement("div",{class:this.getClassNames("-toolbar")}).inject(e.renderTo);var o=n.createElement("div",{class:this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);this.elements.toolbarIconbar=n.createElement("div",{class:this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);o.addEventListener("touchstart",function(e){e.target.style.fontSize="16px"},!1),o.addEventListener("mouseleave",function(e){e.target.style.fontSize="14px"},!1),this.elements.toolbarSearch=new r({events:{onSearch:i}}).inject(o)},_isNodeVisible:function(e){switch(this.currentSelectFilter+"-"+this.currentInstRefFilter){case"none-none":return!0;case"selected-none":return!0===e.getReferenceValue("attrSel");case"unselected-none":return!1===e.getReferenceValue("attrSel");case"none-reference":return"Instance"!==e.getReferenceValue("attrParent");case"none-instance":return"Reference"!==e.getReferenceValue("attrParent");case"selected-reference":return!0===e.getReferenceValue("attrSel")&&"Instance"!==e.getReferenceValue("attrParent");case"selected-instance":return!0===e.getReferenceValue("attrSel")&&"Reference"!==e.getReferenceValue("attrParent");case"unselected-reference":return!1===e.getReferenceValue("attrSel")&&"Instance"!==e.getReferenceValue("attrParent");case"unselected-instance":return!1===e.getReferenceValue("attrSel")&&"Reference"!==e.getReferenceValue("attrParent")}return!0},__setToolbarCmds:function(e){var n=this;this.currentSelectFilter="none",this.currentInstRefFilter="none";var i,o=function(){n.options.models[n.options.activeView].withTransactionUpdate(function(){for(var e=n.options.models[n.options.activeView].getRoots(),t=(n.currentSelectFilter,n.currentInstRefFilter,0);t<e.length;t++){n._isNodeVisible(e[t])?e[t].show():e[t].hide()}}),n.options.models[n.options.activeView].getXSO().onPostAdd(function(){}),n.options.models[n.options.activeView].getXSO().onPostRemove(function(){})},s={fonticon:"filter",text:t.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"checkbox-on",text:t.moreAttributesWizard.selected,name:"selected",selectable:!0},{fonticon:"checkbox-off",text:t.moreAttributesWizard.unselected,name:"unselected",selectable:!0}],events:{onClick:function(e,t){var i;i=t.name,n.currentSelectFilter=i,o()}}}}},a={className:"divider"};if(!this.options.toolbar||this.options.toolbar.currentView!==e){i=(this.instanceMgt,[a,s]);var r={renderTo:this.elements.toolbarIconbar,items:i};this.options.toolbar&&(this.options.toolbar.destroy(),this.options.toolbar=null),this.options.toolbar=new l(r),this.options.toolbar.elements.container.setStyle("display",void 0)}},_declareInstRefTypeReps:function(e){var t={Reference:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Instance:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"flow-cascade",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Both:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-replace",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Extension:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-add",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Unknown:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))},_checkSelected:function(e,t){var n=this.options.selectedAttributes.filter(function(n){return n.name===e&&n.instRef===t});return n.length>1&&console.warn("Several attributes found "+JSON.stringify(n)),1===n.length},__updateTypesViewModel:function(e){var t=this;return new o(function(n){var i=t.options.baseInstanceTypes.length?t.options.baseTypes.concat(t.options.baseInstanceTypes):t.options.baseTypes;c.getTypesInfo({baseTypes:i},e).then(function(e){var i=Object.getOwnPropertyNames(e);if(void 0!==i){for(var o=0;o<i.length;o++){var s=i[o],a=e[s],r=-1!==t.options.selectedTypes.indexOf(s),l=a.parent?a.parent:s,d=-1!==t.options.baseTypes.indexOf(l)?"Reference":-1!==t.options.baseInstanceTypes.indexOf(l)?"Instance":"Unknown",c=new h({label:a.displayName,grid:{attrName:s,attrTitle:a.displayName,attrSel:r,attrParent:d},icons:[a.iconUrl]});t.options.models.typesView.addRoot(c,r?0:void 0),"Reference"===d&&-1===t.options.maps.referenceTypes.indexOf(s)&&t.options.maps.referenceTypes.push(s),"Instance"===d&&-1===t.options.maps.instanceTypes.indexOf(s)&&t.options.maps.instanceTypes.push(s)}n({})}})})},__updateExtensionsView:function(){var e=this;return new o(function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.extensionsView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.extensionsView.removeRoots(),e.__updateExtensionsViewModel(!0).finally(function(){e.elements.loader.off(),e.options.grids.extensionsView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),t()})})},__updateExtensionsViewModel:function(e){var t=this;return new o(function(n){c.getInterfaces({classes:t.options.selectedTypes,onlyCustomer:!1},e).then(function(e){for(var i=Object.getOwnPropertyNames(e.extensions),o=0;o<i.length;o++){for(var s=i[o],a=e.extensions[s],r=-1!==t.options.selectedExtensions.indexOf(s),l="",d=!1,u=!1,p=[],m=0;m<a.declareIn.length;m++){-1!==t.options.baseTypes.indexOf(a.declareIn[m])?d=!0:-1!==t.options.baseInstanceTypes.indexOf(a.declareIn[m])&&(u=!0);var v=a.declareIn[m];c.getNLSForTypes(v);p.push(c.getNLSForTypes(a.declareIn[m]))}l=!0===d&&!0===u?"Both":!0===d?"Reference":!0===u?"Instance":"Unknown";var g=new h({label:a.nlsName,grid:{attrName:s,attrTitle:a.nlsName,attrSel:r,attrInType:a.declareIn,attrInTypeNLS:p,attrParent:l}});t.options.models.extensionsView.addRoot(g,r?0:void 0)}var f=Object.getOwnPropertyNames(e.automaticExtensions);for(o=0;o<f.length;o++)t.options.automaticExtensions.push(f[o]);n({})})})},__updateAttributesView:function(){var e=this;return new o(function(n){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.attributesView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.elements.nextButton.label=t.moreAttributesWizard.done,e.options.wizard.getContent().addClassName("disabled"),e.options.models.attributesView.removeRoots(),e.__updateAttributesViewModel(!0).finally(function(){e.elements.loader.off(),e.options.grids.attributesView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),n()})})},__updateAttributesViewModel:function(e){var t=this;return new o(function(e){for(var i=n.clone(t.options.selectedTypes.concat(t.options.automaticExtensions).concat(t.options.selectedExtensions)),o=0;o<i.length;o++)i[o]="ds6wg:"+i[o];var s=i.join("\n");c.getPredicates({classURIs:s,types:n.clone(t.options.selectedTypes),interfaces:n.clone(t.options.automaticExtensions.concat(t.options.selectedExtensions))}).then(function(n){for(var i=Object.getOwnPropertyNames(n.availaibleAttributes),o=[],s=[],a=0;a<i.length;a++){var r=i[a],l=n.availaibleAttributes[r],d=I[r]?I[r]:r;if(-1===M.indexOf(d)){var u="",p=!1,m=!1,v=!1,g=[],f=[],b=[],w=[];if(l.inTypes)for(var y=0;y<l.inTypes.length;y++){var C=null,T=l.inTypes[y].substring(l.inTypes[y].indexOf(":")+1,l.inTypes[y].length);if(-1!==t.options.baseTypes.indexOf(T))p=!0;else if(-1!==t.options.baseInstanceTypes.indexOf(T))m=!0;else if((-1!==t.options.selectedExtensions.indexOf(T)||-1!==t.options.automaticExtensions.indexOf(T))&&(v=!0,(C=t.options.models.extensionsView.search({match:function(e){return e.nodeModel.getReferenceValue("attrName")===T}})).length)){var A=C[0].getReferenceValue("attrParent");"Reference"===A?p=!0:"Instance"===A?m=!0:"Both"===A&&(p=!0,m=!0)}if(-1!==t.options.maps.referenceTypes.indexOf(T)&&(p=!0,g.push(T),f.push(c.getNLSForTypes(l.inTypes[y]))),-1!==t.options.maps.instanceTypes.indexOf(T)&&(m=!0,b.push(T),w.push(c.getNLSForTypes(l.inTypes[y]))),v&&Array.isArray(C)&&C.length>0){var x=C[0],N=Array.isArray(x.options.grid.attrInType)?x.options.grid.attrInType[0]:"";-1!==t.options.maps.referenceTypes.indexOf(N)&&(p=!0,g.push(N),f.push(c.getNLSForTypes(l.inTypes[y]))),-1!==t.options.maps.instanceTypes.indexOf(N)&&(m=!0,b.push(N),w.push(c.getNLSForTypes(l.inTypes[y])))}}u=!0===p&&!0===m?"Both":!0===p?"Reference":!0===m?"Instance":!0===v?"Extension":"Both";var V=l.dimension,S=l.manipulationUnit,E=l.originCuri?l.originCuri.substring(l.originCuri.indexOf(":")+1,l.originCuri.length):null,R=(l.curi.startsWith("ds6wg:")?l.curi.substr(6):l.curi,d);if("Instance"===u&&(d+="-Instance"),"attribute"===l.nature&&(E=l.selectable),-1===s.indexOf(d))if("Both"===u){o.push(d);var D=t._checkSelected(d,"Reference"),_=new h({label:l.label,grid:{attrName:R,internalName:E,dataIndex:d,attrDim:V,attrUnit:S,attrTitle:l.label,attrNature:l.nature,attrDesc:l.description,attrKind:l.dataType.substring(l.dataType.indexOf("#")+1),attrInType:g,attrInTypeNLS:f,attrOrigName:E,attrSel:D,attrRO:D,attrParent:"Reference"}});t.options.models.attributesView.addRoot(_,D?0:void 0),s.push(d)}else{var O,z;"Reference"===u?(O=g,z=f):"Instance"===u&&(O=b,z=w);var U=t._checkSelected(d,u),B=new h({label:l.label,grid:{attrName:R,internalName:E,dataIndex:d,attrDim:V,attrUnit:S,attrTitle:l.label,attrNature:l.nature,attrDesc:l.description,attrKind:l.dataType.substring(l.dataType.indexOf("#")+1),attrInType:O,attrInTypeNLS:z,attrOrigName:E,attrSel:U,attrRO:U,attrParent:u}});t.options.models.attributesView.addRoot(B,U?0:void 0),s.push(d)}}}e({})})})}})}),define("DS/RequirementAttrManagement/views/actions/MoreAttributesHandler",["DS/RequirementAttrManagement/views/AttributesCommons","DS/PADUtils/PADContext"],function(e,t){"use strict";return{execute:function(n){var i=n.options;i.appColumns;require(["DS/RequirementAttrManagement/views/private/MoreAttributesWizard","i18n!DS/RequirementAttrManagement/assets/nls/RequirementAttrManagement.json"],function(o,s){for(var a=i.attrModel.getRoots(),r=[],l=0;l<a.length;l++)r.push({name:a[l].getReferenceValue("attrName"),instRef:a[l].getReferenceValue("attrParent")});var d=i.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/selectedAttributes"},function(t){i.modelEvents.unsubscribe(d);var o=(i.attrModel.getRoots()||[]).map(function(e){return e.options.columnIndex});i.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),i.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:s.attributesCustomization.apptitle}}),i.selectedExtensions=t.selectedExtensions,i.selectedTypes=t.selectedTypes,n._globalUpdate=!0;var a=t.selectedAttributes.filter(function(e){return-1!==o.indexOf(e.dataIndex)||"ds6w:label"===e.dataIndex}).map(function(e){return e.dataIndex});a.push("ds6w:covers"),a.push("ds6w:refinedInto"),a.push("paramContent"),a.push("ds6wg:PLMReference.V_isLastVersion");var r=o.filter(function(e){return-1===a.indexOf(e)&&"tree"!==e}),l=t.selectedAttributes.filter(function(e){return-1===o.indexOf(e.dataIndex)&&"ds6w:label"!==e.dataIndex}),c=[],u=[],p=0;for(p=0;p<r.length;p++){var m=i.attrModel.search({match:function(e){var t=!1;return e.nodeModel.options.columnIndex===r[p]&&!0!==e.nodeModel.options.grid.isAdditionalColumn&&"ds6w:type"!==r[p]&&(t=!0),t}});i.attrModel.withTransactionUpdate(function(){for(var t=0;t<m.length;t++)i.attrModel.removeRoot(m[t]),c.push(m[t].dump(e.dumpProp))})}var h=[];for(l.forEach(function(t){var o=e.createAttributeNode({dataIndex:t.dataIndex,label:t.label,attrName:t.attrName&&!t.attrName.endsWith("-Instance")?t.attrName:t.attrName.substring(0,t.attrName.length-"-Instance".length),kind:t.kind,attrDim:t.attrDim,internalName:t.internalName,attrNature:t.attrNature,attrUnit:t.attrUnit,icons:void 0,attrInstRef:t.attrParent,attrVisible:!0,isAdditionalColumn:!1,canBeGrouped:!1}),s=n.__locateFirstAndLastPin("right");s.first?i.attrModel.insertBefore(o,s.first):i.attrModel.addChild(o),o.select(),h.push(o)}),p=0;p<h.length;p++)u.push(h[p].dump(e.dumpProp));(c.length||u.length)&&i.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:i.selectedTypes,selectedExtensions:i.selectedExtensions,removedColumns:c,addedColumns:u}}),delete n._globalUpdate}),c=i.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/closeWizard"},function(){i.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),i.modelEvents.unsubscribe(c),i.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:s.attributesCustomization.apptitle}})});t.get().MoreAttrPanel=new o({modelEvents:i.modelEvents,baseTypes:i.baseTypes,baseInstanceTypes:i.baseInstanceTypes,baseExtensions:i.baseExtensions,selectedTypes:i.selectedTypes,selectedExtensions:i.selectedExtensions,selectedAttributes:r})})},__getAllAttrInPinModels:function(e){var t=[];return t=t.concat(e.pinModel.left.getChildren()).concat(e.pinModel.unpinned.getChildren()).concat(e.pinModel.right.getChildren())}}}),define("DS/RequirementAttrManagement/views/AttributesCustomization",["i18n!DS/RequirementAttrManagement/assets/nls/RequirementAttrManagement.json","DS/RequirementAttrManagement/views/private/Iconbar","DS/RequirementAttrManagement/views/AttributesCommons","DS/TraceableRequirementsUtils/Utils","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/Tree/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/PADContext","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","css!DS/RequirementAttrManagement/RequirementAttrManagement.css"],function(e,t,n,i,o,s,a,r,l,d,c,u,p,m,h){"use strict";return a.extend({name:"attr-customization",defaultOptions:{renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0},columns:[{icon:{iconName:"database",fontIconFamily:1},tooltip:e.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.removableFromView?t=e.nodeModel.options.grid.layout.removableFromView:!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{text:e.attributesCustomization.attrTitle,dataIndex:"tree",typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,resizableFlag:!1}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(t){this._parent(t);var i=this,o=c.get();i.elements.container=s.createElement("div",{class:i.getClassNames("-immersivePanel")}),h.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(function(){i.instanceMgt=!!(i.options.baseInstanceTypes&&i.options.baseInstanceTypes.length>0);var t=i.options.dgvOptions;t.columns=t.columns.concat(n.required.columns,n.required.ActionsColumn),i._buildBody(),i._buildFooter(),i.elements.panel2small=s.createElement("div",{class:i.getClassNames("-panel2small"),text:e.attributesCustomization.panel2small}).inject(i.elements.container),o._applicationChannel.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",title:e.attributesCustomization.apptitle,html:i.elements.container}})})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy(),this.options.grid.destroy(),this.options.grid=null,this._parent()},_buildBody:function(){this._buildIconBar(),this.elements.dgv=s.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container),this.options.dgvOptions.columns.splice(4,1);var t=s.extend({identifier:"DataGridView-attrCusto-"+i.uid()},this.options.dgvOptions);t.layout=new m(this.options.dgvLayoutOptions);var o=this.options.grid=new p(t);o.onContextualEvent=function(){return[]},o.getCellTooltip=function(t){if(-1===t.columnID)return o.getCellDefaultTooltip(t);var n=this.options.grid.getColumnOrGroup(t.columnID).dataIndex;return t.dataIndex=n,-1===t.rowID?{shortHelp:e.attributesCustomization[n],updateModel:!1}:"tree"===n&&t.nodeModel&&!0!==t.nodeModel.getReferenceValue("isAdditionalColumn")?{shortHelp:e.replace(e.attributesCustomization.tooltipColName,{label:t.nodeModel.getLabel(),instRef:e.attributesCustomization[t.nodeModel.getReferenceValue("attrInstRef")]}),updateModel:!1}:void 0}.bind(this);var a={actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},r={};r[e.attributesCustomization.pinLeft]="left",r[e.attributesCustomization.pinRight]="right",r[e.attributesCustomization.unpinned]="unpinned";var d={pin:{stdTemplate:"enumCombo",semantics:{possibleValues:r,valueType:"enumCustom"}}};o.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d)),o.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(a));this.options.attrModel=new l({shouldBeSelected:function(e){return!0!==e.options.pinColumn}}),o.treeDocument=this.options.attrModel,o.getContent().addClassName("enxdatagridview"),o.getContent().inject(this.elements.dgv);var c=this;o.onReady(function(){o.addEventListener("change",c._cellModified.bind(c)),o.addEventListener("click",c._cellClicked.bind(c)),c.options.toolbar.show()}),this._addColumns(),this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this)),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},function(e){!0!==c._isMoving&&!0!==c._globalUpdate&&c.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[e.data.nodeModel.dump(n.dumpProp)]}})})),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},function(e){if(!0!==c._isMoving&&!0!==c._globalUpdate){var t=e.data.nodeModel.getReferenceValue("attrName");if(-1!==n.specificColumns.indexOf(t)){if(!1===c.options.withDgv){var i=c.options.toolbar.getItem("specificColumns"),o=i.content.component;if(o)o.isSelected(t)&&o.toggleSelection(o.getItem(t));else{var s=i.content.options.items,a=!1,r=0,l=s.length;do{s[r].id===t?(s[r].selected=!1,a=!0):r++}while(!1===a&&r<l);c.options.toolbar.menu.updateItem(i)}}"thumbnail"===t&&c.elements.comboCompact.disabled(!1)}c.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[e.data.nodeModel.dump(n.dumpProp)]}})}}))},_buildFooter:function(){var t=this,n=s.createElement("div",{class:t.getClassNames("-footer")}).inject(t.elements.container),i=t.elements.closeButton=new r({label:e.attributesCustomization.close,emphasize:"primary",touchMode:!0});i.addEventListener("click",function(){t._closePanel(),t.destroy()}),i.inject(n);var o=t.elements.resetButton=new r({label:e.attributesCustomization.reset,touchMode:!0});o.addEventListener("click",function(){t.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:t.options.applyOnlyToThisApp}}),t.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0,refreshStructure:!0}}),t.destroy()}),o.inject(n)},_closePanel:function(){var e=[];this.options.attrModel.getRoots().forEach(function(t){e.push(t.dump(n.dumpProp))}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:e,applyOnlyToThisApp:this.options.applyOnlyToThisApp}}),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0,refreshStructure:!0}})},_addColumns:function(){var e=this;void 0===this.options.appColumns?console.error("AttributesCustomization## Invalid input. Missing property appColumns"):e.options.attrModel.withTransactionUpdate(function(){e.options.appColumns.forEach(function(t){if("bi_color"!==t.dataIndex){var i=s.is(t.text,"string")&&t.text.length>0?t.text:e._retrieveColumnName(t.dataIndex),o=!(!t.customisation||!t.customisation.layout)&&t.customisation.layout.canBeGrouped,a=t.customisation&&t.customisation.layout?t.customisation.layout:null,r=void 0!==t.visibleFlag?t.visibleFlag:!t.isHidden,l=t.ds6wFrom&&"rel"===t.ds6wFrom?"Instance":"Reference",d=n.createAttributeNode({dataIndex:t.dataIndex,label:i,attrName:t.ds6w||t.dataIndex,internalName:t.dbName,attrNature:t.nature,kind:t.kind,attrDim:t.attrDim,attrUnit:t.attrUnit,icons:void 0,attrInstRef:l,attrVisible:r,provider:t.provider,isAdditionalColumn:t.isAdditionalColumn,canBeGrouped:o,layout:a});d&&e.options.attrModel.addChild(d)}}),e.options.attrModel.expandAll()})},_cellModified:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:t.nodeModel.options.columnIndex,visibilityFlag:t.nodeModel.getReferenceValue("attrVisible")}});break;case"attrTitle":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:t.nodeModel.options.columnIndex,newTitle:t.nodeModel.getReferenceValue("attrTitle")}});break;case"exportContent":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:t.nodeModel.options.columnIndex,exportFlag:t.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var n=this,i=t.nodeModel.getReferenceValue("attrName"),o=t.nodeModel.getReferenceValue("pinContent"),s=n.__locateFirstAndLastPin(o);n.options.attrModel.withTransactionUpdate(function(){n._globalUpdate=!0;var e=s.last?s.last._getLocalID?s.last._getLocalID():s.last._localID:n.options.getRoots().length-1;0===e&&(e=1),n.options.attrModel.addChild(t.nodeModel,e),t.nodeModel.select(),delete n._globalUpdate}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:i,pin:o}})}},_cellClicked:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid){if(!0===t.nodeModel.options.pinColumn)return;n.invokeActionByColumnID({columnID:this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID),context:this,input:[t.nodeModel]})}},_retrieveColumnName:function(t){return e.attributesCustomization[t]?e.attributesCustomization[t]:t},_buildIconBar:function(){this.elements.toolbar=s.createElement("div",{class:this.getClassNames("-toolbar")}).inject(this.elements.container);var e=this,i={renderTo:this.elements.toolbar,multiSelect:!0,items:(e.options.toolbarActions||[]).map(function(t){return n.getToolbarActionView(t,e)||{}})};this.options.toolbar=new t(i),this.options.toolbar.elements.container.setStyle("display",void 0)},_manageAttrSelection:function(){var e=this.options.attrModel.getSelectedNodes(),t=["moveUp","moveDown","moveFirst","moveLast"],n=["remove","changeColor"],i=e.length,o=!1,s=0;for(s=0;s<i;s++)!0===e[s].options.grid.isAdditionalColumn||e[s].options.grid.layout&&!1===e[s].options.grid.layout.removable||(o=!0);if(0===i){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<n.length;s++)this.options.toolbar.disableItem(n[s])}else if(1===i){for(s=0;s<t.length;s++)this.options.toolbar.enableItem(t[s]);for(s=0;s<n.length;s++)"remove"===n[s]&&!1===o?this.options.toolbar.disableItem(n[s]):this.options.toolbar.enableItem(n[s])}else if(i>=1){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<n.length;s++)"remove"===n[s]&&!1===o?this.options.toolbar.disableItem(n[s]):this.options.toolbar.enableItem(n[s])}},__locateFirstAndLastPin:function(e){for(var t,n,i=this.options.attrModel.getRoots(),o=0;o<i.length&&(!t||!n);o++)i[o].getReferenceValue("pinContent")!==e||t?i[o].getReferenceValue("pinContent")!==e&&t&&(n=i[o-1]):t=i[o];return t&&!n&&(n=i[i.length-1]),{first:t,last:n}}})});