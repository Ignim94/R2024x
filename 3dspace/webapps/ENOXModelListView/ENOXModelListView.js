define("DS/ENOXModelListView/ModelListView/js/ModelListViewEmptyContent",["DS/ENOXEmptyContent/js/ENOXEmptyContent"],function(e){"use strict";var t=function(t,i,o,n){this._ENOXEmptyContent=new e(i.emptyContentOptions),this._ENOXEmptyContent.inject(n),this._modelEvents=o,console.log("hey i am the empty content"),0===t.getChildren().length&&n.classList.remove("displaynone");var s=this;["addChild","removeChild"].forEach(function(e){t.addEventListener(e,function(){0===t.getChildren().length?(n.classList.remove("displaynone"),s._modelEvents.publish({event:"xmodel-list-is-empty",data:!0})):(n.classList.add("displaynone"),s._modelEvents.publish({event:"xmodel-list-is-empty",data:!1}))})})};return t.prototype.destroy=function(){this._ENOXEmptyContent.destroy()},t}),define("DS/ENOXModelListView/ModelListView/js/TitleTweaker",["DS/Tweakers/TweakerBase","DS/Tweakers/TweakerString","DS/Core/PointerEvents","DS/Utilities/Utils","DS/Utilities/Dom","DS/Controls/Button","DS/Controls/LineEditor","css!ENOXModelListView/ModelListView/css/TitleTweaker.css"],function(e,t,i,o,n,s,l){"use strict";var a=e.inherit({name:"titleTweaker",publishedProperties:{label:{defaultValue:"",type:"string"},displayStyle:{defaultValue:"editText",type:"string",category:"Appearance"},linkDisplay:{defaultValue:!0,type:"boolean",category:"Appearance"}}}),d=function(t,i){e.prototype.baseViewModule.call(this,t,i)};o.applyMixin(d,e.prototype.baseViewModule);var r=function(e,t){d.call(this,e,t)};return o.applyMixin(r,d),r.prototype.buildView=function(){if(this._tweaker.elements.container){var e=UWA.merge({},this._options.viewOptions);e.touchMode=this._tweaker._getCurrentTouchMode(),e.allowUnsafeHTMLLabel=!1,e.selectAllOnFocus=!0;var t,o=this;if(this._tweaker.value&&(e.value=this._tweaker.value),this._tweaker._isFakeNode=!0,this._tweaker.executionContext.nodeModel.options.id&&(this._tweaker._isFakeNode=!1),this._textSpan=UWA.createElement("span",{textContent:e.value}),this._link=UWA.createElement("a",{textContent:e.value}),this._link.addEventListener(i.POINTERDOWN,(t=this._tweaker,function(e){t.linkDisplay&&t.executionContext&&t.executionContext.nodeModel.getModelEvents().publish({event:"title-link-action",context:t.executionContext})})),this._lineEditor=new l(e),this._view=UWA.createElement("div",{class:"title-tweaker"}),this._view.addContent(this._link),this._view.addContent(this._textSpan),this._view.addContent(this._lineEditor),this._view.addClassName("not-editable"),this._view._giveFocus=function(){o._lineEditor._giveFocus()},this.setValue(this._tweaker.value),!this._tweaker.readOnly){o._tweaker.timeSwitchtoEdit=new Date;setTimeout(function(){o._view.removeClassName("not-editable"),o._tweaker._isFakeNode=!1},500),o._view.addEventListener(i.POINTERDOWN,function(e){new Date-o._tweaker.timeSwitchtoEdit>500?o.setEditable(!0):o._tweaker.executionContext&&o._tweaker.executionContext.nodeModel.getModelEvents().publish({event:"title-link-action",context:o._tweaker.executionContext})})}}},r.prototype.handleEvents=function(){var e=this,t=this._view;t.addEventListener(i.LONGHOLD,function(e){e.stopPropagation()}),t.addEventListener("contextmenu",function(e){}),n.addEventOnElement(e._tweaker,this._lineEditor,"blur",function(t){t.stopPropagation(),e._tweaker.onPostEdit()}),n.addEventOnElement(e._tweaker,this._lineEditor,"uncommittedChange",function(t){t.stopPropagation(),e._tweaker.onPreEdit()}),n.addEventOnElement(this._tweaker,this._lineEditor,"change",function(t){t.stopPropagation(),e._tweaker.readOnly||(""!=e._lineEditor.value.trim()?(e.setTweakerValue(e._lineEditor.value),e._tweaker.onPostEdit()):e.setTweakerValue(e._tweaker._currentValueLabel))}),n.addEventOnElement(e._tweaker,this._lineEditor,"focusout",function(t){t.stopPropagation(),e.setEditable(!1)}),n.addEventOnElement(e._tweaker,this._lineEditor,"keyup",function(t){13==t.keyCode&&(t.stopPropagation(),e.setEditable(!1))})},r.prototype.setEditable=function(e){if(this._view)try{e&&!this._view.isEditing?this._view.addClassName("editing"):e||(this._view.isEditing=!1,this._view.removeClassName("editing"),this.setValue(this._tweaker.value))}catch(e){UWA.log("editable false")}},r.prototype.setValue=function(){this._view&&(this._tweaker.linkDisplay?this._view.removeClassName("no-link-display"):this._view.addClassName("no-link-display"),void 0===this._tweaker.value||null===this._tweaker.value?this._view.label="undefined":(this._textSpan.textContent=this._tweaker.value,this._link.textContent=this._tweaker.value,this._lineEditor.value=this._tweaker.value))},a.prototype.baseViewModule=d,a.prototype.VIEW_MODULES={editText:{classObject:r,options:{viewOptions:{displayStyle:"editText"}}},editText_readOnly:{classObject:r,options:{viewOptions:{displayStyle:"editText"}}}},a}),define("DS/ENOXModelListView/ModelListView/js/ContextualMenuTweaker",["UWA/Core","DS/Tweakers/TweakerBase","DS/Utilities/Utils","DS/Controls/Button","DS/Menu/ContextualMenu","DS/Menu/Menu"],function(e,t,i,o,n,s){"use strict";var l=t.inherit({name:"contextualMenu",publishedProperties:{label:{defaultValue:"",type:"string"},icon:{defaultValue:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"string"},displayStyle:{defaultValue:"menuIcon",type:"string",category:"Appearance"}},computeContentSize:function(){return 30}}),a=function(e,i){t.prototype.baseViewModule.call(this,e,i)};i.applyMixin(a,t.prototype.baseViewModule);var d=function(e,t){a.call(this,e,t)};return i.applyMixin(d,a),d.prototype.buildView=function(){if(!this._tweaker.elements.container)return;let t=this._tweaker.value.menu;var i=e.merge({},this._options.viewOptions);i.touchMode=this._tweaker._getCurrentTouchMode(),i.displayStyle="lite",i.icon=this._tweaker.icon,i.allowUnsafeHTMLLabel=!1,this._view=new o(i),this._view.getContent().addClassName("contextualMenu"),this.setValue(t)},d.prototype.handleEvents=function(){var e=this,t=this._view;t&&t.addEventListener("buttonclick",async function(i){let o=[];if(e._tweaker.value&&Array.isArray(e._tweaker.value.menu))o=e._tweaker.value.menu;else if(e._tweaker.value.menu instanceof Function){let t=e._tweaker.executionContext.nodeModel;o=await e._tweaker.value.menu(t,i)}if(e._tweaker.value&&!(!0===e._tweaker.value.disabled||o&&1===o.length&&o[0]&&o&&"disabled"===o[0].state)){var n=o;if(n)if(1===n.length)n[0].action.callback(i);else{var l=t.getContent().getBoundingClientRect();s.show(n,{position:{x:l.left,y:l.top+l.height},submemu:"outside"})}}})},d.prototype._toggleVisibility=function(e){this._tweaker.value&&(e instanceof Promise||e&&e.length>0)?this._view.show():this._view.hide()},d.prototype._toggleDisability=function(e){this._tweaker.value&&(!0===this._tweaker.value.disabled||e&&1===e.length&&e[0]&&e&&"disabled"===e[0].state)?this._view.getContent().setAttribute("disabled",!0):this._view.getContent().removeAttribute("disabled")},d.prototype.setValue=function(t){if(this._view){if(e.is(t,"object")&&Array.isArray(t.menu))t=t.menu;if(this._view.icon=this.getMenuIcon(t),void 0===this._tweaker.value||null===this._tweaker.value?this._view.value="undefined":(this._view.value=this._tweaker.value,this._toggleDisability(t),this._toggleVisibility(t)),this._tweaker.executionContext){this._view.value.menu instanceof Function&&this._view.value.menu(this._tweaker.executionContext.nodeModel).then(function(e){i._view.icon=i.getMenuIcon(e),i._toggleDisability(e),i._toggleVisibility(e)}),this._eventToken&&this._tweaker.executionContext.nodeModel.removeEventListener(this._eventToken);var i=this;this._eventToken=this._tweaker.executionContext.nodeModel.addEventListener("pushUpdate",async function(){void 0!==this.options.disableMenu&&this.options.disableMenu!==i._tweaker.value.disabled&&(i._tweaker.value.disabled=this.options.disableMenu,i.setValue());let e=[];if(i._tweaker.value.menu instanceof Function){e=await i._tweaker.value.menu(i._tweaker.executionContext.nodeModel);let t=i.getMenuIcon(e);i._view.icon=t,i._toggleDisability(e)}})}}},d.prototype.getMenuIcon=function(e){var t={iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS};return this._tweaker.value&&e&&Array.isArray(e)&&e.length>0&&1==e.length&&(t={iconName:e[0].icon,fontIconFamily:WUXManagedFontIcons.Font3DS}),t},d.prototype.removeEvents=function(){this._view&&this._view.removeEventListener("buttonclick")},d.prototype._updateView=function(){this.setValue()},l.prototype.baseViewModule=a,l.prototype.VIEW_MODULES={menuIcon:{classObject:d,options:{viewOptions:{}}},readOnly:{classObject:d,options:{viewOptions:{displayStyle:"menuIcon"}}}},l}),define("DS/ENOXModelListView/ModelListView/js/ModelListViewCollectionToolBar",["UWA/Core","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","i18n!DS/ENOXModelListView/assets/nls/ModelListView","css!ENOXModelListView/ModelListView/css/ModelListView.css"],function(e,t,i){"use strict";var o=function(o,n,s){this._initMaps(),this._model=o;var l=0;if(this._disabledActions=[],this._opts={},this._opts.views=[],n.viewOptions){if(n.viewOptions.views)for(l=0;l<n.viewOptions.views.length;l+=1)this._opts.views.push({id:n.viewOptions.views[l],text:this._localMap_text[n.viewOptions.views[l]],fonticon:this._localMap_fonticon[n.viewOptions.views[l]]});this._opts.currentView=n.viewOptions.currentView?n.viewOptions.currentView:n.viewOptions.views?n.viewOptions.views.includes("DataGridView")?"DataGridView":n.viewOptions.views[0]:"DataGridView"}this._opts.currentSort=n.viewOptions.currentSort?n.viewOptions.currentSort:void 0,this._opts.sort=[];var a=[];for(this._selectedGroupItem=null,l=0;l<n.viewOptions.grid.columns.length;l+=1)if(""!==n.viewOptions.grid.columns[l].text&&(!0!==n.restrictSortFlag&&!1!==n.viewOptions.grid.columns[l].sortableFlag&&this._opts.sort.push({id:n.viewOptions.grid.columns[l].dataIndex,text:n.viewOptions.grid.columns[l].text,type:"number"===n.viewOptions.grid.columns[l].typeRepresentation?"integer":"string"}),!0===n.viewOptions.grid.columns[l].groupableFlag)){let e=n.viewOptions.grid.columns[l].dataIndex;a.push({id:e,text:n.viewOptions.grid.columns[l].text,selectable:!0,isSelected:!1,handler:function(t,i){if(d._opts.useGeneratedToolbar){let t=e,i=!1;d._opts.groupByMenu.forEach(e=>{e.id===t&&"selected"===e.state&&(i=!0)});let o=[];i||o.push(t),d._opts.modelEvents.publish({event:"xmodel-list-view-group-by-action",data:o})}else{var o=d._getItem(i.parent);if(d._actionParentGroupBy=o,o){var n=[];i.id&&(i.isSelected?(o.elements.container.removeClassName("selected"),i.isSelected=!1):(o.elements.container.hasClassName("selected")||o.elements.container.addClassName("selected"),i.isSelected=!0,d._selectedGroupItem=i,n.push(i.id))),d._opts.modelEvents.publish({event:"xmodel-list-view-group-by-action",data:n});var s=i.id,l=i.isSelected;if(o.content.component)o.content.component.items.forEach(function(e){s===e.id&&(l?e.elements.container.hasClassName("selected")||e.elements.container.addClassName("selected"):e.elements.container.removeClassName("selected"))})}}}})}n.viewOptions.customGrouping&&a.push({id:n.viewOptions.customGrouping.label,text:n.viewOptions.customGrouping.label,selectable:!0,isSelected:!1,handler:function(){let e=n.viewOptions.customGrouping.label,t=!1;d._opts.groupByMenu.forEach(i=>{i.id===e&&"selected"===i.state&&(t=!0)}),d._opts.modelEvents.publish({event:"xmodel-list-view-group-by-custom-action",data:{indexes:n.viewOptions.customGrouping.groupedData,isSelected:!t}})}});var d=this;this._opts.modelEvents=s,this._opts.withmultisel=!!n.withmultisel&&n.withmultisel,this._opts.showItemCount=!1!==n.showItemCount||n.showItemCount,this._opts.itemsName=n.toolbarOptions.itemsName,this._opts.itemName=n.toolbarOptions.itemName,!0!==n.toolbarOptions.hideSearchFilter&&(this._opts.filter={enableCache:!0}),n.toolbarOptions.hideSort&&(this._opts.sort=!1),this._opts.showSwitchViewAction=!1,n.viewOptions&&(this._opts.showSwitchViewAction=!0),void 0!==n.toolbarOptions.showSwitchViewAction&&(this._opts.showSwitchViewAction=n.toolbarOptions.showSwitchViewAction),this._opts.withStableActions=n.toolbarOptions.withStableActions,this._opts.stableActions=n.toolbarOptions.stableActions||[],n.toolbarOptions.hideView&&(this._opts.showSwitchViewAction=!1),this._opts.actions=this._getToolbarActions(n.toolbarOptions.actions),this._opts.withClearSort=!!n.toolbarOptions.withClearSort,this._opts.withClearSort&&(this._opts.clearSort=n.toolbarOptions.clearSort),this._opts.multiselActions=n.toolbarOptions.multiselActions?n.toolbarOptions.multiselActions:void 0,this._opts.multiSelectPartialActions=n.toolbarOptions.multiSelectPartialActions?n.toolbarOptions.multiSelectPartialActions:void 0,this._opts.useGeneratedToolbar=!!n.toolbarOptions.useGeneratedToolbar&&n.toolbarOptions.useGeneratedToolbar,this._opts.touchMode=!!n.toolbarOptions.touchMode&&n.toolbarOptions.touchMode,this._opts._hideOnMultiSelection=n.toolbarOptions.hideOnMultiSelection?n.toolbarOptions.hideOnMultiSelection:[],this._opts._showOnOneSelection=n.toolbarOptions.showOnOneSelection?n.toolbarOptions.showOnOneSelection:[],this._opts.groupByMenu=a;var r=n.toolbarOptions.filterActions?n.toolbarOptions.filterActions:[];if(d._opts.filterActions=r,d._opts.showTaggerFilter=n.toolbarOptions.showTaggerFilter,d._opts.showTaggerFilter){let e={id:"taggerFilter",fonticon:"filter",className:"enox-collection-toolbar-filter-activated",text:i._taggerApplied,visibleFlag:!1,handler:function(){}};this._opts.withStableActions?this._opts.stableActions.push(e):this._opts.actions.splice(0,0,e)}if(r.length>0)for(var c=0;c<r.length;c++){var u=r[c],p=[];if(u&&u.actions&&u.actions.length>0){u.actions.forEach(function(t){let i={id:t.id,text:t.text,selectable:t.selectable,selected:!!t.selected&&t.selected,items:t.items?t.items:void 0,multiSelect:!!t.multiSelect&&t.multiSelect};i.handler=function(i,o){let n=void 0;if(o&&o.id){if(d._opts.useGeneratedToolbar){o.selected=!o.selected,o.state=o.selected?"selected":"",n=o.selected,t.handler(o.selected);let e="";d._childrenSelected(u)&&(e="enox-collection-toolbar-filter-activated"),d._collectionToolBar.stableGenToolbar.updateNodeModel("mv-filter",{grid:{semantics:{icon:{className:e}}}})}else n=(d._opts.withStableActions?d._collectionToolBar._actionsFixedIconBar.menu:d._collectionToolBar._actionsIconBar.menu).getItem("mv-filter").content.component.getItem(o.id).selected;e.log("Filter criteria updated!"),d._opts.modelEvents.publish({event:"xmodel-list-collection-toolbar-filter-changed",data:{id:o.id,parentId:o.parentId?o.parentId:void 0,selected:n||!1}})}},p.push(i)});var h={id:u.id,className:u.className?u.className:"",title:u.text,typeRepresentation:"functionIcon",text:u.text,fonticon:u.fonticon,multiSelect:!0,selected:!!u.selected&&u.selected,content:p,handler:function(){}};let t=c;d._opts.useGeneratedToolbar&&(u.actions.forEach((e,t)=>{e.type="CheckItem",e.state=e.selected?"selected":"",e.title=e.text,e.action={};e.action.callback=function(){p[t].handler("",e)};let i=!1;e.items&&e.items.length>0&&(e.type="PushItem",e.submenu=[],e.items.forEach(o=>{o.type="CheckItem",o.title=o.text,o.state=o.selected?"selected":"",o.selected&&(i=!0),o.action={};o.action.callback=function(){p[t].handler("",o)},e.submenu.push(o)}),e.items="",i&&(e.isSelected=!0,e.state="selected"))}),h.content="",h.value=function(e){let i=e.dsModel&&e.dsModel.elements&&e.dsModel.elements.container;i||(i=e.context.toolbar.elements.dropdownButtonContainer),d._opts.modelEvents.publish({event:"enox-collection-toolbar-display-menu",data:{menu:d._opts.filterActions[t].actions,container:i}})}),this._opts.withStableActions?this._opts.stableActions.push(h):this._opts.actions.splice(0,0,h)}}if(e.is(this._opts.actions,"array")&&a.length>0){let e;e=n.toolbarOptions.groupByActionIndex>-1?n.toolbarOptions.groupByActionIndex:this._opts.actions.length;let t={typeRepresentation:"functionIcon",id:"groupByAction",className:"group-by-action",title:i._groupByAction,text:i._groupByAction,fonticon:"group",content:a,handler:function(){}};if(this._opts.useGeneratedToolbar){t.content="";let e=[];a.forEach(t=>{let i={};i={id:t.id,title:t.text,type:"CheckItem",state:t.isSelected?"selected":"",action:{callback:t.handler}},e.push(i)}),d._opts.groupByMenu=e,t.value=function(e){let t=e.dsModel.elements.container;d._opts.modelEvents.publish({event:"enox-collection-toolbar-display-menu",data:{menu:d._opts.groupByMenu,container:t}})},this._opts.stableActions||(this._opts.stableActions=[]),this._opts.stableActions.push(t)}else this._opts.actions.splice(e,0,t)}this._collectionToolBar=new t(this._opts),this._subscribeEvents(),this._initSort()};return o.prototype._childrenSelected=function(e){let t=this;if(!e.actions&&!e.submenu){return!!e.selected}let i=e.actions||e.submenu;for(let e=0;e<i.length;e++){if(i[e].selected)return!0;if(i[e].submenu&&i[e].submenu.length>0){if(t._childrenSelected(i[e]))return!0}}return!1},o.prototype._updateGroupByMenu=function(e){let t=[];return this._opts.groupByMenu.forEach(i=>{i.id===e&&"selected"===i.state?(i.state="",i.isSelected=!1):i.id==e?i.state="selected":i.id===e?(i.state="selected",i.isSelected=!0,t.push(e)):(i.state="",i.isSelected=!1)}),t},o.prototype._getSelectedState=function(){let e=this._model.getXSO().get().length,t=0;this._model.getChildren().forEach(e=>{e.isHidden()||t++});let i=0;return e===t?i=1:e>0&&e<t&&(i=2),{selectedState:i,selectedItems:e}},o.prototype._subscribeEvents=function(){var e=this;this._opts.modelEvents.subscribe({event:"xmodel-list-item-on-add-selection"},function(){let t=e._getSelectedState();e._opts.withStableActions||e._showMultiselectActions.length>0?e._showMultiselectActions.forEach(t=>{-1===e._hiddenActions.indexOf(t)&&e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!0}})}):e._multiselectActions.forEach(function(t){-1===e._disabledActions.indexOf(t)&&e._opts.modelEvents.publish({event:"enox-collection-toolbar-enable-action",data:t})}),e._opts.useGeneratedToolbar&&(e._opts.withmultisel&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:t.selectedItems}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:t.selectedState})),t.selectedItems>1&&e._opts._hideOnMultiSelection&&e._opts._hideOnMultiSelection.forEach(t=>{e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})}))}),this._opts.modelEvents.subscribe({event:"xmodel-list-item-on-remove-selection"},function(){let t=e._getSelectedState();e._opts.useGeneratedToolbar&&(e._opts.withmultisel&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:t.selectedItems}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:t.selectedState})),1===t.selectedItems&&(0==e._opts._showOnOneSelection.length||e._opts._showOnOneSelection&&e._opts._showOnOneSelection.includes(e._model.getXSO().get()[0].options.grid.isA))&&e._opts._hideOnMultiSelection&&e._opts._hideOnMultiSelection.forEach(t=>{e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!0}})}))}),this._opts.modelEvents.subscribe({event:"xmodel-list-item-on-empty-selection"},function(){e._opts.useGeneratedToolbar&&(e._opts.withmultisel&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:0}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:0})),e._showMultiselectActions.forEach(t=>{e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})}))}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-hide-action"},function(t){e._hiddenActions.indexOf(t)<0&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}}),e._hiddenActions.push(t))}),this._opts.modelEvents.subscribe({event:"xmodel-list-tagger-on-filter-change"},function(t){if(e._opts.showTaggerFilter){let i=t.condition.length>0;e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"taggerFilter",flag:i}})}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-show-action"},function(t){var i=e._hiddenActions.indexOf(t);if(i>-1){if(e._hiddenActions.splice(i,1),e._showMultiselectActions.indexOf(t)>-1&&0===e._model.getSelectedNodes().length)return void e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}});e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!0}})}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-disable-action"},function(t){e._disabledActions.indexOf(t)<0&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-disable-action",data:t}),e._disabledActions.push(t))}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-enable-action"},function(t){var i=e._disabledActions.indexOf(t);if(i>-1){if(e._disabledActions.splice(i,1),e._multiselectActions.indexOf(t)>-1&&0===e._model.getSelectedNodes().length)return void e._opts.modelEvents.publish({event:"enox-collection-toolbar-disable-action",data:t});e._opts.modelEvents.publish({event:"enox-collection-toolbar-enable-action",data:t})}}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(t){var i=t.searchValue[0]||"";e._opts.modelEvents.publish({event:"xmodel-list-context-search-action",data:i})}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-select-inversion"},function(){e._opts.modelEvents.publish({event:"xmodel-list-view-select-inversion"})}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-all-selected"},function(){e._opts.modelEvents.publish({event:"xmodel-list-view-all-selected"}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:1})}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-all-unselected"},function(){e._opts.modelEvents.publish({event:"xmodel-list-view-all-unselected"}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:0})}),this._opts.modelEvents.subscribe({event:"xmodel-list-view-group-by-action"},function(t){var o;if(e._opts.useGeneratedToolbar)return t&&(t.length&&1===t.length?t=t[0]:t.length>=2&&(t=i.DIMENSION+", "+i.UNIT)),void e._updateGroupByMenu(t);if(t&&t.length>0){var n={actionId:"groupByAction",contentId:t};if(!e._selectedGroupItem){var s=e._collectionToolBar._options.actions;if(s&&s.length>0){for(var l=0;l<s.length;l++)if("groupByAction"===s[l].id&&s[l].content&&s[l].content.length>0){o=s[l].content;break}if(o&&o.length>0)for(var a=0;a<o.length;a++)o[a].id===t[0]&&(e._selectedGroupItem=o[a]);var d=e._collectionToolBar._container.querySelector(".group-by-action");d&&(d.hasClassName("selected")?d.removeClassName("selected"):d.addClassName("selected"));var r=e._collectionToolBar._actionsIconBar.menu.getItem("groupByAction");if(r.content&&r.content.options&&r.content.options.items)r.content.options.items.forEach(function(e){e.id===t[0]&&(e.isSelected=!0,e.selected=!0)})}}var c=[],u=e._getItem("groupByAction"),p=t[0];if(u.content.options.items.forEach(function(e){p!==e.id&&c.push(e.id)}),c.length>0&&c.forEach(function(t){var i=e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t);i&&i.elements.container.hasClassName("selected")&&i.elements.container.removeClassName("selected")}),e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t[0])){var h=e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t[0]);h.elements.container.hasClassName("selected")||h.elements.container.addClassName("selected")}e._opts.modelEvents.publish({event:"enox-collection-toolbar-action-item-selection",data:n})}else{var _=e._collectionToolBar._actionsIconBar.menu.getItem("groupByAction");if(_&&_.content&&_.content.component&&_.content.component.items){var m=_.content.component.items;m&&m.forEach(function(t){if(t.elements.container){var i=t.elements.container;i.hasClassName("selected")&&i.removeClassName("selected")}var o=e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t.id);o&&o.elements.container.hasClassName("selected")&&o.elements.container.removeClassName("selected")})}}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-group-visibility"},function(t){if(e._opts.useGeneratedToolbar)e._collectionToolBar.stableGenToolbar.updateNodeModel("groupByAction",{visibleFlag:t}),t||e._updateGroupByMenu();else{var i=e._collectionToolBar._container.querySelector(".group-by-action"),o=e._collectionToolBar._actionsIconBar.overflowMenu.elements.container.querySelector(".groupByAction");e._opts.withStableActions&&o&&(o.style.display=t?"":"none"),i&&(t?(i.removeClassName("displaynone"),i.removeClassName("selected"),e._selectedGroupItem&&(e._selectedGroupItem.isSelected=!1,e._selectedGroupItem.elements&&e._selectedGroupItem.elements.container.removeClassName("selected"),e._selectedGroupItem=null)):i.addClassName("displaynone"))}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-update-switch-view"},function(t){e._opts.modelEvents.publish({event:"enox-collection-toolbar-select-view",data:{id:t,silent:!0}})}),this._opts.modelEvents.subscribe({event:"xmodel-list-data-on-search-complete"},function(){let t=e._getSelectedState();e._opts.useGeneratedToolbar&&e._opts.withmultisel&&e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:t.selectedState})}),this._opts.modelEvents.subscribe({event:"xmodel-list-collection-toolbar-update-filter-menu-status"},function(e){if(e&&e.id){var t=document.getElementById(e.id);t&&(!0===e.selected&&!1===t.hasClassName("selected")?t.addClassName("selected"):!1===e.selected&&!0===t.hasClassName("selected")&&t.removeClassName("selected"))}})},o.prototype._getItem=function(e){if(this._opts.useGeneratedToolbar){let t;return this._collectionToolBar.genToolbar.getNodeModelByID(e)&&(t=this._collectionToolBar.genToolbar),this._collectionToolBar.stableGenToolbar.getNodeModelByID(e)&&(t=this._collectionToolBar.stableGenToolbar),t.getNodeModelByID(e)}return this._collectionToolBar._actionsIconBar.getItem(e)},o.prototype._initMaps=function(){this._localMap_text={},this._localMap_text.DataGridView=i._dataGridView,this._localMap_text.TileView=i._tileView,this._localMap_text.ThumbnailView=i._thumbnailView,this._localMap_text.LargeThumbnailView=i._largeTileView,this._localMap_fonticon={},this._localMap_fonticon.DataGridView="view-list",this._localMap_fonticon.TileView="view-small-tile",this._localMap_fonticon.ThumbnailView="view-big-thb",this._localMap_fonticon.LargeThumbnailView="view-big-tile"},o.prototype._getToolbarActions=function(t){var i=[];this._multiselectActions=[],this._hiddenActions=[],this._showMultiselectActions=[];var o=this;return t.forEach(function(t){var n={handler:function(i,n,s){var l=[];if(t.callSubMenuHandler&&n&&e.is(n.handler,"function"))e.log("Nothing, as event would be fired by UIKIT and be handled in respective handler.!!!");else{if(t.allowSelectRetain)s&&s.hasOwnProperty("selected")&&l.push(s.selected);else if(t.enableOnSelection||t.showOnSelection){var a=[];o._model.getSelectedNodes().forEach(function(e){a.push(e.options)}),l.push(a),l.push(o._model.getSelectedNodes()),this&&this.id&&l.push(this)}0==l.length&&(l.push(o._model),l.push(o._collectionToolBar)),t.handler.apply(o._model,l)}}};t.enableOnSelection&&(n.disabled=!0,o._multiselectActions.push(t.id)),t.showOnSelection&&o._showMultiselectActions.push(t.id),t.visibility&&o._hiddenActions.push(t.id),e.merge(n,t),i.push(n)}),i},o.prototype.hideActions=function(){var e=this;(this._opts.withStableActions||this._showMultiselectActions.length>0)&&this._showMultiselectActions.forEach(function(t){e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})}),this._hiddenActions.length>0&&this._hiddenActions.forEach(function(t){e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})})},o.prototype.inject=function(e){this._collectionToolBar.inject(e),this.hideActions()},o.prototype.attachResizeSensor=function(){},o.prototype._initSort=function(){var t=this;this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(i){if(i&&i.sortAttribute&&i.sortOrder){e.log("sorting tree on "+i.sortAttribute+" "+i.sortOrder);var o={dataIndex:i.sortAttribute,sort:i.sortOrder.toLowerCase(),id:i.sortAttribute,order:i.sortOrder.toLowerCase()};t._collectionToolBar._activateCurrentSort(o),t._opts.modelEvents.publish({event:"xmodel-list-data-sort-action",data:o})}})},o}),define("DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension",["UWA/Core","UWA/Class","DS/TreeModel/TreeNodeModel","DS/ENOXWildcardSearchComponent/ENOXWildcardSearchComponent","DS/PlatformAPI/PlatformAPI"],function(e,t,i,o,n){"use strict";return t.extend({_id:"data-extention",initialize:function(e){this._viewId=e.id,this._model=e.model,this._dataNodeMap={},this._useAsyncExpand=e.useAsyncExpand,this._dataFilters={},this._searchFilters={},this._FILTER_ATTRIBUTES=e.filterAttributes?e.filterAttributes:["id","name","title","description","revision","responsible","owner","creator","maturity",{internal:"state",nlsValue:"nlsState"},{internal:"type",nlsValue:"nlsType"}],this._modelEvents=e.modelEvents,this._childKeys=e.childKeys?e.childKeys:[],this._filterData={},this._searchFilter={},this._wildCardSearchComponent=new o,this._isFilterDataUpdating=void 0,this._filterNodeLevel=0,this._defaultNodeDepth=e.defaultNodeDepth?e.defaultNodeDepth:0,this._keepSelectionOnHide=!!e.keepSelectionOnHide&&e.keepSelectionOnHide,this.subscribeEvents()},subscribeEvents:function(){var t=this;this._modelEvents.subscribe({event:"xmodel-list-data-on-load-complete"},function(){}),this._modelEvents.subscribe({event:"xmodel-list-data-load-action"},function(i){t._loadData(i,e.is(this,"object")?this:void 0)}),this._modelEvents.subscribe({event:"xmodel-list-data-item-append-action"},function(i){t._loadData(i,e.is(this,"object")?this:void 0,{append:!0})}),this._modelEvents.subscribe({event:"xmodel-list-data-item-add-update-action"},function(e){t._addOrUpdateDataItem(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-item-add-action"},function(i){var o=t._addDataItem(i,e.is(this,"object")?this:void 0);t._modelEvents.publish({event:"xmodel-list-data-item-on-add-complete",data:o,context:o})}),this._modelEvents.subscribe({event:"xmodel-list-data-item-replace-action"},function(i){var o=i.source,n=i.target,s=i.context;t._updateDataItem(o,e.is(s,"object")?dataItem.context:void 0,n)}),this._modelEvents.subscribe({event:"xmodel-list-add-many-items"},function(i){var o=t._addDataItem(i,e.is(this,"object")?this:void 0);t._modelEvents.publish({event:"xmodel-list-data-item-on-add-complete",data:o,context:o})}),this._modelEvents.subscribe({event:"xmodel-list-data-item-remove-action"},function(e){t._removeDataItem(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-item-remove-and-parent"},function(e){t._removeDataItem(e,void 0,!0)}),this._modelEvents.subscribe({event:"xmodel-list-data-item-update-action"},function(i){t._updateDataItem(i,e.is(i.context,"object")?i.context:void 0)}),this._modelEvents.subscribe({event:"xmodel-list-data-update-action"},function(e){t._updateData(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-filter-action"},function(e){let i=t.filter(e);t._modelEvents.publish({event:"xmodel-list-tagger-update-filtered-item",data:i})}),this._modelEvents.subscribe({event:"xmodel-list-data-search-action"},function(e){t._wildCardSearch(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-set-filter-node-level"},function(i){e.is(i,"number")&&(t._filterNodeLevel=i)}),this._modelEvents.subscribe({event:"xmodel-list-get-filtered-data"},function(i){t._getFilteredData().then(function(){e.is(i,"function")&&i(t._filterData)})}),this._model.subscribe({event:"matchSearch"},function(e){e.data.nodeModel.show()}),this._model.subscribe({event:"unmatchSearch"},function(e){e.data.nodeModel.hide(t._keepSelectionOnHide)}),n.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(e){(e&&e.data&&e.data.authored&&e.data.authored.modified?e.data.authored.modified:[]).forEach(function(e){e&&t._model.search({shouldStop:function(i){return i.options.id===e&&(t._modelEvents.publish({event:"xmodel-list-data-item-need-refresh",data:e,context:i}),!0)}})})}),this._modelEvents.subscribe({event:"xmodel-list-data-add-wait-for-search"},function(){t._waitForSearch=!0}),this._modelEvents.subscribe({event:"xmodel-list-data-remove-wait-for-search"},function(){var e;for(var i in t._waitForSearch=!1,t._searchFilters)t._searchFilters.hasOwnProperty(i)&&(e={id:i,content:t._searchFilters[i]});e&&t._wildCardSearch(e)}),this._modelEvents.subscribe({event:"xmodel-list-add-columns"},function(i){e.is(i,"array")&&i.length>0&&(i.forEach(e=>{t._FILTER_ATTRIBUTES.push(e.dataIndex)}),t._isFilterDataUpdating=null)})},_loadData:function(t,i,o){var n=this._model,s=void 0!==o&&o.append;i&&e.is(i,"object")&&(n=i),n.prepareUpdate(),n.removeRoots&&!s?(n.ungroupRoots(),n.removeRoots()):n.removeChildren&&!s&&n.removeChildren(),this._modelEvents.publish({event:"xmodel-list-reset-sort-model",data:{}}),t&&t.member&&(this._isFilterDataUpdating=!1,this._loadChildData(t,n),this._modelEvents.publish({event:"xmodel-list-view-update-grouping-action",data:n})),n.pushUpdate(),this._updateFilterData()},_loadChildData:function(e,t){var o=this,n=[];e.member.forEach(function(e,t){var s=o._getNodeOptions(e);if(s){var l=null;if(o._childKeys&&o._childKeys.length>0)for(var a=0,d=o._childKeys.length;a<d;a++){var r=o._childKeys[a];e.hasOwnProperty(r)&&(l=e[r])}o._useAsyncExpand&&l&&(s.children=[]);var c=new i(s);l&&o._loadChildData(l,c),n.push(c),o._dataNodeMap[s.id]=c}}),t.addChild(n)},_removeDataItem:function(t,i,o){var n=this._model;i&&e.is(i,"object")&&(n=i),this._isFilterDataUpdating=!1,n.prepareUpdate(),e.is(t,"array")||(t=[t]);var s=n.search({match:function(e){return-1!==t.indexOf(e.nodeModel.options.id)}});s&&s.forEach(e=>{if(o&&e.getNodeDepth()>0&&0===e.getBrothers().length)return e.getParent().hide(),void e.getParent().remove();e.hide(),e.remove(),delete this._dataNodeMap[e.id]}),n.pushUpdate(),this._updateFilterData()},_updateDataItem:function(t,i,o){if(!i||!e.is(i,"object")){var n=t.id?t.id:t["@id"];n&&this._model.search({shouldStop:function(e){return n===e.options.id&&(i=e,!0)}})}return i&&(i.prepareUpdate(),o||(o=t),i.updateOptions(this._getNodeOptions(o)),i.pushUpdate()),i},_updateData:function(e,t){t&&e.id==t.id?this._updateDataItem(e,t):e.member&&e.member.forEach(t=>{var i=t.id?t.id:t["@id"];i&&this._dataNodeMap.hasOwnProperty(i)?this._updateDataItem(e,this._dataNodeMap[i]):this._updateDataItem(e)})},_addDataItem:function(t,o){var n=this._model;o&&e.is(o,"object")&&(n=o),this._isFilterDataUpdating=!1,n.prepareUpdate();var s=n.getChildren()?n.getChildren().length:0,l=new i(this._getNodeOptions(t));if(l)return!o&&this._useAsyncExpand&&(l.options.children=[]),n.addChild(l,s),n.pushUpdate(),this._updateFilterData(),l},_addOrUpdateDataItem:function(t){var i,o,n,s,l=t.item,a=t.parent;if(a)switch((o=this._model.search({match:function(e){return e.nodeModel.options.id===a.id&&e.nodeModel}})).length){case 0:n=this._addDataItem(a),this._addDataItem(l,n);break;case 1:0===this._model.search({match:function(e){return e.nodeModel.options.id===l.id&&e.nodeModel}}).length&&(this._addDataItem(l,o[0]),this._updateDataItem(a,o[0]));break;default:e.log("Caution find many parent node with identical ID","warn")}else switch((o=this._model.search({match:function(e){return e.nodeModel.options.id===l.id&&e.nodeModel}})).length){case 0:var d;for(n=this._addDataItem(l),i=0;i<this._childKeys.length;i++)if(l[this._childKeys[i]]){d=this._childKeys[i];break}if((s=d?l[d].member:[])&&s.length>0)for(i=0;i<s.length;i++)this._addDataItem(s[i],n);break;case 1:for(i=0;i<this._childKeys.length;i++)if(l[this._childKeys[i]]){d=this._childKeys[i];break}if((s=l[d].member).length>0){for(let e=0;e<s.length;e++)this._model.search({match:function(t){return t.nodeModel.options.id===s[e].id&&t.nodeModel}}).length>0||this._addDataItem(s[e],o[0]);this._updateDataItem(l,o[0])}break;default:e.log("Caution find many parent node with identical ID","warn")}},_getNodeOptions:function(e){if(e.id){e.id=e.id?e.id:e["@id"];var t=e;return{id:e.id?e.id:e["@id"],label:e.title,description:e.description,subLabel:"",grid:t,icons:e.image?[e.image]:e.thumbnail?[e.thumbnail]:[],thumbnail:e.image?e.image:e.thumbnail?e.thumbnail:"",color:""}}},filter:function(e){var t=[];if(e.id){var i,o=this;this._dataFilters[e.id]=e.content||{},this._model.prepareUpdate();var n=[];for(var s in o._dataFilters)if(o._dataFilters.hasOwnProperty(s)){var l=o._dataFilters[s];if(l.ids||l.xIDs){var a=l.idPrefix||"";i?i=i.filter(function(e){return-1!==l.ids.indexOf(a+e)&&o._filterData.hasOwnProperty(e)}):(i=l.ids.reduce(function(e,t){return a&&t.startsWith(a)&&(t=t.slice(a.length)),o._filterData.hasOwnProperty(t)&&e.push(t),e},[]),l.xIDs&&l.xIDs.length>0&&(0==i.length&&(i=Object.keys(o._filterData)),i=i.filter(function(e){return-1==l.xIDs.indexOf(a+e)&&o._filterData.hasOwnProperty(e)}),n=l.xIDs.reduce(function(e,t){return a&&t.startsWith(a)&&(t=t.slice(a.length)),o._filterData.hasOwnProperty(t)&&e.push(t),e},[])))}}i||(i=[]);this._model.search({match:function(e){return-1!==i.indexOf(e.nodeModel.options.id)||0==i.length&&0!=n.length?(n.includes(e.nodeModel.options.id)?e.nodeModel.unmatchSearch():(e.nodeModel.matchSearch(),t.push(e.nodeModel.options.id)),o._matchParent(e,i,t,n),!0):(e.nodeModel.unmatchSearch(),!1)},shouldStop:function(e){return e.getNodeDepth()>o._filterNodeLevel+o._defaultNodeDepth}});let d=o._model.getAllDescendants();if(i.length==d.length){o._model.getChildren().forEach(e=>{let t=e.getChildren();if(Array.isArray(t)&&t.length>0){let i=!1,o=!1;for(let e=0;e<t.length&&!i;e++)o=!(!(i=!(i||!t[e].isMatchingSearch()))||!t[e].isVisible());i&&o?e.setState({state:"expanded"}):i&&!o&&e.setState({state:"collapsed"})}else e.setState({state:"noChildren"})})}this._model.pushUpdate(),this._modelEvents.publish({event:"xmodel-list-data-on-update"})}return t},_matchParent:function(e,t,i,o){var n=e.nodeModel.getNodeDepth();if(n>0)for(var s=e.nodeModel.getParent();n>0;)n--,s&&(s.isMatchingSearch()||(o.includes(s.options.id)?(s.unmatchSearch(),s.getChildren().forEach(e=>{if(i.includes(e.options.id)){let t=i.indexOf(e.options.id);i.splice(t,1)}})):(s.matchSearch(),-1===t.indexOf(s.options.id)&&i.push(s.options.id))),s=s.getParent())},_createFilterDataForNodes:function(t){var i=this;t&&t.getChildren().forEach(function(t){i._filterData[t.options.id]=i._FILTER_ATTRIBUTES.reduce(function(i,o){return i||(i={}),"object"==typeof o?e.is(t.options.grid.nlsValues)&&e.is(t.options.grid.nlsValues[o.nlsValue])?i[o.internal]=t.options.grid.nlsValues[o.nlsValue]:e.is(o.getAttribute,"function")?i[o.internal]=o.getAttribute(t):i[o.internal]=t.options.grid.hasOwnProperty(o.internal)?t.options.grid.hasOwnProperty(o.internal):"":t.options.grid.hasOwnProperty(o)&&null!=t.options.grid[o]&&e.is(t.options.grid[o].toString,"function")?i[o]=t.options.grid[o].toString():i[o]=t.options.grid.hasOwnProperty(o)?t.options.grid[o]:"",i},{}),t.hasChildren()&&i._createFilterDataForNodes(t)})},_updateFilterData:function(){var t=this;return t._filterData={},new e.Promise(function(e,i){try{t._createFilterDataForNodes(t._model),e()}catch(e){t._filterData={},i()}t._modelEvents.publish({event:"xmodel-list-filter-data-update-complete"}),t._isFilterDataUpdating=!1})},_getFilteredData:function(){var t=this;return new e.Promise(function(e){if(!1===t._isFilterDataUpdating)return e();t._modelEvents.subscribeOnce({event:"xmodel-list-filter-data-update-complete"},function(){e()}),t._isFilterDataUpdating||t._updateFilterData()})},_wildCardSearch:function(e){var t=this;if(e.id){this._searchFilters[e.id]=e.content||{};var i=e.content;if(this._waitForSearch&&i.value)return void this._modelEvents.publish({event:"xmodel-list-content-show-loader"});this._modelEvents.publish({event:"xmodel-list-content-hide-loader"}),this._getFilteredData().then(function(){var o=Object.keys(t._filterData).map(function(e){return t._filterData[e]});t._wildCardSearchComponent.search(i.value,o,function(i){var o=[];i&&(o=i.map(function(e){return e.id}));var n=t.filter({id:e.id,content:{ids:o}});t._modelEvents.publish({event:"xmodel-list-data-on-search-complete",data:n})},["id"])})}},destroy:function(){}})}),define("DS/ENOXModelListView/ModelListView/js/ModelListViewTaggerExtension",["UWA/Core","UWA/Class","DS/ENOXTaggerOnIndexComponent/ENOXTaggerOnIndexComponent"],function(e,t,i){"use strict";return t.extend({_id:"tagger-extention",initialize:function(e){this._taggerId=e.id,this._model=e.model,this._modelEvents=e.modelEvents,this._friendTags=[],this.subscribeEvents(),this._taggerComponent=i},subscribeEvents:function(){var t=this;this._modelEvents.subscribe({event:"xmodel-list-data-on-load-complete"},function(){t._modelEvents.publish({event:"xmodel-list-get-filtered-data",data:function(e){t._setupTagger(e?Object.keys(e):[])}})}),this._modelEvents.subscribe({event:"xmodel-list-data-update-subjects"},function(e){t._taggerComponent.getTagProxy(t._taggerId)&&(t._taggerComponent.removeSubjects(t._taggerId,e),t._taggerComponent.publishTags(t._taggerId))}),this._modelEvents.subscribe({event:"xmodel-list-view-open-tagger"},function(){t.openTagger()}),this._modelEvents.subscribe({event:"xmodel-list-view-close-tagger"},function(){t.closeTagger()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-activate-action"},function(){t._activateTagger()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-deactivate-action"},function(){t._deactivateTagger()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-update-friend-tags-action"},function(i){e.is(i,"array")&&(t._friendTags=i)}),this._modelEvents.subscribe({event:"xmodel-list-data-on-search-complete"},function(e){t._filterTagger(e,!0)}),this._modelEvents.subscribe({event:"xmodel-list-tagger-update-filtered-item"},function(e){t._filterTagger(e,!0)}),this._modelEvents.subscribe({event:"xmodel-list-tagger-focus-action"},function(e){var i=[];e.forEach(function(e){i.push(e.options.grid.id)}),t._focusOnSubjects(i)}),this._modelEvents.subscribe({event:"xmodel-list-tagger-unfocus-action"},function(){t._unfocus()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-init-action"},function(e){t._modelEvents.publish({event:"xmodel-list-get-filtered-data",data:function(e){t._setupTagger(e?Object.keys(e):[])}})}),this._modelEvents.subscribe({event:"xmodel-list-tagger-set-filter-action"},function(e){t._taggerComponent.setLocalFilter(t._taggerId,e)}),this._modelEvents.subscribe({event:"xmodel-list-tagger-get-filter-action"},function(i){if(e.is(i,"function")){var o=t._taggerComponent.getTagProxy(t._taggerId);if(o)i(o.getCurrentFilter())}})},_setupTagger:function(t){e.log("set up tagger");var i=this,o={MyFriends:i._friendTags,onSetTagProxy:function(){i._modelEvents.publish({event:"xmodel-list-tagger-on-setup"})},onTagFilterChange:function(e){if(e.content&&(Array.isArray(e.content.ids)&&e.content.ids.length>=0||Array.isArray(e.content.xIDs)&&e.content.xIDs.length>0)){let t=i._taggerComponent.getTagProxy(i._taggerId).getCurrentFilter();i._modelEvents.publish({event:"xmodel-list-data-filter-action",data:e}),i._modelEvents.publish({event:"xmodel-list-tagger-on-filter-change",data:t.allfilters})}},onTagColor:function(e){var t={};if(e.coloredSubjects)for(var o in e.coloredSubjects)e.coloredSubjects.hasOwnProperty(o)&&(t[o.slice(6)]=e.coloredSubjects[o]);i._setDataColor(t)},onTagUncolor:function(){i._unsetDataColor()},colorize:!0,subjectPrefix:"pid://",exclude:!0},n=t||[];this._taggerComponent.killTagProxy(this._taggerId),this._taggerComponent.setTagProxy(this._taggerId,o,n)},_getDataIds:function(){var e=[],t=this._model.getChildren();return t&&t.forEach(function(t){var i=t.options.id||t._id;e.push(i)}),e},_setDataColor:function(e){this._modelEvents.publish({event:"xmodel-list-set-color-visibility-action",data:!0}),this._model.search({match:function(t){return!!e.hasOwnProperty(t.nodeModel.options.id)&&(t.nodeModel.prepareUpdate(),t.nodeModel.updateOptions({color:e[t.nodeModel.options.id]}),t.nodeModel.setAttribute("color",e[t.nodeModel.options.id]),t.nodeModel.pushUpdate(),!0)}})},_unsetDataColor:function(){this._modelEvents.publish({event:"xmodel-list-set-color-visibility-action",data:!1}),this._model.prepareUpdate(),this._model.search({match:function(e){return!!e.nodeModel.options.id&&(e.nodeModel.updateOptions({color:""}),e.nodeModel.setAttribute("color","#00FFFFFF"),!0)}}),this._model.pushUpdate()},_filterTagger:function(e,t){this._taggerComponent.getTagProxy(this._taggerId)&&this._taggerComponent.filterTags(this._taggerId,e,t)},_focusOnSubjects:function(e){this._taggerComponent.getTagProxy(this._taggerId)&&this._taggerComponent.focusOnSubjects(this._taggerId,e)},_unfocus:function(){this._taggerComponent.unfocus(this._taggerId)},_activateTagger:function(){let e={deactivateOthers:!0};this._taggerComponent.getTagProxy(this._taggerId)&&this._taggerComponent.activate(this._taggerId,e)},_deactivateTagger:function(){this._taggerComponent.deactivate(this._taggerId)},destroy:function(){this._taggerComponent.killTagProxy(this._taggerId)},openTagger:function(){},closeTagger:function(){}})}),define("DS/ENOXModelListView/ModelListView/js/ModelListView",["UWA/Core","DS/ENOXModelListView/ModelListView/js/ModelListViewCollectionToolBar","DS/ENOXModelListView/ModelListView/js/ModelListViewEmptyContent","DS/DataGridView/DataGridView","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/UIKIT/Mask","DS/Utilities/Dom","DS/Core/PointerEvents","DS/TreeModel/TreeDocument","DS/Controls/ProgressBar","DS/Utilities/TouchUtils","DS/Controls/ResponsiveThumbnailView","i18n!DS/ENOXModelListView/assets/nls/ModelListView","css!ENOXModelListView/ModelListView/css/ModelListView.css"],function(e,t,i,o,n,s,l,a,d,r,c,u,p,h,_){"use strict";var m=function(t){t.hasOwnProperty("toolbarOptions")&&t.toolbarOptions.hasOwnProperty("touchMode")&&(this.toolbarTouchMode=t.toolbarOptions.touchMode),this.deviceTouchMode=p.getTouchMode(),this._displayProperties=["contextualMenu","description","propertiesList"],this.MOBILE_BREAKPOINT=550,this._withToolBar=void 0===t.withToolBar||t.withToolBar,this._withProgressBar=void 0!==t.withProgressBar&&t.withProgressBar,this.securityContext=t.securityContext?t.securityContext:"",this._initDivs(),t.viewOptions||(t.viewOptions={}),t.model||(t.model=new c({})),this._filterAttributes=t.filterAttributes?t.filterAttributes:"",this._model=t.model,this._options=t,this._id=t.id||"ViewId",this._useAsyncExpand=!0===t.useAsyncExpand,this._model.options.useAsyncPreExpand=this._useAsyncExpand,this._groupedRows=[],this._visibleCustomAttributeColumns=[],this._modelEvents=t.modelEvents,this.useDragAndDrop=t.useDragAndDrop||!1,this.showStatusBar=!!t.showStatusBar&&t.showStatusBar;var i=t.extensions||[];if(this._initExtensions_v1(i),this._withToolBar&&this._initToolBar(this._model,t),this._initListView(t.viewOptions),null!==t.emptyContentOptions&&this._initEmptyContent(this._model,t),this._subscribeEvents(),window.widget&&e.is(window.widget,"object")){var o=this;window.widget.addEvent("onSearch",function(e){o._modelEvents.publish({event:"xmodel-list-dashboard-search-action",data:e})}),window.widget.addEvent("onResetSearch",function(){o._modelEvents.publish({event:"xmodel-list-dashboard-search-action",data:""})}),window.widget.addEvent("onViewChange",function(){o.updateTagFocus()})}};return m.prototype.getDataIndexFromColumnIndex=function(e){var t=this._contentViews.DataGridView;if(t&&e)return t.layout.getDataIndexFromColumnIndex(e)},m.prototype.getColumnIndex=function(e){var t=this._contentViews.DataGridView;if(t&&e)return t.layout.getColumnIndex(e)},m.prototype.getDataGridView=function(){return this._contentViews.DataGridView},m.prototype.removeColumnOrGroup=function(e){var t=this._contentViews.DataGridView;t&&e&&t.removeColumnOrGroup(e)},m.prototype._setCurrentViewRowGroups=function(e){this._contentViews.DataGridView.getCustomViewsManager().addCustomView({identifier:"Current View",columnsVisibleFlag:{dimension:!1,unit:!1},groupingOptions:{dataIndexesToGroup:e}},!0)},m.prototype._subscribeEvents=function(){var t=this;this._modelEvents.subscribe({event:"xmodel-list-hide-status-bar"},function(){t._views.forEach(function(e){t._contentViews[e].displayedOptionalCellProperties&&(t._displayProperties=["contextualMenu","description","propertiesList"],t._contentViews[e].displayedOptionalCellProperties=t._displayProperties,t.refresh())})}),this._modelEvents.subscribe({event:"xmodel-list-show-status-bar"},function(){t._views.forEach(function(e){t._contentViews[e].displayedOptionalCellProperties&&(t._displayProperties=["contextualMenu","description","propertiesList","statusbarIcons"],t._contentViews[e].displayedOptionalCellProperties=t._displayProperties,t.refresh())})}),this._modelEvents.subscribe({event:"xmodel-list-view-set-tagger-context"},function(e){let i=e.tagsActivated,o=i?"activate":"deactivate";t._modelEvents.publish({event:`xmodel-list-tagger-${o}-action`}),e.showFocusedState&&t._showListViewSelected(i)}),this._modelEvents.subscribe({event:"xmodel-list-add-columns"},function(i){if(i&&i.length>0){var o=t._contentViews.DataGridView;o?(o.prepareUpdateView(),i.forEach(function(e){var t=o.columns.length>0?o.columns.length-1:void 0;o.addColumnOrGroup(e,t)}),o.pushUpdateView()):e.log("Warning, DGV instance does not exists!")}}),this._modelEvents.subscribe({event:"xmodel-list-update-progress-bar"},function(e){t._progressBar&&void 0!==e&&(t._progressBar.value=e,e>=100&&setTimeout(function(){t._progressBarContainer.classList.add("displaynone")},200))}),this._modelEvents.subscribe({event:"xmodel-list-update-empty-content"},function(e){t._ModelListViewEmptyContent.destroy(),t._emptyContainer.remove(),t._initEmptyContent(t._model,e)}),this._modelEvents.subscribe({event:"xmodel-list-show-progress-bar"},function(){t._progressBarContainer&&t._progressBarContainer.classList.contains("displaynone")&&t._progressBarContainer.classList.remove("displaynone")}),this._modelEvents.subscribe({event:"xmodel-list-hide-progress-bar"},function(){!1===t._progressBarContainer.classList.contains("displaynone")&&t._progressBarContainer.classList.add("displaynone")}),this._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(e){t._viewIdToolbar=e,t._groupedRows.length>0?(t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:[]}),setTimeout(function(){t._switchView(e)},500)):t._switchView(e),t._modelEvents.publish({event:"xmodel-list-toolbar-group-visibility",data:"DataGridView"===e})}),this._modelEvents.subscribe({event:"xmodel-list-view-update-column-definition"},function(e){if("DataGridView"===t._currentView){let i=t._contentViews[t._currentView];e.forEach(e=>{i.layout.setColumnOrGroupProperties(e.dataIndex,e.properties)})}}),this._model.subscribe({event:"addChild"},async function(e){let i=e.data.nodeModel;var o=await t._getContextualMenu(i);i.prepareUpdate(),i.options.contextualMenu=o,i.pushUpdate(),t._onDataUpdate()}),this._model.subscribe({event:"removeChild"},function(){t._onDataUpdate()}),this._model.subscribe({event:"title-link-action"},function(){this.nodeModel.options.id&&t._modelEvents.publish({event:"xmodel-list-title-link-click",data:{model:this.nodeModel.options.grid},context:this.nodeModel})}),this._modelEvents.subscribe({event:"xmodel-list-view-group-by-custom-action"},function(e){var i=t._contentViews.DataGridView;e.isSelected?t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:e.indexes}):(t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:[]}),i.reapplyRowGrouping())}),this._modelEvents.subscribe({event:"xmodel-list-view-group-by-action"},function(e){e||(e=[]);var i=t._contentViews.DataGridView;i&&(t._groupedRows=e,i.groupRows({dataIndexesToGroup:e}),i.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}),t._modelEvents.publish({event:"xmodel-list-data-set-filter-node-level",data:t._groupedRows.length}))}),this._modelEvents.subscribe({event:"xmodel-list-view-update-grouping-action"},function(i){if(t._contentViews.DataGridView&&i){var o=t._groupedRows;e.is(o,"array")&&o.length>0&&"function"==typeof groupRoots&&i.groupRoots({propertiesToGroup:o}),t._modelEvents.publish({event:"xmodel-list-data-set-filter-node-level",data:t._groupedRows.length})}}),this._modelEvents.subscribe({event:"xmodel-list-view-expand-all-action"},function(){t._model.prepareUpdate(),t._model.expandAll(),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-view-collapse-all-action"},function(){t._model.prepareUpdate(),t._model.collapseAll(),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-view-disble-menu"},function(e){t._model.search({match:function(t){return-1!==e.indexOf(t.nodeModel.options.id)&&(t.nodeModel.prepareUpdate(),t.nodeModel.options.disableMenu=!0,t.nodeModel.pushUpdate(),!0)}});var i=t._contentViews.DataGridView;i&&i.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}),this._modelEvents.subscribe({event:"xmodel-list-data-on-load-start"},function(){t._container&&(a.mask(t._container),t._isLoading=!0)}),this._modelEvents.subscribe({event:"xmodel-list-data-on-load-complete"},function(){t._container&&a.isMasked(t._container)&&(a.unmask(t._container),t._isLoading=!1,"ThumbnailView"===t._currentView&&t._contentViews.ThumbnailView&&(t._container.offsetWidth<t.MOBILE_BREAKPOINT?t._contentViews.ThumbnailView.displayedOptionalCellProperties=["contextualMenu"]:t._contentViews.ThumbnailView.displayedOptionalCellProperties=t._displayProperties,t._contentViews.ThumbnailView.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})))}),this._modelEvents.subscribe({event:"xmodel-list-context-search-action"},function(e){var i={id:"ContextSearch",content:{value:e}};t._modelEvents.publish({event:"xmodel-list-data-search-action",data:i})}),this._modelEvents.subscribe({event:"xmodel-list-dashboard-search-action"},function(e){var i={id:"GlobalSearch",content:{value:e}};t._modelEvents.publish({event:"xmodel-list-data-search-action",data:i})}),this._modelEvents.subscribe({event:"xmodel-list-data-sort-action"},function(e){var i=t._contentViews.DataGridView;i&&(i.sortModel&&1===i.sortModel.length&&i.sortModel[0].dataIndex===e.dataIndex&&i.sortModel[0].sort===e.sort?i.reapplySortModel():i.sortModel=[e])}),this._modelEvents.subscribe({event:"xmodel-list-set-column-visibility-action"},function(e){var i=t._contentViews.DataGridView;i&&i.layout.setColumnVisibleFlag(e.dataIndex,e.visibility)}),this._modelEvents.subscribe({event:"xmodel-list-set-color-visibility-action"},function(e){var i=t._contentViews.DataGridView;i&&(i.showNodeKPIColorFlag=e)}),this._model.getXSO().onPostAdd(function(e){if(Array.isArray(e)&&e.length>0){let i=!1;e.length>1&&(i=!0),t._modelEvents.publish({event:"xmodel-list-item-on-add-selection",data:{model:i?e:e[0].options.grid,items:t._model.getXSO().get(),multiSelect:i},context:i?t._model:e[0].options.grid}),t.updateTagFocus()}}),this._model.getXSO().onPostRemove(function(i){if(!t._isLoading&&Array.isArray(i)&&i.length>0){let o=!1;i.length>1&&(o=!0),t._modelEvents.publish({event:"xmodel-list-item-on-remove-selection",data:{model:o?i:i[0].options.grid,items:t._model.getXSO().get(),multiSelect:o},context:o?t._model:i[0].options.grid}),t._model.getSelectedNodes()&&0===t._model.getSelectedNodes().length&&(e.log("empty selection"),t._modelEvents.publish({event:"xmodel-list-item-on-empty-selection"})),t.updateTagFocus()}}),this._modelEvents.subscribe({event:"xmodel-list-unselect-all"},function(){let e=t._model.getXSO().get();t._model.prepareUpdate(),t._model.getXSO().remove(e),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-select-all"},function(){t._model.selectAll()}),this._modelEvents.subscribe({event:"xmodel-list-enable-contextual-menu"},function(e){t._contextualMenuEnabled=e}),this._modelEvents.subscribe({event:"xmodel-list-select-all-root-nodes"},function(){var e=t._model.getRoots();e&&e.forEach(function(e){e.select()})}),this._modelEvents.subscribe({event:"xmodel-list-selection-action"},function(e){let i=[];t._model.search({match:function(t){return-1!==e.indexOf(t.nodeModel.options.id)&&(i.push(t.nodeModel),!0)}}),i.length>0&&(t._model.prepareUpdate(),t._model.getXSO().add(i),t._model.pushUpdate())}),this._modelEvents.subscribe({event:"xmodel-list-item-get-selection"},function(i){e.is(i,"function")&&i(t._model.getXSO().get().map(function(e){return e.options.grid})||[])}),this._modelEvents.subscribe({event:"xmodel-list-data-on-update"},function(){t._onDataUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-reset-sort-model"},function(){t._contentViews.DataGridView&&(t._contentViews.DataGridView.sortModel=null)}),this._modelEvents.subscribe({event:"enox-collection-toolbar-reset-sort"},function(){t._modelEvents.publish({event:"xmodel-list-reset-sort-model"})}),this._modelEvents.subscribe({event:"enox-collection-toolbar-sort-reset"},function(){t._modelEvents.publish({event:"xmodel-list-reset-sort-model"})}),this._modelEvents.subscribe({event:"xmodel-list-scroll-to-node"},function(e){t._contentViews.DataGridView&&t._contentViews.DataGridView.ensureNodeModelVisible(e,!0)}),this._model.onPreExpand(function(e){t._modelEvents.publish({event:"xmodel-list-view-on-expand",data:{model:e.data.nodeModel.options.grid,nodeInfo:e.data},context:e.data.nodeModel})}),this._modelEvents.subscribe({event:"xmodel-list-view-select-inversion"},function(){let e=t._model.getXSO().get(),i=[];t._model.processDescendants({onlyVisibleNodes:!0,processNode:function(e){let t=e.nodeModel;t.isSelected()&&t._isSelected||i.push(t)}}),t._model.prepareUpdate(),t._model.getXSO().add(i),t._model.getXSO().remove(e),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-view-all-selected"},function(){t._contentViews.DataGridView&&t._contentViews.DataGridView.selectAllVisibleNodes()}),this._modelEvents.subscribe({event:"xmodel-list-view-all-unselected"},function(){t._modelEvents.publish({event:"xmodel-list-unselect-all"})}),this._modelEvents.subscribe({event:"xmodel-list-content-show-loader"},function(){t._listContainer&&a.mask(t._listContainer)}),this._modelEvents.subscribe({event:"xmodel-list-content-hide-loader"},function(){t._listContainer&&a.isMasked(t._listContainer)&&a.unmask(t._listContainer)})},m.prototype._initEmptyContent=function(e,t){this._emptyContainer=document.createElement("div"),this._emptyContainer.classList.add("mdllv-empty-container"),this._withToolBar||this._emptyContainer.classList.add("no-toolbar"),this._emptyContainer.classList.add("displaynone"),this._ModelListViewEmptyContent=new i(e,t,this._modelEvents,this._emptyContainer);var o=this;this._modelEvents.subscribe({event:"xmodel-list-is-empty"},function(e){e?o._listContainer.classList.add("displaynone"):o._listContainer.classList.remove("displaynone")}),this._container.appendChild(this._emptyContainer)},m.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("xmodel-list-view"),0==this.toolbarTouchMode&&null==this.deviceTouchMode&&this._container.classList.add("touchmode-off"),this._collectionToolBarContainer=document.createElement("div"),this._collectionToolBarContainer.classList.add("xmdllv-collectiontoolbar-container"),this._listContainer=document.createElement("div"),this._listContainer.classList.add("xmdllv-list-container"),this._withToolBar||(this._listContainer.classList.add("no-toolbar"),this._collectionToolBarContainer.classList.add("no-toolbar")),this._container.appendChild(this._collectionToolBarContainer),this._withProgressBar&&(this._progressBarContainer=document.createElement("div"),this._progressBarContainer.classList.add("xmdllv-list-progress-bar-container"),this._progressBar=new u({displayStyle:"lite",value:10}).inject(this._progressBarContainer),this._progressBar.addEventListener("change",function(e){e.stopPropagation()}),this._container.appendChild(this._progressBarContainer)),this._container.appendChild(this._listContainer)},m.prototype._initToolBar=function(e,i){this._collectionToolBar=new t(e,i,this._modelEvents),this._collectionToolBar.inject(this._collectionToolBarContainer)},m.prototype.attachResizeSensor=function(){},m.prototype._setDragData=function(e,t){for(var i=[],o=0;o<t.length;o++){var n=t[o],s=n?n.options.grid:{id:"",type:"",modelID:""},l={envId:window.widget.getValue("x3dPlatformId"),serviceId:"3DSpace",contextId:window.widget.getValue("xPref_CREDENTIAL")?window.widget.getValue("xPref_CREDENTIAL"):this.securityContext,objectId:s.id,objectType:s.type&&s.type.trim()||"",objectName:s.name||"",displayType:s.type&&s.type.trim()||"",displayName:s.title};i.push(l)}var a={protocol:"3DXContent",version:"1.1",source:window.widget.getValue("appId"),widget_id:window.widget.id,data:{items:i}};e.dataTransfer.setData("Text",JSON.stringify(a)),e.dataTransfer.effectAllowed="all"},m.prototype._getPreferedView=function(e){if(e||(e=this._views),this._viewIdToolbar)return this._viewIdToolbar;if(this._viewIdOption&&e.indexOf(this._viewIdOption)>=0)return this._viewIdOption;if(window.widget){var t=e.includes("DataGridView")?"DataGridView":e[0];return 0!==this._container.offsetWidth&&this._container.offsetWidth<this.MOBILE_BREAKPOINT&&e.includes("TileView")?t="TileView":window.widget.body.offsetWidth<this.MOBILE_BREAKPOINT&&e.includes("TileView")&&(t="TileView"),t}},m.prototype._initListView=function(t){this._views=t.views||["DataGridView"],this._viewIdOption=t.currentView;var i=this._getPreferedView();this._currentView=t.currentView?t.currentView:i,this._expandLabel=t.expandLabel,this._collapseLabel=t.collapseLabel,!1===e.is(t.onDelayedModelDataRequest,"function")&&(t.onDelayedModelDataRequest=void 0),this._contentViews={};var a={height:"inherit",displayedOptionalCellProperties:this._displayProperties,allowUnsafeHTMLContent:!1,model:this._model,onDelayedModelDataRequest:t.onDelayedModelDataRequest};this.showStatusBar&&(this._displayProperties=["contextualMenu","description","propertiesList","statusbarIcons"],a.displayedOptionalCellProperties=this._displayProperties);var d=this,c={callback:async function(e){var t=e.menu?e.menu:[];let i=e.data;var o=e.cellInfos.nodeModel;if(d._contentViews[d._currentView]&&d._contentViews[d._currentView].activeNode){var n=d._contentViews[d._currentView].activeNode;o!==n&&(o=n,t=await d._getContextualMenu(n,i))}if(t instanceof Promise&&(t=await d._getContextualMenu(o,i)),o&&null===o.getChildren())return t;if(o){var s=o.getTreeDocument(),l=!0;let e=0;for(;e<t.length&&l;)"expand"===t[e].id&&(l=!1),e++;if(l){var a=function(e){for(let t=0;t<e.length;t++)if("SeparatorItem"===e[t].type)return t++}(t);t.splice(a,0,{type:"SeparatorItem"}),t.splice(a+1,0,{id:"expand",type:"PushItem",icon:"flow-tree-expand-down",title:d._expandLabel?d._expandLabel:_._expand_content,action:{callback:function(){void 0!==s&&(o.expandAll(),d._modelEvents.publish({event:"xmodel-list-item-node-expanded",data:{item:o,expanded:!0}}))}},state:o.isExpanded()?"disabled":"enabled"}),t.splice(a+2,0,{id:"collapse",type:"PushItem",icon:"flow-tree-expand-up",title:d._collapseLabel?d._collapseLabel:_._collapse_content,action:{callback:function(){void 0!==s&&(o.collapseAll(),d._modelEvents.publish({event:"xmodel-list-item-node-expanded",data:{item:o,expanded:!1}}))}},state:o.isExpanded()?"enabled":"disabled"})}}return t}},u={label:"label",subLabel:"subLabel",description:"description",customTooltip:"customTooltip",icon:"icon"};e.extend(u,t.itemViewMapping||{});var p={getLabel:function(t){return e.is(u.label,"function")?u.label.call(this,t):t.options.grid[u.label]},getSubLabel:function(t){return e.is(u.subLabel,"function")?u.subLabel.call(this,t):t.options.grid[u.subLabel]},getDescription:function(t){return e.is(u.description,"function")?u.description.call(this,t):t.options.grid[u.description]},getCustomTooltip:function(t){return e.is(u.customTooltip,"function")?u.customTooltip.call(this,t):t.options.grid[u.label]},getIcon:function(t){return e.is(u.icon,"function")?u.icon.call(this,t):t.options.grid.image?t.options.grid.image:""}};d.showStatusBar&&(p.getStatusbarIcons=function(t){return e.is(u.statusBarIcon,"function")?u.statusBarIcon.call(this,t):[]},p.getStatusbarLabelsWidthRatios=function(t){return e.is(u.statusbarLabelsWidthRatios,"function")?u.statusbarLabelsWidthRatios.call(this,t):[]},p.getStatusbarIconsTooltips=function(t){return e.is(u.statusbarIconsTooltips,"function")?u.statusbarIconsTooltips.call(this,t):[]},p.onStatusbarIconPointerDown=function(t){return e.is(u.onStatusbarIconPointerDown,"function")?u.onStatusbarIconPointerDown.call(this,t):[]});var h={_preBuild:function(){this._parent(),this._properties.layout.value.columnMaxWidth={0:192,420:240}}};e.merge(h,p);var m=function(e){e.cellView.getContent().setAttribute("node-depth",e.nodeModel.getNodeDepth())};this._views.forEach(function(i){if("DataGridView"===i){var u={showContextualMenuColumnFlag:!!e.is(t.showContextualMenuColumnFlag)&&t.showContextualMenuColumnFlag,onDropRowHeader:e.is(t.onDropRowHeader,"function")?t.onDropRowHeader:void 0,onDelayedModelDataRequest:t.onDelayedModelDataRequest,identifier:t.identifier?t.identifier:d._options.id?d._options.id:void 0,treeDocument:d._model,_useClipboardFlag:!0,cellSelection:"none",defaultColumnDef:{width:"auto",typeRepresentation:"string",groupableFlag:!1,editionPolicy:"EditionOnClick"},onContextualEvent:e.is(t.onContextualEvent)&&(e.is(t.onContextualEvent,"function")||e.is(t.onContextualEvent.callback,"function"))?t.onContextualEvent:async function(e){var t=[];if(!1===d._contextualMenuEnabled)return[];if(e&&e.collectionView&&e.cellInfos){var i=e.cellInfos.columnID,o=e.cellInfos.rowID;0!==i&&1!==i&&-1===o?t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!1}):o>-1&&e.cellInfos.nodeModel&&(t=await d._getContextualMenu(e.cellInfos.nodeModel,e.data))}return t},rowDragEnabledFlag:d.useDragAndDrop,columnDragEnabledFlag:!1,cellDragEnabledFlag:!0,onDragStartRowHeader:function(t,i){var o=this.getTreeDocument()?this.getTreeDocument().getSelectedNodes():[],n=o&&o.length>0?o:[i.nodeModel];void 0!==d._options.setDragData&&e.is(d._options.setDragData,"function")?d._options.setDragData(t,n):d._setDragData(t,n)}},v=t.grid;if(v.columns){for(var g=0,b=v.columns.length;g<b;g++){var f=v.columns[g];f&&"tree"===f.dataIndex&&(f.alwaysVisibleFlag=!0,void 0!==f.sortableFlag&&!1===f.sortableFlag&&(f.sortableFlag=!0),f.minWidth=150),f&&"titleTweaker"===f.typeRepresentation&&(f.getCellValue||(f.getCellValue=function(e){return e.nodeModel?e.nodeModel.options.label:""}),f.setCellValue||(f.setCellValue=function(e,t){e.nodeModel.setLabel(t)}))}t.contextualActions&&!0!==t.showContextualMenuColumnFlag&&(v.columns.unshift({text:_._color,dataIndex:"color",typeRepresentation:"color",pinned:"left",width:"50",visibleFlag:!1}),v.columns.push({text:_._action,dataIndex:"contextualMenu",pinned:"right",width:55,resizableFlag:!1,allowUnsafeHTMLContent:!0,alwaysVisibleFlag:!0,sortableFlag:!1,groupableFlag:!1,typeRepresentation:"contextualMenuType",getCellTooltip:function(e){if(e.nodeModel&&e.nodeModel.options&&e.nodeModel.options.contextualMenu&&1===e.nodeModel.options.contextualMenu.length)return{shortHelp:e.nodeModel.options.contextualMenu[0].title}},getCellValue:function(e){var t={menu:[],disabled:!1};return d._getContextualMenu(e.nodeModel)instanceof Promise&&(t.menu=d._getContextualMenu.bind(d)),e&&e.nodeModel&&e.nodeModel.options&&!0===e.nodeModel.options.disableMenu&&(t.disabled=!0),t}}))}e.extend(u,v),d._contentViews[i]=new o(u),d._contentViews[i].getCustomViewsManager().onCustomViewsSave=function(e,t){var i;for(g=0;g<e.length;g++)if(e[g].identifier===t){i=e[g].columnsVisibleFlag;break}if(i){var o=d._contentViews.DataGridView.layout.columns;for(var n in d._visibleCustomAttributeColumns=[],o){var s=o[n];s.visibleFlag&&d._visibleCustomAttributeColumns.push(s.dataIndex)}}else d._visibleCustomAttributeColumns=[];d._options.modelEvents.publish({event:"xmodel-list-on-save-custom-view",data:d._visibleCustomAttributeColumns}),d._options.modelEvents.publish({event:"xmodel-list-on-custom-view-save",data:i})},d._contentViews[i].addEventListener("allCellsRendered",function(){let e=d._model.getSelectedNodes();if(0===e.length||e.length>1)return;let t=d._model.getSelectedNodes()[0].isExpanded();d._options.modelEvents.publish({event:"xmodel-list-item-node-expanded",data:{item:e,expanded:t}})});var w={contextualMenuType:{stdTemplate:"contextualMenuTemplate",semantics:{}},titleTweaker:{stdTemplate:"titleEditorTemplate",semantics:{}}};if(v.typeRepresentations&&e.is(v.typeRepresentations,"object")&&e.merge(w,v.typeRepresentations),d._typeRepresentationFactory=d._contentViews[i].getTypeRepresentationFactory(),d._typeRepresentationFactory.registerTypeTemplates({contextualMenuTemplate:{path:"DS/ENOXModelListView/ModelListView/js/ContextualMenuTweaker"},titleEditorTemplate:{path:"DS/ENOXModelListView/ModelListView/js/TitleTweaker"}}),d._typeRepresentationFactory.registerTypeRepresentations(w),t.editable){["postEdit"].forEach(function(e){d._contentViews[i].addEventListener(e,function(e,t){if(e.dsModel&&e.dsModel.layout&&t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.grid){var i=[t.nodeModel.options.grid],o=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);"title"==(o=o&&"tree"===o?"title":o)&&null==t.cellModel&&(i[0].prevTitle=i.title,t.cellModel=""),"description"===o&&void 0!==t.nodeModel.options.description&&(i[0].description=t.nodeModel.options.description),void 0!==o&&""!==o&&"basePrice"!==o&&d._modelEvents.publish({event:"list-view-update-inline-action",data:{model:i,name:o,value:t.cellModel,cell:t}})}})})}d._contentViews[i]._applySortModelOrig=d._contentViews[i]._applySortModel,d._contentViews[i]._applySortModel=function(e){if(this._applySortModelOrig(e),!0===this._isCurrentlyCalledFromUIInteraction()){var t=this.sortModel&&this.sortModel.length>0?this.sortModel[0]:void 0;if(t){var i={sortOrder:t.sort?t.sort.toUpperCase():void 0,sortAttribute:t.dataIndex?t.dataIndex:void 0};d._modelEvents.publish({event:"enox-collection-toolbar-sort-activated",data:i})}else d._modelEvents.publish({event:"enox-collection-toolbar-reset-sort"})}}}else{switch(i){case"TileView":d._contentViews[i]=new(n.inherit(p))(a);break;case"ThumbnailView":d._contentViews[i]=new(s.inherit(h))(a);break;case"LargeThumbnailView":d._contentViews[i]=new(l.inherit(p))(a)}"TileView"!==i&&"ThumbnailView"!==i&&"LargeThumbnailView"!==i||(d._contentViews[i].onContextualEvent=e.is(t.onContextualEvent)?e.is(t.onContextualEvent,"function")?{callback:t.onContextualEvent}:e.is(t.onContextualEvent.callback,"function")?t.onContextualEvent:c:c,d._contentViews[i].onPostCellRequest(m))}d.useDragAndDrop&&(d._contentViews[i].useDragAndDrop=d.useDragAndDrop,d._contentViews[i].onDragStartCell=function(t,i){var o=this.getTreeDocument().getSelectedNodes()?this.getTreeDocument().getSelectedNodes():[],n=o&&o.length>0?o:i.nodeModel;void 0!==d._options.setDragData&&e.is(d._options.setDragData,"function")?d._options.setDragData(t,n):d._setDragData(t,n),d._appendShadowTile(t,o,i)},d._contentViews[i].onDragEnterBlankDefault=function(){},d._contentViews[i].onDragEnterBlank=function(){},d._contentViews[i].onDragEndCell=function(){d._removeShadowTile()}),d._contentViews[i].addEventListener(r.POINTERHIT,function(t,i){if(i&&i.nodeModel&&i.nodeModel.options.id&&2===t.multipleHitCount){e.log("xmodel-list-item-on-dblclickPOINTERHIT");var o="";t&&t.dsModel&&t.dsModel.layout&&t.dsModel.layout.getDataIndexFromColumnIndex&&(o=t.dsModel.layout.getDataIndexFromColumnIndex(i.columnID)),"basePrice"!==o&&d._modelEvents.publish({event:"xmodel-list-item-on-dblclick",data:{model:i.nodeModel.options.grid},context:i.nodeModel})}}),d._contentViews[i].addEventListener("click",function(t,i){if(i&&i.nodeModel&&i.nodeModel.options.id){e.log("xmodel-list-item-on-click");var o=t.target.getAttribute("href");if(null!=o){var n=t.dsModel.layout.getDataIndexFromColumnIndex(i.columnID);d._modelEvents.publish({event:"xmodel-list-item-on-link-click",data:{model:i.nodeModel.options.grid,linkId:n||o}})}else d._modelEvents.publish({event:"xmodel-list-item-on-click",data:{model:i.nodeModel.options.grid,event:t},context:i.nodeModel})}})}),this._switchView(this._currentView,!0)},m.prototype._appendShadowTile=function(t,i,o){let n={picture:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.thumbnail,"function")?this._options.viewOptions.itemViewMapping.thumbnail.call(this,o.nodeModel):o.nodeModel.getAttributeValue("image"),icon:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.thumbnail,"function")?this._options.viewOptions.itemViewMapping.thumbnail.call(this,o.nodeModel):o.nodeModel.getAttributeValue("image"),title:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.label,"function")?this._options.viewOptions.itemViewMapping.label.call(this,o.nodeModel):o.nodeModel.getAttributeValue("title"),multipleTitleLineNumber:!1,subtitle:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.subLabel,"function")?this._options.viewOptions.itemViewMapping.subLabel.call(this,o.nodeModel):_._modified+": "+o.nodeModel.getAttributeValue("modified"),description:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.description,"function")?this._options.viewOptions.itemViewMapping.description.call(this,o.nodeModel):o.nodeModel.getAttributeValue("description")};if(this._img=new h(n),this._img.elements.container.addClassName("xmodel-shadow-img"),this._img.inject(document.body),i.length>=2){var s=e.createElement("div",{class:"xmodel-badge"});e.createElement("div",{class:"numberCircle",text:i.length}).inject(s),s.inject(this._img.elements.picture)}t.dataTransfer.setDragImage(this._img.getContent(),0,0)},m.prototype._removeShadowTile=function(){this._img.getContent().destroy()},m.prototype._getSelectedItem=function(){return this._model.getXSO().get().map(function(e){return e.options.grid})},m.prototype._switchView=function(t,i){var o=this._contentViews[t];o&&(this._currentView=t,e.extendElement(this._listContainer).setContent(o.getContent()),"DataGridView"!==this._currentView?this._modelEvents.publish({event:"xmodel-list-toolbar-group-visibility",data:!1}):this._modelEvents.publish({event:"xmodel-list-toolbar-group-visibility",data:!0})),i&&this._modelEvents.publish({event:"xmodel-list-toolbar-update-switch-view",data:t})},m.prototype.inject=function(e){e.appendChild(this._container);var t=this;d.addResizeListener(this._container,function(){if(t._container.offsetWidth){var e=t._getPreferedView();"ThumbnailView"===e&&t._contentViews.ThumbnailView&&(t._container.offsetWidth<t.MOBILE_BREAKPOINT?t._contentViews.ThumbnailView.displayedOptionalCellProperties=["contextualMenu"]:t._contentViews.ThumbnailView.displayedOptionalCellProperties=t._displayProperties,t._contentViews.ThumbnailView.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})),e!==t._currentView&&(t._groupedRows.length>0?(t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:[]}),setTimeout(function(){t._switchView(e)},500)):t._switchView(e,!0))}})},m.prototype.getTypeRepresentationFactory=function(){return this._typeRepresentationFactory},m.prototype._initExtensions_v1=function(t){var i={id:this._id,model:this._model,modelEvents:this._modelEvents,useAsyncExpand:this._useAsyncExpand,filterAttributes:this._filterAttributes,keepSelectionOnHide:!(!this._options.toolbarOptions||!this._options.toolbarOptions.keepSelectionOnHide)&&this._options.toolbarOptions.keepSelectionOnHide,childKeys:this._options.childKeys?this._options.childKeys:[],defaultNodeDepth:this._options.defaultNodeDepth?this._options.defaultNodeDepth:void 0},o=this;o._extensions=[];var n=[],s=[];t&&t instanceof Array&&t.length>0&&t.forEach(function(t){switch(e.typeOf(t)){case"string":n.push(new e.Promise(function(e,i){require([t],function(t){e(t)},function(e){i("Error loading modules."+(e&&e.requireModules?e:""))})}));break;case"class":s.push(t)}}),e.log("[ModelListView:_initExtensions_v1] No. of Extension to initialize: "+s.length+" to resolve:  "+n.length),s.forEach(function(e){var t=new e;t.initialize(i),o._extensions.push(t)}),n.length>0&&e.Promise.all(n).then(function(e){e.forEach(function(e){var t=new e;o._extensions.push(t)}),o._extensions.forEach(function(e){e.initialize(i)})})},m.prototype._initExtensions=function(t){var i={id:this._id,model:this._model,modelEvents:this._modelEvents},o=this;o._extensions=[],function(t){var i=t.map(function(t){switch(e.typeOf(t)){case"string":return new e.Promise(function(e,i){require([t],function(t){e(t)},function(e){i("Error loading modules."+(e&&e.requireModules?e:""))})});case"class":return e.Promise.resolve(t)}});return e.Promise.all(i)}(t).then(function(e){e.forEach(function(e){var t=new e;o._extensions.push(t)}),o._extensions.forEach(function(e){e.initialize(i)})})},m.prototype.filter=function(e){if(e.id){this._filters[e.id]=e.content||{};var t=e.content;t.ids&&(this._model.prepareUpdate(),this._model.search({match:function(e){return-1!==t.ids.indexOf(e.nodeModel.options.id)?(e.nodeModel.matchSearch(),!0):(e.nodeModel.unmatchSearch(),!1)}}),this._model.pushUpdate())}},m.prototype._onDataUpdate=function(){if(0===this._groupedRows.length){var e=0,t=this._model.getChildren();if(t)e=t.filter(function(e){return e.isVisible()}).length;this._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:e})}},m.prototype._getContextualMenu=async function(t,i){let o=this;var n=[];let s=o._getSelectedItem().length>1;var l=function(i,n){var a={id:n.id,type:n.type?n.type:"PushItem",title:n.title?n.title:n.text,state:n.state?n.state:"enabled"};if(!0===t.options.disableMenu&&(a.state="disabled"),void 0!==n.multiselect&&s&&!n.multiselect&&(a.state="disabled"),n.handler&&(a.action={callback:function(){e.is(n.handler,"function")&&n.handler.call(t,t.options.grid,o._getSelectedItem())}}),n.fonticon&&(a.icon=n.fonticon),n.content){var d=n.content;a.submenu=[],d.reduce(l,a.submenu)}else n.submenu&&(a.submenu=n.submenu);return i.push(a),i};if(this._options.viewOptions.contextualActions&&t&&t.options.id){var a=this._options.viewOptions.contextualActions;e.is(this._options.viewOptions.contextualActions,"function")&&(a=await this._options.viewOptions.contextualActions.call(t,i)),o._getSupportedTypesActions(a),n=a.reduce(l,[])}return n},m.prototype._getSupportedTypesActions=function(e){let t={};this._getSelectedItem().forEach(e=>{t[e.type]?t[e.type]++:t[e.type]=1}),e.forEach(e=>{if(1==Object.keys(t).length&&Array.isArray(e.supportedTypes)&&!e.supportedTypes.includes(Object.keys(t)[0]))e.state="disabled";else{let i=!0;Object.keys(t).forEach(t=>{i&&Array.isArray(e.supportedTypes)&&!e.supportedTypes.includes(t)&&(i=!1)}),i||(e.state="disabled")}})},m.prototype.destroy=function(){this._extensions.forEach(function(e){e.destroy()})},m.prototype.isGrouped=function(){return this._groupedRows&&this._groupedRows.length>0},m.prototype._showListViewSelected=function(e){let t=this;e?t._container.classList.add("xmodel-list-view-set-context"):t._container.classList.remove("xmodel-list-view-set-context")},m.prototype.updateTagFocus=function(){var e=this._model.getXSO().get();window.widget&&"maximized"!==window.widget.getView().type||0===e.length?this._modelEvents.publish({event:"xmodel-list-tagger-unfocus-action"}):window.widget&&"maximized"===window.widget.getView().type&&e&&e.length>0&&this._modelEvents.publish({event:"xmodel-list-tagger-focus-action",data:e})},m.prototype.refresh=function(){var e=this._contentViews.DataGridView;e&&e.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}),"DataGridView"!==this._currentView&&this._contentViews[this._currentView].invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})},m});