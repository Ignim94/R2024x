define("DS/CATRgrReportWizard/wizard/Context",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;t.Context=class{constructor(e,t){this.isRGWidget=!1,this.userSelection=e,this.objectIds=e.map(e=>e.getID()),this.modifyExisting=!1,this.modal={},this.newBtnplaceholder=t,this.nlsTypesDict={},this.parentTypes=new Map}}}),define("DS/CATRgrReportWizard/utils/RGRWizardConstants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGRWizardConstants=void 0;const o=Object.freeze({ADD_REPORT:"Add_Report",REPORT_SELECTOR:"Report_Selector",TEMPLATE_SELECTOR:"Template_Selector",ASSIGN_INPUTS:"Assign_Inputs",REPORT_PROPERTIES:"Report_Properties",OUTPUT_FORMAT:"outputFormat",TARGET_DOCUMENT:"targetDocument",REPORT_TEMPLATE:"Report Template"});t.RGRWizardConstants=o}),define("DS/CATRgrReportWizard/wizard/WizardUI",["require","exports","UWA/Core","DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Loader","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","DS/Windows/ImmersiveFrame","css!DS/CATRgrReportWizard/CATRgrWizard"],function(e,t,o,n,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WizardUI=void 0;t.WizardUI=class{constructor(e){this.ui={},this.containers={},function(e,t){e.ui.loader=new r,e.ui.loader.text=a.loading,e.ui.content=new o.Element("div",{id:"wizard-container",class:"wizard-container"});const l=new n({label:a.previousButton}),d=new n({label:a.nextButton,emphasize:"primary"}),c=new n({label:a.cancelButton});e.ui.newBtnplaceholder=new n({label:a.newReportButton,emphasize:"primary",minWidth:135,minHeight:35,domId:"placeholderBtn"});const u=new n({label:a.newReportButton}),p=new s({});p.elements.container.setStyle("pointer-events","none"),p.inject(t);const m={immersiveFrame:p,title:"Report Wizard",content:e.ui.content,resizableFlag:!0,modalFlag:!0,position:{my:"top middle",at:"top middle"},customButtonsDefinition:[l,u,d,c]};e.containers.modal=new i(m),e.containers.modal.width=649,e.containers.modal.minHeight=450,e.ui.prev=e.containers.modal.getCustomButtons()[0],e.ui.next=e.containers.modal.getCustomButtons()[2],e.ui.newReport=e.containers.modal.getCustomButtons()[1],e.ui.cancel=e.containers.modal.getCustomButtons()[3]}(this,e),function(e,t){t.containers.loaderContainer=new o.Element("div",{class:"loader-container"}).inject(e),t.ui.loader.inject(t.containers.loaderContainer)}(e,this)}}}),define("DS/CATRgrReportWizard/utils/RGRWizardPanelFnTypes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/CATRgrReportWizard/wizard/ObjectSelectorUI",["require","exports","UWA/Core","DS/TreeModel/TreeDocument","DS/Controls/SelectionChips","DS/DataGridView/DataGridView","DS/Controls/Button","DS/Controls/Loader","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","DS/CATRgnWidgetCommons/Placeholder","DS/DataDragAndDrop/DataDragAndDrop","css!DS/CATRgrReportWizard/CATRgrWizard"],function(e,t,o,n,i,r,a,s,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectSelectorUI=void 0;function u(e){e.containers.datagridContainer=new o.Element("div",{styles:{position:"absolute",width:"98%",height:"75%"}})}t.ObjectSelectorUI=class{constructor(e,t,p){this.model={},this.ui={},this.containers={},this.containerAddReport={},function(e,t){e.containerAddReport.content=new o.Element("div",{id:"wizard_add_report",class:"wizard-content"}),c.droppable(e.containerAddReport.content,{drop:t.drop}),new d(t).inject(e.containerAddReport.content)}(this,p),function(e,t,d){d.model=new n,d.containers.inputLableContainer=new o.Element("div",{class:"div-position"}),new o.Element("h5",{text:l.objects}).inject(d.containers.inputLableContainer),d.containers.flexContainerDiv=new o.Element("div",{class:"div-position"}),d.containers.flexContainerDiv.classList.add("flex-container");const c=new o.Element("div",{id:"flexinputText"}).inject(d.containers.flexContainerDiv);d.ui.selectionChips="ExistingReport"===e?new i({placeholder:l.addReports}).inject(c):new i({placeholder:l.addInputs}).inject(c),d.ui.objectsSearch=new a({icon:{iconName:"search-add wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"15px"},minWidth:12,domId:"flexButton"}).inject(d.containers.flexContainerDiv),d.containers.reportLableContainer=new o.Element("div",{class:"div-position"}),d.containers.errorContainer=new o.Element("div",{class:"div-position"}),"ExistingReport"===e?(new o.Element("h5",{text:l.reports}).inject(d.containers.reportLableContainer),u(d),d.ui.dataGridView=new r({treeDocument:d.model,columns:[{text:l.title,dataIndex:"label",pinned:"left",description:l.title},{text:l.name,dataIndex:"name",width:100,description:l.name},{text:l.revision,dataIndex:"revision",width:40,description:l.revision},{text:l.owner,dataIndex:"ds6w:responsible",description:l.owner},{text:l.templateLabel,dataIndex:"template",getCellValue(e){var t,o,n;return null===(n=null===(o=null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid)||void 0===o?void 0:o.template)||void 0===n?void 0:n.title},description:l.templateLabel},{text:l.score,dataIndex:"score",width:60,description:l.score},{text:l.creationDate,dataIndex:"originated",description:l.creationDate},{text:l.action,dataIndex:"download",getCellValue(e){var t;return null===(t=e.nodeModel)||void 0===t?void 0:t.options.grid.download},typeRepresentation:"url",pinned:"right",description:l.action}],placeholder:l.noReportFound,rowSelection:"single",columnSelection:"none",cellSelection:"none",getCellTooltip:e=>{var t;const o=null===(t=e.cellView.collectionView.getColumnOrGroup(e.columnID))||void 0===t?void 0:t.dataIndex;if(!e.nodeModel||"template"!=o){if(e.nodeModel&&"download"==o){const t=e.nodeModel.options.grid,o=l.downloadReport;return t.download?{shortHelp:o}:void 0}return e.nodeModel?void 0:d.ui.dataGridView.getCellDefaultTooltip(e)}{const t=e.nodeModel.options.grid,o=t.template;if(o){let e=`${null==o?void 0:o.title} | ${null==o?void 0:o.type} | ${null==o?void 0:o.name} | ${null==o?void 0:o.revision}`;if(t.inputs&&t.inputs.length>0){let o=`\n ${l.parameters} :\n`;t.inputs.forEach(e=>o=o.concat(`  -${e.name} : ${e.type}`)),e=e.concat(o)}return{shortHelp:e,updateModel:!1}}}}}).inject(d.containers.datagridContainer),d.ui.loader=new s,d.ui.loader.text=l.loading):"CreateNewReport"===e&&(new o.Element("h5",{text:l.compatibleTemplates}).inject(d.containers.reportLableContainer),u(d),d.ui.dataGridView=new r({treeDocument:d.model,columns:[{text:l.title,dataIndex:"label",pinned:"left",description:l.title},{text:l.name,dataIndex:"name",width:100,description:l.name},{text:l.revision,dataIndex:"revision",width:40,description:l.revision},{text:l.owner,dataIndex:"owner",description:l.owner},{text:l.type,dataIndex:"type",width:110,description:l.type},{text:l.creationDate,dataIndex:"creationDate",description:l.creationDate}],placeholder:l.noTemplateFound,rowSelection:"single",columnSelection:"none",cellSelection:"none"}).inject(d.containers.datagridContainer),d.ui.loader=new s,d.ui.loader.text=l.loading)}(e,0,this)}inject(e){Object.values(this.containers).forEach(t=>t.inject(e)),function(e,t){t.containers.loaderContainer=new o.Element("div",{class:"loader-container"}).inject(e),t.ui.loader.inject(t.containers.loaderContainer)}(e,this)}remove(){Object.values(this.containers).forEach(e=>e.remove())}}}),define("DS/CATRgrReportWizard/utils/RGRWizardModes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGRWizardModes=void 0;const o=Object.freeze({DROP_OBJECTS:"Drop_Objects",DROP_TEMPLATE:"Drop_Template",ADD_REPORT:"Add_Report",EDIT_REPORT:"Edit_Report"});t.RGRWizardModes=o}),define("DS/CATRgrReportWizard/wizard/ReportPropertiesUI",["require","exports","UWA/Core","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/Editor","DS/Controls/Expander","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/CATRgrReportWizard/utils/RGRWizardModes","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","css!DS/CATRgrReportWizard/CATRgrWizard"],function(e,t,o,n,i,r,a,s,l,d,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReportPropertiesUI=void 0;t.ReportPropertiesUI=class{constructor(e,t,l){this.ui={},this.containers={},function(e,t,l,p){p.containers.content=new o.Element("div",{id:"wizard-report-properties",class:"wizard--properties-content"}),"ExistingReport"===e&&t!==c.RGRWizardModes.EDIT_REPORT&&(p.ui.modifyPropertiesCheckbox=new i({type:"switch",label:u.modifyPanel,value:0,checkFlag:l}).inject(p.containers.content)),p.containers.contentDiv=new o.Element("div",{class:"wizard--properties-content"}).inject(p.containers.content);const m=new o.Element("div",{class:"div-position"}).inject(p.containers.contentDiv),g=new o.Element("span",{text:u.title}).inject(m);g.classList.add("form-labels"),g.classList.add("form-label-mandatory"),p.ui.titleEditor=new s({value:"",sizeInCharNumber:100,requiredFlag:!0}).inject(m);const v=new o.Element("div",{class:"div-position"}).inject(p.containers.contentDiv);new o.Element("span",{text:u.description}).inject(v).classList.add("form-labels"),p.ui.descriptionEditor=new r({value:"",maxLength:256,nbRows:5,widthInCharNumber:100,newLineMode:"enter"}).inject(v);const f=new o.Element("div",{class:"div-position"}).inject(p.containers.contentDiv),R=new o.Element("span",{text:u.outputFormat}).inject(f);R.classList.add("form-labels"),R.classList.add("form-label-mandatory");const h=new o.Element("div",{class:"div-position"}).inject(p.containers.contentDiv);h.classList.add("flex-container"),p.ui.outputFormatEditor=new s({value:"",sizeInCharNumber:130,domId:"flexinputText"}).inject(h),p.ui.outputFormatEditor.tooltipInfos=new d,p.ui.outputFormatSearch=new n({icon:{iconName:"search wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"15px"},minWidth:12,domId:"searchbtn"}).inject(h);const b=new o.Element("div",{class:"div-position"}).inject(p.containers.contentDiv);new o.Element("span",{text:u.targetDocument}).inject(b).classList.add("form-labels");const w=new o.Element("div",{class:"div-position"}).inject(p.containers.contentDiv);w.classList.add("flex-container"),p.ui.targetDocumentEditor=new s({value:"",sizeInCharNumber:130,domId:"flexinput"}).inject(w),p.ui.targetDocumentEditor.tooltipInfos=new d,p.ui.targetDocumentSearch=new n({icon:{iconName:"search wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"15px"},minWidth:1,domId:"searchbtn"}).inject(w),p.ui.targetDocumentClear=new n({icon:{iconName:"eraser wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"13px"},minWidth:12,domId:"clearbtn"}).inject(w),p.containers.configurationFilterContainer=new o.Element("div",{styles:{"margin-top":"10px",width:"60%"}}).inject(p.containers.contentDiv);const C=new o.Element("div",{class:"div-position"});new o.Element("span",{text:"Name"}).inject(C).classList.add("form-labels"),p.ui.nameEditor=new s({value:"",sizeInCharNumber:100}).inject(C),p.ui.expander=new a({header:"Show more",expandedFlag:!1,body:C}).inject(p.containers.contentDiv)}(e,t,l,this)}inject(e){e.appendChild(this.containers.content)}remove(){this.containers.content.remove()}configurationFilter(){const e=new o.Element("div",{class:"div-position",styles:{"margin-top":"10px",height:"30px"}}).inject(this.containers.configurationFilterContainer);new o.Element("span",{text:u.configurationFilter}).inject(e).classList.add("form-labels");const t=new o.Element("div",{styles:{width:"100%",height:"50px"}}).inject(e);this.ui.configComboBox=new l({elementsList:[],enableSearchFlag:!1,domId:"searchbtn"}).inject(t),this.ui.filterViewComboBox=new l({elementsList:["Official","Projected"],enableSearchFlag:!1,domId:"searchbtn"}).inject(t)}}}),define("DS/CATRgrReportWizard/wizard/InputAssignmentUI",["require","exports","UWA/Core","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Controls/Loader","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","DS/Controls/TooltipModel","DS/CATRgrReportWizard/utils/RGRWizardModes","css!DS/CATRgrReportWizard/CATRgrWizard"],function(e,t,o,n,i,r,a,s,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inputAssignmentUI=void 0,t.inputAssignmentUI=function(e,t,c){const u={},p={};function m(){p.unassignInputsContainer=new o.Element("div",{class:"unassignedZone-container"}).inject(p.subContent),u.unassignedInputsLabel=new o.Element("h5",{text:s.unassignedObjects,id:"label"}).inject(p.unassignInputsContainer),u.unassingedChipContainer=new o.Element("div",{class:"div-position"}).inject(p.unassignInputsContainer)}return function(e,t,c){p.content=new o.Element("div",{id:"wizard-input-assignment",class:"wizard-input-content"}),p.divForLoader=new o.Element("div",{class:"loader-holder"}).inject(p.content),u.loader=(new a).inject(p.divForLoader),u.loader.text=s.loading,"ExistingReport"===e&&t!==d.RGRWizardModes.EDIT_REPORT&&(u.modifyCheckbox=new i({type:"switch",label:s.modifyPanel,value:0,checkFlag:c}).inject(p.content)),p.subContent=new o.Element("div",{id:"wizard-subContent",class:"wizard-input-subContents"}).inject(p.content),"ExistingReport"!==e||c||p.subContent.classList.add("disable");const g=new o.Element("div",{class:"div-position-label"}).inject(p.subContent);new o.Element("span",{id:"label",text:s.templateLabel}).inject(g).classList.add("form-labels");const v=new o.Element("div",{class:"div-position"}).inject(p.subContent);v.classList.add("flex-container"),u.templateEditor=new r({value:"",domId:"flexinputText"}).inject(v),u.templateEditor.tooltipInfos=new l,"CreateNewReport"===e&&(u.templateEditor.disabled=!0),"ExistingReport"!==e&&t!==d.RGRWizardModes.EDIT_REPORT||(u.templateSearch=new n({icon:{iconName:"search wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"15px"},minWidth:12,domId:"flexButton"}).inject(v)),p.parameterContainer=new o.Element("div",{}).inject(p.subContent),m()}(e,t,c),{ui:u,containers:p,unassignedZone:m,createTable:function(){u.table=o.createElement("table",{class:"parameters_table"}).inject(p.parameterContainer)},displayError:function(e){o.Element("h5",{class:"error-message",html:e}).inject(p.content)},displayNoTemplateInfo:function(){u.info=new o.Element("h5",{class:"info-message",text:s.emptyTemplate}).inject(p.parameterContainer)},disableTemplateSearch:function(){const e=document.querySelector("#flexinputText > input");e&&(e.readOnly=!0)},addChipRow:function(e,t){u.tableRow=o.createElement("tr",{class:"tableRow"}).inject(u.table),u.tableData=o.createElement("td",{class:"tableDataLabel"}).inject(u.tableRow),u.parameterLabel=new o.Element("p",{class:"parameter-label",html:e}).inject(u.tableData),"single"===t&&u.parameterLabel.classList.add("form-label-mandatory"),u.textContainer=new o.Element("div",{class:"textContainer"}).inject(o.createElement("td",{class:"tableDataInput"}).inject(u.tableRow)),u.chipcontainer=new o.Element("div",{class:"chip-container"}).inject(u.textContainer),u.browseButton="list"!==t?new n({icon:{iconName:"search wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"15px"},minWidth:8,domId:"flexButton"}).inject(u.textContainer):new n({icon:{iconName:"search-add wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"15px"},minWidth:8,domId:"flexButton"}).inject(u.textContainer)},addInputFieldRow:function(e,t,n,a,s){if(u.tableRow=o.createElement("tr",{class:"tableRow"}).inject(u.table),u.tableData=o.createElement("td",{class:"tableDataLabel"}).inject(u.tableRow),"single"===s&&(u.parameterLabel=new o.Element("p",{class:"parameter-label",html:t}).inject(u.tableData),u.parameterLabel.classList.add("form-label-mandatory")),u.textContainer=new o.Element("div",{class:"input-container",id:e}).inject(o.createElement("td",{class:"tableDataInput"}).inject(u.tableRow)),"Boolean"===a){const e="true"===n||!0===n;u.booleanCheckbox=new i({type:"checkbox",value:e,checkFlag:e}).inject(u.textContainer)}else{const e={width:"100%"};u.editor=new r({value:n,requiredFlag:!0,pattern:"",placeholder:""}).inject(u.textContainer),u.editor.getContent().setStyles(e)}},inject:function(e){e.appendChild(p.content)},remove:function(){p.content.remove()}}}}),define("DS/CATRgrReportWizard/wizard/ReportProperties",["require","exports","DS/DataDragAndDrop/DataDragAndDrop","DS/CATRgrReportWizard/utils/RGRWizardConstants","DS/CATRgrReportWizard/utils/RGRWizardModes","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/CATRgnWidgetCommons/restClient/InternalServices","DS/CoreEvents/Events","DS/CATRgrReportWizard/wizard/ReportPropertiesUI","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","DS/RGNServices/Alert","DS/RGNServices/FederatedSearch","DS/CATRgnWidgetCommons/UI/Tooltips"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reportProperties=void 0,t.reportProperties=function(e,t){let g={};const v=new m.TooltipBuilder,f=new d.ReportPropertiesUI(t.userChoice,t.wizardMode,t.modifyExisting),R=n.RGRWizardConstants.REPORT_PROPERTIES;async function h(){var o,n,i,a,l,d,c,p;const m=await r.service3DSpace(e),v=await r.createHeaders(e,!0),R=[];void 0!==(null===(o=t.inputAssignment)||void 0===o?void 0:o.templateNodes)&&(null===(n=t.inputAssignment)||void 0===n||n.templateNodes.forEach(e=>{"Standard"!==e.typeQualifiedName.split(".")[0]&&e.values.forEach(e=>{R.push(e)})}));try{if(t.configurationFilter=await s.getConfigurationsAttachedTo(m,v,R),t.configurationFilter.length){f.configurationFilter();const e=[{label:"No configuration filter",description:"No configuration filter",value:"No configuration filter"}],o=["0"];let n,r,s;Object.keys(t.configurationFilter).forEach(n=>{s={label:t.configurationFilter[n].title+" | "+t.configurationFilter[n].revision,description:t.configurationFilter[n].title+" | "+t.configurationFilter[n].type+" | "+t.configurationFilter[n].revision+" | "+t.configurationFilter[n].name,value:t.configurationFilter[n].title},e.push(s),o.push(t.configurationFilter[n].id)}),f.ui.configComboBox.elementsList=e,g.configurationId?Object.keys(t.configurationFilter).forEach(e=>{t.configurationFilter[e].title===g.configurationId&&(n=t.configurationFilter[e].id)}):n=(null===(i=null==t?void 0:t.reportProperties)||void 0===i?void 0:i.configurationId)||(null===(l=null===(a=null==t?void 0:t.selectedReportInfo)||void 0===a?void 0:a.configuration)||void 0===l?void 0:l.id);const u=o.indexOf(n);-1!==u&&(f.ui.configComboBox.selectedIndex=u),r=g.filterView?g.filterView:(null===(d=null==t?void 0:t.reportProperties)||void 0===d?void 0:d.filterView)||(null===(p=null===(c=null==t?void 0:t.selectedReportInfo)||void 0===c?void 0:c.configuration)||void 0===p?void 0:p.filterView),t.filterView=r&&"projected"===r.toLowerCase()?"projected":"official",f.ui.filterViewComboBox.selectedIndex="projected"===t.filterView?1:0}}catch(e){u.error(e),t.configurationFilter=[]}}function b(e){f.ui.titleEditor.valueToCommit.trim()&&f.ui.outputFormatEditor.value?(e.modal.nextButton.disabled=!1,e.modal.newReportButton.disabled=!1):(e.modal.nextButton.disabled=!0,e.modal.newReportButton.disabled=!0)}async function w(e,t){var o,n,i,s,l,d,c,u,p,m,v,R,h,b,w,S;const y=await r.service3DSpace(e),E=await r.createHeaders(e,!0),x=function(e){var t,o,n;if(e.configurationFilter.length){e.filterView="Official"===(null===(t=f.ui.filterViewComboBox)||void 0===t?void 0:t.value)?"official":"projected";for(const t of e.configurationFilter)if((null===(o=f.ui.configComboBox)||void 0===o?void 0:o.value)===t.title)return{id:t.id,filterView:e.filterView};return"No configuration filter"===(null===(n=f.ui)||void 0===n?void 0:n.configComboBox.value)?{id:"",filterView:e.filterView}:void 0}}(t),D=null==x?void 0:x.id;let I=t.selectedReportID;if("ExistingReport"===t.userChoice&&t.modifyExisting){const e={};(null===(o=t.selectedReportInfo)||void 0===o?void 0:o.title)!==f.ui.titleEditor.value&&(e.title=f.ui.titleEditor.value),(null===(n=t.selectedReportInfo)||void 0===n?void 0:n.description)!==f.ui.descriptionEditor.value&&(e.description=f.ui.descriptionEditor.value),""!==t.selectedTemplateID&&(null===(s=null===(i=t.selectedReportInfo)||void 0===i?void 0:i.template)||void 0===s?void 0:s.id)!==t.selectedTemplateID&&(e.template={id:t.selectedTemplateID}),(null===(d=null===(l=t.selectedReportInfo)||void 0===l?void 0:l.outputFormat)||void 0===d?void 0:d.id)!==g.outputFormat.id&&""!==g.outputFormat.id&&(e.outputFormat={id:g.outputFormat.id}),(null===(c=t.inputAssignment)||void 0===c?void 0:c.templateNodes)&&C()&&(e.inputs=t.inputAssignment.templateNodes.map(e=>({values:e.values}))),f.ui.filterViewComboBox&&((null===(p=null===(u=null==t?void 0:t.selectedReportInfo)||void 0===u?void 0:u.configuration)||void 0===p?void 0:p.id)===(null==x?void 0:x.id)&&(null===(v=null===(m=null==t?void 0:t.selectedReportInfo)||void 0===m?void 0:m.configuration)||void 0===v?void 0:v.filterView)===(null==x?void 0:x.filterView)||(e.configuration={id:null==x?void 0:x.id,filterView:null==x?void 0:x.filterView})),Object.keys(g.targetDocument)&&(null===(R=t.selectedReportInfo.targetDocument)||void 0===R?void 0:R.id)!==g.targetDocument.id&&(e.targetDocument={id:g.targetDocument.id}),("title"in e||"description"in e||"template"in e||"outputFormat"in e||"targetDocument"in e||"inputs"in e||"configuration"in e)&&await a.updateReport(y,E,I,e)}else if("CreateNewReport"===t.userChoice){const e=t.configurationFilter.length&&D?{id:D,filterView:t.filterView}:void 0,o=[];void 0!==(null===(h=t.inputAssignment)||void 0===h?void 0:h.templateNodes)&&(null===(b=t.inputAssignment)||void 0===b||b.templateNodes.forEach(e=>{o.push({values:e.values})}));const n={title:f.ui.titleEditor.value.trim(),description:f.ui.descriptionEditor.value,name:f.ui.nameEditor.value,template:{id:t.selectedTemplateID},outputFormat:{id:g.outputFormat.id},targetDocument:{id:null===(w=g.targetDocument)||void 0===w?void 0:w.id},inputs:o,configuration:e};I=null===(S=(await a.createReports(y,E,[n])).reports[0])||void 0===S?void 0:S.id}return I}function C(){var e,o,n;const{inputAssignment:i,selectedReportInfo:r}=t;if(!i||!r)return!1;const a=r.inputs||[],s=i.templateNodes||[];if(a.length!==s.length)return!0;for(let t=0;t<a.length;t++){const i=a[t],r=s[t];if((null===(e=null==i?void 0:i.values)||void 0===e?void 0:e.length)!==(null===(o=null==r?void 0:r.values)||void 0===o?void 0:o.length))return!0;for(let e=0;void 0!==(null==i?void 0:i.values)&&e<(null===(n=i.values)||void 0===n?void 0:n.length);e++)if(i.values[e]!==(null==r?void 0:r.values[e]))return!0}return!1}function S(e,i){o.droppable(e,{drop:e=>(async function(e,o){const i=JSON.parse(e);if(i){const e=i.data.items;if(e.length&&e[0]){const i={id:(r=e[0]).objectId,name:r.displayName,title:r.displayName,type:r.objectType},a=await async function(e){const o=new Map;let n;try{const i=function(e,t){const o=new Set;for(let n=t;""!=n&&void 0!==n&&!o.has(n);n=e.get(n))o.add(n);return Array.from(o.values())}(t.parentTypes,e);o.set(e,i),i.includes("DOCUMENTS")&&(o.set(e,i),n=[...o.keys()])}catch(t){o.set(e,[e])}return n}(e[0].objectType);o===n.RGRWizardConstants.OUTPUT_FORMAT&&e[0].objectType===n.RGRWizardConstants.REPORT_TEMPLATE?x(i,g.outputFormat,f.ui.outputFormatEditor):o!==n.RGRWizardConstants.TARGET_DOCUMENT||"Report Document"!==e[0].objectType&&!a.includes(e[0].objectType)||x(i,g.targetDocument,f.ui.targetDocumentEditor)}}var r})(e,i)})}function y(e,t,o){return()=>{let i;const r=o.outputFormat.name+"("+o.outputFormat.title+")",a=o.targetDocument.name+"("+o.targetDocument.title+")",s=(e,t)=>({identifier:e,precond:t,multiSel:!1,mode:"furtive"});i=e===n.RGRWizardConstants.OUTPUT_FORMAT&&""!==f.ui.outputFormatEditor.value&&r!==f.ui.outputFormatEditor.value?s(e,f.ui.outputFormatEditor.value):e===n.RGRWizardConstants.TARGET_DOCUMENT&&""!==f.ui.targetDocumentEditor.value&&a!==f.ui.targetDocumentEditor.value?s(e,f.ui.targetDocumentEditor.value):s(e,t),p.search(i,t=>(async function(e,t,o,i){if(i.length&&i[0]){const a={id:null==(r=i[0])?void 0:r.id,name:null==r?void 0:r["ds6w:identifier"],title:null==r?void 0:r["ds6w:label"],type:null==r?void 0:r["ds6w:type_value"],revision:null==r?void 0:r["ds6wg:revision"]};e.identifier!==n.RGRWizardConstants.OUTPUT_FORMAT&&t!==n.RGRWizardConstants.OUTPUT_FORMAT||a.type!==n.RGRWizardConstants.REPORT_TEMPLATE?e.identifier!==n.RGRWizardConstants.TARGET_DOCUMENT&&t!==n.RGRWizardConstants.TARGET_DOCUMENT||x(a,o.targetDocument,f.ui.targetDocumentEditor):x(a,o.outputFormat,f.ui.outputFormatEditor)}var r})(i,e,o,t),E)}}async function E(){}function x(e,o,n){o.id=e.id,o.name=e.name,o.title=e.title,"type"in o&&(o.type=e.type,o.revision=e.revision);const i=v.buildTooltip(e);n.value=`${o.name}(${o.title})`,n.options=o.id,n.tooltipInfos.shortHelp=i,b(t)}return g=void 0===t.reportProperties?g:t.reportProperties,{name:R,inject:function(e){!async function(e){var t,o,r,a,s,l,d,c,u,p,m,R,w;if(f.ui.expander.visibleFlag=!1,"ExistingReport"===e.userChoice&&e.wizardMode!==i.RGRWizardModes.EDIT_REPORT){const t=f.containers.contentDiv.classList;e.modifyExisting||t.add("disable"),f.ui.modifyPropertiesCheckbox.addEventListener("buttonclick",o=>{const n=o.dsModel.checkFlag;t.toggle("enable",n),t.toggle("disable",!n),e.modifyExisting=n})}if(h(),"CreateNewReport"===e.userChoice&&"TRUE"===(null===(t=localStorage.getItem("ReportWizard_Properties_Name"))||void 0===t?void 0:t.toUpperCase())&&(f.ui.expander.visibleFlag=!0),"CreateNewReport"===e.userChoice){let t="",n="";const i=(null===(a=null===(r=null===(o=e.inputAssignment)||void 0===o?void 0:o.templateNodes)||void 0===r?void 0:r[0])||void 0===a?void 0:a.values)||[];if(i.length){const o=new Map(null===(s=e.inputAssignment)||void 0===s?void 0:s.objects.map(e=>[e.value,e.label]));t=o.get(i[0])||"",null===(l=e.inputAssignment)||void 0===l||l.templateNodes.forEach(e=>{e.values.forEach(e=>{const t=o.get(e);t&&(n+=" "+t)})})}Object.keys(g).length||(g={title:e.selectedTemplateInfo.title+" "+t,description:e.selectedTemplateInfo.title+" Report for"+n,outputFormat:{},targetDocument:{}}),f.ui.titleEditor.value=g.title,f.ui.nameEditor.value=g.name,f.ui.descriptionEditor.value=g.description,f.ui.outputFormatEditor.value=(null===(d=g.outputFormat)||void 0===d?void 0:d.id)?g.outputFormat.name+"("+g.outputFormat.title+")":"",f.ui.outputFormatEditor.options=null===(c=g.outputFormat)||void 0===c?void 0:c.id,f.ui.targetDocumentEditor.value=(null===(u=g.targetDocument)||void 0===u?void 0:u.id)?g.targetDocument.name+"("+g.targetDocument.title+")":"",f.ui.targetDocumentEditor.options=null===(p=g.targetDocument)||void 0===p?void 0:p.id}else{const t=JSON.parse(JSON.stringify(e.selectedReportInfo));if(Object.keys(g).length||(g={title:t.title,name:t.name,description:t.description,outputFormat:t.outputFormat,targetDocument:void 0!==e.reportGenerationStatus.targetDocument?e.reportGenerationStatus.targetDocument:{}}),f.ui.titleEditor.value=g.title,f.ui.nameEditor.value=g.name,f.ui.descriptionEditor.value=g.description,f.ui.outputFormatEditor.value=g.outputFormat.name+"("+g.outputFormat.title+")",f.ui.outputFormatEditor.options=null===(m=g.outputFormat)||void 0===m?void 0:m.id,f.ui.targetDocumentEditor.value=(null===(R=g.targetDocument)||void 0===R?void 0:R.id)?g.targetDocument.name+"("+g.targetDocument.title+")":"",f.ui.targetDocumentEditor.options=null===(w=g.targetDocument)||void 0===w?void 0:w.id,Object.keys(g.outputFormat).length){const e=v.buildTooltip(t.outputFormat);f.ui.outputFormatEditor.tooltipInfos.shortHelp=e}if(Object.keys(g.targetDocument).length){const e=v.buildTooltip(g.targetDocument);f.ui.targetDocumentEditor.tooltipInfos.shortHelp=e}}f.ui.outputFormatSearch.addEventListener("buttonclick",y("outputFormat",'flattenedtaxonomies:"types/Report Template"',g)),f.ui.targetDocumentSearch.addEventListener("buttonclick",y("targetDocument",'flattenedtaxonomies:"types/DOCUMENTS"',g)),S(f.ui.outputFormatEditor.elements.container,n.RGRWizardConstants.OUTPUT_FORMAT),S(f.ui.targetDocumentEditor.elements.container,n.RGRWizardConstants.TARGET_DOCUMENT),b(e)}(t),function(e){f.ui.titleEditor.addEventListener("uncommittedChange",()=>{b(e)}),f.ui.descriptionEditor.addEventListener("change",()=>{b(e)}),f.ui.outputFormatEditor.addEventListener("change",()=>{const t=f.ui.outputFormatEditor.value.includes("(");(t||""==f.ui.outputFormatEditor.value)&&b(e)}),f.ui.outputFormatEditor.addEventListener("keydown",()=>{f.ui.outputFormatEditor.value="",f.ui.targetDocumentEditor.options={}}),f.ui.outputFormatEditor.getContent().addEventListener("keydown",e=>{8===e.keyCode&&0!==Object.keys(f.ui.outputFormatEditor.options).length&&(f.ui.outputFormatEditor.value="",f.ui.outputFormatEditor.options={})},!0),f.ui.targetDocumentEditor.addEventListener("keydown",()=>{f.ui.targetDocumentEditor.value="",f.ui.targetDocumentEditor.options={}}),f.ui.targetDocumentEditor.getContent().addEventListener("keydown",e=>{8===e.keyCode&&0!==Object.keys(f.ui.targetDocumentEditor.options).length&&(f.ui.targetDocumentEditor.value="",f.ui.targetDocumentEditor.options={})},!0),f.ui.targetDocumentEditor.addEventListener("change",()=>{const t=f.ui.targetDocumentEditor.value.includes("(");(t||""==f.ui.targetDocumentEditor.value)&&b(e)}),f.ui.targetDocumentClear.addEventListener("buttonclick",()=>{f.ui.targetDocumentEditor.value="",g.targetDocument.id="",f.ui.targetDocumentEditor.tooltipInfos.shortHelp=""})}(t),t.modal.setProperties({title:c.reportProperties}),t.modal.previousButton.visibleFlag=!0,t.isRGWidget?t.wizardMode===i.RGRWizardModes.EDIT_REPORT?(t.modal.newReportButton.label=c.applyButton,t.modal.newReportButton.visibleFlag=!0,t.modal.nextButton.visibleFlag=!1):(t.modal.newReportButton.label="ExistingReport"===t.userChoice?c.addButton:c.createButton,t.modal.newReportButton.visibleFlag=!0,t.modal.nextButton.label=c.generateButton,t.modal.nextButton.visibleFlag=!0):(t.modal.nextButton.label=c.generateButton,t.modal.nextButton.visibleFlag=!0),f.inject(e)},createAddReport:async function(e,t){try{let o="";o=await w(e,t);const{userChoice:n,modifyExisting:i}=t,r={report:{id:o,authored:"CreateNewReport"===n?"created":"ExistingReport"===n&&!0===i?"modified":void 0,generate:!1}};console.log(r),l.publish({event:"CATRgrReportWizard/closed",data:r})}catch{setTimeout(()=>{u.error(c.createReportFailed)},1e3)}finally{t.modal.destroy()}return null},getNextPanel:async function(e,t){try{let o="";t.modal.destroy(),setTimeout(()=>{u.info(c.reportProceding)},1e3),o=await w(e,t),t.wizardMode!==i.RGRWizardModes.EDIT_REPORT&&await async function(e,t){const o=await r.service3DSpace(t),n=await r.createHeaders(t,!0),i=await a.generateReports(o,n,!1,!0,[e]);l.publish({event:"CATRgrReportWizard/getWizardResult",data:i.reports[0]})}(o,e);const{userChoice:n,modifyExisting:s}=t,d={report:{id:o,authored:"CreateNewReport"===n?"created":"ExistingReport"===n&&!0===s?"modified":void 0,generate:t.wizardMode!==i.RGRWizardModes.EDIT_REPORT}};l.publish({event:"CATRgrReportWizard/closed",data:d})}catch{t.modal.destroy(),setTimeout(()=>{u.error(c.generationStatusFailed)},1e3)}return null},update:function(){var e,o;g.title=f.ui.titleEditor.value,g.name=f.ui.nameEditor.value,g.description=f.ui.descriptionEditor.value,g.configurationId=null===(e=f.ui.configComboBox)||void 0===e?void 0:e.value,g.filterView=null===(o=f.ui.filterViewComboBox)||void 0===o?void 0:o.value,t.reportProperties=g},remove:function(){f.remove()}}}}),define("DS/CATRgrReportWizard/wizard/InputAssignment",["require","exports","module","DS/Logger/Logger","UWA/Core","DS/Controls/SelectionChips","DS/CATRgrReportWizard/wizard/ReportProperties","DS/CATRgrReportWizard/utils/RGRWizardConstants","DS/CATRgrReportWizard/utils/RGRWizardModes","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/CATRgnWidgetCommons/restClient/SearchServices","DS/CATRgrReportWizard/wizard/InputAssignmentUI","DS/CATRgnWidgetCommons/restClient/TemplateServices","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","DS/RGNServices/FederatedSearch","DS/CATRgnWidgetCommons/UI/Tooltips"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,m,g,v,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inputAssignment=void 0;const R=n.getLogger(o);t.inputAssignment=function(e,t,o){var n;let h,b,w={};const C=new f.TooltipBuilder,S=s.RGRWizardConstants.ASSIGN_INPUTS;async function y(e,t,o,n){var i,a,s;if(t.objectIds.length&&!w.objects)try{const o=await u.getObjectsInfos(t.objectIds);e.typeParents=await x(t.objectIds),w.objects=(a=D(o),s=t.objectIds,null==a?void 0:a.filter(e=>s.includes(e.value)))}catch(e){h.containers.divForLoader.remove();const o="Report Template  "+t.selectedTemplateInfo.title+"("+t.selectedTemplateInfo.name+")is being indexed. <br>Either select some other template or try again after sometime",n=void 0===(null===(i=e.response)||void 0===i?void 0:i.status)?o:e.response.status.message;throw h.displayError(n),t.modal.nextButton.disabled=!0,e}e.selectionChips=[],function(e,t,o,n){var i;void 0===w.templateNodes&&(w.templateNodes=function(e,t){return t.map(t=>{const o=e.find(e=>e.name===t.name),n=o?o.values:[];return{name:t.name,title:t.title,type:t.type,cardinality:t.cardinality,typeQualifiedName:t.typeQualifiedName,nature:t.nature,values:n}})}(o,n),"CreateNewReport"===t.userChoice&&t.wizardMode!==l.RGRWizardModes.ADD_REPORT&&(e.templateNodesForSort=w.templateNodes,null===(i=e.templateNodesForSort)||void 0===i||i.sort((e,t)=>I(e.cardinality)-I(t.cardinality)),async function(e,t){var o,n,i,r,a,s;if(e.inputObjectsMap=new Map,w.objects)w.objects.forEach(t=>{var o,n;const i=t.type,r=(null===(o=e.inputObjectsMap)||void 0===o?void 0:o.get(i))||[];r.push(t),null===(n=e.inputObjectsMap)||void 0===n||n.set(i,r)});else{const l=[];for(let d=0;d<t.userSelection.length;d++){const c=null===(o=t.userSelection[d])||void 0===o?void 0:o.getType(),u={isAssigned:!1,type:null===(n=t.userSelection[d])||void 0===n?void 0:n.getType(),label:null===(i=t.userSelection[d])||void 0===i?void 0:i.getLabel(),value:null===(r=t.userSelection[d])||void 0===r?void 0:r.getID()};l.push(u);const p=(null===(a=e.inputObjectsMap)||void 0===a?void 0:a.get(c))||[];p.push(u),null===(s=e.inputObjectsMap)||void 0===s||s.set(c,p),w.objects=l}}for(let t=0;void 0!==e.templateNodesForSort&&t<e.templateNodesForSort.length;t++){const o=e.templateNodesForSort[t],n=e.inputObjectsMap.get(null==o?void 0:o.type)||[];if(0===n.length){for(const[n,i]of e.typeParents)if(i.includes(null==o?void 0:o.type)){const i=e.inputObjectsMap.get(n)||[];if(i.length>0&&void 0!==o){T(e,n,i,o,t);break}}}else void 0!==o&&T(e,o.type,n,o,t)}}(e,t),w.templateNodes=[],w.templateNodes=n.map(t=>{var o;const n=null===(o=e.templateNodesForSort)||void 0===o?void 0:o.find(e=>e.name===t.name);return n||t})))}(e,t,o,n),h.createTable(),w.templateNodes.forEach(o=>{!function(e,t,o){const n=o.typeQualifiedName.split(".");if("Standard"===n[0]){"Boolean"!==o.type||o.values.length||o.values.push("false");const e=(void 0===t.nlsTypesDict["Interface."+o.type+"Parameter"]?o.type:t.nlsTypesDict["Interface."+o.type+"Parameter"])+":"+o.name,i="<b>"+e+"</b>";h.addInputFieldRow(e,i,o.values[0],o.type,o.cardinality),function(e,t,o,n){let i,r;switch(o){case"Boolean":!function(e){h.ui.booleanCheckbox.addEventListener("buttonclick",t=>{const o=w.templateNodes.find(t=>t.name===e.name);o&&(o.values.pop(),o.values[0]=t.dsModel.checkFlag)})}(n);break;case"Integer":i="^-?([0-9]{1,9}|[0-1][0-9]{9}|20[0-9]{8}|21[0-3][0-9]{7}|214[0-6][0-9]{6}|2147[0-3][0-9]{5}|21474[0-7][0-9]{4}|214748[0-2][0-9]{3}|2147483[0-5][0-9]{2}|21474836[0-3][0-9]|214748364[0-7])$|^(-2147483648)$",r=g.integerPlaceholder,h.ui.editor.pattern=i,h.ui.editor.placeholder=r,z(t,n);break;case"Real":i="^-?\\d*(\\.\\d+)?$",r=g.realPlaceholder,h.ui.editor.pattern=i,h.ui.editor.placeholder=r,z(t,n);break;default:z(t,n)}}(0,t,n[1],o)}else{const n="<b>"+(void 0===d.getNLSType(o.type,t.nlsTypesDict)?o.type:d.getNLSType(o.type,t.nlsTypesDict))+": "+o.name+"</b>";h.addChipRow(n,o.cardinality),function(e,t,o){let n,i=!1;const a=new r({selection:{toggle:!1,mode:r.SELECTION_MODE.SINGLE,unselectAllOnEmptyArea:!1},placeholder:"single"===o.cardinality?g.addObjectSingle:"optional"===o.cardinality?g.addObjectOptional:g.addObjectList,identifier:o.name+"."+o.type+"."+o.cardinality,acceptDrop:t=>{var o,r;n=t.sourceSelectionChips,"unassigned_inputs"!==t.sourceSelectionChips.identifier&&(i=!0);const a=t.targetSelectionChips.identifier,s=t.sourceSelectionChips.getSelectedChipsOptions(),l=a.split("."),d=e.typeParents.get(null===(o=s[0])||void 0===o?void 0:o.type)||[];return"unassigned_inputs"===l[0]||l[1]===(null===(r=s[0])||void 0===r?void 0:r.type)||d.includes(l[1])}}).inject(h.ui.chipcontainer);a.onDropBlank=function(e){!function(e,t,o,n){const i=e.dataTransfer.getData("Text"),r=JSON.parse(i);if(r){let e=r.data.items;if(e)for(const n of e)if(o.type===n.objectType){const e={label:n.displayName,value:n.objectId,type:n.objectType,isAssigned:!0};t.addChip(e),w.objects.push(e)}(e=r.data["dswebux/x-controls.selectionchips.items+json"])&&(n.removeChip(e[0].label),t.addChip(e[0]))}}(e,a,o,n)},a.getContent().setStyles({flex:"90%"}),e.selectionChips.push(a),j(e,o,a),function(e,t,o){var n,i;for(const r of o.values){let o=!1;const a=null===(n=w.objects)||void 0===n?void 0:n.find(e=>e.value===r);if(a){const e={label:a.label,value:a.value,type:a.type,isAssigned:!0};t.addChip(e),o=!0}if(!o){const o=null===(i=e.existingReportObjects)||void 0===i?void 0:i.find(e=>e.value===r);if(o){const e={label:o.label,value:o.value,type:o.type,isAssigned:!0};t.addChip(e)}}}}(e,a,o),a.addEventListener("onPostRemove",e=>{if(F(e,o,"onPostRemove"),W(t),!i)for(let t=0;t<e.options.chips.length;t++){const o=e.options.chips[t].chipOptions;b.addChip(o)}i=!1}),a.addEventListener("onPostAdd",e=>{F(e,o,"onPostAdd"),W(t),i=!1})}(e,t,o)}}(e,t,o)}),W(t)}function E(e){b=new r({selection:{toggle:!1,mode:r.SELECTION_MODE.SINGLE,unselectAllOnEmptyArea:!1},identifier:"unassigned_inputs",acceptDrop:t=>{var o,n,i;const r=t.targetSelectionChips.identifier.split("."),a=[...e.typeParents.keys()],s=t.sourceSelectionChips.getSelectedChipsOptions();let l=!1,d=[];return a.length&&e.typeParents.has(null===(o=s[0])||void 0===o?void 0:o.type)&&(d=e.typeParents.get(null===(n=s[0])||void 0===n?void 0:n.type)),"unassigned_inputs"===r[0]?l=!0:(r[1]===(null===(i=s[0])||void 0===i?void 0:i.type)||d.includes(r[1]))&&(l=!0),l}}).inject(h.ui.unassingedChipContainer),function(e,t){const{isUnassignedZoneEmpty:o,objects:n,templateNodes:i}=w;if(void 0!==w.unassignedZone||o)for(const e of w.unassignedZone)t.addChip(e);else{const o=i.flatMap(e=>e.values),r=new Set(e.existingReportInputIds),a=["Report Model","CATReportReference","Report Template"];for(const e of n)if(!(a.includes(e.type)||e.isAssigned||o.includes(e.value)||r.has(e.value))){const o={label:e.label,value:e.value,type:e.type,isAssigned:e.isAssigned};t.addChip(o)}}}(e,b),b.addEventListener("onPostRemove",()=>{b.getAllChipsOptions().length||(w.isUnassignedZoneEmpty=!0)}),b.addEventListener("onPostAdd",e=>{b.unselectAllChips(),e.options.chips[0].chipOptions.isAssigned=!1,w.isUnassignedZoneEmpty=!1})}async function x(e){const o=new Map;if(t.wizardMode!==l.RGRWizardModes.EDIT_REPORT){const n=[...new Set(await u.getObjectsType(e))];try{await Promise.all(n.map(async e=>{try{const n=function(e,t){const o=new Set;for(let n=t;""!=n&&void 0!==n&&!o.has(n);n=e.get(n))o.add(n);return Array.from(o.values())}(t.parentTypes,e);o.set(e,n)}catch(t){o.set(e,[e]),R.debug("Dictionary Services are not working :",t)}}))}catch(e){R.debug("Error fetching type parents:",e)}}return o}function D(e){var t;return null===(t=e.results)||void 0===t?void 0:t.map(e=>{const t=e.attributes.find(e=>"ds6w:label"===e.name),o=e.attributes.find(e=>"resourceid"===e.name),n=e.attributes.find(e=>"ds6w:what/ds6w:type"===e.name);return{label:t?t.value:"",value:o?o.value:"",type:n?n.value:"",isAssigned:!1}})}function I(e){switch(e){case"single":return 0;case"optional":return 1;case"list":return 2;default:return 0}}function T(e,t,o,n,i){var r;for(const e of o)if(!e.isAssigned&&(n.values.push(e.value),e.isAssigned=!0,"list"!==n.cardinality))break;null===(r=e.inputObjectsMap)||void 0===r||r.set(t,o),void 0!==e.templateNodesForSort&&(e.templateNodesForSort[i]=n)}w=null!==(n=t.inputAssignment)&&void 0!==n?n:w;const j=(e,t,o)=>{let n=!1;"list"===t.cardinality&&(n=!0),h.ui.browseButton.addEventListener("buttonclick",()=>{const e={precond:'flattenedtaxonomies:"types/'+t.type+'"',multiSel:n,mode:"furtive"};v.search(e,e=>(async function(e,t){var o,n,i;if(e.length>0)for(let r=0;r<e.length;r++){const a={label:null===(o=e[r])||void 0===o?void 0:o["ds6w:label"],value:null===(n=e[r])||void 0===n?void 0:n.resourceid,type:null===(i=e[r])||void 0===i?void 0:i["ds6w:type"],isAssigned:!0};t.addChip(a),w.objects.push(a)}})(e,o),P)})};function z(e,t){h.ui.editor.addEventListener("validFlagChange",o=>{o.dsModel.validFlag?(A(o.dsModel.valueToCommit,t),W(e)):e.modal.nextButton.disabled=!0}),h.ui.editor.addEventListener("change",e=>{A(e.dsModel.value,t)})}function A(e,t){const o=w.templateNodes.find(e=>e.name===t.name);o&&(o.values=e?[e]:o.values.slice(0,-1))}function W(e){let t=!0;for(let e=0;e<w.templateNodes.length;e++){if("single"===w.templateNodes[e].cardinality&&!w.templateNodes[e].values.length){t=!1;break}if("list"!==w.templateNodes[e].cardinality&&w.templateNodes[e].values.length>1){t=!1;break}}e.modal.nextButton.disabled=!t}function F(e,t,o){const n=e.options.chips;for(let i=0;i<w.templateNodes.length;i++){const r=w.templateNodes[i];if(r.name===t.name){for(let t=0;t<n.length;t++)if("onPostRemove"===o){const e=r.values.indexOf(n[t].chipOptions.value);e>=0&&r.values.splice(e,1)}else n[t].chipOptions.isAssigned=!0,r.values.push(n[t].chipOptions.value),e.options.chips[0].isSelected=!1;O(r,e);break}}}function O(e,t){"single"===e.cardinality&&0===e.values.length?t.target.style.borderColor="red":"list"!==e.cardinality&&e.values.length>1?t.target.style.borderColor="red":t.target.removeAttribute("style")}async function P(){}function U(e){var t;h.containers.divForLoader.remove();const o=void 0===(null===(t=e.response)||void 0===t?void 0:t.status)?e.message:e.response.status.message;throw h.displayError(o),e}return{name:S,inject:function(o){h=p.inputAssignmentUI(t.userChoice,t.wizardMode,t.modifyExisting);const n={typeParents:new Map,selectionChips:[]};try{!async function(e,t,o,n){var r,a,s;if(h.containers.subContent.style.display="none",h.ui.loader.on(),"ExistingReport"===t.userChoice&&t.wizardMode!==l.RGRWizardModes.EDIT_REPORT){const e=h.containers.subContent.classList;h.ui.modifyCheckbox.visibleFlag=!1,t.modifyExisting||e.add("disable"),h.ui.modifyCheckbox.addEventListener("buttonclick",o=>{const n=o.dsModel.checkFlag;e.toggle("enable",n),e.toggle("disable",!n),t.modifyExisting=n})}t.wizardMode===l.RGRWizardModes.EDIT_REPORT&&(t.userChoice="ExistingReport",t.modifyExisting=!0,h.ui.templateSearch.disabled=!1,h.containers.subContent.classList.toggle("enable")),null===(r=h.ui.templateSearch)||void 0===r||r.addEventListener("buttonclick",()=>{v.search({identifier:"templateSearch",precond:'flattenedtaxonomies:"types/Report Model"',multiSel:!1,mode:"furtive"},n=>(async function(e,t,o,n,r){var a,s;i.is(e,"array")&&e.length>0&&(h.ui.templateEditor.value=null===(a=e[0])||void 0===a?void 0:a["ds6w:label"],o.selectedTemplateID=null===(s=e[0])||void 0===s?void 0:s.id,w.templateNodes=void 0,async function(e,t,o,n,i){var r,a;const s=await d.service3DSpace(n),l=(new d.HeadersBuilder).createHeader(n.getSecurityContext());null===(r=h.ui.table)||void 0===r||r.remove(),h.containers.unassignInputsContainer.remove();try{t.selectedTemplateInfo=(await m.getTemplate(s,l,o)).template}catch(e){U(e)}const c=t.selectedTemplateInfo.model.inputs?t.selectedTemplateInfo.model.inputs:[];if(!c.length)return h.ui.info&&h.ui.info.remove(),h.displayNoTemplateInfo(),void(t.modal.nextButton.disabled=!1);null===(a=h.ui.info)||void 0===a||a.remove();const u=C.buildTooltip(t.selectedTemplateInfo);h.ui.templateEditor.tooltipInfos.shortHelp=u,h.unassignedZone(),y(e,t,[],c).then(()=>{E(e)})}(t,o,o.selectedTemplateID,n))})(n,e,t,o),P)});let p=[];const f=await d.service3DSpace(o),R=(new d.HeadersBuilder).createHeader(o.getSecurityContext());try{if("ExistingReport"===t.userChoice||t.wizardMode===l.RGRWizardModes.EDIT_REPORT){t.selectedReportInfo=(await c.getReportDetails(f,R,t.selectedReportID)).report,t.reportGenerationStatus=(await c.generationStatus(f,R,[t.selectedReportID])).reports[0],p=void 0!==t.selectedReportInfo.inputs?JSON.parse(JSON.stringify(t.selectedReportInfo.inputs)):[],t.selectedTemplateID=null!==(a=t.selectedTemplateID)&&void 0!==a?a:t.selectedReportInfo.template.id;const o=C.buildTooltip(t.selectedReportInfo.template);if(h.ui.templateEditor.value=t.selectedReportInfo.template.title,h.ui.templateEditor.tooltipInfos.shortHelp=o,void 0!==p){const t=p.filter(e=>!e.typeQualifiedName.includes("Standard"));if(e.existingReportInputIds=[...new Set(t.flatMap(e=>e.values))],e.existingReportInputIds.length)try{const t=await u.getObjectsInfos(e.existingReportInputIds);e.existingReportObjects=t?D(t):[]}catch(e){U(e)}}}}catch(e){U(e)}const b=""!==t.selectedTemplateID?t.selectedTemplateID:null===(s=t.selectedReportInfo.template)||void 0===s?void 0:s.id;try{t.selectedTemplateInfo=(await m.getTemplate(f,R,b)).template}catch(e){h.containers.divForLoader.remove();const o=g.notFoundTemplatePrefix+t.selectedReportInfo.title+"("+t.selectedReportInfo.name+") "+g.notFoundTemplateSuffix;return h.displayError(o),t.modal.nextButton.disabled=!0,void(h.ui.modifyCheckbox&&(h.ui.modifyCheckbox.visibleFlag=!1))}const S=t.selectedTemplateInfo.model.inputs?t.selectedTemplateInfo.model.inputs:[];if(h.disableTemplateSearch(),h.ui.templateEditor.value=t.selectedTemplateInfo.title,!S.length)return h.ui.modifyCheckbox&&(h.ui.modifyCheckbox.visibleFlag=!0),h.containers.divForLoader.remove(),h.containers.subContent.style.display="block",h.displayNoTemplateInfo(),t.modal.nextButton.disabled=!1,void h.containers.unassignInputsContainer.remove();y(e,t,p,S).then(()=>{h.ui.modifyCheckbox&&(h.ui.modifyCheckbox.visibleFlag=!0),h.containers.divForLoader.remove(),h.containers.subContent.style.display="block",E(e)})}(n,t,e)}catch(e){return}t.modal.setProperties({title:g.assignInputs}),t.modal.newReportButton.visibleFlag=!1,t.modal.previousButton.visibleFlag=t.wizardMode!==l.RGRWizardModes.EDIT_REPORT,t.modal.nextButton.visibleFlag=!0,h.inject(o)},getNextPanel:function(e,t){return void 0!==b&&Object.keys(b).length?(w.unassignedZone=b.getAllChipsOptions(),w.isUnassignedZoneEmpty=!0):(w.unassignedZone={},w.isUnassignedZoneEmpty=!1),t.inputAssignment=w,a.reportProperties(e,t)},update:function(){void 0!==t.inputAssignment&&(delete t.inputAssignment,delete t.reportProperties),t.selectedTemplateID="",t.selectedReportID="",t.modifyExisting=!1},remove:function(){h.remove()}}}}),define("DS/CATRgrReportWizard/wizard/TemplateSelector",["require","exports","UWA/Core","module","DS/Logger/Logger","DS/TreeModel/TreeNodeModel","DS/CATRgrReportWizard/wizard/InputAssignment","DS/CATRgnWidgetCommons/restClient/SearchServices","DS/CATRgrReportWizard/wizard/ObjectSelectorUI","DS/CATRgrReportWizard/utils/RGRWizardConstants","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","DS/RGNServices/Alert","DS/RGNServices/FederatedSearch"],function(e,t,o,n,i,r,a,s,l,d,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateSelector=void 0;const m=i.getLogger(n);async function g(e){try{let t;if(e.objectSelectorUI.ui.loader.on(),e.objectSelectorUI.containers.datagridContainer.style.display="none",e.context.objectIds.length){const o=await s.getObjectsType(e.context.objectIds);if(!o.length){const t=e.context.userSelection.map(e=>e.getType());o.push(...t)}t=await s.getCompatibleTemplatesFromInputTypes(o),e.objectSelectorUI.ui.selectionChips.getContent().style.borderColor="darkgray",e.context.modal.nextButton.disabled=!1}else e.objectSelectorUI.ui.selectionChips.getContent().style.borderColor="red",e.context.modal.nextButton.disabled=!0;e.objectSelectorUI.containers.datagridContainer.style.display="block";const n=e.objectSelectorUI.model;n.prepareUpdate(),n.empty();const i=void 0!==t?t.results:[];null==i||i.forEach(e=>{const t=function(e){const t={physicalId:"",name:"",label:"",owner:"",revision:"",type:"",creationDate:""};return e.forEach(e=>{"resourceid"===e.name&&(t.physicalId=e.value),"ds6w:identifier"===e.name&&(t.name=e.value),"ds6w:label"===e.name&&(t.label=e.value),"ds6w:who/ds6w:responsible"===e.name&&(t.owner=e.value),"ds6w:what/ds6w:type"===e.name&&(t.type=c.templateType),"ds6wg:revision"===e.name&&(t.revision=e.value),"originated"===e.name&&(t.creationDate=e.value)}),new r({label:t.label,grid:t})}(e.attributes);n.addChild(t)}),n.pushUpdate()}catch(t){m.debug("Error while fetching compatible templates",t),e.context.modal.nextButton.disabled=!0,new o.Element("h5",{class:"error-message",text:c.errorFetchingTemplates}).inject(e.objectSelectorUI.containers.errorContainer)}finally{e.objectSelectorUI.ui.loader.off()}}async function v(){}t.TemplateSelector=class{constructor(e,t,o){this.widgetSettings=o,this.context=e,this.webClientOptions=t,this.name=d.RGRWizardConstants.REPORT_SELECTOR}inject(e){var t;this.context.userChoice="CreateNewReport",this.objectSelectorUI=new l.ObjectSelectorUI(this.context.userChoice,this.context.isRGWidget,{}),function(e){var t,o;for(let n=0;n<e.context.userSelection.length;n++)e.objectSelectorUI.ui.selectionChips.addChip({label:null===(t=e.context.userSelection[n])||void 0===t?void 0:t.getLabel(),value:null===(o=e.context.userSelection[n])||void 0===o?void 0:o.getID()})}(this),(t=this).objectSelectorUI.ui.selectionChips.addEventListener("onPostRemove",e=>{t.context.userSelection.splice(t.context.userSelection.findIndex(t=>t.getLabel()===e.options.chips[0].chipOptions.label),1),t.context.objectIds.splice(t.context.objectIds.findIndex(t=>t===e.options.chips[0].chipOptions.value),1),g(t)}),t.objectSelectorUI.ui.selectionChips.onDropBlank=function(e){!function(e,t){const o=e.dataTransfer.getData("Text");console.log(e.dataTransfer.getData("Text"));const n=JSON.parse(o);if(n){const e=n.data.items;if(e){for(let o=0;o<e.length;o++){const n={label:e[o].displayName,value:e[o].objectId,type:e[o].objectType,isAssigned:!0};t.objectSelectorUI.ui.selectionChips.addChip(n),t.context.objectIds.push(e[o].objectId),t.context.userSelection.push({getID:()=>e[o].objectId,getTenant:()=>webClientOptions.getTenant(),getLabel:()=>e[o].displayName,getType:()=>e[o].objectType})}g(t)}}}(e,t)},void 0!==t.objectSelectorUI.ui.objectsSearch&&t.objectSelectorUI.ui.objectsSearch.addEventListener("buttonclick",()=>{p.search({multiSel:!1,mode:"furtive"},e=>(async function(e,t){if(o.is(e,"array")&&e.length>-1){const o=e[0];if(!o)throw new Error("Item is null");t.objectSelectorUI.ui.selectionChips.addChip({label:o["ds6w:label"],value:o.id}),t.context.objectIds.push(o.id),t.context.userSelection.push({getID:()=>o.id,getTenant:()=>webClientOptions.getTenant(),getLabel:()=>o["ds6w:label"],getType:()=>o["ds6w:type"]}),g(t),console.log("In Report Selector Federated Search",t.context.userSelection)}})(e,t),v)}),t.objectSelectorUI.ui.dataGridView.getNodesXSO().onPostAdd(e=>{Object.values(e).forEach(e=>{t.context.selectedTemplateID=e.options.grid.physicalId})}),g(this),this.context.modal.setProperties({title:c.templateSelector}),this.context.modal.newReportButton.visibleFlag=!1,this.context.modal.previousButton.visibleFlag=!0,this.context.modal.nextButton.visibleFlag=!0,this.objectSelectorUI.inject(e)}getNextPanel(){return void 0===this.context.selectedTemplateID||""===this.context.selectedTemplateID?(setTimeout(()=>{u.info("You have not selected any template!")},1e3),null):a.inputAssignment(this.webClientOptions,this.context,this.widgetSettings)}update(){}remove(){this.objectSelectorUI.remove()}}}),define("DS/CATRgrReportWizard/wizard/ReportSelector",["require","exports","UWA/Core","module","DS/Logger/Logger","DS/TreeModel/TreeNodeModel","DS/CATRgrReportWizard/wizard/InputAssignment","DS/CATRgrReportWizard/wizard/TemplateSelector","DS/CATRgrReportWizard/wizard/ObjectSelectorUI","DS/CATRgrReportWizard/utils/RGRWizardConstants","DS/CATRgrReportWizard/utils/RGRWizardModes","DS/CATRgnWidgetCommons/restClient/CloudViewServices","DS/CATRgnWidgetCommons/restClient/DocumentServices","DS/CATRgnWidgetCommons/restClient/ReportServices","DS/CATRgnWidgetCommons/restClient/CommonServices","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard","DS/RGNServices/Alert","DS/RGNServices/FederatedSearch","DS/CATRgnWidgetCommons/utils/RGNConstants"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,m,g,v,f,R,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReportSelector=void 0;const b=i.getLogger(n);function w(e,t){!function(e){var t,o;for(let n=0;n<e.context.userSelection.length;n++)e.objectSelectorUI.ui.selectionChips.addChip({label:null===(t=e.context.userSelection[n])||void 0===t?void 0:t.getLabel(),value:null===(o=e.context.userSelection[n])||void 0===o?void 0:o.getID()})}(t),function(e){e.objectSelectorUI.ui.selectionChips.addEventListener("onPostRemove",t=>{e.context.userSelection.splice(e.context.userSelection.findIndex(e=>e.getLabel()===t.options.chips[0].chipOptions.label),1),e.context.objectIds.splice(e.context.objectIds.findIndex(e=>e===t.options.chips[0].chipOptions.value),1),C(e)}),e.objectSelectorUI.ui.selectionChips.onDropBlank=function(t){!function(e,t){const o=e.dataTransfer.getData("Text"),n=JSON.parse(o);if(n){const e=n.data.items;if(e){for(const o of e){const e={label:o.displayName,value:o.objectId,type:o.objectType};t.objectSelectorUI.ui.selectionChips.addChip(e);const n=x(o);D(n,t)}C(t)}}}(t,e)},void 0!==e.objectSelectorUI.ui.objectsSearch&&e.objectSelectorUI.ui.objectsSearch.addEventListener("buttonclick",()=>{let t="";e.context.wizardMode!==c.RGRWizardModes.ADD_REPORT&&e.context.wizardMode!==c.RGRWizardModes.DROP_TEMPLATE||(t='flattenedtaxonomies:"types/Report Model"');const n={multiSel:!1,mode:"furtive",precond:t};R.search(n,t=>(async function(e,t){var n,i;o.is(t,"array")&&t.length>-1&&(e.objectSelectorUI.ui.selectionChips.addChip({label:null===(n=t[0])||void 0===n?void 0:n["ds6w:label"],value:null===(i=t[0])||void 0===i?void 0:i.id}),y(e,t));C(e)})(e,t),S)});e.objectSelectorUI.ui.dataGridView.getNodesXSO().onPostAdd(t=>{Object.values(t).forEach(t=>{e.context.selectedReportID=t.options.grid.physicalid})})}(t),C(t),t.context.modal.setProperties({title:v.reportSelector}),t.context.modal.newReportButton.visibleFlag=!0,t.context.modal.previousButton.visibleFlag=!1,t.context.modal.nextButton.visibleFlag=!0,t.objectSelectorUI.inject(e)}async function C(e){var t,n;try{let i;e.objectSelectorUI.ui.loader.on(),e.objectSelectorUI.containers.datagridContainer.style.display="none",e.objectSelectorUI.ui.dataGridView.placeholder=e.context.newBtnplaceholder,e.context.objectIds.length?(i=await u.getCompatibleReportsFromInputs(e.context.objectIds,e.webClientOptions,e.widgetSettings),e.objectSelectorUI.ui.selectionChips.getContent().style.borderColor="darkgray",e.context.modal.nextButton.disabled=!1,e.context.modal.newReportButton.disabled=!1,e.context.newBtnplaceholder.disabled=!1):(e.objectSelectorUI.ui.selectionChips.getContent().style.borderColor="red",e.context.modal.nextButton.disabled=!0,"Add_Report"===e.context.wizardMode&&(e.context.modal.newReportButton.disabled=!0,e.context.newBtnplaceholder.disabled=!0)),e.objectSelectorUI.ui.loader.off(),e.objectSelectorUI.containers.datagridContainer.style.display="block";const a=new Map,s=e.objectSelectorUI.model;s.prepareUpdate(),s.empty();const l=void 0!==i?await async function(e,t,o){var n,i,r;const a=e.result;for(const e of a)if("ReportsFromInputs"in e.outputs)for(const n of e.outputs.ReportsFromInputs){const e=n.physicalid,i=o.has(e)?o.get(e).matchingInputs+1:1,r=(i/t.context.objectIds.length*100).toFixed()+"%";o.set(e,{...n,matchingInputs:i,score:r})}const s=await g.service3DSpace(t.webClientOptions),l=(new g.HeadersBuilder).createHeader(t.webClientOptions.getSecurityContext()),d=[...o.keys()],c=[];let u=!1;for(let e=0;e<d.length;e+=10){const t=d.slice(e,e+10);try{const e=await m.getReportsBulkDetails(s,l,t);if(e.reports&&e.reports){const t=e.reports.filter(e=>void 0!==e);c.push(...t)}for(let e=0;e<(null==c?void 0:c.length);e++){const t=null===(n=c[e])||void 0===n?void 0:n.template,a=null===(i=c[e])||void 0===i?void 0:i.inputs,s=null===(r=c[e])||void 0===r?void 0:r.id;o.set(s,{...o.get(s),template:t,inputs:a})}}catch(e){u||(f.error(e),u=!0)}}return Array.from(o.values())}(i,e,a):[];l.forEach(e=>{const t=new r({label:e.label,grid:e});s.addChild(t)}),s.pushUpdate();const d=await async function(e,t,o){var n,i,r;const a=[];if(null==e)return[];const s=e.result;let l=!1;for(const e of s)if("ReportsFromInputs"in e.outputs)for(const t of e.outputs.ReportsFromInputs){const e=t.physicalid;o.set(e)}const d=await g.service3DSpace(t.webClientOptions),c=(new g.HeadersBuilder).createHeader(t.webClientOptions.getSecurityContext()),u=[...o.keys()];for(let e=0;e<u.length;e+=10){const s=u.slice(e,e+10);try{const e=await m.generationStatus(d,c,s);if(e.reports&&e.reports){const t=e.reports.filter(e=>void 0!==e);a.push(...t)}for(let e=0;e<a.length;e++){const s=null===(i=null===(n=a[e])||void 0===n?void 0:n.generation)||void 0===i?void 0:i.status,l=null===(r=a[e])||void 0===r?void 0:r.id,d=I(t,s,l);o.set(l,{...o.get(l),download:d})}}catch(e){l||(f.error(e),l=!0)}}return Array.from(o.values())}(i,e,a);for(let e=0;e<l.length&&e<l.length;e++){const o=l[e],i=d[e];(null==o?void 0:o.physicalid)===(null===(t=null==i?void 0:i.download)||void 0===t?void 0:t.id)&&Object.assign(o,i);for(let e=0;e<s.getChildren().length;e++)null===(n=s.getChildren()[e])||void 0===n||n.updateOptions({grid:{download:null==i?void 0:i.download}})}}catch(t){b.debug("Error while fetching compatible reports",t),e.context.modal.nextButton.disabled=!0,e.objectSelectorUI.containers.datagridContainer.style.display="none",e.objectSelectorUI.ui.loader.off(),new o.Element("h5",{class:"error-message",text:v.errorFetchingReports}).inject(e.objectSelectorUI.containers.errorContainer)}}async function S(){}function y(e,t){for(const o of t)D(E(o),e)}function E(e){return{id:null==e?void 0:e.id,title:null==e?void 0:e["ds6w:label"],type:null==e?void 0:e["ds6w:type"]}}function x(e){return{id:e.objectId,title:e.displayName,type:e.objectType}}function D(e,t){t.context.objectIds.push(e.id),t.context.userSelection.push({getID:()=>e.id,getTenant:()=>webClientOptions.getTenant(),getLabel:()=>e.title,getType:()=>e.type})}function I(e,t,o){var n;if(t)switch(null!==(n=h.ReportStatus[t])&&void 0!==n?n:h.ReportStatus.None){case h.ReportStatus.Succeeded:case h.ReportStatus.Completed:return{icon:"download wux-ui-3ds",label:v.downloadReport,column:"download",id:o,func:function(){!async function(e){try{const t=await g.service3DSpace(e.webClientOptions),o=(new g.HeadersBuilder).createHeader(e.webClientOptions.getSecurityContext()),n=await m.generationStatus(t,o,[null==e?void 0:e.context.selectedReportID]),i=n.reports.filter(e=>e.targetDocument&&e.targetDocument.id);i.forEach(o=>{var n;if(!o.targetDocument){const e=v.downloadTargetError;throw Error(e)}p.download(t,e.webClientOptions.getSecurityContext(),o.targetDocument.id,null===(n=o.targetDocument.reportFile)||void 0===n?void 0:n.id)}),0===i.length&&f.info(v.NO_FILE_TO_DOWNLOAD)}catch(e){f.error(v.Unable_To_Download)}}(e)}};default:return 0}return 0}t.ReportSelector=class{constructor(e,t,o){this.widgetSettings=o,this.context=t,this.webClientOptions=e,this.name=d.RGRWizardConstants.REPORT_SELECTOR}inject(e){this.context.userChoice="ExistingReport";const t={placeholderText:v.templatePlaceholder,placeholderButtonLabel:v.templatePlaceholderButtonLabel,placeholderPrecond:{precond:'flattenedtaxonomies:"types/Report Model"',multiSel:!1,mode:"furtive"},drop:t=>(function(e,t,o){const n=JSON.parse(e);if(n){const e=n.data.items;e.length&&e[0]&&D(x(e[0]),t)}t.objectSelectorUI.containerAddReport.content.remove(),w(o,t)})(t,this,e),onFederatedSearchComplete:t=>(async function(e,t,n){o.is(n,"array")&&n.length>-1&&y(e,n),e.objectSelectorUI.containerAddReport.content.remove(),w(t,e)})(this,e,t),onFederatedSearchCancel:S};this.objectSelectorUI=new l.ObjectSelectorUI(this.context.userChoice,this.context.isRGWidget,t),this.context.wizardMode!==c.RGRWizardModes.ADD_REPORT||this.context.objectIds.length?w(e,this):(this.context.modal.setProperties({title:v.addReport}),this.context.modal.newReportButton.visibleFlag=!1,this.context.modal.previousButton.visibleFlag=!1,this.context.modal.nextButton.visibleFlag=!1,e.appendChild(this.objectSelectorUI.containerAddReport.content))}getNextPanel(){return void 0===this.context.selectedReportID||""===this.context.selectedReportID?(setTimeout(()=>{f.info("You have not selected any report!")},1e3),null):a.inputAssignment(this.webClientOptions,this.context,this.widgetSettings)}getNewReportPanel(){return this.context.wizardMode===c.RGRWizardModes.ADD_REPORT||this.context.wizardMode===c.RGRWizardModes.DROP_TEMPLATE?(this.context.userChoice="CreateNewReport",this.context.selectedTemplateID=this.context.objectIds[0],a.inputAssignment(this.webClientOptions,this.context,this.widgetSettings)):new s.TemplateSelector(this.context,this.webClientOptions,this.widgetSettings)}update(){}remove(){this.objectSelectorUI.remove()}}}),define("DS/CATRgrReportWizard/wizard/ReportWizard",["require","exports","DS/CATRgrReportWizard/wizard/Context","DS/CATRgrReportWizard/wizard/InputAssignment","DS/CATRgrReportWizard/wizard/ReportSelector","DS/CATRgrReportWizard/wizard/WizardUI","DS/RGNServices/WAFDataUtil","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgrReportWizard/utils/RGRWizardConstants","DS/CATRgrReportWizard/utils/RGRWizardModes","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/restClient/DictionnaryServices","DS/CoreEvents/Events","DS/RGNServices/Alert","i18n!DS/CATRgrReportWizard/assets/nls/ReportWizard"],function(e,t,o,n,i,r,a,s,l,d,c,u,p,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReportWizard=void 0;async function v(e,t){t.context.modal=t.wizardUI.containers.modal,t.context.modal.newReportButton=t.wizardUI.ui.newReport,t.context.modal.cancelButton=t.wizardUI.ui.cancel,t.context.modal.nextButton=t.wizardUI.ui.next,t.context.modal.previousButton=t.wizardUI.ui.prev,t.context.newBtnplaceholder=t.wizardUI.ui.newBtnplaceholder,e.currentPanel.inject(t.wizardUI.ui.content)}async function f(e,t,o){o.wizardUI.ui.newBtnplaceholder.addEventListener("buttonclick",()=>{R(e,o.wizardUI.ui.content,t,o.context)}),o.wizardUI.ui.newReport.addEventListener("buttonclick",()=>{R(e,o.wizardUI.ui.content,t,o.context)}),o.wizardUI.ui.prev.addEventListener("buttonclick",()=>{!function(e,t,o){e.currentPanel.remove(),e.currentPanel.name==l.RGRWizardConstants.REPORT_PROPERTIES&&(o.modal.nextButton.label=g.nextButton,o.modal.newReportButton.label=g.newReportButton,o.modal.newReportButton.disbaled=!0,o.modal.nextButton.disabled=!1);e.currentPanel.update(o),e.currentPanel=e.panelStack.pop(),e.currentPanel.inject(t)}(e,o.wizardUI.ui.content,o.context)}),o.wizardUI.ui.next.addEventListener("buttonclick",()=>{!function(e,t,o,n){let i;i=(e.currentPanel.name,l.RGRWizardConstants.REPORT_PROPERTIES,e.currentPanel.getNextPanel(o,n));i&&(e.panelStack.push(e.currentPanel),e.currentPanel.remove(),e.currentPanel.name!=l.RGRWizardConstants.REPORT_PROPERTIES&&(e.currentPanel=i,e.currentPanel.inject(t)))}(e,o.wizardUI.ui.content,t,o.context)}),o.wizardUI.ui.cancel.addEventListener("buttonclick",()=>{o.wizardUI.containers.modal.destroy(),e.currentPanel=new i.ReportSelector(t,o.context,o.settings),e.panelStack=[],p.publish({event:"CATRgrReportWizard/closed",data:{}})})}function R(e,t,o,n){let i;(i=e.currentPanel.name===l.RGRWizardConstants.REPORT_PROPERTIES?e.currentPanel.createAddReport(o,n):e.currentPanel.getNewReportPanel(o))&&(e.panelStack.push(e.currentPanel),e.currentPanel.remove(),e.currentPanel.name!=l.RGRWizardConstants.REPORT_PROPERTIES&&(e.currentPanel=i,e.currentPanel.inject(t)))}t.ReportWizard=class{constructor(e,t,o=!1){this.userSelection=null!=e?e:[];const{body:n,lang:i}=widget;this.settings={widgetBody:n,language:null!=i?i:"en"},this.initializeWizardUI(),this.initializeContext(o,t),this.setupUI()}initializeWizardUI(){this.wizardUI=new r.WizardUI(this.settings.widgetBody),this.wizardUI.ui.loader.on()}initializeContext(e,t){var n;this.context=new o.Context(this.userSelection,this.wizardUI.ui.newBtnplaceholder),this.context.isRGWidget=e,this.context.wizardMode=e?t:d.RGRWizardModes.DROP_OBJECTS,this.context.wizardMode===d.RGRWizardModes.EDIT_REPORT&&(this.context.selectedReportID=null===(n=this.userSelection[0])||void 0===n?void 0:n.getID(),this.context.modifyExisting=!0)}setupUI(){var e;(e=this.context,s.getService("3DSpace").then(e=>a.authenticatedRequest("GET",e.url+"/resources/dictionary/Dictionary?tenant="+e.tenant,"json",{})).then(t=>{const o=t.Dictionary.Types;return Object.values(o).map(t=>{t.Parent&&e.parentTypes.set(t.Name,t.Parent)}),e.parentTypes})).catch(e=>m.error("Error fetching dictionary",e)),function(e,t,o){return new Promise(()=>{var i;u.getDictionaryNLS(null!==(i=t.language)&&void 0!==i?i:"en").then(t=>{o.nlsTypesDict=t,e.context.wizardMode===d.RGRWizardModes.EDIT_REPORT&&async function(e){try{const t=new c.WidgetClientFactory,o=n.inputAssignment(t,e.context,e.settings),i=[],r={currentPanel:o,panelStack:i};f(r,t,e),v(r,e),e.wizardUI.ui.loader.off()}catch(e){throw console.error("Error setting up UI with dictionary:",e),e}}(e)}).catch(e=>{console.error("Error fetching dictionary NLS:",e)})})}(this,this.settings,this.context).catch(e=>m.error("Error fetching dictionary:",e)),this.context.wizardMode!==d.RGRWizardModes.EDIT_REPORT&&async function(e){try{const t=new c.WidgetClientFactory,o=new i.ReportSelector(t,e.context,e.settings),n=[],r={currentPanel:o,panelStack:n};f(r,t,e),v(r,e),e.wizardUI.ui.loader.off()}catch(e){throw console.error("Error setting up UI with dictionary:",e),e}}(this).catch(e=>m.error("Error setting up UI with dictionary:",e))}}}),define("DS/CATRgrReportWizard/ReportWizardCmd",["require","exports","DS/PADUtils/PADContext","DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/CATRgrReportWizard/wizard/ReportWizard","DS/RGNServices/FederatedSearch"],function(e,t,o,n,i,r,a){"use strict";return n.extend({init:function(e){this._parent(e,{isAsynchronous:!1}),a.init(`Wizard_${widget.id}`,!1),widget.onDestroy=(()=>{console.log("wizard destroyed"),a.destroy()})},onResult:function(e){i.subscribeOnce({event:"CATRgrReportWizard/getWizardResult"},e)},execute:function(){let{userSelection:e}=this.options;this.options.userSelection=void 0,void 0===e&&(e=o.get().getSelectedNodes());const t=e;new r.ReportWizard(t,this.options.mode,this.options.isRGWidget)}})});