define("DS/ENOXCADExport/Views/PropetiesView",["UWA/Class/View","DS/Utilities/Utils","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t,n,i,a,o){"use strict";var r,l;return e.extend({_context:null,slideInfoPanel:"",_state:null,_propertiesWdg:null,tagName:"div",className:"export-infopanel",setup:function(e){this.slideInfoPanel=UWA.createElement("div",{id:"slideInfoPanel",class:"slideInfo"}).inject(document.getElementById("sidebar")),this._context=e,l=e,this.launchInfoPanelDialog()},launchInfoPanelDialog:function(){var e=this,a=this._context.getTreeDocument().getXSO(),l=t.debounce(function(){!0===e._state&&e._selectionChange()},100);a.onPostAdd(l),a.onPostRemove(l),a.onEmpty(l),document.contains(document.querySelector(".enxpropertiestab"))&&document.querySelector(".enxpropertiestab").destroy(),e._propertiesWdg=new n({className:"enxpropertiestab",readOnly:!0,typeOfDisplay:i.ALL,selectionType:i.NO_SELECTION,facets:xcadexportinfra.OPERATION_STATE.propertyfacets,actions:[{name:"action_close_panel",text:o.key_close,icon:"close",handler:function(){e._state=!1,e._propertiesWdg.remove(),xcadexportinfra.setupPropertiesView(null,!0,!0)}}]}),r={require:"DS/ENOXCADExport/Views/AdditionalLinksFacet",alwaysVisible:!1,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"additionallinks",icon:"link",text:UWA.i18n("toolbar_link")},options:{xso:this._context.getNodesXSO(),renderDiv:".explorer-root"}},e._selectionChange(),e._propertiesWdg.inject(this.slideInfoPanel),UWA.createElement("div",{id:"resizerInfoDiv",class:"resizer"}).inject(this.slideInfoPanel)},_selectionChange:function(){var e=this;e._state=!0;let t=this._context.getNodesXSO().get();if(document.contains(document.querySelector(".export-standalone-content"))&&document.querySelector(".export-standalone-content").destroy(),document.contains(document.querySelector(".export-infopanel-emptycontentmessage"))&&document.querySelector(".export-infopanel-emptycontentmessage").destroy(),0===t.length)return void e._propertiesWdg.initDatas([]);if(t.length>1)return void e._setupEmptyContent(UWA.i18n("export.infopanel.multipleselection"));if(xcadexportinfra.OPERATION_STATE.showadditionallinks){document.contains(document.querySelector("#export_additionalinks_facet"))&&(document.querySelector("#export_additionalinks_facet").style.display="none");let n=t[0].options.grid.instances,i=t[0].options.grid.circularlinks,a=t[0].options.grid.family;null!=n&&n.length>0||null!=i&&i.length>0||null!=a&&a.length>0?(r.alwaysVisible=!0,e._propertiesWdg.addFacets([r]),document.contains(document.querySelector("#export_additionalinks_facet"))&&(document.querySelector("#export_additionalinks_facet").style.display="block"),setTimeout(function(){let e=UWA.createElement("span",{id:"addlink",text:l.getNodesXSO().get()[0].options.grid.title});document.querySelector(".title-section .title").appendChild(e)},100)):(r.alwaysVisible=!1,e._propertiesWdg.removeFacets([r]))}let n=new a({metatype:"businessobject",objectId:t[0].options.grid.id,source:"3DSpace"});e._propertiesWdg.initDatas([n])},_setupEmptyContent:function(e){this._state=!1,xcadexportinfra.setupPropertiesView(null,!0,!0)}})}),define("DS/ENOXCADExport/Controllers/XMLToJsonConversion",["UWA/Class/Options","UWA/Class"],function(e,t){return t.singleton(e,{_isMappingInfo:null,cyclicNodes:[],cyclicNodeData:{},compInsExpandNodes:[],compInsExpandData:{},relName:null,_mapping:null,parentNode:[],parentNodeData:{},_nodeDataArray:null,_cyclicArrayList:null,init:function(){},xmlToJson:function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0)for(var n=0;n<e.attributes.length;n++){var i=e.attributes.item(n);t[i.nodeName]=i.nodeValue}}else 3==e.nodeType?t=e.nodeValue:4==e.nodeType&&(t=e.nodeValue);var a=[].slice.call(e.childNodes).filter(function(e){return 3===e.nodeType});if(e.hasChildNodes()&&e.childNodes.length===a.length)t=[].slice.call(e.childNodes).reduce(function(e,t){return e+t.nodeValue},"");else if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var r=e.childNodes.item(o),l=r.nodeName;if(void 0===t[l])t[l]=this.xmlToJson(r);else{if(void 0===t[l].push){var d=t[l];t[l]=[],t[l].push(d)}t[l].push(this.xmlToJson(r))}}return t},transform:function(e,t,n){this._isMappingInfo=n,this._nodeDataArray=[];var i,a=(new DOMParser).parseFromString(e,"text/xml");return""!=t&&(i=(new DOMParser).parseFromString(t,"text/xml")),this.checkDataNodes(a,i)},checkDataNodes:function(e,t){var n,i,a=this,o=a.xmlToJson(e),r="",l={jsondata:{}},d=o.response.cse,s=o.response.expandrel;if(a.cyclicNodeData.cyclicNodes=new Array,"CATIAV5UPS"!==d?"FileToFile"!==s?(a.compInsExpandData.compInsExpandNodes=new Array,l.jsondata.mapping="NotFileToFile",a._mapping="NotFileToFile"):"FileToFile"===s&&(l.jsondata.mapping="FileToFile",a._mapping="FileToFile"):l.jsondata.mapping="",null!=t)"success"==(n=a.xmlToJson(t)).response.result?(r=a.mergeData(o,n),i=n.response.result):(r=n.response.info.reason,i=n.response.result);else if("success"==o.response.result){var c=o.response.info.relationshiplist.relationship,p=o.response.info.cadobjectlist.cadobject,u=o.response.info.structure.cadobject;l.jsondata.cadobjectMasterList=p;var f=a.getJsonFromStructure(u,p);r=a.jsonforGridView(c,p,f),i=o.response.result}else r=o.response.info.reason,i=o.response.result;return l.jsondata.result=i,l.jsondata.data=r,l},mergeData:function(e,t){var n;let i=e.response.info.relationshiplist.relationship,a=t.response.info.relationshiplist.relationship;n=i instanceof Object&&a instanceof Array?a.concat(i):(i instanceof Array&&Object,i.concat(a));var o=e.response.info.cadobjectlist.cadobject.concat(t.response.info.cadobjectlist.cadobject);let r=e.response.info.structure.cadobject,l=t.response.info.structure.cadobject,d=this.getJsonFromStructure(r,o),s=this.getJsonFromStructure(l,o);var c=d.concat(s);return this.jsonforGridView(n,o,c)},getJsonFromStructure:function(e,t){return this.getJsonParentChild(e,t)},jsonforGridView:function(e,t,n){var i=this.buildParentChildSkeleton(n),a=this.buildComponentDataMap(i,e,t),o=this.checkforFamilyid(i,t);return this.getJsonNodeStructureForGrid(o,t,a)},getJsonParentChild:function(e,t){var n=this,i={};if(i.structure=new Array,n.parentNodeData.parentNode=new Array,n._cyclicArrayList=new Array,null==e.length){var a="|"+e.cadid+"|"+Date.now();if(i.structure.push({cadid:e.cadid,parentid:"",rowId:a,familyId:""}),null!=e.cadobject){var o=[];null!=e.relationship&&o.push(e.relationship.rid),n.parentChildArray(e,o,t,i.structure)}}else for(var r=0;r<e.length;r++){a="|"+e[r].cadid+"|"+Date.now();if(i.structure.push({cadid:e[r].cadid,parentid:"",rowId:a,familyId:""}),null!=e[r].cadobject){o=[];null!=e[r].relationship&&o.push(e[r].relationship.rid),n.parentChildArray(e[r],o,t,i.structure)}}return n._cyclicArrayList.length>0&&n.buildCyclicNodeData(i.structure,t),console.log(i.structure),i.structure},parentChildArray:function(e,t,n,i){var a=this;let o=e.cadid,r=e.cadobject;n.find(e=>e.cadid==o);if(null==r.length){let e=a.parentNodeData.parentNode.find(e=>e.childid==r.cadid);if(i.some(e=>t.includes(e.rid)))if(null!=e&&e.parentid==o)a.buildDataStrcuture(r,o,i);else{a.buildDataStrcuture(r,o,i);let e=r.relationship.rid+"|"+r.cadid;a._cyclicArrayList.push(e)}else t.push(r.relationship.rid),a.buildDataStrcuture(r,o,i);a.parentNodeData.parentNode.push({childid:r.cadid,parentid:o}),null!=r.cadobject&&a.parentChildArray(r,t,n,i)}else for(var l=0;l<r.length;l++){let e=a.parentNodeData.parentNode.find(e=>e.childid==r[l].cadid);if(i.some(e=>t.includes(e.rid)))if(null!=e&&e.parentid==o)a.buildDataStrcuture(r[l],o,i);else{a.buildDataStrcuture(r[l],o,i);let e=r[l].relationship.rid+"|"+r[l].cadid;a._cyclicArrayList.push(e)}else t.push(r[l].relationship.rid),a.buildDataStrcuture(r[l],o,i);a.parentNodeData.parentNode.push({childid:r[l].cadid,parentid:o}),r[l].cadobject instanceof Object&&a.parentChildArray(r[l],t,n,i)}},buildDataStrcuture:function(e,t,n){var i=e.relationship.rid+"|"+e.cadid+"|"+Date.now();n.push({cadid:e.cadid,parentid:t,rowId:i,rid:e.relationship.rid,familyId:""})},buildCyclicNodeData:function(e,t){var n=this;for(let i=0;i<e.length;i++)if(""!=e[i].parentid){let a=e[i].rid+"|"+e[i].cadid;if(n._cyclicArrayList.includes(a)){let a=e.find(t=>t.parentid===e[i].cadid);if(null!=a){let e=t.find(e=>e.cadid==a.cadid);null!=n.compInsExpandData.compInsExpandNodes?(Boolean(n._isMappingInfo)?n.cyclicNodeData.cyclicNodes.push({phid:e.phid,parent:a.parentid}):n.cyclicNodeData.cyclicNodes.push({id:a.cadid,parent:a.parentid,rid:a.rid}),n.compInsExpandData.compInsExpandNodes.push({cadid:a.cadid,parent:a.parentid,rowid:a.rowId,rid:a.rid})):Boolean(n._isMappingInfo)?n.cyclicNodeData.cyclicNodes.push({phid:e.phid,parent:a.parentid}):n.cyclicNodeData.cyclicNodes.push({id:a.cadid,parent:a.parentid,rid:a.rid})}}}},buildParentChildSkeleton:function(e){for(var t,n={},i=e,a=[],o=0;t=i[o++];){var r=t.cadid,l=t.parentid;r in n?n[r]=2:-1!==Object.keys(n).indexOf(l)?n[r]=2:n[r]=1}for(o=0;o<Object.entries(n).length;o++)1==Object.entries(n)[o][1]&&a.push({id:Object.entries(n)[o][0]});var d=[];for(o=0;o<a.length;o++){var s=a[o].id,c=e.filter(e=>e.cadid===s);d.push(c[0]);var p=e.filter(e=>e.parentid===s);if(null!=p)for(var u=0;u<p.length;u++)d.push(p[u])}if(0==d.filter(t=>-1===e.indexOf(t)).length)return e;var f=[].concat(d);return this.childResultData(e,d,f),d},childResultData:function(e,t,n){for(var i=[],a=0;a<n.length;a++)if(""!=n[a].parentid){var o=n[a].cadid,r=e.filter(e=>e.parentid===o);if(null!=r)for(var l=0;l<r.length;l++)t.push(r[l]),i.push(r[l])}null!=i&&i.length>0&&this.childResultData(e,t,i)},buildComponentDataMap:function(e,t,n){var i=this;i.relName=new Map;var a={};a.structure=new Array;for(var o=[].concat(t),r=0;r<e.length;r++){var l=e[r].rid;e[r].cadid;if(null!=l){o.filter(e=>e.rid===l).forEach(e=>{i.relName.set(l,[e.cadrelationship,e.reluuid]);let t=e.attribute.find(e=>"componentID"===e.name).value["#cdata-section"];void 0===t&&(t=""),a.structure.push({relid:l,instanceName:t,treeorder:e.treeorder})})}}if(null!=i.compInsExpandData.compInsExpandNodes&&i.compInsExpandData.compInsExpandNodes.length>0&&o.length>0)for(r=0;r<i.compInsExpandData.compInsExpandNodes.length;r++){let e=i.compInsExpandData.compInsExpandNodes[r].rid,n=t.find(t=>t.rid==e),a=null!=n?n.attribute.find(function(e){if("componentID"==e.name)return e.value}):void 0;var d=null!=a?a.value["#cdata-section"]:void 0;void 0===d&&(d="");let o=null!=n&&null!=n.treeorder?n.treeorder:"";i.compInsExpandData.compInsExpandNodes[r].relname="",i.compInsExpandData.compInsExpandNodes[r].reluuid="",null!=n&&(i.compInsExpandData.compInsExpandNodes[r].relname=n.cadrelationship,i.compInsExpandData.compInsExpandNodes[r].reluuid=n.reluuid),i.compInsExpandData.compInsExpandNodes[r].instancename=d,i.compInsExpandData.compInsExpandNodes[r].treeorder=o}return a.structure},checkforFamilyid:function(e,t){for(var n=0;n<e.length;n++){var i=e[n].cadid;null!=this._mapping&&("FileToFile"===this._mapping?e[n].linkType="instance":(e[n].familyId=i,e[n].linkType="family"))}return e},getJsonNodeStructureForGrid:function(e,t,n){var i=this,a={mappinginfo:{}},o={};o.structure=new Array;var r={};r.nodes=new Array;var l={};l.insNodes=new Array;var d={};d.familyNodes=new Array;var s={};s.linkNodes=new Array;for(var c=0;c<e.length;c++){let a,s,p,u,f=e[c].cadid,x=e[c].parentid,g=e[c].rowId;null!=i.relName.get(e[c].rid)&&(p=e[c].rid,s=i.relName.get(e[c].rid)[0],a=i.relName.get(e[c].rid)[1]),null!=e[c].familyId&&""!=e[c].familyId&&(u=e[c].familyId);let E=e[c].linkType,m="",h="";if(null!=n)for(let t=0;t<n.length;t++)if(e[c].rid==n[t].relid){m=n[t].instanceName,h=null!=n[t].treeorder?n[t].treeorder:"",n.splice(t,1);break}if(null!=t.length){let e=t.find(e=>e.cadid==f);if(null!=u&&(e=t.find(e=>e.cadid==u)),i.buildStructureJson(e,x,m,h,s,g,a,o.structure),i.buildNodesJson(e,g,"",p,r.nodes),null!=E)if("instance"===E){let n;if(null!=(n=null!=u?t.find(e=>e.cadid==u):t.find(e=>e.familyid==f))){let t=n.cadid+"|"+Date.now();i.buildLinkTypeJson(n,e.cadid,t,g,l.insNodes),i.buildNodesJson(n,t,"",p,r.nodes)}}else if("family"===E){let e=t.find(e=>e.cadid==f),n=e.familyid,a=t.find(e=>e.cadid==n);if(null!=a){let t=a.cadid+"|"+Date.now();i.buildLinkTypeJson(a,e.cadid,t,g,d.familyNodes),n===a.phid&&(n=e.phid),i.buildNodesJson(a,t,n,p,r.nodes)}}}else if(t.cadid==f){i.buildStructureJson(t,x,m,h,s,g,a,o.structure),i.buildNodesJson(t,g,"",p,r.nodes);break}}if(null!=i.compInsExpandData.compInsExpandNodes&&i.compInsExpandData.compInsExpandNodes.length>0)for(let e=0;e<i.compInsExpandData.compInsExpandNodes.length;e++){let t=i.compInsExpandData.compInsExpandNodes[e];""!=t.instancename&&i.buildStructureJson(t,t.parent,t.instancename,t.treeorder,t.relname,t.rowid,t.reluuid,o.structure)}if(Boolean(i._isMappingInfo)&&xcadexportinfra.OPERATION_STATE.isstandalone){let e=[...o.structure],t=[...new Set(e.filter(e=>""!=e.parent).map(e=>e.phid))];e=e.filter(e=>""!==e.parent||!t.includes(e.phid)),o.structure=[...e]}return a.mappinginfo.structure=o.structure,a.mappinginfo.nodes=r.nodes,l.insNodes.length>0&&(a.mappinginfo.instances=l.insNodes,s.linkNodes.push("instances")),d.familyNodes.length>0&&(a.mappinginfo.family=d.familyNodes,s.linkNodes.push("family")),i.cyclicNodeData.cyclicNodes.length>0&&(i.cyclicNodeData.cyclicNodes.reverse(),Boolean(i._isMappingInfo),a.mappinginfo.circularlinks=[...new Map(i.cyclicNodeData.cyclicNodes.map(e=>[e.parent,e])).values()],s.linkNodes.push("circularlinks")),s.linkNodes.length>0&&(a.mappinginfo.additionallinks=s.linkNodes),a},buildStructureJson:function(e,t,n,i,a,o,r,l){let d=e.phid;if(null==d){let e=o.substring(o.indexOf("|")+1);d=e.substring(0,e.indexOf("|"))}Boolean(this._isMappingInfo)?l.push({phid:d,parent:t,relname:a,reluuid:r,treeorder:i}):l.push({id:d,parent:t,rowid:o,relname:a,reluuid:r,instancename:n,treeorder:i})},buildNodesJson:function(e,t,n,i,a){var o=this;let r=xcadexportinfra.NLS_DESIGN_POLICY,l=xcadexportinfra.NLS_3DEXP_TYPES,d=null!=e.defaultfilename?e.defaultfilename.substring(0,e.defaultfilename.lastIndexOf(".")):e.filename.substring(0,e.filename.lastIndexOf("."));if(Boolean(o._isMappingInfo)&&!o._nodeDataArray.includes(e.phid)){o._nodeDataArray.push(e.phid);let t=e.familyid;null==t&&(t=n),a.push({phid:e.phid,info:{title:e.Title["#cdata-section"],rev:e.Rev["#cdata-section"],type:l[e.Type["#cdata-section"]],cadtype:e.type,keyforfilesync:e.keyforfilesync,ceStamp:e.ceStamp,macroceStamp:e.macroceStamp,hashcode:e.hashcode,filename:e.filename,tgt_filename:d,def_filename:null!=e.defaultfilename?e.defaultfilename:"",uuid:e.uuid,cadid:e.cadid,familyid:t,itemid:e.itemid,composerid:e.composerid,selected:null!=e.selected?e.selected:"true"},purpose:""})}else if(!o._nodeDataArray.includes(e.cadid)){o._nodeDataArray.push(e.cadid);let n=e.Description["#cdata-section"];null==n&&(n=""),a.push({id:e.cadid,rowid:t,info:{title:e.Title["#cdata-section"],rev:e.Rev["#cdata-section"],type:l[e.Type["#cdata-section"]],cadtype:e.type,desc:n,owner:e.Owner["#cdata-section"],name:e.Name["#cdata-section"],maturitystate:e.State["#cdata-section"],state:r[e.State["#cdata-section"]],keyforfilesync:e.keyforfilesync,ceStamp:e.ceStamp,macroceStamp:e.macroceStamp,hashcode:e.hashcode,filename:e.filename,tgt_filename:d,def_filename:null!=e.defaultfilename?e.defaultfilename:"",cadorigin:e.cadorigin,familyid:e.familyid,composerid:e.composerid,relid:i,selected:null!=e.selected?e.selected:"true"},purpose:""})}},buildLinkTypeJson:function(e,t,n,i,a){Boolean(this._isMappingInfo)?a.push({rowid:n,phid:e.phid,parent:t}):a.push({rowid:n,noderowid:i,id:e.cadid,parent:t})}})}),define("DS/ENOXCADExport/utils/ExportDownloadJson",["UWA/Class/Options","UWA/Class","DS/ENOXCADUtils/utils/XCADModelEvents","text!DS/ENOXCADExport/assets/cadExtensions.json","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t,n,i,a){return t.singleton(e,{selectionArray:null,rootArray:null,init:function(){},buildDownloadJson:function(e){var t=this;let a=JSON.parse(i);var o=a[Object.keys(a).find(e=>xcadexportinfra.X3D_INTEGRATION.toLowerCase().includes(e))];function r(e){let t=e.filename,n=e.tgt_filename;if(xcadexportinfra.REGEX_VALIDATOR.test(n)&&(n=n.replace(new RegExp(xcadexportinfra.REGEX_VALIDATOR,"g"),"")),xcadexportinfra.REGEX_DOUBLE_BYTE.test(n)&&(n=n.replace(new RegExp(xcadexportinfra.REGEX_DOUBLE_BYTE,"g"),"")),n.endsWith(".")&&(n=n.slice(0,-1)),0==Object.entries(t).length||0==Object.entries(n).length)return n;let i=t.substr(t.lastIndexOf(".")+1);return o.includes(n.substr(n.lastIndexOf(".")+1).toLowerCase())?n.substr(0,n.lastIndexOf("."))+"."+i:n+"."+i}let l=[];var d={operation:"download",version:"1.0",data:{}};null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming&&(d.version="1.1"),t.selectionArray=[],t.rootArray=[];for(let n=0;n<e.length;n++){let i=e[n].options.grid,a=e[n].isRoot(),o={phid:i.id,isRoot:a,purposekey:i.purpose,purpose:t.getPurposeNLS(i.purpose)},d="";null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming&&(d=r(i),o.tgt_filename=d),l.push(o),t.buildDownloadData(i,a,d)}xcadexportinfra.ROOT_NODES=l,d.data.selectioninfo=t.selectionArray,d.data.root=t.rootArray,n.publish({event:"webinwin:web:notification",data:d})},buildDownloadData:function(e,t,n){if(""!=e.purpose&&"exclude"!=e.purpose){let i={phid:e.id,cadtype:e.cadtype,cadorigin:e.cadorigin};""!=n&&(i.filename=e.filename,i.tgt_filename=n),this.selectionArray.push(i),Boolean(t)&&"drawing"!=e.cadtype&&this.rootArray.push(i)}},getPurposeNLS:function(e){let t;return"readonly"===e?t=a.cust_context:"exclude"===e?t=a.cust_exclude:"edit"===e&&(t=a.cust_edit),t}})}),define("DS/ENOXCADExport/utils/ValidateInput",["DS/Utilities/Dom"],function(e){"use strict";function t(){return"object"==typeof t.instance?Validate.instance:(t.instance=this,this)}return t.prototype.createLineEditorSign=function(t){var n=this,i=UWA.createElement("div",{class:"xcadexport-wux-controls-lineeditor-sign"});i.inject(t),n._statusOK=UWA.createElement("div",{class:"xcadexport-wux-controls-lineeditor-statusok"}),n._statusOK.hide(),n._statusOK.inject(i),e.generateIcon("status-ok",{target:n._statusOK}),n._statusKO=UWA.createElement("div",{class:"xcadexport-wux-controls-lineeditor-statusko"}),n._statusKO.hide(),n._statusKO.inject(i),e.generateIcon("status-ko",{target:n._statusKO}),n._warning=UWA.createElement("div",{class:"xcadexport-wux-controls-lineeditor-warning"}),n._warning.hide(),n._warning.inject(i),e.generateIcon("attention",{target:n._warning})},t.prototype.hideAllSignStatus=function(e){e.childNodes[0].style.removeProperty("padding-left"),e.childNodes[1].childNodes[0].hide(),e.childNodes[1].childNodes[1].hide(),e.childNodes[1].childNodes[2].hide()},t.prototype.showStatus=function(e,t){switch(e.childNodes[0].style.paddingLeft="21px",t){case"ok":e.childNodes[1].childNodes[0].show(),e.childNodes[1].childNodes[1].hide(),e.childNodes[1].childNodes[2].hide();break;case"ko":e.childNodes[1].childNodes[0].hide(),e.childNodes[1].childNodes[1].show(),e.childNodes[1].childNodes[2].hide();break;case"warning":e.childNodes[1].childNodes[0].hide(),e.childNodes[1].childNodes[1].hide(),e.childNodes[1].childNodes[2].show()}},new t}),define("DS/ENOXCADExport/Views/toolbar/ExpandSelect",["UWA/Class/View","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView"],function(e,t,n,i,a,o){var r,l,d;return e.extend({tagName:"div",id:"xcadexport-expandselect",className:"xcadexport-expandselect",items:new Array,setup:function(e){this.items=e.items||new Array,this.handler=e.handler||function(){console.log("No event tied")},this.setupListView()},render:function(e){return e&&e.container&&this.container.inject(e.container),this},setupListView:function(){l=new a,d=new n({dataModelSet:l}),r=new o({id:"xcadexport-expandselect-datagridview",treeDocument:d,cellSelection:"none",rowSelection:"none",columns:[{id:"attribute",text:"attribute",dataIndex:"attribute",getCellSemantics:function(e){if(e.nodeModel){if("expandall"===e.nodeModel.getAttributeValue("expandid"))return{icon:"flow-tree-expand-down"};if("collapseall"===e.nodeModel.getAttributeValue("expandid"))return{icon:"flow-tree-expand-up"}}}}],defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:!1,resizableFlag:!0,sortableFlag:!1}}).inject(this.container),this.customizeLayout(),this.items.forEach(function(e){var t={attribute:e.value,expandid:e.id},n=i.createTreeNodeDataModel(l,{grid:t});d.addChild(n)}),t.addEventOnElement(r,r,"click",this.handler)},customizeLayout:function(){r.showRowIndexFlag=!1,r.showSelectionCheckBoxesFlag=!1,r.layout.collectionView.showAlternateBackgroundFlag=!1,r.layout.collectionView.showRowHeaderBackgroundFlag=!1,r.layout.rowsHeader=!1,r.layout.columnsHeader=!1,r.layout.rowsIndex=!1,r.layout.collectionView.showRowBorderFlag=!0},reset:function(){d.selectAll()}})}),define("DS/ENOXCADExport/Views/AdditionalLinksFacet",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Handlebars/Handlebars","UWA/Controls/Abstract","DS/Controls/Accordeon","DS/Controls/ModalContainer","text!DS/ENOXCADExport/assets/templates/linkTable.html"],function(e,t,n,i,a,o,r,l){"use strict";var d,s=require("DS/EditPropWidget/facets/Common/FacetsBase");require("DS/EditPropWidget/constants/EditPropConstants");return t.extend(a,s,{init:function(e){this._parent(e),d=e.xso.get()[0].options,this._initUI()},_initUI:function(){this.elements.container=e.createElement("div",{class:"additionaLinksPanel"}),this.setupData()},setupData:function(t){let n=e.createElement("div",{id:"export_additionalinks_facet",class:"export-additionalinks-facet"});this.elements.container.appendChild(n);let a=i.compile(l),s=[],c=d.grid.instances,p=d.grid.circularlinks,u=d.grid.family;if(null!=c&&c.length>0){let n=this.fetchData(d.grid.instances,t),i=e.createElement("div",{id:"instanceLinkContainer"});i.setHTML(a(n)),s.push({header:e.i18n("key_instances"),content:i,expandedFlag:!0})}if(null!=p&&p.length>0){let n=this.fetchData(d.grid.circularlinks,t),i=e.createElement("div",{id:"circularLinkContainer"});i.setHTML(a(n)),s.push({header:e.i18n("key_circularlinks"),content:i,expandedFlag:!0})}if(null!=u&&u.length>0){let n=this.fetchData(d.grid.family,t),i=e.createElement("div",{id:"familyLinkContainer"});i.setHTML(a(n)),s.push({header:e.i18n("key_family"),content:i,expandedFlag:!0})}let f=new o({domId:"xcadexport_link_accordeon",items:s,style:"simple",exclusive:!1});r.createModal(n,f)},fetchData:function(t,n){function i(t){let n;return"readonly"===t?n=e.i18n("cust_context"):"exclude"===t?n=e.i18n("cust_exclude"):"edit"===t&&(n=e.i18n("cust_edit")),n}let a={label_title:e.i18n("tree"),label_rev:e.i18n("rev"),label_type:e.i18n("type"),label_name:e.i18n("name"),label_purpose:e.i18n("purpose"),cellValue:[]};for(const e of t){let t=n.find(t=>t.options.grid.id===e.id);null!=t&&(e.purpose=t.options.grid.purpose,e.refpurpose=t.options.grid.refpurpose),a.cellValue.push({value_title:e.title,value_rev:e.rev,value_type:e.type,value_name:e.name,value_purpose:i(e.purpose)})}return a}})}),define("DS/ENOXCADExport/cmd/AddExistingContentCmd",["DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADUtils/XCADNotification","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t,n){"use strict";var i;return{datas:{},launchSearch:function(a){var o=this;void 0!==a.precondition&&(i=a.fts_value,require(["DS/ENOXCADSearchUtils/utils/SearchUtils"],function(e){var t={title:a.title,precond:a.precondition,fts_value:a.fts_value,callback:function(e){r(e)},cancel:r};e.inAppsSearch(t)}));var r=function(a){if(null!=a&&1===a.length)if(i===a[0]["ds6w:type_value"]){xcadexportinfra.IS_3DSEARCH_DISBALED=!0;let t=o.buildExpandJson(a[0]);e.publish({event:"webinwin:web:notification",data:t}),e.publish({event:"xcad-loader-on"})}else t.infoMsg(n["xcadexport.type.support"]);console.log("contentWhenDone :"+a)}},buildExpandJson:function(e){let t={operation:"expandrequest",version:"1.0",data:{items:[{envId:xcadexportinfra.X3D_PLATFORM_ID,serviceId:"3DSpace",contextId:xcadexportinfra.X3D_URL_3DSPACE,objectId:e.id,objectType:e["ds6w:type_value"],displayName:e["ds6w:label"],displayType:e["ds6w:type"]}]}};return xcadexportinfra.EXPAND_INPUT=JSON.stringify(t.data),t}}}),define("DS/ENOXCADExport/utils/ExportWSProxy",["UWA/Core","DS/WAFData/WAFData"],function(e,t){let n=function(e,n,i){return new Promise(function(a,o){n.onComplete=function(e){let t=function(e){return"string"==typeof e?JSON.parse(e):e}(e),n=t;i&&(n=i(t)),a(n)},n.onFailure=function(e){o(e)},n.data&&(n.data=JSON.stringify(n.data)),function(e,n,i){let a=null;a=t.authenticatedRequest(e,n)}(e,n)})};return{getCadTypeMapping:function(){let e=xcadexportinfra.X3D_URL_3DSPACE+"/resources/xcaddataexch/services/cadtypemapping?integration="+xcadexportinfra.X3D_INTEGRATION+"&tenant="+xcadexportinfra.X3D_PLATFORM_ID+"&securitycontext="+xcadexportinfra.X3D_SECURITY_CONTEXT,t={type:"json",method:"GET",headers:{Accept:"application/json","content-type":"application/json"},timeout:6e5};return n(e,t)}}}),define("DS/ENOXCADExport/utils/ElementODTInfra",["DS/ENOXCADUtils/utils/XCADModelEvents","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}function i(e,t){return new Promise((n,i)=>{let a=document.getElementsByClassName("wux-layouts-collectionview wux-controls-abstract wux-layouts-datagridview supportsCustomScrolling")[0].dsModel.getTreeDocument().getAllDescendants().find(t=>t.getLabel()===e.title);if(null!=a){a.updateOptions({grid:{purpose:e.value}});let i=xcadexportinfra.OPERATION_STATE.filerenaming?12:11;t.updateCellInfraODT({nodeModel:a,cellModel:e.value,columnID:i}),n()}i()})}function a(e,t){return new Promise((n,i)=>{var a=document.getElementsByClassName("wux-layouts-collectionview wux-controls-abstract wux-layouts-datagridview supportsCustomScrolling")[0].dsModel.getTreeDocument();a.getSelectedNodes().length>0&&a.unselectAll();let o=a.getAllDescendants().find(t=>t.getLabel()===e.title);if(null!=o){o.select();let i="";switch(e.ctxcmdname){case"allparent":i="ctxParent";break;case"allchildren":i="ctxChild";break;case"alldrawing":i="ctxDrwOf"}""!=i&&(t.updateCtxInfraODT(i,a),n())}i()})}function o(e,t){return new Promise(n=>{let i=!1,a=!1,o=document.getElementsByClassName("wux-layouts-collectionview wux-controls-abstract wux-layouts-datagridview supportsCustomScrolling")[0].dsModel.getTreeDocument().getAllDescendants().find(t=>t.getAttributeValue("id")===e.phid);if(null!=o){let n=e.filename;if(xcadexportinfra.REGEX_VALIDATOR.test(n))i=!1;else if(xcadexportinfra.REGEX_DOUBLE_BYTE.test(n))i=!1;else if(n.length>xcadexportinfra.FNAME_CHAR_LIMIT||n.length<xcadexportinfra.FNAME_MIN_CHAR_LIMIT)i=!1;else{let e=o.getAttributeValue("tgt_filename");i=!xcadexportinfra.CADOBJ_NODE_LIST.validFileNames.includes(n)||n==e}let r=o.getAttributeValue("tgt_filename");t.updateCellInfraODT({nodeModel:o,cellModel:e.filename,columnID:1}),a=r!=o.getAttributeValue("tgt_filename")}n({phid:e.phid,filename:e.filename,isinputmodified:i,istargetmodified:a})})}function r(t,n){e.publish({event:"webinwin:web:notification",data:{operation:"elementactionodt",action:t,data:n}})}return n.prototype.elementAction=function(e,t,n){const l=[];switch(e.action){case"changepurpose":for(let n of e.data){const e=i(n,t);l.push(e)}Promise.all(l).then(()=>{r(e.action,{status:"success"})}).catch(t=>{r(e.action,{status:"failure"})});break;case"selectctxcmd":for(let n of e.data){const e=a(n,t);l.push(e)}Promise.all(l).then(()=>{r(e.action,{status:"success"})}).catch(t=>{r(e.action,{status:"failure"})});break;case"clickfolderbtn":document.querySelector("#selectionview_filedisk_button").click();break;case"clickexportbtn":document.querySelector("#selectionview_footer_btngrp #selectionview_footer_btn_export").click();break;case"updatefilename":for(let n of e.data){const e=o(n,t);l.push(e)}Promise.allSettled(l).then(t=>{let n=t.map(e=>e.value);r(e.action,n)});break;case"exportdump":let d=function(e){let t=document.getElementsByClassName("wux-layouts-collectionview wux-controls-abstract wux-layouts-datagridview supportsCustomScrolling")[0].dsModel.getTreeDocument().getAllDescendants(),n=[],i=1;t.filter(e=>""===e.getAttributeValue("parent")).forEach(e=>{e.options.grid.row_id=i.toString(),i+=1});for(let e of t){let i=t.filter(t=>t.getAttributeValue("parent")===e.getAttributeValue("id"));if(i.length>0)for(let t=0;t<i.length;t++){let n=i[t];if(null==n.options.grid.row_id){let i=t+1;n.options.grid.row_id=e.getAttributeValue("row_id")+"|"+i}}n.push({rowid:e.getAttributeValue("row_id"),phid:e.getAttributeValue("id"),title:e.getAttributeValue("title"),cadorigin:e.getAttributeValue("cadorigin").replace(/[^a-zA-Z0-9]/g,""),filename:e.getAttributeValue("filename"),tgt_filename:e.getAttributeValue("tgt_filename"),instancename:e.getAttributeValue("instancename"),rev:e.getAttributeValue("rev"),name:e.getAttributeValue("name"),purpose:e.getAttributeValue("purpose")})}return{customsettings:{isexport_btn_enabled:e.isExportBtnEnabled(),packagename:xcadexportinfra.X3D_PACKAGE_NAME},structure:n}}(n);r(e.action,d)}},new n}),define("DS/ENOXCADExport/cmd/ExportCtxCmd",["UWA/Class","DS/ENOXCADUtils/utils/XCADModelEvents","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t,n){"use strict";var i;return e.extend({_model:null,_dataGridView:null,_infraJson:null,getCtxMenu:function(e){var t=this,a=e.params;function o(e,t){let n=!1;return null!=e.find(e=>e.options.grid.purpose!=t.options.grid.purpose)&&(n=!0),n}t._model=e.model,t._dataGridView=e.dataGridView;var r=[];if(a&&a.collectionView&&a.cellInfos&&a.cellInfos.rowID>-1&&1==t._model.getSelectedNodes().length){let e={type:"PushItem",title:n.ctxtitle_child,action:{callback:function(e){t.contextEvent(a,"ctxChild")}}},l={type:"PushItem",title:n.ctxtitle_parent,action:{callback:function(e){t.contextEvent(a,"ctxParent")}}},d={type:"PushItem",title:n.ctxtitle_drwof,action:{callback:function(e){t.contextEvent(a,"ctxDrwOf")}}};if(a.cellInfos.nodeModel.isRoot()?a.cellInfos.nodeModel.hasChildren()&&o(a.cellInfos.nodeModel.getAllDescendants(),a.cellInfos.nodeModel)&&r.push(e):a.cellInfos.nodeModel.hasChildren()?("exclude"!=a.cellInfos.nodeModel.options.grid.purpose&&o(a.cellInfos.nodeModel.getParents(),a.cellInfos.nodeModel)&&r.push(l),o(a.cellInfos.nodeModel.getAllDescendants(),a.cellInfos.nodeModel)&&r.push(e)):"exclude"!=a.cellInfos.nodeModel.options.grid.purpose&&o(a.cellInfos.nodeModel.getParents(),a.cellInfos.nodeModel)&&r.push(l),i=[],xcadexportinfra.get("enabledwgsupport")&&"drawing"!=a.cellInfos.nodeModel.options.grid.cadtype){t._model.getRoots().filter(e=>"drawing"==e.options.grid.cadtype).map(e=>e.options.grid).forEach(e=>{e.drawingof.some(e=>e.id==a.cellInfos.nodeModel.options.grid.id)&&e.purpose!=a.cellInfos.nodeModel.options.grid.purpose&&t._model.getRoots().filter(t=>t.options.grid.id===e.id).forEach(e=>{i.push(e)})}),i.length>0&&r.push(d)}}return r},contextEvent:function(e,n,a){var o=this;function r(e,n){let i={purpose:n,refpurpose:e.options.grid.refpurpose};t.publish({event:"ExportDataGridView/updatecount",data:i}),e.updateOptions({grid:{purpose:n,refpurpose:e.options.grid.refpurpose}})}function l(e,t){let n=o._model.getAllDescendants().filter(t=>t.options.grid.id===e.options.grid.id);n.length>0&&n.forEach(function(e){null!=e.options.grid["isdiff-Origin"]&&e.options.grid["isdiff-Origin"]||r(e,t)})}if(null!=a&&(o._model=a),"ctxDrwOf"==n)i.forEach(function(e){r(e,o._model.getSelectedNodes()[0].options.grid.purpose)});else for(var d=o._model.getSelectedNodes().length,s=0;s<d;s++){var c=o._model.getSelectedNodes()[s].options.grid.purpose;if("ctxChild"==n){o._model.getSelectedNodes()[s].getAllDescendants().forEach(function(e){xcadexportinfra.OPERATION_STATE.isstandalone?l(e,c):r(e,c)})}else{let e=o._model.getSelectedNodes()[s].getParents();e.length>0&&e.forEach(function(e){xcadexportinfra.OPERATION_STATE.isstandalone?l(e,c):r(e,c)})}}xcadexportinfra.OPERATION_STATE.showstatusbar&&t.publish({event:"ExportDataGridView/updateStausBar"})}})}),define("DS/ENOXCADExport/utils/RulesInfra",["UWA/Class/Options","UWA/Class","text!DS/ENOXCADExport/assets/rulesInfra.json"],function(e,t,n){return t.singleton(e,{_propRuleList:null,_propRuleIDList:null,_cadOrigin:null,_rulesInitInfra:null,_rulesJSON:null,init:function(){var e=this;e._propRuleList=[],e._propRuleIDList=[],e._cadOrigin=xcadexportinfra.CAD_ORIGIN,e._rulesInitInfra=xcadexportinfra.X3D_RULES_INFRA,e._rulesJSON=JSON.parse(n)},checkforRules:function(e){var t=this;if(null!=t._rulesInitInfra){let n=t._rulesInitInfra,i=e.info.cadorigin.replace(/[^a-zA-Z0-9,_]/g,"");for(let a=0;a<n.length;a++){let o=t._rulesJSON.rules.find(e=>e.id===n[a].id);switch(o.id){case"rule1":o.condition.cadorigin===i&&(e.purpose=n[a].purpose,e.ispurposeUnEditable=/true/.test(o.noneditable));break;case"rule2":i===t._cadOrigin&&(e.purpose=o.target.purpose,e.ispurposeUnEditable=/true/.test(o.noneditable));break;case"rule3":"3DEXPERIENCE"!=i&&i!=t._cadOrigin&&(e.purpose=o.target.purpose,e.ispurposeUnEditable=/true/.test(o.noneditable),e["isdiff-Origin"]=!0,e.ispurposeExclude=/true/.test(o.noneditable));break;case"rule4":null!=n[a].cadtype_class&&e.info.typeclass.includes(n[a].cadtype_class)&&(e.ispurposeUnEditable=/true/.test(o.noneditable)),null!=n[a].cadtype&&n[a].cadtype.includes(e.info.cadtype)&&(e.ispurposeUnEditable=/true/.test(o.noneditable));break;case"Rule_Default_Purpose_ReadOnly":i===t._cadOrigin&&(e.purpose=o.target.purpose,e.ispurposeUnEditable=/true/.test(o.noneditable));break;case"prop_rule_nlevel":if(!t._propRuleIDList.includes(o.id)){t._propRuleIDList.push(o.id);let e=o.condition.purpose;null!=n[a].purpose&&(e=n[a].purpose),t._propRuleList.push({rule_id:o.id,purpose:e,cadtype:n[a].cadtype,cadtype_class:n[a].cadtype_class,propagate:o.target.propagate})}break;case"prop_rule_purpose_nlevel":if(!t._propRuleIDList.includes(o.id)){t._propRuleIDList.push(o.id);let e=n[a].purposekey;purpose=n[a].purpose,t._propRuleList.push({rule_id:o.id,purposekey:e,propagate:o.target.propagate})}}}}else e.ispurposeUnEditable=!1},getPropList:function(){return this._propRuleList},getPropagationLevel:function(e){let t="",n=e.options.grid;if(this._propRuleList.length>0)for(let e=0;e<this._propRuleList.length;e++){let i=this._propRuleList[e];if("prop_rule_nlevel"===i.rule_id&&i.purpose.includes(n.purpose)){let e=!1;null!=i.cadtype&&i.cadtype.includes(n.cadtype)&&(e=!0),null!=i.cadtype_class&&n.typeclass.includes(i.cadtype_class)&&(e=!0),Boolean(e)&&(t=i.propagate)}"prop_rule_purpose_nlevel"===i.rule_id&&i.purposekey.includes(n.purpose)&&(t=i.propagate)}return t}})}),define("DS/ENOXCADExport/Controllers/DataGridMapper",["UWA/Class/Options","UWA/Class","DS/ENOXCADExport/utils/RulesInfra"],function(e,t,n){return t.singleton(e,{init:function(){},parseData:function(e){let t=e.busTypeMapping,i=e.relTypeMapping,a=e.structureArray,o=e.nodesArray,r=e.instanceArray,l=e.familyArray,d=e.circularlinksArray,s=[];for(let e=0;e<o.length;e++){let i=o[e].info.cadtype,a=t.find(e=>e.type==i);"shape"===i&&0==a.class.length&&a.class.push("TYPE_REPRESENTATION_LIKE"),o[e].info.typeclass=a.class,o[e].info.cadoriginicon="",null!=xcadexportinfra.X3D_RULES_INFRA?n.checkforRules(o[e]):o[e].purpose="readonly",o[e].refpurpose=o[e].purpose}for(let e=0;e<a.length;e++){if(null!=a[e].relname){let t=i.find(t=>t.type==a[e].relname);a[e].relclass=t.class}else a[e].relclass="";let t;if(a[e].relicon="",l.length>0?null==(t=o.find(t=>t.rowid==a[e].rowid))&&(t=o.find(t=>t.id==a[e].id)):t=o.find(t=>t.id==a[e].id),null!=t){let n=Object.assign({},t);delete n.rowid,delete n.info;let i=Object.assign(a[e],t.info,n);s.push(i)}}if(r.length>0)for(let e=0;e<r.length;e++){let t=o.find(t=>t.rowid==r[e].rowid);if(null!=t){let n=Object.assign({},t);delete n.info;let i=Object.assign(r[e],t.info,n),a=s.find(t=>t.id==r[e].parent);null==a.instances&&Object.assign(a,{instances:[]}),a.instances.push(i)}}if(l.length>0){var c=[].concat(s);for(let e=0;e<l.length;e++){let t,n;if(null!=l[e].noderowid){let i=o.find(t=>t.rowid==l[e].rowid),a=Object.assign({},i);delete a.info,t=Object.assign(l[e],i.info,a),n=c.find(t=>t.rowid==l[e].noderowid)}c.splice(c.indexOf(n),1),null==n.family&&(Object.assign(n,{family:[]}),n.family.push(t))}if(c.length>0)for(let e=0;e<c.length;e++)if(null==c[e].family){let t=s.find(t=>t.rowid==c[e].rowid),n=s.find(t=>t.id==c[e].id);Object.assign(t,{family:[]}),t.family=[].concat(n.family)}}if(d.length>0)for(let e=0;e<d.length;e++){if(null!=o.find(t=>t.id==d[e].parent)){let t=s.filter(t=>t.parent==d[e].parent);s.filter(t=>t.id==d[e].parent).forEach(e=>{t.forEach(t=>{null==e.circularlinks&&Object.assign(e,{circularlinks:[]}),e.circularlinks.push(t),e.cycliclinkicon="check"})})}}return s},parseDrawingData:function(e){function t(e,t){let n=Object.assign({},t);delete n.rowid,delete n.info;let i=Object.assign(n,t.info);null==e.drawingof&&Object.assign(e,{drawingof:[]}),e.drawingof.push(i),0==l.length?l.push(e):l.some(t=>t.id!=e.id)&&l.push(e)}let n=e.dgvNodeList,i=e.includeDrwObj,a=e.nodesArray,o=e.drwOfFamilyIdObj,r=e.busTypeMapping,l=[];return Object.entries(i).forEach(([e,i])=>{let l=n.find(t=>t.options.grid.id==e.toString());if(null!=l){let n=a.find(t=>t.id==e.toString());n.purpose=l.options.grid.purpose,n.refpurpose=l.options.grid.purpose,i.forEach(i=>{let d=[];Object.values(o).some(e=>e.length>0)&&((d=a.filter(e=>o[i.id].find(t=>t==e.id))).forEach(e=>{e.purpose=l.options.grid.purpose,e.refpurpose=l.options.grid.purpose}),d.push(n),delete o[i.id]);i.info.cadtype;let s=r.find(e=>e.type==i.info.cadtype);i.typeclass=s.class,i.cadoriginicon="",i.purpose=l.options.grid.purpose,i.refpurpose=l.options.grid.purpose,i.relclass="",i.cadfiletype="swdrawing",i.cmpfamilyid=e.toString();let c=Object.assign({},i);delete c.rowid,delete c.info;let p=Object.assign(c,i.info);d.length>0?d.forEach(e=>{t(p,e)}):t(p,n)})}}),l},createSkeletonOfDataGrid:function(e){function t(t,n){if(-1!=t){if(!e[t].child)return e[t].child=[n];e[t].child.push(n)}}if(xcadexportinfra.OPERATION_STATE.isstandalone){let t=e.filter(e=>e.relclass.includes("REL_CAD_DOCUMENT_LIKE"));t.length>0&&(e=[...e.filter(e=>!e.relclass.includes("REL_CAD_DOCUMENT_LIKE")),...t])}if(xcadexportinfra.OPERATION_STATE.isstandalone)return e;const n=[];for(let i=0;i<e.length;i++){if(""==e[i].parent){n.push(e[i]),null==e[i].child&&(e[i].child=[]);continue}null==e[i].child&&(e[i].child=[]),t(e.findIndex(t=>t.id===e[i].parent),e[i])}return n}})}),define("DS/ENOXCADExport/utils/GetMappingInfo",["UWA/Class/Options","UWA/Class","DS/ENOXCADExport/Controllers/XMLToJsonConversion","DS/ENOXCADUtils/XCADNotification","DS/ENOXCADUtils/utils/XCADModelEvents","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t,n,i,a,o){return t.singleton(e,{init:function(){},buildMappingInfo:function(e,t,r){let l=[],d=[],s=xcadexportinfra.ROOT_NODES,c={operation:"getmappinginfo",version:"1.0",opendrivefileafterexport:"",openfolderafterexport:"",data:{version:"1.0",packagename:xcadexportinfra.X3D_PACKAGE_NAME.trim(),infra:xcadexportinfra.X3D_INFRA,exportdata:[]}};"3DDRIVE"===xcadexportinfra.get("selectedtoggle")&&""!=xcadexportinfra.DRIVE_3D_CONTENT?(delete c.openfolderafterexport,xcadexportinfra.OPERATION_STATE.openin3ddrive?c.opendrivefileafterexport=xcadexportinfra.OPEN_3DDRIVE_AFTER_EXPORT?"yes":"no":delete c.opendrivefileafterexport,c.data.fileinfo=xcadexportinfra.DRIVE_3D_CONTENT,c.data.drivepath=xcadexportinfra.DRIVE_3D_PATH):"FILEDISK"===xcadexportinfra.get("selectedtoggle")&&""!=xcadexportinfra.FILE_DISK_CONTENT&&(delete c.opendrivefileafterexport,c.openfolderafterexport=Boolean(xcadexportinfra.OPEN_FOLDER_AFTER_EXPORT)?"yes":"no",c.data.folderpath=xcadexportinfra.FILE_DISK_CONTENT),null!=xcadexportinfra.OPERATION_STATE.filerenaming&&(null==c.data.supportedfeatures&&(c.data.supportedfeatures={}),c.data.supportedfeatures.filerenaming=xcadexportinfra.OPERATION_STATE.filerenaming),null!=xcadexportinfra.get("targetpkgextn")&&(c.data.targetpkgextn=xcadexportinfra.get("targetpkgextn"));let p="",u=[].concat(e);for(let e=0;e<u.length;e++){let t=u[e],i=n.transform(t,"",!0);"success"===i.jsondata.result?(l.push(o.success),d.push(i)):l.push(o.failure)}l.includes(o.failure)?i.errorMsg(nodeStructureJson.jsondata.data):(d.forEach(function(e){let n={};var i=e.jsondata.data;null!=e.jsondata.mapping?n.mapping=e.jsondata.mapping:n.mapping="",n.structure=i.mappinginfo.structure;let a=i.mappinginfo.nodes;for(let e=0;e<a.length;e++){let t=s.find(t=>t.phid===a[e].phid);if(null!=t){if(Boolean(t.isRoot)?a[e].rootnode="Y":a[e].rootnode="N",a[e].purpose=t.purpose,a[e].purposekey=t.purposekey,a[e].info.tgt_filename=null!=t.tgt_filename?t.tgt_filename:"",r.length>0){let t=r.find(t=>t.phid===a[e].phid);null!=t&&(a[e].info.def_filename=t.deffilename)}}else if(a[e].rootnode="N",null!=a[e].info.familyid){let t=s.find(t=>t.phid==a[e].info.familyid);if(null!=t){if(a[e].purpose=t.purpose,a[e].purposekey=t.purposekey,a[e].info.tgt_filename=null!=t.tgt_filename?t.tgt_filename:"",r.length>0){let t=r.find(t=>t.phid===a[e].phid);null!=t&&(a[e].info.def_filename=t.deffilename)}}else xcadexportinfra.OPERATION_STATE.isstandalone&&xcadexportinfra.CHECK_SELECTION&&/false/.test(a[e].info.selected)&&(a[e].purpose=UWA.i18n("key_forceexclude"),a[e].purposekey="forceexclude",a[e].info.tgt_filename="",a[e].info.def_filename="")}}if(n.nodes=a,null!=i.mappinginfo.instances&&(n.instances=i.mappinginfo.instances),null!=i.mappinginfo.family&&(n.family=i.mappinginfo.family),null!=i.mappinginfo.circularlinks&&(n.circularlinks=i.mappinginfo.circularlinks),null!=i.mappinginfo.additionallinks&&(n.additionallinks=i.mappinginfo.additionallinks),t.length>0){null!=n.additionallinks?n.additionallinks.push("drawingof"):n.additionallinks=["drawingof"],n.drawingof=[];for(let e=0;e<t.length;e++){let i=t[e],a=s.find(e=>e.phid==i.id),o={phid:i.id,info:{cadid:i.id,rev:i.rev,keyforfilesync:i.keyforfilesync,macroceStamp:i.macroceStamp,cadtype:i.cadtype,hashcode:i.hashcode,ceStamp:i.ceStamp,title:i.title,type:i.type,uuid:"",familyid:"",filename:i.filename,def_filename:"",tgt_filename:null!=a.tgt_filename?a.tgt_filename:""},purpose:a.purpose,purposekey:a.purposekey,rootnode:"N"};if(r.length>0){let e=r.find(e=>e.phid===i.cmpfamilyid);null!=e&&(o.info.def_filename=e.deffilename)}n.nodes.push(o),n.drawingof.push({parent:i.cmpfamilyid,phid:i.id})}}null!=xcadexportinfra.EXPAND_INPUT?p=JSON.parse(xcadexportinfra.EXPAND_INPUT):null!=xcadexportinfra.SELECTED_OBJECT&&(p=xcadexportinfra.SELECTED_OBJECT),c.data.exportdata.push({mappinginfo:n,expandinput:p})}),a.publish({event:"xcad-loader-off"}),a.publish({event:"webinwin:web:notification",data:c}))},packageNotification:function(e){let t=n.xmlToJson(e);t.jsondata.result===o.success?i.sucessMsg(t.response.info):i.errorMsg(t.response.info)}})}),define("DS/ENOXCADExport/Views/toolbar/ExportToolBar",["UWA/Class/View","DS/Controls/Abstract","DS/Controls/Toolbar","DS/Controls/TooltipModel","DS/Controls/Popup","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADExport/Views/toolbar/ExpandSelect","DS/ENOXCADUtils/XCADNotification"],function(e,t,n,i,a,o,r,l){"use strict";var d,s,c,p,u,f,x,g,E;return e.extend({tagName:"div",className:"xcadexport-homeview-tbar",id:"xcadexport-homeview-tbar",renameDialog:null,setup:function(e){s=this.options.dataGridView,(d=new n({})).inject(this.container),this.setupRightBarActions(),p=new Array},setupRightBarActions:function(){var e=this;if(xcadexportinfra.OPERATION_STATE.showsearchbtn){let n=UWA.createElement("span",{id:"plusBtn",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus xcadexport-homeview-tbar-action"}),a=new t({tooltipInfos:new i({title:UWA.i18n("xcadexport.toolbar.action.plus"),shortHelp:UWA.i18n("xcadexport.toolbar.action.plus.help"),mouseRelativePosition:!0,position:"top"})});a.getContent().appendChild(n),d.add("element",{element:a.getContent(),position:"far",index:3}),a.addEventListener("click",e.open3DSearchAction.bind(null,e))}if(xcadexportinfra.get("enabledwgsupport")){let n=UWA.createElement("span",{id:"drawingBtn",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-drawing-add xcadexport-homeview-tbar-action"}),a=new t({tooltipInfos:new i({title:UWA.i18n("xcadexport.toolbar.action.drawing"),shortHelp:UWA.i18n("xcadexport.toolbar.action.drawing.help"),mouseRelativePosition:!0,position:"top"})});a.getContent().appendChild(n),d.add("element",{element:a.getContent(),position:"far",index:3}),a.addEventListener("click",e.addDrawingAction.bind(null,e));let o=UWA.createElement("div",{id:"export-toolbar-seperator",class:"export-toolbar-seperator"});d.add("element",{element:o,position:"far",index:3})}xcadexportinfra.OPERATION_STATE.controlexpandbtn&&(f=UWA.createElement("span",{id:"expandBtn",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-tree-expand-down xcadexport-homeview-tbar-action"}),(g=new t({tooltipInfos:new i({shortHelp:UWA.i18n("xcadexport.toolbar.action.expand"),mouseRelativePosition:!0,position:"top"})})).getContent().appendChild(f),d.add("element",{element:g.getContent(),position:"far",index:3}),e.expandAction());let n=UWA.createElement("span",{id:"sortingViewBtn",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-sorting xcadexport-homeview-tbar-action"});if((c=new t({tooltipInfos:new i({title:UWA.i18n("xcadexport.toolbar.action.sort"),shortHelp:UWA.i18n("xcadexport.toolbar.action.ascsort.help"),mouseRelativePosition:!0,position:"top"})})).getContent().appendChild(n),d.add("element",{element:c.getContent(),position:"far",index:3}),c.addEventListener("click",e.sortAction.bind(null,e)),xcadexportinfra.OPERATION_STATE.showflattenviewbtn){let n=UWA.createElement("span",{id:"flattenViewBtn",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-tree-view-flattened xcadexport-homeview-tbar-action"});(E=new t({tooltipInfos:new i({title:UWA.i18n("xcadexport.toolbar.action.flattenview"),shortHelp:UWA.i18n("xcadexport.toolbar.action.flattenview.help"),mouseRelativePosition:!0,position:"top"})})).getContent().appendChild(n),d.add("element",{element:E.getContent(),position:"far",index:3}),E.addEventListener("click",e.flattenViewAction.bind(null,e))}if(xcadexportinfra.OPERATION_STATE.showinfobtn){let n=UWA.createElement("div",{id:"export-toolbar-seperator",class:"export-toolbar-seperator"});d.add("element",{element:n,position:"far",index:3});let a=UWA.createElement("span",{id:"infoBtn",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-info xcadexport-homeview-tbar-action"}),o=new t({tooltipInfos:new i({title:UWA.i18n("xcadexport.toolbar.action.info"),shortHelp:UWA.i18n("xcadexport.toolbar.action.info.help"),mouseRelativePosition:!0,position:"top"})});o.getContent().appendChild(a),d.add("element",{element:o.getContent(),position:"far",index:3}),o.addEventListener("click",e.infoAction.bind(null,e))}},expandAction:function(){var e=[{id:"expandall",value:UWA.i18n("export.expandselect.expandall")},{id:"collapseall",value:UWA.i18n("export.expandselect.collapseall")}];x=new r({items:e,handler:function(e,t){let n=s.getTreeDocument().getSelectedNodes();for(let e=0;e<n.length;e++)"expandall"===t.nodeModel.options.grid.expandid?n[e].expandAll():"collapseall"===t.nodeModel.options.grid.expandid&&n[e].collapseAll()}}),u&&u.destroy(),(u=new a({domId:"xcadexport-expand-popup",target:g,offset:{x:-100,y:22},trigger:"click"})).addEventListener("show",function(){f.addClassName("xcadexport-expandicon-pressed")}),u.addEventListener("hide",function(){f.removeClassName("xcadexport-expandicon-pressed")}),u.setBody(x.getContent())},open3DSearchAction:function(e,t){xcadexportinfra.OPERATION_STATE.showsearchbtn&&require(["DS/ENOXCADExport/cmd/AddExistingContentCmd"],function(e){let t="";null!=xcadexportinfra.get("defaultsearchtype")&&(t=xcadexportinfra.get("defaultsearchtype")),e.launchSearch({title:UWA.i18n("placeholder_searchcontent"),precondition:"",fts_value:t})})},addDrawingAction:function(e,t){let n=s.getTreeDocument().getSelectedNodes();if(n.length>0){let e={},t=xcadexportinfra.NLS_3DEXP_TYPES.VPMReference,i=xcadexportinfra.CADOBJ_MASTER_LIST,a={operation:"includedrw",version:"1.0",data:{items:[]}},r=new Array,d=null;for(let o=0;o<n.length;o++){let l=n[o].options.grid.id;if("Drawing"===n[o].options.grid.type){d=UWA.i18n("xcadexport.selecObj.drw");break}if(p.includes(l))r.push(n[o].options.label);else if(p.push(l),e[l]=[],xcadexportinfra.OPERATION_STATE.isstandalone){if(n[o].options.grid.type===t){referenceData.push();let t={objectid:l,objecttype:"VPMReference"};e[l].push(t),a.data.items.push(t)}}else{i.filter(e=>e.familyid===l).forEach(function(t){if("VPMReference"===t.bustype){let n=t.id;null==n&&(n=t.phid);let i={objectid:n,objecttype:t.bustype};e[l].push(i),a.data.items.push(i)}})}}if(null!=d)l.warningMsg(d);else{if(r.length>0){let e=UWA.i18n("xcadexport.toolbar.includedrw")+" "+r.toString();l.infoMsg(e)}a.data.items.length>0&&(xcadexportinfra.DRAWING_OBJ=e,o.publish({event:"webinwin:web:notification",data:a}))}}else l.infoMsg(UWA.i18n("xcadexport.selecObj.includedrw"))},infoAction:function(e,t){document.querySelector("#infoBtn").getData("isButtonEnabled")&&null!=s.getModel()&&(t.target.classList.contains("selected")?(t.target.classList.remove("selected"),xcadexportinfra.setupPropertiesView(null,!0,!0)):(t.target.classList.add("selected"),null==xcadexportinfra.centrePanelNewWidth()?document.getElementById("centreContainer").style.width="70%":document.getElementById("centreContainer").style.width=xcadexportinfra.centrePanelNewWidth(),document.getElementById("centreContainer").classList.add("divmaxwidth"),xcadexportinfra.setupPropertiesView(s.getModel(),!1,!0)))},flattenViewAction:function(e,t){document.querySelector("#flattenViewBtn").getData("isButtonEnabled")&&(t.target.classList.contains("selectedflatten")?(t.target.classList.remove("selectedflatten"),o.publish({event:"DataGridView/unflattenView"}),E.tooltipInfos.shortHelp=UWA.i18n("xcadexport.toolbar.action.flattenview.help"),document.querySelector("#flattenViewBtn").classList.value="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-tree-view-flattened xcadexport-homeview-tbar-action"):(o.publish({event:"DataGridView/flattenView"}),E.tooltipInfos.shortHelp=UWA.i18n("xcadexport.toolbar.action.unflattenview.help"),document.querySelector("#flattenViewBtn").classList.value="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-tree-view-all xcadexport-homeview-tbar-action selectedflatten"))},sortAction:function(e,t){document.querySelector("#sortingViewBtn").getData("isButtonEnabled")&&(xcadexportinfra.IS_SORTING_ASC?(xcadexportinfra.IS_SORTING_ASC=!1,s.sortModel=[{dataIndex:"tree",sort:"asc"}],c.tooltipInfos.shortHelp=UWA.i18n("xcadexport.toolbar.action.ascsort.help"),document.querySelector("#sortingViewBtn").classList.value="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alpha-sorting-a-z xcadexport-homeview-tbar-action"):(xcadexportinfra.IS_SORTING_ASC=!0,s.sortModel=[{dataIndex:"tree",sort:"desc"}],c.tooltipInfos.shortHelp=UWA.i18n("xcadexport.toolbar.action.descsort.help"),document.querySelector("#sortingViewBtn").classList.value="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alpha-sorting-z-a xcadexport-homeview-tbar-action"),t.target.classList.contains("selected")||t.target.classList.add("selected"))},setNodeData:function(e){xcadexportinfra.OPERATION_STATE.controlexpandbtn&&(e.length>0?xcadexportinfra.enabledisableButtons(["#expandBtn"],!0):xcadexportinfra.enabledisableButtons(["#expandBtn"],!1))}})}),define("DS/ENOXCADExport/Views/FooterView",["UWA/Class/View","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Controls/TooltipModel","DS/ENOXCADExport/utils/ValidateInput","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADUtils/utils/XCAD3DDriveDialog"],function(e,t,n,i,a,o,r,l,d){"use strict";var s,c,p,u,f,x,g,E,m,h;return e.extend({tagName:"div",className:"xcadexport-selectionview",setup:function(e){E=null,m=null,h=!0,s=!1,"OnPremise"!=xcadexportinfra.X3D_PLATFORM_ID&&null!=xcadexportinfra.get("isplmCSAEnabled")&&"true"===xcadexportinfra.get("isplmCSAEnabled")&&(s=!0),xcadexportinfra.FILE_DISK_CONTENT=xcadexportinfra.get("folderpath"),this.renderFormDiv(),this.renderButtonDiv()},renderFormDiv:function(){let e=UWA.createElement("div",{id:"selectionview_div_content",class:"selectionview-div"}).inject(document.getElementById("footerdiv")),t={legend:UWA.i18n("selectionview.fieldset.legend.text"),packagename:UWA.i18n("selectionview.package_name")};s&&(t.iscloud=!0);let n=`\n\t\t\t\t<fieldset class="selectionview-fieldset">\n\t\t\t\t<legend class="selectionview-legened">${t.legend}</legend>\n\t\t\t\t<form class="selectionview-form">\n\t\t\t\t<table class="selectionview-table">\n\t\t\t\t${t.iscloud?'<tr>\n\t\t\t\t<td style="width:1%" id="folder_drive_radio"></td>\n\t\t\t\t<td style="width:99%" id="folder_drive_textbox"></td>\n\t\t\t\t<td id="folder_drive_button"></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t<td></td>\n\t\t\t\t<td id="open_drive_toggle"></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>':""}\n\t\t\t\t<tr>\n\t\t\t\t<td style="width:1%" id="folder_disk_radio"></td>\n\t\t\t\t<td style="width:99%" id="folder_disk_textbox"></td>\n\t\t\t\t<td id="folder_disk_button"></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t<td></td>\n\t\t\t\t<td id="open_folder_toggle"></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t<td id="package_name_space"></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t<td>${t.packagename}</td>\n\t\t\t\t<td id="package_name_textbox"></td>\n\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t\t</form>\n\t\t\t\t</fieldset>\n\t\t\t\t`;e.setHTML(n),s?(xcadexportinfra.set("selectedtoggle","3DDRIVE"),this.create3DDriveFieldSetContent()):xcadexportinfra.set("selectedtoggle","FILEDISK"),this.createFileDiskFieldSetContent()},create3DDriveFieldSetContent:function(){if(!s){let e=UWA.createElement("span",{styles:{display:"none"}}).inject(fieldDiv);fieldDiv=e}if(E=new i({domId:"selectionview_3DDrive_radio",type:"radio",label:UWA.i18n("selectionview.drive.label"),value:0,checkFlag:!0}).inject(document.getElementById("folder_drive_radio")),s&&E.addEventListener("click",this.driveToggleAction.bind(null,this)),c=new a({domId:"selectionview_3DDrive_editor",placeholder:UWA.i18n("selectionview.drive.editor.placeholder"),value:xcadexportinfra.DRIVE_3D_PATH,sizeInCharNumber:40}).inject(document.getElementById("folder_drive_textbox")),new t({domId:"selectionview_3DDrive_button",displayStyle:"lite-borders",icon:{iconPath:require.toUrl("DS/ENOXCADExport/assets/icons/32/I_Open.png")},tooltipInfos:new o({shortHelp:UWA.i18n("browse.3DDrive.DialogTitle"),mouseRelativePosition:!0,position:"top"}),showLabelFlag:!1}).inject(document.getElementById("folder_drive_button")).addEventListener("click",this.onBrowse3DDrive.bind(null,this)),xcadexportinfra.OPERATION_STATE.openin3ddrive){let e=new i({domId:"selectionview_3DDrive_switch",type:"switch",label:UWA.i18n("selectionview.drive.switch.label"),value:1,checkFlag:xcadexportinfra.ENABLE_OPEN_3DRIVE}).inject(document.getElementById("open_drive_toggle"));xcadexportinfra.OPEN_3DDRIVE_AFTER_EXPORT=xcadexportinfra.ENABLE_OPEN_3DRIVE,e.addEventListener("change",function(t){xcadexportinfra.OPEN_3DDRIVE_AFTER_EXPORT=e.checkFlag})}},createFileDiskFieldSetContent:function(){var e=this;let n=!1;s||(n=!0),m=new i({domId:"selectionview_filedisk_radio",type:"radio",label:UWA.i18n("selectionview.disk.radio.label"),value:0,checkFlag:n}).inject(document.getElementById("folder_disk_radio")),s&&m.addEventListener("click",e.filediskToggleAction.bind(null,e)),p=new a({domId:"selectionview_filedisk_editor",value:xcadexportinfra.get("folderpath"),requiredFlag:!0}).inject(document.getElementById("folder_disk_textbox")),xcadexportinfra.OPERATION_STATE.isstandalone&&(p.disabled=!0),p.addEventListener("uncommittedChange",function(){""===p.getContent().getChildren()[0].value?x.disabled=!0:x.disabled=!h,xcadexportinfra.FILE_DISK_CONTENT=p.getContent().getChildren()[0].value}),new t({domId:"selectionview_filedisk_button",displayStyle:"lite-borders",icon:{iconPath:require.toUrl("DS/ENOXCADExport/assets/icons/32/I_Open.png")},tooltipInfos:new o({shortHelp:UWA.i18n("browse.Folder.DialogTitle"),mouseRelativePosition:!0,position:"top"}),showLabelFlag:!1,onClick:function(e){l.subscribe({event:"ExportSelectionView/folderButton"},function(e){p.getContent().getChildren()[0].value=e,xcadexportinfra.FILE_DISK_CONTENT=e,x.disabled=!h,null!=xcadexportinfra.get("isODTInfra")||(p.elements._validStatusOKSign.show(),p.elements._invalidAttentionSign.hide())});l.publish({event:"xcad-loader-on"}),l.publish({event:"webinwin:web:notification",data:{operation:"folderselection",version:"1.0"}})}}).inject(document.getElementById("folder_disk_button"));let d=new i({domId:"selectionview_filedisk_switch",type:"switch",label:UWA.i18n("selectionview.disk.switch.label"),value:1,checkFlag:xcadexportinfra.ENABLE_OPEN_FOLDER}).inject(document.getElementById("open_folder_toggle"));xcadexportinfra.OPEN_FOLDER_AFTER_EXPORT=xcadexportinfra.ENABLE_OPEN_FOLDER,d.addEventListener("change",function(e){xcadexportinfra.OPEN_FOLDER_AFTER_EXPORT=d.checkFlag}),(g=new a({domId:"selectionview-package-editor",placeholder:UWA.i18n("package_name_placeholder"),displayClearFieldButtonFlag:!1}).inject(document.getElementById("package_name_textbox"))).tooltipInfos=new o,r.createLineEditorSign(g.elements.container),l.subscribe({event:"ExportSelectionView/updatepackagename"},function(){xcadexportinfra.X3D_PACKAGE_NAME=e._isPkgNameValid(xcadexportinfra.X3D_PACKAGE_NAME,!1),g.value=xcadexportinfra.X3D_PACKAGE_NAME}),l.subscribe({event:"ExportSelectionView/isConditionTrue"},function(e){x.disabled=!!e}),g.addEventListener("uncommittedChange",e._onNameChange.bind(this)),s&&xcadexportinfra.enabledisableButtons(["#selectionview_filedisk_editor","#selectionview_filedisk_button","#selectionview_filedisk_switch"],!1)},_isPkgNameValid:function(e,t){if(e){let n=/[\\?\\*\\/<>:\\\\\\|\\\"\s]/gi,i=/[\u3041-\u3096\u30a0-\u30ff]/g;if(t){return!n.test(e)&&(!i.test(e)&&(!e.endsWith(" ")&&!e.endsWith(".")))}{let t=e.replace(n,"_");return t.endsWith(".")&&(t=t.substring(0,t.length-1)),t.replace(i,"_")}}return!1},_onNameChange:function(){let e=g.getContent().getChildren()[0].value;(h=this._isPkgNameValid(e,!0))?(xcadexportinfra.X3D_PACKAGE_NAME=e,null!=g.elements.container.getAttribute("with-validsign")&&(r.showStatus(g.elements.container,"ok"),g.tooltipInfos.shortHelp="")):(null==g.elements.container.getAttribute("with-validsign")&&g.elements.container.setAttribute("with-validsign",""),r.showStatus(g.elements.container,"ko"),g.tooltipInfos.shortHelp=UWA.i18n("xcadexport.toolbar.rename.regexvalidation")),""===e&&(g.tooltipInfos.shortHelp=UWA.i18n("package_name_empty")),x.disabled=!h},renderButtonDiv:function(){let e=UWA.createElement("div",{id:"selectionview_button_content"}).inject(document.getElementById("footerdiv")),i=new n({domId:"selectionview_footer_btngrp"}).inject(e),a=(!s||""==xcadexportinfra.DRIVE_3D_PATH)&&!(!s&&""!=xcadexportinfra.FILE_DISK_CONTENT);if(x=new t({domId:"selectionview_footer_btn_export",label:UWA.i18n("selectionview.export.button.label"),emphasize:"primary",disabled:a,type:"check",onClick:function(e){l.publish({event:"ExportDataGridView/exportData"})}}),i.addChild(x),xcadexportinfra.OPERATION_STATE.footercancelbtn){let e=new t({domId:"selectionview_footer_btn_cancel",label:UWA.i18n("selectionview.cancel.button.label"),emphasize:"secondary",disabled:!1,type:"check",onClick:function(e){l.publish({event:"webinwin:web:notification",data:{operation:"cancelview",version:"1.0"}})}});i.addChild(e)}setTimeout(()=>{x.disabled=a},250)},driveToggleAction:function(e,t){E.checkFlag=!0,m.checkFlag=!1,xcadexportinfra.set("selectedtoggle","3DDRIVE"),""==xcadexportinfra.DRIVE_3D_CONTENT?x.disabled=!0:x.disabled=!1,xcadexportinfra.enabledisableButtons(["#selectionview_filedisk_editor","#selectionview_filedisk_button","#selectionview_filedisk_switch"],!1);let n=["#selectionview_3DDrive_editor","#selectionview_3DDrive_button"];xcadexportinfra.OPERATION_STATE.openin3ddrive&&n.push("#selectionview_3DDrive_switch"),xcadexportinfra.enabledisableButtons(n,!0)},filediskToggleAction:function(e,t){E.checkFlag=!1,m.checkFlag=!0,xcadexportinfra.set("selectedtoggle","FILEDISK"),""==xcadexportinfra.FILE_DISK_CONTENT?x.disabled=!0:x.disabled=!h,xcadexportinfra.enabledisableButtons(["#selectionview_filedisk_editor","#selectionview_filedisk_button","#selectionview_filedisk_switch"],!0);let n=["#selectionview_3DDrive_editor","#selectionview_3DDrive_button"];xcadexportinfra.OPERATION_STATE.openin3ddrive&&n.push("#selectionview_3DDrive_switch"),xcadexportinfra.enabledisableButtons(n,!1)},onBrowse3DDrive:function(e,t){let n=document.getElementById("mainContainer"),i=null!=xcadexportinfra.get("servicejsondata")?xcadexportinfra.get("servicejsondata"):{};new Promise(function(e){d.generate3DDriveBrowser(e,xcadexportinfra.X3D_PLATFORM_ID,n,null,!1,!0,i).then(function(e){null!=e&&(u=e.browser,f=e.immersiveframe)})}).then(function(e){if(e){let t={filestorage:"3DDrive",folderid:e.fileId,tenantid:e.tenant.platformId};xcadexportinfra.DRIVE_3D_CONTENT=t,xcadexportinfra.DRIVE_3D_PATH=e.filePath,c.getContent().getChildren()[0].value=e.filePath,x.disabled=!1}u.close(),u=null,f.destroy()})},isExportBtnEnabled:function(){return!x.disabled}})}),define("DS/ENOXCADExport/Views/ExportDataGridView",["UWA/Class","UWA/Promise","UWA/Core","DS/Utilities/Utils","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/Controls/Label","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/CollectionView/CollectionViewStatusBar","DS/ENOXCADUtils/XCADIconsPath","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADUtils/views/CADSearch","DS/ENOXCADExport/utils/ExportDownloadJson","DS/ENOXCADExport/Views/toolbar/ExportToolBar","DS/ENOXCADExport/cmd/ExportCtxCmd","DS/ENOXCADExport/utils/RulesInfra","DS/ENOXCADExport/Controllers/DataGridMapper","DS/ENOXCADExport/utils/ValidateInput","DS/ENOXCADUtils/XCADNotification","i18n!DS/ENOXCADExport/assets/nls/ExportNLS","text!DS/ENOXCADExport/assets/columns.json","text!DS/ENOXCADExport/assets/newcolumns.json"],function(e,t,n,i,a,o,r,l,d,s,c,p,u,f,x,g,E,m,h,_,D,A,w,b,v){"use strict";var S,T,N,O,I,y,C,M,R,P;return e.extend({_columnMap:null,_linkDialog:null,_ctxMenu:new m,_cadsearchview:null,_selectedIdx:null,init:function(){xcadexportinfra.resizeWindow()},setUpView:function(e){var t=this;I=0,y=0,C=0,M=0,R=0,t.setDataGridView(),t.createToolbar(),t.flattenView(),Boolean(xcadexportinfra.IS_NOT_CV5)&&t.updateStatusBar(!1),f.subscribe({event:"ExportDataGridView/exportData"},function(){f.publish({event:"xcad-loader-on"}),g.buildDownloadJson(N.getTreeDocument().getAllDescendants())}),f.subscribe({event:"xcadexport:onSearch"},function(e){t.callSearchEvent(e)}),f.subscribe({event:"xcadexport:onResetSearch"},function(){t.closeSearch(!0)})},getDataGridNodeList:function(){return N.getTreeDocument().getAllDescendants()},fillGridData:function(e){var n=this;return new t((t,i)=>{var a=[];if(xcadexportinfra.OPERATION_STATE.isstandalone){let t=[...new Set(e.filter(e=>""===e.parent).map(e=>e.id))];if(t.length>1){let n=[...new Set(e.filter(e=>""!=e.parent).map(e=>e.id))];if(0==(t=t.filter(e=>!n.includes(e))).length){let i=e.filter(e=>!(null==e.circularlinks||""!==e.parent||![...new Set(e.circularlinks.map(e=>e.id))].some(e=>n.includes(e))));t=[...new Set(i.map(e=>e.id))]}}let n=[...new Set(e.filter(e=>!t.includes(e.id)).map(e=>e.id))];e=e.filter(e=>(""==e.parent||!t.includes(e.id))&&((""!==e.parent||!n.includes(e.id))&&!(xcadexportinfra.CHECK_SELECTION&&!/true/.test(e.selected)))),xcadexportinfra.OPERATION_STATE.treeorder&&e.sort((e,t)=>parseInt(e.treeorder)>parseInt(t.treeorder)?1:-1);for(let t=0;t<e.length;t++){u.updateGridIconPath(xcadexportinfra.X3D_URL_3DSPACE,e[t]);let n={label:e[t].title,icons:[{iconPath:u.getTypeIconPath(xcadexportinfra.X3D_URL_3DSPACE,e[t],xcadexportinfra.ICON_NON_PSTYPES)}],grid:e[t]};a.push(n)}let r=[],l=[],d=[...a];var o=function(e,t,n){if(-1!=e&&!l.includes(t.grid.id)&&n[e].grid.parent!=t.grid.id){if(!n[e].children)return n[e].children=[t];n[e].children.push(t)}};for(let e=0;e<a.length;e++){if(""==a[e].grid.parent){r.push(a[e]),l.push(a[e].grid.id),null==a[e].children&&(a[e].children=[]);continue}let t=a.reduce((t,n,i)=>(n.grid.id===a[e].grid.parent&&t.push(i),t),[]);if(0==t.length){d.filter(t=>t.grid.id===a[e].grid.parent&&t.grid.parent!=a[e].grid.id).forEach(t=>{t.children?t.children.push(a[e]):t.children=[a[e]]})}else t.forEach(t=>{o(t,a[e],a)});a[e].grid.relclass.includes("REL_CAD_DOCUMENT_LIKE")&&(a.splice(e,1),e--)}if(r.length>1)return void i(new Error("XCADDtExchg.Export.MultiRootUnsupported"));S.prepareUpdate(),r.forEach(e=>{S.addRoot(e)}),S.pushUpdate()}else S.withTransactionUpdate(function(){e.forEach(function(e){var t=n.insertinGrid(e);n.getDescendants(e,t),S.addChild(t)})});n.rowSelectionEvent(),xcadexportinfra.OPERATION_STATE.treeexpandonelevel?S.expandNLevels(1):S.expandAll(),xcadexportinfra.OPERATION_STATE.defaultsortasc&&(xcadexportinfra.IS_SORTING_ASC=!1,N.sortModel=[{dataIndex:"tree",sort:"asc"}],document.querySelector("#sortingViewBtn").classList.value="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alpha-sorting-a-z xcadexport-homeview-tbar-action"),null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming?xcadexportinfra.X3D_PACKAGE_NAME=N.getTreeDocument().getRoots()[0].options.grid.tgt_filename:xcadexportinfra.X3D_PACKAGE_NAME=N.getTreeDocument().getRoots()[0].options.label,f.publish({event:"ExportSelectionView/updatepackagename"}),Boolean(xcadexportinfra.IS_NOT_CV5)&&n.updateStatusBar(!0),xcadexportinfra.OPERATION_STATE.controlexpandbtn&&(N.getTreeDocument().getAllDescendants().length<=1?document.querySelector("#expandBtn").style.display="none":document.querySelector("#expandBtn").style.removeProperty("display"));let r=["#sortingViewBtn"];xcadexportinfra.OPERATION_STATE.showinfobtn&&r.push("#infoBtn"),xcadexportinfra.OPERATION_STATE.showflattenviewbtn&&r.push("#flattenViewBtn"),xcadexportinfra.enabledisableButtons(r,!0),t()})},getDescendants:function(e,t){if(null!=e.child)for(var n=0;n<e.child.length;n++){let i=e.child[n],a=this.insertinGrid(i);t.addChild(a),this.getDescendants(i,a)}},insertinGrid:function(e){return u.updateGridIconPath(xcadexportinfra.X3D_URL_3DSPACE,e),d.createTreeNodeDataModel(T,{label:e.title,icons:[{iconPath:u.getTypeIconPath(xcadexportinfra.X3D_URL_3DSPACE,e,xcadexportinfra.ICON_NON_PSTYPES)}],grid:e})},rowSelectionEvent:function(){var e=this,t=N.getNodesXSO();t.onPostAdd(function(t){e.isSelected=!0,O.setNodeData(t);let n={operation:"selectednode",operationVersion:"1.0",content:{items:[]}},i=xcadexportinfra.NLS_3DEXP_TYPES.VPMReference;xcadexportinfra.CADOBJ_NODE_LIST.filter(e=>e.info.familyid===t[0].options.grid.id).forEach(function(e){if(e.info.type===i){let t=e.id;null==t&&(t=e.phid),n.content.items.push({id:t,familyid:e.info.familyid,type:"VPMReference"})}}),n.content.items.length>0&&f.publish({event:"webinwin:web:notification",data:n})}),t.onPostRemove(function(t){e.isSelected=!1,setTimeout(()=>{e.isSelected||O.setNodeData([])},300)})},setDataGridView:function(){var e=this;let t;if(xcadexportinfra.OPERATION_STATE.renderallcolumns){if(t=JSON.parse(b),null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming){let e={text:w.tgt_filename,dataIndex:"tgt_filename",typeRepresentation:"string",pinned:"left",editionPolicy:"EditionInPlace",editableFlag:!0};t.splice(1,0,e)}}else t=JSON.parse(v);t.push({text:"",dataIndex:"ContextualMenuColumn",hasCellValue:function(e){return!0!==e.nodeModel.getAttributeValue("ispurposeUnEditable")&&"exclude"!==e.nodeModel.getAttributeValue("purpose")}}),e.columnsMap(t),T=new s,S=xcadexportinfra.OPERATION_STATE.isstandalone?new l:new l({dataModelSet:T});let i=xcadexportinfra.get("enabledwgsupport")&&xcadexportinfra.OPERATION_STATE.isdwgmultiselect?"multiple":"single";(N=new c({identifier:"dataGridView",treeDocument:S,cellSelection:"none",rowSelection:i,rowDragEnabledFlag:!0,columns:t,defaultColumnDef:{width:"auto",resizableFlag:!0},showOutlineFlag:!0,showmodelChangesFlag:!0,showRowBorderFlag:!0,getCellTooltip:function(t){if(xcadexportinfra.OPERATION_STATE.renderallcolumns){if(t.nodeModel&&e._columnMap.has(t.columnID))switch(e._columnMap.get(t.columnID)){case"relicon":if(""!=t.nodeModel.getAttributeValue("relicon")){let e=w.relIconText;return t.nodeModel.options.grid.relicon.includes("NON_PS_Link")&&(e=w.relIconTextConditional),{shortHelp:e,updateModel:!1}}break;case"cycliclinkicon":if(null!=t.nodeModel.getAttributeValue("cycliclinkicon"))return{shortHelp:w.key_circularlinks,updateModel:!1};break;case"cadoriginicon":if(null!=t.nodeModel.getAttributeValue("cadorigin")){return{shortHelp:""!=t.nodeModel.getAttributeValue("cadorigin")?t.nodeModel.getAttributeValue("cadorigin").replace(/[^a-zA-Z0-9]/g,""):"3DEXPERIENCE",updateModel:!1}}break;case"owner":return{shortHelp:t.nodeModel.getAttributeValue("owner"),updateModel:!1};case"purpose":let i=t.nodeModel.getAttributeValue("purpose");switch(i){case"readonly":i=n.i18n("cust_context");break;case"exclude":i=n.i18n("cust_exclude");break;case"edit":i=n.i18n("cust_edit")}return{shortHelp:i,updateModel:!1};case"ContextualMenuColumn":return{shortHelp:"",updateModel:!1};default:return{shortHelp:t.nodeModel.options.grid[e._columnMap.get(t.columnID)],updateModel:!1}}if(1==t.columnID&&null==t.nodeModel)return{shortHelp:w.col_relType,updateModel:!1};if(null==t.nodeModel)return{shortHelp:t.cellModel,updateModel:!1}}else{if(t.nodeModel&&(0==t.columnID||2==t.columnID))return{shortHelp:t.cellModel,updateModel:!1};if(null==t.nodeModel)return{shortHelp:t.cellModel,updateModel:!1}}},showContextualMenuColumnFlag:!0,onContextualEvent:function(t){if(f.subscribe({event:"ExportDataGridView/updatecount"},function(t){e.updateCount(t.purpose,t.refpurpose)}),f.subscribe({event:"ExportDataGridView/updateStausBar"},function(){e.updateStatusBar(!0)}),xcadexportinfra.DEFAULT_CTX_MENU)return e._ctxMenu.getCtxMenu({params:t,model:S,dataGridView:N})}})).layout.columnHeaderHeight=40,N.layout.cellHeight=30,N.addEventListener("allCellsRendered",function(){e._lineEditorRegisterEvents()}),xcadexportinfra.get("enabledwgsupport")&&xcadexportinfra.OPERATION_STATE.isdwgmultiselect?(N.layout.rowsHeader=!0,N.showRowIndexFlag=!1,N.showSelectionCheckBoxesFlag=!0,N.layout.collectionView.showRowBorderFlag=!0):N.layout.rowsHeader=!1,xcadexportinfra.OPERATION_STATE.isstandalone&&(N.defaultColumnDef.sortableFlag=!1),e.setColumnsNls();var a=new n.Element("div",{id:"gridContainer",class:"grid-container"});a.inject(document.getElementById("centreContainer")),N.inject(a),N.getTypeRepresentationFactory().registerTypeRepresentations(e.getTypeRepresentations()),N.addEventListener("change",e._updatecell.bind(e))},_updateTooltip:function(e,t,n){null!=n.tooltipInfos?(n.tooltipInfos.title=e,n.tooltipInfos.shortHelp=t):n.tooltipInfos=new o({title:e,shortHelp:t})},getTypeRepresentations:function(){let e={};e[w.cust_context]="readonly",xcadexportinfra.OPERATION_STATE.includepurposeexclude&&(e[w.cust_exclude]="exclude"),e[w.cust_edit]="edit";var t={editable:{stdTemplate:"enumCombo",semantics:{possibleValues:e,valueType:"enumCustom"}},uneditable:{stdTemplate:"enumCombo",semantics:{possibleValues:[w.cust_edit],valueType:"enumString"}}};return JSON.stringify(t)},setColumnsNls:function(){var e=N.columns;for(let n=0;n<e.length;n++){var t=e[n].dataIndex;e[n].text=w[t]}},columnsMap:function(e){this._columnMap=new Map;for(var t=0;t<e.length;t++)switch("options"!=e[t].dataIndex&&("tree"==e[t].dataIndex?this._columnMap.set(t,"title"):this._columnMap.set(t,e[t].dataIndex)),e[t].dataIndex){case"owner":e[t].getCellSemantics=function(e){if(e.nodeModel&&e.nodeModel.getAttributeValue("owner"))return{icon:"topbar-user"}};break;case"state":e[t].onCellRequest=function(e){if(e.nodeModel){let t=new n.Element("div",{class:"xcadexport-status-div"}),i="xcadexport-"+e.nodeModel.getAttributeValue("maturitystate")+"-color",a=e.nodeModel.getAttributeValue("state");new r({value:a,domId:i,tooltipInfos:new o({shortHelp:a})}).inject(t),e.cellView.setReusableContent(t)}};break;case"cadoriginicon":e[t].getCellValueAsStringForFind=function(e){if(e.nodeModel)return e.nodeModel.getAttributeValue("cadorigin")};break;case"purpose":e[t].getCellSemantics=function(e){if(e.nodeModel&&e.nodeModel.options.grid.ispurposeExclude)return{disabled:e.nodeModel.options.grid.ispurposeExclude}},e[t].getCellTypeRepresentation=function(e){if(e.nodeModel)return e.nodeModel.options.grid.ispurposeUnEditable?null!=e.nodeModel.options.grid["isdiff-Origin"]&&e.nodeModel.options.grid["isdiff-Origin"]?"editable":"uneditable":"editable"},e[t].hasCellValue=function(e){if(e.nodeModel)return e.nodeModel.options.grid.ispurposeUnEditable?(N._setEditionMode(e.cellID,!1),null!=e.nodeModel.options.grid["isdiff-Origin"]&&e.nodeModel.options.grid["isdiff-Origin"]?"editable":"uneditable"):"editable"};break;case"tgt_filename":e[t].getCellEditableState=function(e){return e.nodeModel&&("exclude"===e.nodeModel.getAttributeValue("purpose")||e.nodeModel.getAttributeValue("typeclass").includes("TYPE_EMBEDDED_COMPONENT_LIKE"))?(e.nodeModel.setAttribute("celleditablestate",!1),e.nodeModel.isSelected()&&O.setNodeData([e.nodeModel]),!1):(e.nodeModel.setAttribute("celleditablestate",!0),!0)},e[t].getCellClassName=function(e){return"export-filename-class"}}},createToolbar:function(){let e=document.getElementById("topContainer"),t=n.createElement("div").inject(e);(O=new E({dataGridView:N})).inject(t);let i=["#sortingViewBtn"];xcadexportinfra.OPERATION_STATE.showinfobtn&&i.push("#infoBtn"),xcadexportinfra.OPERATION_STATE.showflattenviewbtn&&i.push("#flattenViewBtn"),xcadexportinfra.OPERATION_STATE.controlexpandbtn&&i.push("#expandBtn"),null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenameview&&i.push("#renameBtn"),xcadexportinfra.enabledisableButtons(i,!1)},_updatecell:function(e,t){var n=this;function i(e,t,i){n.updateCount(t,e.options.grid.refpurpose),e.updateOptions({grid:{purpose:t,refpurpose:t,ispurposeExclude:i}})}function a(e,n,a){let o=N.getTreeDocument().getAllDescendants().filter(t=>t.options.grid.id===e.options.grid.id);o.length>0&&o.forEach(function(e){let o=!(null==e.options.grid["isdiff-Origin"]||!e.options.grid["isdiff-Origin"])||(null!=a?a:t.nodeModel.options.grid.ispurposeExclude);null!=n&&null!=a?i(e,n,o):e.updateOptions({grid:{ispurposeExclude:o}})})}if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(N.layout.getDataIndexFromColumnIndex(t.columnID)){case"tgt_filename":null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming&&null!=xcadexportinfra.REGEX_VAL&&n._validateFNameUpdate(e,t);break;case"purpose":let o=t.cellModel,r=!0;if(xcadexportinfra.OPERATION_STATE.isstandalone||o!==t.nodeModel.options.grid.refpurpose||(r=!1),null!=o&&r){if(n.updateCount(o,t.nodeModel.options.grid.refpurpose),t.nodeModel.updateOptions({grid:{refpurpose:o}}),xcadexportinfra.OPERATION_STATE.isstandalone){let e=[];if(null!=t.nodeModel.options.grid.composerid){let n=N.treeDocument.getAllDescendants().find(e=>e.options.grid.id===t.nodeModel.options.grid.composerid),a="exclude"===t.nodeModel.options.grid.purpose;i(n,o,a),e=N.treeDocument.getAllDescendants().filter(e=>e.options.grid.composerid===t.nodeModel.options.grid.composerid)}else e=N.treeDocument.getAllDescendants().filter(e=>e.options.grid.composerid===t.nodeModel.options.grid.id);e.forEach(e=>{let t="exclude"===e.options.grid.purpose;i(e,o,t)})}if("N_LEVEL"===h.getPropagationLevel(t.nodeModel)){let e="exclude"===t.nodeModel.options.grid.purpose,n=!0;if(t.nodeModel.options.grid.typeclass.includes("TYPE_EMBEDDED_COMPONENT_LIKE")&&!e&&xcadexportinfra.OPERATION_STATE.isstandalone&&(n=!1),n){t.nodeModel.getAllDescendants().forEach(function(t){xcadexportinfra.OPERATION_STATE.isstandalone?a(t,o,e):i(t,o,e)})}}else if(t.nodeModel.getAllDescendants().length>0){t.nodeModel.getAllDescendants().forEach(function(e){xcadexportinfra.OPERATION_STATE.isstandalone?a(e):null!=e.options.grid.ispurposeExclude&&Boolean(e.options.grid.ispurposeExclude)&&e.updateOptions({grid:{ispurposeExclude:t.nodeModel.options.grid.ispurposeExclude}})})}xcadexportinfra.OPERATION_STATE.isstandalone&&a(t.nodeModel,o,!1),Boolean(xcadexportinfra.IS_NOT_CV5)&&n.updateStatusBar(!1)}}},_validateFNameUpdate:function(e,t){A.clearNotifications();let n=t.nodeModel,i=t.cellModel,a=N.getTreeDocument().getAllDescendants().filter(e=>"exclude"!=e.options.grid.purpose).filter(e=>!e.options.grid.typeclass.includes("TYPE_EMBEDDED_COMPONENT_LIKE")&&i.length<xcadexportinfra.FNAME_CHAR_LIMIT&&i.length>=xcadexportinfra.FNAME_MIN_CHAR_LIMIT).flatMap(e=>null!=e.options.grid.ref_fname&&""!=e.options.grid.ref_fname?e.options.grid.ref_fname:""!=e.getAttributeValue("def_filename")?e.getAttributeValue("def_filename"):e.getAttributeValue("filename").substring(0,e.getAttributeValue("filename").lastIndexOf(".")));if(xcadexportinfra.REGEX_VALIDATOR.test(i)||xcadexportinfra.REGEX_DOUBLE_BYTE.test(i)||i.length>xcadexportinfra.FNAME_CHAR_LIMIT||i.length<xcadexportinfra.FNAME_MIN_CHAR_LIMIT||a.includes(i)){var o=function(e){return null!=e.options.grid.ref_fname&&""!=e.options.grid.ref_fname?e.options.grid.ref_fname:""!=e.getAttributeValue("def_filename")?e.getAttributeValue("def_filename"):e.getAttributeValue("filename").substring(0,e.getAttributeValue("filename").lastIndexOf("."))};n.getTreeDocument().search({match:function(e){if(e.nodeModel.options.grid.id===n.options.grid.id){let t=i;xcadexportinfra.REGEX_VALIDATOR.test(i)?(t=t.replace(new RegExp(xcadexportinfra.REGEX_VALIDATOR,"g"),""),a.includes(t)&&(t=o(n))):xcadexportinfra.REGEX_DOUBLE_BYTE.test(i)?(t=t.replace(new RegExp(xcadexportinfra.REGEX_DOUBLE_BYTE,"g"),""),a.includes(t)&&(t=o(n))):t=o(n),(t.length>xcadexportinfra.FNAME_CHAR_LIMIT||t.length<xcadexportinfra.FNAME_MIN_CHAR_LIMIT)&&(t=o(n)),e.nodeModel.updateOptions({grid:{tgt_filename:t,ref_fname:t}})}}}),xcadexportinfra.IS_ODT_MODEL||(D.hideAllSignStatus(e.target.childNodes[0]),e.target.childNodes[0].childNodes[0].style.color=""),f.publish({event:"ExportSelectionView/isConditionTrue",data:!1})}else n.getTreeDocument().search({match:function(e){e.nodeModel.options.grid.id===n.options.grid.id&&e.nodeModel.updateOptions({grid:{tgt_filename:i,ref_fname:i}})}});xcadexportinfra.CADOBJ_NODE_LIST.validFileNames.includes(i)||(xcadexportinfra.CADOBJ_NODE_LIST.validFileNames=[...new Set(N.treeDocument.getAllDescendants().map(e=>e.getAttributeValue("tgt_filename")))],xcadexportinfra.X3D_PACKAGE_NAME=xcadexportinfra.X3D_PACKAGE_NAME=N.getTreeDocument().getRoots()[0].options.grid.tgt_filename,f.publish({event:"ExportSelectionView/updatepackagename"}))},_lineEditorRegisterEvents:function(){if(null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming&&null!=xcadexportinfra.REGEX_VAL){var e=this;new t(e=>{let t=document.querySelectorAll(".export-filename-class .wux-controls-lineeditor");for(let e of t)e.classList.contains("sign-added")||(e.classList.add("sign-added"),D.createLineEditorSign(e));e()}).then(function(){let t=document.querySelectorAll(".export-filename-class .wux-controls-lineeditor input");for(let r of t){var o=function(t){xcadexportinfra.IS_ODT_MODEL=!1;let i=r.parentElement.parentElement.parentElement.dsModel,a=t.target.value;A.clearNotifications();let o=n.i18n("xcadexport.toolbar.rename.regexvalidation");if(xcadexportinfra.REGEX_VALIDATOR.test(a))o=xcadexportinfra.REGEX_VAL+" : "+n.i18n("xcadexport.toolbar.rename.regexvalidation"),t.target.value=a.replace(new RegExp(xcadexportinfra.REGEX_VALIDATOR,"g"),""),A.warningMsg(o);else if(xcadexportinfra.REGEX_DOUBLE_BYTE.test(a))t.target.value=a.replace(new RegExp(xcadexportinfra.REGEX_DOUBLE_BYTE,"g"),""),A.warningMsg(o);else if(a.length>xcadexportinfra.FNAME_CHAR_LIMIT||a.length<xcadexportinfra.FNAME_MIN_CHAR_LIMIT)o=n.i18n("xcadexport.toolbar.rename.warningMsg"),P=!0,D.showStatus(r.parentElement,"warning"),e._updateTooltip("",o,i);else{D.hideAllSignStatus(r.parentElement);let t=N.getTreeDocument().getSelectedNodes()[0].getAttributeValue("tgt_filename");xcadexportinfra.CADOBJ_NODE_LIST.validFileNames.includes(a)&&a!=t?(P=!0,D.showStatus(r.parentElement,"warning"),r.style.color="orange",e._updateTooltip(n.i18n("xcadexport.sameTgtFname.title"),n.i18n("xcadexport.sameTgtFname.subtitle"),i)):(P=!1,r.style.color="",e._updateTooltip("",a,i))}f.publish({event:"ExportSelectionView/isConditionTrue",data:P})};r.classList.contains("validation-added")||(r.classList.add("validation-added"),a.addEventOnElement(e,r,"input",i.debounce(o,250)),a.addEventOnElement(e,r,"paste",i.debounce(o,250)))}})}},updateCount:function(e,t){switch(t){case"edit":I--;break;case"readonly":y--}switch(e){case"edit":I++;break;case"readonly":y++}},flattenView:function(){var e=this;function t(t,n,i){S.withTransactionUpdate(function(){t.forEach(function(t){n&&(t.child=[]);let a=e.insertinGrid(t);i&&e.getDescendants(t,a),S.addChild(a)})})}f.subscribe({event:"DataGridView/flattenView"},function(){xcadexportinfra.DEFAULT_CTX_MENU=!1,N.showContextualMenuColumnFlag=!1;let e=N.getTreeDocument().getAllDescendants().flatMap(e=>e.options.grid?e.options.grid:[]);N.getTreeDocument().empty(),t(e,!0,!1)}),f.subscribe({event:"DataGridView/unflattenView"},function(){xcadexportinfra.DEFAULT_CTX_MENU=!0,N.showContextualMenuColumnFlag=!0;let n=N.getTreeDocument().getAllDescendants().flatMap(e=>"drawing"!=e.options.grid.cadtype&&e.options.grid?e.options.grid:[]),i=N.getTreeDocument().getAllDescendants().flatMap(e=>"drawing"===e.options.grid.cadtype&&e.options.grid?e.options.grid:[]);if(N.getTreeDocument().empty(),n.length>0){let i=_.createSkeletonOfDataGrid(n);if(xcadexportinfra.OPERATION_STATE.isstandalone)return void e.fillGridData(i);t(i,!1,!0),S.expandAll()}if(i.length>0){if(xcadexportinfra.OPERATION_STATE.isstandalone)return void e.fillGridData(i);t(i,!1,!1)}})},insertDrawinginGrid:function(e){var t=this;S.withTransactionUpdate(function(){e.forEach(function(e){let n=t.insertinGrid(e);S.addChild(n)})}),Boolean(xcadexportinfra.IS_NOT_CV5)&&t.updateStatusBar(!0)},updateStatusBar:function(e){if(e){let e=N.getTreeDocument().getAllDescendants();I=e.filter(e=>"edit"===e.options.grid.purpose).length,y=e.filter(e=>"readonly"===e.options.grid.purpose).length,C=e.filter(e=>"assemblyFamily"===e.options.grid.cadtype).length,M=e.filter(e=>"componentFamily"===e.options.grid.cadtype).length,R=e.filter(e=>"drawing"===e.options.grid.cadtype).length}N.buildStatusBar([{type:p.STATUS.NB_ITEMS,position:"far"},{type:p.STATUS.CUSTOM,position:"far",id:"forEdit",dataElements:{typeRepresentation:"string",value:n.i18n("cust_edit")+": "+I,displayLabel:!0}},{type:p.STATUS.CUSTOM,position:"far",id:"readOnly",dataElements:{typeRepresentation:"string",value:n.i18n("cust_context")+": "+y,displayLabel:!0}},{type:p.STATUS.CUSTOM,id:"asmObjects",dataElements:{typeRepresentation:"string",value:C,displayLabel:!0,icon:u.getTypeIconPath(xcadexportinfra.X3D_URL_3DSPACE,{cadtype:"assemblyFamily"},xcadexportinfra.ICON_NON_PSTYPES),tooltip:n.i18n("number.assembly.objects")}},{type:p.STATUS.CUSTOM,id:"compObjects",dataElements:{typeRepresentation:"string",value:M,displayLabel:!0,icon:u.getTypeIconPath(xcadexportinfra.X3D_URL_3DSPACE,{cadtype:"componentFamily"},xcadexportinfra.ICON_NON_PSTYPES),tooltip:n.i18n("number.component.objects")}},{type:p.STATUS.CUSTOM,id:"drawObjects",dataElements:{typeRepresentation:"string",value:R,displayLabel:!0,icon:u.getTypeIconPath(xcadexportinfra.X3D_URL_3DSPACE,{cadfiletype:"swdrawing"},xcadexportinfra.ICON_NON_PSTYPES),tooltip:n.i18n("number.drawing.objects")}}])},callSearchEvent:function(e){var t=this;if(N.setFindStr(e,!0,0,void 0,!0),N.matchingStringCount>1&&(t.initCADSearch(),null!=t._cadsearchview)){t._selectedIdx=1;let e=t._selectedIdx+"/"+N.matchingStringCount;t._cadsearchview.setLabel(e),t._cadsearchview.show()}},initCADSearch:function(){var e=this;null===e._cadsearchview&&(e._cadsearchview=new x({renderTo:document.body,callbacks:{onPrevious:function(){e.focusChange({event:"previous"})},onNext:function(){e.focusChange({event:"next"})},onSelectAll:function(){e.findAutoSelect(N.findStr)},onClose:function(){e.closeSearch(!0)}}}))},focusChange:function(e){var t=this;if(null!==t._cadsearchview){"previous"==e.event&&t._selectedIdx>1&&(N.goToPreviousMatchingCell(),t._selectedIdx--),"next"==e.event&&t._selectedIdx<N.matchingStringCount&&(N.goToNextMatchingCell(),t._selectedIdx++);let n=t._selectedIdx+"/"+N.matchingStringCount;t._cadsearchview.setLabel(n)}},findAutoSelect:function(e){var t=this;N.onFindAutoSelect.call(N,{autoSelect:{autoSelect:{value:!0,modified:!0}}},function(e){t.closeSearch(!1)})},closeSearch:function(e){this._cadsearchview&&(this._cadsearchview.hide(),delete this._cadsearchview),Boolean(e)&&N.closeFind()},renderCtxODT:function(e,t){this._ctxMenu.contextEvent(null,e,t)}})}),define("DS/ENOXCADExport/Views/ExportView",["UWA/Class","UWA/Core","DS/ENOXCADExport/utils/ExportWSProxy","DS/ENOXCADExport/Controllers/XMLToJsonConversion","DS/ENOXCADExport/Controllers/DataGridMapper","DS/ENOXCADExport/Views/ExportDataGridView","DS/ENOXCADExport/utils/GetMappingInfo","DS/ENOXCADUtils/XCADNotification","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADUtils/loader/XCADLoader","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t,n,i,a,o,r,l,d,s,c){var p,u,f,x;return e.extend({_dataGridview:null,_viewContainer:null,_busTypeMapping:null,_relTypeMapping:null,_isInitExpandReq:null,initializeView:function(e){u=[],f=[],x=[],p={operation:"initfordataexchange",version:"1.0",data:{}},this.setInfraData(e.json),new s({maindiv:document.getElementById("mainContainer"),url_3DSpace:xcadexportinfra.X3D_URL_3DSPACE}),d.publish({event:"xcad-loader-on"}),this._isInitExpandReq=null!=e.isInitExpand&&e.isInitExpand,this.setCadTypeMapping()},render:function(e){return this},setInfraData:function(e){let t=e.data.infra;xcadexportinfra.X3D_INFRA=t,xcadexportinfra.X3D_SECURITY_CONTEXT=t.securitycontext,xcadexportinfra.X3D_LANG=t.lang,xcadexportinfra.X3D_INTEGRATION=t.integration,xcadexportinfra.X3D_URL_3DSPACE=t.url3DSpace,null!=e.data.rules?xcadexportinfra.X3D_RULES_INFRA=e.data.rules:xcadexportinfra.X3D_RULES_INFRA=null,"OnPremise"!==t.tenantid&&widget.setValue("x3dPlatformId",t.tenantid)},setCadTypeMapping:function(){var e=this;n.getCadTypeMapping().then(function(t){e._busTypeMapping=t.bustype,e._relTypeMapping=t.reltype,xcadexportinfra.CAD_ORIGIN=null!=t.cadorigin?t.cadorigin:"",xcadexportinfra.NLS_DESIGN_POLICY=t.nls_designpolicystates,xcadexportinfra.NLS_3DEXP_TYPES=t.nls_3dexptypes,xcadexportinfra.ICON_NON_PSTYPES=t.icons_nonPStypes,e._dataGridview=new o,e._dataGridview.setUpView(),Boolean(e._isInitExpandReq)?d.publish({event:"ProtocolModel/initexpandresults"}):(p.data.status="success",p.data.message="Init Successful",d.publish({event:"webinwin:web:notification",data:p}))},function(e){p.data.status="failure",p.data.message=e,d.publish({event:"webinwin:web:notification",data:p})})},passXMLData:async function(e,t){var n=this;let o=[],r=[],s=new Set,p="expandresults";Boolean(n._isInitExpandReq)&&(p="initexpandresults");let u={operation:p,version:"1.0",data:{}},x=[].concat(t),g=[].concat(e);for(let e=0;e<g.length;e++){let t=g[e],l="";x.length>0&&(l=x[e],x.splice(0,1));let d=i.transform(t,l,!1);if("success"===d.jsondata.result){xcadexportinfra.CADOBJ_MASTER_LIST=d.jsondata.cadobjectMasterList,xcadexportinfra.OPERATION_STATE.showsearchbtn&&xcadexportinfra.enabledisableButtons(["#plusBtn"],!1),o.push(c.success);var E=d.jsondata.data,m=E.mappinginfo.structure,h=E.mappinginfo.nodes,_=[],D=[],A=[];if(null!=E.mappinginfo.instances&&(_=E.mappinginfo.instances),null!=E.mappinginfo.family&&(D=E.mappinginfo.family),null!=E.mappinginfo.circularlinks&&(A=E.mappinginfo.circularlinks),null!=E.mappinginfo.additionallinks&&E.mappinginfo.additionallinks.forEach(function(e){s.add(e)}),null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming){let e={operation:"defaultfilenames",version:"1.0",data:{filelist:[]}},t=[...m],i=[],a=0,o=[...new Set(t.filter(e=>""===e.parent).map(e=>e.id))],r=[...new Set(t.filter(e=>""!=e.parent).map(e=>e.id))];o.length>1&&(o=o.filter(e=>!r.includes(e))),o.forEach(e=>{if(!i.map(e=>e.id).includes(e)){let n=t.find(t=>t.id===e);i.push({id:n.id,parentid:n.parent,treeorder:""!=n.treeorder?n.treeorder:(a++).toString()})}}),h=h.filter(e=>!xcadexportinfra.CHECK_SELECTION||null==e.info.selected||!/false/.test(e.info.selected));for(let n of h)if(!e.data.filelist.map(e=>e.phid).includes(n.id)){let a=n.info.filename.substring(0,n.info.filename.lastIndexOf(".")),o=n.info.filename.substr(n.info.filename.lastIndexOf(".")+1),r=i.find(e=>e.id===n.id),l=null!=r?r.treeorder:t.filter(e=>""!=e.treeorder&&e.id===n.id).map(e=>e.treeorder).sort((e,t)=>parseInt(e)-parseInt(t))[0],d=null!=r?r.parentid:t.find(e=>e.treeorder===l).parent;e.data.filelist.push({phid:n.id,filename:a,extension:o,parent:d,treeorder:l})}e.data.filelist.sort((e,t)=>parseInt(e.treeorder)>parseInt(t.treeorder)?1:-1),a=0;for(let t of e.data.filelist)""===t.parent&&(t.rowid=a),e.data.filelist.filter(e=>e.parent===t.phid).forEach(e=>{++a,e.rowid=a});e.data.filelist=e.data.filelist.sort((e,t)=>e.rowid>t.rowid?1:-1).map(({parent:e,treeorder:t,rowid:n,...i})=>i),await n._getDefaultFileNames(h,e)}Array.prototype.push.apply(f,h),xcadexportinfra.CADOBJ_NODE_LIST=h;let e=a.parseData({busTypeMapping:n._busTypeMapping,relTypeMapping:n._relTypeMapping,structureArray:m,nodesArray:h,instanceArray:_,familyArray:D,circularlinksArray:A}),t=a.createSkeletonOfDataGrid(e);r.push(t)}else o.push(c.failure)}if(o.includes(c.failure))u.data.status="failure",u.data.message=nodeStructureJson.jsondata.data,l.errorMsg(nodeStructureJson.jsondata.data),d.publish({event:"xcad-loader-off"}),d.publish({event:"webinwin:web:notification",data:u});else{const e=[];Array.from(s);r.length>0&&r.forEach(function(t){const i=n._dataGridview.fillGridData(t);e.push(i)}),Promise.all(e).then(()=>{u.data.status="success",u.data.message="Data Loaded Successfully",l.sucessMsg(c.load_data_success),d.publish({event:"xcad-loader-off"}),d.publish({event:"webinwin:web:notification",data:u})}).catch(e=>{u.data.status="failure",u.data.message=e.message,l.errorMsg(c[e.message]),d.publish({event:"xcad-loader-off"}),d.publish({event:"webinwin:web:notification",data:u})})}},passJSONData:function(e){let t={operation:"expandresults",version:"1.0",data:{}};if(e.data.status===c.success){var n=e.data.expandresponse,i=n.structure,o=n.nodes,r=[],s=[],p=[];null!=n.instances&&(r=n.instances),null!=n.family&&(s=n.family),null!=n.circularlinks&&(p=n.circularlinks),null!=n.additionallinks&&n.additionallinks;var u=a.parseData({busTypeMapping:this._busTypeMapping,relTypeMapping:this._relTypeMapping,structureArray:i,nodesArray:o,instanceArray:r,familyArray:s,circularlinksArray:p}),f=a.createSkeletonOfDataGrid(u);this._dataGridview.fillGridData(f),t.data.status="success",t.data.message="Expand Success",l.sucessMsg(c.load_data_success)}else t.data.status="failure",t.data.message="Expand Failure",l.errorMsg(e.data.message);d.publish({event:"xcad-loader-off"}),d.publish({event:"webinwin:web:notification",data:t})},setIncludeDrwXMLData:function(e){let t=i.transform(e,"",!1);if("success"===t.jsondata.result){let e=t.jsondata.data,n={},i={},o=e.mappinginfo.structure,r=e.mappinginfo.nodes;if(Object.entries(xcadexportinfra.DRAWING_OBJ).forEach(([e,t])=>{n[e]=[],t.forEach(t=>{let a=o.filter(e=>e.id==t.objectid);null!=a&&a.length>0&&a.forEach(t=>{if("CADDrawing"===t.relname&&""!=t.parent){let a=r.find(e=>e.id===t.parent);if(null!=a&&!x.includes(a.id)){x.push(a.id);let r=[];o.filter(e=>e.parent==t.parent).forEach(e=>{null!=f.find(t=>t.id===e.id)&&r.push(f.find(t=>t.id===e.id).info.familyid)}),(r=r.filter(t=>t!==e)).length>0&&(i[a.id]=r),n[e].push(a)}}})})}),Object.values(n).some(e=>e.length>0)){let e=a.parseDrawingData({dgvNodeList:this._dataGridview.getDataGridNodeList(),includeDrwObj:n,nodesArray:f,drwOfFamilyIdObj:i,busTypeMapping:this._busTypeMapping});Array.prototype.push.apply(u,e),this._dataGridview.insertDrawinginGrid(e)}}},_getDefaultFileNames:async function(e,n){return new t.Promise(t=>{d.subscribe({event:"ExportView/FileNameList"},function(n){for(let t of e){let e=n.find(e=>e.phid===t.id);if(null!=e){let n=e.deffilename;t.info.filename.substr(t.info.filename.lastIndexOf(".")+1).toLowerCase()===e.deffilename.substr(e.deffilename.lastIndexOf(".")+1).toLowerCase()&&(n=n.substring(0,n.lastIndexOf("."))),t.info.tgt_filename=n,t.info.def_filename=n}}let i=[...new Set(n.map(e=>e.deffilename))];e.validFileNames=i,d.unsubscribeAll({event:"ExportView/FileNameList"}),t()}),d.publish({event:"webinwin:web:notification",data:n})})},buildMappingInfo:function(e){let t=[];if(null!=xcadexportinfra.OPERATION_STATE.filerenaming&&xcadexportinfra.OPERATION_STATE.filerenaming){let e=this._dataGridview.getDataGridNodeList();for(let n of e){let e=n.options.grid.def_filename+"."+n.options.grid.filename.substr(n.options.grid.filename.lastIndexOf(".")+1);t.push({phid:n.options.grid.id,deffilename:e})}}r.buildMappingInfo(e,u,t)},updateCellInfraODT:function(e){xcadexportinfra.IS_ODT_MODEL=!0,this._dataGridview._updatecell(null,e)},updateCtxInfraODT:function(e,t){this._dataGridview.renderCtxODT(e,t)}})}),define("DS/ENOXCADExport/utils/XCADExportInfra",["UWA/Drivers/Alone","UWA/Core","DS/ENOXCADExport/Views/ExportView","DS/ENOXCADExport/Views/FooterView","DS/ENOXCADUtils/XCADNotification","DS/ENOXCADUtils/utils/XCADModelEvents","DS/ENOXCADExport/utils/ElementODTInfra","DS/ENOXCADExport/Views/PropetiesView","text!DS/ENOXCADExport/assets/settings.json","i18n!DS/ENOXCADExport/assets/nls/ExportNLS"],function(e,t,n,i,a,o,r,l,d,s){var c,p,u,f,x;UWA.i18n(s),window.xcadexportinfra={X3D_PLATFORM_ID:"",X3D_SECURITY_CONTEXT:"",X3D_LANG:"",X3D_INTEGRATION:"",X3D_URL_3DSPACE:"",X3D_PACKAGE_NAME:"",DEFAULT_CTX_MENU:!0,IS_SORTING_ASC:!0,FILE_DISK_CONTENT:"",DRIVE_3D_CONTENT:"",IS_NODE_SELECTED:!0,IS_NOT_CV5:!0,IS_3DSEARCH_DISBALED:!1,OPEN_FOLDER_AFTER_EXPORT:!1,OPEN_3DDRIVE_AFTER_EXPORT:!1,OPERATION_STATE:"",SELECTED_OBJECT:null,X3D_RULES_INFRA:null,EXPAND_INPUT:null,ROOT_NODES:null,X3D_INFRA:"",NLS_DESIGN_POLICY:"",NLS_3DEXP_TYPES:"",ICON_NON_PSTYPES:"",CADOBJ_MASTER_LIST:"",CADOBJ_NODE_LIST:"",CAD_OPERATIONS:null,REGEX_VALIDATOR:"",REGEX_VAL:"",REGEX_DOUBLE_BYTE:"",FNAME_CHAR_LIMIT:206,FNAME_MIN_CHAR_LIMIT:2,DRAWING_OBJ:"",DRIVE_3D_PATH:"",CAD_ORIGIN:"",ENABLE_OPEN_3DRIVE:!1,ENABLE_OPEN_FOLDER:!1,CHECK_SELECTION:!1,IS_ODT_MODEL:!1,get:function(e){return widget.getValue(e)},set:function(e,t){widget.setValue(e,t)},defineProtocol:function(e){function t(e){let t=JSON.parse(d),n=Object.keys(t.uxinfraprop).find(t=>e.includes(t));xcadexportinfra.OPERATION_STATE=t.uxinfraprop[n],xcadexportinfra.REGEX_DOUBLE_BYTE=/[\u3041-\u3096\u30a0-\u30ff]/g}switch(e.operation){case"initexpandresults":if(parseFloat(e.version)>=1){if(t(e.data.infra.integration.toLowerCase()),null!=e.data.customsettings){let t=e.data.customsettings,n=null!=t.isplmCSAEnabled&&t.isplmCSAEnabled;xcadexportinfra.set("isplmCSAEnabled",n);let i=null!=t.enabledwgsupport&&t.enabledwgsupport;xcadexportinfra.set("enabledwgsupport",i),null!=t.isdwgmultiselect&&(xcadexportinfra.OPERATION_STATE.isdwgmultiselect=/true/.test(t.isdwgmultiselect));let a=null!=t.folderpath?t.folderpath:"";xcadexportinfra.set("folderpath",a),null!=t.filenamesettings&&(xcadexportinfra.OPERATION_STATE.filerenaming=null!=t.filenamesettings.filerenaming&&/true/.test(t.filenamesettings.filerenaming),xcadexportinfra.REGEX_VAL=null!=t.filenamesettings.filenamebadchars&&""!=t.filenamesettings.filenamebadchars?t.filenamesettings.filenamebadchars:null,xcadexportinfra.REGEX_VALIDATOR=null!=xcadexportinfra.REGEX_VAL?new RegExp("[\\"+xcadexportinfra.REGEX_VAL+"]"):null);let o=null!=t.targetpkgextn?t.targetpkgextn:"zip";xcadexportinfra.set("targetpkgextn",o),null!=t.openin3ddrive&&(xcadexportinfra.OPERATION_STATE.openin3ddrive=/true/.test(t.openin3ddrive)),xcadexportinfra.CHECK_SELECTION=null!=t.checkselection&&/true/.test(t.checkselection)}if(xcadexportinfra.IS_NOT_CV5=!1,xcadexportinfra.X3D_PLATFORM_ID=e.data.infra.tenantid,xcadexportinfra.updateWidgetInfra(e.data.infra.securitycontext),null!=xcadexportinfra.get("isplmCSAEnabled")&&"true"===xcadexportinfra.get("isplmCSAEnabled")&&"OnPremise"!=xcadexportinfra.X3D_PLATFORM_ID&&null!=e.data.infra.url3DDrive&&""!=e.data.infra.url3DDrive){let t={tenantname:"DSSANDBOX - "+xcadexportinfra.X3D_PLATFORM_ID,url3DDrive:e.data.infra.url3DDrive};xcadexportinfra.set("servicejsondata",t)}o.subscribe({event:"ProtocolModel/initexpandresults"},function(t){if("xml"==e.data.expanddata.type){let t=e.data.expanddata.expandresponse,n="";null!=e.data.expanddata.pathresponse&&(n=e.data.expanddata.pathresponse),c.passXMLData(t,n)}}),(c=new n).render(),c.initializeView({json:e,isInitExpand:!0}),x=new i}break;case"initfordataexchange":if(parseFloat(e.version)>=1){t(e.data.infra.integration.toLowerCase());let a=null!=e.data.enabledwgsupport&&e.data.enabledwgsupport;if(xcadexportinfra.set("enabledwgsupport",a),null!=e.data.isdwgmultiselect&&(xcadexportinfra.OPERATION_STATE.isdwgmultiselect=/true/.test(e.data.isdwgmultiselect)),null!=e.data.targetpkgextn&&xcadexportinfra.set("targetpkgextn",e.data.targetpkgextn),null!=e.data.defaultsearchtype&&xcadexportinfra.set("defaultsearchtype",e.data.defaultsearchtype),null!=e.data.folderpath?xcadexportinfra.set("folderpath",e.data.folderpath):xcadexportinfra.set("folderpath",""),null!=e.data.filerenaming&&(xcadexportinfra.OPERATION_STATE.filerenaming=/true/.test(e.data.filerenaming)),null!=e.data.openin3ddrive&&(xcadexportinfra.OPERATION_STATE.openin3ddrive=/true/.test(e.data.openin3ddrive)),xcadexportinfra.X3D_PLATFORM_ID=e.data.infra.tenantid,null!=e.data.customsettings&&(xcadexportinfra.DRIVE_3D_PATH=null!=e.data.customsettings.drivefpath?e.data.customsettings.drivefpath:"",null!=e.data.customsettings.drivefid&&""!=e.data.customsettings.drivefid&&(xcadexportinfra.DRIVE_3D_CONTENT={filestorage:"3DDrive",folderid:e.data.customsettings.drivefid,tenantid:xcadexportinfra.X3D_PLATFORM_ID}),xcadexportinfra.ENABLE_OPEN_3DRIVE=null!=e.data.customsettings.enabledriveswitch&&/true/.test(e.data.customsettings.enabledriveswitch),xcadexportinfra.ENABLE_OPEN_FOLDER=null!=e.data.customsettings.enablefolderswitch&&/true/.test(e.data.customsettings.enablefolderswitch)),null!=e.data.cadid&&null!=e.data.label){let t={items:[{serviceId:"3DSpace",contextId:e.data.infra.url3DSpace,objectId:e.data.cadid,displayName:e.data.label}]};xcadexportinfra.SELECTED_OBJECT=t}xcadexportinfra.updateWidgetInfra(e.data.infra.securitycontext),(c=new n).render(),c.initializeView({json:e}),x=new i}break;case"expandresults":if(parseFloat(e.version)>=1)if("xml"==e.data.type){let t=e.data.expandresponse,n="";null!=e.data.pathresponse&&(n=e.data.pathresponse),c.passXMLData(t,n)}else"json"==e.data.type&&c.passJSONData(e);break;case"includedrw":if(parseFloat(e.version)>=1&&"xml"==e.data.type){let t=e.data.expandresponse;c.setIncludeDrwXMLData(t)}break;case"folderselection":parseFloat(e.version)>=1&&(o.publish({event:"xcad-loader-off"}),e.data.isfolderselected&&o.publish({event:"ExportSelectionView/folderButton",data:e.data.folderpath}));break;case"getmappinginfo":parseFloat(e.version)>=1&&"xml"==e.data.type&&c.buildMappingInfo(e.data.expandresponse);break;case"createpackagenotification":parseFloat(e.version)>=1&&(o.publish({event:"xcad-loader-off"}),xcadexportinfra.OPERATION_STATE.isstandalone||a.sucessMsg(e.data.responsemsg));break;case"exchangenotification":parseFloat(e.version)>=1&&(o.publish({event:"xcad-loader-off"}),"success"===e.data.status?a.sucessMsg(e.data.message):a.errorMsg(e.data.message));break;case"defaultfilenames":parseFloat(e.version)>=1&&o.publish({event:"ExportView/FileNameList",data:e.data.filelist});break;case"elementactionodt":r.elementAction(e,c,x)}},updateWidgetInfra:function(e){let t;if(0==e.indexOf("ctx::")){let n=(e=e.split("::"))[e.length-1];t=(n=n.split("."))[n.length-1]}else t=(e=e.split("."))[e.length-1];if(widget.setTitle(t),"OnPremise"!==xcadexportinfra.X3D_PLATFORM_ID){let e=widget.getTitle().concat(" ("+xcadexportinfra.X3D_PLATFORM_ID+")");widget.setTitle(e)}},enabledisableButtons:function(e,t){for(let n of e)t?(document.querySelector(n).style.pointerEvents="auto",document.querySelector(n).style.opacity="1.1",document.querySelector(n).setData("isButtonEnabled",t)):(document.querySelector(n).style.pointerEvents="none",document.querySelector(n).style.opacity="0.4",document.querySelector(n).setData("isButtonEnabled",t))},setupPropertiesView:function(e,t,n){if(document.contains(document.getElementById("slideInfoPanel"))&&n&&(t&&(document.getElementById("infoBtn").classList.remove("selected"),document.getElementById("sidebar").classList.toggle("collapsed"),document.getElementById("centreContainer").classList.remove("divmaxwidth"),document.getElementById("centreContainer").style.width="100%"),document.getElementById("resizerInfoDiv").remove(),document.getElementById("slideInfoPanel").remove()),null!=e){new l(e);xcadexportinfra.resizeDivOnDrag()}},resizeDivOnDrag:function(){var e,t,n,i=document.querySelector("#sidebar"),a=document.querySelector(".resizer"),o=document.querySelector(".centrepanel");function r(a){i.style.width=t-a.clientX+e+"px",o.style.width=n+a.clientX-e+"px"}function l(e){document.documentElement.removeEventListener("mousemove",r,!1),document.documentElement.removeEventListener("mouseup",l,!1),document.getElementById("centreContainer").style.width=o.style.width,f=o.style.width}a.addEventListener("mousedown",function(a){e=a.clientX,t=parseInt(document.defaultView.getComputedStyle(i).width,10),parseInt(document.defaultView.getComputedStyle(i).left,10),n=parseInt(document.defaultView.getComputedStyle(o).width,10),document.documentElement.addEventListener("mousemove",r,!1),document.documentElement.addEventListener("mouseup",l,!1)},!1)},centrePanelNewWidth:function(){return f},setCentrePanelNewWidth:function(e){f=e},resizeWindow:function(){window.addEventListener("resize",function(){null!=p&&(u=p);if(p=Math.min(window.innerWidth,document.documentElement.clientWidth),null!=u&&u!=p&&(console.log("Window new width =>"+p),document.contains(document.getElementById("resizerInfoDiv")))){let e,t,n,i=document.querySelector("#sidebar"),a=document.querySelector("#centreContainer");n=parseInt(p,10),e=parseInt(document.defaultView.getComputedStyle(i).width,10);let o=(t=parseInt(document.defaultView.getComputedStyle(a).width,10))+e;if(o>n){let r=(o-n)/2;i.style.width=e-r+"px",a.style.width=t-r+"px"}else if(o<n){let r=(n-o)/2;i.style.width=e+r+"px",a.style.width=t+r+"px"}f=a.style.width}})}}}),define("DS/ENOXCADExport/ENOXCADExportCmd",["DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/ENOXCADExport/utils/XCADExportInfra","DS/ENOXCADUtils/utils/XCADModelEvents","css!DS/ENOXCADExport/ENOXCADExport"],function(e,t,n,i){return{widget:null,onLoad:function(e){null!=e&&(this.widget=e.widget,this.widget.addEvent("onSearch",this.onSearch.bind(this)),this.widget.addEvent("onResetSearch",this.onResetSearch.bind(this)),xcadexportinfra.set("isplmCSAEnabled",e.isplmcsaEnabled));this.setbodyDiv(),this.subscribe(),this.publish();i.publish({event:"webinwin:web:notification",data:{operation:"xcadexportpageready",version:"1.0",data:{status:"success",message:"Page is ready"}}})},onSearch:function(e){i.publish({event:"xcadexport:onSearch",data:e})},onResetSearch:function(){i.publish({event:"xcadexport:onResetSearch"})},publish:function(){i.subscribe({event:"webinwin:web:notification"},function(t){e.publish("webinwin:web:notification",JSON.stringify(t))})},subscribe:function(){e.subscribe("webinwin:win:notification",function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;null!=t.data&&null!=t.data.tokenid&&"ENOXCAD"===t.data.tokenid&&xcadexportinfra.defineProtocol(t)}),e.subscribe("webinwin:win:xcadnotification",function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;xcadexportinfra.defineProtocol(t)})},setbodyDiv:function(){this._mainContainer=UWA.createElement("div",{id:"mainContainer",html:[{tag:"div",id:"topContainer"},{tag:"div",id:"xcadexportbodyDiv",html:[{tag:"div",id:"xcadexportcentreDiv",html:[{tag:"div",id:"centreContainer",class:"centrepanel"},{tag:"div",id:"sidebar",class:"collapsed"}]},{tag:"div",id:"footerdiv",class:"footerpanel"}]}]}),widget.setBody(this._mainContainer)}}}),define("DS/ENOXCADExport/ENOXCADExport",["DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/ENOXCADExport/utils/XCADExportInfra","DS/ENOXCADUtils/utils/XCADModelEvents","css!DS/ENOXCADExport/ENOXCADExport"],function(e,t,n,i){return{onLoad:function(e){this.setbodyDiv(),this.publish(),this.subscribe(),widget.addEvent("onSearch",this.onSearch.bind(this)),widget.addEvent("onResetSearch",this.onResetSearch.bind(this));i.publish({event:"webinwin:web:notification",data:{operation:"xcadexportpageready",version:"1.0",data:{status:"success",message:"Page is ready"}}})},onSearch:function(e){i.publish({event:"xcadexport:onSearch",data:e})},onResetSearch:function(){i.publish({event:"xcadexport:onResetSearch"})},publish:function(){i.subscribe({event:"webinwin:web:notification"},function(t){"undefined"!=typeof dscef?dscef.sendString(JSON.stringify(t)):e.publish("webinwin:web:notification",JSON.stringify(t))})},subscribe:function(){i.subscribe({event:"webinwin:win:notification"},function(e){"string"==typeof e&&(e=JSON.parse(e)),xcadexportinfra.defineProtocol(e)})},setbodyDiv:function(){this._mainContainer=UWA.createElement("div",{id:"mainContainer",html:[{tag:"div",id:"topContainer"},{tag:"div",id:"xcadexportbodyDiv",html:[{tag:"div",id:"xcadexportcentreDiv",html:[{tag:"div",id:"centreContainer",class:"centrepanel"},{tag:"div",id:"sidebar",class:"collapsed"}]},{tag:"div",id:"footerdiv",class:"footerpanel"}]}]}),widget.setBody(this._mainContainer)}}});