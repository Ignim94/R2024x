define("DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SearchControlCenter/scripts/SearchControlCenterServices","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PlatformEnvServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNInfraUX/SNVocabAccess","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/FedDictionaryAccess/FedDicoUtils","text!DS/SNInfraUX/assets/SearchColumnCustoDS.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,s,n,a,o,r,u,l,d,c,h,p,m,v,b,w,f,y,g,S,C){"use strict";var z=t.singleton(s,i,{generalContext:null,ENDUSER_CUSTO:null,resources:null,_6wg_predicates:{},_predicatesInfo:{},setGeneralContext:function(t){this.generalContext=t,this.resources=new v({}),e.is(t.isSCC)&&e.is(t.tenant)&&(this.resources.active_tenant=t.tenant,this.spaceURL=m.getURL()),u.setResources({resources:this.resources}),f.setResources({resources:this.resources}),null===this.ENDUSER_CUSTO&&u.loadVocabulary("ds6w",function(e){console.log("ds6w vocabulary LOADED"),this.computeDefaultEndUSerCusto()}.bind(this))},getTenant:function(){return this.resources.active_tenant},getEndDefaultEndUSerCusto:function(){if(null!==this.ENDUSER_CUSTO)return this.ENDUSER_CUSTO;this.resources=new v({}),u.setResources({resources:this.resources}),u.loadVocabulary("ds6w",function(e){return console.log("ds6w vocabulary LOADED"),this.computeDefaultEndUSerCusto(),this.ENDUSER_CUSTO}.bind(this))},computeDefaultEndUSerCusto:function(){this.ENDUSER_CUSTO={version:"3",customizationId:"Default",viewMode:"all views",views:{Tile:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:project",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:project"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:dataSource",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:dataSource"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1}],LargeTile:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:project",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:project"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:dataSource",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:dataSource"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1}],Thumbnail:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:project",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:project"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:dataSource",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:dataSource"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1}],Datagrid:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:description",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:description"),width:"165px",type:"alpha",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:identifier",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:identifier"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:created",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:created"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"unpinned",isRemovable:!1}]}}},custoDatagridMandatoryAttributes:function(e,t){var i=[];return"Datagrid"===e&&(i=[{name:"Title",uri:"ds6w:label",nlsName:u.getNLSValueForPredicate("ds6w:label"),Text:u.getNLSValueForPredicate("ds6w:label"),Visibility:!0,width:"auto",wrap:!1,pinned:"unpinned",custoMode:t},{name:"PLM_ExternalID",uri:"ds6w:identifier",nlsName:u.getNLSValueForPredicate("ds6w:identifier"),Text:u.getNLSValueForPredicate("ds6w:identifier"),Visibility:!0,width:"auto",wrap:!1,pinned:"unpinned",custoMode:t}]),i},custoDefaultAttributes:function(e,t){if(e){const e=!!t&&t.length,s={title:e?t.find(e=>"Title"===e.name):null,plm:e?t.find(e=>"PLM_ExternalID"===e.name):null,originated:e?t.find(e=>"originated"===e.name):null,modified:e?t.find(e=>"modified"===e.name):null,owner:e?t.find(e=>"owner"===e.name):null},n=t=>{const i=s[t];let n=!0;return e&&(n=!!i&&(null==i.Visibility||i.Visibility)),n};var i=[{name:"Title",uri:"ds6w:label",nlsName:u.getNLSValueForPredicate("ds6w:label"),Text:u.getNLSValueForPredicate("ds6w:label"),Visibility:n("title"),width:s.title?s.title.width:"auto",wrap:!!s.title&&s.title.wrap,pinned:s.title?s.title.pinned:"unpinned",custoMode:"general"},{name:"PLM_ExternalID",uri:"ds6w:identifier",nlsName:u.getNLSValueForPredicate("ds6w:identifier"),Text:u.getNLSValueForPredicate("ds6w:identifier"),Visibility:n("plm"),width:s.plm?s.plm.width:"auto",wrap:!!s.plm&&s.plm.wrap,pinned:s.plm?s.plm.pinned:"unpinned",custoMode:"general"},{name:"originated",uri:"ds6w:created",nlsName:u.getNLSValueForPredicate("ds6w:created"),Text:u.getNLSValueForPredicate("ds6w:created"),Visibility:n("originated"),width:s.originated?s.originated.width:"auto",wrap:!!s.originated&&s.originated.wrap,pinned:s.originated?s.originated.pinned:"unpinned",custoMode:"general"},{name:"modified",uri:"ds6w:modified",nlsName:u.getNLSValueForPredicate("ds6w:modified"),Text:u.getNLSValueForPredicate("ds6w:modified"),Visibility:n("modified"),width:s.modified?s.modified.width:"auto",wrap:!!s.modified&&s.modified.wrap,pinned:s.modified?s.modified.pinned:"unpinned",custoMode:"general"},{name:"owner",uri:"ds6w:responsible",nlsName:u.getNLSValueForPredicate("ds6w:responsible"),Text:u.getNLSValueForPredicate("ds6w:responsible"),Visibility:n("owner"),width:s.owner?s.owner.width:"auto",wrap:!!s.owner&&s.owner.wrap,pinned:s.owner?s.owner.pinned:"unpinned",custoMode:"general"}]}return i},formatCustoAttributes:function(t,i,s,n){var a=[],o={},r=!1;return t.length>0?t.forEach(function(t){r=i.findIndex(e=>e.name===t.name)>-1,o={name:e.is(t.label)?t.label:t.name,uri:e.is(t.uri)?t.uri:e.is(t.object)?t.object.uri:t.dataIndex,nlsName:e.is(t.label)?t.label:t.nlsName,Text:e.is(t.label)?t.label:t.nlsName,Visibility:r,custoMode:n},"general"===n&&(o.dataType=e.is(t.object)?t.object.dataType:""),s&&(o.width=t.width||"auto",o.wrap=t.wrap||!1,o.pinned=t.pinned||"unpinned"),a.push(o)}):"general"===n&&(a=this.custoDefaultAttributes(s,i)),a},_filterPredicatesByService:function(e,t,i,s){var n=[];return t?(e.forEach(function(e){"ds6w:type"!==e.uri&&"ds6w:created"!==e.uri&&"ds6w:description"!==e.uri&&"ds6w:label"!==e.uri&&"ds6w:modified"!==e.uri&&"ds6w:responsible"!==e.uri&&"ds6w:commentedby"!==e.uri&&"ds6w:lastModifiedBy"!==e.uri||n.push(e)}),n):i?(e.forEach(function(e){"ds6w:type"!==e.uri&&"ds6w:created"!==e.uri&&"ds6w:description"!==e.uri&&"ds6w:label"!==e.uri&&"ds6w:modified"!==e.uri&&"ds6w:responsible"!==e.uri&&"ds6w:commentedby"!==e.uri&&"ds6w:lastModifiedBy"!==e.uri||n.push(e)}),n):s?(e.forEach(function(e){"ds6w:type"!==e.uri&&"ds6w:created"!==e.uri&&"ds6w:description"!==e.uri&&"ds6w:label"!==e.uri&&"ds6w:modified"!==e.uri&&"ds6w:responsible"!==e.uri&&"ds6w:commentedby"!==e.uri&&"ds6w:lastModifiedBy"!==e.uri||n.push(e)}),n):e},custoComputeSources:async function(){const e=C.get("adv_search.source.other");let t=[{value:[],label:e[0].toUpperCase()+e.slice(1)}];const i=["swym","3dspace","drive"];var s=new Promise((e,s)=>{h.login({resources:this.resources,onComplete:s=>{for(let e=0;e<s.length;e++){const n={value:s[e].service,label:C.get("adv_search.source."+s[e].name)};i.includes(s[e].name)?t.push(n):t[0].value.push(n)}t=t[0].value.length?[...t.slice(1),t[0]]:t.slice(1),e(t)},onFailure:()=>{console.log("failed to recover datasources"),s(t)}})});return await s},isSourceAvailable:function(t){var i=g.getServiceBaseURL(f.getVocabularyName(t.value),this.resources.active_tenant);return!!e.is(i)},custoComputeOtherTypes:async function(e){const t=e;return new Promise((e,i)=>{e(z.custoComputeAllTypes(t))})},custoComputeAllTypes:async function(e){var t={items:[]};for(let n in e){var i=new Promise((t,i)=>{t(this.custoComputeTypes(e[n].value))}),s=await i;t.items=t.items.concat(s.items)}return t},custoComputeTypes:async function(e){var t;let i={vocabId:f.getVocabularyName(e),lang:r.getLanguage()};this.generalContext.isSCC&&(i.tenantId=this.resources.active_tenant);var s=new Promise((s,n)=>{f.loadVocabularyClasses(i,i=>{if(i.classInfos.length>0){for(let t in i.classInfos)i.classInfos[t].label=i.classInfos[t].nlsName,i.classInfos[t].value=i.classInfos[t].uri,i.classInfos[t].source=e;t={name:e,items:i.classInfos},s(t)}else s(t={items:[]})})});return await s},custoComputePredefinedQuery:async function(){var t=new Promise((t,i)=>{this.generalContext.isSCC&&(this.resources.valid=!0,this.resources.spaceURL=this.spaceURL,this.resources.predefinedQuerySCC=!0),l.fetchPQsFromServer(this.resources).then(function(){var i=l.getPQs(),s=l.getPQNLS(),n=[];e.is(i)&&i.PQ.forEach(function(e){n.push({id:e.pqid,value:e.value,abbreviations:e.abbreviations,title:s[e.pqid+".Title"]})}),n.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}),t(n)}.bind(this))});return await t},custoComputeExtensions:async function(e,t){var i=[];for(let a in t){var s=new Promise((i,s)=>{i(this.custoComputeExtension(e,t[a].object.uri))}),n=await s;i.push(n)}return i},custoComputeExtension:async function(e,t){var i=[];const s=r.getLanguage();var n=new Promise((n,a)=>{f.loadRelevantInterfaces({className:t,currentDataSource:e,lang:s},e=>{for(let t in e.interfaces)i.push({value:e.interfaces[t].name,name:e.interfaces[t].nlsName});n(i)})});return await n},custoComputeAllPredicates:async function(t,i,s){var n=[],a=[],o=[],r=!0,u=!0,l=!1;t.forEach(function(e){s?n.push("ds6wg:"+e.object.uri):n.push(e.object.uri),a.push(e.object.source)}),e.is(i)&&i.forEach(function(e){o.push(e.object)});var d=n.concat(o);a.forEach(function(e){"swym"!==e&&(r=!1),"drive"!==e&&(u=!1)}),"Others"===t.source&&(l=!0),d.includes("ds6wg:PLMEntity")||d.push("ds6wg:PLMEntity");var c=[];for(let e in d){var h=new Promise((t,i)=>{t(this.custoComputePredicates([d[e]]))}),p=await h;p.forEach(function(t){t.dataType=d[e]}),c=c.concat(p)}let m=c.filter((e,t)=>t===c.findIndex(t=>e.uri===t.uri));return m=this._filterPredicatesByService(m,r,u,l)},custoComputePredicates:async function(t){var i,s=[],a=this;e.is(a.resources.active_tenant)&&(i=a.resources.active_tenant),a._6wg_predicates.hasOwnProperty(i)||(a._6wg_predicates[i]={classPredicates:{}});var o=new Promise(function(i,o){e.is(t,"array")&&0!==t.length||o(new Error("No DS6WGTypeArray"));var r=t.join(","),u={idService:"Predicates",method:"POST",data:r};a.resources.getServicewithRole(u,function(t){t.onComplete=function(t){let a=null;e.is(t)&&(a=t,e.is(a,"object")&&e.is(a.classPredicates,"array")||(n.error("Invalid response to Predicates WS"+a),o(new Error("Invalid response to Predicates WS"))),a.classPredicates.forEach(function(e){e.vocabularyPredicateInfo.forEach(function(e){s.push(e)})})),i(s)},t.onFailure=function(e,t){a.log("_asyncCallToPredicatesWS fails"),o(e,t)},y.getPropertiesForClass(r,t)})});return await o},sortAndRemoveDuplicate:function(e,t){return e.filter((i,s)=>e.findIndex(e=>e[t]===i[t])===s).sort((e,i)=>e[t].localeCompare(i[t]))}});return z}),define("DS/SNSearchResultsCusto/model/SNResultsCustomizationModel",["UWA/Class/Debug","UWA/Class/Model","UWA/Core"],function(e,t,i){"use strict";return t.extend(e,{customizationId:"",role:"",version:"3",customizedViews:[],views:{Tile:{general:[],type:[],predefinedQuery:[]},LargeTile:{general:[],type:[],predefinedQuery:[]},Thumbnail:{general:[],type:[],predefinedQuery:[]},Datagrid:{general:[],type:[],predefinedQuery:[]}},setup:function(){},getCustomizationId:function(){return i.is(this.customizationId)&&""!==this.customizationId?this.customizationId:null},setCustomizationId:function(e){this.customizationId=e},getCustomizationRole:function(){return i.is(this.role)&&""!==this.role?this.role:null},setCustomizationRole:function(e){this.role=e},getCustomizationVersion:function(){return i.is(this.version)?this.version:null},setCustomizationVersion:function(e){this.version=e},getViewDefinition:function(e,t){if(i.is(e))switch(e){case"Tile":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.Tile;if("general"===t)return this.views.Tile.general;if("type"===t)return this.views.Tile.type;if("predefinedQuery"===t)return this.views.Tile.predefinedQuery;case"LargeTile":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.LargeTile;if("general"===t)return this.views.LargeTile.general;if("type"===t)return this.views.LargeTile.type;if("predefinedQuery"===t)return this.views.LargeTile.predefinedQuery;case"Thumbnail":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.Thumbnail;if("general"===t)return this.views.Thumbnail.general;if("type"===t)return this.views.Thumbnail.type;if("predefinedQuery"===t)return this.views.Thumbnail.predefinedQuery;case"Datagrid":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.Datagrid;if("general"===t)return this.views.Datagrid.general;if("type"===t)return this.views.Datagrid.type;if("predefinedQuery"===t)return this.views.Datagrid.predefinedQuery}},setViewDefinition:function(e,t,s,n,a){if(i.is(s,"array")&&i.is(e)&&i.is(t)){var o;if("Tile"===e||"all views"===e)if("type"===t){if(i.is(n))(o=this.views.Tile.type.findIndex(e=>e.id===n))>-1?this.views.Tile.type[o].viewDefinition=s:this.views.Tile.type.push({id:n,label:a,viewDefinition:s})}else if("predefinedQuery"===t){if(i.is(n))(r=this.views.Tile.predefinedQuery.findIndex(e=>e.id===n))>-1?this.views.Tile.predefinedQuery[r].viewDefinition=s:this.views.Tile.predefinedQuery.push({id:n,label:a,viewDefinition:s})}else this.views.Tile.general=s;if("LargeTile"===e||"all views"===e)if("type"===t){if(i.is(n))(o=this.views.LargeTile.type.findIndex(e=>e.id===n))>-1?this.views.LargeTile.type[o].viewDefinition=s:this.views.LargeTile.type.push({id:n,label:a,viewDefinition:s})}else if("predefinedQuery"===t){if(i.is(n))(r=this.views.LargeTile.predefinedQuery.findIndex(e=>e.id===n))>-1?this.views.LargeTile.predefinedQuery[r].viewDefinition=s:this.views.LargeTile.predefinedQuery.push({id:n,label:a,viewDefinition:s})}else this.views.LargeTile.general=s;if("Thumbnail"===e||"all views"===e)if("type"===t){if(i.is(n))(o=this.views.Thumbnail.type.findIndex(e=>e.id===n))>-1?this.views.Thumbnail.type[o].viewDefinition=s:this.views.Thumbnail.type.push({id:n,label:a,viewDefinition:s})}else if("predefinedQuery"===t){if(i.is(n))(r=this.views.Thumbnail.predefinedQuery.findIndex(e=>e.id===n))>-1?this.views.Thumbnail.predefinedQuery[r].viewDefinition=s:this.views.Thumbnail.predefinedQuery.push({id:n,label:a,viewDefinition:s})}else this.views.Thumbnail.general=s;if("Datagrid"===e||"all views"===e)if("type"===t){if(i.is(n))(o=this.views.Datagrid.type.findIndex(e=>e.id===n))>-1?this.views.Datagrid.type[o].viewDefinition=s:this.views.Datagrid.type.push({id:n,label:a,viewDefinition:s})}else if("predefinedQuery"===t){var r;if(i.is(n))(r=this.views.Datagrid.predefinedQuery.findIndex(e=>e.id===n))>-1?this.views.Datagrid.predefinedQuery[r].viewDefinition=s:this.views.Datagrid.predefinedQuery.push({id:n,label:a,viewDefinition:s})}else this.views.Datagrid.general=s}},getAllViewsDefinitions:function(){if(i.is(this.views))return this.views},setAllViewsDefinition:function(e){this.views=e},getAllAttributesByView:function(e){if(i.is(e))switch(e){case"Tile":var t=[];return i.is(this.views.Tile.general,"array")?t=this.views.Tile.general.concat(this.views.Tile.type,this.views.Tile.predefinedQuery):i.is(this.views.Tile,"array")&&(t=this.views.Tile),t;case"LargeTile":var s=[];return i.is(this.views.LargeTile.general,"array")?s=this.views.LargeTile.general.concat(this.views.LargeTile.type,this.views.LargeTile.predefinedQuery):i.is(this.views.LargeTile,"array")&&(s=this.views.LargeTile),s;case"Thumbnail":var n=[];return i.is(this.views.Thumbnail.general,"array")?n=this.views.Thumbnail.general.concat(this.views.Thumbnail.type,this.views.Thumbnail.predefinedQuery):i.is(this.views.Thumbnail,"array")&&(n=this.views.Thumbnail),n;case"Datagrid":var a=[];return i.is(this.views.Datagrid.general,"array")?a=this.views.Datagrid.general.concat(this.views.Datagrid.type,this.views.Datagrid.predefinedQuery):i.is(this.views.Datagrid,"array")&&(a=this.views.Datagrid),a}},setCustomizedViews:function(e){this.customizedViews=[e]},getCustomizedViews:function(){return i.is(this.customizedViews)?(i.is(this.customizedViews),this.customizedViews[0]):null},setCustomizationFromJSON:function(e){return this.setCustomizationId(e.customizationId),this.setCustomizationRole(e.role),this.setCustomizationVersion(e.version),this.setCustomizedViews(e.customizedViews),this.setAllViewsDefinition(e.views),this},exportCustomizationToJSON:function(e){var t={SearchAttributesDisplayAdminDefinition:[]},i={customizationId:this.customizationId,role:this.role,version:this.version,customizedViews:this.getCustomizedViews(),views:this.getAllViewsDefinitions()};return"SearchAttributesDisplayAdminDefinition"===e?(t.SearchAttributesDisplayAdminDefinition.push(i),t):i}})}),define("DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchRessources","DS/SNResultUX/utils/SearchViewOptions","DS/MessageBus/MessageBus","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNSearchResultsCusto/model/SNResultsCustomizationModel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/SNInfraUX/assets/SearchColumnCustoDS.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,s,n,a,o,r,u,l,d,c,h,p,m,v,b,w){"use strict";var f=function(e,t){var i=0;return e.label>t.label?i=1:e.label<t.label&&(i=-1),i};return t.singleton(s,i,{ENDUSER_CUSTO:{},BETAcustomizationEnabled:null,_adminCusto:null,_dsCusto:null,_displayNameCusto:null,_displayNameCustoObject:null,fixColumnUnsortable:["ds6wg:_displayName_"],fixColumnSortableFor1000:["ds6w:modified","ds6w:label","ds6w:created","ds6w:responsible"],DEFAULT_FIELDS:{"ds6w:modified":"num","ds6w:label":"alpha","ds6w:created":"num","ds6w:responsible":"alpha","ds6w:type":"group"},SearchResultsActiveCusto:{version:"3",customizationId:"",views:{Tile:[],LargeTile:[],Thumbnail:[],Datagrid:[]}},SearchResultsCustomizations:[],init:function(){this.loadBETAOptionfromTenantSettings(),this._dictionnary=[],this.setDebugMode(a.getDebugMode());try{this._dsCusto=JSON.parse(b),this._addMissingPredicates(this._dsCusto),n.log("DS custo:",this._dsCusto),this._adminCusto=this.upgradeJSONCustomization(r.getAdminCustoDefinition()),this._addMissingPredicates(this._adminCusto)}catch(e){n.error("Error parsing SearchColumnCustoAdmin.json:",e)}},isBETAEnabled:function(){var t=a.getOption("results_attributes_display_customization",{tenant:r.getActiveTenant()});return r.getGrantedRoles(function(e){if(-1===e.findIndex(e=>"CSV"===e.id))return!1}.bind(this)),e.is(t)?(this.BETAcustomizationEnabled=!0===t.BETAcustomizationEnabled,!0===t.BETAcustomizationEnabled):e.is(this.BETAcustomizationEnabled,"Boolean")?this.BETAcustomizationEnabled:void 0},_addMissingPredicates:function(t){if(e.is(t.SearchColumnCustoDSDefinition,"array"))for(var i=0;i<t.SearchColumnCustoDSDefinition.length;i++){var s=t.SearchColumnCustoDSDefinition[i].viewDefinition;this.addMandatoryPredicates(s)}},addMandatoryPredicates:function(t){if(e.is(t,"array")&&!(0>=t.length)){var i,s=["ds6w:identifier","ds6w:type"];for(i=s.length-1;i>=0;i--)for(var n=0,a=t.length;n<a;n++)if(t[n].uri.endsWith(s[i])){s.splice(i,1);break}for(i=s.length-1;i>=0;i--)t.push({uri:s[i],width:"auto"})}},setDefaultCustomization:function(){this.ENDUSER_CUSTO=m.getEndDefaultEndUSerCusto(),this.setActiveCustomizationInLocalStorage(this.ENDUSER_CUSTO)},saveCustomization:function(t,i){this.SearchResultsActiveCusto=t.exportCustomizationToJSON();var s=this.getUserCustomizations();if(e.is(s)&&(this.SearchResultsCustomizations=s),-1===this.SearchResultsCustomizations.findIndex(e=>e.customizationId===t.customizationId))this.SearchResultsCustomizations.push(this.SearchResultsActiveCusto),this.setUserCustomizationsInLocalStorage(this.SearchResultsCustomizations);else{var n=this.SearchResultsCustomizations.findIndex(e=>e.customizationId===t.customizationId);this.SearchResultsCustomizations[n]=this.SearchResultsActiveCusto,this.setUserCustomizationsInLocalStorage(this.SearchResultsCustomizations)}i&&this.setActiveCustomizationInLocalStorage(this.SearchResultsActiveCusto),d.publish({channel:"3dSearch_results_customization",topic:"3dSearch_new_customization_in_localStorage"})},loadBETAOptionfromTenantSettings:async function(){var t=new Promise(t=>{t(a.getTenantSettings(r.getActiveTenant()).then(function(){var t=a.getOption("results_attributes_display_customization",{tenant:r.getActiveTenant()});e.is(t)?e.is(t.BETAcustomizationEnabled)&&(t.BETAcustomizationEnabled?this.BETAcustomizationEnabled=!0:this.BETAcustomizationEnabled=!1):this.BETAcustomizationEnabled=!1}.bind(this)))});if(await t)return this.BETAcustomizationEnabled},loadCustomizationTenantSettings:function(t){var i=t||m.getTenant(),s=this.getActiveCustomization();a.getTenantSettings(i).then(function(){var t=a.getOption("results_attributes_display_customization",{tenant:i});if(e.is(t)&&e.is(t.BETAcustomizationEnabled)&&(t.BETAcustomizationEnabled?this.BETAcustomizationEnabled=!0:this.BETAcustomizationEnabled=!1),e.is(t)&&e.is(t.SearchAttributesDisplayAdminDefinition[0])){var n=t.SearchAttributesDisplayAdminDefinition[0],o=new p;o.setCustomizationId(n.customizationId),o.setCustomizationRole("admin"),o.setCustomizedViews(n.customizedViews),o.setAllViewsDefinition(n.views),e.is(s)?this.saveCustomization(o,!1):this.saveCustomization(o,!0)}}.bind(this)),this._updatePreviousColumnCustomizations(s)},setActiveCustomizationInLocalStorage:function(e){o.setItem("3dSearchResultsActiveCustomization",e),o.commit()},setUserCustomizationsInLocalStorage:function(e){o.setItem("3dSearchResultsCustomizations",e),o.commit()},switchActiveCustomization:function(t){if("Default"===t)this.setDefaultCustomization();else if(e.is(this.getUserCustomizations())){var i=this.getUserCustomizations().find(e=>e.customizationId===t);this.setActiveCustomizationInLocalStorage(i)}},getActiveCustomization:function(){var t={};if(t=o.getItem("3dSearchResultsActiveCustomization"),e.is(t))t=(new p).setCustomizationFromJSON(t);else if(void 0===t&&void 0!==o.getItem("DataGridColumnCusto")){var i=o.getItem("DataGridColumnCusto"),s=r.getAdminCustoDefinition().SearchColumnCustoAdminDefinition;if(e.is(s)&&e.is(i.activeView)){this.SearchResultsActiveCusto.customizationId=i.activeView;var n=s.findIndex(e=>e.viewId===i.activeView.split("-ADMIN",1)[0]);this.SearchResultsActiveCusto.role=n>-1?"admin":"user",this.SearchResultsActiveCusto.adminCusto=n>-1}var a=i.views.findIndex(e=>e.viewId===i.activeView);a>-1&&(this.SearchResultsActiveCusto.customizationId=i.activeView,this.SearchResultsActiveCusto.version=i.views[a].version,this.SearchResultsActiveCusto.views.Datagrid.general=i.views[a].viewDefinition)}return void 0!==t?t:""!==this.SearchResultsActiveCusto.customizationId?this.SearchResultsActiveCusto:null},getCustomizationById:function(t){var i=this.getUserCustomizations().find(e=>e.customizationId===t);return e.is(i)&&(i=(new p).setCustomizationFromJSON(i)),i},getUserCustomizations:function(){var t=o.getItem("3dSearchResultsCustomizations");return e.is(t)?t:[]},copyCustomization:function(t,i,s){var n=this.getUserCustomizations();if(e.is(n)){var a=n.find(e=>e.customizationId===t);if(e.is(a)){var o=new p;o.setCustomizationId(i),o.setCustomizationRole(s),o.setCustomizationVersion(a.version),o.setAllViewsDefinition(a.views),o.setCustomizedViews(a.customizedViews),this.saveCustomization(o,!1)}}else console.log("Failed to copy the customization")},deleteCustomization:function(t){var i=this.getUserCustomizations();if(e.is(i,"array")){var s=i.findIndex(e=>e.customizationId===t);-1!==s&&i.splice(s,1)}null!==this.getActiveCustomization()&&this.getActiveCustomization().getCustomizationId()===t&&this.setDefaultCustomization(),this.setUserCustomizationsInLocalStorage(i),d.publish({channel:"3dSearch_results_customization",topic:"3dSearch_customization_deleted_from_localStorage"})},getViewModeForCustomization:function(){switch(void 0!==o.getItem("LastSearchViewMode")?o.getItem("LastSearchViewMode"):"tile"){case"tile":return"Tile";case"tilebig":return"LargeTile";case"thumbnail":return"Thumbnail";case"table":return"Datagrid"}},buildSubLab:function(t,i,s){var n=[],a=t.getType?t.getType():t.type,r=this.getActiveCustomization();if(e.is(r)){var u=void 0!==o.getItem("LastSearchViewMode")?o.getItem("LastSearchViewMode"):"tile",l=r.views.Tile;switch(u){case"tile":if("Tile"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return n;l=r.views.Tile;break;case"tilebig":if("LargeTile"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return n;l=r.views.LargeTile;break;case"thumbnail":if("Thumbnail"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return n;l=r.views.Thumbnail;break;case"table":if("Datagrid"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return n;l=r.views.Datagrid}var d=function(e){return e.slice(e.indexOf(":")+1)};if(e.is(s)&&s&&i){var c=i.split(":")[0];l.predefinedQuery.forEach(function(e){if(e.label.split(":")[1].split(",").findIndex(e=>e===c)>=0)return e.viewDefinition.forEach(function(e){n.push(e.dataIndex)}),n})}else{var h=l.type.findIndex(e=>d(e.id)===d(a));h>=0&&l.type[h].viewDefinition.forEach(function(e){n.push(e.dataIndex)})}n.length||l.general.forEach(e=>n.push(e.dataIndex))}return n},buildUserCustomizationList:function(t){var i=[],s=this.getActiveCustomization(),n=this.getUserCustomizations(),a=this._adminCusto,o=n.concat(a);function r(e){return e.customizationId||e.getCustomizationId()}return s=e.is(s)?"admin"===t?"admin"===s.role?r(s):"Default":r(s):"Default",e.is(o)&&o.forEach(function(e){function n(e){e.customizationId===s?i.unshift(e.customizationId):i.push(e.customizationId)}"admin"===t&&"admin"===e.role?n(e):"admin"!==t&&n(e)}),i.findIndex(e=>"Default"===e)<0&&i.push("Default"),i=i.filter((e,t)=>t===i.findIndex(t=>e===t))},getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){0==i.indexOf("sixw:")?(t[i]=t[i]||[],(e[i]||[]).forEach(function(e){t[i].push(e)})):(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],s=e.value||[],n=e.field;i.forEach(function(i,a){t[i.predicate]||(t[i.predicate]=[]);var o={disptext:e.display,object:s[a],type:i.type,field:n?[n[a]]:["implicit"]};t[i.predicate].push(o)})})})}),t},getAvailableCustomizations:function(t,i){if(!e.is(t,"object")||!e.is(t.isPQ))throw new Error("E_INVALIDARG: bad iContext given to getAvailableCustomizations method !");var s=[],n=[],o=this.getUserCustomizations();e.is(o)&&(n=o);var r=0,u=null,d=0,c=0,h=null;if(e.is(n,"array")){for(d=0;d<n.length;d++)u={label:n[d].customizationId,value:n[d].customizationId,viewMode:n[d].customizedViews,adminCusto:!1},"admin"===n[d].role&&(u.adminCusto=!0),s.push(u);s.sort(f)}var p=[],m=[];if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){if(this._adminCusto.SearchColumnCustoAdminDefinition.length>0)m=this._adminCusto;else{let t=a.getOption("column_custo",{tenant:i});e.is(t)&&e.is(t.searchColumnCustoInputs,"object")&&e.is(t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,"array")&&t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition.length>0&&(m=t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,this._adminCusto=t.searchColumnCustoInputs),e.is(t)&&e.is(t.searchDisplayCustoInputs,"object")&&(this._displayNameCusto=t.searchDisplayCustoInputs)}for(d=0;d<m.length;d++)if(e.is(m[d].customizationId,"string")&&"The_Default_Columns"!==m[d].customizationId){if(u={label:m[d].customizationId,value:m[d].customizationId,viewMode:m[d].customizedViews,adminCusto:!0},0===m[d].customizationId.indexOf("###"))if(e.is(m[d].views.Datagrid.general,"array"))h=m[d].customizationId.substring(3,m[d].customizationId.length),u.label=w.replace(w.get("custo_PQ"),{PQ:h});else if(e.is(m[d].custoAliasToUse,"string")){var v=m[d].customizationId.substring(3,m[d].customizationId.length);u.label=w.replace(w.get("custo_type"),{type:v})}p.push(u)}p.sort(f)}if(s.length>0&&p.length>0){var b=w.get("SearchColumnCustoUserGroup"),y=w.get("SearchColumnCustoAdminGroup");for(d=0,c=s.length;d<c;d++)s[d].group=b;for(d=0,c=p.length;d<c;d++)p[d].group=y}var g=s.concat(p),S=!1,C=!1,z=null;if(e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0&&(z=t.forcedCusto),!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var _="###"+t.typeName.pqName;if(e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array")){var x=this._dsCusto.SearchColumnCustoDSDefinition;for(d=0;d<x.length&&!C;d++)e.is(x[d].viewId,"string")&&x[d].viewId===_&&z===_&&(C=!0,z=_)}for(d=0,r=g.length;d<r&&!S;d++)_===g[d].value&&(g[d].selected=!0,S=!0,z=_)}if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var I="###"+t.typeName.pqName;if((!e.is(z)||!z.startsWith(I))&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array")){x=this._dsCusto.SearchColumnCustoDSDefinition;for(d=0;d<x.length;d++)if(e.is(x[d].viewId,"string")&&x[d].viewId===I){z=I+"-HIDDEN",u={label:"Customized PQ: "+t.typeName.pqName,value:z,viewMode:"Datagrid"},g.push(u);break}}if(!e.is(z)||!z.startsWith(I)){var P=l.getViewData();if(e.is(P)&&e.is(P.SearchColumnCustoDefinition)){var D=P.SearchColumnCustoDefinition;e.is(D)&&e.is(D.viewId,"string")&&D.viewId===I&&(z=I+"-HIDDEN",u={label:"Customized PQ: "+t.typeName.pqName,value:z,viewMode:"Datagrid"},g.push(u))}}}}var V=this.getActiveCustomization();if(e.is(V)&&(V=V.customizationId),!S&&!C&&e.is(n,"array")&&e.is(V,"string"))for(t.isPQ&&(!e.is(t.forcedCusto,"string")||t.forcedCusto.length<=0)?e.is(z)||(z=V):z=t.isPQ&&e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0?t.forcedCusto:V,d=0,r=g.length;d<r&&!S;d++)z===g[d].value&&(g[d].selected=!0,S=!0);return g},getCustomizationIdToUse:function(t,i){if(e.is(t.forcedCusto))return t.forcedCusto;var s=this.getViewModeForCustomization(),n=this.getAvailableCustomizations(t,i),a="The_Default_Columns";if(e.is(n,"array")&&n.length)for(var o=0,r=n.length;o<r;o++)if(e.is(n[o].selected)&&!0===n[o].selected){s!==n[o].viewMode&&"all views"!==n[o].viewMode||(a=n[o].value);break}if(!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){this._pqName=t.typeName.pqName;var u="###"+this._pqName;if(!a.startsWith(u)&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(var d=this._dsCusto.SearchColumnCustoDSDefinition,c=0;c<d.length;c++)if(e.is(d[c].viewId,"string")&&d[c].viewId===u){a=u+"-HIDDEN";break}if(!a.startsWith(u)){var h=l.getViewData();if(e.is(h)&&e.is(h.SearchColumnCustoDefinition)){var p=h.SearchColumnCustoDefinition;e.is(p)&&e.is(p.viewId,"string")&&p.viewId===u&&(a=u+"-HIDDEN")}}}}else this._pqName=null;return a},getCustomizationDefinitionFromCustoId:function(t,i,s){var n=this.getUserCustomizations(),a=[],o=null,u=null,d=this._getDefaultColumnsForInApps(i),h=[],p=0,m=0,v=0,b=-1,w=-1,f=null,y=0;for(p=0,m=d.length;p<m;p++)h.push(d[p].dataIndex);if("The_Default_Columns"===t)a=this._getDefaultColumns(i);else{var g=n.find(e=>e.customizationId===t);if(e.is(g)&&e.is(g.customizedViews))"all views"===g.customizedViews?a=g.views[this.getViewModeForCustomization()]:e.is(g.views)&&e.is(g.customizedViews)&&(a=g.views[g.customizedViews]);else{if(!e.is(null,"array")||0===null.length){var S=this._adminCusto;for(this._adminCusto.CustoAliasDefinitions,p=0;p<S.length;p++)if(t===S[p].customizationId){if(S[p].views.Datagrid.general.length>0&&e.is(null,"array")){for(v=0;v<null.length;v++)null[v].dataIndex=null[v].uri,b=null[v].uri.indexOf(":"),w=null[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=null[v].uri.substring(0,w)),null[v].dataType=f,null[v].isSortable=!0,null[v].minWidth=40,null[v].text=c.getNLSValueForPredicate(null[v].uri),null[v].visibility=!0,null[v].visibilityEditable=!1,null[v].defaultSort="none",null[v].wrap=!1,null[v].pinned="center",y=parseInt(null[v].width,10),null[v].width=isNaN(y)?"auto":y;a=null}if(S[p].views.Datagrid.type.length>0&&e.is(null,"array")){for(v=0;v<null.length;v++)null[v].dataIndex=null[v].uri,b=null[v].uri.indexOf(":"),w=null[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=null[v].uri.substring(0,w)),null[v].dataType=f,null[v].isSortable=!0,null[v].minWidth=40,null[v].text=c.getNLSValueForPredicate(null[v].uri),null[v].visibility=!0,null[v].visibilityEditable=!1,null[v].defaultSort="none",null[v].wrap=!1,null[v].pinned="center",y=parseInt(null[v].width,10),null[v].width=isNaN(y)?"auto":y;a=null}if(S[p].views.Datagrid.predefinedQuery.length>0&&e.is(null,"array")){for(v=0;v<null.length;v++)null[v].dataIndex=null[v].uri,b=null[v].uri.indexOf(":"),w=null[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=null[v].uri.substring(0,w)),null[v].dataType=f,null[v].isSortable=!0,null[v].minWidth=40,null[v].text=c.getNLSValueForPredicate(null[v].uri),null[v].visibility=!0,null[v].visibilityEditable=!1,null[v].defaultSort="none",null[v].wrap=!1,null[v].pinned="center",y=parseInt(null[v].width,10),null[v].width=isNaN(y)?"auto":y;a=null}break}}if(!e.is(o,"array")||0===o.length){var C=this._dsCusto.SearchColumnCustoDSDefinition;for(p=0,m=C.length;p<m;p++)if(t===C[p].viewId+"-HIDDEN"){if(o=e.clone(C[p].viewDefinition),e.is(o,"array"))for(v=0;v<o.length;v++)o[v].dataIndex=o[v].uri,b=o[v].uri.indexOf(":"),w=o[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=o[v].uri.substring(0,w)),o[v].dataType=f,o[v].isSortable=!0,o[v].minWidth=40,o[v].text=c.getNLSValueForPredicate(o[v].uri),o[v].visibility=!0,o[v].visibilityEditable=!1,o[v].defaultSort="none",o[v].wrap=!1,o[v].pinned="center",y=parseInt(o[v].width,10),o[v].width=isNaN(y)?"auto":y,-1===h.indexOf(o[v].dataIndex)&&a.push(o[v]);break}}if(!e.is(u,"array")||0===u.length){var z=null,_=l.getViewData();if(e.is(_)&&e.is(_.SearchColumnCustoDefinition)&&(z=l.getViewData().SearchColumnCustoDefinition),z&&t===z.viewId+"-HIDDEN"&&(u=e.clone(z.viewDefinition),e.is(u,"array")))for(v=0;v<u.length;v++)u[v].dataIndex=u[v].uri,b=u[v].uri.indexOf(":"),w=u[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=u[v].uri.substring(0,w)),u[v].dataType=f,u[v].isSortable=!0,u[v].minWidth=40,u[v].text=c.getNLSValueForPredicate(u[v].uri),u[v].visibility=!0,u[v].visibilityEditable=!1,u[v].defaultSort="none",u[v].wrap=!1,u[v].pinned="center",y=parseInt(u[v].width,10),u[v].width=isNaN(y)?"auto":y,-1===h.indexOf(u[v].dataIndex)&&a.push(u[v])}}}if(r.isFUN096612Active()){var x=[],I=a.length;if(I>0)for(var P=0;P<I;P++)if(e.is(a[P])&&e.is(a[P].dataIndex,"string")&&"ds6wg:_displayName_"===a[P].dataIndex){a.splice(P,1);break}var D=this.getDisplayNameColumn(this._pqName);e.is(D)&&(x.push(D),d=x.concat(d))}if(e.is(a)){if(e.is(s)&&e.is(a.general))if(s.isPQ&&e.is(this._pqName)){var V=[];a.predefinedQuery.forEach(function(e){e.label.split(":")[1].split(",").findIndex(e=>e===this._pqName)>=0&&e.viewDefinition.forEach(function(e){V.push(e)})}.bind(this)),a=V.length?V:a.general}else a=null!==s.typeName?a.type:a.general;for(p=0,m=a.length;p<m;p++)e.is(a[p])&&e.is(a[p].dataIndex,"string")&&(a[p].dataIndex=r.getURIToUse(a[p].dataIndex))}return a},getCustomizationDefinitionFromCustoIdAndType:function(t,i,s){let n=null;if(e.is(i)&&e.is(s)){var a=this.getCustomizationById(t);e.is(a)&&a.views[i].type.forEach(function(e){e.id.slice(e.id.indexOf(":")+1)===s&&(n=e.viewDefinition)})}return n},_getDefaultColumns:function(e){var t=l.getDataGridViewHeaders(e);return this._completeColumnDefinition(t),t},getDisplayNameColumn:function(t){var i=null;if(e.is(this._displayNameCusto,"object")&&e.is(this._displayNameCusto.CustoDisplayName,"array")){var s=this._displayNameCusto.CustoDisplayName.length;if(s>0)for(var n=0;n<s;n++)this._displayNameCusto.CustoDisplayName[n].viewId+"-ADMIN"!==t&&this._displayNameCusto.CustoDisplayName[n].viewId!=="###"+t||(i={uri:"ds6wg:_displayName_",width:"auto",dataIndex:"ds6wg:_displayName_",dataType:null,isSortable:!1,minWidth:40,text:"ds6wg:_displayName_",visibility:!0,visibilityEditable:!1,defaultSort:"none",wrap:!1,pinned:"left"})}return i},getColumnCustomizationDefinitionFromAliasCustoId:function(t){var i=[],s=[],n=0,a=0;if(!e.is(t,"string")||0===t.length)throw new Error("Invalid Arg in SearchCustoServices.getColumnCustomizationDefinitionFromAliasCustoId!");var o=[];for(n=0,a=(i=this._getDefaultColumnsForInApps()).length;n<a;n++)o.push(i[n].dataIndex);if(e.is(this._adminCusto)){var r=this._adminCusto.CustoAliasDefinitions;if(e.is(r))for(n=0,a=r.length;n<a;n++)if(t===r[n].aliasId){var u=e.clone(r[n]);if(e.is(u.viewDefinition,"array")){s=u.viewDefinition;for(var l=0;l<s.length;l++){s[l].dataIndex=s[l].uri;var d=s[l].uri.indexOf(":"),h=s[l].uri.indexOf("."),p=null;d>0&&h>0&&h>d&&(p=s[l].uri.substring(0,h)),s[l].dataType=p,s[l].isSortable=!0,s[l].minWidth=40,s[l].text=c.getNLSValueForPredicate(s[l].uri),s[l].visibility=!0,s[l].visibilityEditable=!1,s[l].defaultSort="none",s[l].wrap=!1,s[l].pinned="center";var m=parseInt(s[l].width,10);s[l].width=isNaN(m)?"auto":m,-1===o.indexOf(s[l].dataIndex)&&i.push(s[l])}}break}}return i},_getDefaultColumnsForInApps:function(){var e=l.getDataGridViewHeadersForInApps();return this._completeColumnDefinition(e),e},_completeColumnDefinition:function(e){var t=this,i=o.getItem("listColumnsWidth");if(i)try{var s=JSON.parse(i),a=Object.keys(s);e.forEach(function(e){e.width=-1===a.indexOf(e.dataIndex)?"auto":s[e.dataIndex],e.isSortable=t.isColumnSortable(e.dataIndex)})}catch(e){n.log(e)}else e.forEach(function(e){e.isSortable=t.isColumnSortable(e.dataIndex)})},getColumnCustomizations:function(){var t=o.getItem("DataGridColumnCusto");e.is(t)&&e.is(t.views,"array")?t.views.forEach(function(t){var i=r.getAdminCustoDefinition().SearchColumnCustoAdminDefinition;if(e.is(i)){var s=i.findIndex(e=>e.viewId===t.viewId.split("-ADMIN",1)[0]);t.adminCusto=s>-1}}):t={views:[]};var i=this.getUserCustomizations();e.is(i)&&e.is(i,"array")&&i.forEach(function(i){(e.is(i.viewMode)&&"Datagrid"===i.viewMode||"all views"===i.viewMode)&&t.views.push({viewId:i.customizationId,version:i.version,viewDefinition:i.views.Datagrid,viewDefinitionHidden:[]})});var s=this.getActiveCustomization();if(e.is(s)){var n=t.views.findIndex(e=>e.viewId===s.customizationId);(e.is(s.viewMode)&&n>-1&&"Datagrid"===s.viewMode||"all views"===s.viewMode)&&(t.activeView=s.customizationId)}return e.is(t)?t:{}},_updatePreviousColumnCustomizations:function(t){if(-1===this.getUserCustomizations().findIndex(e=>"ENDUSER_CUSTO"===e.customizationId)){var i=o.getItem("DataGridColumnCusto");e.is(i)&&e.is(i.views,"array")&&i.views.forEach(function(t){var s=r.getAdminCustoDefinition().SearchColumnCustoAdminDefinition;if(e.is(s)){var n=s.findIndex(e=>e.viewId===t.viewId.split("-ADMIN",1)[0]);t.adminCusto=n>-1}var a=new p;a.setCustomizationId(t.viewId),t.adminCusto?a.setCustomizationRole("admin"):a.setCustomizationRole("user"),a.setCustomizedViews("Datagrid"),a.setViewDefinition("Datagrid","general",t.viewDefinition),i.activeView===t.viewId?this.saveCustomization(a,!0):this.saveCustomization(a,!1)}.bind(this))}},isColumnSortable:function(e){return!(-1!==this.fixColumnUnsortable.indexOf(e))},isColumnSortableFor1000:function(e){return-1!==this.fixColumnSortableFor1000.indexOf(e)},createJSONadminCustomizationFile:function(e){return r.getAdminCustoDefinition()},isJSONConvertionAllowed:function(){return window.location.href.indexOf("JSONConvertionFUN140670")>-1},upgradeJSONCustomization:function(t){var i=[];if(this.isJSONConvertionAllowed()&&e.is(t.SearchColumnCustoAdminDefinition,"array")){var s=t.SearchColumnCustoAdminDefinition,n=t.CustoAliasDefinitions;s.forEach(function(t){var s={customizationId:"",role:"admin",version:"3",customizedViews:["Datagrid"],views:{Tile:{general:[],type:[],predefinedQuery:[]},LargeTile:{general:[],type:[],predefinedQuery:[]},Thumbnail:{general:[],type:[],predefinedQuery:[]},Datagrid:{general:[],type:[],predefinedQuery:[]}}};if(e.is(t.viewId)&&(s.customizationId=t.viewId),0===t.viewId.indexOf("###")){if(e.is(t.viewDefinition,"array"))sPQ=t.viewId.substring(3,t.viewId.length),s.views.Datagrid.predefinedQuery.push({id:sPQ,viewDefinition:t.viewDefinition});else if(e.is(t.custoAliasToUse,"string")){var a=t.viewId.substring(3,t.viewId.length);e.is(n);var o=n.findIndex(e=>e.aliasId===t.custoAliasToUse);s.views.Datagrid.type.push({id:a,viewDefinition:n[o].viewDefinition})}}else e.is(t.viewDefinition,"array")&&(s.views.Datagrid.general=viewDefinition);i.push(s)})}return i}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomization_GlobalView",["UWA/Class/View","UWA/Class/Debug","UWA/Core","UWA/Element","DS/Controls/Button","DS/Controls/Expander","DS/Controls/LineEditor","DS/Controls/TooltipModel","DS/Spreadsheet/DataGrid","DS/Controls/ResponsiveTileView","DS/SNResultUX/utils/ExternalComponentHelpers","DS/WebappsUtils/WebappsUtils","DS/MessageBus/MessageBus","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,n,a,o,r,u,l,d,c,h,p,m,v,b){"use strict";return e.extend(t,{generalView:null,container:null,savedCustomizations:null,cog_image:c.getWebappsAssetUrl("SNSearchResultsCusto","images/cog_image.png"),views:[{id:"Tile",nls:v.get("custoPanel.view.tile"),icon:"view-small-tile wux-ui-3ds"},{id:"Datagrid",nls:v.get("custoPanel.view.datagrid"),icon:"view-list wux-ui-3ds"},{id:"LargeTile",nls:v.get("custoPanel.view.largeTile"),icon:"view-big-tile wux-ui-3ds"},{id:"Thumbnail",nls:v.get("custoPanel.view.thumbnail"),icon:"view-big-thb wux-ui-3ds"}],ENDUSER_CUSTO:{customizationId:"Default",customizedViews:"all views",role:"admin",attributes:{general:{responsiveCollectionViews:[v.get("custoPanel.attributes.type"),v.get("custoPanel.attributes.revision"),v.get("custoPanel.attributes.maturity"),v.get("custoPanel.attributes.owner"),v.get("custoPanel.attributes.modificationDate"),v.get("custoPanel.attributes.collaborativeSpace"),v.get("custoPanel.attributes.source")],datagrid:[v.get("custoPanel.attributes.type"),v.get("custoPanel.attributes.description"),v.get("custoPanel.attributes.uniqueName"),v.get("custoPanel.attributes.modificationDate"),v.get("custoPanel.attributes.creationDate"),v.get("custoPanel.attributes.revision"),v.get("custoPanel.attributes.maturity"),v.get("custoPanel.attributes.owner")]},type:[],predefinedQuery:[]}},init:function(e){return this.container=e.container,this.generalView=e.elements,this.role=e.role,this.isSCC=e.isSCC,this._parent(e)},_buildGeneralView:function(){this.generalView.mainContainer.classList.contains("customization-panel")&&this.generalView.mainContainer.removeClassName("customization-panel"),this.generalView.mainContainer.classList.contains("customization-panel-SCC")&&this.generalView.mainContainer.removeClassName("customization-panel-SCC"),this.isSCC?this.generalView.mainContainer.addClassName("general-panel-SCC"):this.generalView.mainContainer.addClassName("general-panel"),this.generalView.mainContainer.empty();var e=s.create("div",{class:"selection-view-container"}),t=s.create("div",{class:"expander-navigation-body-container"}).inject(e);this.generalView.saved_custo_container_admin=s.create("div",{class:"search-saved-custo-container"}),this.generalView.saved_custo_container_user=s.create("div",{class:"search-saved-custo-container"});var o=function(){var e=s.create("div",{class:"expander-navigation-body"});new a({header:v.get("custoPanel.general.expander.admin"),body:this.generalView.saved_custo_container_admin,style:"simple",icon:"user-cog wux-ui-3ds",stretchableContentFlag:!0,expandedFlag:!0}).inject(e);if(!this.isSCC)new a({header:v.get("custoPanel.general.expander.local"),body:this.generalView.saved_custo_container_user,style:"simple",icon:"user wux-ui-3ds",stretchableContentFlag:!0,expandedFlag:!0}).inject(e);return e}.bind(this);new a({header:v.get("custoPanel.general.expander.main"),body:o(),icon:{iconName:"cog",fontIconSize:"2x"},style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(t);e.inject(this.generalView.mainContainer);var u=s.create("div",{class:this.isSCC?"content-view-container-SCC":"content-view-container"}),l=s.create("div",{class:"toolbar-content-view"}).inject(u),d=(s.create("div").inject(l),s.create("div",{class:"search-button-container"}));new n({label:v.get("custoPanel.general.newCustomization"),icon:{iconName:"plus",fontIconSize:"2x"}}).inject(d).addEventListener("click",function(){h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_new_customization"})}.bind(this)),d.inject(l);var c=s.create("div",{class:"search-toolbar-button-container"}).inject(l),p=(s.create("div",{class:"search-toolbar-divider"}).inject(c),s.create("div",{class:"search-toolbar-button-container"}).inject(l));this.editButton=new n({displayStyle:"normal",icon:{iconName:"pencil wux-ui-3ds",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(p),this.editButton.tooltipInfos=new r({shortHelp:v.get("custoPanel.toolbar.edit.tooltip")}),this.editButton.addEventListener("click",function(e){if(i.is(this.activeCusto)&&!this.editButton.disabled){var t=m.getCustomizationById(this.activeCusto.title);i.is(t)&&h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_edit_customization",data:t.exportCustomizationToJSON()})}}.bind(this));var b=s.create("div",{class:"search-toolbar-button-container"}).inject(l);this.deleteButton=new n({displayStyle:"normal",icon:{iconName:"trash",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(b),this.deleteButton.tooltipInfos=new r({shortHelp:v.get("custoPanel.toolbar.delete.tooltip")}),this.deleteButton.addEventListener("click",function(e){i.is(this.activeCusto)&&!this.deleteButton.disabled&&!0!==this.activeDeleteConfirmation&&this._addDeleteCustoConfirmation(this.activeCusto.title)}.bind(this));var w=s.create("div",{class:"search-toolbar-button-container"}).inject(l),f=new n({displayStyle:"normal",icon:{iconName:"copy wux-ui-3ds",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(w);f.tooltipInfos=new r({shortHelp:v.get("custoPanel.toolbar.copy.tooltip")}),f.addEventListener("click",function(e){i.is(this.activeCusto)&&!0!==this.activeCopyConfirmation&&this._addCopyCustoConfirmation(this.activeCusto.title)}.bind(this)),this.generalView.synthetic_view=s.create("div",{class:"synthetic-view-container"}).inject(u),u.inject(this.generalView.mainContainer)},_addSavedCusto:function(e){var t="",s=this.cog_image,n=m.getActiveCustomization();if(i.is(n)&&this.isSCC&&"admin"!==n.role&&(n.customizationId="Default"),i.is(n)&&"Default"!==n.customizationId){var a="user";a=i.is(n.role)?n.role:n.getCustomizationRole(),n=i.is(n.customizationId)?n.customizationId:n.getCustomizationId(),"admin"===a&&"user"===this.role&&(this.editButton.disabled=!0,this.deleteButton.disabled=!0)}else n="Default",this.editButton.disabled=!0,this.deleteButton.disabled=!0;e.forEach(function(e){var a=[];let o="";e.customizationId===n&&a.push({label:v.get("custoPanel.general.activeCustomization"),icon:"favorite-on wux-ui-3ds",emphasize:"primary"}),"Default"===e.customizationId?(o=v.get("custoPanel.nls.allviews"),t=v.get("custoPanel.general.default.custo.description"),a.push({label:o,icon:"view-mixed wux-ui-3ds",emphasize:"secondary"})):("Tile"===e.customizedViews?o=v.get("custoPanel.nls.tile"):"Datagrid"===e.customizedViews?o=v.get("custoPanel.nls.datagrid"):"Thumbnail"===e.customizedViews?o=v.get("custoPanel.nls.thumbnail"):"LargeTile"===e.customizedViews?o=v.get("custoPanel.nls.largeTile"):"all views"===e.customizedViews&&(o=v.get("custoPanel.nls.allviews")),a.push({label:o,icon:this._getViewIcon(e),emphasize:"secondary"}),t="admin"===e.role?v.get("custoPanel.general.admin.custo.description"):v.get("custoPanel.general.user.custo.description"));const r="Default"===e.customizationId?v.get("custoPanel.general.default"):e.customizationId;var u=new l({picture:s,icon:"cog",title:r,multipleTitleLineNumber:!1,subtitle:"",description:t,activeFlag:e.customizationId===n,statusbarIcons:a,displayedOptionalCellProperties:["description","statusbarIcons"]});u.elements.container.addEventListener("click",function(e){u.isHighlighted()?(u.unhighlight(),this.generalView.synthetic_view.empty()):(i.is(this.activeCusto)&&this.activeCusto.isHighlighted()&&(this.activeCusto.unhighlight(),this.generalView.synthetic_view.empty()),this._selectCusto(u))}.bind(this)),e.customizationId===n&&this._selectCusto(u),"admin"===e.role||this.isSCC?u.inject(this.generalView.saved_custo_container_admin):u.inject(this.generalView.saved_custo_container_user)}.bind(this))},_selectCusto:function(e){this.activeCusto=e,e.highlight();var t=this.savedCustomizations.find(e=>e.customizationId===this.activeCusto.title);if(i.is(t))if("Default"===t.customizationId){this.editButton.disabled=!0,this.deleteButton.disabled=!0;new a({header:v.get("custoPanel.general.expander.endUserCusto"),body:this._addCustoSyntheticView(t,t.attributes.general),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view)}else{if("admin"===t.role&&"user"===this.role?(this.editButton.disabled=!0,this.deleteButton.disabled=!0):(this.editButton.disabled=!1,this.deleteButton.disabled=!1),"all views"===t.customizedViews)var s=t.views.Tile;else s=t.views[t.customizedViews];if(s.general.length>0)new a({header:t.customizationId+" - "+v.get("custoPanel.preview.expander.general.customization"),body:this._addCustoSyntheticView(t,s.general),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view);s.type.length>0&&s.type.forEach(function(e){new a({header:t.customizationId+" - "+v.get("custoPanel.preview.expander.type.customization")+' "'+e.id+'" ',body:this._addCustoSyntheticView(t,e.viewDefinition),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view)}.bind(this)),s.predefinedQuery.length>0&&s.predefinedQuery.forEach(function(e){new a({header:t.customizationId+" - "+v.get("custoPanel.preview.expander.predefinedQuery.customization")+' "'+e.id+'" ',body:this._addCustoSyntheticView(t,e.viewDefinition),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view)}.bind(this))}},_addCustoSyntheticView:function(e,t){var i=s.create("div",{id:"search-custo_grid-container",class:"custo-grid-global-container"}),n=[];return"Default"===e.customizationId?(this.ENDUSER_CUSTO=e,this.views.forEach(function(i){var s=[];s.push({text:i.nls,dataIndex:"name",width:170,minWidth:40}),t=i.nls===v.get("custoPanel.view.datagrid")?e.attributes.general.datagrid:e.attributes.general.responsiveCollectionViews;for(var a=0;a<t.length;a++)s.push({text:t[a],dataIndex:"name",width:"auto",minWidth:40});n.push(s)})):this.views.forEach(function(i){var s,a=[];if(a.push({text:i.nls,dataIndex:"name",width:170,minWidth:40}),e.customizedViews===i.id||"all views"===e.customizedViews)for(var o=0;o<t.length;o++)a.push({text:t[o].nlsName||t[o].text,dataIndex:"name",width:"auto",minWidth:40});else{s=i.nls===v.get("custoPanel.view.datagrid")?this.ENDUSER_CUSTO.attributes.general.datagrid:this.ENDUSER_CUSTO.attributes.general.responsiveCollectionViews;for(o=0;o<s.length;o++)a.push({text:s[o],dataIndex:"name",width:"auto",minWidth:40})}n.push(a)}.bind(this)),n.forEach(function(e){var t=s.create("div",{class:"custo-grid-container"}),n=new u({columns:e,defaultCellHeight:50,defaultCellWidth:150,headersDimensions:{height:50},selection:{cells:!1},show:{rowHeaders:!1,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!0},isSortable:!1}).inject(t);n.elements.container.getElementsByClassName("wux-layouts-gridengine")[0].addEventListener("mouseover",function(e){e.currentTarget.getElementsByClassName("wux-layouts-gridengine-scroller-container")[0].style.visibility="visible"},!1),n.elements.container.getElementsByClassName("wux-layouts-gridengine")[0].addEventListener("mouseleave",function(e){var t=e.currentTarget.getElementsByClassName("wux-layouts-gridengine-scroller-container")[0];setTimeout(function(){t.style.visibility="hidden"},500)},!1),t.inject(i)}),i},_addDeleteCustoConfirmation:function(e){this.activeDeleteConfirmation=!0;var t=s.create("div",{class:"synthetic-view-delete-confirmation"});s.create("span",{text:v.get("custoPanel.toolbar.delete.confirmation")+" '"+e+"' ?"}).inject(t);new n({label:v.get("custoPanel.validate.delete.content"),emphasize:"primary"}).inject(t).addEventListener("click",function(){i.is(this.activeCusto)&&(this.activeDeleteConfirmation=!1,m.deleteCustomization(this.activeCusto.title),this.render())}.bind(this)),new n({label:v.get("custoPanel.button.cancel"),emphasize:"secondary"}).inject(t).addEventListener("click",function(){this.activeDeleteConfirmation=!1,t.destroy()}.bind(this)),this.generalView.synthetic_view.prepend(t)},_addCopyCustoConfirmation:function(e){this.activeCopyConfirmation=!0;var t=s.create("div",{class:"synthetic-view-copy-confirmation"}),a=(s.create("span",{text:v.get("custoPanel.toolbar.copy.confirmation")+" '"+e+"' :"}).inject(t),s.create("div",{class:"search-line-editor-container"}).inject(t)),u="^(?!("+m.buildUserCustomizationList().join("|")+")$).*$",l=new o({placeholder:this.activeCusto.title,pattern:u,sizeInCharNumber:110,displayClearFieldButtonFlag:!0,maxLength:110});l.tooltipInfos=new r({longHelp:v.get("custoPanel.title.editor.tooltip")}),l.inject(a),this.validate_copy_button=new n({label:v.get("custoPanel.toolbar.copy.tooltip"),emphasize:"primary",disabled:!0}).inject(a),this.validate_copy_button.addEventListener("click",function(){this.activeCopyConfirmation=!1,i.is(this.copyId)&&i.is(this.activeCusto.title)&&i.is(this.role)&&(m.copyCustomization(this.activeCusto.title,this.copyId,this.role),this.render())}.bind(this)),this.cancel_copy_button=new n({label:v.get("custoPanel.button.cancel"),emphasize:"secondary"}).inject(a),this.cancel_copy_button.addEventListener("click",function(){this.activeCopyConfirmation=!1,t.destroy()}.bind(this)),l.addEventListener("uncommittedChange",function(e){i.is(e.dsModel.valueToCommit,"string")&&""!==e.dsModel.valueToCommit&&-1===m.buildUserCustomizationList().findIndex(t=>t===e.dsModel.valueToCommit)?(this.copyId=e.dsModel.valueToCommit,this.validate_copy_button.disabled=!1):this.validate_copy_button.disabled=!0}.bind(this)),this.generalView.synthetic_view.prepend(t)},_getStoredCustomizations:function(){this.savedCustomizations=[this.ENDUSER_CUSTO];var e=m.getUserCustomizations();return i.is(e)&&i.is(e)&&e.forEach(function(e){this.isSCC?"admin"===e.role&&this.savedCustomizations.push(e):this.savedCustomizations.push(e)}.bind(this)),this.savedCustomizations},_getViewIcon:function(e){switch(e.customizedViews){case"Tile":return"view-small-tile wux-ui-3ds";case"LargeTile":return"view-big-tile wux-ui-3ds";case"Datagrid":return"view-list wux-ui-3ds";case"Thumbnail":return"view-big-thb wux-ui-3ds";case"all views":return"view-mixed wux-ui-3ds"}},render:async function(){var e=new Promise(e=>{e(this._getStoredCustomizations())}),t=await e;t&&(this.savedCustomizations=t,this._buildGeneralView(),this._addSavedCusto(this.savedCustomizations))}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomization_CustomizationView",["UWA/Class","UWA/Class/View","UWA/Class/Debug","UWA/Class/Events","UWA/Class/Model","UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/Expander","DS/Menu/Menu","DS/Controls/Label","DS/Controls/LineEditor","DS/Controls/TooltipModel","DS/Controls/Toggle","DS/Spreadsheet/DataGrid","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/Controls/ResponsiveTileView","DS/Controls/ResponsiveTextualTileView","DS/Controls/ResponsiveThumbnailView","DS/SNResultUX/utils/ExternalComponentHelpers","DS/WebappsUtils/WebappsUtils","DS/MessageBus/MessageBus","DS/SNSearchResultsCusto/model/SNResultsCustomizationModel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,n,a,o,r,u,l,d,c,h,p,m,v,b,w,f,y,g,S,C,z,_,x,I,P,D,V,T,N,E){"use strict";return t.extend({customizationView:null,container:null,preview:null,customization:null,customizationMode:null,dataForPreview:null,isEditMode:null,selectedPredicatesInArray:[],gridColumnsTileViews:[{text:N.get("custoPanel.attributes.name"),dataIndex:"tree"},{text:N.get("custoPanel.attributes.visibility"),dataIndex:"Visibility",typeRepresentation:"boolean",type:"checkbox",editableFlag:"true",editionPolicy:"EditionInPlace"}],gridColumnsDataGridView:[{text:N.get("custoPanel.attributes.name"),dataIndex:"tree"},{text:N.get("custoPanel.attributes.visibility"),dataIndex:"Visibility",typeRepresentation:"boolean",editableFlag:"true",editionPolicy:"EditionInPlace",getCellSemantics:function(e){if("ds6w:label"===e.nodeModel.getAttributeValue("uri")||"ds6w:identifier"===e.nodeModel.getAttributeValue("uri"))return{disabled:!0}}},{text:N.get("custoPanel.attributes.width"),dataIndex:"width",typeRepresentation:"integer",editableFlag:"true",editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{disabled:!e.nodeModel.options.grid.Visibility,minValue:1}}},{text:N.get("custoPanel.attributes.wrap"),dataIndex:"wrap",typeRepresentation:"boolean",editableFlag:"true",editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{disabled:!e.nodeModel.options.grid.Visibility}}},{text:N.get("custoPanel.attributes.pin"),dataIndex:"pinned",typeRepresentation:"horizontalAlignment",editableFlag:"true",editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{disabled:!e.nodeModel.options.grid.Visibility,possibleValues:[{value:"left",icon:{iconName:"picture-wrapping-left",fontIconFamily:1}},{value:"unpinned",icon:{iconName:"wrong",fontIconFamily:1}},{value:"right",icon:{iconName:"picture-wrapping-right",fontIconFamily:1}}]}},getCellClassName:function(e){return"search-customization-pin-cell"}}],availableViewsList:[{label:N.get("custoPanel.view.tile"),value:"Tile",icon:"view-small-tile wux-ui-3ds"},{label:N.get("custoPanel.view.largeTile"),value:"LargeTile",icon:"view-big-tile wux-ui-3ds"},{label:N.get("custoPanel.view.thumbnail"),value:"Thumbnail",icon:"view-big-thb wux-ui-3ds"},{label:N.get("custoPanel.view.datagrid"),value:"Datagrid",icon:"view-list wux-ui-3ds"},{label:N.get("custoPanel.nls.allviews"),value:"all views",icon:"view-mixed wux-ui-3ds"}],cog_image:I.getWebappsAssetUrl("SNSearchResultsCusto","images/cog_image.png"),type_image:I.getWebappsAssetUrl("SNSearchResultsCusto","images/type_image.png"),query_image:I.getWebappsAssetUrl("SNSearchResultsCusto","images/query_image.png"),init:function(e){return this.container=e.container,this.customizationView=e.elements,this.preview=e.preview,this.customization=e.customization,this.customizationMode=e.customizationMode,this.dataForPreview=e.dataForPreview,this.isEditMode=e.isEditMode,this.selectedPredicatesInArray=[],this.isSCC=e.isSCC,this._parent(e)},_formatDataForEdition:async function(e){const t=this.customizationMode;var i={general:[],type:[],predefinedQuery:[]};if(e.attributes.general.length>0){i.general=e.attributes.general,V.custoDefaultAttributes(this.customization.viewMode,e.attributes.general).forEach((e,t)=>{-1===i.general.findIndex(t=>t.name===e.name)&&(i.general=[...i.general.slice(0,t-1),e,...i.general.slice(t-1)])}),this.customizationMode="general",this._formatDataForPreview(i)}if(e.attributes.type.length>0){var s=[];e.attributes.type.forEach(function(e){const t=e.typeObj?e.typeObj.label:a.is(e.label)?e.label:e.id;s.push({typeObj:{custoMode:"type",label:t,object:{uri:e.typeObj?e.typeObj.object.uri:e.id}},typePredicates:e.typePredicates||e.viewDefinition})}),this.customization.attributes.type=s,this.customization.attributes.type.forEach(function(e){this.customizationMode="type",i.type=e,this._formatDataForPreview(i)}.bind(this))}if(e.attributes.predefinedQuery.length>0){var n=[],o=[],r=new Promise((e,t)=>{e(V.custoComputePredefinedQuery())});(await r).forEach(function(e){o.push({label:e.abbreviations+"  ("+e.title+")",object:e.id})}),e.attributes.predefinedQuery.forEach(function(e){var t=o.find(t=>t.object===e.id);(e.label||a.is(t))&&n.push({predefinedQueryObj:{custoMode:"predefinedQuery",label:a.is(e.label)?e.label:t.label,object:a.is(e.id)?e.id:t.object},predefinedQueryPredicates:e.viewDefinition})}),this.customization.attributes.predefinedQuery=n,this.customization.attributes.predefinedQuery.forEach(function(e){this.customizationMode="predefinedQuery",i.predefinedQuery=e,this._formatDataForPreview(i)}.bind(this))}return this.customizationMode=t,!0},_addMandatoryPredicate:function(e,t){var i=V.custoDatagridMandatoryAttributes(this.customization.viewMode,this.customizationMode),s=e;let n=s.findIndex(e=>"ds6w:identifier"===e.uri);-1===n&&i.length>1?s.unshift(i[1]):n>-1&&!1===s[n].Visibility&&s[n].Visibility;let a=s.findIndex(e=>"ds6w:label"===e.uri);return-1===a&&i.length>1?s.unshift(i[0]):a>-1&&!1===s[a].Visibility&&s[a].Visibility,s},_formatDataForPreview:function(e){switch(this.customizationMode){case"general":V.formatCustoAttributes(e.general,[...this.customization.attributes.general,...this.dataForPreview.general],this.customization.viewMode,"general").forEach(function(e){e.custoMode="general",-1===this.preview.availablePredicates.general.findIndex(t=>t.uri===e.uri)&&this.preview.availablePredicates.general.push(e)}.bind(this));break;case"type":if(a.is(e.type.typeObj.object)){var t=this.preview.availablePredicates.type.findIndex(t=>t.typeObj.object.uri===e.type.typeObj.object.uri);if(-1===t){const t=this.customization.attributes.type.find(t=>t.typeObj.object.uri===e.type.typeObj.object.uri),n=V.formatCustoAttributes(e.type.typePredicates,t?[...t.typePredicates,...this.dataForPreview.type.typePredicates]:this.dataForPreview.type.typePredicates,this.customization.viewMode,"type");var i=this._addMandatoryPredicate(n),s={typeObj:e.type.typeObj,Text:e.type.typeObj.label,Children:i};this.preview.availablePredicates.type.push(s)}else if(-1!==t&&0===this.preview.availablePredicates.type[t].Children.length){const i=V.formatCustoAttributes(e.type.typePredicates,this.dataForPreview.type.typePredicates,this.customization.viewMode,"type");this.preview.availablePredicates.type[t].Children=this._addMandatoryPredicate(i)}else{var n=this.preview.availablePredicates.type.findIndex(t=>t.typeObj.object.uri===e.type.typeObj.object.uri);const t=-1!==(l=this.customization.attributes.type.findIndex(t=>t.typeObj.object.uri===e.type.typeObj.object.uri))?[...this.customization.attributes.type[l].typePredicates,...this.dataForPreview.type.typePredicates]:this.dataForPreview.type.typePredicates;V.formatCustoAttributes(e.type.typePredicates,t,this.customization.viewMode,"type").forEach(function(e){-1===this.preview.availablePredicates.type[n].Children.findIndex(t=>t.Text===e.Text)&&this.preview.availablePredicates.type[n].Children.push(e)}.bind(this))}}break;case"predefinedQuery":if(a.is(e.predefinedQuery.predefinedQueryObj.object)){var o=this.preview.availablePredicates.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.predefinedQueryObj.object);if(-1===o){const t=this.customization.attributes.predefinedQuery.find(t=>t.predefinedQueryObj.object===e.predefinedQuery.predefinedQueryObj.object),i=V.formatCustoAttributes(e.predefinedQuery.predefinedQueryPredicates,t?[...t.predefinedQueryPredicates,...this.dataForPreview.predefinedQuery.predefinedQueryPredicates]:this.dataForPreview.predefinedQuery.predefinedQueryPredicates,this.customization.viewMode,"predefinedQuery");var r=this._addMandatoryPredicate(i),u={predefinedQueryObj:e.predefinedQuery.predefinedQueryObj,Text:e.predefinedQuery.predefinedQueryObj.label,Children:r};this.preview.availablePredicates.predefinedQuery.push(u)}else if(-1!==o&&0===this.preview.availablePredicates.predefinedQuery[o].Children.length){const t=V.formatCustoAttributes(e.predefinedQuery.predefinedQueryPredicates,this.dataForPreview.predefinedQuery.predefinedQueryPredicates,this.customization.viewMode,"predefinedQuery");this.preview.availablePredicates.predefinedQuery[o].Children=this._addMandatoryPredicate(t)}else{var l;n=this.preview.availablePredicates.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.predefinedQueryObj.object);const t=-1!==(l=this.customization.attributes.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.predefinedQueryObj.object))?[...this.customization.attributes.predefinedQuery[l].predefinedQueryPredicates,...this.dataForPreview.predefinedQuery.predefinedQueryPredicates]:this.dataForPreview.predefinedQuery.predefinedQueryPredicates;V.formatCustoAttributes(e.predefinedQuery.predefinedQueryPredicates,t,this.customization.viewMode,"predefinedQuery").forEach(function(e){-1===this.preview.availablePredicates.predefinedQuery[n].Children.findIndex(t=>t.Text===e.Text)&&this.preview.availablePredicates.predefinedQuery[n].Children.push(e)}.bind(this))}}}},_formatDataForFinalCustomization:function(e){var t={dataIndex:e.values.uri,dataType:"",dataTypeText:"",defaultSort:"none",isRemovable:!1,isSortable:!1,name:e.values.name,nlsName:e.values.nlsName,text:e.values.Text,type:"",width:e.values.width||"495px",wrap:e.values.wrap||!1,pinned:e.values.pinned||"unpinned"};switch(e.values.custoMode){case"general":var i=this.customization.attributes.general.findIndex(e=>e.dataIndex===t.dataIndex);-1===i&&e.visibility?(t.dataType=e.dataType||"",this.customization.attributes.general.push(t)):e.visibility?(this.customization.attributes.general[i].width=t.width.toString()||"auto",this.customization.attributes.general[i].wrap=t.wrap||!1,this.customization.attributes.general[i].pinned=t.pinned||"unpinned"):e.visibility||this.customization.attributes.general.splice(i,1),this.preview.modeInUse="general",this.preview.attributesArrayInUse=this.customization.attributes.general;break;case"type":var s=this.customization.attributes.type.findIndex(t=>t.typeObj.object.uri===e.type.object.uri);if(t.dataType=e.type.object.uri,-1===s&&e.visibility)this.customization.attributes.type.push({typeObj:e.type,typePredicates:[t]}),this.preview.modeInUse="type",this.preview.typeInUse=e.type,this.preview.attributesArrayInUse=[t];else-1===(n=this.customization.attributes.type[s].typePredicates.findIndex(e=>e.dataIndex===t.dataIndex))&&e.visibility?this.customization.attributes.type[s].typePredicates.push(t):e.visibility?(this.customization.attributes.type[s].typePredicates.width=t.width.toString()||"auto",this.customization.attributes.type[s].typePredicates.wrap=t.wrap||!1,this.customization.attributes.type[s].typePredicates.pinned=t.pinned||"unpinned"):e.visibility||this.customization.attributes.type[s].typePredicates.splice(n,1),this.preview.modeInUse="type",this.preview.typeInUse=e.type,this.preview.attributesArrayInUse=this.customization.attributes.type[s].typePredicates;break;case"predefinedQuery":var n,a=this.customization.attributes.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.object);if(t.dataType=e.predefinedQuery.object,-1===a&&e.visibility)this.customization.attributes.predefinedQuery.push({predefinedQueryObj:e.predefinedQuery,predefinedQueryPredicates:[t]}),this.preview.modeInUse="predefinedQuery",this.preview.predefinedQueryInUse=e.predefinedQuery.object,this.preview.attributesArrayInUse=[t];else-1===(n=this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.findIndex(e=>e.dataIndex===t.dataIndex))&&e.visibility?this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.push(t):e.visibility?(this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.width=t.width.toString()||"auto",this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.wrap=t.wrap||!1,this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.pinned=t.pinned||"unpinned"):e.visibility||this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.splice(n,1),this.preview.modeInUse="predefinedQuery",this.preview.predefinedQueryInUse=e.predefinedQuery.object,this.preview.attributesArrayInUse=this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates}},_buildCustomizationView:function(e,t){this.container.classList.contains("general-panel")&&this.container.removeClassName("general-panel"),this.container.classList.contains("general-panel-SCC")&&this.container.removeClassName("general-panel-SCC"),this.container.classList.contains("attributes-selection-panel")&&this.container.removeClassName("attributes-selection-panel"),this.container.classList.contains("attributes-selection-panel-SCC")&&this.container.removeClassName("attributes-selection-panel-SCC"),this.container.empty(),this.isSCC?this.container.addClassName("customization-panel-SCC"):this.container.addClassName("customization-panel"),this.customizationView.generalCustomizationPreview=void 0,this.selectedPredicates=[],this.selectedPredicatesInArray=[],this.customizationView.button_container=o.create("div",{id:"search-button-attributes-container",class:"search-button-attributes-container"}),this.customizationView.add_attributes_button=new d({id:"search-custo_more-attributes-button",label:N.get("custoPanel.add.attributes"),icon:{iconName:"plus",fontIconSize:"2x"}}),this.customizationView.add_attributes_button.addEventListener("click",function(){this._addCustomizationModeSelectionMenu(this)}.bind(this)),this._formatDataForPreview(this.dataForPreview),this.customizationView.custo_view_attributes=o.create("div",{id:"search-custo_attributes-container",class:"custo-view-attributes-container"}).inject(this.container),this.customizationView.button_container.inject(this.customizationView.custo_view_attributes),this.customizationView.add_attributes_button.inject(this.customizationView.button_container),this.customizationView.attributes_container=this._buildAttributesInCustomizationGrid(this.preview.availablePredicates),this.customizationView.attributes_container.inject(this.customizationView.custo_view_attributes);var i=o.create("div",{id:"search-custo_preview-container",class:"custo-view-preview-container"}).inject(this.container);this._addCustoPreview(i,t),this.selectedPredicatesInArray.forEach(function(e){this._formatDataForFinalCustomization(e)}.bind(this)),this._refreshPreview(!0)},_buildAttributesInCustomizationGrid:function(e){var t=o.create("div",{id:"search-attributes-container",class:"search-attributes-container"}),i="Datagrid"===this.customization.viewMode?i=this.gridColumnsDataGridView:this.gridColumnsTileViews,s={data:e,model:void 0,view:void 0,columns:i},n=new g;s.model=new f({dataModelSet:n}),s.model.prepareUpdate();for(var r=0,u=e.general.length;r<u;r++){var l={dataType:e.general[r].typeObj},d=e.general[r],c=y.createTreeNodeDataModel(n,{label:d.Text,grid:d});s.model.addChild(c);const t={dataType:a.is(l.dataType)?l.dataType:"",values:d,visibility:!0};e.general[r].Visibility&&this.selectedPredicatesInArray.push(t)}return e.type.forEach(function(e){var t={type:e.typeObj},i=new y({label:N.get("custoPanel.attributes.for.type")+" : "+e.Text,type:e.typeObj.object.uri,grid:e});s.model.addRoot(i),e.Children&&e.Children.forEach(function(e){var s=new y({label:e.Text,grid:e});i.addChild(s);const n={type:t.type,values:e,visibility:!0};e.Visibility&&this.selectedPredicatesInArray.push(n)}.bind(this))}.bind(this)),e.predefinedQuery.forEach(function(e){var t={predefinedQuery:e.predefinedQueryObj},i=new y({label:N.get("custoPanel.attributes.for.query")+" : "+e.Text,predefinedQuery:e.predefinedQueryObj.object,grid:e});s.model.addRoot(i),e.Children&&e.Children.forEach(function(e){var s=new y({label:e.Text,grid:e});i.addChild(s);const n={predefinedQuery:t.predefinedQuery,values:e,visibility:!0};e.Visibility&&this.selectedPredicatesInArray.push(n)}.bind(this))}.bind(this)),s.model.expandAll(),s.model.pushUpdate(),s.view=new S({treeDocument:s.model,columns:s.columns,rowDragEnabledFlag:!0,layoutOptions:{layoutDensity:"comfortable"},defaultColumnDef:{width:"auto",typeRepresentation:"string"},rowSelection:"none",columnSelection:"none",cellSelection:"none",columnDragEnabledFlag:!1,rowDragEnabledFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1}).inject(t),s.view.addEventListener("change",function(e,t){if(t.nodeModel){var i=t.nodeModel.options.grid,s={values:i,visibility:t.nodeModel.getAttributeValue("Visibility")},n="general",o=this.cog_image;a.is(i.custoMode)?n=i.custoMode:a.is(i.values)&&(n=i.values.custoMode),"general"===n&&(s.dataType=i.dataType,o=this.cog_image),"type"===n&&(s.type=t.nodeModel.getParent().options.grid.typeObj,o=this.type_image),"predefinedQuery"===n&&(s.predefinedQuery=t.nodeModel.getParent().options.grid.predefinedQueryObj,o=this.query_image),this._formatDataForFinalCustomization(s),this._buildCustoPreviewItems(s,!1,o),this._updateCreationButton()}}.bind(this)),t},_addCustomizationModeSelectionMenu:function(e){var t=[],i={type:"CheckItem",title:N.get("custoPanel.general.customization"),icon:{iconName:"search wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){P.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",data:{customization:e.customization,customizationMode:"general",isEditMode:e.isEditMode}})}}},s={type:"CheckItem",title:N.get("custoPanel.type.customization"),icon:{iconName:"filter wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){P.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",data:{customization:e.customization,customizationMode:"type",isEditMode:e.isEditMode}})}}},n={type:"CheckItem",title:N.get("custoPanel.predefinedQuery.customization"),icon:{iconName:"i-question wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){P.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",data:{customization:e.customization,customizationMode:"predefinedQuery",isEditMode:e.isEditMode}})}}};t.push(i,s,n),h.show(t,{position:e.customizationView.add_attributes_button.elements.button.getOffsets()})},_updateCreationButton:function(){let e=!1;if(0===this.customization.attributes.general.length&&0===this.customization.attributes.type.length&&0===this.customization.attributes.predefinedQuery.length)e=!0;else if(0===this.customization.attributes.general.length){var t=0;this.customization.attributes.type.forEach(function(e){t+=e.typePredicates.length}),this.customization.attributes.predefinedQuery.forEach(function(e){t+=e.predefinedQueryPredicates.length}),0===t&&(e=!0)}this.customizationView.create_button.disabled=e},_updatePreviewMode:function(e){var t;switch(this.customization.viewMode){case"all views":case"Tile":t=this._buildCustoPreviewItemsTileView(e);break;case"LargeTile":t=this._buildCustoPreviewItemsLargeTileView(e);break;case"Thumbnail":t=this._buildCustoPreviewItemsThumbnailView(e);break;case"Datagrid":t=this._buildCustoPreviewItemsDatagridView()}return t},_addCustoPreview:function(e,t){this.customizationView.custo_box=o.create("div",{id:"search-custo-preview-box",class:"custo-preview-box"}).inject(e),this.customizationView.hidden_validation_box=o.create("div",{id:"search-custo-preview-box-hidden",class:"custo-preview-validation-box-hidden"}).inject(e),this.customizationView.validate_button=new d({label:t?N.get("custoPanel.button.edit"):N.get("custoPanel.button.create"),emphasize:"primary",disabled:!t,id:"search-custo-preview-validate-button",class:"custo-preview-validate-button"}),this.customizationView.validate_button.addEventListener("click",function(){if(!this.customizationView.validate_button.disabled){"Datagrid"===this.customization.viewMode&&console.log(this.customization),this.customization.preview=this.preview;var e={preview:this.preview,customization:this.customization,isEditMode:t};P.publish({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_created",data:e}),!0===t&&P.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_edited",data:e})}}.bind(this)),this.customizationView.cancel_validation_button=new d({label:N.get("custoPanel.button.cancel"),emphasize:"secondary",id:"search-custo-preview-cancel-validation-button",class:"custo-preview-cancel-validation-button"}),this.customizationView.cancel_validation_button.addEventListener("click",function(){x.hideOverlayLoader(this.customizationView.custo_view_attributes),this.customizationView.hidden_validation_box.removeClassName("custo-preview-validation-box"),this.customizationView.hidden_validation_box.addClassName("custo-preview-validation-box-hidden"),this.customizationView.hidden_validation_box.empty(),this.customizationView.custo_box.removeClassName("custo-preview-box-hidden"),this.customizationView.custo_box.addClassName("custo-preview-box")}.bind(this));var i=o.create("div",{id:"search-custo-preview-title",class:"custo-preview-title"}).inject(this.customizationView.custo_box);new l({elementsList:this.availableViewsList,currentValue:this.customization.viewMode,touchMode:!0,enableSearchFlag:!1}).inject(i).addEventListener("change",function(e){this.customization.viewMode=e.dsModel.value,this._refreshPreview(!1),this.customizationView.attributes_container.destroy();const t=this.preview.availablePredicates;this.customizationView.attributes_container=this._buildAttributesInCustomizationGrid(t),this.customizationView.attributes_container.inject(this.customizationView.custo_view_attributes)}.bind(this));o.create("span",{id:"search-custo-preview-view-title",text:N.get("custoPanel.preview.title")+" :"}).inject(i);var s=o.create("div",{id:"search-custo-preview-section",class:"custo-preview-section"}).inject(this.customizationView.custo_box);this.customizationView.preview_container=s;var n=o.create("div",{id:"search-custo-preview-button",class:"custo-preview-button"}).inject(this.customizationView.custo_box);this.customizationView.create_button=new d({label:t?N.get("custoPanel.button.edit"):N.get("custoPanel.button.ok"),emphasize:"primary",id:"search-custo-preview-create-button",class:"custo-preview-create-button"}).inject(n),this.customizationView.create_button.addEventListener("click",function(){this.customizationView.create_button.disabled||this._buildValidationPanel(t)}.bind(this)),new d({label:N.get("custoPanel.button.cancel"),emphasize:"secondary",id:"search-custo-preview-cancel-button",class:"custo-preview-cancel-button"}).inject(n).addEventListener("click",function(){P.publish({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_canceled"})}.bind(this))},_buildValidationPanel:function(e){x.showOverlayLoader(" ",this.customizationView.custo_view_attributes),this.customizationView.custo_box.removeClassName("custo-preview-box"),this.customizationView.custo_box.addClassName("custo-preview-box-hidden"),this.customizationView.hidden_validation_box.removeClassName("custo-preview-validation-box-hidden"),this.customizationView.hidden_validation_box.addClassName("custo-preview-validation-box");var t=o.create("div",{id:"search-custo-preview-title",class:"custo-validation-form-title"}).inject(this.customizationView.hidden_validation_box),i=(o.create("span",{id:"search-custo-preview-view-title",text:N.get("custoPanel.preview.title.span")}).inject(t),o.create("div",{class:"validation-form-section"}).inject(this.customizationView.hidden_validation_box)),s=o.create("div",{class:"validation-form-naming-section"}).inject(i),n=(o.create("span",{text:N.get("custoPanel.preview.validation.customization.title")+" : "}).inject(s),o.create("div",{class:"search-line-editor-container"}).inject(s));this.existingCustomizationIds=T.buildUserCustomizationList();var r="^(?!("+this.existingCustomizationIds.join("|")+")$).*$",u=new m({placeholder:e?this.customization.customizationId:N.get("custoPanel.general.newCustomization"),disabled:e,pattern:r,sizeInCharNumber:110,displayClearFieldButtonFlag:!0,maxLength:110});u.tooltipInfos=new v({longHelp:N.get("custoPanel.title.editor.tooltip")}),u.inject(n),u.addEventListener("uncommittedChange",function(t){a.is(t.dsModel.valueToCommit,"string")&&""!==t.dsModel.valueToCommit?-1===this.existingCustomizationIds.findIndex(e=>e===t.dsModel.valueToCommit)?(this.customization.customizationId=t.dsModel.valueToCommit,this.customizationView.validate_button.disabled=!1):this.customizationView.validate_button.disabled=!0:e||(this.customizationView.validate_button.disabled=!0)}.bind(this));var d=o.create("div",{class:"validation-form-view-selection-section"}).inject(i);o.create("span",{text:N.get("custoPanel.preview.title")+" : "}).inject(d);new l({elementsList:function(e,t){var i=[];return e.forEach(function(e){e.value===t?i.unshift(e):i.push(e)}.bind(this)),i}(this.availableViewsList,this.customization.viewMode),touchMode:!0,enableSearchFlag:!1}).inject(d).addEventListener("change",function(e){this.customization.viewMode=e.dsModel.value}.bind(this));var c=o.create("div",{class:"custo-preview-validation-box-button"}).inject(this.customizationView.hidden_validation_box);this.customizationView.cancel_validation_button.inject(c),this.customizationView.validate_button.inject(c)},_buildCustoPreviewItems:function(e,t,i){var s=this.customizationView.preview_container;switch(document.getElementById("search-custo-preview-placeholder")&&!t&&document.getElementById("search-custo-preview-placeholder").destroy(),null!==e?e.values.custoMode:"general"){case"general":var n=this._updatePreviewMode(i);if(void 0===this.customizationView.generalCustomizationPreview){this.customizationView.generalCustomizationPreview=o.create("div",{id:"search-custo-preview-general",class:"custo-preview-general"}).inject(s);new c({header:N.get("custoPanel.preview.expander.general.customization"),body:n,style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.customizationView.generalCustomizationPreview)}else if(this.customization.attributes.general.length>0){this.customizationView.generalCustomizationPreview.empty();new c({header:N.get("custoPanel.preview.expander.general.customization"),body:n,style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.customizationView.generalCustomizationPreview)}else this.customizationView.generalCustomizationPreview.empty();break;case"type":n=this._updatePreviewMode(i);var a=this.customizationView.typeCustomizationPreview.findIndex(t=>t.typeName===e.type.label);if(this.customizationView.typeCustomizationPreview.find(t=>t.typeName===e.type.label)&&!t){var r=document.getElementById("search-type-custo-preview-container-"+e.type.object.uri);if(this.preview.attributesArrayInUse.length>0){r.empty();var u=o.create("div",{id:"search-type-custo-preview-container"}).inject(r);new c({header:N.get("custoPanel.preview.expander.type.customization")+" : "+e.type.label,body:n,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(u)}else r.empty()}else{u=o.create("div",{id:"search-type-custo-preview-container-"+e.type.object.uri}).inject(s),new c({header:N.get("custoPanel.preview.expander.type.customization")+" : "+e.type.label,body:n,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(u);-1===a&&this.customizationView.typeCustomizationPreview.push({typeName:e.type.label,html:u})}break;case"predefinedQuery":n=this._updatePreviewMode(i);var l=this.customizationView.predefinedQueryCustomizationPreview.findIndex(t=>t.pqName===e.predefinedQuery.label);if(this.customizationView.predefinedQueryCustomizationPreview.find(t=>t.pqName===e.predefinedQuery.label)&&!t){r=document.getElementById("search-predefinedQuery-custo-preview-container-"+e.predefinedQuery.object);if(this.preview.attributesArrayInUse.length>0){r.empty();var d=o.create("div",{id:"search-predefinedQuery-custo-preview-container",class:"synthetic-view-container"}).inject(r);new c({header:N.get("custoPanel.preview.expander.predefinedQuery.customization")+" : "+e.predefinedQuery.label,body:n,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(d)}else r.empty()}else{d=o.create("div",{id:"search-predefinedQuery-custo-preview-container-"+e.predefinedQuery.object}).inject(s),new c({header:N.get("custoPanel.preview.expander.predefinedQuery.customization")+" : "+e.predefinedQuery.label,body:n,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(d);-1===l&&this.customizationView.predefinedQueryCustomizationPreview.push({pqName:e.predefinedQuery.label,html:d})}}},_buildSpreadsheetPreviewItems:function(e){var t=[];this.preview.attributesArrayInUse.forEach(function(e){t.push({text:e.text,dataIndex:e.dataIndex,width:"auto",minWidth:40})});var i=o.create("div",{class:"custo-grid-container-preview"}).inject(e);this.custoSpreadsheet=new w({modeInUse:this.preview.modeInUse,columns:t,defaultCellHeight:40,defaultCellWidth:120,headersDimensions:{height:40},selection:{cells:!0},show:{rowHeaders:!1,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!1},isSortable:!1}).inject(i),"type"===this.preview.modeInUse&&(this.custoSpreadsheet.typeInUse=this.preview.typeInUse),"predefinedQuery"===this.preview.modeInUse&&(this.custoSpreadsheet.predefinedQueryInUse=this.preview.predefinedQueryInUse),this.custoSpreadsheet.getManager().onMoveColumn(function(e){if(a.is(e.fromColumnID)&&a.is(e.toColumnID)){if("general"===this.custoSpreadsheet.options.modeInUse){var t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.preview.availablePredicates.general.find(t=>t.uri===e.dataIndex);a.is(i)&&t.push(i)}.bind(this)),t.length===this.preview.availablePredicates.general.length&&(this.preview.availablePredicates.general=t);var i=[];this.custoSpreadsheet.options.columns.forEach(function(e){var t=this.customization.attributes.general.find(t=>t.dataIndex===e.dataIndex);a.is(t)&&i.push(t)}.bind(this)),i.length===this.customization.attributes.general.length&&(this.customization.attributes.general=i)}else if("type"===this.custoSpreadsheet.options.modeInUse){var s;if((s=this.preview.availablePredicates.type.findIndex(e=>e.typeObj.object.uri===this.custoSpreadsheet.typeInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.preview.availablePredicates.type[s].Children.find(t=>t.uri===e.dataIndex);a.is(i)&&t.push(i)}.bind(this)),t.length===this.preview.availablePredicates.type[s].Children.length&&(this.preview.availablePredicates.type[s].Children=t)}if((s=this.customization.attributes.type.findIndex(e=>e.typeObj.object.uri===this.custoSpreadsheet.typeInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.customization.attributes.type[s].typePredicates.find(t=>t.dataIndex===e.dataIndex);a.is(i)&&t.push(i)}.bind(this)),t.length===this.customization.attributes.type[s].typePredicates.length&&(this.customization.attributes.type[s].typePredicates=t)}}else if("predefinedQuery"===this.custoSpreadsheet.options.modeInUse){var n;if((n=this.preview.availablePredicates.predefinedQuery.findIndex(e=>e.predefinedQueryObj.object===this.custoSpreadsheet.predefinedQueryInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.preview.availablePredicates.predefinedQuery[n].Children.find(t=>t.uri===e.dataIndex);a.is(i)&&t.push(i)}.bind(this)),t.length===this.preview.availablePredicates.predefinedQuery[n].Children.length&&(this.preview.availablePredicates.predefinedQuery[n].Children=t)}if((n=this.customization.attributes.predefinedQuery.findIndex(e=>e.predefinedQueryObj.object===this.custoSpreadsheet.predefinedQueryInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates.find(t=>t.dataIndex===e.dataIndex);a.is(i)&&t.push(i)}.bind(this)),t.length===this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates.length&&(this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates=t)}}this._buildCustomizationView(this,this.isEditMode)}}.bind(this))},_buildCustoPreviewItemsTileView:function(e){var t=o.create("div",{id:"search-preview-Tile-container",class:"custo-preview-Tile-container"});this._buildSpreadsheetPreviewItems(t);for(var i="",s=0;s<this.preview.attributesArrayInUse.length;s++)s!==this.preview.attributesArrayInUse.length-1?i=i+this.preview.attributesArrayInUse[s].text+" | ":i+=this.preview.attributesArrayInUse[s].text;var n=a.is(e)?e:this.cog_image,r=new C({picture:n,icon:"cog",title:N.get("custoPanel.preview.item.title"),multipleTitleLineNumber:!1,subtitle:i,description:"",contextualMenu:[N.get("custoPanel.preview.item.contextualMenu")]}).inject(t);return r.getContent().setStyle("width","400px"),r.getContent().setStyle("margin-bottom","5%"),t},_buildCustoPreviewItemsLargeTileView:function(e){var t=o.create("div",{id:"search-preview-Tile-container",class:"custo-preview-LargeTile-container"});this._buildSpreadsheetPreviewItems(t);for(var i="",s=0;s<this.preview.attributesArrayInUse.length;s++)s!==this.preview.attributesArrayInUse.length-1?i=i+this.preview.attributesArrayInUse[s].text+" | ":i+=this.preview.attributesArrayInUse[s].text;var n=a.is(e)?e:this.cog_image,r=new z({picture:n,icon:"cog",title:N.get("custoPanel.preview.item.title"),multipleTitleLineNumber:!1,subtitle:i,description:"",contextualMenu:[N.get("custoPanel.preview.item.contextualMenu")]}).inject(t);return r.getContent().setStyle("width","400px"),r.getContent().setStyle("margin-bottom","5%"),t},_buildCustoPreviewItemsThumbnailView:function(e){var t=o.create("div",{id:"search-preview-Tile-container",class:"custo-preview-Thumbnail-container"});this._buildSpreadsheetPreviewItems(t);for(var i="",s=0;s<this.preview.attributesArrayInUse.length;s++)s!==this.preview.attributesArrayInUse.length-1?i=i+this.preview.attributesArrayInUse[s].text+" | ":i+=this.preview.attributesArrayInUse[s].text;var n=a.is(e)?e:this.cog_image,r=new _({picture:n,icon:"cog",title:N.get("custoPanel.preview.item.title"),multipleTitleLineNumber:!1,subtitle:i,description:"",contextualMenu:[N.get("custoPanel.preview.item.contextualMenu")]}).inject(t);return r.getContent().setStyle("width","200px"),r.getContent().setStyle("margin-bottom","5%"),t},_buildCustoPreviewItemsDatagridView:function(){var e=o.create("div",{id:"search-preview-Datagrid-container",class:"custo-preview-Datagrid-container"});this._buildSpreadsheetPreviewItems(e);var t=[],i=[],s={};this.preview.attributesArrayInUse.forEach(function(e){t.push({text:e.text,dataIndex:e.dataIndex,width:e.width,wrap:e.wrap,pinned:e.pinned,typeRepresentation:"string"}),s[e.dataIndex.toString()]=N.get("custoPanel.preview.item.datagrid.title")+" "+e.dataIndex}),s.Text=N.get("custoPanel.preview.item.datagrid.text"),i.push(s);var n={data:i,model:void 0,view:void 0,columns:t},a=new g;n.model=new f({dataModelSet:a}),n.model.prepareUpdate();for(var r=0,u=i.length;r<u;r++){var l=i[r],d=y.createTreeNodeDataModel(a,{label:l.Text,grid:l});n.model.addChild(d)}return n.model.expandAll(),n.model.pushUpdate(),n.view=new S({treeDocument:n.model,columns:n.columns,rowDragEnabledFlag:!1,layoutOptions:{layoutDensity:"comfortable"},defaultColumnDef:{width:"auto",typeRepresentation:"string"},rowSelection:"none",columnSelection:"none",cellSelection:"none",columnDragEnabledFlag:!1,rowDragEnabledFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1}).inject(e),e},_refreshPreview:function(e){var t=this.customizationMode;["general","type","predefinedQuery"].forEach(function(t){"general"===t?(this.customizationMode=t,this.preview.modeInUse="general",this.preview.attributesArrayInUse=this.customization.attributes.general,this._buildCustoPreviewItems(null,e,this.cog_image)):"type"===t?(this.customizationMode=t,this.customization.attributes.type.forEach(function(t){this.preview.modeInUse="type",this.preview.typeInUse=t.typeObj.object.uri,this.preview.attributesArrayInUse=t.typePredicates;var i={type:t.typeObj,values:{custoMode:"type"}};this._buildCustoPreviewItems(i,e,this.type_image)}.bind(this))):(this.customizationMode=t,this.customization.attributes.predefinedQuery.forEach(function(t){this.preview.modeInUse="predefinedQuery",this.preview.predefinedQueryInUse=t.predefinedQueryObj.object,this.preview.attributesArrayInUse=t.predefinedQueryPredicates;var i={predefinedQuery:t.predefinedQueryObj,values:{custoMode:"predefinedQuery"}};this._buildCustoPreviewItems(i,e,this.query_image)}.bind(this)))}.bind(this)),this.customizationMode=t},render:async function(){if(this.isEditMode){var e=new Promise(e=>{e(this._formatDataForEdition(this.customization))});await e&&this._buildCustomizationView(this,this.isEditMode)}else this._buildCustomizationView(this,this.isEditMode)}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomizationPanel",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","DS/Windows/Dialog","DS/SNResultUX/utils/ExternalComponentHelpers","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNSearchResultsCusto/model/SNResultsCustomizationModel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,n,a,o,r,u,l,d,c){"use strict";return i.extend(e,{generalContext:null,elements:[],customizationObject:null,recovered_customizations:null,customizationObject:null,customizationMode:"general",customization:{customizationId:"New customization",viewMode:"Tile",viewModeIcon:"view-small-tile wux-ui-3ds",attributes:{general:[],type:[],predefinedQuery:[]}},preview:{availablePredicates:{general:[],type:[],predefinedQuery:[]},attributesArrayInUse:[]},attributeSelectionForm:{oSourceAutocomplete:{},oTypeAutocomplete:{},oExtensionAutocomplete:{},oPredefinedQueryAutocomplete:{},oAttributesAutocomplete:{},availableTypes:null,availableExtensions:[],selectedDataSource:null,selectedTypes:[],selectedExtensions:[],selectedPredefinedQuery:[],selectedPredicates:{general:[],type:{typeObj:{},typePredicates:[]},predefinedQuery:{predefinedQueryObj:{},predefinedQueryPredicates:[]}}},setup:function(e,i){if(e){o.getPlatformServices().getPortfolioRole(function(e){console.log(e)});if(this.generalContext=e,u.setGeneralContext(e),e.disableTenantSetting||l.loadCustomizationTenantSettings(),this.elements.stepSelector={},this.elements.stepSelector.ropeWidth=null,this.elements.generalCustomizationPreview=void 0,this.elements.typeCustomizationPreview=[],this.elements.predefinedQueryCustomizationPreview=[],t.is(e.isSCC)&&t.is(i))this.elements.mainContainer=i,this.elements.mainContainer.addClassName("general-panel-SCC"),this.isSCC=!0,this.customization.role="admin";else{n.initImmersiveFrame();var a=new s({title:d.get("custoPanel.general.title"),immersiveFrame:n.getImmersiveFrame(),width:"80vh",height:"140vh",recId:"GeneralCustomizationMenu",modalFlag:!0,maximizeButtonFlag:!0,position:{at:"50 50",collision:"fit"}});this.elements.dialog=a,this.elements.mainContainer=a.elements._contentDiv,this.elements.dialog.elements._mainContentDiv.addClassName("general-dialog"),this.elements.dialog.elements._modalDiv.addClassName("custoPanel-mask"),this.elements.mainContainer.addClassName("general-panel"),this.customization.role="user"}this.role=this.customization.role,this.setupViewsObserver(),this.showGlobalView()}return!0},createCustomizationObject:function(){var e=new r;return e.setCustomizationId(this.customization.customizationId),e.setCustomizationRole(this.role),e.setCustomizedViews(this.customization.viewMode),e.setViewDefinition(this.customization.viewMode,"general",this.customization.attributes.general),this.customization.attributes.type.forEach(function(t){e.setViewDefinition(this.customization.viewMode,"type",t.typePredicates,t.typeObj.object.uri,t.typeObj.label)}.bind(this)),this.customization.attributes.predefinedQuery.forEach(function(t){e.setViewDefinition(this.customization.viewMode,"predefinedQuery",t.predefinedQueryPredicates,t.predefinedQueryObj.object,t.predefinedQueryObj.label)}.bind(this)),e},clearCustomization:function(){this.customizationMode="general",this.customizationStep="nav_datasources",this.customization={customizationId:"New customization",viewMode:"Tile",viewModeIcon:"view-small-tile wux-ui-3ds",attributes:{general:[],type:[],predefinedQuery:[]}},this.preview={availablePredicates:{general:[],type:[],predefinedQuery:[]},attributesArrayInUse:[]},this.attributeSelectionForm={oSourceAutocomplete:{},oTypeAutocomplete:{},oExtensionAutocomplete:{},oPredefinedQueryAutocomplete:{},oAttributesAutocomplete:{},availableTypes:null,availableExtensions:[],selectedDataSource:null,selectedTypes:[],selectedExtensions:[],selectedPredefinedQuery:[],selectedPredicates:{general:[],type:{typeObj:{},typePredicates:[]},predefinedQuery:{predefinedQueryObj:{},predefinedQueryPredicates:[]}}}},setCustomizationParameters:function(e,t,i,s,n){this.customization.customizationId=e,this.customization.viewMode=t,this.customization.attributes.general=i,this.customization.attributes.type=s,this.customization.attributes.predefinedQuery=n},getCustomizationPanel:function(){return this.elements},getUserCustomization:function(){return{obj:this.customizationObject}},setupViewsObserver:function(){a.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_new_customization",callback:()=>{this.clearCustomization(),this.showCustomizationView(!1)}}),a.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_edit_customization",callback:e=>{let t=e.customizedViews;"all views"===t&&(t="Tile"),this.setCustomizationParameters(e.customizationId,e.customizedViews,e.views[t].general,e.views[t].type,e.views[t].predefinedQuery),this.showCustomizationView(!0)}}),a.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_created",callback:e=>{this.customization.preview=e.preview,this.customization=e.customization;var t=this.createCustomizationObject();l.saveCustomization(t,!0),this.clearCustomization(),this.showGlobalView()}}),a.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_canceled",callback:()=>{this.clearCustomization(),this.showGlobalView()}}),a.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",callback:e=>{this.customization=e.customization,this.customizationMode=e.customizationMode,this.showAtributesSelectionView(e.isEditMode)}}),a.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",callback:e=>{const t=e.selectedPredicates;this.attributeSelectionForm.selectedPredicates=t,this.showCustomizationView(e.isEditMode)}}),a.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection_canceled",callback:e=>{this.showCustomizationView(e)}})},showGlobalView:function(){n.showOverlayLoader(d.get("custoPanel.general.overlay.loading.view"),this.elements.mainContainer),require(["DS/SNSearchResultsCusto/views/SearchResultsCustomization_GlobalView"],function(e){let t={container:this.elements.mainContainer,elements:this.elements,role:this.customization.role||this.role,isSCC:this.isSCC};this.panelGlobalView=new e(t),this.panelGlobalView.render(),n.hideOverlayLoader(this.elements.mainContainer)}.bind(this))},showCustomizationView:function(e){n.showOverlayLoader(d.get("custoPanel.general.overlay.loading.view"),this.elements.mainContainer),require(["DS/SNSearchResultsCusto/views/SearchResultsCustomization_CustomizationView"],function(t){let i={container:this.elements.mainContainer,elements:this.elements,preview:this.preview,customization:this.customization,customizationMode:this.customizationMode,dataForPreview:this.attributeSelectionForm.selectedPredicates,isEditMode:e,isSCC:this.isSCC};this.panelCustomizationView=new t(i),this.panelCustomizationView.render(),n.hideOverlayLoader(this.elements.mainContainer)}.bind(this))},showAtributesSelectionView:function(e=!1){n.showOverlayLoader(d.get("custoPanel.general.overlay.loading.view"),this.elements.mainContainer),require(["DS/SNSearchResultsCusto/views/SearchResultsCustomization_AttributesSelectionView"],function(t){let i={container:this.elements.mainContainer,elements:this.elements,customization:this.customization,customizationMode:this.customizationMode,isSCC:this.isSCC,isEditMode:e};this.panelAttributesSelectionView=new t(i),this.panelAttributesSelectionView.render(),n.hideOverlayLoader(this.elements.mainContainer)}.bind(this))}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomization_AttributesSelectionView",["UWA/Class/View","UWA/Class/Debug","UWA/Core","UWA/Element","DS/WUXAutoComplete/AutoComplete","DS/Controls/Button","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/SNResultUX/utils/ExternalComponentHelpers","DS/MessageBus/MessageBus","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,n,a,o,r,u,l,d,c,h,p,m,v,b){"use strict";const w="#3498db";return e.extend(t,{attributesSelectionView:null,container:null,customization:null,customizationMode:null,customizationStep:"nav_datasources",customizationSteps:["nav_datasources","nav_types","nav_extensions","nav_attributes","nav_predefined_query"],gridColumnsTileViews:[{text:v.get("custoPanel.attributes.name"),dataIndex:"tree"},{text:v.get("custoPanel.attributes.selection"),dataIndex:"Visibility",typeRepresentation:"boolean",type:"checkbox",editableFlag:"true",editionPolicy:"EditionInPlace"}],attributeSelectionForm:{oSourceAutocomplete:{},oTypeAutocomplete:{},oExtensionAutocomplete:{},oPredefinedQueryAutocomplete:{},oAttributesAutocomplete:{},availableTypes:null,availableExtensions:[],selectedDataSource:null,selectedTypes:[],selectedExtensions:[],selectedPredefinedQuery:[],selectedPredicates:{general:[],type:{typeObj:{},typePredicates:[]},predefinedQuery:{predefinedQueryObj:{},predefinedQueryPredicates:[]}}},init:function(e){return this.container=e.container,this.attributesSelectionView=e.elements,this.customization=e.customization,this.customizationMode=e.customizationMode,this.isSCC=e.isSCC,this.isEditMode=e.isEditMode,this._parent(e)},_buildAttributeSelectionView:async function(){this.container.classList.contains("customization-panel")&&this.container.removeClassName("customization-panel"),this.container.classList.contains("customization-panel-SCC")&&this.container.removeClassName("customization-panel-SCC"),this.container.empty(),this.isSCC?this.container.addClassName("attributes-selection-panel-SCC"):this.container.addClassName("attributes-selection-panel");var e=s.create("div",{id:"search-custo_view-steps",class:"custo-view-steps-container"}).inject(this.container);if(this._addStepSelector(e,this.customizationMode),"type"===this.customizationMode&&"nav_types"===this.customizationStep){var t=new Promise(e=>{e(this._buildSourceSelector())}),n=await t;i.is(n)&&this._buildUIElements()}else this._buildUIElements()},_buildUIElements:function(){var e=s.create("div",{id:"search-custo_search-box",class:"custo-search-box-container"}).inject(this.container);this.autocompleteContainer=e;var t=s.create("div",{id:"search-custo_grid-attribute",class:"custo-grid-attributes-container"}).inject(this.container);this.gridPredicatesContainer=t,this._buildAutocomplete();var i=s.create("div",{id:"search-custo-preview-button",class:"custo-attributes-button"}).inject(this.container);this.attributesSelectionView.skip_button=new a({label:v.get("custoPanel.button.skip"),emphasize:"secondary",class:"custo-preview-skip-button"}).inject(i),this.attributesSelectionView.skip_button.visibleFlag=!1,this.attributesSelectionView.skip_button.addEventListener("click",function(){this._navigateStepSelector(!0);var e=this.customizationSteps.findIndex(e=>e===this.customizationStep);void 0!==this.customizationSteps[e+1]?(this.customizationStep=this.customizationSteps[e+1],this.attributesSelectionView.skip_button.visibleFlag=!1,this._buildAutocomplete()):h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",data:{selectedPredicates:this.attributeSelectionForm.selectedPredicates,isEditMode:this.isEditMode}})}.bind(this)),this.attributesSelectionView.back_button=new a({label:v.get("custoPanel.button.back"),emphasize:"secondary",disabled:!0,id:"search-custo-preview-back-button",class:"custo-preview-back-button",visibleFlag:!1}).inject(i),this.attributesSelectionView.back_button.addEventListener("click",()=>{this._navigateStepSelector(!1);const e=this.customizationSteps.findIndex(e=>e===this.customizationStep);this.customizationStep=this.customizationSteps[e-1],this.attributesSelectionView.back_button.disabled=e-1==0,this.attributesSelectionView.back_button.visibleFlag=e-1!=0,this.attributesSelectionView.skip_button.visibleFlag="predefinedQuery"!==this.customizationMode&&"nav_extensions"===this.customizationStep,this._buildAutocomplete(!0)}),this.attributesSelectionView.next_button=new a({label:v.get("custoPanel.button.next"),emphasize:"primary",disabled:!0,id:"search-custo-preview-create-button",class:"custo-preview-create-button"}).inject(i),this.attributesSelectionView.next_button.addEventListener("click",function(){if(!this.attributesSelectionView.next_button.disabled){var e=this.customizationSteps.findIndex(e=>e===this.customizationStep);this.attributesSelectionView.back_button.disabled=!1,this.attributesSelectionView.back_button.visibleFlag=!0,void 0!==this.customizationSteps[e+1]?(this.customizationStep=this.customizationSteps[e+1],"predefinedQuery"!==this.customizationMode&&("nav_extensions"===this.customizationStep?this.attributesSelectionView.skip_button.visibleFlag=!0:this.attributesSelectionView.skip_button.visibleFlag=!1),this._navigateStepSelector(!0),this._buildAutocomplete()):h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",data:{selectedPredicates:this.attributeSelectionForm.selectedPredicates,isEditMode:this.isEditMode}})}}.bind(this)),new a({label:v.get("custoPanel.button.cancel"),emphasize:"secondary",id:"search-custo-preview-cancel-button",class:"custo-preview-cancel-button"}).inject(i).addEventListener("click",function(){h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection_canceled",data:this.isEditMode})}.bind(this))},_updateNextStepButton:function(){0===this.currentSelection.length?this.attributesSelectionView.next_button.disabled=!0:this.attributesSelectionView.next_button.disabled=!1},_addStepSelector:function(e,t){var i=this.attributesSelectionView,n=[];"general"===t?(this.customizationSteps=["nav_datasources","nav_types","nav_extensions","nav_attributes"],this.customizationStep="nav_datasources",this.attributesSelectionView.stepSelector.ropeWidth=20,n=[{text:v.get("custoPanel.attributes.selection.datasources"),id:"nav_datasources"},{text:v.get("custoPanel.attributes.selection.types"),id:"nav_types"},{text:v.get("custoPanel.attributes.selection.extensions"),id:"nav_extensions"},{text:v.get("custoPanel.attributes.selection.attributes"),id:"nav_attributes"}]):"type"===t?(this.customizationSteps=["nav_types","nav_extensions","nav_attributes"],this.customizationStep="nav_types",this.attributesSelectionView.stepSelector.ropeWidth=25,n=[{text:v.get("custoPanel.attributes.selection.type"),id:"nav_types"},{text:v.get("custoPanel.attributes.selection.extension.optionnal"),id:"nav_extensions"},{text:v.get("custoPanel.attributes.selection.attributes"),id:"nav_attributes"}]):(this.customizationSteps=["nav_predefined_query","nav_attributes"],this.customizationStep="nav_predefined_query",this.attributesSelectionView.stepSelector.ropeWidth=30,n=[{text:v.get("custoPanel.attributes.selection.predefinedQuery"),id:"nav_predefined_query"},{text:v.get("custoPanel.attributes.selection.attributes"),id:"nav_attributes"}]);var a=s.create("div",{id:"search-rope-container",class:"custo-view-rope-container"}).inject(e),o=(s.create("div",{class:"custo-view-rope-placeholder"}).inject(a),s.create("div",{class:"custo-view-rope"}).inject(a));"type"===t?o.setStyle("width","25%"):"predefinedQuery"===t&&o.setStyle("width","30%"),i.stepSelector.rope=o,i.stepSelector.steps=[];var r=s.create("div",{id:"search-view-navigator",class:"custo-view-navigator"}).inject(e);n.forEach(function(e){var n="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-list-test";"nav_datasources"===e.id?n="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-tag-active":"nav_types"===e.id?n="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-3d-object-question":"nav_predefined_query"===e.id?n="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-i-question":"nav_extensions"===e.id?n="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-tree-view-flattened-leaves":"nav_attributes"===e.id&&(n="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-list-test");var a=s.create("div",{class:"custo-view-navigator-element"}).inject(r),o=s.create("div",{class:"nav-item-active-indicator"}).inject(a),u=(s.create("span",{class:"indicator-icon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down"}).inject(o),s.create("div",{class:"nav-item-circle"}).inject(a)),l=s.create("span",{class:n}).inject(u),d=s.create("div",{class:"nav-item-label",text:e.text}).inject(a);i.stepSelector.steps.push({step:e.id,content:[u,l,d]}),("nav_datasources"===e.id||"nav_predefined_query"===e.id||"nav_types"===e.id&&"type"===t)&&(u.setStyle("background-color",w),l.setStyle("color","#ffffff"),d.setStyle("color",w))})},_navigateStepSelector:function(e){"general"===this.customizationMode?e?this.attributesSelectionView.stepSelector.ropeWidth+=20:this.attributesSelectionView.stepSelector.ropeWidth-=20:"type"===this.customizationMode?e?this.attributesSelectionView.stepSelector.ropeWidth+=25:this.attributesSelectionView.stepSelector.ropeWidth-=25:e?this.attributesSelectionView.stepSelector.ropeWidth+=40:this.attributesSelectionView.stepSelector.ropeWidth-=40,this.attributesSelectionView.stepSelector.rope.setStyle("width",this.attributesSelectionView.stepSelector.ropeWidth+"%");var t=this.attributesSelectionView.stepSelector.steps.find(e=>e.step===this.customizationStep).content;e?t[0].setStyle("background-color",w):t[0].setStyle("background-color","#ffffff"),e?t[1].setStyle("color","#ffffff"):t[1].setStyle("color","#b4b6ba"),e?t[2].setStyle("color",w):t[2].setStyle("color","#b4b6ba")},_buildSourceSelector:async function(){this.container.addClassName("attributes-selection-panel-type");var e=new Promise((e,t)=>{e(p.custoComputeSources())}),t=await e;if(i.is(t)){var n=[];t.forEach(function(e){if(Array.isArray(e.value)){e.value.some(e=>p.isSourceAvailable(e))&&n.push(e)}else p.isSourceAvailable(e)&&("dashboard"===e.value&&(e.value=e.label),n.push(e))}.bind(this)),this.custo_source_selector=s.create("div",{class:"search-custo-source-selector-container"}).inject(this.container);s.create("span",{text:v.get("custoPanel.attributes.selection.your.datasources")}).inject(this.custo_source_selector);this.source_selector=new o({elementsList:n,touchMode:!0,enableSearchFlag:!1}).inject(this.custo_source_selector),this.source_selector.addEventListener("change",function(e){i.is(e.dsModel.currentValue)&&(this.attributeSelectionForm.selectedDataSource={label:e.dsModel.currentLabel,object:e.dsModel.currentValue},this._buildAutocomplete())}.bind(this)),t.length>=1&&(this.attributeSelectionForm.selectedDataSource={label:n[0].label,object:n[0].value})}return n},_buildAutocomplete:async function(e=!1){"type"===this.customizationMode&&"nav_types"!==this.customizationStep&&this.container.classList.contains("attributes-selection-panel-type")?(this.custo_source_selector.destroy(),this.container.removeClassName("attributes-selection-panel-type")):"type"!==this.customizationMode&&this.container.classList.contains("attributes-selection-panel-type")&&this.container.removeClassName("attributes-selection-panel-type");const t="nav_datasources"===this.customizationStep?[this.attributeSelectionForm.selectedDataSource]:"nav_types"===this.customizationStep?this.attributeSelectionForm.selectedTypes:"nav_extensions"===this.customizationStep?this.attributeSelectionForm.selectedExtensions:"nav_predefined_query"===this.customizationStep?[this.attributeSelectionForm.selectedPredicates.predefinedQuery.predefinedQueryObj]:"nav_attributes"===this.customizationStep?"general"===this.customizationMode?this.attributeSelectionForm.selectedPredicates.general:"type"===this.customizationMode?this.attributeSelectionForm.selectedPredicates.type.typePredicates:this.attributeSelectionForm.selectedPredicates.predefinedQuery.predefinedQueryPredicates:[];this.currentSelection=e?t:[],this.autocompleteContainer.empty();var s=new r,a=[],o=function(e,t,i){return new u({label:e,value:t,object:i})};switch(this.customizationStep){case"nav_datasources":c.showOverlayLoader(v.get("custoPanel.attributes.selection.datasources_loading"),this.gridPredicatesContainer),this.isMultiSearchMode=!1;var l=new Promise((e,t)=>{e(p.custoComputeSources())}),d=await l;s.prepareUpdate(),d.forEach(function(e){var t=o(e.label,e.label,e.value);s.addRoot(t),a.push({value:{label:e.label,object:e.value}})}),s.pushUpdate();break;case"nav_predefined_query":c.showOverlayLoader(v.get("custoPanel.attributes.selection.predefinedQuery_loading"),this.gridPredicatesContainer),this.isMultiSearchMode=!1;var h=new Promise((e,t)=>{e(p.custoComputePredefinedQuery())}),m=await h;let e=p.sortAndRemoveDuplicate(m,"title");s.prepareUpdate(),e.forEach(function(e){var t=o(e.title+"  :"+e.abbreviations,e.title,e.id);s.addRoot(t),a.push({value:{label:e.title+"  :"+e.abbreviations,object:e.id}})}),s.pushUpdate();break;case"nav_types":c.showOverlayLoader(v.get("custoPanel.attributes.selection.types_loading"),this.gridPredicatesContainer),"type"===this.customizationMode?this.isMultiSearchMode=!1:this.isMultiSearchMode=!0;const t=this.attributeSelectionForm.selectedDataSource.object;if(Array.isArray(t))this.attributeSelectionForm.availableTypes=await p.custoComputeOtherTypes(t);else{var b=new Promise((e,i)=>{e(p.custoComputeTypes(t))});this.attributeSelectionForm.availableTypes=await b}this.attributeSelectionForm.availableTypes.items=p.sortAndRemoveDuplicate(this.attributeSelectionForm.availableTypes.items,"nlsName"),s.prepareUpdate(),this.attributeSelectionForm.availableTypes.items.forEach(function(e){var t={uri:e.uri,source:e.source},i=o(e.nlsName,e.nlsName,t);s.addRoot(i),a.push({value:{label:e.nlsName,object:t}})}),s.pushUpdate();break;case"nav_extensions":let n;c.showOverlayLoader(v.get("custoPanel.attributes.selection.extensions_loading"),this.gridPredicatesContainer),this.isMultiSearchMode=!0,"type"===this.customizationMode?(this.isMultiSearchMode=!1,n=this.attributeSelectionForm.selectedTypes[0]?this.attributeSelectionForm.selectedTypes[0].object.source:this.attributeSelectionForm.selectedTypes.object.source):n=Array.isArray(this.attributeSelectionForm.selectedDataSource.object)?"other":this.attributeSelectionForm.selectedDataSource.object;var w=new Promise((e,t)=>{e(p.custoComputeExtensions(n,this.attributeSelectionForm.selectedTypes))}),f=await w;let r=[];for(let e in f)for(let t in f[e])r.push(f[e][t]);this.attributeSelectionForm.availableExtensions=p.sortAndRemoveDuplicate(r,"name"),s.prepareUpdate(),this.attributeSelectionForm.availableExtensions.forEach(function(e){var t=o(e.name,e.name,e.value);s.addRoot(t),a.push({value:{label:e.name,object:e.value}})}),s.pushUpdate();break;case"nav_attributes":var y;c.showOverlayLoader(v.get("custoPanel.attributes.selection.attributes_loading"),this.gridPredicatesContainer);var g=!1;this.isMultiSearchMode=!0,"predefinedQuery"===this.customizationMode?(g=!0,y=Array.isArray(this.attributeSelectionForm.selectedPredefinedQuery)?this.attributeSelectionForm.selectedPredefinedQuery:[this.attributeSelectionForm.selectedPredefinedQuery]):(i.is(this.attributeSelectionForm.selectedDataSource)&&i.is(this.attributeSelectionForm.selectedDataSource.label)&&"Others"===this.attributeSelectionForm.selectedDataSource.label&&(this.attributeSelectionForm.selectedTypes.source="Others"),y=this.attributeSelectionForm.selectedTypes);var S=new Promise((e,t)=>{e(p.custoComputeAllPredicates(y,this.attributeSelectionForm.selectedExtensions,g))});this.attributesPromise=await S,this.attributesPromise=p.sortAndRemoveDuplicate(this.attributesPromise,"nlsName"),s.prepareUpdate(),this.attributesPromise.forEach(function(e){var t=o(e.nlsName,e.nlsName,e);s.addRoot(t),a.push({value:{label:e.nlsName,object:e}})}),s.pushUpdate()}var C=new n({elementsTree:s,multiSearchMode:this.isMultiSearchMode,allowFreeInputFlag:!1,filterCB:function(e){s.setFilterModel({label:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:e}}}})}});e&&(C.value=this.isMultiSearchMode?[...new Set(this.currentSelection.map(e=>e.label))]:this.currentSelection[0].label);var z=this._updateAutocomplete({component:C,values:s.getRoots()});z.component.addEventListener("change",function(e){var t=null;i.is(e.dsModel.selectedItems)&&(!i.is(e.dsModel.selectedItems,"array")&&i.is(e.dsModel.selectedItems._options)?t={label:e.dsModel.selectedItems._options.label,object:e.dsModel.selectedItems._options.object}:i.is(e.dsModel.selectedItems,"array")&&(t=[],e.dsModel.selectedItems.forEach(function(e){t.push({label:e._options.label,object:e._options.object})}))),t&&("nav_datasources"===this.customizationStep?this.attributeSelectionForm.selectedDataSource=t:"nav_types"===this.customizationStep?(i.is(t,"array")?this.attributeSelectionForm.selectedTypes=t:this.attributeSelectionForm.selectedTypes=[t],"type"===this.customizationMode&&(this.attributeSelectionForm.selectedPredicates.type={typeObj:t,typePredicates:[]})):"nav_extensions"===this.customizationStep?this.attributeSelectionForm.selectedExtensions=t:"nav_attributes"===this.customizationStep?"general"===this.customizationMode?this.attributeSelectionForm.selectedPredicates.general=t:"type"===this.customizationMode?this.attributeSelectionForm.selectedPredicates.type.typePredicates=t:this.attributeSelectionForm.selectedPredicates.predefinedQuery.predefinedQueryPredicates=t:"nav_predefined_query"===this.customizationStep&&(this.attributeSelectionForm.selectedPredicates.predefinedQuery={predefinedQueryObj:t,predefinedQueryPredicates:[]}),i.is(t,"array")?this.currentSelection=t:this.currentSelection=[t]),i.is(t)||(this.currentSelection=[]),this._buildPredicatesGrid(this.dataGridAttributes,this.currentSelection),this._updateNextStepButton();const s="search-scrollable-multi-autocomplete";e.target.children[0].scrollHeight>e.target.children[0].clientHeight?!e.target.classList.contains(s)&&e.target.classList.add(s):e.target.classList.contains(s)&&e.target.classList.remove(s)}.bind(this)),z.component.inject(this.autocompleteContainer),this.dataGridAttributes=a,this._buildPredicatesGrid(a,e?this.currentSelection:null),this._updateNextStepButton()},_updateAutocomplete:function(e){return"nav_datasources"===this.customizationStep?(e&&(this.attributeSelectionForm.oSourceAutocomplete=e),this.attributeSelectionForm.oSourceAutocomplete):"nav_types"===this.customizationStep?(e&&(this.attributeSelectionForm.oTypeAutocomplete=e),this.attributeSelectionForm.oTypeAutocomplete):"nav_extensions"===this.customizationStep?(e&&(this.attributeSelectionForm.oExtensionAutocomplete=e),this.attributeSelectionForm.oExtensionAutocomplete):"nav_attributes"===this.customizationStep?(e&&(this.attributeSelectionForm.oAttributesAutocomplete=e),this.attributeSelectionForm.oAttributesAutocomplete):"nav_predefined_query"===this.customizationStep?(e&&(this.attributeSelectionForm.oPredefinedQueryAutocomplete=e),this.attributeSelectionForm.oPredefinedQueryAutocomplete):void 0},_buildPredicatesGrid:function(e,t){var s=this,n=[];if(this.gridPredicatesContainer.empty(),e.forEach(function(e){var a=!1;i.is(t,"array")&&t.forEach(function(t){t.label===e.value.label&&(a=!0)}.bind(this)),n.push({Text:e.value.label,Visibility:a,width:"auto",wrap:!1,custoMode:s.customizationMode})}),e){var a=this.gridColumnsTileViews,o=new l,h=new r({dataModelSet:o});h.prepareUpdate();for(var p=0,m=n.length;p<m;p++){var v=n[p],b=u.createTreeNodeDataModel(o,{label:v.Text,grid:v});h.addChild(b)}h.expandAll(),h.pushUpdate(),this.oDataGrid=new d({treeDocument:h,columns:a,layoutOptions:{layoutDensity:"comfortable"},defaultColumnDef:{width:"auto",typeRepresentation:"string"},rowSelection:"none",columnSelection:"none",cellSelection:"none",columnDragEnabledFlag:!1,rowDragEnabledFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1}).inject(this.gridPredicatesContainer),this.oDataGrid.cellSelection="single",this.oDataGrid.rowSelection="single",this.oDataGrid.addEventListener("change",function(e,t){if(t.nodeModel){var i,s=t.nodeModel.getAttributeValue("Text"),n=t.nodeModel.getAttributeValue("Visibility"),a=this._updateAutocomplete(null);if((r=a.values.findIndex(e=>e._options.label===s))>-1){var o=a.values[r];if(this.isMultiSearchMode)if(a.component.selectedItems){if(n)a.component.selectedItems.push(o);else{var r=a.component.selectedItems.findIndex(e=>e._options.label===s);a.component.selectedItems.splice(r,1)}a.component._applySelectedItems()}else a.component.selectedItems=[o];else if(n){a.component.selectedItems=[o];var u=[{label:s}];this._buildPredicatesGrid(this.dataGridAttributes,u),this.currentSelection=[]}else this.currentSelection=[],a.component.selectedItems=[],a.component._applySelectedItems();if("general"===this.customizationMode)if(n)this.currentSelection.push({label:s,custoMode:this.customizationMode,object:a.values[r]._options.object});else{r=this.currentSelection.findIndex(e=>e.label===s);this.currentSelection.splice(r,1)}else if("type"===this.customizationMode)if(n)this.currentSelection.push({label:s,custoMode:this.customizationMode,object:a.values[r]._options.object,type:this.attributeSelectionForm.selectedTypes});else{r=this.currentSelection.findIndex(e=>e.label===s);this.currentSelection.splice(r,1)}else if(n)this.currentSelection.push({label:s,custoMode:this.customizationMode,object:a.values[r]._options.object,query:this.attributeSelectionForm.selectedPredefinedQuery});else{r=this.currentSelection.findIndex(e=>e.label===s);this.currentSelection.splice(r,1)}s&&("nav_datasources"===this.customizationStep?this.attributeSelectionForm.selectedDataSource=this.currentSelection[0]:"nav_types"===this.customizationStep?(this.attributeSelectionForm.selectedTypes=this.currentSelection,"type"===this.customizationMode&&(this.attributeSelectionForm.selectedPredicates.type={typeObj:this.currentSelection[0],typePredicates:[]})):"nav_extensions"===this.customizationStep?this.attributeSelectionForm.selectedExtensions=this.currentSelection:"nav_attributes"===this.customizationStep?"general"===this.customizationMode?(i=this.currentSelection.filter((e,t)=>t===this.currentSelection.findIndex(t=>e.label===t.label)),this.attributeSelectionForm.selectedPredicates.general=i):"type"===this.customizationMode?(i=this.currentSelection.filter((e,t)=>t===this.currentSelection.findIndex(t=>e.label===t.label)),this.attributeSelectionForm.selectedPredicates.type.typePredicates=i):(i=this.currentSelection.filter((e,t)=>t===this.currentSelection.findIndex(t=>e.label===t.label)),this.attributeSelectionForm.selectedPredicates.predefinedQuery.predefinedQueryPredicates=i):"nav_predefined_query"===this.customizationStep&&(this.attributeSelectionForm.selectedPredicates.predefinedQuery={predefinedQueryObj:this.currentSelection[0],predefinedQueryPredicates:[]})),this._updateNextStepButton()}}}.bind(this))}c.hideOverlayLoader(this.gridPredicatesContainer)},render:function(){this._buildAttributeSelectionView()}})});