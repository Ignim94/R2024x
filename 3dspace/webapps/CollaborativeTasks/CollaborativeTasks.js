define("DS/CollaborativeTasks/Views/CollaborativeTasksUtils",["UWA/Core","DS/CoreEvents/ModelEvents","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s){"use strict";var i={getErrorMessageForInvalidCredentials:function(e){var t,i;return e&&401===e.statusCode&&e.error&&-1!==e.error.indexOf("ErrorCode:1501009")&&(i="emxCollaborativeTasks.Error.InvalidCredentials",t=s.get(i)),t},initModelEventsBroker:function(){this.modelEventsBroker=new t},publishModelEvents:function(e,t){this.modelEventsBroker&&this.modelEventsBroker.publish({event:e,data:t})},STATE_CHANGE_MODEL_EVENT:"collaborative-tasks-state-change"};return i}),define("DS/CollaborativeTasks/Views/TasksTableConfig",["UWA/Core","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/TaskModelMixin","DS/Handlebars/Handlebars4","DS/E6WCommonApps/TreeNodeUtil","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Views/ObjectIDPanelUtil","text!DS/CollaborativeTasks/assets/templates/personFieldOnGrid.html.handlebars","text!DS/CollaborativeTasks/assets/templates/contextFieldOnGrid.html.handlebars"],function(e,t,s,i,a,o,n,l,r,c,d){"use strict";var h=function(e){var t=o.get(e);return t===e&&(t=n.get(e)),t},u=i.compile(c),p=i.compile(d),m="references",g="deliverables",C={attachment_or_deliverable:"attachmentOrDeliverableIconContent",context:"contextContent",project:"projectContent",description:"descriptionContent",assignee:"taskAssigneesContent",owner:"taskOwnerContent"},T=function(e,t){return(e=e?new Date(e):new Date("10/10/200"))-(t=t?new Date(t):new Date("10/10/200"))},f={[a.COLUMN_DATA_INDICES.context]:"contextForSort",[a.COLUMN_DATA_INDICES.assignees]:"assigneesForSort",[a.COLUMN_DATA_INDICES.owner]:"ownerForSort",[a.COLUMN_DATA_INDICES.project]:"parentForSort"},v=function(e,t,s){var i=this.reuseCellContent(C.attachment_or_deliverable);i.empty(),e.getAttributeValue("correspondingModel").get(s).length?t._setReusableContent(i):t._setReusableContent(null)},S=function(e){if(!e)return 0;var t=e.indexOf(h("E6WCommonApps.Label.Hours"));return-1!==t?Number(e.substring(0,t))/8:Number(e.substring(0,e.indexOf(h("E6WCommonApps.Label.Days"))))},b=function(e,t){var s="",i=e.rdfModel.get(t)&&e.rdfModel.get(t).getModels()||e.getAttributeValue(f[t]);return i?(Array.isArray(i)&&i.length>=1?i.forEach(e=>{s=s+" "+(e.name||e.get&&e.get("name"))}):s=s+" "+(i.name||i.get&&i.get("name")),s):s},_={[h("E6WCommonApps.Label.Low")]:1,[h("E6WCommonApps.Label.Medium")]:2,[h("E6WCommonApps.Label.High")]:3,[h("E6WCommonApps.Label.Urgent")]:4},D=[{text:h("E6WCommonApps.Label.Title"),dataIndex:a.COLUMN_DATA_INDICES.title,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,className:"grid-title-cell",getCellSemantics:function(e){return{icon:e.nodeModel.getAttributeValue("icon")}}},r.getObjectIDFieldForTableConfig(!1),a.descriptionColumn,{text:h("emxCollaborativeTasks.Label.Contributing"),dataIndex:a.COLUMN_DATA_INDICES.context,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,customContentId:C.context,onCellRequest:function(e){(function(e,t){var s=e.getAttributeValue("correspondingModel"),i=this.reuseCellContent(C.context);i.empty();var o={};s.isRDFTask()||(o=s.dataForRendering().context,i.setHTML(p({lData:o}))),t._setReusableContent(i),e.setAttribute(f[a.COLUMN_DATA_INDICES.context],o)}).call(this,e.nodeModel,e.cellView)},getCellValueForSort:b},{text:h("E6WCommonApps.Label.Parent"),dataIndex:a.COLUMN_DATA_INDICES.project,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,customContentId:C.project,onCellRequest:function(e){(function(e,t){var s,i=e.getAttributeValue("correspondingModel"),o=this.reuseCellContent(C.project);o.empty(),s=i.isRDFTask()?i.getParent()&&i.getParent().dataForRendering({level:0,attributes:["title","image"]}):i.dataForRendering().DPMProject,o.setHTML(p({lData:s})),t._setReusableContent(o);var n=e.getAttributeValue(f[a.COLUMN_DATA_INDICES.project]);n&&n.isNoAccessModel&&s.isNoAccessModel||e.setAttribute(f[a.COLUMN_DATA_INDICES.project],s)}).call(this,e.nodeModel,e.cellView)},getCellValueForSort:b},{text:h("E6WCommonApps.Label.RouteContent"),dataIndex:a.COLUMN_DATA_INDICES.routeContent,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{text:h("E6WCommonApps.Label.RouteTaskAction"),dataIndex:a.COLUMN_DATA_INDICES.routeTaskAction,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{text:h("E6WCommonApps.Label.RouteTaskInstructions"),dataIndex:a.COLUMN_DATA_INDICES.routeTaskInstructions,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{text:h("E6WCommonApps.Label.MaturityState"),dataIndex:a.COLUMN_DATA_INDICES.maturity,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,getCellClassName:function(e){return a.getClassForState(e.cellModel)}},{text:h("E6WCommonApps.Label.Priority"),dataIndex:a.COLUMN_DATA_INDICES.priority,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,getCellSemantics:function(e){var t={icon:"fonticon fonticon-medium priority-for-grid"};return e.cellModel===h("E6WCommonApps.Label.Low")?t.icon="fonticon fonticon-low":e.cellModel===h("E6WCommonApps.Label.High")?t.icon="fonticon fonticon-high":e.cellModel===h("E6WCommonApps.Label.Urgent")&&(t.icon="fonticon fonticon-alert"),t},getCellValueForSort:function(e,t){var s=e.getAttributeValue(t);return _[s]?_[s]:0}},{text:h("E6WCommonApps.Label.Percent"),dataIndex:a.COLUMN_DATA_INDICES.percent,typeRepresentation:"number",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{text:h("E6WCommonApps.Label.PlannedStart"),dataIndex:a.COLUMN_DATA_INDICES.estimatedStartDate,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:T},{text:h("E6WCommonApps.Label.PlannedEnd"),dataIndex:a.COLUMN_DATA_INDICES.estimatedFinishDate,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:T},{text:h("E6WCommonApps.Label.Duration"),dataIndex:a.COLUMN_DATA_INDICES.estimatedDuration,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:function(e,t){return S(e)-S(t)}},{text:h("E6WCommonApps.Label.Attachments"),dataIndex:a.COLUMN_DATA_INDICES.attachments,typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,customContentId:C.attachment_or_deliverable,onCellRequest:function(e){v.call(this,e.nodeModel,e.cellView,m)}},{text:h("E6WCommonApps.Label.Deliverables"),dataIndex:a.COLUMN_DATA_INDICES.deliverables,typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,customContentId:C.attachment_or_deliverable,onCellRequest:function(e){v.call(this,e.nodeModel,e.cellView,g)}},{text:h("E6WCommonApps.Label.Community"),dataIndex:a.COLUMN_DATA_INDICES.community,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0},{text:h("E6WCommonApps.Label.ActualStart"),dataIndex:a.COLUMN_DATA_INDICES.actualStartDate,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:T},{text:h("E6WCommonApps.Label.ActualEnd"),dataIndex:a.COLUMN_DATA_INDICES.actualFinishDate,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:T},{text:h("E6WCommonApps.Label.Created"),dataIndex:a.COLUMN_DATA_INDICES.created,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:T},{text:h("E6WCommonApps.Label.LastUpdated"),dataIndex:a.COLUMN_DATA_INDICES.modified,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:T},{text:h("E6WCommonApps.Label.Assignees"),dataIndex:a.COLUMN_DATA_INDICES.assignees,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,customContentId:C.assignee,onCellRequest:function(e){(function(e,t){var i=e.getAttributeValue("correspondingModel"),o=this.reuseCellContent(C.assignee);o.empty();var n=i&&i.dataForRendering({attributes:[s.ASSIGNEESATTR]}).assignees;n&&n.length>=1?o.setHTML(u({persons:n,multiple:1!==n.length})):n&&0===n.length&&o.setHTML(u({noPerson:!0})),t._setReusableContent(o),e.setAttribute(f[a.COLUMN_DATA_INDICES.assignees],n)}).call(this,e.nodeModel,e.cellView)},getCellValueForSort:b},{text:h("E6WCommonApps.Label.Owner"),dataIndex:a.COLUMN_DATA_INDICES.owner,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,customContentId:C.owner,onCellRequest:function(e){(function(e,t){var i=e.getAttributeValue("correspondingModel"),o=this.reuseCellContent(C.owner);o.empty();var n,l=i.dataForRendering({attributes:[s.OWNERATTR]}).ownerInfo;n=l?{persons:Array.isArray(l)?l:[l],multiple:!1}:{noPerson:!0},o.setHTML(u(n)),t._setReusableContent(o),e.setAttribute(f[a.COLUMN_DATA_INDICES.owner],Array.isArray(l)?l:[l])}).call(this,e.nodeModel,e.cellView)},getCellValueForSort:b}];return window.widget&&window.widget.getValue("appId")===l.APP_3DPLAN&&(D.splice(5,3),D.splice(3,1)),{columns:D,reusableComponentIDs:C,lengthOfEachCharacter:10}}),define("DS/CollaborativeTasks/Models/UserGroupModel",["DS/Foundation2/Models/ReferenceModel","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,s,i,a,o){"use strict";return e.extend({_uwaClassName:"UserGroupModel",source:"usersgroup",serviceId:"usersgroup",idAttribute:"id",idAttributeForFederatedSearch:"[ds6w:resourceUid]",optimizeSearchQuery:!0,getIdForFederatedSearch:function(){return i.jsonURIToSparqlURI(this.get("dataelements")&&this.get("dataelements").groupURI||this.get("groupURI")||this.id)},getObjectType:function(){return"Group Proxy"},dataForRendering:function(){return this._parent.apply(this,arguments)},setup:function(){let e=this._rowObjects&&this._rowObjects.length&&"assignees"===this._rowObjects[0]._relationship;return t.isOnPremise()||e||this.fetch(),this.setViewAccess(Boolean(this.get("Title"))),this._parent.apply(this,arguments)},setViewAccess:function(e){this._hasViewAccess=e},canShowProperties:function(){return!1},sync:function(e,s,i){if(t.isOnPremise())return this._parent.apply(this,arguments);var o=this;if("read"===e){var n=this.getIdForFederatedSearch(),l=[n='"'+n+'"'],r={query:l,nresults:l.length+10,sources:[this.source],select_predicate:["ds6w:label","ds6w:type","type_icon_url","preview_url","resourceid","ds6w:resourceUid"],searchQueryPrefix:this.idAttributeForFederatedSearch,onComplete:function(){var e=arguments[0],t=e.results&&e.results.length&&e.results[0].attributes&&e.results[0].attributes.find(e=>"ds6w:label"===e.name).value,s=e.results&&e.results.length&&e.results[0].attributes&&e.results[0].attributes.find(e=>"resourceid"===e.name).value;o.set("Title",t),s&&o.set("groupURI",s),t||o.set("type",void 0),o.setViewAccess(Boolean(o.get("Title"))),o.dispatchEvent("onFetchDone",arguments)},onFailure:function(){var e=i.onFailure;e&&e.apply(this,arguments),o.set("type",void 0),o.set("Title",void 0),o.setViewAccess(Boolean(o.get("Title"))),o.dispatchEvent("onFetchDone")}};a.sendRequestWithDelimiter(r)}},hasViewAccess:function(){return this._hasViewAccess},get:function(e){var s=this._parent.apply(this,arguments);switch(e){case"name":return this.hasViewAccess()?this.get("Title")||s:o.get("E6WCommonUI.Label.PrivateGroup");case"image":try{return this.hasViewAccess()?t.getServiceUrl("usersgroup")+"/3drdfpersist/common/images/T_dsaccess_Group.png":require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png")}catch(e){return s}}return s}})}),define("DS/CollaborativeTasks/Views/TasksViewSelectionMixin",[],function(){"use strict";return{enableMultiSelectMode:function(){this._multiSelectMode||(this._multiSelectMode=!0),this._multiSelectButton.toggleClassName("fonticon-select-on",!0),this._multiSelectButton.toggleClassName("fonticon-select-off",!1)},updateSingleCardSelection:function(e){this._selectedView=e,this._selectedChildView=e.getColumn(),this.handleTagCollect(e)},addToMultiCardSelection:function(e){(this._selectedModels.indexOf(e.model)>-1||this._selectedCards.indexOf(e)>-1)&&console.error("Adding card to selection which is already added"),this._selectedModels.push(e.model),this._selectedCards.push(e)},removeFromMultiCardSelection:function(e){-1===this._selectedModels.indexOf(e.model)&&console.error("Removing card from selection which is not selectd");var t=this._selectedModels.indexOf(e.model);if(this._selectedModels.splice(t,1),-1!==this._selectedCards.indexOf(e)){var s=this._selectedCards.indexOf(e);this._selectedCards.splice(s,1)}},clearSelectedCards:function(){this._selectedView?this.clearSingleCardSelection():this.clearMultiCardSelection()},clearSingleCardSelection:function(){this._selectedView=void 0,this._selectedChildView=void 0,this.handleTagCollect()},clearMultiCardSelection:function(){var e=this;this._columnViews.forEach(function(t){t._childrenViews?t._childrenViews.forEach(function(e){e.isSelected()&&e.multiUnselect()}):e.unSelectCardCheckBox(t)}),this._selectedModels.forEach(function(e){e._isChecked=!1}),this._selectedModels=[],this._selectedCards=[],this._selectedCardsCount.innerHTML="",this.handleTagCollect()},multiSelectCardActual:function(e,t){var s=this;e.forEach(function(e){s.multiSelectCardSimple(e)}),t&&this.isMultiSelectionValid(e[0])&&(1===this._selectedModels.length?this.detailsPanelManager.openDetailsPanel(1):this.detailsPanelManager.openDetailsPanel(1,!0)),this._selectedModels.length>0?this._selectedCardsCount.innerHTML=this._selectedModels.length:this._selectedCardsCount.innerHTML="",this.handleTagCollect()},multiSelectCardBasic:function(e){this.enableMultiSelectMode(),e.multiSelect()},multiSelectCardSimple:function(e){this.addToMultiCardSelection(e),this.multiSelectCardBasic(e)},openCloseMultiSelectDetailsPanel:function(){this.detailsPanelManager.getMultiDetailsPanel().isOpen()?this.cancelDetailsPanel(!1):this.detailsPanelManager.getDetailsPanel().isOpen()?this.cancelDetailsPanel(!1):this.isMultiSelectionValid()&&(1===this._selectedModels.length?this.detailsPanelManager.openDetailsPanel(1):this.detailsPanelManager.openDetailsPanel(1,!0))},multiSelectCardFull:function(e,t){var s=this;let i=this.detailsPanelManager.multiDetailsPanelIsOpen()||this.detailsPanelManager.singleDetailsPanelIsOpen()||t;this.cancelDetailsPanel(!1,{onCancel:function(){s._selectedView&&s.singleUnselectCardActual(s._selectedView),s.multiSelectCardActual(e,i)}})},singleSelectCardActual:function(e){this.updateSingleCardSelection(e),e.onSelect(),this.detailsPanelManager.openDetailsPanel(this._childrenViews.indexOf(this._selectedChildView)+1),this.handleTagCollect(e)},singleUnselectCardActual:function(e){this.clearSingleCardSelection(),e.isMultiSelected()||this.singleUnselectCardSimple(e)},singleUnselectCardSimple:function(e){e.onUnselect()},multiUnselectCardActual:function(e,t){var s=this;1===e.length?(e[0].multiUnselect(),this.removeFromMultiCardSelection(e[0]),this._selectedModels.length>0&&t&&(1===this._selectedModels.length?this.detailsPanelManager.openDetailsPanel(1):this.detailsPanelManager.openDetailsPanel(1,!0))):e.forEach(function(e){s.removeFromMultiCardSelection(e),e.multiUnselect()}),this._selectedModels.length>0?this._selectedCardsCount.innerHTML=this._selectedModels.length:this._selectedCardsCount.innerHTML="",this.handleTagCollect()},multiUnselectCardFull:function(e){let t=this.detailsPanelManager.multiDetailsPanelIsOpen();this.cancelDetailsPanel(!1,{onCancel:this.multiUnselectCardActual.bind(this,e,t)})},singleSelectCardFull:function(e){var t=this;this.cancelDetailsPanel(!1,{onCancel:function(){t._selectedView&&t.singleUnselectCardActual(t._selectedView),t.singleSelectCardActual(e)}})},singleUnselectCardFull:function(e){this.cancelDetailsPanel(!1,{onCancel:this.singleUnselectCardActual.bind(this,e)})},cancelDetailsPanelAndUnselectAllBeforeAction:function(e){var t=this;this.cancelDetailsPanel(!1,{onCancel:function(){t.clearMultiCardSelection(),e()}})}}}),define("DS/CollaborativeTasks/Views/CreateTaskElementConfig",["DS/Foundation/WidgetUwaUtils","DS/Foundation/WidgetAPIs","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonApps/ScheduleConstants","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonApps/XTaskScope","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s,i,a,o,n,l){"use strict";var r=function(e){return l.get(e)};return{getConfig:function(l){var c=[],d=0===s.getUsersContentRepositories().length,h=e.getContext()===t.TSK_PRIVATE_SPACE,u=d&&!h;c.push({readWrite:!0,name:i.TITLE_ATTR,type:"text",label:r("emxCollaborativeTasks.Label.Title"),maxLength:128,required:!0,validate:!0,removeCarriageReturns:!0});var p=o.getObjectData(),m=!1;if(o.isAgileWorkContext()&&(m=o.isAgileWorkContext()&&!p.isSwym),l[i.TASK_TYPE]!==i.STANDALONE_TASK&&l[i.TASK_TYPE]!==i.SIMPLE_TASK||u||m){let e=[],t={actualValue:l[i.TASK_TYPE],displayValue:r("emxCollaborativeTasks.Label.StandaloneTask"),icon:require.toUrl("DS/E6WCommonApps/assets/img/I_Project-Planning-Task_22.png")};t.actualValue===i.SIMPLE_TASK?(t.displayValue=r("emxCollaborativeTasks.Label.SimpleTask"),t.helperText=r("emxCollaborativeTasks.Label.SimpleTaskHelperText"),t.icon=require.toUrl("DS/E6WCommonApps/assets/img/I_Simple-Task_22.png")):t.actualValue===i.DPM_TASK?(t.displayValue=r("emxCollaborativeTasks.Label.SimpleTask"),t.helperText=r("emxCollaborativeTasks.Label.SimpleTaskHelperText"),t.icon=require.toUrl("DS/E6WCommonApps/assets/img/I_Project-Task_22.png")):t.actualValue===i.XPP_TASK&&(t.displayValue=r("emxCollaborativeTasks.Label.ProjectPlanningTask"),t.helperText=r("emxCollaborativeTasks.Label.StandaloneTaskHelperText"),t.icon=require.toUrl("DS/E6WCommonApps/assets/img/I_Project-Planning-Task_22.png")),e.push(t),c.push({readWrite:!1,name:i.TASK_TYPE,type:"select",values:e})}else{var g={name:i.TASK_TYPE,values:function(){let e=[];return n.getServiceUrl("3dplan",!0)&&e.push({actualValue:i.STANDALONE_TASK,displayValue:r("emxCollaborativeTasks.Label.StandaloneTask"),helperText:r("emxCollaborativeTasks.Label.StandaloneTaskHelperText"),icon:require.toUrl("DS/E6WCommonApps/assets/img/I_ProjectPlanningTask_22.png")}),e.push({actualValue:i.SIMPLE_TASK,displayValue:r("emxCollaborativeTasks.Label.SimpleTask"),helperText:r("emxCollaborativeTasks.Label.SimpleTaskHelperText"),icon:require.toUrl("DS/E6WCommonApps/assets/img/I_SimpleTask_22.png")}),e}()};n.getServiceUrl("3dplan",!0)?(g.readWrite=!0,g.type="toggle",g.toggleType="radio"):(g.readWrite=!1,g.type="select"),c.push(g)}return l[i.TASK_TYPE]!==i.STANDALONE_TASK&&l[i.TASK_TYPE]!==i.XPP_TASK&&(l[i.TASK_TYPE]===i.DPM_TASK||l.taskCollabSpace&&"string"==typeof l.taskCollabSpace?c.push({readWrite:!1,name:i.TASK_COLLAB_SPACE,type:"text",label:r("emxCollaborativeTasks.Label.CollaborativeSpace")}):c.push({readWrite:!0,name:i.TASK_COLLAB_SPACE,type:"select",label:r("emxCollaborativeTasks.Label.CollaborativeSpace"),values:l.taskCollabSpace,required:!0,validate:!0})),l[i.TASK_TYPE]!==i.STANDALONE_TASK&&l[i.TASK_TYPE]!==i.XPP_TASK&&(l[i.TASK_TYPE]===i.DPM_TASK?c.push({readWrite:!1,name:i.TASK_ORGANIZATION,type:"text",label:r("emxCollaborativeTasks.Label.Organization")}):l.taskOrganization&&l.taskOrganization.length>1&&c.push({readWrite:!0,name:i.TASK_ORGANIZATION,type:"select",label:r("emxCollaborativeTasks.Label.Organization"),values:l.taskOrganization,required:!0,validate:!0})),l[i.TASK_TYPE]===i.SIMPLE_TASK||l[i.TASK_TYPE]===i.DPM_TASK?c.push({readWrite:!0,name:i.DESCRIPTION_ATTR,label:r("emxCollaborativeTasks.Label.Description"),type:"text"}):c.push({readWrite:!0,name:i.DESCRIPTION_ATTR,titleAttribute:i.TITLE_ATTR,richTextField:"dsplan:RichTextField",label:r("emxCollaborativeTasks.Label.Description"),type:"RichText",customView:a,numberOfDisplayLines:3,numberOfEditableLines:3}),c}}}),define("DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel",["UWA/Core","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/SmartSchedulerUtils"],function(e,t,s,i,a,o){"use strict";return t.extend({_uwaClassName:"RDFTasksWorkscopeModel",getTaskCollectionForFilter:function(s,i){var a=this.getCollectionAttribute(t.TASK_RELATION_ATTR,{mask:"dsplan:MVMask.Task.Complex",detailsMask:"dsplan:MVMask.Task.Complex"});a.setIdForCreateChild(this.id+"/dsxplan:hasTask");var o=e.clone(i||{},!1),n=this.getTaskFetchOptions(s);return e.merge(o,n),a.fetch(o),a},getTaskFetchOptions:function(e){var t={};t.url=i.expandUrl(s.GET_FIRST_LEVEL_LEAF_TASKS_URL);var a=o.getCompletedTaskFilter(),n=[{versionURI:this.id,filter:e,fromCompletionDate:a}];return t.data=JSON.stringify(n),t.headers={"Content-Type":"application/json"},t.method="POST",t},hasFetchedAttribute:function(e){return"dsxplan:hasTask"===e?this._collections[e]:this._parent.apply(this,arguments)}})}),define("DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig",["DS/Foundation2/FoundationV2Data","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/Models/IteropTaskModel","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonApps/Views/PriorityView","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m){"use strict";var g=function(t){var s=e.getWidgetConstant.apply(this,arguments);return s===t&&(s=p.get(t)),s},C={config:function(e){return[{name:"title",label:g("E6WCommonApps.Label.Title"),type:"text",maxLength:128},{name:"description",label:g("E6WCommonApps.Label.Description"),type:"RichText",customView:h},{name:"processName",label:g("emxCollaborativeTasks.Label.TaskProcess"),type:"text"},{name:"processIdentificator",label:g("emxCollaborativeTasks.Label.TaskProcessIdentifier"),type:"text"},{name:"priority",label:g("E6WCommonApps.Label.Priority"),customView:u,priorityMapping:{Low:"dsxplan:Low",Medium:"dsxplan:Medium",High:"dsxplan:High",Urgent:"dsxplan:Urgent"}},{name:"date",label:g("E6WCommonApps.Label.Created"),type:"date"}]}};return C}),define("DS/CollaborativeTasks/Collections/MergingSplitCollection",["UWA/Core","DS/E6WCommonUI/Collections/MergingCollection"],function(e,t){"use strict";var s=t.extend({_uwaClassName:"MergingSplitCollection",getSaveAttributes:function(){return this._subCollections[0].getSaveAttributes.apply(this,arguments)},dataForRendering:function(e){var t=this._subCollections[0],s=t.dataForRendering.apply(t,arguments);return s.filteredCount=this._subCollections.reduce((t,s)=>t+s.dataForRendering(e).filteredCount,0),s},cancelCurrentRequest:Function.prototype});return Object.defineProperty(s.prototype,"extid",{get:function(){return this._subCollections[0].extid}}),Object.defineProperty(s.prototype,"_valueForFiltering",{get:function(){return this._subCollections[0]._valueForFiltering}}),Object.defineProperty(s.prototype,"_filterAttr",{get:function(){return this._subCollections[0]._filterAttr}}),s}),define("DS/CollaborativeTasks/XTaskTagUtils",[],function(){"use strict";var e={setTagColors:function(t){e.colorData={values:{}},e.colorData.attr=t.tagColors[0].predicate.split(":").pop(),t.tagColors.forEach(function(t){e.colorData.values[t.object]=t.color})},unsetTagColors:function(){e.colorData=void 0},hasTagColors:function(){return Boolean(e.colorData)},getColorForModel:function(t){var s;if(e.hasTagColors()){var i=t.get("_tagData");if(i){var a=i[e.colorData.attr];s=e.colorData.values[a]}}return s}};return e}),define("DS/CollaborativeTasks/Views/CustomizedStartStopView",["UWA/Core","DS/E6WCommonUI/Views/StartStopView"],function(e,t){"use strict";return t.extend({_uwaClassName:"E6WCommonUIStartStopView",template:function(){var e=arguments[0].data;return e&&this.setEditFlagOnFields(e),this._parent.apply(this,arguments)},_clearValidationErrors:function(){this._parent.apply(this,arguments);var e=this.container.getElements(".has-error");if(e.length>0)for(var t=0;t<e.length;t++)e[t].toggleClassName("has-error",!1)}})}),define("DS/CollaborativeTasks/Models/TaskModel",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/Foundation2/Models/FoundationBaseModel","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/Collections/FoundationBaseCollection","DS/E6WCommonUI/UIHelper","DS/TreeModel/TreeNodeModel","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/XTaskScope","DS/Foundation2/Collections/ProxyFoundationBaseCollection","DS/CollaborativeTasks/Models/UserGroupModel","DS/E6WCommonApps/TreeNodeUtil","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m){"use strict";var g=function(e){var s=m.get(e);return s===e&&(s=t.getWidgetConstant.apply(this,arguments)),s},C={"To Do":"Assign","In Progress":"Active",Done:"Complete"},T={Create:"To Do",Assign:"To Do",Active:"In Progress",Review:"In Progress",Complete:"Done"},f=i.extend({}),v=null;f.typeAheadCallback=function(e,s,i){return null!==v&&(v.cancel(),v=null),v=t.ajaxRequest({url:"/resources/v2/e6w/service/PersonSearch?searchStr="+s+"*",type:"get",dataType:"json",callback:function(e){var t=[];if(v=null,e.success&&e.data&&e.data.length)for(var s=e.data.length,a=0;a<s;a++){var n=e.data[a];if(n.dataelements){var l=n.dataelements.firstname||"",r=n.dataelements.lastname||"",c=n.dataelements.name||"";t.push({value:n.id,label:l+" "+r,image:o.userPictureURL(c)})}}i(t)},headers:{"content-type":"application/json"}})},f.get=function(e){var t=this._parent.apply(this,arguments);switch(e){case"dsaccess:accountName":return!t&&this.get("name")}return t};var S=function(e,t){switch(e.type){case"Group":case"Group Proxy":return new h(e,t);default:return new f(e,t)}};S.prototype.idAttribute="id";var b=a.childCollection.extend({}),_=s.extend({ASSIGNEESATTR:"assignees",_relations:[{key:"assignees",collectionType:b,serviceName:"ObjectInfo",relatedModel:S},{key:"originatorInfo",relatedModel:f,collectionType:b,serviceName:"ObjectInfo",isCardinalityOne:!0},{key:"candidateAssignees",relatedModel:S,collectionType:b,serviceName:"ObjectInfo"},{key:"ownerInfo",relatedModel:f,collectionType:b,serviceName:"ObjectInfo",isCardinalityOne:!0},{key:p.COOWNERATTR,relatedModel:f,collectionType:b,serviceName:"ObjectInfo"},{key:"references",serviceName:"ObjectInfo",collectionType:d},{key:"scopes",serviceName:"ObjectInfo",relatedModel:i,isCardinalityOne:!0},{key:"contents",serviceName:"ObjectInfo",relatedModel:i},{key:"deliverables",serviceName:"ObjectInfo",collectionType:d},{key:"referencedSimulations",serviceName:"ObjectInfo",collectionType:d},{key:"dependenciesPredecessors",serviceName:"ObjectInfo",relatedModel:i},{key:"DPMProject",serviceName:"ObjectInfo",relatedModel:i,isCardinalityOne:!0},{key:"route",serviceName:"ObjectInfo",relatedModel:i,isCardinalityOne:!0},{key:"dependenciesSuccessors",serviceName:"ObjectInfo",relatedModel:i},{key:"predecessors",relatedModel:i},{key:"successors",relatedModel:i}],_uwaClassName:"TaskModel",addAssigneesByName:function(e){var t=e.map(function(e){return{image:o.userPictureURL(e)}});return this.addObjects(e,this.getMappedAttribute(this.ASSIGNEESATTR),"name",{otherObjectAttributes:t})},getTreeNodeModel:function(){if(this._treeNodeModel)this._treeNodeModel.show();else{var e=this.createNodeData();this._treeNodeModel=new n({label:e.title,grid:e}),u.addListenersOnTreeNode(this._treeNodeModel)}return this._treeNodeModel},assignToSelf:function(t){var s=e.clone(t||{},!1),i=this;this.addAssigneesByName([window.enoviaServer.user]);let a={patch:!0};s.multiEdit?(s.isRDF?a.ajax=s.batchGenerator&&s.batchGenerator.ajax:a.delayedSave=!0,a.onComplete=function(){i.dispatchEvent("onChange:"+i.ASSIGNEESATTR)}):(a.onComplete=function(){i.dispatchEvent("onChange:"+i.ASSIGNEESATTR);var e=g("emxCollaborativeTasks.Label.SuccessfullyAssignedToSelf");o.displaySuccess(e)},a.onFailure=function(){var e=g("emxCollaborativeTasks.Error.FailAssignToSelf");o.displayError(e)}),this.save(null,a)},_getValidationOptions:function(e){var t="false"!==g("emxComponents.Routes.ShowCommentsForTaskApproval").toLowerCase().trim(),s=t&&"false"!==g("emxComponents.Routes.EnforceAssigneeApprovalComments").toLowerCase().trim(),i="false"!==g("emxComponents.Routes.EnforceOwnerReviewComments").toLowerCase().trim();return{needsReview:e.needsReview,newState:e.state,currentState:this.get("state"),showComments:t,enforceAssigneeApprovalComments:s,enforceOwnerReviewComments:i}},_validateNeedsReview:function(e,t,s){"Review"!==s.currentState&&"Complete"!==s.currentState&&"Complete"===s.newState&&"Yes"===s.needsReview&&t.fields.push("needsReview")},validate:function(e){var t,s={fields:[]},i=this._getValidationOptions(e);return this._validateNeedsReview(e,s,i),s.fields.length&&(t=s),t},get:function(e){switch(e){case"endDate":return this.get("dueDate");case"canEdit":return!this.isComplete()&&"TRUE"===this.get("modifyAccess");case"stateForDisplay":return this.getStateForDisplayValue();case this.DUEDATECATEGORY:return this.dueDateCategory(this.get(this.DUEDATEATTR));case p.DESCRIPTION_ATTR:return this.get("description")||this.get("routeTaskInstructions");case"card_icon":return this.getFonticonValue(!0);case"tagsData":return this.userTagsData}return this._parent.apply(this,arguments)},getFonticonValue:function(e){var t,s=this.getObjectType();return t=o.isGate(s)?"I_Gate":o.isMilestone(s)?"I_Milestone":o.isPhaseTask(s)?"I_Phase":this.isIteropTask()?"I_BusinessProcessTask":this.isProjectTask()?"I_ProjectTask":"I_SimpleTask",require.toUrl("DS/E6WCommonApps/assets/img/"+t+(e?"_16.png":"_22.png"))},getStateForDisplayValue:function(){return T[this.get("state")]},getFieldDef:function(e){var t=this.getInMemoryData(),s=t&&t.getAllFields();return(s=s||{})[e]},getDeliverables:function(){return this.get("deliverables")&&this.get("deliverables")},getMaturityState:function(){return this.get("state")},getContext:function(){return this.get(p.SCOPEATTR)},getProject:function(){return this.get(p.DPMPROJECTATTR)},createNodeData:function(){var e={title:this.get("title"),description:u.getDisplayLabelForDescription(this.get("description")),context:this.getContext(),project:this.getProject(),maturity:u.getDisplayLabelForState(this.getMaturityState()),percent:u.getDisplayLabelForPercent(this),estimatedFinishDate:this.get("dueDate"),estimatedDuration:u.getDisplayLabelForDuration(this),attachments:this.get("references"),deliverables:this.getDeliverables(),estimatedStartDate:this.get("estimatedStartDate"),actualStartDate:this.get("actualStartDate"),actualFinishDate:this.get("actualFinishDate"),created:this.get("originated"),modified:this.get("modified"),assignees:this.get("assignees"),owner:this.get("owner"),correspondingModel:this};return e.icon=this.getFonticonValue(),e},set:function(){var t=o.setHelper.apply(this,arguments),s=e.clone(t.attrs||{},!1),i=t.options;if(s){if(s.hasOwnProperty("stateForDisplay")){var a=s.stateForDisplay;delete s.stateForDisplay,s.state=C[a]}if(s.hasOwnProperty(this.DUEDATECATEGORY)){var n=s[this.DUEDATECATEGORY];delete s[this.DUEDATECATEGORY],this.isProjectTask()&&"NO_DATE"===n||(s[this.DUEDATEATTR]=this.dueDateCategory2DueDate(n))}return s.hasOwnProperty("tagsData")&&(this.userTagsData=s.tagsData,delete s.tagsData,this.dispatchEvent("onChange:tagsData")),this._parent(s,i)}return this._parent.apply(this,arguments)},toJSON:function(e){var t=this._parent.apply(this,arguments);return e&&e.onlyUpdated&&!e.dataForRendering&&delete t.dueDateCategory,e&&e.dataForRendering&&(t[this.DUEDATECATEGORY]=this.get(this.DUEDATECATEGORY),t.stateForDisplay=this.get("stateForDisplay"),t.card_icon=this.get("card_icon"),t.userTagsData=this.userTagsData),t.percentComplete&&(t.percentComplete=parseInt(t.percentComplete).toString()),t},setup:function(){this.nbInFlightRequests=0,this.listenTo(this,"onChange:DPMProject",function(){this.adjustDuration(),this._filterDatabyScope()}),this.listenTo(this,"onChange:scopes",function(){this._filterDatabyScope()}),this.listenTo(this,"onChange:assignees",function(){this._filterDatabyScope()}),this.listenTo(this,"onChange:candidateAssignees",function(){this._filterDatabyScope()}),this.listenTo(this,"onChange:"+p.COOWNERATTR,function(){this._filterDatabyScope()}),this.listenTo(this,"onChange:ownerInfo",function(){this._filterDatabyScope()}),this.listenTo(this,"onChange:"+this.DUEDATEATTR,function(e,t,s){s.silent||e.dispatchEvent("onChange:"+this.DUEDATECATEGORY,arguments)}),this.listenTo(this,"onChange:state",function(e,t,s){var i=T[e.previousAttributes().state],a=T[t];i===a||s.silent||e.dispatchEvent("onChange:stateForDisplay",[e,a,s])}),this.collection&&this.listenTo(this.collection,"onComplete",this._filterDatabyScope),this._parent.apply(this,arguments)},dataForRendering:function(){var e=this._parent.apply(this,arguments);return this.isComplete()?e.date=e.actualFinishDate:e.date=e.dueDate,e.context=e.scopes&&e.scopes[0],e.DPMProject=e.DPMProject&&e.DPMProject[0],e.canEdit=this.get("canEdit"),e},getPredecessors:function(){return this.get("predecessors")},getSuccessors:function(){return this.get("successors")},adjustDuration:function(){var t=this.get("estimatedDuration")||0;e.is(t,"string")&&(t=parseInt(t,10));var s=0;!this.isDPMMilestoneGate()&&this.isProjectTask()&&(s=1),t>=s||this.set("estimatedDuration",s)},isDPMMilestoneGate:function(){var e=this.get("dsxplan:jsType")||this.get("type");return o.isMilestone(e)||o.isGate(e)},isProjectTask:function(){var e=!1,t=this.get("hasProject");if(t&&"TRUE"===t.toUpperCase())e=!0;else{var s=this.get("DPMProject");e=Boolean(s&&s.length)}return e},isRouteTask:function(){return!1},isRDFTask:function(){return!1},isIteropTask:function(){return!1},hasChangeSOVAccess:function(){return"TRUE"===this.get("changeSOVAccess")},subscriptionsEnabled:function(){var e=t.getWidgetConstant("ENABLE_SUBSCRIPTIONS");return!this.isProjectTask()&&("true"===e||"TRUE"===e)},addObjects:function(t,s,i,a){var n,l,r=e.clone(a||{},!1),c=!1;if(r.values&&"assignees"===s)for(var d=r.values.length,h=0;h<d;h++)n=!1,l=r.values[h].get("name"),(n=o._alreadyHasObjectInRelatedData(this,s,l))&&(c=!0,o.displayAlreadyAttachedErrorMessage(this.get("title"),n));else for(var u=t.length,p=0;p<u;p++)n=!1,l=t[p],(n=o._alreadyHasObjectInRelatedData(this,s,l))&&(c=!0,o.displayAlreadyAttachedErrorMessage(this.get("title"),n,s));return c?{}:this._parent.apply(this,arguments)},_belongsInCurrentScope:function(e,t){var s;if(!(s=-1!==this.collection.projectTypes().split(",").indexOf(t)?this.get(this.DPMPROJECTATTR):this.get(this.SCOPESATTR))){if(e)return!1;s=[]}for(var i=0;i<s.length;i++){var a=s[i].id||s[i].get("objectId");if(a&&e&&a.toUpperCase()===e.toUpperCase())return!0}return!1},_belongsInCurrentFilter:function(){var e,t,s=window.enoviaServer.user,i=c.getFilter(),a=[],o=this.get(this.ASSIGNEESATTR),n=this.get("ownerInfo"),l=this.get(p.COOWNERATTR),r=this.get("candidateAssignees");i===c.FILTER_OWNED?a=a.concat(n,l):i===c.FILTER_ASSIGNED?a=a.concat(n,o):i===c.FILTER_ALL?a=a.concat(n,l,o):i===c.FILTER_CANDIDATE_ASSIGNEE&&(a=a.concat(r)),n&&n.length||!this.isNew()||(n={get:function(e){var t;return"name"===e&&(t=s),t}});for(var d=0;d<a.length;d++){if((e=(t=a[d]).get("name",{noMapping:!0}))&&s&&e.toUpperCase()===s.toUpperCase())return!0;if(["Group","Group Proxy"].indexOf(t.get("type"))>-1)return!0}return!1},_removeFromCollection:function(t){var s=this;e.Utils.setImmediate(function(){s.collection&&s.collection.remove(s),"function"==typeof t&&t()})},_filterDatabyScope:function(e){if(this.noFilter||0===this.get("ownerInfo").length||this.fetching)"function"==typeof e&&e();else if(this.collection){var t=!0,s=c.getScopeId(),i=c.getScopeType(),a=c.getObjectData(),o=window.widget.getValue("showProjectTasks"),n=this.isProjectTask();this.isRouteTask()?t=!1:n?(t=!1===o||"false"===o,!1===o&&n&&this._belongsInCurrentScope(s,i)&&(t=!1)):s&&"tempfix"!==s&&!c.isScopeRDF()?t=!this._belongsInCurrentScope(s,i):c.isScopeRDF()?c.isAgileWorkContext()&&(t=!this._belongsInCurrentScope(a.id,a.type)):t=!this._belongsInCurrentFilter(),t?this._removeFromCollection(e):"function"==typeof e&&e()}},sync:function(t,s,i){var a=Array.prototype.slice.call(arguments,0),o=e.clone(i||{},!1);if(a[2]=o,"create"===t){var n=this,l=o.onComplete;o.onComplete=function(){n.completed=!0,l&&l.apply(this,arguments)}}return this._parent.apply(this,a)},handleSelfAssignToInWorkTask:function(){var e=o.setHelper.apply(this,arguments).attrs||{},t=this.get(this.ASSIGNEESATTR),s=!t||0===t.length,i=e.state,a=e.stateForDisplay,n=e.percentComplete,l=this.get("state"),r="Active"===i||"In Progress"===a,c=this.isProjectTask()&&"Active"!==l&&n&&parseFloat(n)!==parseFloat(0)&&parseFloat(n)!==parseFloat(100);s&&(r||c)&&(this.addAssigneesByName([window.enoviaServer.user]),this.addSelfAssignToInWorkMessage.apply(this,arguments))},save:function(t,s,i){this.markDeliverablesOn3DNavigate(),this.handleSelfAssignToInWorkTask.apply(this,arguments);var a=e.clone(i||{},!1);if(!this.isRouteTask()&&i&&i.onComplete){var o=this,n=i.onComplete;a.onComplete=function(){c.getFilter()===c.FILTER_CANDIDATE_ASSIGNEE&&o.get("assignees")&&o.get("assignees").length&&o._removeFromCollection(),n&&n.apply(this,arguments)}}let l="$fields=deliverablesInheritance,isAssigneeAccessRestricted,calculateDuration,revision,custom,references.description,deliverables.description";t?a.urlParam=l:s&&(s.urlParam=l),this._parent(t,s,a)},getWorkDayLength:function(){return 8},getWorkingHoursInMilliseconds:function(){return 60*this.getWorkDayLength()*60*1e3},isStarted:function(){var e=this.get("state");return"Active"===e||"Review"===e},getStartDate:function(){return this.isStarted()?this.get(this.ACTUALSTARTDATEATTR):this.get("estimatedStartDate")},getPercentComplete:function(){return void 0===this.get("percentComplete")?-1:parseFloat(this.get("percentComplete"))},getEstimatedDuration:function(){var e=this.get("estimatedDuration")||0;return e&&parseFloat(e)},getDefinedDuration:function(){return this.getEstimatedDuration()},getTransferObject:function(t){var s=this.get("type"),i=e.clone(t||{},!1);i&&delete i.parentObject;var a=e.merge(i,{source:window.widget.getValue("appId")||p.APP_TSK,envId:window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),objectId:this.id,objectType:s,displayType:o.translateType(s),objectType_Internal:s,displayName:this.get("title"),image:this.get("typeicon")});return o.getTransferObject(a)},canDelete:function(){var e=this.get("deleteAccess");e="FALSE"!==e&&e;var t=this.get("state");return e&&("Assign"===t||"Create"===t)},isReadyToStart:function(){var e=this.get("estimatedStartDate"),t=this.get("state");return this.isProjectTask()&&t&&("Create"===t||"Assign"===t)&&e&&!(new Date(new Date(e)-l.THRESHOLD)<=new Date)},getCompressionLevel:function(){return this.isProjectTask()&&"behindSchedule"===this.get("status")?1:0},hasFetchedAccessData:function(){return!0},getParentAsLabel:function(){var e;if(this.isProjectTask()){var t=this.get("DPMProject");if(t&&t[0]){var s=t[0].get("name");e={key:g("emxCollaborativeTasks.Label.Project"),value:s}}}return e},getTaggerURI:function(){return this.getTagPrefix()+this.id}});return _.implement(l,r),_.getAttachmentErrorMessage=function(e,t){var s="";return"assignees"===e?s=g("emxCollaborativeTasks.Error.FailedToAssignUser"):"references"===e?s=g("emxCollaborativeTasks.Error.FailedToCreateReference"):"deliverables"===e?s=g("emxCollaborativeTasks.Error.FailedToCreateDeliverable"):"scopes"===e?s=g("emxCollaborativeTasks.Error.FailedToCreateScope"):e===p.COOWNERATTR?s=g("emxCollaborativeTasks.Error.FailedToAddCoOwner"):"referencedSimulations"===e&&(s=g("emxCollaborativeTasks.Error.FailedToAddProcess")),s=s.replace("%NAME%",t)},_.getAttachmentSuccessMessage=function(e,t){var s="";return"references"===e?s=g("emxCollaborativeTasks.Success.ObjectAddedAsReference"):"deliverables"===e?s=g("emxCollaborativeTasks.Success.ObjectAddedAsDeliverable"):"referencedSimulations"===e&&(s=g("emxCollaborativeTasks.Success.ProcessAdded")),s=s.replace("%NAME%",t)},_.PersonModel=f,_.ReferenceModel=i,Object.defineProperty(_.prototype,"extid",{get:function(){return this.id}}),_.ASSIGNEESATTR="assignees",_}),define("DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/SmartSchedulerUtils","DS/RDFFoundation/RDFUtils","DS/CollaborativeTasks/Views/CustomizedStartStopView","DS/E6WCommonUI/Views/MultiStartStopView","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/E6WCommonApps/Views/CommonPropertiesConfig","DS/E6WCommonApps/Views/DependencyGroupView","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/FeatureFlagUtils","DS/E6WCommonUI/Views/MultiObjectCardView","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S){"use strict";var b=function(e){var s=t.getWidgetConstant.apply(this,arguments);return s===e&&(s=v.get(e)),s},_={config:function(){var e=b("emxCollaborativeTasks.GroupLabel.More"),t={"3dspace":[p.SIMULATION_TYPE,p.SIMULATION_TEMPLATE_TYPE]},s=[{readWrite:!0,name:"title",label:b("E6WCommonApps.Label.Title"),type:"text",removeCarriageReturns:!0,numberOfEditableLines:4,maxLength:128,required:!0,validate:!0},{readWrite:!0,name:"description",label:b("emxCollaborativeTasks.Label.TaskDescription"),type:"textarea",numberOfDisplayLines:3,numberOfEditableLines:6},{readWrite:!0,name:"scopes",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,label:b("emxCollaborativeTasks.Label.Contributing"),type:"object",searchTitle:b("emxCollaborativeTasks.Label.ContributingSearchTitle"),customView:u,typeAheadCallback:n.typeAheadCallback,searchSource:a.filterSearchSources(["3dspace"]),linkCallback:i.launchProperties,placeHolder:b("emxCollaborativeTasks.Label.ObjectPlaceHolder"),excludeSearchTypes:{"3dspace":["Task","Inbox Task","Project Baseline","Experiment","Project Snapshot","Project Space"]},getDropDownMenuItems:o.getDocumentTypeDropDownMenuItems},{readWrite:!0,name:"DPMProject",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,label:b("emxCollaborativeTasks.Label.Project"),type:"object",searchTitle:b("emxCollaborativeTasks.Label.ProjectSearchTitle"),customView:u,typeAheadCallback:n.typeAheadCallback,searchSourceTypes:{"3dspace":["Project Space"]},searchSource:a.filterSearchSources(["3dspace"]),linkCallback:i.launchProperties,placeHolder:b("emxCollaborativeTasks.Label.ObjectPlaceHolder"),getDropDownMenuItems:o.getDocumentTypeDropDownMenuItems},{readWrite:!0,name:"state",label:b("emxCollaborativeTasks.Label.TaskMaturityState"),type:"select"},{name:"dueDate",readWrite:!0,label:b("emxCollaborativeTasks.Label.EstimatedFinishDate"),type:"date",validate:!0},{readWrite:!0,name:"estimatedDurationInputValue",unitAttribute:"estimatedDurationInputUnit",label:b("emxCollaborativeTasks.Label.estimatedDuration"),type:"uom",uomValues:[b("emxCollaborativeTasks.Label.Days"),b("emxCollaborativeTasks.Label.Hours")],minimumValue:"0",maximumValue:"2147483647",conversionTable:[1,24]},_.assigneeFieldConfig(),_.candidateAssigneeFieldConfig(),_.attachmentFieldConfig,_.deliverablesFieldConfig,{name:"project",label:b("emxCollaborativeTasks.Label.CollaborativeSpace"),type:"text"},d.getTagsFieldConfig(),{readWrite:!0,name:"actualStartDate",label:b("emxCollaborativeTasks.Label.ActualDates"),type:"startStop",customView:l,startDateLabel:b("emxCollaborativeTasks.Label.StartDate"),multiCustomView:r,canEditStartDate:function(e){var t=e.get("state");return"Create"!==t&&"Assign"!==t},endDateAttribute:"actualFinishDate",endDateLabel:b("emxCollaborativeTasks.Label.FinishDate"),canEditEndDate:function(e){return"Complete"===e.get("state")},validate:!0,group:e},{name:"originatorInfo",attributeToDisplay:"name",imageAttribute:"image",label:b("emxCollaborativeTasks.Label.TaskOriginator"),type:"person",customView:u,multiCustomView:f,searchSource:["swym"],linkCallback:i.launchProperties,singleObjectOnly:!0},{name:"ownerInfo",attributeToDisplay:"name",imageAttribute:"image",label:b("emxCollaborativeTasks.Label.TaskOwner"),type:"person",customView:u,multiCustomView:f,searchSource:["swym"],linkCallback:i.launchProperties,singleObjectOnly:!0},_.coOwnerFieldConfig(),{name:"originated",label:b("emxCollaborativeTasks.Label.TaskCreated"),type:"date",group:e},{name:"modified",label:b("emxCollaborativeTasks.Label.TaskModified"),type:"date",group:e},{name:"dependencies",customView:h}];return T.referencedSimulationsEnabled()&&s.splice(9,0,{readWrite:!0,name:"referencedSimulations",attributeToDisplay:"name",searchTitle:b("emxCollaborativeTasks.Label.ProcessesSearchTitle"),imageAttribute:"image",label:b("emxCollaborativeTasks.Label.Processes"),type:"object",customView:u,typeAheadCallback:n.typeAheadCallback,linkCallback:i.launchProperties,placeHolder:b("emxCollaborativeTasks.Label.ObjectPlaceHolder"),dropTypes:t,searchSourceTypes:t,searchSource:a.filterSearchSources(["3dspace"]),validateSameTenant:!0,getDropDownMenuItems:o.getDocumentTypeDropDownMenuItems}),s},projectConfig:function(){var e=b("emxCollaborativeTasks.GroupLabel.More");return[{readWrite:!0,name:"percentComplete",label:b("emxCollaborativeTasks.Label.Percent"),type:"range",step:5,percents:!0,insertIndex:4},{readWrite:!0,name:"estimatedStartDate",label:b("emxCollaborativeTasks.Label.EstimatedDates"),type:"startStop",customView:l,multiCustomView:r,canEditStartDate:function(e){var t=e.get("state");return"Review"!==t&&"Active"!==t&&"Complete"!==t},canEditEndDate:function(e){return"Complete"!==e.get("state")},startDateLabel:b("emxCollaborativeTasks.Label.StartDate"),endDateAttribute:"dueDate",endDateLabel:b("emxCollaborativeTasks.Label.FinishDate"),insertIndex:5},{readWrite:!0,name:"taskRequirement",insertIndex:12,label:b("emxCollaborativeTasks.Label.TaskRequirement"),type:"select"},{name:"actualDuration",label:b("emxCollaborativeTasks.Label.ActualDuration"),type:"uom",uomValues:[b("emxCollaborativeTasks.Label.Days"),b("emxCollaborativeTasks.Label.Hours")],conversionTable:[1,24],group:e,insertIndex:13},{readWrite:!0,name:"needsReview",label:b("emxProgramCentral.Task.NeedsReview"),type:"checkbox",insertIndex:19,group:e},{readWrite:!0,name:"deliverablesInheritance",label:b("emxProgramCentral.common.DeliverablesInheritance"),type:"checkbox",insertIndex:21,group:e},{readWrite:!0,name:"calculateDuration",label:b("emxProgramCentral.common.CalculateDuration"),type:"checkbox",insertIndex:21,group:e}]}},D=function(e,t,s){var i,a;return"assignees"===e?i=b("emxCollaborativeTasks.Error.FailedToDisconnectUser"):"references"===e?i=b("emxCollaborativeTasks.Error.FailedToDisconnectReference"):"scopes"===e?i=b("emxCollaborativeTasks.Error.FailedToDisconnectScope"):e===p.COOWNERATTR&&(i=b("emxCollaborativeTasks.Error.FailedToRemoveCoOwner")),a=A(t),i=s&&s.response&&400===s.response.statusCode&&s.response.error?s.response.error:a?i.replace("%NAME%",a):s&&s.response&&s.response.error},k=function(t,i,a,o){var n,l=A(i);return n=a&&a.response&&400===a.response.statusCode&&a.response.error?a.response.error:l?s.getAttachmentErrorMessage(t,l):a&&a.response&&a.response.error,"assignees"===t&&o&&e.is(o.isRouteTask,"function")&&o.isRouteTask()&&"TRUE"===o.get("routeOwnerTask")&&o.get("routeOwnerUGTitle")&&a&&a.response&&a.response.error&&(n+="<br>"+a.response.error),n},A=function(s){let i;if("Person"===s.type){let t=s._mvcModel.get("firstname"),a=s._mvcModel.get("lastname");i=e.is(t,"string")&&e.is(a,"string")?t+" "+a:""}else i=t.getFieldValue(s,"title")||t.getFieldValue(s,"name");return i},w=function(e){var t=b("emxCollaborativeTasks.Error.FailedToModify");return e&&e.response&&400===e.response.statusCode&&e.response.error&&(t+="<br>"+b(g.sanitizeMessage(e.response.error))),t},E=function(e,t,s,i,a){if(t===p.COOWNERATTR&&a&&a.response&&a.response.internalError){a.response.internalError.contains("#1500028")&&("CONNECT"===s?e=b("emxCollaborativeTasks.Error.FailedToAddCoOwnerAccessIssue"):"DISCONNECT"===s&&(e=b("emxCollaborativeTasks.Error.FailedToRemoveCoOwnerAccessIssue")));var o=A(i);e=e.replace("%NAME%",o)}return e},y=function(e){var t;return e?(t=[],C.getServiceUrl("3DSwym",!0)&&C.getServiceUrl("usersgroup",!0)?t.push("usersgroup"):t.push("3dspace")):t=C.getServiceUrl("3DSwym",!0)?["swym"]:["3dspace"],t},M=function(e){return"swym"===e.toString()?{swym:[p.PERSON_TYPE]}:{"3dspace":["Person"]}},I=function(e){var t;return"swym"===e.toString()||(t={"3dspace":["Security Context"]}),t};return _.options={onFailure:function(e,t,s){var i;if(s.clonedInfo)for(var a=Object.keys(s.clonedInfo),o=a.length,n=0;n<o;n++){var l=a[n],r=s.clonedInfo[l].item,d=s.clonedInfo[l].source,h=s.clonedInfo[l].source._relationship,u=r.updateAction;(i=c.getErrorMessageForInvalidCredentials(s.response))||("DISCONNECT"===u?i=D(h,d,s):"CONNECT"===u?i=k(h,d,s,e):"MODIFY"===u&&(i=w(s))),i&&(i=E(i,h,u,d,s),g.displayError(i))}else s.response&&"nothing to save"!==s.response.error&&g.displayError(b("E6WCommonApps.Error.SaveFailed"))}},_.assigneeFieldConfig=function(){return{readWrite:!0,name:"assignees",attributeToDisplay:"name",imageAttribute:"image",label:b("emxCollaborativeTasks.Label.Assignees"),searchTitle:b("E6WCommonApps.Label.assigneeSearchTitle"),typeAheadCallback:n.typeAheadCallback,dropTypes:m.PERSON_DROP_TYPES,searchSourceTypes:M(y()),type:"person",searchSource:a.filterSearchSources(y()),customView:u,multiCustomView:f,linkCallback:i.launchProperties,placeHolder:b("emxCollaborativeTasks.Label.ObjectPlaceHolder"),validateSameTenant:!0,excludeSearchTypes:I(y()),excludePendingUser:!0,addMembers:!0,customButtons:[g.assignToSelfButtonConfig()]}},_.candidateAssigneeFieldConfig=function(){let t=y(!0);var s=e.extend(_.assigneeFieldConfig(),{name:"candidateAssignees",label:b("E6WCommonApps.Label.CandidateAssignees"),searchTitle:b("E6WCommonApps.Label.candidateAssigneeSearchTitle"),searchSourceTypes:function(e){let t;switch(e.toString()){case"3dspace":t={"3dspace":["Group"]};break;case"usersgroup":t={usersgroup:[p.USER_GROUP_TYPE]};break;default:console.error("unexpected search source: "+e)}return t}(t),searchSource:a.filterSearchSources(t),dropTypes:{usersgroup:[p.USER_GROUP_TYPE],"3dspace":["Group Proxy","Group"]},customButtons:null});return delete s.excludeSearchTypes,s},_.coOwnerFieldConfig=function(){return{name:p.COOWNERATTR,attributeToDisplay:"name",imageAttribute:"image",label:b("emxCollaborativeTasks.Label.TaskCoOwners"),searchTitle:b("emxCollaborativeTasks.Label.coOwnerSearchTitle"),typeAheadCallback:n.typeAheadCallback,dropTypes:m.PERSON_DROP_TYPES,searchSourceTypes:M(y()),type:"person",searchSource:a.filterSearchSources(y()),customView:u,multiCustomView:f,linkCallback:i.launchProperties,placeHolder:b("emxCollaborativeTasks.Label.ObjectPlaceHolder"),validateSameTenant:!0,excludeSearchTypes:I(y()),excludePendingUser:!0,addMembers:!0}},Object.defineProperty(_,"attachmentFieldConfig",{get:function(){return{readWrite:!0,name:"references",attributeToDisplay:"name",imageAttribute:"image",allowFileManagement:!0,label:b("emxCollaborativeTasks.Label.References"),searchTitle:b("emxCollaborativeTasks.Label.referencesSearchTitle"),typeAheadCallback:n.typeAheadCallback,type:"object",customView:u,linkCallback:i.launchProperties,dropTypes:{"3dplan":["dsplan:url"]},placeHolder:b("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:a.filterSearchSources(["3dspace","drive"]),excludeSearchTypes:{"3dspace":["Person","Security Context","Business Role"]},validateSameTenant:!0,allowUrlLink:!0,limit:100,getDropDownMenuItems:o.getDocumentTypeDropDownMenuItems}}}),Object.defineProperty(_,"deliverablesFieldConfig",{get:function(){return{readWrite:!0,name:"deliverables",attributeToDisplay:"name",allowFileManagement:!0,searchTitle:b("emxCollaborativeTasks.Label.deliverablesSearchTitle"),imageAttribute:"image",label:b("emxCollaborativeTasks.Label.Deliverables"),type:"object",customView:u,typeAheadCallback:n.typeAheadCallback,linkCallback:i.launchProperties,placeHolder:b("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:a.filterSearchSources(["3dspace","drive"]),validateSameTenant:!0,allowUrlLink:!0,dropTypes:{"3dplan":["dsplan:url"]},limit:100,getDropDownMenuItems:o.getDocumentTypeDropDownMenuItems}}}),_}),define("DS/CollaborativeTasks/Models/TskCloneModel",["UWA/Core","DS/Foundation/WidgetUwaUtils","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/DropValidator","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/CSRFUtil","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s,i,a,o,n,l,r,c){"use strict";var d=s.getWidgetConstant;s.getWidgetConstant=function(e){return d.apply(this,arguments)||c.get(e)};var h=function(){return s.getWidgetConstant.apply(this,arguments)},u={d:0,h:1},p=["d","h"];return a.extend({_uwaClassName:"TskCloneModel",i18n:h,_attributesGet:function(e,t){return e?e[t]:this.get(t)},validate:function(e){var t=!0,i={fields:[],messages:{}},a=this._attributesGet(e,"title"),o=!(this.model.isRouteTask()||this.model.isIteropTask())&&s.containsBadChars(a);return a&&a.length&&!o||(i.fields.push("title"),o&&(i.messages.title=h("emxCollaborativeTasks.Validate.TitleError")),t=!1),(t=t&&this._validateActualDates(e,i))?void 0:i},_validateActualDates:function(e,t){var s=!0,i=this._attributesGet(e,"actualStartDate"),a=this._attributesGet(e,"actualFinishDate"),o=this._attributesGet(e,"state");"Create"===o||"Assign"===o||i&&void 0!==i&&""!==i||this._hasModifiedProperty("actualStartDate")&&(t.fields.push("actualStartDate"),s=!1),"Complete"!==o||a&&void 0!==a&&""!==a||(t.fields.push("actualFinishDate"),s=!1);var n=new Date;return i=i&&new Date(i).setHours(0,0,0,0),a=a&&new Date(a).setHours(0,0,0,0),i&&i>n&&(t.fields.push("actualStartDate"),s=!1),a&&a>n&&(t.fields.push("actualFinishDate"),s=!1),i&&a&&i>a&&(t.fields.push("actualStartDate"),s=!1),s},get:function(e){var t=this._parent.apply(this,arguments);if("needsReview"===e||"deliverablesInheritance"===e||"calculateDuration"===e)return"Yes"===t?"TRUE":"FALSE";switch(e){case"estimatedDurationInputUnit":t=u[t];break;case"modified":case"originated":t=o.getIntlDateTimeFormat(t);break;case"actualStartDate":case"actualFinishDate":t=o.getIntlDateFormat(t)}return t},dataForRendering:function(){var s,i,a=this._parent();this.model&&e.is(this.model.isRouteTask,"function")&&this.model.isRouteTask()||(i=(s=this.get("scopes"))&&s.length?[s[0].dataForRendering()]:[],a.scopes=i),a.route&&a.route.forEach(function(e){e.image={imageValue:window.enoviaServer.computeUrl("/common/images/iconSmallRoute.gif")}});var o=this.get("estimatedDurationInputUnit");void 0!==o&&(a.estimatedDurationInputUnit=o);var n=this.get("needsReview");void 0!==n&&(a.needsReview=n);var l=this.get("deliverablesInheritance");void 0!==l&&(a.deliverablesInheritance=l);var r=this.get("calculateDuration");return void 0!==r&&(a.calculateDuration=r),void 0!==a.modified&&(a.modified=this.get("modified")),void 0!==a.originated&&(a.originated=this.get("originated")),void 0!==a.actualStartDate&&(a.actualStartDate=this.get("actualStartDate")),void 0!==a.actualFinishDate&&(a.actualFinishDate=this.get("actualFinishDate")),void 0!==a.project&&(a.project=t.getContextDisplayValueForContext(this.get("project"))),a},isProjectTask:function(){return this.model.isProjectTask()},set:function(e,t,s){var i=t;if(t.actualValue&&void 0!==t.actualValue&&""!==t.actualValue){var a=this.model.getFieldDef(e);if(a&&a.format&&("UTC"===a.format||"date"===a.format)){var o=new Date(t.actualValue),n=o.getDate(),l=o.getMonth(),r=o.getFullYear();o.setUTCHours(12,0,0,0),o.setMonth(l,n),o.setFullYear(r),i=o}}return void 0!==i.actualValue&&(i=i.actualValue),"title"===e&&(i=i.trim()),"percentComplete"===e&&s&&!s.doNotSetState&&(0===t?this.set("state",{actualValue:h("emxCollaborativeTasks.Label.Assign"),displayValue:h("emxCollaborativeTasks.Label.ToDo")}):t>0&&t<100?this.set("state",{actualValue:h("emxCollaborativeTasks.Label.Active"),displayValue:h("emxCollaborativeTasks.Label.InWork")}):100===t&&this.set("state",{actualValue:h("emxCollaborativeTasks.Label.Complete"),displayValue:h("emxCollaborativeTasks.Label.Done")})),"state"===e&&(t.displayValue===h("emxCollaborativeTasks.Label.Draft")||t.displayValue===h("emxCollaborativeTasks.Label.Open")?this.set("percentComplete",0,{doNotSetState:!0}):t.displayValue===h("emxCollaborativeTasks.Label.InWork")&&(this.get("percentComplete")<10||100===this.get("percentComplete"))?this.set("percentComplete",10,{doNotSetState:!0}):t.displayValue!==h("emxCollaborativeTasks.Label.InReview")&&t.displayValue!==h("emxCollaborativeTasks.Label.Done")||this.set("percentComplete",100,{doNotSetState:!0})),"needsReview"!==e&&"deliverablesInheritance"!==e&&"calculateDuration"!==e||(i="TRUE"===i?"Yes":"No"),"estimatedDurationInputUnit"===e&&(i=p[i]),this._parent(e,i,s)},add:function(e,t,s){var i,a=s&&s.dropObj;return a&&(i=n.validateTenant(a)),i?(o.displayError(i),[]):this._parent.apply(this,arguments)},addIndividualObject:function(e,t){return"scopes"!==e&&"contents"!==e||(this._addForScopes.apply(this,arguments),t instanceof FileList||t instanceof File)?this._parent.apply(this,arguments):{}},getObjectToBeAdded:function(t,s,i){var a;if((i.dropObj||i.detailedObject)&&(a=o.getObjectDataFromDropSearchOrTypeAhead(i)),a&&("usersgroup"===a.serviceId&&"foaf:Group"===a.type||"3DSpace"===a.serviceId&&"Group Proxy"===a.type)){"foaf:Group"===a.type&&(a.type="Group",a.Title=a.title,delete a.title);let i="3DSpace"!==a.serviceId;return e.is(this.model.collection.getRelatedObject,"function")&&this.model.collection.getRelatedObject(t,l.jsonURIToSparqlURI(s),i,void 0,{attributes:a})}return this._parent.apply(this,arguments)},_addForScopes:function(t,s,i,a){var o=e.clone(a||{},!1),n=function(e){return this._addCompletedModelToScopeOrContents(e,t,o)},l=this.model.collection.getRelatedObject(t,s);return l.get("type")?n.call(this,l):(this.listenToOnce(l,"onChange:type",n),{ret:l})},_addCompletedModelToScopeOrContents:function(t,s,i){var n={};if("scopes"===s||"contents"===s){var l=t.get("type");if(-1!==("scopes"===s?this.scopesTypes:this.contentsTypes).indexOf(l)){var r=this.get(s),c=e.clone(i||{},!1);c.silent=!0,r&&r.length&&r[0]===t||(i&&i.config.singleObjectOnly&&this.remove(s,0,c),(n=a.prototype.addIndividualObject.call(this,s,t.id,t,c)).changedModificationPending&&this.dispatchEvent("onChange:modificationsPending"),n.changed&&((c=e.clone(i||{},!1)).operation="add",this._fireRelationshipChangeEvents(s,c)))}else{var d=h("emxCollaborativeTasks.Error.InvalidScopesType");d=d.replace("%TYPE%",l),o.displayError(d)}}return n},save:function(){var e=this.localAttributes;this._parent.apply(this,arguments),this.model.validationError&&(this.localAttributes=e,this.modificationsPending=!0,this.dispatchEvent("onChange:modificationsPending",[this]))},assignToSelf:function(t){var s=e.clone(t||{},!1),a="iam:"+window.enoviaServer.user,o=[{id:a,serviceId:"3DSwym"}];if(s.detailedObjects=[o[0]],t.config.singleObjectOnly&&o&&o.length>0){var n=this.get(i.ASSIGNEESATTR);if(n&&e.is(n,"array")&&n.length>0&&e.is(this.model.remove,"function")){var l=s.singleObjectRemove;s.singleObjectRemove=!0,this.remove(i.ASSIGNEESATTR,0,s),s.singleObjectRemove=l}}this.add(i.ASSIGNEESATTR,a,s),this.model.isRouteTask()&&this.model.isAssignedToUserGroup()&&this.remove("assignees",1)},checkAndSetCSRF:function(e,t){r.checkAndSetCSRF(e,t)}})}),define("DS/CollaborativeTasks/Models/RouteTaskModel",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/TreeNodeUtil","DS/ENOCollabRouteTask/RouteTaskHelper","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,s,i,a,o,n){"use strict";var l=function(e){var s=t.getWidgetConstant.apply(this,arguments);return s===e&&(s=n.get(e)),s};return s.extend({_uwaClassName:"RouteTaskModel",ROUTETASKDUEDATE:"routeTaskDueDate",setup:function(){this.listenTo(this,"onChange:"+this.ROUTETASKDUEDATE,function(e,t,s){s.silent||e.dispatchEvent("onChange:"+this.DUEDATECATEGORY,arguments)}),this._parent.apply(this,arguments)},dataForRendering:function(){var e=this._parent.apply(this,arguments);return this.isComplete()?e.date=e.routeTaskActualFinishDate:e.date=e.routeTaskDueDate,e.routeOwnerTask&&(e.routeOwnerTask=this.isTaskReassignmentRequired()),1===e.contents.length?e.cardTitle=e.title+" | "+e.contents[0].title+" ("+(e.contents[0].actualName||e.contents[0].name)+")":e.contents.length>1&&(e.cardTitle=e.title+" | "+l("E6WCommonUI.Label.ShowContentInfo").replace("{Number}",e.contents.length)),e.context="",e},toJSON:function(){return this._parent.apply(this,arguments)},isTaskReassignmentRequired:function(){return"TRUE"===this.get("routeOwnerTask")},isAssignedToUserGroup:function(){var e=this.get("assignees");return e&&e.length&&("Group"===e[0].get("type")||"Group Proxy"===e[0].get("type"))},get:function(e){return("canEdit"!==e||!this.isAssignedToUserGroup())&&("dueDate"===e||"endDate"===e?new Date(this.get(this.ROUTETASKDUEDATE)):"routeOwner"===e?this._parent.apply(this,arguments):"canApproveRejectAbstain"===e?this.isRouteTask()&&"Assign"===this.get("state")&&"Approve"===this.get("routeTaskAction")&&this.get("canEdit")&&""!==this.get("routeTaskApprovalComments"):this._parent.apply(this,arguments))},set:function(){var t=i.setHelper.apply(this,arguments),s=e.clone(t.attrs||{},!1),a=t.options;if(s){if(s.hasOwnProperty(this.DUEDATECATEGORY)){var o=s[this.DUEDATECATEGORY];delete s[this.DUEDATECATEGORY],s[this.ROUTETASKDUEDATE]=this.dueDateCategory2DueDate(o)}return this._parent(s,a)}return this._parent.apply(this,arguments)},subscriptionsEnabled:function(){return!1},isRouteTask:function(){return!0},isIteropTask:function(){return!1},getContext:function(){return""},canAssignToSelf:function(){return!this.isComplete()&&(this.isAssignedToUserGroup()||this.get("canEdit"))&&!this.isAssignedToCurrentUser()},validate:function(e){var t=this._parent.apply(this,arguments)||{fields:[]},s=this._getValidationOptions(e);return o.validate(e,this,t,s)},getParentIdForRelationship:function(e){return"contents"===e?this.get("route")[0].id:this.id},assignToSelf:function(){var e=this;this.addAssigneesByName([window.enoviaServer.user]),this.isAssignedToUserGroup()&&this.removeObject("assignees",this.get("assignees")[0]),this.save(null,{patch:!0,onComplete:function(){e.dispatchEvent("onChange:"+e.ASSIGNEESATTR);var t=l("emxCollaborativeTasks.Label.SuccessfullyAssignedToSelf");i.displaySuccess(t),e.dispatchEvent("onModifyAccessChanged")},onFailure:function(){var e=l("emxCollaborativeTasks.Error.FailAssignToSelf");i.displayError(e)}})},save:function(e,t){var s=arguments;arguments.length>0?this._saveArgs=arguments:s=this._saveArgs;var i=this;return t&&t.onComplete&&this._shouldDoAutoRefresh(e)&&(t.onComplete=function(){i.collection.fetch({server:!0,partialRefresh:!0,noTag:!0})}),this._parent.apply(this,s)},_shouldDoAutoRefresh:function(e){var t=this.get("assignees")[0].get("dsaccess:accountName"),s=e&&e.state;return!i.isLoggedInUser(t)||s&&("Review"===s||"Complete"===s)},createNodeData:function(){return e.merge(this._parent.apply(this,arguments),{contents:a.getDisplayLabelForRouteContent(this),routeTaskAction:this.get("routeTaskAction"),routeTaskInstructions:this.get("routeTaskInstructions")})},getFonticonValue:function(e){return o.getIconValue(e)},getParentAsLabel:function(){var e,t=this.get("route");if(t&&t[0]){var s=t[0].get("name");e={key:l("emxCollaborativeTasks.Label.Route"),value:s}}return e}})}),define("DS/CollaborativeTasks/Models/SourcingTaskModel",["DS/CollaborativeTasks/Models/RouteTaskModel","DS/E6WCommonUI/PlatformManager"],function(e,t){"use strict";return e.extend({_uwaClassName:"SourcingTaskModel",ROUTETASKDUEDATE:"routeTaskDueDate",get:function(e){if("_isSourcingTask"===e)return!0;if("canApproveRejectAbstain"===e)return this.isRouteTask()&&"Assign"===this.get("state")&&"Approve"===this.get("routeTaskAction")&&this.get("canEdit");return this._parent.apply(this,arguments)},sync:function(){enoviaServer.setTempUrl(t.getServiceUrl("sourcing"));const e=enoviaServer.space;enoviaServer.space=void 0;const s=this._parent.apply(this,arguments);return enoviaServer.setTempUrl(),enoviaServer.space=e,s}})}),define("DS/CollaborativeTasks/Views/TaskMenuMixin",["UWA/Core","DS/Foundation/WidgetAPIs","DS/Foundation2/FoundationV2Data","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button","DS/i3DXCompassServices/i3DXCompassPubSub","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Models/BulkModel","DS/E6WCommonApps/DeleteUtil","DS/E6WCommonApps/DuplicateItemUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/MultiEditMenuUtil","DS/E6WCommonApps/Models/NoAccessModel","DS/CollaborativeTasks/Models/SourcingTaskModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f){"use strict";var v=function(e){var t=T.get(e);return t===e&&(t=f.get(e)),t===e&&(t=s.getWidgetConstant.apply(this,arguments)),t};return{createMenuButtons:function(){var e=this,t=[];if(this.model){if(!(this.model instanceof c)){if(this.isIteropTask()){var s=this.getIteropOpenMenu(this.model);return t.push(s),e.getCardMenu(t)}t.push({className:e.editItemClassName(),fonticon:"info",text:v("emxCollaborativeTasks.Command.Edit"),func:function(){e.dispatchEvent("onTaskCardClickedForTableView",e),e.dispatchEvent("onTaskCardEdit",e)}});let i=this.getParentView()&&(this.getParentView()._selectedModels||this.getParentView()._parentView&&this.getParentView()._parentView._selectedModels);if(i&&i.length>1){let s={dropdownItems:t,selectedModels:i};return this.createMultiItemsMenu(s),e.getCardMenu(t)}if(t.push(this.getAssignToSelfMenuConfig(this.model)),t=e.getConditionalDropMenuItems(t),this.isRouteTask(this.model)&&"Assign"===this.model.get("state")&&"TRUE"===this.model.get("routeTaskDelegationAllowed")?t.push(this.getChangeAssignee(this.model)):"FALSE"===this.model.get("routeTaskDelegationAllowed")&&this.model.get("routeOwner")===r.getContextUser()&&t.push(this.getChangeAssignee(this.model)),this.isRouteTask(this.model)&&"Assign"===this.model.get("state")&&"Approve"===this.model.get("routeTaskAction")?t=this.getApprovalMenuItems(t,this.model):t.push(this.getCompleteMenuConfig(this.model)),this.shouldShowDuplicateOption()&&t.push(this.getDuplicateMenuConfig({model:this.model,parentView:this.getParentView()})),t.push(this.getBookmarkMenuConfig(this.model)),this.model.isRDFTask()||this.model.isRouteTask()||t.push(this.getOpenRelationEditorMenuConfig(this.model)),t.push({className:"divider"}),t.push(this.getDeleteMenuConfig({model:this.model,parentView:this.getParentView()})),this.model instanceof g){t=this.filterDropdownItems(t)}}return e.getCardMenu(t)}},launchRelationsEditorApp:function(){var e=this.getLaunchOptions();n.publish("setX3DContent",e),n.publish("launchApp",{appId:C.APP_RELATIONS})},filterDropdownItems:function(e){let t=["INFO","THUMBS-UP","THUMBS-DOWN"];return e.filter(e=>{if(e.fonticon){let s=e.fonticon.toUpperCase();return t.includes(s)}return!1})},createMultiItemsMenu:function(e){let t=e&&e.selectedModels;p.checkIsMenuDisabled({selectedModels:t,assignToSelfItemAccess:this.assignToSelfItemAccess.bind(this),completeItemAccess:this.completeItemAccess.bind(this),reOpenItemAccess:this.reOpenItemAccess.bind(this),deleteItemAccess:this.deleteItemAccess.bind(this),duplicateItemAccess:this.duplicateItemAccess.bind(this)}),this.getMultiTaskMenus(e)},getMultiTaskMenus:function(t){let s=e.clone(t||{},!1),i=s.model||this.model,a=s.selectedModels||i.models,o=s.dropdownItems;o&&(!s.isDetailsPanel&&o.push(this.getAssignToSelfMenuConfig(i,a)),o.push(this.getCompleteMenuConfig(i,a)),!p.hideDuplicateMenu&&o.push(this.getDuplicateMenuConfig({multiEditModels:a,parentView:this.getParentView()})),o.push(this.getDividerConfig(),this.getDeleteMenuConfig({multiEditModels:a,parentView:this.getParentView()})))},getLaunchOptions:function(){return{protocol:"3DXContent",version:"1.0",data:{items:[{objectId:this.model.get("physicalId")||this.model.id,objectType:this.model.get("type"),image:this.model.get("image"),serviceId:"3DSpace",displayName:this.model.get(C.TITLE_ATTR),source:window.widget.getValue("appId"),envId:r.getTenant()}]}}},getOpenRelationEditorMenuConfig:function(e){var t=this;return{id:"openRelationEditorItem",fonticon:"object-related",text:v("emxCollaborativeTasks.Command.Relations"),func:function(){t.launchRelationsEditorApp()}}},shouldShowDuplicateOption:function(){return!(this.isRouteTask(this.model)||this.model&&this.model.isProjectTask&&this.model.isProjectTask())},isRouteTask:function(e){var t=e||this.model;return t&&t.isRouteTask&&t.isRouteTask()},isIteropTask:function(e){var t=e||this.model;return t&&t.isRouteTask&&t.isIteropTask()},getBookmarkMenuConfig:function(e){var t=u.getBookmarkURLMenuConfig(e);return this.isIteropTask(e)&&(t.disabled=!0),this._bookmarkHandler=function(){t.handler(),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"copyLink",eventLabel:"model",eventValue:e})},t},getIteropOpenMenu:function(e){var t=this;return{className:t.launchItemClassName(),fonticon:"logout",text:v("emxCollaborativeTasks.Command.OpenIteropTask"),func:function(e){t.openIteropItemCallback(e),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"open",eventLabel:"ID",eventValue:e})}}},getDividerConfig:u.getDividerConfig,getAssignToSelfMenuConfig:function(e,t){var s,i=this,a=!1;return t||this.model instanceof c?(s=t||this.model.models,a=p.isAssignToSelfDisabled):(a=!i.assignToSelfItemAccess(e),e.isWedo&&e.isWedo()&&(a=!0)),{className:i.assignToSelfItemClassName(),fonticon:"user-add",disabled:a,text:v("E6WCommonUI.Command.AssignToSelf"),handler:function(){s?p.isSelectionValid(s)&&p.assignToSelf(s,i.assignToSelf.bind(i)):(i.assignToSelf(e),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"assignToSelf",eventLabel:"model",eventValue:e}))}}},getChangeAssignee:function(e){var s=this;return{className:"user-change",fonticon:"user-change",text:v("emxCollaborativeTasks.Label.ChangeAssignee"),handler:function(){const i=function(){var i={taskId:e.id,taskTitle:e._attributes.title,assigneePID:e.get(e.ASSIGNEESATTR)[0].id,type:"Inbox Task",routeOwnerTask:e.get("routeOwnerTask"),routeOwnerUGChoice:e.get("routeOwnerUGChoice"),routeOwnerUGName:e.get("routeOwnerUGName"),routeId:e.get("route")[0].id,Scope:["All","",""],ScopeMembers:"All"};i.collabstorage=widget.data.collabstorage,i.collabspace=widget.data.collabspace,i.collabspace===t.TSK_PRIVATE_SPACE&&(i.noSecurityContextForSearch=!0);try{let t="DS/ENORouteMgmt/Views/Dialogs/InitiateChangeAssignee";s.InitiateChangeAssignee=require(t),s.InitiateChangeAssignee.init(i),widget.routeMgmtMediator&&widget.routeMgmtMediator.subscribe("route-task-on-change-assignee",function(t){e._removeFromCollection()})}catch{console.log("that.initiateRouteChangeAssignee().init(options);")}};e.get("routeOwner")?i():e.addEventOnce("onSync",i)}}},getDuplicateMenuConfig:function(t){var s=this,i=e.clone(t||{},!1),a=i.model,o=!1;let n;return i.multiEditModels||this.model instanceof c?(n=i.multiEditModels||this.model.models,o=p.isDuplicateDisabled):a&&a.hasFetchedAccessData()&&(o=this.duplicateItemAccess(a,t)),!o&&(o=t&&e.is(t.taskHasSubTasks,"function")&&t.taskHasSubTasks(a)),{id:"duplicateItem",className:"item-duplicate",fonticon:"duplicate",disabled:o,text:v("E6WCommonUI.Label.Duplicate"),func:function(e){n?p.isSelectionValid(n)&&h.duplicateItem({selectedModels:n,parentView:i.parentView}):s.duplicateItemCallback(e,t)}}},getCompleteMenuConfig:function(e,t){var s=this,i=!1;let a,o=!1;t||this.model instanceof c?(a=t||this.model.models,i=p.isMarkAsCompleteDisabled,o=p.isComplete):e.hasFetchedAccessData()&&(i=!s.completeItemAccess(e)&&!s.reOpenItemAccess(e),o=e&&e.isComplete());var n=e.isRouteTask();return{id:"completeItem",className:n?s.completeItemClassName():s.completeItemClassName()+(o?"re-open":""),fonticon:n?"status-change":o?"reset":"status-change",disabled:i,text:v(n?"emxCollaborativeTasks.Command.Complete":o?"emxCollaborativeTasks.Command.ReOpen":"emxCollaborativeTasks.Command.Complete"),handler:()=>{a?p.isSelectionValid(a)&&p.updateState(a,s.toggleStateIntoOrOutOfDone.bind(s)):s.toggleStateIntoOrOutOfDone(e)}}},getDeleteMenuConfig:function(t){var s=this,i=e.clone(t||{},!1),a=i.model,o=!1;let n;return i.multiEditModels||this.model instanceof c?(n=i.multiEditModels||this.model.models,o=p.isDeleteDisabled):(a&&a.hasFetchedAccessData()&&(o=this.isRouteTask(a)||!this.deleteItemAccess(a)||this.isIteropTask(a)),!o&&(o=a&&l.isWedoTask(a.get("dsxplan:jsType")))),{id:"deleteButton",className:this.deleteItemClassName(),fonticon:"trash",disabled:o,text:v("emxCollaborativeTasks.Command.Delete"),func:function(e){n?p.isSelectionValid(n)&&(i.selectedModels=n,d.deleteItem(i)):s.deleteItemCallback(e,t)}}},getApprovalMenuItems:function(e,t){var s,i=!1,a=function(e){var s=t.collection&&t.collection.allRouteTaskApprovalActions&&t.collection.allRouteTaskApprovalActions();return s&&s.find(t=>t.actualValue===e)};return t&&t.hasFetchedAccessData()&&(i=!this.approvalActionsItemAccess(t)),t&&"Assign"===t.get("state")&&"Approve"===t.get("routeTaskAction")&&((s=a("Approve"))&&e.push({className:this.approveItemClassName(),fonticon:"thumbs-up",disabled:i,name:"approve",selectable:!0,selected:t&&"Approve"===t.get("routeTaskApprovalAction"),text:s.displayValue,handler:this.handleApprovalActions.bind(this,t,"Approve")}),(s=a("Reject"))&&e.push({className:this.rejectItemClassName(),fonticon:"thumbs-down",disabled:i,name:"reject",selectable:!0,selected:t&&"Reject"===t.get("routeTaskApprovalAction"),text:s.displayValue,handler:this.handleApprovalActions.bind(this,t,"Reject")}),(s=a("Abstain"))&&e.push({className:this.abstainItemClassName(),fonticon:"ignore",disabled:i,name:"abstain",selectable:!0,selected:t&&"Abstain"===t.get("routeTaskApprovalAction"),text:s.displayValue,handler:this.handleApprovalActions.bind(this,t,"Abstain")})),e},getConditionalDropMenuItems:function(e,t){var s=this.isRouteTask(),i=this,a=this.isModelAProjectTask();if(this.subscribedToItem()&&!a&&!s&&this.model.subscriptionsEnabled()?e.push({id:"unsubscribeToItem",className:i.unsubscribeItemClassName(),fonticon:"rss",visible:!1,text:v("emxCollaborativeTasks.Command.Unsubscribe"),func:function(){i.toggleSubscription(),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"unsubscribe",eventLabel:"taskModel",eventValue:this.model})}}):a||s||!this.model.subscriptionsEnabled()||e.push({id:"subscribeToItem",className:i.subscribeItemClassName(),fonticon:"rss",text:v("emxCollaborativeTasks.Command.Subscribe"),func:function(){i.toggleSubscription(),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"subscribe",eventLabel:"taskModel",eventValue:this.model})}}),a){let s={id:"openProjectItem",className:i.launchItemClassName(),fonticon:"logout",text:v("emxCollaborativeTasks.Command.OpenProjectItem"),func:function(e){i.openProjectItemCallback(e),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"open",eventLabel:"ID",eventValue:e})}};t?e.splice(0,0,s):e.splice(1,0,s)}if(this.isIteropTask()){let t=this.getIteropOpenMenu(this.model);e.push(t)}return e},getCardMenu:function(e){return{value:"",dropdownCaret:!1,removeOnHide:!0,id:this.menuId(),className:"link",icon:"fonticon-open-down",dropdown:{items:e},events:{onDropdownClick:function(e,t){t&&"function"==typeof t.func&&t.func()}}}},setDescriptionForLargeCards:function(e,t){var s=t.get(C.DESCRIPTION_ATTR);if(s){var i='<div class="card-description">';t.isRDFTask()?e.replace("<pre></pre>",""):i+="<pre>";var a=e.indexOf(i)+i.length;e=e.slice(0,a)+s+e.slice(a)}return e},deleteItemClassName:function(){return"item-delete"},completeItemClassName:function(){return"item-complete"},launchItemClassName:function(){return"item-launch"},subscribeItemClassName:function(){return"item-subscribe"},unsubscribeItemClassName:function(){return"item-unsubscribe"},assignToSelfItemClassName:function(){return"item-assign"},editItemClassName:function(){return"item-edit"},approveItemClassName:function(){return"item-approve"},rejectItemClassName:function(){return"item-reject"},abstainItemClassName:function(){return"item-abstain"},toggleSubscription:function(){this.model.save("subscribed",String(!this.subscribedToItem()).toUpperCase(),{patch:!0,onFailure:function(){var e=v("emxCollaborativeTasks.Error.FailSubscription");l.displayError(e)}})},deleteItemAccess:function(e){return(e||this.model).canDelete(!0)},duplicateItemAccess:function(t){var s=!1,i=t||this.model;return s=e.is(i.canModify,"function")&&!i.canModify(!0),i.get&&!i.get("dsxplan:jsType")&&(s=!0),s},completeItemAccess:function(e){var t=e||this.model,s=!t.isComplete()&&t.get("canEdit");return s&&t.isProjectTask()&&"Yes"===t.get("needsReview")&&"Review"!==t.get("state")&&(s=!1),s},approvalActionsItemAccess:function(e){return(e||this.model).get("canApproveRejectAbstain")},reOpenItemAccess:function(e){var t=e||this.model,s=!t.isRouteTask()&&t.isComplete();return t.isRDF&&(s=s&&t.get("canEdit")),s},subscribedToItem:function(){var e=this.model&&this.model.get("subscribed");return void 0===e&&(e="false"),"TRUE"===e},isModelAProjectTask:function(){return this.model&&this.model.isProjectTask()},deleteItemCallback:function(t,s){var i=e.clone(s||{},!1),a=i.model||this.model,o=i.parentView||this._parentView;e.extend(i,{model:a,parentView:o}),this.deleteItemAccess(a)&&(d.deleteItem(i),l.trackPageEvent({scope:window.widget&&window.widget.getValue("appId"),eventCategory:"taskMenu",eventAction:"delete",eventLabel:"model",eventValue:a}))},duplicateItemCallback:function(t,s){var i=e.clone(s||{},!1),a=i.model||this.model,o=i.parentView||this._parentView;e.extend(i,{model:a,parentView:o}),this.duplicateItemAccess(a)||h.duplicateItem(i)},openProjectItemCallback:function(t){var i="string"===e.typeOf(t)?t:this.model.id,a=s.calculateFinalUrl("/emxLogin.jsp?appName=ENOPRPR_AP&physicalId="+i);return window.open(a,"projectWindow"),!0},openIteropItemCallback:function(t){var s="string"===e.typeOf(t)?t:this.model.id;return require(["DS/TransientWidget/TransientWidget"],function(e){e.showWidget("ENXBPPY_AP","Widget title",{objectType:"bpa:Task",objectId:s})}),!0},getStateValues:function(){return this.options&&this.options.stateValues||this.getColumn&&this.getColumn().options.stateValues||[{actualValue:C.ACTIVE,displayValue:v("E6WCommonApps.Label.InWork")},{actualValue:C.COMPLETE,displayValue:v("E6WCommonApps.Label.Completed")}]},toggleStateIntoOrOutOfDone:function(t,s){var i,a,o=e.clone(s||{},!1),n=t||this.model,r=this.getStateValues(),c=r&&r.length,d=n.get("dsxplan:jsType")||n.get("type");a=l.isMilestone(d)||l.isGate(d)?n.isComplete()?"Review":"Complete":n.isComplete()?"Active":"Complete";for(var h=0;h<c;h++)if(r[h].actualValue===a){i=r[h];break}let u={};o.multiEdit&&(u=o,o.batchGenerator&&(o.batchGenerator.iState=i)),n.isComplete()?this.reOpenItem(i,n,u):this.completeItem(i,n,u)},reOpenItem:function(t,s,i){var a=e.clone(i||{},!1),o=s||this.model,n=e.clone(t,!1);o.isRDF&&(n.displayValue=v("emxCollaborativeTasks.Label.InProgress"));var l=this.stateChangeOptions(n.displayValue,"",o);a.multiEdit?p.massStateUpdate({model:o,attrs:{state:n.actualValue},callbackOptions:a,iState:t}):o.save("state",n.actualValue,l)},completeItem:function(t,s,i){var a=e.clone(i||{},!1),o=s||this.model;if(!o.isComplete()){var n=e.clone(t,!1);o.isRDF&&(n.displayValue=v("emxCollaborativeTasks.Label.Done"));var l=v("emxCollaborativeTasks.Error.FailSetToComplete"),r=this.stateChangeOptions(n.displayValue,l,o),c={state:n.actualValue};if(a.multiEdit)return void p.massStateUpdate({model:o,attrs:c,callbackOptions:a,iState:t});o.save(c,r)}},createApprovalActionsControl:function(e){var t=this;return new a({buttons:[new o({icon:e.fonticon,events:{onClick:function(){var e=this.elements.content.getParent(".panel-action"),s="Approve";e.hasClassName("item-reject")?s="Reject":e.hasClassName("item-abstain")&&(s="Abstain"),t.handleApprovalActions(t.model,s)}}}),new o({dropdown:{items:this.getApprovalMenuItems([],t.model)}})]})},handleApprovalActions:function(e,t){var s=e||this.model,i=s&&"No"!==s.get("needsReview");if(!s.isComplete()){this._detailsView&&this._detailsView.model.modificationsPending&&this._detailsView.model.save();var a={};a.routeTaskApprovalAction=t;for(var o,n=this.options&&(this.options.stateValues||this._parentView.options.stateValues),l=n&&n.length,r=i?"Review":"Complete",c=0;c<l;c++)if(n[c].actualValue===r){o=n[c].displayValue;break}var d={actualValue:r,displayValue:o},h=v("emxCollaborativeTasks.Error.FailSetToComplete"),u=this.stateChangeOptions(d.displayValue,h,s);a.state=d.actualValue,s.save(a,u)}},stateChangeOptions:function(e,t,s){return{patch:!0,onComplete:function(){var t=v("emxCollaborativeTasks.Label.SuccessfullyChangedAttribute");t=(t=t.replace("%ATTRIBUTE_NAME%",v("emxCollaborativeTasks.Command.View.state"))).replace("%ATTRIBUTE_VALUE%",e),l.displaySuccess(t),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"complete-reOpen",eventLabel:"state, model",eventValue:{state:e,model:s}})},onFailure:function(s,i,a){var o;o=t||(o=(o=v("emxCollaborativeTasks.Error.FailedToChangeAttribute")).replace("%ATTRIBUTE_NAME%",v("emxCollaborativeTasks.Command.View.state"))).replace("%ATTRIBUTE_VALUE%",e),a&&a.response&&400===a.response.statusCode&&a.response.error&&(o+="<br>"+v(l.sanitizeMessage(a.response.error))),l.displayError(o)}}},assignToSelfItemAccess:function(e){return(e||this.model).canAssignToSelf()},assignToSelf:function(e,t){var s=e||this.model;this.assignToSelfItemAccess(s)&&s.assignToSelf(t)},menuId:function(){return"menu-card"},getParentView:function(){return(this._column||this)._parentView}}}),define("DS/CollaborativeTasks/Views/CardViewHandler",["UWA/Core","UWA/Class","DS/Handlebars/Handlebars4","DS/UIKIT/Input/Button","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/CollaborativeTasks/XTaskTagUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","text!DS/CollaborativeTasks/assets/templates/cardContent.html.handlebars","text!DS/CollaborativeTasks/assets/templates/cardHandler.html.handlebars","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s,i,a,o,n,l,r,c,d){"use strict";var h=d.get.bind(d),u=s.compile(r),p=s.compile(c),m=new Map;m.set("Low",n.PRIORITY_LOW_ICON),m.set("Medium",n.PRIORITY_MEDIUM_ICON),m.set("High",n.PRIORITY_HIGH_ICON),m.set("Urgent",n.PRIORITY_URGENT_ICON);var g=t.extend({_uwaClassName:"CardViewHandler",init:function(e){this._column=e.column},getCardHtml:function(e,t){return p({index:t,id:e.id,isChecked:e._isChecked,color:!e.isBlank&&o.getColorForModel(e),hasProgress:!e.isBlank,cardContent:this.getCardContentHtml(e)}).trim()},generateMenu:function(e){var s=e.querySelector(".card-menu"),a=this.createMenuButtons(),o=s.querySelector("button");s.removeChild(o),(a=new i(a)).inject(s);var n=new t.Listener;return n.listenTo(a.dropdown,"onShow",function(){document.addEventListener("contextmenu",a.dropdown.events.document.click,!0)}),n.listenTo(a.dropdown,"onHide",function(){document.removeEventListener("contextmenu",a.dropdown.events.document.click,!0)}),a},getCardContentHtml:function(e){e.calculateAndSetUpListenersForVisualAttributesIfNeeded();var t=e.dataForRendering({attributes:["id","title","card_icon","dueDate","assignees","name","firstname","lastname","state","stateForDisplay","priority",n.USER_DEFINED_START_DATE_ATTR,n.USER_DEFINED_END_DATE_ATTR,n.ACTUAL_DELIVERABLE_ATTR,n.ATTACHMENT_ATTR,"hasFiles","atRisk","readyToStart","late","compressionLevel","percentComplete"]});e.isBlank||this._addDataForLargeCards(e,t),t.multiselect=this.getColumn()._parentView._multiSelectMode,t.isChecked=e._isChecked,t.priority=m.get(t.priority),t.isFixed=t[n.USER_DEFINED_START_DATE_ATTR]||t[n.USER_DEFINED_END_DATE_ATTR],t.isComplete="Complete"===t.state,t.late?(t.status="late",t.percentCompleteTooltip=h("emxCollaborativeTasks.Label.Late")):t.atRisk?t.status="at-risk":t.readyToStart?(t.status="ready-to-start",t.compression=t.compressionLevel?"at-risk":"on-time"):t.isComplete?t.status="complete":t.status=t.compressionLevel?"at-risk":"on-time","at-risk"!==t.status&&"at-risk"!==t.compression||(t.percentCompleteTooltip=h("emxCollaborativeTasks.Label.Risk")),t.assignees&&t.assignees.length>3&&(t.moreAssignees=!0);var s=l.i18n;l.i18n=h;var i=u(t).trim();return l.i18n=s,i=this.setDescriptionForLargeCards(i,e)},_addDataForLargeCards:function(e,t){t.parent=e.getParentAsLabel(),t.explicitTagsData=e.get(n.EXPLICIT_TAGS_DATA)},setModel:function(e,t){this.model=e,this.cardDiv=t},dispatchEvent:function(e){"onTaskCardEdit"===e&&this._column.onTaskCardEdit(this.cardDiv,this.model),this.model.isBlank||this._column.cardClicked(this.cardDiv,this.model)},getColumn:function(){return this._column}});return g.implement(a),g}),define("DS/CollaborativeTasks/Collections/TasksCollection",["UWA/Core","UWA/Class/Promise","DS/Foundation/CsvParser","DS/Foundation/WidgetUwaUtils","DS/Foundation2/FoundationV2Data","DS/Foundation2/Collections/FoundationBaseCollection","DS/RDFFoundation/SecurityContextUtils","DS/CollaborativeTasks/Models/TaskModel","DS/CollaborativeTasks/Models/RouteTaskModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Collections/TasksSplitCollection","DS/RDFFoundation/Collections/CollectionTaggerHelper","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g){"use strict";var C=function(e){var t=m.get(e);return t===e&&(t=g.get(e)),t===e&&(t=a.getWidgetConstant.apply(this,arguments)),t},T=h.DUE_DATE_CATEGORY,f=h.PAST_DUE,v=h.NO_DATE,S=h.DUE_TODAY,b=h.DUE_TOMORROW,_=h.DUE_THIS_WEEK,D=h.DUE_FUTURE,k=function(e){return e&&e.actualValue||e},A=o.extend({_uwaClassName:"TasksCollection",model:l,getModelBasedOnType:function(e){var t=l;return"Inbox Task"===e&&(t=r),t},_prepareModel:function(e){return this.model=this.getModelBasedOnType(e.type),this._parent.apply(this,arguments)},setAttrToSplitBy:function(e,t){if(t&&this._attrToSplitBy!==e){var s=Object.prototype.hasOwnProperty;for(var i in this._TasksByAttr)s.call(this._TasksByAttr,i)&&this._cleanupSubCollectionForAttr(i)}this._attrToSplitBy=e},addNewTask:function(){var e=this.add.apply(this,arguments);if(window.widget){var t=d.getScopeId(),s=d.getScopeType(),i=d.getObjectData();if(t&&(!d.isScopeRDF()||d.isAgileWorkContext())){var a=-1===this.projectTypes().split(",").indexOf(s)?"scopes":"DPMProject";"tempfix"!==(t=i?i.id:t)&&e.addObjects([t],a)}}return e},setup:function(t,s){var o=Array.prototype.slice.call(arguments,0);if(window.widget){var n=i.getContext().split(".");n&&n.length&&(this.collabSpace=n[n.length-1])}this.fetching=0,this._TasksByAttr={},this._attrToSplitBy="state",this.extid="allTasks";var l=e.clone(s,!1);l.serviceName="/resources/v1/modeler/tasks",l.initialLoadOptions="$include=none&$fields=none,title,modifyAccess,hasWorkContext,deleteAccess,state,dueDate,routeTaskDueDate,routeOwnerTask,routeOwner&$definition=true&$terse=true",l.completeOptions="$terse=true&$include=co-owners,predecessors,successors&$fields=deliverablesInheritance,isAssigneeAccessRestricted,calculateDuration,revision,custom,references.description,deliverables.description,routeOwner",o[1]=l,this._translate=s.translate,this.addEvent("onSync",this._onSync),this.dictionaryLoaded=!1,this._allStates=[{actualValue:"Create",displayValue:C("emxCollaborativeTasks.Label.Preliminary")},{actualValue:"Assign",displayValue:C("emxCollaborativeTasks.Label.ToDo")},{actualValue:"Active",displayValue:C("emxCollaborativeTasks.Label.InWork")},{actualValue:"Review",displayValue:C("emxCollaborativeTasks.Label.InReview")},{actualValue:"Complete",displayValue:C("emxCollaborativeTasks.Label.Completed")}];for(var r=this._allStates.length,c=0;c<r;c++){var d=this._allStates[c];a.setWidgetConstant(d.actualValue,d.displayValue)}var h=this.data();h&&h.definitions?this._allDueDates=this._getDefRange(T):this._allDueDates=[{actualValue:f,displayValue:C("emxCollaborativeTasks.Label.Overdue")},{actualValue:v,displayValue:C("emxCollaborativeTasks.Label.NoDate")},{actualValue:S,displayValue:C("emxCollaborativeTasks.Label.Today")},{actualValue:b,displayValue:C("emxCollaborativeTasks.Label.Tomorrow")},{actualValue:_,displayValue:C("emxCollaborativeTasks.Label.ThisWeek")},{actualValue:D,displayValue:C("emxCollaborativeTasks.Label.Future")}],this._allStatesForDisplay=[{actualValue:"To Do",displayValue:C("emxCollaborativeTasks.Label.ToDo")},{actualValue:"In Progress",displayValue:C("emxCollaborativeTasks.Label.InProgress")},{actualValue:"Done",displayValue:C("emxCollaborativeTasks.Label.Done")}],r=this._allStatesForDisplay.length;for(c=0;c<r;c++)d=this._allStatesForDisplay[c],a.setWidgetConstant(d.actualValue,d.displayValue);this._parent.apply(this,o)},setSearch:function(e){this._search=e,this._cleanupSubCollections(),this.dispatchEvent("onChange:search")},resetSearch:function(){delete this._search,this._cleanupSubCollections(),this.dispatchEvent("onChange:search")},getSearch:function(){return this._search},dataForRendering:function(){return{collabSpace:this.collabSpace}},tasksWithAttrValue:function(e,t){var s=this,i=t||this._attrToSplitBy,a=k(e);return this.filter(function(e){var t=k(e.get("state")),o=k(e.get(i)),n=k(e.get("title")||e.get("text")),l=!s._search||c.match(s._search,n);return(i!==h.DUE_DATE_CATEGORY||"Complete"!==t)&&(o===a&&l)})},tasksWithAttrValueCollection:function(e,t){if(void 0!==e){var s=t||this._attrToSplitBy,i=k(e),a=this._TasksByAttr[s];if(!a||!a[i]){var o=this.tasksWithAttrValue(e,s),n={filterAttr:s,valueForFiltering:e,parentCollection:this},l=new A.TasksSplitCollection(o,n);l.extid="tasks-"+s+"-"+i,a||(this._TasksByAttr[s]=a={}),a[i]=l}return a[i]}},_getDefRange:function(e,t){var s,i=a.getAllFields(this.data())[e],o=[];if(i&&i.range)for(var n=i.range.item,l=n.length,r=0;r<l;r++){var c=n[r];s=t&&t.translateUsingE6WCommonAppsNLS?C("E6WCommonApps.Label."+c.display):C("emxCollaborativeTasks.Label."+c.display.replace(/ /g,"")),o.push({actualValue:c.value,displayValue:this._translate?s:c.display})}return o},allTaskRequirements:function(){if(!this._allTaskRequirements){var e=this.data();e&&e.definitions&&(this._allTaskRequirements=this._getDefRange("taskRequirement"))}return this._allTaskRequirements},allStates:function(){return this._allStates},allDueDates:function(){return this._allDueDates},allRouteTaskApprovalActions:function(e){return this._allRouteTaskApprovalActions||(this._allRouteTaskApprovalActions=this._getTranslatedAttributeValues("routeTaskApprovalAction",e)),this._allRouteTaskApprovalActions},allRouteTaskActions:function(e){return this._allRouteTaskActions||(this._allRouteTaskActions=this._getTranslatedAttributeValues("routeTaskAction",e)),this._allRouteTaskActions},allRouteTaskStates:function(e){return this._allRouteTaskStates||(this._allRouteTaskStates=this._getTranslatedAttributeValues("routeTaskValidStates",e)),this._allRouteTaskStates},allRouteTaskNoReviewStates:function(e){return this._allRouteTaskNoReviewStates||(this._allRouteTaskNoReviewStates=this._getTranslatedAttributeValues("routeTaskValidStates",e),this._allRouteTaskNoReviewStates&&this._allRouteTaskNoReviewStates.splice(1,1)),this._allRouteTaskNoReviewStates},_getTranslatedAttributeValues:function(e,t){var s,i=this.data();if(i&&i.definitions)for(var o=(s=this._getDefRange(e,t)).length,n=0;n<o;n++){var l=s[n];a.setWidgetConstant(l.actualValue,l.displayValue)}return s},setFlagForReferencedSimulationsService:function(e){widget.setValue("referencedSimulations",e.some(function(e){return"referencedSimulations"===e.name}))},allStatesForDisplay:function(){return this._allStatesForDisplay},allPrioritiesForDisplay:function(){return this._allPrioritiesForDisplay||(this._allPrioritiesForDisplay=this._getTranslatedAttributeValues("priority",{translateUsingE6WCommonAppsNLS:!0})),this._allPrioritiesForDisplay},allValues:function(){switch(this._attrToSplitBy){case T:return this.allDueDates();case"state":return this.allStates();case"stateForDisplay":return this.allStatesForDisplay();case"priority":return this.allPrioritiesForDisplay();default:return[]}},getSearchTypes:function(e,t){var s,i=this._getDefRange(e);return i&&i.length&&(s=i[0][t]),s},scopesTypesForSearch:function(){return this.getSearchTypes("scopes.scopesTypesForSearch","actualValue")},scopesTypes:function(){return this.getSearchTypes("scopes.scopesTypesForSearch","displayValue")},contentsTypesForSearch:function(){return this.getSearchTypes("contents.contentsTypesForSearch","actualValue")},contentsTypes:function(){return this.getSearchTypes("contents.contentsTypesForSearch","displayValue")},deliverablesTypesForSearch:function(){return this.getSearchTypes("deliverables.deliverablesTypesForSearch","actualValue")},deliverablesTypes:function(){return this.getSearchTypes("deliverables.deliverablesTypesForSearch","displayValue")},projectTypesForSearch:function(){return this.getSearchTypes("projectTypesForSearch","actualValue")},projectTypes:function(){return this.getSearchTypes("projectTypesForSearch","displayValue")},importTasksFromCSV:function(e,i){var a,o,n,l,r,c=s.parse(e),d={},h=c.length,u=[],p=[],m="";function g(e,s,i,a){return new t(function(t,i){var o={onComplete:function(){s.forEach(function(e){e._onCompleteRequest()}),t(s)},onFailure:function(){s.forEach(function(e){e._onCompleteRequest()}),i(new Error("timeout for: "+a))}};e.save(null,o)})}if(h)for(n=(o=c[0]).length,l=0;l<n;l++)(r=o[l].toLowerCase().trim()).match(/^(name|estimated duration|estimated finish date|type|description|assignee)$/)&&u.push({index:l,value:r.trim()});for(var C=this.allStates()[0],T=u.length,f=[],v=1;v<h;v++){o=c[v],(d={}).state=C;var S=[];for(l=0;l<T;l++){switch(r=o[u[l].index].trim(),u[l].value){case"name":d.title=r;break;case"estimated duration":d.estimatedDuration={actualValue:parseFloat(r),displayValue:r};break;case"estimated finish date":d.dueDate={actualValue:new Date(r).getTime(),displayValue:r};break;case"description":d.description={actualValue:r,displayValue:r};break;case"type":d.type=r.toLowerCase();break;case"assignee":S=r.split(";")}}"task"!==d.type||isNaN(d.estimatedDuration.actualValue)||isNaN(d.dueDate.actualValue)||(a=this.addNewTask(d),S&&S.length&&a.addAssigneesByName(S),p.push(a),a._onRequest(),this.updateModelInFoundation("create",a,null),m+=", "+d.title),p.length&&p.length%5==0&&(f.push(g(a,p,0,m)),p=[],m="")}p.length&&f.push(g(a,p,0,m)),t.all(f).then(function(){i.onComplete()},function(){i.onFailure()})},_cleanupSubCollections:function(){var e=Object.prototype.hasOwnProperty;for(var t in this._TasksByAttr)e.call(this._TasksByAttr,t)&&this._cleanupSubCollectionForAttr(t)},_cleanupSubCollectionForAttr:function(e){var t=Object.prototype.hasOwnProperty,s=this._TasksByAttr[e];for(var i in s){if(t.call(s,i))s[i].stopListening(),delete s[i]}},sync:function(t,s,i){var o=i||{},n=this,r=n._getStorage();if("read"===t&&n.isServerFetch(s,o)&&o.partialRefresh){var c={data:[]},d=this.data();if(d&&d.data){d.data.forEach(function(e){var t={id:e.id,cestamp:e.cestamp};e.serviceId&&(t.serviceId=e.serviceId),c.data.push(t)});var h="refreshWidget="+JSON.stringify(c);return a.loadServiceData(this._partialRefreshServiceName,function(t){var s,i=n.data();if(a.copyDefinition(i,t),a.__updateCsrf(i,t),t&&t.success&&t.data){for(var l=t.data,c=l.length,d=0;d<c;d++){var h=l[d];switch(h.updateAction.toUpperCase()){case"DELETE":n.remove(h.tempId),a.unloadObjects(n.data(),[h.tempId]);break;case"MODIFY":var u=h,p=a.__getSourceObjectFromServerObject(i,u);a.__synchronizeSourceObjectFromServerObject(i,u,p,!0,!0);break;case"CREATE":delete(u=h).updateAction;var m=new(n.getModelBasedOnType(h.type))(u);a.__addOrConnectObjectToStructure(i,void 0,void 0,u,void 0,m),n.add(m)}}r&&a.saveCachedData(r,n._serviceName,i),e.is(o.onComplete,"function")&&(s=o.onComplete(t,o))}else e.is(o.onFailure,"function")&&(s=o.onFailure(t,o));return s},!0,h,"application/x-www-form-urlencoded; charset=utf-8","$include=co-owners,predecessors,successors")}}else if(s instanceof l){var u=s;!u.toJSON({onlyUpdated:!0}).subscribed&&u.subscriptionsEnabled()&&u.set("sendEmail","sendEmail")}return this._parent.apply(this,arguments)},_onSync:function(e,t,s){if(e===this&&!this.dictionaryLoaded){var i=this.data();i&&i.definitions&&(this.dictionaryLoaded=!0,this.setFlagForReferencedSimulationsService(i.definitions),this.dispatchEvent("onChange:dictionary"))}},fetch:function(t){var s=this,i=e.clone(t||{},!1),a=d.getObjectData();if(!(!a||d.isAgileWorkContext()&&"3DSpace"===a.serviceId)&&(d.isScopeRDF()||i.forceRDF))return"local"===this.lastReadFrom&&(this.lastReadFrom="server",this.dispatchEvent("onChange:lastReadFrom",[this,this.lastReadFrom,t])),this.clearData(),this.reset(void 0,i),this.getTNProxy().setSubjectsTags({},"foundation2"),{cancel:function(){},noFetch:!0};const o=function(){s.fetching--};this.fetching++;const n=i.onComplete,l=i.onFailure;return i.partialRefresh?(void 0===i.parse&&(i.parse=!0),i.onComplete=function(e){o(),n&&n(s,e,i)},i.onFailure=function(e){o(),l&&l(s,e,i),s.dispatchEvent("onError",[s,e,i])},s.sync("read",s,i)):(i.onComplete=function(e){o(),n&&n(s,e,i)},i.onFailure=function(e){o(),l&&l(s,e,i)},this._parent(i))},fetchTaskById:function(t,s){this.fetch(e.extend({server:!0,url:"/resources/v1/modeler/tasks",method:"POST",data:"$ids="+t,contentType:"application/x-www-form-urlencoded"},s))},getModelsAsArrayToHandleTagger:p.getModelsAsArrayToHandleTagger});return A.optimized=!0,A.TasksSplitCollection=u.extend({model:l}),A}),define("DS/CollaborativeTasks/Views/CardView",["UWA/Core","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/Handlebars/Handlebars4","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonUI/Views/FoundationBaseView","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/DragUtil","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/CollaborativeTasks/Models/TskCloneModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ComponentProxyModel","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/CompassUtil","DS/E6WCommonApps/TaggerChipColorMixin","DS/E6WCommonApps/CSRFUtil","DS/E6WCommonUI/URLUtils","DS/E6WCommonUI/FeatureFlagUtils","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS","text!DS/CollaborativeTasks/assets/templates/card.html.handlebars"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,b,_,D,k,A,w,E){"use strict";l.fixDisplayMessageMethod();var y=function(e){var t=u.getWidgetConstant.apply(this,arguments);return t===e&&(t=k.get(e)),t},M=i.compile(E),I=".wux-controls-responsivetileview-checkbox",V=o.extend({_uwaClassName:"CardView",className:"card real-card drop-target",name:"CollaborativeTasks.CardView",domEvents:{"click .card-content":"onClickTaskCard","dragover ":"handleDragOver","dragleave ":"handleDragLeave","drop ":"handleDrop","dragend .drop-target":"handleDragEnd","dragstart ":"handleDragStart","mouseover .card-content":"handleMouseOver","mouseout .card-content":"handleMouseLeave"},droppedData:null,onClickTaskCard:function(e,t){e&&e.target&&e.target.hasClassName&&e.target.hasClassName("wux-controls-responsivetileview-checkbox")?this.onClickSelection():this.dispatchEvent("onTaskCardClicked",[this,t])},_toggleMultiSelectUI:function(e){try{let t=this.getColumn(),s=t&&t.getParentView();e=!!(e||s&&s._multiSelectMode),this.container.getElement(I).toggleClassName("wux-ui-state-prehighlighted",e)}catch(e){console.error(e)}},handleMouseOver:function(){this.container.addClassName("border-active"),this._toggleMultiSelectUI(!0)},handleMouseLeave:function(){this.container.removeClassName("border-active"),this._toggleMultiSelectUI(!1)},onClickSelection:function(){this.container.getElement(I).classList.remove("wux-ui-state-prehighlighted"),this.dispatchEvent("onMultiSelection",[this,{multiselect:!0}])},multiSelect:function(){this.onSelectCheckbox(),this.onSelect(),this.model._isChecked=!0},multiUnselect:function(){this.onUnselect(),this.onUnselectCheckbox(),this.model._isChecked=!1},onSelectCheckbox:function(){this.container.toggleClassName("checkbox-selected",!0),this.container.getElement(I).toggleClassName("wux-ui-state-highlighted",!0),this.getColumn().getParentView().getElements(`.collaborative-tasks-content ${I}`).forEach(function(e){e.classList.add("wux-ui-state-prehighlighted")})},onUnselectCheckbox:function(){this.container.toggleClassName("checkbox-selected",!1),this.container.getElement(I).removeClassName("wux-ui-state-highlighted")},isSelected:function(){return this.container.className.contains(this._getActiveClassName())},isMultiSelected:function(){var e=this.container.getElement(I);if(e)return e.className.contains("wux-ui-state-highlighted")},onSelect:function(){this.container.toggleClassName(this._getActiveClassName(),!0),v.publishOnPlatformAPI(window.widget.getValue("appId")+".select",this.model)},onUnselect:function(){this.container.toggleClassName(this._getActiveClassName(),!1),v.publishOnPlatformAPI(window.widget.getValue("appId")+".unselect",this.model)},_getActiveClassName:function(){return l.isTouchDevice()?"touch-active":"active"},id:function(){return"card"+(this.model.extid?this.model.extid:this.model.cid)},destroy:function(){this.container.innerHTML="",this._tooltip&&this._tooltip.destroy(),this.cardMenu&&this.cardMenu.dropdown&&this.cardMenu.dropdown.destroy(),this.cardMenu&&this.cardMenu.destroy(),delete this.cardMenu,this._parent()},_changeDirty:function(){this.container.toggleClassName("pending-modification",this.model.nbInFlightRequests>0),this.showSubscriptionIcon()},setup:function(e){var t=this;return this._parent.apply(this,arguments),!l.isTouchDevice()&&this.container.addEventListener("contextmenu",function(e){e.preventDefault();let s=t.displayMenu.bind(t,e);return t.dispatchEvent("onTaskCardContextMenu",[t,s]),!1},!1),this.listenToModelEvent(),e},updateButtons:function(){this._emptyMenuButtons(),this._drawMenuButtons()},listenToModelEvent:function(){var e=this,t={onChange:function(t,s){s&&s.relationshipChanged||e.render(),"assignees"===s.relationshipChanged||"contents"===s.relationshipChanged?e.render():!s||"references"!==s.relationshipChanged&&"deliverables"!==s.relationshipChanged&&"referencedSimulations"!==s.relationshipChanged||e.showAttachmentIcon()},"onChange:nbInFlightRequests":this._changeDirty};t["onChange:"+p.USER_DEFINED_START_DATE_ATTR]=this.showFixedIcon,t["onChange:"+p.USER_DEFINED_END_DATE_ATTR]=this.showFixedIcon,t["onChange:"+p.COMPLETE_PERCENT_ATTR]=this.showProgress,t["onChange:hasProject"]=this.updateButtons,t["onChange:DPMProject"]=function(){this.updateButtons();var e=this.model.get("DPMProject");e&&e[0]&&this.render()},t["onChange:route"]=this.render,t["onChange: "+p.EXPLICIT_TAGS_DATA]=this.render,t.onModifyAccessChanged=this.updateButtons,t.onDeleteAccessChanged=this.updateButtons,t.onUserGroupMembersFetched=function(){this._event?this.displayMenu(this._event):this.updateButtons()},this.addTaggerChipColorChangeEvents(),this.listenTo(this.model,t)},template:function(){var e,t=this.model.dataForRendering({attributes:["id","card_icon","title","cardTitle","actualName","dueDate","assignees","name","firstname","lastname","state","stateForDisplay","priority","percentComplete"]});switch(t.cardTitle=t.cardTitle||t.title,this._addDataForLargeCards(t),t&&t.priority){case"Low":e=p.PRIORITY_LOW_ICON;break;case"Medium":e=p.PRIORITY_MEDIUM_ICON;break;case"High":e=p.PRIORITY_HIGH_ICON;break;case"Urgent":e=p.PRIORITY_URGENT_ICON}t.priority=e,t.notRDF=!(this.model.isRDFTask()||this.model.isIteropTask()),t.subtitle=this.model.get(p.DESCRIPTION_ATTR);var s=a.i18n;a.i18n=y;var i=M(t);return a.i18n=s,i},_addDataForLargeCards:function(e){e.parent=this.model.getParentAsLabel(this.model),e.explicitTagsData=this.model.get(p.EXPLICIT_TAGS_DATA)},updateCardViewonScroll:function(){try{let t=this.getColumn();var e=t&&t.getParentView();e&&(e._selectedModels.length>0&&!e._selectedModels.includes(this.model)?(this.onUnselect(),this.onUnselectCheckbox()):e._multiSelectMode&&e._selectedModels.includes(this.model)&&(this.onSelect(),this.onSelectCheckbox()))}catch(e){console.error(e)}},render:function(){if(this.container){this.container.innerHTML=this.template(),this.container.setAttribute("draggable","true"),this._drawMenuButtons(),this.setDefaultImages(),this.showAttachmentIcon(),this._changeDirty(),this.showFixedIcon(),this.showAtRiskOrLateness(),this.showGreyPriorityIcon(),this.showProgress(),this.colorTaggerChip(),this._toggleMultiSelectUI(),this.updateCardViewonScroll();var e=this.model.get("assignees");e&&this.container.toggleClassName("more-assignees",Boolean(e.length>3))}return this},showAtRiskOrLateness:function(){var e=this.model.isLate(),t=this.model.isAtRisk(),s=this.model.isComplete(),i=this.model.isReadyToStart(),a=this.container.getElement(".card-progress span");this.container.removeClassName("at-risk"),this.container.removeClassName("late"),this.container.removeClassName("ready-to-start"),this.container.removeClassName("complete"),this.container.removeClassName("on-time"),e?(this.container.addClassName("late"),a&&a.setAttribute("title",y("emxCollaborativeTasks.Label.Late"))):t?(this.container.addClassName("at-risk"),i&&this.container.addClassName("ready-to-start")):i?(this.container.addClassName("ready-to-start"),this.container.addClassName("on-time")):s?this.container.addClassName("complete"):this.container.addClassName("on-time"),this.container.hasClassName("at-risk")&&a&&a.setAttribute("title",y("emxCollaborativeTasks.Label.Risk"))},showFixedIcon:function(){this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("is-fixed",Boolean(this.model.fixed))},showAttachmentIcon:function(){var e=this.model.get("references")||[],t=this.model.get("deliverables")||[],s=[];e.toArray&&(e=e.toArray()),t.toArray&&(t=t.toArray());var i=e.concat(t);D.referencedSimulationsEnabled()&&((s=this.model.get("referencedSimulations")||[]).toArray&&(s=s.toArray()),i=i.concat(s)),this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("has-files",Boolean(i.length))},showSubscriptionIcon:function(){var e=this.model.get("subscribed");this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("subscribed",this.model.subscriptionsEnabled()&&"TRUE"===e&&!this.model.isProjectTask()&&!this.model.isRouteTask())},showGreyPriorityIcon:function(){this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("is-complete",Boolean(this.model.isComplete()))},showProgress:function(){this.container.toggleClassName("has-progress",this.model.isRDFTask()||this.model.isProjectTask())},_emptyMenuButtons:function(){var e=this.getElement(".card-menu");e&&(this.cardMenu.dropdown&&this.cardMenu.dropdown.destroy(),e.empty())},displayMenu:function(e){var t=this;(this.updateButtons(),l.showAndUpdateContextualDropdownMenuPosition(t.cardMenu.dropdown,e),this._event=e,this.model.hasFetchedAccessData())||this.model.getAccessBatch().sendBatch({onComplete:function(){t.displayMenu(e)}})},_drawMenuButtons:function(){var e=this.getElement(".card-menu"),i=this.createMenuButtons();if(e){this.cardMenu&&this.cardMenu.destroy(),this.cardMenu=new s(i).inject(e);var a=this;this.cardMenu.addEvent("onClick",function(e){let t=a.displayMenu.bind(a,e);return a.dispatchEvent("onTaskCardContextMenu",[a,t]),!1}),this.cardMenu.elements.container.setStyle("min-width",""),this._tooltip=new t({target:this.cardMenu.elements.container,body:y("emxCollaborativeTasks.Label.TaskMenu")}),this.listenTo(this.cardMenu.dropdown,"onShow",function(){this._parentView&&this._parentView.setDropdown(this.cardMenu.dropdown),document.addEventListener("contextmenu",this.cardMenu.dropdown.events.document.click,!0)}),this.listenTo(this.cardMenu.dropdown,"onHide",function(){document.removeEventListener("contextmenu",this.cardMenu.dropdown.events.document.click,!0)})}},handleDragStart:function(t){var s=[],i=this.getColumn&&this.getColumn().getParentView()._selectedModels;let a;i&&0!==i.length?s=i:e.is(this.model,"array")?s=this.model:s.push(this.model),s.forEach(function(e){try{if(!e.isIteropTask()){var t=e.getTransferObject();a?a.data.items.push(t.data.items[0]):a=t}}catch(e){console.error(e)}}),a&&(r.setDragModels(s),r.setDragTransferData(t,a))},canDragOverCard:function(){var e=!1;return!r.getDragModels()&&(e=this.model.isRDFTask()||"complete"!==this.model.get("state").toLowerCase()),e},handleDragOver:function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!!this.canDragOverCard()&&(e.dataTransfer.dropEffect="copy",this.container.addClassName(p.DROP_CLASS_NAME),!1)},handleDragEnter:function(){if(!this.canDragOverCard())return!1;o.getViewFromContainer(this.container.getClosest(".column"))._parentView.clearAllDropZoneMasks(),this.container.addClassName(p.DROP_CLASS_NAME)},handleDragLeave:function(e){e.target.getParent().toggleClassName(p.DROP_CLASS_NAME,!1)},handleDrop:function(e){if(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.container.removeClassName(p.DROP_CLASS_NAME),!this.canDragOverCard())return!1;var t=e.dataTransfer.files;if(t&&t.length){if(this.model.uploadFiles){var s=this,i=this.model.get("state");i=i?i.toLowerCase():i;var a="references";"active"!==i&&"review"!==i&&"complete"!==i||(a="deliverables");var o={onFailure:function(e,t,i){var o={fieldName:s.model.getMappedAttribute(a),fileName:i&&i.file&&i.file.name};s.model.onFileUploadFailureMessage(o,e)}};if(o.fieldName=this.model.getMappedAttribute(a),o.onComplete=function(e,i,o){var r=o.documentObject,c=o.fileName,d=y("emxCollaborativeTasks.Label.SuccessfulSave");1===t.length&&(r.relateddata&&r.relateddata.files&&r.relateddata.files.length?c=r.relateddata.files[0].dataelements.title:r.dataelements&&r.dataelements&&r.dataelements.length&&(c=r.dataelements[0].title),d=n.getAttachmentSuccessMessage(a,c)),o.onComplete=function(){l.displaySuccess(d)},s.model.onFileUploadCompleteMessage(o,r)},this.model.hasFetchedAccessData&&this.model.hasFetchedAccessData()&&this.model.canModify&&!this.model.canModify(!0))return l.displayError(A.get("E6WCommonUI.Error.noAccessOnObject")),!1;this.model.uploadFiles(t,a,o)}else l.displayError("emxCollaborativeTasks.Error.NoFileDrop");return!1}var r=l.getDataTransferJSON(e.dataTransfer);return r&&this.processDropData(r,e.dataTransfer),!1},handleDragEnd:function(){this.container.removeClassName(p.DROP_CLASS_NAME)},isValidObjectType:function(e){return"Person"===e.objectType||"pno:Person"===e.objectType||"Group Proxy"===e.objectType||"Group"===e.objectType||"foaf:Group"===e.objectType||e.objectType===p.LOGICAL_USER_TYPE},processDropData:function(e){var t=e.data.items,s=this.model.get("state");s=s?s.toLowerCase():s;for(let e=0;e<t.length;e++){const s=t[e];if(this.validateDroppedObject(s))return}let i="references";for(let e=0;e<t.length;e++){const d=t[e];var a=this.model instanceof n&&!this.model.isRouteTask(),o=d.objectType===p.SIMULATION_TYPE||d.objectType===p.SIMULATION_TEMPLATE_TYPE,r=d.objectType===p.TASK_RDF_TYPE||d.objectType===p.MILESTONE_RDF_TYPE,c=d.objectType===p.PROJECT_RDF_TYPE||d.objectType===p.XPROJECT_RDF_TYPE;this.isValidObjectType(d)?i="assignees":o&&a&&D.referencedSimulationsEnabled()?i="referencedSimulations":r||c||"active"!==s&&"review"!==s&&"complete"!==s||(i="deliverables");const h={save:e===t.length-1,onComplete:function(){if(1===t.length){var e=n.getAttachmentSuccessMessage(i,d.displayName);e&&l.displaySuccess(e)}else w.get("emxCollaborativeTasks.Success.ManyObjectsAdded").replace({OBJECT_COUNT:t.length})},onFailure:function(){if(1===t.length){var e=n.getAttachmentErrorMessage(i,d.displayName);e&&l.displayError(e)}else l.displayMessage(k.get("E6WCommonApps.Error.SaveFailed"))}};!d.objectType||"URL"!==d.objectType&&"dsplan:url"!==d.objectType?this.addAttributeToTask(d,i,h):this.createNewUrlObject&&this.createNewUrlObject(d,i,h)}},addAttributeToTask:function(e,t,s){this.model.isRDFTask()?this.addAttributeToRDFTask(e,t,s):this.addAttributeToNonRDFTask(e,t,s)},createNewUrlObject:function(t,s,i){let a=this,o={},n={id:t.objectId,name:t.displayName,title:t.displayName,type:t.objectType,linkURL:t.linkURL,description:t.description},l=function(o){let n=e.clone(t||{},!1),l=e.clone(o||{},!1);n.objectId=l.urlModel&&l.urlModel.id,a.addAttributeToTask(n,s,i)};if(this.model.isRDFTask())i.callback=l,"URL"===n.type&&(n=g.getNewProxyModel(n)),_.createURLForRDFObjects(this.model,n,i);else{if("dsplan:url"===n.type){let e=m.getObjectById(n.id);n={id:"dummyID",name:e.get("title"),type:"URL",linkURL:e.get("dsplan:linkURL"),description:""}}let l=g.getNewProxyModel(n);o[s]=[l],b.checkAndSetCSRF({targetObj:o,model:this.model,operation:"add",fieldName:s,callback:function(o){let n=e.clone(t||{},!1);n.objectId=o,a.addAttributeToTask(n,s,i)}},_.createOrDeleteURLForERTasks)}},addAttributeToRDFTask:function(e,t,s){if(this._tempCloneModel=this._tempCloneModel||new h(this.model),this._tempCloneModel.add(t,[e.objectId],{dropObj:e})&&s&&s.save){this._tempCloneModel.save({onComplete:function(){var s=n.getAttachmentSuccessMessage(t,e.displayName);s&&l.displaySuccess(s)},onFailure:function(){var s=n.getAttachmentErrorMessage(t,e.displayName);s&&l.displayError(s)},relationshipName:t,objectName:e.displayName}),delete this._tempCloneModel}},addAttributeToNonRDFTask:function(e,t,s){var i,a,o=e.objectType,r=this._getIdForDroppedItem(e);"pno:Person"===o&&(i="name",a=[{type:"Person",displayName:e.displayName}]);var c=this.model.addObjects([r],t,i,{otherObjectAttributes:a,attributes:{service:e.serviceId,tenant:e.envId},onFailure:function(e){l.displayError(e)}});c&&c.length&&s.save&&this.model.save(null,{onComplete:function(){var s=n.getAttachmentSuccessMessage(t,e.displayName);s&&l.displaySuccess(s)},onFailure:function(e,t,s){l.displayError(n.getAttachmentErrorMessage(s.relationshipName,s.objectName))},relationshipName:t,objectName:e.displayName,at:0})},_getFieldConfigForValidatingDrop:function(e){var t;return t=this.model instanceof n?C:T,this.isValidObjectType(e)?t.assigneeFieldConfig(this.model):t.attachmentFieldConfig},validateDroppedObject:function(e){var t,s=this._getFieldConfigForValidatingDrop(e);return(t=s.readWrite?f.validateDroppedObject(e,s):A.replace(A.get("E6WCommonUI.Alert.FailedToAttachObjectBadType"),{TYPE:e.displayType||l.translateType(e.objectType)}))&&l.displayError(t),t},_getIdForDroppedItem:function(e){var t=e.objectId;return this.model.isRDFTask()||"pno:Person"!==e.objectType||(t=m.splitUri(e.objectId)[1]),t},getColumn:function(){return this._parentView}});return V.implement(c,S),V}),define("DS/CollaborativeTasks/Collections/SourcingTaskCollection",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/SourcingTaskModel","DS/CollaborativeTasks/Collections/TasksCollection","DS/E6WCommonApps/Collections/TasksSplitCollection","DS/E6WCommonUI/PlatformManager"],function(e,t,s,i,a,o){"use strict";var n=i.extend({_uwaClassName:"SourcingTaskCollection",model:s,getModelBasedOnType:function(e){return s},setAttrToSplitBy:function(e){this._attrToSplitBy=e},_convertFoundationData:function(e){return e&&e.data&&(void 0===e.success||e.success)&&(e.definitions=this._3dspaceDefinitions),this._parent(e)},fetch:function(s){const i=e.clone(s||{},!1);return i.ignoreData||this.data()?this._parent.apply(this,arguments):(i.ignoreData=!0,t.loadServiceData("/resources/v1/modeler/tasks",e=>{this._3dspaceDefinitions=e.definitions,this.fetch(i)},!1,null,null,"$definition=nodata"))},sync:function(e,t,s){enoviaServer.setTempUrl(o.getServiceUrl("sourcing"));const i=enoviaServer.space;enoviaServer.space=void 0,s.noTag=!0,arguments[1]&&arguments[1]._initialLoadOptions&&arguments[1]._initialLoadOptions.includes("&$definition=true")&&(arguments[1]._initialLoadOptions=arguments[1]._initialLoadOptions.replace("&$definition=true",""));const a=this._parent.apply(this,arguments);return enoviaServer.setTempUrl(),enoviaServer.space=i,a},complete:function(e,t,s){this._getStorage();enoviaServer.setTempUrl(o.getServiceUrl("sourcing"));const i=enoviaServer.space;enoviaServer.space=void 0;const a=this._parent.apply(this,arguments);return enoviaServer.setTempUrl(),enoviaServer.space=i,a}});return n.optimized=!0,n.TasksSplitCollection=a.extend({model:s}),n}),define("DS/CollaborativeTasks/Views/ColumnView",["UWA/Core","UWA/Event","UWA/Class/View","DS/UIKIT/Scroller","DS/Handlebars/Handlebars4","DS/E6WCommonUI/Views/FoundationBaseView","DS/CollaborativeTasks/Collections/TasksCollection","DS/CollaborativeTasks/Views/CardView","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/UIKIT/Tooltip","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/DragUtil","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/XTaskScope","DS/RDFFoundation/RDFUtils","text!DS/CollaborativeTasks/assets/templates/column.html.handlebars","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v){"use strict";var S=function(e){var t=T.getWidgetConstant.apply(this,arguments);return t===e&&(t=v.get(e)),t},b=a.compile(C),_=o.extend({_uwaClassName:"ColumnView",tagName:"div",className:"column ds-dialog drop-target",name:"CollaborativeTasks.ColumnView",id:function(){return this.collection.extid},domEvents:{"dragstart .ui-droppable":"handleDragStart","dragenter .ui-droppable":"handleDragEnter","dragleave .ui-droppable":"handleDragLeave","dragover .ui-droppable":"handleDragOver","dragend .ui-droppable":"handleDragEnd","drop .ui-droppable":"handleDrop"},_addChildrenViewAtBack:function(){var e=this._childrenViews.length;this.resetChildViews(this._firstChild+e,!0),this._addChildrenToDom(e,void 0,!0)},_addChildrenViewAtFront:function(){var e=this._childrenViews.length,t=_.nbCardsBuffer-e;this.resetChildViews(Math.max(this._firstChild-t,0),!0,!0),this._addChildrenToDom(0,this._childrenViews.length-e,!0)},resizeBuffer:function(){var e=this._childrenViews.length;if(e<_.nbCardsBuffer&&e<this.collection.size()){var t=this.collection.size();if(this._firstChild+e>=t)this._addChildrenViewAtFront();else{this._addChildrenViewAtBack();var s=this._childrenViews.length;s<_.nbCardsBuffer&&s<this.collection.size()&&this._addChildrenViewAtFront()}}else if(e>_.nbCardsBuffer)for(var i;this._childrenViews.length>_.nbCardsBuffer;)i=this._childrenViews.pop(),this._recycleChild(i);this._adjustBufferHeights()},_onScroll:function(t){if(this.clearDropdown(),this.collection&&this.container){var s=e.Event.getElement(t);if(s&&this._childrenViews.length&&this.collection.length-this._childrenViews.length>0){_._cardHeight||this._computeCardHeight();var i=s.scrollTop,a=Math.floor(i/_._cardHeight),o=Math.max(a-_.nbCardsTopBuffer,0),n=(o=Math.min(o,this.collection.length-_.nbCardsBuffer))-this._firstChild;if(0!==n){if(n>0)if(n>=this._childrenViews.length)this.resetChildViews(o),this._addChildrenToDom(0,void 0);else{for(var l=0;l<n;l++){var r=this._childrenViews.shift();this._recycleChild(r)}this.resetChildViews(o+this._childrenViews.length,!0),this._addChildrenToDom(this._childrenViews.length-n,void 0)}else if(n<0)if((n=-n)>=this._childrenViews.length)this.resetChildViews(o),this._addChildrenToDom(0,void 0);else{for(var c=this._childrenViews.length-_.nbCardsBuffer+n,d=0;d<c;d++){var h=this._childrenViews.pop();this._recycleChild(h)}var u=this._childrenViews.length;this.resetChildViews(o,!0,!0),this._addChildrenToDom(0,this._childrenViews.length-u)}this._adjustBufferHeights()}}}},setDropdown:function(e){this.dropdown=e},clearDropdown:function(){this.dropdown&&(this.dropdown.hide(),delete this.dropdown)},_createTaskView:function(e){var t=new l({model:e,parentView:this});return this.listenTo(t,{onMultiSelection:function(){this.dispatchEvent("onMultiSelection",arguments)},onTaskCardClicked:function(){this.dispatchEvent("onTaskCardClicked",arguments)},onTaskCardEdit:function(){this.dispatchEvent("onTaskCardEdit",arguments)},onTaskCardContextMenu:function(){this.dispatchEvent("onTaskCardContextMenu",arguments)},onDestroy:function(){this.dispatchEvent("onTaskDestroyed",arguments)}}),t},_getRecycledChild:function(e){var t;return this._recycleBin&&this._recycleBin.length?((t=this._recycleBin.pop()).model=e,t.container.id=t.id(),t.listenToModelEvent(),delete t._recycled):t=this._createTaskView(e),t},_recycleChild:function(e,t){this.dispatchEvent("onTaskDestroyed",arguments),e._recycled=!0,e.container.remove(),e.container.empty(!0),this._recycleBin.push(e)},getNonRDFSelectedViewId:function(){var e=this.getParentView(),t=e&&e._selectedView;if(t&&!t.isDeleted&&t.model&&!t.model.isRDFTask())return t.model.id},resetChildViews:function(e,t,s){var i=e||0,a=this;this._childrenViews||(this._childrenViews=[]);var o=t?this._childrenViews.length:0;this._firstChild=i-(s?0:o);var n=a.collection.length,l=(i=Math.max(0,i))+(_.nbCardsBuffer-o);l=Math.min(n,l);var r={},c={};if(t)this._childrenViews.forEach(function(e){var t=e.model;r[t.id]=e});else{var d,h=[];for(let e=i;e<l;e++){let t=a.collection.at(e);c[t.id]=e}var u=a.getNonRDFSelectedViewId();this._childrenViews.forEach(function(e){var t=e.model;void 0===c[t.id]||isNaN(c[t.id])?a._recycleChild(e):(t.isRDFTask()||(a._recycleChild(e),(e=a._getRecycledChild(a.collection.get(e.model.id))).model.id===u&&(d=e)),h.push(e),r[t.id]=e)}),this._childrenViews=h,d&&this.getParentView().select(this,d)}if(s)for(var p=l-1;p>=i;p--){var m=a.collection.at(p);if(m&&r[m.id])continue;let e=a._getRecycledChild(m);a._childrenViews.unshift(e)}else for(let e=i;e<l;e++){var g=a.collection.at(e);if(!g||!r[g.id]){var C=a._getRecycledChild(g);if(c&&void 0!==c[g.id]&&!isNaN(c[g.id])){let e=l>_.nbCardsBuffer?c[g.id]-i:c[g.id];a._childrenViews||(a._childrenViews=[]),a._childrenViews[e]?a._childrenViews.splice(e,0,C):a._childrenViews[e]=C}else a.addChildView(C)}}},tasksChanged:function(){this.container.innerHTML="",this.resetChildViews(),this.render()},_onAdd:function(e,t,s){if(!s||!s.fromServer){var i,a=s&&s.at,o=this._getRecycledChild(e);if(o){this._childrenViews.splice(a,0,o);var n=this.getElement(_.CssSelectorMarkingInsertionPoint);o.render(),0===a?o.container.inject(n,"after"):o.container.inject(this.getElement(_.CssSelectorMarkingBottomInsertionPoint),"before")}if(_.lastCardAdded=o,this._scroller&&this._scroller.scrollToElement(o.container),this._childrenViews.length>_.nbCardsBuffer)i=0!==a?this._childrenViews.shift():this._childrenViews.pop(),this._recycleChild(i);e.id&&(_.pushToComplete(o),this.scheduleComplete()),this._adjustBufferHeights(),this.getElement(_.TitleObjectCountId).setText(_.TitleObjectCountString.replace("%COUNT%",this.collection.length))}},_onRemove:function(e,t,s){var i=this;this._childrenViews=this._childrenViews.filter(function(t){return t.model!==e||(i._recycleChild(t,s),!1)});var a=this._childrenViews.length,o=this.collection.length;this._firstChild+_.nbCardsBuffer>o&&_.nbCardsBuffer<o?(this.resetChildViews(this._firstChild-1,!0,!0),this._addChildrenToDom(0,this._childrenViews.length-a,!0)):(this.resetChildViews(this._firstChild+this._childrenViews.length,!0),this._addChildrenToDom(a,void 0,!0)),this._adjustBufferHeights(),this.getElement(_.TitleObjectCountId).setText(o?_.TitleObjectCountString.replace("%COUNT%",o):"")},onSortComplete:function(){let e=this._scroller.getInnerElement()&&this._scroller.getInnerElement().scrollTop;this.container.innerHTML="",this.resetChildViews(this._firstChild,!1),this.render(),this._scroller.scrollTo(0,e),this.resizeBuffer()},setup:function(e){return this._parent.apply(this,arguments),this._firstChild=0,this._scrolling=0,this.resetChildViews(),this.listenTo(this.collection,"sortComplete",this.onSortComplete),this.listenTo(this.collection,"onReset",this.tasksChanged),this.listenTo(this.collection,"onTaskCollectionFetchComplete",function(){this._parentView.isBeingTagFiltered()||this.tasksChanged()}),this.listenTo(this.collection,"onAdd",this._onAdd),this.listenTo(this.collection,"onRemove",this._onRemove),this.listenTo(this.collection,"onValidationFailure",function(e,t){var s;if(!(this._parentView&&this._parentView._multiSelectMode&&this._parentView._multiSelectMode.selectedModels&&this._parentView._multiSelectMode.selectedModels.length>1)){for(var i=0;i<t.fields.length;i++)"needsReview"===t.fields[i]?s=S("emxCollaborativeTasks.Error.needsReview"):"routeTaskApprovalComments"===t.fields[i]?s=S("emxCollaborativeTasks.Error.needsApprovalComments"):"routeTaskApprovalAction"===t.fields[i]?s=S("emxCollaborativeTasks.Error.needsApprovalAction"):"routeTaskReviewerComments"===t.fields[i]&&(s=S("emxCollaborativeTasks.Error.needsReviewerComments"));s&&d.displayError(s)}}),this._recycleBin=[],this.$dsTaskManagement=e.$dsTaskManagement,e},destroy:function(){clearTimeout(this.completeTimeout),delete this.completeTimeout,this.container.remove(),this._scroller&&this._scroller.destroy();for(var e=this._recycleBin.length,t=0;t<e;t++){this._recycleBin[t].destroy()}delete this._recycleBin,this._parent(),this.$dsTaskManagement=null,this.container=null,delete this._BottomPlaceholder,delete this._TopPlaceholder,this._taskFilterTooltip&&this._taskFilterTooltip.destroy(),delete this._taskFilterTooltip},template:function(){var e=f.i18n;f.i18n=S;var t=this.collection.dataForRendering(),s=t.filteredByValue&&t.filteredByValue.actualValue;"all"===widget.getValue(u.COMPLETED_TASK_PREF_NAME)||"Done"!==s&&"Complete"!==s||(t.completedTaskFilterOn=!0);var i=b(t);return f.i18n=e,i},displayDragAndDropSuccessMessage:function(){var e=this.getColumnFilterAttrValue(),t=S("emxCollaborativeTasks.Label.SuccessfullyChangedAttribute"),s=this.collection._valueForFiltering;s=s.displayValue?s.displayValue:s,t=(t=t.replace("%ATTRIBUTE_NAME%",S("emxCollaborativeTasks.Command.View."+e))).replace("%ATTRIBUTE_VALUE%",s),d.displaySuccess(t)},displayDragAndDropFailureMessage:function(e,t){var s=this.getColumnFilterAttrValue(),i=S("emxCollaborativeTasks.Error.FailedToChangeAttribute"),a=this.collection._valueForFiltering;a=a.displayValue?a.displayValue:a,i=(i=i.replace("%ATTRIBUTE_NAME%",S("emxCollaborativeTasks.Command.View."+s))).replace("%ATTRIBUTE_VALUE%",a),t&&t.response&&400===t.response.statusCode&&t.response.error?i+="<br>"+S(d.sanitizeMessage(t.response.error)):e&&"E6WCommonApps.Error.NoModifyAccess"===e.message&&(i=v.replace(v.get("E6WCommonApps.Error.NoModifyAccess"))),d.displayError(i)},processModelDrop:function(e,t){var s=this,i=this.getElement(".drop-zone-mask");i.addClassName("dropping");var a=this.collection.getSaveAttributes();setTimeout(function(){i.removeClassName("dropping")},500),e.save(a,{patch:!0,ajax:t&&t.ajax,onComplete:function(){t||s.displayDragAndDropSuccessMessage(),r.publishModelEvents(r.STATE_CHANGE_MODEL_EVENT,{data:e.id})},onFailure:function(e,i,a){t||s.displayDragAndDropFailureMessage(i,a)}})},_addChildrenToDom:function(e,t,s){for(var i=e||0,a=t?t+e:this._childrenViews.length,o=document.createDocumentFragment(),n=[],l=i;l<a;l++){var r=this._childrenViews[l];r.container.inject(o),n.push(r)}var c,d,h=this,u=function(){var e,t=n.length;e=!1;for(var i=0;i<t;i++){var a=n[i];!a._recycled&&a.model&&a.container&&(a.render(),a.model.completed||(e=!0,_.pushToComplete(a)))}_.toComplete&&_.toComplete.length&&e&&(s?h.complete():h.scheduleComplete())};n.length&&(s?u():setTimeout(u,21),t&&e+t<this._childrenViews.length&&(d=(c=this._childrenViews[e+t].container).parentElement),c&&!c._recycled||(d=(c=this._BottomPlaceholder).parentElement),d.insertBefore(o,c))},scheduleComplete:function(){this.completeTimeout||(this.completeTimeout=setTimeout(this.complete.bind(this),200))},complete:function(){if(this.collection&&_.toComplete){for(var e=[],t=0,s=_.toComplete.length;t<s;t++){var i=_.toComplete[t];!i._recycled&&i.model&&i.container&&e.push(i.model)}this.collection.complete(e,{onlyIfNeeded:!0}),delete _.toComplete}delete this.completeTimeout},_computeCardHeight:function(){var e=this._childrenViews[0];if(e){var t=e.container.getDimensions();t.height>0&&(_._cardHeight=t.outerHeight)}},_adjustBufferHeights:function(){if(this.collection){var e=Math.max(this.collection.length-this._childrenViews.length-this._firstChild,0);if(this._childrenViews[0]){_._cardHeight||this._computeCardHeight(),_._cardHeight||setTimeout(this._adjustBufferHeights.bind(this),0);var t=_._cardHeight||80;this._BottomPlaceholder&&this._BottomPlaceholder.setStyle("height",e*t),this._TopPlaceholder&&this._TopPlaceholder.setStyle("height",this._firstChild*t)}}},render:function(){for(var t=this,s=this._childrenViews.length,a=0;a<s;a++){t._childrenViews[a].container.remove()}t.container.empty(!0),delete this._BottomPlaceholder,delete this._TopPlaceholder,t.container.setHTML(this.template());var o=this.container.getElement(".fonticon-filter");o&&this.setCompletedTaskFilterToolTip(o),this._BottomPlaceholder=this.getElement(".bottom-buffer"),this._TopPlaceholder=this.getElement(".top-buffer");var n=t.getElement(_.CssSelectorMarkingInsertionPoint);n.getParent().setSelectable(!1),this._columnContent=t.getElement(".body"),this._scroller&&this._scroller.destroy();return this._scroller=new i({element:n.parentElement}).inject(this._columnContent),this.getElement(".scroller-content").addEventListener("scroll",function(s){if(t.container){var i=t.lastScrollEvtTime?t.lastScrollEvtTime:0,a=s.timeStamp-i>1e3,o=t.container.getElement(".scroller-content").scrollTop;if(0===t._scrolling&&(t.scrollTopPos!==o||a)){t.scrollTopPos=o,t.lastScrollEvtTime=s.timeStamp,t._scrolling++;var n=e.clone(s,!1);window.requestAnimationFrame(function(){t._onScroll(n),t._scrolling--})}}}),this._addChildrenToDom(0,void 0,!0),this._adjustBufferHeights(),this.container.addEvent("dragenter",this.handleDragEnter.bind(this)),this},setCompletedTaskFilterToolTip:function(e){var t=widget.getValue("completedTasksDisplayPref"),s=S("emxCollaborativeTasks.Label.CompletedTaskTopCountFilterToolTip");s=s.replace("%DAY_COUNT%",t),this._taskFilterTooltip=new c({target:e,body:s+"<br><br>"+S("emxCollaborativeTasks.Label.ChangeCompletedTaskFiltering")})},getVisibleModels:function(){var e=[];_._cardHeight||this._computeCardHeight();var t=this._scroller.getInnerElement(),s=t.scrollTop,i=Math.floor(s/_._cardHeight),a=t.getSize().height,o=Math.ceil(a/_._cardHeight);o=Math.min(o,this.collection.length);for(var n=0;n<o;n++)e.push(this.collection.at(n+i));return e},getColumnViewName:function(){var e=this.collection._valueForFiltering;return e.actualValue||e},getColumnFilterAttrValue:function(){var e=this.collection._filterAttr;return e.actualValue||e},canDragOverColumn:function(){var e=!1,t=h.getDragModels(),s=this;return t&&t.some(function(t){if(t){var i=s.getColumnViewName(),a=s.getColumnFilterAttrValue();e=t.get(a)!==i;var o=t.get("dsxplan:jsType")||t.get("type");e&&t.isRDFTask()?"state"===a?e="Assign"===i||"Active"===i||"Complete"===i:"dueDateCategory"===a&&(e="NO_DATE"!==i):e&&(d.isMilestone(o)||d.isGate(o))&&"state"===a&&(e="Create"===i||"Review"===i||"Complete"===i)}return e}),e},handleDragStart:function(e){var t=e.target,s=o.getViewFromContainer(t);h.setDragView(s),this.container.click()},handleDragEnter:function(){if(!this.canDragOverColumn())return this.container.toggleClassName(p.DROP_CLASS_NAME,!1),!1;this._parentView.clearAllDropZoneMasks(),this.container.getElement(".ui-droppable").toggleClassName(p.DROP_CLASS_NAME,!0)},handleDragOver:function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",!!this.canDragOverColumn(e)&&(this.container.getElement(".ui-droppable").toggleClassName(p.DROP_CLASS_NAME,!0),!1)},handleDragLeave:function(e){e.target.getParent().toggleClassName(p.DROP_CLASS_NAME,!1),this.adjustScrolling(e)},handleDragEnd:function(){h.setDragModels(),h.setDragView(),this._parentView.clearAllDropZoneMasks()},handleDrop:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this._parentView.detailsPanelManager.closeDetailPanelsIfTheyExist();var t=h.getDragModels(),s=this;const i=g.getBatchGenerator();return t&&t.forEach(function(e){s.canDragOverColumn()&&s._parentView._multiSelectMode?s.processModelDrop(e,i):s.canDragOverColumn()&&s.processModelDrop(e)}),this._parentView._multiSelectMode&&i.sendBatch({onComplete:function(){s.displayDragAndDropSuccessMessage()},onFailure:function(){s.displayDragAndDropFailureMessage()}}),h.setDragModels(),h.setDragView(),this._parentView.clearAllDropZoneMasks(),!1},adjustScrolling:function(e){var t,s;if(!this._parentView.autoScrolling)try{t=h.getDragView().container.offsetWidth,s=e.clientX;var i=this._parentView.container.offsetWidth,a=this._parentView.container.getOffsets().x;s+t-a>i+t/3?this._parentView.scrollRight():s-a<=t/3&&this._parentView.scrollLeft()}catch(e){}},getParentView:function(){return this._parentView},getSuperModal:function(){return this.getParentView().getSuperModal()}});return _.nbCardsBuffer=20,_.nbCardsTopBuffer=5,_.CssSelectorMarkingInsertionPoint=".top-buffer",_.CssSelectorMarkingBottomInsertionPoint=".bottom-buffer",_.TitleObjectCountId=".object-count",_.TitleObjectCountString="(%COUNT%)",_.pushToComplete=function(){_.toComplete||(_.toComplete=[]),_.toComplete.push.apply(_.toComplete,arguments)},_}),define("DS/CollaborativeTasks/Views/TasksTableView",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","UWA/Class/Promise","DS/DataGridView/DataGridView","DS/Tree/TreeDocument","DS/TreeModel/TreeNodeModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/TreeNodeUtil","DS/E6WCommonApps/CustomAttributeMixin","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/E6WCommonApps/DeleteUtil","DS/E6WCommonApps/TaskUtils","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Collections/FTSTaskPseudoCollection","DS/RDFFoundation/RDFUtils","DS/CollaborativeTasks/Views/TasksTableConfig","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/Collections/CollectionTaggerHelper"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S){"use strict";var b=T.columns,_={},D={};const k={};var A,w=function(e){return f.get(e)},E=t.extend({});E.implement(h),E.implement(s);var y=o.extend({_uwaClassName:"TasksTableView",tagName:"span",createTreeDocument:function(){var e=new n;return D={},e},getSelectedColumnInfo:function(){var e,t=this.layout._getDataFromPreferences("columnsSortModel");return t&&this.columns.forEach(s=>{s.dataIndex===t.dataIndex&&(e=s)}),e||this.columns[0]},addNodeToMap:function(e,t){D[e]=t,t.rdfModel&&(t.rdfModel.get("dsxplan:customExtensionName")||t.rdfModel.get("dsbase:extension"))&&this._addToQueue(e)},updateNodeAttr:function(e,t,s){D[e].setAttribute(t,s)},getTreeNodeModels:function(e){var t=e.tasksCollection,s=e.rdfTasksCollection,i=e.iteropTasksCollection,a=e.srcCollection;if((A=this.createTreeDocument()).prepareUpdate(),p.useFTS())this.showSubProjectTasks();else{var o=t.toArray();s&&(o=o.concat(s.toArray())),i&&(o=o.concat(i.toArray())),a&&(o=o.concat(a.toArray())),o.forEach(e=>{A.addChild(e.getTreeNodeModel()),this.addNodeToMap(e.id,e.getTreeNodeModel())})}return A.expandAll(),A.pushUpdate(),A},callRegisterReusableCellContent:function(t){t.forEach(t=>{this.registerReusableCellContent({id:t.id,buildContent:t.buildContent||function(){return e.createElement("div",{class:t.className})},getTweakerPadding:function(){return T.lengthOfEachCharacter}})})},setupResuableComponents:function(){this.callRegisterReusableCellContent([{id:T.reusableComponentIDs.attachment_or_deliverable,className:"fonticon fonticon-attach"},{id:T.reusableComponentIDs.context,className:"grid-object grid-context"},{id:T.reusableComponentIDs.project,className:"grid-object grid-project"},{id:T.reusableComponentIDs.assignee,className:"grid-object grid-member"},{id:T.reusableComponentIDs.owner,className:"grid-object grid-member"},{id:T.reusableComponentIDs.description,className:"grid-description-view"}])},_manageCellSelection:function(e,t,s){this._parent(e,t,s),this.openPropertyPanel(e),"DSpointerhit"!==e.type||this.isTouchDevice()||this.selectCell(this.getActiveCellID())},openOrResetPropertyPanelFromGrid:function(e){var t=this._activeCellStableID.nodeModel.getAttributeValue("correspondingModel");e?this.parentTaskView._detailPanel.resetModel(t):this.parentTaskView._detailPanel.isOpen()||e||(this.parentTaskView._detailPanel.open(),this.parentTaskView._detailPanel.resetModel(t))},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},setActiveTreeNodeModel:function(e){var t=e?e.nodeModel:this._activeCellStableID.nodeModel;if(t){var s=t.getAttributeValue("correspondingModel");s&&this.tasksCollection&&this.parentTaskView&&this.parentTaskView.handleTagCollect&&this.parentTaskView.handleTagCollect({model:s})}},selectCell:function(e,t,s,i){this._parent(e,t,s,i),this.setActiveTreeNodeModel()},unselectAll:function(){this._parent(),this.tasksCollection&&this.parentTaskView&&this.parentTaskView.handleTagCollect&&this.parentTaskView.handleTagCollect()},openPropertyPanel:function(e){if(this.isTouchDevice()){if(1===e.detail)if(this.parentTaskView._detailPanel.isOpen())this.openOrResetPropertyPanelFromGrid(!0);else{if(!this.clickOneDone&&!this.srcElement)return this.clickOneDone=!0,void(this.srcElement=e.srcElement);this.clickOneDone&&(this.srcElement===e.srcElement&&this.openOrResetPropertyPanelFromGrid(),delete this.clickOneDone,delete this.srcElement)}}else 1===e.detail&&this.parentTaskView._detailPanel.isOpen()?this.openOrResetPropertyPanelFromGrid(!0):2===e.detail&&this.openOrResetPropertyPanelFromGrid()},addNewNode:function(e,t){!e.id||D[e.id]||e.isBlank||(A.addChild(e.getTreeNodeModel()),this.addNodeToMap(e.id,e.getTreeNodeModel()),t&&this.subProjectTasks.push(e))},removeNode:function(e){D[e.id]&&(A.removeRoot(D[e.id]),delete D[e.id],delete _[e.id])},handleTaskAddition:function(e,t){e.id&&D[e.id]?this.showNode(e):e.id?this.addNewNode(e,t):this.listenToOnce(e,"onChange:"+e.idAttribute,function(){this.addNewNode(e,t)})},addListenersToCollection:function(e){this.listenTo(e,"onAdd",function(e){this.handleTaskAddition(e)}),this.listenTo(e,"onReset",function(e,t){this.setupLoadingMessages(),this.onTaskCollectionsReset(e,t)}),this.listenTo(e,"onChange:search",function(){this.filterVisibleNodes()})},addCollectionListeners:function(e){this.addListenersToCollection(e.tasksCollection),e.rdfTasksCollection&&this.addListenersToCollection(e.rdfTasksCollection),e.iteropTasksCollection&&this.addListenersToCollection(e.iteropTasksCollection),e.srcCollection&&this.addListenersToCollection(e.srcCollection)},hideNode:function(e){var t=D[e.id];t&&t.hide(),delete _[e.id]},showNode:function(e,t){D[e.id]?D[e.id].show():this.addNewNode(e,t)},addNodesInBulk:function(t,s){A.prepareUpdate(),t.forEach(e=>this.showNode(e,s)),e.Utils.Client.Engine.firefox?setTimeout(function(){A.pushUpdate()},0):A.pushUpdate()},removeNodesInBulk:function(e){A.prepareUpdate(),e.forEach(e=>this.hideNode(e)),A.pushUpdate()},onTaskCollectionsReset:function(t,s){var i=[],a=e.is(s.previousModels,"array")?s.previousModels.slice():[];a.length>0?t.forEach(function(e){var t=a.indexOf(e);-1===t?i.push(e):a.splice(t,1)}):i=t.toArray(),this.removeNodesInBulk(a),this.addNodesInBulk(i)},customizeScroller:function(){var e=this;this._getScroller().onScrollEnd(function(){this.getPosition().y!==this._lastScrollPosition.y&&e.invokeLazyLoading()})},invokeLazyLoading:function(){var e=this.getModelsAndIDsToFetch();e&&(this.rdfTasksCollection&&this.rdfTasksCollection.complete(e.rdfModelIDsToBeFetched,{onlyIfNeeded:!0}),this.tasksCollection.complete(e.nonRDFModelsToBeFetched,{onlyIfNeeded:!0}))},getModelsAndIDsToFetch:function(){let e,t=[],s=[],i=this.layout.collectionView._rowModel;if(i){let o=this.layout.getMinMaxVisibleRowIDs();if(o.minRowID<=0&&o.maxRowID<=0)return void this.onPostUpdateViewOnce(this.invokeLazyLoading);for(let n=o.minRowID;n<=o.maxRowID;n++){var a=(e=i.getVisibleNodeModel(n).getAttributeValue("correspondingModel")).id;_[a]||(_[a]=!0,e.isRDFTask()?t.push(a):s.push(e))}}return{rdfModelIDsToBeFetched:t,nonRDFModelsToBeFetched:s}},_sortAfterFetching:function(e,t){let s=0;const i=this,a=function(){0===--s&&setTimeout(function(){i._rowModel._applySortModel(e,t)},0)};if(this.tasksCollection.fetching&&(s++,this.listenToOnce(this.tasksCollection,"onSync",a)),this.rdfTasksCollection&&this.rdfTasksCollection.fetching){s++;const e=function(){i.stopListening(i.rdfTasksCollection,"onSync"),i.stopListening(i.rdfTasksCollection,"doneCompleting"),a()};this.listenToOnce(this.rdfTasksCollection,"onSync",e),this.listenToOnce(this.rdfTasksCollection,"doneCompleting",e)}},customizeSortingForColumns:function(e){var t=this.tasksCollection,s=this.rdfTasksCollection,i=this;this._rowModel._applySortModel=function(o,n){var l=this,r=arguments;if(t.fetching||s&&s.fetching)i._sortAfterFetching(o,n);else if(o&&o.length||n&&n.length)if(!o||!o.length||n&&n.length){var d=Object.keys(c.ER_TO_TREE_NODE).filter(e=>c.ER_TO_TREE_NODE[e]===n[0].dataIndex).join(","),h=[];s&&h.push(new a(function(e){var t=s.map(e=>e.id);t.length?s.complete(t,{mask:c.getMasksForFetchingRDFTaskDetails(n[0].dataIndex),onlyIfNeeded:!0,onComplete:function(){e()}}):e()})),!k[d]&&d&&h.push(new a(function(e){if(t.length>0){const s=t._initialLoadOptions;t._initialLoadOptions=`$include=none&$fields=${d}&$definition=true&$terse=true`,t.fetch({onComplete:()=>{k[d]=!0,t._initialLoadOptions=s,e()}})}else e()})),i.showLoadingMessage(),a.all(h).then(function(){i.hideLoadingMessage(),e.apply(l,r),i.invokeLazyLoading()})}else e.apply(l,r)}},showLoadingMessage:function(){this.elements&&this.elements.container&&r.showLoadingMessage(this.elements.container)},hideLoadingMessage:function(){r.hideLoadingMessage(this.elements.container)},setupLoadingMessages:function(){this.showLoadingMessage(),this.tasksCollection.fetching||this.rdfTasksCollection&&this.rdfTasksCollection.fetching?(this.tasksCollection.fetching&&this.listenToOnce(this.tasksCollection,"onSync",this.hideLoadingMessage),this.rdfTasksCollection&&this.rdfTasksCollection.fetching&&(this.listenToOnce(this.rdfTasksCollection,"onSync",this.hideLoadingMessage),this.listenToOnce(this.rdfTasksCollection,"doneCompleting",this.hideLoadingMessage))):window.widget.getValue("appId")===v.APP_TSK&&0===this.tasksCollection.length&&this.rdfTasksCollection&&0===this.rdfTasksCollection.length?setTimeout(this.hideLoadingMessage.bind(this),1e3):window.widget.getValue("appId")===v.APP_3DPLAN&&0===this.rdfTasksCollection.length?setTimeout(this.hideLoadingMessage.bind(this),1e3):(this.tasksCollection.length>0||this.rdfTasksCollection&&this.rdfTasksCollection.length>0)&&this.hideLoadingMessage()},getTaskMenu:function(e){const t=new E;var s=this;t.getParentView=function(){return s.parentTaskView};var i=e.isComplete()?[{actualValue:v.ACTIVE,displayValue:w("E6WCommonApps.Label.InWork")}]:[{actualValue:v.COMPLETE,displayValue:w("E6WCommonApps.Label.Completed")}];return t.options={stateValues:i},t.model=e,t},onEditOnGridView:function(){this.parentTaskView._detailPanel.isOpen()?this.openOrResetPropertyPanelFromGrid(!0):this.openOrResetPropertyPanelFromGrid()},getContextualMenu:function(e,t){var s=[];if(e.cellInfos&&e.cellInfos.rowID>-1){var i=e.cellInfos.nodeModel.getAttributeValue("correspondingModel");i.hasFetchedAccessData()||i.fetchAccess();var a=this.getTaskMenu(i);this.listenTo(a,"onTaskCardClickedForTableView",function(){i.dispatchEvent("onEditOnGridView")}),this.listenTo(i,"onEditOnGridView",this.onEditOnGridView),a.createMenuButtons().dropdown.items.forEach(e=>{var t=e.disabled?"disabled":"",i="PushItem";"divider"===e.className?i="SeparatorItem":"header"===e.className&&(i="TitleItem"),s.push({type:i,title:e.text,icon:e.fonticon,state:t,action:{callback:e.func||e.handler||function(){}}})})}else s=e.collectionView.buildDefaultContextualMenu(e,t);return s},updateTreeDocumentWithNewModels:function(e){this.resetTreeDocumentAndMap(),e.forEach(e=>{this.handleTaskAddition(e)})},filterVisibleNodes:function(){this.tasksCollection.getSearch()||this.rdfTasksCollection&&this.rdfTasksCollection.getSearch()?(A._trueRoot.hideChildNodes(),this.parentTaskView&&this.parentTaskView._columnViews.forEach(e=>{e.collection&&e.collection._subCollections.forEach(e=>{e._models.forEach(e=>{D[e.id]&&D[e.id].isHidden()&&D[e.id].show()})})})):A._trueRoot.showChildNodes()},onLevelChanged:function(){p.useFTS()?this.showSubProjectTasks():this.hideSubProjectTasks()},updateRDFCollection:function(e){this.stopListening(this.rdfTasksCollection),this.rdfTasksCollection=e,this.updateTreeDocumentWithNewModels(e),this.addListenersToCollection(this.rdfTasksCollection)},resetTreeDocumentAndMap:function(){this.treeDocument&&this.treeDocument.empty(),D={}},addListenersToColCollectionsForAdd:function(){var e=this;this.parentTaskView._columnViews.forEach(t=>{e.parentTaskView.listenTo(t.collection,"onAdd",function(t){e._ftsCollection.add(t)})})},_onCompleteSubProjectTasksFetch:function(){this.addListenersToColCollectionsForAdd(),this.addListenersToCollection(this._ftsCollection),this.addNodesInBulk(this._ftsCollection._models,!0),this.hideLoadingMessage()},showSubProjectTasks:function(){this.subProjectTasks=[],this.resetTreeDocumentAndMap(),this.showLoadingMessage(),this.stopListening(this._ftsCollection),this._ftsCollection.reset(),this._ftsCollection.fetch(e.merge(this.parentTaskView.getFTSOptions(),{limit:1e5,onComplete:this._onCompleteSubProjectTasksFetch.bind(this),onFailure:this.hideLoadingMessage}))},showFirstLevelTasks:function(){this.addNodesInBulk(this.rdfTasksCollection.toArray()),this.hideLoadingMessage()},hideSubProjectTasks:function(){this.removeNodesInBulk(this.subProjectTasks),this.subProjectTasks=[],this.showFirstLevelTasks()},init:function(e){this.tasksCollection=e.tasksCollection,this.rdfTasksCollection=e.rdfTasksCollection,this.iteropTasksCollection=e.iteropTasksCollection,this.srcCollection=e.srcCollection,this.parentTaskView=e.parentTaskView,this.subProjectTasks=[],this.rdfTasksCollection&&(this._ftsCollection=new g(void 0,{view:v.TASK_TABLE,parentModel:this.rdfTasksCollection.parentModel})),A=this.getTreeNodeModels(e),window.widget&&window.widget.data["wux-collectionView-dataGridView"]&&window.widget.hasPreference&&!window.widget.hasPreference("wux-collectionView-dataGridView")&&window.widget.addPreference({name:"wux-collectionView-dataGridView",type:"hidden"}),this._parent({identifier:"TasksTableView",treeDocument:A,useWidgetPreferencesFlag:!0,columns:[...b],rowSelection:"single",cellSelection:"none",showSelectionCheckBoxesFlag:!0,onContextualEvent:this.getContextualMenu,rowGroupingEnabledFlag:!1,cellActivationFeedback:"row",layoutOptions:{layoutDensity:"comfortable"}});var t=this;A.getModelEvents().subscribe({event:"select"},function(e){t.setActiveTreeNodeModel(e.data)}),A.getModelEvents().subscribe({event:"unselect"},function(){t.unselectAll()}),this.setupLoadingMessages(),this.setupResuableComponents(),this.addCollectionListeners(e),this.customizeScroller(),this.customizeSortingForColumns(this._rowModel._applySortModel),this.onPostUpdateView(this.invokeLazyLoading),this.filterVisibleNodes()}});return y.implement(i),y.implement(s),y.implement(d),y}),define("DS/CollaborativeTasks/Views/SourcingDetailsPanelConfig",["DS/Foundation2/FoundationV2Data","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/CollaborativeTasks/Models/TaskModel","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonApps/Views/CommonPropertiesConfig","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonUI/PlatformManager"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m){"use strict";var g=function(t){var s=e.getWidgetConstant.apply(this,arguments);return s===t&&(s=p.get(t)),s},C={};return C.config=function(e){var i=g("emxCollaborativeTasks.GroupLabel.More"),a="false"!==g("emxComponents.Routes.ShowCommentsForTaskApproval").toLowerCase().trim()||e&&"Comment"===e.get("routeTaskAction"),o="false"!==g("emxComponents.Routes.EnforceAssigneeApprovalComments").toLowerCase().trim(),n=e&&"No"!==e.get("routeTaskDueDate"),l=e&&"FALSE"!==e.get("routeTaskDelegationAllowed"),u=e.collection&&e.collection.contentsTypesForSearch(),p=e.collection&&e.collection.contentsTypes(),C=[{name:"title",label:g("emxCollaborativeTasks.Label.Title"),type:"text",numberOfEditableLines:4,maxLength:128},{name:"routeTaskAction",label:g("emxCollaborativeTasks.Label.TaskExpectedAction"),type:"select"},{name:"routeTaskInstructions",label:g("emxCollaborativeTasks.Label.TaskInstructions"),type:"textarea"},{name:"route",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,label:g("emxCollaborativeTasks.Label.Route"),type:"object",customView:d,linkCallback:r.launchProperties},{readWrite:"true",required:o,name:"routeTaskApprovalComments",label:g("emxCollaborativeTasks.Label.TaskApproverComments"),type:"RichText",titleAttribute:"title",customView:h,validate:o,isRoute:!0,numberOfDisplayLines:3,numberOfEditableLines:6},{name:"state",label:g("emxCollaborativeTasks.Label.TaskMaturityState"),type:"select"},{name:"routeTaskDueDate",label:g("emxCollaborativeTasks.Label.TaskDueDate"),type:"date"},{name:"assignees",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.Assignees"),type:"person",customView:d,linkCallback:r.launchProperties,searchSource:s.filterSearchSources(function(e){var t=e&&e.isTaskReassignmentRequired()&&e.get("routeOwnerUGName");return m.getServiceUrl("swym",!0)&&!t?["swym"]:["3dspace"]}())},{name:"originatorInfo",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.TaskOriginator"),type:"person",customView:d,linkCallback:r.launchProperties,searchSource:["swym"]},{name:"ownerInfo",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.TaskOwner"),type:"person",customView:d,linkCallback:r.launchProperties,searchSource:["swym"]},{name:"contents",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.Content"),searchTitle:g("emxCollaborativeTasks.Label.contentsSearchTitle"),typeAheadCallback:t.typeAheadCallback,type:"object",customView:d,linkCallback:r.launchProperties,placeHolder:g("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:s.filterSearchSources(["3dspace"]),dropTypes:{"3dspace":p&&p.split(",")},searchSourceTypes:{"3dspace":u&&u.split(",")},excludeSearchTypes:{"3dspace":["Person","Security Context"]},allowFileManagement:!0,validateSameTenant:!0,getDropDownMenuItems:c.getDocumentTypeDropDownMenuItems},{name:"project",label:g("emxCollaborativeTasks.Label.CollaborativeSpace"),type:"text"},{name:"originated",label:g("emxCollaborativeTasks.Label.TaskCreated"),type:"date",group:i},{name:"modified",label:g("emxCollaborativeTasks.Label.TaskModified"),type:"date",group:i}],T=e.get("routeOwner"),f=(e.get("routeOwnerUGName"),e.get("state")),v=l||enoviaServer.user===T;a||C.splice(4,1);for(var S=0;S<C.length;S++)("assignees"===C[S].name&&!v||"routeTaskDueDate"===C[S].name&&!n||"routeTaskReviewerComments"===C[S].name&&(enoviaServer.user!==T||"Review"!==f))&&delete C[S].readWrite,("routeTaskReviewerComments"===C[S].name&&(enoviaServer.user!==T||"Review"!==f)||"routeTaskApprovalComments"===C[S].name&&"Complete"===f)&&(delete C[S].required,delete C[S].validate,delete C[S].numberOfDisplayLines);return C},C}),define("DS/CollaborativeTasks/Views/DetailsPanelMixin",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/BulkModel","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/Models/BulkCloneModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/E6WCommonApps/Models/IteropTaskModel","DS/CollaborativeTasks/Models/SourcingTaskModel","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/ENOCollabRouteTask/RouteTaskDetailsPanelConfig","DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig","DS/CollaborativeTasks/Views/SourcingDetailsPanelConfig","DS/CollaborativeTasks/Models/TskCloneModel","DS/DocumentManagement/DocumentManagement","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,b,_){"use strict";var D=function(e){var t=i.getWidgetConstant.apply(this,arguments);if(t===e||null==t){var s=b.get(e);return s===e&&(s=_.get(e)),s}return t},k="column ds-dialog property-panel off",A="off";A="active";var w={_durationOfDetailOpening:500,className:k="slide-in-panel right ds-dialog",tagName:"div",domEvents:{"click #subscribeToItem":"toggleSubscription",resize:function(){delete this._width,this._adjustHeader()}},bookmarkItem:function(){this._bookmarkHandler()},open:function(e){var t=this;this.container.toggleClassName(A,!0),this._width=e,this._isOpen||(this._isOpen=!0,this._unlockWidths(),this.dispatchEvent("onOpen",[this.getContent()])),this._detailsView&&!this.maximize&&(this._detailsView.container.style.width=e+"px",setTimeout(function(){t._detailsView&&(t._detailsView.container.style.width="")},this._durationOfDetailOpening),this._detailsView._resizeHandler()),this._parent.apply(this,arguments)},close:function(){this._parent.apply(this,arguments),this.container.toggleClassName(A,!1),this._isOpen&&(this._isOpen=!1,this._lockWidths(),this.dispatchEvent("onCloseIfOpen"))},isOpen:function(){return this._isOpen},init:function(t){var s=e.clone(t||{},!1);s.scopesTypes=t.collection.scopesTypes(),s.scopesTypesForSearch=t.collection.scopesTypesForSearch(),s.contentsTypes=t.collection.contentsTypes(),s.contentsTypesForSearch=t.collection.contentsTypesForSearch(),s.projectTypes=t.collection.projectTypes(),s.projectTypesForSearch=t.collection.projectTypesForSearch(),s.deliverablesTypes=t.collection.deliverablesTypes(),s.deliverablesTypesForSearch=t.collection.deliverablesTypesForSearch(),delete s.collection,this._parent(s)},setup:function(t){var s=e.clone(t||{},!1);if(this.erTaskConfig=g.config(),this.projectConfig=g.projectConfig(),this.erTaskConfig.options=g.options,this.scopesTypes=t&&t.scopesTypes?t.scopesTypes.split(","):[],this.projectTypes=t&&t.projectTypes?t.projectTypes.split(","):[],this.contentsTypes=t&&t.contentsTypes?t.contentsTypes.split(","):[],this._updateConfigValues(t),e.Utils.Client.Platform.ios||e.Utils.Client.Platform.android)for(var i=this.erTaskConfig.length,a=0;a<i;a++){var o=this.erTaskConfig[a];switch(o.type){case"object":case"person":o.appendTo=".collaborative-tasks"}}return s.buttons=this._getButtonConfig(),s.detailsViewParameters={DocumentManagement:S},this._parent(s),this._detailsView.setConfig(this.getConfig()),this._callbackForVisibleTasks=t.callbackForVisibleTasks,t},getDropDownMenu:function(){var t=[];if(this.model){if(this.model instanceof o){let e={dropdownItems:t,model:this.model,selectedModels:this.model&&this.model.models,isDetailsPanel:!0};this.createMultiItemsMenu(e)}else{this._approvalActionsControl=this.createApprovalActionsControl({fonticon:"thumbs-up"}),this.getApprovalMenuItems(t,this.model),this.getConditionalDropMenuItems(t,!0),t.push(this.getCompleteMenuConfig(this.model)),this.isRouteTask(this.model)&&"Approve"===this.model.get("routeTaskAction")&&"Assign"===this.model.get("state")&&t.pop();var i=e.is(this.model.getParent,"function")&&this.model.getParent();this.model.isProjectTask()||this.model.isRouteTask()||!i||i instanceof c||t.push(this.getDuplicateMenuConfig({model:this.model})),t.push(this.getBookmarkMenuConfig(this.model)),t.push(this.getDuplicateMenuConfig({model:this.model,parentView:this.getParentView()})),t.push(this.getDividerConfig()),t.push(this.getDeleteMenuConfig({model:this.model}))}t.forEach(function(e){!e.handler&&e.func&&(e.handler=e.func)})}if(this.model instanceof p){t=this.filterDropdownItems(t)}var a={className:"properties-menu",target:this.container.getElement(".fonticon-down-open"),items:t};return new s(a)},_updateConfigValues:function(t){this.erTaskConfig.detect(function(e){return"state"===e.name}).values=t.stateValues;var s=this.erTaskConfig.detect(function(e){return"scopes"===e.name});s.dropTypes={"3dspace":t.scopesTypes?t.scopesTypes.split(","):[]},s.searchSourceTypes={"3dspace":t.scopesTypesForSearch?t.scopesTypesForSearch.split(","):[]};var i=this.erTaskConfig.detect(function(e){return"DPMProject"===e.name});i.dropTypes={"3dspace":t.projectTypes?t.projectTypes.split(","):[]},i.searchSourceTypes={"3dspace":t.projectTypes?t.projectTypes.split(","):[]};var a={dropTypes:{"3dspace":t.deliverablesTypes?t.deliverablesTypes.split(","):[]},searchSourceTypes:{"3dspace":t.deliverablesTypesForSearch?t.deliverablesTypesForSearch.split(","):[]}},o=this.erTaskConfig.detect(function(e){return"deliverables"===e.name});-1!==o.searchSource.indexOf("drive")&&(a.dropTypes.drive=["DriveFile"],a.searchSourceTypes.drive=["DriveFile"]),o.dropTypes=Object.assign({},o.dropTypes,a.dropTypes),e.merge(o,a),this.projectConfig.detect(function(e){return"taskRequirement"===e.name}).values=t.taskRequirementValues},onFieldValueChange:function(){var e=this._scroller&&this._scroller.getInnerElement().scrollTop,t=this._scroller&&this._scroller.getInnerElement().scrollLeft;this._detailsView.setConfig(this.getConfig()),this.render(),this._scroller&&this._scroller.scrollTo(t,e)},filterDropdownItems:function(e){let t=["INFO","THUMBS-UP","THUMBS-DOWN"];return e.filter(e=>{if(e.fonticon){let s=e.fonticon.toUpperCase();return t.includes(s)}return!1})},getConfig:function(e){var t=this.getOriginalConfig(e);return this._parent(t)},getOriginalConfig:function(){var t;if(!this.model)return this.erTaskConfig;var s=this.model;let i={};if(s instanceof o){if(!s.models.length)return this.erTaskConfig;s=s.models[0],i.multiSelect=!0}this.model instanceof p?(t=this._getSourcingTaskConfig()).options=g.options:s.isRouteTask()?(t=this._getRouteTaskConfig()).options=g.options:s.isRDFTask()?((t=this._getRDFTaskConfig(this._detailsView&&this._detailsView.model&&this._detailsView.model.model===s?this._detailsView.model:s,i)).options=m.options,this.showOrHideBookmarkForRepositoryField(t)):s.isIteropTask()?(t=this._getIteropTaskConfig(s)).options=T.options:(t=this._getERTaskConfig(s)).options=g.options;var a=e.clone(t,!0);if(a.options=t.options,!(s instanceof o)){(s.isProjectTask()||"TRUE"===s.get("hasProject"))&&this.treatProjectTaskAttributes(a);let e=s.get("restrictedAccess")&&s.get("restrictedAccess").split(",");if(e){var n=a.filter(function(t){return e.includes(t.name)});for(let e=0;e<n.length;e++){const t=n[e];var l=a.findIndex(function(e){return e.name===t.name});a[l].readWrite=!1}}var r=s.getCustomFields();r&&!i.multiSelect&&this.treatCustomFields(a,r)}return this.config=a,a},subscribedToItem:function(){return"TRUE"===this.model.get("subscribed")},_emptyMenu:function(){this._menu&&(this._menu.destroy(),delete this._menu)},_drawMenu:function(){var e=this.getElement(".panel-overflow");e&&(e.empty(),this._menu=new t(this._panelActionsMenu).inject(e),this._menu.elements.container.setStyle("min-width","")),this._adjustHeader()},render:function(){return this._parent.apply(this,arguments),this._dropDownMenu&&this._dropDownMenu.destroy(),this._dropDownMenu=this.getDropDownMenu(),this._updateActionButtonsState(),this.toggleLaunchControl(),this},_adjustHeader:function(){var t=this.getContent(),s=this.getElement(".panel-tabs"),i=this.getElement(".panel-actions");if(t&&s&&i){t.removeClassName("overflow");var a=e.is(this._width)?this._width:t.offsetWidth;i.offsetWidth>=a-s.offsetWidth?t.addClassName("overflow"):t.removeClassName("overflow")}},toggleLaunchControl:function(){var e=this.getElement("#openProjectItem");if(e){var t=this.model.get("DPMProject");t&&t.length?e.toggleClassName("disabled",!1):e.toggleClassName("disabled",!0)}},getDPMGateMilestoneStates:function(){return[{actualValue:"Create",displayValue:D("emxCollaborativeTasks.Label.Preliminary")},{actualValue:"Review",displayValue:D("emxCollaborativeTasks.Label.InReview")},{actualValue:"Complete",displayValue:D("emxCollaborativeTasks.Label.Completed")}]},getStates:function(){var e=[];return e.push({actualValue:r.STATE_OPEN,displayValue:D("emxCollaborativeTasks.Label.ToDo")}),e.push({actualValue:r.STATE_IN_PROGRESS,displayValue:D("emxCollaborativeTasks.Label.InProgress")}),e.push({actualValue:r.STATE_DONE,displayValue:D("emxCollaborativeTasks.Label.Done")}),e},redrawPanel:function(){this.resetModel(this.model||this._detailsView.model,{},!0)},destroy:function(){this._emptyMenu(),this._dropDownMenu&&this._dropDownMenu.destroy(),delete this._panelActionsMenu,delete this.erTaskConfig,delete this.config,delete this.projectConfig,delete this.scopesTypes,delete this.projectTypes,delete this.contentsTypes,this._unlockTimeout&&clearTimeout(this._unlockTimeout),delete this._unlockTimeout,delete this._bookmarkHandler,this._parent.apply(this,arguments)},_lockWidths:function(){var e=this.container.getSize().width,t=this.container.getElement(".body");t&&(t.setStyle("width",e),this.container.getElement(".footer").setStyle("width",e),this.container.getElement(".header").setStyle("width",e),this._unlockTimeout&&clearTimeout(this._unlockTimeout),this._unlockTimeout=setTimeout(this._unlockWidths.bind(this),this._durationOfDetailOpening))},_unlockWidths:function(){if(this.container){var e=this.container.getElement(".body");e&&(e.setStyle("width",""),this.container.getElement(".footer").setStyle("width",""),this.container.getElement(".header").setStyle("width",""))}},_getButtonConfig:function(){this._approvalActionsControl=this.createApprovalActionsControl({fonticon:"thumbs-up"});const e=[];return!this.model||!this.model.isRDF||this.model instanceof o||e.push({id:"openSubButtonPropertPanel",title:D("E6WCommonApps.Label.Subscription"),fonticon:this.model.get("_xplanSubscribed")?"bell active no-hover":"bell-off"}),e.push({id:"openMenuButton",title:D("E6WCommonApps.Label.OpenMenu"),fonticon:"down-open"}),e},_getRouteTaskConfig:function(){for(var t=C.config(this.model),s=this.model&&"No"!==this.model.get("needsReview"),i=this.options,a=t.length,o=0;o<a;o++){var n=t[o];"state"===n.name?n.values=s?i.routeTaskStateValues:i.routeTaskNoReviewStateValues:"routeTaskApprovalAction"===n.name?n.values=i.routeTaskApprovalActionValues:"routeTaskAction"===n.name&&(n.values=i.routeTaskActionValues)}if(e.Utils.Client.Platform.ios||e.Utils.Client.Platform.android)for(var l=0;l<a;l++){var r=t[l];switch(r.type){case"object":case"person":r.appendTo=".collaborative-tasks"}}return t},_getSourcingTaskConfig:function(){for(var t=f.config(this.model),s=this.model&&"No"!==this.model.get("needsReview"),i=this.options,a=t.length,o=0;o<a;o++){var n=t[o];"state"===n.name?n.values=s?i.routeTaskStateValues:i.routeTaskNoReviewStateValues:"routeTaskApprovalAction"===n.name?n.values=i.routeTaskApprovalActionValues:"routeTaskAction"===n.name&&(n.values=i.routeTaskActionValues)}if(e.Utils.Client.Platform.ios||e.Utils.Client.Platform.android)for(var l=0;l<a;l++){var r=t[l];switch(r.type){case"object":case"person":r.appendTo=".collaborative-tasks"}}return t},_getRDFTaskConfig:function(e,t){for(var s=m.config(e||this.model,t),i=s.length,a=0;a<i;a++){var o=s[a];o.name===r.STATE_ATTR?o.values=this.getStates():"dependencies"===o.name&&(o.getVisibleModels=this._callbackForVisibleTasks)}return s},_getERTaskConfig:function(t){var s=e.clone(this.erTaskConfig,!1);if(s.find(function(e){return e.name===r.COOWNERATTR}).readWrite=t.hasChangeSOVAccess(),!this.model.isProjectTask()){var i=s.findIndex(function(e){return"dependencies"===e.name});i>=0&&s.splice(i,1)}var o=t&&(t.get("dsxplan:jsType")||t.get("type"));return a.isMilestone(o)||a.isGate(o)?this._getDPMGateMilestoneConfig(s):s},_getDPMGateMilestoneConfig:function(t){for(var s=e.clone(t,!0),i=s.length,a=-1,o=0;o<i;o++){var n=s[o];"state"===n.name?n.values=this.getDPMGateMilestoneStates():"estimatedDurationInputValue"===n.name&&(a=o)}return a>-1&&s.splice(a,1),s},_getIteropTaskConfig:function(e){return T.config(e)},_updateApprovalActionsButton:function(){var e=this.getElement("#approvalActionsItem"),t=e.getElement(".fonticon"),s=this.model.get("state"),i=this.model.get("routeTaskAction"),a=this.model.get("routeTaskApprovalAction"),o=this._approvalActionsControl&&this._approvalActionsControl.buttons[1]&&this._approvalActionsControl.buttons[1].dropdown?this._approvalActionsControl.buttons[1].dropdown:void 0,n=this._menu&&this._menu.dropdown?this._menu.dropdown:void 0,l=this.model&&!this.approvalActionsItemAccess(this.model),r=this.model&&!this.model.isRouteTask();r||(r="Assign"!==s||"Approve"!==i),r?e.toggleClassName("hidden",!0):e.toggleClassName("hidden",!1),this.model&&!this.approvalActionsItemAccess()?e.toggleClassName("disabled",!0):e.toggleClassName("disabled",!1),e.toggleClassName("item-approve",!1),e.toggleClassName("item-reject",!1),e.toggleClassName("item-abstain",!1),t.toggleClassName("fonticon-thumbs-up",!1),t.toggleClassName("fonticon-thumbs-down",!1),t.toggleClassName("fonticon-ignore",!1),"Reject"===a?(e.toggleClassName("item-reject",!0),t.toggleClassName("fonticon-thumbs-down",!0)):"Abstain"===a?(e.toggleClassName("item-abstain",!0),t.toggleClassName("fonticon-ignore",!0)):(e.toggleClassName("item-approve",!0),t.toggleClassName("fonticon-thumbs-up",!0)),n&&(l?n.disableItem("approve"):n.enableItem("approve"),l?n.disableItem("reject"):n.enableItem("reject"),l?n.disableItem("abstain"):n.enableItem("abstain")),o&&(l?o.disableItem("approve"):o.enableItem("approve"),l?o.disableItem("reject"):o.enableItem("reject"),l?o.disableItem("abstain"):o.enableItem("abstain"))},treatCustomFields:function(t,s){for(var i=Object.keys(s),a=i.length,o=0;o<a;o++){var n=s[i[o]],l={};if(l.name=n.name,l.label=n.label,void 0!==this.model.get(n.name)){var r=n.viewConfig;try{if(l.name&&l.label&&r){e.extend(l,r),l.multivalue&&delete l.readWrite,n.mandatory&&(l.required=!0,l.validate=!0);var c=l.insertIndex||0;void 0!==l.insertIndex?t.splice(c,0,l):t.push(l)}}catch(e){console.log(e)}}}},_updateCompleteButton:function(){var e,t=this.getElement("#completeItem");if(this.model&&this.model.isRouteTask()&&"Assign"===this.model.get("state")&&"Approve"===this.model.get("routeTaskAction")?t.toggleClassName("hidden",!0):t.toggleClassName("hidden",!1),!this.model||this.completeItemAccess()||this.reOpenItemAccess()?t.toggleClassName("disabled",!1):t.toggleClassName("disabled",!0),this.reOpenItemAccess()){e=D("emxCollaborativeTasks.Command.ReOpen"),t.setAttribute("title",D("emxCollaborativeTasks.Command.ReOpen"));var s=t.getElement(".fonticon-check");s&&s.removeClassName("fonticon-check").addClassName("fonticon-reset")}else{e=D("emxCollaborativeTasks.Command.Complete"),t.setAttribute("title",D("emxCollaborativeTasks.Command.Complete"));var i=t.getElement(".fonticon-reset");i&&i.removeClassName("fonticon-reset").addClassName("fonticon-check")}const o=this._childrenViews.find(e=>e&&e.options&&e.options.target&&e.options.target.getElement("#completeItem"));this.removeChildView(o),o&&o.elements&&o.destroy(),this.addChildView(a.createTooltip(t,e))},treatProjectTaskAttributes:function(t){for(var s=t.length,o=3,n=-1,l=0;l<s;l++){if("DPMProject"===t[l].name){var c=e.clone(t[l]);delete c.readWrite,t[l]=c,o--}else if("dueDate"===t[l].name)n=l,o--;else if("estimatedDuration"===t[l].name){if("Review"===this.model.get("state")){var d=e.clone(t[l]);delete d.readWrite,t[l]=d}o--}if(0===o)break}n>-1&&t.splice(n,1);var h=this.projectConfig,u=this.model.get("dsxplan:jsType")||this.model.get("type");if(this.model.isProjectTask()){var p=this.model.get("state"),m=h.find(function(e){return"needsReview"===e.name});m&&(m.readWrite="Review"!==p&&"Complete"!==p)}var g=!1;if((a.isMilestone(u)||a.isGate(u))&&(g=!0,h=h.filter(e=>!["needsReview","calculateDuration"].includes(e.name))),h&&h.length>0)for(var C=0,T=h.length;C<T;C++){if("calculateDuration"===h[C].name)if(this.model&&this.model.collection&&e.is(this.model.collection.data,"function"))if(!i.getAllFields(this.model.collection.data()).calculateDuration)continue;if(g&&h[C].name===r.PERCENT_COMPLETE){var f=e.clone(h[C],!1);f.step=100,t.splice(h[C].insertIndex,0,f)}else t.splice(h[C].insertIndex,0,h[C])}},cloneModelForDetailDisplayView:function(){if(this.model){var e,t=this.CloneClass;return(this.model instanceof d||this.model.isRDF)&&(t=h),t?this.model instanceof u&&(t=n):t=v,this.model instanceof o?e=new l(this.model,t,g.options,{scopesTypes:this.scopesTypes,projectTypes:this.projectTypes,contentsTypes:this.contentsTypes}):((e=new t(this.model,g.options)).scopesTypes=this.scopesTypes,e.projectTypes=this.projectTypes,e.contentsTypes=this.contentsTypes),e}},resetModel:function(e,t){var s=this;this._parent(e,t);var i=function(){s._panelActionsMenu=s.createMenuButtons(),s.onFieldValueChange()};this.listenTo(this.model,"onChange:hasProject",i),this.listenTo(this.model,"onChange:DPMProject",i),this.listenTo(this.model,"onChange:PALId",this.onFieldValueChange),this.listenTo(this.model,"onChange:subscribed",this.onFieldValueChange),this.listenTo(this.model,"onChange:_xplanSubscribed",this._updateActionButtonsState),this.listenTo(this.model,"onChange:routeOwner",this.onFieldValueChange);var a={onDeleteAccessChanged:this._updateStateOfDeleteButton,onDestroy:this.close};this.listenTo(this.model,a),this.listenTo(this.model,"onModifyAccessChanged",this._updateStateOfAssignToSelfButton),this.container.getElement(".panel-actions").empty(),this.buttonConfig=this._getButtonConfig(),this._initButtons(this.buttonConfig),this._dropDownMenu&&this._dropDownMenu.destroy(),this._dropDownMenu=this.getDropDownMenu(),this.listenTo(this.model,"onChange:"+r.STATE_ATTR,this.redrawPanel),this.listenTo(this.model,"onChange:routeTaskAction",this.redrawPanel),this.model instanceof o&&(this.listenTo(this.model,"onChange:"+r.TSK_STATE_ATTR,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.PERCENT_COMPLETE,this.onFieldValueChange)),this.listenTo(this.model,"onChange:"+r.PARENT_HAS_SWYM_COMMUNITY,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.PARENT_HAS_LEAN_BOARD,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.PARENT_ATTR,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.TASK_PARENT_ATTR,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.RESTRICT_ASSIGNEE_ATTR,this.onFieldValueChange)}};return w.i18n=D,w.DPM_PROJECT="DPMProject",w.maximize=!0,w.CLASS_NAME=k,w.ACTIVE_CLASS_NAME=A,w.DETAILSPANEL_MAX_WIDTH=400,w.MATURITY_STATE_CONFIG_ATTR="state",w.ESTIMATED_DURATION_CONFIG_ATTR="estimatedDurationInputValue",w.STATE_CREATE_VALUE="Create",w.STATE_REVIEW_VALUE="Review",w.STATE_COMPLETE_VALUE="Complete",w}),define("DS/CollaborativeTasks/Views/MultiDetailsPanel",["UWA/Core","UWA/Class/Events","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Views/PropertyPanel","DS/E6WCommonApps/Views/MultiPropertyPanel","DS/DocumentManagement/DocumentManagement","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/CollaborativeTasks/Models/TskCloneModel","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/CollaborativeTasks/Views/DetailsPanelMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/ENOCollabRouteTask/RouteTaskDetailsPanelConfig","DS/E6WCommonApps/Models/AssigneeTypeAhead","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/IteropTaskModel","DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/Models/BulkCloneModel","DS/E6WCommonUI/Models/BulkModel","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","DS/E6WCommonUI/UIHelper"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,b,_,D,k,A){"use strict";var w="column ds-dialog property-panel off",E="off";w="slide-in-panel right ds-dialog",E="active";var y=a.extend({_uwaClassName:"MultiDetailsPanel",_durationOfDetailOpening:500,tagName:"div",name:"CollaborativeTasks.MultiDetailsPanel",bookmarkItem:function(){this._bookmarkHandler()},id:function(){return"MultiDetailsPanelView"},getOriginalConfig:function(){var t;if(!this.model)return this.erTaskConfig;var s=this.model;s instanceof D&&(s=s.models[0]),s.isRouteTask()?(t=this._getRouteTaskConfig()).options=r.options:s.isRDFTask()?((t=this._getRDFTaskConfig(this._detailsView&&this._detailsView.model&&this._detailsView.model.model===s?this._detailsView.model:s)).options=T.options,this.showOrHideBookmarkForRepositoryField(t)):s.isIteropTask()?(t=this._getIteropTaskConfig(s)).options=S.options:(t=this._getERTaskConfig(s)).options=r.options;var i=e.clone(t,!0);if(i.options=t.options,!(s instanceof D)){(s.isProjectTask()||"TRUE"===s.get("hasProject"))&&this.treatProjectTaskAttributes(i);var a=s.getCustomFields();a&&this.treatCustomFields(i,a)}return this.config=i,i},_updateActionButtonsState:Function.prototype});return y.implement(d,h),y.maximize=!0,y.CLASS_NAME=w,y.ACTIVE_CLASS_NAME=E,y.STATE_CREATE_VALUE="Create",y.STATE_REVIEW_VALUE="Review",y.STATE_COMPLETE_VALUE="Complete",y.DETAILSPANEL_MAX_WIDTH=400,y.MATURITY_STATE_CONFIG_ATTR="state",y.ESTIMATED_DURATION_CONFIG_ATTR="estimatedDurationInputValue",y}),define("DS/CollaborativeTasks/Views/DetailsPanel",["UWA/Core","UWA/Class/Events","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Views/PropertyPanel","DS/DocumentManagement/DocumentManagement","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/CollaborativeTasks/Models/TskCloneModel","DS/CollaborativeTasks/Models/SourcingTaskModel","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/E6WCommonApps/Views/ChecklistView","DS/ENOCollabRouteTask/RouteTaskDetailsPanelConfig","DS/CollaborativeTasks/Views/DetailsPanelMixin","DS/E6WCommonApps/Models/AssigneeTypeAhead","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/IteropTaskModel","DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig","DS/E6WCommonUI/Models/CloneModel","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","DS/E6WCommonUI/UIHelper"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,b,_,D,k){"use strict";var A=function(e){var t=s.getWidgetConstant.apply(this,arguments);if(t===e||null==t){var i=D.get(e);return i===e&&(i=k.get(e)),i}return t},w="column ds-dialog property-panel off",E="off";w="slide-in-panel right ds-dialog",E="active";var y=i.extend({_uwaClassName:"DetailsPanel",className:w,name:"CollaborativeTasks.DetailsPanel",id:function(){return"DetailsPanelView"},getOriginalConfig:function(){var t=this.erTaskConfig;if(!this.model)return t;this.model instanceof c?(t=this._getSourcingTaskConfig()).options=l.options:this.model.isRouteTask()?(t=this._getRouteTaskConfig()).options=l.options:this.model instanceof u?((t=this._getRDFTaskConfig(this._detailsView.model&&this._detailsView.model.model===this.model?this._detailsView.model:this.model)).options=f.options,this.showOrHideBookmarkForRepositoryField(t)):this.model instanceof S?(t=this._getIteropTaskConfig(this.model)).options=b.options:(t=this._getERTaskConfig(this.model)).options=l.options;var s=e.clone(t,!0);s.options=t.options,(this.model.isProjectTask()||"TRUE"===this.model.get("hasProject"))&&this.treatProjectTaskAttributes(s);var i=this.model.getCustomFields();return i&&this.treatCustomFields(s,i),this.config=s,s},getChecklistConfig:function(){return[{name:v.HAS_CHECKLIST_ATTR,customView:m}]},_updateActionButtonsState:function(){delete this._panelActionsMenu,this._panelActionsMenu=this.createMenuButtons();var t=this.getElement(".panel-actions #openSubButtonPropertPanel .fonticon"),s=this.getElement("#subscribeToItem"),i=this.getElement("#openProjectItem"),a=this.getElement("#duplicateButton");if(this._updateStateOfAssignToSelfButton(),this._updateStateOfDeleteButton(),t&&(t.className=this.model.get("_xplanSubscribed")?"fonticon fonticon-bell active no-hover":"fonticon fonticon-bell-off"),a){var o=e.is(this.model.getParent,"function")&&this.model.getParent();(this.model.isProjectTask()||this.model.isRouteTask()||!o||o&&o instanceof h)&&a.remove()}if(i&&(this.isModelAProjectTask()?i.toggleClassName("disabled",!1):i.remove()),s){s.toggleClassName("active",this.subscribedToItem());var n=this.getElement("#subscribeToItem");this.subscribedToItem()?n.set("title",A("emxCollaborativeTasks.Command.UnsubscribeFromNotifications")):n.set("title",A("emxCollaborativeTasks.Command.SubscribeToNotifications")),this.model.subscriptionsEnabled()||s.remove()}this._emptyMenu(),this._drawMenu()}});return y.implement(d,C),y.maximize=!0,y.CLASS_NAME=w,y.ACTIVE_CLASS_NAME=E,y.STATE_CREATE_VALUE="Create",y.STATE_REVIEW_VALUE="Review",y.STATE_COMPLETE_VALUE="Complete",y.DETAILSPANEL_MAX_WIDTH=400,y.MATURITY_STATE_CONFIG_ATTR="state",y.ESTIMATED_DURATION_CONFIG_ATTR="estimatedDurationInputValue",y}),define("DS/CollaborativeTasks/Views/DetailsPanelManager",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/BulkModel","DS/CollaborativeTasks/Views/DetailsPanel","DS/CollaborativeTasks/Views/MultiDetailsPanel"],function(e,t,s,i,a,o,n,l){"use strict";return t.extend(s,i,{init:function(e){this._parentView=e.parentView,delete e.parentView,this._postResetAction=e.postResetAction,delete e.postResetAction,this._detailPanel=new n(e),this._multiDetailPanel=new l(e),this._parentView.listenTo(this._detailPanel,"onCloseIfOpen",e.onCloseDetail),this._parentView.listenTo(this._multiDetailPanel,"onCloseIfOpen",e.onCloseDetail),this.listenTo(this._detailPanel,"onClose",function(){this.dispatchEvent("collapseRightContent")}),this.listenTo(this._multiDetailPanel,"onClose",function(){this.dispatchEvent("collapseRightContent")}),this.listenTo(this._detailPanel,"onOpen",function(){this.dispatchEvent("expandRightContent",arguments)}),this.listenTo(this._multiDetailPanel,"onOpen",function(){this.dispatchEvent("expandRightContent",arguments)}),this._parentView.addChildView(this._detailPanel),this._parentView.addChildView(this._multiDetailPanel)},getDetailsPanel:function(){return this._detailPanel},getMultiDetailsPanel:function(){return this._multiDetailPanel},destroy:function(){this._detailPanel&&this._detailPanel.destroy(),delete this._detailPanel,this._multiDetailPanel&&this._multiDetailPanel.destroy(),delete this._multiDetailPanel},injectDetailsPanel:function(e,t){t?this._multiDetailPanel.inject(e):this._detailPanel.inject(e)},multiDetailsPanelIsOpen:function(){return this.getMultiDetailsPanel().isOpen()},singleDetailsPanelIsOpen:function(){return this.getDetailsPanel().isOpen()},closeDetailPanelsIfTheyExist:function(){this._parentView&&(this._detailPanel&&this._detailPanel.container&&this._detailPanel.close(),this._multiDetailPanel&&this._multiDetailPanel.container&&this._multiDetailPanel.close())},openDetailsPanel:function(e,t){let s=this._parentView._selectedChildView?this._parentView._selectedChildView.container.clientWidth:this._parentView.container.clientWidth;var i=a.isWidgetNarrow()?s:n.DETAILSPANEL_MAX_WIDTH;let r;if(this._parentView._cancelManagementViewPropertyPanelChanges&&this._parentView._cancelManagementViewPropertyPanelChanges({onCancel:Function.prototype}),t){if(!(this._parentView._selectedModels&&this._parentView._selectedModels.length>0))return;r=new o(this._parentView._selectedModels),this._detailPanel.close(),this._multiDetailPanel.open(i),this._multiDetailPanel.resetModel(r,{force:!0}),this._postResetAction(l,this._multiDetailPanel,e)}else r=this._parentView._selectedView?this._parentView._selectedView.model:this._parentView._selectedModels[0],this._multiDetailPanel.close(),this._detailPanel.open(i),this._detailPanel.resetModel(r,{force:!0}),this._postResetAction(n,this._detailPanel,e)}})});var groupViewerModuleName="DS/i3DXRDFGroupViewer/js/GroupViewer";define("DS/CollaborativeTasks/Views/CollaborativeTasksView",["UWA/Core","UWA/Event","UWA/Controls/Drag","DS/UIKIT/Input/Button","DS/Controls/Toggle","DS/UIKIT/SuperModal","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/WAFData/WAFData","DS/Handlebars/Handlebars4","DS/ENO6WPlugins/jQuery_3.3.1","DS/Foundation/WidgetUwaUtils","DS/Foundation/WidgetAPIs","DS/E6WCommonUI/Views/FoundationBaseView","DS/E6WCommonUI/Views/DetailsDisplayView","DS/Foundation2/FoundationV2Data","DS/DocumentManagement/DocumentManagement","DS/CollaborativeTasks/Collections/MergingSplitCollection","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/TagUtils","DS/Foundation2/TaggerAggregator","DS/CollaborativeTasks/Views/ColumnView","DS/CollaborativeTasks/Views/CardView","DS/CollaborativeTasks/Views/DetailsPanel","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/ScheduleElementPopupModel","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Views/CreateDialogTabMixin","DS/XTaskApp/Models/ScopeModelContainer","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/RDFFoundation/CustomExtensionUtils","DS/CollaborativeTasks/Views/TasksTableView","DS/CollaborativeTasks/Views/CreateTaskElementConfig","DS/CollaborativeTasks/Views/MultiDetailsPanel","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/FeatureFlagUtils","DS/PlatformAPI/PlatformAPI","DS/ENXESignature/Views/Dialogs/ESignatureAuthDialog","DS/Windows/ImmersiveFrame","DS/E6WCommonApps/LiveUpdateUtils","DS/E6WCommonApps/TaskUtils","DS/E6WCommonApps/TaggerChipColorMixin","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/ScheduleConstants","DS/CollaborativeTasks/Views/DetailsPanelManager","DS/CollaborativeTasks/Views/TasksViewSelectionMixin",groupViewerModuleName,"i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","text!DS/CollaborativeTasks/assets/templates/main.html.handlebars","text!DS/E6WCommonApps/assets/templates/customAttributes.html.handlebars","css!DS/CollaborativeTasks/CollaborativeTasks"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,b,_,D,k,A,w,E,y,M,I,V,F,P,R,N,x,L,O,U,W,j,B,H,G,K,z,Y,q,X,$,J,Z,Q,ee,te){"use strict";v.fixDisplayMessageMethod(),w.typeDictionary.typeMap=w.typeDictionary.typeMap||{},e.merge(w.typeDictionary,w.typeDictionary,{mapping:[{key:"dsplan:Task",type:E}],typeMap:{"dsplan:Task":E}});var se=Y.DUE_DATE_CATEGORY,ie=function(e){var t=g.getWidgetConstant.apply(this,arguments);return t===e&&(t=Z.get(e)),t===e&&(t=Q.get(e)),t},ae=0,oe=c.compile(ee),ne=c.compile(te),le=M.FILTER_ALL,re=M.FILTER_OWNED,ce=M.FILTER_ASSIGNED,de=M.FILTER_CANDIDATE_ASSIGNEE,he="cards-small",ue="cards-large",pe="task-table",me={"cards-small":"smallCards","cards-large":"largeCards","task-table":"taskTable"},ge={taskTable:pe,smallCards:he,largeCards:ue},Ce={smallCards:"fonticon-view-small-tile ",largeCards:"fonticon-view-big-tile ",taskTable:"fonticon-view-list "};var Te=p.extend({_uwaClassName:"CollaborativeTasksView",_minColWidth:256,_maxColWidth:800,_durationOfDetailClosure:300,initiateRouteChangeAssignee:null,className:"collaborative-tasks",name:"CollaborativeTasks.CollaborativeTasksView",scopeName:"",ColumnView:_,domEvents:{"click button.scroll-right":"scrollRight","click button.scroll-left":"scrollLeft","click #createTaskIcon":"fireOnClickCreateTask"},init:function(t){const s=e.clone(t||{},!1);this._rdfCollection=s.rdfCollection,this.iteropTasksCollection=t&&t.iteropCollection,this._srcCollection=s.srcCollection,M.setCollection(this._rdfCollection),this._fetchCount=s.fetchCount||0,Object.defineProperty(this,"_detailPanel",{get:function(){return this.detailsPanelManager&&this.detailsPanelManager.getDetailsPanel()}}),Object.defineProperty(this,"_multiDetailPanel",{get:function(){return this.detailsPanelManager&&this.detailsPanelManager.getMultiDetailsPanel()}}),this._parent.apply(this,arguments)},disableCreateTaskIcon:function(){var e=this.getElement("#createTaskIcon");!e&&this._toolbarElement&&(e=this._toolbarElement.getElement("#createTaskIcon")),e&&e.addClassName("disabled")},enableCreateTaskIcon:function(){var e=this.getElement("#createTaskIcon");!e&&this._toolbarElement&&(e=this._toolbarElement.getElement("#createTaskIcon")),e&&e.removeClassName("disabled")},id:function(){var e="no id found";return this.collection&&this.collection.extid?e=this.collection.extid:this.options&&this.options.rdfCollection&&this.options.rdfCollection.extid&&(e=this.options.rdfCollection.extid),e},destroy:function(){this._fetchNewTagsTimeout&&clearTimeout(this._fetchNewTagsTimeout),this._fetchNewTagsTimeout=void 0,this.scopeIdView&&this.scopeIdView.destroy(),delete this.scopeIdView,this._parent(),this.$dsTaskManagement=null,delete this._columnStyle,delete this._columnsCarrier,this._taskTools&&this._taskTools.destroy(),delete this._taskTools,this._tasksFilterMenuButton&&this._tasksFilterMenuButton.destroy(),delete this._tasksFilterMenuButton,this._smallLargeCardTooltip&&this._smallLargeCardTooltip.destroy(),delete this._smallLargeCardTooltip,this._tasksFilterDropDownMenu&&this._tasksFilterDropDownMenu.destroy(),delete this._tasksFilterDropDownMenu,this._createTaskTooltip&&this._createTaskTooltip.destroy(),delete this._createTaskTooltip,this._displayMenuButton&&this._displayMenuButton.destroy(),delete this._displayMenuButton,this._viewByTooltip&&this._viewByTooltip.destroy(),delete this._viewByTooltip,delete this._displayOptionsDropdown,delete this._scopeIdContainer,this.scopeIdView&&(this.stopListening(this.scopeIdView),this.scopeIdView.destroy(),delete this.scopeIdView),delete this._scopeListenedTo,this.modal&&this.modal.destroy(),delete this.modal,this._detailsViewCreateTask&&this._detailsViewCreateTask.destroy(),delete this._detailsViewCreateTask,this._repeatCheckBox&&this._repeatCheckBox.destroy(),delete this._repeatCheckBox,this.scopeIdView&&this.scopeIdView.destroy(),delete this.scopeIdView,this.tasksTableView&&this.tasksTableView.destroy(),this.tasksTableView=void 0,this.charEditor&&this.charEditor.destroy(),this.charEditor=void 0},cleanUpChildren:function(){this._circleContainer&&this._circleContainer.empty(!0),this._parent(),this.detailsPanelManager&&this.detailsPanelManager.destroy(),this._columnViews=[]},selectById:function(e){var t=this,s=this.getColumnAndCardIdxFromId(e),i=s[0],a=s[1];if(i&&-1!==a){_._cardHeight||i._computeCardHeight();var o=_._cardHeight*a;i._scroller.scrollTo(0,o),setTimeout(function(){var a;i&&i._childrenViews||(s=this.getColumnAndCardIdxFromId(e),i=s[0]);for(var o=0;o<i._childrenViews.length;o++){var n=i._childrenViews[o];if(n.model.id===e){a=n;break}}a&&(t.singleSelectCardFull(a),t._detailPanel.selectTab(widget.getValue("propertyPanelTab"))),widget.deleteValue("propertyPanelTab")}.bind(this),0)}},getColumnAndCardIdxFromId:function(e){for(var t,s=-1,i=this._childrenViews.length,a=0;a<i;a++){var o=(t=this._childrenViews[a]).collection;if(o){var n=o.get(e);if(n){s=o.indexOf(n);break}}}return[t,s]},onTaskCardClicked:function(e,t){this._multiSelectMode||(!this._selectedView||t!==this._selectedView&&t.model!==this._selectedView.model?this._selectedView&&t!==this._selectedView?(this.singleSelectCardFull(t),t.model.markDeliverablesOn3DNavigate(),v.trackPageEvent({eventCategory:"taskMenu",eventAction:"edit",eventLabel:"iCardViewModel",eventValue:t.model})):(this.singleSelectCardActual(t),t.model.markDeliverablesOn3DNavigate(),v.trackPageEvent({eventCategory:"taskMenu",eventAction:"edit",eventLabel:"iCardViewModel",eventValue:t.model})):this.singleUnselectCardFull(t))},onTaskCardEdit:function(e,t){this._multiSelectMode?this._selectedModels.includes(t.model)?this.openCloseMultiSelectDetailsPanel():this.multiSelectCardFull([t],!0):this.onTaskCardClicked(e,t)},onTaskCardContextMenu:function(e,t){this._multiSelectMode&&this._selectedModels.length>1?this._selectedModels.includes(e.model)?(e.model.dispatchEvent("selectionChanged",{shouldShow:!0}),t()):this.cancelDetailsPanelAndUnselectAllBeforeAction(t):(this._multiSelectMode&&1===this._selectedModels.length&&e.model.dispatchEvent("selectionChanged",{shouldShow:!0}),t())},select:function(e,t){var s=this;function i(){s._selectedModels.length>1?s.areModelsOfSameType(s._selectedModels)?"function"==typeof s._selectedModels[0].isRouteTask&&s._selectedModels[0].isRouteTask()?v.displayWarning(ie("E6WCommonUI.Label.RouteTaskMultiselectNotSupported")):"function"==typeof s._selectedModels[0].isIteropTask&&s._selectedModels[0].isIteropTask()?v.displayWarning(ie("E6WCommonUI.Label.IteropTaskMultiselectNotSupported")):(s._selectedChildView=e,s.detailsPanelManager.openDetailsPanel(s._childrenViews.indexOf(e)+1,!0)):(v.displayWarning(ie("E6WCommonUI.Label.ChooseSameTypeObjects")),s.detailsPanelManager.closeDetailPanelsIfTheyExist()):(s._selectedView&&!s._selectedView.model._isChecked&&s._selectedView.onUnselect(),t.onSelect(),s._selectedChildView=e,s._selectedView=t,s.detailsPanelManager.openDetailsPanel(s._childrenViews.indexOf(e)+1))}if(this._selectedView){var a=!this._selectedChildView||this._selectedChildView===e||k.maximize;this._detailPanel.cancel({keepPanelOpen:a,onCancel:function(){s._durationOfDetailClosure&&!a?setTimeout(i,s._durationOfDetailClosure):i(),s.handleTagCollect(t)}})}else i(),this.handleTagCollect(t)},onMultiSelection:function(e,t,s){this._multiSelectMode=s.multiselect,this.handleMultiSelection(e,t)},handleMultiSelection:function(e,t){t.model._isChecked&&!0===t.model._isChecked?this.onUnclickCheckBox(t):this.onClickCheckBox(t)},selectCardInMultiSelectMode:function(e){e.onSelectCheckbox(),e.onSelect(),e.model._isChecked=!0,-1===this._selectedModels.indexOf(e.model)&&(this._selectedModels.push(e.model),this._selectedCards.push(e))},onClickCheckBox:function(e){this._selectedView&&this._selectedView===e?this.multiSelectCardSimple(e):this.multiSelectCardFull([e])},onUnclickCheckBox:function(e){this.multiUnselectCardFull([e])},areModelsOfSameType:function(e){let t,s;for(let i=0;i<e.length;i++){let a=e[i].get("type")?e[i].get("type"):e[i].get("dsxplan:jsType"),o=e[i].isProjectTask();if(t){if(t!==a)return!1}else t=a;if(0===i)s=o;else if(s!==o)return!1}return!0},isMultiSelectionValid:function(e){let t=this._selectedModels.concat([]);return e&&t.push(e.model),t&&t.length>20?(v.displayWarning(ie("E6WCommonUI.Label.LimitMultiSelectEdit")),!1):this.areModelsOfSameType(t)?"function"==typeof t[0].isRouteTask&&t[0].isRouteTask()?(v.displayWarning(ie("E6WCommonUI.Label.RouteTaskMultiselectNotSupported")),!1):"function"!=typeof t[0].isIteropTask||!t[0].isIteropTask()||(v.displayWarning(ie("E6WCommonUI.Label.IteropTaskMultiselectNotSupported")),!1):(v.displayWarning(ie("E6WCommonUI.Label.ChooseSameTypeObjects")),!1)},cancelDetailsPanel:function(e,t){var s=this;(this.detailsPanelManager.getDetailsPanel().isOpen()?this.detailsPanelManager.getDetailsPanel():this.detailsPanelManager.getMultiDetailsPanel()).cancel({keepPanelOpen:e,onCancel:function(){t&&t.onCancel&&t.onCancel()},onAbortCancel:function(){s.scopeModelContainer.getScope()&&(M.removeScopeData(),s.scopeModelContainer.removeScopeInternal(),s.onReset())}})},handleTagCollect:function(e){this.collection&&(this.collection.handleFocusOnSubjects?this.collection.handleFocusOnSubjects(e&&e.model):R.handleFocusOnSubjects.call(this.collection,e&&e.model))},resetChildViews:function(){var t=this;this.cleanUpChildren();var s=this.collection.allValues();this._circleContainer||(this._circleContainer=e.createElement("ul")),s&&s.forEach(this.createColumnView,this);let i={stateValues:this.collection.allStates(),collection:this.collection,deliverablesTypes:this.collection.deliverablesTypes(),deliverablesTypesForSearch:this.collection.deliverablesTypesForSearch(),taskRequirementValues:this.collection.allTaskRequirements(),routeTaskActionValues:this.collection.allRouteTaskActions(),routeTaskStateValues:this.collection.allRouteTaskStates(),routeTaskNoReviewStateValues:this.collection.allRouteTaskNoReviewStates(),routeTaskApprovalActionValues:this.collection.allRouteTaskApprovalActions(),alertMessageContainer:this._alertContainer||this.container,context:h.getContext(),callbackForVisibleTasks:function(){return t.filterModelsWithSameParentWorkScopeAsSelectedTask(t.getVisibleRDFModels())},parentView:this,onCloseDetail:this.onCloseDetail.bind(this),postResetAction:this.handleOrderAndScroll.bind(this)};this.detailsPanelManager=new X(i)},getColumnViewCollection:function(e){var t=this.collection.tasksWithAttrValueCollection(e),s=new T;if(s.addSubCollection(t),this._rdfCollection){var i=this._rdfCollection.tasksWithAttrValueCollection(e);s.addSubCollection(i)}if(this.iteropTasksCollection){var a=this.iteropTasksCollection.tasksWithAttrValueCollection(e);s.addSubCollection(a)}if(this._srcCollection){var o=this._srcCollection.tasksWithAttrValueCollection(e);s.addSubCollection(o)}return t=s},unselectTaskForDestruction:function(e){this._selectedView===e&&this.singleUnselectCardSimple(e)},createColumnView:function(t,s){var i=new this.ColumnView({parentView:this,collection:this.getColumnViewCollection(t),$dsTaskManagement:this.$dsTaskManagement,stateValues:this.collection.allStates(),attrDisplayValue:t.displayValue,attrValue:t.actualValue});this._columnViews.push(i);var a=s+1+"0";return i.container.setAttributes({style:"order:"+a+"; -webkit-order:"+a+"; -ms-order:"+a+";"}),this.addChildView(i),this.listenTo(i,"onTaskCardClicked",this.onTaskCardClicked.bind(this,i)),this.listenTo(i,"onTaskCardEdit",this.onTaskCardEdit.bind(this,i)),this.listenTo(i,"editMockTaskCard",this.onTaskCardEdit.bind(this,i)),this.listenTo(i,"onTaskCardContextMenu",this.onTaskCardContextMenu.bind(this)),this.listenTo(i,"onTaskDestroyed",this.unselectTaskForDestruction.bind(this)),this.listenTo(i,"onMultiSelection",this.onMultiSelection.bind(this,i)),e.createElement("li").inject(this._circleContainer),i},onCloseDetail:function(){this._selectedView&&!this._selectedView._recycled&&this.singleUnselectCardActual(this._selectedView);var e=this._selectedChildView;if(k.maximize)this._updateScrollButtonsAndDots();else{if(this.onResize(),this._maxLeftIndex()<this.getLeftColumnIndex())this.scrollLeft();else{var t=this.getLeftColumnIndex();--t>=0&&t<this._childrenViews.length&&e===this._childrenViews[t]&&this.scrollLeft()}this._circleContainer.getElements("li").pop().remove(),this._updateScrollButtonsAndDots()}this.handleTagCollect()},handleOrderAndScroll:function(t,s,i){if(!t.maximize){s.isOpen()||e.createElement("li").inject(this._circleContainer);let t=10*i+1;this.onResize(),s.container.setAttributes({style:"order:"+t+"; -webkit-order:"+t+"; -ms-order:"+t+";"}),i-this.getLeftColumnIndex()===this._nbColumnsShown?this.scrollRight():this._updateScrollButtonsAndDots()}},filterTasks:function(e){var t=M.getFilter(),s=e.value;s!==t&&(M.setFilter(s),enoviaServer.preferences.currentTaskFilter=s,this.setTitleDefaultValue(),this._drawTaskTools(),this.onFilter(),v.trackPageEvent({eventCategory:"taskView",eventAction:"filter",eventLabel:"filterValue",eventValue:s}))},onFilter:function(){this.onReset()},switchView:function(e,t){if(e!==this.currentViewName){this.currentViewName&&this.container.toggleClassName("tasks-"+this.currentViewName,!1),this.container.toggleClassName("tasks-"+e,!0),this.currentViewName=e;this.collection.setAttrToSplitBy(this.currentViewName,!1),this._rdfCollection&&this._rdfCollection.setAttrToSplitBy(this.currentViewName,!1),this.iteropTasksCollection&&this.iteropTasksCollection.setAttrToSplitBy(this.currentViewName,!1),this._srcCollection&&this._srcCollection.setAttrToSplitBy(this.currentViewName,!1),t||this.colChanged(),widget.setValue("currentView",e),this.onResize()}this._drawTaskTools()},colReset:function(){},colChanged:function(){this.resetChildViews(),this.onResize(),this.renderColumns(),this.dispatchEvent("afterColChanged"),this.updateTitle()},setScopeNameLabels:function(){if(this.container.isInjected()){var e,t=this.scopeModelContainer.getScope();t&&(e=t.get("name")),this.setTitleDefaultValue(),window.widget&&window.widget.getValue("appId")===Y.APP_TSK&&this.setCredentialPreference(),this.modifyCreateTaskText(e),this.setScopePlaceholderText(t),this.collection&&this.listenToOnce(this.collection,"onSync",this.updateTitle),this._rdfCollection&&this.listenToOnce(this._rdfCollection,"onSync",this.updateTitle),this._srcCollection&&this.listenToOnce(this._srcCollection,"onSync",this.updateTitle)}},setCredentialPreference:function(){window.widget&&widget.getValue("collabspace")!==u.TSK_PRIVATE_SPACE?widget.setValue("xPref_CREDENTIAL",U.getCollaborativeSpaceName()):window.widget&&widget.getValue("collabspace")===u.TSK_PRIVATE_SPACE&&widget.getValue("xPref_CREDENTIAL")&&widget.deleteValue("xPref_CREDENTIAL")},_shouldShowCollabSpaceAlert:function(e){var t,s=!1;if(e){var i=e.get("collabSpace")||this.collection.collabSpace;t=e.get("type")||"";var a=this.collection.projectTypes();a&&-1!==a.split(",").indexOf(t)&&(s=i!==this.collection.collabSpace)}return s},setScopePlaceholderText:function(e){var t=this.scopeIdView.getElement("input[type=text]");if(t){var s=ie("emxCollaborativeTasks.Label.ShowTasksForObject");s=s.replace("%NAME%",ie("emxCollaborativeTasks.WidgetLabel.MyTasks")),e?t.removeAttribute("placeholder"):t.setAttribute("placeholder",s)}},setup:function(t){var s=e.clone(t||{},!1);this.SHOWTASKSFOR=ie("emxCollaborativeTasks.Label.ShowTasksForObject"),this._parent.apply(this,arguments),this.$dsTaskManagement=d(this.container);var i=widget.getValue("currentView"),a=i||"stateForDisplay";this._columnStyleInnerHTML="",this._embeddedApp=s.embeddedApp,this._alertContainer=s.alertContainer,this._singleTaskId=s.singleTaskId,this._columnViews=[],this._selectedModels=[],this._selectedCards=[],this.switchView(a,!0),this.resetChildViews(),this._initializeScopeModelContainer(),this._initializeScopeIdView(),this._rdfCollection&&this.listenTo(this._rdfCollection,"onFailToFindScope",this.onFailToFindRDFScope),this.addListeners(),this.modal=new o({renderTo:this.container,okButtonText:ie("emxCollaborativeTasks.Command.OK"),koButtonText:ie("emxCollaborativeTasks.Command.Cancel")}),this.initTagger()},loadCommonInitializerLibrary:function(){var e=g.getAllFields(this.collection.data()).isLibraryInstalled,t=e&&e.label&&"TRUE"===e.label;this._detailPanel&&this._detailPanel.createCommonLibrary(t)},addListeners:function(){this.collection.dictionaryLoaded?this.loadCommonInitializerLibrary():this.listenToOnce(this.collection,"onChange:dictionary",function(){this.loadCommonInitializerLibrary()}),this.listenTo(this.collection,"onChange:dictionary",function(){this.colChanged()}),this.listenTo(this.collection,"onReset",this.colReset),this.listenTo(this.collection,"onChange:lastReadFrom",this._setLastReadClass),this.listenTo(this.collection,"onChange:search",function(){this.colChanged(),this._updateTnProxyWithSearchFilter()}),widget&&this.listenTo(widget,"onViewChange",this.onViewChange),this.listenTo(this.collection,"onChange:collabSpace",this.render),this.listenTo(this,"onInjected",this.setScopeNameLabels),this.listenTo(this.scopeModelContainer,"onScopeDestroyed",this._onScopeDestroyed),this.eSignatureAuthAndRecordIdUpdate(),this.listenTo(G,"onUpdateNotification",function(e){e.find(e=>{if(M.isScopeRDF()&&M.getScopeId()===e["@id"])return!(e.data&&!e.data["dsplan:hasTask"])&&M.getScope().get("@etag")!==e.ceStamp})&&this.resetRDFCollectionForLiveUpdate()})},eSignatureAuthAndRecordIdUpdate:function(){this.listenTo(this.collection,"onValidationFailure",function(e,t){if(0!==t.fields.length&&"signature_required"===t.fields[0]){var s,i=j.getUser(),a=t.fields[1];"Reject"===a&&(a="Disapprove"),s={eSignPolicyReference:"ESignConfigRoute",Username:i&&i.login,x3dPlatformId:enoviaServer.tenant,ObjectActionType:a},B.init(s).subscribe("ESign-Authenticated",function(t){let s=t.ESignRecordId;e._signature=!0,e.eSignRecordId=s,e.save();let i=U.getServiceUrl("3DSpace",!0)+"/resources/v1/modeler/ESignRecord/"+s,a=e.csrf;var o=e.get("needsReview"),n={actionType:[{ObjectRevision:e.get("revision")},{MaturityChange:{before:"To Do",after:""!==o&&"Yes"===o?"Review":"Complete"}}]},l={csrf:a,data:[{dataelements:{ObjectActionTaken:JSON.stringify(n),ObjectReference:e.id,ObjectServiceID:"3DSpace",ObjectURI:"/resources/v1/modeler/tasks/"}}]};r.authenticatedRequest(i,{method:"PUT",type:"json",data:JSON.stringify(l),headers:{"Content-Type":"application/json"},onComplete:()=>{var e=ie("emxCollaborativeTasks.Success.UpdatedEsignRecordId");v.displaySuccess(e)},onFailure:()=>{var e=ie("emxCollaborativeTasks.Error.FailedToUpdateEsignRecordId");v.displayError(e)}}),delete e._signature})}})},resetRDFCollectionForLiveUpdate:function(){this.resetRDFCollection()},tagAddListener:function(e){var t=this._selectedView.model;R.setExplicitTagsData(t,{object:e.object,sixw:e.predicate}),S.getTagInfo(t)},tagRemoveListener:function(e){var t=this._selectedView.model;R.removeExplicitTagsData(t,{object:e.object,sixw:e.predicate}),S.getTagInfo(t)},_onScopeDestroyed:function(e){e||v.displayError(ie("emxCollaborativeTasks.Error.FailedToRetrieveScope")),this.setTitleDefaultValue()},_initializeScopeIdView:function(){this.scopeIdView=new m({model:this.scopeModelContainer,id:function(){return"changeContextDiv"},DocumentManagement:C,context:h.getContext(),i18n:ie})},resetRDFCollection:function(){if(!this._rdfCollection)return;var e=this;this.showLoadingMessage(!0);let t=this._rdfCollection&&this._rdfCollection.fetch({reset:!0,onComplete:function(){M.setCollection(e._rdfCollection),e.updateTitle.bind(e),e.hideLoadingMessage()},onFailure:function(){e.hideLoadingMessage()}});t&&t.noFetch&&setTimeout(this.hideLoadingMessage.bind(this),0)},resetIteropCollection:function(){try{if(!this.iteropTasksCollection)return;var e=arguments[0];if(M.getObjectData()||e&&e.allfilters&&Object.keys(e.allfilters).length>0)this.iteropTasksCollection.reset();else{var t=this;this.showLoadingMessage(!0),this.iteropTasksCollection.fetch({onComplete:function(){t.hideLoadingMessage()},onFailure:function(){t.hideLoadingMessage()}})}}catch(e){console.log(e),this.hideLoadingMessage()}},resetSRCCollection:function(){try{if(!this._srcCollection)return;var e={previousModels:this._srcCollection.toArray()},t=arguments[0];if(M.getObjectData()||t&&t.allfilters&&Object.keys(t.allfilters).length>0)this._srcCollection.reset();else{var s=this;this.showLoadingMessage(!0),this._srcCollection.fetch({onComplete:function(){s.hideLoadingMessage(),s._srcCollection.dispatchEvent("onReset",[s._srcCollection,e])},onFailure:function(){s.hideLoadingMessage()}})}}catch(e){console.log(e),this.hideLoadingMessage()}},_initializeScopeModelContainer:function(){var e=this;this.scopeModelContainer=new V({collection:this.collection}),this.scopeModelContainer.confirmRemoveScope=function(t){var s=this.get("scope");if(s){var i=s.get("name")||"",a=ie("emxCollaborativeTasks.Command.RemoveContext").replace("%NAME%",i);e.modal.confirm(a,ie("emxCollaborativeTasks.Command.RemoveContextTitle"),function(s){s&&(t(),e.setScopePlaceholderText())})}};var t=function(){this._scopeListenedTo&&this.stopListening(this._scopeListenedTo),this._scopeListenedTo=this.scopeModelContainer.getScope(),this._scopeListenedTo&&this.listenTo(this._scopeListenedTo,{onChange:this.setScopeNameLabels,onReset:this.setScopeNameLabels})};this.listenTo(this.scopeModelContainer,"onChange:scopeId",function(s){t.apply(this),this.updateCreateTaskIcon(),s&&this.onReset(),setTimeout(function(){e.container&&e.container.getElement("#scopeIdContainer").removeClassName("active"),e.container&&e.container.getElement("ul").removeClassName("active")},0)}),t.apply(this)},_setLastReadClass:function(e,t){this.container.toggleClassName("readFromLocal","local"===t)},onViewChange:function(){this.container.click()},template:function(t){let s=e.clone(t||{},!1);e.extend(s,this.collection.dataForRendering()),window.widget&&(s.showCreateDialog=!0);var i=f.i18n;f.i18n=ie;var a=oe(s);return f.i18n=i,a},updateCreateTaskIcon:function(){this.setScopeNameLabels(),this.shouldDisableCreateTask()?this.disableCreateTaskIcon():this.enableCreateTaskIcon()},updateCredentialsBasedOnServiceData:function(){h.onEdit(widget)},render:function(t){return this.removeElementsFromDom(),this.container.empty(!0),this.container.setHTML(this.template()),e.Utils.Client.Platform.ios&&this.container.addClassName("ios"),this._setScopesTypesForSearch(),this._columnStyle=this.getElement("#respColumnWidth"),this._columnStyle.setHTML(this._columnStyleInnerHTML),this.renderColumns(),this.showLoadingMessage(),this._drawTaskTools(),this._addToolTipCreateTaskIcon(),this._setLastReadClass(null,this.collection.lastReadFrom),this._scopeIdContainer=this.getElement("#scopeIdContainer")||widget.getElement("#scopeIdContainer"),this.scopeIdView.render().inject(this._scopeIdContainer),U.hasLoadedRolesData()?this.updateCredentialsBasedOnServiceData():(this.listenToOnce(U,"rolesDataLoaded",this._updateUIBasedOnRoles),this.listenToOnce(U,"serviceDataLoaded",this.updateCredentialsBasedOnServiceData)),this.updateCreateTaskIcon(),this.dispatchEvent("afterRender"),this.container.addClassName(ge[widget.getValue("selectedTaskView")||"smallCards"]),void 0!==this._fetchCount&&this._fetchCount>0&&this.showLoadingMessage(),t&&t.shouldRearrangeDOMElementsForToolbar&&this.rearrangeDOMElementsForToolbar(),this.checkAndInitializeTaskTableView(),this},_addToolTipCreateTaskIcon:function(){var e=this.getElement("#createTaskIcon");this._createTaskTooltip=new l({target:e,body:ie("emxCollaborativeTasks.Label.NewTask"),position:"bottom"})},_updateUIBasedOnRoles:function(){this.updateCreateTaskIcon(),this._detailPanel._detailsView&&this._detailPanel.onFieldValueChange()},injectTaskDetailsPanel:function(){this.detailsPanelManager.injectDetailsPanel(this.container)},injectMultiTaskDetailsPanel:function(){this.detailsPanelManager.injectDetailsPanel(this.container,!0)},showLoadingMessage:function(e){var t=this.getElement(".pagination");e&&this._fetchCount++,this._fetchCount>0&&t&&v.showLoadingMessage(t)},hideLoadingMessage:function(){if(this._fetchCount--,this._fetchCount<=0&&this.container){const e=this.getElement(".pagination");e&&v.hideLoadingMessage(e)}this._fetchCount<0&&(console.error("negative fetch count reset to 0"),this._fetchCount=0)},shouldDisableCreateTask:function(){var e=!1,t=M.isScopeRDF(),s=M.getObjectData();return(M.isScopeSwym()||M.isAgileWorkContext()&&s.isSwym)&&(e=!0),!e&&t&&!M.isAgileWorkContext()&&(e=!U.isXPPAuthorized()),e},removeElementsFromDom:function(){this.tasksTableView&&this.tasksTableView.remove(),this._circleContainer.remove(),this.scopeIdView&&this.scopeIdView.remove();for(var e=this._childrenViews.length,t=0;t<e;t++){this._childrenViews[t].container.remove()}},_setScopesTypesForSearch:function(){var e=this,t=function(){var t=e.scopeModelContainer.config();t[0].activationCallback=function(t,s){e._scopeIdContainer.toggleClassName("active",s)},e.scopeIdView.setConfig(t),e.scopeIdView.render(),e.setScopeNameLabels()};this.collection.scopesTypesForSearch()||this.listenToOnce(this.collection,"onSync",function(){t()}),P.hasLoadedFederatedSearchSources()||this.listenToOnce(P.eventDispatcher,"onFederatedSearchSourcesLoaded",function(){t()}),t()},renderColumns:function(){var e=this.getElement(".columns-carrier");if(this._columnsCarrier=e,e){e.empty();for(var t=this._childrenViews.length,s=0;s<t;s++){var i=this._childrenViews[s];i instanceof k&&k.maximize?this.injectTaskDetailsPanel():i instanceof O&&O.maximize?this.injectMultiTaskDetailsPanel():i.container.inject(e),i.render()}}return this._circleContainer.inject(this.getElement(".pagination")),this.setLeftColumnIndex(0),this},_drawTaskTools:function(){this._taskFilterNLSValues=this._getTaskFilterViewNLSValues(),this._taskTools=this.getElement("#taskTools")||widget.getElement("#taskTools"),this._taskTools&&(this._taskTools.empty(),this._multiSelectButton&&this._multiSelectButton.destroy(),this._multiSelectButton=this._drawMultiSelect().inject(this._taskTools),this._selectedCardsCount&&this._selectedCardsCount.destroy(),this._selectedCardsCount=this._drawSelectedCardsCount().inject(this._taskTools),this._multiSelectDropDownMenu&&this._multiSelectDropDownMenu.destroy(),this._multiSelectDropDownMenu=this._drawMultiSelectDropDownMenu().inject(this._taskTools),this._tasksFilterMenuButton&&this._tasksFilterMenuButton.destroy(),this._tasksFilterMenuButton=this._drawTaskFilterMenu().inject(this._taskTools),this._displayMenuButton&&this._displayMenuButton.destroy(),this._displayMenuButton=this._drawSmallLargeTaskCardsTableViewMenu().inject(this._taskTools),this._displayMenuButton.classList.contains("fonticon-view-list")&&(this._multiSelectButton.destroy(),this._multiSelectDropDownMenu.destroy()))},_drawTaskFilterMenu:function(){var t=e.createElement("span",{id:"ViewMenu",class:"fonticon fonticon-list-filter"});this._viewByTooltip=new l({target:t,body:ie("E6WCommonApps.Label.FilterBy"),position:"bottom"});var s=this.getDropDownItems();return this.setSelectView(s),this._tasksFilterDropDownMenu=new n({id:"ViewMenu",target:t,items:s,events:{onClick:this.onMenuClick.bind(this)}}),t},onMenuClick:function(e,t){t.className.indexOf("filter-")>-1?this.filterTasks(t):this.switchView(t.value),this._multiSelectMode=!1,this.onUnselectAll()},setClassNameAndWidgetValue:function(e){[pe,he,ue].forEach(e=>{this.container.removeClassName(e)}),this.container.addClassName(e),widget.setValue("selectedTaskView",me[e])},_drawMultiSelect:function(){var t=e.createElement("span",{class:"fonticon fonticon-select-off item-select",id:"MultiSelect"});return t.set({events:{click:this.onMultiSelectClick.bind(this)}}),this._viewByTooltip=new l({target:t,body:ie("E6WCommonApps.Label.MultiSelect"),position:"bottom"}),t},_drawSelectedCardsCount:function(){return e.createElement("a",{class:"fonticon selected-cards-count item-select",id:"SelectedCardsCount",html:""})},_drawMultiSelectDropDownMenu:function(){var t=e.createElement("span",{class:"fonticon fonticon-open-down item-select"}),s="";"allLevelTasks"===widget.getValue(Y.LEVEL_PREF)&&(s="disabled");var i=[{text:ie("E6WCommonApps.Label.MultiSelectMode"),className:"multi-select",id:"multiSelect",fonticon:"fonticon fonticon-select-on"},{text:ie("E6WCommonApps.Label.SelectAll"),className:"select-all "+s,id:"SelectAll",fonticon:"fonticon fonticon-select-all"},{text:ie("E6WCommonApps.Label.UnselectAll"),className:"unselect-all",id:"UnselectAll",fonticon:"fonticon fonticon-select-none"}];return i.push({text:ie("E6WCommonApps.Label.EditSelected"),className:"edit-selected",id:"EditSelected",fonticon:"fonticon fonticon-pencil"}),this._multiSelectDropDownMenu=new n({target:t,items:i,events:{onClick:this.onMultiSelectionDropDownClick.bind(this)}}),t},onMultiSelectClick:function(e,t){this.getElements(".collaborative-tasks-content .wux-controls-responsivetileview-checkbox").forEach(function(e){e.toggleClassName("wux-ui-state-prehighlighted")}),this._multiSelectButton.toggleClassName("fonticon-select-off"),this._multiSelectButton.toggleClassName("fonticon-select-on"),this._multiSelectMode&&!0===this._multiSelectMode?(this.getElements(".collaborative-tasks-content .wux-controls-responsivetileview-checkbox").forEach(function(e){e.classList.remove("wux-ui-state-prehighlighted"),e.classList.remove("wux-ui-state-highlighted")}),this.getElements(".real-card").forEach(function(e){e.classList.remove("active"),e.classList.remove("checkbox-selected")}),this._selectedModels&&this._selectedModels.forEach(function(e){e._isChecked=!1}),this._selectedModels=[],this._selectedCards=[],this._multiSelectMode=!1):this._multiSelectMode=!0,this._selectedModels&&this._selectedModels.length>0?this._selectedCardsCount.innerHTML=this._selectedModels.length:this._selectedCardsCount.innerHTML=""},onUnselectAll:function(){this.clearSelectedCards()},onSelectAll:function(){var e=this;this._columnViews.forEach(function(t){t.collection.toArray().forEach(function(t){e._selectedModels.includes(t)||e._selectedModels.push(t)}),t._childrenViews.forEach(function(t){t.isSelected()||e.multiSelectCardBasic(t)})}),this._selectedCardsCount.innerHTML=this._selectedModels.length},onMultiSelectionDropDownClick:function(e,t){"SelectAll"===t.id?this.onSelectAll():"UnselectAll"===t.id?this.onUnselectAll():"multiSelect"===t.id?this.onMultiSelectClick(e):"EditSelected"===t.id&&this._multiSelectMode&&this.isMultiSelectionValid()&&(1===this._selectedModels.length?this.detailsPanelManager.openDetailsPanel(1):this.detailsPanelManager.openDetailsPanel(1,!0))},_drawSmallLargeTaskCardsTableViewMenu:function(){var t=this,s=e.createElement("span",{class:"fonticon "+Ce[widget.getValue("selectedTaskView")||"smallCards"]});this._smallLargeCardTooltip=new l({target:s,body:ie("E6WCommonApps.Label.SwitchView"),position:"bottom"});var i=[{text:ie("E6WCommonApps.Label.SmallTiles"),selected:"smallCards"===widget.getValue("selectedTaskView"),class:he,fonticon:"fonticon fonticon-view-small-tile "},{text:ie("E6WCommonApps.Label.LargeTiles"),selected:"largeCards"===widget.getValue("selectedTaskView"),class:ue,fonticon:"fonticon fonticon-view-big-tile "},{text:ie("E6WCommonApps.Tasks.Label.TaskTableView"),selected:"taskTable"===widget.getValue("selectedTaskView"),class:pe,fonticon:"fonticon fonticon-view-list "}];return this._displayOptionsDropdown=new n({target:s,items:i,events:{onClick:function(e,s){t.setClassNameAndWidgetValue(s.class),t._drawTaskTools(),t.checkAndInitializeTaskTableView(),t.colChanged()}}}),s},checkAndInitializeTaskTableView:function(){"taskTable"===widget.getValue("selectedTaskView")&&this.initializeTaskTableView()},initializeTaskTableView:function(){this.tasksTableView||(this.tasksTableView=new x({tasksCollection:this.collection,rdfTasksCollection:this._rdfCollection,iteropTasksCollection:this.iteropTasksCollection,srcCollection:this._srcCollection,parentTaskView:this}),this.tasksTableView.listenTo(this,"scopeInitializedOnTaskView",function(e){this.scopeModelContainer=e,this.listenTo(e,"onChange:scopeId",this.setupLoadingMessages)})),this.tasksTableView.inject(this.getElement("#taskTableViewDiv"))},_getTaskFilterViewNLSValues:function(){return{viewBy:ie("E6WCommonApps.Label.FilterBy"),stateForDisplay:ie("emxCollaborativeTasks.Command.View.stateForDisplay"),state:ie("emxCollaborativeTasks.Command.View.state"),dueDateCategory:ie("emxCollaborativeTasks.Command.View.dueDateCategory"),all:ie("emxCollaborativeTasks.Command.Filter.all"),owned:ie("emxCollaborativeTasks.Command.Filter.owned"),assigned:ie("emxCollaborativeTasks.Command.Filter.assigned"),candidateAssignee:ie("emxCollaborativeTasks.Command.Filter.candidateAssignee")}},getDropDownItems:function(){var e=this._taskFilterNLSValues,t=[],s="";return"taskTable"===widget.getValue("selectedTaskView")&&(s="disabled"),t.push({className:"drop-tool view-by-menu stateForDisplay-view "+s,text:e.stateForDisplay,value:"stateForDisplay"}),this._embeddedApp||t.push({className:"drop-tool view-by-menu state-view "+s,text:e.state,value:"state"}),t.push({className:"drop-tool view-by-menu dueDateCategory-view "+s,text:e.dueDateCategory,value:se}),t.push({className:"divider"}),t.push({className:"drop-tool task-filter filter-all",text:e.all,value:le}),t.push({className:"drop-tool task-filter filter-owned",text:e.owned,value:re}),t.push({className:"drop-tool task-filter filter-assigned",text:e.assigned,value:ce}),t.push({className:"drop-tool task-filter filter-candidate-assignee",text:e.candidateAssignee,value:de}),t},setSelectView:function(e){var t=this,s=M.getFilter();return e.forEach(function(e){t.currentViewName===e.value||s===e.value?e.fonticon="fonticon fonticon-check":e.fonticon="fonticon"}),e},scrollRight:function(){var e=this.getLeftColumnIndex();this.setLeftColumnIndex(++e)},scrollLeft:function(){var e=this.getLeftColumnIndex();this.setLeftColumnIndex(--e)},_resetSingleTask:function(){U.hasAccess("3DSpace")&&this.collection.fetchTaskById(this._singleTaskId,{reset:!0}),this._rdfCollection.length&&this._rdfCollection.at(0).fetch()},onReset:function(){this.onViewChange(),this.scopeModelContainer._scope&&this.scopeModelContainer.validateRDFScopeWithServer(this.scopeModelContainer._scope),this._singleTaskId?this._resetSingleTask():this.resetCollections()},resetCollections:function(){var e=this,t=!this._embeddedApp&&U.hasAccess("3DSpace"),s={previousModels:this.collection.toArray()};if(t){this.showLoadingMessage(!0);let t=this.collection.fetch({server:!0,reset:!0,onComplete:function(){e.updateTitle(),e.hideLoadingMessage(),e.collection.dispatchEvent("onReset",[e.collection,s]);var t=ie("emxCollaborativeTasks.Label.SuccessfulRefresh");v.displaySuccess(t)},onFailure:function(t,s){e.hideLoadingMessage();var i=A.getErrorMessageForInvalidCredentials(s);if(!i){var a=ie("emxCollaborativeTasks.Label.FailedRefresh");i=s&&s.error||a}v.displayError(i)}});t&&t.noFetch&&setTimeout(this.hideLoadingMessage.bind(this),0)}this.resetRDFCollection(),this.resetIteropCollection(),this.resetSRCCollection()},onResize:function(){var e=this;if(!this._childrenViews)return;var t=(this.getElement(".collaborative-tasks-content-wrapper")||this.container).getSize();if(t.width&&t.height){var s=this._nbColumnsShown;!function(){var s=_.nbCardsBuffer,i=_._cardHeight||80;_.nbCardsBuffer=Math.floor(t.height/i)+2*_.nbCardsTopBuffer;for(var a=e._childrenViews.length-1;a>=0;a--){var o=e._childrenViews[a];o.collection&&o.collection.size()>Math.min(s,_.nbCardsBuffer)&&o.resizeBuffer()}}();var i=d(this.container),a=t.width/this._minColWidth,o=Math.floor(a);o=Math.max(1,o);var n,l="min-width:"+this._minColWidth+"px;",r=100/o,c=this._nbColumnsToDisplay(),h=r*c,u=100/c,p="",m="";a>c?(m=".columns-carrier { max-width: calc( "+c+" * "+this._maxColWidth+"px );} ",p=".column { width:"+u+"%;"+l+" max-width:"+this._maxColWidth+"px; } ",i.toggleClass("wide",!0),i.toggleClass("medium",!1),i.toggleClass("narrow",!1),this._nbColumnsShown=c):(i.toggleClass("wide",!1),o>1?(i.toggleClass("medium",!0),i.toggleClass("narrow",!1),l="min-width:0px;"):(i.toggleClass("medium",!1),i.toggleClass("narrow",!0),l="min-width:0px;"),p=".column { width:"+u+"%; max-width:none;"+l+"} ",m=".columns-carrier { width:"+h+"%;} ",this._nbColumnsShown=o||1),n=".collaborative-tasks-content .alert:not(.alert-fullwidth)  { width: calc("+100/this._nbColumnsShown+"% - 4px) }";var g=".column.details-tasks.off { transition: width "+this._durationOfDetailClosure/1e3+"s ease-in-out; }";this._columnStyleInnerHTML=g+p+m+n,this._columnStyle&&this._columnStyle.setHTML(this._columnStyleInnerHTML),s!==this._nbColumnsShown&&this.setLeftColumnIndex(this.getLeftColumnIndex())}},_maxLeftIndex:function(){return this._nbColumnsToDisplay()-this._nbColumnsShown},_stopAutoScrolling:function(){this.autoScrolling=!1},_nbColumnsToDisplay:function(){var e=this._columnViews.length;return this._selectedChildView&&!k.maximize&&e++,e},setLeftColumnIndex:function(e){if(this._childrenViews){var t=e<0?0:e;if(this._selectedChildView&&!k.maximize){var s=this._childrenViews.indexOf(this._selectedChildView)-(this._nbColumnsShown-2);1===this._nbColumnsShown&&(s=this._childrenViews.indexOf(this._selectedChildView)+1),t=t<s?s:t}var i=this._maxLeftIndex();t=t>i?i:t,this._leftColumnIndex!==t&&(this.autoScrolling=!0,setTimeout(this._stopAutoScrolling.bind(this),510)),this._leftColumnIndex=t,this._columnsCarrier&&this._columnsCarrier.setStyle("left",-100*t/this._nbColumnsShown+"%"),this._updateScrollButtonsAndDots()}},_updateScrollButtonsAndDots:function(){var e=this.getLeftColumnIndex(),t=this.getElement(".scroll-left"),s=this.getElement(".scroll-right");t&&t.toggle(0!==e&&!this._selectedChildView),s&&s.toggle(e!==this._maxLeftIndex()&&!this._selectedChildView);var i=this._circleContainer.getElements("li");if(i)for(var a=i.length,o=0;o<a;o++){var n=i[o];o<e||o>=e+this._nbColumnsShown?n.removeClassName("in-view"):n.addClassName("in-view")}for(var l=this._nbColumnsToDisplay(),r=[],c=0;c<l;c++){var d=this._childrenViews[c];r.push(d),d===this._selectedChildView&&(r.push(this.detailsPanelManager.getDetailsPanel()),r.push(this.detailsPanelManager.getMultiDetailsPanel()))}for(var h=e+this._nbColumnsShown-1,u=0;u<l;u++){r[u].container.toggleClassName("right-most-column-shown",u===h)}},getLeftColumnIndex:function(){return this._leftColumnIndex||(this._leftColumnIndex=0),this._leftColumnIndex},onKeyUpCreateTask:function(e,t){"Enter"===e.key&&(e.preventDefault&&e.preventDefault(),this.createTaskAction(t))},_setTaskCollabSpaceAndOrganization:function(e,t,s,i,a){e&&(!e.collabspace||t!==q.DPM_TASK&&1!==e.collabspace.length?s[q.TASK_COLLAB_SPACE]=e.collabspace:s[q.TASK_COLLAB_SPACE]=i?a.get("collabSpace"):e.collabspace[0].displayValue,t===q.DPM_TASK&&e.organization?s[q.TASK_ORGANIZATION]=e.organization[0].displayValue:s[q.TASK_ORGANIZATION]=e.organization)},fireOnClickCreateTask:function(){var e;1===++ae?e=setTimeout(()=>{ae=0,this._onClickCreateTaskButton(1)},400):2===ae&&(clearTimeout(e),ae=0,this._onClickCreateTaskButton(2))},_onClickCreateTaskButton:function(t){if(this.modal&&this.modal.modals.current)return;var s=this.scopeModelContainer.getScope(),i=!1;s&&(i=this._shouldShowCollabSpaceAlert(s));const o={};o.elementType=q.TASK,o.model=new e.Class.Events;var n=new y(o);n[q.REPEAT_CREATE_TASK]=2===t;var l=M.getTSKTaskType(),r=widget.getValue("taskTypeSimpleOrStandAlone");l===q.STANDALONE_TASK&&r===q.SIMPLE_TASK?n[q.TASK_TYPE]=q.SIMPLE_TASK:n[q.TASK_TYPE]=l;var c=F.getPreferencesCredentials();this._setTaskCollabSpaceAndOrganization(c,l,n,i,s);var d=L.getConfig(n);this._detailsViewCreateTask=new m({model:n}),this._detailsViewCreateTask.setConfig(d);var h=this._detailsViewCreateTask&&N.getExtensionsForTaxonomy("dsplan:Task")&&N.getExtensionsForTaxonomy("dsplan:Task").length>0;if(n[q.TASK_TYPE]===q.XPP_TASK&&h){var u=f.i18n;f.i18n=ie;var p=ne();f.i18n=u,this.tabbedDialogcontainer=e.createElement("div",{html:p})}if(this.renderDialog(o,n),n[q.TASK_TYPE]===q.XPP_TASK&&h?(this._setupTabBar(this.tabbedDialogcontainer),this._detailsViewCreateTask.render().inject(this._propertiesForm),this.tabbedDialogcontainer.getParent(".modal-root").classList.add("eno-dialog"),this.tabbedDialogcontainer.getParent(".modal-content").classList.add("ds-dialog")):this._detailsViewCreateTask.render(),this.setProjectTypeIcon(n),i){var g=e.createElement("span",{class:"fonticon fonticon-attention",title:ie("emxCollaborativeTasks.Label.CollaborativeSpaceAttention")}),C=this._detailsViewCreateTask.getFieldViewByName("taskCollabSpace").getElement(".input-group-wrapper");g.inject(C)}var T=e.createElement("div",{class:"primary repeat-check-box"});this._repeatCheckBox=new a({type:"checkbox",label:ie("emxCollaborativeTasks.Label.Repeat"),value:n[q.REPEAT_CREATE_TASK],checkFlag:n[q.REPEAT_CREATE_TASK]}),this._repeatCheckBox.addEventListener("change",function(e){e.dsModel.checkFlag?n[q.REPEAT_CREATE_TASK]=!0:n[q.REPEAT_CREATE_TASK]=!1}),this._repeatCheckBox.elements.container.addClassName("primary"),this._repeatCheckBox.elements.container.addClassName("repeat-check-box"),this._repeatCheckBox.inject(T).inject(this.modal.modals.current.elements.footer,"top"),n.createButton=this.modal.modals.current.elements.container.getElement(".btn-create"),n.createButton&&n.createButton.toggleClassName("disabled",!0),this.listenTo(this._detailsViewCreateTask.model,"onChange:"+q.TASK_TYPE,this.onFieldValueChange),this.listenTo(this._detailsViewCreateTask.model,"onChange:"+q.TASK_COLLAB_SPACE,this.onFieldValueChange),v.isIpad()||v.isAndroid()||this._focusOnTitleFieldAndAddKeyPressEvent(n)},setProjectTypeIcon:function(t){var s;[q.XPP_TASK,q.STANDALONE_TASK].includes(t[q.TASK_TYPE])?s=e.createElement("img",{src:require.toUrl("DS/E6WCommonApps/assets/img/I_ProjectPlanningTask_22.png")}):t[q.TASK_TYPE]===q.SIMPLE_TASK?s=e.createElement("img",{src:require.toUrl("DS/E6WCommonApps/assets/img/I_Simple-Task_22.png")}):t[q.TASK_TYPE]===q.DPM_TASK&&(s=e.createElement("img",{src:require.toUrl("DS/E6WCommonApps/assets/img/I_ProjectTask_22.png")}));var i=this._detailsViewCreateTask.getFieldViewByName("taskType");if(!i._config.readWrite){var a=i.getElement(".object-type");s&&s.inject(a,"top")}},_focusOnTitleFieldAndAddKeyPressEvent:function(e){var t=this._detailsViewCreateTask.getFieldViewByName("title").getElement(".content");t.focus(),t.addEvent("keypress",t=>this.onKeyUpCreateTask(t,e))},onFieldValueChange:function(){if(this._detailsViewCreateTask){var e=L.getConfig(this._detailsViewCreateTask.model);this._detailsViewCreateTask.setConfig(e),this._detailsViewCreateTask.render(),this._focusOnTitleFieldAndAddKeyPressEvent(this._detailsViewCreateTask.model)}},closeModalDialog:function(){this.modal&&this.modal.modals.current.hide(),this.charEditor=void 0},processCreateTaskInput:function(t,s){var i,a=e.clone(s||{},!1),o=t.get("title"),n=t.get("subtitle"),l=t.get("taskType");return l!==q.SIMPLE_TASK&&l!==q.STANDALONE_TASK||widget.setValue("taskTypeSimpleOrStandAlone",l),o&&(i=this.createTask(o,n,l,a.selectTask)),o||this.closeModalDialog(),i&&(a.close?this.closeModalDialog():(t.set("title",""),t.set("subtitle",""),this.onFieldValueChange(),this.setProjectTypeIcon(t),this._templateComboBox&&(this._templateComboBox.value=""),this.charEditor&&this.charEditor.destroy(),this.charEditor=void 0)),i},createTaskAction:function(e){!0===e[q.REPEAT_CREATE_TASK]?this.processCreateTaskInput(e,{close:!1}):this.processCreateTaskInput(e,{close:!0,selectTask:!0})},renderDialog:function(e,t){var s=this._detailsViewCreateTask,i=this._detailsViewCreateTask&&N.getExtensionsForTaxonomy(this._detailsViewCreateTask.model["dsplan:actualType"])&&N.getExtensionsForTaxonomy(this._detailsViewCreateTask.model["dsplan:actualType"]).length>0;t[q.TASK_TYPE]===q.XPP_TASK&&i&&(s=this.tabbedDialogcontainer),this.modal.dialog({body:s,title:ie("emxCollaborativeTasks.Label.CreateNewTask"),buttons:[{className:"primary btn-create",value:ie("emxCollaborativeTasks.PopUp.Create"),action:()=>{this.createTaskAction(t)}},{className:"default",value:ie("emxCollaborativeTasks.Command.Cancel"),action:function(e){e.hide()}}]})},createTask:function(e,t,s,i){var a,o,n=this.collection.allDueDates()[1];i&&(o=function(){_.lastCardAdded&&_.lastCardAdded.onClickTaskCard()});var l=M.getObjectData(),r=!1;if(M.isAgileWorkContext()&&(r=M.isAgileWorkContext()&&!l.isSwym),M.isScopeRDF()&&!r||!M.getScopeType()&&s===q.STANDALONE_TASK){var c={onComplete:o,createDescription:t},d={};if(s===q.XPP_TASK&&this.charEditor&&this.charEditor.getFormValues()){if(!this.charEditor.elements.form.validateForm())return void this.tabBar.getButtonFromValue(1).elements.container.classList.add("has-error");d.extensionID=this._templateComboBox.value;var h=this.charEditor.getFormValues(),u={};Object.keys(h).forEach(function(e){u[e]=h[e].value}),d.instanceParams=u}Object.keys(d).length>0&&(c.extensionAttrs=d),a=this._rdfCollection.addNewTask(e,this.scopeModelContainer.getScope(),c)}else{var p={title:e,description:t,state:this.collection.allStates()[0].actualValue,dueDateCategory:n};(a=this.collection.addNewTask(p)).completed=!0,a.save(null,{onFailure:function(){var e=ie("emxCollaborativeTasks.Error.CannotCreateObjectTask"),t=ie("emxCollaborativeTasks.Error.FailedToCreateTask"),s=arguments[2],i=s&&s.response;if(i&&400===i.statusCode)t=i.error&&i.error.length?ie(v.sanitizeMessage(i.error)):t;else{var a=A.getErrorMessageForInvalidCredentials(i);a&&(t=a)}var o={level:"error",title:e,showWebUX:!0};v.displayError(t,o)},onComplete:function(){o(),v.trackPageEvent({eventCategory:"create",eventAction:"create task",eventLabel:"create task",eventValue:e})},at:0,urlParam:"$fields=deliverablesInheritance,isAssigneeAccessRestricted,calculateDuration,revision,custom,references.description,deliverables.description"})}var m=this.getNewColumnIndex(0,1,a);return this.setLeftColumnIndex(m),a},createTaskWithString:function(e,t){var s,i,a=this.collection.allDueDates()[1];t&&(i=function(){_.lastCardAdded&&_.lastCardAdded.onClickTaskCard()});var o=M.getObjectData(),n=!1;if(M.isAgileWorkContext()&&(n=M.isAgileWorkContext()&&!o.isSwym),M.isScopeRDF()&&!n||!M.getScopeType()&&h.getContext()===u.TSK_PRIVATE_SPACE)s=this._rdfCollection.addNewTask(e,this.scopeModelContainer.getScope(),{onComplete:i});else{var l={title:e,state:this.collection.allStates()[0].actualValue,dueDateCategory:a};(s=this.collection.addNewTask(l)).completed=!0,s.save(null,{onFailure:function(){var e=ie("emxCollaborativeTasks.Error.FailedToCreateTask"),t=arguments[2],s=t&&t.response;if(s&&400===s.statusCode)e=s.error&&s.error.length?ie(v.sanitizeMessage(s.error)):e;else{var i=A.getErrorMessageForInvalidCredentials(s);i&&(e=i)}v.displayError(e)},onComplete:i,at:0,urlParam:"$fields=deliverablesInheritance,isAssigneeAccessRestricted,calculateDuration,revision,custom,references.description,deliverables.description"})}var r=this.getNewColumnIndex(0,1,s);return this.setLeftColumnIndex(r),s},getNewColumnIndex:function(e,t,s){var i=0;if("state"===this.currentViewName)i=e;else if(this.currentViewName===se){var a=s.get(se);i=t,this.collection.allDueDates().detect(function(e,t){var s=e.actualValue===a;return s&&(i=t),s})}return i},handleDropCSV:function(e){var s,i,a,o=this;return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.getElement(e).getParent().removeClassName(Y.DROP_CLASS_NAME),(s=e.dataTransfer.files)&&s.length&&(i=s[0],"undefined"!=typeof FileReader&&((a=new FileReader).onload=function(e){var t=e.target.result,s={onComplete:o.onCSVSuccess,onFailure:o.onCSVFailure};o.collection.importTasksFromCSV(t,s)},a.readAsText(i))),!1},onCSVSuccess:function(){var e=ie("emxCollaborativeTasks.Label.ImportItemsDone");v.displayMessage({msg:e,msgType:"primary"})},onCSVFailure:function(){var e=ie("emxCollaborativeTasks.Label.ImportItemsDone");v.displayPrimary(e)},handleDragOver:function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",t.getElement(e).getParent().addClassName(Y.DROP_CLASS_NAME),!1},handleDragEnter:function(e){t.getElement(e).getParent().addClassName(Y.DROP_CLASS_NAME)},handleDragLeave:function(e){t.getElement(e).getParent().removeClassName(Y.DROP_CLASS_NAME)},handleDragEnd:function(e){t.getElement(e).getParent().removeClassName(Y.DROP_CLASS_NAME)},clearAllDropZoneMasks:function(){for(var e=this.getElements("."+Y.DROP_CLASS_NAME),t=e.length,s=0;s<t;s++)e[s].toggleClassName(Y.DROP_CLASS_NAME,!1)},modifyCreateTaskText:function(e){var t=this.getElement("#createTaskIcon"),s=ie("emxCollaborativeTasks.Label.NewTask");t&&(this._createTaskTooltip&&this._createTaskTooltip.destroy(),delete this._createTaskTooltip,this.shouldDisableCreateTask()?this._createTaskTooltip=v.createTooltip(t,this.getDisabledPlaceholder(),"bottom"):e?(s=ie("emxCollaborativeTasks.Label.CreateTaskForContext"),this._createTaskTooltip=v.createTooltip(t,s.replace("%CONTEXT%",e),"bottom")):this._createTaskTooltip=v.createTooltip(t,s,"bottom"))},getDisabledPlaceholder:function(){var e,t=0===F.getUsersContentRepositories().length,s=M.isScopeRDF(),i=h.getContext()===u.TSK_PRIVATE_SPACE;return s||!t||i?M.isScopeSwym()?e="E6WCommonUI.Label.SwymTaskDisabled":s&&!U.isXPPAuthorized()&&(e="emxCollaborativeTasks.Error.FailedToCreateTaskWithNoXPPLicense"):e="E6WCommonUI.Label.NoAccessToCollabSpace",ie(e)},setTitleDefaultValue:function(){var e=ie("emxCollaborativeTasks.Command.Filter.assigned"),t=widget.getValue("title"),s=ie("emxCollaborativeTasks.Command.Filter."+M.getFilter())||t,i=s&&s.indexOf(":");-1!==i&&(s=s&&s.substring(i+1,i.length));var a=this.scopeModelContainer.getScope(),o=a&&a.get("name");s=o?o+":"+s:s||e,h&&h.getContextDisplayValue()&&(s=h.getContextDisplayValue()+" - "+s),widget.setValue("title",s)},initScope:function(){var e=M.getScopeId();!this.scopeModelContainer.getScope()&&e?this.scopeModelContainer.add("scope",e,{scopeType:M.getScopeType(),isRDF:M.isScopeRDF(),dontCheckTypes:M.isScopeRDF(),isScopeSwym:M.isScopeSwym(),objectData:M.getObjectData(),initialLoad:!0}):M.isInvalidScope()?(M.setScopeToInvalid(!1),this.scopeModelContainer.removeScopeOnDelete()):this.scopeModelContainer.getScope()&&!e&&this.scopeModelContainer.removeScopeInternal(),this.dispatchEvent("scopeInitializedOnTaskView",[this.scopeModelContainer])},_getSingleTaskTitle:function(){var e;return 1===this.collection.length?e=this.collection.at(0).get("title"):this._rdfCollection&&1===this._rdfCollection.length&&(e=this._rdfCollection.at(0).get("title")),e},getTotalTasksCount:function(){var e=0;return this._columnViews.forEach(t=>{e+=t.collection.length}),e},updateTitle:function(){if(widget){var e;if(this._singleTaskId)e=this._getSingleTaskTitle();else if(e=widget.getValue("title"))if(e=e.trim(),this.collection&&this.collection._search)e+=" ("+this.getTotalTasksCount()+")";else{var t=this.collection.length;this._rdfCollection&&(t+=this._rdfCollection.length),this._srcCollection&&this._srcCollection.length&&(t+=this._srcCollection.length),e+=" ("+t+")"}e=e&&e.stripTags(),widget.getTitle()!==e&&widget.setTitle(e)}},getVisibleModels:function(){for(var e=[],t=this.getLeftColumnIndex(),s=t;s<t+this._nbColumnsShown;s++){var i=this._childrenViews[s];i.getVisibleModels&&(e=e.concat(i.getVisibleModels()))}return e},getVisibleRDFModels:function(){return this.getVisibleModels().filter(function(e){return e instanceof E})},filterModelsWithSameParentWorkScopeAsSelectedTask:function(e){var t=[],s=this._selectedView.model.getParent&&this._selectedView.model.getParent();return s&&(t=e.filter(function(e){var t=e.getParent&&e.getParent();return t&&t.id===s.id})),t},onFailToFindRDFScope:function(){v.displayError(ie("emxCollaborativeTasks.Error.FailedToRetrieveScope"));var e=widget.getPreference("title");e&&widget.setValue("title",e.defaultValue),this.scopeModelContainer.setScope(null),M.removeUserScopeData(),this._rdfCollection.fetch({reset:!0,onComplete:this.updateTitle.bind(this)})},initTagger:function(){var t=this;try{var s=this.collection.getTNProxy({events:{addTagCreationListener:this.tagAddListener.bind(t),addTagDeletionListener:this.tagRemoveListener.bind(t)}});s instanceof b||(this.listenTo(s,"foundation2TagsFetchComplete",function(e){t.updateLargeCardsWithTaggerData(e)}),s=new b(s),this.collection.setTNProxy(s)),this._rdfCollection&&R.addTaggerProxyColoringEvents(s.tnProxy,this._rdfCollection),R.addTaggerProxyColoringEvents(s.tnProxy,this.collection),this.setTaggerColorMap(s.tnProxy),this._rdfCollection&&s&&s.tnProxy&&(this.listenTo(s.tnProxy,"onFilterSubjectsChange",function(){this._rdfCollection.filterCollection.apply(this._rdfCollection,arguments),this.resetIteropCollection(arguments[0])}),this.listenTo(this._rdfCollection,"onReset",function(){var t=Array.prototype.slice.call(arguments,0),s=e.clone(t[1]||{},!1);this.fetchNewTags(s)}),this.listenTo(this._rdfCollection,"onTaskCollectionFetchComplete",function(){this.fetchNewTags()}),this.listenTo(R.dispatcher,"refreshTagger",function(){R.updateTagsData.apply(this,arguments),this._setTagDataOnProxy("rdf")}))}catch(e){}},fetchNewTags:function(t){const s=e.clone(t||{},!1),i=s.rdfCollection||this._rdfCollection;this._fetchNewTagsTimeout||s.dontCallTagger||!i||(this._fetchNewTagsTimeout=setTimeout(()=>{this._fetchNewTagsTimeout=void 0,0===i.length?this._setTagDataOnProxy("rdf",t):i.requestFetchNewTags({onComplete:()=>this._setTagDataOnProxy("rdf",s),onFailure:()=>this._setTagDataOnProxy("rdf",s),onlyIfNeeded:!0})},100))},_updateTnProxyWithSearchFilter:function(){!this.collection.getSearch()&&this.collection.originalCollection&&(this.collection.reset(this.collection.originalCollection._models,{dontRegisterChange:!0}),delete this.collection.originalCollection);var e=this.collection.getTNProxy();e.setSubjectsTags(R.getTaggerDataWithSearchFilter(this.collection),"foundation2"),e.setSubjectsTags(R.getTaggerDataWithSearchFilter(this._rdfCollection),"rdf")},_setTagDataOnProxy:function(e){var t=this._rdfCollection.getTaggerData();this.collection.getTNProxy().setSubjectsTags(t,e)},updateLargeCardsWithTaggerData:function(e){var t=this.collection&&this.collection.toArray();t&&t.forEach(t=>{var s=w.jsonURIToSparqlURI(t.id);if(s=t.getTagPrefix()+s,e[s]){var i=R.getExplicitTagsData(e[s]);t.set(R.EXPLICIT_TAGS_DATA,i)}})},isBeingTagFiltered:function(){return!!this.collection.tnProxy.tnProxy.getCurrentFilter().allfilters&&Object.keys(this.collection.tnProxy.tnProxy.getCurrentFilter().allfilters).length},getSuperModal:function(){return this.modal},getFTSOptions:function(){return{}}});return Te.AUTO_SCROLL_TIMEOUT=510,Te.VIEW_VALUE_PRIORITY="priority",Te.SELECTED_TASK_VIEW="selectedTaskView",Te.TASK_TABLE="taskTable",Te.FETCH_NEW_TAGS_TIMEOUT=100,Te.implement(z),Te.implement(I),Te.implement($),Te}),define("DS/CollaborativeTasks/CollaborativeTasksBootstrap",["UWA/Core","UWA/Utils","DS/Utilities/TouchUtils","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Collections/TasksCollection","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/E6WCommonApps/Collections/RDFTasksCollection","DS/E6WCommonApps/Collections/IteropTasksCollection","DS/CollaborativeTasks/Collections/SourcingTaskCollection","DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/CollaborativeTasks/Views/CollaborativeTasksView","DS/Foundation/WidgetAPIs","DS/Foundation/WidgetUwaUtils","DS/E6WCommonApps/SharedWidgetUwaUtils","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/LiveUpdateUtils","DS/DocumentManagement/DocumentManagement","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonUI/PlatformManager","DS/PlatformAPI/PlatformAPI","DS/E6WCommonUI/WidgetUtils","DS/E6WCommonApps/Views/ProgressBarPopupView","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/CommonAppsHandlebarsHelper","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS","DS/XTaskApp/Models/XTaskAppTypeDictionary","css!DS/E6WCommonApps/E6WCommonApps"],function(e,t,s,i,a,o,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,b,_,D,k,A,w,E,y,M,I,V,F){"use strict";new e.Class.Listener;var P,R=i.getWidgetConstant;i.getWidgetConstant=function(e){return R.apply(this,arguments)||F.get(e)};var N=function(){return i.getWidgetConstant.apply(this,arguments)},x=function(e){e.options&&e.options.length>1&&e.options.sort((e,t)=>e.label.localeCompare(t.label))};return C.i18n=N,V.registerPartials(),window.dataVersion=.3,(P={emailNotificationService:"/resources/v1/modeler/tasks/tasksPreference",defaultWindowedHeight:505,lInitiateChangeAssigneeModule:null,checkVisibilityAPI:function(){void 0!==P.document.hidden?(P._hidden="hidden",P._visibilityChange="visibilitychange"):void 0!==P.document.mozHidden?(P._hidden="mozHidden",P._visibilityChange="mozvisibilitychange"):void 0!==P.document.msHidden?(P._hidden="msHidden",P._visibilityChange="msvisibilitychange"):void 0!==P.document.webkitHidden&&(P._hidden="webkitHidden",P._visibilityChange="webkitvisibilitychange")},onPreferencesOpened:function(e){e&&e.fromTSK||(P._prefsWhenOpened=widget.getPreferences().reduce(function(e,t){return e[t.name]=t.value,e},{}))},onPreferencesClosed:function(){P.updateEmailPreference.apply(this,arguments),widget.dispatchEvent("onUpdateTitle",[widget.getTitle(),void 0]),P._prefsWhenOpened.collabspace!==widget.getValue("collabspace")&&(window.enoviaServer.space=widget.getValue("collabspace")),P._prefsWhenOpened.collabstorage!==widget.getValue("collabstorage")&&(A.setTenant(widget.getValue("collabstorage")),window.enoviaServer.storageUrl=A.getTenantServiceData()["3DSpace"],P.onStorageChange()),P._prefsWhenOpened.collabspace!==widget.getValue("collabspace")&&P.onSpaceChange()},_initEmailPreference:function(){if(A.isOnPremise()){var e={url:P.emailNotificationService,type:"GET",dataType:"json",callback:function(e){var t;e||(e={});var s=P.tasks.data();s&&i.__updateCsrf(s,e);try{widget.getValue("emailNotify")!==(t="true"===(t=e.data[0].dataelements.preference_AssignedTaskNotificationOn).toLowerCase())&&widget.setValue("emailNotify",t)}catch(e){}}};i.ajaxRequest(e)}},_doAutoRefresh:function(){!P.PENDINGFETCH&&P.tasks.length<=P.MAXFETCHCOUNT&&!this._getTaskIdToOpen()&&(P.PENDINGFETCH=!0,P.tasks.fetch({server:!0,partialRefresh:!0,noTag:!0,onComplete:function(){P.PENDINGFETCH=!1,P._setAutoRefreshTimeout()},onFailure:function(e,t){P.PENDINGFETCH=!1,P._handleInvalidScope(t,!P.tasks.dictionaryLoaded)||P._setAutoRefreshTimeout.bind(void 0,void 0)}}))},_setAutoRefreshTimeout:function(e){e?P._doAutoRefresh():P.REFRESHTIMEOUT&&(P.refreshTimeoutId=setTimeout(function(){P.document[P._hidden]||P._doAutoRefresh()},P.REFRESHTIMEOUT))},handleVisibilityChange:function(){P.document[P._hidden]?(clearTimeout(P.refreshTimeoutId),delete P.refreshTimeoutId):P.refreshTimeoutId||P._setAutoRefreshTimeout(!0)},onTenantChangedInPreference:function(e){D.loadSecurityContextsForTenant({tenant:e,callback:function(e){var t=m.securityContextsForSameOrganization(e),s=widget.getPreference("collabspace");s.options=[];var i=e[0].name;for(var a of e){var o=m.getSecurityContextName(t,a.displayName);s.options.push({label:o,value:a.name,displayName:a.displayName}),a.isDefault&&(i=a.name)}x(s),s.defaultValue=i,widget.addPreference(s),widget.dispatchEvent("onEdit",{fromTSK:!0})}})},addNewPreferences:function(){var e=function(){window.enoviaServer.preferences.showProjectTasks=widget.getValue("showProjectTasks")},t={name:"showProjectTasks",type:"boolean",label:"Show project tasks",defaultValue:"true",onChange:e},s=S.getCompletedTasksFilterPref(S.COMPLETED_TASK_FILTER_30_DAYS);widget.addPreference({name:"collabstorage",type:"list",label:"collabstorage"}),widget.addPreference({name:"collabspace",type:"list",label:"collabspace"}),widget.addPreference(s),widget.addPreference(t),widget.addEvent("onStorageChange",function(e,t){widget.isEdit&&P.onTenantChangedInPreference(t)}),A.isOnPremise()&&(widget.addPreference({name:"emailNotify",type:"boolean",label:"Email notifications",defaultValue:"defaultValue"}),widget.setValue("emailNotify","defaultValue")),e();var i=T.getFilter(),a=i||T.setFilter("all");enoviaServer.preferences.currentTaskFilter=a;var o=S.getCompletedTaskFilter();enoviaServer.preferences[S.COMPLETION_DATE_TASK_FILTER_ATTR]=o,widget.getValue("createSampleData")||(widget.setValue("createSampleData","true"),enoviaServer.preferences.createSampleData="true")},_has3DPlanAccess:function(){return A.hasAccess(I.SERVICE_3DPLAN)},_hasIteropAccess:function(){return A.hasAccess("businessprocess")},_hasSourcingAccess:function(){return A.hasAccess("sourcing")},showLoadingMessage:function(){P._fetchCount++,P.tasksView&&P.tasksView.showLoadingMessage(!0)},hideLoadingMessage:function(){P._fetchCount--,P.tasksView&&P.tasksView.hideLoadingMessage()},_loadRDFTasks:function(){if(P._getTaskIdToOpen()){if(P._taskIdToOpenIsRDF()){var e=new k({"@id":P._getTaskIdToOpen(),"dsxplan:jsType":"dsplan:Task"});P.showLoadingMessage(!0),e.fetch({onComplete:function(){P.hideLoadingMessage(),"dsplan:DeletedTask"===e.get("dsxplan:jsType")?b.displayInfo(N("emxCollaborativeTasks.Label.TaskDeleted")):(e.noFilter=!0,P.rdfTasks.add(e),P._selectTaskByIdOnLoad(e.id))},onFailure:function(){P.hideLoadingMessage(),P._onSingleTaskFetchFail()},mask:"dsplan:MVMask.Task.CollaborativeTask.Basic"})}}else{var t={fromCompletionDate:S.getCompletedTaskFilter()};!1===window.widget.getValue("showProjectTasks")&&(t.standAloneTasks=!0),P.showLoadingMessage(!0);var s=P.rdfTasks.fetch({reset:!0,data:JSON.stringify([T.getFilter(),t]),onComplete:P.hideLoadingMessage,onFailure:P.hideLoadingMessage});(s&&s.noFetch||!s)&&setTimeout(P.hideLoadingMessage,0)}d.subscribeToNotification(this.onNotification.bind(this)),this._notifQueue=[]},onNotification:f.onNotification,_getTaskIdToOpen:function(){return d.removeBracketLongURI(P._selectedTaskId)},_taskIdToOpenIsRDF:function(){return-1!==P._getTaskIdToOpen().indexOf(":")},initMSF:function(){require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){v.MSFDocumentClient=e,v.MSFDocumentClient.ConnectWidgetWithMSF()})},initRouteMgmt:function(){let e="DS/ENORouteMgmt/Views/Dialogs/InitiateChangeAssignee";require([e],t=>{e=t})},_initTasksCollection:function(){P.tasks=new a,P.tasks.addEvent("onAdd",P.onTitleChange),P.tasks.addEvent("onRemove",P.onTitleChange),P.tasks.addEvent("onReset",P.onTitleChange)},_initSourcingTasksCollection:function(){P.sourcingTasks=new r,P.sourcingTasks.addEvent("onAdd",P.onTitleChange),P.sourcingTasks.addEvent("onRemove",P.onTitleChange),P.sourcingTasks.addEvent("onReset",P.onTitleChange)},_initRDFTasksCollection:function(){n.RDFWorkscopeModel=c,this.rdfTasks=new n(void 0,{"@href":"/invoke/dsxplan:getTasks","@mask":"dsplan:MVMask.Task.CollaborativeTask.Basic",detailsMask:"dsplan:MVMask.Task.CollaborativeTasks.Complex"}),this.rdfTasks.addEvent("onAdd",this.onTitleChange),this.rdfTasks.addEvent("onRemove",this.onTitleChange),this.rdfTasks.addEvent("onReset",this.onTitleChange)},init:function(){P._fetchCount=0,b.setHeaderMetaTag(),s.setTouchMode(!0),e.extend(m,g),E.restoreWidgetViewModeBeforePreview(),window.enoviaServer||m.setupEnoviaServer({getUrl:()=>A.getServiceUrl("3DSpace",!0)}),window.enoviaServer.widgetId=widget.id,window.enoviaServer.widgetName=widget["6wWidgetName"];try{this.initRouteMgmt(),t.Client.Platform.windows&&this.initMSF()}catch(e){console.error(e)}widget.addEvents({onRefresh:P.onRefresh,onEdit:P.onPreferencesOpened,endEdit:P.onPreferencesClosed}),widget.useUIKitSelect=!0,this.addNewPreferences(),h.setContextUserUid(),m.onAfterLoad=Function.prototype,b.initializeAlert(window.document.body),this._initTasksCollection(),P.iteropTasks=new l;var i=widget.getValue("collabstorage");this._processSelectedIds(),require(["DS/DocumentCreateNew/Utils/TypesUtils"],e=>{try{e.init();let t=M.documentGetTypeInfoOptions();e.getTypeInfos(t)}catch(e){console.log(e)}}),p.getCollaborativeStorages(function(e){A.filterCollabSpaces(e,function(e){m.processStorages(e,i,{additionalStorage:I.SERVICE_3DPLAN}),A.storePlatformServiceData(e),m.setStoragesPrefs(widget,e,i,"true"),T.initialize(),P.processStorageChange(i),P.document.addEventListener(P._visibilityChange,P.handleVisibilityChange,!1)})}),P.scopes=P.tasks.getChildCollection("scopes");var a=top.document.getElementsByName("viewport");a&&a.length&&a[0].setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),v.downloadDocument=function(t,s,i,a){var o=e.clone(a||{},!1),n=Array.prototype.slice.call(arguments,0);n[3]=o;var l=o.serviceId;return enoviaServer&&l&&(o.tenantUrl=enoviaServer[l]),this.constructor.prototype.downloadDocument.apply(this,n)},E.addDragDropListeners(),A.fetchRolesData(),w.subscribe("Collaborative Tasks.refresh",function(){P.refreshTimeoutId||P._setAutoRefreshTimeout(!0)}),o.initModelEventsBroker()},onLoad:function(){P.init()},onRefresh:g.onRefresh,_updatePrefOnRefresh:function(){var e=widget.getValue("showProjectTasks");window.enoviaServer.preferences.showProjectTasks=e;var t=S.getCompletedTaskFilter();enoviaServer.preferences[S.COMPLETION_DATE_TASK_FILTER_ATTR]=t},onViewChange:function(){var e=widget.getView();e.previous&&e.previous.type!==e.type&&P.setWindowHeight()},setWindowHeight:function(){var e=widget.getViewportDimensions();P.tasksView&&P.tasksView.container.setStyle("height",e.height)},onTitleChange:function(){P.tasksView&&P.tasksView.updateTitle()},onEmailNotifyChange:function(e,t){P.userEnteredEmailValue=t},onCompletedTasksDisplayPrefChange:function(e,t){S.setCompletedTaskFilter(t)},updateEmailPreference:function(){if(A.isOnPremise()){var e=widget.getValue("emailNotify"),t={data:[{dataelements:{}}]},s=P.userEnteredEmailValue;if(void 0!==s&&e===s){var a=P.tasks.data();a&&i.__updateCsrf(t,a),t.data[0].dataelements.preference_AssignedTaskNotificationOn=s.toString();var o={url:P.emailNotificationService,type:"PUT",dataType:"json",data:JSON.stringify(t),headers:{"content-type":"application/json"}};i.ajaxRequest(o),delete P.userEnteredEmailValue}}},spaceNames:{},myAppsStorages:null,onStorageChange:function(){A.setTenant(widget.getValue("collabstorage")),P._has3DPlanAccess()&&P.tasksView&&!P.tasksView._rdfCollection&&(this._initRDFTasksCollection(),P.tasksView&&P.tasksView.destroy(),P.setupTasksView()),T.removeScopeData(),m.onStorageChange.call(P),P.tasksView._detailPanel.updateCommonInitializerLibrary()},onSpaceChange:function(){m.onSpaceChange.call(P),P.setSpace(),P.tasksView._detailPanel.updateCommonInitializerLibrary()},_loadIndividual3DSpaceTask:function(){var e=P._getTaskIdToOpen();if(!P._taskIdToOpenIsRDF()){P.showLoadingMessage(!0);let t=P.tasks.fetchTaskById(e,{reset:!0,onComplete:function(){var t=P.tasks.get(e);t&&(t.noFilter=!0),P.hideLoadingMessage(),P._afterLoadInvididual3DSpaceTask()},onFailure:function(){P.hideLoadingMessage(),P._onSingleTaskFetchFail()}});(t&&t.noFetch||!t)&&setTimeout(P.hideLoadingMessage,0)}},_afterLoadInvididual3DSpaceTask:function(){if(!P._taskIdToOpenIsRDF()){var e=P._getTaskIdToOpen();P.tasksView?P._selectTaskByIdOnLoad(e):widget.addEventOnce("constantsServiceReturned",function(){P._selectTaskByIdOnLoad(e)})}},_load3DSpaceTasks:function(){if(P._getTaskIdToOpen())P._loadIndividual3DSpaceTask();else{var e=!1;if("true"===enoviaServer.preferences.createSampleData&&!enoviaServer.space){var t=Object.keys(m.spaceNames);enoviaServer.space=t.find(e=>e!==p.TSK_PRIVATE_SPACE&&"undefined"!==e&&""!==e),e=!0}var s=this;P.showLoadingMessage(!0);let i=P.tasks.fetch({server:!0,reset:!0,onComplete:function(){e&&(enoviaServer.space=null,s.tasks.dispatchEvent("onChange:collabSpace",[s.tasks,s.tasks.collabSpace])),P._setAutoRefreshTimeout(),P.hideLoadingMessage()},onFailure:function(t,s){e&&(enoviaServer.space=null);var i=s&&s.error;i&&(P._handleInvalidScope(s),i=!1),P.hideLoadingMessage(),P.tasksView&&P._setAutoRefreshTimeout(),i&&(P._setAutoRefreshTimeout(),P.licenseError=s.error,widget.body.setContent(""),b.initializeAlert(widget.body),b.displayError(s.error))}});i&&i.noFetch&&setTimeout(P.hideLoadingMessage,0)}},_loadIteropTasks:function(){P.showLoadingMessage(!0),P.iteropTasks.fetch({onComplete:function(){P.hideLoadingMessage()},onFailure:function(){P.hideLoadingMessage()}})},_loadSourcingTask:function(){P.showLoadingMessage(!0),P.sourcingTasks.fetch({server:!0,reset:!0,onComplete:function(){P.hideLoadingMessage()},onFailure:function(){P.hideLoadingMessage()}})},_tasksServiceInitCalls:function(){var e=this;0!==P.tasks.collabSpace.length&&this._load3DSpaceTasks(),i.getWidgetConstants("/resources/v2/e6w/service/TSK_WIDGET_CONSTANTS",function(){var t=N("REFRESH_TIMEOUT");t&&(P.REFRESHTIMEOUT=1e3*parseInt(t,10)),enoviaServer.widgetId=widget.id,P._has3DPlanAccess()&&(e._initRDFTasksCollection(),P._loadRDFTasks()),!P._hasIteropAccess()||P._getTaskIdToOpen()||T.getObjectData()||P._loadIteropTasks(),P._hasSourcingAccess()&&(P._initSourcingTasksCollection(),P._loadSourcingTask()),P.tasksView||(widget.addEvents({onViewChange:P.onViewChange,onUpdateTitle:P.onTitleChange,onUpdateValue:P.onValueChanged}),P.setupTasksView(),P._initEmailPreference.apply(this,arguments)),P.tasksView.setTitleDefaultValue(),P.tasksView.initScope(),P.setWindowHeight(),widget.dispatchEvent("onResize"),P._initPreferencesWithConstants(),widget.dispatchEvent("constantsServiceReturned")})},onValueChanged:function(e,t){switch(e){case"emailNotify":P.onEmailNotifyChange(e,t);break;case S.COMPLETED_TASK_PREF_NAME:P.onCompletedTasksDisplayPrefChange(e,t)}},setupTasksView:function(){P.tasksView=new u({collection:P.tasks,rdfCollection:P.rdfTasks,iteropCollection:P.iteropTasks,srcCollection:P.sourcingTasks,singleTaskId:P._getTaskIdToOpen(),fetchCount:P._fetchCount}),P.licenseError?delete P.licenseError:(P.tasksView.listenTo(widget,"onResize",function(){P.setWindowHeight(),P.tasksView.onResize.apply(P.tasksView,arguments)}),P.tasksView.listenTo(widget,"onSearch",function(e){P.rdfTasks&&P.rdfTasks.setSearch(e),P.tasks.setSearch(e)}),P.tasksView.listenTo(widget,"onResetSearch",function(){P.rdfTasks&&P.rdfTasks.resetSearch(),P.tasks.resetSearch()}),widget.body.empty(),P.tasksView.render().inject(widget.body),this._progressBarView=new y,this._progressBarView.render().inject(window.widget.body))},_initPreferencesWithConstants:function(){if("0"!==R("hasDPJAccess")){var e=widget.getPreference("showProjectTasks");e.disabled="disabled",widget.addPreference(e)}var t=widget.getPreference("collabspace");t.label=N("emxCollaborativeTasks.Label.Credential"),x(t),widget.addPreference(t);var s=widget.getPreference("collabstorage");s.label=N("emxFoundation.Widget.CollaborativeStorages"),s.disabled=s.options&&1===s.options.length,widget.addPreference(s);var i=widget.getPreference("showProjectTasks");if(i.label=N("emxCollaborativeTasks.Label.ShowProjectTasks"),widget.addPreference(i),A.isOnPremise()){var a=widget.getPreference("emailNotify");a.label=N("emxCollaborativeTasks.Label.EmailNotify"),widget.addPreference(a)}},setSpace:function(){var e=m.getContext().split(".");if(P.tasks.collabSpace=e[e.length-1],P.myAppsStorages&&P.myAppsStorages.find){var t=P.myAppsStorages.find(e=>e.platformId===A.getTenant());t&&(enoviaServer.storageUrl=t["3DSpace"])}P._tasksServiceInitCalls(),P.tasks.dispatchEvent("onChange:collabSpace",[P.tasks,P.tasks.collabSpace]);var s=this.spaceNames[enoviaServer.storageUrl];s&&D.processSecurityContextData(s)},clearData:function(){m.clearData.call(P)},loadBPS:function(){m.loadBPS.call(P,widget,"false","/resources/v2/e6w/service/TSK_WIDGET_CONSTANTS",{additionalStorage:I.SERVICE_3DPLAN,storageAsTenant:!0})},setTitlePref:Function.prototype,setRowPref:Function.prototype,processStorageChange:function(){m.processStorageChange.apply(P,arguments)},onAfterLoad:Function.prototype,_onSingleTaskFetchFail:function(){b.displayInfo(N("emxCollaborativeTasks.Info.TaskNotFound"))},_selectTaskByIdOnLoad:function(e){-1===P.tasksView.getColumnAndCardIdxFromId(e)[1]?P.tasksView.addEventOnce("afterColChanged",function(){P.tasksView.selectById(e)}):P.tasksView.selectById(e)},_processSelectedIds:function(){var e;if(widget.getValue("id")||widget.getValue("ids")){var t=(e=widget.getValue("id")||widget.getValue("ids")).indexOf("?");-1!==t&&(e=e.substring(0,t))}else widget.getValue("X3DContentId")&&(e=this._getIdFromCompassSelect());e&&(P._selectedTaskId=e)},_getIdFromCompassSelect:function(){var e=JSON.parse(widget.getValue("X3DContentId")).data.items[0];if(-1!==["Task","Inbox Task","dsplan:Task","Phase","Gate","Milestone"].indexOf(e.objectType))return b.validateObjectTenant(),e.objectId;b.displayWarning(i.getWidgetConstant("emxCollaborativeTasks.Warning.ObjectNotTask")),widget.deleteValue("X3DContentId")},_handleInvalidScope:function(e,t){var s=!1;return e&&400===e.statusCode&&e.error&&e.error.indexOf("Invalid Business Object")>=0&&(s=!0,T.setScopeToInvalid(!0),t?T.removeUserScopeData():T.removeScopeData(),P.setSpace()),s}}).onAfterLoad=P.setSpace,P.REFRESHTIMEOUT=0,P.PENDINGFETCH=!1,P.MAXFETCHCOUNT=1e3,P.document=document,P.checkVisibilityAPI(),P});