define("DS/DELWebViewerWorkInstructionController/DELImporter",["UWA/Core","DS/DELWebViewerCommon/DELCommonImporter"],function(e,t){"use strict";return function(e,n){var i,o=n.getOption("logger"),r=function(){var n={context:e.getContext(),frameWindow:e.getFrameWindow(),bDisplayNominal:!1,bDisplayInWork:!1,thumbnailListTitle:"",activateSlide:!1,displayDMUSlidePanel:!1,beforeApplySlideCB:null,afterApplySlideCB:null};return i||(i=new t(n)),i};return{importModel:function(e){o.debug("DELImporter::importModel method invoked with parameters : %o",e),r().importModel(e)},removeModel:function(){o.debug("DELImporter::removeModel method invoked"),r().removeModel()},destroy:function(){i&&(i.removeModel(),i.destroyDMUImporter()),o=i=r=null}}}}),define("DS/DELWebViewerWorkInstructionController/WorkInstructionDataManager",["DS/DELPPRData/Buildup/BuildUpSettings"],function(e){"use strict";return function(t,n){var i=n.getOption("logger"),o=t.getInstance("WorkInstructionBehaviorModelService"),r=n.getOption("mappingKeys"),u=function(e,t){var n=[];return UWA.is(e)&&UWA.is(e.Model,"array")&&UWA.is(e.Model[0].WKIRelations,"array")&&e.Model[0].WKIRelations.length>0&&e.Model[0].WKIRelations.forEach(function(e){t&&e&&e.Instruction&&e.View&&(UWA.is(t.pid,"array")&&(t.pid.indexOf(e.Instruction.InstPhyID)>-1||e.Instruction.Row&&t.pid.indexOf(e.Instruction.Row.RowPhyID)>-1)?-1===n.indexOf(e.View.UUID)&&n.push(e.View.UUID):t.uuid&&e.View.UUID===t.uuid&&(n.push(UWA.is(e.Instruction.Row)?e.Instruction.Row.RowPhyID:e.Instruction.InstPhyID),UWA.is(e.Instruction.Row)&&n.push(e.Instruction.InstPhyID)))}),n};return{getStepViewJson:function(e){return new UWA.Promise(function(t,n){o.getWKIContentPromise(e,r.FILETYPES.DMUJSON).then(function(e){t({json:e})}).fail(n)})},initStepViewSettings:function(e){return new UWA.Promise(function(t,u){o.getWKIContentPromise(e,r.FILETYPES.WKIVIEWINFO).then(function(e){if(e&&e[r.WKIKEYS.WKIVIEWINFO]&&e[r.WKIKEYS.WKIVIEWINFO][r.WKIKEYS.OPERATION]){let n=e[r.WKIKEYS.WKIVIEWINFO][r.WKIKEYS.OPERATION][r.WKIKEYS.VIEWS];o.setCurrentStepViewInfo({viewInfo:n}),t(n)}else i.error("WorkInstructionDataManager::initStepViewSettings View BuildUp Settings format is invalid, check the mapping"),u(n.getNLSValue("Error.ViewBuildUpSettingsFormatInvalid.Message"))}).fail(u)})},getLocalGraphicData:function(t,n){var r,u=o.getViewInfo({viewUUID:n});return i.debug("WorkInstructionDataManager::getLocalGraphicData method invoked with parameters : ",n),u?r=function(n={}){var i=[],o=e.getParsedBuildUpSettings(n.BuildUpSettings);return t&&t.forEach(function(t){var n,r=e.getGraphicProperties(o,t.category);r&&(n=UWA.merge({path:t.path},r),"OnlyAssignedResources"===o[e.getCategory(t.category)].filter&&"all"===t.category&&(n.visibility=!1),n.visibilityFree=!n.visibility,i.push(n))}),i}(u):i.warn("View Settings not found"),r},getLinkedViewUuids:function(e,t){return new UWA.Promise(function(n,i){o.getWKIContentPromise(e,r.FILETYPES.WKICONTENT).then(function(e){n(u(e,t))}).fail(i)})},getLinkedTextualInstIds:function(e,t){return new UWA.Promise(function(n,i){o.getWKIContentPromise(e,r.FILETYPES.WKICONTENT).then(function(e){n(u(e,{uuid:t}))}).fail(i)})},getWKIContent:function(e){return new UWA.Promise(function(t,n){o.getWKIContentPromise(e,r.FILETYPES.WKICONTENT).then(function(e){t(e)}).fail(n)})},getCurrentStepViewInfo:function(){o.getCurrentStepViewInfo()},getViewInfo:function(e){return o.getViewInfo(e)},reset:function(){o.reset()},destroy:function(){o&&o.destroy(),i=o=r=u=null}}}}),define("DS/DELWebViewerWorkInstructionController/WorkInstructionController",["UWA/Core","DS/DELWebViewerCommon/DELCommonSlideServices","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","DS/DELWebViewerWorkInstructionController/WorkInstructionDataManager","DS/DELWebViewerWorkInstructionController/DELImporter","DS/DELWebViewerWorkInstructionCommon/DELWKIContent/DELWKIContentController"],function(e,t,n,i,o,r){"use strict";return function(u,s,l,a){var c,d=a.getOption("logger"),I=a.getOption("eventCollection").getViewerCtrlEventHnd(),g=new i(l,a),w=new r({context:s.getContext()}),f=u.getInstance("BuildUpBehavior"),h=new o(s,a),p=a.getOption("mappingKeys"),W=function(){return s.getMode()===p.VIEWERMODES.WORKINSTRUCTIONS},v=function(e){var t,n;return f?t=(n=f.getCurrentBuildUpContent())?n[e]:null:d.error("BuildUpBehavior not found"),t},S=function(){return d.debug("WorkInstructionController::clean method invoked"),s.removeSceneGraphOverrideSet(p.SCENEGRAPHKEYS.PUBLIC),w.removeModel(),h.removeModel(),e.is(c)&&c.clean(),g.reset(),e.Promise.resolve()},m=function(){var i=function(n,i){n&&n.data&&(s.setGraphicProperties({graphicProperties:g.getLocalGraphicData(v(p.BUILDUPKEYS.GRAPHICDATA),n.data.uuid)},p.SCENEGRAPHKEYS.BUILDUP),n.data.context=s.getContext(),t.applySlide(n.data),w.applySlide({uuid:n.data.uuid}),e.is(n.data.uuid)&&i&&g.getLinkedTextualInstIds(v(p.BUILDUPKEYS.PATHIDS),n.data.uuid).then(function(e){I.publish(I.events.onSelectView,{viewUUID:n.data.uuid,textualInstructionPIds:e,viewID:n.data.id,viewName:n.data.name})}))},o=function(e){var n={slides:t.getSlidesDefinition({context:s.getContext()}),wkiContent:e};c.clean(),c.display(n)},r=function(t){var r;g.initStepViewSettings(v(p.BUILDUPKEYS.PATHIDS)).then(function(){return g.getWKIContent(v(p.BUILDUPKEYS.PATHIDS))}).then(function(o){return w.importModel({wkiContent:o,...t}),new e.Promise(function(e,t){c?e(o):((r=Object.create(a)).setOption("onSlideSelectedCB",i),Object.assign(r,a.getOption("executionContext")?n.getDELViewerSetting("wkiview_opts"):n.getLayout_options("wkiview_opts")),s.getComponentPromise("DELSlideView",r).then(function(t){c=t,e(o)}).fail(function(e){throw d.error("DELSlideView Component Initialization failed due to -",e),t(e),new Error(e)}))})}).then(o).fail(function(e){d.error("WorkInstructionController::addSlidePanel - Unable to create views panel due to -",e)})};d.debug("WorkInstructionController::show method invoked"),S().then(function(){return g.getStepViewJson(v(p.BUILDUPKEYS.PATHIDS))}).then(function(e){d.debug("WorkInstructionController::importStepView method invoked"),e.onModelLoadedCB=r,h.importModel(e)}).fail(function(t){e.is(c)&&c.hide(),s.render(),d.error("WorkInstructionController::show unable to show the work instructions due to - ",t),I.publish(I.events.onWKIFailed,{error:t})})};I.subscribe(I.events.onGlobalBuildUpComplete,function(){W()&&m()}),I.subscribe(I.events.onHighlightComplete,function(e){e.highlight?w.highlightNode(e):w.unHighlightNode(e)});let D={show:m,reset:function(){d.debug("WorkInstructionController::remove method invoked"),S().then(function(){return new e.Promise(function(t){e.is(c)&&(w.removeModel(),c.reset(),c=null),t()})}).fail(function(e){d.error("WorkInstructionController::remove not able to remove work instructions due to - ",e)})},highlightLinkedViews:function(n){return d.info("WorkInstructionController::highlightLinkedViews API invoked with parameters : ",n),n&&e.is(n.pid,"string")&&(n.pid=[n.pid]),new e.Promise(function(i,o){W()&&n?g.getLinkedViewUuids(v(p.BUILDUPKEYS.PATHIDS),n).then(function(n){var o;c?e.is(n,"array")&&n.length>0?((o=t.getSlidesDefinition({context:s.getContext()}).find(function(e){return n.indexOf(e.uuid)>-1}))&&o.uuid&&c.activateView({viewUUID:o.uuid}),c.highlightViews(n)):(c.unHighlightViews(n),c.selectActiveView()):d.debug("Work Instruction views are not available, unable to highlight View"),i()}).fail(function(e){d.error("WorkInstructionController::highlightLinkedViews not able to highlight views due to ",e),o(e)}):(d.error("WorkInstructionController :: WorkInstruction mode is not active"),o(a.getNLSValue("Error.WorkInstModeNotActive.Message")))})},highlightWKIViews:function(n){return d.info("WorkInstructionController::highlightWKIViews API invoked with parameters : ",n),new e.Promise(function(i,o){if(W())if(e.is(n.viewUUIDs,"array")||e.is(n.viewIDs,"array")){if(c){let i=[];if(e.is(n.viewUUIDs,"array")?i=n.viewUUIDs:e.is(n.viewIDs,"array")&&n.viewIDs.forEach(function(e){let t=c.getUuidFromViewId(e);t&&i.push(t)}),i.length>0){if(!0===n.activateFirstView){let e,n;(n=(e=t.getSlidesDefinition({context:s.getContext()})).find(function(e){return i.indexOf(e.uuid)>-1}))&&n.uuid&&c.activateView({viewUUID:n.uuid})}c.highlightViews(i)}else c.unHighlightViews(i)}else d.debug("Work Instruction views are not available, unable to highlight View");i()}else d.error("WorkInstructionController :: highlightWKIViews Invalid input paramters"),o(a.getNLSValue("Error.InvalidInput.Message"));else d.error("WorkInstructionController :: WorkInstruction mode is not active"),o(a.getNLSValue("Error.WorkInstModeNotActive.Message"))})},getCurrentView:function(){return d.info("WorkInstructionController::getCurrentView API invoked"),new e.Promise(function(e,t){var n;c&&W()?(n=c.getActiveView())?e(n):(d.error("WorkInstructionController :: getCurrentView No active View ID found"),t(a.getNLSValue("Error.ActiveViewIDNotFound.Message"))):t(a.getNLSValue("Error.WorkInstModeNotActive.Message"))})},setCurrentView:function(t){return d.info("WorkInstructionController::setCurrentView API invoked with parameters : ",t),new e.Promise(function(n,i){W()?t&&(e.is(t.viewUUID,"string")||e.is(t.viewID,"number"))?(c.activateView(t),n()):(d.error("WorkInstructionController :: setCurrentView Invalid input paramters"),i(a.getNLSValue("Error.InvalidInput.Message"))):(d.error("WorkInstructionController :: WorkInstruction mode is not active"),i(a.getNLSValue("Error.WorkInstModeNotActive.Message")))})},clean:S,getCurrentViewInfo:async function(){return g.getViewInfo(await D.getCurrentView())},getCurrentBuildUpSettings:async function(){let e;try{let t=g.getViewInfo(await D.getCurrentView());t&&(e=t.BuildUpSettings)}catch(t){d.log(t),d.debug("Views are not available, global build up settings is shown"),e=l.getInstance("BuildUpBehaviorModelService").getBuildUpGlobalSettings()}return e},streamPathWithType:function(t,n,i){let o=w.getID(t);e.is(o)&&e.is(n,"array")&&e.is(i,"object")&&(n.push([o]),i[o]={type:p.WKIKEYS.DRESSUP})},destroy:function(){h&&h.destroy(),c&&c.destroy(),g&&g.destroy(),d=I=g=f=h=c=p=null,w.destroy()}};return D}});