define("DS/DELPPWMfgStructureModule/CreateMBOMStatusUI",["UWA/Core"],function(e){"use strict";const t="CREATED",n="IN_PROGRESS",o="COMPLETED",i="FAILED",a=function(t){return e.is(t,"string")&&0===t.length},r=function(e){return new Date(e)},s=function(e,t){return e>t?1:e===t?0:-1};return function(l,u,d,c,m){const g=[{text:d.getNLSValue("CreateMBOMStatusUI.Column.Action"),description:d.getNLSValue("CreateMBOMStatusUI.Column.Action"),dataIndex:"tree",width:"9.5%"},{text:d.getNLSValue("CreateMBOMStatusUI.Column.Details"),description:d.getNLSValue("CreateMBOMStatusUI.Column.Details"),dataIndex:"details",width:"20%"},{text:d.getNLSValue("CreateMBOMStatusUI.Column.Status"),description:d.getNLSValue("CreateMBOMStatusUI.Column.Status"),dataIndex:"status",width:"10%",getCellSemantics:function(e){return{icon:function(e){let t;switch(e.toUpperCase()){case o:t="status-ok";break;case i:t="remove";break;case n:t="compute";break;default:t=""}return{iconName:t,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}}(e.nodeModel.options.status)}}},{text:d.getNLSValue("CreateMBOMStatusUI.Column.Started"),description:d.getNLSValue("CreateMBOMStatusUI.Column.Started"),dataIndex:"started",width:"13.5%",typeRepresentation:"datetime",alignment:"near",compareFunction:function(e,t){return s(e,t)},getCellValueForSort:function(e){return Number(e.options.startedDateTime)}},{text:d.getNLSValue("CreateMBOMStatusUI.Column.Ended"),description:d.getNLSValue("CreateMBOMStatusUI.Column.Ended"),dataIndex:"ended",width:"13.5%",typeRepresentation:"datetime",alignment:"near",hasCellValue:function(e){let o;switch(e.nodeModel.options.status){case t:case n:o=!1;break;default:o=!0}return o},compareFunction:function(e,t){return s(e,t)},getCellValueForSort:function(e){const t=e.options.endedDateTime;return a(t)?0:Number(t)}},{text:d.getNLSValue("CreateMBOMStatusUI.Column.MoreDetails"),description:d.getNLSValue("CreateMBOMStatusUI.Column.MoreDetails"),dataIndex:"moreDetails"}];let p,f,I,S;const M=function(e){e.sortModel=[{dataIndex:"started",sort:"desc"}]},C=function(t){if(-1===t.columnID)return this.getCellDefaultTooltip(t);let n="";const{dataIndex:o,description:i}=this.getColumnOrGroup(t.columnID);if(-1===t.rowID)return e.is(i)&&(n=i),{longHelp:n};const a=t.nodeModel,r="tree"===o?a.getLabel():a.getAttributeValue(o);if(e.is(r))switch(o){case"tree":case"details":case"owner":case"started":case"ended":case"status":case"moreDetails":n=r}return{longHelp:n}},h=function(e,t){const n=u.getComponent("TreeNodeModel"),o=t.map(e=>{let t;if(e.details.startsWith("{")){const n=JSON.parse(e.details),{rootMfgTitle:o,rootPrdTitle:i}=n;t="Scoped Mfg Item: "+o+", Scoped Product: "+i}else t=e.details;const o=r(Number(e.started)),i=a(e.ended)?"":r(Number(e.ended));return new n({label:d.getNLSValue(`CreateMBOMStatusUI.Action.${e.action}`),grid:{details:t,owner:e.owner,started:o,ended:i,status:d.getNLSValue(`CreateMBOMStatusUI.Status.${e.status}`),moreDetails:e.moreDetails},payload:e.payload,mfgId:e.mfgId,correlationId:e.correlationId,status:e.status,startedDateTime:e.started,endedDateTime:e.ended})});e.withTransactionUpdate(()=>{o.forEach(t=>e.addRoot(t))})},b=function(t){const n=u.getComponent("WUXFrameWindowsManager").getFrameWindow(l.getAppContext()).getImmersiveFrame(),o=u.getComponent("Button");let a=e.createElement("div");a.className="cm-status-header",a.setAttribute("id","cm-status-header"),a.setStyles({left:"10px",position:"relative",width:"fit-content"});let r=e.createElement("div");r.className="header-base",r.setStyles({display:"flex","align-items":"center",height:"25px"});const f=new o({domId:"RefreshButton",label:d.getNLSValue("CreateMBOMStatusUI.RefreshAll"),icon:{iconName:"refresh",fontIconSize:"1x"},onClick:()=>{if(e.is(S,"function")){f.disabled=!0,p.unselectAll();const t=d.getNLSValue("View.WaitMessage");I.displayModalLoader(t,()=>{S().then(n=>{e.is(p)&&(p.empty(),n.sort((e,t)=>(function(e,t,n){return n(t,e)})(Number(e.started),Number(t.started),s)),h(p,n),M(I)),f.disabled=!1,I.removeModalLoader(t)}).catch(e=>{f.disabled=!1,I.removeModalLoader(t)})})}}}),b=new o({domId:"ResubmitButton",label:d.getNLSValue("CreateMBOMStatusUI.Resubmit"),icon:{iconName:"reset",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},disabled:!0,onClick:()=>{const t=p.getSelectedNodes();if(Array.isArray(t)&&1===t.length){const n=function(t){const n=t.options,o=n.status.toUpperCase()===i;if(o){const t=n.mfgId,i=JSON.parse(n.payload),{rawXMLPhantomNodeConfig:a,rawXMLLinkAuthoringConfig:r}=c.getRawXMLsRequired4CreateMBOM();return{isJobInFailedState:o,details:{payload:{...i,xmlPhantomNodeConfig:e.is(a,"string")?a:null,xmlLinkAuthoringConfig:e.is(r,"string")?r:null},mfgId:t,correlationId:n.correlationId}}}return{isJobInFailedState:o,details:null}}(t[0]);if(n.isJobInFailedState&&e.is(n.details)){const{payload:t,mfgId:o,correlationId:i}=n.details;b.disabled=!0;const a=d.getNLSValue("View.WaitMessage");I.displayModalLoader(a,()=>{(function(t,n,o){return new Promise(function(i,a){if(0===m.getInstancesFromCollection(n).length){const n={noTimeout:!0};l.notify("startProgress",n),c.createMBOMOnResubmit(t,o).then(e=>{l.info(d.getNLSValue("CreateMfgItemStructure.jobSubmit.Success")),l.notify("stopProgress",n),i()}).catch(t=>{e.is(t)&&e.owns(t,"message")&&"MfgItem_has_children"===t.message?l.warn(d.getNLSValue("CreateMBOMStatusUI.jobSubmit.Resubmit")):l.warn(d.getNLSValue("CreateMfgItemStructure.jobSubmit.Fail")),l.notify("stopProgress",n),a()})}else l.warn(d.getNLSValue("CreateMBOMStatusUI.jobSubmit.Resubmit")),a()})})(t,o,i).then(()=>{b.disabled=!1,I.removeModalLoader(a)}).catch(()=>{b.disabled=!1,I.removeModalLoader(a)})})}}}});f.inject(r),b.inject(r),a.setContent(r);const L=u.create("Panel",{header:a,title:d.getNLSValue("CreateMBOMStatusUI.Title"),icon:d.getIconURLFromKey("CreateMBOMStatus"),immersiveFrame:n,content:t,width:1100,height:250,position:{my:"center",at:"center"},resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!0});L.close=(()=>L.hide());const N=u.getComponent("TreeDocument"),P=u.getComponent("DataGridView"),w=new N;return w.getXSO().onChange(()=>{!function(e,t){1===e.length?!0===t.disabled&&(t.disabled=!1):!1===t.disabled&&(t.disabled=!0)}(w.getSelectedNodes(),b)}),I=new P({treeDocument:w,columns:g,getCellTooltip:C}),M(I),I.getContent().inject(t),{panel:L,treeDocument:w}};return{display:function(t){S=t;const n=t();e.is(n.then,"function")&&n.then(t=>{let n=e.createElement("div",{class:"CreateMBOMStatus-content-container"});const{panel:o,treeDocument:i}=b(n);f=o,p=i,h(i,t),o.show()})},destroy:function(){e.is(p)&&(p.empty(),p=null),e.is(S)&&(S=null),e.is(f)&&(f.destroy(),f=null)}}}}),define("DS/DELPPWMfgStructureModule/MfgStructureModule",["UWA/Core","DS/DELPPWMfgStructureModule/CreateMBOMStatusUI"],function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","ModelBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ProductImplementBehavior","SelectionBehavior","MfgItemBehavior","ViewBehavior","RootsBehavior"],creator:function(n,o,i,a,r,s,l,u,d,c,m){var g,p,f,I,S,M,C,h,b,L,N,P,w,D,B,U,v,V=null,O={},R=null,y=null;p=function(t,n){if(O={},!e.is(t))throw new Error("Command ID is null");O.cmdId=t,O.onOKCallBack=n,O.onCancelCallback=L},S=function(){e.is(V)&&(V.isVisible()&&V.destroyUI(),V=void 0)},M=function(e){var t=!0,n=c.getActiveView();return!1===e.changed.isSelected&&e.sourceId!==n&&(t=!1),t},I=function(){var t,n,o,i,r={},s=[],u=!1;return t=V.getImplementingID(),i=V.getImplementedIDs()[0],e.is(t)&&(n=a.getReferenceId(t),(o=l.getScopeLinksOfImplementing(n)).length>0&&(r.id=o[0].get("to"),s.push(r),e.is(i)?a.getReferenceId(i)!==r.id&&(V.updateImplemented(s),u=!0):(V.updateImplemented(s),u=!0))),u},f=function(e){var t,n;!0===e.bUpdateImplemented?(V.updateImplemented(e.selNodes),t="ImplementUI.ImplementedSelectionNotAllowed",n="error"):!0===e.bUpdateImplementing&&(V.updateImplementing(e.selNodes),t="ImplementUI.ImplementedSelectionChanged",n="info"),!0===I()&&V.showMessages(i.getNLSValue(t),n)},C=function(t){if(O={},!e.is(t))throw new Error("Command ID is null");O.cmdId=t,O.moduleOptions=g,O.onOKCallBack=P,O.onCancelCallback=L},h=function(e,t){R.updateImplementingLabel(e),a.getMajorRevisions(t,function(e){R.updateImplementedRevnList(t,e,!1)})},b=function(){e.is(R)&&(R.isVisible()&&R.destroyUI(),R=void 0)};const F=function(){e.is(y)&&(y.destroy(),y=null)};return N=function(t){var r,s,u,c,g,p,f,I,M,C={};if(e.is(t)){r=a.getReferenceModel(t.implementingId),s=a.getReferenceModel(t.implementedIDs[0]),u=a.getInstance(t.implementingId),c=a.getInstance(t.implementedIDs[0]),M=t.implementingId,e.is(t.implementingPaths[0])&&e.is(t.implementingPaths[0][0])&&(M=a.getInstance(t.implementingPaths[0][0]).get("isAggregatedBy")),u&&c&&l.isImplementLinkPossible(t.implementingPaths[0],t.implementedPaths[0])&&(g=u.get("PID"),p=l.getPathToScope(t.implementedPaths[0])),f=r.get("PLMEntity.V_Name"),I=s.get("PLMEntity.V_Name"),C.scopeCreation=t.scopeCreation,C.prefix=t.mfgItemPrefix,C.logMessage=i.getNLSValue("CreateMfgItemStructure.LogMessage",{mbom:f,ebom:I}),C.computeResultReport=!!e.is(t.resultReportMode)&&"no_report"!==t.resultReportMode;const h=m.getCompatibleConfigurationFilters([s.id]);if(!e.is(h)||null===h)return void n.warn(i.getNLSValue("Error.NoConfigurationFiltersExists.Failure"));d.webservice("Create",{product:{referencePID:s.get("PID"),OccPath:p,productConfigFilter:h[s.id]},mfgItem:{referencePID:r.get("PID"),instancePID:g,topRootMfgItemPID:M}},C,function(n){var i;n=n||{},e.is(n.resultReport)&&(e.is(t.resultReportMode)&&(i=t.resultReportMode),o.create("MfgItemCreateReportUI",{report:n.resultReport,mode:i}))}),S()}},P=function(t){var n,o,r={};e.is(t)&&(n=a.getReferenceModel(t.implementingId).get("PLMEntity.V_Name"),r.backgroundJobFlag=!1,r.scopeCreation=t.scopeCreation,r.prefix=t.mfgItemPrefix,r.logMessage=i.getNLSValue("UpdateMfgItemStructure.LogMessage",{mbom:n}),r.updateIntermediateScopedAssemblies=t.updateIntermediateScopedAssemblies,o=t.implementingId,e.is(t.implementingPaths[0])&&e.is(t.implementingPaths[0][0])&&(o=a.getInstance(t.implementingPaths[0][0]).get("isAggregatedBy")),d.webservice("Update",{product:{referencePID:t.implementedId,productConfigFilter:v[t.implementedId]},mfgItem:{referencePID:t.implementingId,processConfigFilter:U[t.implementingId],topRootMfgItemPID:o}},r),b())},L=function(){S(),b()},w=function(){L(),p("CreateMfgItemStructure",N),O.cmdTitle="Dialog.CreateMfgItemStructure.Title",O.implementingSection=!0,O.implementedSection=!0,O.optionsSection=!0,O.scopeOption="ComboBox",O.mfgItemPrefix=!0,O.mfgItemResultReport=!d.isCreateMBOMv2(),O.multiSelectionOfImplementing=!1,O.multiSelectionOfImplemented=!1,V=o.create("ImplementUI",O),f(V.getSelectionsWithPaths())},D=function(){e.is(y)&&F(),(y=new t(n,o,i,d,a)).display(()=>d.getCreateMfgItemStatus())},B=function(){var t,r,s,d,c,g=u.getSelectionsWithPaths()[1][0],p=g.id,f=a.getReferenceModel(p);if(L(),!e.is(f))return void n.debug("UpdateMfgItemStructure: Reference Model not found for pid:"+p);if(s=f.get("PID"),(t=l.getScopeLinksOfImplementing(s)).length<=0)return void n.warn(i.getNLSValue("Error.NoProductScopeExists.Title"));if(r=t[0].get("to"),e.is(g.path,"array")&&g.path.length>0){const e=g.path[0];c=a.getInstance(e).get("isAggregatedBy");const t=l.getScopeLinksOfImplementing(c);if(0===t.length)return void n.warn(i.getNLSValue("Error.NoProductScopeExists.Title"));d=t[0].get("to")}else d=r,c=s;const I=m.getCompatibleConfigurationFilters([c]),S=m.getCompatibleConfigurationFilters([d]);e.is(I)&&e.is(S)?(U={...I},v={...S},C("UpdateMfgItemStructure"),O.cmdTitle="Dialog.UpdateMfgItemStructure.Title",O.implementedRevTreeListCSSStyle="implementedSection-container-withChkBox",O.optionsSection=!0,O.scopeOption="ComboBox",O.mfgItemPrefix=!0,O.defaultHeight="430",O.modalFlag=!0,(R=o.create("ImplementedRevChooserUI",O)).updateImplementing(),h(s,r)):n.warn(i.getNLSValue("BI.Computation.IncompatibleFilter"))},{listenTo:function(){return{select:this.onSelect,CreateMfgItemStructure:w,CreateMBOMStatus:D,UpdateMfgItemStructure:B}},onStart:function(e){g=e},onStop:function(){S(),b(),F()},onSelect:function(t){if(e.is(V)&&V.isVisible()&&e.is(t)){if(!1===M(t))return;e.is(t.changed)&&f(V.getSelectionsWithPaths())}}}}}});