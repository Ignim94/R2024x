define("DS/CSIViewModelWebImplement/CSIVMClientObject",["UWA/Core","DS/CSIViewModelWebInterfaces/CSIVMClientStateMode"],function(e,t){"use strict";class i{constructor(){this._childrenMapping=void 0,this._children=void 0,this._parents=void 0,this._associatedObject=void 0,this._withTempoState=void 0,this._childrenTempo=void 0,this._parentsTempo=void 0,this._associatedObjectTempo=void 0}initTempoChildren(){e.is(this._childrenTempo)||(!0===this._childrenMapping?this._childrenTempo=new Map(this._children):this._childrenTempo=void 0!==this._children?this._children.slice():[],this._withTempoState=!0)}initTempoParents(){void 0===this._parentsTempo&&(this._parentsTempo=void 0!==this._parents?this._parents.slice():[],this._withTempoState=!0)}abort(){this._childrenTempo=void 0,this._parentsTempo=void 0,this._associatedObjectTempo=void 0,this._withTempoState=!1}commit(){this._withTempoState&&(void 0!==this._childrenTempo&&(this._children=this._childrenTempo),void 0!==this._parentsTempo&&(this._parents=this._parentsTempo),void 0!==this._associatedObjectTempo&&(this._associatedObject=this._associatedObjectTempo),this.abort())}getProperty(e,i){let r=void 0;switch(i){case t.Tempo:case t.TempoOrPermanent:void 0===(r=this[e+"Tempo"])&&(r=this[e]);break;case t.Permanent:r=this[e]}return r}setAssociatedObject(e){this._withTempoState=!0,this._associatedObjectTempo=e}getAssociatedObject(e){return this.getProperty("_associatedObject",e)}addChild(e){this.initTempoChildren(),!0===this._childrenMapping?this._childrenTempo.set(e.getLocalId(),e):this._childrenTempo.push(e)}addChildren(e){if(this.initTempoChildren(),!0===this._childrenMapping){let t,i=e.length;for(let r=0;r<i;++r)t=e[r],this._childrenTempo.set(t.getLocalId(),t)}else{let t=e.length,i=this._childrenTempo.length;t+=i,this._childrenTempo.length=t;for(let r=i;r<t;++r)this._childrenTempo[r]=e[r-i]}}removeChild(e){if(this.initTempoChildren(),!0===this._childrenMapping)this._childrenTempo.delete(e.getLocalId());else{let t=this._childrenTempo.indexOf(e);t>-1&&this._childrenTempo.splice(t,1)}}removeChildren(e){this.initTempoChildren();let t,i,r=e.length;if(!0===this._childrenMapping)for(t=0;t<r;++t)i=e[t],this._childrenTempo.delete(i.getLocalId());else{let a=-1;for(t=0;t<r;++t)i=e[t],(a=this._childrenTempo.indexOf(i))>-1&&this._childrenTempo.splice(a,1)}}getChildren(e){let t,i=this.getProperty("_children",e);return void 0!==i&&(t=!0===this._childrenMapping?Array.from(i.values()):i),t}getMappedChildren(e){return!0===this._childrenMapping?this.getProperty("_children",e):void 0}addParent(e){this.initTempoParents(),this._parentsTempo.push(e)}removeParent(e){this.initTempoParents();let t=this._parentsTempo.indexOf(e);t>-1&&this._parentsTempo.splice(t,1)}getParents(e){return this.getProperty("_parents",e)}}class r{constructor(e,t,i){this._ViewDatas=void 0,this._localId=t,this._idPattern=i,this._nameSpace=e,this._additionalObjects=void 0,this._dualObj=void 0,this._dualViewType=void 0,this._mainObj=void 0,this._childrenMapping=void 0}clear(){void 0!==this._ViewDatas&&delete this._ViewDatas}getLocalId(){return this._localId}getIdPattern(){return this._idPattern}getNameSpace(){return this._nameSpace}getMainObject(){return this._mainObj}addObject(){void 0===this._additionalObjects&&(this._additionalObjects=[]);let e=new r(this._nameSpace,this._localId,this._idPattern);return e._mainObj=this,e._dualObj=this._dualObj,e._dualViewType=this._dualViewType,this._additionalObjects.push(e),e}getAdditionalObjects(){return this._additionalObjects}getViewData(e){let t=void 0;return void 0!==this._ViewDatas&&(t=this._ViewDatas[e.getViewType()]),t}getOrCreateViewData(e){let t=void 0,r=e.getViewType();return void 0!==this._ViewDatas&&(t=this._ViewDatas[r]),void 0===t&&(void 0===this._ViewDatas&&(this._ViewDatas={}),t=new i,!0===this._childrenMapping&&(t._childrenMapping=!0),this._ViewDatas[r]=t),t}deleteViewData(e){if(void 0!==this._ViewDatas&&void 0!==e&&(delete this._ViewDatas[e.getViewType()],0===Object.keys(this._ViewDatas).length&&delete this._ViewDatas,void 0!==this._dualObj)){this._dualObj.getDualObject(e.getViewType())===this&&this._dualObj.setDualObject(),this.setDualObject()}}isEmpty(){if(void 0!==this._additionalObjects){let e=0,t=this._additionalObjects.length;for(e=0;e<t;e++)if(!this._additionalObjects[e].isEmpty())return!1}return void 0===this._ViewDatas&&!this.isRoot()}isTemporary(){let e=void 0,i=void 0;if(void 0!==this._ViewDatas)for(e of Object.values(this._ViewDatas))if(void 0!==(i=this.isRoot()?e.getChildren(t.Permanent):e.getParents(t.Permanent)))return!1;return!0}associateViewElt(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&i.setAssociatedObject(t)}getAssociatedViewElt(e){let i=void 0,r=this.getViewData(e);return void 0!==r&&(i=r.getAssociatedObject(t.TempoOrPermanent)),i}getKey(e){let i=void 0,r=void 0;if(void 0!==this._ViewDatas)for(let a of Object.keys(this._ViewDatas)){if((r=this._ViewDatas[a].getAssociatedObject(t.Tempo))===e){i=this.getNameSpace().getTreeKeyFromViewType(a);break}if((r=this._ViewDatas[a].getAssociatedObject(t.Permanent))===e){i=this.getNameSpace().getTreeKeyFromViewType(a);break}}return i}setRoot(){this._isRoot=!0,this._nameSpace.setRootObject(this)}isRoot(){return!0===this._isRoot}isLeaf(e){let i=!0,r=this.getChildren(e,t.TempoOrPermanent);return void 0!==r&&r.length>0&&(i=!1),i}activateChildrenMapping(){this._childrenMapping=!0}addChild(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&(i.addChild(t),t.addParent(e,this))}addChildren(e,t){let i=this.getOrCreateViewData(e);if(void 0!==i){i.addChildren(t);let r=t.length;for(let i=0;i<r;i++)t[i].addParent(e,this)}}addParent(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&i.addParent(t)}removeChild(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&(i.removeChild(t),t.removeParent(e,this))}removeChildren(e,t){let i=this.getOrCreateViewData(e);if(void 0!==i){i.removeChildren(t);let r=t.length;for(let i=0;i<r;i++)t[i].removeParent(e,this)}}removeParent(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&i.removeParent(t)}getChildren(e,t){let i=void 0,r=this.getViewData(e);return void 0!==r&&(i=r.getChildren(t)),i}getMappedChildren(e,t){let i=void 0,r=this.getViewData(e);return void 0!==r&&(i=r.getMappedChildren(t)),i}getAllChildren(e){let t,i,r,a=[],s=void 0,n=void 0,o=void 0;if(void 0!==this._ViewDatas)for(s of Object.keys(this._ViewDatas))if(void 0!==(o=(n=this._ViewDatas[s]).getChildren(e)))for(t=o.length,i=0;i<t;i++)r=o[i],a.indexOf(r)<0&&a.push(r);return a}getAllParents(e){let t,i,r,a=[],s=void 0,n=void 0,o=void 0;if(void 0!==this._ViewDatas)for(s of Object.keys(this._ViewDatas))if(void 0!==(o=(n=this._ViewDatas[s]).getParents(e)))for(t=o.length,i=0;i<t;i++)r=o[i],a.indexOf(r)<0&&a.push(r);return a}getFirstParentsDefiningNameSpaceOfThis(e){let i,r=[];if(void 0===e){if((i=this.getIdPattern()._idSpace)===this.getIdPattern()._idContext)return r}else i=e;let a=this.getAllParents(t.Tempo),s=a.length;if(s)if(a[0].getIdPattern()._idContext===i)for(let e=0;e<s;e++){if(a[e].getIdPattern()._idContext!==i)return;r.push(a[e])}else{let e=0;for(;!r.length&&e<s;)r=a[e].getFirstParentsDefiningNameSpaceOfThis(i),e++}return r}getParents(e,t){let i=void 0,r=this.getViewData(e);return void 0!==r&&(i=r.getParents(t)),i}getChildrenWithId(e,t,i){let r=[];if(void 0===i)return r;if(!0===this._childrenMapping){let a=this.getMappedChildren(e,t);if(void 0!==a){let e=i.length;if(a.size===e)r=Array.from(a.values());else{let t,s,n;for(t=0;t<e;++t)"string"==typeof(n=i[t])&&(n=parseInt(n)),void 0!==(s=a.get(n))&&r.push(s)}}}else{let a=this.getChildren(e,t);if(void 0!==a){let e=a.length,t=i.length;if(e===t)r=a;else{let s,n,o=new Map;for(s=0;s<e;++s)void 0!==(n=a[s])&&o.set(n.getLocalId().toString(),n);for(s=0;s<t;++s)void 0!==(n=o.get(i[s]))&&r.push(n)}}}return r}preCommit(i){if(this._nameSpace._errManager.addContext({name:"preCommit",arguments:arguments}),void 0!==this._additionalObjects){let e,t=0,r=this._additionalObjects.length;for(t=0;t<r;t++)(e=this._additionalObjects[t]).preCommit(i)}let r=this.getViewData(i);if(void 0!==r){let a=r.getParents(t.Tempo);if(!(this.isRoot()||e.is(a)&&0!==a.length)){let e=0,a=r.getChildren(t.Tempo);if(void 0!==a){let t,r=a.length;for(e=0;e<r;e++)(t=a[e]).removeParent(i,this),t.preCommit(i)}this.deleteViewData(i)}}this._nameSpace._errManager.cleanContext(arguments)}commit(e){if(this._nameSpace._errManager.addContext({name:"commit",arguments:arguments}),void 0!==this._additionalObjects){let t,i=0,r=this._additionalObjects.length;for(i=0;i<r;i++)(t=this._additionalObjects[i]).commit(e)}let t=this.getViewData(e);void 0!==t&&t.commit(),this._nameSpace._errManager.cleanContext(arguments)}abort(e){if(this._nameSpace._errManager.addContext({name:"abort",arguments:arguments}),void 0!==this._additionalObjects){let t=0;for(t=this._additionalObjects.length-1;t>=0;t--)this._additionalObjects[t].isTemporary()?this._additionalObjects.splice(t,1):this._additionalObjects[t].abort(e)}let t=this.getViewData(e);void 0!==t&&t.abort(),void 0!==this._dualObj&&this._dualObj.setDualObject(e.getViewType(),this),this._nameSpace._errManager.cleanContext(arguments)}setDualObject(e,t){this._dualObj=t||void 0,this._dualViewType=e}getDualObject(e){let t=void 0;return e!==this._dualViewType&&void 0!==e||(t=this._dualObj),t}getGlobalId(){return this._idPattern&&this._localId?`${this._idPattern._idContext}#${this._localId}`:null}}return r}),define("DS/CSIViewModelWebImplement/CSIVMErrorManager",[],function(){function e(){this._activeState=!1,this._debugContext=[]}return e.prototype.setDebugMode=function(e){let t=this;t._activeState=1==e&&e,t._activeState&&(window.onerror=function(e,i,r,a,s){t._activeState&&(console.error("Context",t._debugContext),console.error("StackTrace",s))})},e.prototype.addContext=function(e){this._activeState&&this._debugContext.push(e)},e.prototype.cleanContext=function(e){let t=this;t._activeState&&0!=t._debugContext.length&&-1!=(index=function(){for(let i in t._debugContext)if(e==t._debugContext[i].arguments)return i;return-1}())&&t._debugContext.splice(index)},e}),define("DS/CSIViewModelWebImplement/CSIVMStringMap",[],function(){"use strict";function e(){this._data=new Map,this.clear()}return e.prototype.clear=function(){this._data.clear()},e.prototype.createValue=function(e,t){if(void 0===e)return;let i=e.toString(),r=this._data.get(i);Array.isArray(r)?r.push(t):this._data.set(i,[t])},e.prototype.size=function(e){return this._data.size},e.prototype.get=function(e){if(void 0!==e)return this._data.get(e.toString())},e.prototype.remove=function(e,t){if(void 0!==e){let i=e.toString(),r=!0;if(void 0!==t){let e=this._data.get(i);if(Array.isArray(e)){let i=e.indexOf(t);i>-1&&e.splice(i,1),e.length>0&&(r=!1)}}r&&this._data.delete(i)}},e.prototype.forEachValue=function(e,t){let i,r,a,s;if(void 0!==t){if(s=this._data.get(t.toString()),Array.isArray(s))for(r=s.length,i=0;i<r;++i)a=s[i],e(a)}else this._data.forEach(function(t){if(Array.isArray(t))for(r=t.length,i=0;i<r;++i)a=t[i],e(a)})},e.prototype.findValue=function(e){let t,i,r=this._data.values(),a=r.next();for(;!a.done&&void 0===t;)i=a.value,Array.isArray(i)&&(t=i.find(function(t){return e(t)})),a=r.next();return t},e}),define("DS/CSIViewModelWebImplement/CSIVMClientNameSpace",["UWA/Core","DS/CSIViewModelWebImplement/CSIVMClientObject","DS/CSIViewModelWebImplement/CSIVMStringMap","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientStateMode"],function(e,t,i,r,a){"use strict";const s="#",n="/";return class{constructor(e,t,r=!1){this._treeKeys={},this._objects=new i,this._uuid=e,this._model=t,this._errManager=t.getErrorManager(),this._rootObj=void 0,this._isMain=r}clear(e){if(void 0!==e){delete this._treeKeys[e.getViewType()];let t=e.getUUID();this._model.removeTreeKey(t)}(this.isEmpty()||void 0===e)&&(void 0!==this._objects&&this._objects.clear(),this._treeKeys={},this._rootObj=void 0)}isEmpty(){return null==this._treeKeys||0===Object.keys(this._treeKeys).length||0==this._objects.size()}addTreeKey(e){void 0!==e&&(this._treeKeys[e.getViewType()]=e)}getTreeKey(e){return this._model.getTreeKey(e)}getAllTreeKeys(){return Object.values(this._treeKeys)}getTreeKeyFromViewType(e){return this._treeKeys[e]}isNameSpaceOfTreeKey(e){return void 0!==e&&this._treeKeys[e.getViewType()]===e}setRootObject(e){this._rootObj=e}getRootObject(){return this._rootObj}getObjects(e,t){let i=[];return this._objects.forEachValue(function(t){t.getIdPattern()===e&&i.push(t)},t),i}getObjectsFromCtx(e,t){let i=[];return this._objects.forEachValue(function(t){t.getIdPattern()._idContext===e&&i.push(t)},t),i}createObject(e,i){let r=void 0;return this._model.isAnExistingIdPattern(e)&&(r=new t(this,i,e),this._objects.createValue(i,r)),r}getOrCreateObject(e,t){let i=void 0,r=this.getObjects(e,t);return i=r.length?r[0]:this.createObject(e,t)}removeObject(e){if(void 0!==e){let t=e.getLocalId();this._objects.remove(t,e);let i=e.getDualObject();void 0!==i&&i.getDualObject()===e&&i.setDualObject()}}pushNewExistingObject(e){if(0===this.getObjects(e._idPattern,e._localId).length){let t=this._objects.get(e._localId);t.length=0;let i=fromNamespace.getObjects(e._idPattern,e._localId);t.push(i[0])}}commit(e){this._errManager.addContext({name:"commit",arguments:arguments}),this._objects.forEachValue(function(t){t.preCommit(e)});let t=[];this._objects.forEachValue(function(i){i.isEmpty()?t.push(i):i.commit(e)});for(let e=t.length,i=0;i<e;++i){let e=t[i];this.removeObject(e)}this._errManager.cleanContext(arguments)}abort(e){this._errManager.addContext({name:"abort",arguments:arguments}),this._objects.forEachValue(function(t){t.abort(e)}),this._errManager.cleanContext(arguments)}buildGlobalId(e){this._errManager.addContext({name:"buildGlobalId",arguments:arguments});let t="",i="",r=null,a=null,o=null,d=!1,h=!0,l=!0;for(let c=e.length-1;c>=0;c--){let _=e[c],p=_.getIdPattern();r=p._idSpace,d=p._shared,i=(o=p._idContext)+s+_.getLocalId(),o&&r&&o===a&&(l=!0),l&&(h||(i+=n),h=!1,t=i+=t),(l=d)||(a=r)}return this._errManager.cleanContext(arguments),t}findNodesByIdentifier(e){let t=e.split(s),i=t[0],r=t[1];return this.getObjectsFromCtx(i,r)}has3D(){return e.is(this._treeKeys[r.ViewType.View3D])}}}),define("DS/CSIViewModelWebImplement/CSIVMClientModel",["DS/CSIViewModelWebImplement/CSIVMClientNameSpace","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientStateMode","DS/CSIViewModelWebImplement/CSIVMErrorManager"],function(e,t,i,r){"use strict";const a="/";class s{constructor(e,t,i){this._idSpace=e,this._idContext=t,this._shared=i}}return class{constructor(){this._nameSpaces=[],this._treeKeys={},this._errorManager={},this._idPatterns=[]}clear(){for(let e of this._nameSpaces)e.clear();this._nameSpaces=[],this._idPatterns=[],this._treeKeys={},this._errorManager={}}getOrCreateTreeKey(e,i,r,a){let s=this.getTreeKey(e);return void 0===s&&(s=new t(e,i,r,a),this._treeKeys[e]=s),s}getTreeKey(e){return this._treeKeys[e]}getTreeKeysFromViewType(e){let t=[];for(const i of Object.values(this._treeKeys))i.getViewType()===e&&t.push(i);return t}removeTreeKey(e){void 0!==this.getTreeKey(e)&&delete this._treeKeys[e]}getIdPattern(e,t,i){let r=void 0;if(void 0!==e&&void 0!==t&&void 0!==i){let a=0,s=this._idPatterns.length,n=null;for(a=0;a<s&&void 0===r;a++)(n=this._idPatterns[a])._idSpace===e&&n._idContext===t&&n._shared===i&&(r=n)}return r}isAnExistingIdPattern(e){let t=!1;return void 0!==e&&this._idPatterns.indexOf(e)>-1&&(t=!0),t}getOrCreateIdPattern(e,t,i){let r=void 0;return void 0!==e&&void 0!==t&&void 0!==i&&void 0===(r=this.getIdPattern(e,t,i))&&(r=new s(e,t,i),this._idPatterns.push(r)),r}getObject(e,t,i){let r=void 0,a=this.getNameSpace(e);if(void 0!==a){let e=a.getObjects(t,i);e.length&&(r=e[0])}return r}getNameSpaces(){return this._nameSpaces}createObject(e,t,i){let r=void 0,a=this.getNameSpace(e);return void 0!==a&&(r=a.createObject(t,i)),r}getOrCreateObject(e,t,i){let r=void 0,a=this.getNameSpace(e);return void 0!==a&&(r=a.getOrCreateObject(t,i)),r}getDualObject(e,t,i){let r=void 0,a=this.getTreeKeysFromViewType(e),s=0,n=a.length;for(s=0;s<n&&void 0===r;s++){let e=a[s],n=this.getNameSpace(e);if(void 0!==n){let e=n.getObjects(t,i);void 0!==e&&1===e.length&&(r=e[0])}}return r}getNameSpace(e){let t=void 0,i=0,r=this._nameSpaces.length,a=e.getNameSpaceId();for(i=0;i<r&&void 0===t;i++){let r=this._nameSpaces[i];r.isNameSpaceOfTreeKey(e)?t=r:r._uuid===a&&(t=r).addTreeKey(e)}return t}createNameSpace(t){let i=new e(t,this);return this._nameSpaces.push(i),i}getOrCreateNameSpace(e){let t=void 0;return void 0===(t=this.getNameSpace(e))&&e.getNameSpaceId().length>0&&(t=this.createNameSpace(e.getNameSpaceId())).addTreeKey(e),t}removeNameSpace(e){let t=this._nameSpaces.indexOf(e);t>-1&&this._nameSpaces.splice(t,1)}findNodesByIdentifier(e,t){let i=[],r=t,a=!1;if(t&&(i=t.findNodesByIdentifier(e)),0==i.length)for(let s of Object.values(this._nameSpaces))if(s!==t&&(i=s.findNodesByIdentifier(e)).length){r=s,a=!0;break}return[i,r,a]}addSharedObjectToNamespace(e,t,i){if(0===i.getObjects(e._idPattern,e._localId).length){i.createObject(e._idPattern,e._localId);let r=i._objects.get(e._localId);r.length=0;let a=t.getObjects(e._idPattern,e._localId);r.push(a[0])}}decodeGlobalId(e){this._errorManager.addContext({name:"decodeGlobalIdInternal",arguments:arguments}),void 0===e.State&&(e.State=i.Permanent),void 0===e.isOptimizedPath&&(e.isOptimizedPath=!0),void 0===e.namespace&&(e.namespace=this);const t=e.Node,r=e.Id,s=e.State,n=e.AuthorizePartialPath,o=e.isOptimizedPath,d=r.split(a);e.noPath;let h=e.namespace,l=null,c=[],_=!1,p=[],g=null,m=UWA.is(t)?t:h.getRootObject();if(o&&p.push(m),e.noPath){let[e,t,i]=this.findNodesByIdentifier(r,h);if(1==e.length)return e[0];throw new Error(`unexpected number of object! for ${r} found ${e.length}`)}for(let t=0;t<d.length&&UWA.is(p);t++){let i,r=d[t],a=void 0;[i,l,_]=this.findNodesByIdentifier(r,h);let u=i.length;if(1===u)a=i[0];else if(u)for(let e=0;e<u&&!UWA.is(a);e++){let t=i[e].getFirstParentsDefiningNameSpaceOfThis(),r=t.length;for(let s=0;s<r&&!UWA.is(a);s++)p.indexOf(t[s])>=0&&(a=i[e])}if(!UWA.is(a)){p=void 0;break}if(_&&c.push(h),t===d.length-1)for(let t of c)t!==h&&(this.addSharedObjectToNamespace(a,h,t),e.onNewObjectInNamespace&&e.onNewObjectInNamespace(a,h,t));h=l;let f=a.getAdditionalObjects();if(UWA.is(f)){let e,t,i=a;a=void 0;for(let r=-1;r<f.length&&void 0===a;r++){t=(e=-1===r?i:f[r]).getAllParents(s);for(let i=0;i<t.length&&void 0===a;i++)t[i]===m&&(a=e)}}if(o){let e=a,t=[];for(;a!==m;){if(void 0===a){t=[];break}if(t.push(a),g=a.getAllParents(s),a=g[0],g.length>1){if(-1===g.indexOf(m)){console.warn("Impossible to create a full PathElement from the identifier."),!0!==n?p=void 0:p.splice(0,1);break}a=m}}if(p)for(let e=t.length-1;e>=0;e--)p.push(t[e]);m=e}else p&&p.push(a)}return this._errorManager.cleanContext(arguments),p}decodeGlobalIdToViewObjects(e,t,i,r,a){let s;this._errorManager.addContext({name:"decodeGlobalIdToViewObjects",arguments:arguments});const n=this.decodeGlobalId({Node:e,Id:i,State:r,isOptimizedPath:a,namespace:this.getNameSpace(t)});if(void 0!==n){s=[];let e=null;for(const i of n){if(void 0===(e=i.getAssociatedViewElt(t))){s=void 0;break}s.push(e)}}return this._errorManager.cleanContext(arguments),s}getErrorManager(){return Object.keys(this._errorManager).length?this._errorManager:(this._errorManager=new r,this._errorManager)}isEmpty(){for(const e of this._nameSpaces)if(!e.isEmpty())return!1;return!0}}});