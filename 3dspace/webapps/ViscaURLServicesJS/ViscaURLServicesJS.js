define("DS/ViscaURLServicesJS/VisuRepServices",["DS/WAFData/WAFData"],function(e){"use strict";var t=function(){};function r(e,t){var r="&"+t+"=",i=e.indexOf(r);if(!(i<0)){var n=e.indexOf("&",i+r.length);if(!(n<0))return e.substring(i+r.length,n)}}t.RepType=Object.freeze({AV1:"av1",RR:"rr",PR:"pr"});t.prototype.GetFallbackUrl=function(e,t){if("string"==typeof e){var i=r(e,"id");if("string"==typeof i){var n=r(e,"f"),o=r(e,"fmt");if("object"==typeof t&&"string"==typeof t.spaceUrl&&"string"==typeof n&&"string"==typeof o)return t.spaceUrl+"/resources/fcsservices/fcs/mediaURL?boid="+i+"&format="+o+"&filename="+n;var s=r(e,"type"),a=r(e,"e");if("string"==typeof s&&!isNaN(parseInt(a))){return e.replace("&type="+s,"&type=av")}}}};return t.prototype.GetStaticUrls=function(i,n,o){if("object"==typeof i&&"object"==typeof n&&Array.isArray(o)){var s=[],a=[],l="string"==typeof i.viscaUrl,f=void 0,u="function"==typeof i.onCompleteCB,p=[];o.forEach(function(e){if("string"==typeof e)s.push(e);else if("object"==typeof e){if(l){if(void 0===f){var o=(f=i.viscaUrl.toLowerCase()).lastIndexOf(":");o>f.indexOf(":")&&(f=f.substring(0,o))}if("string"==typeof e.currentUrl&&e.currentUrl.toLowerCase().includes(f)){var u={};if(u.boid=r(e.currentUrl,"id"),"string"==typeof u.boid){if(u.filename=r(e.currentUrl,"f"),u.format=r(e.currentUrl,"fmt"),u.version=r(e.currentUrl,"v"),n.type===t.RepType.AV1&&"string"==typeof i.spaceUrl&&"string"==typeof u.filename&&"string"==typeof u.format)return u.resourceId=e.resourceId,u.url=i.spaceUrl+"/resources/fcsservices/fcs/mediaURL?boid="+u.boid+"&format="+u.format+"&filename="+u.filename,void p.push(u);var c=r(e.currentUrl,"type"),y=r(e.currentUrl,"e");if(u.element=parseInt(y),"string"==typeof c&&!isNaN(u.element)){return u.resourceId=e.resourceId,u.url=e.currentUrl.replace("&type="+c,"&type="+n.type.substring(0,2)),void p.push(u)}}}}"string"==typeof e.resourceId?s.push(e.resourceId):"string"==typeof e.boid&&(Array.isArray(e.elements)?a.push(e):s.push(e.boid))}}),p.length>0&&u&&i.onCompleteCB(p);var c=function(){if(0!==s.length){var r={async:u,timeout:i.timeout,authentication:"passport",proxy:"passport",method:"POST",data:JSON.stringify({label:"VisuRepServices-"+i.user+"-"+Date.now(),physicalid:s,select_predicate:["physicalid","cgrwms","3dthbwms"],select_file:[n.type==t.RepType.AV1?"cgr":"thumbnail_3d"],fcs_url_mode:"REDIRECT"}),headers:{"Content-type":"application/json",SecurityToken:i.user+"|"+i.securityCtx+"|preferred",SecurityContext:i.securityCtx},onComplete:function(e,t){if("string"==typeof e&&0!==e.length){var r=JSON.parse(e);if("object"==typeof r&&Array.isArray(r.results)){var n=[];r.results.forEach(function(e){if(Array.isArray(e.attributes)){var t={};e.attributes.forEach(function(e){"physicalid"==e.name?t.boid=e.value:"cgr"==e.name||"thumbnail_3d"==e.name?t.url=e.value:"string"==typeof t.version||"cgrwms"!=e.name&&"3dthbwms"!=e.name||(t.version=e.value)}),"string"==typeof t.boid&&"string"==typeof t.url&&n.push(t)}}),u?i.onCompleteCB(n,i.spaceUrl):p=p.concat(n)}else i.onFailureCB()}else i.onFailureCB()},onFailure:function(){i.onFailureCB&&i.onFailureCB()},onPassportError:function(){i.onFailureCB&&i.onFailureCB()},onTimeout:function(){i.onFailureCB&&i.onFailureCB()}};e.authenticatedRequest(i.spaceUrl+"/cvservlet/fetch/v2?tenant="+i.tenant,r)}};if(l&&(n.type!=t.RepType.AV1||a.length>0)){var y=[];n.type!=t.RepType.AV1&&s.forEach(function(e){y.push({source:n.source,boid:e,type:n.type})}),a.forEach(function(e){y.push({source:n.source,boid:e.boid,elements:e.elements,type:n.type})});var d={async:u,timeout:i.timeout,authentication:"passport",proxy:"passport",method:"POST",data:JSON.stringify({files:y}),headers:{"Content-type":"application/json",SecurityContext:i.securityCtx},onComplete:function(e,r){if("string"==typeof e&&0!==e.length){var o=JSON.parse(e);if("object"==typeof o&&Array.isArray(o.urls)){var a=[];o.urls.forEach(function(e){a.push({boid:e.boid,url:e.url,version:e.version})}),a.length>0?(u?i.onCompleteCB(a,i.viscaUrl):p=p.concat(a),n.type==t.RepType.AV1&&s.length>0&&c()):c()}else c()}else c()},onFailure:function(){c()},onPassportError:function(){c()},onTimeout:function(){c()}};e.authenticatedRequest(i.viscaUrl+"/api/v1/urls",d)}else c();return u?void 0:p}i.onFailureCB&&i.onFailureCB()},t}),define("DS/ViscaURLServicesJS/ViscaURLServices",function(){"use strict";var e=function(){};function t(e){for(var t=e.split("&"),r={},i=0;i<t.length;i++){var n=t[i].split("=");"s"===n[0]?r.source=n[1]:"t"===n[0]?r.tenant=n[1]:"id"===n[0]?r.boid=n[1]:"f"===n[0]?r.filename=n[1]:"fmt"===n[0]?r.format=n[1]:"e"===n[0]?r.element=Number(n[1]):"v"===n[0]?r.version=n[1]:"ts"===n[0]?r.timestamp=n[1]:"type"===n[0]?r.type=n[1]:"sgn"===n[0]&&(r.signature=n[1])}return r}function r(e){if("Range"==e.name&&0==e.value.indexOf("bytes=")){var t=e.value.indexOf("-");if(t>0){const n="bytes=".length;var r=e.value.substring(n,t),i=e.value.substring(t+1);return Number(i)-Number(r)}}return-1}function i(e){var t=e;if("number"!=typeof t.element)return t;if(t.elements=[t.element],delete t.element,"number"!=typeof t.index)return t;if(t.indices=[t.index],delete t.index,Array.isArray(t.headers)&&1==t.headers.length){var i=r(t.headers[0]);i>=0&&(t.contentSize=i)}return t}return e.prototype.CreateURLsRequestBody=function(e,t){if(void 0!==e&&0!==e.length){for(var r={},i={files:[]},n=0;n<e.length;n++){if(void 0===e[n])return;i.files.push(e[n])}return"object"==typeof t&&"boolean"==typeof t.fallback&&t.fallback&&(i.fallback=!0),r.body=JSON.stringify(i),r}},e.prototype.IsURLFetchCompatible=function(e){return!e.toLowerCase().includes("&type=av")},e.prototype.CreateBatchURLAndBody=function(e,r){if(void 0!==e&&0!==e.length){for(var i={},n={files:[]},o=0;o<e.length;o++){if(void 0===e[o])return;var s=e[o].toLowerCase().search("api/v1/rep?");if(-1===s)return;0===o&&(i.url=e[o].substring(0,s)+"api/v1/reps");var a=t(e[o].substring(s+"api/v1/rep?".length,e[o].length));n.files.push(a)}return"object"==typeof r&&"boolean"==typeof r.allowPartial&&r.allowPartial&&(n.allowPartial=!0),"object"==typeof r&&"boolean"==typeof r.fallback&&r.fallback&&(n.fallback=!0),"object"==typeof r&&"string"==typeof r.emptyFallback&&r.emptyFallback.length>0&&(n.emptyFallback=emptyFallback),"object"==typeof r&&"boolean"==typeof r.checkVersion&&r.checkVersion&&(n.checkVersion=!0),i.body=JSON.stringify(n),i}},e.prototype.MergeBatchAnswer=function(e,t){if("object"==typeof e&&Array.isArray(e.files)){for(var n="number"==typeof t?t:0,o=[],s=0;s<e.files.length;s++){var a=e.files[s];if("object"==typeof a&&"string"==typeof a.url&&(Array.isArray(o[a.url])||(o[a.url]=[]),a.index=s,o[a.url].push(a),o[a.url][0].source!=a.source||o[a.url][0].boid!=a.boid))return}var l={files:[]};for(var f in o)u(o[f]);return l}function u(e){if(!Array.isArray(e)||0==e.length)return;const t="bytes=".length;for(var o=i(e[0]),s=1;s<e.length;s++)if("number"!=typeof o.contentSize||0!=n&&o.contentSize>=n)l.files.push(o),o=i(e[s]);else if(Array.isArray(e[s].headers)&&1==e[s].headers.length){var a=r(e[s].headers[0]);a<0?l.files.push(e[s]):0!=n&&o.contentSize+a>n?(l.files.push(o),o=i(e[s])):(o.contentSize+=a,o.elements.push(e[s].element),o.indices.push(e[s].index),o.headers[0].value+=","+e[s].headers[0].value.substring(t))}else l.files.push(e[s]);l.files.push(o)}},e.prototype.CreateFetchURLAndBody=function(e,r,i){if(void 0!==e&&0!==e.length&&void 0!==r&&r.length===e.length){for(var n={},o={files:[]},s=0;s<e.length;s++){if(void 0===e[s])return;var a=e[s].toLowerCase().search("api/v1/rep?");if(-1===a)return;0===s&&(n.url=e[s].substring(0,a)+"api/v1/fetch");var l=t(e[s].substring(a+"api/v1/rep?".length,e[s].length));l.correlationID=r[s],o.files.push(l)}return"object"==typeof i&&"number"==typeof i.splitTargetedSize&&i.splitTargetedSize>0&&(o.splitTargetedSize=i.splitTargetedSize),"object"==typeof i&&"boolean"==typeof i.allowPartial&&i.allowPartial&&(o.allowPartial=!0),"object"==typeof i&&"boolean"==typeof i.checkVersion&&i.checkVersion&&(o.checkVersion=!0),n.body=JSON.stringify(o),n}},e});