define("DS/CATRgdApp/commands/ExportTemplateCmd",["require","exports","DS/ApplicationFrame/Command","DS/CATRgdImportExport/Export"],function(e,t,n,i){"use strict";return n.extend({execute:function(){let e=[];const t=this.libraryManager.modelManager.getModel();t&&(e=t.getSelectedNodes());const n=e.map(e=>e.options.grid.id);i.download(n,this.libraryManager.webClientOptions)}})}),define("DS/CATRgdApp/UI/LegacyEntryPoints",["require","exports","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/TemplateServices","DS/CATRgnWidgetCommons/interfaces/Facade","DS/RGNServices/Alert"],function(e,t,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.launchTemplateEditor=void 0,t.launchTemplateEditor=async function(e,t,r){try{const l=document.querySelector("#templateEditorApp"),s=new o.WebClientFactory(r,t),d=await n.service3DSpace(s),c=(new n.HeadersBuilder).createHeader(s.getSecurityContext()),p=await i.getI18N(d.url,c);window.I18n=p;const m=new com.dassault_systemes.catrgn.reportUIModeller.gwt.diagram.ModellerEntryPoint(e);l&&(l.modeller=m),m.setUrl(d.url),m.setContext(s.getSecurityContext()),m.load()}catch(e){console.error(e),a.error("Cannot load I18n",e)}}}),define("DS/CATRgdApp/commands/ImportTemplateCmd",["require","exports","DS/ApplicationFrame/Command","UWA/Core","DS/CATRgdImportExport/Import","DS/CATRgdImportExport/ImportUI","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/CATRgdApp/assets/nls/CATRgdApp"],function(e,t,n,i,o,a,r,l,s){"use strict";return n.extend({execute:function(){const e=this,t=new i.Element("div",{class:"rgd-import-container"}),n=new a;n.buildUI(t);const d=new r({title:s.get("commands.import"),content:t,buttons:{Ok:new l({onClick:async()=>{var t,i;const a=n.getImportData();if(a)try{const r=await o.process(a,n.getGlobalOptions(),e.libraryManager.webClientOptions);if(r.importStatus&&r.importStatus.imported){const t=r.importStatus.imported.map(e=>e.importedId);e.libraryManager.addFromIds(t,!0)}await n.processResults(r,null!==(t=a.importSettings)&&void 0!==t?t:{}),d.close(),null===(i=e.app)||void 0===i||i.welcomePage.hideWelcomeScreen({})}catch(e){const t=document.querySelector(".errorZone");null==t||t.classList.remove("hidden");const n=null==t?void 0:t.querySelector("#errorMessage");n&&(n.innerHTML=e&&e.message||e)}else alert("No import data")}}),Cancel:new l({onClick:()=>{d.close()}})}});e.files&&(n.display(e.files),e.files=void 0);const c=e.options.fileEvent;c&&(e.options.fileEvent=void 0,n.setFile(c))}})}),define("DS/CATRgdApp/commands/RemoveTemplateCmd",["require","exports","DS/ApplicationFrame/Command","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","DS/CATRgnWidgetCommons/restClient/CommonServices"],function(e,t,n,i,o,a,r,l){"use strict";function s(e){return`<strong>${e.title}</strong> | ${l.getNLSType(e.type,this.libraryManager.widgetSettings.dictionaryLoaded)} | ${e.revision} | ${e.name}`}return n.extend({execute:function(){let e=[];const t=this,n=t.libraryManager,l=t.libraryManager.modelManager.getModel();if(l&&(e=l.getSelectedNodes()),e.length<1)return;let d=r.removeTemplatesMessage;d+="<ol>";for(const n of e)d+="<li>"+s.call(t,null==n?void 0:n.options.grid)+"</li>";d+="</ol>";const c=new i.Element("div",{class:"rgd-remove-container",html:d}),p=new o({title:r.removeTemplates,content:c,buttons:{Yes:new a({onClick:function(){n.removeNodes(e),p.close()}}),Cancel:new a({onClick:function(){p.close()}})}})}})}),define("DS/CATRgdApp/commands/DuplicateTemplateCmd",["require","exports","DS/ApplicationFrame/Command","DS/CATRgnWidgetCommons/restClient/TemplateServices","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/RGNServices/Alert"],function(e,t,n,i,o,a){"use strict";function r(e){var t;return{type:e.type,title:e.title,description:e.description,policy:e.policy,model:{data:e.model.data,compression:null!==(t=e.model.compression)&&void 0!==t?t:"gzip+b64"}}}return n.extend({execute:async function(){try{const e=this,t=e.libraryManager.getSelectedTemplates().map(e=>e.id),n=await o.service3DSpace(e.libraryManager.webClientOptions),l=await o.createHeaders(e.libraryManager.webClientOptions,!0),s=(await i.getTemplatesBulk(n,l,t)).templates.map(r),d=await i.createTemplates(n,l,s);e.libraryManager.addFromIds(d.templates.map(e=>e.id),!0)}catch(e){a.error(e)}}})}),define("DS/CATRgdApp/UI/ConfigureInputTypes",["require","exports","DS/RGNServices/WAFDataUtil","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],function(e,t,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigureInputTypes=void 0;function r(e,t){return new a({label:e,value:t,tooltip:{shortHelp:`${e} [${t}]`},grid:{value:t}})}t.ConfigureInputTypes=class{async getInfosInputTypes(e,t){var n,a;const l=await i.service3DSpace(e),s=(new i.HeadersBuilder).createHeader(e.getSecurityContext());var d;this.dataModel=await this.getInputTypes(l,s,t?"default":"user"),this.availableTypes=null===(n=this.dataModel)||void 0===n?void 0:n.availableTypes,this.elementsTree=function(e){const t=new o;t.prepareUpdate();for(const n in e){const i=r(e[n],n);t.addRoot(i)}return t.pushUpdate(),t}((d=this.availableTypes,Object.fromEntries(Object.entries(d).sort(([,e],[,t])=>e.localeCompare(t))))),this.defaultInputSelected=[],null===(a=this.dataModel)||void 0===a||a.selectedTypes.map(e=>{var t;for(const n of this.elementsTree.getRoots())n.getAttributeValue("value")===e&&(null===(t=this.defaultInputSelected)||void 0===t||t.push(n))})}getInputTypes(e,t,i){return n.authenticatedRequest("GET",`${e.url}/resources/v1/modeler/dsrgn/internal/template/settings/${i}/inputTypes`,"json",t)}putInputTypes(e,t,i,o){return n.authenticatedRequest("PUT",`${e.url}/resources/v1/modeler/dsrgn/internal/template/settings/${i}/inputTypes`,"json",t,{type:"json",payload:o})}async sendConfiguration(e,t,n){let o=await i.service3DSpace(e),a=(new i.HeadersBuilder).createHeader(e.getSecurityContext());this.putInputTypes(o,a,n?"default":"user",this.getActualConfiguration(t))}getActualConfiguration(e){const t=[];return e.map(e=>{t.push(e.getAttributeValue("value"))}),t}}}),define("DS/CATRgdApp/UI/CreateTemplate",["require","exports","UWA/Core","DS/Controls/Loader","DS/Controls/Button","DS/Controls/Expander","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/CATRgnWidgetCommons/UI/BasicUIElements","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/TemplateServices","DS/RGNServices/Alert","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","css!DS/CATRgdApp/UI/css/CreateTemplateStyle"],function(e,t,n,i,o,a,r,l,s,d,c,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTemplateUI=void 0,t.createTemplateUI=async function(e,t,g){const u={type:g.getDefaultTemplateType()};await C();const S=(e,t)=>{u[e]=t};async function C(){const C=new n.Element("div",{id:"template-form",class:"template-form-modal"}),y=await d.getTemplateTypesAndNls(e.widgetSettings.dictionaryNls,t.webClientOptions),f=(new i).inject(C),T={container:C,label:m.title,placeholder:m.title,requiredFlag:!0,onChange:e=>{S("title",e.target.dsModel.valueToCommit),""!==e.target.dsModel.valueToCommit.trim()?D.disabled=!1:D.disabled=!0}};s.InputEditor(T,"uncommittedChange");const v={container:C,label:m.description,placeholder:m.description,onChange:e=>S("description",e.target.dsModel.value)};s.TextAreaEditor(v);const w={container:C,label:m.type,elementsList:y.map(e=>e.label),onChange:e=>{var t;return S("type",null===(t=y.find(t=>e.dsModel.value==t.label))||void 0===t?void 0:t.value)},defaultValue:d.getNLSType(g.getDefaultTemplateType(),e.widgetSettings.dictionaryLoaded)};s.ComboBox(w);const h=n.createElement("div"),b={container:h,label:m.policy,elementsList:m.policyList,onChange:e=>S("policy",e.target.dsModel.value)};s.ComboBox(b);const A={container:h,label:m.name,placeholder:m.blankAutoName,onChange:e=>S("name",e.target.dsModel.value.trim())};s.InputEditor(A,"change"),new a({header:m.showMore,expandedFlag:!1,body:h}).inject(C);const D=new o({label:m.create,emphasize:"primary",disabled:!0,domId:"submitBtnTemplateID"}),I=new l({});I.elements.container.setStyle("pointer-events","none"),I.inject(g.widgetBody);const M=new r({immersiveFrame:I,title:m.newtemplate,content:C,buttons:{Yes:D,Cancel:new o({onClick:function(){M.close()}})},resizableFlag:!0,width:550});M.minHeight=320,D.getContent().addEventListener("buttonclick",()=>{!async function(n,i){i.on(m.loader);const o=t.webClientOptions,a=await d.createHeaders(o,!0);try{const r=await c.createTemplates(await d.service3DSpace(o),a,[u]);i.off(m.loader),n.destroy(),t.addFromIds(r.templates.map(e=>e.id),!0),e.welcomePage.hideWelcomeScreen({})}catch(e){if(i.off(m.loader),e.response.status.details[0].message===m.errrorResponse)return void setTimeout(()=>{p.error(m.uniqueError)},1e3);console.error(e),setTimeout(()=>{p.error(m.errorMessage)},1e3)}}(M,f)}),M.show()}return C}}),define("DS/CATRgdApp/utils/RGDConstants",["require","exports"],function(e,t){"use strict";return Object.freeze({RGD_DISPLAY_VIEW:"RGD_DisplayView",WELCOME_PAGE:"welcomePage",TEMPLATE_TILE:"tile",TEMPLATE_TABLE:"table",RGD_WELCOME_PANEL:"rgd_welcome_panel"})}),define("DS/CATRgdApp/commands/CreateTemplateCmd",["require","exports","DS/ApplicationFrame/Command","DS/CATRgdApp/UI/CreateTemplate"],function(e,t,n,i){"use strict";return n.extend({execute:function(){i.createTemplateUI(this.app,this.libraryManager,this.widgetSettings)}})}),define("DS/CATRgdApp/UI/TemplateEditorLauncher",["require","exports","UWA/Core","DS/RGNServices/Alert","DS/UIKIT/SuperModal","DS/Windows/Panel","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/TemplateServices","DS/Windows/ImmersiveFrame","DS/CATRgdApp/UI/LegacyEntryPoints"],function(e,t,n,i,o,a,r,l,s,d,c){"use strict";async function p(e,t,n){try{const o=await l.service3DSpace(n);await s.unlockTemplate(o,t,await l.createHeaders(n,!0,o.url))}catch(t){e.destroy(),console.log(t),i.error(t)}finally{e.immersiveFrame.destroy(),e.destroy()}}function m(e,t,n,i){return()=>{var a,l,s;const d=null===(a=null==e?void 0:e.elements)||void 0===a?void 0:a.container;if(!(null==d?void 0:d.querySelector('button > img[src$="I_RGN_Save.png"]'))||(null===(s=null===(l=null==d?void 0:d.querySelector('button > img[src$="I_RGN_Save.png"]'))||void 0===l?void 0:l.parentNode)||void 0===s?void 0:s.disabled))p(e,t,n);else{const a=new o({renderTo:i.widgetBody}),l="<span class='fonticon fonticon-attention'></span>"+r["editor.quit.body"];a.dialog({title:r["editor.quit.title"],body:l,buttons:[{className:"primary",value:r["editor.quit.save"],action:function(i){i.hide(),async function(e,t,n){e.elements.container.querySelector('button > img[src$="I_RGN_Save.png"]').parentNode.click(),p(e,t,n)}(e,t,n)}},{value:r["editor.quit.discard"],action:function(i){i.hide(),p(e,t,n)}},{value:r["editor.quit.cancel"],action:function(e){e.hide()}}]})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.launch=void 0,t.launch=async function(t,o,r,l){e(["DS/CodeMirror/lib/codemirror","css!DS/CodeMirror/lib/codemirror"],()=>{e(["DS/CodeMirror/addon/mode/simple","DS/CodeMirror/addon/display/autorefresh","DS/CodeMirror/addon/display/placeholder","text!CATRgnOTScript/assets/scripts/emxRGNOTSCodeMirror.js"])});const s=r.getElementById(t);let p="<iframe>";p='<div id="layout-header">',p+='<div id="layout-toolbar" class="elorn-controlbar">',p+='<div style="width: 2px"></div>',p+="</div>",p+="</div>",p+='<div id="layout-content"></div>',p+="</iframe>";const g=new n.Element("div",{id:"templateEditorApp",class:"layout",html:'<div id="layout-header"><div id="layout-toolbar" class="elorn-controlbar"><div style="width: 2px"></div></div></div><div id="layout-content"></div></iframe>'}),u=t?"Template":function(e){return null==e?void 0:e.name}(s),S=new d({});S.elements.container.setStyle("z-index","10"),S.elements.container.setStyle("pointer-events","none"),S.inject(l.widgetBody);const C=new a({title:`${u} - Editing `,identifier:"TemplateEditor_CodeMirror",immersiveFrame:S,content:g,height:70,width:130,resizableFlag:!1,collapsibleFlag:!1,snappableFlag:!1,allowedDockAreas:WUXDockAreaEnum.NoneDockArea,maximizedFlag:!0,movableFlag:!1,autoCloseFlag:!1});C.addEventListener("close",m(C,t,o,l));try{(0,c.launchTemplateEditor)(t,o.getTenant(),o.getSecurityContext())}catch(e){throw console.log(e),i.error(e),e}}}),define("DS/CATRgdApp/commands/EditTemplateCmd",["require","exports","DS/CATRgdApp/UI/TemplateEditorLauncher","DS/ApplicationFrame/Command"],function(e,t,n,i){"use strict";return i.extend({execute:async function(){var e,t,i;const o=this.libraryManager.modelManager.getModel(),a=null!==(e=null==o?void 0:o.getSelectedNodes())&&void 0!==e?e:[];if(1!=a.length)throw new Error("Multi selection not supported");const r=1==a.length?null===(t=a[0])||void 0===t?void 0:t.options.grid:void 0;n.launch(null!==(i=null==r?void 0:r.id)&&void 0!==i?i:"",this.webClientOptions,this.libraryManager.modelManager.getCollection(),this.widgetSettings)}})}),define("DS/CATRgdApp/utils/TemplateLibrary",["require","exports","DS/CATRgnWidgetCommons/restClient/TemplateServices","DS/ApplicationFrame/CommandsManager","DS/CATRgnWidgetCommons/ModelManager","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","i18n!DS/CATRgnWidgetCommons/assets/nls/CATRgnWidgetCommons","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/RGNServices/Alert","DS/CATRgnWidgetCommons/ModelElement","DS/CATRgnWidgetCommons/RecentsManager","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/LoaderManager","DS/CATRgnWidgetCommons/ListManager","DS/CATRgnWidgetCommons/TaggerProxyFilter","DS/CATRgdApp/UI/TemplateEditorLauncher"],function(e,t,n,i,o,a,r,l,s,d,c,p,m,g,u,S){"use strict";function C(e){return{...e.options,picture:`${e.service.url}/snresources/images/icons/large/iconLargeDefault.png`,imageUrl:`${e.service.url}/common/images/I_RGNReportTemplate.png`,contextualActions:["details","delete","edit","download","open"],getContextualMenu:t=>(function(e,t){return[{id:"ENOproperties",title:r.INFORMATION,type:"PushItem",icon:"info-open-in-a-new-window",action:{callback:function(){i.getCommand("ENO_Properties",t.workbenchName).begin()}}},{id:"remove",title:r.REMOVE,type:"PushItem",icon:"eye-delete",tooltip:r.REMOVE_TOOLTIP,action:{callback:function(){const n=i.getCommand("RemoveTemplateCmd",t.workbenchName);n.libraryManager=e,n.begin()}}},{id:"export",title:a.export,tooltip:a.export_tooltip,type:"PushItem",icon:"export",action:{callback:function(){const n=i.getCommand("ExportTemplateCmd",t.workbenchName);n.libraryManager=e,n.begin()}}},{id:"edit",title:a.edit,tooltip:a.edit_tooltip,type:"PushItem",icon:"open-eye",action:{callback:function(){const n=i.getCommand("EditTemplateCmd",t.workbenchName);n.libraryManager=e,n.webClientOptions=e.webClientOptions,n.widgetSettings=t.widgetSettings,n.begin()}}},{id:"duplicate",title:a.duplicate,type:"PushItem",icon:"duplicate",action:{callback:function(){const n=i.getCommand("DuplicateTemplateCmd",t.workbenchName);n.libraryManager=e,n.begin()}}},{id:"lifecycle",title:r.LIFE_CYCLE,type:"PushItem",text:"LIFE_CYCLE",icon:"collaborative-lifecycle-management",submenu:[{id:"maturityState",title:r.MATURITY,type:"PushItem",icon:"promote",action:{callback:function(){i.getCommand("Lifecycle_Maturity",t.workbenchName).begin()}}},{id:"ReviseHdr",title:r.REVISE,type:"PushItem",icon:"flow-line-add",action:{callback:function(){i.getCommand("Lifecycle_Revision",t.workbenchName).begin()}}},{id:"DeleteHdr",title:r.DELETE,type:"PushItem",icon:"doc-delete",action:{callback:async function(){const o=e.getModel().getSelectedNodes().map(e=>e.options.grid.id),r=(new l.HeadersBuilder).createHeader(e.webClientOptions.getSecurityContext()),d=await n.areTemplatesUsed(e.service,r,o);if(-1==Object.values(d).indexOf(!0))i.getCommand("Lifecycle_Delete",t.workbenchName).begin();else{let t="";Object.keys(d).forEach(n=>{const i=e.modelManager.getCollection().getElementById(n);!0===d[n]&&(null==i?void 0:i.title)&&(0!==t.length&&(t+=", "),t+=`${i.title}`)}),s.error(a.templateUsed.replace("${0}",t))}}}},{id:"HistoryHdr",title:r.REVISIONS,type:"PushItem",icon:"flow-tree-ordered",action:{callback:function(){i.getCommand("Lifecycle_History",t.workbenchName).begin()}}}]}]})(e,t)}}async function y(e,t){const n=new p.WidgetClientFactory,i=await l.service3DSpace(n);return{metaType:d.MetaType.Template,id:t.id,type:t.type,name:t.name,title:t.title,description:t.description,current:t.current,revision:t.revision,owner:t.owner,ownerFullName:await l.getPersonFullName(i,(new l.HeadersBuilder).createHeader(n.getSecurityContext()),t.owner),model:t.model,openTemplateEditor:()=>{var t,n,i;const o=e.modelManager.getModel(),a=null!==(t=null==o?void 0:o.getSelectedNodes())&&void 0!==t?t:[];if(1!=a.length)throw new Error("Multi selection not supported");const r=1==a.length?null===(n=a[0])||void 0===n?void 0:n.options.grid:void 0;S.launch(null!==(i=null==r?void 0:r.id)&&void 0!==i?i:"",e.webClientOptions,e.modelManager.getCollection(),e.widgetSettings)}}}function f(e,t){return(null==t?void 0:t.indexOf(e.type))>=0}return class{constructor(e,t,n,i){this.options=e,this.modelManager=new o(g.RGD_TEMPLATES,new c.RecentsManager("RGD",t),t,i),this.modelManager.setTaggerProxyFilter(new u.TaggerProxyFilter({model:this.modelManager.model,widgetSettings:i},t)),this.webClientOptions=t,this.service=n,this.widgetSettings=i,this.modelManager.getModel().setFilterModel({tree:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:""},operator:"or",condition2:{type:"contains",filter:""}}},name:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:""},operator:"or",condition2:{type:"contains",filter:""}}},dispType:{filterId:"set"},ownerFullName:{filterId:"set"},revision:{filterId:"set"},current:{filterId:"set"}})}getSelectedTemplates(){return this.modelManager.getModel().getSelectedNodes().map(e=>e.options.grid)}getModel(){return this.modelManager.getModel()}async addTemplates(e,t){var n;await this.modelManager.addToModel(e,C(this),t,this.widgetSettings.dictionaryNls),null===(n=this.modelManager.tagger)||void 0===n||n.addDataToProxy(e)}removeNodes(e){this.modelManager.removeFromModel(e)}async addFromIds(e,t){const i=new m(this.widgetSettings.widgetBody.getElement("#appMain"));i.displayLoader(a.loader);try{e=e.filter(e=>-1===this.getModel().getRoots().map(e=>{var t;return null===(t=e.getAttributeValue)||void 0===t?void 0:t.call(e,"id")}).indexOf(e));const o=10,a=[];for(let t=0;t<e.length;t+=o)a.push(e.slice(t,t+o));const r=(new l.HeadersBuilder).createHeader(this.webClientOptions.getSecurityContext());for(const e of a){const i=await n.getTemplatesBulk(this.service,r,e);if(await this.addTemplates(await Promise.all(i.templates.filter(async e=>f(e,await this.widgetSettings.acceptedTypes)).map(e=>y(this,e))),t),l.isBulkGetPartialSucessStatus(i.status)){const e=i.status.details.map(e=>`${e.message}: ${e.reference.id}`).concat("\n");s.info(e)}}}catch(e){console.log(e),s.error(e)}finally{i.hideLoader()}}}}),define("DS/CATRgdApp/utils/RgdWidgetSettings",["require","exports","DS/CATRgnWidgetCommons/RgnWidgetSettings","DS/CATRgnWidgetCommons/restClient/DictionnaryServices","DS/CATRgdApp/utils/RGDConstants","DS/RGNServices/Alert"],function(e,t,n,i,o,a){"use strict";return class extends n{constructor(e){super(),this.acceptedTypes=async function(e){try{const t=await i.getTypeInfo(["Report Model"],e);return Object.keys(t)}catch(e){return a.error(e),["Report Model"]}}(e)}getDisplaySettings(){return this.widget.getValue(o.RGD_DISPLAY_VIEW)}setDisplaySettings(e){this.widget.setValue(o.RGD_DISPLAY_VIEW,e)}getDefaultTemplateType(){var e,t;return null!==(t=null===(e=this.getPreference("xDefaultTemplateType"))||void 0===e?void 0:e.value)&&void 0!==t?t:"Report Model"}}}),define("DS/CATRgdApp/UI/RGDMainApp",["require","exports","DS/DataDragAndDrop/DataDragAndDrop","UWA/Core","DS/ApplicationFrame/CommandsManager","DS/CATRgdApp/utils/TemplateLibrary","DS/CATRgnWidgetCommons/DisplayManager","DS/RGNServices/Alert","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/Controls/TooltipModel"],function(e,t,n,i,o,a,r,l,s,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildUI=void 0,t.buildUI=function(e,t,p){const m=new i.Element("div",{class:"rgn-droppable-area",id:"displayer-container",styles:{position:"relative",height:"calc(100vh - 38px)",width:"100%"}});return n.droppable(m,{drop:(t,n,i)=>(async function(e,t,n,i){var a,r,d,c;try{if(t.length>0){const n=[],i=JSON.parse(t);if(i.data&&i.data.items)for(const t of i.data.items){const i=t.objectType;(await(null!==(a=e.widgetSettings.acceptedTypes)&&void 0!==a?a:"")).includes(i)&&n.push(t.objectId)}else if(i.objects)for(const t of i.objects){const i=t.type;(await(null!==(r=e.widgetSettings.acceptedTypes)&&void 0!==r?r:"")).includes(i)&&n.push(t.oid)}if(0===n.length)throw new Error(s.INVALID_DATA);e.libraryManager.addFromIds(n,!0).catch(e=>{console.error(e)})}else if(i.dataTransfer){let t;if(!(t=i.dataTransfer.items?null===(d=i.dataTransfer.items[0])||void 0===d?void 0:d.getAsFile():null===(c=i.dataTransfer.files)||void 0===c?void 0:c.item(0))||"application/json"!==t.type)throw new Error(s.INVALID_FILE_FORMAT);{const t=o.getCommand("ImportTemplateCmd","CATRgdWebApp");t.options.fileEvent=i,t.app=e,t.welcomePage=e.welcomePage,t.libraryManager=e.libraryManager,t.begin()}}}catch(e){l.error(e||"Invalid data")}finally{n.classList.remove("ondragover")}})(e,t,n,i)}),e.libraryManager=new a(e.context,t,p,e.widgetSettings),e.displayer=new r.QueryDisplayer({...e.context,model:e.libraryManager.modelManager.getModel(),placeholderText:s.placeholder,placeholderButtonLabel:s.placeholderButtonLabel,placeholderPrecond:{precond:'type:"Report Model"',multiSel:!0,mode:"furtive"},onFederatedSearchComplete:t=>(async function(e,t){const n=t.map(e=>e.id);e.libraryManager.addFromIds(n,!0).catch(e=>{l.error(e)})})(e,t),onFederatedSearchCancel:()=>(async function(){})(),getCellTooltip:t=>{var n;const o=r.getDataIndex(t),a=null===(n=t.nodeModel)||void 0===n?void 0:n.options.grid,l=null==a?void 0:a.model.inputs;let p;if(!t.nodeModel)return e.displayer.tableView.getDataGrid().getCellDefaultTooltip(t);switch(o){case"openTemplateEditor":return new c({shortHelp:s.openTemplateEditor,allowUnsafeHTMLShortHelp:!0});case"tree":if(p=i.createElement("div",{styles:{width:"auto",height:"auto",margin:"0.1em"}}),l&&e.widgetSettings.dictionaryLoaded){const t=i.createElement("p",{class:"inputInfos"}).inject(p);return i.createElement("span",{html:`${s.parameters}:`,class:"bold"}).inject(t),l.forEach(async n=>{i.createElement("br").inject(t),i.createElement("span",{html:`  -${n.name} | ${d.getNLSTypeFromInput(n,e.widgetSettings.dictionaryLoaded)}`}).inject(t)}),new c({shortHelp:p,allowUnsafeHTMLShortHelp:!0})}}},columns:[{text:s.title,description:s.title,dataIndex:"tree",pinned:"left",alwaysVisibleFlag:!0,editionPolicy:"EditionOnDoubleClick",editableFlag:!0,getCellValue:e=>{var t,n;return null===(n=null===(t=e.nodeModel)||void 0===t?void 0:t.getAttributeValue)||void 0===n?void 0:n.call(t,"title")}},{text:s.action,description:s.action,dataIndex:"openTemplateEditor",editableFlag:!1,pinned:"left",typeRepresentation:"functionIcon",showTextFlag:!1,alignment:"center",width:50,editionPolicy:"EditionInPlace",getCellSemantics:function(){return{icon:{iconName:"open-eye wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},{text:s.description,description:s.description,dataIndex:"description",editionPolicy:"EditionOnDoubleClick",editableFlag:!0},{text:s.name,description:s.name,dataIndex:"name",width:100},{text:s.revision,description:s.revision,dataIndex:"revision",typeRepresentation:"url",width:40,getCellValue:t=>{var n,i;return{label:null===(n=t.nodeModel)||void 0===n?void 0:n.options.grid.revision,column:"maturity",id:null===(i=t.nodeModel)||void 0===i?void 0:i.options.grid,func:function(){o.getCommand("Lifecycle_Revision",e.context.workbenchName).begin()}}}},{text:s.type,description:s.type,dataIndex:"dispType",width:110},{text:s.maturity_state,description:s.maturity_state,dataIndex:"current",typeRepresentation:"url",width:90,getCellValue:t=>{var n,i;return{label:s[`lifeCycle.${null===(n=t.nodeModel)||void 0===n?void 0:n.options.grid.current.toUpperCase()}`],column:"maturity",id:null===(i=t.nodeModel)||void 0===i?void 0:i.options.grid,func:function(){o.getCommand("Lifecycle_Maturity",e.context.workbenchName).begin()}}}},{text:s.owner,description:s.owner,dataIndex:"ownerFullName"}]},e.widgetSettings),e.displayer.build(m),e.displayer.onCellDoubleClick(()=>{const n=o.getCommand("EditTemplateCmd",e.context.workbenchName);n.libraryManager=e.libraryManager,n.webClientOptions=t,n.widgetSettings=e.widgetSettings,n.begin()}),m}}),define("DS/CATRgdApp/UI/RGDTopActionBar",["require","exports","DS/Controls/TooltipModel","DS/ApplicationFrame/CommandsManager","DS/UIKIT/Iconbar","UWA/Core","DS/RGNServices/FederatedSearch","DS/RGNServices/Alert","DS/CATRgdApp/utils/RGDConstants"],function(e,t,n,i,o,a,r,l,s){"use strict";function d(e,t,d,p){a.createElement("div",{id:"table-title",class:"table-title",styles:{"font-weight":"bold","font-size":"large","margin-left":"15px"}}).inject(d),function(e){e.menu.items.forEach(e=>{var t;const i=e,o=i.elements.container;o.tooltipInfos=new n({allowUnsafeHTMLLongHelp:!0,mouseRelativePosition:!1,position:"bottom"}),o.tooltipInfos.loadFromHelpRscFile("CATRgdApp/help",null!==(t=e.name)&&void 0!==t?t:"")})}(new o({renderTo:d,items:[{name:"Home",fonticon:"home",text:"",handler(){p.widgetSettings.setDisplaySettings(s.WELCOME_PAGE),e.welcomePage.showWelcomeScreen();const t=document.getElementById(s.RGD_WELCOME_PANEL);t&&(t.style.display="none")}},{name:"CreateTemplate",fonticon:"new-create",text:"",handler(){const n=i.getCommand("CreateTemplateCmd",t.workbenchName);n&&(n.app=p,n.libraryManager=e.libraryManager,n.widgetSettings=p.widgetSettings,n.begin())}},{name:"InsertTemplates",fonticon:"search",text:"",handler(){r.search({precond:'type:"Report Model"',multiSel:!0,mode:"furtive"},t=>(async function(e,t){const n=t.map(e=>e.id);e.addFromIds(n,!0).catch(e=>{l.error(e)})})(e.libraryManager,t),c)}},{name:"ImportTemplates",fonticon:"database-import",text:"",handler(){const n=i.getCommand("ImportTemplateCmd",t.workbenchName);n.app=p,n.libraryManager=e.libraryManager,n.begin()}}]}))}async function c(){}return class{constructor(e,t){this.libraryManager=t.libraryManager,this.welcomePage=t.welcomePage,d(this,t.context,e,t)}}}),define("DS/CATRgdApp/CATRgdWelcomePage",["require","exports","UWA/Core","DS/WelcomeScreenView/WelcomeScreen","DS/WelcomeScreenView/WelcomeScreenButtonController","DS/WelcomeScreenView/WelcomeScreenMRUController","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/RGNServices/Alert","DS/RGNServices/FederatedSearch","i18n!DS/CATRgdApp/assets/nls/RGDWelcomePage","DS/WebUAUtils/WebUAUtils","DS/CATRgdApp/utils/RGDConstants","DS/CATRgnWidgetCommons/ListManager","DS/CATRgnWidgetCommons/RecentsManager","DS/CATRgnWidgetCommons/ModelElement"],function(e,t,n,i,o,a,r,l,s,d,c,p,m,g,u,S){"use strict";function C(e,t,n){t.setMRU({items:n,controller:new a({simpleHit:!0,onHit(t){!async function(e,t){await e.templateLibrary.addFromIds([t.id],!0),e.hideWelcomeScreen({})}(e,t)}})})}async function y(e,t){try{C(e,t,[]);const n="RGD",i=[S.MetaType.Template],{withFacets:o,withoutFacets:a}=await new u.RecentsManager(n,e.webClientOptions).loadItemsWithFacets(i);a.length>1&&console.warn(`Cannot load details for ${n} recents`,a),C(e,t,o.map(e=>({id:e.id,title:e.title,modified:e.modified,image:function(e){switch(e){case S.MetaType.Template:return r.getWebappsAssetUrl("CATRgdApp","images/ReportTemplate160x120.png");default:throw new Error("Unexpected recent type")}}(e.kind),custom:{tooltip:[{key:"Type",value:e.dispType}]}})))}catch(e){console.error("Failed to load recents",e),s.error("Failed to load recents")}}function f(e,t){return{items:[{id:"NewTemplate",i18n:{title:c.get("WelcomeScreen.Buttons.New")},icon:"new-create",controller:new o({onAction:async()=>{try{const t=l.getCommand("CreateTemplateCmd","CATRgdWebApp");t.app=e.app,t.libraryManager=e.templateLibrary,t.widgetSettings=e.widgetSettings,t.begin()}catch(e){throw console.error(e),e}}})},{id:"OpenTemplate",i18n:{title:c.get("WelcomeScreen.Buttons.Open")},icon:"folder-open",controller:new o({onAction:async()=>{d.search({precond:'flattenedtaxonomies:"types/Report Model"',multiSel:!0,mode:"furtive"},t=>(async function(e,t){if(n.is(t,"array")&&t.length>0){const n=t.map(e=>e.id);e.templateLibrary.addFromIds(n,!0),e.hideWelcomeScreen({})}})(e,t),T)}})},{id:"ImportTemplates",i18n:{title:c.get("WelcomeScreen.Buttons.ImportTemplates")},icon:"database-import",controller:new o({onAction:async()=>{try{const t=l.getCommand("ImportTemplateCmd",e.context.workbenchName);t.libraryManager=e.templateLibrary,t.app=e.app,t.welcomePage=e,t.begin()}catch(e){throw console.error(e),e}}})},{id:"MyTemplates",i18n:{title:c.get("WelcomeScreen.Buttons.Templates")},icon:"view-list",controller:new o({onAction:async()=>{try{e.hideWelcomeScreen({})}catch(e){throw console.error(e),e}}})},{id:"configRGD",i18n:{title:c.get("WelcomeScreen.Buttons.Config")},icon:"tools",controller:new o({onAction:async()=>{try{const n=l.getCommand("ConfigureAppCmd",e.context.workbenchName);n.libraryManager=e.app.libraryManager,n.isAdmin=t,n.widgetSettings=e.widgetSettings,n.begin()}catch(e){throw console.error(e),e}}})}]}}async function T(){}t.setMRU=void 0;return class{constructor(e,t){this.app=e,this.webClientOptions=t,this.templateLibrary=e.libraryManager,this.widgetSettings=e.widgetSettings,this.context=e.context}async createContainer(){const{widgetSettings:e,app:t}=this,n=(await e.getCredentials()).startsWith("VPLMAdmin");return this.welcomePageContainer=new i({title:c.get("WelcomeScreen.Title"),subtitle:" ",background:r.getWebappsAssetUrl("CATRgdApp","images/CATRTW_AP_LandingPage.jpg"),linksCategories:[{id:"ContentAndKnowledge",i18n:{title:c.get("WelcomeScreen.linksCategories.ContentAndKnowledge")},links:[{id:"UserAssistance",i18n:{title:c.get("WelcomeScreen.ContentAndKnowledge.linkText")},icon:"i-question",url:p.getHelpFullPath("CATRtwUserMap/CATRtw-c-ov.htm")},{id:"WhatsNew",i18n:{title:c.get("WelcomeScreen.WhatsNew.linkText")},icon:"i-question",url:p.getEmbeddedHelpFullPath("WNApps/CATRTW_AP-index.html")}]},{id:"SocialNetworks",i18n:{title:c.get("WelcomeScreen.linksCategories.SocialNetworks")},links:[{id:"Communities",i18n:{title:c.get("WelcomeScreen.SocialNetworks.linkText")},icon:"topbar-users",url:"https://r1132100503382-eu1-3dswym.3dexperience.3ds.com/#community:6"}]}],buttons:f(this,n),dragAndDrop:{callbacks:{onDragEnter:()=>Promise.resolve(),onDrop:e=>{const n=e.dataTransfer.getData("text")||e.dataTransfer.getData("text/searchitems");try{if(n.length>0){const e=JSON.parse(n);if(Object.values(e.data.items).every(e=>"Report Model"===e.objectType)){const t=e.data.items.map(e=>e.objectId);this.hideWelcomeScreen({templateIds:t})}}else if(e.dataTransfer.files){const n=l.getCommand("ImportTemplateCmd",t.context.workbenchName);n.welcomePage=this.welcomePageContainer,n.libraryManager=t.libraryManager,n.files=e.dataTransfer.files,n.app=t,n.begin()}}catch(e){s.error(e||"Invalid data")}}}}}),await y(this,this.welcomePageContainer),this.welcomePageContainer}showWelcomeScreen(){const{welcomePageContainer:e}=this;e&&(e.show(),y(this,e))}async hideWelcomeScreen(e){var t;const{widgetSettings:n,templateLibrary:i}=this;n.setDisplaySettings(m.TEMPLATE_TABLE),this.app.displayer.tableViewCtnr.show(),this.app.displayer.tileViewCtnr.hide(),null===(t=this.welcomePageContainer)||void 0===t||t.hide();const o=document.getElementById(m.RGD_WELCOME_PANEL);o&&(o.style.display="block"),i.modelManager.getModel().getRoots().length||(null==e.templateIds&&(e.templateIds=await n.listManager.getList(g.RGD_TEMPLATES,n)),i.addFromIds(e.templateIds,!1))}}}),define("DS/CATRgdApp/CATRgdApp",["require","exports","module","DS/Logger/Logger","DS/ApplicationFrame/ActionBar","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/LifecycleCmd/MessageMediator","DS/PADUtils/PADContext","DS/PADUtils/PADCommandProxy","UWA/Core","DS/CATRgdApp/UI/RGDMainApp","DS/CATRgdApp/UI/RGDTopActionBar","DS/RGNServices/FederatedSearch","DS/CATRgdApp/CATRgdWelcomePage","DS/CATRgnWidgetCommons/interfaces/Facade","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgdApp/utils/RGDConstants","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","DS/CATRgnWidgetCommons/restClient/TemplateServices","DS/CATRgdApp/UI/TemplateEditorLauncher","DS/CATRgdApp/utils/RgdWidgetSettings","DS/WebUAUtils/WebUAUtils","DS/CATRgnWidgetCommons/LoaderManager"],function(e,t,n,i,o,a,r,l,s,d,c,p,m,g,u,S,C,y,f,T,v,w,h){"use strict";const b=i.getLogger(n),A=window.document;async function D(e){const t=d.createElement("div",{id:"appMain",class:"appMain",styles:{width:"auto",height:"100%",position:"inherit"}}),n=new h(t);n.displayLoader(y.loader);try{const i=new u.WidgetClientFactory;e.context={workbenchName:"CATRgdWebApp",workbenchModule:"CATRgdApp"};const m=await S.service3DSpace(i);e.widgetSettings.widgetBody.empty(),await Promise.all([async function(e){r.addEvent("onModification",t=>{const n=e.libraryManager.getModel();t.deleted.length>0&&t.deleted.forEach(e=>{const t=n.getRoots().find(t=>t.options.grid.id===e.physicalid);t&&n.removeRoot(t)});t.created.length>0&&t.created.forEach(t=>{e.libraryManager.addFromIds([t.physicalid],!0)});t.modified.length>0&&t.modified.forEach(e=>{if("Promote"===e.operation){const t=n.getRoots().find(t=>t.options.grid.id===e.physicalid);t&&(null==t||t.updateOptions({grid:{current:e.state}}))}})})}(e),async function(e,t){a.addCredentialPreferenceToWidget({usePreferredCredentials:!0},1);const n={label:y.templateTypePref,name:"xDefaultTemplateType",options:[],type:"list",defaultValue:"Report Model"};n.options=await S.getTemplateTypesAndNls(t.dictionaryNls,e),t.addPreference(n)}(i,e.widgetSettings),async function(e,t,n,i){var a,r,s,m,u,S,y,f,v,h;t.inject(e.widgetSettings.widgetBody);const b=function(e){return d.createElement("div",{id:C.RGD_WELCOME_PANEL,class:C.RGD_WELCOME_PANEL,styles:{height:"100%",width:"100%"}}).inject(e)}(t),D=c.buildUI(e,n,i),I=new d.Element("div",{id:"topActionBar",class:"rgd-top-iconbar",styles:{display:"flex","justify-content":"space-between","align-items":"center"}}).inject(b);D.inject(b),e.welcomePage=new g(e,n);const M=await e.welcomePage.createContainer();new p(I,e),t.appendChild(M.getDOM());const R=A.getElementById(C.RGD_WELCOME_PANEL);R&&(R.style.display="none");const E=e.widgetSettings.getDisplaySettings();E&&E!==C.WELCOME_PAGE&&(e.welcomePage.hideWelcomeScreen({}),e.displayer.switchView("table"));(null===(r=(a=e.widgetSettings).getValue)||void 0===r?void 0:r.call(a,"templateToShow"))&&(e.libraryManager.addFromIds([null===(m=(s=e.widgetSettings).getValue)||void 0===m?void 0:m.call(s,"templateToShow")],!0),e.welcomePage.hideWelcomeScreen({}),T.launch(null===(S=(u=e.widgetSettings).getValue)||void 0===S?void 0:S.call(u,"templateToShow"),n,e.libraryManager.modelManager.getCollection(),e.widgetSettings));if(null===(f=(y=e.widgetSettings).getValue)||void 0===f?void 0:f.call(y,"X3DContentId")){const t=JSON.parse(null===(h=(v=e.widgetSettings).getValue)||void 0===h?void 0:h.call(v,"X3DContentId"));e.libraryManager.addFromIds(function(e){const t=[],n=["Specification Report Template","Report Model"];return e.data.items.filter(e=>n.indexOf(e.objectType)>-1).forEach(e=>t.push(e.objectId)),t}(t),!0),e.welcomePage.hideWelcomeScreen({}),e.displayer.switchView("table")}w.setPanelHelpMode({container:t}),function(e,t){const n={getSelectedNodes:()=>{var n;const i=e.libraryManager.modelManager.getModel();return null!==(n=null==i?void 0:i.getSelectedNodes().map(e=>{var n,i;return{getID:()=>{var t;return null===(t=null==e?void 0:e.getAttributeValue)||void 0===t?void 0:t.call(e,"id")},getTenant:()=>t.getTenant(),getDisplayName:()=>{var t;return null===(t=null==e?void 0:e.getAttributeValue)||void 0===t?void 0:t.call(e,"title")},getLabel:()=>{var t;return null===(t=null==e?void 0:e.getAttributeValue)||void 0===t?void 0:t.call(e,"title")},object:{revision:null===(n=null==e?void 0:e.getAttributeValue)||void 0===n?void 0:n.call(e,"revision"),type:null===(i=null==e?void 0:e.getAttributeValue)||void 0===i?void 0:i.call(e,"type")}}}))&&void 0!==n?n:[]},getSecurityContext:()=>{const e=t.getSecurityContext();return{SecurityContext:e}},getPADTreeDocument:()=>e.libraryManager.modelManager.getModel(),addEvent:(e,t)=>console.debug("RgdApp eventListener",e,t),getEditMode:()=>!0,options:{arguments:[]}};l.set(n)}(e,n),function(e){new o({file:e.context.workbenchName+".xml",module:e.context.workbenchModule})}(e)}(e,t,i,m),async function(e,t){s.create({events:{onRefresh:async function(n){const i=d.is(n,"object")?n:JSON.parse(n),o=i.authored,a=e.libraryManager.getModel().getSelectedNodes(),r=a.map(e=>{var t;return null===(t=e.getAttributeValue)||void 0===t?void 0:t.call(e,"id")});if(JSON.stringify(o.modified.sort())===JSON.stringify(r.sort())&&o&&o.modified){const n=(new S.HeadersBuilder).createHeader(t.getSecurityContext()),i=await(0,f.getTemplatesBulk)(e.libraryManager.service,n,r);a.forEach(e=>{const t=i.templates.find(t=>t.id===e.options.grid.id);e.updateOptions({grid:{title:null==t?void 0:t.title}})})}}}})}(e,i)])}catch(e){b.debug("initialization failed",e)}finally{n.hideLoader()}}return class{constructor(){this.init()}async init(){const e=this;await async function(e,t){try{t.widgetSettings=new v(e),await t.widgetSettings.loadDictionary()}catch(e){t.widgetSettings.acceptedTypes=Promise.resolve(["Report Model"])}}(new u.WidgetClientFactory,e),this.widgetSettings.addEvent("onLoad",()=>{D(e)}),this.widgetSettings.addEvent("onRefresh",()=>{this.widgetSettings.widgetBody.empty(),D(e)}),this.widgetSettings.addEvent("onSearch",t=>{e.displayer.searchInWidget(t)}),this.widgetSettings.addEvent("onResetSearch",()=>{e.displayer.resetSearchInWidget()}),m.init(this.widgetSettings.widgetId,!0),this.widgetSettings.onDestroy=(()=>{console.log("widget destroyed"),m.destroy()}),S.listenLifeCycleEvents(this.widgetSettings.widgetId,"RGD")}}}),define("DS/CATRgdApp/commands/ConfigureAppCmd",["require","exports","DS/ApplicationFrame/Command","UWA/Core","DS/CATRgdApp/UI/ConfigureApp","DS/RGNServices/Alert"],function(e,t,n,i,o,a){"use strict";function r(t){return new Promise((n,i)=>{e(t,()=>{n()},e=>{i(e)})})}return n.extend({init:function(e){this._parent(e,{isAsynchronous:!1}),async function(){try{await r(["DS/CodeMirror/lib/codemirror","css!DS/CodeMirror/lib/codemirror"]),await r(["DS/CodeMirror/addon/mode/simple","DS/CodeMirror/addon/display/autorefresh","DS/CodeMirror/addon/display/placeholder"]),await r(["DS/CATRgnOTScript/assets/scripts/emxRGNOTSCodeMirror"])}catch(e){console.error(e),a.error(e)}}()},execute:async function(){const e=new i.Element("div",{class:"rgd-configure-container"});o.buildUI(this.libraryManager.webClientOptions,e,this.isAdmin,this.widgetSettings)}})}),define("DS/CATRgdApp/OTScript/UI/OTScriptFilesUI",["require","exports","DS/DataDragAndDrop/DataDragAndDrop","UWA/Core","DS/Controls/Button","DS/Controls/Loader","DS/Controls/ButtonGroup","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/CATRgnWidgetCommons/restClient/OtscriptServices","DS/CATRgdApp/OTScript/UI/BasicOTScriptUIElements","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","DS/Controls/TooltipModel","css!DS/CATRgdApp/OTScript/UI/css/OTScriptFilesStyle"],function(e,t,n,i,o,a,r,l,s,d,c,p){"use strict";function m(e,t,n){var i;const{errors:o,message:a}=t;if("success"===n){if(a)e.setHTML(`<div class="ots-success-msg"><p>${a}</p></div>`);else if(o){const n=null===(i=t.errors)||void 0===i?void 0:i.map(e=>`<div class="ots-error-msg"><p>${null==e?void 0:e.library}: ${null==e?void 0:e.error}</p></div>`).join("");e.setHTML(n)}}else e.setHTML(`<div class="ots-error-msg"><p>${a}</p></div>`)}async function g(e,t,n,i,o,a,r,d){var c;i.setText(""),n.inject(i),n.on("Checking OTScript...");const p={otscript:[]};if("save"===t&&(p.action="save"),null==a?void 0:a.otScriptPage){if("save"===p.action){const e=Object.keys(a.otScriptPage),t=Object.keys(a.deletedOTscriptFiles);e.forEach(e=>{t.includes(e)&&(Array.from(d.children).forEach(t=>{t.id===e&&t.remove()}),delete a.otScriptPage[e],delete a.deletedOTscriptFiles[e])})}for(const[e,t]of Object.entries(null==a?void 0:a.otScriptPage))null===(c=p.otscript)||void 0===c||c.push({name:e,code:t||""})}const g=await l.service3DSpace(e),u=(new l.HeadersBuilder).createHeaderWithCsrfToken(e.getSecurityContext(),await l.getCSRFToken());s.saveOTScriptFiles(g,u,p).then(e=>{e&&(m(i,e,"success"),"0"===e.code&&"save"===p.action&&(o.disabled=!0),o.disabled&&f(r,!1))}).catch(e=>{m(i,e,"error")}).finally(()=>{n.off()})}function u(e,t,n){var i;const{fileMenuList:o,fileList:a,otsExportPage:l,otscriptPage:s,otsButtons:c,saveOTSFileButton:p,otsTerminal:m,exportOTSFileButton:g,terminalLoader:u,editor:C,otscriptTab:y}=e;m.setText("");const T=new r({type:"checkbox"}),v=null==o?void 0:o.childNodes;T.addEventListener("buttonclick",e=>{const t=e.dsModel,n=null==t?void 0:t.label,i=y.otScriptPage[n];let o=!0;null==l||l.forEach((e,t)=>{if(e.name===n)return o=!1,void l.splice(t,1)}),o&&(null==l||l.push({name:n,code:i}));const a=null==l?!0:!l.length;g.disabled=a});let w=`OTScript${(null===(i=null==a?void 0:a.childNodes)||void 0===i?void 0:i.length)+1}`;w=S(y.otScriptPage,w),s&&(null==s?void 0:s.name)?(w=null==s?void 0:s.name,y.otScriptPage[w]=null==s?void 0:s.code):y.otScriptPage[w]="",u.inject(m),d.displayOTSFileList(w,T,C,n);const h=!v||!v.length;null==c||c.map(e=>e.disabled=h),p.disabled=h,p.disabled||f(t,!0)}function S(e,t){const n=Object.keys(e);for(;n.includes(t);)t=`${t}1`;return t}function C(e,t,i){n.droppable(e,{drop:(e,n,o)=>(function(e,t,n){e.preventDefault();const i=e.target,o=e.dataTransfer.files[0],a=new FileReader;return a.onload=function(e){var o,a,r;(null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.result)&&(null===(a=null==e?void 0:e.target)||void 0===a?void 0:a.result.startsWith("["))?(y(JSON.parse(null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.result),t,n),t.saveOTSFileButton.disabled&&(t.saveOTSFileButton.disabled=!1,f(t.myDialog,!0))):m(null==t?void 0:t.otsTerminal,{message:c.INVALID_FILE_FORMAT},"error"),i.classList.remove("ots-drag-over")},a.readAsText(o),!1})(o,t,i),enter:function(e){e.classList.add("ots-drag-over")},over:function(e){e.classList.add("ots-drag-over")},leave:function(e){e.classList.remove("ots-drag-over")}})}async function y(e,t,n){e&&(e.forEach(e=>{e.name=S(t.otscriptTab.otScriptPage,e.name),t.otscriptPage=e,u(t,t.myDialog,n)}),setTimeout(()=>{null==t||t.editor.setValue(null==t?void 0:t.editor.getValue())},0),t.saveOTSFileButton.disabled=!0,t.saveOTSFileButton.disabled&&f(t.myDialog,!1))}function f(e,t){e.Yes.disabled=t}function T(e){return new i.Element("span",{class:"file-menu-list-item"}).inject(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.checkOTScriptFileName=t.updateDialogButtonState=t.buildUI=void 0,t.checkOTScriptFileName=S,t.updateDialogButtonState=f,t.buildUI=function(e,t,n,r){const l=[],s=new a,m=new i.Element("div",{class:"otscript-main-container"}),S=new i.Element("div",{class:"file-menu-list"}).inject(m),v=new i.Element("div",{class:"left-file-menu-list"}).inject(S),w=new i.Element("div",{class:"right-file-menu-list"}).inject(S);new i.Element("div",{class:"clear-both"}).inject(S);const h=new i.Element("div",{class:"leftSideSection"}).inject(m),b=document.createElement("div");b.classList.add("rightSideSection"),m.appendChild(b),new i.Element("div",{class:"clear-both"}).inject(m);const A=document.createElement("div"),D=document.createElement("div"),I=document.createElement("textArea");I.style.display="none";const M=new i.Element("div",{class:"otscript-terminal"});A.classList.add("editorTerminalContainer"),b.appendChild(A),D.classList.add("editorContainer"),A.appendChild(D),D.appendChild(I),M.inject(A),s.inject(M);const R=CodeMirror.fromTextArea(I,{indentUnit:4,lineNumbers:!1,autofocus:!0,mode:"otscript",readOnly:!0,showCursorWhenSelecting:!0}),E=new o({showLabelFlag:!1,domId:"idOtsBtns",icon:{iconName:"database-save",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"20px",minWidth:0},displayStyle:"lite",disabled:!0,onClick:async()=>{g(e,"save",s,M,E,n,r,W)}});E.tooltipInfos=new p,E.tooltipInfos.shortHelp=c.otScript_Save,R.on("change",(e,t)=>{"setValue"!==t.origin&&(E.disabled=!1,f(r,!0))}),E.disabled&&f(r,!1);const F=new o({showLabelFlag:!1,domId:"idOtsBtns",icon:{iconName:"task-list-status-ok",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"20px",minWidth:0},displayStyle:"lite",disabled:!0,onClick:()=>{g(e,"run",s,M,E,n,r,W)}});F.tooltipInfos=new p,F.tooltipInfos.shortHelp=c.otScript_CheckCode;const x=new o({showLabelFlag:!1,domId:"idOtsBtns",icon:{iconName:"database-export",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"20px",minWidth:0},displayStyle:"lite",disabled:!0,onClick:()=>{!function(e){const t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","export.json"),document.body.appendChild(n),n.click(),n.remove()}(l)}});x.tooltipInfos=new p,x.tooltipInfos.shortHelp=c.otScript_Export;const W=new i.Element("ul",{class:"file-list"}),L=new o({showLabelFlag:!1,domId:"idOtsBtns",icon:{iconName:"upload",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"20px",minWidth:0},displayStyle:"lite",disabled:!0});L.tooltipInfos=new p,L.tooltipInfos.shortHelp=c.otScript_addSnipetCode,null==L||L.getContent().addEventListener("buttonclick",()=>{d.addOTSSnippets(n,R,E,r)});const O=[F,L],N={saveOTSFileButton:E,otsButtons:O,fileMenuList:S,fileList:W,editorTerminalSection:b,terminalLoader:s,otsTerminal:M,exportOTSFileButton:x,otscriptPage:{},otsExportPage:l,editor:R,otscriptTab:n,myDialog:r},P={otsButtons:O,fileList:W,otscriptTab:n,saveOTSFileButton:E,myDialog:r},U=new o({showLabelFlag:!1,domId:"idOtsBtns",icon:{iconName:"doc-add",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"20px",minWidth:0},displayStyle:"lite",onClick:()=>{N.otscriptPage={},u(N,r,P)}});return U.tooltipInfos=new p,U.tooltipInfos.shortHelp=c.otScript_New,U.inject(T(v)),E.inject(T(v)),F.inject(T(v)),x.inject(T(w)),L.inject(T(w)),W.inject(h),C(new i.Element("div",{class:"ots-drop-zone",text:"Drop Exported Library"}).inject(h),N,P),y(t,N,P),m}}),define("DS/CATRgdApp/UI/ConfigureApp",["require","exports","UWA/Core","DS/Controls/Tab","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Loader","DS/WUXAutoComplete/AutoComplete","i18n!DS/CATRgdApp/assets/nls/RGDWelcomePage","DS/CATRgnWidgetCommons/restClient/OtscriptServices","DS/CATRgdApp/OTScript/UI/OTScriptFilesUI","DS/CATRgdApp/UI/ConfigureInputTypes","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/RGNServices/Alert","DS/Windows/ImmersiveFrame","css!DS/CATRgrReportWizard/CATRgrWizard"],function(e,t,n,i,o,a,r,l,s,d,c,p,m,g,u){"use strict";function S(e,t,n){const i=new l({elementsTree:e,allowFreeInputFlag:!1,selectedItems:n,popupConstraint:document.querySelector(".wux-windows-window-content"),columnOptions:{autoRowHeightFlag:!0},getChipInfo:function(e){return{label:e.options.label,tooltip:e.options.tooltip}}});return i.inject(t),i}Object.defineProperty(t,"__esModule",{value:!0}),t.getAutoComplete=t.buildUI=void 0,t.buildUI=async function(e,t,l,C){const y=new r;y.inject(new n.Element("div",{class:"loader-container"}).inject(t)),y.on(s.loader);const f=new u({});f.elements.container.setStyle("pointer-events","none"),f.inject(C.widgetBody);const T=new o({title:"Configure",immersiveFrame:f,content:t,autoCloseFlag:!1,buttons:{Yes:new a({label:s.get("WelcomeScreen.InputTypes.Done")}),Cancel:new a({onClick:function(){T.destroy()}})},resizableFlag:!0,width:700,height:400});T.addEventListener("close",()=>{var e;const t=v.getActualConfiguration(w.selectedItems),n=null===(e=v.dataModel)||void 0===e?void 0:e.selectedTypes;if(n.some((e,n)=>e!==t[n])||t.length!==n.length){const e=new o({identifier:"configurationCloseConfirmDialog",immersiveFrame:f,title:s.get("quitConfiguration"),content:s.get("message_quitConfiguration"),closeButtonFlag:!1,modalFlag:!0,buttons:{Yes:new a({onClick:async()=>{e.destroy(),T.destroy()}}),No:new a({onClick:()=>{e.destroy()}})}})}else T.destroy()}),T.buttons.Yes.addEventListener("mousedown",async()=>{v.sendConfiguration(e,w.selectedItems,l),T.buttons.Yes.disabled||T.destroy()});const v=new p.ConfigureInputTypes;await v.getInfosInputTypes(e,l);const w=S(v.elementsTree,t,v.defaultInputSelected);y.off();const h=new i({displayStyle:"strip"});return l?(h.add({label:"Default input Types",content:w,isSelected:!0,icon:{iconName:"tools",fontIconFamily:WUXManagedFontIcons.Font3DS}}),h.add({label:"OTScript Files",icon:{iconName:"export-multiple",fontIconFamily:WUXManagedFontIcons.Font3DS}})):h.add({label:"Input Types",content:w,isSelected:!0,icon:{iconName:"tools",fontIconFamily:WUXManagedFontIcons.Font3DS}}),h.inject(t),h.addEventListener("change",async t=>{var n,i;if(1===(null===(n=t.dsModel)||void 0===n?void 0:n.value[0])){const n={lastOTScriptTabName:"",otScriptPage:{},deletedOTscriptFiles:{}};let i;try{const o=await m.service3DSpace(e),a=(new m.HeadersBuilder).createHeader(e.getSecurityContext()),r=await d.fetchOTScriptFiles(o,a);i=null==r?void 0:r.otscript;const l=c.buildUI(e,i,n,T.buttons);t.dsModel.tabPanelContainer.setHTML(l)}catch(e){g.error(t)}}else null===(i=t.dsModel)||void 0===i||i.tabPanelContainer.setHTML(w)}),w},t.getAutoComplete=S}),define("DS/CATRgdApp/OTScript/UI/BasicOTScriptUIElements",["require","exports","UWA/Core","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Toggle","DS/Controls/TooltipModel","i18n!DS/CATRgdApp/assets/nls/CATRgdApp","DS/CATRgdApp/OTScript/UI/OTScriptFilesUI","DS/RGNServices/Alert","css!DS/CATRgdApp/OTScript/UI/css/OTScriptFilesStyle"],function(e,t,n,i,o,a,r,l,s,d){"use strict";function c(e,t,n){const i=e.querySelector(".file-name").innerText;t.setOption("readOnly",!1),t.setOption("lineNumbers",!0);const{lastOTScriptTabName:o}=n;t&&(i==o?n.otScriptPage[i]&&t.setValue(n.otScriptPage[i]):""!==n.lastOTScriptTabName&&n.lastOTScriptTabName?n.otScriptPage[i]?(n.otScriptPage[o]=t.getValue(),t.setValue(n.otScriptPage[i])):(n.otScriptPage[o]=t.getValue(),t.setValue("")):n.otScriptPage[i]?t.setValue(n.otScriptPage[i]):t.setValue("")),o?i!==o&&(n.lastOTScriptTabName=i):n.lastOTScriptTabName=i,t.focus(),t.on("blur",()=>{n.otScriptPage[n.lastOTScriptTabName]=null==t?void 0:t.getValue()})}Object.defineProperty(t,"__esModule",{value:!0}),t.addOTSSnippets=t.displayOTSFileList=void 0,t.addOTSSnippets=function(e,t,n,i){const{lastOTScriptTabName:o}=e;if(o){const a=(null==t?void 0:t.getValue())+'\nMETHOD <Type>.<Name>() -doc : {\n\t//Code\n} CATEGORY "<methodCategory>"\nLABEL "<methodDisplay>"\nHELPTEXT "<Tooltip information>";\n';null==t||t.setValue(a),e.otScriptPage[o]=null==t?void 0:t.getValue(),e.lastOTScriptTabName=o,n.disabled=!1,s.updateDialogButtonState(i,!0)}},t.displayOTSFileList=function(e,t,p,m){let{otsButtons:g,ulContainer:u,otscriptTab:S,saveOTSFileButton:C,myDialog:y}=m;u=m.fileList;const f=new n.Element("li",{class:"file-list-item",id:e,recId:e}).inject(u),T=new n.Element("div",{class:"div-box "}).inject(f);T.classList.add("flex-container");const v=u.childNodes;f.addEventListener("click",e=>{v&&0===v.length&&(g.map(e=>e.disabled=!0),p.setValue(""),p.setOption("readOnly",!0),p.setOption("lineNumbers",!1));let t=e.target;for(;t;){if(e.currentTarget===t){S.otScriptTabContainer.classList.remove("selected"),e.currentTarget.classList.add("selected"),S.otScriptTabContainer=e.currentTarget,c(e.currentTarget,p,S);break}t=t.parentNode}}),t.inject(T);const w=new n.Element("div",{class:"mid"}).inject(T),h=new n.Element("span",{class:"file-name",text:e}).inject(w),b=new a({type:"checkbox",label:null==h?void 0:h.innerText});t.addChild(b);const A=new o({placeholder:"Enter file name",displayClearFieldButtonFlag:!0,class:"file-name"});h.addEventListener("dblclick",e=>{if(e.stopPropagation(),h){const e=h.innerHTML;h.remove(),A.value=e,A.inject(w),A.focus(),D.replaceChildren(),I.inject(D)}});const D=new n.Element("span",{class:"right"}).inject(T),I=new i({showLabelFlag:!1,icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},domId:"idOtsFileBtns",displayStyle:"lite"});I.addEventListener("buttonclick",e=>{e.stopPropagation(),F()}),A.addEventListener("blur",e=>{e.stopPropagation(),F()}),A.addEventListener("keydown",e=>{e instanceof KeyboardEvent&&"Enter"===e.key&&F()});const M=new i({showLabelFlag:!1,icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x",className:"editFile"},tooltipInfos:new r({shortHelp:l.otScript_edit}),domId:"idOtsFileBtns",displayStyle:"lite",onClick:e=>{if(e.stopPropagation(),M){const e=h.innerHTML;h.remove(),A.value=e,A.inject(w),A.getContent().focus(),D.replaceChildren(),I.inject(D)}}}).inject(D),R=new i({showLabelFlag:!1,icon:{iconName:"reset wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},domId:"idOtsFileBtns",recID:"reset",displayStyle:"lite"});R.addEventListener("buttonclick",e=>{const t=R.getContent().parentNode.parentNode;let n;if(v.forEach(e=>{e.childNodes.forEach(i=>{if(t===i)return n=e,!1})}),n){const e=null==n?void 0:n.innerText;e&&(e in S.deletedOTscriptFiles&&delete S.deletedOTscriptFiles[e],R.remove(),C.disabled=!1,s.updateDialogButtonState(y,!0),h.className="file-name",M.inject(D),E.inject(D))}}),w.addEventListener("onClick",e=>{if(13===e.keyCode){const e=h.innerHTML;h.remove(),A.value=e,A.inject(w),A.getContent().focus(),D.replaceChildren(),I.inject(D)}});const E=new i({showLabelFlag:!1,icon:{iconName:"wrong",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},tooltipInfos:new r({shortHelp:l.otScript_remove}),domId:"idOtsFileBtns",displayStyle:"lite"}).inject(D);function F(){const e=A.value;A.remove(),h.inject(w),""!==e?(S.otScriptPage[e]=S.otScriptPage[null==f?void 0:f.innerText],delete S.otScriptPage[null==f?void 0:f.innerText],S.lastOTScriptTabName=e,h.innerHTML=e,f.setAttribute("recId",e),b.label=e):setTimeout(()=>{d.error("File name was empty")},500),I.remove(),C.disabled=!1,s.updateDialogButtonState(y,!0),M.inject(D),E.inject(D)}E.getContent().addEventListener("buttonclick",e=>{var t;const n=E.getContent().parentNode.parentNode;let i;if(v.forEach(e=>{e.childNodes.forEach(t=>{if(n===t)return i=e,!1})}),i){const e=i.innerText,n=S.otScriptPage[e];void 0!==n&&(S.deletedOTscriptFiles={...S.deletedOTscriptFiles,[e]:n}),h.className="deleted",D.replaceChildren(),R.inject(D),C.disabled=!1,s.updateDialogButtonState(y,!0),v&&v.length&&(S.otScriptTabContainer.classList.remove("selected"),v[0].classList.add("selected"),S.otScriptTabContainer=v[0],S.lastOTScriptTabName=null===(t=v[0])||void 0===t?void 0:t.innerText,c(v[0],p,S))}}),v&&v.length&&1===v.length&&(v[0].classList.add("selected"),S.otScriptTabContainer=v[0],c(v[0],p,S))}});