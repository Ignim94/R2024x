define("DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper",["UWA/Core","UWA/Promise","DS/Controls/Abstract","DS/ENOCharacteristicsApp/model/SpecificationModel","DS/ENOCharacteristicsApp/utils/CharacteristicsServiceProvider","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],function(e,t,n,r,i,a,c){"use strict";return n.extend({init:function(e){e&&(this.modelEvents=e.modelEvents,this.options=e,this.appCore=e.appCore)},getSpecData:function(e){var n=this;return new t(function(t,r){console.time("getSpecification from service"),(new i).fetchSpecificationsData(e).then(function(e){let r=e.data.specsData;var i=n.buildExtensionAttributesInfo(e),a=n.createSpecNodes(r);return t({listNodes:a,extensionAttributesColumnInfo:i})}).catch(function(e){return r(e)})})},buildExtensionAttributesInfo:function(e){let t=this,n={};if(e&&e.data){e.data.specsData.forEach(e=>{if(e.hasOwnProperty("additionalAttributes")&&r(e.additionalAttributes),e.hasOwnProperty("characteristics")){e.characteristics.forEach(e=>{e.hasOwnProperty("additionalAttributes")&&r(e.additionalAttributes)})}});let i=e.data.additionalAttributes;return t.appCore.defaultExtensionAttributes=i,r(i),Object.values(n)}return[];function r(e){for(let t in e){(Array.isArray(e[t])?e[t]:[e[t]]).forEach(e=>{let t="";if("Change Id"===(t=e.nlsName?e.nlsName:i(e.name)))return;let r=e.extension+"||"+e.name;e.mandatory;if(e.dimension&&""!==e.dimension){let n="";e.units.forEach(t=>{t.dbName==e.preferredUnit&&(n=t.nlsLabel)}),t=`${t} (${n})`}if(!n.hasOwnProperty(r)){let i="timestamp"!==e.type||e.rangevalue?"string":"datetime";n[r]={dataIndex:r,text:t,typeRepresentation:i,editableFlag:"ReadWrite"==e.userAccess,extension:e.extension,mandatory:e.mandatory},e.dimension&&""!==e.dimension&&(n[r].baseUnit=e.baseUnit,n[r].preferredUnit=e.preferredUnit),e.hasOwnProperty("rangevalue")&&(n[r].range=Object.values(e.rangevalue)),"boolean"===e.type&&(n[r].range=[c.boolean_true,c.boolean_false])}})}}function i(e){let t="";return t=e.includes("XP_PerformanceSpec_Ext")?e.replace("XP_PerformanceSpec_Ext.",""):e.includes("XP_PerformanceChar_Ext")?e.replace("XP_PerformanceChar_Ext.",""):e}},createSpecNodes:function(t){var n=[];if(void 0!==t){for(var r=0;r<t.length;r++){var i=this.createSpecNode(t[r]);e.is(i)&&n.push(i)}return n}},createSpecNode:function(e){var t=new r({appCore:this.appCore}).set(e);return t.charModelEvents=this.modelEvents,t},updateCharacteristicsData:function(e,n,r){return new t(function(t,a){(new i).updateCharacteristics(e,n,r).then(function(e){return t(e)}).catch(function(e){return a(e)})})},updateSpecificationData:function(e,n,r){return new t(function(t,a){(new i).updateSpecificaton(e,n,r).then(function(e){return t(e)}).catch(function(e){return a(e)})})},reorderchar:function(e,n,r){return new t(function(t,a){(new i).reorder(e,n,r).then(function(e){return t(e)}).catch(function(e){return a(e)})})},createCharacteristics:function(e){return new t(function(t,n){(new i).createCharacteristics(e).then(function(e){var r=JSON.parse(e),i=r.data.physicalid;return null!=e&&null!=i?t(r):n(r)}).catch(function(e){var t=JSON.parse(e).errorMessage;return console.log(t),n(t)})})},deleteInstances:function(e){var t=e[0].getTypeActualName(),n=new i(this.options);return a.isPerformanceSpecification(t)?n.deleteSpecifications(e):n.deleteCharacteristics(e)},removeDerivedSpecs:function(e,t){return new i(this.options).removeDerivedSpecs(e,t)},getDimensionDisplayUnitSet:function(){return new t(function(e,t){(new i).fetchDimensionDisplayUnitSet().then(function(t){return e(t)}).catch(function(e){return t(e)})})},createSpecification:function(e,n){return new t(function(t,r){(new i).createSpecification(e,n).then(function(e){var n=JSON.parse(e),i=n.data.physicalid;return null!=e&&null!=i?t(n):r(n)}).catch(function(e){var t=JSON.parse(e).errorMessage;return console.log(t),r(t)})})},getExtensions:function(e){return new t((t,n)=>{(new i).getExtensions(e).then(e=>t(e)).catch(e=>n(e))})},getAttachedExtensions:function(e){return new t((t,n)=>{(new i).getAttachedExtensions(e).then(e=>t(e)).catch(e=>n(e))})},addExtensions:function(e){return new t((t,n)=>{(new i).addExtensions(e).then(e=>t(e)).catch(e=>n(e))})},removeExtensions:function(e){return new t((t,n)=>{(new i).removeExtensions(e).then(e=>t(e)).catch(e=>n(e))})},getSpecDataById:function(e,n,r){return new t(function(t,a){(new i).fetchSpecificationsDataByID(e,n,r).then(function(e){return e.data?t(e.data):null}).catch(function(e){return a(e)})})},duplicateInstances:function(e,n){return new t(function(t,r){(new i).duplicateCharacteristics(e,n).then(function(e){return t(e)}).catch(function(e){return r(e)})})},syncPerformanceSpecs:function(e,n){let r=this;return new t(function(t,a){(new i).syncPerformanceSpecs(e,n).then(function(e){let n={specsData:e.data,additionalAttributes:[]},i=r.buildExtensionAttributesInfo({data:n});return t({data:e.data,extensionAttribs:i})}).catch(function(e){return a(e)})})},getScopedEngItem:function(e){return new t(function(t,n){(new i).getScopedEngItem(e).then(function(e){return t(e)}).catch(function(e){return n(e)})})},getMeasurementCharacteristicLimitsConfiguration:function(){return new t(function(e,t){(new i).getMeasurementCharacteristicLimitsConfiguration().then(function(t){return JSON.parse(t).data?e(JSON.parse(t).data):null}).catch(function(e){return t(e)})})},getType:function(){return new t(function(e,t){(new i).getType().then(function(t){return t.data?e(t.data):null}).catch(function(e){return t(e)})})}})});