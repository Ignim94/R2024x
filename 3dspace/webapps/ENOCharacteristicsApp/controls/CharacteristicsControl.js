define("DS/ENOCharacteristicsApp/controls/CharacteristicsControl",["UWA/Class","DS/ENOCharacteristicsApp/controls/CreateCharacteristics","DS/ENOCharacteristicsApp/controls/CreateSpecification","DS/ENOCharacteristicsApp/controls/DeleteCharacteristics","DS/ENOCharacteristicsApp/utils/CharacteristicsUtils","DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper","DS/ENOCharacteristicsApp/utils/Constants","DS/XSRCommonComponents/service/XSpecsActionsFactory","DS/XSRCommonComponents/components/EditProp/XSpecProperties","DS/XSRCommonComponents/utils/TypeUtils","DS/ENOCharacteristicsApp/utils/Notification","DS/Controls/Button","DS/Windows/Dialog","DS/XSRCommonComponents/components/AddExtensions/AddExtensions","DS/XSRCommonComponents/utils/RequestUtil","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],function(e,t,i,s,a,n,r,o,c,l,d,p,h,u,m,f){"use strict";return e.extend({init:function(e){this.charGrid=e.charGrid,this.dataGrid=e.dataGrid,this.itemTitle=e.itemTitle,this.itemMaturity=e.itemMaturity,this.actualItemMaturity=e.actualItemMaturity,this.physicalPrdModel=e.physicalPrdModel,this.modelEvents=e.modelEvents,this.specViewerModelEvents=e.specViewerModelEvents,this.appCore=e.appCore},launchCreateForm:function(e,s){var a={};if(a.charContainer=e.charContainer,a.modelEvents=this.modelEvents,"CreateSpecification"===s){a.parentId=e.parentId,a.title=this.itemTitle,a.createCloseAction=a.createAction=function(e,t){e&&null!=e&&t.modelEvents.publish({event:"specification-created",data:{specRowData:e}})},new i(a).loadFields()}else{if(a.isSpecificationLimitsDisabled=e.isSpecificationLimitsDisabled,a.isRoutineReleaseLimitsDisabled=e.isRoutineReleaseLimitsDisabled,!this.dataGrid.getTreeDocument().getSelectedNodes()||1!==this.dataGrid.getTreeDocument().getSelectedNodes().length)return void d.displayNotification({eventID:"info",msg:f.MultipleItemSelected});a.parentId=this.dataGrid.getTreeDocument().getSelectedNodes()[0].getPhysicalId(),a.title=this.dataGrid.getTreeDocument().getSelectedNodes()[0].getTitle(),a.createCloseAction=a.createAction=function(e,t){e&&null!=e&&t.modelEvents.publish({event:"characteristic-created",data:{specRowData:e}})},new t(a).loadFields()}},deleteCharNodes:function(e){var t={};t.parentId=e.parentId,t.modelEvents=e.modelEvents,t.container=e.container,t.selectedNodes=this.dataGrid.getTreeDocument().getSelectedNodes(),new s(t).deleteCharacteristics()},testMethodsDialog:function(e){var t=this;console.log("Test Methods Dialog"),console.log(e);var i=e.selectedNodes[0];t.facetsArr=[];var s=UWA.createElement("div",{class:"testMethods-char-container",styles:{height:"inherit"}});t.specProp=new c,t.editPropView=t.specProp.init({id:i.getID(),container:s,readOnly:!1,facets:t.facetsArr,enableChangeRequired:!1,specModel:i});var a=new h({title:"Test Methods",content:s,height:600,width:500,activeFlag:!1,modalFlag:!0,buttons:{Cancel:new p({onClick:function(e){a.close()}})}});a.addEventListener("close",function(e){t.specViewerModelEvents.publish({event:"xsr-slide-in-facet-destroy-updated"})}),t.specProp._addCustomFacet(e.appCore)},informationDialog:function(e){if(null==e||0==e.length)return void d.displayNotification({eventID:"info",msg:f.Info_Select_Spec_Or_Char});if(e.length>1)return void d.displayNotification({eventID:"info",msg:f.Info_Select_Single_item});var t=e[0];let i="PerformanceSpec"!==e[0].getTypeActualName();this.facetsArr=["Properties","Change","Comments"];var s=UWA.createElement("div",{class:"properties-char-container",styles:{height:"inherit"}});this.specProp=new c,this.editPropView=this.specProp.init({id:t.getID(),container:s,readOnly:i,facets:this.facetsArr,enableChangeRequired:!0,specModel:t});var a=new h({title:"Properties",content:s,height:600,width:500,activeFlag:!1,modalFlag:!0,buttons:{Cancel:new p({onClick:function(e){a.close()}})}})},addExtensions:function(){var e=this;let t=new n,i=this.dataGrid.getTreeDocument().getSelectedNodes(),s=i[0].getTypeActualName(),a=l.isPerformanceSpecification(s)?r.TYPE_PERFORMANCE_SPEC:l.isPerformanceCharacteristics(s)?r.TYPE_PERFORMANCE_CHAR:null,o=a===r.TYPE_PERFORMANCE_SPEC?i[0].getMaturityActualName():i[0].getParent().getMaturityActualName(),c=e.physicalPrdModel.isBeyondInWork();if(o!==r.MATURITY_IN_WORK||c)return d.clearNotifications(),void d.displayNotification({eventID:"error",msg:f.Error_Beyond_InWork_State});let p,h={classes:s,isCloud:m.isCloud()},g=i[0].getID();a==r.TYPE_PERFORMANCE_CHAR&&(p=i[0].getParent().getID());let C=t.getExtensions(h),E={},v={physicalid:g,isCloud:m.isCloud()},D=t.getAttachedExtensions(v),S={};function N(e){return e.filter(e=>{let t=e.name;return!(t.startsWith("XP_")&&t.endsWith("_Ext"))})}Promise.all([C,D]).then(([t,i])=>{E=N(t.data[0].interfaces),S=N(i.data.interfaces),new u({itemId:g,type:a,parentId:p,modelEvents:e.modelEvents,applicableExtensions:E,attachedExtensions:S}).render()}).catch(e=>{d.clearNotifications(),d.displayNotification({eventID:"error",msg:f.Error_Fetch_Extensions})})},syncPerformanceSpecs:function(e){let t=this,i=new n({appCore:t.appCore});i.getScopedEngItem(e).then(s=>{if(s.totalItems>0){let a=s.member[0].ScopeEngItem?s.member[0].ScopeEngItem.identifier:"";i.syncPerformanceSpecs(e,{scopeEngItem:a}).then(e=>{let i=e.data,s=e.extensionAttribs;i&&t.modelEvents.publish({event:"sync-specifications",data:{specsList:i,engItemId:a,extensionAttribs:s}})})}}).catch(e=>{d.clearNotifications(),d.displayNotification({eventID:"error",msg:e?e.errorMessage:"An Error Occured."})})},duplicateCharNodes:function(e){var t=this,i=[],s=1,o=!1,c="";if(e.forEach(function(e){if(!(r.MEASUREMENT_CHAR!==e.getTypeActualName()||a.dimensionDisplayUnitMap[e.getDimensionId()]&&a.displayUnitIdToObjMap[e.getDisplayUnitId()]))return o=!0,void(c+=`${e.getTitle()}, `)}),o)return d.clearNotifications(),void d.displayNotification({eventID:"error",msg:`${f.Err_Duplicate_Unsupported} : ${c.replace(/,\s*$/,"")}`});e.forEach(function(e){var t=e.getParent().getID(),a=e.getParent().getChildren().length+s;s+=1;var r={};r.type=e.getTypeActualName(),r.charId=e.getID(),r.sequence=a;var o=(new n).duplicateInstances(t,r);i.push(o)}),Promise.allSettled(i).then(function(e){if(e&&e.length>0){for(var i=[],s=0,n=0;n<e.length;n++)if("fulfilled"===e[n].status){var r=JSON.parse(e[n].value),o=a.createDupCharData(r.data.data);i.push(o)}else s++;s>0?d.displayNotification({eventID:"error",msg:f.Err_DuplicateChar}):(t.modelEvents.publish({event:"dup-characteristic-created",data:{specRowData:i}}),d.displayNotification({eventID:"success",msg:f.Success_DuplicateChar}))}}).catch(function(e){d.displayNotification({eventID:"error",msg:e?e.message:"An Error Occured."}),t._closeDialog()})},personalize:function(){this.charGrid.personalize()},exportGrid:function(){var e;e=this.itemTitle&&this.itemMaturity?this.itemTitle+"_"+this.itemMaturity+"_"+f.label_PerformanceSpec+"_"+(new Date).toString().split(" ").splice(1,4).join(" "):f.label_Characteristics+"_"+(new Date).toString().split(" ").splice(1,4).join(" "),this.charGrid.exportGrid(e)},maturityStateControl:function(e){o.showMaturityGraph(e)},revisionControl:function(e){o.launchPerfSpecVersionExplorer(e)}})});