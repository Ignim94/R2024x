define("DS/ENOCharacteristicsApp/CharacteristicsGridView/controller/CharacteristicsGridViewManager",["UWA/Core","UWA/Class","DS/DataGridView/DataGridView","DS/ENOCharacteristicsApp/model/SpecificationModel","DS/ENOCharacteristicsApp/model/CharacteristicsModel","DS/ENOCharacteristicsApp/CharacteristicsGridView/controller/GridColumn","DS/ENOCharacteristicsApp/utils/CharacteristicsUtils","DS/ENOCharacteristicsApp/utils/CharacteristicsValidation","DS/ENOCharacteristicsApp/utils/Constants","DS/ENOCharacteristicsApp/utils/Notification","DS/ENOCharacteristicsApp/utils/CharacteristicsMask","DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper","DS/XSRCommonComponents/utils/Utils","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],function(e,t,i,a,n,r,s,o,d,c,l,p,u,g){"use strict";return t.extend({limitValues:{},init:function(e){var t=e;this._parent(t),this.appCore=t.appCore,this.specViewerModelEvents=this.appCore.specViewerModelEvents,this.itemId=t.itemId,this.container=t.container;var i=t.columns;this.modelEvents=t.modelEvents,this.currentTabKey=t.currentTabKey,this.initializeColumns(i),this.model=t.model,this._subscribe()},_subscribe:function(){},initializeColumns:function(e){var t=e;t&&widget.data.appId&&"ENOSPEC_AP"!==widget.data.appId&&(t=e.filter(e=>"menu"!==e.dataIndex));var i=this.appCore.isSpecificationLimitsDisabled,a=this.appCore.isRoutineReleaseLimitsDisabled,n=[];t&&t.forEach(function(e){"newRoutineLimits"===e.dataIndex&&a||"newSpecificationLimits"===e.dataIndex&&i||n.push(e)}),this.columns=(new r).process.call(this,n)},addColumn:function(e,t){this.grid.addColumnOrGroup(e,t)},setColumns:function(e){this.initializeColumns(e)},setToolBar:function(e){},addChildColumns:function(e,t){},drawGrid:function(e){var t=this;!function(){var e={modelEvents:t.modelEvents};t.grid=new i({columns:t.columns,showModelChangesFlag:!0,showTreeIconsFlag:!1,showRowBorderFlag:!0,treeDocument:t.model,cellSelection:"multiple",rowSelection:"multiple",rowDragEnabledFlag:!0,showNodeKPIColorFlag:!0,rowGroupingEnabledFlag:!1}).inject(t.container),t.grid.onReady(function(){t.grid.getTreeDocument().expandAll()}),t.grid.layout.cellHeight=50,t.addEvents(),t.model.onPostExpand(e=>{e.target,t.model.gridLayout.resetRowHeight()}),t.model.onPostCollapse(e=>{e.target,t.model.gridLayout.resetRowHeight()}),t.service=new p(e);t.grid.getTypeRepresentationFactory().registerTypeTemplates(JSON.stringify({UWAObjectTemplate:{path:"DS/SpecGridView/utils/UWAObjectTemplate",options:{}}}));t.grid.layout.columnHeaderHeight=40,t.model.setLayoutInstance(t.grid.layout),t.grid.onCustomViewsSave=function(e,i){var a=e;widget.setValue("CustomGridViews"+t.currentTabKey,a),widget.setValue("CurrentCustomViewIndex"+t.currentTabKey,i)},setTimeout(function(){var e=widget.getValue("CustomGridViews"+t.currentTabKey),i=widget.getValue("CurrentCustomViewIndex"+t.currentTabKey);e&&i>=0&&t.grid.loadCustomViews(e,i)},1e3),t.addUpdateEvents(),t.grid.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify({contextMenu:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"chevron-down",fontIconFamily:1}}},UWAObject:{stdTemplate:"UWAObjectTemplate"}}))}(),t.modelEvents.subscribe({event:"specification-created"},function(e){let i=t.grid.treeDocument;e.specRowData.enableDefaultExtensions=!0;let n=new a({appCore:t.appCore}).set(e.specRowData);i.prepareUpdate(),i.addChild(n),i.pushUpdate(),i.acceptChanges()}),t.modelEvents.subscribe({event:"characteristic-created"},function(e){let i=t.grid.treeDocument,a=i.getSelectedNodes()[0];e.specRowData.dimension=s.dimensionIdToObjMap[e.specRowData.dimension],e.specRowData.storageUnit=s.displayUnitIdToObjMap[e.specRowData.displayUnit],e.specRowData.enableDefaultExtensions=!0;let r=new n({appCore:t.appCore}).set(e.specRowData);i.prepareUpdate(),a.addChild(r),i.pushUpdate(),i.acceptChanges(),a.expand()}),t.modelEvents.subscribe({event:"sync-specifications"},function(e){let i=t.grid.treeDocument,n=[],r=[];if(i.getChildren().forEach(e=>{e.isDerivedSpec()&&n.push(e.getPhysicalId())}),!e.engItemId&&0==n.length)return c.clearNotifications(),void c.displayNotification({eventID:"error",msg:g.Err_NoScopeLinkExists});if(i.prepareUpdate(),e.specsList.length>0){let s=t.grid.columns.map(e=>e.dataIndex);e.extensionAttribs.forEach(e=>{s.includes(e.dataIndex)||(e.editableFlag=!1,t.addColumn(e))}),e.specsList.forEach(e=>{if(r.push(e.physicalid),!n.includes(e.physicalid)){e.enableDefaultExtensions=!0;let n=new a({appCore:t.appCore}).set(e);i.addChild(n)}}),i.getChildren().forEach(e=>{!e.isDerivedSpec()||r.includes(e.getPhysicalId())&&"OBSOLETE"!=e.getMaturityActualName()||e.getParent().removeChild(e)})}else n.length>0&&i.getChildren().forEach(e=>{e.isDerivedSpec()&&e.getParent().removeChild(e)});i.pushUpdate(),i.acceptChanges(),c.clearNotifications(),c.displayNotification({eventID:"success",msg:g.MfgItemSyncSuccess})}),t.modelEvents.subscribe({event:"dup-characteristic-created"},function(e){let i=t.grid.treeDocument,a=i.getSelectedNodes()[0].getParent();e.specRowData.forEach(function(e){e.dimension=s.dimensionIdToObjMap[e.dimension],e.storageUnit=s.displayUnitIdToObjMap[e.displayUnit],e.enableDefaultExtensions=!0;let r=new n({appCore:t.appCore}).set(e);i.prepareUpdate(),a.addChild(r),i.pushUpdate(),i.acceptChanges(),i.getSelectedNodes()[0].unselect(),r.highlight(),a.expand()})}),t.specViewerModelEvents.subscribe({event:"TestMethodFacet-to-PerfSpec-commute-add-node-success"},function(e){let t=e.nodeModel,i=e.testmethodInfo.results,a=[];i.forEach(e=>{let t={};e.attributes.forEach(e=>{"resourceid"==e.name?t.physicalid=e.value:"ds6w:identifier"===e.name&&(t.name=e.value)}),a.push(t)});let n=t.getTestMethodsList()?t.getTestMethodsList():[];n=n.concat(a);let r={};n.forEach(e=>{r.hasOwnProperty(e.physicalid)||(r[e.physicalid]=e)}),n=Object.values(r),t.setTestMethodsList(n);let s="";s=n.length>1?`${n[0].name} + ${n.length-1}`:n[0].name,t.setTestMethods(s),t.updateOptions({grid:{testMethods:s}})}),t.specViewerModelEvents.subscribe({event:"TestMethodFacet-to-PerfSpec-commute-remove-node-success"},function(e){let t=e.nodeModel,i=(t.getTestMethodsList()?t.getTestMethodsList():[]).filter(t=>!e.testmethodIds.includes(t.physicalid));t.setTestMethodsList(i);let a="";a=i.length>1?`${i[0].name} + ${i.length-1}`:1===i.length?i[0].name:"",t.setTestMethods(a),t.updateOptions({grid:{testMethods:a}})}),t.modelEvents.subscribe({event:"handle-modified-extensions"},function(e){let i=t.grid.columns.map(e=>e.dataIndex),a=t.grid.getTreeDocument().getSelectedNodes()[0];if(e.extToAdd&&Object.keys(e.extToAdd).length>0){let n={interfaces:e.extToAdd,physicalid:e.itemId,type:e.type,specid:e.parentId};t.service.addExtensions(n).then(n=>{Object.keys(e.extAttribsInfo).forEach(n=>{let r=e.extAttribsInfo[n];Object.keys(r).forEach(e=>{let n=r[e],s="";s=n.ranges?n.ranges[n.value]:n.value;let o=e.split(".")[1],d=n.mandatory;o.includes("__")&&(o=o.slice(0,o.indexOf("__"))),n.unitNLSName&&(o=`${o} (${n.unitNLSName})`);let c=e.replace(".","||"),l="Date"!=n.type||n.hasRange?"string":"datetime";"Boolean"==n.type&&(n.hasRange=!0,n.ranges=[g.boolean_true,g.boolean_false],s=""==s?g.boolean_false:s),i.includes(c)||t.addColumn({dataIndex:c,text:o,typeRepresentation:l,editableFlag:!n.readOnly,getCellSemantics:function(e){if(n.hasRange){var t=e.nodeModel;if(t&&t._canBeGrouped()){var i=Object.values(n.ranges);return{possibleValues:()=>i,placeholder:""}}}}}),a.setAttribute(c,s),a.mandatory=d})}),n.data.revisedCharId&&a.setID(n.data.revisedCharId),c.clearNotifications(),c.displayNotification({eventID:"success",msg:g.extensions_modify_success})}).catch(function(e){c.clearNotifications(),c.displayNotification({eventID:"error",msg:g.extensions_modify_failure})})}if(e.extToRemove&&Object.keys(e.extToRemove).length>0){let n={interfaces:e.extToRemove,physicalid:e.itemId,type:e.type,specid:e.parentId};t.service.removeExtensions(n).then(t=>{e.extToRemove.forEach(e=>{i.filter(t=>t.startsWith(e)).forEach(e=>{a.removeAttribute(e)})}),t.data.revisedCharId&&a.setID(t.data.revisedCharId),c.clearNotifications(),c.displayNotification({eventID:"success",msg:g.extensions_modify_success})}).catch(function(e){c.clearNotifications(),c.displayNotification({eventID:"error",msg:g.extensions_modify_failure})})}})},groupRoots:function(e){this.model.groupRoots(e)},highlightCell:function(e,t){if(e&&t){var i=this.grid.layout.getColumnIndex(t),a=this.grid.layout.getCellIDFromCoordinates({rowID:e,columnID:i});a&&this.grid.selectCell(a)}},exportCSV:function(e){var t=this.grid.layout.getVisibleOrderedColumnsIndexes(),i=[];if(t&&t.length>0){this.model.selectAll();for(var a=0;a<t.length;a++){var n=t[a],r=this.grid.layout.getDataIndexFromColumnIndex(n);this.exportableColums.indexOf(r)>=0&&i.push(r)}var o=this.grid.getAsCSV({forceQuotes:!1,allColumns:!1,onlySelectedRows:!(!e||!e.onlySelectedRows)&&e.onlySelectedRows,columnKeys:i,columnSeparator:e&&e.columnSeparator?e.columnSeparator:void 0,addLevelInformation:!0});s.downloadCSV(o,e.fileName),this.model.unselectAll()}},addUpdateEvents:function(){var e=this;e.modelEvents.subscribe({event:d.EVENT_SAVE_CHAR},function(t){if(t.newValue)var i=m(t.newValue);var a=t.oldValue,n=t.nodeModel,r=!1;let o=t.nodeModel.mandatory;null==o?r=t.nodeModel.getAttributeValue("mandatory"):"YES"===o.toUpperCase()&&(r=!0);t.rowID;if(e.cellId=t.cellId,n){if(s.allTypeList.includes(n.getTypeActualName())){if((d={}).title=m(n.getTitle()),d.description=m(n.getDescription()),d.notes=m(n.getNotes()),d.category=n.getCategory(),d.physicalid=n.getPhysicalId(),d.parentPhysicalid=e.itemId,t.dataIndex.contains("||")){d.customerAttributes={};let e=t.dataIndex.split("||"),n=e[0],s=e[1],o=t.nodeModel.getAttributeValue(t.dataIndex+"_type");if(1==r&&(""==i||null==i))return t.nodeModel.setAttribute(t.dataIndex,a),void c.displayNotification({eventID:"error",msg:g.mandatory_extensions_failure});"integer"!==o||isNaN(i)||t.nodeModel.setAttribute(t.dataIndex,parseInt(i)),d.customerAttributes[n]={[s]:i}}[].push(d),e.grid.unselectAll(),t.nodeModel.select(),e.service.updateSpecificationData(d,e.itemId,n.getPhysicalId()).then(function(t){JSON.parse(t)&&(n.syncModel(d),n.acceptChanges(),c.displayNotification({eventID:"success",msg:g.Perf_Spec_Updated}),l.unmaskLoader(e.container)),Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues()}).catch(function(t){if(l.unmaskLoader(e.container),console.log(t),n.cancelChanges(),(i=JSON.parse(t)).errorMessage)var i=g.replace(g.get(g.Failure_Update),{errorMsg:i.errorMessage});Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues(),c.displayNotification({eventID:"error",msg:i}),l.unmaskLoader(e.container)})}else{var d={},p="",u=s.CharLimitsValidation(n);switch(t.dataIndex){case"lowerTarget":if(!i&&n.isLowerTargetIncluded())return n.cancelChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Deactivate_LowerInc});if(!u.isValidated)return n.setLowerTarget(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});if(!i.length>0)return n.setLowerTarget(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Cannot_Clear_Value});p="min";break;case"upperTarget":if(!i&&n.isUpperTargetIncluded())return n.cancelChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Deactivate_UpperInc});if(!u.isValidated)return n.setUpperTarget(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});if(!i.length>0)return n.setUpperTarget(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Cannot_Clear_Value});p="max";break;case"displayTarget":if(!u.isValidated)return n.setDisplayTarget(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});if(!i.length>0)return n.setDisplayTarget(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Cannot_Clear_Value});p="target";break;case"lowerRoutineReleaseLimit":if(!u.isValidated)return n.setLowerRoutineReleaseLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});if(!i.length>0)return n.setLowerRoutineReleaseLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Cannot_Clear_Value});p="lowerRoutineReleaseLimit";break;case"upperRoutineReleaseLimit":if(!u.isValidated)return n.setUpperRoutineReleaseLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});if(!i.length>0)return n.setUpperRoutineReleaseLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Cannot_Clear_Value});p="upperRoutineReleaseLimit";break;case"lowerSpecificationLimit":if(!u.isValidated)return n.setLowerSpecificationLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});if(!i.length>0)return n.setLowerSpecificationLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Cannot_Clear_Value});p="lowerSpecificationLimit";break;case"upperSpecificationLimit":if(!u.isValidated)return n.setUpperSpecificationLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});if(!i.length>0)return n.setUpperSpecificationLimit(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Cannot_Clear_Value});p="upperSpecificationLimit";break;case"title":p="title";break;case"description":p="description";break;case"notes":p="notes";break;case"displayUnit":p="storageUnit";break;case"dimension":p="dimension";break;case"charPrecision":if(p="precision",!i)return n.setCharPrecision(a),void n.acceptChanges();break;case"priority":if(!i)return n.setPriority(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.info_clearPriority});if(isNaN(i)||i.contains(".")&&i.lastIndexOf(".")+1===i.length||parseInt(i)<0||i.contains("-0"))return n.setPriority(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.Err_Priority});if(5<i.length)return n.setPriority(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.err_priorityLength});p="priority";break;case"missedTargetAction":if(!i)return n.cancelChanges(),void c.displayNotification({eventID:"error",msg:g.Err_MissedTargetAction});p="missedTargetAction";break;case"displayLowerTargetIncluded":if(p="isMinIncluded",i&&!n.getLowerTarget())return n.setUpperTargetIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.updateMin});if(!(i||parseFloat(n.getLowerTarget())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getLowerTarget())!==parseFloat(n.getUpperTarget())))return n.setLowerTargetIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.LowerIncCannotDeactivate});if(!u.isValidated)return n.setLowerTargetIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});p="isMinIncluded";break;case"displayUpperTargetIncluded":if(p="isMaxIncluded",i&&!n.getUpperTarget())return n.setUpperTargetIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.updateMax});if(!(i||parseFloat(n.getUpperTarget())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getUpperTarget())!==parseFloat(n.getLowerTarget())))return n.setUpperTargetIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.UpperIncCannotDeactivate});if(!u.isValidated)return n.setUpperTargetIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});p="isMaxIncluded";break;case"displayLowerRoutineIncluded":if(p="isLowerRoutineReleaseLimitIncluded",i&&!n.getLowerRoutineReleaseLimit())return n.setLowerRoutineIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.updateLowerRoutine});if(!(i||parseFloat(n.getLowerRoutineReleaseLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getLowerRoutineReleaseLimit())!==parseFloat(n.getUpperRoutineReleaseLimit())))return n.setLowerRoutineIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.LowerRoutineIncCannotDeactivate});if(!u.isValidated)return n.setLowerRoutineIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});p="isLowerRoutineReleaseLimitIncluded";break;case"displayUpperRoutineIncluded":if(p="isUpperRoutineReleaseLimitIncluded",i&&!n.getUpperRoutineReleaseLimit())return n.setUpperRoutineIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.updateUpperRoutine});if(!(i||parseFloat(n.getUpperRoutineReleaseLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getUpperRoutineReleaseLimit())!==parseFloat(n.getLowerRoutineReleaseLimit())))return n.setUpperRoutineIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.UpperRoutineIncCannotDeactivate});if(!u.isValidated)return n.setUpperRoutineIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});p="isUpperRoutineReleaseLimitIncluded";break;case"displayLowerSpecificationIncluded":if(p="isLowerSpecificationLimitIncluded",i&&!n.getLowerSpecificationLimit())return n.setLowerSpecificationIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.updateLowerSpecification});if(!(i||parseFloat(n.getLowerSpecificationLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getLowerSpecificationLimit())!==parseFloat(n.getUpperSpecificationLimit())))return n.setLowerSpecificationIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.LowerSpecificationIncCannotDeactivate});if(!u.isValidated)return n.setLowerSpecificationIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});p="isLowerSpecificationLimitIncluded";break;case"displayUpperSpecificationIncluded":if(p="isUpperSpecificationLimitIncluded",i&&!n.getUpperSpecificationLimit())return n.setUpperSpecificationIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.updateUpperSpecification});if(!(i||parseFloat(n.getUpperSpecificationLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getUpperSpecificationLimit())!==parseFloat(n.getLowerSpecificationLimit())))return n.setUpperSpecificationIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:g.UpperSpecificationIncCannotDeactivate});if(!u.isValidated)return n.setUpperSpecificationIncluded(a),n.acceptChanges(),void c.displayNotification({eventID:"error",msg:u.msg});p="isUpperSpecificationLimitIncluded";break;case"newAcceptanceLimits":p="target"}if("storageUnit"==p){let e=n.getDimensionId();d[p]=s.dimensionId_uomValue_To_uomId[e+":"+i]?s.dimensionId_uomValue_To_uomId[e+":"+i]:i}else if("priority"==p)d[p]=parseInt(i);else if("missedTargetAction"==p)d[p]=s.missedTargetActionMap[i];else if(p)d[p]=i;else if(t.dataIndex.contains("||")){d.customerAttributes={};let e=t.dataIndex.split("||"),n=e[0],s=e[1],o=t.nodeModel.getAttributeValue(t.dataIndex+"_type");if(1==r&&(""==i||null==i))return t.nodeModel.setAttribute(t.dataIndex,a),void c.displayNotification({eventID:"error",msg:g.mandatory_extensions_failure});"integer"!==o||isNaN(i)||t.nodeModel.setAttribute(t.dataIndex,parseInt(i)),d.customerAttributes[n]={[s]:i}}d.type=n.getTypeActualName(),e.grid.unselectAll(),t.nodeModel.select(),e.service.updateCharacteristicsData(d,n.getParent().getPhysicalId(),n.getPhysicalId()).then(function(t){var i=JSON.parse(t);i&&(n.syncModel(d),i.data.revisionid&&""!==i.data.revisionid&&n.setPhysicalId(i.data.revisionid),n.acceptChanges(),c.displayNotification({eventID:"success",msg:g.Perf_Char_Updated}),i.data.message&&""!==i.data.message&&c.displayNotification({eventID:"info",msg:i.data.message}),l.unmaskLoader(e.container)),Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues()}).catch(function(t){if(l.unmaskLoader(e.container),console.log(t),n.cancelChanges(),(i=JSON.parse(t)).errorMessage)var i=g.replace(g.get(g.Failure_Update),{errorMsg:i.errorMessage});Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues(),c.displayNotification({eventID:"error",msg:i}),l.unmaskLoader(e.container)})}}function m(e){return e.length&&e.length>5e3?(c.clearNotifications(),c.displayNotification({eventID:"warning",msg:g.Warning_Max_Char_Length}),e.substring(0,5e3)):e}})},addEvents:function(){var t=this;t.grid.getCellsXSO().onPostAdd(function(i){if(i&&e.is(i,"array")&&1==i.length){t.grid.unselectAll(),!i[0].nodeModel._canBeGrouped()?setTimeout(function(){i[0].nodeModel.select()},50):i[0].nodeModel.select()}}),t.grid.addEventListener("dragstart",function(e,t){t.nodeModel&&(u.dragStartedInXSR=!0)}),t.grid.addEventListener("dragend",function(e,i){i.nodeModel&&(u.dragStartedInXSR=!1);var a={modelEvents:t.modelEvents};t.service=new p(a);var n=i.nodeModel._parentNode.getChildren(),r=i.nodeModel._parentNode.getTreeDocument().getSelectedNodes()[0].getPhysicalId();i.nodeModel._parentNode.getTreeDocument().getSelectedNodes()[0].getTitle();for(let e=0;e<n.length;e++){var s={};s.sequenceNumber=e+1,s.characteristicsid=r,s.title=n[e].options.grid.title,r==n[e].getPhysicalId()&&t.service.reorderchar(s,i.nodeModel.getParent().getID(),r).catch(function(e){c.displayNotification({eventID:"error",msg:g.Error_NoAccess_Resequence})})}});var i=function(e){var i=t.grid.layout.getDataIndexFromColumnIndex(e.columnID),a=(t.grid.getColumnOrGroup(e.columnID).text,t.grid.getColumnOrGroup(e.columnID)._parent,e.cellModel),n=(e.nodeModel,e.nodeModel?e.nodeModel.getReferenceValue(i):void 0);n=n&&Array.isArray(n)?n[0]:n;var r="string"==typeof a?a.trim():a;r instanceof Date&&(r=u.convertDateToStandard(r)),r!==n&&t.modelEvents.publish({event:d.EVENT_SAVE_CHAR,data:{nodeModel:e.nodeModel,cellId:e.cellID,newValue:r,oldValue:n,dataIndex:i}})};this.grid.addEventListener("preEdit",function(e,i){var a=t.grid.layout.getDataIndexFromColumnIndex(i.columnID),n=(o.hasValidationValueFields(a,d.LIMIT_VALUE_FIELDS),t.grid.getTreeDocument()._charRefModels);if(n.length>0)if(i.rowID!==n[0]._rowID)t.removeErrors();else if(i.rowID==n[0]._rowID){var r=n[0]._referenceValues;for(var s in r){var c=o.hasValidationValueFields(s,d.LIMIT_VALUE_FIELDS),l=n[0].isInvalidNo();if(s==a)break;c?c&&!l&&t.removeErrors():t.removeErrors()}}}),this.grid.addEventListener("change",function(e,a){void 0===a||"boolean"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"UWAObject"!=t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"independantBoolean"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"string"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"textBlock"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"datetime"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)||i(a)}),t.modelEvents.subscribe({event:"update-acceptance-limits"},function(e){console.log(e),i(e.cellInfos)})},removeErrors:function(){c.clearNotifications(),this.modelEvents.publish({event:d.EVENT_HIDE_RESET_COMMAND}),this.grid.getTreeDocument().cancelChanges()},hide:function(){this.container.setStyle("display","none")},show:function(){this.container.setStyle("display","block")},personalizeColumns:function(){this.grid.showCustomViewsDialog()},deleteLimitValues:function(){for(var e in this.limitValues)delete this.limitValues[e]},destroy:function(){for(var e in c.clearNotifications(),this.limitValues)delete this.limitValues[e];this.eventList&&this.eventList.length>0&&this.modelEvents.unsubscribeList(this.eventList)}})});