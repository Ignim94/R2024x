define("DS/ENOCharacteristicsApp/ENOCharacteristicsApp",["UWA/Core","UWA/Promise","DS/Controls/Abstract","DS/ENOCharacteristicsApp/utils/RequestUtil","DS/ENOCharacteristicsApp/CharacteristicsGridView/CharacteristicsGridView","DS/ENOCharacteristicsApp/controls/CharacteristicsControl","DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper","DS/ENOCharacteristicsApp/utils/Constants","DS/ENOCharacteristicsApp/utils/CharacteristicsEvents","DS/ENOCharacteristicsApp/utils/CharacteristicsUtils","DS/ENOCharacteristicsApp/utils/CharacteristicsMask","DS/SpecGridView/utils/GridUtil","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/PlatformAPI/PlatformAPI","text!DS/ENOCharacteristicsApp/assets/config/CharacteristicsColumnConfig.json","text!DS/ENOCharacteristicsApp/assets/config/CharacteristicsToolBarCommands.json","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp","css!DS/ENOCharacteristicsApp/ENOCharacteristicsApp.css"],function(e,t,i,r,a,s,o,c,n,l,d,p,h,u,C,m,f,E){"use strict";return i.extend({init:function(e){this.setPreReqConfigs();var t=e;this.itemId=t.itemId,this.appCore=e.appCore,this.specModel=e.specModel,this.currentTabKey=e.currentTabKey,this.currentView=widget.getValue(c.VIEW_PERSISTANCE_KEY),this.currentView||(this.currentView=c.TOOLBAR_VIEW_REVISED);var i=t.specModel;i&&(this.itemTitle=i._options.title,this.accessOnItem=i._options.currentAccess,this.itemMaturity=i._options.maturity),this.container=t.container,e.appCore&&e.appCore.WorkUnderContext&&(r.workUnderIsSet=!0,r.setWorkUnderHeaders(e.appCore.WorkUnderContext.getWorkUnderHeaders())),this.modelEvents=new n,this.appCore.perfSpecAsPlugin&&!this.appCore.specViewerModelEvents&&(this.appCore.specViewerModelEvents=this.appCore.basicModelEvents),this._characteristicsColumns=JSON.parse(m),this._charSubscriptionList=[],this.appCoreSubList=[],this.specViewerEventList=[],this._subscribeEvents();var a={modelEvents:this.modelEvents,appCore:this.appCore};this.service=new o(a)},_subscribeEvents:function(){var e=this;e.platformSubs=[],e._charSubscriptionList.push(e.modelEvents.subscribe({event:c.CHARACTERISTICS_GRID_TOTAL_SELECTED_NODES},function(t){e.selectedGridCount=t.count,e.selectedGridNodes=t.currentModel,e.setToolbarCommandsState(t)})),e._charSubscriptionList.push(e.appCore.basicModelEvents.subscribe({event:c.EVENT_LAUNCH_PREV_NEXT_COMMAND},function(t){e.evt_LanchPrevNextCommand(t)})),e._charSubscriptionList.push(e.modelEvents.subscribe({event:"chargrid-delete-node-successfull-characterstics"},function(t){e.charGrid.removeRootNodes(t)})),e.appCoreSubList.push(e.appCore.basicModelEvents.subscribe({event:c.EVENT_CREATE_PERF_CHAR},t=>{t.select(),e.charControl.launchCreateForm({isSpecificationLimitsDisabled:e.appCore.isSpecificationLimitsDisabled,isRoutineReleaseLimitsDisabled:e.appCore.isRoutineReleaseLimitsDisabled,charContainer:e._charContainer},c.CHARACTERISTICS_CREATE)}),e.appCore.basicModelEvents.subscribe({event:"refresh-spec-viewer-or-grid"},()=>{e.appCore&&e.appCore.WorkUnderContext&&(r.workUnderIsSet=!0,r.setWorkUnderHeaders(e.appCore.WorkUnderContext.getWorkUnderHeaders()))}),e.appCore.basicModelEvents.subscribe({event:"test-methods-floating-panel"},t=>{e.charControl.testMethodsDialog({selectedNodes:e.selectedGridNodes,appCore:e.appCore}),console.log(t)})),e.specViewerEventList.push(e.appCore.specViewerModelEvents.subscribe({event:c.TRIGGER_DELETE_SPEC_CHAR},t=>{e.dataGrid.getTreeDocument().unselectAll(),t[0].select();var i={};i.parentId=e.itemId,i.modelEvents=e.modelEvents,i.container=e.container,e.charControl.deleteCharNodes(i)})),e._charSubscriptionList.push(e.modelEvents.subscribe({event:"grid-toolbar-action-click-characterstics"},function(t){var i={};i.parentId=e.itemId,i.charContainer=e._charContainer,i.container=e.container;var r={};r.parentId=e.itemId,r.modelEvents=e.modelEvents,r.container=e.container;var a={};if(a.selectedGridCount=e.selectedGridCount,a.selectedGridNodes=e.selectedGridNodes,t)switch(t){case"CreateSpecification":e.charControl.launchCreateForm(i,t);break;case"CreateCharacteristics":i.isSpecificationLimitsDisabled=e.appCore.isSpecificationLimitsDisabled,i.isRoutineReleaseLimitsDisabled=e.appCore.isRoutineReleaseLimitsDisabled,e.charControl.launchCreateForm(i,t);break;case"DeleteCharacteristics":e.charControl.deleteCharNodes(r);break;case"Export":e.charControl.exportGrid();break;case"Personalize":e.charControl.personalize();break;case c.CMD_MATURITY:e.charControl.maturityStateControl(e.selectedGridNodes);break;case c.CMD_REVISION:e.charControl.revisionControl(e.selectedGridNodes);break;case c.TOOLBAR_VIEW_RELEASED:case c.TOOLBAR_VIEW_REVISED:case c.TOOLBAR_VIEW_ALL:e.currentView=widget.getValue("performanceSpecView"),e.toggleView();break;case"DuplicateCharacteristics":e.charControl.duplicateCharNodes(e.selectedGridNodes);break;case"PerfSpec_Information_Panel":e.charControl.informationDialog(e.selectedGridNodes);break;case"SyncPerformanceSpecs":e.charControl.syncPerformanceSpecs(e.itemId);break;case"AddExtensions":e.charControl.addExtensions(e.itemId)}})),e.platformMaturity=C.subscribe("DS/PADUtils/PADCommandProxy/refresh",t=>e.evt_PostMaturityUpdate(t)),e.platformLifecycle=C.subscribe("Lifecycle.Modification",t=>e.evt_PostLifecycleUpdate(t)),e.platformSubs.push(this.platformMaturity,this.platformLifecycle)},render:function(){this._charContainer=e.createElement("div",{class:"datagrid-char-container"}).inject(this.container)},initializeCharGrid:function(){(i=this)._charContainer=i._charContainer?i._charContainer:e.createElement("div",{class:"datagrid-char-container"}),i._charContainer.inject(i.container);var t={appCore:this.appCore,currentTabKey:this.currentTabKey,itemId:this.itemId,enableInteractiveRightPanel:!0,enableCrossWidgetFeature:!0,itemId:this.itemId,itemTitle:this.itemTitle,container:i._charContainer,modelEvents:this.modelEvents,parentModel:this.specModel},i=(JSON.parse(f),this);this.service.getMeasurementCharacteristicLimitsConfiguration().then(function(e){i.appCore.isRoutineReleaseLimitsDisabled=e.isRoutineReleaseLimitsDisabled,i.appCore.isSpecificationLimitsDisabled=e.isSpecificationLimitsDisabled,i.getCharacteristics(),i.charGrid=new a(t)})},loadAllDimensionDisplayUnits:function(){var e=this;return new t(function(t,i){e.service.getDimensionDisplayUnitSet().then(function(e){l.allDimensionSet=JSON.parse(e),l.processDimensionDisplayUnit(),t()}).catch(function(e){var t=E.Message_ErrorFetchAllDimension;i(t)})})},initTypeList:function(){var e=[],t=[],i={};this.service.getType().then(function(r){var a=r;if(Object.keys(a).length>0){var s=a;Object.keys(a).forEach(function(r){e.push({labelItem:s[r],valueItem:r}),t.push(r),i[r]=s[r]})}e.push({labelItem:E.type_PerformanceSpec,valueItem:c.TYPE_PERFORMANCE_SPEC}),i[c.TYPE_PERFORMANCE_SPEC]=E.type_PerformanceSpec,t.push("PerformanceSpec"),l.allTypeSet=e,l.allTypeList=t,l.allTypesMap=i,u.performanceSpec=t})},getCharacteristics:function(){var e=this;e.service.getSpecData([e.itemId],!1).then(function(t){let i=t.listNodes,r=t.extensionAttributesColumnInfo;l.extensionsInfo=r,e.charGrid.setColumns(e._characteristicsColumns.columns.concat(r)),e.charGrid.render({withDefaultColumns:!1});var a=e.getToolbarCommands();e.charGrid.setToolBarActions({actions:a}),e.dataGrid=e.charGrid.gridManager.grid;var o={charGrid:e.charGrid,dataGrid:e.dataGrid,itemTitle:e.itemTitle,itemMaturity:e.itemMaturity,physicalPrdModel:e.specModel,modelEvents:e.modelEvents,specViewerModelEvents:e.appCore.specViewerModelEvents,appCore:e.appCore};if(e.charControl=new s(o),i&&i.length>0){new Map;d.maskLoader(e.container,E.Loading);for(var c=0;c<i.length;c++){var n=i[c];n.appCore=e.appCore,e.charGrid.addRootNodes(n,!1)}e.charGrid.checkAndUpdatePersistency(),e.toggleView(),d.unmaskLoader(e.container)}e.setToolbarCommandsState({count:0})}).catch(function(e){console.log(e),console.log(e+E.Message_ErrorLoadCharacteristics)})},getToolbarCommands:function(){return JSON.parse(f).actions.filter(e=>"DELRME_AP"===widget.data.appId||"DELRMEC_AP"===widget.data.appId||"PerfSpec_Information_Panel"!==e.key&&"SyncPerformanceSpecs"!==e.key)},setPreReqConfigs:function(){var e=this,i=[];r.set3DSpaceURL().then(function(a){i.push(r.setSecurityContext()),i.push(r.setCSRFToken()),t.all(i).then(function(){e.loadAllDimensionDisplayUnits().then(function(){e.initTypeList(),setTimeout(()=>{e.initializeCharGrid()},500)}).catch(function(e){console.error(e)})}).catch(function(e){console.log(e),console.error("Error in getting PreReqs for characteristics")})})},setToolbarCommandsState:function(e){let t=this,i=[c.CMD_MATURITY,c.CMD_REVISION,c.CMD_DELETE,c.CMD_INFORMATION,c.CMD_DUPLICATE,c.CMD_ADDEXTENSIONS],r=function(){if(e.count<=1)return!1;let t=null;return!e.currentModel.every(e=>null==t?(t=u.isPerformanceCharacteristics(e.getTypeActualName())?c.TYPE_PERFORMANCE_CHAR:e.getTypeActualName(),!0):u.isPerformanceCharacteristics(e.getTypeActualName())?t===c.TYPE_PERFORMANCE_CHAR:!(!u.isPerformanceSpecification(t)||!u.isPerformanceSpecification(e.getTypeActualName()))||t===e.getTypeActualName())},a=function(){let t=[];for(let i=0;i<e.currentModel.length;i++){if(e.currentModel[i].getAttributeValue("isDerivedSpec")||!1){t.push(c.CMD_MATURITY,c.CMD_REVISION);break}}return t},s=function(){let i=!1,a=!1,s=!1,o=e.productMaturity?"IN_WORK"!=e.productMaturity:t.specModel.isBeyondInWork(),n=[],d=l.allTypeList.includes(e.currentModel[0].getTypeActualName()),p=0;return(i=r())||(d?p=e.currentModel[0].getRevision():(s=function(){let t=null;return!e.currentModel.every(e=>null==t?(t=e.getParent().getID(),!0):t===e.getParent().getID())}(),p=e.currentModel[0].getParent().getRevision())),((a=0!==e.count&&!e.currentModel.every(e=>{let t=u.isPerformanceSpecification(e.getTypeActualName())&&e.isInWork(),i=u.isPerformanceCharacteristics(e.getTypeActualName())&&e.getParent().isInWork();return t||i}))||s||i||o&&(!d||1==p))&&n.push(c.CMD_DELETE,c.CMD_DUPLICATE),!i&&d&&n.push(c.CMD_DUPLICATE),(a||o)&&n.push(c.CMD_ADDEXTENSIONS),n};if(0===e.count)t.charGrid.toolbar.disableCommands(i);else if(e.count>1){let o=[c.CMD_INFORMATION,c.CMD_REVISION,c.CMD_ADDEXTENSIONS],n=s(),l=a();(r()||u.isPerformanceCharacteristics(e.currentModel[0].getTypeActualName()))&&o.push(c.CMD_MATURITY),n.includes(c.CMD_DELETE)&&o.push(c.CMD_DELETE),n.includes(c.CMD_DUPLICATE)&&o.push(c.CMD_DUPLICATE),l.length>0&&(o=[...o,...l]),t.charGrid.toolbar.enableCommands(i),t.charGrid.toolbar.disableCommands(o)}else{let r=[],o=s(),n=function(){let t=[];return u.isPerformanceCharacteristics(e.currentModel[0].getTypeActualName())&&t.push(c.CMD_INFORMATION,c.CMD_REVISION,c.CMD_MATURITY),u.isPerformanceSpecification(e.currentModel[0].getTypeActualName())&&t.push(c.CMD_DUPLICATE),t}(),l=function(){let t=[];return u.isPerformanceSpecification(e.currentModel[0].getTypeActualName())&&(e.currentModel[0].isInWork()||e.currentModel[0].isFrozen())&&t.push(c.CMD_REVISION),t}(),d=a();r=o.concat(n,l,d),r=new Set(r),r=Array.from(r),t.charGrid.toolbar.enableCommands(i),t.charGrid.toolbar.disableCommands(r)}},toggleView:function(){let e=this.charGrid.model.getAllDescendants();const t=function(t){e.forEach(e=>{e&&e._canBeGrouped()&&u.isPerformanceSpecification(e.getTypeActualName())&&e.isObsolete()&&(t?e.show():e.hide())})};this.currentView===c.TOOLBAR_VIEW_RELEASED?(e.forEach(e=>{e&&e._canBeGrouped()&&u.isPerformanceSpecification(e.getTypeActualName())?e.isReleased()?e.show():e.hide():e&&e._canBeGrouped()&&u.isPerformanceCharacteristics(e.getTypeActualName())&&(e.getParent().isReleased()?e.show():e.hide())}),t(!1)):this.currentView===c.TOOLBAR_VIEW_REVISED?(e.forEach(e=>{e&&e._canBeGrouped()&&u.isPerformanceSpecification(e.getTypeActualName())?e.isLastRevision()?e.show():e.hide():e&&e._canBeGrouped()&&u.isPerformanceCharacteristics(e.getTypeActualName())&&(e.getParent().isLastRevision()?e.show():e.hide())}),t(!1)):this.currentView===c.TOOLBAR_VIEW_ALL&&e.forEach(e=>{e&&e._canBeGrouped&&u.isPerformanceSpecification(e.getTypeActualName())?e.show():e&&e._canBeGrouped()&&u.isPerformanceCharacteristics(e.getTypeActualName())&&e.show()})},evt_PostMaturityUpdate:function(e){var t=this;if(e.data.authored&&e.data.authored.modified){let r=e.data.authored.modified,a=new Map,s=t.charGrid.model.getAllDescendants();var i=[];for(let e=0;e<s.length;e++){let t=s[e].getAttributeValue(["ds6w:type_value"]);l.allTypeList.includes(t)&&i.push(s[e])}i.forEach(e=>{r.includes(e.getID())&&a.set(e.getID(),e)}),r.forEach(function(e){t.service.getSpecDataById(t.itemId,e,!1).then(i=>{let r=[];r.push(c.CMD_ADD),r.push(c.CMD_ADDEXTENSIONS),r.push(c.CMD_DELETE);var s=i.current;t.itemId==e&&(t.setToolbarCommandsState({count:t.selectedGridCount,currentModel:t.selectedGridNodes,productMaturity:s}),"IN_WORK"!==s?t.charGrid.toolbar.disableCommands(r):t.charGrid.toolbar.enableCommands(r));let o=a.get(e);void 0!==o&&(o.syncModel(i),"IN_WORK"!=o.getMaturityActualName()?t.charGrid.toolbar.disableCommands(r):t.charGrid.toolbar.enableCommands(r)),t.dataGrid.updateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}).catch(e=>console.log(e)).finally(()=>{console.log("Maturity updated."),t.dataGrid.getTreeDocument().acceptChanges(),t.toggleView()})})}},evt_PostLifecycleUpdate:function(e){let t=this;if(e&&"string"==typeof e&&(e=JSON.parse(e)),e.Refresh){let o=t.dataGrid.getTreeDocument().getSelectedNodes()[0];if(e.Refresh.created&&e.Refresh.created.length>0&&e.Refresh.created[0].sourceObjectId===o.getID()){var i=e.Refresh.created;Array.isArray(i)||(i=Array.from(i)),i.forEach(e=>{t.service.getSpecDataById(t.itemId,e.physicalid,!0).then(e=>{t.modelEvents.publish({event:"specification-created",data:{specRowData:e}})}).catch(e=>console.log(e)),t.service.getSpecDataById(t.itemId,e.sourceObjectId,!0).then(e=>{o.syncModel(e),t.toggleView()}).catch(e=>console.log(e))})}else if(e.Refresh.deleted&&e.Refresh.deleted.length>0)console.log("Deleted from lifecycle");else if(e.Refresh.modified&&e.Refresh.modified.length>0){var r="",a="";if(c.MATURITY_RELEASED==e.Refresh.modified[0].state){let i=t.charGrid.model.getAllDescendants();var s=[];for(let e=0;e<i.length;e++){let t=i[e].getAttributeValue(["ds6w:type_value"]);l.allTypeList.includes(t)&&s.push(i[e])}s.forEach(t=>{e.Refresh.modified[0].physicalid==t.getNextRevisionID()&&c.MATURITY_RELEASED==t.getMaturityActualName()&&(r=t,a=t.getPhysicalId())})}r&&c.MATURITY_RELEASED==r.getMaturityActualName()&&t.service.getSpecDataById(t.itemId,a,!0).then(e=>{r.syncModel(e),t.toggleView()}),console.log("modified from lifecycle")}}},evt_LanchPrevNextCommand:function(e){var t=e.move,i=e.itemId,r=this.selectedGridNodes,a=this.selectedGridCount;if(r&&!r||!(a<=0||a>1)?(r=Array.isArray(r)?r[0]:r)&&r.getID()!==i&&(r=(new p).getModelById(i,this.dataGrid)):r=(new p).getModelById(i,this.dataGrid),r&&r.getID()===i){var s=h.getValidPreviousorNextNode(r,t);s&&(this.charGrid.unselectAll(),this.gridViewInstance=this.charGrid.getGridViewInstance(),this.gridViewInstance&&this.gridViewInstance.ensureNodeModelVisible(s),s.select())}},destroy:function(){var e=this;console.log("Performance Specification destroyed"),e._charContainer&&e._charContainer.destroy(),setTimeout(()=>{e.charGrid&&e.charGrid.destroy()},1e3),this._charSubscriptionList&&(this.modelEvents.unsubscribeList(this._charSubscriptionList),this.appCore.specViewerModelEvents.unsubscribeList(this.specViewerEventList),this.appCore.basicModelEvents.unsubscribeList(this.appCoreSubList)),this.platformSubs&&this.platformSubs.length>0&&this.platformSubs.forEach(function(e){C.unsubscribe(e)})}})});