define("DS/ENODerivedFormatManagement/Views/DerivedFormatCreate",["UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/Input/Select","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/ENODerivedFormatManagement/Models/DerivedFormatRule","DS/ENODerivedFormatManagement/Views/ParamListView","text!DS/ENODerivedFormatManagement/assets/templates/edfm.formatparams.html","text!DS/ENODerivedFormatManagement/assets/templates/edfm.form.html","DS/ENODerivedFormatManagement/Utils/DerivedFormatUtil","DS/ENO6WPlugins/jQuery","DS/ENO6WPlugins/jQueryUI","DS/Controls/TooltipModel","DS/Controls/Toggle"],function(e,t,n,a,r,o,i,d,l,s,c,m,u,f){var v,g,p,y,D;return e.extend({className:"derivedformatformview",viewMe:this,disableFields:!1,id:function(){return"derivedformatformview"},setup:function(e){var t=this;t.selection=e.selection,t.superModal=new r,t.superModal.dialog({closable:!0,body:t.getForm(),title:t.selection?derivedformatmanagementinfra.getNLSData().label.editRuleTitle:derivedformatmanagementinfra.getNLSData().label.createRuleTitle}),t.addforceUpdateCheckbox(),t.setupEvent()},addforceUpdateCheckbox:function(){var e=v.getDocument().getElementById("derivedformatfield-forceupdate-container");(D=new f({type:"checkbox",label:derivedformatmanagementinfra.getNLSData().label.forceUpdate,id:"derivedformatfield-forceupdate",touchMode:!0})).inject(e)},setupEvent:function(){var e=this;viewMe=this,v.getDocument().getElementById("derivedformatfield-converter").addEventListener("change",e.resetConverterForms.bind(null,e)),v.getDocument().getElementById("derivedformatfield-connector").addEventListener("change",e.resetFormFields.bind(null,e)),v.getDocument().getElementById("derivedformatfield-event").addEventListener("change",e.switchEventField.bind(null,e)),v.getDocument().getElementById("derivedformatfield-source").addEventListener("change",e.switchSourceFormat.bind(null,e)),v.getDocument().getElementById("derivedformatfield-target").addEventListener("change",e.switchTargetFormat.bind(null,e)),v.getDocument().getElementById("btnActionSubmit").addEventListener("click",e.save.bind(null,e)),v.getDocument().getElementById("btnActionCancel").addEventListener("click",e.cancel.bind(null,e)),e.switchEventField(),e.switchTargetFormat()},populateData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);t[n].selected&&(a.selected=!0),e.add(a)}},populateSourceData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);t[n].selected&&(a.selected=!0),t[n].partExtension&&(a.dataset.partextension=t[n].partExtension),t[n].subType&&(a.dataset.subtype=t[n].subType),a.dataset.type=t[n].type,e.add(a)}},populateEventData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);a.lifecycle=t[n].lifecycle,e.add(a)}},refresh:function(){},getForm:function(){g=new i({selection:(y=this).selection,parameters:y.selection?y.selection.get("parameters"):{}});var e,n,a,r,o,s,c,m,u,f,p;t.compile(d);v=UWA.createElement("div",{id:"divCreateDerivedFormatFormContainer"}),y.selection&&(y.disableFields=!0,e=y.selection.get("converter"),n=y.selection.get("category"),a=y.selection.get("source"),r=y.selection.get("target"),o=y.selection.get("event"),s=y.selection.get("inputStreamId"),c=y.selection.get("outputStreamId"),m=y.selection.get("partExtension"),u=y.selection.get("subType"),f=y.selection.get("sourceType"),p=y.selection.get("forceUpdate"));var y,D=t.compile(l),E=(y=this).getConverters();e||(e=E.find(e=>e.selected).value);var h=y.getConnectors(e);n||(n=h.find(e=>e.selected).value);var I=y.getSourceFormats(e,n);a||(a=I.find(e=>e.selected).value,f=I.find(e=>e.selected).type,m=I.find(e=>e.selected).partExtension,u=I.find(e=>e.selected).subType);var b=y.getEvents(e,n);o||(o=b.find(e=>e.selected).value);var S=y.getTargetFormats(e,n,a,f);if(r||(r=S.find(e=>e.selected).value),!s||!c){var w=y.getStreamIds(e,n,a,f,r);s=w.inputStreamId,c=w.outputStreamId}return v.setHTML(D({labels:derivedformatmanagementinfra.getNLSData().label,buttons:derivedformatmanagementinfra.getNLSData().button,converters:E,connectors:h,events:y.getEvents(e,n),activation:y.getActivation(e,n,o),states:y.getStates(e,n,a),sources:I,sourceFormat:a,targets:S,disableFields:y.disableFields,inputStreamId:y.inputStreamId,outputStreamId:y.outputStreamId,partExtension:m,subType:u,sourceType:f,forceUpdate:p})),v.getElementsByClassName("derivedformatfield-formatparams")[0].append(g.getContent()),v},switchEventField:function(e){var t=v.getDocument().getElementById("derivedformatfield-event"),n=v.getDocument().getElementById("derivedformatfield-activation"),a=v.getDocument().getElementById("derivedformatfield-outputStreamId").value,r=t.selectedOptions[0].value;if((r||a)&&("checkin"==r||"onXCADSave"==r||"linkable"==a||"authoringvisu"==a?(D.checkFlag=!1,D.disabled=!0):D.disabled=!1),this.selection&&1==this.selection.get("forceUpdate")&&(D.checkFlag=!0),t&&t.selectedOptions[0]){var o=t.selectedOptions[0];"yes"==o.lifecycle||"yes"==o.getAttribute("lifecycle")?v.getDocument().getElementById("derivedformatfield-state-container").style.display="block":v.getDocument().getElementById("derivedformatfield-state-container").style.display="none";var i=viewMe.getActivation("","",o.value);viewMe.populateData(n,i),viewMe.fieldActivationTest(i,n)}},cancel:function(e){e.superModal.modals.current.hide()},switchSourceFormat:function(){var e=v.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=v.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value,n=v.getDocument().getElementById("derivedformatfield-source").selectedOptions[0].value,a=v.getDocument().getElementById("derivedformatfield-source").selectedOptions[0].dataset.type;v.getDocument().getElementById("derivedformatfield-sourceFormat").value=n;var r=v.getDocument().getElementById("derivedformatfield-target"),o=viewMe.getTargetFormats(e,t,n,a);viewMe.populateData(r,o),viewMe.fieldActivationTest(o,r);var i=v.getDocument().getElementById("derivedformatfield-state"),d=viewMe.getStates(e,t,n);viewMe.populateData(i,d),viewMe.switchTargetFormat()},resetConverterForms:function(){var e=v.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=v.getDocument().getElementById("derivedformatfield-connector"),n=viewMe.getConnectors(e);viewMe.populateData(t,n),viewMe.fieldActivationTest(n,t),viewMe.resetFormFields()},fieldActivationTest:function(e,t){1==e.length?t.disabled=!0:0==viewMe.disableFields&&(t.disabled=!1)},resetFormFields:function(){var e=v.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=v.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value,n=v.getDocument().getElementById("derivedformatfield-event"),a=v.getDocument().getElementById("derivedformatfield-state"),r=v.getDocument().getElementById("derivedformatfield-source"),o=(v.getDocument().getElementById("derivedformatfield-target"),viewMe.getEvents(e,t));viewMe.populateEventData(n,o);var i=viewMe.getStates(e,t);viewMe.populateData(a,i);var d=viewMe.getSourceFormats(e,t);viewMe.populateSourceData(r,d),viewMe.fieldActivationTest(o,n),viewMe.fieldActivationTest(i,a),viewMe.fieldActivationTest(d,r),viewMe.switchSourceFormat(),viewMe.switchEventField()},switchTargetFormat:function(){var e,t,n,a,r;p&&p.destroy(),y&&y.destroy();var o=v.getDocument().getElementById("derivedformatfield-converter"),d=v.getDocument().getElementById("derivedformatfield-connector"),l=v.getDocument().getElementById("derivedformatfield-source"),s=v.getDocument().getElementById("derivedformatfield-target");o&&(t=o.selectedOptions[0].value),d&&(n=d.selectedOptions[0].value),l&&(a=l.selectedOptions[0].value,r=l.selectedOptions[0].dataset.type),s&&(e=s.selectedOptions[0].value);var c=viewMe.getStreamIds(t,n,a,r,e),m=v.getDocument().getElementById("derivedformatfield-inputStreamId"),f=v.getDocument().getElementById("derivedformatfield-outputStreamId");m&&(m.value=c.inputStreamId),f&&(f.value=c.outputStreamId),g=new i({selection:this.selection,parameters:this.selection?this.selection.get("parameters"):{},derivedForm:v});var E=v.getDocument().getElementById("derivedformatfield-event"),h=v.getDocument().getElementById("derivedformatfield-outputStreamId").value,I=E.selectedOptions[0].value;if((I||h)&&("checkin"==I||"onXCADSave"==I||"linkable"==h||"authoringvisu"==h?(D.checkFlag=!1,D.disabled=!0):D.disabled=!1),"authoring"!==m.value){var b=v.getDocument().getElementById("derivedformatfield-warning-icon");p=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-attention" style="font-size: 19px; height: 32px"></span>'}).inject(b);var S=m.value.toLowerCase(),w=r.toLowerCase();(B=derivedformatmanagementinfra.getNLSData().label[S+w])&&(B=B.replace("%1",e)),p.tooltipInfos=new u({shortHelp:B})}if("OnPremise"!==widget.getValue("x3dPlatformId")&&("OfficeDocumentConverter"==o.value||"3DEXPERIENCE"===n&&"CATPart"===e)){b=v.getDocument().getElementById("derivedformatfield-warning-icon");p=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-tokens" style="font-size: 19px; height: 32px"></span>'}).inject(b);var B=derivedformatmanagementinfra.getNLSData().label.creditConsumptionMsg;p.tooltipInfos=new u({shortHelp:B})}if(o&&d&&l&&s&&!s.disabled&&"3DEXPERIENCE"==o.value&&"SOLIDWORKS"==d.value&&"SLDPRT"==l.value&&"ExactGeometry"==s.value){v.getDocument().getElementById("edfm-derivedformatparamview-param-warning-row").style.display="";var M=v.getDocument().getElementById("edfm-derivedformatparamview-param-warning");UWA.createElement("span",{class:"edfm-derivedformatparamview-param-warning-msg",html:derivedformatmanagementinfra.getNLSData().label.polyhedralFalseWarning,styles:{}}).inject(M)}var T=v.getDocument().getElementById("derivedformatfield-forceupdate-tooltip");(y=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-info" style="font-size: 13px; height: 13px"></span>'}).inject(T)).tooltipInfos=new u({shortHelp:derivedformatmanagementinfra.getNLSData().label.forceUpdateExplain})},save:function(e){var t,n=e.getData(),a={};e.selection?((a=e.selection).set(n),t=a._previousAttributes):a=new o(n),a.get("deployed")&&!a.hasChanged()||(a.get("deployed")&&a.hasChanged()||"updated"==a.get("action")?a.set("action","updated"):a.set("action","created"));var r=e.isDuplicateRule(e,a);r&&a.isNew()?(a.set(t),e.superModal.modals.current.hide(),s.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.ruleExists})):!r&&n&&a.isValid()?(e.collection.add(a),e.superModal.modals.current.hide()):a.isNew()||(a.set(t),e.cancel(e),s.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.ruleExists}))},isDuplicateRule:function(e,t){var n=e.collection._models;for(var a in refModelAttr=t._attributes,n)if(modelAttr=n[a]._attributes,t.cid!=n[a].cid&&refModelAttr.converter===modelAttr.converter&&refModelAttr.source===modelAttr.source&&refModelAttr.target===modelAttr.target&&refModelAttr.event===modelAttr.event&&refModelAttr.category===modelAttr.category&&e.checkPartExtension(modelAttr,refModelAttr)&&e.checkSubType(modelAttr,refModelAttr)&&e.checkState(modelAttr,refModelAttr)&&e.checkParameters(modelAttr.parameters,refModelAttr.parameters))return console.log(),!0;return!1},checkPartExtension:(e,t)=>!e.partExtension||t.partExtension&&t.partExtension===e.partExtension,checkSubType:(e,t)=>!e.subType||t.subType&&t.subType===e.subType,checkState:function(e,t){return!e.state||t.state&&t.state===e.state},checkParameters:function(e,t){if(0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(Object.keys(e).length!==Object.keys(t).length)return!1;var n;if(Object.keys(e).length>0)for(var a in e)if(val=e[a],(n=t[a])!==val||void 0===n&&""==n)return!1;return!0},getData:function(){var e={};e.converter=v.getDocument().getElementById("derivedformatfield-converter").value,e.category=v.getDocument().getElementById("derivedformatfield-connector").value;var t=v.getDocument().getElementById("derivedformatfield-event").options.selectedIndex;if(e.event=v.getDocument().getElementById("derivedformatfield-event").value,e.forceUpdate=D.checkFlag,e.eventToDisplay=v.getDocument().getElementById("derivedformatfield-event").options[t]?v.getDocument().getElementById("derivedformatfield-event").options[t].innerHTML:"",e.activation=v.getDocument().getElementById("derivedformatfield-activation").value,"PROMOTE"==e.event||"promote"==e.event){var n=v.getDocument().getElementById("derivedformatfield-state").options.selectedIndex;e.state=v.getDocument().getElementById("derivedformatfield-state").value,e.stateToDisplay=v.getDocument().getElementById("derivedformatfield-state").options[n].innerHTML}else e.state="",e.stateToDisplay="";var a=v.getDocument().getElementById("derivedformatfield-source").options.selectedIndex;return e.source=v.getDocument().getElementById("derivedformatfield-source").value,e.sourceToDisplay=v.getDocument().getElementById("derivedformatfield-source").options[a].innerHTML,e.partExtension=v.getDocument().getElementById("derivedformatfield-source").options[a].dataset.partextension,e.subType=v.getDocument().getElementById("derivedformatfield-source").options[a].dataset.subtype,e.sourceType=v.getDocument().getElementById("derivedformatfield-source").options[a].dataset.type,e.target=v.getDocument().getElementById("derivedformatfield-target").value,e.updateOnly=!1,e.inputStreamId=v.getDocument().getElementById("derivedformatfield-inputStreamId").value,e.outputStreamId=v.getDocument().getElementById("derivedformatfield-outputStreamId").value,e.parameters=g.getData(),e},getConverters:function(){var e=derivedformatmanagementinfra.getInfraCollection(),t=new Array,n=e._models[0]._attributes.name;this.selection&&(n=this.selection.get("converter"));let a=derivedformatmanagementinfra.getNLSData().label.synchronous?derivedformatmanagementinfra.getNLSData().label.synchronous:"Synchronous, at save",r=derivedformatmanagementinfra.getNLSData().label.asynchronous?derivedformatmanagementinfra.getNLSData().label.asynchronous:"Asynchronous";return e.forEach(function(e,o){var i=!0===e.get("synchronous")||"true"===e.get("synchronous")?a:r;t.push({label:e.get("name")+" ("+i+")",value:e.get("name"),selected:e.get("name")==n})}),t.sort(function(e,t){var n=e.label.toUpperCase(),a=t.label.toUpperCase();return n<a?-1:n>a?1:0}),t},getConnectors:function(e){var t=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e}),n=new Array,a=t.get("connectors"),r=a[0].name;return this.selection&&(r=this.selection.get("category")),a.forEach(function(e,t){n.push({label:e.name,value:e.name,selected:e.name==r})}),n.sort(function(e,t){var n=e.label.toUpperCase(),a=t.label.toUpperCase();return n<a?-1:n>a?1:0}),n},getEvents:function(e,t){var n=new Array,a=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(a){var r=a.get("connectors").find(function(e,n){return e.name==t});if(r&&r.actions){var o=r.actions,i=o[0].name;this.selection&&(i=this.selection.get("event")),o.forEach(function(e,t){n.push({label:e.value,value:e.name,selected:e.name==i,lifecycle:"lifecycle"==e.maturityGraph?"yes":"no"})})}}return n},getActivation:function(e,t,n){var a=new Array,r=derivedformatmanagementinfra.getInfraCollection();!e&&v.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0]&&(e=v.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value),!t&&v.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0]&&(t=v.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value);var o=r.find(function(t,n){return t.get("name")==e});if(o){var i=o.get("connectors").find(function(e,n){return e.name==t});if(i&&i.actions){var d=i.actions.find(function(e,t){return e.name==n});if(d){var l=d.activation.split("|"),s=l[0];this.selection&&(s=this.selection.get("activation")),l.forEach(function(e,t){a.push({label:derivedformatmanagementinfra.getNLSData().label[e],value:e,selected:e==s})})}}}return a},getStates:function(e,t,n){var a=new Array,r=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(r){var o=r.get("connectors").find(function(e,n){return e.name==t});if(o&&o.actions){var i=o.actions,d=UWA.Array.detect(i,function(e){return"PROMOTE"==e.name||"promote"==e.name});if(d){var l=this.getSourceFormats(e,t).find(function(e,t){return e.value==n});if(l){var s=null;if(l.type.includes("Part")||l.type.includes("SEComponent")?s=d.states.Part:l.type.includes("Drawing")?s=d.states.Drawing:l.type.includes("Document")&&(s=d.states.Document),s){var c=s[0];this.selection&&(c=this.selection.get("state")),s.forEach(function(e,t){a.push({label:e.value,value:e.name,selected:e.name==c})})}}}}}return a},getTargetFormats:function(e,t,n,a){var r=new Array,o=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(o){var i=o.get("connectors").find(function(e,n){return e.name==t});if(i){var d=i.supportedformats.find(function(e,t){return e.source.name==n&&e.source.type==a});if(d){var l=d.targets[0].target;this.selection&&(l=this.selection.get("target")),d.targets.forEach(function(t,n){var a=t.target,o=a;derivedformatmanagementinfra.getNLSData()[e]&&derivedformatmanagementinfra.getNLSData()[e].target[a]&&(o=derivedformatmanagementinfra.getNLSData()[e].target[a]),r.push({label:o,value:a,selected:a==l})})}}}return r},getStreamIds:function(e,t,n,a,r){var o={},i=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(i){var d=i.get("connectors").find(function(e,n){return e.name==t});if(d){var l=d.supportedformats.find(function(e,t){return e.source.name==n&&e.source.type==a});if(l&&l.targets)l.targets.forEach(function(e,t){e.target==r&&(o.inputStreamId=e.inputStreamId,o.outputStreamId=e.outputStreamId)})}}return o},getSourceFormats:function(e,t){var n=this,a=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e}),r=new Array;if(a){var o,i,d,l=a.get("connectors").find(function(e,n){return e.name==t});if(l)n.selection?(o=n.selection.get("sourceType"),i=n.selection.get("source"),n.selection.get("partExtension"),d=n.selection.get("subType")):(o=l.supportedformats[0].source.type,i=l.supportedformats[0].source.name,l.supportedformats[0].source.partExtension,d=l.supportedformats[0].source.subtype),l.supportedformats.forEach(function(e,t){var n="";n=e.source.subtype?e.source.subtypeValue?e.source.subtypeValue:e.source.subtype:derivedformatmanagementinfra.getNLSData().label[e.source.type.toLowerCase()]?derivedformatmanagementinfra.getNLSData().label[e.source.type.toLowerCase()]:e.source.type;var a=e.source.name==i&&e.source.type==o;d&&(a=a&&e.source.subtype==d),r.push({label:n,value:e.source.name,type:e.source.type,selected:a,partExtension:e.source.partExtension,subType:e.source.subtype})})}return r},getParamListView:function(){return g}})});