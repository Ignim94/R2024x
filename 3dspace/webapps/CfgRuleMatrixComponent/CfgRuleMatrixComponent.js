define("DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter",["UWA/Core","DS/CoreEvents/ModelEvents","UWA/Element","DS/TreeModel/TreeDocument","DS/xModelEventManager/xModelEventManager","DS/ENOXModelListView/ModelListView/js/ModelListView","DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension","i18n!DS/CfgRuleMatrixComponent/assets/nls/ConstrainedCriteriaPresenter","i18n!DS/CfgRuleMatrixComponent/assets/nls/GlobalPresenter","css!DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter.css"],function(e,t,i,n,a,o,r,s,l){"use strict";var d=function(){};return d.prototype.init=function(e,i,n,o,r){this._listConstrainedCriteria=e,this._criteria_panel_open=!1,this._matrixRuleModel=i,this._privateChannel=o||new t,this._updateChannel=r&&void 0!==r.updateChannel?r.updateChannel:new t,this._applicationChannel=n,this._modelEventXmodel=new t,this._myEventManager=new a(this._privateChannel,this._updateChannel,this._applicationChannel,this._modelEventXmodel),this._editable=!0===r.editable,this._isRHSPanelActivated=!1,this._workaroundCheckAndWakeUpResizeSensor=r.resizeSensorEnablerFun?r.resizeSensorEnablerFun:function(){},this._subscribeToEvents(),this._initXModelListView(),this._initDivs(),this.loadData(this._listConstrainedCriteria)},d.prototype._initXModelListView=function(){var t=this;this._model_constrained_criteria=new n({});var i={id:"constrainedCriteria",defaultNodeDepth:2,model:this._model_constrained_criteria,modelEvents:this._modelEventXmodel,childKeys:["options"],restrictSortFlag:!0,viewOptions:{identifier:"constrained_criteria",grid:{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer"},{text:s.TYPE,dataIndex:"type",getCellValue:function(e){var t=e.nodeModel.options.grid.type;switch(t){case"variability_group":case"Variability Group":t=s.OPTION_GROUP;break;case"option":case"Variability Option":t=s.OPTION;break;case"value":case"Variant Value":t=s.VALUE;break;case"variant":case"Variant":t=s.VARIANT}return t}}]},contextualActions:[{id:"remove-constrained",fonticon:"remove",disable:!this._editable,title:s.REMOVE,text:s.REMOVE,handler:function(){t.removeCriteriaCombination([this])}}],disabledContextualActions:!this._editable},emptyContentOptions:{sentences:[{type:"icon",fonticon:"book-open",sizeicon:"40px",text:e.String.format(s.EMPTY_CONTENT_MESSAGE,'<span class="wux-ui-3ds wux-ui-3ds-book-open"></span>')}]},toolbarOptions:{withStableActions:!0,hideView:!0,useGeneratedToolbar:!0,touchMode:!1,actions:[{id:"add-criteria-constrained",text:l._openVariability,fonticon:"book-open",visibility:!this._editable,handler:function(){t._displayCriteriaPanel()}},{className:"divider"},{id:"delete-multiple-criteria",text:s.REMOVE,visibility:!this._editable,showOnSelection:!0,fonticon:"remove",handler:function(e,i){t.removeCriteriaCombination(i)}}]},extensions:[r]};this._xModelListView=new o(i),this._modelEventXmodel.publish({event:"xmodel-list-enable-contextual-menu",data:this._editable})},d.prototype._addData=function(e){this._modelEventXmodel.publish({event:"xmodel-list-data-item-add-update-action",data:e})},d.prototype.loadData=function(e){this._listConstrainedCriteria=e,this._modelEventXmodel.publish({event:"xmodel-list-data-load-action",data:e})},d.prototype._initDivs=function(){this._container=document.createElement("div"),this._container.classList.add("build-tablerule-presenter"),e.extendElement(this._container),this._xModelListView.inject(this._container)},d.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},function(){e.resetCriteriaVariantIcon()}),this._myEventManager.subscribe(this._applicationChannel,{event:"information-panel-open"},function(){e.resetCriteriaVariantIcon()})},d.prototype.getContainer=function(){return this._container},d.prototype.inject=function(e){e.appendChild(this._container)},d.prototype.refreshUI=function(){this._updateChannel.publish({event:"refresh-criteria-panel",data:"constrained-criteria"})},d.prototype._displayCriteriaPanel=function(){!1===this._criteria_panel_open?(this._updateChannel.publish({event:"display-criteria-panel",data:"constrained-criteria"}),this._applicationChannel.publish({event:"information-panel-hidden",data:"right"}),this.highLightCriteriaVariantIcon()):(this._applicationChannel.publish({event:"triptych-hide-panel",data:"right"}),this.resetCriteriaVariantIcon())},d.prototype.resetCriteriaVariantIcon=function(){this._criteria_panel_open=!1,this._updateChannel.publish({event:"criteria-panel-active",data:!1});var e={id:"add-criteria-constrained",fonticon:"book-open",text:l._openVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-icon-action",data:e})},d.prototype.addCriteriaCombination=function(e){for(var t=0;t<e.length;t++){var i=e[t].item,n=this._matrixRuleModel.formatXmodelListViewForJsonModel(i);this._matrixRuleModel.addConstrainedValues(n),this._matrixRuleModel.addConstrainedCriteria(n),this._addData(e[t])}this._listConstrainedCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().constrainedCriteria,"constrained-criteria"),this._privateChannel.publish({event:"mr-model-change"}),this._privateChannel.publish({event:"switch-view-allow",data:!0})},d.prototype.removeCriteriaCombination=function(e){if(0!==e.length){for(var t,i=0;i<e.length;i++){var n=e[i].options.grid;t=this._matrixRuleModel.formatXmodelListViewForJsonModel(n),this._matrixRuleModel.removeConstrainedCriteria(t),this._matrixRuleModel.removeConstrainedValues(t),this._updateChannel.publish({event:"add-update-to-criteria-panel",data:[e[i]]}),this._modelEventXmodel.publish({event:"xmodel-list-data-item-remove-and-parent",data:n.id})}this._listConstrainedCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().constrainedCriteria,"constrained-criteria"),this._privateChannel.publish({event:"mr-model-change"}),this._privateChannel.publish({event:"switch-view-allow",data:!0})}},d.prototype.destroy=function(){this._myEventManager.cleanup("ConstrainedCriteriaPresenter")},d.prototype.highLightCriteriaVariantIcon=function(){this._criteria_panel_open=!0,this._updateChannel.publish({event:"criteria-panel-active",data:!0});let e={id:"add-criteria-constrained",icon:"book-open",text:l._closeVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e})},d}),define("DS/CfgRuleMatrixComponent/Utils/CfgRuleMatrixExpressionGenerator",[],function(){"use strict";var e={generateBCR:function(t,i){var n={};n.rightExpression=e.generateRightExpression(t,i),n.defaultExpression=e.generateDefaultExpression(t);var a={};a.version=t.version,a.defaultExpression=n.defaultExpression,a.expression=n.rightExpression;var o=JSON.stringify(a);return n.fullExpression="MREV1:"+o,n},generateDefaultExpression:function(e){var i="",n="",a=0;for(a=0;a<e.drivingCombinationValues.length&&""===(i=t(a,e));a++);for(a+=1;a<e.drivingCombinationValues.length;a++)""!==(n=t(a,e))&&(i=i+" ; "+n);return i}},t=function(e,t){var n=[],a="",o=0;for(o=0;o<t.constrainedValues.length;o++)"D"===t.states[e][o]&&n.push(t.constrainedValues[o]);for(0!==n.length&&(a=n[0]),o=1;o<n.length;o++)a=a+" , "+n[o];return""!==a&&(a="DEFAULT ( "+(a="( "+a+" )")+" , ( "+i(t.drivingCombinationValues[e])+" ) )"),a};e.generateRightExpression=function(e,t){var o="",r=0,s="",l="",d="";if(0===e.drivingCombinationValues.length||0===e.constrainedValues.length)return"";for(r=0;r<e.drivingCombinationValues.length;r++)if(l=i(e.drivingCombinationValues[r]),t&&(d=n(r,e)),""!==(s=a(l,d))){o="( "+s+" )";break}for(r+=1;r<e.drivingCombinationValues.length;r++)l=i(e.drivingCombinationValues[r]),t&&(d=n(r,e)),""!==(s=a(l,d))&&(o=o+" AND ( "+s+" )");return o};var i=function(e){var t="",i="";for(i in e){var n="";n="yes"===e[i]?i:"no"===e[i]?"NOT ("+i+")":e[i],t=""===t?n:t+" AND "+n}return t},n=function(e,t){var i="",n=t.states,a=0,o="";for(a=0;a<t.constrainedValues.length;a++)"N"===n[e][a]?(o=t.constrainedValues[a],i=""===i?"NOT ( "+o+" )":"NOT ( "+o+" ) AND "+i):"S"===n[e][a]&&(o=t.constrainedValues[a],i=""===i?"( "+o+" )":"( "+o+" ) AND "+i);return i},a=function(e,t){return""===e||""===t?"":"NOT ( "+e+" ) OR ( "+t+" )"};return e}),define("DS/CfgRuleMatrixComponent/Runtime/ConflictPanelPresenter",["UWA/Class","UWA/Class/View","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/Controls/ResponsiveTileView","DS/WebappsUtils/WebappsUtils","DS/CollectionView/ResponsiveTilesCollectionView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Core/PointerEvents","css!DS/CfgRuleMatrixComponent/Runtime/ConflictPanelPresenter.css","i18n!DS/CfgRuleMatrixComponent/assets/nls/ConflictPanelPresenter"],function(e,t,i,n,a,o,r,s,l,d,c){return e.singleton({render:function(e){var t,i,n="home.ModelDefinition.ModelInfo.RuleDetails",l="/home/ModelDefinition/ModelInfo/RuleDetails",d="ve4al501dsy.ux.dsone.3ds.com:443/3DSpace/snresources/images/icons/large/I_VariabilityRulesThumbnail.png",u="/home/ModelDefinition/ModelInfo/RuleDetails",h=e.reasons,p=c._list_conflict_rules;h&&(h.type&&"InvColumn"===h.type?(p=c._list_invalid_Column,t=e.BC_ENFORCEMENT_ENABLED?c._causingRulesOrBaseConfigurations+" :":c._causingRules+" :",i=h.drivingCombinationValuesText):h.type&&"conflictMandatory"===h.type?(p=c._conflict_helper,t=c._reason,i=h.constrained?h.drivingCombinationValuesText+" / "+h.constrained+" "+c._conflict_message:"NOT "+e.conflictingRules[0]+" "+c._conflict_message):h.type&&"ConfigConflict"===h.type?(p=c._list_conflict_rules,t=c.impliedRules+" :",i=h.drivingCombinationValuesText):(p=c._list_conflict_rules,t=c._rule,h.causingRulesList&&h.causingRulesList.length>1&&(t+="s"),t=h.causingRulesList.length+" "+t+" :","ConflictRules"===h.type&&(i=h.drivingCombinationValuesText+" / "+h.constrained)));var m=h.causingRulesList;(this._container=UWA.createElement("div",{class:"conflict-panel",styles:{height:"100%",width:"100%"}}),UWA.createElement("div",{html:p,styles:{fontFamily:"Arial",fontSize:"16px",color:" #77797c",margin:"5px 0 3px 8px",fontWeight:"bold"},class:"title-conflict-panel"}).inject(this._container),i)&&UWA.createElement("div",{html:i,styles:{fontFamily:"Arial",fontSize:"14px",color:"#3d3d3d",margin:"10px 0 10px 18px",fontWeight:"normal"},class:"combination-conflict-panel"}).inject(this._container);t&&UWA.createElement("div",{html:t,styles:{fontFamily:"Arial",fontSize:"14px",color:"#3d3d3d",margin:"10px 0 10px 18px",fontWeight:"normal"},class:"toolbar-conflict-panel"}).inject(this._container);var v,_=UWA.createElement("div",{class:"list-Section",styles:{margin:"10px 0 10px 20px",height:"80%",width:"90%",position:"absolute"}});if(_.inject(this._container),h.constrainedCriteria)h.constrainedCriteria.mandatory&&UWA.createElement("div",{html:h.constrainedCriteria.title+" "+c._mandatory_message_matrix_rule,class:"noConflict-message"}).inject(_);else if(h.type&&"conflictMandatory"===h.type){UWA.createElement("div",{html:e.conflictingRules[0]+" "+c._mandatory_message_expression_rule,class:"noConflict-message"}).inject(_)}else{for(var g=(new o).inject(_),C=(a.getWebappsAssetUrl("ENOXModelApp","icon/rules.png"),a.getWebappsAssetUrl("ENOXModelApp","icon/rules.png")),f=a.getWebappsAssetUrl("ENOXModelApp","icon/BaseConfiguration.png"),b=new r,M=0;M<h.causingRulesList.length;M++){var y=m[M].description;y&&" "===y&&(y="");var V=new s({label:h.causingRulesList[M].title,id:h.causingRulesList[M].id,icons:"Model Type"==h.causingRulesList[M].type?[f]:[C],thumbnail:"Model Type"==h.causingRulesList[M].type?f:C,subLabel:m[M].ruleType+" | "+m[M].owner,description:y,type:h.causingRulesList[M].ruleType,version:h.causingRulesList[M].revision?h.causingRulesList[M].revision:"",customTooltip:(v=void 0,m[M].title&&(v=c.TITLE+" : "+m[M].title+"\n"),m[M].ruleType&&(v+=c.TYPE+" : "+m[M].ruleType+"\n"),m[M].revision&&(v+=c.REVISION+" : "+m[M].revision+"\n"),m[M].basePrice&&(v+=c.BASEPRICE+" : "+m[M].basePrice+"\n"),m[M].state&&(m[M].nlsValues&&m[M].nlsValues.nlsState?v+=c.MATURITY_STATE+" : "+m[M].nlsValues.nlsState+"\n":v+=c.MATURITY_STATE+" : "+m[M].state+"\n"),m[M].owner&&(v+=c.OWNER+" : "+m[M].owner+"\n"),m[M].modified&&(v+=c.MODIFICATION_DATE+" : "+function(e){var t,i={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};widget&&widget.lang?t=widget.lang:navigator&&navigator.language&&(t=navigator.language);var n=Intl.DateTimeFormat(t,i),a=new Date(e);return n.format(a)}(m[M].modified)+"\n"),m[M].organization&&(v+=c.ORGANIZATION+" : "+m[M].organization+"\n"),m[M].collabspace&&(v+=c.COLLABSPACE+" : "+m[M].collabspace+"\n"),m[M].name&&(v+=c.NAME+" : "+m[M].name+"\n"),v),multipleTitleLineNumber:!1,contextualMenu:[c._open]});b.addRoot(V)}g.onCellDoubleClick(function(e){console.log("Rule clicked: "+e.cellView.contentView.title);var t=e.cellView.contentView.title,i=e.cellModel.options.id,a=this.options.type,o=this.options.version;h.privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:{name:n,path:l,type:a,version:o,model:{id:i,name:t,image:d,version:u}}})}),g.onContextualEvent={callback:function(e){var t=e,i=[];if(e.menu&&e.menu.length)for(var o=0;o<e.menu.length;o++){var r=e.menu[o],s=a.getWebappsBaseUrl();s=0==o?s+"WUXResponsiveTileView/assets/ExpandAll.png":s+"WUXResponsiveTileView/assets/CollapseAll.png",i.push({type:"PushItem",title:r,icon:"open",context:t.context.title,action:{callback:function(e){var t=this.context.title,i=this.context.cellInfos.cellModel.options.id,a=this.context.cellInfos.cellModel.options.version,o=this.context.cellInfos.cellModel.options.type;h.privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:{name:n,path:l,type:o,version:a,model:{id:i,name:t,image:d,version:u}}})}.bind(t),context:{}}})}return i}},g.loadApplicativeModel(b)}return this._container},getContainer:function(){return this._container}})}),define("DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter",["UWA/Core","DS/CoreEvents/ModelEvents","UWA/Element","DS/TreeModel/TreeDocument","DS/xModelEventManager/xModelEventManager","DS/ENOXModelListView/ModelListView/js/ModelListView","DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension","i18n!DS/CfgRuleMatrixComponent/assets/nls/DrivingCriteriaPresenter","i18n!DS/CfgRuleMatrixComponent/assets/nls/GlobalPresenter","css!DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter.css"],function(e,t,i,n,a,o,r,s,l){"use strict";var d=function(){};return d.prototype.init=function(e,i,n,o,r){this._listDrivingCriteria=e,this._criteria_panel_open=!1,this._matrixRuleModel=i,this._privateChannel=o||new t,this._updateChannel=r&&void 0!==r.updateChannel?r.updateChannel:new t,this._applicationChannel=n,this._modelEventXmodel=new t,this._myEventManager=new a(this._privateChannel,this._updateChannel,this._applicationChannel,this._modelEventXmodel),this._editable=!0===r.editable,this.reservedbyFullName=r.reservedbyFullName,this._isRHSPanelActivated=!1,this._workaroundCheckAndWakeUpResizeSensor=r.resizeSensorEnablerFun?r.resizeSensorEnablerFun:function(){},this._subscribeToEvents(),this._initXModelListView(),this._initDivs(),this.loadData(this._listDrivingCriteria)},d.prototype._initXModelListView=function(){var t=this;this._model_driving_criteria=new n({});var i={id:"drivingCriteria",model:this._model_driving_criteria,modelEvents:this._modelEventXmodel,defaultNodeDepth:2,childKeys:["options"],restrictSortFlag:!0,viewOptions:{identifier:"driving_criteria",grid:{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer"},{text:s.TYPE,dataIndex:"type",getCellValue:function(e){var t=e.nodeModel.options.grid.type;switch(t){case"variability_group":case"Variability Group":t=s.OPTION_GROUP;break;case"option":case"Variability Option":t=s.OPTION;break;case"value":case"Variant Value":t=s.VALUE;break;case"variant":case"Variant":t=s.VARIANT}return t}}]},contextualActions:[{id:"remove-driving",fonticon:"remove",title:s.REMOVE,text:s.REMOVE,handler:function(){t.removeCriteriaCombination([this])}}],disabledContextualActions:!this._editable},emptyContentOptions:{sentences:[{type:"icon",fonticon:"book-open",sizeicon:"40px",text:e.String.format(s.EMPTY_CONTENT_MESSAGE,'<span class="wux-ui-3ds wux-ui-3ds-book-open"></span>')}]},toolbarOptions:{withStableActions:!0,useGeneratedToolbar:!0,touchMode:!1,hideView:!0,actions:[{id:"add-criteria-driving",text:this._editable?l._openVariability:e.String.format(l._lockedVariability,t.reservedbyFullName),fonticon:"book-open",disabled:!this._editable,handler:function(){t._displayCriteriaPanel()}},{id:"delete-multiple-criteria",visibility:!this._editable,showOnSelection:!0,category:"destructive",text:s.REMOVE,fonticon:"remove",handler:function(e,i){t.removeCriteriaCombination(i)}}]},extensions:[r]};this._xModelListView=new o(i),this._modelEventXmodel.publish({event:"xmodel-list-enable-contextual-menu",data:this._editable})},d.prototype._addData=function(e){this._modelEventXmodel.publish({event:"xmodel-list-data-item-add-update-action",data:e})},d.prototype.loadData=function(e){this._listDrivingCriteria=e,this._modelEventXmodel.publish({event:"xmodel-list-data-load-action",data:e})},d.prototype._initDivs=function(){this._container=document.createElement("div"),this._container.classList.add("build-tablerule-presenter"),e.extendElement(this._container),this._xModelListView.inject(this._container)},d.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},function(){e.resetCriteriaVariantIcon()}),this._myEventManager.subscribe(this._applicationChannel,{event:"information-panel-open"},function(){e.resetCriteriaVariantIcon()})},d.prototype.inject=function(e){e.appendChild(this._container)},d.prototype.getContainer=function(){return this._container},d.prototype.refreshUI=function(){this._updateChannel.publish({event:"refresh-criteria-panel",data:"driving-criteria"})},d.prototype._displayCriteriaPanel=function(){!1===this._criteria_panel_open?(this._updateChannel.publish({event:"display-criteria-panel",data:"driving-criteria"}),this._applicationChannel.publish({event:"information-panel-hidden",data:"right"}),this.highLightCriteriaVariantIcon()):(this._applicationChannel.publish({event:"triptych-hide-panel",data:"right"}),this.resetCriteriaVariantIcon())},d.prototype.resetCriteriaVariantIcon=function(){this._criteria_panel_open=!1,this._updateChannel.publish({event:"criteria-panel-active",data:!1});var e={id:"add-criteria-driving",fonticon:"book-open",text:l._openVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-icon-action",data:e})},d.prototype.addCriteriaCombination=function(e){for(var t=0;t<e.length;t++){var i=this._matrixRuleModel.formatXmodelListViewForJsonModel(e[t].item);this._matrixRuleModel.addDrivingCriteria(i),this._addData(e[t])}this._matrixRuleModel.reOrderDrivingCriteria(),this._matrixRuleModel.setIsUpdatingDrivingCriteria(!0),this._matrixRuleModel.createAllDrivingCombination(this._matrixRuleModel.getJsonModel().drivingCriteria),this._matrixRuleModel.setIsUpdatingDrivingCriteria(!1),this._listDrivingCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().drivingCriteria,"driving-criteria"),this._matrixRuleModel.updateDrivingCombinationValues(this._matrixRuleModel.getAllDrivingCombination()),this._privateChannel.publish({event:"mr-model-change"}),this._privateChannel.publish({event:"switch-view-allow",data:!0})},d.prototype.removeCriteriaCombination=function(e){if(0!==e.length){for(var t,i=0;i<e.length;i++){var n=e[i].options.grid;t=this._matrixRuleModel.formatXmodelListViewForJsonModel(n),this._matrixRuleModel.removeDrivingCriteria(t),this._updateChannel.publish({event:"add-update-to-criteria-panel",data:[e[i]]}),this._modelEventXmodel.publish({event:"xmodel-list-data-item-remove-and-parent",data:n.id})}this._matrixRuleModel.setIsUpdatingDrivingCriteria(!0),this._matrixRuleModel.createAllDrivingCombination(this._matrixRuleModel.getJsonModel().drivingCriteria),this._matrixRuleModel.setIsUpdatingDrivingCriteria(!1),this._matrixRuleModel.updateDrivingCombinationValues(this._matrixRuleModel.getAllDrivingCombination()),this._privateChannel.publish({event:"mr-model-change"}),this._matrixRuleModel.reOrderDrivingCriteria(),this._listDrivingCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().drivingCriteria,"driving-criteria"),this._privateChannel.publish({event:"switch-view-allow",data:!0})}},d.prototype.destroy=function(){this._myEventManager.cleanup("DrivingCriteriaPresenter")},d.prototype.highLightCriteriaVariantIcon=function(){this._criteria_panel_open=!0,this._updateChannel.publish({event:"criteria-panel-active",data:!0});let e={id:"add-criteria-driving",icon:"book-open",text:l._closeVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e})},d}),define("DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent",["DS/UIKIT/Popover","css!DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent.css","css!DS/UIKIT/UIKIT.css"],function(e,t,i){"use strict";var n={},a=function(e,t){null!=e&&t instanceof Array&&t.forEach(function(t){e.classList.add(t)})};return n.generateMRStandard=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-standard","user-selection"]);var n=document.createElement("span");return a(n,["fonticon","fonticon-check","user-selection"]),i.appendChild(n),i},n.generateMRStandardConflict=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-standard","mr-conflict","user-selection"]);var n=document.createElement("span");a(n,["fonticon","fonticon-check","user-selection"]),i.appendChild(n);var o=document.createElement("span");return a(o,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),i.appendChild(o),i},n.generateMRStandardIncompatible=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-standard","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-check","user-selection"]),e.appendChild(t);var i=this.createTriangleDiv("incompatible");return e.appendChild(i),e},n.generateMRStandardRequired=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-standard","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-check","user-selection"]),e.appendChild(t);var i=this.createTriangleDiv("required");return e.appendChild(i),e},n.generateMRDefault=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-default","user-selection"]);var n=document.createElement("span");return a(n,["fonticon","fonticon-favorite-on","user-selection"]),i.appendChild(n),i},n.generateMRDefaultRequired=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-default","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-favorite-on","user-selection"]),e.appendChild(t);var i=this.createTriangleDiv("required");return e.appendChild(i),e},n.generateMRDefaultIncompatible=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-default","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-favorite-on","user-selection"]),e.appendChild(t);var i=document.createElement("span");return a(i,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),e.appendChild(i),e},n.generateMRAvailable=function(e,t){var i=document.createElement("div");return a(i,["mr-body-cell","mr-available","mr-standard"]),i},n.generateMRAvailableRequired=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-available","mr-standard"]);var n=this.createTriangleDiv("required");return i.appendChild(n),i},n.generateMRAvailableIncompatible=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-available","mr-standard"]);var n=this.createTriangleDiv("incompatible");return i.appendChild(n),i},n.generateMRAvailableConflict=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-available","mr-standard"]);var n=document.createElement("span");return a(n,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),i.appendChild(n),i},n.generateMRNotAvailable=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-notavailable","user-selection"]);var n=document.createElement("span");return a(n,["fonticon","fonticon-block","user-selection"]),i.appendChild(n),i},n.generateMRNotAvailableConflict=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-notavailable","mr-conflict","user-selection"]);var n=document.createElement("span");a(n,["fonticon","fonticon-block","user-selection"]),i.appendChild(n);var o=document.createElement("span");return a(o,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),i.appendChild(o),i},n.generateMRNotAvailableIncompatible=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-notavailable","user-selection"]);var n=document.createElement("span");a(n,["fonticon","fonticon-block","user-selection"]),i.appendChild(n);var o=this.createTriangleDiv("incompatible");return i.appendChild(o),i},n.createTriangleDiv=function(e){var t=document.createElement("div");t.classList.add("triangle");var i=document.createElement("span");return a(i,["mr-span-information","fonticon"]),"required"===e?i.classList.add("fonticon-check"):"incompatible"===e?i.classList.add("fonticon-block"):i.classList.add("fonticon-info"),i.classList.add("mr-combi-details"),t.appendChild(i),t},n.createConflictDiv=function(){var e=document.createElement("span");return a(e,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),e},n.changeStateIcon=function(e,t){if(e.cellModel){var i,a=e.cellModel.stateValidity,o=e.cellModel.state,r=e.cellView.getContent();e.cellView.getContent().getElement(".triangle");if(t){var s=e.cellView.getContent().getElement(".mr-body-cell");s.getChildren().length>0?i=s.getChildren()[0]:(i=UWA.createElement("span"),s.appendChild(i))}else{var l=e.cellView.getContent().getElement(".wux-controls-combobox").getElement(".mr-body-cell");l.getChildren().length>0?i=l.getChildren()[0]:(i=UWA.createElement("span"),l.appendChild(i))}switch(this.setAttributeSpanElement(o,i),this.getCellState(o,a)){case"conflict":r.appendChild(n.createConflictDiv());break;case"required":r.appendChild(n.createTriangleDiv("required"));break;case"incompatible":r.appendChild(n.createTriangleDiv("incompatible"))}}else console.error("Issue MatruiTablePresenterStaticContent changeStateIcon : cell no cellmodel")},n.getCellState=function(e,t){var i="";switch(e){case"S":switch(t){case"C":case"A":case"T":case"I":i="conflict";break;case"U":case"R":case"E":i="required"}break;case"A":case"N":switch(t){case"U":case"R":case"E":i="required";break;case"A":case"T":case"I":i="incompatible";break;case"C":i="conflict"}break;case"D":switch(t){case"U":case"R":case"E":i="required";break;case"A":case"T":case"I":case"C":i="conflict"}}return i},n.setAttributeSpanElement=function(e,t){if(t&&e)switch(e){case"S":t.setAttribute("class","fonticon fonticon-check user-selection");break;case"A":t.setAttribute("class","");break;case"N":t.setAttribute("class","fonticon fonticon-block user-selection");break;case"D":t.setAttribute("class","fonticon fonticon-favorite-on user-selection")}},n}),define("DS/CfgRuleMatrixComponent/Buildtime/CriteriaPresenter",["DS/Handlebars/Handlebars","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeDocument","DS/ENOXModelListView/ModelListView/js/ModelListView","DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension","i18n!DS/CfgRuleMatrixComponent/assets/nls/CriteriaPresenter","i18n!DS/xDimensionManager/assets/nls/xUnitLabelLong","i18n!DS/xDimensionManager/assets/nls/xDimentions","text!DS/CfgRuleMatrixComponent/Buildtime/CriteriaPresenter.html","css!DS/CfgRuleMatrixComponent/Buildtime/CriteriaPresenter.css"],function(e,t,i,n,a,o,r,s,l,d,c){"use strict";var u=function(){},h={variability_group:s.OPTION_GROUP,"Variability Group":s.OPTION_GROUP,option:s.OPTION,"Variability Option":s.OPTION,value:s.VALUE,"Variant Value":s.VALUE,variant:s.VARIANT,Variant:s.VARIANT,"Variant Parameter":s.PARAMETER};return u.prototype.init=function(e){this._options=e,this._criteria_model=new t,this._myEventManager=new i(this._criteria_model),this._initDivs(this._options)},u.prototype._initDivs=function(t){var i=e.compile(c)(t);this._container=document.createElement("div"),this._container.innerHTML=i,this._container=this._container.firstChild,this._criteriaContent=this._container.querySelector(".criteria-content"),this._criteriaTitle=this._container.querySelector(".criteria-main-title")},u.prototype._getGridInitialListView=function(e){return e?{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer",width:100},{text:s.TYPE,groupableFlag:!0,dataIndex:"type",width:100,getCellValue:function(e){return h[e.nodeModel.options.grid.type]}},{text:s.RANGE,sortableFlag:!1,dataIndex:"range",valueAttribute:["minValue","maxValue"],width:100,kind:["instance"],getCellValue:function(e){if("Variant Parameter"===e.nodeModel.options.grid.type){var t="";if(e.nodeModel.options.grid.hasOwnProperty("minValue")&&e.nodeModel.options.grid.hasOwnProperty("maxValue")){var i=e.nodeModel.options.grid.minValue.split(" ")[0],n=e.nodeModel.options.grid.maxValue.split(" ")[0];i&&n&&(t=i+" "+s.RangeValueDelimiter+" "+n)}return t}}},{text:s.UNIT,groupableFlag:!0,dataIndex:"unit",valueAttribute:["unit"]},{text:s.DIMENSION,groupableFlag:!0,dataIndex:"dimension",valueAttribute:["dimension"],width:100,kind:["instance"],getCellValue:function(e){var t=" ";return e.nodeModel.options.grid.hasOwnProperty("dimension")?(t=e.nodeModel.options.grid.dimension,"Integer"===(t=d.get(t))||"Real"===t?s.NoDimensionLabel:t):t}},{text:s.DESCRIPTION,dataIndex:"description"}]}:{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer",width:100},{text:s.TYPE,dataIndex:"type",getCellValue:function(e){return h[e.nodeModel.options.grid.type]}},{text:s.DESCRIPTION,dataIndex:"description"}]}},u.prototype.initializeListView=function(e,t=!1){this._options_xmodellistview=e,this._model_criteria=new a({});var i={id:"criteria-model",model:this._model_criteria,modelEvents:this._criteria_model,defaultNodeDepth:2,restrictSortFlag:!0,childKeys:["values","options"],viewOptions:{currentView:"DataGridView",identifier:"criteria-component",layoutOptions:e.layoutOptions,grid:this._getGridInitialListView(t),contextualActions:this._options_xmodellistview.contextualActions?this._options_xmodellistview.contextualActions:null},emptyContentOptions:{sentences:[{type:"img",src:n.getWebappsAssetUrl("ENOXModelApp","icon/variantValue.png"),sizeicon:"40px",text:s.EMPTY_CONTENT_MESSAGE}]},toolbarOptions:this._options_xmodellistview.toolbarOptions?this._options_xmodellistview.toolbarOptions:null,extensions:[r]};this._xModelListView=new o(i),this._xModelListView.inject(this._criteriaContent)},u.prototype.getCriteriaModel=function(){return this._criteria_model},u.prototype._updateDataWithUnit=function(e){for(var t,i=0;i<e.member.length;i++)e.member[i].isA===s.TYPE_PARAMETER&&(t=e.member[i].minValue.split(" ")[1],e.member[i].unit=t?l.get(t):" ")},u.prototype.loadData=function(e){var t;this._updateDataWithUnit(e),e.member.forEach(e=>{(t=e.values?e.values:e.options)&&t.member.forEach(e=>{e.sequenceNumber=parseInt(e.sequenceNumber)})}),this._criteria_model.publish({event:"xmodel-list-data-load-action",data:e})},u.prototype.removeData=function(e){this._criteria_model.publish({event:"xmodel-list-data-item-remove-and-parent",data:e})},u.prototype._addData=function(e){this._criteria_model.publish({event:"xmodel-list-data-item-add-update-action",data:e})},u.prototype.inject=function(e){e.appendChild(this._container)},u.prototype.getContainer=function(){return this._container},u.prototype.getXModelListView=function(){return this._xModelListView},u.prototype.destroy=function(){this._myEventManager.cleanup("Chanel CriteriaPresenter clean")},u}),define("DS/CfgRuleMatrixComponent/LoadingPanel/LoadingPanel",["DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/CoreEvents/ModelEvents","i18n!DS/CfgRuleMatrixComponent/assets/nls/LoadingPanel"],function(e,t,i,n,a){"use strict";var o=function(e){e&&(this._modelEventObj=e,this._tokens=[])};o.prototype.subscribe=function(e,t,i){t&&i&&this._modelEventObj&&this._tokens.push(this._modelEventObj.subscribe(t,i))},o.prototype.cleanup=function(e){if(this._tokens&&this._tokens.length>0){var t=this;console.log("[ENOXWizard:LocalEvtManager] Performing event cleanup for: "+e),this._tokens.forEach(function(e){t._modelEventObj.unsubscribe(e)})}};var r=function(e){e&&(this._options=e,this._content=this._options.content,this._immersiveFrame=this._options.immersiveFrame,this._modelEvents=this._options.modelEvents,this._myEventManager=new o(this._modelEvents),this._init())};return r.prototype._init=function(){this._createLoadingPanel(this._content),this._subscribeToEvents()},r.prototype.close=function(){this.myDialog?this.myDialog.close():console.log("No loadingPanel displayed")},r.prototype.destroy=function(){this._modelEvents.publish({event:"destroy-loading"}),this._myEventManager&&(this._myEventManager.cleanup("LoadingPanel"),this._myEventManager=null)},r.prototype._subscribeToEvents=function(){var e=this;this._modelEvents&&(this._myEventManager.subscribe(this._modelEvents,{event:"change-icon-loading"},function(t){e._changeIconLoading(t.id,t.icon)}),this._myEventManager.subscribe(this._modelEvents,{event:"change-text-loading"},function(t){e._changeText(t.id,t.text)}))},r.prototype._createLoadingPanel=function(e){var i=this;this.contentLoading=UWA.createElement("div");for(var n=0;n<e.length;n++){var o,r=UWA.createElement("div");switch(e[n].icon?e[n].icon:"no-start"){case"no-start":(o=new UWA.Element("i",{id:"icon-loading-panel-"+n,class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock"})).style="color: orange;";break;case"on-progress":(o=new UWA.Element("i",{id:"icon-loading-panel-"+n,class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-progress-2"})).style="color: #368EC4;";break;case"done":(o=new UWA.Element("i",{id:"icon-loading-panel-"+n,class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"})).style="color: green;"}var s=new UWA.Element("div",{id:"title-loading-panel-"+n,html:e[n].title+" : "}),l=new UWA.Element("div",{id:"percentage-loading-panel-"+n,html:e[n].text?e[n].text:""});l.style="display: inline; margin-left: 2px;",s.inject(r),o&&o.inject(s),l.inject(s),r.inject(this.contentLoading)}this.myDialog=new t({immersiveFrame:this._immersiveFrame,title:a.loading_Status,content:this.contentLoading,activeFlag:!1,modalFlag:!1,resizableFlag:!1}),this.myDialog.addEventListener("close",function(e){i.destroy()})},r.prototype._changeIconLoading=function(e,t){var i=document.getElementById("icon-loading-panel-"+e);if(i)switch(t){case"no-start":i.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock",i.style="color : orange";break;case"done":i.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check",i.style="color : green";break;case"on-progress":i.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-progress-2",i.style="color : #368EC4"}return i},r.prototype._changeText=function(e,t){var i=document.getElementById("percentage-loading-panel-"+e);return i&&i.setText(t),i},r}),define("DS/CfgRuleMatrixComponent/Model/DemoModel",["UWA/Class/Model"],function(e){return UWA.Class.Model.extend({defaults:{drivingCriteria:[],constrainedCriteria:[],drivingCombinationValues:[],constrainedValues:[],states:null,statesValidity:null}})}),define("DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils",[],function(){"use strict";var e={convertJsonToV3:function(t,i){switch(i.version){case"1.0.1":var n=e.generateJsonModelV2FromV1(t,i);return e.generateJsonModelV3FromV2(t,n);case"2.0":return e.generateJsonModelV3FromV2(t,i);default:return i}},generateJsonModelV2FromV1:function(e,t){var i=0,n=0,a={},o=[];for(a.constrainedValues=[],i=0;i<t.constrainedCombinations.length;i+=1){(v={}).id=t.constrainedCombinations[i].combinationOptions[0].id,e[v.id]?("option"===e[v.id].type?(v.parent=null,v.criteriaValidity="yes"):(v.parent=e[v.id].parent,v.variantValue=v.id),a.constrainedValues.push(v),o.push(v.id)):console.error("Issue generateJsonModelV2FromV1 dico not found id : "+v.id)}var r={};for(a.drivingCombinationValues=[],i=0;i<t.drivingCombinations.length;i+=1){var s=[];for(n=0;n<t.drivingCombinations[i].combinationOptions.length;n+=1)s.push(t.drivingCombinations[i].combinationOptions[n].id);var l={};for(n=0;n<s.length;n+=1)if(e[s[n]])if("option"===e[s[n]].type)l[s[n]]={},l[s[n]].criteriaValidity="yes";else{var d=e[s[n]].parent;if(l[d]={},l[d].variantValue=s[n],l[d].value=e[s[n]].title,l[d].type=e[s[n]].type,void 0===r[d])r[d]={},r[d].values=[],r[d].values.push(s[n]);else r[d].values.find(e=>e===s[n])||r[d].values.push(s[n])}else console.error("Issue 2  generateJsonModelV2FromV1 dico not found id : "+s[n]);0!==Object.keys(l).length&&a.drivingCombinationValues.push(l)}a.drivingCriteria=[];for(i=0;i<t.drivingFeatures.length;i+=1){if(e[t.drivingFeatures[i].id]){if((p={}).id=t.drivingFeatures[i].id,p.type=e[t.drivingFeatures[i].id].type,p.name=e[t.drivingFeatures[i].id].title,p.selectedValues=[],p.rejectedValues=[],r&&Object.keys(r).length>0)for(n=0;n<r[t.drivingFeatures[i].id].values.length;n+=1)p.selectedValues.push({variantValue:r[t.drivingFeatures[i].id].values[n],validity:!0,id:r[t.drivingFeatures[i].id].values[n]});p.rejectedValues.push({criteriaValidity:"no"}),p.selectedValues.length>0&&a.drivingCriteria.push(p)}}if(a.constrainedCriteria=[],o.length>0)for(i=0;i<t.constrainedFeatures.length;i+=1){if(e[t.constrainedFeatures[i].id])if((m={}).id=t.constrainedFeatures[i].id,m.type=e[t.constrainedFeatures[i].id].type,m.name=e[t.constrainedFeatures[i].id].title,m.selectedValues=[],m.rejectedValues=[],"variability_group"===m.type)for(n=0;n<e[t.constrainedFeatures[i].id].content.length;n+=1){(m={}).id=e[t.constrainedFeatures[i].id].content[n],m.type="option",m.parent=null,m.rejectedValues=[{criteriaValidity:"no"}],m.selectedValues=[{id:e[t.constrainedFeatures[i].id].content[n],parent:null,criteriaValidity:"yes"}],a.constrainedCriteria.push(m)}else{for(n=0;n<e[t.constrainedFeatures[i].id].values.length;n+=1)m.selectedValues.push({variantValue:e[t.constrainedFeatures[i].id].values[n]});m.selectedValues.length>0&&a.constrainedCriteria.push(m)}}if(a.states=[],a.statesValidity=[],!t.statesValidity){t.statesValidity="";for(i=0;i<t.states.length;i++)t.statesValidity+="V"}for(i=0;i<a.drivingCombinationValues.length;i+=1){var c="",u="";for(n=0;n<a.constrainedValues.length;n+=1){var h=n*t.drivingCombinations.length+i;c+=t.states[h],u+=t.statesValidity[h]}a.states.push(c),a.statesValidity.push(u)}if(a.drivingCriteria.length!=t.drivingFeatures.length)for(i=0;i<t.drivingFeatures.length;i+=1){if(e[t.drivingFeatures[i].id]){var p;(p={}).id=t.drivingFeatures[i].id,p.type=e[t.drivingFeatures[i].id].type,p.selectedValues=[],p.rejectedValues=[];for(n=0;n<e[t.drivingFeatures[i].id].values.length;n+=1)p.selectedValues.push({variantValue:e[t.drivingFeatures[i].id].values[n]});p.rejectedValues.push({criteriaValidity:"no"}),p.selectedValues.length>0&&a.drivingCriteria.push(p)}}if(a.constrainedCriteria.length!=t.constrainedFeatures.length&&0===o.length||a.constrainedCriteria[0].selectedValues.length!=o.length){a.constrainedCriteria=[];for(i=0;i<t.constrainedFeatures.length;i+=1){if(e[t.constrainedFeatures[i].id])if((m={}).id=t.constrainedFeatures[i].id,m.type=e[t.constrainedFeatures[i].id].type,m.name=e[t.constrainedFeatures[i].id].title,m.selectedValues=[],m.rejectedValues=[],"variability_group"===m.type)for(n=0;n<e[t.constrainedFeatures[i].id].content.length;n+=1){var m;(m={}).id=e[t.constrainedFeatures[i].id].content[n],m.type="option",m.parent=null,m.rejectedValues=[{criteriaValidity:"no"}],m.selectedValues=[{id:e[t.constrainedFeatures[i].id].content[n],parent:null,criteriaValidity:"yes"}],a.constrainedCriteria.push(m)}else{for(n=0;n<e[t.constrainedFeatures[i].id].values.length;n+=1)m.selectedValues.push({variantValue:e[t.constrainedFeatures[i].id].values[n]});m.selectedValues.length>0&&a.constrainedCriteria.push(m)}}for(i=0;i<a.constrainedCriteria.length;i+=1){var v;if((v={}).id=a.constrainedCriteria[i].id,e[v.id]){if("option"===e[v.id].type)v.parent=null,v.criteriaValidity="yes";else{if("variant"===e[v.id].type){for(let t=0;t<e[v.id].values.length;t++){let i={};i.id=e[v.id].values[t],i.parent=v.id,i.variantValue=i.id,void 0===a.constrainedValues.find(e=>e.id===i.id)&&a.constrainedValues.push(i)}continue}"value"===e[v.id].type&&(v.parent=e[v.id].parent)}void 0===a.constrainedValues.find(e=>e.id===v.id)&&a.constrainedValues.push(v)}else console.error("Issue generateJsonModelV2FromV1 dico not found id : "+v.id)}}if(0===t.constrainedCombinations.length&&0===t.drivingCombinations.length){let e=1;for(let t=0;t<a.drivingCriteria.length;t++)e*=a.drivingCriteria[t].selectedValues.length;var _="";for(let e=0;e<a.constrainedCriteria.length;e++)if("option"===a.constrainedCriteria[e].type)_+="X","X";else for(let t=0;t<a.constrainedCriteria[e].selectedValues.length;t++)_+="X","X";for(let t=0;t<e;t++){var g=UWA.clone(_),C=UWA.clone(_);a.states.push(g),a.statesValidity.push(C)}}return a.version="2.0",a},generateJsonModelV3FromV2:function(t,i){var n={};n.drivingCriteria=e.getCriteriaV3FromV2(t,i.drivingCriteria),n.constrainedCriteria=e.getCriteriaV3FromV2(t,i.constrainedCriteria),n.constrainedValues=[],i.constrainedValues.forEach(e=>{n.constrainedValues.push({id:e.id})}),n.drivingCombinationValues=[];var a={};return i.drivingCombinationValues.forEach(e=>{Object.keys(e).forEach(t=>{a[t]={variantValue:e[t].variantValue}}),n.drivingCombinationValues.push(a),a={}}),n.states=i.states,n.statesValidity=i.statesValidity,n.drivingCombinationsValidity=i.drivingCombinationsValidity,n.version="3.0",n},getCriteriaV3FromV2:function(e,t){var i=[],n={},a={};return t.forEach(t=>{"variant"===t.type?(a.id=t.id,a.selectedValues=[],t.selectedValues.forEach(e=>{a.selectedValues.push({id:e.variantValue})}),i.push(a),a={}):"option"===t.type&&(UWA.is(n[e[t.id].parent],"number")?i[n[e[t.id].parent]].selectedValues.push({id:t.id}):(n[e[t.id].parent]=i.length,a.id=e[t.id].parent,a.selectedValues=[],a.selectedValues.push({id:t.id}),i.push(a)),a={})}),void 0!==a.id&&i.push(a),i}};return e}),define("DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter",["UWA/Core","DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/Controls/Popup","DS/CfgSolver/CfgSolverServices","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/UIKIT/Mask","DS/xModelEventManager/xModelEventManager","i18n!DS/CfgRuleMatrixComponent/assets/nls/MatruiTablePresenter","css!DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter.css"],function(e,t,i,n,a,o,r,s,l,d,c,u,h){"use strict";var p={},m="check",v="block",_="favorite-on",g={S:u.Selected,A:u.Available,N:u.NA,D:u.Default,U:u.Undefined},C=function(){};return C.prototype.init=function(t,i,n){this.loadingConflictPercent=0,this.loadingSuggestionPercent=0,t.removeStateValidity(),t.removeDrivingCombinationsValidity(),this._matrixModel=t,this._mapDico=this._matrixModel._mapDico,this._jsonModel=this._matrixModel.getJsonModel(),this._solverKey=n.solverKey,this._solverModelEvent=n.solverModelEvent,this._options=n||{},this._privateChannel=i,this.context=n.context?n.context:"",this.headerFilter=[],this.invalidFilter=[],this.previousInvalidFilter=[],this.previousHeaderFilter=[],n.filter&&n.filter.headerFilter&&n.filter.invalidFilter&&(this.headerFilter=n.filter.headerFilter,this.invalidFilter=n.filter.invalidFilter,this.previousInvalidFilter=e.clone(this.invalidFilter),this.previousHeaderFilter=e.clone(this.headerFilter)),this.conflictColumn={},this.invalidColumn=[],this.arrColumnAfterSort=[],this._editable=n.editable,this._painterEnabled=void 0,this._isConflictPanelOpened=!1,this._myEventManager=new c(this._privateChannel,this._solverModelEvent),this._container||(this._container=document.createElement("div"),this._container.classList.add("matrui-table-presenter")),this._subscribeToEvent(),this._resizableTableModel=this._createResizableModel(),this.lengthHeader=this._resizableTableModel.title_columns.length,this._initTreeModel(),this._stopRecursiveCall=!1,this._updateDatagrid=!0,this._jsonModel.states&&this._jsonModel.states.length>0&&this._buildTable(),this._editable&&this._observeDOM()},C.prototype._observeDOM=function(){var e=this;this.observer=new MutationObserver(function(){1===document.getElementsByClassName("wux-controls-abstract wux-controls-combobox-popup wux-controls-popup").length&&(e._stopAsyncRecursiveCallSolver(),e._updateDatagrid=!1)});this.observer.observe(document,{attributes:!1,childList:!0,subtree:!0})},C.prototype._subscribeToEvent=function(){var e=this;this._myEventManager.subscribe(this._privateChannel,{event:"reset-loading-status-bar"},function(){var t={id:"statusConflict",text:u.Conflicts_Computing+" 0%",icon:"clock"};e._updateStatusBar(t),t={id:"statusSuggestion",text:u.Suggestions_Computing+" 0%",icon:"clock"},e._updateStatusBar(t)}),this._myEventManager.subscribe(this._solverModelEvent,{event:"mr-stop-recursive-call"},function(){e._stopAsyncRecursiveCallSolver()}),this._myEventManager.subscribe(this._solverModelEvent,{event:"mr-check-all-conflict-suggestion"},function(){e._stopRecursiveCall=!1,e._checkAllConflictMatrix(e._matrixModel)}),this._myEventManager.subscribe(this._solverModelEvent,{event:"mr-reload-table"},function(){e._container.innerHTML="",e._buildTable()}),this._myEventManager.subscribe(this._privateChannel,{event:"mr-resize"},function(){e._dataGridView&&e._dataGridView.layout.postRender()}),this._myEventManager.subscribe(this._privateChannel,{event:"conflict-panel-opened"},function(t){e._isConflictPanelOpened=t}),this._myEventManager.subscribe(this._privateChannel,{event:"matrui-reset-filter"},function(){e.resetFilter()}),this._myEventManager.subscribe(this._privateChannel,{event:"matrui-setprevious-filter"},function(){e.invalidFilter=e.previousInvalidFilter,e.headerFilter=e.previousHeaderFilter,e._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:e.invalidFilter,headerFilter:e.headerFilter}})}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-action-activated"},function(t){e._actionToolBar(t),e._container&&e._previousPainterEnabled!==e._painterEnabled&&(e._dataGridView.invalidateLayout({updateCellContent:!0}),e._previousPainterEnabled=e._painterEnabled)})},C.prototype._actionToolBar=function(e){switch(e){case"painter-not-available":this._painterState=g.N,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush-block"}}),this._painterEnabled=!0;break;case"painter-available":this._painterState=g.A,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush"}}),this._painterEnabled=!0;break;case"painter-default":this._painterState=g.D,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush-favorite"}}),this._painterEnabled=!0;break;case"painter-selected":this._painterState=g.S,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush-ok"}}),this._painterEnabled=!0;break;case"painter-none":this._painterState=g.A,this._painterEnabled=!1;break;case"large":this._setColumnWidth(600);break;case"medium":this._setColumnWidth(400);break;case"small":this._setColumnWidth(200);break;case"display-all-combination":this.resetFilter();break;case"filter-invalid-column":this.filterInvalidColumn();break;default:this._painterState=g.A,this._painterEnabled=!1}},C.prototype._setColumnWidth=function(e){for(var t=0;t<this._dataGridView.columns.length;t++)this._dataGridView.layout.setColumnWidth(t,e)},C.prototype._buildTable=function(){this._resizableTableModel=this._createResizableModel(),this._resizableTableModel.columns&&this._resizableTableModel.columns.length>0&&(this.lengthHeader=this._resizableTableModel.title_columns.length,this._initTreeModel(),this._insertDataNodes(),this._createDatagrid(),this._initDivs(),this._dataGridView&&this._dataGridView.treeDocument&&this._dataGridView.treeDocument.expandAll())},C.prototype._createResizableModel=function(){var e={lines:[],columns:[],title_columns:[],linesColumns:[]};this._jsonModel=this._matrixModel.getJsonModel(),this._mapDico=this._matrixModel._mapDico;for(var t=this._jsonModel.drivingCriteria,i=[],n=0;n<t.length;n++){var a=this._mapDico[t[n].id],o={};o.id=t[n].id,o.value=a.title,e.title_columns.push(o)}if(void 0!==this._jsonModel.drivingCombinationValues[0])for(var r in this._jsonModel.drivingCombinationValues[0])for(var s=0;s<e.title_columns.length;s++)e.title_columns[s].id===r&&i.push(s);for(var l=0;l<this._jsonModel.drivingCombinationValues.length;l+=1){var d=new Array(this._jsonModel.drivingCriteria.length),c=new Array(this._jsonModel.drivingCriteria.length),u=0;for(var h in this._jsonModel.drivingCombinationValues[l]){a=this._mapDico[this._jsonModel.drivingCombinationValues[l][h].variantValue];d.splice(i[u],1,a.title),a.id=this._jsonModel.drivingCombinationValues[l][h].variantValue,c.splice(i[u],1,a),u++}e.columns.push(d),e.linesColumns.push(c)}for(l=0;l<this._jsonModel.constrainedValues.length;l+=1){var p={};p.id=this._jsonModel.constrainedValues[l].id;a=this._mapDico[p.id];p.id=a.title,p.type=a.type,p.idparent=a.parent,p.idparent?p.value=this._mapDico[p.idparent].title:p.value=a.title,p.seqNumber=a.seqNumber,e.lines.push(p)}return e},C.prototype._initDivs=function(){this._container||(this._container=document.createElement("div"),this._container.classList.add("matrui-table-presenter")),this._dataGridView.inject(this._container),this._dataGridView.layout.postRender()},C.prototype.inject=function(e){e.appendChild(this._container)},C.prototype.destroy=function(){this._container="",this._myEventManager&&(this._myEventManager.cleanup("MatruiTablePresenter"),this._myEventManager=null),this._stopAsyncRecursiveCallSolver(),this.observer&&this.observer.disconnect()},C.prototype._initTreeModel=function(){var e=this._jsonModel.drivingCombinationValues?this._jsonModel.drivingCombinationValues.length:0,t=this._jsonModel.constrainedValues?this._jsonModel.constrainedValues.length:0,i=this.lengthHeader;this.allData=[];for(var n=0;n<t;n++){for(var a={},o=0;o<e;o++)a["col"+o+i]={state:this._jsonModel.states[o][n],stateValidity:this._jsonModel.statesValidity[o][n]||"V",flatIndexRowID:n};this.allData.push(a)}},C.prototype._insertDataNodes=function(){this._dataModelSet=new s,this._treeDocumentModel=new a({useAsyncPreExpand:!0,dataModelSet:this._dataModelSet}),this._treeDocumentModel.prepareUpdate();for(var e=0;e<this._jsonModel.constrainedCriteria.length;e++){var t;!this._mapDico[this._jsonModel.constrainedCriteria[e].id]||"variant"!==this._mapDico[this._jsonModel.constrainedCriteria[e].id].type&&"variability_group"!==this._mapDico[this._jsonModel.constrainedCriteria[e].id].type||(t=n.createTreeNodeDataModel(this._dataModelSet,{label:this._mapDico[this._jsonModel.constrainedCriteria[e].id].title,icons:this._mapDico[this._jsonModel.constrainedCriteria[e].id].image?[this._mapDico[this._jsonModel.constrainedCriteria[e].id].image]:[],grid:{}}),this._treeDocumentModel.addChild(t));for(var i=0;i<this._jsonModel.constrainedValues.length;i++){var o=this._jsonModel.constrainedValues[i].id,r=this.allData[i];this._dataModelSet.createDataModel(r),this._mapDico[this._jsonModel.constrainedValues[i].id]&&this._jsonModel.constrainedCriteria[e].id===this._mapDico[this._jsonModel.constrainedValues[i].id].parent&&t.addChild({label:this._mapDico[o].title,icons:this._mapDico[o].image?[this._mapDico[o].image]:[],grid:this.allData[i]}),this._jsonModel.constrainedCriteria[e].id===this._jsonModel.constrainedValues[i].id&&this._treeDocumentModel.addChild({label:this._mapDico[o].title,icons:this._mapDico[o].image?[this._mapDico[o].image]:[],grid:this.allData[i]})}t&&t.setState({state:"expanded"})}this._treeDocumentModel.pushUpdate()},C.prototype._createCellView=function(e){var i,n,a,o;if(e.cellModel&&(i=e.cellModel.state,n=e.cellModel.stateValidity,o=e.cellModel.drivingCombinationsValidity),"I"===o)a=t.generateMRAvailable();else if("A"===i)switch(n){case"U":case"R":case"E":a=t.generateMRAvailableRequired();break;case"A":case"T":case"I":a=t.generateMRAvailableIncompatible();break;case"C":a=t.generateMRAvailableConflict();break;default:a=t.generateMRAvailable()}else if("N"===i)switch(n){case"C":case"U":case"R":case"E":a=t.generateMRNotAvailableConflict();break;case"A":case"T":case"I":a=t.generateMRNotAvailableIncompatible();break;default:a=t.generateMRNotAvailable()}else if("S"===i)switch(n){case"C":case"T":case"I":a=t.generateMRStandardConflict();break;case"U":case"R":case"E":a=t.generateMRStandardRequired();break;case"A":a=t.generateMRStandardIncompatible();break;default:a=t.generateMRStandard()}else if("D"===i)switch(n){case"U":case"R":case"E":a=t.generateMRDefaultRequired();break;case"C":case"A":case"T":case"I":a=t.generateMRDefaultIncompatible();break;default:a=t.generateMRDefault()}else a=t.generateMRAvailable();return a},C.prototype._updateTooltip=function(e,t){var i=this,n="c"+(t.columnID-1)+"r"+t.rowID;p[n]&&p[n].elements&&(p[n]={}),p[n]=new o({target:e,trigger:"click",constraint:this._container,position:"bottom",alignment:"near"}),e.onclick=function(e){if(this.columnID>=0&&this.rowID>=0){var t=document.querySelectorAll(".wux-controls-popup");p[n].setBody(u.Loading),t&&t[0]&&t[0].setContent(u.Loading);var a=i._matrixModel.getMiniJsonModel(this.columnID-1);a._clientData.rowID=this.cellModel.flatIndexRowID,a._clientData.treeRowID=this.rowID;var o="";if(a.states[0])for(var r=0;r<a.states[0].length;r++)o+=r===this.cellModel.flatIndexRowID?"Y":"N";a.statesCauses=[o],e.target.classList.contains("mr-span-conflict")&&(a._clientData.isConflict=!0,i._privateChannel.publish({event:"show-loading-conflict-right-panel"}),a.runtimeCauseComputation="yes",a.buildtimeCheckLevel="statesValidity",a.buildtimeCauseComputation="yes",i._callSolverToAbort().then(function(){i._callSolverConflict(a)},function(){console.log('Error "abort" solver matruiTablePresenter')})),e.target.getParent().classList.contains("triangle")&&(a.runtimeCauseComputation="yes",i._callSolverToAbort().then(function(){i._callSolverSuggestion(a)},function(){console.log('Error "abort" solver matruiTablePresenter')}))}}.bind(t)},C.prototype.setTooltip=function(t,i,n){var a=u.ReasonString;switch(t.states+t.statesValidity){case"SA":case"ST":case"SI":case"DI":case"DT":case"DA":case"NE":case"NR":case"NU":a+=u.stateValidity_C_Rule;break;case"AC":case"SC":case"DC":case"NC":a+=u.stateValidity_C;break;case"DU":case"SU":case"AU":a+=u.stateValidity_U;break;case"DR":case"DE":case"AR":case"AE":case"SR":case"SE":a+=u.stateValidity_RE;break;case"NA":case"NT":case"NI":case"AA":case"AT":case"AI":a+=u.stateValidity_ATI}if((t.statesCausingRules.length>0||t.statesCausingValues.length>0)&&(a+=u.due_to),t.statesCausingValues.length>0&&0===t.statesCausingRules.length){a+=u.current_Selection;for(var o=0;o<t.statesCausingValues.length;o++)o>0&&(a+=", "),a=a+" "+n}if(t.statesCausingRules.length>0){a+=u.ImpliedRulesString;for(o=0;o<t.statesCausingRules.length;o++)o>0&&(a+=", "),a=a+" "+n}var r="c"+i.columnID+"r"+i.treeRowID;p[r]&&(p[r].setBody(a),p[r].getContent().addClassName("mr-custom-popup"),p[r].show()),d.unmask(e.extendElement(this._container))},C.prototype._createDatagrid=function(){var t=this,n=i.SETTINGS.STANDARD;delete n.height,n.columns=[],n.treeDocument=this._treeDocumentModel,n.selectionMode="cell",n.defaultColumnDef={minWidth:40,editableFlag:!0,resizableFlag:!0,sortableFlag:!0,allowUnsafeHTMLContent:!1};for(var a=this._jsonModel.drivingCombinationValues?this._jsonModel.drivingCombinationValues.length:0,o=this.lengthHeader,r=[],s={},c=this.lengthHeader;c>-1;c-=1)s=c<this.lengthHeader?{text:this._resizableTableModel.title_columns[c].value,dataIndex:"colTree"+c,children:[s],editableFlag:!1}:{text:u.ConstrainedCriteria,dataIndex:"tree",pinned:"left",width:"150px",editableFlag:!1};r.push(s),this.mappingData=[];for(var h=0;h<a;h+=1){s={};for(var p=o;p>-1;p-=1)p<o?(this.mappingData.push({dataIndex:"col"+h+p,columnID:h+1,rowID:-(o-p)-1,text:this._resizableTableModel.columns[h][p],idObject:this._resizableTableModel.linesColumns[h][p].id}),s={text:this._resizableTableModel.columns[h][p],dataIndex:"col"+h+p,seqNumber:this._resizableTableModel.linesColumns[h][p].seqNumber,children:[s]}):s={text:"",dataIndex:"col"+h+p,typeRepresentation:"dropdownSelection",editableFlag:!0,setCellValue:function(i,n){var a,o=i.columnID-1,r=i.nodeModel._options.grid["col"+o+t.lengthHeader].flatIndexRowID;switch(n){case g.S:a="S";break;case g.D:a="D";break;case g.N:a="N";break;case g.A:a="A"}if(t._matrixModel.setStateWithID(o,r,a),"S"===a||"D"===a)for(var s=0;s<t._jsonModel.constrainedValues.length;s+=1)s===r||"option"===t._mapDico[t._jsonModel.constrainedValues[s].id].type||"S"!==t._matrixModel.__jsonModel.states[o][s]&&"D"!==t._matrixModel.__jsonModel.states[o][s]||!t._mapDico[t._jsonModel.constrainedValues[s].id].parent||t._mapDico[t._jsonModel.constrainedValues[s].id].parent!==t._mapDico[t._jsonModel.constrainedValues[r].id].parent||t._matrixModel.setStateWithID(o,s,"A");t._matrixModel.setTimerIDForColumnID(o);var l=t._matrixModel.getMiniJsonModel(o);l.check="runtime",d.mask(e.extendElement(t._container)),t._updateColumnCombination(l),t._privateChannel.publish({event:"mr-model-change",data:""})},onCellRequest:function(e){var i=e.columnID-1;if(e.cellView.getContent().getElement(".triangle")&&e.cellView.getContent().getElement(".triangle").remove(),e.cellView.getContent().getElement(".mr-span-conflict")&&e.cellView.getContent().getElement(".mr-span-conflict").remove(),e.nodeModel&&e.nodeModel._options.grid["col"+i+t.lengthHeader]&&e.cellModel){t._dataGridView.prepareUpdateView();var n=e.nodeModel._options.grid["col"+i+t.lengthHeader].flatIndexRowID;e.cellModel.state=t._jsonModel.states[i][n],e.cellModel.stateValidity=t._jsonModel.statesValidity[i][n],e.cellModel.drivingCombinationsValidity=t._jsonModel.drivingCombinationsValidity[i],e.cellModel.flatIndexRowID=n,t._manageMatrixRuleCell(e,t._painterEnabled),t._dataGridView.pushUpdateView()}else t._dataGridView.getTypeRepresentationFactory().generateView(" ",{typePath:"string",readOnly:!0,touchMode:!1,escapeHTML:!0,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:!0},onViewCreated:function(t){e.cellView._setReusableContent(t)}})},getCellClassName:function(e){var i=e.columnID-1;if("I"===t._jsonModel.drivingCombinationsValidity[i])return"invalid-column-cell"},getCellTooltip:function(e){var i=e.columnID-1;if("I"===t._jsonModel.drivingCombinationsValidity[i])return{shortHelp:u.tooltip_invalid_column}}};r.push(s)}n.columns=r,n.showOutlineFlag=!0,this._dataGridView=new l(n),this._dataGridView.onReady(function(){t._stopRecursiveCall=!1,t._updateDatagrid=!0,t._checkAllConflictMatrix(t._matrixModel)}),"Compare"!==this.context&&this._dataGridView.buildStatusBar([{type:1},{type:0,id:"totalColumn",dataElements:{typeRepresentation:"string",value:u.Total_Columns+" : "+(this._jsonModel.drivingCombinationValues.length+1),displayLabel:!0}},{type:0,id:"nbConflict",dataElements:{typeRepresentation:"string"}},{type:0,id:"invalidColumn",dataElements:{typeRepresentation:"string",displayLabel:!0}},{type:0,id:"statusConflict",dataElements:{position:"far",typeRepresentation:"string",value:u.Conflicts_Computing+" : 0%",displayLabel:!0,icon:"clock"}},{type:0,id:"statusSuggestion",dataElements:{position:"far",typeRepresentation:"string",value:u.Suggestions_Computing+" : 0%",displayLabel:!0,icon:"clock"}}]),this._dataGridView.columnDragEnabledFlag=!1,this._dataGridView.columns[0].sortableFlag=!0,this._dataGridView.columns[0].editableFlag=!1,this._dataGridView.showRowBorderFlag=!0,this._dataGridView.layout.rowsHeader=!1,this._dataGridView.layout.cellHeight=36,this._dataGridView.onContextualEvent=function(e){var i=e.cellInfos;if(i&&i.rowID<-1){if(!(i.columnID>0))return t.createMenuVariant(i);if(t._editable)return t.createMenuValue(i)}return[]},this._dataGridView.addEventListener("click",function(e,i){if(i&&i.rowID<-1&&e.target.classList.contains("wux-ui-3ds-help")){var n=i.columnID;t.arrColumnAfterSort&&t.arrColumnAfterSort.length>0&&(n=t.arrColumnAfterSort[n-1].columnID);var a=t._matrixModel.getMiniJsonModel(n-1);a._clientData.rowID=i.rowID,t._callSolverDrivingCombCause(a)}else t._painterEnabled&&i&&i.cellModel&&i.columnID>0&&i.rowID>=0&&i.nodeModel&&i.nodeModel._options.grid["col"+(i.columnID-1)+t.lengthHeader]&&"I"!==i.cellModel.drivingCombinationsValidity&&t._dataGridView.setModelAt(i.cellID,t._painterState)});var C={dropdownSelection:{stdTemplate:"comboSelector",semantics:{possibleValues:[{value:g.S,icon:{iconName:m,fontIconFamily:1}},{value:g.D,icon:{iconName:_,fontIconFamily:1}},{value:g.N,icon:{iconName:v,fontIconFamily:1}},{value:g.A,icon:{iconName:" ",fontIconFamily:1}}]}}};if(this._dataGridView.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(C)),this.notVisibleColumns=[],this.notVisibleColumns=this.removeDuplicateFilterValues(this.headerFilter),this.updateCountColumn(this._jsonModel.drivingCombinationValues.length+1-(this.invalidFilter.length+this.notVisibleColumns.length)),this.invalidFilter.length>0)this.updateCountInvalidColumn(this.invalidFilter.length);else{var f;f=this.notVisibleColumns.filter(e=>this.invalidColumn.includes(e)),this.updateCountInvalidColumn(f.length)}this.updateDataGridVisibleColumn(this.headerFilter,this.invalidFilter)},C.prototype._manageMatrixRuleCell=function(e,i){var n;if(n=i?null===(n=e.cellView.getContent().getElement(".wux-controls-combobox"))?e.cellView.getContent().getElement(".mr-body-cell"):null:e.cellView.getContent().getElement(".wux-controls-combobox"),"I"!==e.cellModel.drivingCombinationsValidity)if(null!==n){t.changeStateIcon(e,i);var a=e.cellView.elements.container.querySelector(".mr-combi-details");a&&this._updateTooltip(a,e)}else this._createMatrixRuleCell(e,this._painterEnabled);else this._createMatrixRuleCell(e,!0)},C.prototype._createCompareView=function(t){if(1===t.cellModel.state.length){let i=new e.Element("div"),n=t.cellModel.state;switch(i.addClassName("iconDiv"),n){case"S":i.addClassName("fonticon fonticon-check");break;case"D":i.addClassName("fonticon fonticon-favorite-on");break;case"N":i.addClassName("fonticon fonticon-block")}return i}if(t.cellModel.state.length>1){let o=new e.Element("div"),r=new e.Element("div"),s=new e.Element("div"),l=new e.Element("span"),d=new e.Element("span");r.appendChild(l),s.appendChild(d),s.addClassName("rightOnly"),r.addClassName("leftOnly"),o.addClassName("celldiv"),l.addClassName("leftIcon"),d.addClassName("rightIcon"),o.appendChild(r),o.appendChild(s);var i=t.cellModel.state,n=i[0],a=i[1];switch(n){case"S":l.addClassName("fonticon fonticon-check");break;case"D":l.addClassName("fonticon fonticon-favorite-on");break;case"N":l.addClassName("fonticon fonticon-block")}switch(a){case"S":d.addClassName("fonticon fonticon-check");break;case"D":d.addClassName("fonticon fonticon-favorite-on");break;case"N":d.addClassName("fonticon fonticon-block")}return o}},C.prototype._createMatrixRuleCell=function(e,t){var i=this;if("Compare"===i.context){let t=i._createCompareView(e);e.cellView._setReusableContent(t)}else{var n;switch(e.cellModel.state){case"S":n=g.S;break;case"D":n=g.D;break;case"N":n=g.N;break;case"A":n=g.A}this._dataGridView.getTypeRepresentationFactory().generateView(n,{typePath:t?"functionIcon":"dropdownSelection",readOnly:!1,touchMode:!1,escapeHTML:!0,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:!0},onViewCreated:function(t){var n=i._createCellView(e);if(i._editable&&"I"!==e.cellModel.drivingCombinationsValidity){if(i._painterEnabled)t.elements.container&&(t.elements.container.setContent(n),t.elements.container.style.backgroundColor="transparent"),e.cellView._setReusableContent(n);else if(t.elements.internalView&&t.elements.internalView.elements){t.elements.internalView.elements.expander.style.display="none",t.elements.internalView.elements.mainElement.style.backgroundColor="transparent",t.elements.internalView.elements.mainElement.style.marginLeft="19px",t.elements.internalView.elements.mainElement.setContent(n);var a=n.querySelector(".mr-span-conflict")||n.querySelector(".triangle");e.cellView.elements.container.addContent(a),e.cellView.elements.container.children.length>2&&e.cellView.elements.container.firstChild.remove(),e.cellView._setReusableContent(t)}}else t.elements.container&&(t.elements.container.setContent(n),t.elements.container.style.backgroundColor="transparent"),e.cellView._setReusableContent(n);var o=e.cellView.elements.container.querySelector(".mr-combi-details");o&&i._updateTooltip(o,e)}})}},C.prototype._updateColumnCombination=function(e){var t=this,i=e;t._stopAsyncRecursiveCallSolver(),this._updateDatagrid=!0,this._callSolverToAbort().then(function(){t._callSolverConflict(i,!0).then(function(){t._callSolverSuggestion(i,!0).then(function(){var e=t._matrixModel.getMiniJsonModel(t.columnNumber);t._stopRecursiveCall=!1,t.checkAllConflictDone?t._recursiveCheckSuggestionMatrixModel(e,t.columnNumber):t._recursiveCheckConflictMatrixModel(e,t.columnNumber)},function(e){console.error(e)})},function(e){console.error(e)})},function(e){console.error(e)})},C.prototype._restartMatrixSolverCall=function(){var e=this;this._privateChannel.publish({event:"reset-loading-status-bar"}),e._stopRecursiveCall=!0,e._callSolverToAbort().then(function(){e._stopRecursiveCall=!1,e._checkAllConflictMatrix(e._matrixModel)},function(){console.log('Error "abort" solver matruiTablePresenter')})},C.prototype._checkAllConflictMatrix=function(e){var t=e.getMiniJsonModel(0);this.conflictColumn={},this.checkAllConflictDone=!1,this.invalidColumn=[],this._privateChannel.publish({event:"enox-collection-toolbar-disable-action",data:"filter-invalid-column"}),this._recursiveCheckConflictMatrixModel(t)},C.prototype._checkAllSuggestionMatrix=function(e){var t=e.getMiniJsonModel(0);this._recursiveCheckSuggestionMatrixModel(t)},C.prototype._recursiveCheckConflictMatrixModel=function(e,t){var i=this;"Compare"!==i.context&&(this.columnNumber=t||0,e&&this._callSolverConflict(e,!0).then(function(){if(i.columnNumber++,i._updateLoadingStatus(i.columnNumber,"conflict"),!1===i._stopRecursiveCall){var e=i._matrixModel.getMiniJsonModel(i.columnNumber);e?setTimeout(i._recursiveCheckConflictMatrixModel(e,i.columnNumber),10):(i.checkAllConflictDone=!0,i._checkAllSuggestionMatrix(i._matrixModel))}},function(e){console.error("Error _callSolverConflict _recursiveCheckConflictMatrixModel"),console.error(e)}))},C.prototype._recursiveCheckSuggestionMatrixModel=function(e,t){var i=this;this.columnNumber=t||0,e&&this._callSolverSuggestion(e,!0).then(function(){if(i.columnNumber++,i.columnNumber<=i._matrixModel.getNumberCombination()&&i._updateLoadingStatus(i.columnNumber,"suggestion"),!1===i._stopRecursiveCall){var e=i._matrixModel.getMiniJsonModel(i.columnNumber);e&&setTimeout(i._recursiveCheckSuggestionMatrixModel(e,i.columnNumber),10)}i.columnNumber===i._matrixModel.getNumberCombination()&&i._privateChannel.publish({event:"enox-collection-toolbar-enable-action",data:"filter-invalid-column"})},function(){console.log("[_recursiveCheckSuggestionMatrixModel : _callSolverSuggestion] failed/rejected!")})},C.prototype._callSolverToAbort=function(){return r.abortSolverCall(this._solverKey,this._solverModelEvent)},C.prototype._callSolverConflict=function(e,t){return r.callSolveForRulesCheckConflict(e,this._solverKey,this._solverModelEvent,t)},C.prototype._callSolverSuggestion=function(e,t){return r.callSolveForRulesCheckSuggestion(e,this._solverKey,this._solverModelEvent,t)},C.prototype._callSolverDrivingCombCause=function(e){return r.callSolveForCausingDrivingComb(e,this._solverKey,this._solverModelEvent)},C.prototype.update=function(t,i){var n=e.is(t.columnID,"number")&&t.columnID>=0?t.columnID+1:0;if(this._updateDatagrid)if(n&&this._dataGridView&&this._dataGridView.treeDocument){this._dataGridView.prepareUpdateView(),this.countInvalidColumn(n,i);t=this._dataGridView.layout.getDataIndexFromColumnIndex(n);this._dataGridView.updateRenderedColumn(n,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}),d.unmask(e.extendElement(this._container)),this._dataGridView.pushUpdateView(),this.countConflict(n,this._jsonModel)}else this._container.innerHTML="",this._buildTable(),this._container&&d.unmask(e.extendElement(this._container))},C.prototype.refresh=function(){this._container.innerHTML="",this.arrColumnAfterSort=[],this._mapDico=this._matrixModel._mapDico,this._jsonModel=this._matrixModel.getJsonModel(),this._jsonModel.states&&this._jsonModel.states.length>0&&this._buildTable()},C.prototype._stopAsyncRecursiveCallSolver=function(){this._stopRecursiveCall=!0},C.prototype.createMenuVariant=function(e){var t=[];if(t.push({type:"PushItem",title:u.Sort_By,submenu:this.createMenuItemSort(e)}),this._resizableTableModel.linesColumns){for(var i=[],n=0;n<this._resizableTableModel.linesColumns.length;n++){for(var a=!1,o=this._resizableTableModel.linesColumns[n][this._resizableTableModel.linesColumns[n].length+(e.rowID+1)],r=0;r<i.length;r++)if(i[r].id===o.id){a=!0;break}a||i.push(o)}t.push({type:"PushItem",title:u.Filter,submenu:this.createMenuItemFilter(i,e)})}return t},C.prototype.createMenuValue=function(e){var t=[];return t.push({type:"PushItem",title:u.SetColumn,submenu:this.createMenuItemSetColumn(e)}),t},C.prototype.createMenuItemFilter=function(e,t){for(var i=[],n=0;n<e.length;n++){if(this.headerFilter.length>0)for(var a=0;a<this.headerFilter.length;a++){if(this.headerFilter[a].id===e[n].id){o=void 0;break}o={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-check"}}else var o={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-check"};i.push({type:"PushItem",title:e[n].title,fonticon:o,visible:!0,action:{callback:function(e){this.filterColumn(e.context.item.id,e.context.row)}.bind(this),context:{item:e[n],row:t}}})}return i},C.prototype.createMenuItemSort=function(e){var t=[],i=[],n=[];return i.push({type:"RadioItem",title:u.ASC,state:"",action:{callback:function(t){this.sortColumn(e,"asc","text"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","asc"),e.cellView.elements.container.setAttribute("type-representation","string")}.bind(this),context:{}}}),i.push({type:"RadioItem",title:u.DESC,state:"",action:{callback:function(t){this.sortColumn(e,"desc","text"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","desc"),e.cellView.elements.container.setAttribute("type-representation","string")}.bind(this),context:{}}}),n.push({type:"RadioItem",title:u.ASC,state:"",action:{callback:function(t){this.sortColumn(e,"asc","integer"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","asc"),e.cellView.elements.container.removeAttribute("type-representation","string")}.bind(this)}}),n.push({type:"RadioItem",title:u.DESC,state:"",action:{callback:function(t){this.sortColumn(e,"desc","integer"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","desc"),e.cellView.elements.container.removeAttribute("type-representation","string")}.bind(this)}}),t.push({type:"PushItem",title:u.SeqNumber,submenu:n}),t.push({type:"PushItem",title:u.Title,submenu:i}),t},C.prototype.createMenuItemSetColumn=function(e){var t=this,i=[];return i.push({type:"PushItem",title:u.NA,state:t.invalidColumn.includes(e.columnID)?"disabled":"enabled",action:{callback:function(t){if(e&&e.columnID>0&&e.rowID<0){t.context.object.setColumnTo(e,"N")}},context:{object:this}}}),i.push({type:"PushItem",title:u.Available,state:t.invalidColumn.includes(e.columnID)?"disabled":"enabled",action:{callback:function(i){(t=i.context.object).setColumnTo(e,"A")},context:{object:this}}}),i},C.prototype.getStableColumnId=function(e){for(var t=!1,i=this._dataGridView.layout.getColumnOrGroupFromCoordinates(e);!t;)i.children?i=i.children[0]:t=!0;return this._dataGridView.layout.getColumnIndex(i.dataIndex)},C.prototype.setColumnTo=function(t,i){var n=this.getStableColumnId(t);this._matrixModel.__jsonModel.states[n-1]=i.repeat(this._matrixModel.__jsonModel.states[n-1].length);var a=this._matrixModel.getMiniJsonModel(n-1);a.check="runtime",d.mask(e.extendElement(this._container)),this._updateColumnCombination(a),this._privateChannel.publish({event:"mr-model-change",data:""})},C.prototype.sortColumn=function(t,i,n){for(var a=[],o=this._dataGridView.layout.getLeafColumns().length,r=1;r<o;r++)a.push(e.merge({columnID:this._dataGridView.layout.getOrderedColumnsIndexes()[r]},this._dataGridView.layout.getColumnOrGroupFromCoordinates({rowID:t.rowID,columnID:r})));this.invalidColumn&&this.invalidColumn.length>0&&(this.invalidColumn=[]);var s=this.bubbleSort(a,i,n);this.arrColumnAfterSort=s,this._dataGridView.prepareUpdateView();for(var l=0;l<s.length;l++)this._dataGridView.layout.moveColumn(s[l].columnID,this._dataGridView.layout.getOrderedColumnsIndexes()[l+1]),s[l].icon&&this.invalidColumn.push(l+1);this._dataGridView.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})},C.prototype.resetFilter=function(){if(this._privateChannel.publish({event:"enox-collection-toolbar-change-icon-action",data:{id:"filter-column",fonticon:"list-filter",text:u.Filter_Column}}),this._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:[],headerFilter:[]}}),this.invalidFilter=[],this.headerFilter=[],this._dataGridView){this._dataGridView.prepareUpdateView();for(var e=0;e<this._dataGridView.layout.getLeafColumns().length;e++)this._dataGridView.layout.setColumnVisibleFlag(e,!0),this.conflictColumn&&this.conflictColumn[e]&&(this.conflictColumn[e].visible=!0);this.updateCountConflict(),this.updateCountColumn(this._jsonModel.drivingCombinationValues.length+1),this.updateCountInvalidColumn(),this._dataGridView.pushUpdateView()}},C.prototype.filterInvalidColumn=function(){var t=e.clone(this._matrixModel.getJsonModel());this.previousInvalidFilter=e.clone(this.invalidFilter),this._dataGridView.prepareUpdateView();for(var i=0;i<t.drivingCombinationsValidity.length;i++)"I"===t.drivingCombinationsValidity[i]&&(this.invalidFilter.includes(i+1)||(this.invalidFilter.push(i+1),this._dataGridView.layout.columns[i+1]&&this._dataGridView.layout.setColumnVisibleFlag(this.invalidFilter[this.invalidFilter.length-1],!1)));this.invalidFilter.length>0&&this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"filter-column",icon:"list-filter"}}),this._dataGridView.pushUpdateView(),this._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:this.invalidFilter,headerFilter:this.headerFilter}});var n;for(n=this.removeDuplicateFilterValues(this.headerFilter),i=0;i<n.length;i++)this.conflictColumn[n[i]]&&(this.conflictColumn[n[i]].visible=!1);this.updateCountConflict(),this.updateCountInvalidColumn(this.invalidFilter.length),this.updateCountColumn(this._jsonModel.drivingCombinationValues.length+1-(this.invalidFilter.length+n.length))},C.prototype.filterColumn=function(t,i){var n=!1;this.previousHeaderFilter=e.clone(this.headerFilter);for(var a=0;a<this.headerFilter.length;a++)this.headerFilter[a].id===t&&this.headerFilter[a].rowID===i.rowID&&(this.headerFilter.splice(a,1),n=!0,a--);var o=[];if(this._dataGridView.prepareUpdateView(),!n){for(var r=[],s=0;s<this.mappingData.length;s++)t===this.mappingData[s].idObject&&i.rowID===this.mappingData[s].rowID&&(this.invalidFilter.includes(this.mappingData[s].columnID)||(r.push(this.mappingData[s].columnID),this._dataGridView.layout.setColumnVisibleFlag(this.mappingData[s].columnID,!1)));this.headerFilter.push({columnID:r,id:t,rowID:i.rowID})}var l=[];for(a=1;a<this._dataGridView.layout.getLeafColumns().length;a++)l.push(a);this.invalidFilter.length>0&&(l=l.filter(e=>!this.invalidFilter.includes(e)));var d=[];if(this.headerFilter.length>0){o=this.removeDuplicateFilterValues(this.headerFilter);for(a=0;a<o.length;a++)this.invalidColumn.includes(o[a])&&d.push(a),this.conflictColumn[o[a]]&&(this.conflictColumn[o[a]].visible=!1);l=l.filter(e=>!o.includes(e))}for(a=0;a<l.length;a++)l[a]&&(this._dataGridView.layout.setColumnVisibleFlag(l[a],!0),this.conflictColumn[l[a]]&&!this.conflictColumn[l[a]].visible&&(this.conflictColumn[l[a]].visible=!0));this._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:this.invalidFilter,headerFilter:this.headerFilter}}),0===this.headerFilter.length&&0===this.invalidFilter.length?this._privateChannel.publish({event:"enox-collection-toolbar-change-icon-action",data:{id:"filter-column",fonticon:"list-filter",text:u.Filter_Column}}):this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"filter-column",icon:"list-filter"}}),this.updateCountConflict(),this.updateCountInvalidColumn(d.length),this.updateCountColumn(l.length+1),this._dataGridView.pushUpdateView()},C.prototype.removeAllIconSortHeader=function(){for(var e=document.getElementsByClassName("wux-layouts-datagridview-column-header-cell"),t=0;t<e.length;t++)e[t].removeAttribute("sort-direction"),e[t].removeAttribute("type-representation")},C.prototype.bubbleSort=function(e,t,i){i=i.toLowerCase(),t=t.toLowerCase();var n=e.length;switch(i){case"integer":for(var a=n-1;a>=0;a--)for(var o=1;o<=a;o++)if(parseInt(e[o-1].seqNumber,10)>parseInt(e[o].seqNumber,10)){var r=e[o-1];e[o-1]=e[o],e[o]=r}break;case"text":for(a=n-1;a>=0;a--)for(o=1;o<=a;o++)if(e[o-1].text>e[o].text){r=e[o-1];e[o-1]=e[o],e[o]=r}}return"desc"===t&&e.reverse(),e},C.prototype._updateLoadingStatus=function(e,t){var i=this._matrixModel.getJsonModel().drivingCombinationValues.length,n=Math.floor(100*e/i);switch(n>100&&(console.error("Caution they have a issue in _updateLoadingStatus where we have a % over 100"),n=100),t){case"conflict":this.loadingConflictPercent=n;var a={id:"statusConflict",text:u.Conflicts_Computing+" : "+this.loadingConflictPercent+"%",icon:100===this.loadingConflictPercent?"check":"clock"};this._updateStatusBar(a);break;case"suggestion":this.loadingSuggestionPercent=n;a={id:"statusSuggestion",text:u.Suggestions_Computing+" : "+this.loadingSuggestionPercent+"%",icon:100===this.loadingSuggestionPercent?"check":"clock"};this._updateStatusBar(a);break;default:console.error("Error updateLoadinPanel : typeUpdate not recognize")}},C.prototype._updateStatusBar=function(e){"Compare"!==this.context&&(e&&this._dataGridView.elements.statusBar.getNodeModelByID(e.id).updateOptions({grid:{data:e.text,semantics:{icon:e.icon}}}))},C.prototype.countConflict=function(e,i){if(e&&i){var n=i.statesValidity[e-1],a=i.states[e-1];if(n&&a)for(var o=0;o<n.length;o++)if("conflict"===t.getCellState(a[o],n[o]))this.conflictColumn[e]?this.conflictColumn.nbTotalConflict&&!this.conflictColumn[e].rowID.includes(o)&&(this.conflictColumn.nbTotalConflict++,this.conflictColumn[e].rowID.push(o),this.updateCountConflict()):(this.conflictColumn[e]={columnID:e,rowID:[o],visible:!0},this.conflictColumn.nbTotalConflict?this.conflictColumn.nbTotalConflict++:this.conflictColumn.nbTotalConflict=1,this.notVisibleColumns&&this.notVisibleColumns.length>0&&this.notVisibleColumns.includes(e)&&(this.conflictColumn[e].visible=!1),this.updateCountConflict());else if(this.conflictColumn[e]&&this.conflictColumn[e].rowID.includes(o)){var r=this.conflictColumn[e].rowID.indexOf(o);this.conflictColumn[e].rowID.splice(r,1),this.conflictColumn.nbTotalConflict--,0===this.conflictColumn[e].rowID.length&&delete this.conflictColumn[e],this.updateCountConflict()}}},C.prototype.countInvalidColumn=function(e,t){if(e&&t&&("I"===t.drivingCombinationsValidity&&(this.invalidColumn.includes(e)||this.invalidColumn.push(e),this.updateCountInvalidColumn(this.invalidFilter.length)),t.InvalidDrivingValues&&t.InvalidDrivingValues.length>0&&(t.drivingCombinationsInvalidValues=t.InvalidDrivingValues),t.drivingCombinationsValidity&&"I"===t.drivingCombinationsValidity)){this._dataGridView.prepareUpdateView();var i={icon:{iconName:"help"}};if(t.drivingCombinationsInvalidValues&&t.drivingCombinationsInvalidValues.length>0)for(var n=t.drivingCombinationsInvalidValues[0],a=0;a<n.length;a++){var o=this._dataGridView.layout._columnItemsByDepth[a][e].dataIndex;i.text=this._resizableTableModel.columns[e-1][a]+" (invalid)",this._dataGridView.layout.getLeafColumns()[e].editableFlag=!1,this._dataGridView.layout.setColumnOrGroupProperties(o,i)}this._dataGridView.pushUpdateView()}},C.prototype.updateCountInvalidColumn=function(e){var t,i;this.invalidColumn.length>0&&(e&&e>0?(t=this.invalidColumn.length-e,i={id:"invalidColumn",text:u.Invalid_columns+" : "+t+"/"+this.invalidColumn.length}):i={id:"invalidColumn",text:u.Invalid_columns+" : "+this.invalidColumn.length},this._updateStatusBar(i))},C.prototype.updateCountColumn=function(e){if(e){var t={id:"totalColumn",text:e===this._jsonModel.drivingCombinationValues.length+1?u.Total_Columns+" : "+(this._jsonModel.drivingCombinationValues.length+1):u.Total_Columns+" : "+e+"/"+(this._jsonModel.drivingCombinationValues.length+1)};this._updateStatusBar(t)}},C.prototype.countNotVisibleConflicts=function(){var e=0;for(var t in this.conflictColumn)this.conflictColumn[t].rowID&&(this.conflictColumn[t].visible||(e+=this.conflictColumn[t].rowID.length));return e},C.prototype.updateCountConflict=function(){if(this.conflictColumn){var e=this.countNotVisibleConflicts();if(this.conflictColumn.nbTotalConflict&&this.conflictColumn.nbTotalConflict>0)if(e&&e>0){var t=this.conflictColumn.nbTotalConflict-e,i={id:"nbConflict",text:u.Number_Conflict+" : "+t+"/"+this.conflictColumn.nbTotalConflict,icon:"attention"};this._updateStatusBar(i)}else{i={id:"nbConflict",text:u.Number_Conflict+" : "+this.conflictColumn.nbTotalConflict,icon:"attention"};this._updateStatusBar(i)}else{i={id:"nbConflict"};this._updateStatusBar(i)}}},C.prototype.removeDuplicateFilterValues=function(e){var t=[];if(e&&e.length>0){var i;i=e.map(e=>e.columnID),t=(t=t.concat.apply(t,i)).filter(function(e,i){return t.indexOf(e)===i})}return t},C.prototype.updateDataGridVisibleColumn=function(e,t){if(this._dataGridView&&e&&t){var i=this._dataGridView.layout.getOrderedColumnsIndexes();if(t.length>0)for(var n=0;n<t.length;n++)i.includes(t[n])&&this._dataGridView.layout.setColumnVisibleFlag(t[n],!1);if(e.length>0)for(n=0;n<e.length;n++)for(var a=e[n].columnID,o=0;o<a.length;o++)i.includes(a[o])&&this._dataGridView.layout.setColumnVisibleFlag(a[o],!1)}},C}),define("DS/CfgRuleMatrixComponent/Model/MatrixRuleModel",["UWA/Core","DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils","i18n!DS/CfgRuleMatrixComponent/assets/nls/MatrixRuleModel"],function(e,t){"use strict";var i=function(e,t){this.init(e,t)};return i.prototype.init=function(e,i){var n=t.convertJsonToV3(e,i);this.__jsonModel=JSON.parse(JSON.stringify(n)),this.__jsonModel.drivingCombinationsValidity=this.__jsonModel.drivingCombinationsValidity||[],this._isUpdatingDrivingCriteria=!1,void 0!==this.__jsonModel.drivingCombinationsValidity&&"string"==typeof this.__jsonModel.drivingCombinationsValidity&&(this.__jsonModel.drivingCombinationsValidity=[]),this._allDrivingCombination=[],this._drivingCriteria=this.__jsonModel.drivingCriteria||[],this._constrainedCriteria=this.__jsonModel.constrainedCriteria||[],this._constrainedValues=this.__jsonModel.constrainedValues||[],this._drivingCombinationValues=this.__jsonModel.drivingCombinationValues||[],this._mapDico=e||[],this._states=this.__jsonModel.states||[],this._statesValidity=this.__jsonModel.statesValidity||[],this._timerID=[]},i.prototype.getJsonModel=function(){return this.__jsonModel},i.prototype.setJsonModel=function(t){e.extend(this.__jsonModel,t),this._drivingCriteria=this.__jsonModel.drivingCriteria,this._constrainedCriteria=this.__jsonModel.constrainedCriteria,this._constrainedValues=this.__jsonModel.constrainedValues,this._drivingCombinationValues=this.__jsonModel.drivingCombinationValues,this._states=this.__jsonModel.states,this._statesValidity=this.__jsonModel.statesValidity,this.createAllDrivingCombination(this._drivingCriteria)},i.prototype.setIsUpdatingDrivingCriteria=function(e){this._isUpdatingDrivingCriteria=e},i.prototype.reOrderDrivingCriteria=function(){var e=this,t=[];e.__jsonModel.drivingCriteria.forEach(function(e){t.push(e.id)});var i=function(i,n){for(var a=0,o=i[0],r=n[0],s=0;s<t.length;s++){var l=t[s];if(void 0!==o[l]){if(o[l].variantValue&&r[l].variantValue){if(e._mapDico[o[l].variantValue].title===e._mapDico[r[l].variantValue].title)continue;a=e._mapDico[o[l].variantValue].title<e._mapDico[r[l].variantValue].title?-1:1}break}}return a},n=function(e){for(var t=0;t<e.length;t++)e[t]=[e[t],t];e.sort(i);for(var n=[],a=0;a<e.length;a++)n.push(e[a][1]),e[a]=e[a][0];return n}(e.__jsonModel.drivingCombinationValues),a=[],o=[],r=0;for(r=0;r<n.length;r+=1)a.push(e.__jsonModel.states[n[r]]),o.push(e.__jsonModel.statesValidity[n[r]]);e.__jsonModel.states=a,e.__jsonModel.statesValidity=o},i.prototype.addConstrainedValues=function(t){var i,n,a=this;for(var o in t)if(Object.hasOwn(t,o)){var r=0;for(n=0;n<a.__jsonModel.constrainedCriteria.length;n++){if(e.is(a.__jsonModel.constrainedCriteria[n].selectedValues,"array"))if(a.__jsonModel.constrainedCriteria[n].id===o){var s=[];if(i=t[o],a.__jsonModel.constrainedCriteria[n].selectedValues.forEach(function(e){i.forEach(function(t,i){e.id===t.id?s.push(i):r++})}),s.length>0)for(var l=s.length-1;l>=0;l--)i.splice(s[l],1)}else r+=a.__jsonModel.constrainedCriteria[n].selectedValues.length;if(a.__jsonModel.constrainedCriteria[n].id===o)break}t.hasOwnProperty(o)&&(i=t[o]).forEach(function(e){r>a.__jsonModel.constrainedValues.length&&(r=a.__jsonModel.constrainedValues.length),a.__jsonModel.constrainedValues.splice(r,0,e);var t=a.__jsonModel.states.length;for(0===t&&(t=a.__jsonModel.drivingCombinationValues.length),n=0;n<t;n++){var i=a.__jsonModel.states[n],o="";void 0===i?o+="A":o=i.slice(0,r)+"A"+i.slice(r),a.__jsonModel.states[n]=o}for(n=0;n<t;n++){var s=a.__jsonModel.statesValidity[n],l="";void 0===s?l+="V":l=s.slice(0,r)+"V"+s.slice(r),a.__jsonModel.statesValidity[n]=l}})}},i.prototype.removeConstrainedValues=function(e){var t,i=this;for(var n in e){if(e.hasOwnProperty(n))e[n].forEach(function(e){var n=e.id,a=-1;for(t=0;t<i.__jsonModel.constrainedValues.length;t++)if(i.__jsonModel.constrainedValues[t].id===n&&(!i.__jsonModel.constrainedValues[t].id||i.__jsonModel.constrainedValues[t].id===e.id)){a=t;break}if(a>-1)for(i.__jsonModel.constrainedValues.splice(a,1),t=0;t<i.__jsonModel.states.length;t++){var o=i.__jsonModel.states[t].split("");o.splice(a,1);var r=o.join("");i.__jsonModel.states[t]=r;var s=i.__jsonModel.statesValidity[t].split("");s.splice(a,1);var l=s.join("");i.__jsonModel.statesValidity[t]=l}})}},i.prototype.removeDrivingCombinationValues=function(e){for(var t=0;t<e.length;t++){var i=e[t];-1!==i&&i<this.__jsonModel.drivingCombinationValues.length&&(this.__jsonModel.drivingCombinationValues.splice(i,1),this.__jsonModel.states.splice(i,1),this.__jsonModel.statesValidity.splice(i,1))}},i.prototype.updateDrivingCombinationValues=function(t){var i;if(e.is(t,"array")){t=e.clone(t);var n=[];this.__jsonModel.drivingCombinationValues.forEach(function(e,a){for(var o=-1,r=Object.keys(e),s=0;s<t.length;s++){var l=t[s],d=l.length;if(r.length===d){var c=0;for(i=0;i<d;i++)for(var u=0;u<r.length;u++)if(e[r[u]].variantValue===l[i].id){c++;break}if(c===d){o=s;break}}}-1!==o?t.splice(o,1):n.push(a)});var a=[],o=this;t.forEach(function(e){var t={};e.forEach(function(e){var i=o._mapDico[e.id];i.parent?t[i.parent]={variantValue:e.id}:t[e.id]={value:i.title,type:i.type}}),a.push(t)});var r=[],s=[];if(a.forEach(function(e){var t="",n="";for(i=0;i<o.__jsonModel.drivingCombinationValues.length;i++){var a=o.__jsonModel.drivingCombinationValues[i],l=i,d=Object.keys(a),c=Object.keys(e);if(d.length>0&&d.length<=c.length){for(var u=!1,h=0;h<d.length;h++){var p=e[d[h]],m=a[d[h]];if(!p)break;if(p.variantValue!==m.variantValue)break;u=!0}if(u){t=o.__jsonModel.states[l];break}}}for(i=0;i<o.__jsonModel.constrainedValues.length;i++)t.length<i+1&&(t+="A"),n.length<i+1&&(n+="V");r.push(t),s.push(n)}),n.reverse(),n.forEach(function(e){o.__jsonModel.drivingCombinationValues.splice(e,1),o.__jsonModel.states.splice(e,1),o.__jsonModel.statesValidity.splice(e,1)}),a.length>0){var l=this.__jsonModel.drivingCriteria.map(e=>e.id),d=[];for(let e=0;e<a.length;e++)d.push(l.reduce((t,i)=>(t[i]=a[e][i],t),{})),o.__jsonModel.drivingCombinationValues.push(d[e]),o.__jsonModel.states.push(r[e]),o.__jsonModel.statesValidity.push(s[e])}}},i.prototype.addDrivingCriteria=function(e){this._addCriteria(this.__jsonModel.drivingCriteria,e)},i.prototype.removeDrivingCriteria=function(e){this._removeCriteria(this.__jsonModel.drivingCriteria,e)},i.prototype._addCriteria=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=!1;if(e.forEach(function(e){e.id===i&&(n=!0,t[i].forEach(function(t){var i=!1;e.selectedValues.forEach(function(e){e.id===t.id&&(i=!0)}),i||e.selectedValues.push(t)}))}),!n){var a={id:i};this._mapDico[i]&&(a.selectedValues=t[i]),e.push(a)}}},i.prototype._removeCriteria=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=-1;e.forEach(function(e,a){e.id===i&&(t[i].forEach(function(t){var i=e.selectedValues.findIndex(function(e){return e.id===t.id});-1!==i&&e.selectedValues.splice(i,1)}),0===e.selectedValues.length&&(n=a))}),n>-1&&e.splice(n,1)}},i.prototype.addConstrainedCriteria=function(e){this._addCriteria(this.__jsonModel.constrainedCriteria,e)},i.prototype.removeConstrainedCriteria=function(e){this._removeCriteria(this.__jsonModel.constrainedCriteria,e)},i.prototype.setStateWithID=function(e,t,i){var n=this.__jsonModel.states[e],a=n.substr(0,t)+i+n.substr(t+1,n.length);this.__jsonModel.states[e]=a},i.prototype.getMiniJsonModel=function(e){var t;return this.__jsonModel.drivingCombinationValues[e]&&(t={drivingCriteria:this.__jsonModel.drivingCriteria,constrainedCriteria:this.__jsonModel.constrainedCriteria,drivingCombinationValues:[this.__jsonModel.drivingCombinationValues[e]],drivingCombinationsValidity:[this.__jsonModel.drivingCombinationsValidity[e]],constrainedValues:this.__jsonModel.constrainedValues,states:[this.__jsonModel.states[e]],statesValidity:[this.__jsonModel.statesValidity[e]],version:"3.0",_clientData:{columnID:e,timerID:this._timerID[e]}}),t},i.prototype.replaceStateValidityToConflict=function(t,i){var n=e.clone(t);if(i.statesValidity.length>0)for(var a=0;a<i.statesValidity.length;a++){for(var o="",r=0;r<i.statesValidity[a].length;r++)"C"===n.statesValidity[a][r]?o+="C":o+=i.statesValidity[a][r];n.statesValidity[a]=o}return i.drivingCombinationsValidity&&"I"===i.drivingCombinationsValidity&&(n.drivingCombinationsValidity=i.drivingCombinationsValidity),n},i.prototype.removeStateValidity=function(){for(var e=0;e<this.__jsonModel.statesValidity.length;e++){for(var t="",i=0;i<this.__jsonModel.statesValidity[e].length;i++)t+="V";this.__jsonModel.statesValidity[e]=t}},i.prototype.removeDrivingCombinationsValidity=function(){if(this.__jsonModel&&this.__jsonModel.drivingCombinationsValidity)for(var e=0;e<this.__jsonModel.drivingCombinationsValidity.length;e++)"I"===this.__jsonModel.drivingCombinationsValidity[e]&&(this.__jsonModel.drivingCombinationsValidity[e]="V")},i.prototype.setTimerIDForColumnID=function(e){e>=0&&(this._timerID[e]=performance.now())},i.prototype.updateJsonModel=function(e){var t=e._clientData.columnID;t>=0&&(this.__jsonModel.states[t]=e.states[0],this.__jsonModel.statesValidity[t]=e.statesValidity[0]),void 0!==e.drivingCombinationsValidity&&this.__jsonModel.drivingCombinationsValidity.length>=0&&("I"===e.drivingCombinationsValidity?this.__jsonModel.drivingCombinationsValidity[t]=e.drivingCombinationsValidity:this.__jsonModel.drivingCombinationsValidity[t]="V")},i.prototype.checkAndFixDiscrepancy=function(){var e={_rc:0,discrepancyList:[]},t=0,i=0,n=[],a=[];for(t=0;t<this.__jsonModel.drivingCriteria.length;t+=1)void 0===this._mapDico[this.__jsonModel.drivingCriteria[t].id]&&(this.__jsonModel.states=[],this.__jsonModel.statesValidity=[],this.__jsonModel.drivingCriteria[t]="to remove",this.__jsonModel.drivingCombinationValues=[],a.push(this.__jsonModel.drivingCriteria[t].id));for(this.__jsonModel.drivingCriteria=this.__jsonModel.drivingCriteria.filter(function(e){return"to remove"!==e}),t=0;t<this.__jsonModel.drivingCriteria.length;t+=1)this.__jsonModel.drivingCriteria[t].selectedValues&&(this.__jsonModel.drivingCriteria[t].selectedValues=this.__jsonModel.drivingCriteria[t].selectedValues.filter(e=>{return!(void 0===this._mapDico[e.id])||(a.push(e.id),!1)}));for(t=0;t<this.__jsonModel.constrainedCriteria.length;t+=1)void 0===this._mapDico[this.__jsonModel.constrainedCriteria[t].id]&&(a.push(this.__jsonModel.constrainedCriteria[t].id),this.__jsonModel.constrainedCriteria[t]="to remove");for(this.__jsonModel.constrainedCriteria=this.__jsonModel.constrainedCriteria.filter(function(e){return"to remove"!==e}),t=0;t<this.__jsonModel.constrainedCriteria.length;t+=1)this.__jsonModel.constrainedCriteria[t].selectedValues&&(this.__jsonModel.constrainedCriteria[t].selectedValues=this.__jsonModel.constrainedCriteria[t].selectedValues.filter(e=>{return!(void 0===this._mapDico[e.id])||(a.push(e.id),!1)}));var o=null,r=[];for(t=0;t<this.__jsonModel.drivingCombinationValues.length;t+=1){var s=!0;if(0===r.length)for(o in this.__jsonModel.drivingCombinationValues[0])r.push(o);for(i=0;i<r.length;i+=1)void 0===this._mapDico[this.__jsonModel.drivingCombinationValues[t][r[i]].variantValue]&&(a.push(this.__jsonModel.drivingCombinationValues[t][r[i]].variantValue),s=!1);s||(this.__jsonModel.drivingCombinationValues[t]="to remove",this.__jsonModel.states[t]="YOURE REMOVED",this.__jsonModel.statesValidity[t]="YOURE REMOVED")}for(this.__jsonModel.states=this.__jsonModel.states.filter(function(e){return"YOURE REMOVED"!==e}),this.__jsonModel.statesValidity=this.__jsonModel.statesValidity.filter(function(e){return"YOURE REMOVED"!==e}),this.__jsonModel.drivingCombinationValues=this.__jsonModel.drivingCombinationValues.filter(function(e){return"to remove"!==e}),t=0;t<this.__jsonModel.constrainedValues.length;t+=1)void 0===this._mapDico[this.__jsonModel.constrainedValues[t].id]&&(n.push(t),a.push(this.__jsonModel.constrainedValues[t].id));if(n.length>0){for(i=0;i<this.__jsonModel.states.length;i+=1){for(t=0;t<n.length;t+=1)this.__jsonModel.states[i]=this.__jsonModel.states[i].substr(0,n[t])+"_"+this.__jsonModel.states[i].substr(n[t]+1),this.__jsonModel.statesValidity[i]=this.__jsonModel.statesValidity[i].substr(0,n[t])+"_"+this.__jsonModel.statesValidity[i].substr(n[t]+1);this.__jsonModel.states[i]=this.__jsonModel.states[i].replace(/_/g,""),this.__jsonModel.statesValidity[i]=this.__jsonModel.statesValidity[i].replace(/_/g,"")}for(t=0;t<n.length;t+=1)this.__jsonModel.constrainedValues[n[t]]="test_remove";this.__jsonModel.constrainedValues=this.__jsonModel.constrainedValues.filter(function(e){return"test_remove"!==e})}return e._discrepancyIds=a,e._discrepancyIds.length>0&&(e._discrepancyIds=e._discrepancyIds.filter(function(t,i){return e._discrepancyIds.indexOf(t)===i}),e._rc=-1),e},i.prototype.createAllDrivingCombination=function(e){if(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].selectedValues);this._allDrivingCombination=this.recursiveCombination(t,0),!this._isUpdatingDrivingCriteria&&this._allDrivingCombination&&this.__jsonModel.drivingCombinationValues&&this._allDrivingCombination.length>this.__jsonModel.drivingCombinationValues.length&&this._addMissingDataToJsonModel(this._allDrivingCombination)}else console.error("No driving criteria function initAllDrivingCombination")},i.prototype._addMissingDataToJsonModel=function(e){for(var t=[],i=[],n=[],a=[],o=[],r=0;r<e.length;r++){for(var s=e[r],l={},d=0;d<s.length;d++)if(s[d].id){var c=this._mapDico[s[d].id];if(!c)break;void 0!==c.parent&&(l[c.parent]={variantValue:s[d].id})}if(Object.keys(l).length>0){t.push(l);for(var u=Object.keys(l).sort(),h=0;h<this.__jsonModel.drivingCombinationValues.length;h++){var p=0,m=Object.keys(this.__jsonModel.drivingCombinationValues[h]).sort();if(m.length===u.length&&m.length>0&&u.length>0)for(var v=0;v<m.length;v++)l[u[v]]&&this.__jsonModel.drivingCombinationValues[h][m[v]]&&this.__jsonModel.drivingCombinationValues[h][m[v]].variantValue===l[u[v]].variantValue&&p++;if(p===m.length&&p===u.length){o.push(r);break}}}if(o.includes(r)){var _=this.__jsonModel.states[o.indexOf(r)],g=this.__jsonModel.statesValidity[o.indexOf(r)];void 0!==_&&(i[r]=_),void 0!==g&&(n[r]=g),a[r]="V"}else if(this._constrainedValues.length>0)if(i[r]="",n[r]="",this._states.length>0){a[r]="I";for(var C=0;C<this._states[0].length;C++)i[r]+="A",n[r]+="?"}else{a[r]="V";for(C=0;C<this._constrainedValues.length;C++)i[r]+="A",n[r]+="V"}}this.__jsonModel.drivingCombinationValues=t,this.__jsonModel.states=i,this.__jsonModel.statesValidity=n,this.__jsonModel.drivingCombinationsValidity=a},i.prototype.recursiveCombination=function(t,i){for(var n=[],a=[],o=i;o<t.length;o++)if(o+2===t.length)for(c=0;c<t[o].length;c++)for(var r=0;r<t[o+1].length;r++){var s=[];s.push(t[o][c]),s.push(t[o+1][r]),n.push(s)}else{if(o+2<t.length){for(a=this.recursiveCombination(t,o+1),c=0;c<t[o].length;c++)for(var l=e.clone(a),d=0;d<a.length;d++)l[d].push(t[o][c]),n.push(l[d]);break}if(1===t.length)for(var c=0;c<t[o].length;c++)(a=[]).push(t[0][c]),n.push(a)}return n},i.prototype.addDrivingToAllCombination=function(t){if(0===this._allDrivingCombination.length)for(const e in t)for(var i=0;i<t[e].length;i++)this._allDrivingCombination.push([t[e][i]]);else{var n=[];for(const r in t)for(i=0;i<t[r].length;i++)for(var a=e.clone(this._allDrivingCombination),o=0;o<this._allDrivingCombination.length;o++)a[o].push(t[r][i]),n.push(a[o]);this._allDrivingCombination=n}},i.prototype.getNumberCombination=function(){return this._allDrivingCombination.length},i.prototype.getAllDrivingCombination=function(){return this._allDrivingCombination},i.prototype.formatJsonModelForXmodelListView=function(e,t){var i=this;if(void 0!==this._mapDico){var n=[],a=[],o={},r={member:n,allIds:a};if(e)for(var s in e.forEach(function(e){var r=i._mapDico[e.id],s={};if(void 0!==r)if(void 0!==r.type&&null!==r.type){switch(r.type.toLocaleLowerCase()){case"variant":s.id=e.id,s.type=r.type,s.title=r.title,s.image=r.image,s.sequenceNumber=r.seqNumber,s.description=r.description,a.push(e.id),n.push(s);break;case"option":e.selectedValues&&e.selectedValues[0]?(a.includes(r.parent)?o[r.parent].push(e.id):(o[r.parent]=[],o[r.parent].push(e.id),a.push(r.parent)),a.push(e.id)):"yes"===e.criteriaValidity&&(a.includes(r.parent)?o[r.parent].push(e.id):(o[r.parent]=[],o[r.parent].push(e.id),a.push(r.parent)),a.push(e.id));break;case"variability_group":if(s.id=e.id,s.type=r.type,s.title=r.title,s.image=r.image,s.sequenceNumber=r.seqNumber,s.description=r.description,i._mapDico[e.id].content.length===e.selectedValues.length)a.push(e.id);else{var l=i._mapDico[e.id].content.filter(t=>!e.selectedValues.some(e=>t===e.id)),d="driving-criteria"===t?i.__jsonModel.constrainedCriteria:i.__jsonModel.drivingCriteria;for(let t of d)if(t.id===e.id){l=l.filter(e=>!t.selectedValues.some(t=>e===t.id));break}0===l.length&&a.push(e.id)}n.push(s)}if(e.selectedValues){var c=[];s.options={member:c},e.selectedValues.forEach(function(t){var n={};if(void 0!==t.id){var o=i._mapDico[t.id];void 0!==o?t.id&&(n.id=t.id,n.type=o.type,n.sequenceNumber=o.seqNumber,n.title=o.title,n.image=o.image,n.description=o.description,n.parentId=o.parent,c.push(n),a.push(t.id)):console.error("The dico didn't can't map the id : "+e.id)}})}}else console.log("Error type not defined formatJsonModelForXmodelListView");else console.error("The dictionary can't map the id : "+e.id)}),o){var l={},d=i._mapDico[s];l.id=s,l.type=d.type,l.title=d.title,l.image=d.image,l.sequenceNumber=d.seqNumber,n.push(l);var c=[];l.options={member:c};for(var u=0;u<o[s].length;u++){var h={},p=i._mapDico[o[s][u]];h.id=o[s][u],h.type=p.type,h.title=p.title,h.image=p.image,h.sequenceNumber=p.seqNumber,h.description=p.description,c.push(h)}}return r}console.error("The disco isn't loaded")},i.prototype.formatXmodelListViewForJsonModel=function(e){var t,i=e.parentId?e.parentId:this._mapDico[e.id].parent;if(i)t={[i]:[{id:e.id,parent:i}]};else{var n,a;t={[e.id]:[]};var o=e.values?e.values:e.options;if(o)for(a=0;a<o.member.length;a++)n={id:o.member[a].id,parent:e.id},t[e.id].push(n)}return t},i.prototype.getDetailFromIdOnDico=function(e){return this._mapDico[e]},i}),define("DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter",["DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/Handlebars/Handlebars","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","UWA/Element","text!DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter.html","i18n!DS/CfgRuleMatrixComponent/assets/nls/RunTimePresenter","css!DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter.css"],function(e,t,i,n,a,o,r,s,l){"use strict";var d=function(){};return d.prototype.init=function(t,i,a){this._matrixModel=t,this._privateChannel=i||new n,this._options={},this._options.painter=!!a.painter&&a.painter,this._solverKey=a.solverKey,this._solverModelEvent=a.solverModelEvent,this._dictionary=a.dictionary,this._editable=a.editable,this._subscribedEventTokens=[],this._subscribedEventTokensPrivate=[],this._matruiTablePresenter=new e;try{this._matruiTablePresenter.init(this._matrixModel,this._privateChannel,{solverKey:this._solverKey,solverModelEvent:this._solverModelEvent,dictionary:this._dictionary,editable:this._editable,immersiveFrame:a.immersiveFrame,filter:a.filter,context:a.context})}catch(e){this._matruiTablePresenter.init(this._matrixModel,this._privateChannel,{solverKey:this._solverKey,solverModelEvent:this._solverModelEvent,dictionary:this._dictionary,editable:this._editable,immersiveFrame:a.immersiveFrame,context:a.context})}this._initToolbar(),this._initDivs(),this._subscribeToEvents()},d.prototype._initToolbar=function(){var e=[{id:"painter",fonticon:"brush",text:s.Painter,disabled:!this._editable,content:[{id:"painter-not-available",text:s.NA,fonticon:"brush-block",changeIconSelection:!0},{id:"painter-available",text:s.Available,fonticon:"brush",changeIconSelection:!0},{id:"painter-default",text:s.Default,fonticon:"brush-favorite",changeIconSelection:!0},{id:"painter-selected",text:s.Selected,fonticon:"brush-ok",changeIconSelection:!0},{id:"painter-none",text:s.None,fonticon:"brush",changeIconSelection:!0}]},{id:"zoom",text:s.ResizeColumn,fonticon:"zoom-in",content:[{id:"large",text:s.Large,fonticon:"fonticon fonticon-high"},{id:"medium",text:s.Medium,fonticon:"fonticon fonticon-medium"},{id:"small",text:s.Small,fonticon:"fonticon fonticon-low"}]},{id:"filter-column",text:s.Filter_Column,fonticon:"list-filter",content:[{id:"display-all-combination",text:s.Clear},{id:"filter-invalid-column",text:s.Valid_Column,disabled:!0}]}],i={modelEvents:this._privateChannel,actions:e,useGeneratedToolbar:!0,touchMode:!1};this._containerToolBar=document.createElement("div"),this._containerToolBar.classList.add("matri-table-toolbar"),this.collectionToolbar=new t(i),this.collectionToolbar.inject(this._containerToolBar)},d.prototype._initDivs=function(){var e=i.compile(r)(this._options);this._container=document.createElement("div"),this._container.innerHTML=e,this._container=this._container.firstChild,this._painterContainer=this._container.querySelector(".painter-presenter"),this._matruiTablePresenterContainer=this._container.querySelector(".table-presenter"),this._matruiTablePresenterContainer.appendChild(this._containerToolBar),this._matruiTablePresenter.inject(this._matruiTablePresenterContainer),UWA.extendElement(this._container)},d.prototype._clearPreviousEvents=function(){if(this._solverModelEvent)for(var e=UWA.clone(this._subscribedEventTokens)||[],t=0;t<e.length;t++)this._solverModelEvent.unsubscribe(e[t]);if(this._privateChannel)for(e=UWA.clone(this._subscribedEventTokensPrivate)||[],t=0;t<e.length;t++)this._privateChannel.unsubscribe(e[t])},d.prototype._subscribeToEvents=function(){var e=this;this._subscribedEventTokensPrivate.push(this._privateChannel.subscribe({event:"mr-refresh-run-view"},function(t){e._matruiTablePresenter._options.filter=t,e._matruiTablePresenter.refresh()})),this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_statesConflicts_SolverAnswer"},function(t){var i=t.answerData._clientData?t.answerData._clientData.columnID:-1;i>=0?e._matrixModel.getMiniJsonModel(i)._clientData.timerID===t.answerData._clientData.timerID&&(e._matrixModel.updateJsonModel(t.answerData),e.update({columnID:i},t.answerData)):(e._matrixModel.setJsonModel(t.answerData),e.update({columnID:i},t.answerData));a.unmask(e._container)})),this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_SolverAnswer"},function(t){var i=t.answerData._clientData?t.answerData._clientData.columnID:-1;if(i>=0){var n=e._matrixModel.getMiniJsonModel(i);n._clientData.timerID===t.answerData._clientData.timerID&&(n=e._matrixModel.replaceStateValidityToConflict(n,t.answerData),e._matrixModel.updateJsonModel(n),e.update({columnID:i},t.answerData))}else e._matrixModel.setJsonModel(t.answerData),e.update({columnID:i});a.unmask(e._container)})),this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_SolverReason"},function(t){var i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID;if(i>=0&&n>=0){var o={};o.statesCausingValues=t.answerData.statesCausingValues[0][n],o.statesCausingRules=t.answerData.statesCausingRules[0][n],o.statesValidity=t.answerData.statesValidity[0][n],o.states=t.answerData.states[0][n],e._privateChannel.publish({event:"get-mr-details",data:{conflictingRules:o.statesCausingRules,reasons:o,clientData:t.answerData._clientData}})}a.unmask(e._container)}))},d.prototype.setNewTooltip=function(e){var t="";if(UWA.is(e.member,"array"))for(var i=0;i<e.member.length;i++)e.member.length-1>i?t+=e.member[i].title+",":t+=e.member[i].title;this._matruiTablePresenter.setTooltip(e.reasons,e.clientData,t)},d.prototype.inject=function(e){e.appendChild(this._container)},d.prototype.attachResizeSensor=function(){this.collectionToolbar.attachResizeSensor()},d.prototype.loadData=function(){},d.prototype.update=function(e,t){this._matruiTablePresenter.update(e,t)},d.prototype.destroy=function(){this._matruiTablePresenter.destroy()},d.prototype.refreshUI=function(){this._privateChannel.publish({event:"mr-refresh-run-view"})},d.prototype.restartAsyncCallSolver=function(){this._matruiTablePresenter._restartMatrixSolverCall()},d}),define("DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter",["UWA/Core","DS/Handlebars/Handlebars","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/CfgDictionary/CfgDictionaryMapperUtils","DS/Controls/TabBar","DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter","DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter","DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter","DS/CfgRuleMatrixComponent/Model/MatrixRuleModel","DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils","UWA/Class/Model","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Alert","DS/xModelEventManager/xModelEventManager","text!DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter.html","css!DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter.css","i18n!DS/CfgRuleMatrixComponent/assets/nls/GlobalPresenter"],function(e,t,i,n,a,o,r,s,l,d,c,u,h,p,m,v,_,g,C,f){"use strict";var b=function(){};return b.prototype.init=function(t,n,a,h,p,m){if(this.firstLoad=!0,this._variabilityDictionaryFormatForXmodel=m.variabilityDictionaryFormatForXmodel?m.variabilityDictionaryFormatForXmodel:null,this._options=m,this._solverKey=m.solverKey?m.solverKey:null,this._solverModelEvent=m.solverModelEvent,this._privateChannelForRules=m.privateChannelForRules,this._updateChannel=p,this._applicationChannel=h||void 0,this._privateChannel=new i,this._myEventManager=new _(this._applicationChannel,this._updateChannel,this._privateChannel,this._solverModelEvent),this._currentView="build",this._jsonModel=a||null,this._jsonModel?this._jsonModel.states&&this._jsonModel.states.length>0&&(this._currentView="run"):this._jsonModel={drivingCriteria:[],constrainedCriteria:[],constrainedValues:[],drivingCombinationValues:[],states:[],statesValidity:[],version:"2.0"},this._variabilityDictionary=n,this._contextDictionary=m.contextDico,this._mapDico=o.dicoMinifiedV3ToMap(n),"1.0.1"===this._jsonModel.version){var v=u.convertJsonToV3(this._mapDico,this._jsonModel);this._jsonModel=v}this._matrixRuleModel=new c(this._mapDico,this._jsonModel);var g=this._matrixRuleModel.checkAndFixDiscrepancy();if(0!==g._rc?this._matrixRuleModel.setJsonModel(this._matrixRuleModel.__jsonModel):this._matrixRuleModel.createAllDrivingCombination(this._matrixRuleModel.__jsonModel.drivingCriteria),this._inputJsonModel=e.clone(this._matrixRuleModel.getJsonModel()),this._isReadyToSwitch=!0,this._ruleId=t.ruleId,this._modelId=t.modelId,this._ruleName=t.ruleName,this._ruleSaveAllowed=!0,this._ruleSaveErrorMessage="",this._runTimePresenter=new d,this._drivingCriteriaPresenter=new s,this._constrainedCriteriaPresenter=new l,this._tabBar=new r({displayStyle:"strip",centeredFlag:!1}),this._tabBar.add({label:f._driving_criteria,icon:{iconName:"table",fontIconFamily:WUXManagedFontIcons.Font3DS},isSelected:"build"===this._currentView}),this._tabBar.add({label:f._constrained_criteria,icon:{iconName:"table-vertical",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this._tabBar.add({label:f._content,icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS},isSelected:"run"===this._currentView}),this._workaroundCheckAndWakeUpResizeSensor=m.resizeSensorEnablerFun?m.resizeSensorEnablerFun:function(){},this._runTimePresenter.init(this._matrixRuleModel,this._privateChannel,{painter:!1,solverKey:this._solverKey,solverModelEvent:m.solverModelEvent,dictionary:this._variabilityDictionary,editable:m.editable,immersiveFrame:m.immersiveFrame,filter:m.filter}),this._drivingCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.drivingCriteria,"driving-criteria"),this._constrainedCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.constrainedCriteria,"constrained-criteria"),this._drivingCriteriaPresenter.init(this._drivingCriteriaList,this._matrixRuleModel,this._applicationChannel,this._privateChannel,{updateChannel:this._updateChannel,editable:m.editable,resizeSensorEnablerFun:this._workaroundCheckAndWakeUpResizeSensor,reservedbyFullName:m.reservedbyFullName}),this._constrainedCriteriaPresenter.init(this._constrainedCriteriaList,this._matrixRuleModel,this._applicationChannel,this._privateChannel,{updateChannel:this._updateChannel,editable:m.editable,resizeSensorEnablerFun:this._workaroundCheckAndWakeUpResizeSensor}),this._initDivs(),this._subscribeToEvents(),this._msgError="",0!==g._rc){var C="",b=0;for(b=0;b<g._discrepancyIds.length;b+=1)0===b?C=g._discrepancyIds[b]:C+=", "+g._discrepancyIds[b];this._msgError=C+" "+f._HaveNotBeenFoundWhileOpeningRule}""!==this._msgError&&(this._msgError=f._error_missing_criteria,this._updateChannel.publish({event:"mr-global-presenter-error-criteria-not-found",data:this._msgError}),console.warn(this._msgError)),""!==this._msgError&&this._privateChannel.publish({event:"mr-model-change"});var M=this._matrixRuleModel.getJsonModel();0!==M.drivingCriteria.length&&0!==M.constrainedCriteria.length||this._contentrunContainer.classList.add("no-content")},b.prototype._initDivs=function(){var i=t.compile(g)();this._container=document.createElement("div"),this._container.innerHTML=i,this._container=this._container.firstChild,e.extendElement(this._container),this._alertContainer=this._container.querySelector(".tablerule-alert-container"),this._wizardContainer=this._container.querySelector(".wizard-container"),this._contentDrivingContainer=this._container.querySelector(".contentbuild-container"),this._contentConstrainedContainer=this._container.querySelector(".contentconstrained-container"),this._contentrunContainer=this._container.querySelector(".contentrun-container"),this._alert=new v,this._alert.inject(this._alertContainer),this._tabBar.inject(this._wizardContainer),this._drivingCriteriaPresenter.inject(this._contentDrivingContainer),this._constrainedCriteriaPresenter.inject(this._contentConstrainedContainer),this._runTimePresenter.inject(this._contentrunContainer),e.createElement("div",{class:"no-criteria-container",html:f._noCriteriaSelected}).inject(this._contentrunContainer),"build"===this._currentView?(this._contentrunContainer.classList.add("displaynone"),this._contentConstrainedContainer.classList.add("displaynone"),this._contentDrivingContainer.classList.remove("displaynone")):"run"===this._currentView&&(this._contentDrivingContainer.classList.add("displaynone"),this._contentrunContainer.classList.remove("displaynone"),this._contentrunContainer.classList.remove("no-content")),this._okCancelContainer=this._container.querySelector(".okcancel-footer"),this._createOKCancelActions().inject(this._okCancelContainer)},b.prototype._switchView=function(e){switch(e){case 0:this._currentTab="driving-criteria",!0===this._options.editable&&this._solverModelEvent.publish({event:"mr-stop-recursive-call"}),this._contentDrivingContainer.classList.remove("displaynone"),this._contentrunContainer.classList.add("displaynone"),this._contentConstrainedContainer.classList.add("displaynone"),this._drivingCriteriaPresenter.refreshUI(),this._IsActiveCriteriaPanel?this._drivingCriteriaPresenter.highLightCriteriaVariantIcon():this._drivingCriteriaPresenter.resetCriteriaVariantIcon();break;case 1:this._currentTab="constrained-criteria",!0===this._options.editable&&this._solverModelEvent.publish({event:"mr-stop-recursive-call"}),this._contentConstrainedContainer.classList.remove("displaynone"),this._contentDrivingContainer.classList.add("displaynone"),this._contentrunContainer.classList.add("displaynone"),this._constrainedCriteriaPresenter.refreshUI(),this._IsActiveCriteriaPanel?this._constrainedCriteriaPresenter.highLightCriteriaVariantIcon():this._constrainedCriteriaPresenter.resetCriteriaVariantIcon(),this._workaroundCheckAndWakeUpResizeSensor(this._constrainedCriteriaPresenter.getContainer());break;case 2:if(this._contentrunContainer.classList.contains("displaynone")){this._applicationChannel.publish({event:"information-panel-close"}),this._IsActiveCriteriaPanel=!1,this._contentConstrainedContainer.classList.add("displaynone"),this._contentDrivingContainer.classList.add("displaynone"),this._contentrunContainer.classList.remove("displaynone"),this._privateChannel.publish({event:"mr-refresh-run-view",data:this._options.filter});var t=this._matrixRuleModel.getJsonModel();0===t.drivingCriteria.length||0===t.constrainedCriteria.length||0===t.states.length?this._contentrunContainer.classList.add("no-content"):this._contentrunContainer.classList.remove("no-content")}}},b.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._privateChannel,{event:"widget-preference-update-filter"},function(t){e._options.filter=t,e._updateChannel.publish({event:"widget-preference-update-filter",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"notification-conflict-matrix"},function(){e._updateChannel.publish({event:"notification-conflict-matrix"})}),this._myEventManager.subscribe(this._privateChannel,{event:"show-loading-conflict-right-panel"},function(){e._updateChannel.publish({event:"show-loading-right-panel"})}),this._myEventManager.subscribe(this._updateChannel,{event:"criteria-panel-active"},function(t){e._IsActiveCriteriaPanel=t}),this._myEventManager.subscribe(this._applicationChannel,{event:"model-conflict-panel-closed"},function(){e._privateChannel.publish({event:"model-conflict-panel-hidden",data:"right"})}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-cancel-button-clicked"},function(){console.log("Save canceled")}),this._myEventManager.subscribe(this._updateChannel,{event:"activate-filter-icon"},function(){e._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"filter-column",icon:"list-filter"}})}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-dontsave-button-clicked"},function(t){e._privateChannel.publish({event:"matrui-setprevious-filter"}),t&&(t.linkID?(e._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),e._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),e._applicationChannel.publish({event:"breadcrumb-link-clicked",data:t})):t.isBackClicked?(e._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),e._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),window.history.back()):(e._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),e._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),e._privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:t})))}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-save-button-clicked"},function(t){console.log("Save .."),e._ruleSaveAllowed?e._updateChannel.publish({event:"mr-onsave",data:{jsonModel:e._matrixRuleModel.getJsonModel(),model:t}}):e._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:e._ruleSaveErrorMessage}})}),this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-panel-visible"},function(t){e._privateChannel.publish({event:"conflict-panel-opened",data:!0})}),this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-panel-hidden"},function(){e._privateChannel.publish({event:"conflict-panel-opened",data:!1})}),this._myEventManager.subscribe(this._solverModelEvent,{event:"checkMatrixRuleValidity_SolverReason"},function(t){if(t.answerData._clientData.isConflict){var i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID;if(t.answerData._clientData.columnID&&t.answerData._clientData.rowID&&(i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID),i>=0&&n>=0){var a={};switch(a.privateChannelForRules=e._privateChannelForRules,a.statesCausingValues=t.answerData.statesCausingValues[0][n],a.statesValidity=t.answerData.statesValidity[0][n],a.states=t.answerData.states[0][n],a.statesCausingRules=[],a.type="ConflictRules",a.statesValidity){case"I":case"R":case"T":case"C":a.statesCausingRules=t.answerData.statesCausingRules[0][n];break;default:a.statesCausingRules=[]}if(a.drivingCombinationValues=t.answerData.drivingCombinationValues,a.conflictingRules=[],t.answerData.constrainedValues&&t.answerData.constrainedValues[n].parent){for(var o=t.answerData.constrainedValues[n].parent,r=[],s=0;s<t.answerData.constrainedValues.length;s++)if(t.answerData.constrainedValues[s].parent===o){var l=t.answerData.constrainedValues[s];l&&(l.index=s,r.push(l))}var d=e._mapDico[o];if(d){var c=t.answerData.statesValidity[0],u=t.answerData.states[0],h=0;for(s=0;s<r.length&&("C"===c[r[s].index]&&"N"===u[r[s].index]);s++)h++;r.length===h&&(a.constrainedCriteria=d,a.type="conflictMandatory")}}var p="";for(s=0;s<t.answerData.drivingCriteria.length;s++){var m=t.answerData.drivingCriteria[s].id;p+=" "+e._mapDico[a.drivingCombinationValues[0][m].variantValue].title}a.drivingCombinationValuesText=p;var v="";a.constrained="",t.answerData.constrainedValues[n]&&(v=t.answerData.constrainedValues[n].id,e._matrixRuleModel._mapDico[v].title&&(a.constrained=e._matrixRuleModel._mapDico[v].title));var _={};_.conflictingRules=t.answerData.statesCausingRules[0][n],_.reasons=a,e._updateChannel.publish({event:"get-rule-details",data:_})}}}),this._myEventManager.subscribe(this._solverModelEvent,{event:"checkInvalidColumnCausingRules"},function(t){if(t.answerData){var i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID;if(t.answerData._clientData.columnID&&t.answerData._clientData.rowID&&(i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID),i>=0&&n<-1){var a={};a.privateChannelForRules=e._privateChannelForRules,a.type="InvColumn",a.drivingCombinationsCausingRules=t.answerData.drivingCombinationsCausingRules,a.drivingCombinationValues=t.answerData.drivingCombinationValues,a.conflictingRules=[];for(var o="",r=0;r<t.answerData.drivingCriteria.length;r++){var s=t.answerData.drivingCriteria[r].id;o+=" "+e._mapDico[a.drivingCombinationValues[0][s].variantValue].title}a.drivingCombinationValuesText=o;var l={};l.conflictingRules=t.answerData.drivingCombinationsCausingRules[0],l.reasons=a,e._updateChannel.publish({event:"get-rule-details",data:l})}}}),this._tabBar.modelEvent.subscribe({event:"selectTab"},function(t){e._switchView(t.index)}),this._myEventManager.subscribe(this._privateChannel,{event:"display-more-details-solver"},function(){console.log("receiving display-more-details-solver")}),this._myEventManager.subscribe(this._privateChannel,{event:"mr-model-change"},function(){e._showOkCancel(),e._privateChannel.publish({event:"mr-rule-save-allow",data:{allow:!0}}),e._updateChannel.publish({event:"mr-model-change"}),e._privateChannelForRules&&e._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!1}),e._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!1})}),this._myEventManager.subscribe(this._privateChannel,{event:"set-notification-message"},function(t){e._alert.add(t),e._alert.show()}),this._myEventManager.subscribe(this._privateChannel,{event:"mr-rule-save-allow"},function(t){t&&(e._ruleSaveAllowed=!0===t.allow,e._ruleSaveAllowed?e._ruleSaveErrorMessage="":e._ruleSaveErrorMessage=t.message)}),this._myEventManager.subscribe(this._privateChannel,{event:"switch-view-allow"},function(t){e._isReadyToSwitch=!0===t,e._wizardContainer&&(e._isReadyToSwitch?e._wizardContainer.classList.remove("switch-disabled"):e._wizardContainer.classList.add("switch-disabled"))}),this._updateChannel.subscribe({event:"mr-reload-table"},function(){e._runTimePresenter.refreshUI()}),this._myEventManager.subscribe(this._privateChannel,{event:"get-mr-details"},function(t){e._updateChannel.publish({event:"get-rule-details-for-tooltip",data:t})})},b.prototype.updateMRTooltip=function(e){this._runTimePresenter.setNewTooltip(e)},b.prototype.attachResizeSensor=function(){this._runTimePresenter.attachResizeSensor()},b.prototype.inject=function(e){e.appendChild(this._container)},b.prototype.destroy=function(){this._runTimePresenter&&(this._runTimePresenter._clearPreviousEvents(),this._runTimePresenter.destroy()),this._drivingCriteriaPresenter&&this._drivingCriteriaPresenter.destroy(),this._constrainedCriteriaPresenter&&this._constrainedCriteriaPresenter.destroy(),this._myEventManager.cleanup("GlobalPresenter")},b.prototype._createOKCancelActions=function(){var t=this;this._myEventManager.subscribe(this._updateChannel,{event:"mr-onsavedone"},function(){t._hideOKCancel(),t._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0})}),this._myEventManager.subscribe(this._updateChannel,{event:"update-json-model-on-mr-save"},function(i){t._jsonModel=t._matrixRuleModel.getJsonModel(),t._inputJsonModel=e.clone(t._jsonModel),i.model&&(i.model.linkID?(t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),t._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),t._applicationChannel.publish({event:"breadcrumb-link-clicked",data:i.model})):i.model.isBackClicked?window.history.back():t._privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:i.model})),console.log("updating json model on mr save done")});var i=new p({value:f._save,className:"primary"});i.addEvent("onClick",function(){t._ruleSaveAllowed?t._updateChannel.publish({event:"mr-onsave",data:{jsonModel:t._matrixRuleModel.getJsonModel()}}):t._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:t._ruleSaveErrorMessage}})});var n=new p({value:f._undo,className:"default"});n.addEvent("onClick",function(){t.refreshUI(t._inputJsonModel),t.restartAsyncCall(),t._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),t._hideOKCancel()});var a=new m({buttons:[i,n]});return t._OkCancel=a,"3.0"!==t._jsonModel.version&&t._showOkCancel(),a},b.prototype._showOkCancel=function(){this._okCancelContainer.classList.remove("displaynone"),this._contentDrivingContainer.classList.add("with-footer"),this._contentrunContainer.classList.add("with-footer"),this._contentConstrainedContainer.classList.add("with-footer"),this._contentrunContainer.classList.contains("displaynone")||this._privateChannel.publish({event:"mr-resize"})},b.prototype._hideOKCancel=function(){this._okCancelContainer.classList.add("displaynone"),this._contentDrivingContainer.classList.remove("with-footer"),this._contentConstrainedContainer.classList.remove("with-footer"),this._contentrunContainer.classList.remove("with-footer")},b.prototype.restartAsyncCall=function(){this._contentrunContainer.classList.contains("displaynone")||this._runTimePresenter.restartAsyncCallSolver()},b.prototype.refreshUI=function(t){n.mask(this._container),this._jsonModel=t?e.clone(t):null,this._jsonModel||(this._jsonModel={drivingCriteria:[],constrainedCriteria:[],constrainedValues:[],drivingCombinationValues:[],states:[],statesValidity:[],version:"3.0"}),(this._jsonModel.states||0===this._jsonModel.states.length)&&(this._currentView="build",this._jsonModel.drivingCriteria&&this._jsonModel.constrainedCriteria&&(0!==this._jsonModel.drivingCriteria.length&&0!==this._jsonModel.constrainedCriteria.length&&0!==this._jsonModel.states.length||this._contentrunContainer.classList.add("no-content"))),this._matrixRuleModel.setJsonModel(this._jsonModel),this._drivingCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.drivingCriteria,"driving-criteria"),this._drivingCriteriaPresenter.loadData(this._drivingCriteriaList),this._constrainedCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.constrainedCriteria,"constrained-criteria"),this._constrainedCriteriaPresenter.loadData(this._constrainedCriteriaList),this.refreshUICriteriaPanel(this._currentTab),this._runTimePresenter.refreshUI(),n.unmask(this._container)},b.prototype.refreshUICriteriaPanel=function(e){var t=this;this._applicationChannel.publish({event:"triptych-fetch-panel-visibility-status",data:function(i){i&&!0===i.right&&t._updateChannel.publish({event:"refresh-criteria-panel",data:e})}})},b.prototype.addListCriteriaTo=function(e,t){switch(t){case"driving-criteria":this._drivingCriteriaPresenter.addCriteriaCombination(e);break;case"constrained-criteria":this._constrainedCriteriaPresenter.addCriteriaCombination(e)}},b.prototype.getListDrivingCriteriaAndRefresh=function(){return this._drivingCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.__jsonModel.drivingCriteria,"driving-criteria"),this._drivingCriteriaList},b.prototype.getListConstrainedCriteriaAndRefresh=function(){return this._constrainedCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.__jsonModel.constrainedCriteria,"constrained-criteria"),this._constrainedCriteriaList},b});