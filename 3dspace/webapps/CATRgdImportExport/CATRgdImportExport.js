define("DS/CATRgdImportExport/Export",["require","exports","DS/RGNServices/RGNServices","DS/CATRgnWidgetCommons/restClient/CommonServices","DS/RGNServices/WAFDataUtil","i18n!DS/CATRgdImportExport/assets/nls/CATRgdImportExport"],function(e,t,n,o,i,r){"use strict";async function l(e,t){const n="string"==typeof e?[e]:e,i=await o.service3DSpace(t),l=(new o.HeadersBuilder).createHeader(t.getSecurityContext());if(!(n instanceof Array))throw new Error(r.get("not_string_id_array"));if(n&&n.length>0)return 1===n.length?await s(i,l,n[0]):await a(i,l,n.map(e=>({id:e})))}async function s(e,t,n){return i.authenticatedRequest("GET",`${e.url}/resources/v1/modeler/dsrgn/template/${n}/export`,"json",t)}async function a(e,t,n){return i.authenticatedRequest("POST",`${e.url}/resources/v1/modeler/dsrgn/template/export`,"json",t,{type:"json",payload:n})}Object.defineProperty(t,"__esModule",{value:!0}),t.exportTemplates=t.exportTemplate=t.download=t.toJson=void 0,t.toJson=l,t.download=async function(e,t){let o=await l(e,t),i=o.templates,r=(new TextEncoder).encode(JSON.stringify(o)),s=new Blob([r],{type:"application/json;charset=utf-8"}),a=i.length>1?"templates.json":`${i[0].name}_${i[0].revision}.json`;n.download(a,s,!0)},t.exportTemplate=s,t.exportTemplates=a}),define("DS/CATRgdImportExport/Import",["require","exports","DS/RGNServices/WAFDataUtil","DS/CATRgnWidgetCommons/restClient/CommonServices"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.process=t.DataToKeep=t.ImportFailureCode=t.ImportConflict=void 0,function(e){e.NewAutoName="newAutoName",e.Revise="revise",e.Overwrite="overwrite",e.Skip="skip"}(t.ImportConflict||(t.ImportConflict={})),function(e){e[e.ServerError=1]="ServerError",e[e.TNRConflict=10]="TNRConflict",e[e.TypeNotSet=11]="TypeNotSet",e[e.PolicyNotSet=12]="PolicyNotSet",e[e.OwnerNotSet=13]="OwnerNotSet",e[e.MaturityNotSet=14]="MaturityNotSet"}(t.ImportFailureCode||(t.ImportFailureCode={})),function(e){e.Type="Type",e.Owner="Owner",e.Maturity="Maturity",e.Policy="Policy"}(t.DataToKeep||(t.DataToKeep={})),t.process=async function(e,t,i){let r=await(0,o.service3DSpace)(i),l=await(0,o.getCSRFToken)(r.url),s=(new o.HeadersBuilder).createHeaderWithCsrfToken(i.getSecurityContext(),l),a=void 0;t.keep&&t.keep.length>0&&(a=t.keep.join());try{return await async function(e,t,o,i="false",r="false"){return n.authenticatedRequest("POST",`${e.url}/resources/v1/modeler/dsrgn/template/import?onConflict=${i}&keep=${r}`,"json",t,{type:"json",payload:o})}(r,s,e,t.onConflict,a)}catch(e){if(e.response&&e.response.importStatus)return e.response;throw e}}}),define("DS/CATRgdImportExport/ImportUIPrinters",["require","exports","UWA/Core","DS/UIKIT/Input/Select","i18n!DS/CATRgdImportExport/assets/nls/CATRgdImportExport","DS/CATRgdImportExport/Import"],function(e,t,n,o,i,r){"use strict";function l(e){return e.replace(/.*Error: #\d+:\s*/g,"")}function s(e,t){new n.Element("td",{class:"heading2",colspan:"3",text:t}).inject(new n.Element("tr").inject(e))}function a(e,t,i){const r=new n.Element("td",{class:"label",colspan:"3",text:`${t.type} - ${t.name} - ${t.revision}`}).inject(new n.Element("tr",{title:i.tooltip}).inject(e));i.tooltip&&new n.Element("span",{class:"fonticon fonticon-info"}).inject(r),new o({id:t.id,placeholder:i.placeholder||!1,className:i.className,tnr:{type:t.type,name:t.name,revision:t.revision},options:i.selectOptions}).inject(new n.Element("td",{class:"createInputField"}).inject(new n.Element("tr",{title:i.title}).inject(e)))}function c(e,t,o){t.length>0&&(s(e,i.get("server_error")),t.forEach(t=>{const i=o.filter(e=>e.id===t.id)[0],r=l(t.message);i&&new n.Element("td",{class:"label",colspan:"3",text:`${i.type} - ${i.name} - ${i.revision}`}).inject(new n.Element("tr",{title:r}).inject(e)),new n.Element("td",{class:"createInputField",text:r}).inject(new n.Element("tr",{title:r}).inject(e))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.printGlobalOptions=t.printDropZone=t.printErrorZone=t.printResultPage=t.printArtifactNotSet=t.printServerError=t.printSelect=t.printTitle=void 0,t.printTitle=s,t.printSelect=a,t.printServerError=c;const p={Type:{title:i.get("type_not_set"),selectClassName:"keep-type",selectOptionsLabel:i.get("use_default_type")},Owner:{title:i.get("owner_not_set"),selectClassName:"keep-owner",selectOptionsLabel:i.get("use_current_user")},Maturity:{title:i.get("maturity_not_set"),selectClassName:"keep-maturity",selectOptionsLabel:i.get("use_default_maturity")},Policy:{title:i.get("policy_not_set"),selectClassName:"keep-policy",selectOptionsLabel:i.get("use_default_policy")}};function d(e,t,n,o){n.length>0&&(s(t,i.get(e.title)),n.forEach(n=>{const r=o.filter(e=>e.id===n.id)[0];r&&a(t,r,{className:e.selectClassName,tooltip:l(n.message),selectOptions:[{value:"skip",label:i.get("do_not_import"),selected:!0},{value:"default",label:e.selectOptionsLabel}]})}))}t.printArtifactNotSet=d,t.printResultPage=function(e,t,o,m,u){const g=new n.Element("table",{class:"form table page page"+m}).inject(e);1!==m&&g.classList.add("hidden");const f=new n.Element("tbody").inject(g);c(f,t.filter(e=>e.code==r.ImportFailureCode.ServerError),o),function(e,t,n){t.length>0&&(s(e,i.get("tnr_not_unique")),t.forEach(t=>{const o=n.filter(e=>e.id===t.id)[0];o&&a(e,o,{className:"on-conflict",tooltip:l(t.message),selectOptions:[{value:"skip",label:i.get("do_not_import"),selected:!0},{value:"newAutoName",label:i.get("create_new_autoname")},{value:"revise",label:i.get("new_revision")},{value:"overwrite",label:i.get("overwrite_attributes")}]})}))}(f,t.filter(e=>e.code==r.ImportFailureCode.TNRConflict),o),d(p.Type,f,t.filter(e=>e.code==r.ImportFailureCode.TypeNotSet),o),d(p.Policy,f,t.filter(e=>e.code==r.ImportFailureCode.PolicyNotSet),o),d(p.Owner,f,t.filter(e=>e.code==r.ImportFailureCode.OwnerNotSet),o),d(p.Maturity,f,t.filter(e=>e.code==r.ImportFailureCode.MaturityNotSet),o);const h=new n.Element("tr").inject(f);m>1?new n.Element("button",{class:"btn-primary btn-previous",text:i.get("previous"),events:{click:function(){var t;e.querySelectorAll("table.page").forEach(e=>{e.classList.add("hidden")}),null===(t=e.querySelector("table.page"+(m-1)))||void 0===t||t.classList.remove("hidden")}}}).inject(new n.Element("td").inject(h)):new n.Element("td").inject(h),m<u?new n.Element("button",{class:"btn-primary btn-next",text:i.get("next"),events:{click:function(){var t;e.querySelectorAll("table.page").forEach(e=>{e.classList.add("hidden")}),null===(t=e.querySelector("table.page"+(m+1)))||void 0===t||t.classList.remove("hidden")}}}).inject(new n.Element("td").inject(h)):new n.Element("td").inject(h)},t.printErrorZone=function(e){const t=new n.Element("table",{class:"form table"}).inject(e),o=new n.Element("thead").inject(t),r=new n.Element("tr").inject(o);new n.Element("td",{class:"heading1",colspan:"2",text:i.get("errors")}).inject(r);const l=new n.Element("tbody").inject(t),s=new n.Element("tr").inject(l),a=new n.Element("td").inject(s);new n.Element("span",{class:"font-3ds-regular labelRequired",id:"errorMessage"}).inject(a)},t.printDropZone=function(e){const t=new n.Element("table",{class:"form table"}).inject(e),o=new n.Element("thead").inject(t),r=new n.Element("tr").inject(o);new n.Element("td",{class:"heading1",colspan:"2",text:i.get("file")}).inject(r);const l=new n.Element("tbody").inject(t),s=new n.Element("tr").inject(l),a=new n.Element("td",{colspan:"2"}).inject(s);new n.Element("span",{class:"fonticon fonticon-2x fonticon-drag-drop",draggable:!1}).inject(a),new n.Element("span",{class:"dnd-label font-3ds-regular labelRequired",text:i.get("drop_file_here")}).inject(a)},t.printGlobalOptions=function(e){const t=new n.Element("table",{class:"form table"}).inject(e),r=new n.Element("thead").inject(t),l=new n.Element("tr").inject(r);new n.Element("td",{class:"heading1",colspan:"2",text:i.get("options")}).inject(l);const s=new n.Element("tbody").inject(t),a=new n.Element("tr").inject(s);new n.Element("td",{class:"createLabel",text:i.get("on_conflict")}).inject(a),new o({id:"globalActionOnConflict",placeholder:!1,showTooltips:!0,options:[{value:"notify",label:i.get("notify"),selected:!0},{value:"newAutoName",label:i.get("create_new_autoname")},{value:"revise",label:i.get("revise")}]}).inject(new n.Element("td",{class:"createInputField"}).inject(a));const c=new n.Element("tr").inject(s);new n.Element("td",{class:"createLabel",text:i.get("keep")}).inject(c),new o({id:"globalDataToKeep",placeholder:i.get("data_to_keep"),multiple:!0,showTooltips:!0,options:[{value:"type",label:i.get("type"),selected:!0},{value:"policy",label:i.get("policy")},{value:"owner",label:i.get("owner")},{value:"maturity",label:i.get("maturity")}]}).inject(new n.Element("td",{class:"createInputField"}).inject(c));const p=new n.Element("tr").inject(s);new n.Element("td",{class:"createLabel hidden",id:"numOfTplLabel",text:i.get("nb_templates")}).inject(p),new n.Element("td",{class:"createInputField hidden",id:"numOfTpl"}).inject(p)}}),define("DS/CATRgdImportExport/ImportUI",["require","exports","UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/CATRgdImportExport/ImportUIPrinters","i18n!DS/CATRgdImportExport/assets/nls/CATRgdImportExport"],function(e,t,n,o,i,r){"use strict";return class{constructor(){this._importData={},this._importStatus={},this._importSettings={},this._errorZone=new n.Element("div",{class:"errorZone hidden"}),this._globalOptionsZone=new n.Element("div",{class:"globalOptions hidden"}),this._resultZone=new n.Element("div",{class:"importResult hidden"}),this._dropZone=new n.Element("div",{class:"dropZone"})}buildUI(e){this._errorZone.inject(e),this._dropZone.inject(e),o.droppable(this._dropZone,{drop:this._drop.bind(this),enter:function(e){e.classList.add("ondragover")},over:function(e){e.classList.add("ondragover")},leave:function(e){e.classList.remove("ondragover")}}),this._globalOptionsZone.inject(e),this._resultZone.inject(e),i.printErrorZone(this._errorZone),i.printDropZone(this._dropZone),i.printGlobalOptions(this._globalOptionsZone)}fillSpecificOptions(){const e=this._importData.importSettings||{};if(this._resultZone){const t=[],n=Array.from(this._resultZone.querySelectorAll("select"));this._importSettings&&this._importSettings.actions&&(e.actions||(e.actions=[]),e.actions=this._importSettings.actions.map(e=>e)),n.forEach(n=>{var o;const i=null==n?void 0:n.tnr,r=n.id,l=n.value,s=null===(o=null==n?void 0:n.parentElement)||void 0===o?void 0:o.classList;let a=e.actions;if(a||(a=[],e.actions=a),l&&"skip"!==l){const e=a.filter(e=>e.id===r);let t;e&&e[0]?t=e[0]:(t={},a.push(t)),t&&(t.id=r,t.reference=i?{type:i.type,name:i.name,revision:i.revision}:{id:r},s&&s.contains("on-conflict")?t.onConflict=l:t.keep?t.keep.splice(t.keep.indexOf(l),1):t.keep=[])}else t.push(r)})}this._importData.importSettings=e}getImportData(){return this._importData&&this.fillSpecificOptions(),this._importData}getGlobalOptions(){var e,t;const n={};if(this._globalOptionsZone){const o=null===(e=null==this?void 0:this._globalOptionsZone)||void 0===e?void 0:e.querySelector("select#globalActionOnConflict"),i=null===(t=null==this?void 0:this._globalOptionsZone)||void 0===t?void 0:t.querySelector("select#globalDataToKeep");n.onConflict=null==o?void 0:o.value,n.keep=Array.from(null==i?void 0:i.selectedOptions).filter(e=>e&&e.value.length>0).map(e=>e.value)}return n}processResults(e,t){this._importSettings=t;const n=this;return new Promise((t,o)=>{if(n._importData=e,n._importStatus=e.importStatus,n._importStatus.failed&&n._importStatus.failed.length>0){this._globalOptionsZone.classList.add("hidden"),this._resultZone.classList.remove("hidden"),this._resultZone.innerHTML="";const t=5,l=Math.trunc(n._importStatus.failed.length/t)+1,s=n._importStatus.failed.sort((e,t)=>e.code-t.code);for(let n=0;n<l;n++){const o=t*n;i.printResultPage(this._resultZone,s.slice(o,o+t),e.templates,n+1,l)}o(new Error(r.get("import_incomplete")))}else t()})}setFile(e){this._drop(void 0,document.documentElement,e)}async getFileContent(e){const t=new FileReader;return new Promise(n=>{t.onload=function(e){var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result,i=JSON.parse("string"==typeof o?o:"");n(i)},t.readAsText(e)})}async getTemplatesFromFile(e){return(await this.getFileContent(e)).templates}async mergeTemplates(e){let t=[];for(const n of Array.from(e))t=t.concat(await this.getTemplatesFromFile(n));return t}async display(e){const t=document.documentElement,n=t.querySelector(".dnd-label"),o=this._errorZone.querySelector("#errorMessage");this._errorZone.classList.add("hidden"),this._globalOptionsZone.classList.add("hidden"),this._resultZone.classList.add("hidden"),this._resultZone.innerHTML="";const i=this;o&&(o.innerHTML=""),i._importData={};const l=await this.getFileContent(e[0]),s=await this.mergeTemplates(e);l.templates=s,n&&(n.innerHTML="Loading...");try{if(n&&(n.innerHTML=e[0].name),!l.version)return i._errorZone.classList.remove("hidden"),void(o&&(o.innerHTML=r.get("no_version_attribute")));if(!l.templates)return i._errorZone.classList.remove("hidden"),void(o&&(o.innerHTML=r.get("no_templates_attribute")));i._globalOptionsZone.classList.remove("hidden");const a=t.ownerDocument.getElementById("numOfTplLabel"),c=t.ownerDocument.getElementById("numOfTpl");a&&(a.innerHTML=r.get("number_of_templates"),a.classList.remove("hidden")),c&&(c.innerHTML=s.length+"",c.classList.remove("hidden")),i._importData=l}catch(e){i._errorZone.classList.remove("hidden"),o&&(o.innerHTML=r.get("json_parse_error")+": "+e)}}_drop(e,t,n){n.preventDefault();const o=(e||n.dataTransfer).files;this.display(o)}}});