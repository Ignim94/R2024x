<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:widget="http://www.netvibes.com/ns/">
<head>
<widget:preferences>
	<widget:preference type="range" name="count" label="Number of Item"
		step="500" min="0" max="10000" defaultValue="0" />
	</widget:preference>

	<widget:preference type="list" name="category" label="categories">
		<widget:option value="Project Space" label="Project Space" selected></widget:option>
		<widget:option value="Document" label="Document"></widget:option>
	</widget:preference>
	
	<widget:preference type="list" name="project state" label="state">
		<widget:option value="Active" label="진행중" selected></widget:option>
		<widget:option value="Complete" label="완료"></widget:option>
		<widget:option value="Drop" label="Drop"></widget:option>
		<widget:option value="Hold" label="Hold"></widget:option>
	</widget:preference>
	
</widget:preferences>

<script>
	require([ "DS/PlatformAPI/PlatformAPI",
			  "DS/i3DXCompassServices/i3DXCompassServices",
			  "DS/WAFData/WAFData" ], function(API, i3DXCompassServices, WAFData) {
		let x3dPlatformId = widget.getValue("x3dPlatformId");

		let username = "";
		let getType = "Project Space";
		let getRange = "0";
		let setState = "ALL";
		let myWidget = {
			onloadWidget : function() {
				console.log(username);
				console.log(getType);
				console.log(getRange);
				widget.body.innerHTML = "36 로딩중";
				
				i3DXCompassServices.getServiceUrl({
					serviceName : "3DSpace",
					platformId : x3dPlatformId,
					onFailure : function(result) {
						alert(result);
					},
					onComplete : function(serviceUrl) {
						let restUrl = "";
						//restUrl = serviceUrl
						//		+ "/resources/CommonModel/findObject";
						//alert(restUrl);
						restUrl = "https://local.3ds.org/3dspace"
								+ "/resources/CommonModel/findObject";
						//alert(restUrl);
						WAFData.authenticatedRequest(restUrl, {
							method : 'GET',
							data : {'findType':getType,
									'setState':setState
							}, //data는 optional임. restURl 호출을 했을 때, /Path가 findObjectd인 해당 파일에서 request.getParameter같은걸로 받아서 쓸 수 있음.
							type : 'json',
							onFailure : function(result) {
								alert(result);
								widget.body.innerHTML = "rest Service Error: "
										+ result;
							},
							onComplete : function(dataRep) {

								console.log(dataRep);
								//let vType = dataRep.type;
								let vName = dataRep.name.split(",");
								let vOID = dataRep.id.split(",");
								let vOriginator = dataRep.originator.split(",");
								let vModified = dataRep.modifiedDate.split(",");
								let vCreated = dataRep.createdDate.split(",");
								
								let html = "REST Service Data" + "</br>";
								html += "이름 :" +vName + ", id: " + vOID;
								
								let table = "<table border='1'>";
								
								  if (getType === "Document") {
									  let vTitle = dataRep.title.split(",");
									  let vLocked = dataRep.locked.split(",");
									  
									  table += "<tr>" +
									  "<td style='border: 1px solid #000; padding: 8px;'>" + "문서코드" + "</td>" +
									  "<td style='border: 1px solid #000; padding: 8px;'>" + "문서명" + "</td>" +
									  "<td style='border: 1px solid #000; padding: 8px;'>" + "OID" + "</td>" +
									  "<td style='border: 1px solid #000; padding: 8px;'>" + "생성일" + "</td>" +
									  "<td style='border: 1px solid #000; padding: 8px;'>" + "수정일" + "</td>" +
									  "<td style='border: 1px solid #000; padding: 8px;'>" + "작성자" + "</td>" +
									  "<td style='border: 1px solid #000; padding: 8px;'>" + "잠금여부" + "</td>"
									  "</tr>";
									  
									// 반복문을 사용하여 테이블 데이터 추가
										for (let i = 0; i < Math.min(vName.length, getRange); i++) {
											table += "<tr>" +
											  "<td style='border: 1px solid #000; padding: 8px;'>" + vTitle[i] + "</td>" +
											  "<td style='border: 1px solid #000; padding: 8px;'>" + vName[i] + "</td>" +
											  "<td style='border: 1px solid #000; padding: 8px;'>" + vOID[i] + "</td>" +
											  "<td style='border: 1px solid #000; padding: 8px;'>" + vCreated[i] + "</td>" +
											  "<td style='border: 1px solid #000; padding: 8px;'>" + vModified[i] + "</td>" +
											  "<td style='border: 1px solid #000; padding: 8px;'>" + vOriginator[i] + "</td>" +
											  "<td style='border: 1px solid #000; padding: 8px;'>" + vLocked[i] + "</td>" +
											  "</tr>";
										}
									}else{
								
										table += "<tr>" +
										  "<td style='border: 1px solid #000; padding: 8px;'>" + "프로젝트명" + "</td>" +
										  "<td style='border: 1px solid #000; padding: 8px;'>" + "OID" + "</td>" +
										  "<td style='border: 1px solid #000; padding: 8px;'>" + "생성일" + "</td>" +
										  "<td style='border: 1px solid #000; padding: 8px;'>" + "수정일" + "</td>" +
										  "<td style='border: 1px solid #000; padding: 8px;'>" + "작성자" + "</td>" +
										  "</tr>";
										  
										// 반복문을 사용하여 테이블 데이터 추가 Math.min(vName.length, range)  vName.length;
											for (let i = 0; i < Math.min(vName.length, getRange); i++) {
												table += "<tr>" +
												  "<td style='border: 1px solid #000; padding: 8px;'>" + vName[i] + "</td>" +
												  "<td style='border: 1px solid #000; padding: 8px;'>" + vOID[i] + "</td>" +
												  "<td style='border: 1px solid #000; padding: 8px;'>" + vCreated[i] + "</td>" +
												  "<td style='border: 1px solid #000; padding: 8px;'>" + vModified[i] + "</td>" +
												  "<td style='border: 1px solid #000; padding: 8px;'>" + vOriginator[i] + "</td>" +
												  "</tr>";
											}	  
									}  
								  
								

								table += "</table>";
								widget.body.innerHTML = table;
								// 컬럼 순서 지정
								const columnOrder = ['name', 'id', 'createdDate', 'modifiedDate', 'originator'];

								
							}
						});
					}
				});
			},
			endEditWidget : function() {
				getType = widget.getValue('category')
				getRange = widget.getValue('count')
				setState = widget.getValue('count')
				console.log(getType);
				console.log(getRange);
				alert("환경설정편집종료");
			}
		};

		widget.addEvent("onLoad", myWidget.onloadWidget);
		widget.addEvent("endEdit", myWidget.endEditWidget);

	});
	//widget.getValue("");
	//widget.setValue("","");
</script>


</head>
<body>
</body>

</html>


