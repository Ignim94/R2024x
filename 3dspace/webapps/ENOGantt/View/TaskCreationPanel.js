define("DS/ENOGantt/View/TaskCreationPanel",["UWA/Class","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants"],function(e,a,t,r,n){return e.extend({init:function(e){var t=UWA.clone(e||{},!1);this.parentView=t.parentView,this.parentView&&this.parentView.listenTo(this.parentView,"closeCreationPanel",this.closeTaskCreationPanel);var i=a.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Optional",name:App.Nls["emxProgramCentral.Range.Task_Requirement.Optional"]},{abbr:"Mandatory",name:App.Nls["emxProgramCentral.Range.Task_Requirement.Mandatory"]}]}),l=a.create("Ext.data.Store",{fields:["abbr","name"],data:[{abbr:"Yes",name:App.Nls["emxProgramCentral.Range.NeedsReview.Yes"]},{abbr:"No",name:App.Nls["emxProgramCentral.Range.NeedsReview.No"]}]});a.define("DS.ENOGantt.View.TaskCreationPanel",{extend:"Ext.form.Panel",renderTo:document.body,title:App.Nls["emxProgramCentral.Common.AddTask"],region:"east",xtype:"ganttTaskCreationPanel",id:"ganttTaskCreationPanel",width:330,hidden:!0,bodyPadding:10,scrollable:!0,defaultType:"textfield",defaults:{anchor:"100%",labelAlign:"top",font:"15px/18px Arial,Helvetica,sans-serif"},cls:"x-panel-header-default",layout:"anchor",items:[{xtype:"fieldcontainer",id:"requiredFields",fieldLabel:App.Nls["ProgramCentral.GanttTaskCreation.FieldsRequired"],labelCls:"createRequired"},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.Type"],queryMode:"local",displayField:"name",valueField:"abbr",name:"type",id:"type",editable:!1,listeners:{change:function(e,t){var n=a.ComponentQuery.query("#ganttTaskCreationPanel")[0];null==t&&(t="Task");var i=t;"Task"==t?i=App.Nls["emxProgramCentral.Type.Task"]:"Phase"==t?i=App.Nls["emxProgramCentral.Type.Phase"]:"Gate"==t?i=App.Nls["emxProgramCentral.Type.Gate"]:"Milestone"==t&&(i=App.Nls["emxProgramCentral.Type.Milestone"]),n.setTitle(App.Nls["emxProgramCentral.Gantt.Create"]+" : "+i);var l=a.create("Ext.data.Store",{fields:["abbr","name"],data:function(){var e=new Array,a=App.Infra.PoliciesAndTypes[t].split("#")[0],r=a.substring(1,a.length-1).split(","),n=App.Infra.PoliciesAndTypes[t].split("#")[1],i=n.substring(1,n.length-1).split(", "),l=r.length;for(idx=0;idx<l;idx++){var s=r[idx].trim(),o=i[idx].trim();null==o&&(o=s),e.push({abbr:s,name:o})}return e}()});a.getCmp("policy").bindStore(l),r.getGanttItem(n,"policy").setValue(l.data.items[0]);var s=r.getGanttItem(n,"duration");"Gate"==t||"Milestone"==t?(s.setValue(0),s.setReadOnly(!0)):(s.setValue(1),s.setReadOnly(!1))}}},{xtype:"numberfield",fieldLabel:App.Nls["emxProgramCentral.Common.Number"],minValue:1,name:"number",id:"number",value:1,validator:function(e){var a=!0;return this.value<=0||this.value>100?(a=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber"],this.setError(a),a):Number.isInteger(this.value)?a:(a=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber.MustBePositiveInteger"],this.setError(a),a)},listeners:{change:function(e,t){var n=a.ComponentQuery.query("#ganttTaskCreationPanel")[0],i=r.getGanttItem(n,"namecontainer");t>1?(i.items.items[1].setValue(!0),i.items.items[1].setDisabled(!0),i.items.items[0].setDisabled(!0)):(i.items.items[1].setValue(!1),i.items.items[1].setDisabled(!1),i.items.items[0].setDisabled(!1))},focusleave:function(e,a,t){var r=this.getValue();if(isNaN(r)||!Number.isInteger(this.value)){var n=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber.MustBePositiveInteger"];alert(n),this.setValue(1)}else if(r<=0||r>100){n=App.Nls["emxProgramCentral.Gantt.TaskCreationFormNumber"];alert(n),this.setValue(1)}}}},{xtype:"fieldcontainer",fieldLabel:App.Nls["emxProgramCentral.Gantt.ResourceUtilization.Header.Name"],id:"namecontainer",name:"Name",labelCls:"createName",layout:{type:"hbox"},items:[{xtype:"textfield",name:"name",id:"name",validator:function(e){var a=!0;if(0==this.nextSibling("[name=autoname]").value&&""==this.value)return a=App.Nls["emxProgramCentral.Gantt.MustHaveName"],this.setError(a),a;if(App.Infra.PoliciesAndTypes)for(var t=App.Infra.PoliciesAndTypes.InvalidChars,r=t.split(" "),n=0;n<r.length;n++){var i=r[n];if(-1!=e.indexOf(i)){a=App.Nls["emxProgramCentral.ProjectImport.InvalidCharacterInTaskName"]+"\n"+t;break}}return a}},{xtype:"checkbox",fieldLabel:App.Nls["emxProgramCentral.Common.AutoName"],labelAlign:"right",name:"autoname",id:"autoname",value:!1,listeners:{change:function(e,t,n,i){var l=a.ComponentQuery.query("#ganttTaskCreationPanel")[0],s=r.getGanttItem(l,"namecontainer");1==t?(s.items.items[0].reset(),s.items.items[0].setDisabled(!0)):s.items.items[0].setDisabled(!1)}}}]},{xtype:"textareafield",fieldLabel:App.Nls["emxProgramCentral.Common.Description"],name:"description",id:"description"},{xtype:"radiogroup",fieldLabel:App.Nls["emxProgramCentral.Button.Insert"],id:"insertradio",columns:1,vertical:!0,items:[{boxLabel:App.Nls["emxProgramCentral.Gantt.Above"],name:"insert",id:"above",inputValue:"above",checked:!0},{boxLabel:App.Nls["emxProgramCentral.Gantt.SubLevel"],name:"insert",id:"sublevel",inputValue:"sublevel"}]},{xtype:"durationfield",fieldLabel:App.Nls["emxProgramCentral.Common.Duration"],minValue:0,maxValue:9999,name:"duration",durationUnit:"d",id:"duration",value:1,listeners:{focusleave:function(e,a,t){var r=this.rawValue.split(" "),n=r[0],i=r[1];if(isNaN(n)){var l=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];return alert(l),void this.setValue(1)}if(i!=App.Nls.durationUnits.day&&i!=App.Nls.durationUnits.days&&i!=App.Nls.durationUnits.hour&&i!=App.Nls.durationUnits.hours){var s=App.Nls["emxProgramCentral.Common.InvalidDuration"];return alert(s),void this.setValue(1)}var o=this.up("form").getValues();if(App.Infra.PoliciesAndTypes&&(App.Infra.PoliciesAndTypes.gateMilestoneTypes.indexOf(o.type)>=0&&"0"!=r[0]&&this.setValue(0),App.Infra.PoliciesAndTypes.gateMilestoneTypes.indexOf(o.type)<0))if("0"==n||"0.0"==n){s=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];alert(s),this.setValue(1)}else if(n<=0||n>=1e4){var m=App.Nls["emxProgramCentral.Gantt.Task.Duration.Limit"];alert(m),this.setValue(1)}}}},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.Policy"],queryMode:"local",displayField:"name",valueField:"abbr",name:"policy",id:"policy",editable:!1},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Common.TaskRequirement"],store:i,queryMode:"local",displayField:"name",valueField:"abbr",name:"taskRequirement",id:"taskRequirement",value:"Optional",editable:!1},{xtype:"constrainttypefield",fieldLabel:App.Nls["emxProgramCentral.WBS.ConstraintType"],name:"constrainttype",id:"constrainttype",editable:!1,value:"assoonaspossible",hidden:App.Infra.TypeOf.ProjectTemplate,validator:function(e){var a=this.nextSibling("[name=constraintdate]");return"assoonaspossible"==this.getValue()||"aslateaspossible"==this.getValue()||""!=a.getValue()&&null!=a.getValue()||App.Nls["emxProgramCentral.Gantt.selectConstraintDate"]}},{xtype:"constraintdatefield",fieldLabel:App.Nls["emxProgramCentral.WBS.ConstraintDate"],name:"constraintdate",id:"constraintdate",format:r.getDateFormat(),hidden:App.Infra.TypeOf.ProjectTemplate},{xtype:"combobox",fieldLabel:App.Nls["emxProgramCentral.Task.NeedsReview"],store:l,queryMode:"local",displayField:"name",valueField:"abbr",name:"needsReview",id:"needsReview",value:"No",editable:!1},{xtype:"radiogroup",fieldLabel:App.Nls["emxProgramCentral.Task.DeliverablesInheritance"],id:"deliverablesInheritance",columns:1,vertical:!0,items:[{boxLabel:App.Nls["emxProgramCentral.Range.NeedsReview.Yes"],name:"deliverablesInheritance",inputValue:"Yes",checked:!0},{boxLabel:App.Nls["emxProgramCentral.Range.NeedsReview.No"],name:"deliverablesInheritance",inputValue:"No"}]}],buttons:[{text:"OK",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px;border-radius: 5px;border-width:1px;border-style:solid;box-shadow: inset 0px 2px 0px rgba(255,255,255,.3), inset 0px 0px 8px rgba(255,255,255,.5);",cls:"apply-button-text",handler:function(){var e=a.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,t=this.up("form"),i=t.getValues(),l=i.type,s=n.actionType.ADD_SUB_TASK;"Phase"===l?s=n.actionType.ADD_PHASE:"Gate"===l?s=n.actionType.ADD_GATE:"Milestone"===l&&(s=n.actionType.ADD_MILESTONE);var o=App.Nls["emxProgramCentral.Common.InvalidDuration"];if(o=o.replace(/\\n/g,"\n"),t.hasInvalidField()){for(var m=[],p=t.items.items,d=0,u=p.length;d<u;d++){if(fieldId=p[d].id,"namecontainer"===fieldId)for(var g=p[d].items.items,c=0,b=g.length;c<b;c++){var f=g[c].getErrors();break}else{if("requiredFields"==p[d].id)continue;f=p[d].getErrors();if("duration"===fieldId&&f.length>0)for(var x=0,C=f.length;x<C;x++)if(f[x].error!=o){f.splice(x,1);break}}f.length>0&&m.push(p[d].fieldLabel)}var y=App.Nls["emxProgramCentral.GanttTaskCreation.InvalidFormErrorMsg"];return alert(y+" : \n"+m),!1}if(r.isValidRMBOperation(e[0],s)&&!t.hasInvalidField()){cpnl.syncOnAddRemoveTask(this,s,i);var v=a.ComponentQuery.query("#ganttTaskCreationPanel")[0];v.hide(),v.reset(),a.getCmp("tBarganttConfiguration").enable()}}},{id:"Apply",text:App.Nls["emxProgramCentral.Gantt.Apply"],handler:function(){var e=a.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,t=this.up("form"),i=t.getValues(),l=i.type,s=n.actionType.ADD_SUB_TASK;"Phase"===l?s=n.actionType.ADD_PHASE:"Gate"===l?s=n.actionType.ADD_GATE:"Milestone"===l&&(s=n.actionType.ADD_MILESTONE);var o=App.Nls["emxProgramCentral.Common.InvalidDuration"];if(o=o.replace(/\\n/g,"\n"),t.hasInvalidField()){for(var m=[],p=t.items.items,d=0,u=p.length;d<u;d++){if(fieldId=p[d].id,"namecontainer"===fieldId)for(var g=p[d].items.items,c=0,b=g.length;c<b;c++){var f=g[c].getErrors();break}else{if("requiredFields"==p[d].id)continue;f=p[d].getErrors();if("duration"===fieldId&&f.length>0)for(var x=0,C=f.length;x<C;x++)if(f[x].error!=o){f.splice(x,1);break}}f.length>0&&m.push(p[d].fieldLabel)}var y=App.Nls["emxProgramCentral.GanttTaskCreation.InvalidFormErrorMsg"];return alert(y+" : \n"+m),!1}r.isValidRMBOperation(e[0],s)&&!t.hasInvalidField()&&cpnl.syncOnAddRemoveTask(this,s,i);a.ComponentQuery.query("#ganttTaskCreationPanel")[0]}},{id:"Close",text:App.Nls["emxProgramCentral.Gantt.DependencyEditor.Cancel"],handler:this.closeTaskCreationPanel}]})},closeTaskCreationPanel:function(){var e=a.ComponentQuery.query("#ganttTaskCreationPanel")[0];e.hide(),e.reset();var t=a.getCmp("tBarganttConfiguration");t&&t.enable()}})});