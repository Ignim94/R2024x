define("DS/ENOGantt/View/ResourceUtilizationContextMenu",["UWA/Class","DS/ENOGantt/URLStore","DS/ENOProjectMgmtCommonComponents/utils/ProjectMgmtCloneModel","DS/ENOProjectMgmtModels/Collections/Persons","DS/ENOProjectMgmtModels/Models/Person","DS/ENOGantt/Ven/Ext"],function(e,t,o,n,r,s){return e.extend({init:function(){s.define("DS.ENOGantt.View.ResourceUtilizationContextMenu",{extend:"Ext.menu.Menu",constructor:function(){var e=s.ComponentQuery.query("#dpmprojectgantt")[0],r=s.ComponentQuery.query("#dpmresourceutilizationpanel")[0],a=r.context,i=a.getId(),c=(a.getName(),r.getSelection()[0]),m=c.get("Id"),g=(c.getName(),c.get("Type")),l=(c.get("isReadOnly"),!0);-1!=m.indexOf("assignment-")&&(l=!1);var d=c.data.TaskId;l&&(d=i);var u=e.taskStore.getModelById(d),p=!1;if(u&&(p=u.data.changeSOVAccess),l)var S=e.taskStore.resourceStore.getModelById(m.replace("resource-","")).data.currentState;else S=e.taskStore.assignmentStore.getModelById(m.replace("assignment-","")).getResource().data.currentState;removeAssigneeFromModel=function(e,r){var a=s.ComponentQuery.query("#dpmprojectgantt")[0],i=s.ComponentQuery.query("#dpmresourceutilizationpanel")[0];i.setLoading(!1),i.setLoading(a.L("savingText"));let c=App.Infra.contextInfo,m=c.getAllTasks(),g=c.id===e?c:m.get(e);(g.get("assignees")||new n).remove(r.id),UWA.extend(g._changed,{objectId:g.id});let l=t.getAssignResourceToTaskUrl(),d=a.crudManager.viewCollection,u=new o(g);window.Widget||(donotShowMessage=!0),d.processSaveDataModel(u,{fields:l.fields,include:l.include,isNew:!1,donotShowMessage:donotShowMessage,customParams:l.customParams,onComplete:function(e){a.crudManager.commit(),i.setLoading(!1)}})},_unassign=function(){if(l){var t=e.taskStore.resourceStore.getModelById(m.replace("resource-","")),o=e.getAssignmentStore().getAssignmentForTaskAndResource(a,t);e.crudManager.transport.sync.params.contextTaskId=d,s.MessageBox.confirm(App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveResource.Alert.Header"],App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveResource.Alert.Body"],function(n){"yes"===n&&(e.assignmentStore.remove(o),e.taskStore.resourceStore.remove(t),this.removeAssigneeFromModel(d,t))})}else s.MessageBox.confirm(App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveAssignment.Alert.Header"],App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveAssignment.Alert.Body"],function(t){if("yes"===t){var o=e.taskStore.assignmentStore.getModelById(m.replace("assignment-","")),n=o.getResource();e.crudManager.transport.sync.params={contextTaskId:d},d==i?(e.assignmentStore.remove(o),e.taskStore.resourceStore.remove(n)):e.assignmentStore.remove(o),this.removeAssigneeFromModel(d,n)}})};var v=enoviaServer.computeUrl("/common/images/");this.items=[{text:App.Nls["emxProgramCentral.Common.OpenInNewTab"],icon:v+"iconActionOpenShortcuts.png",iconCls:"tBarIcon",handler:function(){var e="",t="../../common/emxNavigator.jsp?physicalId="+(e=l?c.getId().replace("resource-",""):c.get("TaskId"));window.isIFWE&&(t=enoviaServer.computeUrl("/common/")+"emxNavigator.jsp?physicalId="+e),window.open(t)}},{text:App.Nls["emxProgramCentral.Common.Remove"],icon:v+"iconActionDelete.png",iconCls:"tBarIcon",hidden:"External"==g||"TRUE"!=p||"Active"!=S,handler:function(){var t=e.taskStore.assignmentStore.getModifiedRecords(),o=t&&t.length>0,n=e.taskStore.getModifiedRecords(),a=n&&n.length>0;o||a?s.MessageBox.confirm(App.Nls["emxProgramCentral.Gantt.ResourceUtilization.RemoveAssignment.Alert.Header"],App.Nls["emxProgramCentral.Project.DiscardChanges"],function(t){"yes"===t&&(r.getStore().rejectChanges(),e.getCrudManager().reject(),_unassign())}):_unassign()}}],this.callParent(arguments)}})}})});