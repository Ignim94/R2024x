define("DS/SpecViewer/Documents/view/VersionFileView",["UWA/Core","UWA/Promise","UWA/Class/View","DS/Controls/TooltipModel","DS/Controls/Button","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/createform/view/NewDialog","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/fileupload/FileUploader","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/RequestUtil","i18n!DS/SpecViewer/assets/nls/SpecViewer"],function(e,i,t,n,o,l,s,a,c,r,d,u){"use strict";var f=function(i){var t=new e.createElement("div",{class:"confirmation-text"});t.textContent=u.ConfirmFileName,new e.createElement("div",{class:"confirmation"}).inject(t).textContent=u.ConfirmContinue;var n={},o=this.appCore.specMainContainer;n.Title=u.Title_Confirmation,n.Content=t,n.renderTo=o,n.RemoveApplyButton=!0,n.OKLabel=u.label_Button_Ok,n.position={at:"center",my:"center"};var l=new s(n);l.render(),l.dispatchEvent("CONTAINS_DIRTY_FIELD",{hasDirtyField:!1}),l.listenTo(l,"EVENT_CLICK_SPEC_OK",function(e){l.closeDialog(),i()})};return t.extend({setup:function(e){this._fields={},this._parentView=e,this.container=e.mContainer,this.appCore=e.appCore,this.ctrlContex=e.ctx},render:function(){return this.drawFileZone(this._parentView),this},drawFileZone:function(i){this.fileuploaderDiv=new e.createElement("div",{class:"xsr-file-uploader"}).inject(this.container),this.toggleDropDiv(!0),this.checkInBtn=new o({label:u.Upload,emphasize:"primary",domId:"xsr-file-upload-button",disabled:!0,minHeight:34,preferredHeight:35}),this.fileField=new c({parentContext:this}).render({drawIcon:this.checkInBtn}),this.fileField.renderTo.inject(this.fileuploaderDiv);var t=this;t.uploadAction();this.fileField.listenTo(this.fileField,"VALIDATE_FIELD_VALUE",function(e){t.fileField.hasDirtyField?t._disableUploadIcon():t.fileField.hasDirtyField?t._disableUploadIcon():t._enableUploadIcon()})},toggleDropDiv:function(e){e?(this.fileuploaderDiv.setStyle("display","none"),this.fileField&&this.fileField.dispatchEvent("CLEAR_FIELD_VALUES")):(this.fileuploaderDiv.setStyle("display","block"),this.fileField&&(this.fileField.hasDirtyField?this._disableUploadIcon():this.fileField.hasDirtyField?this._disableUploadIcon():this._enableUploadIcon()))},downloadAction:function(i,t){var o,l=this,s=t.options.grid;d.isSafarionIPadorPod()?(o=e.createElement("div",{class:"xsr-file-actions wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-legend-eye"}).inject(i)).tooltipInfos=new n({shortHelp:u.Preview,allowUnsafeHTMLShortHelp:!1}):(o=e.createElement("div",{class:"xsr-file-actions wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"}).inject(i)).tooltipInfos=new n({shortHelp:u.Download,allowUnsafeHTMLShortHelp:!1}),o.addEventListener("click",function(e){t.getTreeDocument().unselectAll(),t.select(),l.prepareCallBackActions({name:"download",fileName:s.fileName,versionId:s.id})})},deleteAction:function(i,t){var o=t.options.grid;if(o.isLatestVersion&&o.showDelete){var l=this,s=new e.createElement("div",{class:"xsr-file-actions wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash"}).inject(i);s.tooltipInfos=new n({shortHelp:u.Tooltip_Delete,allowUnsafeHTMLShortHelp:!1}),s.addEventListener("click",function(e){t.getTreeDocument().unselectAll(),t.select(),o.locker&&""!==o.locker?(r.clearNotifications(),r.displayNotification({eventID:"warning",msg:u.DeleteVersionWarning})):l.prepareCallBackActions({name:"delete",versionId:o.id,latestVersionId:l.latestFileID,nodeModel:t})})}},uploadAction:function(){var e=this;this.checkInBtn.addEventListener("ondblclick",function(e){console.warn("Ignoring double click")}),this.checkInBtn.addEventListener("buttonclick",function(i){var t,n;i.stopPropagation(),i.preventDefault();var o=e.ctrlContex.getCheckedOutFiles(),l=o.isMultiFileCheckedOut,s=e.ctrlContex.getFileTreeDocument();if(l){if(1!==s.getSelectedNodes().length)return void r.displayNotification({eventID:"warning",msg:u.SelectDocument});var a=s.getSelectedNodes()[0];t=a.options.grid.id,n=a.options.grid.fileName}else t=o.fileID,n=o.fileName;var c=e.fileField.getFiles(),d=e.fileField.getComments();if(c){var p=function(){var i=void 0!==t&&""!==t?"modify":"add";e.ctrlContex.prepareCallBackActions({name:"checkin",mode:i,fileInfo:c,comments:d,versionId:t})};if(n)n===e.fileField.fileName?p():f.call(e,p);else p()}else e.checkInBtn.disabled||r.displayNotification({eventID:"error",msg:u.NoFilesChosen})})},checkoutAction:function(i,t){var o=this,l=t.options.grid,s=new e.createElement("div",{class:"xsr-file-actions wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-database-export"}).inject(i);s.tooltipInfos=new n({shortHelp:u.Checkout,allowUnsafeHTMLShortHelp:!1}),s.addEventListener("click",function(e){t.getTreeDocument().unselectAll(),t.select(),o.prepareCallBackActions({name:"checkout",fileName:l.fileName,versionId:l.id,nodeModel:t})})},checkInAction:function(i,t){var o=this,s=(t.options.grid,new e.createElement("div",{class:"xsr-file-actions wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-database-save"}).inject(i));s.tooltipInfos=new n({shortHelp:u.Checkin,allowUnsafeHTMLShortHelp:!1}),s.addEventListener("click",function(e){t.getTreeDocument().unselectAll(),t.select();var i=l.getFileInput(!0);i.click(),i.addEventListener("change",function(e){e.preventDefault(),e.stopImmediatePropagation();var n=e.target.files.length>0?e.target.files:e.dataTransfer.files;i.removeEvent("change"),i.destroy();if(n.length>0){var s=n[0],a=s.name;if(l.isRestrictedFileFormat(a)){var c=u.replace(u.get("Restricted_Document"),{filename:a});r.displayNotification({eventID:"error",msg:c})}else{var d=t.options.grid.id,p=function(){o.prepareCallBackActions({name:"checkin",mode:"modify",fileInfo:s,comments:"",versionId:d})};t.options.grid.fileName!==a?f.call(o,p):p()}}})})},unlockAction:function(i,t){var o=this,l=t.options.grid,s=new e.createElement("div",{class:"xsr-file-actions wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open"}).inject(i);s.tooltipInfos=new n({shortHelp:u.LockedBy,allowUnsafeHTMLShortHelp:!1}),s.addEventListener("click",function(e){t.getTreeDocument().unselectAll(),t.select(),o.prepareCallBackActions({name:"unlock",versionId:l.id,nodeModel:t})})},lockAction:function(i,t){var o=this,l=t.options.grid,s=new e.createElement("div",{class:"xsr-file-actions wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock"}).inject(i);s.tooltipInfos=new n({shortHelp:u.Lock,allowUnsafeHTMLShortHelp:!1}),s.addEventListener("click",function(e){t.getTreeDocument().unselectAll(),t.select(),o.prepareCallBackActions({name:"lock",versionId:l.id,nodeModel:t})})},_disableUploadIcon:function(){this.checkInBtn&&(this.checkInBtn.disabled=!0)},_enableUploadIcon:function(){this.checkInBtn&&(this.checkInBtn.disabled=!1)}})});