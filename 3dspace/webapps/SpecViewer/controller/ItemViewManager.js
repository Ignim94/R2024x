define("DS/SpecViewer/controller/ItemViewManager",["UWA/Core","DS/Controls/TabBar","UWA/Class/View","DS/Controls/TooltipModel","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/XSRMask","text!DS/SpecViewer/assets/config/TabCommands.json","i18n!DS/SpecViewer/assets/nls/SpecViewer","DS/XSRCommonComponents/utils/Constants","css!DS/SpecViewer/controller/ItemViewManager.css"],function(e,t,i,a,s,n,r,o,l,c){"use strict";return i.extend({setup:function(t){this.appCore=t.appCore,this.idCard=t.idCard,this.modelEvents=this.appCore.specViewerModelEvents,this.basicModelEvents=this.appCore.basicModelEvents,this.specTreeModel=t.specModel,this.itemId=this.specTreeModel.getID(),this.itemType=this.getItemType(this.specTreeModel.getTypeActualName()),this.itemKindOf=this.specTreeModel.getKindOf(),this.parentType=this.getParentType(),this.container=new e.Element("div",{id:"xsr-item-data-view"});var i=this;if(this.itemViewSubsList=[],this.itemViewSubsList.push(this.modelEvents.subscribe({event:"item-view-manager-material-icon-update"},function(e){let t="Material";"true"===e.hasMaterialMismatch?(i.specTabWindow.updateTab(4,{label:l.Alert_Material_Mismatch,showTitleFlag:!1,icon:{iconName:"material-attention",fontIconFamily:WUXManagedFontIcons.Font3DS,className:"material-mimatch"},allowClosableFlag:!1}),t=l.Alert_Material_Mismatch):(document.querySelector("#xsr-item-tab-button-spec_mat").classList.remove("xsr-material-mismatch"),i.specTabWindow.updateTab(4,{label:t,icon:{iconName:"material",fontIconFamily:WUXManagedFontIcons.Font3DS}}))})),this.itemViewSubsList.push(this.modelEvents.subscribe({event:"xsr-current-tab-refresh"},function(){var e=i.currentTab?i.currentTab.currentTabArguments:null,t=i.currentTab.instance;t.refreshTab?t.refreshTab():e&&(i.tabContainer.empty(),t.destroy&&t.destroy(),i._instantiateTab(e.AMDLoader,e.target,e.key))})),this.itemViewSubsList.push(this.modelEvents.subscribe({event:"refresh-current-grid-content"},function(){const e=i.currentTab.currentTabArguments.key,t={updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1};if("Properties"==e){i.tabContainer.empty();let t={};t.appCore=i.appCore,t.container=i.tabContainer,t.currentTabKey=e,t.itemId=i.itemId,t.itemType=i.itemType,t.specModel=i.specTreeModel,t.target=i.tabContainer,require(["DS/SpecViewer/Properties/SpecAttributes"],function(e){e&&new e(t).render();r.unmaskLoader(i.container)})}else if("MakeFrom"===e)i.currentTab.instance.MBMFView.MBMFGrid.gridView.updateView(t);else if("ReleaseSnapshot"===e)i.currentTab.instance.refreshTab();else if("Properties"!=e){let a=c.gridNames[e];i.currentTab.instance[a].gridView.updateView(t)}})),this.basicEvtSubsList=[],this.basicEvtSubsList.push(this.basicModelEvents.subscribe({event:"xsr-set-Dnd-status"},function(e){e&&e.disableDropZone?s.dragStartedInXSR=!0:s.dragStartedInXSR=!1})),r.maskLoader(this.container),o)var a=JSON.parse(o);!this.appCore.isPerformanceSpecEnabled&&a.hasOwnProperty("PerfomanceSpecification"),this._tabConfig=a},getParentType:function(){return n.isPhysicalProduct(this.itemType)?c.TYPE_VPMREFERENCE:s.isTechnicalSpecification(this.itemType)?c.TYPE_DOCUMENT:""},getItemType:function(e){return n.isRawMaterial(e)?c.RAW_MATERIAL_TYPE:n.isFormulatedProduct(e)?c.FORMULATED_PRODUCT:e},render:function(){var i=this;this.specTabWindow=new t({allowUnsafeHTMLOnTabButton:!1,reorderFlag:!1,showComboBoxFlag:!0,pinFlag:!1,editableFlag:!1,multiSelFlag:!1,centeredFlag:!1,displayStyle:["strip"],domId:"xsr-item-tab",touchMode:!0}),this.specTabWindow.inject(this.container),this.tabloaderInfo={};var r={};if(this.tabDetailsInfo=[],this._tabConfig){let e=i.specTreeModel.hasBOMConnection(),t=i.specTreeModel.hasMBMFConnection(),S=i.specTreeModel.getKindOf().includes(c.TYPE_3DPART),A=i.specTreeModel.hasMBMFConnection&&i.specTreeModel.hasMaterialMismatch(),R=i.specTreeModel.options.isMEI;var o=!1,d=i.appCore.specRouteManager.getItemInfoInStack(i.itemId),m="",u=widget.getValue("itemTabInfo");if(u){m=R?"spec_mat":u.selectedTab;let a=!1;n.isPhyOrRaw(i.itemType)&&n.isPhyOrRaw(u.itemType)&&(a=!0),n.isFormulatedProduct(i.itemType)&&n.isFormulatedProduct(u.itemType)&&(a=!0);let s=u.itemId,r=s&&s==i.itemId,o=["ReleaseSnapshot","Properties"].includes(u.selectedTab);n.isPhyProd(i.itemType)&&!n.isFormulatedProduct(i.itemType)&&(m===c.BOM_TAB&&t?m=c.MAKE_FROM_TAB:m===c.MAKE_FROM_TAB&&e&&(m=c.BOM_TAB),S&&m===c.BOM_TAB&&(m="")),n.isRawMaterial(i.itemType)&&[c.BOM_TAB,c.MAKE_FROM_TAB].includes(m)&&(m=c.MAT_TAB),r||a||o||(widget.setValue("itemTabInfo",void 0),m=""),n.isFormulatedProduct(i.itemType)&&[c.BOM_TAB,c.MAKE_FROM_TAB,c.MAT_TAB].includes(m)&&(m=c.FORMULABOM_TAB)}else!u&&d.selectedTab&&(m=d.selectedTab);for(var p in this._tabConfig){var T=this._tabConfig[p],b=l[T.nls_key]?l[T.nls_key]:T.nls_key,h=T.icon,M=T.key,y=T.AmdLoader,f=(T.license,T.applicableType),C=T.order,g=T.excludeTypes,E=(T.excludeKind,l[T.toolTipKey]?l[T.toolTipKey]:b);if("ReleaseSnapshot"!==M||!s.hasAdminDisabledTemplate){if(g&&g.length>0){if(g.includes("MEI")&&R)continue;if(g.includes(i.itemType))continue;if(n.isRawMaterial(i.itemType)&&g.includes(c.RAW_MATERIAL_TYPE))continue;if(g.includes(i.parentType))continue}if(A&&(this._tabConfig.Materials.icon="material-attention",E=l.Alert_Material_Mismatch),"all"===f||f===i.itemType||f===i.parentType){this.tabloaderInfo[C]={loader:T.AmdLoader,key:M};var I=!1;(m&&M===m||!o&&!m)&&(r={loader:T.AmdLoader,key:M},I=!0,o=!0);var w=new a({shortHelp:E,allowUnsafeHTMLShortHelp:!1}),_=this.specTabWindow.add({label:b,showTitleFlag:!1,isSelected:I,index:C,icon:{iconName:h,fontIconFamily:1},allowClosableFlag:!1}),v={tabKey:M,tabInfo:_,tabOrder:C,tabLoader:y};this.tabDetailsInfo.push(v),_.tooltipInfos=w,_.domId="xsr-item-tab-button-"+M,A&&"spec_mat"==T.key&&_.elements.container.addClassName("xsr-material-mismatch")}}}}this.tabContainer=new e.Element("div",{id:"xsr-item-tab-view",class:"listContainer"}).inject(i.container),this.appCore.xsrTabContainer=this.tabContainer,this.specTabWindow.addEventListener("change",function(e){var t=e.dsModel.value[0];if(t>=0&&i.tabloaderInfo&&i.itemId){var a={itemId:i.itemId,selectedTab:i.tabloaderInfo[t].key,itemType:i.itemType};widget.setValue("itemTabInfo",a),i.appCore.specRouteManager.updateCurrentItem(i.itemId,i.tabloaderInfo[t].key)}var s=function(){if(i.currentTabIndex=e.dsModel.getButtonFromValue(t)._index,t>=0){i.tabContainer.empty(),i.appCore.triptychManager&&i.appCore.triptychManager.hideRightPanel(),i.currentTab&&i.currentTab.instance&&i.currentTab.instance.destroy&&i.currentTab.instance.destroy();var a=i.tabloaderInfo[t].loader,s=i.tabloaderInfo[t].key;i._instantiateTab(a,i.tabContainer,s)}};if(i.basicModelEvents&&i.basicModelEvents.getEventByName(c.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN)){if(i.currentTabIndex===e.dsModel.getButtonFromValue(t)._index)return;i.basicModelEvents.publish({event:c.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN,data:{callBackFunc:s,cancleCallBackFunc:function(){i.currentTabIndex&&(i.specTabWindow.value=i.currentTabIndex)}}})}else s()}),i._instantiateTab(r.loader,i.tabContainer,r.key)},_instantiateTab:function(e,t,i){var a={AMDLoader:e,target:t,key:i},s=this,n={};n.target=n.container=t,n.itemId=this.itemId,n.specModel=this.specTreeModel,n.itemType=this.specTreeModel.getTypeActualName(),n.currentTabKey=i,n.appCore=this.appCore;let o={itemId:this.itemId,selectedTab:i,itemType:this.specTreeModel.getTypeActualName()};widget.setValue("itemTabInfo",o);var l=widget.getValue(c.XSR_FILTER_PREF);if(l&&l.filterRootIds[0]!==n.itemId||"bom"!=n.currentTabKey){s.modelEvents.publish({event:c.EVENT_UPDATE_IDCARD_RENDERING,data:""})}let d=document.getElementsByClassName("xspecs-content-container")?document.getElementsByClassName("xspecs-content-container").item(0):"";if(d){let e=d.getElementsByClassName("xspecs-list-tile")?d.getElementsByClassName("xspecs-list-tile").item(0):"";if(e){let t=e.getElementsByClassName("wux-layouts-responsivecollectionview")?e.getElementsByClassName("wux-layouts-responsivecollectionview").item(0):"";if(t){let e=t.getElementsByClassName("wux-controls-responsivetileview-menu")?t.getElementsByClassName("wux-controls-responsivetileview-menu").item(0):"";if(e){e=t.getElementsByClassName("wux-controls-responsivetileview-menu");for(let t=0;t<e.length;t++)e[t].setAttribute("has-menu",!1)}}}}e&&require([e],function(e){if(e){var t=new e(n);t.render(),s.currentTab={instance:t,currentTabArguments:a}}r.unmaskLoader(s.container)})},destroy:function(){this.currentTab&&this.currentTab.instance.destroy&&this.currentTab.instance.destroy(),this.itemViewSubsList&&this.modelEvents.unsubscribeList(this.itemViewSubsList),this.basicEvtSubsList&&this.basicModelEvents.unsubscribeList(this.basicEvtSubsList),this.container.destroy()}})});