define("DS/SpecViewer/controller/SpecViewController",["DS/Controls/Abstract","DS/SpecViewer/IDCard/SpecIdCard","DS/SpecViewer/controller/ItemViewManager","DS/XSRCommonComponents/utils/XspecEvents","UWA/Core","DS/SpecViewer/model/SpecTreeModel","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/components/XSpecDnD/DragDropUtil","DS/XSRCommonComponents/utils/Constants","css!DS/SpecViewer/spec.css"],function(e,i,t,s,n,o,a,r,p,d,c){"use strict";return e.extend({init:function(e){this.itemPid=e.itemPid,this.itemActualType=e.typeActual?e.typeActual:"",this.itemTypeName=e.typeName||this.itemActualType,this.itemKindOf=e.kindOf||"",this.isMEI=e.isMEI,this.appCore=e.appCore,this.appCore.specViewerModelEvents=this.modelEvents=new s,this.triptychManager=this.appCore.triptychManager,this.specRouteManager=this.appCore.specRouteManager,this.basicModelEvents=this.appCore.basicModelEvents;var i=e.container||this.appCore.specContainer;i.empty(),this.container=e.appCore.specMainContainer;var t=e.openViewer;this.viewerSubscription=[],this.basicModelSubscription=[],this.specViewContainer=new n.Element("div",{id:"SpecViewContainer",class:"SpecContainer"}),this.specViewContainer.inject(i),t?this.triptychManager.hideLeftPanel():this.basicModelEvents&&this.basicModelEvents.publish({event:c.WELCOMEPANEL_EVENT_COLLAPSE}),this._subscribeToEvents(),this.dnd=new d({modelEvents:this.basicModelEvents}),this.appCore.dndManager={},this.appCore.dndManager.enableDragAndDropOnSpecViewer=this._enableDragAndDropOnSpecViewer.bind(this),this.appCore.dndManager.enableDragAndDropOnIDCard=this._enableDragAndDropOnIDCard.bind(this)},_subscribeToEvents:function(){var e=this;this.basicModelSubscription.push(this.basicModelEvents.subscribe({event:c.SPEC_VIEW_REMOVE_PENDINGACTIONS},e.removePendingActions.bind(e))),this.basicModelSubscription.push(this.basicModelEvents.subscribe({event:"xsr-item-delete-success"},function(i){e.itemPid===i&&e.modelEvents.publish({event:c.EVENT_IDCARD_CUSTOM_SHOW_LANDING_PAGE,data:""})}))},loadSpecViewer:function(){var e=this.itemPid,i=this.itemActualType,t=this.itemTypeName;if(e){var s={id:e,type:i,typeName:t,isMEI:this.isMEI};widget.setValue("xsr-item",s),this.specViewerModel=new o(s),this.specViewerModel.syncModel({onComplete:this.loadSpecCallBack.bind(this),onFailure:this.loadSpecCallBack.bind(this)})}},loadSpecCallBack:function(e){"succesful"==e?(this._setWidgetTitle(),this.appCore.specRouteManager.setActiveSpecItem(this.specViewerModel),this.specRouteManager.pushItem({typeActual:this.itemActualType,itemPid:this.itemPid,isMEI:this.isMEI}),this._initPosition()):console.error(e)},_setWidgetTitle:function(){a.getCurrentSCCollabSpaceTitle(),a.getAppTenantName();let e=this.specViewerModel.getTitle();widget.setTitle(a.setWidgetTitle(e))},_initPosition:function(){var e=this._loadIdCard(),i=this._loadItemView(),t=e.xIDCard;if(t.getMainContent().appendChild(i.container),t.inject(this.specViewContainer),e.handleIconsBasedOnWidth(),r.isOriginatedInGLS(this.specViewerModel)){var s=this.specViewContainer.getElementsByClassName("version");s.length>0&&s[0].toggleClassName("version")}this.dnd.cleanDroppable(this.appCore.specMiddleContainer),this._enableDragAndDropOnSpecViewer()},_loadIdCard:function(){return this.idCardComponent=new i(this),this.idCardComponent.build(),this.idCardComponent},_loadItemView:function(){var e={specModel:this.specViewerModel,appCore:this.appCore,idCard:this.idCardComponent};return this.itemView=new t(e),this.itemView.render(),this.itemView},enableDragAndDrop:function(e){e&&(this.dnd.makeDragable(e,[this.specViewerModel]),this.dnd.makeDroppable(e,"drop"))},_enableDragAndDropOnSpecViewer:function(){var e=document.querySelector(".xapp-id-card-container");e&&null!=e&&(this.dnd.cleanDroppable(e),this.dnd.makeDragable(e,[this.specViewerModel])),this.dnd.makeDroppable(this.specViewContainer,"drop")},_enableDragAndDropOnIDCard:function(){this.dnd.cleanDroppable(this.specViewContainer);var e=document.querySelector(".xapp-id-card-container");this.enableDragAndDrop(e)},removePendingActions:function(){this.dnd&&this.dnd.makeDroppable(this.appCore.specMiddleContainer,"drop"),this.viewerSubscription&&this.modelEvents.unsubscribeList(this.viewerSubscription),this.basicModelSubscription&&this.basicModelEvents.unsubscribeList(this.basicModelSubscription),this.idCardComponent&&this.idCardComponent.destroy(),this.itemView&&this.itemView.destroy(),this.specViewContainer.destroy(),this.appCore.triptychManager.hideRightPanel(),widget.getValue("xsr-item")&&widget.setValue("xsr-item",void 0)}})});