define("DS/SpecViewer/BOM/ContQty/controller/AddContQty",["UWA/Controls/Abstract","DS/SpecViewer/BOM/ContQty/view/CreateContQty","DS/SpecRawMaterial/control/NewRawMaterial","DS/SpecViewer/BOM/service/EngineeringServiceWrapper","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/XSRSearch","DS/XSRCommonComponents/utils/RMCommonServiceProvider","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/TypeUtils","DS/SpecViewer/BOM/ContQty/service/ContQtyServiceProvider","DS/XSRCommonComponents/utils/Utils","i18n!DS/SpecViewer/assets/nls/ContQty"],function(e,t,n,i,a,s,r,o,d,l,c,p){"use strict";return e.extend({init:function(e){this.appCore=e.appCore,this.currentTabKey=e.currentTabKey,this.container=e.container,this.bomGrid=e.bomGrid,this.isReferenceView=e.isReferenceView,this.isTileView=e.isTileView,this.specModel=e.specModel,this.modelEvents=e.modelEvents,this.isFP=e.isFP;var t={appCore:this.appCore,currentTabKey:this.currentTabKey,modelContainer:this.container,parentNodeModel:this.specModel};this.engService=new i(t)},launchAddInstance:function(e){var n=this;let i=[o.TYPE_VPMREFERENCE];e&&e.searchOnlyRawM&&(i=[o.RAW_MATERIAL_TYPE]),n.isFP&&(i=[o.FORMULATED_PRODUCT]);var a={allowedTypes:i,role:"",criteria:e.query,precondition:'NOT [current]:"OBSOLETE"',in_apps_callback:function(e){var i={};i.appCore=n.appCore;var a=n.bomGrid.getTreeDocument().getSelectedNodes();if(a&&0===a.length?(i.parentId=n.specModel.getID(),i.parentTitle=n.specModel.getLabel()):a&&1===a.length&&(i.parentId=a[0].getID(),i.parentTitle=a[0].getLabel()),e&&e.length>0){i.createCloseAction=i.createAction=function(e){for(var t=[],i=[],a=0;a<e.length;a++){var s={},r=e[a].instanceDetails;!0===r.asRequired||r.quantity&&r.quantityType&&r.quantityUOM?(r.quantityType?r.quantityType.dbName=l.get(r.child.id):r.quantityType={dbName:l.get(r.child.id),nlsName:l.get(r.child.id)},i.push(r)):(s.fromId=r.parentId,s.id=r.child.id,s.instanceId=r.instanceId,t.push(s))}t&&t.length>0&&n.modelEvents.publish({event:"grid-list-addInst-node-successful-bom",data:t}),i&&i.length>0&&n.modelEvents.publish({event:"add-CQ-node-BOM-success",data:{nodes:i,canExpand:!(t&&t.length>0)}})};var s=[];e.forEach(function(e){let t=e["ds6w:type_value"];!e["ds6wg:raw_material.v_dimensiontype_value"]&&t&&(d.isRawMaterial(t)||d.isFormulatedProduct(t))&&s.push(e.id)});var o=[];0!==s.length&&s.forEach(function(e){var t=new Promise((t,n)=>{(new r).getUOMTypes(e).then(function(n){var i={};i[e]=n.result.applicableUOMTypes[0].dimension.dbName,t(i)})});o.push(t)});var l=new Map;Promise.all(o).then(function(a){var s=new Map;a.forEach(function(e){s.set(Object.keys(e)[0],Object.values(e)[0])});var r=n.createProdGridFields(e,i.parentId,s);r.forEach(function(e){l.set(e.id,e.DimensionType)}),new t(i).loadFields(r)})}}};new s(a).launchSearch(a)},createProdGridFields:function(e,t,n){for(var i=[],a=0;a<e.length;a++){var s=[];s.Title=e[a]["ds6w:label"],s.DimensionType=e[a]["ds6wg:raw_material.v_dimensiontype_value"],(!s.DimensionType&&("Raw Material"==e[a]["ds6w:type"]||d.isFormulatedProduct(e[a]["ds6w:type"])||d.isFormulatedProduct(e[a]["ds6w:type_value"]))&&0!=n.length||!s.DimensionType&&d.isRawMaterial(e[a]["ds6w:type"]))&&(null!=e[a].id&&""!=e[a].id?s.DimensionType=n.get(e[a].id):null!=e[a].physicalId&&""!=e[a].physicalId&&(s.DimensionType=n.get(e[a].physicalId)));var r=[];if(s.DimensionType){var o=d.getUOMUnits(s.DimensionType);Object.keys(o).forEach(function(e){r.push({nlsLabel:o[e],dbName:e})}),s.Dimensions=r}s.Type=e[a]["ds6w:type"],s.typeDBName=e[a]["ds6w:type_value"],null!=e[a].id&&""!=e[a].id?s.id=e[a].id:null!=e[a].physicalId&&""!=e[a].physicalId&&(s.id=e[a].physicalId),s.parentId=t,s.revision=e[a]["ds6wg:revision"],s.revisionDBName=e[a]["dds6wg:revision_value"],s.maturityNLS=e[a]["ds6w:status"],s.maturityDBName=e[a]["ds6w:status_value"],i.push(s)}return i},createRawM:function(){var e=this,t={appCore:e.appCore,advanceUi:!0},i=e.bomGrid.getTreeDocument().getSelectedNodes();i&&0===i.length?(t.parentId=e.specModel.getID(),t.parentTitle=e.specModel.getTitle()):i&&1===i.length&&(t.parentId=i[0].getID(),t.parentTitle=i[0].getTitle()),t.onCreateSuccess=function(t,n,i){e.createRawMCreateCloseAction(t,i)},e.createRawM=new n(t),e.createRawM.execute()},createRawMCreateCloseAction:function(e,t){var n=this;(new l).getContQtyInstData(t).then(function(e){e&&e.result?n.modelEvents.publish({event:"add-CQ-node-BOM-success",data:{nodes:[e.result]}}):a.displayNotification({eventID:"error",msg:p.Error_AddCQ})}).catch(function(e){a.displayNotification({eventID:"error",msg:e?e.message.trim()===p.Continous_Qunat_Template_Error?p.Continous_No_Access:e.message:p.Error_AddCQ})})},CreateDragAndDrop:function(e){var n=this,i={};i.appCore=n.appCore;var a=n.bomGrid.getTreeDocument().getSelectedNodes();a&&0===a.length?(i.parentId=n.specModel.getID(),i.parentTitle=n.specModel.getLabel()):a&&1===a.length&&(i.parentId=a[0].getID(),i.parentTitle=a[0].getLabel()),i.createCloseAction=i.createAction=function(e){for(var t=[],i=[],a=0;a<e.length;a++){var s={},r=e[a].instanceDetails;!0===r.asRequired||r.quantity&&r.quantityType&&r.quantityUOM?(r.quantityType?r.quantityType.dbName=l.get(r.child.id):r.quantityType={dbName:l.get(r.child.id),nlsName:l.get(r.child.id)},i.push(r)):(s.fromId=r.parentId,s.id=r.child.id,s.instanceId=r.instanceId,t.push(s))}t&&t.length>0&&n.modelEvents.publish({event:"grid-list-addInst-node-successful-bom",data:t}),i&&i.length>0&&n.modelEvents.publish({event:"add-CQ-node-BOM-success",data:{nodes:i}})};var s=[];e.forEach(function(e){!e["ds6wg:raw_material.v_dimensiontype_value"]&&d.isRawMaterial(e["ds6w:type"])?s.push(e.physicalId):d.isFormulatedProduct(e["ds6w:type"])&&s.push(e.physicalId)});var o=[];0!==s.length&&s.forEach(function(e){var t=new Promise((t,n)=>{(new r).getUOMTypes(e).then(function(n){var i={};i[e]=n.result.applicableUOMTypes[0].dimension.dbName,t(i)})});o.push(t)});var l=new Map;Promise.all(o).then(function(a){var s=new Map;a.forEach(function(e){s.set(Object.keys(e)[0],Object.values(e)[0])});var r=n.createProdGridFields(e,i.parentId,s);r.forEach(function(e){l.set(e.id,e.DimensionType)}),new t(i).loadFields(r)})}})});