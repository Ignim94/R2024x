define("DS/SpecViewer/Properties/view/ItemProperties",["UWA/Core","DS/SpecViewer/commands/CommandBase","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/components/EditProp/XSpecProperties","DS/EditPropWidget/constants/EditPropConstants","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/components/Navigation/NavigationView","i18n!DS/SpecViewer/assets/nls/SpecViewer","css!DS/XSRCommonComponents/InformationPanel.css"],function(e,t,s,i,n,o,a,c,r,d){"use strict";return t.extend({init:function(t){t=e.extend(t,{isAsynchronous:!1}),this._parent(t),this.cmdId=t.ID},execute:function(){var e=arguments[0]._selectedItems[0];let t=arguments[0].cmdLaunchAt;var n;if(this.selectFacet=arguments[0].selectFacet,e){this.itemId=e.getID(),this.itemTitle=e.getTitle(),this.itemType=e.getTypeActualName(),this.appCore=e.appCore,this.latestItemIdInRoute=e.appCore.specRouteManager.getCurrentSpecViewerId(),this.isFirstObject=e.firstObject,this.isLastObject=e.lastObject,this.container=e.appCore.specRightContainer,(n=this.container).empty(),this.modelEvents=e.appCore.specViewerModelEvents,this.basicModelEvents=e.appCore.basicModelEvents,widget&&void 0!==widget.data&&widget.data.appId===s.XSR_APP_ID&&(widget.appMediator=this.basicModelEvents),this.specModel=e;let t=e.appCore.triptychManager;t.setResetSearch(!1),t.setCommandId(s.INFORMATION_CMD),t.isRightPanelOpen()?t.isLaunchFromIcon()?(this.destroy(),t.setLaunchFromIcon(!1),t.hideRightPanel()):t.resizePanel(500):t.showRightPanel(550),t.getCurrentTabKey()?(i.deactivateInfoIcon(),i.activateInfoIconInTab()):this.latestItemIdInRoute==this.itemId||t.getCurrentTabKey()?(i.activateInfoIcon(),i.deactivateInfoIconInTab()):(i.deactivateInfoIcon(),i.activateInfoIconInTab()),this.eventsSusb=[],this.modelEventsSubs=[];var o=this;o.lastNodeSelected||(o.lastNodeSelected=e.id),this.eventsSusb.push(o.basicModelEvents.subscribe({event:s.EVENT_SPEC_GRID_NODES_SELECTION_ACTION},function(e){if(t.isRightPanelOpen()&&e.commandId==s.INFORMATION_CMD)if(e.currentTab&&(t.setCurrentTabKey(e.currentTab),i.deactivateInfoIcon(),i.activateInfoIconInTab()),0===e.count)void 0===e.parentModel&&o._renderEmptyOrManyMsg("Empty");else if(e.count>1)o._renderEmptyOrManyMsg("Many");else if(1===e.count){let t=e.currentModel,i=o.itemId;if(t){let e=i&&t.id&&i==t.id;o.lastNodeSelected!=i&&e||(o.lastNodeSelected=t.id,o.destroy(),o.basicModelEvents.publish({event:s.EVENT_LAUNCH_COMMAND,data:{commandId:o.cmdId,context:{item:{data:t}}}})),o.lastNodeSelected=t.id}}})),o.modelEvents&&this.modelEventsSubs.push(o.modelEvents.subscribe({event:s.EVENT_DESTROY_INSTANCE},function(e){e.cmdId!==s.INFORMATION_CMD&&o.removeSubscriptions()})),this.eventsSusb.push(o.basicModelEvents.subscribe({event:s.EVENT_INFORMATION_PANEL_REFRESH},function(e){o.editPropView&&o.editPropView.onRefresh()})),this.eventsSusb.push(o.basicModelEvents.subscribe({event:s.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN},function(e){if(o.container.hasClassName(s.PROPERTIES_FIELD_DIRTY))o.basicModelEvents.publish({event:s.XSR_EVENT_CHECK_RIGHT_BEFORE_CLOSE,data:{okCallBack:e.callBackFunc,cancleCallBackFunc:e.cancleCallBackFunc}});else{if((void 0===e.cmdId||e.cmdId!==s.INFORMATION_CMD&&e.cmdId!==s.MANAGE_FILES)&&e.callBackFunc&&"function"==typeof e.callBackFunc)return void e.callBackFunc.call();if(t.getCommandId()==s.INFORMATION_CMD&&o.itemId===e.selNodes[0].getID()&&o.latestItemIdInRoute&&o.latestItemIdInRoute===e.selNodes[0].getID())return t.isLaunchFromIcon()&&t.isRightPanelOpen()?(t.setLaunchFromIcon(!1),t.hideRightPanel(),void o.destroy()):void(e.callBackFunc&&"function"==typeof e.callBackFunc&&(o.destroy(),e.callBackFunc.call()));e.cmdId!==s.INFORMATION_CMD&&e.cmdId!==s.MANAGE_FILES||!e.callBackFunc||"function"!=typeof e.callBackFunc||(t.setCommandId(e.cmdId),o.destroy(),e.callBackFunc.call())}})),this.eventsSusb.push(this.basicModelEvents.subscribe({event:"xsr-right-panel-closed"},function(){o.destroy()}))}"ActionBar_Information"===o.cmdId&&(o.cmdId=s.INFORMATION_CMD);let a={modelEvents:o.modelEvents,basicModelEvents:o.basicModelEvents,container:n,model:o.specModel,cmdId:o.cmdId,appCore:o.appCore},c=new r(a);if(this.facetsArr=["Properties","Change","Comments","Sharing","History"],void 0===o.latestItemIdInRoute||o.latestItemIdInRoute!==o.itemId){"ActionBar_Information"===o.cmdId&&(o.cmdId=s.INFORMATION_CMD),a={callBackFunc:o.destroy.bind(o)},n=c.displayPrevNextIcons(a).container}this.initEditPropWidget(n,t);let d=widget.getValue("lastSelectedFacet"),l=o.selectFacet?o.selectFacet:d;"Yes"==arguments[0]._selectedItems[0].options.grid.Alternate&&(l="alternateFacet"),l&&"properties"!=l&&setTimeout(function(){o.editPropView&&o.editPropView.selectFacet(l)},600)},_renderEmptyOrManyMsg:function(t){this.container=this.appCore.specRightContainer,this.container.empty();let s=c.getTouchMode(),i=e.createElement("div",{class:"xsr-message-container"});"Empty"==t?i.addContent(d.Message_NoItemSelected):"Many"==t&&i.addContent(d.Message_TooManyItems),s&&i.addClassName("xsr-mobile-font"),i.inject(this.container)},initEditPropWidget:function(e,t){var a=i.isPerformanceChar(this.itemType),c=n.isTechnicalSpecification(this.itemType),r=i.isPerformanceSpec(this.itemType),d=!1;(a||r&&this.specModel.getMaturityActualName()!=s.MATURITY_IN_WORK)&&(d=!0);var l=!0;c&&(l=!1),i.isOriginatedInGLS(this.specModel)&&(d=!0,this.facetsArr=["Properties"]),i.isPerformanceChar(this.specModel.getTypeActualName())&&(this.facetsArr=["Properties","History"]),i.isPerformanceSpec(this.specModel.getAttributeValue("ds6w:type_value"))&&(this.facetsArr=this.facetsArr.filter(e=>"Sharing"!=e));var p=i.isMEIItem(this.specModel),m=i.isPerformanceSpec(this.specModel.getTypeActualName()),I=i.isPerformanceChar(this.specModel.getTypeActualName());(p||n.isTechnicalSpecification(this.itemType)||s.TYPE_DOCUMENT==this.itemType)&&this.facetsArr.push("Classifications"),this.specProp=new o,this.editPropView=this.specProp.init({id:this.itemId,container:e,readOnly:d,facets:this.facetsArr,enableChangeRequired:l,specModel:this.specModel}),this.appCore.editPropView=this.editPropView,(n.isPhysicalProduct(this.itemType)&&!p&&!m||I)&&this.specProp._addCustomFacet(this.appCore,t)},removeSubscriptions:function(){this.eventsSusb&&this.basicModelEvents.unsubscribeList(this.eventsSusb),this.modelEventsSubs&&this.modelEventsSubs.length>0&&this.modelEvents.unsubscribeList(this.modelEventsSubs)},persistInformationFacet:function(){if(this.editPropView){let e=this.editPropView.getContent?this.editPropView.getContent().currentFacetName:void 0;e&&widget.setValue("lastSelectedFacet",e)}},destroy:function(){this.modelEvents&&this.modelEvents.publish({event:"xsr-slide-in-facet-destroy-updated",data:{}}),this.persistInformationFacet(),this.removeSubscriptions(),this.appCore.triptychManager.setResetSearch(!0),this.appCore.editPropView=void 0,this.specProp&&this.specProp.destroy(),i.deactivateInfoIconInTab(),i.deactivateInfoIcon(),this.container.empty()}})});