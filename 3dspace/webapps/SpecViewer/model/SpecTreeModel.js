define("DS/SpecViewer/model/SpecTreeModel",["DS/TreeModel/TreeNodeModel","UWA/Core","UWA/Promise","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/XInfraRequestUtil","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/IndexServiceProvider","DS/XSRCommonComponents/utils/ChangeServiceProvider","DS/XSRCommonComponents/utils/Constants","DS/SpecViewer/BOM/service/EngineeringServiceWrapper","DS/ENOMadeFromUX/service/MBMFServiceProvider","DS/ENOMadeFromUX/utils/MBMFUtils","DS/XSRCommonComponents/utils/ContextManager","DS/XSRCommonComponents/utils/ItemServiceProvider","text!DS/SpecViewer/assets/BOMConfig/BOMNGFilter.json"],function(t,e,o,i,n,s,r,p,a,c,u,l,h,d,m,y){"use strict";var f=function(t,e){if(t.indexOf("all")>=0)return!0;var o=e;if(Array.isArray(o)){for(var i=!0,n=0;n<o.length;n++){var s=o[n];if(-1===t.indexOf(s)){i=!1;break}}return i}return t.indexOf(o)>=0||void 0};function g(o){this._parentNode={_nodeDepth:1},this.pathElement={externalPath:[]},this.queryType=o.type,this.id=o.id,this.typeName=o.typeName,this.options={grid:{"ds6w:type":void 0,"ds6wg:revision":void 0,"ds6w:responsible":void 0,typeIcon:[],"ds6w:label":void 0,physicalid:void 0,modelType:c.SPEC_ITEM_MODEL,isMEI:o.isMEI},icons:[],type:"",typeActualName:"",typeSymbolicName:"",physicalid:"",name:"",title:void 0,description:"",policy:"",policyActualName:"",maturity:"",maturityActualName:"",cestamp:"",currentAccess:void 0,templatePid:"",templateTitle:"",templateName:"",templateRevision:"",templateState:"",templateStateDisplay:"",specReportPid:"",specReportType:void 0,specReportTypeSymbolicName:void 0,specReportTypeActualName:void 0,specReportName:void 0,specReportRevision:void 0,specReportMaturity:void 0,specReportMaturityActualName:void 0,specReportCreator:void 0,specReportDescription:void 0,specReportTitle:void 0,specReportCurrentAccess:void 0,proposedChangeAction:[],realizedChangeAction:[],changeContext:[],changeRequired:[],thumbnail:void 0,childrenPresent:!1,hasMadeOf:!1,childBOMConnection:!1,kindOf:[],referenceList:[],is3DPart:!1},this.options=e.extend(this.options,o),t.call(this,this.options)}return g.prototype=Object.create(t.prototype),g.prototype.getReferenceVersion=function(){return this.options.revision},g.prototype.getTemplateState=function(){return this.options.templateState},g.prototype.getTemplateDescription=function(){return this.options.templateDescription},g.prototype.getTemplateStateDisplay=function(){return this.options.templateStateDisplay},g.prototype.getFilename=function(){return this.options.filename},g.prototype.isFileLocked=function(){return Boolean.parse(this.options.isFileLocked)},g.prototype.getFileLocker=function(){return this.options.fileLocker},g.prototype.destroy=function(){this.options=void 0},g.prototype.getCurrentAccess=function(){return this.options.currentAccess},g.prototype.hasAccess=function(t){var e=this.getCurrentAccess();return!e||f(e,t)},g.prototype.getSpecReportCurrentAccess=function(){return this.options.specReportCurrentAccess},g.prototype.hasAccessOnSpecReport=function(t){var e=this.getSpecReportCurrentAccess();return!e||f(e,t)},g.prototype.getTemplatePid=function(){return this.options.templatePid},g.prototype.getTemplateTitle=function(){return this.options.templateTitle},g.prototype.getTemplateName=function(){return this.options.templateName},g.prototype.getTemplateRev=function(){return this.options.templateRevision},g.prototype.getSpecReportPid=function(){return this.options.specReportPid},g.prototype.getSpecReportType=function(){return this.options.specReportType},g.prototype.getSpecReportTypeSymbolicName=function(){return this.options.specReportTypeSymbolicName},g.prototype.getSpecReportName=function(){return this.options.specReportName},g.prototype.isReportCheckedIn=function(){return this.options.isReportCheckedIn},g.prototype.getSpecReportRevision=function(){return this.options.specReportRevision},g.prototype.getSpecReportMaturity=function(){return this.options.specReportMaturity},g.prototype.getSpecReportMaturityActualName=function(){return this.options.specReportMaturityActualName},g.prototype.getSpecReportCreator=function(){return this.options.specReportCreator},g.prototype.getSpecReportDescription=function(){return this.options.specReportDescription},g.prototype.getSpecReportTitle=function(){return""===this.options.specReportTitle?this.options.techSpecTitle:this.options.specReportTitle},g.prototype.getType=function(){return this.options.grid["ds6w:type"]},g.prototype.getCEStamp=function(){return this.options.cestamp},g.prototype.getTypeActualName=function(){return this.options.typeActualName},g.prototype.getTypeSymbolicName=function(){return this.options.typeSymbolicName},g.prototype.getOwner=function(){return this.options.creator},g.prototype.getModifedDate=function(){return this.options.lastmodified},g.prototype.getDescription=function(){return this.options.description},g.prototype.getKindOf=function(){return this.options.kindOf},g.prototype.hasBOMAdded=function(){return this.options.BOMAdded},g.prototype.setBOMAdded=function(t){return this.options.BOMAdded=t||!1},g.prototype.hasBOMConnection=function(){return this.options.childBOMConnection},g.prototype.hasMBMFConnection=function(){return this.options.childMBMFConnection},g.prototype.setBOMConnection=function(t){this.options.childBOMConnection=t||!1},g.prototype.setMBMFChildren=function(t){this.options.childMBMFConnection=t||!1},g.prototype.setKindOf=function(t){this.options.kindOf=t},g.prototype.hasMadeOf=function(){return this.options.hasMadeOf},g.prototype.setMadeOf=function(t){this.options.hasMadeOf=t||!1},g.prototype.setMaterialMismatch=function(t){this.options.hasMaterialMismatch=t||!1},g.prototype.hasMaterialMismatch=function(){return this.options.hasMaterialMismatch},g.prototype.has3DPart=function(){return this.options.is3DPart},g.prototype.set3DPart=function(t){this.options.is3DPart=t||!1},g.prototype.isEngineeringItem=function(){var t=!1;return this.getTypeActualName()===c.TYPE_VPMREFERENCE&&(t=!0),n.isPhysicalProduct(this.getTypeActualName())&&(t=!0),t},g.prototype.getRefDimension=function(){return this.options.refDimension},g.prototype.setRefDimension=function(t){this.options.refDimension=t},g.prototype.getRefQuantity=function(){return this.options.refQuantity},g.prototype.setRefQuantity=function(t){this.options.refQuantity=t},g.prototype.getRefUnit=function(){return this.options.refUnit},g.prototype.setRefUnit=function(t){this.options.refUnit=t},g.prototype.getUnitNLSLabel=function(){return this.options.unitNLSLabel},g.prototype.setUnitNLSLabel=function(t){this.options.unitNLSLabel=t},g.prototype.getCurrentPath=function(){return this.currentPath},g.prototype.setIsUnitsPresent=function(t){this.options.isUnitsPresent=t},g.prototype.isUnitsPresent=function(){return this.options.isUnitsPresent},g.prototype.refreshModel=function(t){try{if(void 0!==t.member[0]["@id"]){var e=t.member[0];if(this.options.cestamp=e.cestamp,this.options.grid["ds6w:type"]=null!=e.typedisplayName&&e.typedisplayName.includes("emxFramework")?e.typedisplayName.split(/[. ]+/).pop():e.typedisplayName,this.options.type=this.options.typeActualName=e.typeactualName,this.options.typeSymbolicName=e.symbolicTypeName,this.options.physicalid=this.options.grid.physicalid=e["@id"],this.currentPath=e["@id"],this.options.name=e.name,this.options.revision=this.options.grid["ds6wg:revision"]=e.revision,this.options.description=e.description||e.V_description||"",this.options.policy=e.policydisplayName,this.options.policyActualName=e.policyactualName,this.options.maturity=e.maturitydisplayName||"",this.options.maturityActualName=e.maturityactualName||"",this.options.title=this.options.grid["ds6w:label"]=e.title||e.V_Name,this.options.creator=this.options.grid["ds6w:responsible"]=e.creator,this.options.lastmodified=e.lastmodified,this.options.currentAccess=e.access||"",this.options.filename=e.filename||"",this.options.fileLocker=e.fileLocker||"",this.options.isFileLocked=e.isFileLocked||"",this.options.organization=e.organization,this.options.project=e.project,this.options.originated=e.originated,e.specificationReport){var o=e.specificationReport.member[0];if(this.options.specReportPid=o["@id"]||"",this.options.specReportType=o.typedisplayName||"",this.options.specReportTypeActualName=o.typeactualName||"",this.options.specReportTypeSymbolicName=o.symbolicTypeName||"",this.options.specReportName=o.name||"",this.options.specReportRevision=o.revision||"",this.options.specReportMaturity=o.maturitydisplayName||"",this.options.specReportMaturityActualName=o.maturityactualName||"",this.options.specReportCreator=o.creator||"",this.options.specReportDescription=o.description||"",this.options.specReportTitle=o.title||"",this.options.specReportCurrentAccess=o.access||"",this.options.isReportCheckedIn=!(!o.hasReport||""===o.hasReport||null===o.hasReport||void 0===o.hasReport),o.template){var i=o.template.member[0];this.options.templatePid=i["@id"],this.options.templateTitle=i.title||"",this.options.templateName=i.name||"",this.options.templateRevision=i.revision||"",this.options.templateState=i.maturityactualName||"",this.options.templateDescription=i.description||""}}}}catch(t){throw new Error(t)}},g.prototype.syncModel=function(t){var e=this,i=e.getTypeActualName()||e.queryType,r=e.getType()||e.typeName,c=e.getID()||e.id;e.updateThumbnail_async(c);var u=t,d=[];if(n.isPhysicalProduct(i)){var y=new o(function(t,o){(new p).fetchItemData([c],["ds6wg:EnterpriseExtension.V_PartNumber","ds6w:kind"]).then(function(o){if(o){var i=o.results[0].attributes,n=[];if(i){for(var s=0;s<i.length;s++){var r=i[s];"ds6wg:EnterpriseExtension.V_PartNumber"===r.name&&e.setPartNumber(r.value),"ds6w:kind"===r.name&&(r.value&&(n.push(r.value),console.log("kindOfArr "+n)),"3DPart"==r.value&&e.set3DPart(!0))}e.setKindOf(n),t()}}}).catch(function(t){console.log(t),o(t)})});d.push(y);let t=new o((t,o)=>{(new m).listMaterials(c).then(o=>{if(o.success&&o.result){let i=o.result;i&&0!==Object.keys(i).length&&e.setMadeOf(!0),t()}}).catch(o=>{e.setMadeOf(!1),t()})});if(d.push(t),!n.isFormulatedProduct(i)){let t=new o((t,o)=>{(async()=>{try{let o=await h.getReferenceList(c);e.setReferenceNameList(o),t()}catch(e){return t()}})()});d.push(t)}}if(n.isPhyProd(i)){let t=new o((t,o)=>{(new m).checkMaterialMismatch(c).then(o=>{if(o.success&&o.result){let i=o.result;i&&"true"===i.hasMaterialMismatch&&e.setMaterialMismatch(!0),t()}})});d.push(t)}if(n.isFormulatedProduct(i)){let t=new o((t,o)=>{(new m).getRefBatchSize(c).then(o=>{200===o.statusCode&&(e.setRefDimension(o.result.dimension),e.setRefQuantity(o.result.quantity),e.setRefUnit(o.result.units),e.setUnitNLSLabel(o.result.unitNLSLabel),e.setIsUnitsPresent(o.result.unitsPresent),t())}).catch(e=>{console.log(e),t()})});d.push(t)}var f=new o(function(t,o){var n=new s({id:c}),p={mask:"SpecAndRelatedInfoObjectMask",typeActual:i,typeName:r};n.get(p).then(function(o){e.refreshModel(o),t()}).catch(function(t){console.log(t),o(t)})});d.push(f);var g=new o(function(t,o){var i=new a;i.getChangeControlledForanItem(c).then(function(o){if(o&&o[c]){var n=o[c].id;if(void 0===n||""===n)return void t();i.getChangeActionForAnID(n).then(function(i){i&&(o[c].current=i),e.setChangeValues(o[c]),t()},function(i){e.setChangeValues(o[c]),console.log("Error found while fetching state NLS of CA: "+i),t()})}}).catch(function(e){console.error(e),t()})});if(d.push(g),n.isPhysicalProduct(i)){var R=new o(t=>{(new p).expand([c],r,!0).then(o=>{let i=!1,n=!1;o&&o.results.length>2&&(i=!0,o.results.forEach(t=>{t.path&&t.path.length>=3&&(n=!0)})),e.setBOMConnection(n),t()}).catch(e=>{console.log(e),t()})});d.push(R)}if(n.isPhyProd(i)&&!this.hasBOMConnection()&&!n.isFormulatedProduct(i)){var N=function(){let t=!1;return new o(function(o,i){e.MBMFService=new l,e.MBMFService.getMBMFInfo(c).then(function(i){if(i&&i.success&&200===i.statusCode&&i.result){let e=i.result.MadeFromConnections;e&&e.length>0&&(t=!0)}e.setMBMFChildren(t),o()}).catch(function(t){console.log(t),i()})})}();d.push(N)}console.log(d),o.all(d).then(function(t){u&&u.onComplete&&u.onComplete("succesful")}).catch(function(t){var e;console.log(t),e=t,u&&u.onFailure&&u.onFailure(e)})},g.prototype.setChangeValues=function(t){"none"===t?this.options.isChangeControlled=!1:"any"===t?this.options.isChangeControlled=!0:t&&(this.options.isChangeControlled=!0,this.options.changeActionName=t.name,this.options.changeActionState=t.current,this.options.changeActionId=t.id,this.options.changeActionType=t.type,this.options.changeActionTitle=t.synopsis)},g.prototype.setPartNumber=function(t){this.options.partNumber=t,this.options.grid["ds6wg:EnterpriseExtension.V_PartNumber"]=t},g.prototype.getPartNumber=function(t){return this.options.partNumber},g.prototype.getID=function(){return this.options.physicalid},g.prototype.getUuid=function(){return this.getID()},g.prototype.getName=function(){return this.options.name},g.prototype.getRevision=function(){return this.options.revision},g.prototype.getPolicy=function(){return this.options.policy},g.prototype.getPolicyActualName=function(){return this.options.policyActualName},g.prototype.getOrganization=function(){return this.options.organization},g.prototype.getCollabSpace=function(){return this.options.project},g.prototype.getOriginatedDate=function(){return this.options.originated},g.prototype.getThumbnail=function(){return this.options.thumbnail||this.getDefaultThumbnail()},g.prototype.getMaturity=function(){return this.options.maturity},g.prototype.getMaturityActualName=function(){return this.options.maturityActualName},g.prototype.getTitle=function(){return this.options.title},g.prototype.isChangeControlled=function(){return this.options.isChangeControlled},g.prototype.getChangeActionId=function(){return this.options.changeActionId},g.prototype.getChangeActionTitle=function(){return this.options.changeActionTitle},g.prototype.getChangeActionName=function(){return this.options.changeActionName},g.prototype.getChangeActionState=function(){return this.options.changeActionState},g.prototype.getChangeActionType=function(){return this.options.changeActionType},g.prototype.getLabel=function(){return this.getTitle()},g.prototype.getDisplayName=function(){return this.getLabel()+" "+this.getRevision()},g.prototype.isBeyondInWork=function(){return this.getMaturityActualName().toUpperCase()!==c.MATURITY_IN_WORK&&this.getMaturityActualName().toUpperCase()!==c.MATURITY_PRIVATE},g.prototype.getReferenceNameList=function(){return this.options.referenceList},g.prototype.setReferenceNameList=function(t){this.options.referenceList=t},g.prototype.getDefaultThumbnail=function(){return n.isFormulatedProduct(this.type)||n.isFormulatedProduct(this.typeName)?i.getIconFormXSR("FormulatedProduct"):n.isRawMaterial(this.type)||n.isRawMaterial(this.typeName)?i.getIconFormXSR("RawMaterial"):n.isPhysicalProduct(this.getTypeActualName())?i.getIconFormXSR("product"):i.getIconFormXSR("document")},g.prototype.setThumbnail=function(t){t&&t.startsWith("http")?this.options.thumbnail=t:this.options.thumbnail=t?r.get3DSpaceURL().concat(t):this.getDefaultThumbnail()},g.prototype.setTypeIcon=function(t){var e=function(t){return t&&t.startsWith("http")?t:t&&t.indexOf("/")>=0?r.get3DSpaceURL().concat(t):t?r.get3DSpaceURL().concat("/snresources/images/icons/small/"+t+".png"):void 0};if(Array.isArray(t))for(var o=0;o<t.length;o++){var i=e(t[o]);i&&-1===this.options.grid.typeIcon.indexOf(i)&&(this.options.grid.typeIcon.push(i),this.options.icons.push(i))}else{var n=e(t);n&&-1===this.options.grid.typeIcon.indexOf(n)&&(this.options.grid.typeIcon.push(n),this.options.icons.push(n))}},g.prototype.detachPersistedFilter=function(){(this.options._NGFilterId||this.options._NGFilterName)&&(this.options._NGFilterId=void 0,this.options._NGFilterName=void 0,this.options._persistedFilter=void 0)},g.prototype.getNGFilterPref=function(){return this.options._NGFilterName?"["+this.options._NGFilterName+"]":""},g.prototype.setPersistedNGFilterContext=function(t){this.options._transientFilter=t,this.options._NGFilterName=t?t.filterName:null},g.prototype.nextGenFilterMultiExpand=function(t){var e=this,n={appCore:e.appCore,parentNodeModel:e};return e.service=new u(n),new o(function(o,n){if(t){var s=UWA.clone(t.CVQuery);if(s.union.expand&&s.union.expand.length>=1){for(var p=[],a=0;a<s.union.expand.length;a++){var c=s.union.expand[a];c.volume_filter?p.push(a):(c.expand_iter="1",c.no_type_filter_rel=["XCADBaseDependency"],c["q.iterative_filter_query_bo"]='[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"')}for(var u=0;u<p.length;u++)s.union.expand.splice(p[u],1)}var l=JSON.parse(y);s.select_bo=l.mandatorySixwForBO,s.select_rel=l.mandatorySixwForRel,s.compute_select_bo=l.compute_select_bo,s.label=i.getRequestLabel();var h=l.multiexpand;r.multiExpand(s,t,h).then(function(t){e.service._processExpandResponse(t,o,n)}).catch(function(t){console.error(t),n(t)})}else console.log("Reset Applied Filter"),o()}).catch(function(t){reject(t)})},g.prototype.getNGFilterId=function(){return this.options._NGFilterId},g.prototype.getNGFilterName=function(){var t=widget.getValue(c.XSR_FILTER_PREF);return t&&this.id===t.filterRootIds[0]?t.filterName:this.options._NGFilterName},g.prototype.updateThumbnail_async=function(t){var e,o,i=this,n=t||this.getID();n&&(new p).fetchItemDataByFederated([n]).then(function(t){if(t){var n=t.results?t.results[0]:void 0,s=n?n.attributes:void 0;if(s)for(var r=!1,p=!1,a=0;a<s.length&&("preview_url"!==s[a].name&&"thumbnail_2d"!==s[a].name||(e=s[a].value,r=!0),"type_icon_url"===s[a].name&&(o=s[a].value,p=!0),!p||!r);a++);}i.setThumbnail(e),i.setTypeIcon(o),i.options.grid.isMEI&&i.updateMEIThumbnailImages()}).catch(function(t){console.log(t)})},g.prototype.updateMEIThumbnailImages=function(t){this.setThumbnail("/webapps/ENOXComponentQualification/assets/icons/MEI-Thumbnail.png")},g.prototype.getMaturityBasedDisabledCommands=function(){switch(this.getMaturity()){case"Released":case"Obsolete":return["add","removeitem","deleteItem","addMaterial","removeMaterial","addMBMFItem"];default:return[]}},g.prototype.getChildren=function(){return d.getChildrenOfTrueRoot()},g.prototype.getNodesById=function(t){return d.getNodesByIdForSpecTreeModel()},g});