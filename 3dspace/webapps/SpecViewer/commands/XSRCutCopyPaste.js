define("DS/SpecViewer/commands/XSRCutCopyPaste",["DS/SpecViewer/commands/CommandBase","DS/XSRCommonComponents/utils/XSpecLocalStorage","DS/PlatformAPI/PlatformAPI","DS/XSRCommonComponents/utils/ContextManager","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/XSRMask","i18n!DS/SpecViewer/assets/nls/SpecViewer"],function(t,e,o,n,s,r,i,a,c){"use strict";return t.extend({init:function(t){t=UWA.extend(t,{isAsynchronous:!1}),this._parent(t)},execute:function(){"UPSAuthCut"===this.options.ID||"UPSAuthCopy"===this.options.ID?this.addItemsInClipboard(this.options.context):"UPSAuthPaste"===this.options.ID&&this.pasteItems(this.options.context)},pasteItems:function(t){let s=this;var r=t.getSelectedNodes(),p=e.getItem("clipboard");if(p&&0!=p.length){for(var l=p.startsWith("CX")?"CutPaste":"CopyPaste",u=[],d=[],m=(p=p.substring(3)).split(","),C=0;C<m.length;C++)d.push(m[C].split("|"));for(var S=0;S<d.length;S++){var g=d[S];u.push(g)}var h=u.map(function(t){return Array.isArray(t)&&t.length>2?t[1]:null}).filter(function(t){return null!==t});if(""==d[0])return e.removeItem("clipboard"),void s.notify("error",c.clipboard_empty);var f=[];Array.isArray(r)&&r.length>=1&&r[0].getID()!==t.contextId?r.forEach(function(t){f.push(t.getCurrentPath().split("/"))}):f.push([t.contextId]);var y={children:u,parents:f,mode:l,commit:!0};a.maskLoader(s.context.maskContainer,c.ExecutingLoader),require(["DS/UPSCommands/commands/UPSAuthCmdCutCopyPaste"],function(r){new r({context:n.getContext(),ID:"InsertExisting"}).execute({mode:l,internal_call:!0,data:y,onSuccess:function(n){s.context.appCore.specViewerModelEvents.publish({event:"xsr-toolbar-switch-fetch-mode-to-author"});let r=s.context.gridView.currentTabKey;if(Array.isArray(n)){let p=t.getSelectedNodes();Array.isArray(p)&&p.length>=1&&p[0].getID()!==t.contextId?p.forEach(function(t){"noExpandState"===t._expandState&&t.setState({state:"expanded"}),"expandState"!==t._expandState?(t.collapse(),t.expand()):t.expand()}):1==p.length&&p[0].getID()===t.contextId&&o.publish(i.PASTE_ROOT_NODES+"-"+r,n),"CutPaste"===l&&(o.publish(i.REMOVE_CUT_INSTANCES+"-"+r,h),e.removeItem("clipboard"),o.publish(i.EVENT_PASTE_DISABLE+"-"+r)),s.notify("success",c.paste_success),a.unmaskLoader(s.context.maskContainer)}},onFailure:function(t){a.unmaskLoader(s.context.maskContainer),t&&t.messages?s.notify("error",t.messages.toString()):void 0!==t&&s.notify("error",c.paste_error)}})}),s.context.gridView.gridManager.grid.unselectAll()}else s.notify("error",c.clipboard_empty)},addItemsInClipboard:function(t){let n=this;var r="UPSAuthCopy"===n.options.ID?["CP"]:["CX"],a=t.getSelectedNodes(),p=t.contextId;let l,u;if(Array.isArray(a)){l=0;for(var d=0;d<a.length;d++)s.isPhysicalProduct(a[d].getType())?r.push(p+"|"+a[d].getRelationID()+"|"+a[d].getID()):l++;l>0&&n.notify("error",c.cutCopy_notSupported)}else r.push(a.getParent().getID()+"|"+a.getRelationID()+"|"+a.getID());e.setItem("clipboard",r.toString()),o.publish(i.EVENT_PASTE_ENABLE+"-"+n.context.gridView.currentTabKey),1===a.length&&0===l?(u=c.replace(c.get("singleCopyOrCutOperation"),{title:a[0].getTitle(),opeartion:"CP"===r[0]?c.operationCopy:c.operationCut}),n.notify("success",u)):(u=c.replace(c.get("multipleCopyOrCutOperation"),{count:Math.abs(a.length-l),opeartionName:"CP"===r[0]?c.label_Copy:c.label_Cut}),n.notify("success",u)),t.gridView.getTreeDocument().unselectAll()},notify:function(t,e){r.displayNotification({eventID:t,msg:e})}})});