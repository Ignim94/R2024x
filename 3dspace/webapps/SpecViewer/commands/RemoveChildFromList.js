define("DS/SpecViewer/commands/RemoveChildFromList",["DS/SpecViewer/commands/CommandBase","UWA/Promise","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/createform/view/NewDialog","DS/XSRCommonComponents/utils/ItemServiceProvider","DS/XSRCommonComponents/utils/DocumentServiceProvider","DS/ENOMadeFromUX/service/MBMFServiceProvider","DS/SpecViewer/MEI/service/MEIServiceProvider","DS/SpecViewer/MAT/service/MATServiceProvider","i18n!DS/SpecViewer/assets/nls/SpecViewer"],function(e,t,n,r,i,o,s,a,c,l,u,d,m,v){"use strict";return e.extend({init:function(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute:function(){var e=this,t=arguments[0]._selectedItems;this.modelEvents=t[0].appCore.specViewerModelEvents,this.currentTabKey=t[0].currentTabKey;var i,a,c=t[0].appCore.specRouteManager;this.currentSpecViewerContextID=c?c.getCurrentSpecViewerId():void 0,this.contextParentID=t[0].contextParentID,this.itemIds=[],this.nodes=[],Array.isArray(t)&&t.forEach(function(t){t.getID();void 0!==t.getParentInstanceIds&&e.itemIds.push({id:t.getParentInstanceIds()}),e.nodes.push(t),i=t.getTypeActualName(),a=t.getAttributeValue("parentType")||i}),o.isXSRAuthoredType(i)||o.isXSRAuthoredType(a)?s.isPhysicalProduct(i)&&(this.currentTabKey===n.MEI_TAB||void 0!==t[0].getMEIInterface&&t[0].getMEIInterface()===n.MEI_INTERFACE)?this.removeMEIs(t):s.isPhysicalProduct(i)&&t[0].getMadeFrom()?this.removeMBMFs(t):s.isPhysicalProduct(i)?this.unparentEngItem():o.isCoreMaterial(i)?this.removeCoreMaterial(t):o.isCoveringMaterial(i)?this.removeCoveringMaterial(t):this.removeDocument():r.displayNotification({eventID:"error",msg:v.InvalidOperation})},unparentEngItem:function(){var e=this;this.confirmationBox(function(){if(e.itemIds.length>0){for(var t=[],n=0;n<e.itemIds.length;n++)for(var r in e.itemIds[n])if(e.itemIds[n].hasOwnProperty(r)){var i=e.itemIds[n][r];Array.isArray(i)?t.push.apply(t,i):t.push(i)}var o={instances:t};new c({isChangeControlled:!0}).removeInstance(o).then(function(t){if(t&&"success"===t.status){e._notifySuccess();var n=e.currentTabKey?"grid-list-remove-node-successful-"+e.currentTabKey:"grid-list-remove-node-successful";e.modelEvents.publish({event:n,data:e.nodes})}else e._notifyError()}).catch(function(t){e.modelEvents.publish({event:"xsr-current-tab-refresh"}),e._notifyError()})}})},_notifyError:function(e){var t=v.RemoveMutipleFailed;this.singleItem&&1==this.nodes.length&&(t=v.replace(v.get("RemoveItemFailed"),{title:this.nodes[0].getTitle()})),r.displayNotification({eventID:"error",msg:e||t}),i.unmaskLoader(widget.body)},_notifySuccess:function(e){var t=v.RemoveMutipleSuccess;if(e)t=e;else{this.singleItem&&(t=v.replace(v.get("RemoveItemSuccess"),{title:this.nodes[0].getTitle()}))}r.displayNotification({eventID:"success",msg:t}),i.unmaskLoader(widget.body)},removeMBMFs:function(e){this.items=[];var t=[];if(e&&e.length>0){var n=this;this.confirmationBox(function(){for(var r,i={},o=[],s=0;s<e.length;s++){var a=(r=e[s]).options.grid.madeFromRelationId.replaceAll(/"/g,"");o.push(a)}i.refData=o,function(r,i){(new u).disconnectMBMFItem(r.getParentId(),r.getID(),i).then(function(i){if(i&&i.success){t.push(i.statusCode);for(var o=n.currentTabKey?"grid-list-remove-node-successful-"+n.currentTabKey:"grid-list-remove-node-successful",s=0;s<e.length;s++)n.modelEvents.publish({event:o,data:e[s]});if(r.parentNodeModel&&"function"==typeof r.parentNodeModel.getMBMFChild&&r.parentNodeModel.getMBMFChild()&&r.parentNodeModel.setMBMFChild(null),t.length===e.length&&1===e.length)n._notifySuccess();else{var a=v.RemoveMutipleSuccess;n._notifySuccess(a)}}else n._notifyError()}).catch(function(e){var t="";e&&!e.success&&e.result&&(t=e.result.message),n.modelEvents.publish({event:"xsr-current-tab-refresh"}),n._notifyError(t)})}(r,i)},{actionFor:"removeMBMF"})}},removeMEIs:function(e){this.items=[];var t=[];if(e&&e.length>0){var n=this;this.confirmationBox(function(r){for(var i=function(r,i){(new d).removeInstance(i).then(function(i){if(i&&i.success){t.push(i.statusCode);var o=n.currentTabKey?"grid-list-remove-node-successful-"+n.currentTabKey:"grid-list-remove-node-successful";if(n.modelEvents.publish({event:o,data:r}),t.length===e.length&&e.length>1){var s=v.RemoveMutipleSuccess;n._notifySuccess(s),n.modelEvents.publish({event:"xsr-current-tab-refresh"})}else t.length===e.length&&1===e.length&&(n._notifySuccess(s),n.modelEvents.publish({event:"xsr-current-tab-refresh"}))}else n._notifyError()}).catch(function(e){var t="";e&&!e.success&&(t=e.error),n.modelEvents.publish({event:"xsr-current-tab-refresh"}),n._notifyError(t)})},o=0;o<e.length;o++){var s=e[o],a=e[o].getEqQualId();e.length,i(s,a)}})}},removeDocument:function(){var e=this;this.confirmationBox(function(){if(e.nodes&&e.nodes.length>0){for(var n,r,i,o,s=[],a=[],c=function(t,n){n.push(t.getID());var r=t.getParentId();return r&&r.split(","),r=e.contextParentID?e.contextParentID:e.currentSpecViewerContextID},u=0;u<e.nodes.length;u++){var d=e.nodes[u].getRelationshipType();i?i===d?n=c(e.nodes[u],s):(r=c(e.nodes[u],a),o=d):(n=c(e.nodes[u],s),i=d)}var m=[];s.length>0&&m.push((new l).detachDocuments(s,n,i)),a.length>0&&m.push((new l).detachDocuments(a,r,o)),t.all(m).then(function(t){var n=!1;if(t)for(var r=0;r<t.length;r++)for(var i=t[r],o=0;o<i.length;o++)i[o].success||(n=!0);if(n)e._notifyError();else{var s=e.currentTabKey?"grid-list-remove-node-successful-"+e.currentTabKey:"grid-list-remove-node-successful";e.modelEvents.publish({event:s,data:e.nodes}),e._notifySuccess()}}).catch(function(t){console.log(t),e._notifyError()})}})},removeCoreMaterial:function(e){var t=this;if(e&&e.length>0){if([n.MATURITY_RELEASED,n.MATURITY_OBSOLETE].includes(e[0].parentModel.getMaturityActualName().toUpperCase()))return void r.displayNotification({eventID:"error",msg:v.ERROR_Material_REMOVE_Editable_State});if(e[0].parentModel.options.changeActionId&&!o._isWorkUnderEnabled())return void r.displayNotification({eventID:"error",msg:v.ERROR_MAT_ERROR_REMOVE+"\n"+v.ERROR_MAT_ENABLE_WORK_UNDER});var i=function(){let n=e[0].parentModel.getID();(new m).removeInstance(n).then(function(n){if(n){var r=t.currentTabKey?"grid-list-remove-node-successful-"+t.currentTabKey:"grid-list-remove-node-successful";t.modelEvents.publish({event:r,data:e}),t._notifySuccess(n.result.message)}else t._notifyError(n.msg)}).catch(function(e){t.modelEvents.publish({event:"xsr-current-tab-refresh"}),t._notifyError(e.msg)})}}this.confirmationBox(i,{actionFor:"removeCoreMaterial"})},removeCoveringMaterial:function(e){var t=this;if(e&&e.length>0){if([n.MATURITY_RELEASED,n.MATURITY_OBSOLETE].includes(e[0].parentModel.getMaturityActualName().toUpperCase()))return void r.displayNotification({eventID:"error",msg:v.ERROR_Material_REMOVE_Editable_State});if(e[0].parentModel.options.changeActionId&&!o._isWorkUnderEnabled())return void r.displayNotification({eventID:"error",msg:v.ERROR_MAT_ERROR_REMOVE+"\n"+v.ERROR_MAT_ENABLE_WORK_UNDER});if(e[0].getAttributeValue("isPartial"))return void r.displayNotification({eventID:"error",msg:v.ERROR_PARTIAL_MATERIAL_DETACH});var i=function(){let n=e[0].parentModel.getID(),r=e[0].getID();(new m).removeCoveringMaterials(n,[r]).then(function(n){if(n){var r=t.currentTabKey?"grid-list-remove-node-successful-"+t.currentTabKey:"grid-list-remove-node-successful";t.modelEvents.publish({event:r,data:e}),t._notifySuccess(n.result.message)}else t._notifyError(n.msg)}).catch(function(e){t.modelEvents.publish({event:"xsr-current-tab-refresh"}),t._notifyError(e.msg)})}}this.confirmationBox(i,{actionFor:"removeCoreMaterial"})},confirmationBox:function(e,t){var n={};n.Title=v.label_Detach;var r=new UWA.Element("div",{class:"Delete-Dialog-Option-Container"}),o=new UWA.Element("div",{class:"xsr-delete-message-icon"}).inject(r),s=(new UWA.Element("span",{class:"xsr-delete_warning_icon fonticon fonticon-attention fonticon-1x"}).inject(o),new UWA.Element("p",{class:"message-container",html:v.RemoveConfirm}).inject(o));n.Content=r;if(1===this.nodes.length){n.Title=v.label_Detach+" "+this.nodes[0].getTitle();var c=v.replace(v.get("RemoveItemConfirm"),{title:this.nodes[0].getTitle()});"function"==typeof this.nodes[0].IsComputed&&this.nodes[0].IsComputed()&&(c=v.replace(v.get("DetachSpecilizedMakeFrom"),{title:this.nodes[0].getTitle()})),s.innerHTML=c,this.singleItem=!0}if(t&&t.actionFor){let e="";switch(t.actionFor){case"removeMBMF":e=v.Message_removeMBMF;break;case"removeCoreMaterial":e=v.Message_removeCoreMaterial}UWA.Element("div",{class:"xsr-delete-extra-info",html:e}).inject(r)}n.position={at:"center",my:"center"},n.width=450,n.height=150,n.renderTo=widget.body,n.RemoveApplyButton=!0,n.OKLabel=v.label_Detach;var l=new a(n);l.render(),l._dialog.buttons.Ok.disabled=!1,l.listenTo(l,"EVENT_CLICK_SPEC_OK",function(){i.maskLoader(widget.body,v.RemovingProgress),l.closeDialog(),e()})}})});