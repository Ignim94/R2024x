define("DS/SpecViewer/commands/DeleteChildFormList",["DS/Controls/TooltipModel","DS/SpecViewer/commands/CommandBase","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/createform/view/NewDialog","DS/XSRCommonComponents/utils/ItemServiceProvider","DS/XSRCommonComponents/utils/DocumentServiceProvider","DS/SpecViewer/MEI/service/MEIServiceProvider","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/SpecViewer/assets/nls/SpecViewer","DS/XSRCommonComponents/createform/view/NewForm","css!DS/SpecViewer/commands/DeleteChildFormList.css"],function(e,t,s,i,n,o,r,a,l,c,u,d,h){"use strict";return t.extend({init:function(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute:function(){var e=this,t=arguments[0]._selectedItems;this.appCore=t[0].appCore,this.modelEvents=t[0].appCore.specViewerModelEvents,this.basicModelEvents=t[0].appCore.basicModelEvents,this.currentTabKey=t[0].currentTabKey;var n,o,r=this.appCore.specRouteManager;this.currentSpecViewerContextID=r.getCurrentSpecViewerId(),this.contextParentID=t[0].contextParentID,this.nodes=[],this.container=t[0].container?t[0].container:widget.body,this.fireDeleteCallback=t[0].fireDeleteCallback,Array.isArray(t)&&t.forEach(function(t){n=t.getTypeActualName(),o=t.getAttributeValue("parentType")||n,e.nodes.push(t)}),c.isXSRAuthoredType(n)||c.isXSRAuthoredType(o)?u.isPhysicalProduct(n)&&(this.currentTabKey===s.MEI_TAB||void 0!==t[0].getMEIInterface&&t[0].getMEIInterface()===s.MEI_INTERFACE)?(this.showWholeStructure=!1,this.deleteMEIs(t)):u.isPhysicalProduct(n)?(this.showWholeStructure=!1,this.deleteEngItem()):u.isPerformanceSpecChar(n)?this.modelEvents.publish({event:s.TRIGGER_DELETE_SPEC_CHAR,data:t}):(this.showWholeStructure=!1,this.deleteDocument()):i.displayNotification({eventID:"error",msg:d.InvalidOperation})},deleteFormToolbar:function(e){if(e){this.showWholeStructure=!!e.hasPhysicalProduct,this.nodes=e.ids,this.container=widget.body,this.basicModelEvents=e.appCore.basicModelEvents;var t=this;this.confirmationBox(function(e){var i=function(i,n){var o=i.id,r=i.type;i.rowStatus&&t._statusdeleting(i.rowStatus),u.isPhysicalProduct(r)?t._deleteEngItem(o,e,i,n):t.currentTabKey===s.MEI_TAB||void 0!==i.getMEIInterface&&i.getMEIInterface()===s.MEI_INTERFACE?t.deleteMEI(meiNode,eqQualId):t._deleteDoc(o,i,n)},o=t.nodes;o.length>1?o=t.deleteDialog(o):n.maskLoader(t.container,d.DeletingProgess);for(var r=0;r<o.length;r++)i(o[r],r===o.length-1)})}},_notifyError:function(e){e=e||d.DeleteMutipleFailed;this.singleItem&&(e=d.replace(d.get("DeleteItemFailed"),{title:this.nodes[0].getTitle()})),i.displayNotification({eventID:"error",msg:e}),n.unmaskLoader(widget.body)},_notifySuccess:function(e){var t=d.DeleteMutipleSuccess;if(e)t=e;else{this.singleItem&&(t=d.replace(d.get("DeleteItemSuccess"),{title:this.nodes[0].getTitle()}))}i.displayNotification({eventID:"success",msg:t}),n.unmaskLoader(widget.body)},deleteMEIs:function(e){this.items=[];var t=[];if(this.currentTabKey||(this.currentTabKey=s.MEI_TAB),e&&e.length>0){var i=this;this.confirmationBox(function(s){i.nodes,i.nodes;for(var n=0;n<e.length;n++)t.push(e[n].getID());!function(t){(new l).deleteInstance(t).then(function(t){if(t&&200===t.status){var s=i.currentTabKey?"grid-list-remove-node-successful-"+i.currentTabKey:"grid-list-remove-node-successful";if(i.modelEvents.publish({event:s,data:e}),e.length>1){var n=d.DeleteMutipleSuccess;i._notifySuccess(n)}else 1===e.length&&(i.singleItem=!0,i._notifySuccess())}else i._notifyError()}).catch(function(e){i.modelEvents.publish({event:"xsr-current-tab-refresh"}),i._notifyError(e.message)})}(t)})}},deleteEngItem:function(){if(this.items=[],this.repeatingItems=[],this.nodes&&this.nodes.length>0){var e=this;this.confirmationBox(function(t){var i=e.nodes,o=function(i,n){var o=i.getParentId?i.getParentId():void 0,a=i.getID();if(o){var l=i.getParentInstanceIds();l.length;var c={instances:l};i.rowStatus&&e._statusdeleting(i.rowStatus);let o=!1;e.items.some(function(e){if(e.getID()==a)return o=!0}),o?e.repeatingItems.push({object:i,msg:"",iSuccess:!1,isLastItem:n}):e.items.push(i),new r({isChangeControlled:!0}).removeInstance(c).then(function(r){if(r&&"success"===r.status)o||e._deleteEngItem(a,t,i,n,function(t){var o=t.report[0].error;"."!=o.charAt(o.length-1)&&(o+=".");let r,l=widget.getValue(s.PERSISTENCY_BOM_VIEW);r=l?i.getTitle():i.getInstanceTitle();var c=d.replace(d.get("RemovedFromList"),{title:r}),u=o?o+"\n"+c:d.replace(d.get("DeleteFailedinList"),{title:i.getTitle()});for(let t=0;t<e.repeatingItems.length;t++){let s=e.repeatingItems[t];if(s.object.getID()===a){let t;t=l?s.object.getTitle():s.object.getInstanceTitle();let i=d.replace(d.get("RemovedFromList"),{title:t});s.msg=o?o+"\n"+i:d.replace(d.get("DeleteFailedinList"),{title:s.object.getTitle()}),s.iSuccess=!1,e._updateStatus(s.object,s.msg,s.iSuccess,s.isLastItem),e._removeNode(s.object)}}e._updateStatus(i,u,!1,n),e._removeNode(i)});else{var l=d.replace(d.get("DeleteFailure"),{title:i.getTitle()});e._updateStatus(i,l,!1,n)}}).catch(function(t){var s=d.replace(d.get("DeleteFailure"),{title:i.getTitle()});e._updateStatus(i,s,!1,n)})}else e._deleteEngItem(a,t,i,n)},a=e.nodes;a.length>1?a=e.deleteDialog(i):n.maskLoader(e.container,d.DeletingProgess);for(var l=0;l<a.length;l++){var c=a[l],u=l===a.length-1;void 0!==c.getMadeFrom&&c.getMadeFrom()?e._deleteEngItem(c.getID(),!1,c,u):o(c,u)}})}},_deleteDoc:function(e,t,s,o){var r=this,l=function(e){if(o)o.call(e);else{if(!e.success&&e.error)return"."!=(n=e.error).charAt(n.length-1)&&(n+="."),i.displayNotification({eventID:"error",msg:n}),void r._updateStatus(t,n,!1,s);var n=d.FailedToDelete;r._updateStatus(t,n,!1,s)}};(new a).deleteDocument(e).then(function(i){i&&i.success?(r._updateStatus(t,d.Message_Success,!0,s),r._removeNode(t),r._postSuccessActions(e)):l(i)}).catch(function(e){l(e),n.unmaskLoader(r.container)})},_postSuccessActions:function(e){this.fireDeleteCallback&&"function"==typeof this.fireDeleteCallback&&this.fireDeleteCallback(),this.basicModelEvents&&this.basicModelEvents.publish({event:"xsr-item-delete-success",data:e})},_deleteEngItem:function(e,t,i,o,a){var l=this,c=function(e){if(a)a.call(this,e);else{var t=e.report&&e.report[0].error?e.report[0].error:d.FailedToDelete;"."!=t.charAt(t.length-1)&&(t+="."),l._updateStatus(i,t,!1,o)}};new r({isChangeControlled:!0}).deleteItem({itemId:e,isWholeStructure:t}).then(function(t){if(t&&"success"===t.status&&0==t.report){if(l.repeatingItems&&l.repeatingItems.length>0)for(let t=0;t<l.repeatingItems.length;t++){let s=l.repeatingItems[t];s.object.getID()==e&&(s.msg=d.Message_Success,s.iSuccess=!0,l._updateStatus(s.object,d.Message_Success,s.iSuccess=!0,s.isLastItem),l._removeNode(s.object))}void 0===l.currentTabKey?l._updateStatus(i,d.Message_Success,!0,o):l.currentTabKey!==s.BOM_TAB&&l.currentTabKey!==s.FORMULABOM_TAB||l._updateStatus(i,d.replace(d.get("DeleteChild"),{title:i.getTitle()}),!0,o),l._removeNode(i),l._postSuccessActions(e)}else c(t)}).catch(function(e){c(e),n.unmaskLoader(l.container)})},_removeNode:function(e){if(this.currentTabKey){var t=this.currentTabKey?"grid-list-remove-node-successful-"+this.currentTabKey:"grid-list-remove-node-successful";this.modelEvents.publish({event:t,data:e})}},_statusdeleting:function(e){UWA.createElement("div",{class:"deleting-icon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash"}).inject(e),UWA.createElement("div",{class:"mass-deleting-msg",text:d.DeletingProgess}).inject(e)},deleteDocument:function(){var e=this;this.confirmationBox(function(){var t=e.nodes,s=function(t,s){var n=t.getParentId?t.getParentId():void 0,o=n?n.split(","):[];n=e.contextParentID?e.contextParentID:e.currentSpecViewerContextID;var r=t.getID();if(n){t.rowStatus&&e._statusdeleting(t.rowStatus);var l=function(o){if(!this.success&&this.error){var l=this.error;return l&&i.displayNotification({eventID:"error",msg:l}),void e._updateStatus(t,l,!1,s)}if(n){var c=t.getRelationshipType?t.getRelationshipType():void 0;if(!c){var u=d.replace(d.get("DeleteFailure"),{title:t.getTitle()});return void e._updateStatus(t,u,!1,s)}(new a).removeDocument(r,n,c).then(function(i){if(i&&i.success){var n=o?d.replace(d.get("DeleteFailedHasReference"),{title:t.getTitle()}):d.replace(d.get("DeleteFailedinList"),{title:t.getTitle()});e._updateStatus(t,n,!1,s),e._removeNode(t)}else{var r=d.replace(d.get("DeleteFailure"),{title:t.getTitle()});e._updateStatus(t,r,!1,s)}}).catch(function(i){var n=d.replace(d.get("DeleteFailure"),{title:t.getTitle()});e._updateStatus(t,n,!1,s)})}};o.length>1?l(!0):e._deleteDoc(r,t,s,l)}else e._deleteDoc(r,t,s)},o=e.nodes;o.length>1?o=e.deleteDialog(t):n.maskLoader(e.container,d.DeletingProgess);for(var r=0;r<o.length;r++)s(o[r],r===o.length-1)})},_updateStatus:function(t,s,o,r){if(t&&t.rowStatus){t.rowStatus.empty();UWA.createElement("div",{class:"xsr-delete-message",text:s}).inject(t.rowStatus);t.rowStatus.tooltipInfos=new e({shortHelp:s,allowUnsafeHTMLShortHelp:!1}),o?(t.rowStatus.addClassName("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"),t.rowStatus.getParent().addClassName("xsr-mass-delete-row-success")):(t.rowStatus.addClassName("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-close"),t.rowStatus.getParent().addClassName("xsr-mass-delete-row-failed")),delete t.rowStatus}else i.displayNotification({eventID:o?"success":"error",msg:s});r&&this.dialog&&this.dialog.dispatchEvent("XSR_SHOW_DIALOG_CLOSE_BUTTON",{Close:!0}),n.unmaskLoader(this.container)},confirmationBox:function(e){var t,s={},i=new UWA.Element("div",{class:"Delete-Dialog-Option-Container"}),n=new UWA.Element("div",{class:"xsr-delete-message-icon"}).inject(i),r=(new UWA.Element("span",{class:"xsr-delete_warning_icon fonticon fonticon-attention fonticon-2x"}).inject(n),new UWA.Element("p",{class:"message-container",html:d.DeleteMultipleItemsConfirm}).inject(n));if(s.position={at:"center",my:"center"},s.Title=d.label_Delete,s.Content=i,this.nodes&&1===this.nodes.length){var a=this.nodes[0].getTitle?this.nodes[0].getTitle():this.nodes[0].title;s.Title=d.label_Delete+" "+a,r.innerHTML=d.replace(d.get("DeleteItemConfirm"),{title:a}),"function"==typeof this.nodes[0].IsComputed&&this.nodes[0].IsComputed()&&(r.innerHTML=d.replace(d.get("DeleteSpecilizedMakeFrom"),{title:a})),s.Content=i,u.isRawMaterial(this.nodes[0].type)&&(this.showWholeStructure=!1)}if(this.showWholeStructure&&1===this.nodes.length){var l={fields:[{name:"wholeStructure",type:"toggle",toggleType:"checkbox",toggleLabel:d.DeleteStructureMessage}]};(t=new h(l)).render(),t.inject(i),s.Content=i}s.width=450,s.height=150,s.renderTo=this.container,s.RemoveApplyButton=!0,s.OKLabel=d.label_Button_Ok;var c=new o(s);c.render(),c._dialog.buttons.Ok.disabled=!1,c.listenTo(c,"EVENT_CLICK_SPEC_OK",function(){document.querySelector('.Delete-Dialog-Option-Container input[type="checkbox"]');var s=!!t&&t.formfieldControls.wholeStructure.inputfield.checkFlag;c.closeDialog(),e(s)})},deleteDialog:function(t){if(t){var s=Object.create(t),i=UWA.createElement("div",{class:"xsr-mass-delete-operation"}),n=UWA.createElement("div",{class:"xsr-mass-delete-header-section"}).inject(i);UWA.createElement("div",{class:"xsr-mass-delete-header mass-delete-title",text:d.label_Title}).inject(n),UWA.createElement("div",{class:"xsr-mass-delete-header mass-delete-status",text:d.label_Status}).inject(n);for(var r=0;r<s.length;r++){var a=s[r],l=UWA.createElement("div",{class:"xsr-mass-delete-rows-section"}).inject(i),c=a.getTitle?a.getTitle():a.title;UWA.createElement("div",{class:"xsr-mass-delete-row mass-delete-title",text:c}).inject(l).tooltipInfos=new e({shortHelp:c,allowUnsafeHTMLShortHelp:!1}),a.rowStatus=UWA.createElement("div",{class:"xsr-mass-delete-row mass-delete-status",text:""}).inject(l)}var u=Math.round(34*s.length)>widget.getView().height?widget.getView().height-100:Math.round(34*s.length)+150,h={position:{at:"center",my:"center"}};return h.Title=d.DeleteStatus,h.Content=i,h.width=450,h.height=u,h.renderTo=this.container,h.NoButtons=!0,h.closeButtonFlag=!1,this.dialog=new o(h),this.dialog.render(),s}}})});