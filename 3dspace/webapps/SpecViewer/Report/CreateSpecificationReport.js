define("DS/SpecViewer/Report/CreateSpecificationReport",["UWA/Core","UWA/Class","DS/Controls/TooltipModel","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/createform/view/NewDialog","DS/XSRCommonComponents/createform/view/NewForm","DS/XSRCommonComponents/utils/DocumentServiceProvider","DS/XSRCommonComponents/utils/XInfraRequestUtil","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Notification","i18n!DS/SpecViewer/assets/nls/SpecViewer"],function(e,t,o,i,n,a,l,r,s,m,p){"use strict";return t.extend({loadCreateForm:function(e){var t=this,l=function(e){i.unmaskLoader(t.target),m.clearNotifications(),m.displayNotification({eventID:"error",msg:e.message}),t.modelEvents.publish({event:"xsr-current-tab-refresh"})},d=function(e){var o;t.specPid=e.specPid,(o=t.specModel).syncModel({onComplete:function(){i.unmaskLoader(t.target),t.specPid=o.getSpecReportPid(),t.genReportValue?t.modelEvents.publish({event:s.EVENT_REGENERATE_REPORT,data:t.specPid}):t.modelEvents.publish({event:"xsr-current-tab-refresh"})},onFailure:function(){i.unmaskLoader(t.target),t.modelEvents.publish({event:"xsr-current-tab-refresh"})}})},c=function(){t.formFields.Template.inputfield.tooltipInfos=new o({shortHelp:"",allowUnsafeHTMLShortHelp:!1})},f=function(e){t.formFields.Template.inputfield.tooltipInfos=new o({shortHelp:e.description,allowUnsafeHTMLShortHelp:!1})},u={data:{itemPid:t.itemPid}};new r({id:"getCreateSpecReportForm"}).invoke(u).then(function(e){var o,s=e,u={clearButton:!1,disabled:!1,toggleLabel:p.GenerateReleaseSnapshot,name:"ReportCheckBox",type:"toggle",toggleType:"checkbox"};if(s.fields.push(u),t.newForm=new a(s).render(),t.formFields=t.newForm.formfieldControls,t.templateListInfo=e.templateInfo,e.templateInfo.length>0){var g=!!(o=t.formFields.Template)&&(1==o.inputfield.fieldoptions.elementsList.length?(o.inputfield.value=t.templateListInfo[0].valueItem,f(t.templateListInfo[0]),!0):void 0),v=(t.target.getBoundingClientRect(),{});v.Title=p.NewSpecification,v.Content=t.newForm.container,v.width=550,v.height=150,v.renderTo=widget.body,v.RemoveApplyButton=!0,v.OKLabel=p.label_Button_Ok,v.position={at:"center",my:"center"},t.dialog=new n(v),t.dialog.destroyPrevDialog(),t.dialog.render(),g&&t.dialog.dispatchEvent("CONTAINS_DIRTY_FIELD",{hasDirtyField:!1}),t.newForm.listenTo(t.newForm,"CONTAINS_DIRTY_FIELD",function(e){t.dialog.dispatchEvent("CONTAINS_DIRTY_FIELD",e)}),t.newForm.listenTo(t.newForm,"EVENT_TYPE_CHANGE",function(e){"Template"==e.field&&function(){var e=t.formFields.Template.inputfield.value;for(var o in void 0===e&&c(),t.templateListInfo)t.templateListInfo.hasOwnProperty(o)&&e==t.templateListInfo[o].valueItem&&f(t.templateListInfo[o])}()}),t.dialog.listenTo(t.dialog,"EVENT_CLICK_SPEC_OK",function(e){t.templateId=t.formFields.Template.inputfield.value,t.genReportValue=t.formFields.ReportCheckBox.inputfield.checkFlag;var o={data:{itemPid:t.itemPid,template:t.templateId}};t.dialog.closeDialog();var n=t.itemTitle,a=p.replace(p.get("CreatingSpecificationLoader"),{title:n});t.removePreviewMsg(),i.maskLoader(t.target,a),new r({id:"SpecificationReport"}).create(o).then(function(e){d(e)}).catch(l.bind(this))})}else{var C=p.replace(p.get("NoTemplateForItem"),{type_name:t.itemDisplayType});m.clearNotifications(),m.displayNotification({eventID:"info",msg:C})}}.bind(this)).catch(l.bind(this))}})});