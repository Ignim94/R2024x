define("DS/PLMNewLibraryActive/PLMNewLibraryActiveController",["DS/ClassificationsFacet/PLMNewCommomCmpUXController","DS/ClassificationsFacet/service/PLMNewCommonWebService","i18n!DS/LibraryActive/assets/nls/LibraryActive","DS/LibraryActive/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/LibraryActive/service/LibraryActiveWebService","DS/LibraryActive/LibraryActive","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/Controls/TooltipModel","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/LibraryEditor/service/LibraryEditorWebService","DS/ClassificationProp/utils/ClassifPropControl","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,a,s,i,o,n,l,r,c,d,u,p,m,f){let C=!1;return e.extend({name:"PLMNewLibraryActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_nodesData:{},_isResetInProgress:!1,_subBookmarkExpand:{},_favoriteSection:s.TYPE_FAVORITES_SECTION,_allSection:s.TYPE_LIBRARIES_SECTION,_supportedTypesForDropAtFindIn:["General Class"],_classPathMap:new Map,_attributeMap:new Map,_classUsageMap:new Map,_parentOptions:null,_parentInitMethod:null,_classNameMap:new Map,init:function(e){this.plmNewContextProvider=e.securityContext,this._nodesData={},this.PLMNewCommonWebService=Object.assign({},t),this.PLMNewCommonWebService.getSearchQuery=function(){if(e.multiSelectionComponent&&e.multiSelectionComponent.rootLibraries){var t=e.multiSelectionComponent.rootLibraries;if(Array.isArray(t)&&t.length>0){var a="";return t.forEach(function(e){a=a?a+" OR "+e:e}),"physicalid: ("+a+') AND flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:("types/General Class")'},this.PLMNewCommonWebService.navigatePathRelArray=function(){return["Subclass"]},this.PLMNewCommonWebService.getType_filter_bo=function(){return["General Library","General Class"]},this.PLMNewCommonWebService.generateSearchQuery=function(e,t){return'(flattenedtaxonomies:("types/General Library" OR "types/General Class")) AND (label: *'+e+"*)"+(t?' AND NOT physicalid: "'+t+'"':"")},this.PLMNewCommonWebService.getLabel=function(e){return"IPClass-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},this.PLMNewCommonWebService.getRefineSearch=function(){var e=m.getSearchQueryFilter();return e?{"ds6w:what/ds6w:status":[{object:"Classification.Active",type:"string",field:"internal"}],"ds6w:what/ds6w:classificationUsage":[{object:e,type:"string",field:"internal"}]}:{"ds6w:what/ds6w:status":[{object:"Classification.Active",type:"string",field:"internal"}]}},this.PLMNewCommonWebService.getSpecific_source_parameter=function(e,t){return{"3dspace":{search_in_context:{expand:{root_physicalid:e,expand_iter:t?"-1":"1",type_filter_bo:["General Library","General Class"]}}}}},this._parent(e),this._parentOptions=e,this._parentInitMethod=this._parent},_getWebServiceRef:function(){return this.PLMNewCommonWebService},_getIcon:function(e){var t="Definition";if(!e)return{iconName:"library-class"};t=e.classUsage||e["ds6w:classificationUsage"];var a="";return"General Class"==e.type||"General Class"==e["ds6w:type"]||"General Class"==e.plmType?(a={iconName:"library-class"},"Definition"==t&&(a={iconName:"library-class-filled"})):"General Library"!=e.type&&"General Library"!=e["ds6w:type"]&&"General Library"!=e.plmType||(a={iconName:"library"},"Standard"==t&&(a={iconName:"library-lined"})),a},couldBeValid:function(e){e&&e.getID&&e.getID();if(e&&e.getType){if(e.getType())return"General Class"===e.getType();if("General Class"===e.plmType)return!0}return!1},_getComponentName:function(){return a.name_Section_AllLibraries},_autoCompleteName:function(){return a.name_Section_AllLibraries},_getAutocomplete:function(e){return this.autocompleteLibrary},couldBeSelected:function(e){return!!["General Class"].includes(e)},_autocompleteComponent:function(e){return this.autocompleteLibrary=this.createAutocompleteComponent(this._getComponentName(),[],e,this.browseAssociations.bind(this,!0,!0)),this.autocompleteLibrary},saveRespectiveAssociations:function(e,t,a){return new Promise(function(s,i){const o=[];o.push(new Promise(function(s,i){n.performMultiClassify({data:{Classifications:t,ItemsToClassify:[e]},plmNewContextProvider:a,onComplete:function(e){e&&e.failedIds.length>0&&s("fail"),s(e)},onFailure:function(e,t){s("fail")}})})),Promise.all(o).then(function(e){s(e)}).catch(()=>{console.log("Issue with the Save Classification")})})},onClickSelector:function(){var e=this;widget&&widget.addEvent("onLoad",function(e){C=!1}),C||(e.libraryActiveActionBar=new l({multiSelectionComponent:{withClassify:!0,launchDialog:!0,componentTitle:a.multiSelectionComponent.PLMNewLibraryWidgetName,OKButtonLabel:a.multiSelectionComponent.PLMNewbutton_OK,immersiveFrame:null},popOverDialogProperties:{width:250,height:350,minHeight:250,modalFlag:!0,minWidth:400,icon:"none"},dialogButtons:!0,selectionMode:"DefaultMulti",favoriteButton:!0,handleClassification:!0,isRootSelectable:!0,isClassifyMultiEveDispatch:!0,isonSetActiveEveDispatch:!1,container:widget.body,widgetName:a.multiSelectionComponent.PLMNewLibraryWidgetName}),e.libraryActiveActionBar.addEvent("onClassifyMultiple",function(t){var a=t.nodeData,s=[];e.autoComplete.selectedItems&&e.autoComplete.selectedItems.length?e.autoComplete.selectedItems.forEach(e=>{s.push(e.id)}):s=[];var i=[];a.forEach(function(t){s.includes(t.getID())||i.push(t.getID()),t.updateOptions({label:t.options.label,subLabel:u.loading,icon:[t.options.icons]}),t._options&&t._options.classUsage&&(e._classUsageMap.set(t.getID(),t._options.classUsage),e.classifPropertiesUI.setClassUsage(e.getClassUsage())),C=!1}),i.length&&e.PLMNewCommonWebService.getClassPaths({id:i,plmNewContextProvider:e.plmNewContextProvider,onComplete:function(t){const s=e.PLMNewCommonWebService.constructPath(t,"idPathMap");console.log(s),a.forEach(t=>{e._classPathMap.set(t.id,s.get(t.id)),e._classNameMap.set(t.id,t.options.label),e.classifPropertiesUI.setClassPath(e.getClassPath())}),m.getInformationPanel()?(e._isResetInProgress=!0,e.addContents({classId:i}).then(function(t){a.forEach(a=>{if(s.has(a.id)&&t.successIds.includes(a.id)){a.updateOptions({tooltip:new d({title:a.options.label,shortHelp:s.get(a.id),mouseRelativePosition:!0}),value:{subLabel:s.get(a.id)}}),e.autoComplete._model.prepareUpdate();let t=e.insertInAutocomplete(e._getAutocomplete(),a);e._nodesData[a.id]=t,e.autoComplete._model.pushUpdate();var i=e.autoComplete._model.getChildren().length;e.autoComplete._model.getNthRoot(i-1).select()}}),e._isResetInProgress=!1})):a.forEach(t=>{if(s.has(t.id)){t.updateOptions({tooltip:new d({title:t.options.label,shortHelp:s.get(t.id),mouseRelativePosition:!0}),value:{subLabel:s.get(t.id)}}),e.autoComplete._model.prepareUpdate();let i=e.insertInAutocomplete(e._getAutocomplete(),t);e._nodesData[t.id]=i,e.autoComplete._model.pushUpdate();var a=e.autoComplete._model.getChildren().length;e.autoComplete._model.getNthRoot(a-1).select()}})},onFailure:function(e){console.error(e)}}),t.handleUI()}),e.libraryActiveActionBar.nestedMenuInContext.addEvent("onSelectorCancel",function(e){C=!1}),C=!0)},getAdditionalNodesAtInit:async function(e,t,a){let s=this;return t&&new Promise((e,i)=>{p.fetchExistingClassesAndAttributes({objectId:a,informationPanelContext:s.plmNewContextProvider,onComplete:function(a){if(a){let i=JSON.parse(a),o=[];i.length>0&&(i.forEach((e,t)=>{o.push(e.id),s._classNameMap.set(e.id,e.label)}),s.PLMNewCommonWebService.getClassPaths({id:o,plmNewContextProvider:s.plmNewContextProvider,onComplete:function(a){const o=s.PLMNewCommonWebService.constructPath(a,"idPathMap");let n=[];i.forEach(e=>{let t={...e};t.icons=[{iconName:s._getIcon(t).iconName,fontIconFamily:1}],t.plmType=e.type,t.id=e.id,s._attributeMap.set(e.id,{attribute:e.attribute,isExisting:!0}),s._classUsageMap.set(e.id,e.classUsage),n.push(t)}),s._classPathMap=o,"function"==typeof s.getAttribute&&(s.classifPropertiesUI.setClassPath(s.getClassPath()),s.classifPropertiesUI.setExistingClassAttributes(s.getAttribute()),s.classifPropertiesUI.setClassUsage(s.getClassUsage()),s.classifPropertiesUI.setIsInformationPanel(t)),e(n)},onFailure:function(e){console.log("================",e)}}))}},onFailure:function(e){console.log("================",e)}})})},getAttributesandClassPathsForExistingClasses:function(){return{_attributeMap:this._attributeMap,_classPathMap:this._classPathMap}},setClassPathForSearchData:function(e){console.log("data===",e),e.results.forEach(e=>{const t=e.attributes.find(e=>"physicalid"===e.name),a=e.attributes.find(e=>"ds6w:classificationUsage"===e.name||"ds6w:what/ds6w:classificationUsage"===e.name);a&&this._classUsageMap.set(t.value,a.value)})},saveNodes:function(e){this._nodesData[e.id]=e},isResetInProgress:function(e){return this._isResetInProgress},isConfirmModel:function(e){return this._nodesData.accordianData=e,!0},removeContents:function(e,t){var a=this,s=[];e.accordianData=a._nodesData.accordianData;var i=a._nodesData;delete i.accordianData;for(let e in i)s.push(i[e]);function o(e,s){if(s);else if(e.accordianData){var i=e.accordianData;1==i.removedIds.length?t.nodeHandler(i.removedIds[0],i.isNodeAdded,i.selectedIdsLabelMap.get(i.removedIds[0])):t.multiNodeHandler(i.removedIds,i.isNodeAdded,i.selectedIdsLabelMap)}e.classId.forEach(t=>{a._attributeMap.delete(t),a._classUsageMap.delete(t),a._classPathMap.delete(t);var s=a._classNameMap.get(t);p.removecontent({pid:t,IDs:e.IDs,informationPanelContext:a.plmNewContextProvider,onComplete:function(e){JSON.parse(e).failedCount?(f.displayNotification({title:u.replace(u.declassificationFailureMesaageTitle,{classname:s}),subtitle:u.declassificationFailureMesaageSubTitle,className:"error"}),a._isProcessing=!1,a._parentInitMethod({...a._parentOptions,isRefreshContainer:!0})):JSON.parse(e)&&"failure"==JSON.parse(e).status?(f.displayNotification({title:u.replace(u.declassificationFailureMesaageTitle,{classame:s}),subtitle:u.declassificationFailureMesaageSubTitle,className:"error"}),a._isProcessing=!1,a._parentInitMethod({...a._parentOptions,isRefreshContainer:!0})):(delete a._nodesData[t],f.displayNotification({message:u.replace(u.declassificationSuccessMesaage,{number:1,classname:s}),className:"success"}))},onFailure:function(e){f.displayNotification({title:u.replace(u.declassificationFailureMesaageTitle,{classname:s}),subtitle:u.declassificationFailureMesaageSubTitle,className:"error"}),a._isProcessing=!1,a._parentInitMethod({...a._parentOptions,isRefreshContainer:!0})}})})}function n(e){a._isResetInProgress=!0,a.autoComplete._model.prepareUpdate();var t=a.autoComplete._model.getChildren().length;for(let e=0;e<t;e++)a.autoComplete._model.prepareUpdate(),a.autoComplete._model.nodeModel_reset=!0,a.autoComplete._model.removeRoot(0),a.autoComplete._model.pushUpdate(),a.autoComplete._model.nodeModel_reset=!1;a.autoComplete._model.nodeModel_reset=!0,a.autoComplete.selectedItems=[],a.autoComplete._model.nodeModel_reset=!1,a.previousPresentIds=[],e.forEach(e=>{a.autoComplete._model.prepareUpdate(),a.insertInAutocomplete(a._getAutocomplete(),e),a.autoComplete._model.pushUpdate();var t=a.autoComplete._model.getChildren().length;t>0&&a.autoComplete._model.getNthRoot(t-1).select()}),a._isResetInProgress=!1}p.checkModifyAccessOnItems({objectIds:e.IDs,informationPanelContext:a.plmNewContextProvider,onComplete:function(t){var i=e.classId.length,l=t?JSON.parse(t):void 0,r={deleteButtonLabel:u.titleRemove,titleLabel:u.titleRemove+" - "+a._nodesData[e.classId[0]].label,warningMessage:u.replace(u.msg_removeSingleClass,{className:a._nodesData[e.classId[0]].label})};i>1&&(r.warningMessage=u.replace(u.msg_removeMultipleClass,{number:i}),r.titleLabel=u.titleRemove+" - "+i+" "+u.classes),l.unModifiableIds.length>0&&(r.confirmationBoxText=u.confirmationMsg,r.moreInfo=u.msg_removeContentMoreInfo,r.enableConfirmationBox=!0),c.confirmDialog(r,o,n,e,s)},onFailure:function(e){console.log(" Error while fetching modify access on items")}})},setClassUsageForSearchData:function(e){this._classPathMap=e},addContents:function(e){let t=this;return new Promise(a=>{n.performMultiClassify({data:{Classifications:e.classId,ItemsToClassify:[m.getObjectId()]},plmNewContextProvider:()=>t.plmNewContextProvider,onComplete:function(e){e&&(e.failedIds.length>0&&(1==e.failedIds.length?f.displayNotification({title:u.classificationFailureMesaageTitle,subtitle:u.replace(u.classificationFailureMesaageSubTitle,{classname:t._classNameMap.get(e.failedIds[0])}),className:"error"}):f.displayNotification({title:u.replace(u.classificationFailureForMultipleClassesMessageTitle,{classCount:e.failedIds.length}),subtitle:u.classificationFailureForMultipleClassesMessageSubTitle,className:"error"})),e.successIds.length>0&&(1==e.successIds.length?f.displayNotification({subtitle:u.replace(u.classificationSuccessMesaage,{classname:t._classNameMap.get(e.successIds[0])}),className:"success"}):f.displayNotification({subtitle:u.replace(u.classificationSuccessForMultipleClassesMessageSubTitle,{classCount:e.successIds.length}),className:"success"})),e.successIds.forEach((e,a)=>{p.getClassificationAttributesForClassifedObjectOnOneClass({data:{classId:e,objId:m.getObjectId()},informationPanelContext:t.plmNewContextProvider,onComplete:function(e){var t=JSON.parse(e);t&&m.getClassifPropController()&&m.getClassifPropController().onAttributesLoad(t[0])},onFailure:function(e){t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0}),reject(e)}})}),a(e))},onFailure:function(e){f.displayNotification({title:u.classificationFailureMesaageTitle,subtitle:u.replace(u.classificationFailureMesaageSubTitle,{classname:name}),className:"error"}),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0}),reject(e)}})})},getClassUsage:function(){return this._classUsageMap},getClassPath:function(){return this._classPathMap},getAttribute:function(){return this._attributeMap},updateAttribute:function(e){return p.updateAttributesFromInformationPanel(e)},getClassificationAttributesForAClass:function(e){return p.getClassificationAttributesForClassifedObjectOnOneClass({data:e.payload,onComplete:function(e){return e},onFailure:function(e){console.log(e)}})},setClassNameForSearchData:function(e){e.results.forEach(e=>{const t=e.attributes.find(e=>"physicalid"===e.name),a=e.attributes.find(e=>"ds6w:label"===e.name);a&&this._classNameMap.set(t.value,a.value)})}})});