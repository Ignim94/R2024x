define("DS/PPWDataGridView/RecursiveGrouping",["UWA/Core","UWA/Class","DS/PPWTreeNodeModel/PPWTreeNodeModel","i18n!DS/PPWDataGridView/assets/nls/ContextualMenu.json"],function(e,t,o,n){"use strict";var r,i,s,a,l,u,d,c,p,g,h,f,_,v,G,C,y,D,I;return r=function(t){var n=!1;return e.is(t)&&e.is(t.getNodeSource,"function")&&(n=t.getNodeSource()===o.NODE_SOURCE.GROUPING),n},i=function(e){return-1===e.getNodeDepth()?e.getNodeDepth():e.getParents().filter(e=>!r(e)).length},s=function(t,o){this.rowGroupingOptions.maxDepth=e.is(o)&&o?void 0:t,this.rowGroupingOptions.depth=function(e){return e>=this}.bind(t)},a=function(t,o){var n;switch(t){case"date":n=e.is(o,"number")?o:Date.parse(o),isNaN(n)||(o=new Date(n));break;case"number":case"integer":case"float":n=isNaN(o)?o:parseFloat(o);break;case"boolean":n=o;break;default:n=o}return n},l=function(t){var o,n;o=(t=t||{}).onDropCell,t.onDropCell=function(t,n){var i,s,l,u=this;if(e.is(n.nodeModel)&&r(n.nodeModel))i=n.nodeModel,s=i.getProperty(),l=i.getIdentifier(),(Array.isArray(n.droppedNodes)?n.droppedNodes:[]).forEach(t=>{var o,n,r,i,d,c,p;o=u.layout,n=t._getRowID(),r=o.getColumnIndex(s),n&&r&&(i=o.getCellIDFromCoordinates({rowID:n,columnID:r}))&&u.getCellEditableState(i)&&(c=o.getColumnSetCellValue(s),e.is(c,"function")&&(d=u.getCellInfosAt(i),p=o._getCellTypeRepresentation({cellID:i,columnID:r,rowID:n,cellModel:l,nodeModel:t}),c.call(u,d,a(p,l))))});else{if(!e.is(o,"function"))return!1;o.call(this,t,n)}},n=t.onDragOverCell,t.onDragOverCell=function(t,o){var i,s,a=this,l=!0;return e.is(o.nodeModel)&&r(o.nodeModel)?(i=o.nodeModel,s=i.getProperty(),(Array.isArray(o.draggedNodes)?o.draggedNodes:[]).some(e=>{var t,o,n,r,i=!0;return t=a.layout,o=e._getRowID(),n=t.getColumnIndex(s),o&&n&&(r=t.getCellIDFromCoordinates({rowID:o,columnID:n}))&&(i=a.getCellEditableState(r)),!i})||t.preventDefault(),l=!0):l=!e.is(n,"function")||n.call(this,t,o),l}},u=function(t){var o,n;n=function(t){var n,i,s,a="N/A",l=function(t){var o,n,i=t.getChildren();if(Array.isArray(i)&&i.length>0)for(o=0;o<i.length&&(n=r(i[o])?l(i[o]):i[o],!e.is(n));o++);return n};return e.is(t)&&r(t)?(n=t.getProperty(),i=l(t),e.is(i)&&(s=t.getOriginalChildrenInformation().notHiddenNotFilteredChildrenCount,a=e.is(o,"function")?o.call(this,t):this.layout.getColumnOptionValue(n,"text")+": "+t.getIdentifier()+" ("+s+")")):e.is(o,"function")&&(a=o.call(this,t)),a},(t=t||{}).rowGroupingOptions=t.rowGroupingOptions||{},o=t.rowGroupingOptions.getGroupingNodeLabel,t.rowGroupingOptions.getGroupingNodeLabel=n.bind(this._dgv)},d=function(){return[{iconName:"group"}]},c=function(t,o,n){return e.is(n)||(n=t.getTreeDocument()._getTrueRoot()),-1===n._propertiesToGroup.indexOf(o)?"unselected":"selected"},D=function(t,n){e.is(n)||(n=this.getTreeDocument()._getTrueRoot()),n._propertiesToGroup=t,n.getAllDescendants().forEach(function(e){e.getNodeSource()===o.NODE_SOURCE.MODEL&&(e._propertiesToGroup=t)})},p=function(t,n){var r,a,l;if(l=e.is(n)?n:this.getTreeDocument()._getTrueRoot(),e.is(this._rowModel)){"clear"===t?(l._propertiesToGroup=[],r="clear"):((a=l._propertiesToGroup.indexOf(t))>-1?l._propertiesToGroup.splice(a,1):l._propertiesToGroup.push(t),r=-1===a?"add":"remove"),l.getAllDescendants().forEach(function(e){var n;if(e.getNodeSource()===o.NODE_SOURCE.MODEL)switch(n=e._propertiesToGroup.indexOf(t),r){case"add":n<0&&e._propertiesToGroup.push(t);break;case"remove":(n=e._propertiesToGroup.indexOf(t))>-1&&e._propertiesToGroup.splice(n,1);break;case"clear":e._propertiesToGroup=[]}});let u=e.is(n)?i(n)+1:0;s.call(this,u,"clear"===t),this.groupRows({dataIndexesToGroup:l._propertiesToGroup,ignorePreprocess:!0})}},g=function(t){var o=t.target;if(!r(o)&&Array.isArray(o._propertiesToGroup)&&o._propertiesToGroup.length>0&&!(o._appliedGroupingProps.join(",")===o._propertiesToGroup.join(","))){let t=e.is(o)?i(o)+1:0;s.call(this,t),this.groupRows({dataIndexesToGroup:o._propertiesToGroup,ignorePreprocess:!0})}},y=function(t){var o,n,r,a,l=this,u={},d=Number.MAX_VALUE;t.forEach(function(t){o=t.target,n=t.nodeModel,e.is(o)&&e.is(n)&&Array.isArray(o._propertiesToGroup)&&o._propertiesToGroup.length>0&&(a=i(o),t.event&&"update"===t.event?(r=Array.from(o._propertiesToGroup),s.call(l,a+1),o._propertiesToGroup=[],l.groupRows({dataIndexesToGroup:[],ignorePreprocess:!0}),o._propertiesToGroup=r,l.groupRows({dataIndexesToGroup:r,ignorePreprocess:!0})):(u[a]=u[a]||[],u[a].push(o),a<d&&(d=a)))}),Object.keys(u).length>0&&(s.call(l,parseInt(d)+1),l.reapplyRowGrouping())},h=function e(t){let o=t.getParent();return r(o)?e(o):o},f=function(){this._transactionCounter++,null===this._transactions&&(this._transactions=[])},_=function(){var e;this._transactionCounter--,0===this._transactionCounter&&(e=Array.isArray(this._transactions)?Array.from(this._transactions):[],this._transactions=null,e.length>0&&y.call(this._dgv,e))},v=function(t){var o,n,i;n=t.target,i=t.data.nodeModel,e.is(i)&&!r(i)&&(!e.is(n)||r(n)||n._isGroupingInProgress||Array.isArray(n._propertiesToGroup)&&n._propertiesToGroup.length>0&&(i._propertiesToGroup=e.clone(n._propertiesToGroup),o={event:"addchild",target:n,nodeModel:i},Array.isArray(this._transactions)?this._transactions.push(o):y.call(this._dgv,[o])))},G=function(t){var o,n,i;n=t.target,i=t.data.nodeModel,e.is(n)&&r(n)&&e.is(i)&&!r(i)&&((n=h(n))._isGroupingInProgress||(o={event:"remove",target:n,nodeModel:i},Array.isArray(this._transactions)?this._transactions.push(o):y.call(this._dgv,[o])))},C=function(t){var o,n,i,s,a,l;n=(i=t.data.nodeModel).getParent(),e.is(n)&&r(n)&&e.is(i)&&!r(i)&&(s=t.data.attributes,(l=e.is(s)?Object.keys(s):[]).length>0&&(n=h(n),a=Array.isArray(n._propertiesToGroup)?e.clone(n._propertiesToGroup):[],l.some(e=>{var t="label"===e?"tree":e;return a.indexOf(t)>-1})&&(o={event:"update",target:n,nodeModel:i},Array.isArray(this._transactions)?this._transactions.push(o):y.call(this._dgv,[o]))))},I=function(){var e;(e=this._dgv.getTreeDocument()).addEventListener("prepareUpdate",f.bind(this)),e.addEventListener("addChild",v.bind(this)),e.addEventListener("removeChild",G.bind(this)),e.addEventListener("pushUpdate",_.bind(this)),e.addEventListener("nodeModelUpdate",C.bind(this))},t.extend({_dgv:null,_transactions:null,_transactionCounter:0,init:function(e){this._dgv=e,this._transactions=null,this._transactionCounter=0},handlePreCreation:function(t){var o;return o=t.rowGroupingOptions||{},o=e.merge(o,{getGroupingNodeIcons:d}),t.rowGroupingOptions=o,u.call(this,t),l.call(this,t),t},handlePostCreation:function(e){this._dgv.getTreeDocument().addEventListener("postExpand",g.bind(this._dgv)),I.call(this),e&&Array.isArray(e.initialDataIndecesToGroup)&&e.initialDataIndecesToGroup.length>0&&this._dgv.groupRows({dataIndexesToGroup:e.initialDataIndecesToGroup})},getGroupByMenu:function(t){var o,r,i=this,s=[],a=[],l=t.collectionView,u=!1,d=t.cellInfos.nodeModel,g=function(t){var o=d;return e.is(o)||(o=i._dgv.getTreeDocument()._getTrueRoot()),o._propertiesToGroup.indexOf(t.dataIndex)>-1},h=function(e){let t=c(l,e.dataIndex,d);return"selected"!==t||u||(u=!0),{type:"CheckItem",title:e.text,state:t,icon:e.icon,action:{callback:p.bind(l,e.dataIndex,d)}}};return o=l.layout.getLeafColumns(),function(){var e;for(r=0;r<o.length;r++)(e=o[l.layout._orderedColumnsIndexes[r]]).groupableFlag&&(!1!==e.visibleFlag||e.defaultGroupable||g(e))&&a.push(h(e))}(),a.length>0&&(s.push({type:"PushItem",id:"GroupBy",title:n.get("ContextualMenu.GroupBy.Title"),icon:{iconName:"group",fontIconFamily:WUXManagedFontIcons.Font3DS},submenu:a}),u&&s.push({type:"PushItem",id:"ClearGroupBy",title:n.get("ContextualMenu.ClearGroupBy.Title"),icon:{iconName:"group-delete",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:p.bind(l,"clear",d)}})),s},doGroupingPreprocess:function(e){var t=e.dataIndexesToGroup,o=e.nodeModel;return D.call(this._dgv,t,o)}})}),define("DS/PPWDataGridView/ColumnFiltering",["UWA/Core","UWA/Class"],function(e,t){"use strict";var o,n,r,i,s;return o=function(){this._transactionCounter++,null===this._transactions&&(this._transactions=[])},n=function(){var e;this._transactionCounter--,0===this._transactionCounter&&(e=Array.isArray(this._transactions)?Array.from(this._transactions):[],this._transactions=null,e.length>0&&i.call(this._dgv,e))},r=function(t,o){var n;n=o.data.nodeModel,e.is(n)&&(Array.isArray(this._transactions)?this._transactions.push(t):i.call(this._dgv,t))},i=function(t){var o,n,r;n=(o=this.getTreeDocument()).getFilterManager(),r=n.filterModel,Object.keys(r).some(t=>e.is(r[t])&&e.is(r[t].filterModel))&&o.reapplyFilterModel()},s=function(){var e;(e=this._dgv.getTreeDocument()).addEventListener("prepareUpdate",o.bind(this)),e.addEventListener("pushUpdate",n.bind(this)),e.addEventListener("addChild",r.bind(this,"addChild")),e.addEventListener("removeChild",r.bind(this,"removeChild")),e.addEventListener("nodeModelUpdate",r.bind(this,"nodeModelUpdate"))},t.extend({_dgv:null,_transactions:null,_transactionCounter:0,init:function(e){this._dgv=e},handlePostCreation:function(){this.setFilterModel(),s.call(this)},setFilterModel:function(){var t=this,o={};this._dgv.columns.forEach(function(n){var r,i,s,a={};if(e.is(n.filterInfos)){switch(r="tree"===n.dataIndex?"label":n.dataIndex,n.filterInfos.type){case"boolean":i="string",a._isBoolean=!0;break;default:i=n.filterInfos.type}(s=n.filterInfos.options)&&(s.getCellValueForFilter&&(s.getCellValueForFilter=s.getCellValueForFilter.bind(t._dgv)),a=e.extend(a,s,!0)),o[r]={filterId:i,filterOptions:a}}}),Object.keys(o).length>0&&this._dgv.treeDocument.setFilterModel(o)}})}),define("DS/PPWDataGridView/PPWDataGridView",["UWA/Core","DS/Utilities/Dom","DS/DataGridView/DataGridView","DS/PPWDataGridView/ColumnFiltering","DS/PPWDataGridView/RecursiveGrouping","i18n!DS/PPWDataGridView/assets/nls/ContextualMenu.json"],function(e,t,o,n,r,i){"use strict";var s,a,l,u,d,c,p,g,h=["Filter","Pin","SizeColumnToFit","Hide","GroupBy"];return p=function(e){var o,n,r,i,s,a=[],l=e.collectionView,u=e.cellInfos&&-1===e.cellInfos.rowID;if(!u&&e.infos&&e.infos.target&&(u=t.firstParentWithClass(e.infos.target,"wux-layouts-header")),u)for(r=(n=l.layout).getLeafColumns(),i=0;i<r.length;i++)o=r[n._orderedColumnsIndexes[i]],s=n.getColumnVisibleFlag(o.dataIndex)?"selected":"unselected",a.push({type:"CheckItem",title:o.text,icon:o.icon,state:n.getColumnAlwaysVisibleFlag(o.dataIndex)?"disabled|"+s:s,action:{callback:function(e){var t;e&&e.context&&e.context.id&&(t=n.getColumnVisibleFlag(e.context.id),n.setColumnVisibleFlag(e.context.id,!t,{isUserInteraction:!0}))},context:{id:o.dataIndex}}});return a},l=function(e){var t,o=[];return(t=p(e)).length>0&&o.push({type:"PushItem",title:i.get("ContextualMenu.DisplayColumns.Title"),icon:{iconName:"eye",fontIconFamily:WUXManagedFontIcons.Font3DS},submenu:t}),o},a=function(e){let t,o,n=this,r=[];return e&&e.cellInfos&&-1===e.cellInfos.rowID&&e.collectionView&&(t=e.collectionView)._contextualMenuBuilder&&h.forEach(function(i){var s;"Hide"===i?o=l(e):"GroupBy"===i?o=n._recursiveGroupingHelper.getGroupByMenu(e):(s="_create"+i+"ContextualMenu",o=t._contextualMenuBuilder[s](e)),r=r.concat(o)}),r},u=function(e){var t;return e&&e.collectionView&&(t=e.collectionView.buildDefaultContextualMenu(e,{expandCollapse:!0})),t},s=function(t,o){var n=[],r=[];return function(t){var o,n=!1;return e.is(t)&&e.is(t.cellInfos)&&e.is(t.cellInfos.nodeModel)&&e.is(t.collectionView)&&(o=t.collectionView.getTreeDocument(),e.is(o)&&(n=o.isGroupingNodeModel(t.cellInfos.nodeModel))),n}(o)?r=u.call(this,o):(e.is(o.cellInfos)&&(n=-1===o.cellInfos.rowID?a.call(this,o):this._recursiveGroupingHelper.getGroupByMenu(o)),r=e.is(t,"function")&&o.collectionView?t.call(o.collectionView,o,n):n),r},d=function(t){t.filterViewOptions=t.filterViewOptions||{},t.filterViewOptions=e.merge(t.filterViewOptions,{ignoreGroupingNodes:!0}),this._recursiveGroupingHelper=new r(this),this._columnFilteringHelper=new n(this),(t=this._recursiveGroupingHelper.handlePreCreation(t)).onContextualEvent=s.bind(this,t.onContextualEvent),e.is(t.selectionBehavior)||(t.selectionBehavior={}),e.is(t.selectionBehavior.showMixedStateOnParents)||(t.selectionBehavior.showMixedStateOnParents=!0)},c=function(e){this._recursiveGroupingHelper.handlePostCreation(e),this._columnFilteringHelper.handlePostCreation()},g=function(t,o,n){var r,i,s,a,l=this;a=this.getCellInfosAt(t),e.is(a)&&a.columnID>-1&&(r=this.getTreeDocument(),i=a.nodeModel,r.isGroupingNodeModel(i)&&(o||n||r.getXSO().empty(!0),s=i.getChildren(),Array.isArray(s)&&r.withTransactionUpdate(function(){!function e(t){t.forEach(function(t){r.isGroupingNodeModel(t)?e(t.getChildren()):t.isSelected()||l.selectNodeModel(t,!0,n)})}(s)})))},o.extend({name:"PPRDataGridView",init:function(e){d.call(this,e=e||{}),this._parent(e),c.call(this,e)},groupRows:function(t){var o,n,r,i=this;if(t=t||{},r=this.getTreeDocument(),n=this.rowGroupingOptions.depth,o=!e.is(t.ignorePreprocess)||!t.ignorePreprocess,delete t.ignorePreprocess,o&&this._recursiveGroupingHelper.doGroupingPreprocess(t),e.is(n)&&Array.isArray(t.dataIndexesToGroup)&&0===t.dataIndexesToGroup.length&&(!e.is(this._rowModel._latestGroupingOptions)||Array.isArray(this._rowModel._latestGroupingOptions)&&0===this._rowModel._latestGroupingOptions.length)){let e;"function"!=typeof n&&(e=Array.isArray(n)?n:[n]).sort((e,t)=>t-e);const t=function(t){if(e){const o=e.indexOf(t);return 1===e.length&&-1===e[0]||-1!==o}return n.call(r,t)};let o=!1;(function e(n,s){if(!r.isGroupingNodeModel(n)&&t(s)){let e=n.getParents().filter(e=>!r.isGroupingNodeModel(e)),t=e.length>0?e[e.length-1]:r._getTrueRoot();Array.isArray(t._appliedGroupingProps)&&t._appliedGroupingProps.length>0&&(i._rowModel._latestGroupingOptions=Array.from(t._appliedGroupingProps),o=!0)}else if(!o){const t=n.getChildren();t&&t.forEach(t=>{e(t,s+(r.isGroupingNodeModel(t)?0:1))})}})(r._getTrueRoot(),r._getTrueRoot().getNodeDepth())}this._parent(t)},getCellEditableState:function(t){var o,n,r;return r=this.layout.getCellCoordinatesAt(t),o=this.getNodeModelAtRowID(r.rowID),n=this.getTreeDocument(),(!e.is(o)||!n.isGroupingNodeModel(o))&&this._parent(t)},selectCell:function(e,t,o,n){this._parent(e,t,o,n),g.call(this,e,t,o)}})});