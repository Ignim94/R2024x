define("DS/CfgWebAppEffectivityUX/scripts/CfgProductConfigurationColumn",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController","DS/PADUtils/PADContext","DS/EditPropWidget/constants/EditPropConstants","DS/CfgBaseUX/scripts/CfgPropertiesView","i18n!DS/CfgWebAppEffectivityUX/assets/nls/CfgEffectivityNLS"],function(e,t,i,n,o,a,l,r,s){"use strict";var c={};function d(e,t,i){if(!e.isHeader)if(e.cellModel.options.value){var n=e.cellView.reuseCellContent(t);n&&(n.innerText=e.cellModel.options.value)}else e.cellView.reuseCellContent(i)}function f(e){if(e.nodeModel)return e.cellModel?"string":"configLoading"}var u=t.singleton({_columnDataIndex:["ProductConfiguration"],_columnDef:{ProductConfiguration:{dataIndex:"ProductConfiguration",text:s.CFG_PRODUCT_CONFIGURATION_HEADER,width:180,minWidth:50,isHidden:!0,onCellRequest:function(e){d(e,"product_configuration_col_value","product_configuration_col_colloader")},xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}}},_columnDefDGV:{},setReadOnlyMode:function(t){let i=!1;e.is(t,"boolean")?i=t:e.is(t,"string")&&(i="true"===t.toLowerCase()),u._columnStateReadOnly=i},init:function(e){this._parent(e),o.init(null,"","3DDashboard")},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){n.rolesAvailable(function(t){c.ProductConfiguration=s.CFG_PRODUCT_CONFIGURATION_HEADER;var i={dataIndex:"ProductConfiguration",text:s.CFG_PRODUCT_CONFIGURATION_HEADER,width:180,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){d(e,"product_configuration_col_value","product_configuration_col_colloader")},xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},n={dataIndex:"ProductConfiguration",text:s.CFG_PRODUCT_CONFIGURATION_HEADER,width:180,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:f,customisation:{dataIndex:"ProductConfiguration",exportable:{lock:!1,value:!0},layout:{removable:!1}},getCellClassName:function(e){return e&&e.nodeModel&&" "!==e.nodeModel._options.grid.ProductConfiguration&&u&&u.InstantiatedPCInfo?"cfg-pc-col-link":"cfg-pc-col"}};!0===u._columnStateReadOnly&&(i.readOnly=!0,n.readOnly=!0),1!=t.isCHGRoleAvail&&1!=t.isCFGRoleAvail&&1!=t.isCSVRoleAvail||(u._columnDataIndex=["ProductConfiguration"],u._columnDef={ProductConfiguration:i},u._columnDefDGV={ProductConfiguration:n}),e()})}(function(){t(!0),u.InstantiatedPCInfo={}})},getName:function(){return"CfgProductConfigurationColumn"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var i=!1;return"SyncModelRefresh"!==t&&"OnSyncModel"!==t||(i=!0),void 0!==e.ProductConfiguration&&""!==e.ProductConfiguration||(i=!0),i},updateAttributes:function(t,i){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(i,"function"))throw new Error("A callback function should be defined");setTimeout(()=>{var e={pids:{},relids:{}},o=0;let a=t.relids;if(t.pids.length>0){for(n.isAdditionalConsoleLog()&&console.log("CfgProductConfigurationColumn original nodesToUpdate = "+JSON.stringify(t)),o=0;o<t.pids.length;o++)e.pids[t.pids[o]]={ProductConfiguration:" "};0==a.length&&i(e)}if(a.length>0){widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise";let a={instanceIdList:t.relids};n.populate3DSpaceURL().then(function(){n.populateSecurityContext().then(function(){n.getProductConfigurations(a).then(function(a){let l=t.pids;for(o=0;o<l.length;o++)e.pids[l[o]]={ProductConfiguration:" "};for(let t in a)if("version"!=t&&a.hasOwnProperty(t)){let i=" ";if("true"==a[t].hasStaticMapping&&null!=a[t].content&&null!=a[t].content.results){let e=a[t].content.results[0].type;if("Product Configuration"==e||"xRevisionElement"==e){let e=" ",n=a[t].content.results[0].computed,o=a[t].content.results[0].basicData;if(null!=o)for(let t=0;t<o.length;t++)if("revision"==o[t].name&&null!=o[t].value){e=o[t].value[0];break}null!=n&&(i=n.label.value[0]+" "+e)}else if("VPMCfgConfiguration"==e){let e=a[t].content.results[0].data;if(null!=e)for(let t=0;t<e.length;t++)if("PLM_ExternalID"==e[t].name&&null!=e[t].value){i=e[t].value[0];break}}u.InstantiatedPCInfo[t]={filterID:a[t].filterID,ProductConfiguration:i}}e.relids[t]={ProductConfiguration:i}}n.isAdditionalConsoleLog()&&console.log("CfgProductConfigurationColumn output response updatedAttributes = "+JSON.stringify(e)),i(e)},function(t){console.log("getProductConfigurations error = "+t),i(e)})},function(t){console.log("populateSecurityContext error = "+t),i(e)})},function(t){console.log("populate3DSpaceURL error = "+t),i(e)})}},200)},getAdditionalColumnsUX:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDef[a]),r=i.indexOf(a);-1===r?t.push(l):t[r]=e.extend(t[r],l,!0)}},getAdditionalColumnsUXDGV:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDefDGV[a]),r=i.indexOf(a);-1===r?t.push(l):(t[r]=e.extend(t[r],l,!0),t[r].text=c[t[r].dataIndex])}},getTypeRepresentations:function(){return{configLoading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},provideDisplayTooltip:function(e){var t=null;switch(e.dataIndex){case"ProductConfiguration":t=e.cellModel&&e.cellModel.options&&" "==e.cellModel.options.value||" "==e.cellModel?"":e.cellModel}return t},registerReusableCellContent:function(e){e.getManager().registerReusableCellContent({id:"product_configuration_col_colloader",buildContent:function(){return i.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"product_configuration_col_value",buildContent:function(){return i.createElement("span")}})},showInstantiatedConfigurationProperties:function(e){let t=e.nodeModel,i=u.InstantiatedPCInfo[t.getRelationID()].filterID;r.createPropertiesComponent({itemID:i,displayType:l.POPUP,readOnly:!0,extraNotif:!1,editMode:!1})},getOnCellClickCB:function(e){let t;return"ProductConfiguration"===e&&(t=(e=>{u.showInstantiatedConfigurationProperties(e)})),t}});return u}),define("DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns",["UWA/Core","UWA/Class","DS/UIKIT/Spinner","DS/Utilities/Dom","DS/CfgBaseUX/scripts/CfgUtility","DS/EffectivityInlineEditor/EffectivityInlineEditor","i18n!DS/CfgWebAppEffectivityUX/assets/nls/CfgEffectivityNLS","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/CfgBaseUX/scripts/CfgController","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/ApplicationFrame/CommandsManager","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Mask","DS/PADUtils/PADContext","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","DS/CfgBaseUX/scripts/CfgUXEnvVariables","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json"],function(e,t,i,n,o,a,l,r,s,c,d,f,u,C,g,v,p,E,m,y,h,_,I,R){"use strict";var D="E",x=!0,V={};function b(e,t,i){if(!e.isHeader)if(e.cellModel.options.value){var n=e.cellView.reuseCellContent(t);n&&(n.innerText=e.cellModel.options.value)}else e.cellView.reuseCellContent(i)}function A(e){if(e.nodeModel)return e.cellModel?"string":"configLoading"}var T=t.singleton({_columnDataIndex:["Effectivity"],_columnDef:{Effectivity:{dataIndex:"Effectivity",text:l.CFG_EFFECTIVITY_HEADER,width:100,minWidth:50,maxWidth:300,isHidden:!0,readOnly:!1,onCellRequest:function(e){b(e,"effecivity_col_value","effecivity_col_colloader")},xnav_options:{layout:{width:100,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}}},_columnDefDGV:{},setReadOnlyMode:function(t){let i=!1;e.is(t,"boolean")?i=t:e.is(t,"string")&&(i="true"===t.toLowerCase()),T._columnStateReadOnly=i},init:function(e){this._parent(e),s.init(null,"","3DDashboard"),this.CfgUXEnvVariables=JSON.parse(R)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){o.rolesAvailable(function(t){if(x){V.Effectivity=l.CFG_EFFECTIVITY_HEADER;var i={dataIndex:"Effectivity",text:l.CFG_EFFECTIVITY_HEADER,width:100,minWidth:50,maxWidth:300,isHidden:!0,readOnly:!1,onCellRequest:function(e){b(e,"effecivity_col_value","effecivity_col_colloader")},xnav_options:{layout:{width:100,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},n={dataIndex:"Effectivity",text:l.CFG_EFFECTIVITY_HEADER,width:100,minWidth:50,maxWidth:300,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:A,customisation:{dataIndex:"Effectivity",exportable:{lock:!1,value:!0},layout:{removable:!1}}};V.VariantEffectivity=l.CFG_VARIANT_HEADER;var o={dataIndex:"VariantEffectivity",text:l.CFG_VARIANT_HEADER,width:300,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){b(e,"variant_effecivity_col_value","variant_effecivity_col_colloader")},xnav_options:{layout:{width:300,minWidth:200,maxWidth:500,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},a={dataIndex:"VariantEffectivity",text:l.CFG_VARIANT_HEADER,width:300,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:A,customisation:{dataIndex:"Effectivity",exportable:{lock:!1,value:!0},layout:{removable:!1}}};V.CurrentEvolutionEffectivity=l.CFG_CURRENT_EVOLUTION_HEADER;var r={dataIndex:"CurrentEvolutionEffectivity",text:l.CFG_CURRENT_EVOLUTION_HEADER,width:300,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){b(e,"current_evolution_effecivity_col_value","current_evolution_effecivity_col_colloader")},xnav_options:{layout:{width:300,minWidth:50,maxWidth:500,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},s={dataIndex:"CurrentEvolutionEffectivity",text:l.CFG_CURRENT_EVOLUTION_HEADER,width:300,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:A,customisation:{dataIndex:"Effectivity",exportable:{lock:!1,value:!0},layout:{removable:!1}}};V.ProjectedEvolutionEffectivity=l.CFG_PROJECTED_EVOLUTION_HEADER;var c={dataIndex:"ProjectedEvolutionEffectivity",text:l.CFG_PROJECTED_EVOLUTION_HEADER,width:300,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){b(e,"projected_evolution_effecivity_col_value","projected_evolution_effecivity_col_colloader")},xnav_options:{layout:{width:300,minWidth:50,maxWidth:500,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},d={dataIndex:"ProjectedEvolutionEffectivity",text:l.CFG_PROJECTED_EVOLUTION_HEADER,width:300,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:A,customisation:{dataIndex:"Effectivity",exportable:{lock:!1,value:!0},layout:{removable:!1}}};V.EvolutionEffectivity=l.CFG_EVOLUTION_HEADER;var f={dataIndex:"EvolutionEffectivity",text:l.CFG_EVOLUTION_HEADER,width:300,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){b(e,"evolution_effecivity_col_value","evolution_effecivity_col_colloader")},xnav_options:{layout:{width:300,minWidth:50,maxWidth:500,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},u={dataIndex:"EvolutionEffectivity",text:l.CFG_EVOLUTION_HEADER,width:300,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:A,customisation:{dataIndex:"Effectivity",exportable:{lock:!1,value:!0},layout:{removable:!1}}};1==t.isCHGRoleAvail?(!0===T._columnStateReadOnly&&(i.readOnly=!0,o.readOnly=!0,r.readOnly=!0,c.readOnly=!0,n.readOnly=!0,a.readOnly=!0,s.readOnly=!0,d.readOnly=!0),D="EE",T._columnDataIndex=["Effectivity","VariantEffectivity","CurrentEvolutionEffectivity","ProjectedEvolutionEffectivity"],T._columnDef={Effectivity:i,VariantEffectivity:o,CurrentEvolutionEffectivity:r,ProjectedEvolutionEffectivity:c},T._columnDefDGV={Effectivity:n,VariantEffectivity:a,CurrentEvolutionEffectivity:s,ProjectedEvolutionEffectivity:d}):1!=t.isCFGRoleAvail&&1!=t.isCSVRoleAvail||(!0===T._columnStateReadOnly&&(i.readOnly=!0,o.readOnly=!0,f.readOnly=!0,n.readOnly=!0,a.readOnly=!0,u.readOnly=!0),D="VE",T._columnDataIndex=["Effectivity","VariantEffectivity","EvolutionEffectivity"],T._columnDef={Effectivity:i,VariantEffectivity:o,EvolutionEffectivity:f},T._columnDefDGV={Effectivity:n,VariantEffectivity:a,EvolutionEffectivity:u}),e()}})}(function(){t(!0)})},getName:function(){return"CfgEffectivityColumns"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var i=!1;return"SyncModelRefresh"!==t&&"OnSyncModel"!==t||(i=!0),"EE"===D?void 0!==e.Effectivity&&""!==e.Effectivity&&void 0!==e.VariantEffectivity&&""!==e.VariantEffectivity&&void 0!==e.CurrentEvolutionEffectivity&&""!==e.CurrentEvolutionEffectivity&&void 0!==e.ProjectedEvolutionEffectivity&&""!==e.ProjectedEvolutionEffectivity||(i=!0):"VE"===D&&(void 0!==e.Effectivity&&""!==e.Effectivity&&void 0!==e.VariantEffectivity&&""!==e.VariantEffectivity&&void 0!==e.EvolutionEffectivity&&""!==e.EvolutionEffectivity||(i=!0)),i},updateAttributes:function(t,i){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(i,"function"))throw new Error("A callback function should be defined");setTimeout(function(){var e={pids:{},relids:{}},n=0,a=t.relids;if(t.pids.length>0&&o.isAdditionalConsoleLog()&&console.log("CfgEffectivityColumns original nodesToUpdate = "+JSON.stringify(t)),null!=t.pairs){let o=function(e){let t=[];for(let i=0;i<e.pids.length;i++){let n=e.pids[i];e.pairs[n]||t.push(n)}return t}(t);if("EE"===D){if(o.length>0){for(n=0;n<o.length;n++)e.pids[o[n]]={Effectivity:" ",VariantEffectivity:" ",CurrentEvolutionEffectivity:" ",ProjectedEvolutionEffectivity:" "};0==a.length&&i(e)}}else if("VE"===D&&o.length>0){for(n=0;n<o.length;n++)e.pids[o[n]]={Effectivity:" ",VariantEffectivity:" ",EvolutionEffectivity:" "};0==a.length&&i(e)}}else{var r=JSON.parse(R).isCRColumnVisible;if("EE"===D){if(0==r&&t.pids.length>0||1==r&&t.pids.length>0&&0==a.length){for(n=0;n<t.pids.length;n++)e.pids[t.pids[n]]={Effectivity:" ",VariantEffectivity:" ",CurrentEvolutionEffectivity:" ",ProjectedEvolutionEffectivity:" "};0==a.length&&i(e)}}else if("VE"===D&&(0==r&&t.pids.length>0||1==r&&t.pids.length>0&&0==a.length)){for(n=0;n<t.pids.length;n++)e.pids[t.pids[n]]={Effectivity:" ",VariantEffectivity:" ",EvolutionEffectivity:" "};0==a.length&&i(e)}}this.cfgUXEnvVariablesJS=I.getCfgUXEnvVariables();a.length>0&&(widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",o.populate3DSpaceURL().then(function(){o.populateSecurityContext().then(function(){var r={InstanceID:a,InstanceLength:a.length,Version:"2.0",TargetFormat:"TXT",withDescription:"YES",View:"ALL",Domains:"ALL"},s=null;"function"==typeof f.getConfigurationRevisionDetails&&(s=f.getConfigurationRevisionDetails().configurationRevision),null!=s&&(r.configurationRev=s),o.getEffectivityJSON(r).then(function(a){if("EE"===D){let i=t.pids;for(n=0;n<i.length;n++)e.pids[i[n]]={Effectivity:" ",VariantEffectivity:" ",CurrentEvolutionEffectivity:" ",ProjectedEvolutionEffectivity:" "};for(var r in a.expressions)if(a.expressions.hasOwnProperty(r))if("NO"==a.expressions[r].hasEffectivity||"NO"==a.expressions[r].hasConfigRevEffectivity)e.relids[r]={Effectivity:l.CFG_EFFECTIVITY_NO,VariantEffectivity:" ",CurrentEvolutionEffectivity:" ",ProjectedEvolutionEffectivity:" "};else if("YES"==a.expressions[r].hasEffectivity){var s=" ",c=" ",d=" ";null!==a.expressions[r].content&&null!==a.expressions[r].content.Variant&&void 0!==a.expressions[r].content.Variant&&""!==a.expressions[r].content.Variant&&(s=(s=a.expressions[r].content.Variant).replace(/[\r\n]+/g," ")),null!==a.expressions[r].content&&null!==a.expressions[r].content.Evolution&&void 0!==a.expressions[r].content.Evolution&&""!==a.expressions[r].content.Evolution&&(c=a.expressions[r].content.Evolution.Current,d=a.expressions[r].content.Evolution.Projected,c=null!=c&&""!==c?c.replace(/[\r\n]+/g," "):" ",d=void 0!==d&&null!=d&&""!==d?d.replace(/[\r\n]+/g," "):" "),e.relids[r]={Effectivity:l.CFG_EFFECTIVITY_YES,VariantEffectivity:s,CurrentEvolutionEffectivity:c,ProjectedEvolutionEffectivity:d}}else if("YES"==a.expressions[r].hasConfigRevEffectivity){s=" ",c=" ",d=" ";null!==a.expressions[r].content&&null!==a.expressions[r].content.Variant&&void 0!==a.expressions[r].content.Variant&&""!==a.expressions[r].content.Variant&&(s=(s=a.expressions[r].content.Variant).replace(/[\r\n]+/g," ")),null!==a.expressions[r].content&&null!==a.expressions[r].content.Evolution&&void 0!==a.expressions[r].content.Evolution&&""!==a.expressions[r].content.Evolution&&(c=null!=(c=d=a.expressions[r].content.Evolution)&&""!==c?c.replace(/[\r\n]+/g," "):" ",d=void 0!==d&&null!=d&&""!==d?d.replace(/[\r\n]+/g," "):" "),e.relids[r]={Effectivity:l.CFG_EFFECTIVITY_YES,VariantEffectivity:s,CurrentEvolutionEffectivity:c,ProjectedEvolutionEffectivity:d}}else"ERROR"!=a.expressions[r].hasEffectivity&&"SUCCESS"==a.expressions[r].status||(e.relids[r]={Effectivity:" ",VariantEffectivity:" ",CurrentEvolutionEffectivity:" ",ProjectedEvolutionEffectivity:" "})}else if("VE"===D){let i=t.pids;for(n=0;n<i.length;n++)e.pids[i[n]]={Effectivity:" ",VariantEffectivity:" ",EvolutionEffectivity:" "};for(var r in a.expressions)if(a.expressions.hasOwnProperty(r))if("NO"==a.expressions[r].hasEffectivity||"NO"==a.expressions[r].hasConfigRevEffectivity)e.relids[r]={Effectivity:l.CFG_EFFECTIVITY_NO,VariantEffectivity:" ",EvolutionEffectivity:" "};else if("YES"==a.expressions[r].hasEffectivity){s=" ";var f=" ";null!==a.expressions[r].content&&null!==a.expressions[r].content.Variant&&void 0!==a.expressions[r].content.Variant&&""!==a.expressions[r].content.Variant&&(s=(s=a.expressions[r].content.Variant).replace(/[\r\n]+/g," ")),null!==a.expressions[r].content&&null!==a.expressions[r].content.Evolution&&void 0!==a.expressions[r].content.Evolution&&""!==a.expressions[r].content.Evolution&&(f=null!=(f=a.expressions[r].content.Evolution.Current)&&""!==f?f.replace(/[\r\n]+/g," "):" "),e.relids[r]={Effectivity:l.CFG_EFFECTIVITY_YES,VariantEffectivity:s,EvolutionEffectivity:f}}else if("YES"==a.expressions[r].hasConfigRevEffectivity){s=" ",f=" ";null!==a.expressions[r].content&&null!==a.expressions[r].content.Variant&&void 0!==a.expressions[r].content.Variant&&""!==a.expressions[r].content.Variant&&(s=(s=a.expressions[r].content.Variant).replace(/[\r\n]+/g," ")),null!==a.expressions[r].content&&null!==a.expressions[r].content.Evolution&&void 0!==a.expressions[r].content.Evolution&&""!==a.expressions[r].content.Evolution&&(f=null!=(f=a.expressions[r].content.Evolution)&&""!==f?f.replace(/[\r\n]+/g," "):" "),e.relids[r]={Effectivity:l.CFG_EFFECTIVITY_YES,VariantEffectivity:s,EvolutionEffectivity:f}}else"ERROR"!=a.expressions[r].hasEffectivity&&"SUCCESS"==a.expressions[r].status||(e.relids[r]={Effectivity:" ",VariantEffectivity:" ",EvolutionEffectivity:" "})}o.isAdditionalConsoleLog()&&console.log("CfgEffectivityColumns output response updatedAttributes = "+JSON.stringify(e)),i(e)},function(t){console.log(t),i(e)})},function(t){console.log(t),i(e)})},function(t){console.log(t),i(e)}))},200)},getAdditionalColumnsUX:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDef[a]),r=i.indexOf(a);-1===r?t.push(l):t[r]=e.extend(t[r],l,!0)}},getAdditionalColumnsUXDGV:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDefDGV[a]),r=i.indexOf(a);-1===r?t.push(l):(t[r]=e.extend(t[r],l,!0),t[r].text=V[t[r].dataIndex])}},getTypeRepresentations:function(){return{configLoading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},provideDisplayTooltip:function(e){var t=null;switch(e.dataIndex){case"Effectivity":case"VariantEffectivity":case"CurrentEvolutionEffectivity":case"ProjectedEvolutionEffectivity":t=e.cellModel&&e.cellModel.options&&" "==e.cellModel.options.value||" "==e.cellModel?"":e.cellModel}return t},registerReusableCellContent:function(e){"EE"===D?(e.getManager().registerReusableCellContent({id:"effecivity_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"variant_effecivity_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"current_evolution_effecivity_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"projected_evolution_effecivity_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"effecivity_col_value",buildContent:function(){return n.createElement("span")}}),e.getManager().registerReusableCellContent({id:"variant_effecivity_col_value",buildContent:function(){return n.createElement("span")}}),e.getManager().registerReusableCellContent({id:"current_evolution_effecivity_col_value",buildContent:function(){return n.createElement("span")}}),e.getManager().registerReusableCellContent({id:"projected_evolution_effecivity_col_value",buildContent:function(){return n.createElement("span")}})):"VE"===D&&(e.getManager().registerReusableCellContent({id:"effecivity_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"variant_effecivity_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"evolution_effecivity_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"effecivity_col_value",buildContent:function(){return n.createElement("span")}}),e.getManager().registerReusableCellContent({id:"variant_effecivity_col_value",buildContent:function(){return n.createElement("span")}}),e.getManager().registerReusableCellContent({id:"evolution_effecivity_col_value",buildContent:function(){return n.createElement("span")}}))},cancelVariantDialog:function(){T.cfgVarEffectivityInlineEditor.cfgVarDialog.closeDialog(),T.callCommandClickTrackerEvent({mode:"Dashboard",operation:"Cancel"})},subscribeCfgEffInlineEditorActionEvents(){C.cfgEffInlineEditorActionEvents.subscribe({event:"clearIteOptionsOnVarDialogClose"},()=>{T.ite_options=void 0})},sendEditVariantTrackerEvent:function(e){let t="",i="",n=e.noOfContext,o=e.noOfReference,a=e.totalVariantLength,l=e.totalVariantValueLength,r=e.totalOptionGroupLength,s=e.totalOptionLength,c=e.totalNotOperatorLength,d=e.variantComplexity,f=e.totalFeaturesLength,u=e.totalFeatureOptionsLength;"Native"==e.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,i=null!=widget.options?widget.options.title:"ODT Environment");let C=y.getDeviceUsedForOperation(),g=y.ConfigOperationMode.CREATE;"Edit"==e.variantMode&&(g=y.ConfigOperationMode.EDIT);let v=y.AuthoringMode.EMPTY;"Empty"!=e.authoringMode&&(v=y.AuthoringMode[e.authoringMode]);let p=y.EditVariantMode.INLINE;y.createEventBuilder({category:y.Category.USAGE,action:y.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(y.Labels.EDIT_VARIANT_EFFECTIVITY).setAppId(t).addDimension(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_WIDGET,i).addDimension(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MEDIA,C).addDimension(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MODE,g).addDimension(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_AUTHORING_MODE,v).addDimension(h.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_TYPE_MODE,p).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_NO_OF_MODEL,n).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_REFERENCE_SELECTED,o).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT,a).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT_VALUE,l).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION_GROUP,r).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION,s).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_NOT_OPERATOR,c).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_COMPLEXITY,d).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURES,f).addPersonalValue(_.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURE_OPTIONS,u).send()},callEditVariantTrackerEvent:function(){let e={noOfContext:T.cfgVarEffectivityInlineEditor.ite_options.contextData.length,mode:"Dashboard",variantMode:"Create"};0==T.cfgVarEffectivityInlineEditor.cfgVarDialog.options.isInlineEmptyVariantEffectivity&&(e.variantMode="Edit"),e.authoringMode="Empty",T.cfgVarEffectivityInlineEditor.ite_options.auth.headers.length>0&&("DS-Change-Authoring-Context"==T.cfgVarEffectivityInlineEditor.ite_options.auth.headers[0].key?e.authoringMode="CHANGE":"DS-Configuration-Authoring-Context"==T.cfgVarEffectivityInlineEditor.ite_options.auth.headers[0].key&&(e.authoringMode="EVOLUTION")),e.noOfReference=1,e.totalVariantLength=-1,e.totalVariantValueLength=-1,e.totalOptionGroupLength=-1,e.totalOptionLength=-1,e.totalNotOperatorLength=-1,e.variantComplexity=-1,e.totalFeaturesLength=-1,e.totalFeatureOptionsLength=-1,T.sendEditVariantTrackerEvent(e)},callCommandClickTrackerEvent:function(e){let t="Native",i="Rich Client Applications",n="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(t=widget.data.appId),widget&&widget.options&&widget.options.title&&(i=widget.options.title),"Dashboard"==e.mode&&(n="DASHBOARD"),"OK"==e.operation){for(let e=0;e<T.cfgVarEffectivityInlineEditor.probesData.length;e++){let a={AppId:t,AppName:i,CommandOperation:T.cfgVarEffectivityInlineEditor.probesData[e],CommandName:y.Labels.EDIT_VARIANT_EFFECTIVITY,ConfigMode:y.ConfigMode.CONTEXTUAL,ApplicationMode:n};o.sendConfgurationCommandsClickEventForMagicProbes(a)}T.cfgVarEffectivityInlineEditor.clearCommandClickProbesData()}else{let e={AppId:t,AppName:i,CommandOperation:"Edit_Variant_Inline_Cancel",CommandName:y.Labels.EDIT_VARIANT_EFFECTIVITY,ConfigMode:y.ConfigMode.CONTEXTUAL,ApplicationMode:n};o.sendConfgurationCommandsClickEventForMagicProbes(e)}},setVariantEffectivity:function(){E.mask(document.querySelector("#target-container")," ");var e=null,t=T.cfgVarEffectivityInlineEditor.getExpressions();if("ERROR"==t.effectivity)return o.showwarning(l.Syntax_Error,"error"),void E.unmask(document.querySelector("#target-container"));if(""!=(e=0==t.effectivity.length?"":u.VariantJSONtoXMLConverter(t))||null==T.cfgVarEffectivityInlineEditor||null==T.cfgVarEffectivityInlineEditor.ite_options||1!=T.cfgVarEffectivityInlineEditor.ite_options.isInlineEmptyVariantEffectivity){var i=null;T.ite_options.auth.headers.length>0&&(i={operationheader:{key:T.ite_options.auth.headers[0].key,value:T.ite_options.auth.headers[0].value}});var n=function(e){(new Array).push(T.ite_options.node);var t=" ";if(null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus){var i=e.results[0],n=i.existing,a=i.new;if(null!=n&&null!=n.pid&&(n.pid,n.pid,null!=n.content&&null!=n.content.Variant)){var s=n.content.Variant;e.results[0].existing.content.displayExpression=o.getDisplayExpressionUsingXSLT(s)}if(null!=a&&null!=a.pid&&(t=a.pid,null!=a.content&&null!=a.content.Variant)){var c=a.content.Variant;e.results[0].new.content.displayExpression=o.getDisplayExpressionUsingXSLT(c)}}if(null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus){var d={commandName:"cfgInlineVariant",widgetId:widget.id,response:o.getEventResponse(e),data:{}};o.publishPostProcessingEventForApplications(d)}if(" "!=t&&o.showwarning(l.CFG_Application_Refresh_For_Instance_Evolved,"info"),E.unmask(document.querySelector("#target-container")),T.cfgVarEffectivityInlineEditor.cfgVarDialog.closeDialog(),void 0!==e.GlobalStatus&&"SUCCESS"==e.GlobalStatus||void 0!==e.unset&&("SUCCESS"===e.unset.Variant.status.toUpperCase()||"WARNING"===e.unset.Variant.status.toUpperCase()))o.showwarning(l.Service_OK,"success");else if(void 0!==e.GlobalStatus&&"ERROR"==e.GlobalStatus&&void 0!==e.results[0].errorDetails){if(126==e.results[0].errorCode){let e="";null!=T.cfgVarEffectivityInlineEditor.cfgVarDialog&&null!=T.cfgVarEffectivityInlineEditor.cfgVarDialog.options&&null!=T.cfgVarEffectivityInlineEditor.cfgVarDialog.options.dialogue&&null!=T.cfgVarEffectivityInlineEditor.cfgVarDialog.options.dialogue.header&&2==T.cfgVarEffectivityInlineEditor.cfgVarDialog.options.dialogue.header.split("- ").length&&2==T.cfgVarEffectivityInlineEditor.cfgVarDialog.options.dialogue.header.split("- ").length&&(e=T.cfgVarEffectivityInlineEditor.cfgVarDialog.options.dialogue.header.split("- ")[1]);let t=r.CfgMessageNoEditVariantTitle.replace("{1}",e),i=r.CfgMessageNoEditVariantAction.replace("{1}","<b>"+r.CfgHeaderEditConfigurationContext+"</b>");o.showNotifs("error",t,r.CfgMessageNoEditVariantSubTitle,i)}else 135==e.results[0].errorCode||136==e.results[0].errorCode?o.showwarning(l.Service_Fail+" "+e.results[0].message,"error"):o.showwarning(l.Service_Fail+" "+e.results[0].errorDetails,"error");console.log("Inline Edit Variant Effectivity operation error = "+e.results[0].errorDetails)}else o.showwarning(l.Service_Fail,"error");T.callEditVariantTrackerEvent(),T.callCommandClickTrackerEvent({mode:"Dashboard",operation:"OK"})},a=function(e){E.unmask(document.querySelector("#target-container")),T.cfgVarEffectivityInlineEditor.cfgVarDialog.closeDialog(),o.isDefined(e)&&o.isDefined(e.errorMessage)?o.showwarning(l.Service_Fail+"\n"+e.errorMessage,"error"):o.showwarning(l.Service_Fail,"error")};if(""==e){var s=[];s.push(T.ite_options.instanceID);var c={version:"2.0",wsOptions:i,unsetList:s,domain:"Variant"};o.unsetVariantEffectivities(c).then(function(e){n(e)},function(e){a(e)})}else c={wsOptions:i,version:"1.1",domain:"Variant",view:"All",expressionList:[{pid:T.ite_options.instanceID,VariantContent:e}]},o.setVariantEffectivities(c).then(function(e){n(e)},function(e){a(e)})}else T.cfgVarEffectivityInlineEditor.cfgVarDialog.closeDialog()},initVariantDialog:function(e){if(C&&!1===C.isEditVariantEnabled)o.showwarning(r.Edit_Variant_Disabled,"error");else{var t=e.options.relationid;if(C.clear(),C.cfgEffInlineEditorActionEvents=new g,this.subscribeCfgEffInlineEditorActionEvents(),!T||!T.ite_options){var i="";i=e.options.grid["ds6w:label-Instance"]?e.options.grid["ds6w:label-Instance"]:e.options.label;var n=e._parentNode.options.resourceid;if(t&&""!==t&&window.cfgCmdWidgetData&&!0===window.cfgCmdWidgetData._isDecouplingActivated&&!0===window.cfgCmdWidgetData._isConfigAvailable&&!0===C.isEditVariantEnabled){T.ite_options={node:e,contextData:null,varEffJsonWithLabel:null,parentDiv:null,isInlineEmptyVariantEffectivity:!1,parentID:n,instanceID:t,mode:"ITEOnDashboard",width:800,height:500,minHeight:380,minWidth:240,probesData:[],setVariantEffectivity:T.setVariantEffectivity,cancelVariantDialog:T.cancelVariantDialog,iconModelURL:null,auth:{headers:[]},dialogue:{header:l.CFG_EDIT_VARIANT_HEADER+" - "+i,target:widget.body,buttonArray:null}},T.cfgVarEffectivityInlineEditor=new a,T.cfgVarEffectivityInlineEditor.initVariantDialog(T.ite_options);let r="defaultAppID",s="ODT Environment";widget&&widget.data&&widget.data.appId&&(r=widget.data.appId),widget&&widget.options&&widget.options.title&&(s=widget.options.title);let c={AppId:r,AppName:s,CommandName:y.Labels.EDIT_VARIANT_EFFECTIVITY,CommandOperation:"Edit_Variant_Effectivity_Inline_Dialog_Open",ConfigMode:y.ConfigMode.CONTEXTUAL,ApplicationMode:y.ApplicationMode.DASHBOARD};o.sendConfgurationCommandsClickEventForMagicProbes(c)}}}},getAdditionalCtxMenu:function(t){if(!1===e.is(t.callback,"function"))throw new Error("A callback function should be defined");if(void 0===t.ctxParams)throw new Error("No Ctx params given");var i=!1;if(t.ctxParams.treeview?(i=t.ctxParams.treeview.isHeader,t.ctxParams.treeview.dataIndex):"datagridview"===t.view&&(i=-1===t.ctxParams.cellInfos.rowID,t.ctxParams.collectionView.getColumnOrGroup(t.ctxParams.cellInfos.columnID).dataIndex),!0===i)t.callback("CfgEffectivityColumnsHeader",[]);else{var n=null,o=(i=!1,t.ctxParams);o.graphview?n=o.graphview.node:o.treeview?(n=o.treeview.nodeModel?o.treeview.nodeModel:o.treeview.cellModel,i=o.treeview.isHeader):n=o.cellInfos?o.cellInfos.nodeModel?o.cellInfos.nodeModel:o.cellInfos.cellModel:null;var a=t.treeDocument.getSelectedNodes();if(n&&(!o.treeview||!o.treeview.isHeader)){var r,s,c,d,f="enabled",u="enabled",C="enabled",g="enabled";null!=(r=v.getCommand("CopyVariantEffectivity"))&&(r._checkSelection(),0==r._isEnabled&&(f="disabled")),null!=(s=v.getCommand("PasteVariantEffectivity"))&&(s._checkSelection(),0==s._isEnabled&&(u="disabled")),null!=(c=v.getCommand("CopyEvolutionEffectivity"))&&(c._checkSelection(),0==c._isEnabled&&(C="disabled")),null!=(d=v.getCommand("PasteEvolutionEffectivity"))&&(d._checkSelection(),0==d._isEnabled&&(g="disabled"));var E={type:"PushItem",icon:"url("+p.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Copy_Variant_Effectivity.png")+")",title:l.CFG_COPY_VARIANT_EFFECTIVITY,state:f,action:{context:{nodes:a},callback:function(e){r.execute()}}},m={type:"PushItem",icon:"url("+p.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Paste_Variant_Effectivity.png")+")",title:l.CFG_PASTE_VARIANT_EFFECTIVITY,state:u,action:{context:{nodes:a},callback:function(e){s.execute()}}},y={type:"PushItem",icon:"url("+p.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Copy_Evolution_Effectivity.png")+")",title:l.CFG_COPY_EVOLUTION_EFFECTIVITY,state:C,action:{context:{nodes:a},callback:function(e){c.execute()}}},h={type:"PushItem",icon:"url("+p.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Paste_Evolution_Effectivity.png")+")",title:l.CFG_PASTE_EVOLUTION_EFFECTIVITY,state:g,action:{context:{nodes:a},callback:function(e){d.execute()}}}}setTimeout(function(){t.callback("copyVariantEffectivityCtx",E),t.callback("pasteVariantEffectivityCtx",m),t.callback("copyEvolutionEffectivityCtx",y),t.callback("pasteEvolutionEffectivityCtx",h)},50)}},getOnCellClickCB:function(e){var t,i=this;switch(e){case"Effectivity":t=function(e){};break;case"VariantEffectivity":t=function(e){var t=e.nodeModel;if(m.get&&null!=m.get().getEditMode&&!0===m.get().getEditMode()){!1===T._columnDef.VariantEffectivity.readOnly&&i.initVariantDialog(t)}}}return t}});return T}),define("DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationContextColumn",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgWebAppEffectivityUX/assets/nls/CfgEffectivityNLS","DS/CfgBaseUX/scripts/CfgController","DS/PlatformAPI/PlatformAPI","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS"],function(e,t,i,n,o,a,l,r,s,c){"use strict";var d={};function f(e,t,i){if(!e.isHeader)if(e.cellModel.options.value){var n=e.cellView.reuseCellContent(t);n&&(n.innerText=e.cellModel.options.value)}else e.cellView.reuseCellContent(i)}function u(e){if(e.nodeModel)return e.cellModel!==c.CfgCtxNoReadAccess?"string":e.cellModel===c.CfgCtxNoReadAccess?"noReadAccessBlock":"configLoading"}var C=t.singleton({_columnDataIndex:["ConfigurationContext"],_columnDef:{ConfigurationContext:{dataIndex:"ConfigurationContext",text:o.CFG_CONFIGURATION_CONTEXT_HEADER,width:180,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){f(e,"configuration_context_col_value","configuration_context_col_colloader")},xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}}},_columnDefDGV:{},setReadOnlyMode:function(t){let i=!1;e.is(t,"boolean")?i=t:e.is(t,"string")&&(i="true"===t.toLowerCase()),C._columnStateReadOnly=i},init:function(e){this._parent(e),a.init(null,"","3DDashboard")},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){n.rolesAvailable(function(t){d.ConfigurationContext=o.CFG_CONFIGURATION_CONTEXT_HEADER;var i={dataIndex:"ConfigurationContext",text:o.CFG_CONFIGURATION_CONTEXT_HEADER,width:180,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){f(e,"configuration_context_col_value","configuration_context_col_colloader")},xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},n={dataIndex:"ConfigurationContext",text:o.CFG_CONFIGURATION_CONTEXT_HEADER,width:180,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:u,customisation:{dataIndex:"ConfigurationContext",exportable:{lock:!1,value:!0},layout:{removable:!1}}};d.RevisionMaster=r.labelRevisionMaster;var a={dataIndex:"RevisionMaster",text:r.labelRevisionMaster,width:180,minWidth:50,isHidden:!0,readOnly:!1,onCellRequest:function(e){f(e,"revision_master_col_value","revision_master_col_colloader")},xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},l={dataIndex:"RevisionMaster",text:r.labelRevisionMaster,width:180,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:u,customisation:{dataIndex:"RevisionMaster",exportable:{lock:!1,value:!0},layout:{removable:!1}}};d.RevisionMode=r.labelRevisionControl;var c={dataIndex:"RevisionMode",text:r.labelRevisionControl,width:180,minWidth:50,maxWidth:300,isHidden:!0,readOnly:!1,onCellRequest:function(e){f(e,"revision_mode_col_value","revision_mode_col_colloader")},xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},g={dataIndex:"RevisionMode",text:r.labelRevisionControl,width:180,minWidth:50,maxWidth:300,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:u,customisation:{dataIndex:"RevisionMode",exportable:{lock:!1,value:!0},layout:{removable:!1}}};!0===C._columnStateReadOnly&&(i.readOnly=!0,n.readOnly=!0,a.readOnly=!0,l.readOnly=!0,c.readOnly=!0,g.readOnly=!0);let v=s.getCfgUXEnvVariables();1!=t.isCHGRoleAvail&&1!=t.isCFGRoleAvail&&1!=t.isCSVRoleAvail||(1==v.isXrevisionColumnsEnabled?(C._columnDataIndex=["ConfigurationContext","RevisionMaster","RevisionMode"],C._columnDef={ConfigurationContext:i,RevisionMode:c,RevisionMaster:a},C._columnDefDGV={ConfigurationContext:n,RevisionMode:g,RevisionMaster:l}):(C._columnDataIndex=["ConfigurationContext"],C._columnDef={ConfigurationContext:i},C._columnDefDGV={ConfigurationContext:n})),e()})}(function(){t(!0)})},getName:function(){return"CfgConfigurationContextColumn"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var i=!1;return"SyncModelRefresh"!==t&&"OnSyncModel"!==t||(i=!0),void 0!==e.ConfigurationContext&&""!==e.ConfigurationContext||(i=!0),i},updateAttributes:function(t,i){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(i,"function"))throw new Error("A callback function should be defined");setTimeout(function(){var e={pids:{},relids:{}},o=0;if(widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",t.pids.length>0)for(o=0;o<t.pids.length;o++)e.pids[t.pids[o]]={ConfigurationContext:" ",RevisionMaster:" ",RevisionMode:" "};var a={referenceIds:t.pids,version:"1.1",xRevisionContent:!0};n.populate3DSpaceURL().then(function(){n.populateSecurityContext().then(function(){n.getMultipleConfigurationContextInfo(a).then(function(t){null!=t.contextInfo&&null!=t.version&&(t.contextInfo.forEach(t=>{t.content&&t.content.results[0]&&t.content.results[0].notification&&t.content.results[0].notification.type&&"ERROR"===t.content.results[0].notification.type?t.contextOf.forEach(t=>{e.pids[t].ConfigurationContext=c.CfgCtxNoReadAccess}):t.contextOf.forEach(i=>{if(e.pids[i].ConfigurationContext!==c.CfgCtxNoReadAccess){let o=t.content.results[0].data.find(e=>"Marketing Name"===e.name);if(!o)var n=t.content.results[0].basicData.find(e=>"name"===e.name);if(o||n){let t=o?o.value[0]:n.value[0];e.pids[i].ConfigurationContext=" "!==e.pids[i].ConfigurationContext?e.pids[i].ConfigurationContext+", "+t:t,e.pids[i].RevisionMaster=" "!==e.pids[i].RevisionMaster?e.pids[i].RevisionMaster+", "+t:t}else e.pids[i].ConfigurationContext=" "}e.pids[i].RevisionMode=r.revisionControlEffectivityBased})}),null!=t.xRevisionContent&&t.xRevisionContent.forEach(t=>{let i=" ",n=" ";i=r.revisionControlEffectivityBased,null!=t.xRevisionGraph&&null!=t.xRevisionGraph.name&&(n=t.xRevisionGraph.name),e.pids[t.referencePID].RevisionMode=i,e.pids[t.referencePID].RevisionMaster=n,t&&t.attachedScopes?t.attachedScopes.forEach(i=>{if(i&&i.attributes[0]&&i.attributes[0].notification&&i.attributes[0].notification.type&&"ERROR"===i.attributes[0].notification.type)e.pids[t.referencePID].ConfigurationContext=c.CfgCtxNoReadAccess;else{let n=i.attributes[0];if(null!=n.data){let i=n.data.find(e=>"Marketing Name"===e.name);if(i||(modelName=n.basicData.find(e=>"name"===e.name)),i||modelName){let n=i?i.value[0]:modelName.value[0];e.pids[t.referencePID].ConfigurationContext=" "!==e.pids[t.referencePID].ConfigurationContext?e.pids[t.referencePID].ConfigurationContext+", "+n:n}else e.pids[t.referencePID].ConfigurationContext=" "}}}):e.pids[t.referencePID].ConfigurationContext=" "}),null!=t.referencesInfo&&t.referencesInfo.forEach(t=>{"NO"==t.hasConfigContext&&"NO"==t.hasXRevisionGraph&&(e.pids[t.pid].RevisionMode=r.revisionControlClassical)}),i(e))},function(t){console.log("Get multiple configuration context Info error "+t),i(e)})},function(t){console.log("populateSecurityContext error = "+t),i(e)})},function(t){console.log("populate3DSpaceURL error = "+t),i(e)})},200)},getAdditionalColumnsUX:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDef[a]),r=i.indexOf(a);-1===r?t.push(l):t[r]=e.extend(t[r],l,!0)}},getAdditionalColumnsUXDGV:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDefDGV[a]),r=i.indexOf(a);-1===r?t.push(l):(t[r]=e.extend(t[r],l,!0),t[r].text=d[t[r].dataIndex])}},getTypeRepresentations:function(){return{configLoading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin",fontIconFamily:WUXManagedFontIcons.Font3DS}}},noReadAccessBlock:{stdTemplate:"functionIcon",semantics:{className:"relationBlock",icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},provideDisplayTooltip:function(e){var t=null;switch(e.dataIndex){case"ConfigurationContext":t=e.cellModel&&e.cellModel.options&&" "==e.cellModel.options.value||" "==e.cellModel?"":e.cellModel.replaceAll(", ","\r\n")}return t},registerReusableCellContent:function(e){e.getManager().registerReusableCellContent({id:"configuration_context_col_colloader",buildContent:function(){return i.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"configuration_context_col_value",buildContent:function(){return i.createElement("span")}})}});return C}),define("DS/CfgWebAppEffectivityUX/facets/EffectivityFacet",["UWA/Core","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/constants/EditPropConstants","UWA/Class/Model","DS/UIKIT/Mask","i18n!DS/CfgEffectivityViewUX/assets/nls/CfgEffectivityView"],function(e,t,i,n,o,a){"use strict";return t.extend({init:function(){this._parent.apply(this,arguments),this.elements.container||(this.elements.container=e.createElement("div",{styles:{height:"100%"}}))},updateFacet:function(){var e=this;o.mask(this.elements.container),require(["DS/CfgEffectivityViewUX/scripts/CfgEffectivityViewFactory"],function(t){if(e.elements&&e.elements.container){var i=e.getModel();if(!i)return!1;var n="",l=e.getOccurrence().getOptions("Effectivity");n=l?l.targets[0].id:i.get("objectId");var r=i.getTenant(),s=new t;s.loadEffectivities(n,r).then(function(t){e.elements.container.setContent(""),s.createInstance(t,e.elements.container,!0).render(),o.unmask(e.elements.container),null!=t.effData&&""==t.effData.officialEvolutionExpression&&""==t.effData.variantExpression&&e.elements.container.setHTML(a.NO_EFF_MSG)},function(t){return o.unmask(e.elements.container),e.elements.container.setContent(""),console.log("CfgEffectivityViewFactory : loadEffectivities failed"),!1})}})},destroyComponent:function(){e.is(this.destroy,"function")&&this.destroy()}})}),define("DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationRevisionColumn",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgWebAppEffectivityUX/assets/nls/CfgEffectivityNLS","DS/CfgBaseUX/scripts/CfgController","DS/PlatformAPI/PlatformAPI","DS/PADUtils/PADContext","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgConfigurationRevisionUX/scripts/views/instance/CfgCRCompositionVersionExplorerView","DS/Utilities/TouchUtils","DS/CfgBaseUX/scripts/CfgUXEnvVariables","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/Tweakers/TypeRepresentationFactory","DS/Controls/TooltipModel","css!DS/CfgWebAppEffectivityUX/CfgWebAppEffectivityUX.css"],function(e,t,i,n,o,a,l,r,s,c,d,f,u,C,g,v,p,E){"use strict";var m={},y=new Map;function h(e){if(e.nodeModel)return e.cellModel!==v.CfgRevAccessDialogForCRCompose?"object":e.cellModel===v.CfgRevAccessDialogForCRCompose?"accessDialogForCRCompose":"configLoading"}y.set("Private",{NLS:v.CfgLabelInPrivate,labelColor:"#9B2C98"}),y.set("In Work",{NLS:v.CfgLabelInWork,labelColor:"#007DA3"}),y.set("Frozen",{NLS:v.CfgLabelInFrozen,labelColor:"#018308"}),y.set("Released",{NLS:v.CfgLabelInReleased,labelColor:"#757575"}),y.set("Obsolete",{NLS:v.CfgLabelInObsolete,labelColor:"#FFFFFF"});var _=t.singleton({_columnDataIndex:["ConfigurationRevision"],_columnDef:{ConfigurationRevision:{dataIndex:"ConfigurationRevision",text:o.CFG_CONFIGURATION_REVISION_HEADER,width:180,minWidth:50,maxWidth:300,isHidden:!0,readOnly:!1,xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}}},_columnDefDGV:{},setReadOnlyMode:function(t){let i=!1;e.is(t,"boolean")?i=t:e.is(t,"string")&&(i="true"===t.toLowerCase()),_._columnStateReadOnly=i},setCRselectedData:function(e){"Set"==e.operation?(_.crDataJSON=e.dataJSON,_.isCRChanged=!0,_.physicalPrdCRDataMap&&(_.physicalPrdCRDataMap.clear(),_.physicalPrdCRDataMap=null),_.isCRManuallyComposed=!1,_.physicalPrdCRDataMap=new Map):"Remove"==e.operation&&(_.crDataJSON=null,_.crData=[],_.physicalPrdCRDataMap&&(_.physicalPrdCRDataMap.clear(),_.physicalPrdCRDataMap=null),_.isCRManuallyComposed=!1)},init:function(e){this._parent(e),a.init(null,"","3DDashboard");var t="";widget&&(t=widget.id),l.subscribe("NGFilter.SetConfigurationRevision_"+t,function(e){_.setCRselectedData({operation:"Set",dataJSON:e})}),l.subscribe("NGFilter.RemoveConfigurationRevision_"+t,function(e){_.setCRselectedData({operation:"Remove",dataJSON:e})})},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(t){n.rolesAvailable(function(i){m.ConfigurationRevision=o.CFG_CONFIGURATION_REVISION_HEADER;var n={dataIndex:"ConfigurationRevision",text:o.CFG_CONFIGURATION_REVISION_HEADER,width:180,minWidth:50,maxWidth:300,isHidden:!0,readOnly:!1,onCellRequest:function(e){!function(e,t,i){if(!e.isHeader)if(e.cellModel.options.value){var n=e.cellView.reuseCellContent(t);n&&(n.innerText=e.cellModel.options.value)}else e.cellView.reuseCellContent(i)}(e,"configuration_revision_col_value","configuration_revision_col_colloader")},xnav_options:{layout:{width:180,minWidth:50,maxWidth:300,removable:!0,hidden:!0},exportable:{lock:!1,value:!0}}},a={dataIndex:"ConfigurationRevision",text:o.CFG_CONFIGURATION_REVISION_HEADER,width:180,minWidth:50,maxWidth:300,visibleFlag:!1,isAdditionalColumn:!0,readOnly:!1,getCellTypeRepresentation:h,customisation:{dataIndex:"ConfigurationRevision",exportable:{lock:!1,value:!0},layout:{removable:!1}},getCellClassName:function(e){return e&&e.nodeModel&&e.nodeModel._options&&e.nodeModel._options.grid&&e.nodeModel._options.grid.ConfigurationRevision&&Array.isArray(e.nodeModel._options.grid.ConfigurationRevision.crValues)&&e.nodeModel._options.grid.ConfigurationRevision.crValues.length>0&&""!==e.nodeModel._options.grid.ConfigurationRevision.crValues[0].value&&_&&_.crDataJSON?!0===_._columnDef.ConfigurationRevision.readOnly?"cfg-rev-col":"cfg-rev-col-link":"cfg-rev-col"},onCellRequest:async function(t){var i=new e.Element("div",{styles:{display:"flex"}});if(_.crDataJSON){{const e=new p,a=t.nodeModel._options.grid.ConfigurationRevision.crValues,l=t.nodeModel._options.grid.ConfigurationRevision.options;if(Array.isArray(a)&&a.length>0&&Array.isArray(l)&&l.length>0){const r=await e.generateView(a[0].value,{typePath:a[0].type,readOnly:l[0].readOnly,semantics:l[0].semantics});if(r.getContent().addClassName("cr-revision"),i.addContent(r.getContent()),t.cellView.tooltipInfos=new E({shortHelp:"pencil"===a[0].value?v.CfgRevAccessDialogForCRCompose:a[0].value}),a[1]){var n,o;n=a[1].value&&y.get(a[1].value)&&y.get(a[1].value).NLS?y.get(a[1].value).NLS:a[1].value,o=a[1].value&&y.get(a[1].value)&&y.get(a[1].value).labelColor?y.get(a[1].value).labelColor:"#007DA3";const t=await e.generateView([n],{typePath:a[1].type,readOnly:l[1].readOnly,semantics:l[1].semantics});t.getContent().getChildren()[0].setStyle("background",o),"Obsolete"===a[1].value&&t.getContent().getChildren()[0].setStyle("color","#000"),i.addContent(t.getContent())}}}t.cellView.setReusableContent(i)}else t.cellView.tooltipInfos=new E({shortHelp:""}),t.cellView.setReusableContent(i)}};!0===_._columnStateReadOnly&&(n.readOnly=!0,a.readOnly=!0);var l=JSON.parse(g).isCRColumnVisible;null!=l&&1==l&&(1!=i.isCHGRoleAvail&&1!=i.isCFGRoleAvail&&1!=i.isCSVRoleAvail||(_._columnDataIndex=["ConfigurationRevision"],_._columnDef={ConfigurationRevision:n},_._columnDefDGV={ConfigurationRevision:a})),t()})}(function(){var e=JSON.parse(g).isCRColumnVisible;t(null!=e&&1==e)})},getName:function(){return"CfgConfigurationRevisionColumn"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var i=!1;return"SyncModelRefresh"!==t&&"OnSyncModel"!==t||(i=!0),void 0!==e.ConfigurationRevision&&""!==e.ConfigurationRevision||(i=!0),i},updateAttributes:function(t,i){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(i,"function"))throw new Error("A callback function should be defined");setTimeout(async function(){var e={pids:{},relids:{}},o=0;if(widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",t.pids.length>0)for(o=0;o<t.pids.length;o++)e.pids[t.pids[o]]={ConfigurationRevision:{crValues:[{type:"string",value:""},{type:"tag",value:""}],options:[{readOnly:!0},{readOnly:!0,semantics:{allowMultipleValuesFlag:!0,emphasize:"success"}}]}};if(null!=_.crDataJSON&&null!=_.crDataJSON||i(e),null!=_.crDataJSON&&null!=_.crDataJSON){var a=_.crDataJSON;if(null!=_._getInformationResponse&&0==_.isCRChanged)_.computeCRData(_._getInformationResponse,t.pids),e=await _.computeConfigurationRevisionValues(e),i(e);else if(null!=a&&null!=a.configRevision&&1==a.configRevision.length){var l={configurationRevisionId:a.configRevision[0].id};n.populate3DSpaceURL().then(function(){n.populateSecurityContext().then(function(){n.getCRInformation(l).then(async function(n){null!=n&&null!=n.versions&&(_.isCRChanged=!1,_._getInformationResponse=n,_.computeCRData(n,t.pids),e=await _.computeConfigurationRevisionValues(e),i(e))},function(t){console.log("getCRInformationResponse error = "+t),i(e)})},function(t){console.log("populateSecurityContext error = "+t),i(e)})},function(t){console.log("populate3DSpaceURL error = "+t),i(e)})}}},200)},computeCRData(e,t){try{_.pidsRelatedToFilteredRoot=[];let i={crInfo:e,pIds:t};if(null!=r&&null!=r._context&&null!=r._context.getRoots()&&r._context.getRoots().length>0){let e;for(let t=0;t<r._context.getRoots().length;t++){let i=r._context.getRoots()[t];if(_.crDataJSON.rootId==i.options.resourceid||_.crDataJSON.rootId==i.options.physicalid){e=i;break}}null!=e&&_.computeAllPidsOfFilteredRoot(e),i.pIds=t.filter(e=>_.pidsRelatedToFilteredRoot.includes(e))}_.isCRManuallyComposed||(_.crData=n.getCRColumnInfo(i)),_.isCRManuallyComposed=!1}catch(e){console.log("Compute CR data for CR column failed",e)}},computeAllPidsOfFilteredRoot(e){null!=e.options.resourceid?_.pidsRelatedToFilteredRoot.push(e.options.resourceid):null!=e.options.physicalid&&_.pidsRelatedToFilteredRoot.push(e.options.physicalid),void 0!==e.options.children&&e.options.children.forEach(e=>_.computeAllPidsOfFilteredRoot(e))},async computeConfigurationRevisionValues(e){var t=[];try{t=_.crData.filter(e=>"ConfiguredBaseline"!==e.type).filter(e=>void 0===_.physicalPrdCRDataMap.get(e.pid)).map(e=>({id:e.pid}))}catch(e){console.log("computeConfigurationRevisionValues failed for CR column ",e)}try{if(t.length>0)var i=await n.getAllowedSemanticsForMultipleProducts(t);for(let t of _.crData)if(" "===t.revision||" "===t.crID){if(i&&i.allowedSemantics)var o=i.allowedSemantics.find(e=>e.id===t.pid);!1===_._columnDef.ConfigurationRevision.readOnly&&(o&&n.isBaselineMode(t.pid,i)&&0==n.isFirstSemantic(t.pid,i)||_.physicalPrdCRDataMap.get(t.pid)&&_.physicalPrdCRDataMap.get(t.pid).isCRDefined)?(_.physicalPrdCRDataMap.set(t.pid,{isCRDefined:!0}),e.pids[t.pid]={ConfigurationRevision:{crValues:[{type:"icon",value:"pencil"}],options:[{stdTemplate:"functionIcon",semantics:{className:"relationCRCompose",icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS}}}]}}):(_.physicalPrdCRDataMap.set(t.pid,{isCRDefined:!1}),e.pids[t.pid]={ConfigurationRevision:{crValues:[{type:"string",value:""},{type:"tag",value:""}],options:[{readOnly:!0},{readOnly:!0,semantics:{allowMultipleValuesFlag:!0,emphasize:"success"}}]}})}else _.physicalPrdCRDataMap.set(t.pid,{isCRDefined:!0}),e.pids[t.pid]={ConfigurationRevision:{crValues:[{type:"string",value:t.revision},{type:"tag",value:t.maturity}],options:[{readOnly:!0},{readOnly:!0,semantics:{allowMultipleValuesFlag:!0,emphasize:"success"}}]}}}catch(t){console.log("Get allowed semantics web service failure ",t),_.crData.forEach(t=>{" "!==t.revision&&" "!==t.crID?e.pids[t.pid]={ConfigurationRevision:{crValues:[{type:"string",value:t.revision},{type:"tag",value:t.maturity}],options:[{readOnly:!0},{readOnly:!0,semantics:{allowMultipleValuesFlag:!0,emphasize:"success"}}]}}:e.pids[t.pid]={ConfigurationRevision:{crValues:[{type:"string",value:""},{type:"tag",value:""}],options:[{readOnly:!0},{readOnly:!0,semantics:{allowMultipleValuesFlag:!0,emphasize:"success"}}]}}})}return e},getAdditionalColumnsUX:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDef[a]),r=i.indexOf(a);-1===r?t.push(l):t[r]=e.extend(t[r],l,!0)}},getAdditionalColumnsUXDGV:function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var a=this._columnDataIndex[o],l=e.clone(this._columnDefDGV[a]),r=i.indexOf(a);-1===r?t.push(l):(t[r]=e.extend(t[r],l,!0),t[r].text=m[t[r].dataIndex])}},getTypeRepresentations:function(){return{configLoading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin",fontIconFamily:WUXManagedFontIcons.Font3DS}}},accessDialogForCRCompose:{stdTemplate:"functionIcon",semantics:{className:"relationCRCompose",icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},provideDisplayTooltip:function(e){var t=null;switch(e.dataIndex){case"ConfigurationRevision":t=e.cellModel&&e.cellModel.options&&" "==e.cellModel.options.value||" "==e.cellModel?"":e.cellModel}return t},registerReusableCellContent:function(e){e.getManager().registerReusableCellContent({id:"configuration_revision_col_colloader",buildContent:function(){return i.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"configuration_revision_col_value",buildContent:function(){return i.createElement("span")}})},getOnCellClickCB:function(e){if(this.cfgUXEnvVariablesJS=C.getCfgUXEnvVariables(),!this.cfgUXEnvVariablesJS.isCFGCRCompositionEnabled)return;if(!0===_._columnDef.ConfigurationRevision.readOnly)return;let t;return"ConfigurationRevision"===e&&_.crDataJSON?t=(async e=>{r.get&&null!=r.get().getEditMode&&!0===r.get().getEditMode()&&(_.crDataJSON.rootId!==e.nodeModel.options.resourceid?await this.initCRCompositionDialog(e.nodeModel):n.showwarning(v.CfgErrorCRComposeOnParent,"error"))}):"ConfigurationRevision"!==e||_.crDataJSON||n.showwarning(v.CfgInfoCRComposeFilterStructure,"info"),t},initCRCompositionDialog:async function(e){c.clear(),c.cfgCRCompositionActionEvents=new d,this.subscribeCfgCRCompositionActionEvents();let t=e.options.resourceid;const i=await n.getAllowedSemantics(t);if(n.isBaselineMode(t,i)&&0==n.isFirstSemantic(t,i)){let t=_.getMaturityOfParentCR();!t||"Private"!==t&&"In Work"!==t&&"Frozen"!==t?n.showwarning(v.CfgErrorCRComposeIncorrectParentState,"error"):await this.loadCRCompositionOfProduct(e)}},getMaturityOfParentCR:function(){let e=r.get().getSelectedNodes()[0].options.from,t=_.crData.find(t=>t.pid===e);return t?t.maturity:null},loadCRCompositionOfProduct:async function(e){widget?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",await n.populate3DSpaceURL(),await n.populateSecurityContext(),await this.createVersionExplorerView(e)},createVersionExplorerView:async function(e){let t,i=e.options.resourceid,n=_.crData.find(e=>e.pid===i);n&&" "!==n.crID&&(t={displayName:n.name,id:n.crID,name:n.name,physicalid:n.crID,revision:n.revision,type:n.type}),this.CfgCRCompositionVersionExplorerViewObj=await new f({physicalIDOfProduct:i,crVersionToBeSelectedInVEObj:t||null}),this.createCRCompositionDialog(e,n)},createCRCompositionDialog:function(t,i){let o=this,a=t.options.resourceid,l=t.options.label;_.existingCRId=i.crID,this.MainContainer=new e.Element("div",{html:this.CfgCRCompositionVersionExplorerViewObj.render(),styles:{width:"100%",height:"100%"}});let c=[{label:"OK",labelValue:v.CfgLabelOK,handler:async function(){var e,i,l;if(o.CfgCRCompositionVersionExplorerViewObj.CfgCRCompositionFactoryObj.getVEObject().getSelectedNodes()[0]){if(t&&t.options&&t.options.grid&&t.options.grid.ConfigurationRevision&&Array.isArray(t.options.grid.ConfigurationRevision.crValues)&&"pencil"===t.options.grid.ConfigurationRevision.crValues[0].value){let e=r.get().getSelectedNodes()[0].options.from;l=_.crData.find(t=>t.pid===e).crID}else[i,l]=o.computeExistingChildAndParentCRIds(a);e=o.CfgCRCompositionVersionExplorerViewObj.CfgCRCompositionFactoryObj.getVEObject().getSelectedNodes()[0].options.data.physicalid}else{if(t&&t.options&&t.options.grid&&" "===t.options.grid.ConfigurationRevision)return console.log("no operation"),void o.crCompositionDialog.closeDialog();[i,l]=o.computeExistingChildAndParentCRIds(a)}if(i!==e){try{var s=await o.CfgCRCompositionVersionExplorerViewObj.saveCRCompositionContent(i,e,l);if(!s||s.errorID)throw"Edit CR Composition Failure";n.showwarning(v.CfgMessageCRComposeSuccess,"success"),await o.updateCRInfoAfterCRComposition(),_.isCRManuallyComposed=!0,o.sendEventToPSE(s,a)}catch(e){n.showwarning(v.CfgErrorCRComposeFailure,"error")}o.crCompositionDialog.closeDialog()}else o.crCompositionDialog.closeDialog()},className:"primary"},{label:"Cancel",labelValue:v.CfgLabelCancel,handler:function(){o.crCompositionDialog.closeDialog()},className:"secondary"}],d={className:"",title:v.CfgLabelCRComposition,parent:widget.body,body:this.MainContainer,overlay:!0,mode:"DashboardConfigurationContext",closable:!1,animate:!0,resizable:!0,footer:c,persistId:"CfgCRComposition",width:440,height:490,minHeight:100,minWidth:370,style:{"min-height":"350px"},dialogue:{header:l?`${v.CfgLabelCRComposition} - ${l}`:v.CfgLabelCRComposition,buttonArray:c,target:widget.body},touchMode:null!=u.getTouchMode()&&0!=u.getTouchMode()};this.crCompositionDialog=new s(d),this.crCompositionDialog.render(),this.crCompositionDialog.footerButton.Ok.disabled=!0},sendEventToPSE:function(e,t){let i={commandName:"cfgRevManualComposition",widgetId:widget.id,response:e,data:{pids:[t]}};n.publishPostProcessingEventForApplications(i)},updateCRInfoAfterCRComposition:async function(){try{let e={configurationRevisionId:_.crDataJSON.configRevision[0].id},t=await n.getCRInformation(e);t&&t.versions&&(_.isCRChanged=!1,_._getInformationResponse=t,_.computeCRData(t,_.pidsRelatedToFilteredRoot))}catch(e){console.log("Fetching Configuration Revision Details for the selected Configuration Revision in filter is failed")}},computeExistingChildAndParentCRIds:function(e){let t,i;for(let n=0;n<_.crData.length;n++){let o=_.crData[n].children.find(t=>t.ChildPid===e);o&&(t=o.childCrID,i=o.parentCrID)}return[t,i]},subscribeCfgCRCompositionActionEvents:function(){c.cfgCRCompositionActionEvents.subscribe({event:"selectionInCRCompositionDialog"},e=>{_.existingCRId===e.data.nodeModel.options.id?this.crCompositionDialog.footerButton.Ok.disabled=!0:this.crCompositionDialog.footerButton.Ok.disabled=!1}),c.cfgCRCompositionActionEvents.subscribe({event:"unselectionInCRCompositionDialog"},()=>{" "===_.existingCRId?this.crCompositionDialog.footerButton.Ok.disabled=!0:this.crCompositionDialog.footerButton.Ok.disabled=!1})}});return _});