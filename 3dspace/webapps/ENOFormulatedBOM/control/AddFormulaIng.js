define("DS/ENOFormulatedBOM/control/AddFormulaIng",["UWA/Controls/Abstract","DS/ENOFormulatedBOM/view/CreateFormulaIng","DS/ENOFormulatedBOM/view/CreateFormulaIngWithSpecificUnit","DS/ENOFormulatedBOM/service/FPBOMServiceProvider","DS/XSRCommonComponents/utils/XSRSearch","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils"],function(e,t,s,n,l,i,o){"use strict";return e.extend({init:function(e){let t=this;this.appCore=e.appCore,this.currentTabKey=e.currentTabKey,this.container=e.container,this.bomGrid=e.bomGrid,this.specModel=e.specModel,this.modelEvents=e.modelEvents;var s={appCore:this.appCore,currentTabKey:this.currentTabKey,modelContainer:this.container,parentNodeModel:this.specModel};this.formulaService=new n(s),this.promises=e.promises,this.promises&&Promise.allSettled(this.promises).then(e=>{let s=!1,n=!1;e.forEach((e,t)=>{0==t?e.value.results.forEach(e=>{e.path&&e.path.length>=3&&(s=!0)}):1==t&&(n=e.value.result.unitsPresent)}),t.specModel.isHavingWeightChild=s?n:o.isFormulaUnitsEnabled()})},launchAddInstance:function(e){var n=this;var a={allowedTypes:[i.RAW_MATERIAL_TYPE,i.TYPE_FORMULATEDPRODUCT],role:"",criteria:e,precondition:'NOT [current]:"OBSOLETE"',in_apps_callback:function(e){var l={};if(l.appCore=n.appCore,l.parentId=n.specModel.getID(),l.parentTitle=n.specModel.getLabel(),e&&e.length>0){l.createCloseAction=l.createAction=function(e){e&&e.length>0&&n.modelEvents.publish({event:i.EVENT_ADD_FORMULA_INGREDIENT,data:{nodes:e}})};var a=n.createFormulaGridFields(e,l.parentId);o.isFormulaUnitsEnabled()?n.promises?(n.specModel.isHavingWeightChild?new s(l):new t(l)).loadFields(a):0==n.specModel.getAllDescendants().length||0!=n.specModel.getAllDescendants().length&&n.specModel.getAllDescendants()[0].options.grid.unit?new s(l).loadFields(a):0==n.specModel.getAllDescendants().length||n.specModel.getAllDescendants()[0].options.grid.unit||new t(l).loadFields(a):n.promises?(n.specModel.isHavingWeightChild?new s(l):new t(l)).loadFields(a):0==n.specModel.getAllDescendants().length||0!=n.specModel.getAllDescendants().length&&!n.specModel.getAllDescendants()[0].options.grid.unit?new t(l).loadFields(a):0!=n.specModel.getAllDescendants().length&&n.specModel.getAllDescendants()[0].options.grid.unit&&new s(l).loadFields(a)}}};new l(a).launchSearch(a)},createFormulaGridFields:function(e,t){for(var s=[],n=0;n<e.length;n++){var l=[];l.Title=e[n]["ds6w:label"],l.Type=e[n]["ds6w:type"],l.typeDBName=e[n]["ds6w:type_value"],null!=e[n].id&&""!=e[n].id?l.id=e[n].id:null!=e[n].physicalId&&""!=e[n].physicalId&&(l.id=e[n].physicalId),l.parentId=t,l.revision=e[n]["ds6wg:revision"],l.revisionDBName=e[n]["dds6wg:revision_value"],l.maturityNLS=e[n]["ds6w:status"],l.maturityDBName=e[n]["ds6w:status_value"],s.push(l)}return s}})});