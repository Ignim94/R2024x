define("DS/ENOFormulatedBOM/service/FPBOMServiceProvider",["UWA/Class","UWA/Promise","DS/XSRCommonComponents/utils/RequestUtil","DS/ENOFormulatedBOM/util/Constants","DS/XSRCommonComponents/utils/ItemServiceProvider","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/ENOFormulatedBOM/assets/nls/FormulaBOM"],function(e,t,n,r,o,a,s,u){"use strict";return e.extend({init:function(e){e&&(this.currentTabKey=e.currentTabKey,this.appCore=e.appCore,this.myModelConatiner=e.modelContainer,this.parentNodeModel=e.parentNodeModel),this.platFormId=n.getPlatformId(),this.CSRFToken=n.get3DSpaceCSRFToken(),this.SC=n.getSecurityContext(),this.isChangeControlled=!(!e||!e.isChangeControlled),[...s.rawMaterialArray].reduce((e,t)=>(e[t.valueItem]=t.labelItem,e),{}).Formulated_Product=u.label_FRMProduct},getHeaders:function(e){var t={"Content-type":"application/json"};return this.isChangeControlled&&Object.assign(t,n.getWorkUnderHeaders()),e&&Object.keys(e).forEach(n=>{t[n]=e[n]}),t},createFormulatedProduct:function(e){var o=this,a=JSON.stringify(e.data);return new t(function(e,t){n.send3DSpaceRequest(r.FP_BASE_URL+"formulatedproduct","POST",{type:"json",headers:o.getHeaders(),data:a},e,t)})},createFormulaIng:function(e,o){var a=this,s=JSON.stringify(e);return new t(function(e,t){n.send3DSpaceRequest(r.FP_BASE_URL+"formulatedproduct/"+o+"/continousquantites","POST",{type:"json",headers:a.getHeaders(),data:s},e,t)})},getFormulatedProduct:function(e){return new t(function(t,o){n.send3DSpaceRequest(r.FP_BASE_URL+"getDetails?objectPID"+e,"GET",t,o)})},updateFormulatedProduct:function(e,o){let a=this;var s=o.getInstanceId(),u=o.getParentId();return new t(function(t,o){n.send3DSpaceRequest(r.FP_BASE_URL+"/formulatedproduct/"+u+"/instances/"+s,"PUT",{type:"json",headers:a.getHeaders({ENO_CSRF_TOKEN:a.CSRFToken,SecurityContext:a.SC}),data:UWA.Json.encode(e)},t,o)})},getTotalTargetQuantity:function(e,o){let a=this;var s=o.getID();return new t(function(t,o){n.send3DSpaceRequest(r.FP_BASE_URL+"formulatedproduct/"+s+"/target-quantity-rollup","POST",{type:"json",headers:a.getHeaders({ENO_CSRF_TOKEN:a.CSRFToken,SecurityContext:a.SC}),data:UWA.Json.encode(e)},t,o)})},getFRMContQtyInstances:function(e,o){var a=this,s={instanceIds:e};return new t(function(e,t){n.send3DSpaceRequest(r.FP_BASE_URL+"formulatedproduct/"+o+"/instances","POST",{type:"json",headers:a.getHeaders({ENO_CSRF_TOKEN:a.CSRFToken,SecurityContext:a.SC}),data:UWA.Json.encode(s)},e,t)})},gateMaturity:function(e){return(new o).gateMaturityNPolicy(e)},updateRefBatchSize:function(e){var o=this;return new t(function(t,a){n.send3DSpaceRequest(r.FP_BASE_URL+"formulatedproduct/"+e.objectID+"/batchsize","POST",{type:"json",headers:o.getHeaders({ENO_CSRF_TOKEN:o.CSRFToken,SecurityContext:o.SC}),data:UWA.Json.encode(e)},t,a)})},expand:function(e,t){return(new o).expand(e,void 0,t)},fetchAlternateInfo:function(e){if(!Array.isArray(e))throw new Error("fetchData need an array as input");var n={referenceIds:e};return new t(function(e,t){(new o).getAlternateInfo(n).then(function(t){e(t)}).catch(function(e){return t(e)})})},fetchItemInfo:function(e){return new t(function(t,n){(new o).fetchItemData(e,null).then(function(e){let n=e.results[0].attributes.reduce((e,t)=>(e[t.name]=t.value,e),{});t(n)}).catch(function(e){console.warn(e)})}).catch(function(e){console.warn(e)})},updateAndSyncAttributes:function(e,n,s,u,i){var c={itemid:e,request:n,isRelorBus:u,relId:s.getInstanceId(),nodeModel:s,customAttribute:i};return new t(function(e,t){new o({isChangeControlled:!0}).updateAttributes(c).then(function(n){if(n.results&&n.results.length>0)for(var o=n.results,u=0;u<o.length;u++){if(200===o[u].status){var i=o[u].body;if(i.errors&&i.errors.length>0)t(i.errors);else{for(var c in i){var d=Array.isArray(i[c].value)?i[c].value[0]:i[c].value;r.ITEM_DESCRIPTION_SELECTABLE===c&&(s.options.grid["ds6w:description"]=d),"modified"===c&&(s.options.grid["ds6w:modified"]=a.getformatedDate(d)),r.ITEM_V_NAME_SELECTABLE===c&&s.setTitle(d)}s.updateOtherDetails(),e(s)}}else t()}}).catch(function(e){console.log(e)})})}})});