define("DS/ENOFormulatedBOM/view/CreateFormulaIng",["UWA/Core","UWA/Controls/Abstract","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/Controls/Tab","DS/XSRCommonComponents/createform/view/NewDialog","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/Constants","DS/ENOFormulatedBOM/service/FPBOMServiceProvider","text!DS/ENOFormulatedBOM/assets/config/AddFormulaIngColumnConfig.json","i18n!DS/ENOFormulatedBOM/assets/nls/FormulaBOM"],function(e,t,o,n,r,i,d,a,l,s,c,g,p,m,u){"use strict";return t.extend({target:null,options:null,dialog:null,dataGridView:null,init:function(e){this._parent(e),this.basicModelEvents=e.appCore.basicModelEvents,this.target=e.appCore.specMainContainer,this.createCloseAction=e.createCloseAction,this.parentId=e.parentId,this.parentTitle=e.parentTitle,this.frmService=new p},loadFields:function(e){this.container=widget.body,s.maskLoader(this.container);var t=e;this.initDetailedView(t)},initDetailedView:function(t){var o=this;this.inputData=[];var n=this.options;n.Title=u.label_addFormulatedProd+" | "+this.parentTitle,n.width=1e3,n.height=250,n.renderTo=this.target,n.Content=this.getUIContainer(t),n.OKLabel=u.label_add,n.RemoveApplyButton=!0,s.unmaskLoader(this.getUIContainer(t)),this.dialog=new l(n),this.dialog.destroyPrevDialog(),this.dialog.render(),o.dialog._dialog.buttons.Ok.disabled=!0,s.unmaskLoader(this.container);this.dialog.listenTo(this.dialog,"EVENT_CLICK_SPEC_OK",function(){o.dialog._dialog.buttons.Ok.disabled=!0;let t=function(){let e=o.dataGridView,t=[];return e.getTreeDocument().getChildren().forEach(function(e){let o={};o.id=e.options.grid.id,o.minPercent=e.options.grid.minPercent,o.maxPercent=e.options.grid.maxPercent,o.targetPercent=e.options.grid.targetPercent,o.lossPercent=e.options.grid.lossPercent,o.isQS=e.options.grid.isQS,o.parentId=e.options.grid.parentId,t.push(o)}),t}(),n=[],r={},l="";for(var s=0;s<t.length;s++){var g={};g.id=t[s].id,g.minPercent=t[s].minPercent,g.maxPercent=t[s].maxPercent,g.targetPercent=t[s].targetPercent,g.lossPercent=t[s].lossPercent?t[s].lossPercent:"",g.isQS=t[s].isQS,n.push(g)}l=t[0].parentId,r.children=n,o.frmService.createFormulaIng(r,l).then(function(t){o.dialog._dialog.buttons.Ok.disabled=!1,o._closeDialog();let n=[];for(let e=0;e<t.result.length;e++)if(0==t.result[e].isConnected)o.notify("error",t.result[e].instanceDetails.message);else{let o=t.result[e].instanceDetails;n.push(o)}if(o.fetchFiInfo(n),0!==n.length){var r=new e.createElement("div",{class:"xsr-Success-report"}),l=new e.createElement("ul",{});for(s=0;s<n.length;s++){let t=n[s].child.title;e.createElement("li",{text:u.replace(u.get("FRMIngSuccessMSG"),{childItem:t,parentItem:o.parentTitle})}).inject(l)}l.inject(r);var c=new a({displayStyle:"strip"});c.add({label:"Success ("+n.length+")",isSelected:!0,content:r});var g=new e.createElement("div",{id:"container"});g.inject(o.options.renderTo);var p=new e.Element("div",{class:"xsr-dialog-immersiveframe"}).inject(g),m=new i;m.inject(p);new d({immersiveFrame:m,title:u.ReportTitle,content:c,position:{my:"center",at:"center",of:m},width:600})}}).catch(function(e){null==e&&c.displayNotification({eventID:"error",msg:u.replace(u.get(u.Error_AddCQ),{parentItem:o.parentTitle})}),c.displayNotification({eventID:"error",msg:e.result?e.result.message.trim()===u.Continous_Qunat_Template_Error?u.Continous_No_Access:e.result.message:u.Error_AddCQ}),o._closeDialog()})})},_closeDialog:function(){var e=this.dialogContainer?this.dialogContainer:this.target;s.unmaskLoader(e),this.dialog.closeDialog()},fetchFiInfo:function(e){this.createCloseAction&&this.createCloseAction(e)},getUIContainer:function(t){for(var i=this,d=new o,a=[],l=0;l<t.length;l++){var s={Title:t[l].Title,type:t[l].Type,id:t[l].id,parentId:t[l].parentId,"ds6wg:revision":t[l].revision,"ds6w:status":t[l].maturityNLS,minPercent:void 0,maxPercent:void 0,targetPercent:void 0,lossPercent:void 0,isQS:!1};a.push(s)}d.prepareUpdate(),a.forEach(function(e){var t=new n({label:e.Text,grid:e});d.addRoot(t)}),d.pushUpdate();var c=e.createElement("div",{class:"xsr-continousQty-container"}),p=e.createElement("div",{class:"xsr-Formula-mandDiv"}).inject(c,"top");e.Element("span",{class:"xsr-mandatory-flag-title",text:"* "}).inject(p),e.createElement("span",{text:u.FormulaIngMand}).inject(p);var P=e.createElement("div",{class:"xsr-contQty-grid"}),M=JSON.parse(m).columns,h=this.getNLSLabels(M);h&&h.forEach(function(e){e.text=e.text,"FormulaQunatityPercent"==e.dataIndex&&e.children.forEach(function(e){"minPercent"!==e.dataIndex&&"maxPercent"!==e.dataIndex&&"targetPercent"!==e.dataIndex||(e.getCellSemantics=function(e){if(e.nodeModel)return{pattern:g.MIN_MAX_TARGET_PATTERN}}),"lossPercent"===e.dataIndex&&(e.getCellSemantics=function(e){if(e.nodeModel)return{pattern:g.LOSS_PATTERN}}),"minPercent"===e.dataIndex&&(e.getCellValue=function(e){let t="";return e.nodeModel&&(t=e.nodeModel.getAttributeValue("minPercent")),t}),"maxPercent"===e.dataIndex&&(e.getCellValue=function(e){if(e.nodeModel)return e.nodeModel.options.grid.maxPercent})})}),i.dataGridView=new r({treeDocument:d,columns:h,showModelChangesFlag:!0,showTreeIconsFlag:!0,showRowBorderFlag:!0,showNodeKPIColorFlag:d.isColorized,cellSelection:"multiple",rowSelection:"none"});var f=[];return i.dataGridView.addEventListener("change",function(e,t){let o=!1;null!=t&&(t.nodeModel.options.grid.targetPercent&&(isNaN(parseFloat(t.nodeModel.options.grid.targetPercent))||0>parseFloat(t.nodeModel.options.grid.targetPercent)||100<parseFloat(t.nodeModel.options.grid.targetPercent))&&(0!=f.length&&null!=f[t.rowID]&&null!=f[t.rowID].target?t.nodeModel.options.grid.targetPercent=f[t.rowID].target:t.nodeModel.options.grid.targetPercent=void 0,i.notify("error",u.replace(u.get(u.UpdateErr),{columnName:u.Target}))),t.nodeModel.options.grid.minPercent&&(isNaN(parseFloat(t.nodeModel.options.grid.minPercent))||0>parseFloat(t.nodeModel.options.grid.minPercent)||100<parseFloat(t.nodeModel.options.grid.minPercent))&&(0!=f.length&&null!=f[t.rowID]&&null!=f[t.rowID].min?t.nodeModel.options.grid.minPercent=f[t.rowID].min:t.nodeModel.options.grid.minPercent=void 0,i.notify("error",u.replace(u.get(u.UpdateErr),{columnName:u.Min}))),t.nodeModel.options.grid.maxPercent&&(isNaN(parseFloat(t.nodeModel.options.grid.maxPercent))||0>parseFloat(t.nodeModel.options.grid.maxPercent)||100<parseFloat(t.nodeModel.options.grid.maxPercent))&&(0!=f.length&&null!=f[t.rowID]&&null!=f[t.rowID].max?t.nodeModel.options.grid.maxPercent=f[t.rowID].max:t.nodeModel.options.grid.maxPercent=void 0,i.notify("error",u.replace(u.get(u.UpdateErr),{columnName:u.Max}))),t.nodeModel.options.grid.lossPercent&&(isNaN(parseFloat(t.nodeModel.options.grid.lossPercent))||0>parseFloat(t.nodeModel.options.grid.lossPercent))&&(0!=f.length&&null!=f[t.rowID]&&null!=f[t.rowID].loss?t.nodeModel.options.grid.lossPercent=f[t.rowID].loss:t.nodeModel.options.grid.lossPercent=void 0,i.notify("error",u.lossUpdateErr)),null!=t.nodeModel.options.grid.targetPercent&&(t.nodeModel.options.grid.maxPercent||(t.nodeModel.options.grid.maxPercent=t.nodeModel.options.grid.targetPercent),t.nodeModel.options.grid.minPercent||(t.nodeModel.options.grid.minPercent=t.nodeModel.options.grid.targetPercent)),"minPercent"==i.dataGridView.getColumnOrGroup(t.columnID).dataIndex&&t.nodeModel.options.grid.minPercent&&(t.nodeModel.options.grid.targetPercent&&parseFloat(t.nodeModel.options.grid.minPercent)>parseFloat(t.nodeModel.options.grid.targetPercent)||t.nodeModel.options.grid.maxPercent&&parseFloat(t.nodeModel.options.grid.minPercent)>parseFloat(t.nodeModel.options.grid.maxPercent))&&(t.nodeModel.options.grid.minPercent=f[t.rowID].min,t.nodeModel.options.grid.maxPercent=f[t.rowID].max,t.nodeModel.options.grid.targetPercent=f[t.rowID].target,i.notify("error",u.minPer_UpdateErr)),"maxPercent"==i.dataGridView.getColumnOrGroup(t.columnID).dataIndex&&t.nodeModel.options.grid.maxPercent&&(t.nodeModel.options.grid.targetPercent&&parseFloat(t.nodeModel.options.grid.targetPercent)>parseFloat(t.nodeModel.options.grid.maxPercent)||t.nodeModel.options.grid.minPercent&&parseFloat(t.nodeModel.options.grid.minPercent)>parseFloat(t.nodeModel.options.grid.maxPercent))&&(t.nodeModel.options.grid.minPercent=f[t.rowID].min,t.nodeModel.options.grid.maxPercent=f[t.rowID].max,t.nodeModel.options.grid.targetPercent=f[t.rowID].target,i.notify("error",u.maxPer_UpdateErr)),"targetPercent"==i.dataGridView.getColumnOrGroup(t.columnID).dataIndex&&t.nodeModel.options.grid.targetPercent&&(t.nodeModel.options.grid.minPercent&&parseFloat(t.nodeModel.options.grid.minPercent)>parseFloat(t.nodeModel.options.grid.targetPercent)||t.nodeModel.options.grid.maxPercent&&parseFloat(t.nodeModel.options.grid.targetPercent)>parseFloat(t.nodeModel.options.grid.maxPercent))&&(t.nodeModel.options.grid.minPercent=f[t.rowID].min,t.nodeModel.options.grid.maxPercent=f[t.rowID].max,t.nodeModel.options.grid.targetPercent=f[t.rowID].target,i.notify("error",u.targetPer_UpdateErr)),i.dataGridView.getTreeDocument().getChildren().forEach(function(e){if(e.options.grid.id===t.nodeModel.options.grid.id){var n={};n.min=t.nodeModel.options.grid.minPercent,n.max=t.nodeModel.options.grid.maxPercent,n.target=t.nodeModel.options.grid.targetPercent,n.loss=t.nodeModel.options.grid.lossPercent,f[t.rowID]=n,e.options.grid=t.nodeModel.options.grid}e.options.grid.minPercent&&e.options.grid.maxPercent&&e.options.grid.targetPercent||(o=!0)}),i.dialog._dialog.buttons.Ok.disabled=!!o),t.nodeModel.updateOptions(t.nodeModel.options)}),i.dataGridView.inject(P),P.inject(c),c},isOnlyPhysicalProducts:function(e){for(var t=0;t<e.length;t++)if(e[t].DimensionType)return!1;return!0},getNLSLabels:function(e){var t=e;if(t){var o=function(e){for(var t=0;t<e.length;t++)e[t].text=e[t].text&&u[e[t].text]?u[e[t].text]:e[t].text,e[t].children&&o(e[t].children)};o(t)}return t},notify:function(e,t){c.displayNotification({eventID:e,msg:t})}})});