define("DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent",["DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/WAfrHandlers/mod_HandlerComponent","DS/CoreEvents/ModelEvents","DS/CoreEvents/Events","DS/CoreUtilities/ErrorManagement","UWA/Class/Promise","DS/WAfrDebug/mod_Performances"],function(e,n,a,t,r,d,c){"use strict";const i={DYNAMIC_COMMAND_CANCELED:"Dynamic Command Canceled",COMPUTE_COMMAND_MODE_FAILED:"Dynamic Command Mode computation failed",CLIENT_COMPUTE_COMMAND_MODE_FAILED:"Applicative Code for Dynamic Command Mode computation failed"};let m=[r.generateReturnValue("COMMAND_NOT_STARTED",!1)],o=r.getErrorManager(m,{merge:!1});var l={exclusiveCmdCalled:0,secondExecuteCalled:1,killedByInfra:2,askedByCmd:3},s=!1;function _(e,n){s&&console.log(n+" : "+e)}let u=!1;function p(e){if(e.commandHandlerId){if(!e.executionCtx)throw new Error("mod_commandsManagerComponent.js cannot execute a command without an execution context");var a=e.executionCtx.getComponent(n.DEFAULT_COMPONENT_NAME);if(!a)throw new Error("mod_commandsManagerComponent.js cannot execute a command without a handler component registered on the execution context");a.executeHandler({id:e.commandHandlerId})}}function v(n){if(n.cmdsManager._private._runningCmd)throw new Error("CmdsManager.runNextCmd a command is already running");if(n.cmdsManager._private._currentExecutionDone){var a;if(n.cmdsManager._private._executionChain.length>0&&(a=n.cmdsManager._private._executionChain[0].caller.cmdHandler),n.cmdsManager._private._pausedCmds.length>0&&(!n.cmdsManager._private._waitingExecution||a===n.cmdsManager._private._pausedCmds[0]||a.getMode()!==e.CmdMode.NESTED)){var t=Object.create(null);return t.cmdsManager=n.cmdsManager,t.cmdHandler=n.cmdsManager._private._pausedCmds.pop(),void function(n){_("resume",n.cmdHandler.getId()),n.cmdHandler.setStateAndSendEvent({state:e.HandlerState.EXECUTING,event:e.LifeCycleEvents.RESUME}),n.cmdsManager._private._runningCmd=n.cmdHandler,n.cmdHandler._private._command._instance.resumeExecute?(n.cmdHandler._private._command._instance.done=y.bind(n),h({callback:n.cmdHandler._private._command._instance.resumeExecute,caller:n.cmdHandler._private._command._instance})):h({callback:y,caller:n});h({callback:function(){n.cmdsManager._private._currentExecutionDone&&C(n.cmdHandler)&&x.call(n.cmdsManager)}}),n.cmdsManager._private._modelEvents.publish({event:n.cmdHandler.getId()+"/resume"}),n.cmdsManager._private._modelEvents.publish({event:"resume",data:n.cmdHandler.getId()})}(t)}if(0===n.cmdsManager._private._waitingExecution&&n.cmdsManager._private._currentExecutionDone){var r=n.cmdsManager.getDefaultCommand();r&&p({commandHandlerId:r,executionCtx:n.cmdsManager.getExecutionContext()})}setTimeout(function(){n.cmdsManager._private._waitingExecution||n.cmdsManager._private._executionChain.length>0?x.call(n.cmdsManager):n.cmdsManager._private._currentExecution&&n.cmdsManager._private._currentExecutionDone&&(n.cmdsManager._private._currentExecution=null)},0)}}function C(n){return n.getState()===e.HandlerState.EXECUTING}var g=new Array(50),E=0;function M(){for(var e=0;e<E;e+=3){var n=g[e],a=g[e+1],t=g[e+2];n.call(a,t),g[e]=void 0,g[e+1]=void 0,g[e+2]=void 0}E=0}function h(e){g[E]=e.callback,g[E+1]=e.caller,g[E+2]=e.arg,3===(E+=3)&&setTimeout(M,0)}function H(e){if(!e.caller.cmdsManager._private._currentExecutionDone)throw new Error("begin forbidden");return e.caller.cmdsManager._private._waitingExecution--,e.caller.cmdsManager._private._currentExecutionDone=!1,setTimeout(function(){e.callback.call(void 0,e.caller)},0),e.caller}function f(n){var a;if(n.caller.cmdHandler.getState()!==e.HandlerState.PAUSED)return n.caller.cmdsManager._private._runningCmd&&n.caller.cmdsManager._private._runningCmd!==n.caller.cmdHandler&&C(n.caller.cmdsManager._private._runningCmd)&&(n.caller.cmdsManager._private._waitingExecution++,(a=Object.create(null)).caller=Object.create(null),a.caller.cmdsManager=n.caller.cmdsManager,a.caller.cmdHandler=n.caller.cmdsManager._private._runningCmd,n.caller.cmdHandler.getMode()===e.CmdMode.EXCLUSIVE||!0===n.caller.cmdsManager._private._runningCmd._private._command._instance.cancelWhenPaused?(a.callback=N,a.caller.cmdHandler._private._command._instance.params=Object.create(null),a.caller.cmdHandler._private._command._instance.params.cancelReason=l.exclusiveCmdCalled):n.caller.cmdHandler.getMode()===e.CmdMode.NESTED&&(a.callback=S)),a}function x(){return new Promise((n,a)=>{if(!this._private._currentExecutionDone)return n();if(this._private.executionChaining)return n();if(0===this._private._executionChain.length)return this._private._waitingExecution=0,this._private._executionChain=[],this._private._currentExecution=null,this._private._currentExecutionDone=!0,this._private._runningCmd||v({cmdsManager:this,cmdHandler:void 0}),n();{let t=Promise.resolve();const r=this._private._executionChain[0];if(r.caller.cmdHandler.isDynamic()&&!r.caller.cmdHandler._private._command._dynamicModeComputed){void 0===r.caller.cmdsManager._private._uExecID&&(r.caller.cmdsManager._private._uExecID=0);const n=r.caller.cmdsManager._private._uExecID;r.caller.cmdsManager._private._uExecID++,r.caller.cmdsManager._private._currentComputations||(r.caller.cmdsManager._private._currentComputations=new Map),r.caller.cmdsManager._private._currentComputations.set(n,t),this._private._executionChain[0].caller.cmdHandler.setStateAndSendEvent({state:e.HandlerState.COMPUTING,event:e.LifeCycleEvents.COMPUTE}),r.caller.cmdHandler._private._command._dynamicModeComputed=!0,t=D(r),r.caller.cmdsManager._private._modelEvents.publish({event:r.caller.cmdHandler.getId()+"/compute"})}t.then(()=>{if(0===this._private._executionChain.length)return n();let e=f(this._private._executionChain[0]);return e||(e=this._private._executionChain.shift()),this._private._currentExecution=H(e),n()}).then(()=>{r.caller.cmdsManager._private._currentComputations&&r.caller.cmdsManager._private._currentComputations.delete(currExecID)}).catch(e=>e.cause?a(e):a(new Error(e,{cause:i.COMPUTE_COMMAND_MODE_FAILED})))}})}function D(n){const a=new(0,c.Performances),t=a.start("[DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent::ComputeCmdMode]");if(!n.caller||!n.caller.cmdsManager||!n.caller.cmdHandler)return Promise.reject(new Error("pauseCmd requires the parameter caller with a valid cmdsManager and cmdHandler with a valid command instance"));return new Promise((r,d)=>{if(n.caller.cmdHandler._private._command._dynamicModeModule&&n.caller.cmdHandler._private._command._dynamicModeFunction)require([n.caller.cmdHandler._private._command._dynamicModeModule],function(c){if(!c)return d(new Error("Call to "+n.caller.cmdHandler._private._command._dynamicModeMod+" constructor returned undefined"));{const m=n.caller.cmdHandler._private._command._dynamicModeFunction,o=c;if(!o)return d(new Error("Unable to retrieve Dynamic Mode ctor : "+n.caller.cmdHandler._private._command._dynamicModeModule+" in Dynamic Mode Module : "+m));let l=null;const s=n.caller.cmdsManager.getExecutionContext();s&&((l=s.applicationContext).ID=n.caller.cmdsManager._private._executionContext.getId());let _=new o;if(!_[m])return d(new Error("Invalid function name for Dynamic Mode computation"));const u=e.CmdMode;let p=_[m](l,u);a.stop(t),p.then(a=>Object.values(e.CmdMode).includes(a)?(n.caller.cmdHandler.setMode(a),r(a)):d(new Error("Invalid return type for Dynamic Mode. Please check doc to see valid types."))).catch(e=>d(new Error(e,{cause:i.CLIENT_COMPUTE_COMMAND_MODE_FAILED})))}},function(){return d(new Error("Require to "+n.caller.cmdHandler._private._command._dynamicModeMod+" has failed."))});else{if(n.caller.cmdHandler._private._command._dynamicModeModule&&n.caller.cmdHandler._private._command._dynamicModeFunction)return d(new Error("Missing dynamic mode module in commandHandler parameters."));if(n.caller.cmdHandler._private._command._dynamicModeModule&&!n.caller.cmdHandler._private._command._dynamicModeFunction)return d(new Error("Missing dynamic mode function in commandHandler parameters."))}})}function b(){this.cmdHandler._private._command._instance.done=function(){},_("paused",this.cmdHandler.getId()),this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/paused"}),this.cmdsManager._private._modelEvents.publish({event:"paused",data:this.cmdHandler.getId()}),this.cmdsManager._private._runningCmd=null,this.cmdsManager._private._currentExecution&&(this.cmdsManager._private._currentExecutionDone=!0);var e=this;setTimeout(function(){x.call(e.cmdsManager)},0)}function S(n){if(!n||!n.cmdsManager||!n.cmdHandler)throw new Error("pauseCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance");if(n.cmdsManager._private._unstackingCommand&&n.cmdsManager._private._unstackingCommand.length>0)return n.cmdsManager._private._currentExecutionDone=!0,n.cmdsManager._private._unstackingCommand=[],void setTimeout(function(){x.call(n.cmdsManager)},0);C(n.cmdHandler)&&(_("pause",n.cmdHandler.getId()),n.cmdsManager._private._modelEvents.publish({event:n.cmdHandler.getId()+"/pause"}),n.cmdsManager._private._modelEvents.publish({event:"pause",data:n.cmdHandler.getId()}),n.cmdHandler.setStateAndSendEvent({state:e.HandlerState.PAUSED,event:e.LifeCycleEvents.PAUSE}),n.cmdsManager._private._pausedCmds.push(n.cmdHandler),n.cmdHandler._private._command._instance.pauseExecute?(n.cmdHandler._private._command._instance.done=b.bind(n),h({callback:n.cmdHandler._private._command._instance.pauseExecute,caller:n.cmdHandler._private._command._instance})):h({callback:b,caller:n}))}function A(n){var a,t=this.cmdsManager.getExecutionContext();if(t){var d=t.getComponent("AFR_UndoRedoComponent");d&&!0===this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested&&(d._stopConcatenateUS(this.cmdsManager._private._runningCmd._private._command._instance._undoGroupID),this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested=!1);var c=this.cmdsManager._private._runningCmd._private._command._instance;if(a=function(e){var n=!1;if(!e._dirtyUndoStack)return n;var a=this.cmdsManager.getExecutionContext(),t=a.getComponent("AFR_UndoRedoComponent");if(t){var d=t.getLastStepId();if(e._previousUndoId<d){var c=!0;"shared"===e._mode&&e._executeUndoAtEnd&&(c=!1);var i=t._createUndoStep({undoTitle:e.getId(),exclusivity:c,redoEnabled:!e._executeUndoAtEnd});t.registerAction(i);var m=t.groupSteps(i.getId(),e._previousUndoId+1,a);if(r.hasSucceeded(m))n=!0;else{var o=t.removeStepWithId(t.getLastStepId());r.hasSucceeded(o)||r.logResult(o)}}}return n}.call(this,c),c.params&&c.params.undoOnEnd&&a){var i=!1;this.cmdsManager&&"WAFRRedoCmd"===this.cmdsManager.getRunningCommand()&&(i=!0),0===d.getUndoStack().getSize()||i||d.undo()}this.cmdsManager._private._runningCmd=null,this.cmdsManager._private._currentExecution&&(this.cmdsManager._private._currentExecutionDone=!0);var m=this.cmdHandler.getState()===e.HandlerState.CANCELED,o=this.cmdHandler.getRepeatMode()===e.RepeatMode.ALWAYS&&!m&&0===this.cmdsManager._private._waitingExecution;if(this.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDED,event:e.LifeCycleEvents.END,repeated:o,canceled:m}),_("end",this.cmdHandler.getId()),this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/end",data:{repeated:o,canceled:m}}),this.cmdsManager._private._modelEvents.publish({event:"end",data:{handlerId:this.cmdHandler.getId(),repeated:o,canceled:m}}),this.cmdHandler._private._cb&&"function"==typeof this.cmdHandler._private._cb&&(this.cmdHandler._private._cb(n?n.error:void 0),o||(this.cmdHandler._private._appCB=[],this.cmdHandler._private._cbIfCommandNotStarted=null)),this.cmdHandler._private._command._instance.destroy&&this.cmdHandler._private._command._instance.destroy(),this.cmdHandler._private._command._instance.stateGraph&&this.cmdHandler._private._command._instance._clearGraph(),this.cmdHandler._private._command._instance=null,this.cmdHandler._private._command._dynamicModeComputed=null,o)this.cmdHandler.execute(),x.call(this.cmdsManager);else{var l=this;setTimeout(function(){l.cmdsManager._private._runningCmd||v(l)},0)}}}function I(n){n&&n.undoOnEnd&&(this.cmdsManager._private._runningCmd._private._command._instance.params||(this.cmdsManager._private._runningCmd._private._command._instance.params={}),this.cmdsManager._private._runningCmd._private._command._instance.params.undoOnEnd=n.undoOnEnd);var a=this.cmdsManager.getExecutionContext();if(this.cmdHandler._private._command._instance.done=function(){},this.cmdHandler.getState()!==e.HandlerState.CANCELED&&this.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDING}),this.cmdHandler.isUsingComputeServer()){var t={from:this.cmdHandler._private._command._instance},r=a.getComponent("AFR_CSComponent");r&&r.sendStopCommand(t)}else{var d=this;setTimeout(function(){A.call(d,n)},0)}}function y(e){this.cmdHandler._private._command._instance.done=function(){},this.cmdsManager._private._runningCmd===this.cmdHandler&&C(this.cmdHandler)?(e&&e.error&&(this.cmdHandler._private._command._instance.params.error=e.error),e&&e.cancel?(this.cmdHandler._private._command._instance.params.cancelReason=l.askedByCmd,e.undoOnEnd&&(this.cmdHandler._private._command._instance.params.undoOnEnd=e.undoOnEnd),N(this)):I.call(this)):_("done execute callback called but command paused/canceled in between",this.cmdHandler.getId())}function w(e){if(!(e&&e.cmdsManager&&e.cmdHandler&&e.cmdHandler._private._command._instance&&e.cmdHandler._private._cb&&e.cmdHandler._private._cb))throw new Error("executeCmd require the parameter capsuleObject with a valid CommandsManager and cmdHandler with a valid command instance");if(_("begin",e.cmdHandler.getId()),e.cmdsManager._private._modelEvents.publish({event:e.cmdHandler.getId()+"/begin"}),e.cmdsManager._private._modelEvents.publish({event:"begin",data:e.cmdHandler.getId()}),e.cmdsManager._private._runningCmd=e.cmdHandler,!e.cmdHandler._private._command._instance.beginExecute&&!0!==e.cmdHandler._private._command._instance.stateGraph)throw new Error("mod_CommandsManagerComponent.executeCmd : Cannot execute a command without a beginExecute method defined on it. It has no sense. BAD Command : "+e.cmdHandler._private._command._module);var n=e.cmdsManager.getExecutionContext(),a=n.getComponent("AFR_UndoRedoComponent");if(a&&(e.cmdHandler._private._command._instance._previousUndoId=a.getLastCreatedUndoStepId()),e.cmdHandler.isUsingComputeServer()){var t={from:e.cmdHandler._private._command._instance},r=n.getComponent("AFR_CSComponent");r&&r.sendStartCommand(t)}!0!==e.cmdHandler._private._command._instance.stateGraph?(e.cmdHandler._private._command._instance.done=y.bind(e),h({callback:e.cmdHandler._private._command._instance.beginExecute,caller:e.cmdHandler._private._command._instance})):(!0===e.cmdHandler._private._command._instance.asyncGraph?e.cmdHandler._private._command._instance.done=function(){this.cmdHandler._private._command._instance.done=y.bind(this),this.cmdsManager._private._runningCmd===this.cmdHandler&&C(this.cmdHandler)?h({callback:this.cmdHandler._private._command._instance._initGraph,caller:this.cmdHandler._private._command._instance}):_("done execute callback called but command paused/canceled in between",this.cmdHandler.getId())}.bind(e):e.cmdHandler._private._command._instance.done=y.bind(e),h({callback:e.cmdHandler._private._command._instance.buildGraph,caller:e.cmdHandler._private._command._instance}),!0!==e.cmdHandler._private._command._instance.asyncGraph&&h({callback:e.cmdHandler._private._command._instance._initGraph,caller:e.cmdHandler._private._command._instance})),e.cmdsManager._private._currentExecution&&(e.cmdsManager._private._currentExecutionDone=!0),h({callback:function(){e.cmdsManager._private._currentExecutionDone&&C(e.cmdHandler)&&x.call(e.cmdsManager)}})}function N(n){if(!(n&&n.cmdsManager&&n.cmdHandler&&n.cmdHandler._private._cb))throw new Error("cancelCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance");C(n.cmdHandler)&&(n.cmdHandler.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL}),_("canceling",n.cmdHandler.getId()),n.cmdsManager._private._modelEvents.publish({event:n.cmdHandler.getId()+"/canceling"}),n.cmdsManager._private._modelEvents.publish({event:"canceling",data:n.cmdHandler.getId()}),n.cmdHandler._private._command._instance.cancelExecute?(n.cmdHandler._private._command._instance.done=I.bind(n),h({callback:n.cmdHandler._private._command._instance.cancelExecute,caller:n.cmdHandler._private._command._instance,arg:n.cmdHandler._private._command._instance.params})):h({callback:I,caller:n}))}var O=Object.create(null);return O.CommandsManagerComponent=function(){var e=this;this._private||(this._private=Object.create(null)),this._private._defaultCommand=null,this._private._runningCmd=null,this._private._pausedCmds=[],this._private._executionChain=[],this._private._currentExecution=null,this._private._currentExecutionDone=!0,this._private._waitingExecution=0,this._private._modelEvents=new a,t.subscribe({event:"COMMAND_MANAGER/Ending_Commands"},function(){e.endAll(void 0)})},O.CommandsManagerComponent.DEFAULT_COMPONENT_NAME="AFR_CommandsManager",O.CommandsManagerComponent.prototype.initialize=function(e){return u=!1,e&&this.cmdsManager.getExecutionContext().setContext("usingCS",!0),d.resolve()},O.CommandsManagerComponent.prototype.clean=function(){var e=this;u=!0;let n=[];this._private._currentComputations&&this._previousUndoId._currentComputations.forEach(e=>{n.push(e)}),Promise.allSettled(n).then(()=>this.endAll().then(function(){e.setDefaultCommand(null)}))},O.CommandsManagerComponent.prototype.isCmdExecuting=function(n){return n.getState()===e.HandlerState.EXECUTING},O.CommandsManagerComponent.prototype.setDefaultCommand=function(e){if(void 0===e||e&&"string"!=typeof e)throw new Error("CommandsManagerComponent.setDefaultCommand can only take null or a string (commandHandlerID) as input parameter");e&&null===this._private._runningCmd&&0===this._private._pausedCmds.length&&0===this._private._waitingExecution&&this._private._currentExecutionDone&&p({commandHandlerId:e,executionCtx:this._private._executionContext});this._private._defaultCommand=e},O.CommandsManagerComponent.prototype.getDefaultCommand=function(){return this._private._defaultCommand},O.CommandsManagerComponent.prototype.subscribeToCmdState=function(e,n,a){var t;return t=""===e?n:e+"/"+n,this._private._modelEvents.subscribe({event:t},function(e){a(e)})},O.CommandsManagerComponent.prototype.subscribeOnceToCmdState=function(e,n,a){var t;return t=""===e?n:e+"/"+n,this._private._modelEvents.subscribeOnce({event:t},function(e){a(e)})},O.CommandsManagerComponent.prototype.unsubscribeToCmdState=function(e){this._private._modelEvents.unsubscribe(e)},O.CommandsManagerComponent.prototype.getRunningCommand=function(){return this._private._runningCmd?this._private._runningCmd.getId():null},O.CommandsManagerComponent.prototype.getExposedComponentCtor=function(){function e(){this.cancelReason=l}return e.prototype.getDefaultCommand=this.getDefaultCommand.bind(this),e.prototype.getRunningCommand=this.getRunningCommand.bind(this),e.prototype.setDefaultCommand=this.setDefaultCommand.bind(this),e.prototype.isCmdExecuting=this.isCmdExecuting.bind(this),e.prototype.subscribeToCmdState=this.subscribeToCmdState.bind(this),e.prototype.unsubscribeToCmdState=this.unsubscribeToCmdState.bind(this),e.prototype.subscribeOnceToCmdState=this.subscribeOnceToCmdState.bind(this),e},O.CommandsManagerComponent.prototype.stackCommandExecutionRequest=function(n,a){var t=Object.create(null);t.cmdsManager=this,t.cmdHandler=a.handler;var d=a.cb;t.cmdHandler._private._cbIfCommandNotStarted=d,function(n){const a=n.caller.cmdHandler,t=n.caller.cmdsManager;if(void 0===a||void 0===t||void 0===t._private)throw new Error("Error on arguments in chainNewExecution, please check.");void 0===t._private._uExecID&&(t._private._uExecID=0);const d=t._private._uExecID;t._private._uExecID++,t._private.unstartedExecutions||(t._private.unstartedExecutions=new Map);let c=t._private.unstartedExecutions;return new Promise((m,l)=>{if(n.caller.cmdsManager._private._waitingExecution++,n.caller.cmdsManager._private.executionChaining||n.caller.cmdsManager._private._currentExecution||!n.caller.cmdsManager._private._currentExecutionDone||n.caller.cmdsManager._private._runningCmd&&!C(n.caller.cmdsManager._private._runningCmd)){if(n.caller.cmdsManager._private._executionChain.length>0){n.caller.cmdsManager._private._waitingExecution--;let a=n.caller.cmdsManager._private._executionChain.pop();if(a.caller.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDED,event:e.LifeCycleEvents.END,notStarted:!0}),a.caller.cmdHandler._private._cb&&"function"==typeof a.caller.cmdHandler._private._cb){const e=r.createReturnObject(o.COMMAND_NOT_STARTED,{description:"Can't start the command as another one has been started as the same time."});a.caller.cmdHandler._private._cbIfCommandNotStarted&&a.caller.cmdHandler._private._appCB.push(a.caller.cmdHandler._private._cbIfCommandNotStarted),a.caller.cmdHandler._private._cb(e),a.caller.cmdHandler._private._appCB=[]}a.caller.cmdHandler===n.caller.cmdHandler?n.caller.cmdsManager._private._waitingExecution--:(n.caller.cmdsManager._private._unstackingCommand=[],n.caller.cmdsManager._private._unstackingCommand.push({discardedCommand:a,newCommandToExecute:n}),n.caller.cmdsManager._private._executionChain.push(n))}else n.caller.cmdsManager._private._executionChain.push(n);return m()}{t._private.unstartedExecutions.set(d,a);let r=Promise.resolve();n.caller.cmdHandler.isDynamic()&&!n.caller.cmdHandler._private._command._dynamicModeComputed&&(t._private._currentComputations||(t._private._currentComputations=new Map),n.caller.cmdHandler.setStateAndSendEvent({state:e.HandlerState.COMPUTING,event:e.LifeCycleEvents.COMPUTE}),n.caller.cmdsManager._private._modelEvents.publish({event:n.caller.cmdHandler.getId()+"/compute"}),n.caller.cmdHandler._private._command._dynamicModeComputed=!0,r=D(n),t._private._currentComputations.set(d,r)),a.isDynamic()||(t._private.executionChaining=!0),r.then(()=>{let r=void 0;if(t._private&&t._private._runningCmd&&(r=t._private._runningCmd.getState()),r===e.HandlerState.ENDING)return t._private._executionChain.push(n),t._private.executionChaining=!1,m();if(a._private._command.killed)return a._private._command._instance=null,a._private._command._dynamicModeComputed=null,a._private._command.killed=null,l(new Error("Dynamic mode canceled during mode computation",{cause:i.DYNAMIC_COMMAND_CANCELED}));let o=new Map(c);if(c.size>1&&c.forEach((n,r)=>{r>d&&(t._private._waitingExecution--,o.delete(d),a.isDynamic()&&(a._private._command._instance=null,a._private._command._dynamicModeComputed=null,a._private._command.killed=null),a.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL})),n.isDynamic()&&r<d&&(t._private._waitingExecution--,n._private._command.killed=!0,n.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL}),o.delete(r)),!n.isDynamic()&&r<d&&(n.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL}),o.delete(r))}),t._private.unstartedExecutions=o,t._private.unstartedExecutions.size>1)return l(new Error("Dynamic mode canceled during mode computation",{cause:i.DYNAMIC_COMMAND_CANCELED}));if(1!==t._private.unstartedExecutions.size)return l(new Error("ASYNC FAILURE ON DYNAMIC MODE COMMANDS"));{let e=t._private.unstartedExecutions.entries().next();if(e.value[1]!==a)return l(new Error("ASYNC FAILURE ON DYNAMIC MODE COMMANDS"));t._private.unstartedExecutions.delete(e.value[0])}if(a._private._command.killed)return l(new Error("Dynamic mode canceled during mode computation",{cause:i.DYNAMIC_COMMAND_CANCELED}));let s=f(n);return t._private.executionChaining=!1,s?(t._private._executionChain.push(n),s.caller.cmdsManager._private._currentExecution=H(s)):t._private._currentExecution=H(n),m()}).then(()=>{t._private._currentComputations&&t._private._currentComputations.delete(d)}).catch(e=>e.cause?l(e):l(new Error(e,{cause:i.COMPUTE_COMMAND_MODE_FAILED})))}})}({callback:function(t){if(!t)throw new Error("mod_CommandsManagerComponent.js callback in chainNewExecution cannot start a command is no capsuleObject is passed");if(!u){if(null!==d&&"function"==typeof d||(d=void 0),t.cmdHandler.getState()===e.HandlerState.PAUSED)return t.cmdsManager._private._currentExecution&&(t.cmdsManager._private._currentExecutionDone=!0),void setTimeout(function(){x.call(t.cmdsManager)},0);C(t.cmdHandler)?(t.cmdHandler._private._appCB||(t.cmdHandler._private._appCB=[]),d&&t.cmdHandler._private._appCB.push(d),t.cmdHandler._private._command._instance.params=Object.create(null),t.cmdHandler._private._command._instance.params.cancelReason=l.secondExecuteCalled,N(t)):(t.cmdHandler.setStateAndSendEvent({state:e.HandlerState.EXECUTING,event:e.LifeCycleEvents.BEGIN}),require([t.cmdHandler._private._command._module],function(e){if(!e)throw new Error("Failed to load the module related to the command",t.cmdHandler._private._id);var r=null,c=t.cmdsManager.getExecutionContext();c&&((r=c.applicationContext).ID=t.cmdsManager._private._executionContext.getId()),a.args||(a.args=Object.create(null)),a.args.cmdLifeCyleEventsChanel=t.cmdsManager._private._modelEvents,a.ID=t.cmdHandler.getId(),e.prototype.isNewInfraActivated=function(){return!0};var i=new e({args:a.args,executionContext:r,ID:a.ID});if(!i)throw x.call(t.cmdsManager),new Error("Call to "+t.cmdHandler._private._command._module+" constructor returned undefined");t.cmdHandler.isUsingComputeServer()&&(i.getCSIdentifier=function(){return i},i.hasDecalredCS=function(){return!0},i.onCmdEnded=function(e){return A.call(t,e)}),i.getId=function(){return t.cmdHandler.getId()},i.askForUndoGroupingAtEnd=function(e,n){i._endUndoGroupingRequested=!0,i._concatenateServerStep=n,i._undoGroupID=e},i._evtID=r.ID+a.ID,t.cmdHandler._private._command._instance=i,t.cmdHandler._private._command._instance.params={},t.cmdHandler._private._cb=n,t.cmdHandler._private._appCB||(t.cmdHandler._private._appCB=[]),d&&t.cmdHandler._private._appCB.push(d),w(t)},function(){var e=new Error("Require failed ("+t.cmdHandler._private._command._module+")");if(!d||"function"!=typeof d)throw e;d(e),x.call(t.cmdsManager)}))}},caller:t}).catch(e=>{if(e.cause!==i.DYNAMIC_COMMAND_CANCELED){if(!d||"function"!=typeof d)throw e;d(e)}})},O.CommandsManagerComponent.prototype.endAll=function(){var e=this;return new UWA.Promise(function(n,a){var r=e._private._pausedCmds.length;if(r>0)var d=e.subscribeToCmdState("","resume",function(a){var c=Object.create(null);if(c.cmdsManager=e,c.cmdHandler=e._private._runningCmd,N(c),0===--r)return e.unsubscribeToCmdState(d),t.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}),n()});if(e._private._runningCmd&&("WAFRUndoCmd"!==e._private._runningCmd._private._id||"Undo"!==e._private._runningCmd._private._id)){var c=Object.create(null);c.cmdsManager=e,c.cmdHandler=e._private._runningCmd,N(c)}if(0===r)return t.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}),n()})},O}),define("DS/WAfrCommandsArchitecture/mod_CommandsInterpreter",["UWA/Class/Promise"],function(e){"use strict";var n=function(){};n.prototype.interpret=function(n,a){var t=!1,r=function(e,n){Object.keys(e).some(function(a){a===n&&!0===e[a]?t=!0:e[a]&&"object"==typeof e[a]&&r(e[a],n)})};return r(n,"computeServer"),t&&a.setContext("usingCS",!0),e.resolve(t)};var a=Object.create(null);return a.generateInterpreter=function(e,a){return Promise.resolve(new n)},a});