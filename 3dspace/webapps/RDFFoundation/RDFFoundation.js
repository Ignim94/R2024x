define("DS/RDFFoundation/SecurityContextUtils",["UWA/Core","DS/Foundation/WidgetAPIs","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/PlatformManager"],function(e,t,n,i){"use strict";var o={spaceNames:{}},s=[];return o.getDefaultSecurityContext=function(){var e;if(window.enoviaServer.space)return window.enoviaServer.space;var t=o.getSecurityContexts();return t&&t.length&&(e=t[0].actualValue,t.some(function(t){return!!t.isDefault&&(e=t.actualValue,!0)})),e},o.getDefaultCollabSpace=function(){var e,t=o.getSecurityContexts();return t&&t.length&&(e=t[0].csName,t.some(function(t){return!!t.isDefault&&(e=t.csName,!0)})),e},o.getSecurityContexts=function(){return s},o.processSecurityContextData=function(e){var t=[];e.forEach(function(e){var n,i=e.name,o=e.displayName.split(".");o.length&&(n=o[o.length-1]),t.push({actualValue:i,displayValue:n,csName:e.csName,isDefault:e.isDefault})}),s=t},o.initSecurityContexts=function(){t.getSecurityContexts(o.processSecurityContextData)},o.fetchSecurityContextByRepo=function(e){var t,n=o.getSecurityContexts();return n&&n.length&&n.some(function(n){return n.csName===e&&(t=n,!0)}),t},o.getContentRepositories=function(t,n){var i=o.getUsersContentRepositories(),s=t.get(n);(s=e.is(s,"array")?s[0]:s,i&&s)&&(s.get("_isDriveRepositoryModel")||o.hasAccessToContentRepository(s.id)||i.push({actualValue:s.id}));return i},o.getUsersContentRepositories=function(){var e=o.getSecurityContexts(),n=[],i=Object.create(null);if(e){var s=e.slice();if(s.length>0)s[s.length-1].actualValue===t.TSK_PRIVATE_SPACE&&s.pop();s.forEach(function(e){var t=e.csName;t&&!i[t]&&(n.push({actualValue:t,displayValue:e.displayValue}),i[t]=!0)})}return n},o.hasAccessToContentRepository=function(e){return o.getUsersContentRepositories().some(function(t){return t.actualValue===e})},o.getContentRepositoryValuesForDetailDisplay=function(t,n){var i=n.attribute,s=o.getContentRepositories.bind(void 0,t,i);return e.merge(s,e.Class.Events.prototype),e.merge(s,e.Class.Listener.prototype),s.listenTo(t,"onChange:"+i,function(){s.dispatchEvent("onChange")}),s},o.loadSecurityContextsForTenant=function(e){let s=e.tenant||i.getTenant();if(o.spaceNames[s])return void e.callback(o.spaceNames[s]);let r=[],a=i.getTenantServiceData(s),l=a?a["3DSpace"]:void 0;if(o.shouldShowPrivateSecurityContext()&&r.push({name:t.TSK_PRIVATE_SPACE,displayName:"Private ● "+i.getContextUserName(),csName:"TSK_privateSpace"}),l){let t=l;t+="/resources/bps/cspaces?tenant="+s,n.ajaxRequest({url:t,type:"GET",dataType:"json",data:"",noSecurityContext:!0,callback:function(t){o.spaceNames[s]=t.cspaces.concat(r),e.callback(o.spaceNames[s])}},!0)}else o.spaceNames[s]=r,e.callback(r)},o.shouldShowPrivateSecurityContext=function(e){return!1},o.getPreferencesCredentials=function(){const e=function(e,t){var n=e.split(".");if(n&&n.length)return n[n.length-t]},t=function(e,t){for(var n=0;n<e.length;n++){if(e[n].value.includes(t))return!0}return!1};var n,i,o=widget.getPreference("collabspace"),s=widget.getValue("collabspace");if(o&&s){window.enoviaServer.space=s;var r={},a=(n=o.options,i=[],n.forEach(t=>{var n=e(t.displayName,1),o=i.find(e=>e.name===n),s=e(t.displayName,2);if(o){var r=o.value.find(e=>e.name===s);r?r.value.push(t.value):o.value.push({name:s,value:[t.value]})}else{var a={name:n,value:[{name:s,value:[t.value]}]};i.push(a)}}),i),l=function(e,t){for(var n=0;n<t.length;n++)for(var i=t[n],o=0;o<i.value.length;o++)if(i.value[o].value.includes(e))return i}(s,a);return r.collabspace=function(e,n,i){var o=e.map(e=>{if("string"==typeof e.name&&!t(e.value,n))return{actualValue:e.value,displayValue:e.name}}).filter(e=>e);return o.unshift({actualValue:i.value,displayValue:i.name}),o}(a,s,l),r.organization=function(e,t){var n=e.value.map(e=>{if("string"==typeof e.name&&!e.value.includes(t))return{actualValue:e.value,displayValue:e.name}}).filter(e=>e);return e.value.forEach(e=>{e.value.includes(t)&&n.unshift({actualValue:e.value,displayValue:e.name})}),n}(l,s),r}},o.isTSKContext=function(){return"ENOTASK_AP"===widget.getValue("appId")||"ENOTASP_AP"===widget.getValue("appId")},o}),define("DS/RDFFoundation/FederatedSearchUtil",["UWA/Core","UWA/Class/Events","DS/WAFData/WAFData","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/FeatureFlagUtils"],function(e,t,n,i,o){"use strict";var s={_buildRequestData:function(t){var n=e.clone(t||{},!1),o=t.sources||[];n.source=o,delete n.sources,n&&!n.locale&&(n.locale=widget.lang||"en");var s=window.enoviaServer&&window.enoviaServer.user||window.dsUserLogin,r=this._isSynthesisTrue(o,t.with_synthesis_attribute),a={label:"3dplan-"+s+"-"+Date.now(),with_synthesis:r,with_synthesis_attribute:r,order_field:"relevance",order_by:"desc",select_file:["icon","thumbnail_2d"],nresults:10,start:0,tenant:i.getTenant()};return e.extend(a,n),a},_isSynthesisTrue:function(e,t){var n=e||[],i=-1!==n.indexOf("swym")||-1!==n.indexOf("usersgroup");return void 0!==t?t&&i:i},_buildRequest:function(e){var t={method:"POST",type:"json",headers:{"Content-Type":"application/json"}};return t.data=JSON.stringify(this._buildRequestData(e)),t.onComplete=e.onComplete,t.onFailure=e.onFailure,t},escapeTwoByteChars:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/（/g,"\\（")).replace(/）/g,"\\）")).replace(/［/g,"\\［")).replace(/］/g,"\\］")).replace(/｛/g,"\\｛")).replace(/｝/g,"\\｝")).replace(/｟/g,"\\｟")).replace(/｠/g,"\\｠")).replace(/〖/g,"\\〖")).replace(/〗/g,"\\〗")).replace(/【/g,"\\【")).replace(/】/g,"\\】")).replace(/〚/g,"\\〚")).replace(/〛/g,"\\〛")).replace(/ー/g,"\\ー")).replace(/\u3000/g," ")},sendRequestWithDelimiter:function(t){for(var n,i,o=e.clone(t||{},!1),r=o.delimeter||" OR ",a=0,l=t.query,c=0;c<l.length;c++)i=l[c],n&&n.length+(r+i).length>s.QUERY_MAX_LENGTH?(o.query=n,o.nresults=a,t.queueRequest?this._handleQueue(o):this.sendRequest(o),c--,a=-1,n=void 0):n?n+=r+i:n=i,a++;o.searchQueryPrefix&&(n=o.searchQueryPrefix+":("+n+")"),o.query=n,o.nresults=a,t.queueRequest?this._handleQueue(o):this.sendRequest(o)},_handleQueue:function(t){var n=e.clone(t||{},!1),i=this;s._queue=s._queue||[],n.onComplete=function(e){t.onComplete&&t.onComplete(e),i._requestFetch()},n.onFailure=function(e){t.onFailure&&t.onFailure(e),i._requestFetch()},s._queue.push(n),s._requestFetch()},_requestFetch:function(){var e=this;s._timeout||(s._timeout=setTimeout(function(){delete s._timeout;var t=s._queue.shift();t&&e.sendRequest(t)},s.REQUEST_DELAY))},sendRequest:function(e){var t=i.getServiceUrl("3DSearch",!0);if(t)return t+="/search",n.authenticatedRequest(t,this._buildRequest(e))},filterSearchSources:function(e){s._validFederatedSearchSources=s._validFederatedSearchSources||{},e=e||[],Array.isArray(e)||(e=[e]);var t=e.slice(),o=i.getServiceUrl("3DSearch",!0);return o?(o&&(o&&s._validFederatedSearchSources[o]?t=e.filter(function(e){return-1!==s._validFederatedSearchSources[o].indexOf(e)}):s._gettingSources||(s._gettingSources=!0,n.authenticatedRequest(o+"/search/source",{onComplete:function(e){delete s._gettingSources,s._validFederatedSearchSources[o]=e?JSON.parse(e).source:void 0,s.eventDispatcher.dispatchEvent("onFederatedSearchSourcesLoaded")},onFailure:function(){delete s._gettingSources}}))),t):e},hasLoadedFederatedSearchSources:function(){return s._validFederatedSearchSources},getFederatedQueryCriteria:function(t){var n=e.clone(t||{},!1),i=n.criteria,o=n.fieldConfig;if(o&&"person"===o.type&&o.searchSource&&-1!==o.searchSource.indexOf("swym")&&1!==i.length)throw new Error("Invalid search criteria for person field.");return i.length>1?"("+i.join(" OR ")+")":0===i.length||0===i[0].length?"":o&&o.searchSourceTypes?i[0]+"*":i[0]},getFederatedQueryPreCondition:function(e){var t;return e&&"person"===e.type&&e.userRole&&e.searchSource&&-1!==e.searchSource.indexOf("3dspace")&&(t='userrole:"'+e.userRole+'"'),t}};return s.eventDispatcher=new t,s.QUERY_MAX_LENGTH=8192,s.REQUEST_DELAY=100,s}),define("DS/RDFFoundation/ProjectTypeUtils",["DS/E6WCommonUI/PlatformManager","UWA/Class/Events","DS/E6WCommonUI/E6WCommonUIConstants","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],function(e,t,n,i){"use strict";const o=i.get.bind(i),s=["dsplan:AgileProject","AgileProject"],r=["dsplan:xProject","Enterprise Project","xProject"],a={"dsplan:Project":"RDFFoundation.Label.TeamProjectTypeHelper","dsplan:xProject":"RDFFoundation.Label.EnterpriseProjectTypeHelper","dsplan:AgileProject":"RDFFoundation.Label.AgileProjectTypeHelper"},l={"dsplan:Project":"xPlan.Label.dsplan:Project","dsplan:xProject":"xPlan.Label.dsplan:xProject","dsplan:AgileProject":"xPlan.Label.dsplan:AgileProject"},c=["dsplan:AgileProject","dsplan:Project",r[0]];var d=new(t.extend({projectTypeList:[],loadProjectTypes:function(t){t(e.getServiceUrl("3dplan",!0)+"/v1/invoke/dsxplan:getProjectTypes?$mask=dsplan:MVMask.Template.Basic",{method:"POST",type:"json",data:JSON.stringify([]),headers:{"Content-Type":"application/json"},onComplete:e=>{this.parseProjectTypes(e),this.dispatchEvent("onChange")},onFailure:function(e){console.log(e)}})},getDefaultProjectImage:function(e,t){const i=t&&t.imageType;let o="_22.png";return i&&i===n.IMAGE_TILE_ATTR?o="_Tile.png":i&&i===n.IMAGE_THUMBNAIL_ATTR&&(o="_Thumbnail.png"),t&&t.isTemplate?require.toUrl("E6WCommonApps/assets/img/I_ProjectPlanningTemplate_Thumbnail.png"):r.includes(e)?require.toUrl("E6WCommonApps/assets/img/I_EnterpriseProject"+o):s.includes(e)?require.toUrl("E6WCommonApps/assets/img/I_AgileProject"+o):"dsplan:ProjectPlanningTemplate"===e?require.toUrl("E6WCommonApps/assets/img/I_ProjectPlanningTemplate_Thumbnail.png"):require.toUrl("E6WCommonApps/assets/img/I_TeamProject"+o)},parseProjectTypes:function(e){var t=this;if(e&&e.member){let n=e.member.map(function(e){let n=t.getDefaultProjectImage(e["@id"]);return{actualValue:e["@id"],displayValue:e["dskern:nlsLabel"],icon:n}});n.sort((e,t)=>"dsplan:Project"===e.actualValue?-1:"dsplan:Project"===t.actualValue?1:e.actualValue<=t.actualValue?-1:1),this.setProjectTypes(n)}},setProjectTypes:function(e){this.projectTypeList=e},getProjectTypes:function(){let e=c;return this.projectTypeList.length>0&&(e=(e=this.projectTypeList.map(e=>e.actualValue)).filter(e=>e!==n.PROJECT_TEMPLATE_TYPE)),e},getCreateProjectTypes:function(e){let t=e&&e.projectTypes?e.projectTypes:[...this.projectTypeList];return t=t.filter(e=>e.actualValue!==n.PROJECT_TEMPLATE_TYPE)},getEditProjectTypes:function(){let e=this.getCreateProjectTypes();return e=e.filter(e=>"dsplan:AgileProject"!==e.actualValue)},getHelperText:function(e){return o(a[e])},getProjectLabel:function(e){return o(l[e])},getLabel:function(e){return this.isTemplate(e)?o("xPlan.Label.Template"):o("xPlan.Label."+e.get("dsplan:projectType"))},isTemplate:function(e){return this.isProject(e.get("dsxplan:jsType"))&&Boolean(e.get("dsplan:isTemplate"))},isProject:function(e){return"dsplan:Project"===e||"dsplan:xProject"===e||"dsplan:AgileProject"===e},getProjectTypeData:function(e){return this.projectTypeList.find(t=>t.actualValue===e)}}));return d.AGILE_PROJECT="dsplan:AgileProject",d.TEAM_PROJECT="dsplan:Project",d.ENTERPRISE_PROJECT=r[0],d}),define("DS/RDFFoundation/Mixins/FetchTrackingMixin",[],function(){"use strict";const e={initFetchTrackingMixinForInstance:function(){this._completeCount=0,this._fetchCount=0},initFetchTrackingMixinForClass:function(t){Object.defineProperty(t.prototype,"fetching",e.fetchingPropertyDefinition),Object.defineProperty(t.prototype,"completing",e.completingPropertyDefinition)},allFetchesUseComplete:function(){return this._completeCount===this._fetchCount},handleBadFetchCounts:function(e){this[e]<0&&(this[e]=0,console.error(`tried to set ${e} to a negative value`))},fetchingPropertyDefinition:{get:function(){return this._fetchCount>0},set:function(e){return!1===e?(this._fetchCount--,this.handleBadFetchCounts("_fetchCount")):this._fetchCount++,this.dispatchEvent("onFetchCountChanged"),this.fetching}},completingPropertyDefinition:{get:function(){return this._completeCount>0},set:function(e){return!1===e?(this._completeCount--,this.handleBadFetchCounts("_completeCount")):this._completeCount++,this.fetching=e,this.completing}}};return e}),define("DS/RDFFoundation/RequestUtils",["UWA/Core"],function(e){"use strict";var t={addNecessaryHeadersAndParams:function(e){e.headers||(e.headers={}),"GET"!==e.method&&"OPTIONS"!==e.METHOD&&(e.headers["X-Requested-With"]="XMLHttpRequest"),"POST"===e.method&&(e.url.match(/\/invoke/)&&(e.headers["Content-Type"]=e.headers["Content-Type"]?e.headers["Content-Type"]:"application/json",e.data||(e.data="[]"),!e.headers["Request-Timeout"]&&e.url.match(/3dplan/)&&(e.headers["Request-Timeout"]=1800)),"json"!==e.type&&(e.headers.Accept="multipart/mixed,application/json")),!e.headers["Accept-Language"]&&(e.headers["Accept-Language"]=window.widget&&window.widget.lang||window.dsLang);var n=window.widget&&window.widget.getValue("overrideTenant");n&&(e.url=t.addQueryParam(e.url,"tenant","dstenant:"+n,!0))},addQueryParam:function(t,n,i,o){return e.is(i)?t+(-1===t.indexOf("?")?"?":"&")+n+"="+(o?encodeURIComponent(i):i):t},addQueryParams:function(e,n){return n.forEach(function(n){e=t.addQueryParam(e,n.name,n.value,n.encode)}),e}};return t}),define("DS/RDFFoundation/CustomExtensionUtils",["DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/E6WCommonUIConstants","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],function(e,t,n){"use strict";n.get.bind(n);const i={customExtensionMap:{},customAttrsMap:{},customAttrCols:[],fetchExtensions:function(t){t(e.getServiceUrl("3dplan",!0)+"/v1/invoke/dsxplan:getExtensions",{method:"POST",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(e){i.parseExtensions(e)},onFailure:function(e){console.log(e)}})},parseExtensions:function(e){if(e&&e.member){var t=e.member,n=["dsplan:Project","dsplan:xProject","dsplan:AgileProject","dsplan:Task","dsplan:Milestone","dsplan:Gate"],o=[],s={};if(t)for(var r=0;r<n.length;r++){var a=t.filter(e=>e.taxonomy===n[r]);if(0!==a.length){o=[];for(var l=0;l<a[0].extensions.member.length;l++)o.push({value:a[0].extensions.member[l]["@id"],label:a[0].extensions.member[l].label});s[n[r]]=o}}i.setExtensions(s)}},setExtensions:function(e){i.customExtensionMap=e},getExtensionsForTaxonomy:function(e){return i.customExtensionMap[e]}};return i}),define("DS/RDFFoundation/Models/ObjectProxyUtil",["UWA/Core","DS/WAFData/WAFData","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/UIHelper","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],function(e,t,n,i,o){"use strict";var s={getDate:function(e){var t=new Date(e);return"Invalid Date"===t.toString()&&(t=new Date(1e3*parseInt(e,10))),"Invalid Date"!==t.toString()?t:e}};const r={id:"resourceid",type:"ds6w:type",extension:"ds6w:docextension",icon:"type_icon_url",image:"preview_url",kind:"ds6w:kind",linkURL:"linkURL",description:"description"};s.convertServiceResponseToFederatedFormat=function(t){var n=[];t=e.is(t,"array")?t:[t];for(var o,a=0;a<t.length;a++){var l=t[a];i.isIconURL(l.image)&&delete l.image;let e={attributes:[{name:"ds6w:label",value:(o=l,o.title?o.title:o.name)},{name:"files",value:l.hasfiles||""},{name:"modified",value:s.getDate(l.modified)}]};for(const t in r)Object.hasOwn(r,t)&&Object.hasOwn(l,t)&&e.attributes.push({name:r[t],value:l[t]});n.push(e)}return n},s.i3dxKeyMap={"ds6w:icon":"type_icon_url","ds6w:previewURL":"preview_url"},s.sendRequest=function(t,n){var i=require("DS/DocumentManagement/ObjectInfoService");if(t["3dspace"]&&t["3dspace"].length>0){let r=e.clone(n||{},!1);var o="$fields=modified,icon,description";r.additionalURLParams=r.additionalURLParams?r.additionalURLParams+"&"+o:o,r.responsePreprocessor=s.convertServiceResponseToFederatedFormat,s.sendRequestHelper(i,t["3dspace"],"3dspace",r)}if(t.drive&&t.drive.length>0){var r=require("DS/DocumentManagement/DriveDocumentManagement");let i=e.clone(n||{},!1);i.tenantUrl=window.enoviaServer["3DDrive"],i.tenant=widget.getValue("x3dPlatformId")||widget.getValue("tenant"),i.responsePreprocessor=s.convertServiceResponseToFederatedFormat,s.sendRequestHelper(r,t.drive,"drive",i)}if(t.i3dx&&t.i3dx.length>0){let i=e.clone(n||{},!1);i.responsePreprocessor=(e=>e.map(e=>({attributes:Object.keys(e).map(t=>({name:s.i3dxKeyMap[t]||t,value:e[t]}))}))),s.sendRequestHelper(s,t.i3dx,"i3dx",i)}},s.sendRequestHelper=function(i,s,r,a){var l=e.clone(a||{},!1);let c=e=>{let t=e;l.responsePreprocessor&&(t=l.responsePreprocessor(e)),l.onComplete&&l.onComplete(t,r)},d=(e,i)=>{let r=[];for(const t of s)e[t]||r.push({id:t});if(r.length){let e=n.getServiceUrl("3DSpace",!0)+"/resources/v1/application/E6WFoundation/CheckObjectExistence";return t.authenticatedRequest(e,{type:"json",headers:{"Content-Type":"application/json"},method:"POST",data:JSON.stringify({data:r}),contentType:"application/json",onComplete:e=>{if(e.success)for(const t of e.data)"FALSE"===t.exists&&(i.push(t),t.type="DELETED",t.title=o.get("RDFFoundation.Label.Deleted"));c(i)},onFailure:e=>{console.error("CheckObjectExistence returned: "+e),c(i)}}),!1}return!0};i.getObjects(s,{tenantUrl:l.tenantUrl,tenant:l.tenant,additionalURLParams:l.additionalURLParams,onComplete:function(e){if(e&&e.data&&(e=e.data),"3dspace"===r){let t={};for(const n of e)t[n.id]=n;if(!d(t,e))return}c(e)},onFailure:function(){if("3dspace"===r){d({},[])}else l.onFailure&&l.onFailure("object_not_found",r,s)}})},s.split3dx=function(e){let t=e.match(/i3dx:([^!]+)!(.+)/);return 3==t.length?{domain:t[1],id:t[2]}:void 0};let a={MBSE:{login:"/resources/v1/modeler/dssyseng/version",service:"mbseapps",fetch:"/resources/v1/modeler/mbse/i3dx/fetch?include=ds6w%3Akind%2Cds6w%3Aicon%2Cds6w%3ApreviewURL",domain:"MBSE"}};return s.i3dxRegistry=function(e){return a[e]},s.getObjects=function(e,i){let o={};e.forEach(e=>{let t=s.split3dx(e),n=o[t.domain];n?n.requestPayload.push({"ds6w:i3dx":e}):(n=s.i3dxRegistry(t.domain),o[n.domain]=n,n.requestPayload=[{"ds6w:i3dx":e}])});for(const[e,s]of Object.entries(o)){let e=n.getServiceUrl(s.service,!0)+s.fetch;if(e){var r;let o=a=>{let l=r.getDefaultSecurityContext().split("::")[1],c=0;t.authenticatedRequest(e,{type:"json",headers:{"Content-Type":"application/json",SecurityContext:l},method:"POST",data:JSON.stringify({data:s.requestPayload}),contentType:"application/json",onComplete:i&&i.onComplete,onFailure:function(){401!==c||a?i&&i.onFailure():(a=!0,t.authenticatedRequest(n.getServiceUrl(s.service,!0)+s.login,{method:"GET",contentType:"*/*",headers:{Accept:"*/*"},onComplete:function(e){console.log(e),s.login=!0,o(!0)}}))},onProgress:function(e){console.log("onprogress"),c=e.currentTarget.status}})};try{r=require("DS/RDFFoundation/SecurityContextUtils"),o()}catch(e){require(["DS/RDFFoundation/SecurityContextUtils"],e=>o())}}}},s}),define("DS/RDFFoundation/MaskUtils",["UWA/Core"],function(e){"use strict";var t,n;require(["text!DS/RDFFoundation/assets/maskDefinition.json"],function(e){e=JSON.parse(e),t=e.masks,n=e.maskBreakdownArray},function(){require(["text!DS/RDFFoundation/assets/maskDefinition_prebuilt.json"],function(e){e=JSON.parse(e),t=e.masks,n=e.maskBreakdownArray})});var i={isSubMask:function(e,t){return t.some(function(t){return e===t||n[t]&&n[t].includes(e)})},addAttributeToMask:function(e,t,n){i.addMask(e)[t]=n},addMask:function(e){var n=t[e];return n||(n=t[e]={}),n},getMask:function(e){return t[e]},getAllMasks:function(){return t},resetMaskContent:function(n){t=e.clone(n||{})},getMinMaskArray:function(o,s){var r=e.clone(s||{},!1),a=r.level||0;let l,c=[],d=0,u=[];return a>3?o:(r.attributes&&r.attributes.length>0&&(o=o.filter(e=>r.attributes.some(n=>t[e].hasOwnProperty(n)))),o.forEach(e=>{let t=n[e]?n[e]:[],i=o.filter(e=>t.includes(e));i.push(e),i.length>d&&(d=i.length,l=e,u=i)}),l&&c.push(l),d!==o.length&&(c=c.concat(i.getMinMaskArray(o.filter(e=>!u.includes(e)),{attributes:[],level:++a}))),c)},ARRAY_ATTR:"array",COLLECTION_ATTR:"collection",MODEL_ATTR:"model",STRING_ATTR:"string"};return i}),define("DS/RDFFoundation/MemberUtils",["UWA/Core","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonUI/PlatformManager","DS/WAFData/WAFData"],function(e,t,n,i){"use strict";var o="uuid:",s="iam:",r=/^(uuid:|mailto:|iam:)/g,a={userMap:{},idAttributeForFederatedSearch:"ds6w:resourceUid",addUserUIdToMap:function(e,t){e!==t&&(a.userMap[e]=t)},escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},findAndGetSwymPersonResourceUid:function(n){var i=e.clone(n||{},!1),o=i.searchOptions,s=o.id,r=n.dropObj&&n.dropObj.objectType||n.detailedObject&&n.detailedObject["ds6w:type"],l=this._getDefaultSearchAttributes(s,r);e.extend(l,o),t.sendRequest({select_predicate:l.select_predicate,sources:[l.source],query:l.query,nresults:1,onComplete:function(e){var t=!0,n=e.results;if(n&&n.length)for(var o=n[0].attributes,s=o.length,r=0;r<s;r++)if(o[r].name===a.idAttributeForFederatedSearch){var c=o[r].value;l.callback&&l.callback(c,i),t=!1;break}t&&l.onFailure&&l.onFailure()},onFailure:function(){l.onFailure&&l.onFailure()}})},getContextUserUid:function(t){var o=e.clone(t||{});let s=n.getServiceUrl("3DSwym",!0)+"/api/index/tk";i.authenticatedRequest(s,{method:"GET",onComplete:e=>{let t=JSON.parse(e).result.ServerToken;i.authenticatedRequest(n.getServiceUrl("3DSwym",!0)+"/api/user/getcurrent",{method:"POST",type:"json",data:JSON.stringify({params:{detailedView:!1,get_autosaved_content:!0}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":t},onComplete:e=>{let t=e.result;a.addUserUIdToMap(t.login,a.addUUIDToURI(t.uid)),n.setContextUserUid(t.uid),o.onComplete&&o.onComplete(t.uid)},onFailure:()=>{console.error("Unable to retrieve current user information from 3DSwym"),o.onFailure&&o.onFailure()}})},onFailure:()=>{console.error("Unable to retrieve current user information from 3DSwym"),o.onFailure&&o.onFailure()}})},setContextUserUid:function(t){let i=e.clone(t||{});n.getServiceUrl("3DSwym",!0)?this.getContextUserUid(i):n.addEventOnce("serviceDataLoaded",a.getContextUserUid.bind(this,i))},_getDefaultSearchAttributes:function(e,t){var n,i;return t&&"foaf:Group"===t||"Group"===t?(n="usersgroup",i=["[ds6w:resourceUid]",':("',e,'")'].join("")):(n="swym",i=["resourceid",':("',e,'")'].join("")),{source:n,query:i,select_predicate:["resourceid","ds6w:resourceUid"]}},getPersonMask:function(){return"dsplan:MVMask.Person.Complex"},addUUIDToURI:function(t,n){var i=n&&n.detailedObject&&("foaf:Group"===n.detailedObject["ds6w:type"]||"Group"===n.detailedObject["ds6w:type"]),s=n&&n.dropObj&&("foaf:Group"===n.dropObj.objectType||"Group"===n.dropObj.objectType);return i||s||!t||!e.is(t,"string")||t.match(r)?t:[o,t].join("")},removeUUIDFromURI:function(t){return t&&e.is(t,"string")&&t.startsWith(o)&&(t=t.replace(o,"")),t},addIamToURI:function(t){return t&&e.is(t,"string")&&!t.match(r)?[s,t].join(""):t},preProcessPersonObject:function(e,t){return"pno:Person"===t["ds6w:type"]&&(e=a.addUUIDToURI(e)),e},typeAheadCallback:function(e,n,i){return t.sendRequest({select_predicate:["ds6w:label","ds6w:resourceUid","ds6w:type","ds6w:type_value","type_icon_url","preview_url"],sources:t.filterSearchSources(["swym","usersgroup"]),query:'[ds6w:type]:("foaf:Group" OR "pno:Person")',specific_source_parameter:{usersgroup:{additional_query:" AND [ds6w:label]:("+a.escapeRegExp(e)+"*)"},swym:{additional_query:" AND personOrGroup:("+e+")"}},with_synthesis_attribute:!0,onComplete:i.onComplete&&i.onComplete.bind(void 0,n,i)})},isPendingUser:function(e){var t=e.get("resourceid"),n=e.get("dsaccess:state");return!(!t&&!n)&&(t&&t.startsWith("mailto:")||n&&"pending"===n)},getAccountNameForUser:function(e,t){var n=e.startsWith("mailto:")?t:e;return n&&n.split(":")[1]},getLabelForUserGroup:function(e){return e.detailedObject?e.detailedObject.label?e.detailedObject.label:e.detailedObject["ds6w:label"]:e.dropObj?e.dropObj.objectType:void 0},getUserNameForSwymUserProfile:function(e){var t=e.get("resourceid");return t&&t.startsWith("iam:")?t.split(":")[1]:e.get("dsaccess:accountName")}};return a}),define("DS/RDFFoundation/BatchBuilder",["UWA/Core","UWA/Utils","UWA/Class","DS/RDFFoundation/RequestUtils"],function(e,t,n,i){"use strict";var o=n.extend({init:function(e){this.ajax=this.ajax.bind(this),this.requests=[],this._baseUrl=e.baseUrl,this._ajax=e.ajax},ajax:function(t,n){var i=e.clone(n||{},!1);i.url=t,this.requests.push(i)},addRequestsFromBatch:function(e){this.requests.push.apply(this.requests,e.requests)},_sendSingleRequest:function(t,n,i){var o=i,s=n,r=t,a=s.onComplete&&o.onComplete,l=s.onFailure&&o.onFailure,c=i.waitOnInFlightRequests;if(a||l||c){var d=(s=e.clone(s,!1)).onComplete,u=s.onFailure;s.onComplete=a?function(){d&&d.apply(this,arguments),o.onComplete&&o.onComplete.apply(this,arguments)}:d||o.onComplete,s.onFailure=l?function(){u&&u.apply(this,arguments),o.onFailure&&o.onFailure.apply(this,arguments)}:u||o.onFailure,c&&(s.waitOnInFlightRequests=c)}return r(s.url,s)},sendBatch:function(n){var s,r,a,l=n&&n.ajax||this._ajax,c=this.requests;if(0===c.length)return n&&e.is(n.onComplete,"function")&&n.onComplete(),{cancel:function(){}};var d=e.clone(n||{},!1);if(1===c.length)return this._sendSingleRequest(l,c[0],d);var u=t.getUUID(),h="batch_"+u,p="changeset_"+u,g="\r\n--"+h+"\r\nContent-Type: multipart/mixed;boundary="+p+"\r\n\r\n",f=this._baseUrl.length;s=c.length;var m=1;for(a=0;a<s;a++){if((r=c[a]).changeset=p,r.newTransaction&&a&&(g+="--"+p+"--\r\n",g+="--"+h+"\r\n",g+="Content-Type: multipart/mixed;boundary="+(p="changeset_"+(u=t.getUUID()))+"\r\n\r\n"),g+="--"+p+"\r\n",g+="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\nContent-ID: "+(r.id||m++)+"\r\n\r\n",g+=r.method+" "+r.url.substring(f)+"\r\n",i.addNecessaryHeadersAndParams(r),r.headers)for(var y=Object.keys(r.headers),v=y.length,C=0;C<v;C++){var F=y[C];g+=F+": "+r.headers[F]+"\r\n"}g+="\r\n",g+=(r.data||"")+"\r\n"}return g+="--"+p+"--\r\n--"+h+"--",d.method="POST",d.data=g,d.headers={"Content-Type":"multipart/mixed;boundary="+h},d.url=this._baseUrl+"batch",d.responseType="text",d.batchRequest=!0,d.onComplete=function(t){var i=o.parseBatchRequest(t),a=i.length,l=0;s=c.length;for(var d,u=function(t,n){var i=this[n],o=i.data;2===Math.floor(i.status/100)?("json"===t.type&&(o=JSON.parse(o)),e.is(t.onComplete,"function")&&t.onComplete(o,i.headers)):e.is(t.onFailure,"function")&&t.onFailure(i.data,i.headers)},h=function(t){if("string"==typeof this.data)try{this.data=JSON.parse(this.data)}catch(e){this.data={msg:this.data}}this.data["@code"]=this.status,e.is(t.onFailure,"function")&&t.onFailure(new Error('NetworkError: URL "'+t.url+'" return ResponseCode with value "'+(this.status||0)+" "+(this.statusText||"")+'".'),this.data,this.headers)},p=0;p<a;p++){d=i[p];for(var g=[];l<s;l++){if((r=c[l]).newTransaction&&l){r.newTransaction=!1;break}g.push(r)}if(e.is(d,"array")){if(d.length!==g.length)throw new Error("expecting "+g.length+" response.  Got "+d.length);g.forEach(u,d)}else g.forEach(h,d)}n&&e.is(n.onComplete,"function")&&n.onComplete(t)},d.onFailure=function(){for(s=c.length,a=0;a<s;a++)r=c[a],e.is(r.onFailure,"function")&&r.onFailure.apply(this,arguments);n&&e.is(n.onFailure,"function")&&n.onFailure.apply(this,arguments)},d.onTimeout=function(){for(s=c.length,a=0;a<s;a++)r=c[a],e.is(r.onTimeout,"function")?r.onTimeout.apply(this,arguments):e.is(r.onFailure,"function")&&r.onFailure.apply(this,arguments);n&&e.is(n.onFailure,"function")&&n.onFailure.apply(this,arguments)},d.ignoreDictionary=!0,l(d.url,d)}});return o.parseBatchRequest=function(e){var t=e,n=t.indexOf("\r\n",1),i=t.substr(0,n),o=t.split(i),s=o.length,r=[];r.boundary=i;for(var a=function(e){if(e.length){var t=e.match(/([^:]*):(.*)/);t&&(this[t[1]]=t[2])}},l=function(e){var t=e.trim().split("\r\n\r\n",2),n=t[0].split("\r\n");if(n.length>1){var i={};n.forEach(a,i);var o=t[1],s=o.split("\r\n"),l=s.shift(),c=l.match(/(POST|GET|PATCH|DELETE|PUT)[ ]+(.*)/),d=l.match(/HTTP\/1\.1[ ]+([0-9]+)[ ]+(.*)/),u={data:e.substr(t[0].length+2*"\r\n\r\n".length+o.length),partHeader:i};return c?(u.url=c[2],u.method=c[1]):d&&(u.status=parseInt(d[1],10),u.statusText=d[2]),i={},s.map(a,i),u.headers=i,u}return r},c=1;c<s-1;c++){var d=o[c],u=d.match(/Content-Type:\s*multipart\/mixed;boundary=(.*)/);if(u){var h=u[1],p=d.split("--"+h);p.pop(),p.shift();var g=p.map(l.bind(this));g.boundary=h,r.push(g)}else r.push(l.call(this,d))}return r},o.batchResponseHasAFailure=function(t){var n;if(e.is(t,"string"))n=o.parseBatchRequest(t);else{if(e.is(t,"object"))return!1;if(!e.is(t,"array"))return console.error("unexpected batch response type"),!0}return n.find(t=>!e.is(t,"array"))},o}),define("DS/RDFFoundation/RDFUtils",["UWA/Core","UWA/Utils","UWA/Utils/Cookie","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/BatchBuilder","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/ProjectTypeUtils","DS/RDFFoundation/CustomExtensionUtils","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Search","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,o,s,r,a,l,c,d,u,h,p,g){"use strict";var f,m=/(-)?P(?:([0-9]+|NaN)D)?T?(?:([0-9]+|NaN)H)?(?:([0-9]+|NaN)M)?(?:([0-9.]+|NaN)S)?/,y={"3dspace":"3DSpace",drive:"3DDrive",swym:"3DSwym",geovia:"geoservice","3dportfolio":"3dportfolio"},v={dsxplan:"http://www.3ds.com/RDF/Corpus/xPlan/",dsplan:"http://www.3ds.com/RDF/Corpus/Plan/",dskern:"http://www.3ds.com/RDF/Corpus/Kernel/",dspol:"http://www.3ds.com/RDF/Corpus/Policy/",dscom:"http://www.3ds.com/RDF/Corpus/com/",ds6w:"http://www.3ds.com/vocabularies/ds6w/",dsbase:"http://www.3ds.com/RDF/Corpus/dsbase/",iam:"http://iam.3ds.com/",dsaccess:"http://www.3ds.com/RDF/Corpus/Access/",w3:"http://www.w3.org/1999/02/"},C=function(e){for(var t={},n=Object.keys(e),i=n.length,o=0;o<i;o++){var s=n[o];t[e[s]]=s}return t};var F={cancel:function(){var e=this.options.queue||f;if(this.actualRequest)delete this.options.onComplete,this.actualRequest.cancel&&this.actualRequest.cancel();else{var t=f._pendingRequests.indexOf(this);e._pendingRequests.splice(t,1)}},onComplete:function(t){var n=this.options.queue||f;this.options.invokeAsLRT||this.removeFromInFlightRequest(),t&&t.httpStatusCode>400?e.is(this._onFailure,"function")&&this._onFailure(t):e.is(this._onComplete,"function")&&this._onComplete.apply(this,arguments),this.options.invokeAsLRT||f.sendPendingRequests(n)},onFailure:function(){var t=this.options.queue||f;this.removeFromInFlightRequest(),e.is(this._onFailure,"function")&&this._onFailure.apply(this,arguments),f.sendPendingRequests(t)},onTimeout:function(){var t=this,n=this.options.queue||f;e.is(this._longRunningOperationTimeoutCallback,"function")?this._longRunningOperationTimeoutCallback({onComplete:function(){var n=t.options.queue||f;t.removeFromInFlightRequest(),e.is(t._onTimeout,"function")&&t._onTimeout.apply(t,arguments),f.sendPendingRequests(n)},onFailure:function(){t.onFailure.apply(t,arguments)}}):(this.removeFromInFlightRequest(),e.is(this._onTimeout,"function")?this._onTimeout.apply(this,arguments):e.is(this._onFailure,"function")&&this._onFailure.apply(this,arguments),f.sendPendingRequests(n))},removeFromInFlightRequest:function(){var e=this.options.queue||f,t=e._inFlightRequests.indexOf(this);e._inFlightRequests.splice(t,1),e!==f&&(t=f._inFlightRequests.indexOf(this),f._inFlightRequests.splice(t,1))}};return(f={MAX_CONCURRENT_REQUEST:20,TAGGER_URI_PREFIX:"dsplan:",WEDO_TAGGER_URI_PREFIX:"swym:wedo%3Aeoe%3A",_inFlightRequests:[],_pendingRequests:[],DOWNLOADABLE_TYPES:["MS Word Document","MS Excel Document","MS Powerpoint Document","MS Outlook Document","MS Word Template","MS Excel Template","MS Powerpoint Template","MS Outlook Template","Document","DriveFile"],EDITABLE_TYPES:["MS Word Document","MS Excel Document","MS Powerpoint Document","MS Outlook Document","MS Word Template","MS Excel Template","MS Powerpoint Template","MS Outlook Template","MS Outlook Attachment","Document"],inverseMapping:C,sourceToServiceMap:y,serviceToSourceMap:C(y),serviceFromSource:function(e){return f.sourceToServiceMap[e]||e},sourceFromService:function(e){return f.serviceToSourceMap[e]||e},serviceArrayFromSourceArray:function(e){return e.map(f.serviceFromSource)},_computeTypeAheadEntryBasedOnFedSearchResult:function(e){for(var t=e.attributes,n=t.length,i={},o=0;o<n;o++){var s=t[o],r=s.value;switch(s.name){case"resourceid":i.value=r;break;case"ds6w:resourceUid":r=c.preProcessPersonObject(r,i),i.resourceUid=r;break;case"preview_url":i.image=r;break;case"ds6w:type":case"ds6w:what/ds6w:type":i["ds6w:type"]=r;break;case"ds6w:label":i.label=r;break;case"sourceid":i.sourceId=r}}return i},onTypeAheadComplete:function(t,n,i){var o=(e.is(i,"string")?JSON.parse(i):i).results,s=[];if(o)for(var r=o.length,a=0;a<r;a++){var l=o[a],c=f._computeTypeAheadEntryBasedOnFedSearchResult(l);if(n.fieldConfig&&"dsplan:hasWorkContext"===n.fieldConfig.name){var d=n.model.get(n.fieldConfig.name),u=f.removeBracketLongURI(c.resourceUid)||c.sourceId;if(d||u===n.model.id)(d&&d.id)!==u&&u!==n.model.id&&s.push(c);else s.push(c)}else s.push(c)}t(s,n)},typeAheadCallback:function(t,n,i,o){var s=e.clone(o||{},!1);s.fieldConfig=t,n=r.escapeTwoByteChars(n);var a,l,c=r.filterSearchSources(t.searchSource);return window.widget.getValue("oldSearch")?a="("+n+"* OR "+n+")":(a=(a=n.split(",").map(function(e){return e.trim()})).filter(function(e){return e}),a=r.getFederatedQueryCriteria({criteria:a,fieldType:t.type,fieldConfig:t}),l=r.getFederatedQueryPreCondition(t)),r.sendRequest({select_predicate:["ds6w:label","ds6w:resourceUid","ds6w:type","ds6w:type_value","type_icon_url","preview_url"],sources:c,query:a,precond:l,specific_source_parameter:p.computeSourceParameters(t,n),with_synthesis_attribute:void 0!==t.with_synthesis_attribute?t.with_synthesis_attribute:(c||[]).includes("swym"),onComplete:f.onTypeAheadComplete.bind(void 0,i,s),onFailure:f.onTypeAheadComplete.bind(void 0,i,s)})},complete:function(t,n,i){var o=e.clone(i||{},!1),s=o.batchGenerator,r=o.mask;if(r&&"undefined"!==r){var a=function(t,n,i){var o=e.clone(i||{}),s=[],r=o.mask;delete o.mask;for(var a=0;a<n.length;a++){var l=f.getObjectForAdding(t,n[a],o);!l.id||o.onlyIfNeeded&&r&&l.hasDataForMask(r,{checkFetching:!0})||(l._onRequest&&l._onCompleteRequest&&l._onRequest(),l.fetchingMask(r),l.completing=!0,s.push(l))}return s}(t,n,o);if(0!==a.length)for(var l=function(e){e.forEach(function(e){var t=f.getObjectById(e);t._onCompleteRequest&&t._onCompleteRequest(),t.doneFetchingMask(r),t.completing=!1})},c=o.onComplete,d=o.onFailure,u=function(e,t){!function(e,t,n){(e.member||[]).forEach(function(e){if(404===e.error||401===e.error){var i=f.getObjectById(e["@id"]);i&&n&&n(i)}else{var o=f.getExistingAndMerge(e,{animate:t});o&&o.addMask(e["@mask"])}})}(t,i.animate,d),l(e),0==--y&&c&&c()},h=function(e){if(l(e),d)for(var t=e.length,n=0;n<t;n++)d(e[n]);0==--y&&c&&c()},p=[],g=s?s.ajax:f.request,m=a.map(function(e){return p.push(e.id),f.jsonURIToSparqlURI(e.id)}),y=Math.ceil(m.length/10);m.length;){var v=m.splice(0,10),C=p.splice(0,10),F="classes/rdfs:Resource?$mask="+r;F+="&$where="+encodeURIComponent("?s WHERE { VALUES ?s {"+v.join(" ")+"} }"),g(f.expandUrl(F,"v1"),{method:"GET",type:"json",newTransaction:!0,onComplete:u.bind(void 0,C),onFailure:h.bind(void 0,C)})}else o.onComplete&&o.onComplete()}else console.log("empty mask in complete function")},subscribeToNotification:function(e){return s.subscribe("XApp.Magic.Update",e)},hrefFromId:function(e){var t="/resources/";return t+=e},getObjectById:function(e){e=f.getObjectIDFromUserMap(e);return f.objectMap[e]},getObjectIDFromUserMap:function(e){e=f.removeBracketLongURI(e);return c.userMap[e]||e},resetObjectMap:function(){f.objectMap={},c.userMap={}},addObjectToMap:function(e,t){var n=f.removeBracketLongURI(e);f.objectMap[n]&&console.error("attempting to add object to an existing id"),f.objectMap[n]=t},removeObjectFromMap:function(e){!f.objectMap[e]&&console.log("Removing object from map that wasn't there. Not an issue, just strange"),delete f.objectMap[e]},getObjectForAdding:function(t,n,i){var o=f.removeBracketLongURI(n),s=e.clone(i||{},!1),r=f.getObjectById(o);if(!r&&t){var a=f.getTypeCollection(t,{create:!0}),l=i&&i.attrs&&i.attrs["@type"]||!0;r=f.createPlaceholder(o,void 0,l),s.attrs&&(e.merge(r,s.attrs),s.attrs["dsxplan:jsType"]&&delete r["@type"],delete s.attrs),r=a.add(r,s)}return s.mask&&(s.onlyIfNeeded=!0,r.fetch(s)),r},createPlaceholder:function(e,t,n,i){var o={"@id":f.removeBracketLongURI(e),"@href":f.hrefFromId(e),"@mask":t,"@type":n,_skeletonId:e};return i&&i.forceDslc&&(o.forceDslc=!0),o},splitUri:function(e){var t;return t=e.indexOf(":"),[e.substr(0,t),e.substr(t+1)]},getAssetUrl:function(e){var t;return"webapps"===(t=f.splitUri(e))[0]&&(e=o.getWebappsBaseUrl()+t[1]),e},parseUrl:function(e){var n,i;return i=(n=t.parseUrl(e)).query.length?t.parseQuery(n.query):{},{path:n.path,mask:i.$mask,where:i.$where&&decodeURIComponent(i.$where)}},buildProductAuthorizationRequests:function(e,t){t.forEach(function(t){e.ajax(f.expandUrl("invoke/dsplan:isProductAuthorized","v1"),{method:"POST",type:"json",data:'"'+t+'.prd"',headers:{"Content-Type":"application/json"},onComplete:function(e){"ENXPLAN_AP"===t?h.setXPPAuthorized(e["@value"]||e.value):h.setAuthorized(t,e["@value"]||e.value)}})})},reconstructUrl:function(e){var t=e.path+(e.mask?"?$mask="+e.mask:"");return t+=e.mask&&e.where?"&":"",t+=e.where?"$where="+e.where:""},expandUrl:function(e,t,n){return e=e.replace(/^\//,""),t=t||"v1",e=h.getServiceUrl("3dplan",!0)+"/"+t+"/"+e,n&&n.rdfIndex&&(e=e.replace("3DPLAN","3drdfindex")),e},hasLoadedDictionary:function(){return!!f.typeDictionary&&f.typeDictionary.typeHierarchy},request:function(t,o){var s,r=e.clone(o||{},!1),a=Object.create(F);let c=h.getServiceUrl("3dplan",!0);if(!r.ignoreDictionary&&!f.hasLoadedDictionary()&&c){var d=e.clone(r,!1);d.newTransaction=!0;var u=f.getDictionaryBatch();return r.waitForDictionary?u.sendBatch({onComplete:function(){f.request(t,o)}}):(u.ajax(t,d),u.sendBatch()),a}r.url=t,l.addNecessaryHeadersAndParams(r);var p=r.queue||f;s=i.authenticatedRequest,a.options=r;var g,m=p.MAX_CONCURRENT_REQUEST||f.MAX_CONCURRENT_REQUEST;return p._inFlightRequests.length>=m||r.waitOnInFlightRequests&&f._inFlightRequests.length?(p._pendingRequests.push(a),a):(a._onComplete=r.onComplete,a._onFailure=r.onFailure,a._onTimeout=r.onTimeout,a._longRunningOperationTimeoutCallback=r.longRunningOperationTimeoutCallback,r.onComplete=a.onComplete.bind(a),r.onTimeout=a.onTimeout.bind(a),p._inFlightRequests.push(a),p!==f&&f._inFlightRequests.push(a),r.onFailure=function(i,o){var l=g&&g.xhr&&g.xhr.status;l&&e.is(o,"object")&&(o["@code"]=l),o&&e.is(o,"object")&&(o.error=i),503!==l&&503!==this.status||a.alreadySentOnce?a.onFailure.apply(a,arguments):(n.expire("SERVERID"),n.expire("SOLVERID"),a.alreadySentOnce=!0,g=s(t,r))},f.isBlockingRequests()?(f._blockedRequests.push(r),a):(r.invokeAsLRT&&(r.cancelableRequest=a),g=s(r.url,r),a.actualRequest=g,r.invokeAsLRT?a:g))},createRequestQueue:function(e){return{_inFlightRequests:[],_pendingRequests:[],MAX_CONCURRENT_REQUEST:e||3}},getPendingRequests:function(e){return e._pendingRequests},sendPendingRequests:function(e){var t=e||f;if(e&&!e._pendingRequests.length&&(t=f),t._pendingRequests.length){var n,i=t._pendingRequests,o=i.length,s=t.MAX_CONCURRENT_REQUEST||f.MAX_CONCURRENT_REQUEST;for(n=0;n<o&&t._inFlightRequests.length<s;n++){var r=i[n];f.request(r.options.url,r.options)}t._pendingRequests.splice(0,n)}},getBatchGenerator:function(e){return e&&e.ignoreDictionary||f.hasLoadedDictionary()?new a({ajax:f.request,baseUrl:f.expandUrl("","v1")}):f.getDictionaryBatch()},getExistingAndMerge:function(t,n){var i=e.clone(n||{},!1),o=f.getObjectById(t["@id"]);if(i.mergeIfSameETag&&(o&&o.get("@etag")===t["@etag"]||(o=void 0)),o){var s=t;o.isDSLC()&&s&&(s=o._mapDslcAttributes(s)),s=o.parse(s),i.parse=!0,o.set(s,i)}return o},getModelConstructor:function(t){var n;if(f.typeDictionary){if(f.typeDictionary.typeMap){var i=t["@type"]||t["dsxplan:jsType"];if(!i){var o=t["dsxplan:actualType"]||t["dsplan:actualType"];i=o&&o["@id"]}if(i){var s=f.typeDictionary.typeMap[i];return s&&s.type}}if(f.typeDictionary.mapping){var r,a=t["rdf:type"],l=e.is(a,"array")?a:a&&a.member,c={};if(l)l.forEach(function(e){c[e["@id"]]=e});else if(t["@type"]){var d=t["@type"];c[d]=d}f.typeDictionary.mapping.some(function(e){return!!c[e.key]&&(r=e.type,!0)}),n=r}}return n},removeTypeCollection:function(e){var t;if(f.typeDictionary&&f.typeDictionary.modelIndexes){var n=f.typeDictionary.modelIndexes.get(e);f.typeDictionary.modelIndexes.delete(e),t=n}return t},resetTypeCollection:function(e,t){f.typeDictionary&&(f.typeDictionary.modelIndexes||(f.typeDictionary.modelIndexes=new Map),f.typeDictionary.modelIndexes.set(e,t))},getTypeCollection:function(e,t){var n;if(f.typeDictionary){f.typeDictionary.modelIndexes||(f.typeDictionary.modelIndexes=new Map);var i=f.typeDictionary.modelIndexes.get(e);!i&&t&&t.create&&(i=new f.ResultCollection(void 0,{model:e,"@href":"classes/"+e.prototype._uwaClassName,"@id":"typeCollection:"+e.prototype._uwaClassName}),f.typeDictionary.modelIndexes.set(e,i)),n=i}return n},getModelByTypeAndId:function(e,t,n){var i=this.getTypeCollection(e,n);return i&&i.get(t,n)},_maskStrength:function(e){if(!e)return-1;if(f.typeDictionary&&f.typeDictionary.masksStrength){var t=f.typeDictionary.masksStrength[e];if(void 0!==t)return t}return"dskern:Mask.Default"===e?0:e.match(/.*\.Basic$/)?1:e.match(/.*\.Simple$/)?2:e.match(/.*\.Collapsed$/)?6:e.match(/.*\.Expanded$/)?8:e.match(/.*\.Complex$/)?10:1},compareMasks:function(e,t){return f.typeDictionary&&f.typeDictionary.masksStrength,f._maskStrength(e)-f._maskStrength(t)},xsdDayTimeDurationToMilliseconds:function(e){var t,n=0,i=String(e).match(m);return i&&(t="-"===i[1],n=864e5*parseInt(i[2]||0)+36e5*parseInt(i[3]||0)+6e4*parseInt(i[4]||0)+1e3*parseFloat(i[5]||0),t&&(n=-n)),n},millisecondsToXsdDayTimeDuration:function(e){return(e<0?"-":"")+"PT"+Math.abs(e)/1e3+"S"},handleContext:function(t){if(t){var n=t["@context"];n&&e.merge(f.typeDictionary.context,n)}},shortToLongURI:function(e){var t=f.splitUri(e),n=f.typeDictionary.context[t[0]],i=e;return n?i="<"+n+t[1]+">":"uuid"===t[0]&&(i="<"+e+">"),i},conditionalShortToLongURI:function(e){return e.startsWith("uuid")&&(e=f.shortToLongURI(e)),encodeURIComponent(e)},longToShortURI:function(e){var t=e.split("/"),n=t.pop(),i=t.join("/")+"/";return f.inverseTypeDictionary[i]?`${f.inverseTypeDictionary[i]}:${n}`:e},jsonURIToSparqlURI:function(e){var t=e;if(t){var n=f.splitUri(e);f.typeDictionary.context[n[0]]&&n.length>=2&&!n[1].startsWith("//")?t=e:"uuid"===n[0]&&(t="<"+e+">")}return t},removeBracketLongURI:function(t){return t&&e.is(t,"string")&&t.startsWith("<")&&t.endsWith(">")&&(t=t.substr(1,t.length-2)),t},getURIForFiltering:function(t){return t&&e.is(t,"string")&&(t=t.replace(this.TAGGER_URI_PREFIX,"")),t&&e.is(t,"string")&&(t=t.replace(this.WEDO_TAGGER_URI_PREFIX,"")),this.removeBracketLongURI(decodeURIComponent(t))},loadTypeList:function(e){var t=e&&e.member;if(t){for(var n,i,o={},s={},r=t.length,a=function(e){return e.key===n&&(i=e,!0)},l=function(e){var t=e.Name;t&&(i&&(o[t]=i),s[n].push(t))},c=0;c<r;c++){var d=t[c];n=d.Name,i=void 0,s[n]=[],f.typeDictionary.mapping.some(a),f.scanStructure(d,l)}f.typeDictionary.typeMap=o,f.typeDictionary.typeHierarchy=s}for(var u=f.typeDictionary.mapping,h=u.length,p=0;p<h;p++){var g=u[p];f.typeDictionary.typeMap[g.key]||(f.typeDictionary.typeMap[g.key]=g)}},scanStructure:function(t,n,i,o){if(e.is(t,"array"))for(var s=t.length,r=0;r<s;r++){var a=t[r];if("STOP"===f.scanStructure(a,n,t))return"STOP"}else if(e.is(t,"object")){for(var l=Object.keys(t),c=l.length,d=0;d<c;d++){var u=l[d],h=t[u];if("@context"!==u&&"rdf:type"!==u&&((e.is(h,"object")||e.is(h,"array"))&&"STOP"===f.scanStructure(h,n,t,u)))return"STOP"}return n(t,i,o)}},typeDictionary:{context:v},inverseTypeDictionary:C(v),getDictionaryBatch:function(t){var n=e.clone(t||{},!1),i=f.getBatchGenerator({ignoreDictionary:!0});n.ajax=i.ajax;var o=function(e){var n,i=(n="E6WCommonUI.Alert.3DPlanServiceFail",g.get(n));return window.widget&&window.widget.alerter&&h.getServiceUrl("3dplan",!0)&&(window.widget.alerter.add({message:i,className:"error"}),window.widget.alerter.show()),t&&e&&e.apply(this,arguments)};return i.ajax(f.expandUrl("invoke/dsmf:xplan.xPlanVocabulary.getVocabulary"),{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify([]),onComplete:function(e){f.loadTypeList(e)},onFailure:o.bind(this,t&&t.onFailure),onTimeout:o.bind(this,t&&(t.onTimeout||t.onFailure)),type:"json"}),this.buildProductAuthorizationRequests(i,["ENXPLAN_AP","RSK","DPM","XWO"]),d.loadProjectTypes(i.ajax),u.fetchExtensions(i.ajax),i},serverHasDSLC:function(){return!(!this.typeDictionary||!this.typeDictionary.typeHierarchy)&&this.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"]},removeAllTypeCollections:function(){delete f.typeDictionary.modelIndexes},removeObjectFromIndex:function(e){var t=f.getObjectById(e);t&&(f.getTypeCollection(t.constructor).remove(t),delete f.objectMap[e]);return t},isBlockingRequests:function(){return e.is(f._blockedRequests,"array")},blockRequests:function(){f._blockedRequests=f._blockedRequests||[]},unblockRequests:function(){f.isBlockingRequests()&&(f._blockedRequests.forEach(function(e){i.authenticatedRequest(e.url,e)}),delete f._blockedRequests)},clearBlockedRequests:function(){delete f._blockedRequests},getCurrentUserName:function(){var e=f.getObjectById(h.getContextUserUid());if(!e||!e.fullName){var t=s.getUser();return t.firstName+" "+t.lastName}return e.fullName},downloadFCSFile:function(t,n){let i=e.clone(n||{});i.onFailure=i.onFailure||Function.prototype,f.request(f.expandUrl(`invoke/dspol:checkOut?$this=${t}`),{method:"POST",type:"json",onComplete:function(e){f.request(e.url,{method:"POST",data:{__fcs__jobTicket:e.body},onComplete:function(e){i.onComplete&&i.onComplete(e)},onFailure:i.onFailure})},onFailure:i.onFailure})},invokeAsLRT:function(t,n){let i=e.clone(n||{},!1);return i.cancelableRequest=f.request(f.expandUrl("task/"+t),{invokeAsLRT:!0,method:"POST",queue:i.queue?i.queue:f,onComplete:function(e){var t={method:"GET",type:"json",headers:{"Content-Type":"application/json"}};return f.checkStatusOfLRT(e,i,t,1e3,0)},onTimeout:i.onTimeout||i.onFailure,onFailure:i.onFailure,data:JSON.stringify(i.data),headers:{"Content-Type":"application/json"},type:"json"}),i.cancelableRequest},invokeAsRPC:function(t,n){let i=e.clone(n||{},!1);return i.cancelableRequest=f.request(f.expandUrl("invoke/"+t),{method:"POST",queue:i.queue||f,onComplete:i.onComplete,onTimeout:i.onTimeout||i.onFailure,onFailure:i.onFailure,data:JSON.stringify(i.data),headers:{"Content-Type":"application/json"},type:"json"}),i.cancelableRequest},removeInflightAndSendPendingRequests:function(e){let t=e.cancelableRequest;t&&t.removeFromInFlightRequest(),e.queue&&f.sendPendingRequests(e.queue),f.sendPendingRequests(f)},checkStatusOfLRT:function(t,n,i,o,s){if(202===t["@code"]){var r=t["@id"],a=f.expandUrl("task/"+r.toString(),"v1");o=Math.max(o,s),i.onComplete=function(e){return f.checkStatusOfLRT(e,n,i,o,s+.1*o)},i.onFailure=function(t){return f.removeInflightAndSendPendingRequests(n),e.is(n.onFailure,"function")&&n.onFailure.apply(this,[t])},setTimeout(function(){f.request(a,i)},o)}else{if(200===t["@code"])return f.removeInflightAndSendPendingRequests(n),e.is(n.onComplete,"function")&&n.onComplete.apply(this,[t]);if(t["@code"]>=400)return e.is(n.onFailure,"function")&&n.onFailure.apply(this,[t])}},isStoryTask:function(e){const t=e.get("dsxplan:workscopeParent");if(t&&"NoAccessModel"!==t._uwaClassName){if(t.isAgile&&t.isAgile())return!1;const e=t.getParent&&t.getParent();if(e&&e.isAgile&&e.isAgile())return!0}return Boolean(e.get("dsxplan:backlogParent"))},isDPMProject:function(t,n,i){if(t)return Boolean(t&&"Project Space"===t.get("ds6w:type"));var o,s=i&&(i.detailedObjects||i.dropObj);if(e.is(s,"array")){for(var r=0;r<s.length;r++){var a=s[r];if(a.id===n){o=a;break}}return Boolean(o&&"Project Space"===o.objectType)}return Boolean(s&&"Project Space"===s.objectType)},getDefaultModelConstructor:function(){return f._defaultModelConstructor},setDefaultModelConstructor:function(e){f._defaultModelConstructor=e}}).inverseMapping=C,f.MS_DAY=864e5,f}),define("DS/RDFFoundation/Models/NoAccessModel",["UWA/Core","UWA/Class/Model","DS/RDFFoundation/RDFUtils","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],function(e,t,n,i){"use strict";return t.extend({isAgile:()=>!1,_uwaClassName:"NoAccessModel",idAttribute:"physicalId",init:function(t,o){var s=e.extend(t||{},{"dsxplan:label":i.get("RDFFoundation.Label.NoAccess"),image:require.toUrl("DS/RDFFoundation/assets/img/NoAccess.png"),physicalId:"noAccessModelId"});this._parent(s,o),this.set("physicalId","noAccessModelId"+this.cid),n.addObjectToMap(this.id,this)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"displayValue":case"title":return this.get("dsxplan:label")}return t},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){},sync:Function.prototype,getObjectType:Function.prototype,getParent:Function.prototype,hasViewAccess:function(){return!1},dataForRendering:function(){var e=this.toJSON();return e.isNoAccessModel=!0,e},isReferenceProject:function(){return!1},canBeRemoved:function(){return!0}})}),define("DS/RDFFoundation/Utils/Filter",["UWA/Class","UWA/Class/Events","UWA/Class/Listener","DS/RDFFoundation/RDFUtils"],function(e,t,n,i){"use strict";const o=e.extend({init:function(e){this.collection=e.collection,this._ids=[],this._active=!1},updateCollection:function(e){this.collection=e,this.isActive()&&this.execute()},setModels:function(e){this._ids=e.map(e=>o.getModelIdForFilter(e)),this.onChange()},getIds:function(){return this._ids},setActive:function(e){this._active!==e&&(this._active=e,this.onChange())},isActive:function(){return this._active},onChange:function(e){this.onChangeTimeout||(this.onChangeTimeout=setTimeout(()=>{this.onChangeTimeout=void 0;const t=this.isActive()?o.events.changed:o.events.deactivated;this.dispatchEvent(t,[e])},0))},execute:Function.prototype});return o.implement(t,n),o.getModelIdForFilter=function(e){return i.removeBracketLongURI(e.get("physicalId"))},o.events={changed:"onFilterChange",deactivated:"onFilterDeactivated"},o.ON_CHANGE_TIMEOUT=0,o}),define("DS/RDFFoundation/Models/DeletedModel",["UWA/Core","UWA/Class/Model","DS/RDFFoundation/RDFUtils","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],function(e,t,n,i){"use strict";return t.extend({isAgile:()=>!1,_uwaClassName:"DeletedModel",idAttribute:"physicalId",init:function(t,o){var s=e.extend(t||{},{"dsxplan:label":i.get("RDFFoundation.Label.Deleted"),image:require.toUrl("DS/RDFFoundation/assets/img/Deleted.png"),physicalId:"deletedModelId"});this._parent(s,o),this.set("physicalId","deletedModelId"+this.cid),n.addObjectToMap(this.id,this)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"displayValue":case"title":return this.get("dsxplan:label")}return t},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){},sync:Function.prototype,getObjectType:Function.prototype,getParent:Function.prototype,hasViewAccess:function(){return!1},dataForRendering:function(){var e=this.toJSON();return e.isNoAccessModel=!0,e},isReferenceProject:function(){return!1},canBeRemoved:function(){return!0}})}),define("DS/RDFFoundation/Utils/TaggerFilter",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Utils/Filter"],function(e,t,n){"use strict";const i=n.extend({init:function(e){this._parent.apply(this,arguments),e.proxy||e.collection?this.tnProxy=e.proxy?e.proxy:e.collection.getTNProxy({setPredicatesOnProxy:!1}):this.tnProxy=null,this.setupListener(),this.collection.requestFetchNewTags({onlyIfNeeded:!0}),this.listenTo(this.collection,{onAdd:()=>{this.collection.requestFetchNewTags(),this.updateTags()},onRemove:this.updateTags,"onChange:tagsData":this.updateTags})},handleTaggerFilter:function(e){const t=(e.filteredSubjectList||[]).map(e=>i.objectMap[e]);this.setModels(t),e.dontCacheFilters||this.setActive(Object.keys(e.allfilters).length>0)},updateTags:function(){this._updateTagTimeout=this._updateTagTimeout||setTimeout(()=>{this._updateTagTimeout=void 0;const e=this.collection.getTaggerData();"function"==typeof this.tnProxy.setSubjectsTags?this.tnProxy.setSubjectsTags(e):"function"==typeof this.tnProxy.setTags&&this.tnProxy.setTags(e)},200)},setupListener:function(){this.stopListening(this.tnProxy,"onFilterSubjectsChange"),this.listenTo(this.tnProxy,"onFilterSubjectsChange",this.handleTaggerFilter)},onChange:function(){this._parent({fromTagger:!0})}});return i.objectMap={},i.addModelToMap=function(e){i.objectMap[e.getTaggerURI()]=e,e.addEvent("onDestroy",function(t){try{i.objectMap[t.getTaggerURI()]=void 0}catch(t){console.error(`Could not calcluate tagger uri to remove ${e.id} from TaggerFilter map`)}})},i.UPDATE_TAG_TIMEOUT=200,i}),define("DS/RDFFoundation/Models/ResultModel",["UWA/Core","UWA/Utils","UWA/Class/Model","UWA/Class/Collection","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/BatchBuilder","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/MaskUtils","DS/RDFFoundation/Mixins/FetchTrackingMixin","DS/RDFFoundation/Utils/TaggerFilter","DS/RDFFoundation/Models/NoAccessModel","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/ApolloUtils","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,o,s,r,a,l,c,d,u,h,p,g){"use strict";o.objectMap={};var f,m,y=n,v=Object.prototype.hasOwnProperty;m=e.is;var C=function(){var t=this.get("dsxplan:jsType")||this.get("@type")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");return t&&!e.is(t,"string")&&(t=t.id),t};return f={_mapDslcAttributes:function(e){if(e&&this.dslcMapping)for(var t=Object.keys(e),n=t.length,i=0;i<n;i++){var o=t[i],s=this.dslcMapping[o];if(s){var r=e[o];delete e[o],e[s]=r}}return e},isRDF:!0,serviceHosting:"3dplan",idAttribute:"@id",_uwaClassName:"ResultModel",canBeRemoved:function(){return!0},getIdForFederatedSearch:function(){return this.id},getCombinedAttributes:function(e){let t=this.getChangedAttributesSinceLastSave(),n=e?Object.keys(e):[];return e?n.concat(t.filter(e=>n.indexOf(e)<0)):t},setCollection:function(t,n){var i=this;this._collections[t]=n;var o=this.getPropertyInverse(t);function s(t){var n;return!o.name||t&&t.dontRegisterChange||(n=e.clone(t||{},!1),e.merge(n,o),n.dontRegisterChange=!0),n}this.listenTo(n,{onAdd:function(e,n,i){var o=s(i);o&&e._addToModelOrCollectionProperty(this,o),this._registerChangedCollection(t,e,n,i)},onRemove:function(e,n,o){var r=s(o);r&&e._removeFromModelOrCollectionProperty(i,r),this._registerChangedCollection(t,e,n,o)},onReset:function(e,n){var o=s(n);if(o){var r={};n.previousModels.forEach(function(e){r[e.id]=e}),e.forEach(function(e){r[e.id]?delete r[e.id]:e._addToModelOrCollectionProperty(i,o)});for(var a=Object.keys(r),l=0;l<a.length;l++){r[a[l]]._removeFromModelOrCollectionProperty(i,o)}}this._registerChangedCollection.bind(this,t)}})},hasUsedMask:function(e){return!!(this._usedMasks&&this._usedMasks.indexOf(e)>-1)},hasViewAccess:function(){return{"dsxplan:Open":!0,"dsxplan:Draft":!0,"dsxplan:InProgress":!0,"dsxplan:Done":!0,"dsxplan:OnHold":!0,"dsxplan:Published":!0,"dsxplan:Low":!0,"dsxplan:Medium":!0,"dsxplan:High":!0,"dsxplan:Urgent":!0}[this.id]||!!this.get("dsplan:jsType")||!!this.get("dsxplan:jsType")},MAX_CONCURRENT_REQUEST:1,init:function(e,t){this._inFlightRequests=[],this._pendingRequests=[],e&&e.forceDslc&&(this._isDslc=!0,delete e.forceDslc),this.initFetchTrackingMixinForInstance(),this._models={},this._collections={},this._changedAttributesSinceLastSave={},this._fetchedAttributes={},this.isDSLC(e||{})&&(e=this._mapDslcAttributes(e));var n=t||{};Object.defineProperty(this,"collectionConstructor",{get:this._getCollectionConstructor,set:function(e){return this._collectionConstructor=e,e}}),this._collectionConstructor||(n.collectionConstructor?this.collectionConstructor=n.collectionConstructor:n.collection&&(this.collectionConstructor=n.collection.constructor));var i=e&&e["@id"];if(i){if(o.getObjectById(i))throw new Error("object existing try to get existing from resultmodel first");o.addObjectToMap(o.removeBracketLongURI(i),this),e["@href"]||(e["@href"]=o.hrefFromId(i))}return this._parent.apply(this,arguments)},_getCollectionConstructor:function(){return this._collectionConstructor||this.collection&&this.collection.constructor||o.ResultCollection},_registerChangedCollection:function(e,t,n,o){var s=n,r=o;t instanceof i&&(s=t,r=n),r&&(r.parse||r.dontRegisterChange)||this.isPropertyVolatile(e)||(this._changedAttributesSinceLastSave[e]=s)},getParent:Function.prototype,getParentModels:function(e){if(this.getParent()){var t=this.getParent();e.push(t.id),t.getParentModels(e)}},isParentHierarchyLoaded:function(e,t){return!!e&&(t===e||this.isParentHierarchyLoaded(e.getParent(),t))},_registerChangedAttributes:function(t,n){var i=t||this,o=e.clone(n||{},!1);if(!o.parse&&!o.dontRegisterChange){var s=i.changedAttributes();for(var r in s)v.call(s,r)&&!this.isPropertyVolatile(r)&&this._registerChangedAttribute(r,s[r],n)}},_registerChangedAttribute:function(e,t,n){var i=this._changedAttributesSinceLastSave;void 0!==i[e]&&null!==i[e]||(i[e]=this.previous(e)),t instanceof f&&(this._models[e]=t),this._updateInverseProperty(e,t,n)},_updateInverseProperty:function(t,n,i){var s=this.getPropertyInverse(t);if(s.name){var r=e.clone(i||{},!1);e.merge(r,s),r.dontRegisterChange=!0;var a=this.previous(t);if(a&&(a["@id"]&&(a=o.getObjectById(a["@id"])),a instanceof f&&a!==n&&a._removeFromModelOrCollectionProperty(this,r)),n){let e=n.get(s.name);const t=Boolean(e)&&s.isCollection?e.get(this):e===this;n&&n instanceof f&&!t&&n._addToModelOrCollectionProperty(this,r)}}},_removeFromModelOrCollectionProperty:function(e,t){t.isCollection?this.getCollectionAttribute(t.name).remove(e,t):this.unset(t.name,t)},_addToModelOrCollectionProperty:function(e,t){t.isCollection?this.getCollectionAttribute(t.name).add(e,t):this.set(t.name,e,t)},destroy:function(t){this.destroying=!0;var n=e.clone(t||{},!1),i=this;n.apolloShouldIgnore||(n.onComplete=function(){h.onModelDeleted(i),t&&t.onComplete&&t.onComplete.apply(i,arguments)}),n.dontRegisterChange=!0;var s=Array.prototype.slice.call(arguments,0);s[0]=n,this.stopListening(),o.removeObjectFromMap(this.id),o.removeObjectFromMap(this.cid),this._parent.apply(this,s),this.removeEvents()},clone:function(){throw new Error("don't clone resultmodels please")},toJSON:function(t){var n="string"==typeof t?{}:e.clone(t||{},!1),i=void 0===n.level?1:n.level;if(i<0)return{};n.level=i-1;var o=n.ancestors,s=o&&o[this.id];o||(n.ancestors=o={});try{o[this.id]=!0;var r=this._parent.apply(this,arguments),a={},l={};if(n.attributes)for(var c=n.attributes.length,d=0;d<c;d++){var u=n.attributes[d],h=r[u];void 0!==h&&(l[u]=h),a[u]=!0}else l=r;if(n.attributesWhiteList=a,s||n.noSerialize||(this._jsonChildren(l,this._models,i,n),this._jsonChildren(l,this._collections,i,n),t&&t.noSkeletonId&&delete l._skeletonId),this.isDSLC()&&this.dslcMapping&&(n.level=i,n.isAnAncestor=s,this._jsonDSLC(l,n),n.ancestors=o,i>0&&(n.level=i-1)),n.attributes){var p=n.attributes.filter(function(e){return!l[e]});this._jsonAddAttributes(l,p,n)}return this.hasViewAccess()||(l.error="No Access",l.noAccessCharacter=g.get("E6WCommonUI.Error.NoAccess")+" "),l}finally{delete o[this.id]}},_jsonChildren:function(e,t,n,i){for(var s=Object.keys(t),r=s.length,a=i.attributesWhiteList,l=0;l<r;l++){var c=s[l];if(0!==n){if(i.attributes&&!a[c])continue;var d=t[c];if(d instanceof o.ResultCollection&&!d.length&&i.noEmptyCollection){delete e[c];continue}e[c]=d.toJSON(i)}else delete e[c]}},_jsonAddAttributes:function(t,n,i){for(var s=i.attributesWhiteList,r=i.isAnAncestor,a=n.length,l=0;l<a;l++){var c=n[l];if(!i.attributes||s[c]){var d=this.get(c),u=!1;if(void 0!==d){if(!r){if(e.is(d,"array")){for(var h=[],p=0;p<d.length;p++)if(d[p]instanceof f||d[p]instanceof o.ResultCollection){if(0===i.level){u=!0;break}h.push(d[p].toJSON(i))}d=h}(d instanceof f||d instanceof o.ResultCollection)&&(0!==i.level?d=d.toJSON(i):u=!0)}u?delete t[c]:t[c]=d}}}},_jsonDSLC:function(e,t){if(t.dataForRendering){var n=Object.keys(this.dslcMapping);this._jsonAddAttributes(e,n,t)}},getCollectionAttribute:function(e,t){var n=e;this.isDSLC()&&this.dslcMapping&&(n=this.dslcMapping[e]||n);var i=this.get(n);return i||(i=this.addNewCollectionData(n,void 0,t)),i},isNew:function(e){return!(e&&e.excludeForced||!this.forcedNew)||this._parent.apply(this,arguments)},_syncCreateDSLC:function(e,t){var n=t.idToDuplicate?f.CLONE_ITEM_VERSION_URI:f.CREATE_ITEM_VERSION_URI,i=t.mask||this.writeMask||this.getMask(),s=i?"?$mask="+i:"";t.url=o.expandUrl(n+s);var r=this.getParentPath(),a=t.idToDuplicate;t.data=a?JSON.stringify([t.attrs,a,r]):JSON.stringify([t.attrs,r]),t.method="POST"},syncCreate:function(e,t){var o=this,s={},r={};Object.keys(e).forEach(function(t){var a,l;if((a=e[t])instanceof i){if(!a.length)return;s[t]=a,l=a.compactJson()}else l=a instanceof n||Boolean(this._models[t])?a?o.getRelatedModelCompactJson(a,t):void 0:a;r[t]=l},this);var a,l,c=(a=this.getParentPath(),(l=a.split("/"))[l.length-1]),d=this.getPropertyThisIsInverseOf(c);d&&delete r[d],t.attrs=t.attrs=t.noStringify||this.isDSLC()||t.dslc?r:JSON.stringify(r);var u=[],h=Object.keys(this._models),p=Object.keys(this._collections),g=t.onComplete,f=t.onFailure;h.forEach(function(e){var t=this[e];t.isNew()&&u.push(t)},this._models);var m=function(e){e.isNew()&&u.push(e)};p.forEach(function(e){this[e].forEach(m)},this._collections),t.onComplete=function(){var e;e=o._collections,Object.keys(e).forEach(function(e){var t=s[e];t&&t.resetFlags()}),u.forEach(function(e){e.isNew({excludeForced:!0})&&e.destroy()}),g&&g.apply(o,arguments)},t.onFailure=function(){setTimeout(()=>{o.destroy({noServer:!0,dontRegisterChange:!0})},0),f&&f.apply(o,arguments)};var y=t.onTimeout;t.onTimeout=function(){o.destroy({noServer:!0,dontRegisterChange:!0}),y&&y.apply(o,arguments)},this.collection&&this.collection.removeAddedModel(this),(this.isDSLC()||t.dslc)&&this._syncCreateDSLC(e,t)},_syncPatchDSLC:function(e,t){var n=t.mask||this.getMask();t.url=o.expandUrl(f.MODIFY_ITEM_VERSION_URI+(n?"?$mask="+n:""));var i=t.activityIdToSubscribe;t.data=i?JSON.stringify([t.attrs,this.id,i]):JSON.stringify([t.attrs,this.id]),t.method="POST"},_syncPatchHandleCollectionAttribute:function(t,n,i){var o,s=n._replaceOnSave,r=[],a=this;return delete n._replaceOnSave,"rdf:type"===t&&1===n._added.length&&1===n.length&&(n._removed.length>0||s)?r.push({op:"replace",path:"/"+t,value:this.getRelatedModelCompactJson(n._added[0],t)}):(n._added.forEach(function(e){r.push({op:"add",path:"/"+t+"/-",value:a.getRelatedModelCompactJson(e,t)})}),n._removed.forEach(function(n){o=n["@value"],e.is(o)?e.is(o,"string")&&(o='"'+o+'"'):o=n.id,r.push({op:"remove",path:"/"+t+"/{"+o+"}"})})),i[t]={_removed:n._removed,_added:n._added},n.resetFlags(),r},syncPatch:function(t,o){var s=[],r={},a=this._changedAttributesSinceLastSave;this._changedAttributesSinceLastSave={};var l,c={},d=this;if(Object.keys(a).forEach(function(e){var o,l,u,h,p;d.isPropertyVolatile(e)||d.computedProperties&&d.computedProperties[e]||((o=t[e])instanceof i?s.push.apply(s,d._syncPatchHandleCollectionAttribute(e,o,c)):(p=o instanceof n||Boolean(this._models[e]),u=a[e],m(u)&&!m(o)?h="remove":!m(u)&&m(o)?h="add":m(u)&&m(o)&&(p&&u.id!==o.id||!p&&u!==o)&&(h="replace"),p?(r[e]=o,l=o?d.getRelatedModelCompactJson(o,e):void 0):l=o,h&&s.push({op:h,path:"/"+e,value:l})))},this),s.length||(o&&o.onComplete&&o.onComplete({}),l={cancel:function(){}}),!l){o.attrs=o.noStringify||this.isDSLC()?s:JSON.stringify(s);var u=e.clone(o||{},!1),h=o.onFailure;o.onFailure=function(e){h&&h(e),this.dispatchEvent("onError",[this,e,u]),this.rollbackChanges(a,c,t)}.bind(this),o.url=this.url({mask:this.writeMask})}return!l&&this.isDSLC()&&(l=this._syncPatchDSLC(t,o)),l},rollbackChanges:function(e,t,n){var i=this,o=e||this._changedAttributesSinceLastSave,s=!1,r={};if(o&&Object.keys(o).forEach(function(e){var t=i.get(e),n=o[e];n!==t&&(r[e]=n,s=!0)}),s){this.set(r,{dontRegisterChange:!0});var a=this._previousAttributes;this._previousAttributes=n;for(var l=Object.keys(r),c=0;c<l.length;c++){var d=l[c];this._updateInverseProperty(d,r[d])}this._previousAttributes=a}t&&Object.keys(t).forEach(function(e){var n=i.get(e),o=t[e],s=!1;o._added&&o._added.forEach(function(t){i.onCollectionRollback(e),n.remove(t,{dontRegisterChange:!0}),s=!0}),o._removed&&o._removed.forEach(function(e){n.add(e,{dontRegisterChange:!0}),s=!0}),s&&i._fireRelationshipChangeEvents(e)}),this._changedAttributesSinceLastSave={}},onCollectionRollback:Function.prototype,_dontRollBackAndRetrySave:function(t,n){var i=this;e.extend(this._changedAttributesSinceLastSave,t),Object.keys(n).forEach(function(e){var t=i.get(e),o=n[e];o._added&&o._added.forEach(function(e){t._registerAddedModel(e)}),o._removed&&o._removed.forEach(function(e){t._registerRemovedModel(e)})}),this.save()},fetchingMask:function(e){this._masksBeingFetched=this._masksBeingFetched||{},this._masksBeingFetched[e]=!0},doneFetchingMask:function(e){this._masksBeingFetched&&delete this._masksBeingFetched[e]},_syncSetQueue:function(t,n){if(this instanceof f&&!n.queue){var i=this;"create"===t&&e.is(this.getParent,"function")&&(i=this.getParent()||this),n.queue=i}},ifActualFailure:function(e,t){var n=!0,i=e?Object.keys(a.getMask(e)||{}):[];return e&&i.length?-1!==i.indexOf("dsxplan:jsType")||-1!==i.indexOf("@type")?n=!t["dsxplan:jsType"]&&!t["@type"]:"dsplan:MVMask.Task.Deliverables"===e?t["dsxplan:actualDeliverable"]&&(n=!1):"dskern:Mask.Default"===e?t.title&&(n=!1):"dsplan:MVMask.URL.Complex"===e?t["dsplan:linkURL"]&&(n=!1):"dsplan:MVMask.History.Basic"===e&&(t["dsxplan:label"]||t["dsplan:label"])&&(n=!1):n=!t["dsxplan:jsType"]&&!t["@type"],n},sync:function(t,n,i){if(i&&i.noServer)return i&&i.onComplete&&i.onComplete({}),{cancel:function(){}};var s=this,r=e.clone(i||{},!1);r.ajax||(r.ajax=o.request,this._syncSetQueue(t,r));var a=e.extend(this.toJSON({noSkeletonId:!0}),this._collections);a=e.extend(a,this._models);var l=Array.prototype.slice.call(arguments,0);l[2]=r;var c=i.onComplete,d=i.onFailure,u=function(e){p.trackPageEvent({eventCategory:"ResultModel",eventAction:e,eventLabel:n.getObjectType()})};switch(t){case"create":this.syncCreate(a,r);try{u(t)}catch(e){console.log("e")}break;case"update":case"patch":l[0]="patch";var h=this.syncPatch(a,r);if(h)return h;try{u(t)}catch(e){console.log("e")}break;case"read":var g=this.mask;i&&i.mask&&!i.dontUpdateMask&&(this.mask=i.mask,this.fetchingMask(this.mask)),this.fetching=!0,r.onComplete=function(e){s instanceof f&&s.ifActualFailure(i.mask,e)?r.onFailure(e,"no-access"):(i&&i.mask&&!i.dontUpdateMask&&s.doneFetchingMask(i.mask),s.fetching=!1,c&&c.apply(this,arguments))},r.onFailure=function(){i&&i.mask&&!i.dontUpdateMask&&s.doneFetchingMask(i.mask),s.fetching=!1,s.mask=g,d&&d.apply(this,arguments)};break;case"delete":this.syncDelete(r);try{u(t)}catch(e){console.log("e")}}return r.id=this.id||this.cid,this._parent.apply(this,l)},onTypeChange:function(){var e=o.getModelConstructor(this.toJSON())||f;if(!(this instanceof e)){o.removeObjectFromIndex(this.id);var t=new e(this.toJSON({noSerialize:!0}),{collectionConstructor:this.collectionConstructor});this.dispatchEvent("onReplace",[this,t])}},isDSLC:function(e){if(this._isDslc)return this._isDslc;var t,n=e?e["@type"]:f.prototype.get.call(this,"@type",{noDSLCMapping:!0});if(n&&o&&o.typeDictionary&&o.typeDictionary.typeHierarchy){var i=o.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"];t=i&&-1!==i.indexOf(n)}else if(!e){var s=this.get("dsxplan:jsType",{noDSLCMapping:!0})||f.prototype.get.call(this,"dsxplan:actualType",{noDSLCMapping:!0});if(!(t=Boolean(s))){var r=f.prototype.get.call(this,f.ACTUAL_TYPE_ATTR,{noDSLCMapping:!0})||n;if((r=r&&(r.id||r))&&!(t="dslc:ItemVersion"===r)&&o&&o.typeDictionary&&o.typeDictionary.typeHierarchy){var a=o.typeDictionary.typeHierarchy["dslc:ItemVersion"];t=a&&-1!==a.indexOf(r)}}}return this._isDslc=t,t},setup:function(t,n){if(f.scheduleUpdateInverseProperties(this),n=n||{},this.isDSLC()&&this.inverseDslcMapping){var i=this;Object.keys(this.inverseDslcMapping).forEach(function(e){i.listenTo(i,"onChange:"+e,function(t,n,i){i&&i.silent||t.dispatchEvent("onChange:"+this.inverseDslcMapping[e],arguments)})})}!this.collection&&n.mask&&(this.mask=n.mask),this.isNew()&&this.set("_skeletonId","temp:"+this.cid),this.listenTo(this,"onChange",this._registerChangedAttributes),this.listenTo(this,"onChange:@href",this.onHRefChange),this.listenTo(this,"onChange:@id",this.onAtIdChange),this.listenTo(this,"onChange:rdf:type",this.onTypeChange),this.listenTo(this,"onChange:dsplan:actualType",this.onTypeChange),this.listenTo(this,"onChange:dsxplan:actualType",this.onTypeChange),this.listenTo(this,"onChange:dsxplan:jsType",this.onTypeChange);var s=o.getTypeCollection(this.constructor,{create:!0}),r=e.clone(n,!1);if(r.parse=!1,r.fireTypeCollectionEvent&&delete r.silent,s.get(this))throw new Error("object existing try to get existing from rdfutils first!");s&&s.add(this,r),this.id?c.addModelToMap(this):o.addObjectToMap(this.cid,this)},_updateInverseProperties:function(){if(this._propertyDictionary){Object.entries(this._propertyDictionary).filter(([e,t])=>t.inverseProperty).forEach(([e,t])=>{const n=this.get(e);n&&this._updateInverseProperty(e,n,{fromServer:!0})})}},url:function(e){var t,n;if(this.isNew()){var i=this.collection.getUri({forNewObject:!0});t=o.expandUrl(i),n="/resource"===i.substr(0,"/resource".length)}else t=o.expandUrl(this.get("@href")?this.get("@href"):"","v1");var s=e&&e.mask;return s||(s=this.getMask(),this.isNew()&&(s=n?this.parentMask||this.collection.getMask():this.writeMask||s)),r.addQueryParam(t,"$mask",s)},_originalGet:function(){return n.prototype.get.apply(this,arguments)},get:function(e,t){var n=Array.prototype.slice.call(arguments,0),i=e;return t&&t.noDSLCMapping||!this.isDSLC()||!this.dslcMapping||(i=this.dslcMapping[i]||i),n[0]=i,"physicalId"===i?this.id&&o.jsonURIToSparqlURI(this.id):this._models[i]||this._collections[i]||this._parent.apply(this,n)},compactJson:function(){if(this.isNew())return this.toJSON({noSkeletonId:!0,noEmptyCollection:!0});var e={};return e[this.idAttribute]=this.id,e},parse:function(n,i){var s;if(!e.is(n,"object"))return{value:n};var r=e.clone(n||{},!1);n&&n["@href"]&&0===n["@href"].indexOf("/invoke/")&&(r=n["@value"]||n.value),s=o.parseUrl(r["@href"]),o.handleContext(r),delete r["@context"],delete r["@code"],this.addMask(r["@mask"]),s.path&&(r["@href"]=s.path),(!this.mask||o.compareMasks(this.getMask(),r["@mask"])<0)&&(this.mask=r["@mask"]);var l=r["@mask"];l&&a.addMask(l),delete r["@mask"];var c=r["@id"];return c&&(c.test(/[/?]/)?r._skeletonId=t.getCheckSum("_"+c):r._skeletonId=c),r.image&&(r.image=o.getAssetUrl(r.image)),r["@id"]&&r["@id"]!==this.id&&this.set("@id",r["@id"],{dontRegisterChange:!0}),this._parseNestedModelsAndCollections(r,l,i),this._parsePruneModelsAndCollections(r,l,i),r},_parseNestedModelsAndCollections:function(t,n){var i=t,o=n;Object.keys(i).forEach(function(t){var n;n=!e.is(i[t],"string")||"dsxplan:hasPriority"!==t&&"dsxplan:hasMaturity"!==t?i[t]:{"@id":i[t]},(m(n,"object")&&n["@id"]||"dsxplan:hasPriority"===t||"dsxplan:hasMaturity"===t)&&("Collection"===n["@type"]?this.parseNestedCollection(i,o,t,n):this.parseNestedModel(i,o,t,n))},this)},parseNestedCollection:function(t,n,i,o){var s,r=!0;if(o.member&&o.member.length&&(s=o.member,r=!e.Array.detect(s,function(t){return!e.is(t,"string")})),r&&s){var l=e.clone(s,!1);this.set(i,l,{dontRegisterChange:!0}),t[i]=l,a.addAttributeToMask(n,i,a.ARRAY_ATTR)}else this.addNewCollectionData(i,o,{parse:!0,fromServer:!0}),o.member&&a.addAttributeToMask(n,i,a.COLLECTION_ATTR)},parseNestedModel:function(e,t,n,i){let o=this._models[n];if(o&&o.id===i["@id"]){var s=o.parse(i);o.set(s,{dontRegisterChange:!0,dontAdjustDates:!0})}else o=f.mergeOrCreateObject(i),this._models[n]=o;e[n]=o,t&&a.addAttributeToMask(t,n,a.MODEL_ATTR)},_parsePruneModelsAndCollections:function(t,n,i){var o=n,s=t;if(o)for(var r,l=a.getMask(o),c=Object.keys(l),d=c.length,u=function(e){return!e.isNew()},h=function(e){e.isNew()&&r.push(e)},p=0;p<d;p++){var g=c[p];if(!s[g])switch(l[g]){case a.COLLECTION_ATTR:var f=this.get(g,{noDSLCMapping:!0}),m=e.clone(i||{},!1);if(delete m.batchFetch,delete m.parse,m.dontRegisterChange=!0,f){r=f._added.filter(u),f.forEach(h);var y=f.length;if(f.reset&&f.reset(r||[],m),y!==f.length){this._fireRelationshipChangeEvents(g,m);try{var v=this._attributes&&this._attributes[g];v&&(v.totalItems=f.length,v.member=f.pluck("@id").map(function(e){return{"@id":e}}))}catch(e){console.log(e)}}}break;case a.MODEL_ATTR:var C=g;this.isDSLC()&&this.inverseDslcMapping&&this.inverseDslcMapping[C]&&(C=this.inverseDslcMapping[C]),void 0!==s[C]&&void 0===this.get(g)&&this.parsePruneModel(g,s[C],i);break;case a.STRING_ATTR:case a.ARRAY_ATTR:default:void 0!==s[g]&&null!==s[g]||void 0!==this.get(g)&&this.unset(g,{dontRegisterChange:!0})}}},parsePruneModel:function(e,t,n){!this._models[e]||this._models[e]===t||n&&n.silent||this._fireRelationshipChangeEvents(e,n),delete this._models[e],delete this._attributes[e]},removeObject:function(t,i,o){var s=t;this.isDSLC()&&this.dslcMapping&&(s=this.dslcMapping[s]||s);var r=this._collections[s];if(r){if(e.is(i,"number"))r.at(i);else{if(!(i instanceof n))throw new Error("invalid object to remove "+i);i}r.remove(i,o),this._fireRelationshipChangeEvents(s,o,o&&o.silentOnChange),o&&o.silent&&(this._registerChangedCollection(s,i,r,o),r._registerRemovedModel(i,r,o))}else this._models[s]===i&&(this.unset(s,o),o&&o.silent&&this._registerChangedAttributes())},getMask:function(){return this.mask||this.collection&&this.collection.getDetailsMask()},dataForRendering:function(t){var n=e.clone(t||{},!1);return n.dataForRendering=!0,this.toJSON(n)},_setDateAttribute:function(t,n,i){if(n instanceof Date)this.set(t,n.toISOString(),i);else{if(!e.is(n,"string"))throw new Error(n+" is not a date object or a string. It was not saved for the model.");this.set(t,n,i)}i&&i.silent&&this._registerChangedAttributes()},isOfType:function(e){var t=o.typeDictionary.typeMap,n=this.get("dsxplan:jsType")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");return n=n.id||n,!(!t||!n)&&t[e].key===n},_fireRelationshipChangeEvents:function(t,n,i,o){if(!(n&&n.silent||(o||(this.dispatchEvent("onChange:"+t,[this,n]),n&&"add"===n.operation?this.dispatchEvent("onAdd:"+t,[this,n]):n&&"remove"===n.operation&&this.dispatchEvent("onRemove:"+t,[this,n])),i))){var s=e.clone(n||{},!1);s.relationshipChanged=t,this.dispatchEvent("onChange",[this,s])}},addObjects:function(e,t,n,i){var o=t;this.isDSLC()&&this.dslcMapping&&(o=this.dslcMapping[t]||o);var s,r=[],a=e.length,l=this._collections[o];l||(l=this._createCollection(o,void 0,i));for(var c=0;c<a;c++){var d=this.getObjectToBeAdded(e[c],i);r.push(l.add(d,i)),i&&i.silent&&l._registerAddedModel(d,l,i)}if(r.length)try{this._changing||(s=this._changed,this._changed={}),this._fireRelationshipChangeEvents(o,i,i&&i.silentOnChange),i&&i.silent&&this._registerChangedCollection(o,l,i)}finally{this._changing||(this._changed=s)}return r},getObjectToBeAdded:function(t,n){var i;if(t instanceof f)i=t;else if(e.is(t,"string"))(i=o.getObjectById(t))||(i=new f(o.createPlaceholder(t))).fetch(n);else if(t["@id"]&&t["@type"]){var s=e.clone(t,!1),r=o.getModelConstructor(t);s.mask=n.mask||r.prototype.mask||"dsplan:MVMask.Task.Basic",i=o.getObjectForAdding(r,t["@id"],s)}return i},addModelToAttributeWithCollection:function(t,n,i){var o,s=this._collections[t],r=e.clone(i||{},!1);if(s)o=s.add(n,i);else{r.parse=!0;var a=this._jsonForCollectionForAttribute(t);n&&(a.member=[n]),s=this.addNewCollectionData(t,a,r),n&&s.dispatchEvent("onAdd",[s.at(0),s]),o=s.first()}return o},_jsonForCollectionForAttribute:function(e,t){return{"@href":this._computeCollectionId(e,t),"@id":this.get("@id")+"/"+e,"@type":"Collection","@mask":t&&t.mask||this.getMask()}},addNewCollectionData:function(t,n,i){var o=this._collections[t];if(o){var s=function(e,t){return e+"|"+t.id},r=o.reduce(s,""),a=o.state.totalRecords;o.update(n,i);var l=o.reduce(s,""),c=o.state.totalRecords;l===r&&c===a||this._fireRelationshipChangeEvents(t,i)}else{var d=e.clone(i||{},!1);d.parentModel=this,o=this._createCollection(t,n,d)}return o},_createCollection:function(t,n,i){var o=n;e.is(n,"array")&&((o=this._createCollection(t)).member=n);var s=this.getCollectionConstructor(t),r=e.clone(i||{},!1);r["@href"]=this._computeCollectionId(t,r);var a=new s(o,r);if(this.setCollection(t,a),this.set(t,a,{dontRegisterChange:!0}),this.getPropertyInverse(t).name)for(var l=0;l<a.length;l++){var c=a.at(l);this._updateInverseProperty(t,c)}return a},getCollectionConstructor:function(e){var t,n=this.collectionConstructor;if(this._relations&&(t=this._relations.detect(function(t){return t.key===e})),t){var i=t.relatedCollection;i&&(n=i)}return n},getChangedAttributesSinceLastSave:function(){return this._changedAttributesSinceLastSave?Object.keys(this._changedAttributesSinceLastSave):[]},_computeCollectionId:function(e){return this.get("@href")+"/"+e},onHRefChange:function(){var e=this;this._collections&&Object.keys(this._collections).forEach(function(t){var n=e._collections[t],i=e._computeCollectionId(t,{mask:n.getMask()});n.setUri(i)})},onAtIdChange:function(){this.id?(o.addObjectToMap(this.id,this),c.addModelToMap(this)):o.addObjectToMap(this.cid,this);var e=this.previousAttributes()["@id"];e?o.removeObjectFromMap(e):this.id&&o.removeObjectFromMap(this.cid)},setModel:function(t,n,i){var o=p.setHelper.apply(this,arguments),s=e.clone(o.attrs||{},!1);i=o.options,this.isDSLC()&&s&&(s=this._mapDslcAttributes(s));for(var r=Object.keys(s),a=r.length,l=0;l<a;l++){var c=r[l],d=s[c];this._models[c]!==d?(this._previousAttributes||(this._previousAttributes=e.clone(this._attributes,!1)),this._previousAttributes[c]=this._models[c],this._models[c]=d):delete s[c]}return y.prototype.set.call(this,s,i)},set:function(){var t=p.setHelper.apply(this,arguments),n=e.clone(t.attrs||{},!1),i=t.options;this.isDSLC()&&n&&(n=this._mapDslcAttributes(n)),this._removeModelsForUndefinedValues(n);var o=this._setModelIfNeeded(n,i);return this._parent(n,i)&&o},_removeModelsForUndefinedValues:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];void 0===e[i]&&delete this._models[i]}},_setModelIfNeeded:function(e,t){for(var n=Object.keys(e),i=n.length,o={},s=!1,r=0;r<i;r++){var a=n[r],l=e[a];l instanceof f&&(o[a]=l,s=!0)}var c=!0;return s&&(c=this.setModel(o,t)),c},syncDelete:function(e){if(this.isVersion()&&this.isDSLC()||e.dslc){e.url=o.expandUrl(f.DELETE_ITEM_VERSION_URI),e.data=JSON.stringify([this.id,Boolean(e.isStructureDelete)]),e.method="POST";var t=e.onComplete;e.onComplete=function(e){var n=e.member;if(n)for(var i=0;i<n.length;i++){var s=n[i],r=o.getObjectById(s);r&&r.destroy({noServer:!0})}t.apply(this,arguments)}}this.handleDeleteFailure(e)},handleDeleteFailure:function(e){var t=e.onFailure,n=e.onComplete;this._collectionsRemovedFrom=[];var i=this;e.onFailure=function(){o.addObjectToMap(i.id,i),o.addObjectToMap(i.cid,i),i._collectionsRemovedFrom.forEach(function(e){e.add(i)}),delete i._collectionsRemovedFrom,t&&t.apply(i,arguments)},e.onComplete=function(){delete i._collectionsRemovedFrom,n&&n.apply(i,arguments)}},onRemovedFromCollection:function(e){this._collectionsRemovedFrom&&this._collectionsRemovedFrom.push(e)},fetch:function(t){var n=e.clone(t||{},!1);return n.dontUpdateMask&&(n.url=this.url(t)),n.mask&&n.onlyIfNeeded&&this.hasDataForMask(n.mask,{checkFetching:!0})?(n.onComplete&&n.onComplete(this),{cancel:function(){}}):this._parent(n)},isPropertyVolatile:function(e){return"@etag"===e||this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].volatility},getPropertyInverse:function(e){return{name:this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].inverseProperty,isCollection:this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].inversePropertyIsCollection}},getPropertyThisIsInverseOf:function(e){var t;if(this._propertyDictionary){var n=this;Object.keys(this._propertyDictionary).some(function(i){return n._propertyDictionary[i].inverseProperty===e&&(t=i),void 0!==t})}return t},getParentPath:function(){return this.collection.getIdForCreateChildDSLC()},addMask:function(t){this._usedMasks=this._usedMasks||[],t&&-1===this._usedMasks.indexOf(t)&&(this._usedMasks.push(t),e.merge(this._fetchedAttributes,a.getMask(t)))},getMasks:function(){return this._usedMasks||(this._usedMasks=[]),this._usedMasks},hasDataForMask:function(e,t){var n=a.isSubMask(e,this.getMasks());if(!n&&t&&t.checkFetching&&this._masksBeingFetched){var i=Object.keys(this._masksBeingFetched);n=a.isSubMask(e,i)}return n},resetMasks:function(){this._usedMasks=[]},unset:function(e){var t,n=this._models[e],i=this._collections[e];n&&(t=this._previousAttributes[e],this._previousAttributes[e]=n,delete this._models[e]),i&&(t=this._previousAttributes[e],this._previousAttributes[e]=n,delete this._collections[e]);var o=this._parent.apply(this,arguments);return o||(this._models[e]=n,this._collections[e]=i,this._previousAttributes[e]=t),o},getTagPrefix:function(){return o.TAGGER_URI_PREFIX},getObjectType:C,getDragType:C,getObjectTypeNLS:function(){return p.translateType(C.call(this))},getTransferObject:function(n){var i=this.getDragType(),o=e.clone(n||{},!1);o&&delete o.parentObject;var s=e.merge(o,{source:window.widget.getValue("appId")||"X3DCSMA_AP",envId:window.enoviaServer&&window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),objectId:this.get("physicalId"),objectType:i,objectType_Internal:i,displayType:p.translateType(i),displayName:this.get("title"),serviceId:o.serviceId||"3dplan",image:this.get("image"),objectState:this.get("@etag")||t.getUUID()});let r=this.getIconURL&&this.getIconURL();return r&&(s.displayIcon=r,r!==s.image&&(s.displayPreview=s.image)),p.getTransferObject(s)},getLaunchOptions:function(){var e={appId:"ENXPLAN_AP"};return e.ids=this.id,e.x3dPlatformId=window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),e},isVersion:function(){return!1},hasChanged:function(e){var t=e;return this.isDSLC()&&this.dslcMapping&&(t=this.dslcMapping[e]||t),this._parent(t)},hasFetchedAttribute:function(e){var t=this.isDSLC()&&(this.dslcMapping[e]||e);return this.getMasks().detect(function(e){return a.getMask(e)[t]})},getFetchedAttributes:function(){return this._fetchedAttributes},processLiveUpdateCreation:function(e){var t=o.getObjectById(e["@parentId"]),n=t.getCollectionAttributeBasedOnModel(this);if(t.hasFetchedAttribute(n)){t.getCollectionAttribute(n).add(this,{dontRegisterChange:!0});var i=this.liveUpdateCreateMask||"dsplan:MVMask.ScheduleElements.Basic";this.fetch({mask:i})}},_fetchHistoryFromS3Bucket:function(e){var t=window.enoviaServer&&window.enoviaServer.tenant;const n=u.getServiceUrl("3dplan",!0)+`/auditarchive/api/v1/historyentries/${this.id}?tenantId=${t}&sourceService=3DPLAN`;return o.request(n,{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:t=>this._fetchHistoryFromRDF(t,e),onFailure:()=>this._fetchHistoryFromRDF([],e),onCancel:()=>{this.fetchingHistory=!1}})},_fetchHistoryFromRDF:function(t,n){var i=e.clone(n||{},!1),s=this.id;const r=o.expandUrl(`invoke/dsaudit:Auditable.getHistory?$this=${s}`,"v1");return o.request(r,{method:"POST",type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:e=>{this.fetchingHistory=!1,i.onComplete&&i.onComplete.apply(this,[e,t])},onFailure:e=>{this.fetchingHistory=!1,i.onFailure&&i.onFailure.call(this,e)},onCancel:()=>{this.fetchingHistory=!1}})},fetchAuditHistoryData:function(e){return this.fetchingHistory=!0,this._fetchHistoryFromS3Bucket(e)},getRelatedModelCompactJson:function(e){return e.compactJson()},isDeleted:function(){return!this.get("dsxplan:jsType")||0===this.get("dsxplan:jsType").indexOf("dsplan:Deleted")},getTaggerURI:function(){var e=this.get("physicalId")||this.id;return this.isRDF&&(e=this.getTagPrefix()+o.conditionalShortToLongURI(e)),e},uploadingFileForAttribute:function(e){return this._attributes[e]&&this._attributes[e].input&&this._attributes[e].input instanceof File},setTagsData:function(e){this.tagsData=e,this.dispatchEvent("onChange:tagsData")}},(f=y.extend(f)).implement(l),l.initFetchTrackingMixinForClass(f),f.shouldCreateOnLiveUpdate=function(e){var t=o.getObjectById(e["@parentId"]);return Boolean(t)},f.RDF_TYPE="rdf:type",f.ACTUAL_TYPE_ATTR="dsplan:actualType",f.getObjectById=o.getObjectById,f.mergeOrCreateObject=function(e){var t=o.getModelConstructor(e);t=t||f;var n=o.getExistingAndMerge(e);return(n=n||new t(e,{parse:!0,collectionConstructor:this.collectionConstructor}))&&n._updateInverseProperties(),n},Object.defineProperty(f.prototype,"tenant",{get:function(){return window.enoviaServer.tenant}}),Object.defineProperty(f,"fakeEmptyCollection",{get:function(){var e=[];return e.get=function(){},e.first=e.get,e.toArray=function(){return this},e}}),f.resetObjectMap=o.resetObjectMap,Object.defineProperty(f.prototype,"fedSearchIdQuery",{get:function(){if(this.id)return p.isWedoTask(this.get("dsxplan:jsType"))?'resourceid:"'+o.removeBracketLongURI(this.id)+'"':'uri:"'+o.shortToLongURI(this.id)+'"'}}),Object.defineProperty(f.prototype,"parentId",{get:function(){return this._parentId},set:function(e){if(this._parentId){var t=o.getObjectById(this._parentId);this.stopListening(t,"onModifyAccessChanged"),this.stopListening(t,"onDeleteAccessChanged")}this._parentId=e,o.getObjectById(e)&&this.listenTo(o.getObjectById(e),{onModifyAccessChanged:this.dispatchEvent.bind(this,"onModifyAccessChanged"),onDeleteAccessChanged:this.dispatchEvent.bind(this,"onDeleteAccessChanged")})}}),f.scheduleUpdateInverseProperties=function(e){f._inverseTimeout=f._inverseTimeout||setTimeout(()=>{f._inverseTimeout=void 0,Object.values(f._modelsToUpdateInverse).forEach(e=>{e._updateInverseProperties()}),f._modelsToUpdateInverse={}},0),f._modelsToUpdateInverse=f._modelsToUpdateInverse||{},f._modelsToUpdateInverse[e.cid]=e},f.MODIFY_ITEM_VERSION_URI="/invoke/dsxplan:modifyItemVersion",f.CREATE_ITEM_VERSION_URI="/invoke/dsxplan:createItemVersion",f.CLONE_ITEM_VERSION_URI="/invoke/dsxplan:cloneItemVersion",f.DELETE_ITEM_VERSION_URI="/invoke/dsxplan:deleteItemVersion",o.setDefaultModelConstructor(f),f}),define("DS/RDFFoundation/Models/XPPModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Models/NoAccessModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper"],function(e,t,n,i,o){"use strict";return t.extend({_uwaClassName:"XPPModel",sourceName:"3dplan",_propertyDictionary:{richTextDescription:{volatility:!0},_xplanSubscribed:{volatility:!0},"dsxplan:jsType":{volatility:!0}},getTransferObject:function(t){var n=e.clone(t||{},!1);return n.i3dx=o.i3dx(this),this._parent(n)},get:function(e){if(this._fieldBeingFetched=this._fieldBeingFetched||{},this._fieldFetched=this._fieldFetched||{},this.fetching&&this._fieldBeingFetched[e])return{fetching:!0};if("richTextDescription"===e){if(this._fieldFetched[e]&&this.get("dsplan:RichTextField")===this._fieldFetched[e].identifier)return this._fieldFetched[e].value;var t=this.get("dsplan:RichTextField");return!!t&&(this.fetching=!0,this._fieldBeingFetched[e]=!0,i.downloadFCSFile(t,{onComplete:n=>{this.fetchComplete(e,"richTextDescription",n,{identifier:t}),this.listenTo(this,"onChange:dsplan:RichTextField",function(){this.dispatchEvent("onChange:richTextDescription",[this]),this.set("richTextDescription",null)})},onFailure:()=>{this.fetching=!1,this.set(e,null),this._fieldFetched.richTextDescription={value:null,identifier:t},delete this._fieldBeingFetched[e],this.set("dsplan:RichTextField",null),this.dispatchEvent("onChange:richTextDescription",[null])}}),{fetching:!0})}if("_xplanSubscribed"===e){const t=this._parent.apply(this,arguments);return null==t&&(this.fetching=!0,this._fieldBeingFetched[e]=!0,setTimeout(()=>{i.request(i.expandUrl("invoke/dsplan:isUserSubscribingNotif"),{method:"POST",type:"json",data:JSON.stringify([this.get("@id")]),onComplete:t=>{this.fetchComplete(e,"_xplanSubscribed",t["@value"])}})},0)),t}return this._parent.apply(this,arguments)},fetchComplete:function(e,t,n,i){this.fetching=!1;var o={value:n};i&&i.identifier&&(o={value:n,identifier:i.identifier}),this._fieldFetched[t]=o,delete this._fieldBeingFetched[e],this.set(t,n),i&&i.onlyValue?this.dispatchEvent("onChange:"+t,[n]):this.dispatchEvent("onChange:"+t,[this])},toJSON:function(){return this.hasViewAccess()?this._parent.apply(this,arguments):(new n).toJSON()},getStartingFacet:function(){return"tasks"}})}),define("DS/RDFFoundation/Models/ComponentProxyIndexModel",["UWA/Core","UWA/Class/Model","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/Models/ObjectProxyUtil","DS/RDFFoundation/Models/ResultModel"],function(e,t,n,i,o){"use strict";var s=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url","ds6w:resourceUid","modified","ds6w:modified","ds6w:kind","linkURL","description"];const r=new Map;var a={};s.forEach(function(e){a[e]=!0});var l=t.extend({_uwaClassName:"ComponentProxyIndexModel",idAttribute:"resourceid",defaults:{},init:function(e,t){var n=Array.prototype.slice.call(arguments,0);if(e&&(e.results||e.attributes)&&(!t||!t.parse)){var i="";if(e.results){var o=e.results;if(1!==o.length)return this._parent.apply(this,n);i=o[0]}this.collection=t&&t.collection;var s=this.parse(i);n[0]=s}this._parent.apply(this,n),r.set(this.id,this)},sync:function(t,n,i){if("read"!==t)throw new Error("component proxy index model don't support writing");var o=e.clone(i||{},!1);return o.source=this.get("source"),l.requestFetch(n,o)},parse:function(e,t){var n={};if(e&&e.attributes)for(var i=e.attributes,o=i.length,s=t&&t.selectPredicates||a,r=0;r<o;r++){var l=i[r],c=l.name;"ds6w_facet"===l.format&&(c=c.substr(c.lastIndexOf("/")+1)),s[c]&&(n[c]=l.value)}return n},destroy:function(){r.delete(this.id),this._parent.apply(this,arguments)}});l.prototype.dataForRendering=function(){return this.toJSON()},l.toBeFetched={};var c={cancel:function(){this.fetching?(delete this._onComplete,delete this._onFailure):delete this.queue.toBeFetched[this.id]},onComplete:function(){this._onComplete&&this._onComplete.apply(this,arguments)},onFailure:function(){this._onFailure&&this._onFailure.apply(this,arguments)}};return l.TIMEOUT_LENGTH=97,l.idAttributeForFederatedSearch="[ds6w:resourceUid]",l.idAttributeForFederatedSearchResult="resourceid",l.select_predicate=s,l.fetchProxies=function(){delete this.fetchTimeout;var t={idAttributeForFederatedSearch:this.idAttributeForFederatedSearch,select_predicate:this.select_predicate,idAttributeForFederatedSearchResult:this.idAttributeForFederatedSearchResult||this.idAttributeForFederatedSearch},n=this.toBeFetched;this.toBeFetched={};var i=Object.keys(n),s=i.length;if(!s)return{cancel:function(){}};for(var r,a,c={},d={"3dspace":[],i3dx:[]},u=0;u<s;u++){var h,p=i[u],g=n[p];g.fetching=!0;var f=g.idAttributeForFederatedSearch||t.idAttributeForFederatedSearch;h=e.is(t.idAttributeForFederatedSearch,"function")?t.idAttributeForFederatedSearch(g.source):f,g.id.startsWith("i3dx:")?d.i3dx.push(p):"3dspace"===g.source?d["3dspace"].push(p):(this.optimizeSearchQuery?r='"'+p+'"':(r=h+':"'+p+'"',g.additionalQueryStatement&&(r="("+r+" AND "+g.additionalQueryStatement+")")),c[g.source]||(c[g.source]=[]),c[g.source].push(r))}var m=function(e,t){for(var i=Object.keys(n),s=i.length,r=0;r<s;r++){var l=i[r],c=n[l],d=c.source;"3dspace"===t||"3dspace"===d?"3dspace"===t&&"3dspace"===d&&c.onFailure&&c.onFailure(e):"drive"===d?o.sendRequest({drive:[l]},{onComplete:a,onFailure:function(e,t,i){var o=n[i[0]];o.onFailure.apply(o,arguments)}}):t===d&&c.onFailure&&c.onFailure(e)}};return a=function(e,i){var o,s=e.length,r=t.idAttributeForFederatedSearchResult.replace(/\[?([^\]]*)]?/,"$1");"i3dx"===i&&(r="ds6w:i3dx");for(var a=0;a<s;a++)for(var l=e[a],c=l.attributes,d=c.length,u=0;u<d;u++){var h=c[u];if(h.name===r){(o=n[h.value])&&o.onComplete(l),delete n[h.value];break}}m("object_not_found",i)},o.sendRequest(d,{onComplete:a,onFailure:m}),l.sendFederatedSearchRequest.apply(this,[c,a,m]),{}},l.sendFederatedSearchRequest=function(t,n,o){var s=Object.keys(t);if(s.length>0)for(var r=function(t,i){var s=(e.is(i,"string")?JSON.parse(i):i).results;s?n(s,t):o("object_not_found",t)},a=0;a<s.length;a++){var c=s[a],d=t[s[a]],u={query:d,nresults:d.length+10,sources:[c],select_predicate:this.select_predicate,searchQueryPrefix:this.optimizeSearchQuery?l.idAttributeForFederatedSearch:void 0,delimeter:this.optimizeSearchQuery&&"swym"===c?" BOR ":void 0,onComplete:r.bind(void 0,c),onFailure:o.bind(this,"object_not_found",c)};i.sendRequestWithDelimiter(u)}},l.requestFetch=function(t,n){var i=e.clone(n||{},!1),o=i.queue||this,s=o.toBeFetched[t.id];return s||((s=Object.create(c)).id=t.id,s.source=i.source||"3dspace",s._onComplete=i.onComplete,s._onFailure=i.onFailure,s.queue=o,s.additionalQueryStatement=i.additionalQueryStatement,s.idAttributeForFederatedSearch=i.idAttributeForFederatedSearch,o.toBeFetched[t.id]=s,o.fetchTimeout||(o.fetchTimeout=setTimeout(l.fetchProxies.bind(o),l.TIMEOUT_LENGTH)),s)},l.resetQueue=function(e){(e=e||this).toBeFetched={},clearTimeout(e.fetchTimeout),delete e.fetchTimeout,delete e.optimizeSearchQuery},l.getObjectById=function(e){return r.get(e)},l}),define("DS/RDFFoundation/Models/ComponentProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyIndexModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Models/NoAccessModel","DS/RDFFoundation/Models/DeletedModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ObjectProxyUtil"],function(e,t,n,i,o,s,r){"use strict";var a=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);return t[0]=this,this.dispatchEvent("onChange"+(e?":"+e:""),t)}},l=n.extend({_uwaClassName:"ComponentProxyModel",writeMask:"dsplan:MVMask.ComponentProxy.Complex",_propertyDictionary:{"dsxplan:hasContributingElements":{inverseProperty:"dsxplan:hasWorkContext",volatility:!0}},init:function(t,n){const i=e.clone(t||{},!1);if(!t["dscom:ServiceHosting"]){const e=t["@id"].match(/dscom:(.*?)_/);e&&e[1]&&(i["dscom:ServiceHosting"]=e[1])}this._parent(i,n)},setup:function(n,i){var o=e.clone(i||{},!1);o.mask="dsplan:MVMask.ComponentProxy.Complex";var s=this._getProxyModelId(this.id);this.indexModel=t.getObjectById(s)||new t({resourceid:s,tenant:this.get("dscom:Tenant"),source:this.sourceName,description:this.get("description")}),this.listenTo(this.indexModel,"onChange:ds6w:label",a("title")),this.listenTo(this.indexModel,"onChange:type_icon_url",a("image")),this.listenTo(this.indexModel,"onChange:ds6w:type",a("ds6w:type")),this.listenTo(this.indexModel,"onChange:modified",a("modified")),this.listenTo(this.indexModel,"onChange",a());var r=this;"3DLean"!==this.get("dscom:ServiceHosting")&&this.indexModel.fetch({onComplete:function(){if("3DSpace"===r.get("dscom:ServiceHosting")){let n=r.get("ds6w:label"),i=r.get("modified");if(!n&&!i){var t=e.clone(arguments[2]||{},!1).onFailure;t&&t("object_not_found")}}},onFailure:function(e,t){"object_not_found"===t&&(r.indexModel._noAccess=!0,r.dispatchEvent("onModelAccessChanged"))}}),this._parent(n,o)},canShowProperties:function(){return"3DLean"!==this.sourceName},hasViewAccess:function(){return Boolean(this.forceAccess||this.indexModel&&!this.indexModel._noAccess)&&!this.isDeleted()},isDeleted:function(){return Boolean(this.indexModel&&"DELETED"===this.indexModel.get("ds6w:type"))},getLaunchOptions:function(e){var t=this._parent.apply(this,arguments);return"swym:Community"===this.getDragType()?(t.appId="X3DMCTY_AP",t.community=this.get("physicalId"),t.communityType="community"):"Project Space"===this.getDragType()?(t.ids=this.get("physicalId"),t.appId="ENOPRPR_AP"):"3dportfolio"===this.serviceHosting&&(t.ids=s.removeBracketLongURI(this.get("physicalId")),t.appId="ENXPORT_AP"),t.x3dPlatformId=this.tenant,t},_getProxyModelId:function(e){if(this.get("dscom:ServiceHosting")){var t=("dscom:"+this.get("dscom:ServiceHosting")+"_").length;return decodeURI(e.substring(t))}return e.split("_")[1]},set:function(e,t){if("modified"===e)this.indexModel.set(e,t);else{if("title"!==e)return this._parent.apply(this,arguments);this.indexModel.set("ds6w:label",t)}},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"name":case"title":return this.indexModel.get("ds6w:label")||t;case"physicalId":return this.indexModel.id||this._getProxyModelId(this.id);case"image":return this.indexModel.get("preview_url")||this.indexModel.get("type_icon_url")||t;case"ds6w:type":case"type":return this.indexModel&&this.indexModel.get("ds6w:type")||t;case"kind":case"ds6w:kind":return this.indexModel.get("ds6w:kind")||t;case"hasfiles":return s.DOWNLOADABLE_TYPES.includes(this.get("type"));case"fileExtension":return this.indexModel.get("ds6w:docextension")}return t||(t=this.indexModel&&this.indexModel.get(e)),t},toJSON:function(e){var t=this._parent.apply(this,arguments);if(e&&e.dataForRendering){if(t.image=this.get("image"),t.type=this.get("type"),t.hasfiles=this.get("hasfiles"),t.fileExtension=this.get("fileExtension"),t.title=this.get("title"),this.isDeleted())t=(new o).toJSON();else if("No Access"===t.error||!this.hasViewAccess())t=(new i).toJSON();t.physicalId=this.get("physicalId")}else t["ds6w:type"]=this.get("ds6w:type");return t},syncCreate:function(e,t){t.noStringify=!0;var n=this._parent.apply(this,arguments),i="/invoke/dsxplan:createProxyModel",o=this.writeMask||this.getMask(),r=o?"?$mask="+o:"";t.url=s.expandUrl(i+r),t.data=JSON.stringify([t.attrs]),t.method="POST";var a=t.onComplete;return t.onComplete=function(e,t){var n=e;return n["@href"]===i&&(n=n["@value"]||n.value),a.call(this,n,t)},n},getParentPath:function(){return""},getIdForFederatedSearch:function(){return this.get("physicalId")},getTransferObject:function(t){let n=e.clone(t||{},!1);e.merge(n,{serviceId:this.serviceHosting,envId:this.tenant});try{var i,o=this.getDragType();if(o&&(i=e.clone(this.get("parentTypes")||[o],!1)),i&&0!==i.length)if("Document"===o){var s=i,r=this.indexModel.get("files");if(r&&1===r.length){var a=r[0].dataelements.title.match(/\.[^.]*$/);s.push(a[0])}n.objectTaxonomies=s}else"URL"===o?(n.linkURL=this.get("linkURL"),n.description=this.get("description")):0!==Object.keys(i).length&&(n.objectTaxonomies=i);var l=this.get("ds6w:kind");l&&o&&(n.objectTaxonomies=n.objectTaxonomies||[o],n.objectTaxonomies.push(l))}catch(e){console.log(e)}return this.isMBSE()&&(n.i3dx=this.indexModel.id),this._parent(n)},isMBSE:function(){return this.indexModel.id.startsWith("i3dx:MBSE!")},getObjectType:function(){return this.get("type")},getDragType:function(){return this.get("type")}});return Object.defineProperty(l.prototype,"tenant",{get:function(){return this.get("dscom:Tenant")}}),Object.defineProperty(l.prototype,"serviceHosting",{get:function(){return this.get("dscom:ServiceHosting")}}),Object.defineProperty(l.prototype,"sourceName",{get:function(){return"3DPlan"===s.sourceFromService(this.serviceHosting)?"3dplan":s.sourceFromService(this.serviceHosting)||""}}),Object.defineProperty(l.prototype,"fedSearchIdQuery",{get:function(){return'[ds6w:resourceUid]:"'+this.get("physicalId")+'"'}}),l.computeURI=function(e){let t=e.id||e.objectId;if(e.i3dx){"MBSE"!==r.split3dx(e.i3dx).domain||t.startsWith("cid")||(t=e.i3dx)}return"dscom:"+e.serviceId+"_"+encodeURI(t)},l.getNewProxyModel=function(e){var t="dscom:"+e.serviceId+"_",n=e.id||e.objectId;0!==n.indexOf(t)&&(n=l.computeURI(e));let i={title:e.title,image:e.image,"dscom:ServiceHosting":e.serviceId,"dscom:Tenant":e.envId?e.envId:e.tenant,type:e.type||e.objectType,"@type":"dscom:ComponentProxy"};"URL"===e.type&&(i.linkURL=e.linkURL,i.description=e.description,i.name=e.name);var o=s.getObjectForAdding(l,n,{attrs:i});return o.forcedNew=!0,o},l.getOrCreateProxy=function(e,t){let n=s.getObjectById(l.computeURI(e));return n||(n=l.getNewProxyModel(e),t&&n.save(void 0,{ajax:t.ajax})),n},l}),define("DS/RDFFoundation/Models/MemberModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Models/ComponentProxyIndexModel"],function(e,t,n,i,o,s,r){"use strict";var a=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url","resourceid","ds6w:resourceUid"],l=require.toUrl("DS/RDFFoundation/assets/img/defaultProfile.png"),c={};a.forEach(function(e){c[e]=!0});var d=t.extend({_uwaClassName:"MemberModel",parse:function(e){return e&&e.attributes?r.prototype.parse.call(this,e,{selectPredicates:c}):this._parent.apply(this,arguments)},setup:function(){return this.fetch(),this._parent.apply(this,arguments)},memberSync:function(t,n,i){var o=this;if("read"===t){var s=e.clone(i||{},!1);s.queue=d;var a=this.getIdForFederatedSearch(),l=i.onComplete;return s.onComplete=function(){var e=arguments[0];o._processTaggerDataAndStoreOnModel(n,arguments),o.completing=!1,l&&l.apply(this,arguments),o.dispatchEvent("onFetchDone",arguments),"foaf:Group"===o.getObjectType()&&(o.setLabel(e.attributes&&e.attributes.find(e=>"ds6w:label"===e.name).value),o.setViewAccess(Boolean(o.get("ds6w:label"))),o.dispatchEvent("onChange",[o]),o.dispatchEvent("onAccessSetOfGroup",[o]))},s.onFailure=function(){var t=i.onFailure,n=e.clone(s||{},!1);n.onFailure=function(){o.completing=!1,t&&t.apply(this,arguments),o.dispatchEvent("onFetchDone"),"foaf:Group"===o.getObjectType()&&(o.setViewAccess(Boolean(o.get("ds6w:label"))),o.dispatchEvent("onChange",[o]),o.dispatchEvent("onAccessSetOfGroup",[o]))},"foaf:Group"!==o.getObjectType()?o.getPersonFromRDF(n):o.fetchUserGroupName(n)},s.source=this.source,s.additionalQueryStatement=a?void 0:this.additionalQueryStatement,s.idAttributeForFederatedSearch=this.idAttributeForFederatedSearch,d.optimizeSearchQuery=!0,d.toBeFetched[a]||(this.completing=!0),r.requestFetch({id:a},s)}},_processTaggerDataAndStoreOnModel:function(e,t){var n=t&&t[0].attributes;if(n){var i=e.collection.getModelAndProcessedTaggerDataAttributes(n);e.setTagsData(i.tags),e.set("explicitTagsData",i.explicitTagsData)}},get:function(e){var t=this.id&&n.splitUri(this.id)[1];switch(e){case"name":return this.getFullName();case"image":return this.get("preview_url")||this.get("type_icon_url")||o.userPictureURL(t,"normal")||l;case"miniImage":return"foaf:Group"===this.get("ds6w:type")&&this.get("ds6w:label")?this.get("preview_url"):this.get("ds6w:label")||"foaf:Group"!==this.get("dsxplan:jsType")?o.userPictureURL(t,"mini")||l:require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png");case"physicalId":return this._getPhysicalId();case"resourceUid":return this._getResourceUid();case"type":return this.get("ds6w:type");case"accountName":return this.get("dsaccess:accountName")}return this._parent.apply(this,arguments)},getFullName:function(){var e=this.get("resourceid");if(e&&e.startsWith("mailto:"))return n.splitUri(e)[1];var t=this.get("dsaccess:state");if(!e&&t&&"pending"===t)return this.get("dsaccess:mbox");var i=this.get("ds6w:label");if(!i){var o=this.getFirstName(),s=this.getLastName();i=o&&s&&o+" "+s}return i},getFirstName:function(){var e=this.get("foaf:givenName");return e&&e[0]},getLastName:function(){var e=this.get("foaf:familyName");return e&&e[0]},_getPhysicalId:function(){return n.jsonURIToSparqlURI(this.id)},_getResourceUid:function(){return n.jsonURIToSparqlURI(this.id)},toJSON:function(e){var t=e||{},n=this._parent.apply(this,arguments);return n.isRDF=!0,n.physicalId=this.get("physicalId"),n.resourceUid=this.get("resourceUid"),n.name=this.get("name"),n.image=this.get("image"),"dskern:Person.Guest"===this.id||"foaf:xPlanInfra"===this.id||"dskern:Person.Creator"===this.id?(n.firstname=this.id.split(":")[1],n.fullName=n.firstname):n.fullName=this.get("name")||n.name||n["ds6w:label"],n.title=n.fullName,t.dataForRendering&&(n.type="pno:Person"),n},getPersonFromRDF:function(e){var t=["resources/",n.removeBracketLongURI(this.id),"?$mask=dsplan:MVMask.Person.Complex"].join(""),i=n.expandUrl(t,"v1");n.request(i,{method:"GET",type:"json",onComplete:e.onComplete,onFailure:e.onFailure})},getDragType:function(){return this.getObjectType()},getTransferObject:function(){return this._parent({objectId:this.get("physicalId"),resourceUid:this.get("resourceUid"),displayName:this.fullName,serviceId:this.serviceHosting})},hasViewAccess:function(){return!0}});return Object.defineProperty(d.prototype,"fullName",{get:function(){return this.get("name")}}),Object.defineProperty(d.prototype,"serviceHosting",{get:function(){return this.serviceId}}),Object.defineProperty(d.prototype,"physicalId",{get:function(){return this.get("physicalId")}}),Object.defineProperty(d.prototype,"fedSearchIdQuery",{get:function(){return this.idAttributeForFederatedSearch+':"'+this.getIdForFederatedSearch()+'"'}}),d.toBeFetched={},d.idAttributeForFederatedSearch=i.idAttributeForFederatedSearch,d.select_predicate=a,d}),define("DS/RDFFoundation/Models/PersonRDFModel",["UWA/Core","UWA/Class/Events","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/Models/MemberModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils"],function(e,t,n,i,o,s){"use strict";var r=i.extend({_uwaClassName:"PersonRDFModel",additionalQueryStatement:'[ds6w:type]:"pno:Person"',source:"swym",sourceName:"swym",serviceId:"3DSwym",idAttributeForFederatedSearch:"[ds6w:resourceUid]",getIdForFederatedSearch:function(){return s.removeUUIDFromURI(this.id)},getObjectType:function(){return"pno:Person"},sync:function(){return this.memberSync.apply(this,arguments)},_getPhysicalId:function(){var e=this.get("resourceid");if(e&&e.startsWith("mailto:"))return e;var t=this.get("dsaccess:state");return!e&&t&&"pending"===t?this.get("dsaccess:mbox"):s.addIamToURI(this.get("accountName"))},_getResourceUid:function(){return s.removeUUIDFromURI(this.id)}});return r.Events={CurrentUserModelCreated:"CurrentUserModelCreated"},r.Dispatcher=new t,r.loadAndCreateModelForCurrentUser=function(){function e(e){var t=o.getObjectForAdding(r,e,{attrs:{"dsaccess:accountName":n.getContextUser()}});t.addEvent("onSync",function(){r.Dispatcher.dispatchEvent(r.Events.CurrentUserModelCreated,t)})}s.setContextUserUid({onComplete:e,onFailure:e})},r}),define("DS/RDFFoundation/Models/UsersGroupRDFModel",["UWA/Core","DS/RDFFoundation/Models/MemberModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,o,s){"use strict";return t.extend({_uwaClassName:"UsersGroupRDFModel",additionalQueryStatement:'[ds6w:type]:"foaf:Group"',source:"usersgroup",serviceId:"usersgroup",idAttributeForFederatedSearch:"uri",getIdForFederatedSearch:function(){return n.jsonURIToSparqlURI(this.id)},setup:function(){return this.setViewAccess(Boolean(this.get("ds6w:label"))),this._parent.apply(this,arguments)},setViewAccess:function(e){this._hasViewAccess=e},getObjectType:function(){return"foaf:Group"},setLabel:function(e){e&&this.set("ds6w:label",e)},hasViewAccess:function(){return this._hasViewAccess},sync:function(){return this.memberSync.apply(this,arguments)},get:function(e){switch(e){case"name":if(!this.hasViewAccess())return s.get("E6WCommonUI.Label.PrivateGroup");break;case"image":if(!this.hasViewAccess())return require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png")}return this._parent.apply(this,arguments)},fetchUserGroupName:function(e){let t=o.getServiceUrl("usersgroup",!0)+"/3drdfindex/v1/resources/"+n.removeBracketLongURI(this.id)+"?$mask=dsaccess:Mask.Group.Name";n.request(t,{method:"GET",type:"json",onComplete:e.onComplete,onFailure:e.onFailure})},includesCurrentUser:function(e){var t,s=JSON.stringify({taskId:e.id,personId:i.addUUIDToURI(o.getContextUserUid())});n.request(n.expandUrl("/invoke/dsxplan:isUserCandidate","v1"),{method:"POST",type:"json",data:s,headers:{"Content-Type":"application/json"},onComplete:function(n){n["@value"]&&(t=!0),e._membersChecked=!0,e._isUserACandidateAssignee=t,e.dispatchEvent("onUserGroupMembersFetched")},onFailure:function(e){console.log("err",e)}})},canShowProperties:function(){return!1},compactJson:function(){var e={};return e[this.idAttribute]=this.id,e.type="group",e}})}),define("DS/RDFFoundation/Models/URLModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/RDFUtils"],function(e,t,n,i){"use strict";return t.extend({_uwaClassName:"URLModel",writeMask:"dsplan:MVMask.URL.Complex",_propertyDictionary:{canEdit:{volatility:!0}},isDSLC:function(){return!0},init:function(t,n){const i=e.clone(t||{},!1),o=e.clone(n||{},!1);i["dsplan:jsType"]=i["dsplan:jsType"]||i["dsxplan:jsType"]||"dsplan:url",o.mask=this.getPropertyMask(),this._parent(i,o)},setup:function(t,n){var i=e.clone(n||{},!1);i.mask=this.getPropertyMask(),this._parent(t,i)},hasViewAccess:function(){return!0},set:function(){return this._parent.apply(this,arguments)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"canEdit":return!0;case"ds6w:type":case"type":return"dsplan:url";case"description":return this.get("dsplan:comment");case"linkURL":return this.get("dsplan:linkURL");case"icon":case"image":return require.toUrl("DS/E6WCommonApps/assets/img/I_CommonIcon_Link_22.png")}return t},fetchForProperty:function(t){let n=e.clone(t||{},!1);n.mask=this.getPropertyMask&&this.getPropertyMask(),n.onlyIfNeeded=!0,this.fetch(n)},save:function(){var e=n.setHelper.apply(this,arguments),t=e.attrs||{},i=e.options;return this._parent(t,i)},toJSON:function(e){var t=this._parent.apply(this,arguments);return e&&e.dataForRendering?(t.image=this.get("image"),t.type=this.get("type"),t.title=this.get("title"),t.linkURL=this.get("linkURL"),t.physicalId=this.get("physicalId")):t["ds6w:type"]=this.get("ds6w:type"),t},syncCreate:function(e,t){t.noStringify=!0;var n=this._parent.apply(this,arguments),o="/invoke/dsxplan:createURLObject",s=this.writeMask||this.getMask(),r=s?"?$mask="+s:"";t.url=i.expandUrl(o+r),t.data=JSON.stringify([t.attrs]),t.method="POST";var a=t.onComplete;return t.onComplete=function(e,t){var n=e;return n["@href"]===o&&(n=n["@value"]||n.value),a&&a.call(this,n,t)},n},syncPatch:function(e,t){t.noStringify=!0;var n=t.onComplete,o="/invoke/dsxplan:modifyURLObject";return i.request(i.expandUrl(o),{method:"POST",noStringify:!0,type:"json",data:JSON.stringify([e]),onComplete:function(e,t){var i=e;return i["@href"]===o&&(i=i["@value"]||i.value),n&&n.call(this,i,t)}})},getParentPath:function(){return""},getIdForFederatedSearch:function(){return this.get("physicalId")},getTransferObject:function(t){let n=e.clone(t||{},!1);return e.merge(n,{serviceId:this.serviceHosting,envId:this.tenant}),n.linkURL=this.get("dsplan:linkURL"),this._parent(n)},getPropertyMask:function(){return"dsplan:MVMask.URL.Complex"},getObjectType:function(){return this.get("type")},getDragType:function(){return this.get("type")}})}),define("DS/RDFFoundation/Models/CategoryModel",["UWA/Core","UWA/Utils","UWA/Class/Model","DS/RDFFoundation/RDFUtils"],function(e,t,n,i){"use strict";var o={_uwaClassName:"CategoryModel",defaults:{title:"",subtitle:""},_image:function(){var e;return(e=this.get("thumbnail"))&&(e=i.getAssetUrl(e)),e},"onChange:thumbnail":function(){this.set("image",this._image())},parse:function(e){var t,n=(t=i.parseUrl(e["@href"])).path.match(/(?:\/resources\/|\/classes\/|\/invoke\/)(.*)/);if(e["@id"]=n&&n[1]||e["@id"],!e.mask){var o=e["@mask"]||t.mask;o&&(e.mask=o)}return e.where=t.where&&t.where,e},isAgile:()=>!1,isXProject:()=>!1};return n.extend(o)}),define("DS/RDFFoundation/Models/DriveRepositoryProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/PlatformManager"],function(e,t,n,i){"use strict";var o=t.extend({_uwaClassName:"DriveRepositoryProxyModel",init:function(e){return e&&e["@id"]&&(e["dscom:ServiceHosting"]="3DDrive",e["dscom:Tenant"]=i.getTenant(),e["@type"]="dscom:ComponentProxy"),this._parent.apply(this,arguments)},get:function(e){if("_isDriveRepositoryModel"===e)return!0;return this._parent.apply(this,arguments)}});return o.ID_PREFIX="dscom:3DDrive_",o}),define("DS/RDFFoundation/Models/RDFCloneModel",["UWA/Core","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/E6WCommonUIConstants","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/Models/URLModel","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonUI/Models/DropValidator","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/Models/UsersGroupRDFModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,o,s,r,a,l,c,d,u,h,p,g){"use strict";var f=t.extend({getObjectToBeAdded:function(t,o,d){var u;if(!d.dropObj&&!d.detailedObject){var g=s.getObjectById(o);return g||"dsplan:hasAssignee"!==t?g:s.getObjectForAdding(c,o,{mask:h.getPersonMask(),attrs:{"dsaccess:accountName":h.addIamToURI(i.getContextUser())}})}u=r.getObjectDataFromDropSearchOrTypeAhead(d);var f,m,y,v=s.getExistingAndMerge({"@id":s.getObjectIDFromUserMap(u.id),image:u.image},{dontRegisterChange:!0}),C="swym:WeDo"===u.type,F="dsplan:url"===u.type;if(v)return v;if(F)y=e.clone(u||{},!1),e.extend(y,{"@type":u.type?u.type:n.URL_TYPE}),f=l,m="MVMask.URL.Complex";else if("3dplan"===u.serviceId||C)y=e.clone(u||{},!1),e.extend(y,{"@type":u.type?u.type:n.LOGICAL_USER_TYPE}),f=s.getModelConstructor(y),m="dsplan:MVMask.Task.Basic";else{var _="pno:Person"===u.type,D="foaf:Group"===u.type;if(!_&&!D)return u.id=a.computeURI(u),a.getNewProxyModel(u);var S=u.id;if(!S.startsWith("uuid:")){var b={id:S,callback:this.swymPersonCallback.bind(this),onFailure:this.swymPersonCallbackFailure.bind(this),fieldName:t};return e.extend(d,{searchOptions:b}),this._swymPersonFetchCount++,void h.findAndGetSwymPersonResourceUid(d)}if(_)f=c;else{if(!D)throw new Error("Object type is not supported");f=p}m=h.getPersonMask(),y={"dsaccess:accountName":u.accountName}}return s.getObjectForAdding(f,u.id,{mask:m,attrs:y})},swymPersonCallback:function(e,t){if(e){var n,i=h.addUUIDToURI(e,t),o=t.searchOptions,r=o&&o.fieldName,a=o&&o.id;this.localAttributes.hasOwnProperty(r)&&delete this.localAttributes[r];let l=t.dropObj&&("foaf:Group"===t.dropObj.objectType||"Group"===t.dropObj.objectType),d=t.detailedObject&&("foaf:Group"===t.detailedObject["ds6w:type"]||"Group"===t.detailedObject["ds6w:type"]),u={"dsaccess:accountName":h.getAccountNameForUser(a,i)},g=c;(l||d)&&(g=p,u["ds6w:label"]=h.getLabelForUserGroup(t));let f=t.singleObjectOnly||t.config&&t.config.singleObjectOnly,m=s.getObjectForAdding(g,i,{mask:h.getPersonMask(),attrs:u});n=f?this.replaceObjectOnAttributeWithSingleModel(r,m,t):this.addIndividualObjectAsModel(r,m,t),!h.userMap[a]&&h.addUserUIdToMap(a,i),this.dispatchEvent("onChange:modificationsPending",[this]),t.operation="add",t.added=[n.ret],this._fireRelationshipChangeEvents(r,t)}this._swymPersonFetchCount--},swymPersonCallbackFailure:function(){this._swymPersonFetchCount--},buildBatchWithPreprocessedObjects:function(e){var t=e&&e.batch,n=e&&e.attributesToBeUpdated||{},i=Object.keys(n);if(i.length){var o=this._options.onFailure;t=t||s.getBatchGenerator();for(var r=0;r<i.length;r++)for(var l=i[r],c=0;c<n[l].length;c++){var d=n[l][c];d instanceof a!=!1&&(delete d.collection,d.save(void 0,{ajax:t.ajax,newTransaction:!0,onFailure:o}))}}return t},save:function(t){if(!this.model.hasFetchedAccessData||!this.model.hasFetchedAccessData()||this.model.canModify(!0)||this.model.get(n.CANDIDATE_ASSIGNEE_ATTR))if(this._swymPersonFetchCount)this.listenToOnce(this,"allSwymPersonsFetched",this.save.bind(this,t));else{var i=this._filterProxyObjectsFromLocalAttributesAndLocalRelatedData(),o=e.clone(t||{},!1);o.attributesToBeUpdated=i.proxyAttributes;var s=this.buildBatchWithPreprocessedObjects(o);s?(o.changed=!0,o.ajax=s.ajax,o.newTransaction=!0,delete o.attributesToBeUpdated,this._parent(o),delete o.ajax,delete o.onComplete,s.sendBatch(o)):(o&&(o.attributesToBeUpdated=o.attributesToBeUpdated||{}),this._parent(o))}else r.displayError(g.get("E6WCommonUI.Error.noAccessOnObject"))},_modelSave:function(e){this._shouldWaitForSave()?this.model.set(e):this._parent.apply(this,arguments)},_shouldWaitForSave:function(){return this.model&&this.model.isUploadingFiles&&this.model.isUploadingFiles()},_validateDroppedObject:function(e,t){var n=d.validateDroppedObject(e,t);return n&&r.displayError(n),n},_filterProxyObjectsFromLocalAttributesAndLocalRelatedData:function(){var e=Object.keys(this.localRelatedData),t={},n={},i=this;return e.forEach(function(e){for(var o=i.localRelatedData[e],s=0;s<o.length>0;s++){var r,l=o[s].value;l instanceof a?"add"===o[s].operation&&((r=t[e]||[]).push(l),t[e]=r):((r=n[e]||[]).push(o[s]),n[e]=r)}}),(e=Object.keys(this.localAttributes)).forEach(function(e){var n=i.localAttributes[e];n instanceof a&&(t[e]=[n])}),{proxyAttributes:t,nonProxyAttributes:n}},getDetailedObjectToBeAdded:function(t,n,i){if(i&&i.isObject){var o=e.clone(i||{},!1);return o.detailedObject=o.detailedObjects&&o.detailedObjects[0],this.getObjectToBeAdded(t,n,o)}return n},set:function(e,t,n){return t&&void 0!==t.actualValue&&(t=t.actualValue),t=this.getDetailedObjectToBeAdded(e,t,n),this._parent(e,t,n)},add:function(t,i,o){var a;if(t===n.ATTACHMENT_ATTR||t===n.ACTUAL_DELIVERABLE_ATTR){var l=this.get(n.BOOKMARK_FOR_FILE_REPOSITORY);if(l&&!l.hasViewAccess())return r.displayError(g.get("E6WCommonUI.Error.noAccessOnBookmark")),a}if("dsplan:hasAttachment"!==t||s.removeBracketLongURI(i)!==s.removeBracketLongURI(this.model.id)){var c=e.clone(o||{},!1),d=c.singleObjectOnly||c.config&&c.config.singleObjectOnly;return a=this.get(t)instanceof e.Class.Model||d?this.replaceObjectOnAttributeWithSingleModel.apply(this,arguments):this._parent.apply(this,arguments)}r.displayError(g.get("E6WCommonUI.Error.CannotAddSameObject"))},remove:function(t,n,i){var o=e.clone(i||{},!1),s=o.singleObjectOnly||o.config&&o.config.singleObjectOnly,r=this.get(t);return this.model.get(t)&&(r instanceof e.Class.Model||s)&&delete this.localAttributes[t],(r=this.get(t))&&this._parent.apply(this,arguments)},replaceObjectOnAttributeWithSingleModel:function(n,i,o){var s=e.clone(o||{},!1);s.isObject=!(i instanceof e.Class.Model||i instanceof FileList||i instanceof File);var r=s.isCollectionAttribute,a=e.is(i,"string")?void 0:[i];if(this.get(n))this.remove(n,0,o),r||delete this.localRelatedData[n];else if(!r){var l=this.localRelatedData[n];l&&1===l.length&&"remove"===l[0].operation&&delete this.localRelatedData[n]}return r?t.prototype.add.call(this,n,i,s):this.set(n,i,s),a},preprocessPersonObject:function(e){if("pno:Person"===e.objectType){var t=e.objectId;t.startsWith("iam:")||(e.objectId=h.addUUIDToURI(t))}}});f._modelShouldWaitForSave=function(e){return e.isUploadingFiles&&e.isUploadingFiles()};var m=0;return Object.defineProperty(f.prototype,"_swymPersonFetchCount",{get:function(){return m},set:function(e){0===(m=e)&&this.dispatchEvent("allSwymPersonsFetched")}}),f}),define("DS/RDFFoundation/Collections/CollectionTaggerHelper",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/MemberUtils","DS/TagNavigatorProxy/TagNavigatorProxy","DS/E6WCommonUI/TopBarSearchDispatcher","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,o,s,r,a){"use strict";var l={_proxyCount:0,requestFetchNewTags:function(t){const n=e.clone(t||{},!1);if(0!==this.length){for(var i,o=n.searchSource||[],s=[],r=0;r<this.length;r++){var a=this.at(r);if(!(n.onlyIfNeeded&&a.tagsData&&a.tagsData.length>1)){var l=a.get("source");l&&!o.includes(l)&&o.push(l),(i=a.fedSearchIdQuery)&&s.push(i)}}this._sendFederatedTaggerRequest(s,o,n)}},_sendFederatedTaggerRequest:function(e,t,i){var o=this;e.length>0&&n.sendRequestWithDelimiter({sources:t,with_synthesis_attribute:!0,locale:window.widget.lang||"en",query:e,onComplete:function(e){var t=e?e.results:[];t?(o.convertTagDataToTnProxyFormat(t),i.onComplete&&i.onComplete()):i.onFailure&&i.onFailure()},onFailure:function(){i.onFailure&&i.onFailure()},queueRequest:!0})},convertTagDataToTnProxyFormat:function(e){if(e&&e.length>0)for(var t=e.length,n=0;n<t;n++){var i=this.getModelAndProcessedTaggerDataAttributes(e[n].attributes),o=i.id,s=i.tags,r=this.getModelsAsArrayToHandleTagger(o);r&&0!==r.length&&r.forEach(function(e){e.setTagsData(s),e.set("explicitTagsData",i.explicitTagsData)})}},getModelsAsArrayToHandleTagger:function(e){var t=this.get(e);return t?[t]:this.getModelsAsArrayToHandleTaggerFallback&&this.getModelsAsArrayToHandleTaggerFallback(e)},getModelsAsArrayToHandleTaggerFallback:function(e){for(var n=[],i=0;i<this.length;i++){var o=this.at(i),s=o.get("physicalId");e.includes&&e.includes(s)?n.push(o):t.removeBracketLongURI(s)===e&&n.push(o)}return n},getModelAndProcessedTaggerDataAttributes:function(e){var n,i=[],o={},s={},r=e.length;for(let d=0;d<r;d++){let r=e[d];var c=r.value;if(c)if(o=l.getExplicitTagsDataHelper(r,o),"ds6w_facet"===r.format){"date"===r.type?c=this.getFormatedTagDate(c):"double"===r.type&&(c=parseFloat(c).toString()),["ds6w:what/ds6w:status","ds6w:what/ds6w:type"].indexOf(r.name)>-1&&(s[r.name]=r.value,this.translate&&(c=this.translate(c)));let e={object:c,sixw:r.name,field:r.field,type:r.type},t="E6WCommonUI.Tag."+c,n=a.get(t);n!==t&&(e.dispValue=n),i.push(e)}else"resourceid"===r.name?n=t.removeBracketLongURI(c):["preview_url","ds6w:label","dsplan:projectType"].indexOf(r.name)>-1&&(s[r.name]=r.value)}return{id:n,tags:i,explicitTagsData:o,attributesForModelCreation:s}},fetchModelAndAddTaggerData:function(n,i){var o=e.clone(i||{},!1),s=n.results,r=[];if(s&&s.length>0){var a=s.length;o.dontUpdateTaggerSummaryData||(this.tagsSummaryData=this.translateSummaryData?this.translateSummaryData(n.facets):n.facets);for(var l=[],c=0;c<a;c++){var d,u=this.getModelAndProcessedTaggerDataAttributes(s[c].attributes),h=u.id,p=u.tags,g=u.attributesForModelCreation,f=t.getObjectById(h),m=g["dsplan:projectType"],y=g["ds6w:what/ds6w:type"],v=f&&f.get("dsxplan:jsType")!==y,C=f&&!f.get("title"),F=v||C;if(!f||F){switch(g["ds6w:what/ds6w:status"]){case"To Do":d="Open";break;case"In Work":d="InProgress";break;case"Completed":d="Done";break;default:d=g["ds6w:what/ds6w:status"]}var _={"dsxplan:jsType":this.getJSType(y),"dsxplan:label":g["ds6w:label"],"dsplan:hasThumbnail":g.preview_url,"dsxplan:hasMaturity":{"@id":"dsxplan:"+d}};m&&(_["dsplan:projectType"]=m),F?f.set(f.parse(_),{dontRegisterChange:!0}):(_["@id"]=h,f=new o.ModelConstructor(_,{parse:!0}))}r.push(h),l.push(f),f.setTagsData(p)}o.reset?this.reset(l):this.add(l)}},getJSType:function(e){return"dsplan:xProject"===e&&(e="dsplan:Project"),e},getFormatedTagDate:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),s=i<10?"0"+i:i,r=o<10?"0"+o:o;return String(n)+"/"+s+"/"+r},refineParametersAndQuery:function(t){var n=this,i=e.clone(t||{},!1);if(i.refineParam){const t=e.clone(i.refineParam,!0);Object.keys(t).forEach(function(e){if("date"===t[e][0].type){var o=t[e][0].object,s=n.getFromAndToDateFromDateTagFilter(o),r=e.split("/"),a=r[r.length-1];i.query="("+i.query+")",s.from&&(s.from.setHours(0),i.query="["+a+']>="'+s.from.toISOString()+'" AND '+i.query),s.to&&(i.query="["+a+']<="'+s.to.toISOString()+'" AND '+i.query),delete t[e]}}),i.refineParam=t}return i},getFromAndToDateFromDateTagFilter:function(e){var t,n;return e.to||e.from?(e.from&&(t=new Date(e.from)),e.to&&(n=new Date(e.to)).setHours(24)):(n=this.parseEndDate(e),7===e.length?(e+="/01",t=new Date(e)):t=new Date(e,0,1)),{from:t,to:n}},parseEndDate:function(e){var t,n;return e.length>7?((t=new Date(e)).setHours(24),t):(7===e.length?(e+="/01",n=new Date(e)):n=new Date(e,0,1),t=4===e.length?new Date(n.getFullYear()+1,0,1):new Date(n.getFullYear(),n.getMonth()+1,1))},federatedSearchAdvanceQueryRequest:function(t){var i=this,o=e.clone(t||{},!1);o=i.refineParametersAndQuery(o),n.sendRequest({label:"3dplan-"+o.labelPrefix+window.enoviaServer.user+"-"+Date.now(),select_predicate:o.selectPredicateArray,sources:["3dplan"],with_synthesis:!0,with_synthesis_attribute:!0,query:o.query,nresults:o.limit,refine:o.refineParam,order_field:"ds6w:modified",order_by:"desc",iDoNotThrowError:!0,onComplete:function(e){o.onComplete&&o.onComplete(e),i.dispatchEvent("onSync")},onFailure:function(){o.onFailure&&o.onFailure()}})},getTaggerData:function(e){var t={};return(e&&e.isTopBarSearch||s.getSearchString()?this:this.originalCollection||this).forEach(function(e){if(e.id){var n=e.getTaggerURI();t[n]=e.tagsData||[]}}),t},getFilterOnServerTaggerData:function(e){var n={tagsData:{},summaryData:[]};if(e){var i=this.get(t.removeBracketLongURI(e));i?n.tagsData[t.TAGGER_URI_PREFIX+encodeURIComponent(t.shortToLongURI(i.id))]=i.tagsData||[]:n.tagsData={}}else this.forEach(function(e){n.tagsData[t.TAGGER_URI_PREFIX+encodeURIComponent(t.shortToLongURI(e.id))]=e.tagsData||[]});return n.summaryData=this.tagsSummaryData||[],n},getTNProxy:function(t){var n=e.clone(t||{},!1),i=this.tnProxy;if(i)return i;var s={widgetId:widget.id?widget.id:window.enoviaServer.widgetId,filteringMode:n.filterOnServer?o.filteringMode.FilteringOnServer:o.filteringMode.WithFilteringServices,tenant:r.getTenant(),events:n.events,colorize:!0};return i=o.createProxy(s),n.filterOnServer&&i&&i.configurePredicates({"ds6w:modified":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:created":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:plannedStart":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:plannedEnd":{allowFreeInput:!0,freeInputOnly:!0}}),this.tnProxy=i,i},setTNProxy:function(e){this.tnProxy=e},cacheCollection:function(){this.originalCollection=this.clone()},_resetCollectionOnObjectSelction:function(e,t){var n=this._getModelIdsToKeep(e,t),i=this._getModelsBasedOnIds(n);this._resetCollection(i)},filterCollection:function(t,n){var i=e.clone(n||{},!1),o=t.searchInput||s.getSearchString();return o||this._isTaggerFilteringOn(t)?(this.originalCollection||i.noCache||(this.allFetchesUseComplete()?this.cacheCollection():this.listenToOnce(this,"onSync",()=>{this.allFetchesUseComplete()&&(this.cacheCollection(),this._resetCollectionOnObjectSelction(t,o))})),this._resetCollectionOnObjectSelction(t,o),!0):(this.originalCollection&&(this._resetCollection(this.originalCollection._models),delete this.originalCollection),!1)},_getModelIdsToKeep:function(e,t){var n=e.filteredSubjectList||[];return t&&!this._isTaggerFilteringOn(e)&&(n=[],this.originalCollection.toArray().forEach(e=>{n.push(e.id)}),this._resetCollection(this.originalCollection._models)),n},_getModelsBasedOnIds:function(e){let n=s.getSearchString();n&&(n=i.escapeRegExp(n));var o=new RegExp(n,"i"),r=[];return e.forEach(e=>{var i=(this.originalCollection||this).getModelsAsArrayToHandleTagger(t.getURIForFiltering(e));i&&i.length>0&&(n?o.test(i[0].get("title"))?r=r.concat(i):o.test(i[0].get("dsxplan:enterpriseIdentificationNumber"))&&(r=r.concat(i)):r=r.concat(i))}),r},_isTaggerFilteringOn:function(e){var t=this.getTNProxy().getCurrentFilter();return e.allfilters&&Object.keys(e.allfilters).length||t.allfilters&&Object.keys(t.allfilters).length},_resetCollection:function(e){this.reset(e,{dontCallTagger:!0,dontRegisterChange:!0})},handleFocusOnSubjects:function(e){if(e){var n={},i=e.get("physicalId")||e.id;if(!i)return;var o=e.serviceId||"3DSpace";if(e.isRDF&&"3dspace"!==e.get("source")){i=t.jsonURIToSparqlURI(i);var s=e.get("dsxplan:jsType");(s&&"swym:WeDo"===s||"swym"!==e.get("source"))&&(i=encodeURIComponent(i)),o="6WTags"}e.getTagPrefix&&(i=e.getTagPrefix()+i),n[i]=o;try{this.getTNProxy().focusOnSubjects([i],!0,n)}catch(e){console.log(e.message),console.log(e)}}else try{this.getTNProxy().unfocus()}catch(e){console.log(e.message),console.log(e)}},handleTagColoring:function(e,n){var i=n&&n.coloredSubjects;if(e.coloredObjects||(e.coloredObjects=[]),Object.values(e.coloredObjects).forEach(function(e){delete e.tagColor,e.dispatchEvent("onChangeTaggerColoring")}),e.coloredObjects=[],i)for(var o in i){var s=o.startsWith("pid://")?o.substring("pid://".length):o,r=e.getModelsAsArrayToHandleTagger(t.getURIForFiltering(s));r&&r.length>0&&r.forEach(t=>{e.coloredObjects.push(t),t.tagColor=i[o],t.dispatchEvent("onChangeTaggerColoring")})}},addTaggerProxyColoringEvents:function(e,t){var n=function(e){l.handleTagColoring(t,e)};e.addEvent("colorize",n),e.addEvent("unColorize",n)},getExplicitTagsData:function(e){var t={};return e.forEach(e=>{t=l.getExplicitTagsDataHelper(e,t)}),t},getExplicitTagsDataHelper:function(e,t){if(void 0!==e.field&&"implicit"!==e.field){var n=e.dispValue||e.object||e.value,i=(e.sixw||e.name).substring("ds6w:".length);t[i]||(t[i]=[]),t[i].push(n)}return t},setExplicitTagsData:function(t,n){var i=n.sixw.substring("ds6w:".length),o=e.clone(t.get("explicitTagsData")||{},"false");o[i]||(o[i]=[]),o[i].push(n.object),t.set("explicitTagsData",o)},removeExplicitTagsData:function(t,n){var i=n.sixw.substring("ds6w:".length),o=e.clone(t.get("explicitTagsData")||{},"false"),s=o[i].indexOf(n.object);o[i].splice(s,1),t.set("explicitTagsData",o)},updateTagsData:function(e,t,n){var i=!0;e.tagsData||e.setTagsData([]);for(var o=0;o<e.tagsData.length;o++){var s=e.tagsData[o];if(s.sixw===t){s.object=n,i=!1;break}}i&&e.tagsData.push({field:"implicit",object:n,sixw:t,type:"string"})},getTaggerDataWithSearchFilter:function(e){var t={},n=s.getSearchString()||e.getSearch(),i=new RegExp(n,"i");return(e=n?e:e.originalCollection||e).forEach(function(e){if(e.id){var o=e.getTaggerURI();n?i.test(e.get("title"))?t[o]=e.tagsData||[]:i.test(e.get("dsxplan:enterpriseIdentificationNumber"))&&(t[o]=e.tagsData||[]):t[o]=e.tagsData||[]}}),t}};return l.dispatcher=new e.Class.Events,l.EXPLICIT_TAGS_DATA="explicitTagsData",l}),define("DS/RDFFoundation/Collections/ResultCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","UWA/Class/Model","DS/PlatformAPI/PlatformAPI","DS/WebAppsFoundations/Collections/PageableCollection","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/Models/CategoryModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/RDFFoundation/Mixins/FetchTrackingMixin"],function(e,t,n,i,o,s,r,a,l,c,d,u){"use strict";var h={_uwaClassName:"ResultCollection",getId:function(){return this._modelKey.get("@id")},_syncSetQueue:Function.prototype,getTotalRecords:function(){var e=this.length;return this.state&&null!==this.state.totalRecords&&void 0!==this.state.totalRecords&&(e=this.state.totalRecords+this._added.length-this._removed.length,e+=this._unregisteredModelsAdded.length-this._unregisteredModelsRemoved.length),e},hasMoreItems:function(){return this.moreItems||this.length!==this.getTotalRecords()},getModels:function(){return this._models},defaultOptions:{mode:"data",state:{pageSize:20},queryParams:{pageSize:"$top",sortKey:"$orderby",directions:{1:"desc","-1":"asc"}}},dataForRendering:function(e){for(var t=[],n=this.length,i=0;i<n;i++){var o=this.at(i);o&&t.push(o.dataForRendering(e))}return t},name:"rdf-result-collection",sync:function(){return c.prototype.sync.apply(this,arguments)},reset:function(e,t){return t&&t.forceReplaceOnSave&&(this._replaceOnSave=!0),this._newModels.clear(),this._parent.apply(this,arguments)},init:function(){this.initFetchTrackingMixinForInstance(),this._newModels=new Map,this._parent.apply(this,arguments)},setup:function(t,n){var i;if(n=n||{},this._defaultModel=n.defaultModel,i=n._modelKey,e.is(i))this._modelKey=i;else{var o=t&&t["@mask"]||n["@mask"];this._modelKey=new l({"@href":t&&t["@href"]||n["@href"],"@id":t&&t["@id"]||n["@id"],"@mask":o,mask:o,detailsMask:n.detailsMask},{parse:!0})}this.resetFlags(),this.initialized=Boolean(t&&t.member),this.listenTo(this,{onAdd:this._registerAddedModel,onRemove:this._registerRemovedModel,onReset:this._registerResetModels}),this.listenTo(this,{onReplace:this._replaceModel}),this._unregisteredModelsRemoved=[],this._unregisteredModelsAdded=[]},_replaceModel:function(e,t){var n=this.indexOf(e);-1!==n&&(this.remove(e),this.add(t,{at:n}))},removeAddedModel:function(e){var t,n=this._added.indexOf(e);return-1!==n&&(this._added.splice(n,1),t=e),t},_registerAddedModel:function(e,t,n){if(n&&(n.parse||n.fromServer||n.dontRegisterChange))n&&n.dontRegisterChange&&this.addUnregisteredModel(e);else{var i=this._removed.indexOf(e);if(-1!==i)this._removed.splice(i,1);else-1===this._added.indexOf(e)&&this._added.push(e)}e.isNew()&&(this.listenToOnce(e,"onChange:@id",()=>this._newModels.delete(e)),this._newModels.set(e,!0))},_registerRemovedModel:function(e,t,n){n&&(n.parse||n.fromServer||n.dontRegisterChange)?n&&n.dontRegisterChange&&this.removeUnregisteredModel(e):this.removeAddedModel(e)||-1===this._removed.indexOf(e)&&this._removed.push(e);this._newModels.delete(e)},_registerResetModels:function(e,t){if(!t||!(t.parse||t.fromServer||t.dontRegisterChange)){var n=t.previousModels,i=this;n.forEach(function(e){i._registerRemovedModel(e,i,t)}),this.forEach(e=>{i._registerAddedModel(e,i,t),e.isNew()&&this._newModels.set(e,!0)})}},destroy:function(){this.stopListening(),this._newModels.clear(),this._newModels=void 0,this._parent.apply(this,arguments),this.removeEvents()},set:function(t,n){var i=t;if(n&&(n.parse||n.fromServer)){let t=[...this._newModels.keys()];var o;n.parse?(r.handleContext(i),o=i.member):e.is(i.member,"array")?o=i.member:e.is(i,"array")?o=i:i=o=[i],o&&o.push.apply(o,t)}return this._parent(i,n)},fetch:function(t){var i,o,s,r,l={cancel:function(){}};if(t&&t.dontFetch)return l;var c=(s=e.clone(t,!1)||{}).idsToOpen,d=!c||s.collectionAndIds,u=d&&c&&c.length>0,h=s.onComplete;return s.onComplete=function(){!u&&h&&h.apply(this,arguments),u=!1},c&&c.length&&(this.fetchModelsById(c,s),s.newTransaction=!0),d?(s.mask&&this.setMask(s.mask),i=this._checkState(this.state),o=this.queryParams,(r=this.getLink(s.to))||(r=this.url(),"first"===s.to&&i.pageSize&&(r=a.addQueryParam(r,o.pageSize,i.pageSize)),i.sortKey&&(r=a.addQueryParam(r,o.sortKey,i.sortKey+" "+o.directions[i.order],!0))),s.url=r,-1!==s.url.indexOf("/invoke/")&&(s.method="POST"),s.remove||(s.remove=!1),n.prototype.fetch.call(this,s)):l},fetchModelsById:function(t,n){var i=this,o=e.clone(n||{},!1);o.mask=o.mask||this.getDetailsMask();var s=t.filter(function(e){return!i.get(e)}).map(function(e){return c.getObjectById(e)||r.createPlaceholder(e,void 0,void 0,{forceDslc:!0})}),a=n&&n.onFailure;this.add(s);o.onFailure=function(t){if(t instanceof e.Class.Model)i.remove(t);else{var n=[];s.forEach(function(t){t instanceof e.Class.Model?n.push(t):n.push(r.getObjectById(t["@id"]))}),i.remove(n)}e.is(a,"function")&&a.apply(void 0,arguments)},r.complete(this.model,t,o)},getPage:function(t,n){var i=e.clone(n||{},!1);return i.to=t,this.fetch(i)},sortBy:function(t,n){if(e.is(t,"function"))return this._parent.apply(this,arguments);if(e.is(n,"string")?"asc"===(n=n.toLowerCase())?n=-1:"desc"===n&&(n=1):n=n||-1,1!==n&&-1!==n)throw new Error("direction should be 1, -1, asc or desc");return this.state.sortKey=t,this.state.order=n,this.links={},this.reset(),this.toArray()},url:function(){var e=r.expandUrl(this.getUri());return a.addQueryParams(e,[{name:"$mask",value:this.getMask()},{name:"$where",value:this.getWhere(),encode:!0}])},getLink:function(e){var t=this.links[e];return t&&(t=r.expandUrl(t,"v1"),this.state.sortKey&&(t=a.addQueryParam(t,this.queryParams.sortKey,this.state.sortKey+" "+this.queryParams.directions[this.state.order],!0))),t},getWhere:function(){return this._modelKey.get("where")},getMask:function(){return this._modelKey.get("mask")},setMask:function(e){return this._modelKey.set("mask",e)},getDetailsMask:function(){return this._modelKey.get("detailsMask")||this.getMask()},setDetailsMask:function(e){return this._modelKey.set("detailsMask",e)},getUri:function(){return this._modelKey.get("@href")},setUri:function(e){this._modelKey.set(l.prototype.parse({"@href":e}))},parseRecords:function(e){return e["@href"]&&this.setUri(e["@href"]),e.member||e.value&&[e.value]||e["@value"]&&[e["@value"]]},getModelsToRemove:function(e){return this.filter(function(t){return!t.isNew()&&!e[t.id]&&!t.keepWhenUpdating})},update:function(t,n){var i=e.clone(n||{},!1);if(t.member||this.setUri(t["@id"]),t.member){for(var o={},s=t.member,r=s.length,a=0;a<r;a++){var l=s[a];o[l["@id"]]=l}var c=this.getModelsToRemove(o);this.remove(c,i),i.merge=!0,i.parse=!0,this.add(t,i)}else this.parse(t,{})},parseResponseForStateUpdate:function(n,i,o){var s=e.clone(o||{},!1),r=n.view;if(r){var a=this.links;a.first=r.first,a.prev=r.previous,a.next=r.next,a.last=r.last,a.current=r["@href"];var l=parseInt(t.parseQuery(t.parseUrl(r["@href"]).query).$skip);s.currentPage=l/o.pageSize+1}return e.is(n.totalItems)?(s.totalRecords=n.totalItems,delete this.moreItems):this.moreItems=n.moreItems,this._unregisteredModelsRemoved=[],this._unregisteredModelsAdded=[],s},compactJson:function(){return this.reduce(function(e,t){return t._deleted||e.push(t.compactJson()),e},[])},resetFlags:function(){this._added=[],this._removed=[]},model:function(e,t){var n=r.getModelConstructor(e,t)||t&&t._defaultModel||t&&t.collection&&t.collection._defaultModel||r.getDefaultModelConstructor(),i=r.getExistingAndMerge(e,t);return i?(i.collection=i.collection||t&&t.collection,i):new n(e,t)},add:function(t,n){var i=e.clone(n||{},!1);if(i.fireTypeCollectionEvent=!i.silent,i.silent=!0,n&&n.merge){const i=this._parent(t,n);return i&&(e.is(i,"array")?i.forEach(e=>c.scheduleUpdateInverseProperties(e)):c.scheduleUpdateInverseProperties(i)),i}var o=[],s=this,r=function(e){var t;e instanceof c?t=e:t=e[s.model===h.prototype.model?c.prototype.idAttribute:s.model.prototype.idAttribute];t&&!s.get(t)&&o.push(t)};t&&(e.is(t.forEach,"function")?t.forEach(r):r(t));var a=this._parent(t,i);return n&&n.silent||(a&&e.is(a.forEach,"function")?a.forEach(function(e){e.id||o.push(e)}):a&&!a.id&&-1===o.indexOf(a)&&o.push(a),i.forceDispatchEvent&&o.push(a),o.forEach(function(e){var t;t=s.get(e),s.dispatchEvent("onAdd",[t,s,n])})),a},getIdForCreateChildDSLC:function(){return 0===this.getUri().indexOf("/resources")?this.getId():""},_prepareModel:function(e){var t;if(!(e instanceof i)&&(t=r.getExistingAndMerge(e))){var n=Array.prototype.slice.call(arguments,0);return n[0]=t,this._parent.apply(this,n)}return this._parent.apply(this,arguments)},getTenant:function(){return window.enoviaServer.tenant||"OnPremise"},removeUnregisteredModel:function(e){-1===this._unregisteredModelsRemoved.indexOf(e)&&this._unregisteredModelsRemoved.push(e)},addUnregisteredModel:function(e){if(-1===this._unregisteredModelsAdded.indexOf(e)&&this._unregisteredModelsAdded.push(e),-1!==this._unregisteredModelsRemoved.indexOf(e)){var t=this._unregisteredModelsRemoved.indexOf(e);this._unregisteredModelsRemoved.splice(t,1)}},remove:function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++){var n=e[t];n.destroying&&n.onRemovedFromCollection(this)}return this._parent.apply(this,arguments)},allFetchesUseComplete:c.allFetchesUseComplete,handleBadFetchCounts:c.handleBadFetchCounts,fetchingMask:Function.prototype,doneFetchingMask:Function.prototype};return h.model.prototype.idAttribute=c.prototype.idAttribute,(h=s.extend(h)).implement(d),Object.defineProperty(h.prototype,"totalRecords",{get:h.prototype.getTotalRecords}),h.implement(u),u.initFetchTrackingMixinForClass(h),r.ResultCollection=h,h}),define("DS/RDFFoundation/Collections/PersonCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/PersonRDFModel"],function(e,t,n,i,o,s,r){"use strict";return s.extend({_uwaClassName:"PersonCollection",model:r})}),define("DS/RDFFoundation/Models/CollabspaceRepositoryModel",["UWA/Core","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ResultModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,o){"use strict";return i.extend({_uwaClassName:"CollabspaceRepositoryModel",idAttribute:"@id",setup:function(e){if(!e.displayValue){var n=t.getUsersContentRepositories().find(e=>e.actualValue===this.id);this.set(n)}},get:function(e){var n=this._parent.apply(this,arguments);switch(e){case"physicalId":return this.id;case"image":return require.toUrl("E6WCommonApps/assets/Collab_Space_icon.png");case"title":return t.hasAccessToContentRepository(this.id)?this.get("displayValue"):o.get("E6WCommonUI.Error.NoAccess")+(this.get("displayValue")||this.id)}return n},hasViewAccess:function(){return t.hasAccessToContentRepository(this.id)},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){return this.id}})}),define("DS/RDFFoundation/Models/CloneModelForRepository",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/RDFCloneModel","DS/RDFFoundation/Models/CollabspaceRepositoryModel","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/E6WCommonUI/UIHelper"],function(e,t,n,i,o,s){"use strict";return n.extend({_uwaClassName:"CloneModelForRepository",getObjectToBeAdded:function(t,n,i){const o=e.clone(i||{},!1);return o.detailedObject&&delete o.detailedObject.type_icon_url,this._parent(t,n,o)},save:function(t){var n=this.getUploadRepositoryIdAsOptionsObject(),i=e.clone(t||{},!1);e.merge(i,n),this._parent(i)},dataForRenderingWhitelistHelper:function(t,n){for(var i,o=this.createWhitelistMap(n),r=0;r<this.attributesOverridden.length;r++)if(i=this.attributesOverridden[r],o&&o[i]){var a=this.get(i);e.is(a,"object")&&(a=s.normalizedToJson(a,n)),t[i]=a}else delete t[i];return t},dataForRendering:function(e){var t=this._parent.apply(this,arguments),n=e&&e.attributes,i=this;function o(e){if(!n||n&&-1!==n.indexOf(e)){var o=i.get(e);o&&(t[e]=o.toJSON({dataForRendering:!0}))}else delete t[e]}return o("dsxplan:hasContentRepository"),o("dsplan:hasCollaborativeSpace"),t},getUploadRepositoryIdAsOptionsObject:function(){var e={},t=this.get("dsxplan:hasContentRepository");if(t){var n=t.id;n.startsWith(o.ID_PREFIX)?e.driveFolderProxyId=n:e.collabspaceId=n}return e}})}),define("DS/RDFFoundation/Models/LogicalUserModel",["DS/RDFFoundation/Models/ResultModel","DS/E6WCommonUI/E6WCommonUIConstants"],function(e,t){"use strict";var n=e.extend({_uwaClassName:"LogicalUserModel",source:t.SERVICE_3DPLAN,serviceId:t.SERVICE_3DPLAN,getObjectType:function(){return t.LOGICAL_USER_TYPE},canShowProperties:function(){return!1},getDragType:function(){return t.LOGICAL_USER_TYPE},get:function(e){let n=this._parent.apply(this,arguments);switch(e){case"miniImage":case"image":return require.toUrl("DS/E6WCommonApps/assets/img/role-avatar.png");case"fullName":case"name":return this.get("title")||this.get(t.DSLC_TITLE_ATTR);case"responsibility":if(!n)return this.get("dsplan:logicalResponsibility");break;case"@type":return this.get("type")}return n},toJSON:function(){var e=this._parent.apply(this,arguments);return e.name=this.get("name"),e.image=this.get("image"),e.fullName=this.get("fullName"),e},getTransferObject:function(){return this._parent({objectId:this.get("id"),displayName:this.get("title"),serviceId:t.SERVICE_3DPLAN})},hasViewAccess:()=>!0});return Object.defineProperty(n.prototype,"fullName",{get:function(){return this.get("fullName")}}),n}),define("DS/RDFFoundation/Collections/UserCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/Models/UsersGroupRDFModel","DS/RDFFoundation/Models/LogicalUserModel"],function(e,t,n,i,o,s,r,a,l,c){"use strict";return r.extend({_uwaClassName:"UserCollection",_prepareModel:function(e){var t,n;return this.model=(t=e[s.JS_TYPE_ATTR],n=a,t===s.LOGICAL_USER_TYPE?n=c:"foaf:Group"===t&&(n=l),n),this._parent.apply(this,arguments)}})});