define("DS/DELPPWInsertCmdPLMNewModule/InsertPLMNewCommand",["DS/ENONewWidget/command/NewContentCommandBase","UWA/Core","DS/Logger/Logger","UWA/Class/Options"],function(e,n,t,o){"use strict";var i=e.extend(o,{name:"InsertPLMNewCommand",_logger:null,_options:{context:null,type:null,dialogBoxTitle:null,callbacks:null,isCreateRoot:null,fatherReferenceID:null,ebomReferenceID:null,backendInfo:null,linkType:null,preferences:null},init:function(e){this._logger=t.getLogger(i),this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._options=e,this._options.context=this.getOption("context")},getType(){return this._options.type},getOptions(){var e={labelTopBar:this._options.dialogBoxTitle,options:{selectedIDs:["false","null","null",this._options.oneDelmiaAggregationMode?"true":"false","null",...this._options.preferences],parentOrigin:["false","null","null",this._options.oneDelmiaAggregationMode?"true":"false","null",...this._options.preferences]},events:this._options.callbacks,context:{serviceBaseUrl:this._options.backendInfo.url,tenant:this._options.backendInfo.tenant,header:this._options.backendInfo.headers,getENONewContext:function(){return{}}},viewType:"tabView",facets:[{name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}]};return this._options.isXRev&&e.facets.push({name:"revisionFacet"}),!this._options.isCreateRoot&&n.is(this._options.fatherReferenceID)&&this._options.fatherReferenceID.length>0&&!n.is(this._options.linkType,"string")&&(e.options.parentPIDs=[this._options.fatherReferenceID],e.options.selectedIDs[0]="true",e.options.parentOrigin[0]="true",e.options.parentOrigin[4]=this._options.fatherReferenceID),n.is(this._options.linkType,"string")&&this._options.linkType.length>0&&n.is(this._options.ebomReferenceID,"string")&&this._options.ebomReferenceID.length>0&&(e.options.selectedIDs[1]=this._options.linkType,e.options.selectedIDs[2]=this._options.ebomReferenceID,e.options.parentOrigin[1]=this._options.linkType,e.options.parentOrigin[2]=this._options.ebomReferenceID),e},execute:function(){var e=this.getCreateOptions(this.getType());this.launchCreateNew(e)}});return i}),define("DS/DELPPWInsertCmdPLMNewModule/InsertCmdPLMNewModule",["UWA/Core","DS/DELPPWInsertCmdPLMNewModule/InsertPLMNewCommand"],function(e,n){"use strict";return{behaviors:["ModelBehavior","ResourceBehavior","SelectionBehavior"],creator:function(t,o,i,s){var r,l,a,c,u,f,p,g={};return p=function(n){var t,i,r;if(e.is(n,"string")&&n.length>0)(t=s.getModuleSelections(n)).length>0&&(t=t[0].id,e.is(t,"string")&&t.length>0&&o.isInstance(t)&&(t=o.getReferenceIdFromInstance(t)));else if(r=s.getSelections(),e.is(r,"array")&&r.length>0)for(i=0;i<r.length&&(t=r[i][0],!e.is(t));i++);return e.is(t,"string")&&0!==t.length||(t=null),t},l=function(n){var i={},s=null,r={onComplete:function(n){var o=e.is(n)?n.get("PID"):null;t.notify("referenceCreated",{referencePID:o}),t.notify("referenceAdded",[n,null,null]),t.debug("onDBFetchComplete, fetch from DB completed: "+o),t.notify("stopProgress",i)},onFailure:function(e){t.debug("onDBFetchFailure, fetch from DB failed: "+e),t.notify("stopProgress",i)},forceDBMode:!0},l={onComplete:function(n){var o=e.is(n)&&n.instancesAndReferences.length>=2?n.instancesAndReferences[1].get("PID"):null;t.notify("instanceCreated",{instancePID:o}),t.notify("instanceAdded",[n.instancesAndReferences[1],null,null]),t.debug("onDBFetchComplete, fetch from DB completed: "+o),t.notify("stopProgress",i)},onFailure:function(e){t.debug("onDBFetchFailure, fetch from DB failed: "+e),t.notify("stopProgress",i)},forceDBMode:!0};e.is(n)&&e.is(n.result,"array")&&e.is(n.result.length>0)?(s=e.is(n.result[0].identifier,"string")&&n.result[0].identifier.length>0?n.result[0].identifier:null,t.debug("_onComplete, created PID: "+s),e.is(s)&&(t.notify("startProgress",i),e.is(n.result[0].relations)&&e.is(n.result[0].relations[0].fromID)?o.fetchInstancesAndTheirReferences([n.result[0].relations[0].relationshipID],l):o.fetchRoot(s,r))):t.warn("_onComplete, no reference PID found")},a=function(){t.debug("_onFailure")},c=function(){t.debug("_onCancel")},u=function(n,t){var o="InsertUI.CreateDialog.Title",s=i.getNLSValue(n);if(e.is(t,"string")&&t.length>0)switch(t){case"SCOPE":o="ImplementUI.CreateImplementingAndScope";break;case"RESULTING_PRODUCT":o="ImplementUI.CreateImplementingAndResultingProduct";break;default:o="ImplementUI.CreateImplementAndUnknownLink"}return i.getNLSValue(o,{type:s})},f=function(n,i){var s=null,r="Unkwown";e.is(i,"string")&&i.length>0?(s=o.getReference(o.getReferenceId(i)),e.is(s)&&(r=s.get("type")),t.debug(n+": "+i+", reference type: "+r)):t.debug("No "+n+" object ID")},r=function(i){var s,r,g=e.is(i)?i.arguments:null,d=null;i.options={isCreateRoot:null,fatherReferenceID:null,linkType:null,ebomReferenceID:null},i.options.type=null,i.options.oneDelmiaAggregationMode=t.getPreferenceValue("oneDelmiaAggregationMode"),i.options.isXRev=t.getPreferenceValue("isXRevisionActivated"),e.is(g,"array")&&g.forEach(function(n){if(e.is(n)&&e.is(n.ID,"string")&&e.is(n.Value,"string"))switch(n.ID){case"ReferenceType":i.options.type=e.is(n.Value,"string")?n.Value.split("/")[1]:null;break;case"LinkType":d=n.Value}}),s=p(i.sourceModuleId),r=p("EBOM"),e.is(s,"string")&&s.length>0&&(i.options.isCreateRoot=!1,i.options.fatherReferenceID=o.getReferenceId(s)),e.is(r,"string")&&r.length>0&&(i.options.isCreateRoot=!0,i.options.fatherReferenceID=null,i.options.linkType=d,i.options.ebomReferenceID=r),i.options.callbacks={onSuccess:l,onFailure:a,onCancel:c},i.options.backendInfo={url:o.get3DSpaceUrl().slice(0,-1),tenant:o.getTenant(),securityContext:o.getSecurityContext(),headers:o.getHeaders({isAuthoringCtx:!0})},i.options.dialogBoxTitle=u(i.options.type,i.options.linkType),f("selectedObjectId",s),f("selectedEBOMrefId",e.is(r,"array")&&r.length>0?r[0]:r),i.options.preferences=[t.getPreferenceValue("MASS"),t.getPreferenceValue("VOLUME"),t.getPreferenceValue("AREA"),t.getPreferenceValue("LENGTH")],new n(i.options).execute()},{listenTo:function(){return{InsertCmdPLMNew:r,refreshAll:this.closeDialog}},onStart:function(n,o){g=e.extend(g,n),e.is(g.insertFormAttributeXML)||(t.debug("Insert Module loading failed : insertFormAttributeXML option is undefined"),o()),o()},onStop:function(){},closeDialog:function(){}}}}});