define("DS/RevisionFamily/RevisionFamilyModel",["UWA/Controls/Abstract","DS/LifecycleServices/ArrayFunctions"],function(e,t){"use strict";return e.extend({init:function(){this.objects={},this.currentObject={}},setCurrentObject:function(e){this.currentObject!==e&&(this.currentObject=e)},getCurrentObject:function(){return this.currentObject},setObjects:function(e){var t=JSON.parse(e);if(t.hasOwnProperty("data")){this.objects=t.data;var i=this.objects.find(function(e){return e.id===this.currentObject.id},this);null!=i&&this.setCurrentObject(i)}},getObjects:function(){return this.objects},removeObjects:function(e){UWA.is(e,"array")&&e.forEach(function(e){this.removeObject(e)},this)},removeObject:function(e){for(var t=0;t<this.objects.length;++t)if(this.objects[t].id===e)return void this.objects.splice(t,1)},setObjectsInternal:function(e){this.objects=e},getObjectTitle:function(e){for(var t=0;t<this.objects.length;++t)if(this.objects[t].id===e)return this.objects[t].displayName},objectIsInModel:function(e){for(var t=0;t<this.objects.length;++t)if(this.objects[t].id===e)return!0;return!1}})}),define("DS/RevisionFamily/RevisionFamilyController",["UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/RevisionFamily/RevisionFamilyModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(e,t,i,n,o,r,s){"use strict";return e.extend({tenant:null,init:function(){this.model=new i},initTree:function(e){var t=this;n.getSecurityContextPromise(this.tenant).then(function(i){t.getRevisionHistory(e,i)})},getRevisionHistory:function(e,t){if(e.hasOwnProperty("physicalid")){var i=this,a=o.get3DSpaceWSUrl(i.tenant,"/resources/lifecycle/revision/family",null);r.authenticatedRequest(a,{method:"GET",type:"text",headers:o.getHeaders(encodeURIComponent(t)),timeout:6e5,data:"physicalid="+e.physicalid,onComplete:function(e){i.model.setObjects(e),i.dispatchEvent("onTreeInfoChanged"),i.dispatchEvent("onCompleteGetRevisionHistory")},onFailure:function(e,t){i.dispatchEvent("onError",n.parseWebServiceError(e,t))},ontimeout:function(){i.dispatchEvent("onError",s.connectionTimeout)}})}},setTenant:function(e){this.tenant=e}})}),define("DS/RevisionFamily/RevisionFamily",["css!DS/RevisionFamily/RevisionFamily","UWA/Core","UWA/Controls/Abstract","UWA/Utils/InterCom","UWA/Widget","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/ApplicationFrame/CommandsManager","DS/LifecycleCmd/CommandAPI","DS/RevisionFamily/RevisionFamilyModel","DS/UIBehaviors/ContextualMenuManager","DS/Menu/Menu","DS/WebInWinHelper/WebInWinHelper","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","i18n!DS/ConfigurationRevisionView/assets/nls/ConfigurationRevisionView","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","WebappsUtils/WebappsUtils","DS/ENO6WPlugins/jQuery","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ConfigurationRevisionView/FirstCfgRevView","DS/ConfigurationRevisionView/NewCfgRevDialog","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/i3DXCompassPlatformServices/OpenWith","DS/ApplicationFrame/ActionBar","DS/LifecycleServices/LifecycleAlert"],function(cssRevisionFamily,UWA,Abstract,InterCom,Widget,Mask,PlatformAPI,CommandsManager,CommandAPI,RevisionFamilyModel,ContextualMenuManager,Menu,WebInWinHelper,lifecycleWidgetNls,CfgRevNLS,LifecycleServicesSettings,LifecycleServices,WebappsUtils,jQuery,VersionExplorerController,FirstCfgRevView,NewCfgRevDialog,VEEnums,VESettings,OpenWith,ActionBar,LifecycleAlert){"use strict";var useNewMenu=!0,pushVar="PushItem",myWidget=Abstract.extend({context:null,currentObject:void 0,originalEBProduct:void 0,currentType:"NON_CR",cfgRevType:"ConfiguredBaseline",defaultOptions:{wintop:!1},WebToWinComSocket:null,ContextualMenuData:null,init:function(e,t,i,n,o){this.widget=e,this.bottomMargin=i,this.dropDownToken=void 0,this.context=o,LifecycleServices.getHistoryConfigPromise().then(function(e){VESettings.historyConfig=e},function(){VESettings.historyConfig=null}),this.contextMenuObject=null,1==n.wintop&&(this.WebToWinComSocket=n.webToWinComSocket),this._parent(n),this._buildSkeleton(),this._getParentContainer=function(){return t||UWA.Element.getElement.call(e.body,".history_popup")},this.parentWidget=t,this.id=Date.now()},updateObjectTitle:function(e,t){var i=document.getElementById(this.getUniqueHtmlIdForNode(e));i&&(i.textContent=t+"Â ")},getUniqueHtmlIdForNode:function(e){return e+"revision"},showCompare:function(e,t){if(1==this.options.wintop)null!=this.ContextualMenuData&&WebInWinHelper.launchWinCompare(this.WebToWinComSocket,e,t);else{var i=[],n=widget.getValue("x3dPlatformId");if(null!==e&&i.push({envId:n,serviceId:"",contextId:"",objectId:e.id,objectType:"",displayName:""}),null!==t&&i.push({envId:n,serviceId:"",contextId:"",objectId:t.id,objectType:"",displayName:""}),i.length>0){var o={envId:n,protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:i}},r=new InterCom.Socket("compassPageSocket");r.subscribeServer("com.ds.compass",window.parent),r.dispatchEvent("onSetX3DContent",o,"compassPageSocket"),r.addListener("launchApp",function(e){console.log("Response = "+JSON.stringify(e)),this.response=e.response});r.dispatchEvent("onLaunchApp",{appId:"ENOCOMP_AP"},"compassPageSocket")}}},_buildSkeleton:function(){var that=this,globalDiv=this.elements.container=UWA.createElement("div");globalDiv.className="revision-main",globalDiv.setAttribute("data-rec-id",globalDiv.className),this.revisionTab=document.createElement("div"),this.revisionTab.className="revision-table",this.revisionTab.setAttribute("data-rec-id",this.revisionTab.className);var NLVView=document.createElement("div");NLVView.className="revision-NLVView",NLVView.setAttribute("data-rec-id",NLVView.className),this.revisionTab.NLVView=NLVView,this.revisionTab.appendChild(NLVView),globalDiv.appendChild(this.revisionTab),this.revisionTab.NLVView.style.display="block",this.revisionFamilyCfgRevContainer=UWA.createElement("div",{class:"revisionFamilyCfgRevContainer"}),this.revisionFamilyCfgRevContainer.inject(NLVView),this.revisionFamilyCfgRevContainer.hide(),this.revisionFamilyNLVViewContainer=UWA.createElement("div",{class:"revisionFamilyNLVViewContainer"}),this.revisionFamilyNLVViewContainer.setAttribute("data-rec-id","revisionFamilyNLVViewContainer"),this.revisionFamilyNLVViewContainer.inject(NLVView),this.revisionFamilyNLVViewContainer.addEventListener("click",function(e){Menu.hide()});var selectionType=VEEnums.SELECTION_MODES.SINGLE_SELECT_ONLY;void 0!==that.options.clientOptions&&"true"===that.options.clientOptions.Multiselect&&(selectionType=VEEnums.SELECTION_MODES.MULTI_SELECT_ONLY),void 0!==that.options.clientOptions&&"true"===that.options.clientOptions.NoContextMenu||(selectionType|=VEEnums.SELECTION_MODES.WITH_COMMANDS),this.widget||(this.widget=new Widget,this.widget.setValue("TemporaryPropertiesWidget",!0));var useWebCommandsOnNative=!1;void 0!==that.options.clientOptions&&that.options.clientOptions.versionExplorerUseWebCommandsOnNative&&(useWebCommandsOnNative=!0);var disableMaturityButton=!1;void 0!==that.options.clientOptions&&that.options.clientOptions.disableMaturityButton&&(disableMaturityButton=!0);var fromWebInWinWrapper=!1;void 0!==that.options.clientOptions&&that.options.clientOptions.fromWebInWinWrapper&&(fromWebInWinWrapper=!0),that.useGlobalStorage=!1,that.globalStorageName="",that.WebToWinComSocket&&void 0!==that.options.clientOptions&&"true"===that.options.clientOptions.UseWebInWinGlobalStorage?(that.useGlobalStorage=!0,that.globalStorageName="WebInWinSettings"):that.widget&&that.widget._view&&"maximized"===that.widget._view.type&&1!=that.widget.wasLaunchedMinimized?(that.useGlobalStorage=!0,that.widget.wasLaunchedMinimized=!1,that.globalStorageName="LifecycleStandAloneSettings"):that.widget&&!that.widget._view&&null==that.widget.wasLaunchedMinimized&&(that.widget.wasLaunchedMinimized=!0),that.versionExplorer=new VersionExplorerController({versionGraphContainer:that.revisionFamilyNLVViewContainer,webToWinComSocket:that.WebToWinComSocket,useWebCommandsOnNative:useWebCommandsOnNative,selectionMode:selectionType,useGlobalStorage:that.useGlobalStorage,globalStorageName:that.globalStorageName,disableMaturityButton:disableMaturityButton,fromWebInWinWrapper:fromWebInWinWrapper,customOnDrop:function(e){that.dispatchEvent("DropEvent",e)},widget:!0!==that.options.wintop||that.widget?that.widget:void 0,autoUpdate:!1,historyUIContainer:that.context,revisionFamily:that}),that.versionExplorer.subscribeEvent("_ENOXVersionExplorerInternalRefreshCompleted",function(e){that.applyFilter(e.contextualMenu)},!1),that.versionExplorer.subscribeEvent("select",function(e){that.onSelectForVersionExplorer(e.data.nodeModel)},!1),that.versionExplorer.subscribeEvent("unselect",function(e){that.onUnSelectForVersionExplorer(e.data.nodeModel)},!1),that.versionExplorer.subscribeEvent("ENOXVersionExplorerLoadCompleted",function(event){that.dropDownToken&&that.versionExplorer.unsubscribeEvent("ENOXVersionExplorerDropdownMenu",that.dropDownToken);var webCommnadsOnNative=that.versionExplorer._setUseWebCommandsOnNative();if(webCommnadsOnNative){PlatformAPI.subscribe("Lifecycle.Modification",function(e){that.versionExplorer.publishEvent("_ENOXVersionExplorerInternalRefresh",{reframe:!1,contextualMenu:!0})}),that.displayNotification=function(e){LifecycleAlert.displayNotification(e)};var cmd=CommandsManager.getCommand("RevisionHdr",that.widget);if(!cmd){that._commandGenerationRequired=!0;var action_bar="lifecycle.xml";that._actionBar=new ActionBar({context:that,file:action_bar,module:"LifecycleWidget"})}that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerOpenWith",function(e){return!1}),that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerOpenVersion",function(e){return!1}),that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerWhereUsed",function(e){return that.versionExplorer.isEffectivityBased()&&!that.versionExplorer.isEffectivityBasedReused()&&!e.isMIB()}),that.versionExplorer.subscribeEvent("_ENOXVersionExplorerViewChanged",function(e){})}else if(1==that.options.wintop)that.dropDownToken=that.versionExplorer.subscribeEvent("ENOXVersionExplorerDropdownMenu",function(e){var t=e.data||e;that.onPickContextForVersionExplorer(t.treeNode,t.selectedNodes,t.position)},!0);else{var cmd=CommandsManager.getCommand("RevisionHdr",that.widget);that.wasWidgetCommands=null!=CommandsManager.getCommand(that.widget),cmd||(cmd=CommandsManager.getCommand("RevisionHdr"));var documentOnly=!1;if(cmd&&"Document"===that.currentObject.type&&"ENOPSTE_AP"!=that.widget.data.appId){var DownloadHdr=CommandsManager.getCommand("DownloadHdr",that.widget),PreviewHdr=CommandsManager.getCommand("PreviewHdr",that.widget);DownloadHdr&&PreviewHdr||("ENOFOL4_AP"!=that.widget.data.appId&&(documentOnly=!0),cmd=null)}if(!cmd){var commandsEnabled=that.versionExplorer.areCommandsEnabled();that._commandGenerationRequired=!0;var NewBranchCmd=CommandsManager._commands.NewBranchHdr,MaturityCmd=CommandsManager._commands.MaturityHdr,RevisionCmd=CommandsManager._commands.RevisionHdr;NewBranchCmd&&delete CommandsManager._commands.NewBranchHdr,MaturityCmd&&delete CommandsManager._commands.MaturityHdr,RevisionCmd&&delete CommandsManager._commands.RevisionHdr;var action_bar=documentOnly?"prop_lifecycle.xml":"lifecycle.xml";that._actionBar=new ActionBar({context:that,file:action_bar,module:"LifecycleWidget"}),that._actionBar._modelEvents.subscribe({event:"EVT_ACTIONBAR_READY"},function(){NewBranchCmd&&(CommandsManager._commands.NewBranchHdr=NewBranchCmd),MaturityCmd&&(CommandsManager._commands.MaturityHdr=MaturityCmd),RevisionCmd&&(CommandsManager._commands.RevisionHdr=RevisionCmd),commandsEnabled&&that.versionExplorer.enableCommands()})}that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerOpenVersion",function(e){return!1}),void 0!==that.options.clientOptions&&!0===that.options.clientOptions.includeMaturity||that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerShowMaturity",function(e){return!1}),that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerWhereUsed",function(e){return!that.versionExplorer.isEffectivityBasedReused()&&!e.isMIB()}),that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerOpenWith",function(e){return!e.isxRev()}),that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerCompareToSelected",function(e){var t=!1,i=that.versionExplorer.getSelectedNodes(),n=e.options.data.id;if(e.isMIB())return t;for(var o=0;o<i.length;o++){if(i[o]._options.id!==n){t=!0;break}}return t}),that.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerMergeIntoSelected",function(e){if(e.isMIB())return!1;var t=CommandsManager.getCommand("MergeHdr",that.widget);if(!t)return!1;var i=e.getAttributeValue("type");if(!i||!t.isTypesSupported([i]))return!1;for(var n=!1,o=that.versionExplorer.getSelectedNodes(),r=e.options.data.id,s=0;s<o.length;s++){if(o[s]._options.id!==r){n=!0;break}}return n});var data=[];that.context&&that.context.options&&that.context.options.context&&that.context.options.context.infoForCustomization&&(data=that.context.options.context.infoForCustomization);var customizations=data.VersionExplorerCustomization,versionExplorer=that.versionExplorer;if(customizations)for(var ii=0;ii<customizations.length;ii++){var func="string"==typeof customizations[ii]?eval("("+customizations[ii]+")"):customizations[ii];"function"==typeof func&&func()}}},!1),that.versionExplorer.subscribeEvent("ENOXVersionExplorerError",function(e){var t={eventID:"error",msg:lifecycleWidgetNls.objectNotFound};LifecycleAlert.displayNotification(t)},!1)},onResize:function(e){},applyFilter:function(e){var t=this,i=!1;if(void 0!==t.options.clientOptions)if("false"===t.options.clientOptions.SelectAnyRevison)1===(n=t.versionExplorer.applyFilter(function(e){var i=!0;if("false"===t.options.clientOptions.ActiveObjectSelectable){var n=t.versionExplorer.getObjects().find(function(e){return e.options.id===t.currentObject.id||e.options.grid&&e.options.grid.contents&&e.options.grid.contents[0].id===t.currentObject.id}),o=n?n.options.grid.majorid:void 0;if("string"==typeof t.currentObject.id)i=t.currentObject.id!==e._options.id&&e._options.grid.majorid!==o;else if(t.currentObject.id.item&&t.currentObject.id.item.id){var r=t.currentObject.id.item.id;i=(r=r.replace("vid:",""))!==e._options.id&&e._options.grid.majorid!==o}}return!0===i&&(i=!0===e._options.grid.__isLeaf__),i})).length&&(t.versionExplorer.unselectAll(),n[0].select(),void 0!==t.options.clientOptions&&"true"===t.options.clientOptions.AutoFire&&(i=!0));else if("false"===t.options.clientOptions.ActiveObjectSelectable){var n,o=t.versionExplorer.getObjects().find(function(e){return e.options.id===t.currentObject.id||e.options.grid&&e.options.grid.contents&&e.options.grid.contents[0].id===t.currentObject.id}),r=o?o.options.grid.majorid:void 0;1===(n=t.versionExplorer.applyFilter(function(e){if("string"==typeof t.currentObject.id)return t.currentObject.id!==e._options.id&&e._options.grid.majorid!==r;var i=!0;if(t.currentObject.id.item&&t.currentObject.id.item.id){var n=t.currentObject.id.item.id;i=(n=n.replace("vid:",""))!==e._options.id&&e._options.grid.majorid!==r}return i})).length&&(t.versionExplorer.unselectAll(),n[0].select(),void 0!==t.options.clientOptions&&"true"===t.options.clientOptions.AutoFire&&(i=!0))}else{var s=t.versionExplorer.getSelectedNodes();!0===e&&0!==s.length&&t.currentObject.id!==s[0].options.data.id||t.versionExplorer.select(t.currentObject.id,!0)}return i},_updateHistoryTree:function(){var e=this;this.revisionTab.style.display="none",this.revisionTab.style.display="block",this.dispatchEvent("ModelUpdated",this.currentObject),LifecycleServices.getSecurityContextPromise(LifecycleServicesSettings.getTenant()).then(function(t){var i={displayLegend:!1};VESettings.historyConfig&&VESettings.historyConfig.settings&&(VESettings.historyConfig.settings.defaultView&&(i.displayMode=VEEnums.DISPLAY_MODES[VESettings.historyConfig.settings.defaultView]),VESettings.historyConfig.settings.thumbnailGraph&&(VESettings.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout&&(i.thumbnailGraphLayout=VESettings.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout),VESettings.historyConfig.settings.thumbnailGraph.displayThumbnailOverview&&(i.displayThumbnailOverview="true"===VESettings.historyConfig.settings.thumbnailGraph.displayThumbnailOverview)),VESettings.historyConfig.settings.subwayGraph&&(VESettings.historyConfig.settings.subwayGraph.subwaySort&&(i.subwaySortAscending="asc"===VESettings.historyConfig.settings.subwayGraph.subwaySort),"SUBWAY_COMPACT_VIEW"!==VESettings.historyConfig.settings.subwayGraph.viewMode&&"SUBWAY_COMFORTABLE_VIEW"!==VESettings.historyConfig.settings.subwayGraph.viewMode||(i.subwayViewMode=VESettings.historyConfig.settings.subwayGraph.viewMode)),VESettings.historyConfig.settings.defaultDisplayDuplicates&&(i.displayDuplicates="true"===VESettings.historyConfig.settings.defaultDisplayDuplicates)),VESettings._widget&&e.tenant&&VESettings._widget.setValue("x3dPlatformId",e.tenant),VESettings.loadUserSettingsPromise(i,!1,e.useGlobalStorage,e.globalStorageName,e.versionExplorer._getWebInWinSocket()).then(function(){e.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:e.currentObject.id,tenantId:e.tenant,securityContext:t,type:e.currentObject.type,serviceId:e.currentObject.serviceId,context:e.context,onComplete:function(){var t=e.applyFilter(),i={selectedNodes:e.versionExplorer.getSelectedNodes(),autoFire:t};e.versionExplorer.reframeAll(),e.dispatchEvent("onVersionExplorerLoaded",i)},dataModelType:void 0!==e.options.clientOptions&&"true"===e.options.clientOptions.modelRevisions||"ConfiguredBaseline"===e.currentObject.type?VEEnums.DATA_MODEL_TYPES.MODEL_REVISION:VEEnums.DATA_MODEL_TYPES.MODEL_HISTORY})},function(e){console.log(e)})},function(e){console.log(e)}),e.onResize()},displayError:function(e){document.body.style.cursor="default",this.showError(e)},showError:function(e){if(void 0!==this.context&&null!==this.context&&this.hasOwnProperty("context")&&"function"==typeof this.context.displayNotification){var t={eventID:"warning",msg:e};this.context.displayNotification(t)}},setObjects:function(e){var t=this;if(0===e.length)this.displayError(lifecycleWidgetNls.noObject);else if(1===e.length){var i=e[0];if(i.hasOwnProperty("physicalid")&&""===i.physicalid)this.displayError(lifecycleWidgetNls.epmtyPhysicalId);else{if(this.tenant=i.tenant,i.hasOwnProperty("displayName")&&i.displayName&&i.displayName.trim().length>0){var n=i.type,o=i.serviceId;this.currentObject={id:i.physicalid,displayName:i.displayName,revision:i.revision,type:n,serviceId:o}}else{n=i.type,o=i.serviceId;this.currentObject={id:i.physicalid,type:n,serviceId:o}}if(this.options.getAllowedSemanticsResponse)this.transitRevisionUXBasedOnModeAndSemantic(this.currentObject,this.options.getAllowedSemanticsResponse);else{var r=[];r.push(this.currentObject.id),LifecycleServices.getAllowedSemanticsPromise(r).then(function(e){t.transitRevisionUXBasedOnModeAndSemantic(t.currentObject,e)},function(e){t.displayError(e)})}}}else this.displayError(lifecycleWidgetNls.multipleSelection)},transitRevisionUXBasedOnModeAndSemantic:function(e,t){if(LifecycleServices.isAnyEffectivityBasedMode(e.id,t)){var i=LifecycleServices.getRevisionMode(e.id,t);this.versionExplorer.setRevisionMode(i),this.originalEBProduct=e,this.graphProprietary=LifecycleServices.getgraphProprietary(e.id,t),this.versionExplorer.setGraphProprietary(this.graphProprietary),this.originalEBProduct&&"xRevisionElement"===e.type||(this.originalEBProduct=e)}else"xRevisionElement"!=e.type&&(this.originalEBProduct=null,this.versionExplorer.clearRevisionMode());if(LifecycleServices.isBaselineMode(e.id,t)){var n={data:{displayName:e.displayName,cfgRevTitle:CfgRevNLS.CfgRevText+" - "+e.displayName+" ["+CfgRevNLS.ConfiguredText+"]"}};this.currentType="CR",e.type=this.cfgRevType,LifecycleServices.isFirstSemantic(e.id,t)?this.loadFirstCfgRevView(e):this.loadRevisionFamilyNLVView(e),this.dispatchEvent("onCfgRevisionLoad",n)}else this.currentType="NON_CR",this.loadRevisionFamilyNLVView(e)},loadFirstCfgRevView:function(e){var t=this;this.revisionFamilyNLVViewContainer.hide(),this.revisionFamilyCfgRevContainer.show(),this.firstCfgRevView=new FirstCfgRevView({parentContainer:t.revisionFamilyCfgRevContainer,displayCompactMode:!1,onClick:function(){require(["DS/ReviseWidget/ReviseWidget"],function(i){var n=[],o={useFIRST:!0,type:"ConfiguredBaseline",physicalid:e.id,name:e.name,displayName:e.displayName,tenant:t.tenant};n.push(o),new i({}).executeCmd(n,{context:t.context,targetFolderId:null},function(i){i&&(e.id=i.id,e.revision=i.revision,e.name=i.name,e.displayName=i.displayName,t.loadRevisionFamilyNLVView(e))})})}}),this.firstCfgRevView.render()},loadRevisionFamilyNLVView:function(e){this.revisionFamilyCfgRevContainer.hide(),this.revisionFamilyNLVViewContainer.show(),this._updateHistoryTree(),this.dispatchEvent("onDataUpdated",e)},onSetCtxMenuForItem:function(e){var t=this,i=WebInWinHelper.parseContextualMenu(e);t.versionExplorer._isWebInWinMode()&&t.WebToWinComSocket.contextCallback?t.WebToWinComSocket.contextCallback(i):(t.ContextualMenuData=i,null!=t.contextMenuObject&&(this.options.wintop?t.doPickContext(t.contextMenuObject):LifecycleServicesSettings.isOpenWithCATIAV5Available(function(e){t.doPickContext(t.contextMenuObject,e)})))},onSelectForVersionExplorer:function(e){var t=this.versionExplorer.getSelectedNodes(),i=e.options.cid?e.options.cid:e._options.id,n=UWA.String.unescapeHTML(e._options.label),o=e._options.grid.code,r=this.versionExplorer._securityContext,s=e.options.grid["ds6w:kind"];if(void 0===this.options.clientOptions||"false"!==this.options.clientOptions.ActiveObjectSelectable||this.currentObject.id!==i){var a=e._options.data.serviceId,c=e._options.data.type;c||""!=c||(c=e._options.grid.type);var l={revisionMode:this.versionExplorer.revisionMode,graphProprietary:this.graphProprietary,originalEBProduct:this.originalEBProduct},d={data:{physicalid:i,displayName:n,revision:o,contextId:r,serviceId:a,type:c,tenant:this.tenant,"ds6w:kind":s,selectedNodes:t,revisionModeInfo:l}};this.currentType&&"CR"==this.currentType&&(d.data.cfgRevTitle=CfgRevNLS.CfgRevText+" - "+d.data.displayName+" ["+CfgRevNLS.ConfiguredText+"]"),this.sendEBProduct=!1,this.dispatchEvent("onSelectedObject",d)}else 1===t.length&&this.versionExplorer.unselectAll()},onUnSelectForVersionExplorer:function(e){var t=this,i=t.versionExplorer.getSelectedNodes(),n={data:{physicalid:e._options.id,displayName:e._options.label,revision:e._options.grid.code,serviceId:e.options.data.serviceId,type:e.options.data.type,tenant:t.tenant,selectedNodes:i}};this.currentType&&"CR"==this.currentType&&(n.data.cfgRevTitle=CfgRevNLS.CfgRevText+" - "),t.dispatchEvent("onUnSelectedObject",n),t.versionExplorer.isAnyEffectivityBasedMode()&&(t.sendEBProduct=!0,setTimeout(function(){if(1==t.sendEBProduct&&0==t.versionExplorer.getSelectedNodes().length&&t.originalEBProduct){var e={data:t.originalEBProduct};e.data.physicalid||(e.data.physicalid=e.data.id),t.dispatchEvent("onSelectedObject",e)}},100))},onPickContextForVersionExplorer:function(e,t,i){var n=this;if(!0!==n.options.disableContextMenu){n.contextMenuObject=UWA.merge({pos:[i.x,i.y],selectedNodes:t},e.options.data),void 0!==n.contextMenuObject.displayName&&(n.contextMenuObject.displayName=UWA.String.unescapeHTML(n.contextMenuObject.displayName)),void 0!==n.contextMenuObject.name&&(n.contextMenuObject.name=UWA.String.unescapeHTML(n.contextMenuObject.name));var o=[];o.push(e.options.data),!0===n.options.wintop?WebInWinHelper.fetchContextFromSelection(n.WebToWinComSocket,o,n.currentObject):LifecycleServicesSettings.isOpenWithCATIAV5Available(function(e){n.doPickContext(o[0],e)})}},doPickContext:function(e,t){if(1==this.options.wintop){this._doPickContext(e,t,void 0)}},_doPickContext:function(e,t,i){var n=this,o=this;n.context.hasOwnProperty("widget")?n._isWidget=!0:n._isWidget=!1;var r,s=[];for(var a=WebappsUtils.getWebappsBaseUrl()+"RevisionFamily/assets/icons/32/",c=!1,l=o.versionExplorer.getSelectedNodes(),d=0;d<l.length;d++){if(l[d]._options.id===e.physicalid){c=!0;break}}for(d=0;d<o.contextMenuObject.selectedNodes.length;d++){if(o.contextMenuObject.selectedNodes[d]._options.id===e.physicalid){c=!0;break}}if(o.contextMenuObject&&1==o.options.wintop){var p=o.ContextualMenuData[0],u=n.contextMenuObject.displayName,h={id:n.contextMenuObject.physicalid,displayName:u};WebInWinHelper.onBuildWinContextMenu(o.WebToWinComSocket,p,s,h)}if(1==o.options.wintop){var v=!0;if(0==l.length&&(v=!1),!c&&v){r="url("+a+"I_Compare.png)";var m=function(){if(l.length>0){var e=l[0];o.showCompare({id:e._options.id},{id:n.contextMenuObject.physicalid})}},g={callback:m,this:o};s.push({title:lifecycleWidgetNls.compare,label:lifecycleWidgetNls.compare,type:pushVar,icon:r,action:g,callback:m})}}if(1==o.options.wintop){var f=window.location.search.indexOf("touch")>=0,y=window.location.search.indexOf("replace")>=0,E={input:f?"touch":"mouse",position:{x:o.contextMenuObject.pos[0],y:o.contextMenuObject.pos[1]},submenu:1==s.length?"outside":y?"replace":"auto"};Menu.show(s,E)}},cleanup:function(){0==this.wasWidgetCommands&&delete CommandsManager._commands[this.widget],this.versionExplorer.cleanup(),this.firstCfgRevView&&this.firstCfgRevView.cleanup()},reviseStatus:function(e){}});return myWidget});