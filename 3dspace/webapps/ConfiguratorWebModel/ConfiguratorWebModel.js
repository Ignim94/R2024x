define("DS/ConfiguratorWebModel/ConfiguratorModel",["UWA/Core"],function(t){function e(){this._applicationStateInJson={featuresVisibleAttributes:[],optionsVisibleAttributes:["Display Text"]},this._appRulesParamInJson={multiSelection:"false",selectionMode:"selectionMode_Build",rulesMode:"RulesMode_EnforceRequiredOptions",rulesActivation:"true",completenessStatus:"Unknown",rulesCompliancyStatus:"Unknown"},this._dictionaryInJson="",this._configurationCriteriaInJson=[],this.cacheKeyInValueById=new Object,this.cacheDateKeyInDisplayValueById=new Object,this._appFuncInJson="",this._appAction="",this._accordConfigurationFeature={},this._evolutionCriteriaInJson={},this._productStateTreeObj=null,this._nodeSolver,this._solverId,this._nodeSolverName="SolverNode_0",this._mustSelectFeatureNumber=0,this._listOfListOfConflictingImpliedRules=[],this._listOfListOfConflictingIds=[],this._listOfDefaultOptionsFromSolver=[],this._rulesConsistency=!0,this.cacheIdWithState=new Object,this.cacheIdWithPrice=new Object,this.totalPrice="0.0",this.cacheFeatures,this.cacheOption,this.CoordForTooltipIncompatibilities,this.cacheOptionIdWithFeatureId=new Object,this.cacheOrderableState,this._pcPurpose="",this._refineSelMode="",this._listOfRefineSelectionMode=new Object,this._showWarningInfoBox=!0,this._onWinEnv=!1,this._widget=null,this._errorOnConflictPanel=!1,this._3dCounter=0,this.getPCPurpose=function(){return this._pcPurpose},this.setPCPurpose=function(t){this._pcPurpose=t},this.getRefineSelMode=function(){return this._refineSelMode},this.setRefineSelMode=function(t){this._refineSelMode=t},this.getWidget=function(){return this._widget},this.setWidget=function(t){this._widget=t},this.setErrorOnConflictPanel=function(t){this._errorOnConflictPanel=t},this.getErrorOnConflictPanel=function(){return this._errorOnConflictPanel},this.getFeatureIdWithOptionId=function(t){return this.cacheOptionIdWithFeatureId[t]},this.getCacheOptionsIdWithFeatureId=function(){return this.cacheOptionIdWithFeatureId},this.getCacheOrderableState=function(){return this.cacheOrderableState},this.EmptyCacheIdWithState=function(){this.cacheIdWithState=[],this._configurationCriteriaInJson=[],this.cacheKeyInValueById=[],this.cacheDateKeyInDisplayValueById=[],this.cacheFeatures=null,this.cacheOption=null},this.setCoordForTooltipIncompatibilities=function(t){this.CoordForTooltipIncompatibilities=t},this.getCoordForTooltipIncompatibilities=function(){return this.CoordForTooltipIncompatibilities},this.getFeatureCache=function(){return this.cacheFeatures},this.setFeatureCache=function(t){this.cacheFeatures=t},this.getOptionCache=function(){return this.cacheOption},this.setOptionCache=function(t){this.cacheOption=t},this.getDefaultOptionsList=function(){return this._listOfDefaultOptionsFromSolver},this.setDefaultOptionsList=function(t){this._listOfDefaultOptionsFromSolver=t},this.getListOfListOfImpliedRules=function(){return this._listOfListOfConflictingImpliedRules},this.setListOfListOfImpliedRules=function(t){this._listOfListOfConflictingImpliedRules=t},this.getListOfListOfConflictingIds=function(){return this._listOfListOfConflictingIds},this.setListOfListOfConflictingIds=function(t){this._listOfListOfConflictingIds=t},this.get3DCounter=function(){return this._3dCounter},this.set3DCounter=function(t){this._3dCounter=t},this.getRulesConsistency=function(){return this._rulesConsistency},this.setRulesConsistency=function(t){this._rulesConsistency=t},this.setConfigurationMode=function(t){this._onWinEnv&&this._appRulesParamInJson.selectionMode&&this._appRulesParamInJson.selectionMode!=t&&this._3dCounter++,this._appRulesParamInJson.selectionMode=t,"build"==this._appRulesParamInJson.selectionMode&&(this._appRulesParamInJson.selectionMode="selectionMode_Build"),"refine"==this._appRulesParamInJson.selectionMode&&(this._appRulesParamInJson.selectionMode="selectionMode_Refine"),"selectionMode_Build"==this._appRulesParamInJson.selectionMode&&this.setRefineSelectionModeForAllFeatures("select"),"selectionMode_Refine"==this._appRulesParamInJson.selectionMode&&this.setRefineSelectionModeForAllFeatures("reject")},this.getConfigurationMode=function(){return this._appRulesParamInJson.selectionMode},this.setRefineSelectionModeForSpecifiedFeature=function(t,e){this._listOfRefineSelectionMode[t]=e},this.getRefineSelectionModeForSpecifiedFeature=function(t){return this._listOfRefineSelectionMode[t]},this.setRefineSelectionModeForAllFeatures=function(t){for(var e in this._listOfRefineSelectionMode)this._listOfRefineSelectionMode[e]=t},this.getSelectionTypeForSpecifiedFeature=function(t){for(var e=this._dictionaryInJson.features,i=0;i<e.length;i++)if(e[i].ruleId==t)return e[i].selectionType},this.setCompletenessStatus=function(t){this._appRulesParamInJson.completenessStatus=t},this.getCompletenessStatus=function(){return this._appRulesParamInJson.completenessStatus},this.setRulesCompliancyStatus=function(t){this._appRulesParamInJson.rulesCompliancyStatus=t},this.getRulesCompliancyStatus=function(){return this._appRulesParamInJson.rulesCompliancyStatus},this.setDictionary=function(t){this._dictionaryInJson=t;var e=this._dictionaryInJson.features;this.cacheOrderableState=new Object;for(var i=0;i<e.length;i++){this.cacheOptionIdWithFeatureId[e[i].ruleId]=e[i].ruleId;var n=!1,s=!0;"selectionMode_Build"==this.getConfigurationMode()?this.setRefineSelectionModeForSpecifiedFeature(e[i].ruleId,"select"):"selectionMode_Refine"==this.getConfigurationMode()&&this.setRefineSelectionModeForSpecifiedFeature(e[i].ruleId,"reject");for(var o=0;o<e[i].options.length;o++)this.cacheOptionIdWithFeatureId[e[i].options[o].ruleId]=e[i].ruleId,null!=e[i].options[o].orderability&&(s=!1,this.cacheOrderableState[e[i].options[o].ruleId]=e[i].options[o].orderability,1==e[i].options[o].orderability&&(n=!0));this.cacheOrderableState[e[i].ruleId]=!(!n&&!s)}},this.getDictionary=function(){return this._dictionaryInJson},this.setAction=function(t){this._appAction=t},this.getAction=function(){return this._appAction},this.setApplicationState=function(t){this._applicationStateInJson=t},this.getApplicationState=function(){return this._applicationStateInJson},this.setAppRulesParam=function(t){this._onWinEnv&&this._appRulesParamInJson.selectionMode&&this._appRulesParamInJson.selectionMode!=t.selectionMode&&this._3dCounter++,this._appRulesParamInJson=t,"build"==this._appRulesParamInJson.selectionMode&&(this._appRulesParamInJson.selectionMode="selectionMode_Build"),"refine"==this._appRulesParamInJson.selectionMode&&(this._appRulesParamInJson.selectionMode="selectionMode_Refine"),"optim"==this._appRulesParamInJson.rulesMode&&(this._appRulesParamInJson.rulesMode="RulesMode_ProposeOptimizedConfiguration"),"completeConfMode"==this._appRulesParamInJson.rulesMode&&(this._appRulesParamInJson.rulesMode="RulesMode_SelectCompleteConfiguration"),"dependencies"==this._appRulesParamInJson.rulesMode&&(this._appRulesParamInJson.rulesMode="RulesMode_EnforceRequiredOptions"),"incompatibilities"==this._appRulesParamInJson.rulesMode&&(this._appRulesParamInJson.rulesMode="RulesMode_DisableIncompatibleOptions"),t.rules&&!t.rulesActivation&&(this._appRulesParamInJson.rulesActivation=t.rules),"selectionMode_Build"==this._appRulesParamInJson.selectionMode&&this.setRefineSelectionModeForAllFeatures("select"),"selectionMode_Refine"==this._appRulesParamInJson.selectionMode&&this.setRefineSelectionModeForAllFeatures("reject")},this.getAppRulesParam=function(){return this._appRulesParamInJson},this.setConfigurationCriteria=function(t){this._configurationCriteriaInJson=this.stateInterpreter(t)},this.getConfigurationCriteria=function(){return this._configurationCriteriaInJson},this.getAdaptedConfigurationCriteria=function(){for(var t=this._configurationCriteriaInJson,e=0;e<t.length;e++)this.isAFeature(t[e].Id)?t[e].State="Unknown":(this.isAnOption(t[e].Id)||0==t[e].Id.indexOf("KeyIn_"))&&("chosen"==t[e].State||"chosenInConflict"==t[e].State?t[e].State="Chosen":"required"==t[e].State?t[e].State="Required":"default"==t[e].State||"defaultInConflict"==t[e].State?t[e].State="Default":"dismissed"==t[e].State||"dismissedInConflict"==t[e].State?t[e].State="Dismissed":"incompatible"==t[e].State?t[e].State="Incompatible":"available"==t[e].State||"included"==t[e].State?t[e].State="Unselected":"Unknown"==t[e].State?t[e].State="Unknown":"recommanded"==t[e].State&&(t[e].State="Selected"));return t},this.setAppFunc=function(t){this._appFuncInJson=t,t.build&&!t.selectionMode_Build&&(this._appFuncInJson.selectionMode_Build=t.build),t.refine&&!t.selectionMode_Refine&&(this._appFuncInJson.selectionMode_Refine=t.refine),t.optim&&!t.rulesMode_ProposeOptimizedConfiguration&&(this._appFuncInJson.rulesMode_ProposeOptimizedConfiguration=t.optim),t.completeConfMode&&!t.rulesMode_SelectCompleteConfiguration&&(this._appFuncInJson.rulesMode_SelectCompleteConfiguration=t.completeConfMode),t.rules&&!t.rulesMode_EnforceRequiredOptions&&(this._appFuncInJson.rulesMode_EnforceRequiredOptions=t.rules),t.incompatibilities&&!t.rulesMode_DisableIncompatibleOptions&&(this._appFuncInJson.rulesMode_DisableIncompatibleOptions=t.incompatibilities)},this.getAppFunc=function(){return this._appFuncInJson},this.setmultiSelect=function(t){this._appRulesParamInJson.multiSelection=t},this.getmultiSelect=function(){return this._appRulesParamInJson.multiSelection},this.setRulesMode=function(t){"optim"==t&&(t="RulesMode_ProposeOptimizedConfiguration"),"completeConfMode"==t&&(t="RulesMode_SelectCompleteConfiguration"),"dependencies"==t&&(t="RulesMode_EnforceRequiredOptions"),"incompatibilities"==t&&(t="RulesMode_DisableIncompatibleOptions"),this._appRulesParamInJson.rulesMode=t},this.getRulesMode=function(){return this._appRulesParamInJson.rulesMode},this.setRulesActivation=function(t){if("false"==t)for(var e in this.cacheIdWithState)"chosenInConflict"==this.cacheIdWithState[e]?this.cacheIdWithState[e]="chosen":"incompatibleFeature"==this.cacheIdWithState[e]&&(this.cacheIdWithState[e]="Unknown");this._appRulesParamInJson.rulesActivation=t},this.getRulesActivation=function(){return this._appRulesParamInJson.rulesActivation},this.setMustSelectFeatureNumber=function(t){this._mustSelectFeatureNumber=t},this.getMustSelectFeatureNumber=function(){return this._mustSelectFeatureNumber},this.getNodeSolver=function(){return this._nodeSolver},this.setNodeSolver=function(t){this._nodeSolver=t},this.setSolverId=function(t){this._solverId=t},this.getSolverId=function(){return this._solverId},this.setNodeSolverName=function(t){this._nodeSolverName=t},this.getNodeSolverName=function(){return this._nodeSolverName},this.getAttrVisibility=function(t,e){var i;"feature"==t?i=this._applicationStateInJson.featuresVisibleAttributes:"option"==t&&(i=this._applicationStateInJson.optionsVisibleAttributes);for(var n=0;n<i.length;n++)if(i[n]==e)return!0;return!1},this.setAttrVisibility=function(t,e,i){var n,s=!1,o=this._applicationStateInJson;if("feature"==t){for(n=0;n<o.featuresVisibleAttributes.length;n++)o.featuresVisibleAttributes[n]==e&&(s=!0,0==i&&o.featuresVisibleAttributes.splice(n,1));s||1!=i||(o.featuresVisibleAttributes[n]=e)}else if("option"==t){for(n=0;n<o.optionsVisibleAttributes.length;n++)o.optionsVisibleAttributes[n]==e&&(s=!0,0==i&&o.optionsVisibleAttributes.splice(n,1));s||1!=i||(o.optionsVisibleAttributes[n]=e)}this.setApplicationState(o)},this.getStateWithId=function(t){return this.cacheIdWithState[t]},this.setStateWithId=function(t,e){if("range"==e)return 0;for(var i=!1,n=0;n<this._configurationCriteriaInJson.length;n++)if(this._configurationCriteriaInJson[n].Id==t){this._configurationCriteriaInJson[n].State!=e&&this._onWinEnv&&this.isAnOption(this._configurationCriteriaInJson[n].Id)&&this._3dCounter++,this._configurationCriteriaInJson[n].State=e,i=!0;break}i||(this._configurationCriteriaInJson.push({Id:t,State:e}),this._3dCounter++),this.cacheIdWithState[t]=e},this.getKeyInValueById=function(t){return this.cacheKeyInValueById[t]},this.getDateKeyInDisplayValueById=function(t){return this.cacheDateKeyInDisplayValueById[t]},this.setKeyInValueById=function(t,e){var i=!1,n="available";e&&""!=e&&(n="chosen");for(var s=0;s<this._configurationCriteriaInJson.length;s++)if(this._configurationCriteriaInJson[s].Id==t){this._configurationCriteriaInJson[s].State=n,this._configurationCriteriaInJson[s].Value=e,i=!0;break}i||this._configurationCriteriaInJson.push({Id:t,State:n,Value:e}),this.cacheIdWithState[t]=n,this.cacheKeyInValueById[t]=e},this.setDateKeyInDisplayValueById=function(t,e){this.cacheDateKeyInDisplayValueById[t]=e},this.getPriceById=function(t){return this.cacheIdWithPrice[t]},this.setPriceById=function(t,e){this.cacheIdWithPrice[t]=e},this.getTotalPrice=function(){return this.totalPrice},this.setTotalPrice=function(t){this.totalPrice=t},this.stateInterpreter=function(t){for(var e=[],i=0;i<t.length;i++){var n=0==t[i].Id.indexOf("KeyIn_");this.isAnOption(t[i].Id)||n?("Chosen"==t[i].State?(t[i].State="chosen",n&&(t[i].Value=this.cacheKeyInValueById[t[i].Id])):"Default"==t[i].State?t[i].State="default":"Required"==t[i].State?t[i].State="required":"Selected"==t[i].State?t[i].State="recommanded":"Dismissed"==t[i].State?t[i].State="dismissed":"Incompatible"==t[i].State?t[i].State="incompatible":"Unselected"==t[i].State?t[i].State="available":"Unknown"==t[i].State&&(t[i].State="available"),"range"!=t[i].State?(this.cacheIdWithState[t[i].Id]=t[i].State,n&&t[i].Value&&(this.cacheKeyInValueById[t[i].Id]=t[i].Value,console.log("key in value "+t[i].Value))):e.push(i)):("Incompatible"==t[i].State?t[i].State="incompatibleFeature":"Required"==t[i].State?t[i].State="requiredFeature":t[i].State="Unknown","range"!=t[i].State?this.cacheIdWithState[t[i].Id]=t[i].State:e.push(i))}if(e.length>0){var s;s=t,t=[];for(i=0;i<s.length;i++)"range"!=s[i].State&&t.push(s[i])}return t},this.setAccordConfigurationFeature=function(t){this._accordConfigurationFeature=t},this.getAccordConfigurationFeature=function(){return this._accordConfigurationFeature},this.getEvolutionCriteria=function(){return this._evolutionCriteriaInJson},this.setEvolutionCriteria=function(t){this._evolutionCriteriaInJson=t},this.getProductStateTreeObj=function(){return this._productStateTreeObj},this.isAFeature=function(t){var e=this.getFeatureCache();if(null==e){e=new Object;for(var i=this.getDictionary().features,n=0;n<i.length;n++)e[i[n].ruleId]=!0;return this.setFeatureCache(e),null!=e[t]}return null!=e[t]},this.isAnOption=function(t){var e=this.getOptionCache();if(null==e){e=new Object;for(var i=this.getDictionary().features,n=0;n<i.length;n++)for(var s=0;s<i[n].options.length;s++)e[i[n].options[s].ruleId]=!0;return this.setOptionCache(e),null!=e[t]}return null!=e[t]},this.getOnWinEnv=function(){return this._onWinEnv},this.setOnWinEnv=function(t){this._onWinEnv=t},this.setProductStateTreeObj=function(t){this._productStateTreeObj=t},this.checkOptionsAndFeaturesPresenceInDictionary=function(e){for(var i=[],n=!1,s=0;s<e.length;s++)e[s].Id&&(this.isAFeature(e[s].Id)||this.isAnOption(e[s].Id)?i.push({Id:e[s].Id,State:e[s].State}):0==e[s].Id.indexOf("KeyIn_")&&this.isAFeature(e[s].Id.substring("KeyIn_".length))?i.push({Id:e[s].Id,State:e[s].State,Value:e[s].Value}):n=!0);if(n&&"view"==this.getAction()){var o=t.i18n("FeatureOptionInEffective");alert(o)}return i}}var i=null;return t.namespace("DS/ConfiguratorWebModel/ConfiguratorModel",function(){return null==i&&(i=new e),i})});