define("DS/3DWorkbook/js/models/WkbLangTranslatorDS",["UWA/Core","UWA/Class","DS/3DWorkbook/js/WkbUtils","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(t,e,s,r){"use strict";var a=null,n=null,i="",o="",l=null,c=function(e){return t.is(e.referencePID)?e.referencePID:e.physicalId};return e.extend({init:function(t){l=t.modelEvtManager,i=t.serverURL,o=t.securityContext,a=i+"resources/v1/modeler/dstrs/dstrs:Translation/locate",n=i+"resources/v1/modeler/dstrs/dstrs:Translation/bulkfetch?$mask=dstrs:TranslationMask.Details"},addTranslations:async function(e){var s=[];for(let r=0;r<e.length;r++){const a=e[r];t.is(a.physicalId)&&s.push(c(a))}var r=new Map,a=null,n=[];for(let t=0;t<s.length;t++){const e=s[t];a=await this.getLocationPIDs(e),r.set(e,a),n=n.concat(a)}var i=await this.getTranslationsMap(n);return this.processTranslations(e,i)},_translateObjectAttributes:function(e,s){return Object.keys(s).forEach(r=>{t.is(e[r])&&(e[r]=s[r].translation),"title"===r&&t.is(e.displayName)&&(e.displayName=s[r].translation)}),e},_translateConfiguredAttributes:function(e,s){const r=e.attributeMetaList;return!t.is(r)||r.length<1?e:(Object.keys(s).forEach(t=>{const a=r.indexOf(t);a>-1&&(e.attributeValues[a]=s[t].translation)}),e)},processTranslations:function(e,s){var r=[];return e.forEach(e=>{const a=s.get(c(e));if(t.is(a)){var n=this._translateObjectAttributes(e,a);n=this._translateConfiguredAttributes(n,a),r.push(n)}else r.push(e)}),r},getLocationPIDs:async function(t){var e=null,n=[],i=this._getLocatorPayload(t);try{e=await s.serverRequestPromise(a,"json","POST",i,s.getPrefixedSecurityContext()),n=this._extractLocationPIDs(e)}catch(t){l.publish({event:"wkbNotify",data:{src:"WkbLangTranslatorDS",title:r.ErrorTitle,subtitle:r.ErrLocateTranslations,message:t.message,isVanishes:!1,type:"error"}})}return n},getTranslationsMap:async function(e){var s=new Map;if(e.length<1)return s;var r=await this.getTranslationData(e);return!t.is(r)||!t.is(r.member)||r.member.length<1?s:(r.member.forEach(e=>{!t.is(e.translationDetails)||e.translationDetails.objectReferences.length<1||s.set(e.translationDetails.objectReferences[0].identifier,e.translationDetails.objectReferences[0].attributes)}),s)},getTranslationData:async function(t){var e=null;const a=JSON.stringify(t);try{e=await s.serverRequestPromise(n,"json","POST",a,o)}catch(t){l.publish({event:"wkbNotify",data:{src:"WkbLangTranslatorDS",title:r.ErrorTitle,subtitle:r.ErrFetchTranslations,message:t.message,isVanishes:!1,type:"error"}})}return e},_getLocatorPayload:function(t){var e={objectReferences:[{identifier:t}],languageIds:[widget.getValue("wkbTranslatorLanguage")]};return JSON.stringify(e)},_extractLocationPIDs:function(e){var s=[];return t.is(e)&&e.totalItems>0&&e.member[0]["dstrs:Translation"].totalItems>0?(e.member.forEach(t=>{s.push(t["dstrs:Translation"].member[0].id)}),s):s}})});