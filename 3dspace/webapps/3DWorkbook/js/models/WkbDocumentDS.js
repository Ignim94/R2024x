define("DS/3DWorkbook/js/models/WkbDocumentDS",["UWA/Core","UWA/Class","UWA/Promise","DS/3DWorkbook/js/models/WkbDataStore","DS/3DWorkbook/js/models/WkbDocument","DS/3DWorkbook/js/WkbUtils","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(e,t,n,r,o,s,i){"use strict";var a=null,c=null;function u(e){console.log(e);var t="";widget.Debug.debugMode&&(t=e.message),a.publish({event:"wkbNotify",data:{src:"WkbDocumentDS",title:i.ErrorTitle,subtitle:i.ErrDocListWebService,message:t,isVanishes:!1,type:"error"}})}return t.extend({init:function(e,t){a=e,c=t},_getWkbDocuments:async function(e,t){var r=this,o=new Map,i=[];const a=t+"resources/v1/modeler/documents/?$fields=none,name,title,description,revision";return new n(async function(t,n){e.forEach(e=>{var t=e.identifier;i.push(t)});var c=i.toString();let u=await s.serverRequestPromise(a,"application/json","POST","$ids="+c,null,null,"application/x-www-form-urlencoded");if(0===(u=JSON.parse(u)).items)return void t(o);t(r._transformToDocumentsArray(u.data))}).catch(function(e){u(e)})},getSystemDocuments:async function(t,o){var s=this,i=new Map;return new n(async function(n,a){var c=r.getSystemDocuments();if(e.is(c)&&c.length>0){const e=await s._getWkbDocuments(c,o);i.set(t,e)}n(i)}).catch(function(e){u(e)})},getOperationDocuments:async function(t,o){var s=this,i=new Map;return new n(async function(n,a){var c=r.getOperationDocuments(t);if(e.is(c)&&c.length>0){const e=await s._getWkbDocuments(c,o);i.set(t,e)}n(i)}).catch(function(e){u(e)})},getWkiItemDocuments:async function(t,o,s){var i=this,a=0,c=new Map;return new n(async function(n,u){for(var l=null;a<t.length;a++){const n=t[a];if(l=r.getWkiItemDocuments(n,o),e.is(l)&&l.length>0){const e=await i._getWkbDocuments(l,s);c.set(n,e)}}n(c)}).catch(function(e){u(e)})},getDocumentURL:async function(t){var n=null;try{n=await s.getCsrfToken()}catch(e){return this._csrfWebServiceError(e),null}try{const e=c+"resources/v1/modeler/documents/"+encodeURIComponent(t)+"/files/DownloadTicket";var r=await s.serverRequestPromise(e,"json","PUT",null,null,n.csrf.value)}catch(e){return this._onGetDocumentUrlError(e),null}return e.is(r.data[0].dataelements)&&e.is(r.data[0].dataelements.ticketURL)?r.data[0].dataelements.ticketURL:null},_csrfWebServiceError:function(t,n){e.is(n)&&console.log(n);var r="";widget.Debug.debugMode&&(r=t.message),a.publish({event:"wkbNotify",data:{src:"wkbDetails",title:i.ErrorTitle,subtitle:i.ErrCSRFWebService,message:r,isVanishes:!1,type:"error"}})},_onGetDocumentUrlError:function(e){var t="";widget.Debug.debugMode&&(t=e.message),a.publish({event:"wkbNotify",data:{src:"wkbDetails",title:i.ErrorTitle,subtitle:i.ErrDownloadTicketWebService,message:t,isVanishes:!1,type:"error"}})},_transformToDocumentsArray:function(e){var t=[];return e.forEach(e=>{var n=new o;n.loadWithDataStore(e),t.push(n)}),t}})});