define("DS/3DWorkbook/js/WkbPreferences",["UWA/Core","UWA/Class","DS/3DWorkbook/js/WkbUtils","DS/3DWorkbook/js/models/WkbUtilityDS","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(e,a,l,t,r){"use strict";var n=null;function o(a){return e.is(a)&&e.is(a.collabspace)&&e.is(a.role)&&e.is(a.organization)?a.role.name+"."+a.organization.name+"."+a.collabspace.name:""}function i(a){var l={securityContexts:[],displayOrganization:!1};if(!e.is(a,"array")||0===a.length)return l;var t=null;for(var r of a)if(e.is(r.couples,"array")&&0!==r.couples.length)for(var n of r.couples){t||(t=n.organization.title);var o={};o.organizationTitle=n.organization.title,o.organizationName=n.organization.name,o.roleName=n.role.name,o.roleNLS=n.role.nls,o.securityName=r.name,o.organizationTitle!==t&&(l.displayOrganization=!0),l.securityContexts.push(o)}return l}return a.extend({init:function(){return this.load3DSpaceURL(),this},load3DSpaceURL:function(){var e=this;l.get3DSpaceURL(function(a){n=a,e.loadUserRoles().then(function(){e.loadLanguages().then(function(){l.updateWidgetTranslatorSetting()})})})},loadPreferences:async function(){widget.addPreference({name:"collabSpace",type:"list",label:r.PrefUserRoleLbl,options:[]}),widget.addPreference({name:"resType",type:"list",defaultValue:"linked",label:r.PrefResourceTypeLbl,options:[{label:r.PrefResourceTypeLinked,value:"linked"},{label:r.PrefResourceTypeCapable,value:"capable"}]}),widget.addPreference({name:"showOrientationViewer",type:"boolean",label:r.PrefShowOrientationView,defaultValue:!1,options:[]}),widget.addPreference({name:"defaultViewType",type:"list",defaultValue:"2D",label:r.PrefDefaultViewType,options:[{label:r.Pref2DView,value:"2D"},{label:r.Pref3DView,value:"3D"}]}),widget.addPreference({name:"searchFor",type:"list",defaultValue:"process",label:r.PrefSearchForLbl,options:[{label:r.PrefSearchProcess,value:"process"},{label:r.PrefSearchOperation,value:"operation"}]}),widget.addPreference({name:"publishedDataCheck",type:"boolean",label:r.PrefPublishedCheckLbl,defaultValue:!1,options:[]}),widget.addPreference({name:"loadLevel",type:"list",defaultValue:"system",label:r.PrefLoadLevelLbl,options:[{label:r.PrefSystem,value:"system"},{label:r.PrefFirstOperation,value:"firstoperation"}]}),widget.addPreference({name:"volumeOffset",type:"text",label:r.PrefVolumeOffsetLbl,defaultValue:"50"}),widget.addPreference({name:"volumeFilterCheck",type:"boolean",label:r.PrefVolumeFilterCheckLbl,defaultValue:!1,options:[]}),widget.addPreference({name:"hide2DMagnifierBar",type:"boolean",label:r.PrefHide2DMagnifierLbl,defaultValue:!1,options:[]}),widget.addPreference({name:"requestTimeout",type:"text",label:r.PrefRequestTimeoutLbl,defaultValue:"50000"}),widget.addPreference({name:"maxMruItems",type:"range",label:r.PrefMaxMruItemsLbl,step:"1",min:"1",max:"24",defaultValue:"12"}),widget.addPreference({name:"mruList",type:"hidden",defaultValue:"[]"});const e=[{label:r.PrefLangDefault,value:""}];widget.addPreference({name:"wkbTranslatorLanguage",type:"list",label:r.PrefLangTranslatorLbl,options:e,defaultValue:""})},loadLanguages:async function(e){var a=new t({ematrixURL:n,modelEvtManager:null}),l=await a.getLanguagesListPreferenceOptions();const o={label:r.PrefLangDefault,value:""};l.unshift(o),widget.addPreference({name:"wkbTranslatorLanguage",type:"list",label:r.PrefLangTranslatorLbl,options:l,defaultValue:""})},loadUserRoles:async function(){var a,t=n+"resources/modeler/pno/person?current=true&select=collabspaces&select=preferredcredentials";try{var s=await l.serverRequestPromise(t,"json","GET")}catch(l){console.log("Error in loading user roles"),e.is(a)&&console.log(a)}!function(a){var l=o(a.preferredcredentials),t=i(a.collabspaces),n=widget.getValue("collabSpace");e.is(n)||(n="");var s=!1,u="",d={name:"collabSpace",label:r.PrefUserRoleLbl,type:"list",options:[]},c=[];for(var f of t.securityContexts)c.push(`${f.securityName}●${f.organizationTitle}●${f.roleNLS}●${f.roleName}●${f.organizationName}`);c.length>0&&c.sort();for(var p of c){var b=p.split("●"),g=`${b[3]}.${b[4]}.${b[0]}`,m=`${b[0]} ● ${b[1]} ● ${b[2]}`;t.displayOrganization||(m=`${b[0]} ● ${b[2]}`),d.options.push({label:m,value:g}),n===g&&(s=!0),l===g&&(u=g)}widget.addPreference(d),!1===s&&u.length>0?(widget.setValue("collabSpace",u),n=u):!1===s&&widget.setValue("collabSpace","")}(s)},testFunction:function(e,a){switch(e){case"getPreferredSecurityContext":return o(a);case"getSecurityContextList":return i(a)}}})});