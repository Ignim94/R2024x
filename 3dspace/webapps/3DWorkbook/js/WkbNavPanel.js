define("DS/3DWorkbook/js/WkbNavPanel",["UWA/Core","DS/3DWorkbook/js/WkbUtils","DS/CoreEvents/ModelEvents","DS/Controls/ResponsiveTileView","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/DELMOMWKIExperience/js/WkiStreamUtil","DS/DELMOMWKIExperience/js/IndexFileParser","DS/3DWorkbook/js/models/WkbDataStore","DS/3DWorkbook/js/WkbWidgetCom","css!DS/3DWorkbook/css/WkbNavPanel.css","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(e,t,n,i,a,s,l,o,r,c,d,u,p,v){"use strict";var h,b,g,m,f,D,y,k=null,S=null,w="",I=null,O=null,E=[],j=!1,N=null,L=function(i){D=i.modelEvtManager||new n,h=i.ematrixURL,w=i.systemPhysicalId,S=i.system,g=0;var a=null;if(a=D.subscribe({event:"wkbHeader-SelectOrder"},_),E.push(a),a=D.subscribe({event:"wkbHeader-SelectOper"},U),E.push(a),a=D.subscribe({event:"wkbNavPanel-resize"},K),E.push(a),a=D.subscribe({event:"ManualOperSelect-WkbNavPanel"},q),E.push(a),a=D.subscribe({event:"ShowSubOps-WkbNavPanel"},T),E.push(a),a=D.subscribe({event:"NavBackToMainList-WkbNavPanel"},P),E.push(a),e.is(i.wkiStreamUtil))y=i.wkiStreamUtil;else{var s={serverURL:h,securityContext:widget.getValue("collabSpace"),PID:w,serverRequestTimeoutMS:t.serverRequestTimeoutMS,modelEvtManager:D};y=new r(s)}return this.setContainer(),this.testFunction=A,this.wkiStreamUtil=y,this};function T(t){widget.Debug.log("navSelected"),e.is(t.children)&&0!==t.children.length?(O=t,g=1,R(),C(t.children)):widget.Debug.log("navSelected - no subops")}function P(){widget.Debug.log("navBackToMainList"),g=0,R(),C(b),I=null,O=null,D.publish({event:"wkbNav-ShowMainList",data:{}})}function M(t,n,i){widget.Debug.log("************** addImageToTile: "+i.displayName);e.is(n)&&n.length>0?y.getImageUrl(n,function(n){widget.Debug.log("************** addImageToTile: Images retrieved"+n),e.is(n)?t.picture=n:W(t)},i.physicalId):W(t)}function W(e){widget.Debug.log("************** getDefaultImage: add default thumbnail to tile"),e.picture=h+"webapps/3DWorkbook/assets/images/defaultthumbnails/MOM-OperationDefault.png"}function C(t){var n=null,a=null,s=f.getElement(".navListDiv");null!==s&&s.parentNode.removeChild(s),$(s=e.createElement("div",{id:"navListDiv",class:"navListDiv"}));y.cacheStream(function(){t.forEach(function(t){var l=t.description,o=t.displayName+"  ("+v.OperRevLbl+"."+t.version+")",r=v.OperMaturityLbl+t.status;e.is(t.children)&&t.children.length>0?(n=[" "],a=function(){T(t)}):(n=null,a=null);var d=new i({tileWidth:290,title:o,multipleTitleLineNumber:!1,subtitle:r,description:l,statusbarIcons:[],contextualMenu:n,onContextMenuBuildCallback:a}),u=c.getOperationThumbnail(t.id,t.instancePhysicalId);M(d,u,t),d.elements.maincontent.parentElement.onclick=function(){H(t,d)},d.elements.description.style.height="26px",I===t&&(d.highlight(),k=d);const p=d.getContent();p.style.width=null,p.tabIndex=0,d.inject(s)}),s.inject(f),m=new l({element:s}).inject(f),D.publish({event:"wkbNav-OperListPopulated",data:{operations:t}}),s.setStyle("outline","none"),s.tabIndex=-1,s.focus()})}function _(e){widget.Debug.log("selectionChangedOrder"),g=0,I=null,R(),b&&C(b)}function x(e){widget.Debug.log("changeOperation"),g=1,O=null,R(),I=e,C(b),u.publishOperationSelected(e)}function U(t){for(var n={},i=0;i<b.length;i+=1)if(n=b[i],e.is(t.object_data.physicalId)){if(n.physicalId===t.object_data.physicalId){x(n);break}}else if(n.instanceName===t.object_data.instanceName){x(n);break}}function F(e){var t=e.dsModel;D.publish({event:"wkbMain-ShowProcessFlow",data:{object_data:{systemPID:w},target:t}})}function R(){var t=f.getElement(".navHeaderDiv");null!==t&&t.parentNode.removeChild(t),t=e.createElement("div",{id:"navHeaderDiv",class:"navHeaderDiv"});var n=e.createElement("div",{id:"navOpSeqBtn",class:"navOpSeqBtn"});n.inject(t),(N=new a({icon:h+"webapps/3DWorkbook/assets/images/defaultthumbnails/I_GraphProductFlow.png",displayStyle:"icon"}).inject(n)).tooltipInfos=new s({title:v.ShowProcessFlowToolTipTitle,shortHelp:v.ShowProcessFlowToolTip,longHelp:v.ShowProcessFlowToolTipLong}),N.addEventListener("buttonclick",F);var i=e.createElement("div",{class:"navHeaderChevron fonticon fonticon-open-left "}).inject(t);0===g||1===g&&null===O?(j?e.createElement("p",{html:v.OperationsLblFltd}).inject(t):e.createElement("p",{html:v.OperationsLbl}).inject(t),i.style.display="none"):(e.createElement("p",{html:O.displayName}).inject(t),i.onclick=P),t.inject(f)}function H(t,n){t!==I&&(I||(g=1),"SYSTEM"===(I=t).parentType&&(g=1),"OPERATION"===I.parentType&&(g=2),e.is(k)&&k.unhighlight(),e.is(n)&&(n.highlight(),k=n),u.publishOperationSelected(t),d.setCurrentOperation(t.physicalId),D.publish({event:"wkbNav-SelectOper",data:{object_data:t,level:g,parent:O}}))}function B(e,t,n){widget.Debug.log("manualChangeOperation"),g=1,R(),I=e,C(t),I=null,function(e,t){e.displayParts=t.object_data.displayParts,e.displayResources=t.object_data.displayResources,e.displayDocuments=t.object_data.displayDocuments,e.display0DInst=t.object_data.display0DInst}(e,n),H(e,k),function(e){e.displayParts=void 0,e.displayResources=void 0,e.displayDocuments=void 0,e.display0DInst=void 0}(e)}function q(t){let n=!1,i=!1,a=!1,s=!1,l=!1;const o=t.object_data.physicalId,r=t.object_data.id,c=t.object_data.instanceName,d=t.object_data.referenceName;if(e.is(o,"string")&&o.length>0)n=!0;else if(e.is(r,"string")&&r.length>0)e.is(c,"string")&&c.length>0?l=!0:i=!0;else if(e.is(c,"string")&&c.length>0)a=!0;else{if(!(e.is(d,"string")&&d.length>0))return;s=!0}for(let u=0;u<b.length;u+=1){const p=b[u];if(n&&p.physicalId===o||l&&p.id===r&&p.instanceName===c||i&&p.id===r||a&&p.instanceName===c||s&&p.displayName===d)return void B(p,b,t);if(e.is(p.children))for(let e=0;e<p.children.length;e+=1){const u=p.children[e];if(n&&u.physicalId===o||l&&p.id===r&&p.instanceName===c||i&&u.id===r||a&&u.instanceName===c||s&&u.displayName===d)return O=p,void B(u,p.children,t)}}if(l)u.publishLoadError(`Operation not found, refName = ${r} + ' InstName= ' + ${c}`);else{const e=n?o:i?r:c||d;u.publishLoadError(`Operation not found, id = ${e}`)}}function K(t){if(e.is(f)){var n=f.getElement(".navListDiv");e.is(n)&&$(n)}}function $(e){var t=f.offsetHeight-38-5;e.setStyle("height",t+"px");var n=f.offsetWidth-13;e.setStyle("width",n+"px")}function A(e,t,n,i){switch(e){case"createList":return C(t);case"addImageToTile":return M(t,n,i)}}return L.prototype={loadOperations:async function(){if(e.is(w)&&w.length>0){var t=f.getElement(".navListDiv");null!==t&&o.mask(t);var n=await d.getOperations();(j=e.is(S.headerOperationPhysicalId))&&(n=[n.find(e=>e.physicalId===S.headerOperationPhysicalId)]),function(t){if(widget.Debug.log("processOperations"),e.is(t)){(b=t).length&&(R(),C(b),D.publish({event:"wkbNav-SystemLoaded",data:{object_type:"SYSTEM",object_data:b[0]}}));var n=f.getElement(".navListDiv");null!==n&&o.unmask(n),I=null}}(n)}},setContainer:function(){var t=e.createElement("div",{id:"navPanelDiv",class:"navPanelDiv"});e.createElement("div",{id:"navListDiv",class:"navListDiv"}).inject(t),f=t},getContainer:function(){return f},dispose:function(){e.is(N)&&(N.removeEventListener("buttonclick",F),N.destroy(),N=null),e.is(m)&&(m.destroy(),m=null),e.is(y)&&y.dispose&&y.dispose(),y=null,E.forEach(function(e){D.unsubscribe(e)}),E=[],f.testFunction=null,f.dispose=null,f.destroy()},getSystemPID:function(){return w},selectOperation:function(e){q(e)},selectFirstOperation:function(){var t;t=document.getElementById("navListDiv").getChildren(),e.is(t)&&t.length>0&&t[0].getChildren()[0].click()}},L});