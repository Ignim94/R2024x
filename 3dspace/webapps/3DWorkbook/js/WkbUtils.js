define("DS/3DWorkbook/js/WkbUtils",["UWA/Core","UWA/Class","DS/WAFData/WAFData","UWA/Promise","DS/3DWorkbook/js/WkbHighlightUtil","DS/3DWorkbook/js/models/WkbMRUList","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,n,i,r,a,s){"use strict";return t.singleton({init:function(e){this.graphicsMode={Graphics2D:0,Graphics3D:1,Both:2,Graphics3DB:3},this.ematrixURL=null,this.highlightUtil=r,this.tenant=this.getTenant(),this.serverRequestTimeoutMS=5e4,this.isOrientation2DPanelStateOpen=null},getMapMode:function(e){return e.getElementsByTagName("DELWKIPublishMappingRoot")[0].getAttribute("mode")},setServerRequestTimeout:function(e){e=parseInt(e),isNaN(e)?this.serverRequestTimeoutMS=5e4:this.serverRequestTimeoutMS=parseInt(e)},getServerConfig:function(){return{ematrixURL:this.ematrixURL,serverURL:this.ematrixURL,securityContext:this.getSecurityContext()}},getTenant:function(){if(e.is(widget)&&e.is(widget.getValue)){var t=widget.getValue("x3dPlatformId");return e.is(t)&&t.length>0?this.tenant=t:(widget.setValue("x3dPlatformId","OnPremise"),this.tenant="OnPremise"),this.tenant}this.tenant="OnPremise"},isOnCloudPlatform:function(){return"OnPremise"!==widget.getValue("x3dPlatformId")},getPrefixedSecurityContext:function(){var t=widget.getValue("collabSpace");return e.is(t)&&(t="ctx::"+t),t},getDataTimeNow:function(){return(new Date).toLocaleString()},createAndAppend:function(t,n,i,r){var a={};i&&(a.class=i),r&&(a.id=r);var s=e.createElement(n,a);return t.appendChild(s),s},getSecurityContext:function(){return widget.getValue("collabSpace")},callServerRequest:function(t,i,r,a,s,o,u,l,c){e.is(c)||(c=this.getSecurityContext()),void 0===c&&(c=null);var g={Accept:"application/json, text/plain, application/octet-stream",SecurityContext:c};e.is(u)&&(g["Content-Type"]=u),e.is(l)&&(g.ENO_CSRF_TOKEN=l);var h={method:s,type:a,data:o,cache:-1,headers:g,timeout:this.serverRequestTimeoutMS,onComplete:i,onFailure:r||function(t){e.log("Error")}},f=(new Date).getTime();t.includes("?")?t+=`&tenant=${this.tenant}&timestamp=${f}`:t+=`?tenant=${this.tenant}&timestamp=${f}`,n.authenticatedRequest(t,h)},serverRequestPromise:function(t,n,r,a,s,o,u){var l=this;return new i(function(i,c){e.is(u)&&0!==u.length||(u="application/json"),l.callServerRequest(t,function(e){i(e)},function(e){c(e)},n,r,a,u,o,s)})},getServerData:function(e,t,n,i){this.callServerRequest(e,t,n,i,"GET","")},postServerData:function(e,t,n,i){this.callServerRequest(e,t,n,"json","POST",i)},putServerData:function(e,t,n,i,r){this.callServerRequest(e,t,n,"json","PUT",i,"",r)},getCsrfToken:async function(){var e=this.ematrixURL+"resources/v1/application/CSRF";return await this.serverRequestPromise(e,"json","GET","",this.getSecurityContext())},getPreferenceValue:function(e,t){var n;for(n=0;n<e.length;++n)if(e[n].name===t)return e[n].value;return""},getPrefBoolValue:function(t,n){var i;for(i=0;i<t.length;++i)if(t[i].name===n)return"boolean"==typeof t[i].value?t[i].value:!(!e.is(t[i].value)||"TRUE"!==t[i].value.toUpperCase());return!1},getAlertMessageBody:function(e){var t;window.DOMParser?t=(new DOMParser).parseFromString(e,"text/html"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t.body.innerHTML},getHighlightIdByExternalPath:function(t,n){var i=null,r="",a="Connected"===this.getMapMode(n);return t.length>0&&a?(i=this.highlightUtil.getPartPhysicalId(t,n),e.is(i)&&(r=i),r):""},getInstancePath:function(t,n){var i=[];if(e.is(n)&&""!==n){if(!("Connected"===this.getMapMode(n)))return[];i=this.highlightUtil.getInstancePath(t,n),e.is(i)||(i=[])}return i},updateWidgetTranslatorSetting:function(){var t=widget.getValue("wkbTranslatorLanguage");e.is(t)&&t.length>0?widget.wkbIsLanguageTranslation=!0:widget.wkbIsLanguageTranslation=!1},get3DSpaceURL:function(t){var n=this;if(e.is(this.servicesInfos))n.ematrixURL=n.servicesInfos["3DSpace"]+"/",t(n.ematrixURL);else{var i=widget.getValue("x3dPlatformId");s.getPlatformServices({platformId:i,onComplete:function(i){e.is(i,"array")&&(i=i[0]),this.servicesInfos=i,n.ematrixURL=i["3DSpace"]+"/",t(n.ematrixURL)},onFailure:function(){n.ematrixURL="",t("")}})}},fadeInOutImage:async function(t,n,i){var r=0,a=function(){var e=Number(window.getComputedStyle(t).getPropertyValue("opacity"));e<1?(e+=.1,t.style.opacity=e):clearInterval(r)};t.style.opacity=1,r=setInterval(function(){var s=Number(window.getComputedStyle(t).getPropertyValue("opacity"));s>0?(s-=.1,t.style.opacity=s):(clearInterval(r),t.style.background="url("+n+") no-repeat 50% 50%",e.is(i)&&i.length>0&&(t.style.backgroundSize=i),r=setInterval(a,20))},20)},updateMRUList:function(e){(new a).updateWithSystem(e,this.ematrixURL)},updateMRUListItem:function(e){(new a).update(e)},parseModifiedDate:function(t){var n=null,i=null;return"Z"===t.charAt(t.length-1)?t:(t.indexOf(":GMT")>0?i=":GMT":t.indexOf("GMT")>0&&(i="GMT"),e.is(i)?("Z"!==(n=t.replace(i,"")).charAt(n.length-1)&&(n+="Z"),n):t)}})});