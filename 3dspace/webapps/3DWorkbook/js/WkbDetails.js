define("DS/3DWorkbook/js/WkbDetails",["UWA/Core","UWA/Class","UWA/Promise","DS/CoreEvents/ModelEvents","DS/3DWorkbook/js/WkbUtils","DS/Utilities/KeyboardUtils","DS/3DWorkbook/js/models/WkbDataStore","DS/3DWorkbook/js/models/WkbDetailsModel","DS/3DWorkbook/js/models/WkbPartDS","DS/3DWorkbook/js/models/WkbToolDS","DS/3DWorkbook/js/models/WkbDocumentDS","DS/3DWorkbook/js/models/WkbAttributeConfig","DS/DELMOMWKIExperience/js/WkiContentJsonParser","DS/DELMOMWKIExperience/js/DmuMarkerMappingParser","DS/3DWorkbook/js/views/WkbDetailsView","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(e,t,i,n,s,o,l,a,r,c,u,d,h,g,b,f){"use strict";var p,w="ibInstructions",D="ibParts",I="ibTools",k="ibDocuments",v=!1,m=!1,y=!1,T=!1;let S=!1;var C,E,L,P,M,W=!1,V=!0,R=!0,H=!0,O=!0,U=!0,B=!0,A=!1,j=!1;let K=!1;var x=null,F=!0,N=null,G=0,$=null,_=null,z=null,q=null,J=null,Q=[],X=!1,Y=null,Z=null,ee=[];let te=null,ie=!1,ne=!1,se=!0,oe=!0,le=!0,ae=!0;var re=null,ce=null,ue=null,de=null,he=null,ge=null,be=null,fe=null,pe=null,we=null,De=null,Ie=null,ke=null,ve=null;function me(t,i){Se(),e.is(i)&&console.log(i);var n="";widget.Debug.debugMode&&(n=t.message),p.publish({event:"wkbNotify",data:{src:"wkbDetails",title:f.ErrorTitle,subtitle:f.ErrDownloadTicketWebService,message:n,isVanishes:!1,type:"error"}})}function ye(e){var t=P+"resources/v1/modeler/documents/"+encodeURIComponent(E)+"/files/DownloadTicket";s.putServerData(t,Te,me,"",e.csrf.value)}function Te(t){if(C){if(e.is(x)||(x=window.open("","_blank")),!e.is(x))return;var i=null;switch(t.data[0].dataelements.fileName.split(".").pop().toLowerCase()){case"mp4":i=' type="video/mp4" />'}if(e.is(i)){var n='<video controls autoplay muted name="media"><source src="';n+=t.data[0].dataelements.ticketURL+'" ',n+=i,n+="</video>",x.document.body.innerHTML=n}else x.location.href=t.data[0].dataelements.ticketURL,x.focus();x=null,C=!1}}function Se(){C&&(C=!1,x=null)}function Ce(t,i){Se(),e.is(i)&&console.log(i);var n="";widget.Debug.debugMode&&(n=t.message),p.publish({event:"wkbNotify",data:{src:"wkbDetails",title:f.ErrorTitle,subtitle:f.ErrCSRFWebService,message:n,isVanishes:!1,type:"error"}})}function Ee(e){C=!0,E=e;var t=P+"resources/v1/application/CSRF";s.getServerData(t,ye,Ce,"json")}function Le(t){(se=e.is(t.displayParts)?t.displayParts:se)?(!function(e,t){widget.Debug.log("************** getPartsData");var i=performance.now(),n=widget.getValue("collabSpace");new r(p).getPartsData([e.instancePhysicalId],P,n).then(function(e){var n=performance.now();widget.Debug.log(`************** Time for WkbDetails.getPartsData: ${(n-i)/1e3} seconds.`),t(e)},function(e){console.log(e)})}(t,Ue),De.showIcon("ibParts"),De.setIconbarDividerWidth()):(V=!0,De.hideIcon("ibParts"),De.setIconbarDividerWidth())}function Pe(e){if(widget.Debug.log("************** getToolsData for operation"),"capable"===s.getPreferenceValue(L,"resType")){new c(p,P).getOperationCapableToolsEx(e).then(function(e){Ae(e)},function(e){Fe(e)})}else!function(e,t){widget.Debug.log("************** getIndexToolsData");var i=performance.now(),n=widget.getValue("collabSpace");new c(p,P).getToolsData(e,n).then(function(e){var n=performance.now();widget.Debug.log(`************** Time for WkbDetails.getIndexToolsData: ${(n-i)/1e3} seconds.`),t(e)},function(e){console.log(e)})}(e.instancePhysicalId,Ae)}function Me(t){if(!e.is(t.displayResources)||e.is(t.displayResources)&&!0===t.displayResources){"capable"===s.getPreferenceValue(L,"resType")?function(e){U=!1,widget.Debug.log("************** getToolsData for system"),new c(p,P).getSystemCapableTools(e.systemPhysicalId).then(function(e){at(e)},function(e){Fe(e)})}(t):(U=!0,Ie.disableIcon(I))}else U=!0,Ie.hideIcon(I)}function We(t){(le=e.is(t.displayDocuments)?t.displayDocuments:le)?(!function(e,t){widget.Debug.log("************** getOperationDocuments");var i=performance.now();new u(p).getOperationDocuments(e,P).then(function(n){var s=performance.now();widget.Debug.log(`************** Time for WkbDetails.getOperationDocuments: ${(s-i)/1e3} seconds.`),t(n,e)},function(e){console.log(e)})}(t.physicalId,Ke),De.showIcon("ibDocuments"),De.setIconbarDividerWidth()):(O=!0,De.hideIcon("ibDocuments"),De.setIconbarDividerWidth())}function Ve(t){(ae=e.is(t.display0DInst)?t.display0DInst:ae)?(!function(e,t,i){widget.Debug.log("************** getWkiIndexData");var n=performance.now();de.getWkiIndexData([t,e]).then(function(e){var t=performance.now();widget.Debug.log(`************** Time for WkbDetails.getWkiIndexData: ${(t-n)/1e3} seconds.`),i(e)},function(e){console.log(e)})}(t.physicalId,t.instancePhysicalId,je),De.showIcon("ibInstructions"),De.setIconbarDividerWidth()):(R=!0,De.hideIcon("ibInstructions"),De.setIconbarDividerWidth())}function Re(){var e,t;R&&V&&H&&O&&(pe.redrawTabBar(),m=!1,e=!1,t=!0,e=De.isIconEnabled(w),t=De.isIconVisible(w),e&&t?(De.highlightIcon(w),Qe(null,De.getItem(w))):(e=De.isIconEnabled(D),t=De.isIconVisible(D),e&&t?(De.highlightIcon(D),$e(null,De.getItem(D))):(e=De.isIconEnabled(I),t=De.isIconVisible(I),e&&t?(De.highlightIcon(I),ze(null,De.getItem(I))):(e=De.isIconEnabled(k),t=De.isIconVisible(k),e&&t&&(De.highlightIcon(k),_e(null,De.getItem(k)))))),l.getSystem().then(function(e){e.isForDelmiaViewer&&ut({}),he.unmask()}))}function He(e,t,i){t?i.enableIcon(e):i.disableIcon(e)}async function Oe(e){for(var t=e,i=new r(p),n=0;n<t.length;n++){const e=t[n];if("CreateKit"===e.type||"DetailedFasten"===e.type){var s=await i.getMfgKitChildParts(e.referencePID,P);s.length>0&&(t[n].children=s)}}return t}async function Ue(t){e.is(t)||(t=[]);var i=await Oe(t);J&&new r(p).addHighlightId(i,J);var n=i.length>0||e.is(_.children)&&_.children.length>0;n&&ge.loadPartCards(i),He(D,n,De),V=!0,Re(),z=i,widget.Debug.log("************** Finished Getting Parts")}async function Be(t){e.is(t)||(t=[]);var i=await Oe(t);be.loadPartCards(i),y=!1,T=!0,be.addHighlightingData(J),be.show(),he.unmask()}function Ae(t){if(e.is(t)||(t=[]),J){var i=new c(p);i.addHighlightId(t,J);for(var n=0;n<t.length;n++)e.is(t[n].children)&&i.addHighlightId(t[n].children,J)}Z=t,fe.loadCards(t);var s=t.length>0;He(I,s,De),H=!0,Re(),widget.Debug.log("************** Finished Getting Tools")}function je(e){ue.loadCards(e);var t=e.length>0;He(w,t,De),R=!0,Re(),q=e,widget.Debug.log("************** Finished Getting WkiData")}function Ke(t,i){var n=[];e.is(t)&&t.size>0&&e.is(i)&&(n=t.get(i)),we.loadDocumentCards(n);var s=n.length>0;He(k,s,De),O=!0,Re(),widget.Debug.log("************** Finished Getting Documents")}function xe(){V=!0,R=!0,H=!0,O=!0,Re(),he.unmask()}function Fe(t,i){console.log(t),e.is(i)&&console.log(i),setTimeout(xe,500)}function Ne(t){var i=performance.now(),n=t.physicalId;T=!1,_=t,V&&R&&H&&O&&n.length>0&&(V=!1,R=!1,H=!1,O=!1,e.is(t.children)&&t.children.length>0?(W=!0,pe.selectCurrentTab()):(W=!1,pe.hide()),Le(t),function(t){(oe=e.is(t.displayResources)?t.displayResources:oe)?(Pe(t),De.showIcon("ibTools"),De.setIconbarDividerWidth()):(H=!0,De.hideIcon("ibTools"),De.setIconbarDividerWidth())}(t),We(t),Ve(t),Re());var s=performance.now();widget.Debug.log(`************** Time for WkbDetails.loadOperDetail: ${(s-i)/1e3} seconds.`)}var Ge=function(){F?(ve.hide(),ke.hide()):(pe.hide(),e.is(be)&&be.hide(),ue.hide(),ge.hide(),fe.hide(),we.hide())};function $e(e,t){Ge(),W?(pe.show(),pe.isCurrentTabSelected()?ge.show():be.show()):ge.show(),De.updateActiveIcon(t)}function _e(e,t){Ge(),we.show(),De.updateActiveIcon(t)}function ze(e,t){Ge(),fe.show(),De.updateActiveIcon(t)}function qe(e,t){Ge(),ke.show(),Ie.updateActiveIcon(t)}function Je(e,t){Ge(),ve.show(),Ie.updateActiveIcon(t)}function Qe(t,i){Ge(),ue.show(),e.is(i)||(i=De.getItem(w)),e.is(i)&&De.updateActiveIcon(i)}function Xe(){e.is(M),e.is(ue)&&(ue.hideDCHeader(),ue.resetList(),ge.clearTiles(),be.clearTiles(),fe.hideSecondaryToolList(),fe.hideSecondaryToolHeader(),fe.clearTiles(),we.clearTiles())}function Ye(){ve.clearTiles(),ke.clearTiles()}async function Ze(t){widget.Debug.log("************** loadOperation");var i=performance.now();if(he.mask(),function(e){S=!1,ne||$.loadFile(e.object_data.id).then(function(){S=!0})}(t),Xe(),he.updateTitle(f.OperationDetailsTitle),he.hideSystemSection(),he.showOperSection(),De.updateActiveIcon(null),De.setIconbarDividerWidth(),De.resize(),"capable"===widget.getValue("resType")&&e.is(t.object_data.workCenterPID)){const e=new c(p,P),i=await e.getWorkCenterTitle(t.object_data.workCenterPID);t.object_data.workCenterTitle=i}ce.update(t),Ne(t.object_data);var n=performance.now();widget.Debug.log(`************** Time for WkbDetails.loadOperation: ${(n-i)/1e3} seconds.`)}function et(){if(v||m)setTimeout(et,200);else{m=!0;var e=Q.pop();e?Ze(e):m=!1}}function tt(e){F=!1,(Q=[]).push(e),et()}function it(t){var i="";if(e.is(t)&&e.is(t.linkedResourceId))for(var n=t.linkedResourceId.split(","),s=0;s<n.length;s++)for(var o=0;o<Z.length;o++)if(Z[o].linkedResourceId===n[s])i=e.is(Z[o].highlightID)&&Z[o].highlightID.length>0?i+Z[o].highlightID+";":i+Z[o].physicalId+";";else{var l=Z[o].children;if(e.is(l))for(var a=0;a<l.length;a++)l[a].linkedResourceId===n[s]&&(i=e.is(l[a].highlightID)&&l[a].highlightID.length>0?i+l[a].highlightID+";":i+l[a].physicalId+";")}return i}function nt(t){var i="";if(e.is(t)&&e.is(t.linkedPartId))for(var n=t.linkedPartId.split(","),s=0;s<n.length;s++){var o=z.find(function(e){return e.linkedPartId===n[s]});e.is(o)&&(i=e.is(o.highlightID)&&o.highlightID.length>0?i+o.highlightID+";":i+o.physicalId+";")}return i}async function st(t){let i="";wt(),t.userSelect||ue.highlightLinkedCardsByPID(t),"WKIITEM"===t.type?i=await async function(e){var t,i="";return i=nt(t=await de.getInstruction(_.instancePhysicalId,e.pid)),i+=it(t)}(t):"DCROW"===t.type&&(i=function(t){for(var i,n="",s=0;s<q.length;s++){if("DELWkiDataCollectPlanReference"===q[s].wkiType){var o=q[s].children;e.is(o)&&(i=o.find(function(e){return e.physicalId===t.pid}))}if(e.is(i))break}return n=nt(i),n+=it(i)}(t)),j=!0;const n={instruction:t,part:mt(i)};p.publish({event:"HighlightLinkedObjects-wkb3DViewer",data:n}),j=!1}async function ot(t){var i=t.object_data;if(e.is(i.systemPhysicalId)){v=!0;var n={ematrixURL:P,securityContext:widget.getValue("collabSpace"),systemPID:i.systemPhysicalId,modelEvtManager:p,wkiStreamUtil:Y};$=new h(n),F=!0,he.updateTitle(f.SystemDetailsTitle);var s=await l.getSystem();re.update(s,d.attributeConfig),he.hideOperSection(),he.showSystemSection(),Ye(),U=!1,Me(i),B=!1,function(t){!e.is(t.displayDocuments)||e.is(t.displayDocuments)&&!0===t.displayDocuments?(new u(p).getSystemDocuments(t.systemPhysicalId,P).then(function(e){rt(e,t.systemPhysicalId)}),Ie.showIcon("ibDocuments")):(B=!0,Ie.hideIcon("ibDocuments"))}(i),ae=!0,se=!0,se=!0,le=!0}else console.log("3DWorkbook: No system physical id provided")}function lt(){U&&B&&(v=!1,Ie.isIconEnabled(I)?(Ie.highlightIcon(I),Je(0,Ie.getItem(I))):Ie.isIconEnabled(k)&&(Ie.highlightIcon(k),qe(0,Ie.getItem(k))),he.unmask())}function at(t){e.is(t)||(t=[]),ve.loadCards(t);var i=t.length>0;He(I,i,Ie),U=!0,lt(),widget.Debug.log("************** Finished Getting System Tools")}function rt(t,i){var n=[];e.is(t)&&e.is(i)&&(n=t.get(i));var s=!1;e.is(n)&&n.length>0&&(s=!0,ke.loadDocumentCards(n)),He(k,s,Ie),B=!0,lt(),widget.Debug.log("************** Finished Getting System Documents")}function ct(){e.is(N)&&p.unsubscribe(N),N=p.subscribe({event:"wkb3DViewer-HighlightCallback"},dt)}function ut(e){const t=performance.now();widget.Debug.log("************** Begin setUpHighlight"),he.mask(),J=e.mapData,v||m||y?G<80?(G++,setTimeout(ut,300,e)):(console.log("Error setting up highlighting"),G=0,xe()):(G=0,ct(),ct(),he.setUpHighlight(e.mapData),he.unmask(),widget.Debug.log(`************** Time to setUpHighlight: ${(performance.now()-t)/1e3} seconds.`))}function dt(e){const t=e.action,i=e.idPath;!0!==A&&(ve.syncHighlightToViewer(i,t),fe.syncHighlightToViewer(i,t),ge.syncHighlightToViewer(i,t),be.syncHighlightToViewer(i,t),ue.syncToolHighlightToViewer(i,t),Dt(i,t))}function ht(e,t,i,n){for(var s=t.split(","),o=0;o<s.length;o++)if(s[o]===e){ue.syncHighlightToViewer(i,n);break}}function gt(e,t,i,n){for(var s=t.split(","),o=0;o<s.length;o++)if(s[o]===e){ue.syncDCRowHighlightToViewer(i,n);break}}function bt(t,i){var n=0,s=null;if(e.is(i))for(n=0;n<i.length;n++)if(e.is(i[n].highlightID)&&i[n].highlightID.length>0){if(i[n].highlightID===t){s=i[n];break}}else if(i[n].physicalId===t){s=i[n];break}return s}function ft(t,i){var n=0,s=null,o=null;if(e.is(i))for(n=0;n<i.length;n++)if(e.is(i[n].highlightID)&&i[n].highlightID.length>0&&(o=i[n].highlightID.split("/"))[o.length-1]===t){s=i[n];break}return s}function pt(t,i){for(var n,s=0;s<q.length;s++)if(e.is(q[s].linkedResourceId)&&ht(t.linkedResourceId,q[s].linkedResourceId,q[s].instancePhysicalId,i),"DELWkiDataCollectPlanReference"===q[s].wkiType&&(n=q[s].children,e.is(n)))for(var o=0;o<n.length;o++)e.is(n[o].linkedResourceId)&&gt(t.linkedResourceId,n[o].linkedResourceId,n[o].physicalId,i)}function wt(){ue.unHighlightWkiItems(),ue.unHighlightAllDataCollectItems()}function Dt(t,i){wt();var n,s=null;if(n=bt(t,z),e.is(n))e.is(n.linkedPartId)&&n.linkedPartId.length>0&&function(t,i){for(var n,s=0;s<q.length;s++)if(e.is(q[s].linkedPartId)&&ht(t.linkedPartId,q[s].linkedPartId,q[s].instancePhysicalId,i),"DELWkiDataCollectPlanReference"===q[s].wkiType&&(n=q[s].children,e.is(n)))for(var o=0;o<n.length;o++)e.is(n[o].linkedPartId)&&gt(t.linkedPartId,n[o].linkedPartId,n[o].physicalId,i)}(n,i);else if(s=bt(t,Z),e.is(s)&&e.is(s.linkedResourceId)&&s.linkedResourceId.length>0)pt(s,i);else{for(let n=0;n<Z.length;n++)if(s=bt(t,Z[n].children),e.is(s)&&e.is(s.linkedResourceId)&&s.linkedResourceId.length>0){pt(s,i);break}e.is(s)||function(t,i){var n=null,s=0,o=t.split("/");if(o.length>0){if(n=ft(o[o.length-1],Z),e.is(n)&&e.is(n.linkedResourceId)&&n.linkedResourceId.length>0)pt(n,i);else for(s=0;s<Z.length;s++)if(n=ft(o[o.length-1],Z[s].children),e.is(n)&&e.is(n.linkedResourceId)&&n.linkedResourceId.length>0){pt(n,i);break}if(!e.is(n)&&o.length>1)if(n=ft(o[0],Z),e.is(n)&&e.is(n.linkedResourceId)&&n.linkedResourceId.length>0)pt(n,i);else for(s=0;s<Z.length;s++)if(n=ft(o[0],Z[s].children),e.is(n)&&e.is(n.linkedResourceId)&&n.linkedResourceId.length>0){pt(n,i);break}}}(t,i)}}function It(e){p.publish({event:"selectItems-wkb3DViewer",data:e})}function kt(e){p.publish({event:"unselectItem-wkb3DViewer",data:e})}function vt(){p.publish({event:"clearSelections-wkb3DViewer",data:{}})}function mt(t){const i={ids:[],skipSelection:j};if(e.is(t,"string")&&""!==t){const e=t.split(";");t.includes("/")?e.forEach(e=>{const t=e.split("/");i.ids.push(t[t.length-1])}):i.ids=e.filter(e=>""!==e)}return i}function yt(e){if(A=!0,e.isSelectMode){let t="";if(e.selectedCards.forEach(e=>{t=t+e.getHighlightId()+";"}),""!==(t=t.slice(0,-1))){const e=mt(t);e.clear=!K,It(e)}}else e.selectedCards.forEach(e=>{!function(e){if(""!==e){var t=null;K?kt((t=e.split(";")[0].split("/"))[t.length-1]):vt()}}(e.getHighlightId())});A=!1}function Tt(t){var i=0,n=!0,s=t.isSelected();A=!0;var o=t.getElement(".highlightID");if((!e.is(o)||""===o.innerHTML)&&(o={innerHTML:t.getElement("#prdPathList").getAttribute("data-phyid")},!e.is(o)||0===o.length))return void(A=!1);K?s?(t.unhighlight(),n=!1):t.highlight():(ge.unhighlightAll(),fe.unhighlightAll(),be.unhighlightAll(),ve.unhighlightAll(),ue.unhighlightAllCapableToolCards(),t.unhighlight(),s?n=!1:t.highlight());var l,a=o.innerHTML;if(""!==a){var r=null,c=[],u=null;if(n)if((u=a.split(";")).length>1){for(i=0;i<u.length;i++)r=u[i].split("/"),c.push(r[r.length-1]);It({ids:c,clear:!K,skipSelection:!1})}else r=u[i].split("/"),l=r[r.length-1],p.publish({event:"selectItem-wkb3DViewer",data:l});else K?kt((r=(u=a.split(";"))[i].split("/"))[r.length-1]):vt()}A=!1,event.stopPropagation()}function St(e){wt()}function Ct(t){X||(wt(),function(t){if(!e.is(t.webUuids,"array")||!e.is(t.nativeUuids,"array")||0===t.webUuids.length&&0===t.nativeUuids.length)return;if("remove"===t.action)return;let i=t.nativeUuids;ne||(i=i.concat(g.getNativeUUID(t.webUuids)));const n=$.getInstructionsLinkedToMarkers(i);if(!e.is(n)||0===n.length)return;document.dispatchEvent(new CustomEvent("DELMOMOPENNESSMARKERSELECTED",{detail:n})),ue.highlightLinkedCards(n);const s=n.filter(t=>t&&t.Instruction&&e.is(t.Instruction.InstPhyID,"string")).map(e=>e.Instruction.InstPhyID),o=new CustomEvent("DELMOMSELECTLINKEDVIEWS",{detail:{wkiInstPIDs:s,activateView:!1}});document.dispatchEvent(o)}(t))}function Et(t){if(e.is(t)&&e.is(t.detail)&&t.detail.isUserClicked)if(!S||v||m)setTimeout(function(){Et(t)},500);else{if(ie){const e=ue.getHighlightedCardsPID();return e.length>0&&p.publish({event:"wkbDetails-InstructionSelected",data:{pid:e[0],type:"WKIITEM",userSelect:!1}}),void(ie=!1)}wt();var i,n,s=null;e.is(t.detail.instructionPIDs)&&t.detail.instructionPIDs.length>0&&(s=function(e){var t=[];return e.forEach(function(e){var i={Instruction:{InstPhyID:e}};t.push(i)}),t}(t.detail.instructionPIDs)),i=t.detail.uuid,n=s,e.is(n)||(n=$.getLinkedWkiItems(i)),e.is(n)&&0!==n.length&&ue.highlightLinkedCards(n),ue.scrollToFirstLinkedItem()}}function Lt(){widget.wkbEventManager=null,ne=!1,he.destroy(),ee.forEach(e=>p.unsubscribe(e)),ee.length=0,window.removeEventListener("DELMOMVIEWSELECTED",Et),window.removeEventListener("DELMOMVIEWSELECTED2D",Et),document.removeEventListener("SELECTMODECHANGE",Ft),document.removeEventListener("keyup",Kt),document.removeEventListener("keydown",xt)}function Pt(e,t,i,n){switch(e){case"addInstanceDataForHighlighting":return;case"loadOperDetail":return Ne(t);case"getWkbOperationIconBar":return De;case"loadOperation":return Ze(t);case"processPartData":Ue(t).then(function(){});break;case"processToolData":return Ae(t);case"processWkiData":return je(t);case"processDocumentData":return Ke(t,i);case"clearTiles":return Xe();case"setUpHighlight":return ut(t);case"updateIconBarMenu":return He(t,i,n);case"highlightCallback":return dt(t);case"processOrderTools":return at(t);case"processOrderDocs":return rt(t,i);case"getToolsData":return Pe(t);case"onWkiItemClick":return;case"setWkiContentParser":return void($=t);case"clearSystemLists":return Ye();case"detailsView-showOperSection":return he.hideSystemSection(),void he.showOperSection();case"onInstructionSelected":return void st(t);case"highlightInstructions":return void Dt(t,i);case"getDetailsModel":return de;default:return null}}function Mt(){return T?be:ge}function Wt(e){var t=e.target.attributes["data-pid"].value,i=e.target.attributes["data-title"].value,n=Mt();n.updateMfgKitHeaderTitle(i),n.showMfgKitHeader(),n.showMfgKitChildList(t)}function Vt(){var e=Mt();e.hideMfgKitChildList(),e.showMainList()}function Rt(e){be.hide(),ge.show()}function Ht(t){ge.hide(),T||(he.mask(),y=!0,function(t,i){var n=performance.now(),s=widget.getValue("collabSpace"),o=new r(p);if(e.is(t.children)&&t.children.length>0){var l=function(e){var t=[];return e.children.forEach(function(e){t.push(e.instancePhysicalId)}),t}(t);o.getPartsData(l,P,s).then(function(e){var t=performance.now();widget.Debug.log(`************** Time for WkbDetails.getRollupData: ${(t-n)/1e3} seconds.`),i(e)},function(e){console.log(e),y=!1})}else y=!1}(_,Be)),be.show(),be.showMainList()}function Ot(e){ue.hideMainList();var t=e.target.attributes["data-pid"].value,i=e.target.attributes["data-title"].value;ue.updateDCHeaderTitle(i),ue.showDCHeader(),ue.showDCChildList(t)}function Ut(){ue.hideDCChildList(),ue.showMainList()}function Bt(e){var t=e.target.attributes["data-pid"].value,i=e.target.attributes["data-title"].value;fe.updateSecondaryToolHeaderTitle(i),fe.showSecondaryToolHeader(),fe.showSecondaryToolList(t)}function At(){fe.hideSecondaryToolList(),fe.showMainList()}function jt(e){ue.updateSecondaryListTitle(e.name),fe.showSecondaryToolHeader(),fe.showSecondaryToolList(e.pid)}function Kt(e){"Control"===e.key&&(K=!1,ge.setMultiSelect(!1),be.setMultiSelect(!1))}function xt(e){e.ctrlKey&&(K=!0,ge.setMultiSelect(!0),be.setMultiSelect(!0))}function Ft(e){"multi"===e.detail.SelectMode?(K=!0,ge.setMultiSelect(!0),be.setMultiSelect(!0)):(K=!1,ge.setMultiSelect(!1),be.setMultiSelect(!1))}function Nt(){window.addEventListener("DELMOMVIEWSELECTED",Et),window.addEventListener("DELMOMVIEWSELECTED2D",Et);let t=null;t=p.subscribe({event:"wkb3DViewer-ViewerClearedSelections"},St),ee.push(t),t=p.subscribe({event:"wkb3DViewer-MarkerSelected"},Ct),ee.push(t),t=p.subscribe({event:"wkbPartListView-onMfgKitExpand"},Wt),ee.push(t),t=p.subscribe({event:"wkbToolListView-onCapableResourceExpand"},Bt),ee.push(t),t=p.subscribe({event:"wkbInstructionListView-DCPlanExpand"},Ot),ee.push(t),t=p.subscribe({event:"wkbOperationIconBar-InstructionClicked"},e=>Qe(e.event,e.icon)),ee.push(t),t=p.subscribe({event:"wkbOperationIconBar-PartClicked"},e=>$e(e.event,e.icon)),ee.push(t),t=p.subscribe({event:"wkbOperationIconBar-ToolClicked"},e=>ze(e.event,e.icon)),ee.push(t),t=p.subscribe({event:"wkbOperationIconBar-DocumentClicked"},e=>_e(e.event,e.icon)),ee.push(t),t=p.subscribe({event:"wkbSystemIconBar-ToolClicked"},e=>Je(e.event,e.icon)),ee.push(t),t=p.subscribe({event:"wkbSystemIconBar-DocumentClicked"},e=>qe(e.event,e.icon)),ee.push(t),t=p.subscribe({event:"wkbDocumentListView-openDocument"},e=>Ee(e.docPID)),ee.push(t),t=p.subscribe({event:"wkbPartTabBar-CurrentTabSelected"},Rt),ee.push(t),t=p.subscribe({event:"wkbPartTabBar-RollupTabSelected"},Ht),ee.push(t),t=p.subscribe({event:"wkbDCPlanChildListHeader-Hide"},Ut),ee.push(t),t=p.subscribe({event:"wkbToolChildListHeader-Hide"},At),ee.push(t),t=p.subscribe({event:"wkbMfgKitChildListHeader-Hide"},Vt),ee.push(t),t=p.subscribe({event:"wkbToolListView-Select"},Tt),ee.push(t),t=p.subscribe({event:"wkbInstructionListView-SelectCapRsc"},Tt),ee.push(t),t=p.subscribe({event:"wkbSecondaryToolListView-Select"},Tt),ee.push(t),t=p.subscribe({event:"wkbPartListView-Select"},yt),ee.push(t),t=p.subscribe({event:"wkbMfgKitChildListView-Select"},yt),ee.push(t),t=p.subscribe({event:"wkbNav-SelectOper"},tt),ee.push(t),t=p.subscribe({event:"wkbHeader-SelectOrder"},ot),ee.push(t),t=p.subscribe({event:"wkb3DViewer-MapFileLoaded"},ut),ee.push(t),t=p.subscribe({event:"wkbHeader-SelectOper"},tt),ee.push(t),t=p.subscribe({event:"wkbDetails-LoadDocument"},Ee),ee.push(t),t=p.subscribe({event:"wkiCapRscStamp-click"},jt),ee.push(t),t=p.subscribe({event:"wkbDetails-InstructionSelected"},st),ee.push(t),t=p.subscribe({event:"wkbMain-GraphicsChanged"},e=>{e.mode!==te&&(te=e.mode,ie=!0)}),ee.push(t),t=p.subscribe({event:"wkb3DViewer-onOperationLoadComplete"},function(t){t&&e.is(t.output,"array")&&t.output.length>0&&($.loadData(t.output[0]),S=!0)}.bind(this)),ee.push(t),document.addEventListener("keydown",xt),document.addEventListener("keyup",Kt),document.addEventListener("SELECTMODECHANGE",Ft)}return t.extend({init:function(e){L=e.widgetPreferences,P=e.ematrixURL,p=e.modelEvtManager||new n,Y=e.wkiStreamUtil,widget.wkbEventManager=p,ne=e.isDelmiaViewer,te=s.getPreferenceValue(L,"defaultViewType");var t={modelEvtManager:p,ematrixURL:P,security:widget.getValue("collabSpace")};de=new a(t),Nt();var i=s.getPreferenceValue(L,"resType"),o={modelEvtManager:p,title:f.SystemDetailsTitle,attributeConfig:d.attributeConfig,toolsTooltip:"capable"===s.getPreferenceValue(L,"resType")?f.CapableLbl:f.ToolsLbl,resourceType:i,ematrixURL:P};he=new b(o),re=he.wkbSystemAttributesView,(Ie=he.wkbSystemIconBar).show(),ve=he.wkbSystemToolListView,ke=he.wkbSystemDocumentListView,pe=he.wkbPartTabBar,ue=he.wkbInstructionListView,ge=he.wkbPartListView,be=he.wkbPartRollupView,fe=he.wkbToolListView,we=he.wkbOperDocumentListView,(De=he.wkbOperationIconBar).show(),this.wkbOperationIconBar=De,ce=he.wkbOperationAttributesView,ot({object_data:{systemPhysicalId:e.systemData.physicalId}}),he.mainElement.testFunction=Pt,he.mainElement.dispose=Lt},testFunction:function(e,t,i,n){Pt(e,t,i,n)},dispose:function(){Lt()},getElement:function(){return he.mainElement},getEnabledOperMenuItems:function(){return this.wkbOperationIconBar.iconBar.elements.container.getElementsByClassName("item item-enabled")},flashBorder:function(e){e.classList.add("flashBorder"),setTimeout(function(){e.classList.remove("flashBorder")},400)},selectOperIconBarItem:function(e){const t=De.getItem(e);switch(e){case D:$e(0,t);break;case I:ze(0,t);break;case w:Qe(0,t);break;case k:_e(0,t)}this.flashBorder(t.elements.container)},selectElement:function(e,t){var i=document.querySelectorAll(t);i[e].click(),i[e].scrollIntoView(!1)},selectInstructionCard:function(e){this.selectElement(e,"div.MainInstructionList div.wkbDetailsCard.cardClickable.wkiItem")},selectDCCard:function(e){this.selectElement(e,'.DataCollectLists .dcPlanChildItems[style=""] .dcPlanChildItem.wkiItem')},selectPartCard:function(e){this.selectElement(e,"div.mainPartList div.wkbDetailsCard.cardClickable")},selectToolCard:function(e){this.selectElement(e,"div.mainToolList div.wkbDetailsCard.cardClickable")},selectSecondaryToolCard:function(e){this.selectElement(e,'div.secondaryToolsList .secCapResource[style=""] div.toolItem')},selectMfgKitCard:function(e){this.selectElement(e,'div.OperChildList .mfgKitChildList[style=""] div.partItem')}})});