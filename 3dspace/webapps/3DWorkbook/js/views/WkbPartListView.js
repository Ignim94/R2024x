define("DS/3DWorkbook/js/views/WkbPartListView",["UWA/Core","UWA/Class","UWA/Promise","UWA/Utils/Client","DS/CoreEvents/ModelEvents","DS/UIKIT/Scroller","DS/Menu/ContextualMenu","DS/3DWorkbook/js/views/WkbViewsUtils","DS/3DWorkbook/js/views/WkbMfgKitListHeaderView","DS/3DWorkbook/js/views/WkbMfgKitChildListView","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(t,i,e,s,n,l,a,h,r,d,o){"use strict";return i.extend({init:function(t){this.id=t.id,this.ematrixURL=t.ematrixURL,this.modelEvtManager=t.modelEvtManager||new n,this.container=null,this.attributeConfig=t.attributeConfig,this.scroller=null,this.cardList=[],this.rollupCardList=[],this.partTabBar=null,this.wkbMfgKitChildListMap=new Map,this.multiSelect=!1,this.lastSelectedCardIndex=null,this.buildSkeleton()},buildSkeleton:function(){this.container=t.createElement("div",{id:this.id,class:"PartList",styles:{height:"98%",display:"block","white-space":"pre-line"}}),this.mainList=t.createElement("div",{class:"mainPartList",styles:{height:s.getSize().height-230+"px",display:"block","white-space":"pre-line"}}),this.mainList.inject(this.container);var i={modelEvtManager:this.modelEvtManager};this.wkbMfgKitListHeaderView=new r(i),this.wkbMfgKitListHeaderView.inject(this.container),this.mfgKitChildLists=t.createElement("div",{class:"mfgKitChildList",styles:{height:s.getSize().height-230+"px",display:"block","white-space":"pre-line"}}),this.mfgKitChildLists.inject(this.container),this.mfgKitChildLists.hide()},clearTiles:function(){var t=this;for(this.cardList.forEach(function(i){i.removeOnClick(t._getOnCardSelected(i)),i.destroy()}),this.cardList.length=0;this.mainList.firstChild;)this.mainList.removeChild(this.mainList.lastChild);this._destroyScroll(),this.hideMfgKitHeader(),this.hideMfgKitChildList();for(const t of this.wkbMfgKitChildListMap.values())t.clearTiles(),t.destroy();this.wkbMfgKitChildListMap.clear(),this.currentMfgKitChildListView=null},hideMainList:function(){this.mainList.hide()},showMainList:function(){this.mfgKitChildLists.hide(),t.is(this.currentMfgKitChildListView)&&this.currentMfgKitChildListView.hide(),this.mainList.show()},hideMfgKitChildList:function(){this.mfgKitChildLists.hide(),t.is(this.currentMfgKitChildListView)&&this.currentMfgKitChildListView.hide()},showMfgKitChildList:function(i){this.hideMainList(),this.mfgKitChildLists.show(),this.currentMfgKitChildListView=this.wkbMfgKitChildListMap.get(i),t.is(this.currentMfgKitChildListView)&&this.currentMfgKitChildListView.show()},showMfgKitHeader:function(){this.wkbMfgKitListHeaderView.show()},hideMfgKitHeader:function(){this.wkbMfgKitListHeaderView.hide()},updateMfgKitHeaderTitle:function(t){this.wkbMfgKitListHeaderView.updateTitle(t)},hide:function(){this.container.hide()},show:function(){this.container.show()},isVisible:function(){return!this.container.isHidden()},unhighlightCard:function(t){t.unhighlight()},highlightCard:function(t){t.highlight()},unhighlightAll:function(){this.container.querySelectorAll(".partItem").forEach(function(t){h.setCardStyleNotSelected(t)}),this.lastSelectedCardIndex=null},syncHighlightToViewer:function(i,e){var s=this.container.querySelectorAll(".partItem");t.is(s)&&h.doHighlight(s,i,e,!0)},setMultiSelect:function(i){const e=this;e.multiSelect=i,t.is(e.currentMfgKitChildListView)&&(e.currentMfgKitChildListView.multiSelect=i)},inject:function(t){this.container.inject(t)},getContainer:function(){return this.container},loadPartCards:function(i){this._destroyScroll();var e=0,s=null;if(0!==i.length){for(;e<i.length;e++)s=this._getPartCard(i[e]),t.is(s)&&(s.inject(this.mainList),this.cardList.push(s)),t.is(i[e].children)&&i[e].children.length>0&&this._loadMfgKitChildCards(i[e]);this._addScroll(this.mainList,this.mainList.parentElement)}else this._addNoPartDataMarkup(o.NoPartsFoundMsg)},_getHiglightIds:function(t){return t.map(t=>t.getHighlightId()).join(";")},addHighlightingData:function(i){if(!(this.cardList.length<1))for(let e=0;e<this.cardList.length;e+=1){let s=null;const n=this.cardList[e],l=this.wkbMfgKitChildListMap.get(n.dataset.id);t.is(l)&&l.addHighlightingData(i),s=n.isMfgKit?this._getHiglightIds(l.cardList):t.is(i)?h.getPartHighlightPath(n,i):n.getPID(),h.createHighlightingData(n,s)}},_addNoPartDataMarkup:function(i){var e=t.createElement("div",{class:"noPartMsg"});e.textContent=i,e.inject(this.mainList)},_loadMfgKitChildCards:function(t){var i={modelEvtManager:this.modelEvtManager,attributeConfig:this.attributeConfig,mfgKitPID:t.physicalId},e=new d(i);e.loadCards(t),e.hide(),e.inject(this.mfgKitChildLists),this.wkbMfgKitChildListMap.set(t.physicalId,e)},_addContextMenu:function(t){var i=this;a.addEventListener(t.element,{callback:function(){var e=[];return e.push({type:"PushItem",title:o.ReframeOn,icon:i.ematrixURL+"webapps/DELWebPPRIcons/assets/icons/32/I_PPRCommon_ReframeOn.png",action:{callback:function(){var t=document.createEvent("CustomEvent");t.initCustomEvent("REFRAMEONSELECTEDPARTS",!1,!1,{}),document.dispatchEvent(t)},context:t.element}}),t.element.classList.contains("cardHighlight")||i.modelEvtManager.publish({event:"wkbPartListView-Select",data:{selectedCards:[t.element],isSelectMode:!0}}),e}})},_onMfgKitExpand:function(t){this.modelEvtManager.publish({event:"wkbPartListView-onMfgKitExpand",data:t}),t.stopPropagation()},_getOnCardSelected:function(i){var e=this;return function(s){let n=[];var l=!i.isSelected(),a=e.cardList.indexOf(i);const h=e.cardList[e.lastSelectedCardIndex];if(t.is(h)&&!h.isSelected()&&(e.lastSelectedCardIndex=null),e.multiSelect||s.shiftKey&&t.is(e.lastSelectedCardIndex)||i.testShiftSelect&&t.is(e.lastSelectedCardIndex)||e.unhighlightAll(),s.shiftKey&&t.is(e.lastSelectedCardIndex)&&l||i.testShiftSelect&&t.is(e.lastSelectedCardIndex)&&l){const t=Math.min(a,e.lastSelectedCardIndex),i=Math.max(a,e.lastSelectedCardIndex);(n=e.cardList.slice(t,i+1)).forEach(t=>t.highlight())}else n=[i],l?(i.highlight(),e.lastSelectedCardIndex=a):(i.unhighlight(),e.lastSelectedCardIndex=null);!t.is(e.lastSelectedCardIndex)&&l&&(e.lastSelectedCardIndex=a),e.modelEvtManager.publish({event:"wkbPartListView-Select",data:{selectedCards:n,isSelectMode:l}}),s.stopPropagation()}},_getPartCard:function(i){var e=h.getPartCard(i,this.attributeConfig.part);return e.setOnClick(this._getOnCardSelected(e)),e.isMfgKit=!1,this._addContextMenu(e),t.is(i.children)&&i.children.length>0&&(e.isMfgKit=!0,e.addContextMenu(this._onMfgKitExpand.bind(this),i.physicalId,i.displayName)),e},_addScroll:function(t,i){this.scroller&&(this.scroller.destroy(),this.scroller=null),this.scroller=new l({element:t}).inject(i)},_destroyScroll:function(){t.is(this.scroller)&&(this.scroller.destroy(),this.scroller=null)},destroy:function(){this._destroyScroll(),this.rollupCardList.length=0,this.container.destroy(),this.container=null,this.cardList.length=0}})});