define("DS/3DWorkbook/js/views/WkbViewsUtils",["UWA/Core","UWA/Class","UWA/Utils/Client","DS/UIKIT/Popover","DS/Controls/Expander","DS/DataDragAndDrop/DataDragAndDrop","DS/3DWorkbook/js/WkbUtils","DS/3DWorkbook/js/WkbHighlightUtil","DS/3DWorkbook/js/WkbDetailsCard","DS/3DWorkbook/js/views/WkbStyles","DS/3DWorkbook/js/views/WkbCustomAttributesView","i18n!DS/3DWorkbook/assets/nls/3DWorkbook"],function(t,e,n,i,a,o,r,s,l,c,d,g){"use strict";function h(t){return t.getElementsByTagName("DELWKIPublishMappingRoot")[0].getAttribute("mode")}return e.singleton({init:function(){},modelEventManager:{},getWithSpan:function(t,e){return'<span style="color: '+t+'">'+e+"</span>"},getAttributeDiv:function(e,n){var i=t.createElement("div");return i.setHTML(this.getWithSpan(c.attributeLabelColor,e)+this.getWithSpan(c.attributeValueColor,n)),i},_getLoadDocFunction:function(t,e){return function(){e.publish({event:"wkbDocumentListView-openDocument",data:{docPID:t}})}},_getPreferredDiv:function(){var e=t.createElement("div",{class:"wkbCapPreferFontIcon wux-ui-3ds-favorite-off wux-ui-3ds"});return e.innerHTML=this.getWithSpan(c.attributeLabelColor,"  "+g.CapablePreferredFlag),e},_addInstanceDataForHighlighting:function(e,n){var i,a;if(t.is(n.instancePath)||(n.instancePath=[]),n.instancePath.length>0){(i=r.createAndAppend(e,"ul")).style.margin="0px",i.setAttribute("data-listname","prdPathList"),i.id="prdPathList",t.is(n.physicalId)&&n.physicalId.length>0&&i.setAttribute("data-phyId",n.physicalId);for(var o=0;o<n.instancePath.length;o++)null!==n.instancePath[o]?r.createAndAppend(i,"li").setAttribute("data-prdInstance",n.instancePath[o]):1===n.instancePath.length&&((a=r.createAndAppend(e,"div")).style.margin="0px",a.setAttribute("data-refId",n.id),a.id="refId")}else console.log("no instance path found, so highlighting of part will not work for this part")},getPartCard:function(e,n){var i=0,a=null,o=null;t.is(e.documents)&&e.documents.length>0&&(o=this.getDocumentAttachmentElement(e.documents,e.displayName));var r="";if(t.is(e.usage)&&(r="("+e.usage+") "),r=r+e.displayName+" - "+e.version,t.is(n)){for(;i<n.length;i++)if(t.is(n[i].objPropertyName)&&"instanceName"===n[i].objPropertyName&&""!==e.instanceName){r+=" ("+e.instanceName+")";break}a=d.getCustomAttributesElement(e,n)}else a=t.createElement("div",{styles:{display:"inline-block",width:"80%","font-family":"Arial"}}),t.is(e.instanceName)&&e.instanceName.length>0&&(r+=" ("+e.instanceName+")");if(this._addInstanceDataForHighlighting(a,e),e.instanceCount>19){var s=g.PartQtyLbl+" ";s=this.getWithSpan(c.attributeLabelColor,s),a.innerHTML=s+this.getWithSpan(c.attributeValueColor,e.instanceCount)+a.innerHTML}var l=this.getDetailCard(r,"partItem itemHover cardNoHighlight","fonticon fonticon-3dpart",a.getHTML(),o,!0);return l.type="part",l.setPID(e.physicalId),l.getHighlightId=function(){var e="",n=this.getElement(".highlightID");t.is(n)&&""!==n.innerHTML?e=n.innerHTML:e=l.getElement("#prdPathList").getAttribute("data-phyid");return e},l},getToolCard:function(e,n){var i=d.getCustomAttributesElement(e,n),a=r.createAndAppend(i,"ul");a.setAttribute("data-listname","prdPathList"),a.id="prdPathList",t.is(e.physicalId)&&e.physicalId.length>0&&a.setAttribute("data-phyId",e.physicalId);var o=e.displayName+" - "+e.version;t.is(e.instanceName)&&e.instanceName.length>0&&(o+=" ("+e.instanceName+")");var s=null;if("capable"===widget.getValue("resType")){var l=t.createElement("div",{styles:{clear:"both"}});e.resourceType?l.innerHTML=this.getWithSpan(c.attributeLabelColor,g.Type+": ")+e.resourceType:l.innerHTML=this.getWithSpan(c.attributeLabelColor,g.Type+": ")+e.wkiType,s=l.outerHTML+i.getHTML();e.isPreferred&&(s=this._getPreferredDiv().outerHTML+s)}else s=i.getHTML();var h=this.getDetailCard(o,"toolItem itemHover cardNoHighlight","fonticon fonticon-tools",s,null,!0);return h.dataset.referenceName=e.id,h.setPID(e.physicalId),h.type="resource",h},getDocumentCard:function(e,n){var i=t.is(e.m1Id)?e.m1Id:e.physicalId,a=e.title+" - "+e.revision,o=t.createElement("div",{class:"fonticon fonticon-window",styles:{"font-size":"18px",color:"#B4B6BA"},events:{click:this._getLoadDocFunction(i,n)}}),r=this.getDetailCard(a,"documentItem cardNoHighlight","fonticon fonticon-doc",e.description,o);return r.onclick=this._getLoadDocFunction(i),this.addDragElement(e,r.element),r},addDragElement:function(e,n){o.clean(n);var i=e.physicalId;t.is(i)||(i=e.physicalid);var a={protocol:"3DXContent",version:"1.1",source:"3DWorkbook",data:{items:[{envId:r.getTenant(),serviceId:"3DSpace",contextId:"ctx::"+widget.getValue("collabSpace"),objectId:i,objectType:e.wkiType,displayName:e.name}]}};o.draggable(n,{data:JSON.stringify(a),start:function(){},stop:function(){}})},_addDocumentPopover:function(t,e,a,o){var r=this,s="focus";n.Features.touch&&(s="touch"),new i({target:t,position:a,allowedPositions:["left","left top"],body:o,trigger:s,events:{onShow:function(){var t,e,n=document.getElementsByClassName("PopoverDocument");for(t=0;t<n.length;t++)e={physicalId:n[t].getAttribute("data-phyid"),wkiType:"Document",name:n[t].getAttribute("data-docName")},r.addDragElement(e,n[t])}},title:e}).elements.container.style.maxWidth="500px"},_getPopoverBody:function(e){var n,i,a,o=t.createElement("div",{id:"",class:""}),s=r.createAndAppend(o,"div","wkbDocPopupScroll","wkbDocPopupScroll"),l=r.createAndAppend(s,"div","documentList","documentList");for(n=0;n<e.length;n++){i=r.createAndAppend(l,"div","","doc"+n),(a=t.createElement("div",{textContent:"",onclick:"event.stopPropagation();widget.wkbEventManager.publish({event: 'wkbDetails-LoadDocument',data: '"+e[n].physicalId+"'});return false;"})).inject(i);var c=this.getDocumentCard(e[n]);c.style.margin="5px 0",c.inject(a)}return o.innerHTML},getDocumentAttachmentElement:function(e,n){var i=t.createElement("button",{class:"",type:"button",styles:{padding:"0 0 10px 10px",outline:"none",border:"none",background:"transparent","z-index":2}});t.createElement("span",{class:"fonticon fonticon-attach",styles:{"font-size":"18px",margin:"0px",color:"#77797C"}}).inject(i);var a=this._getPopoverBody(e);return this._addDocumentPopover(i,n+" - "+g.DocsLbl,"left bottom",a),i},setCardStyleSelected:function(t){t.removeClassName("cardHighlight2"),t.removeClassName("cardNoHighlight"),t.addClassName("cardHighlight")},setCardStyleNotSelected:function(t){t.removeClassName("cardHighlight2"),t.removeClassName("cardHighlight"),t.addClassName("cardNoHighlight")},isCardSelected:function(e){return!(!t.is(e)||!e.hasClassName("cardHighlight"))},getDetailCard:function(t,e,n,i,a,o){return new l({title:t,itemClass:e,fonticonClass:n,html:i,stampElement:a,isClickable:o})},_getOnToolCardSelected:function(t,e){return function(){e.publish({event:"wkbInstructionListView-SelectCapRsc",data:t})}},insertCapableResources:function(e,n,i,o){var r=0,s=n.element;if(t.is(e)){n.toolCards=[];for(var l=t.createElement("div",{class:"",styles:{}});r<e.length;r+=1){var c=this.getToolCard(e[r],o);c.setOnClick(this._getOnToolCardSelected(c,i)),c.inject(l),n.toolCards.push(c)}new a({icon:{iconName:"tools",fontIconFamily:WUXManagedFontIcons.Font3DS},header:g.CapableLbl,body:l,style:"styled"}).inject(s)}},getPartHighlightPath:function(e,n){var i,a="",o="Connected"===h(n),r=e.getElement("#prdPathList");if(r){var l=r.getElementsByTagName("li");if(l.length>0)o?(i=s.getPathFromMapConnected(r,n,0))||(i=s.getPathFromMapConnected(r,n,1)):(i=s.getPathFromMap(l,n,0))||(i=s.getPathFromMap(l,n,1));else{var c=e.getElement("#refId");i=s.getTopAssemblyPath(c.getAttribute("data-refId"),n)}}return t.is(i)&&(a=i),a},getToolHighlightPath:function(t,e){return s.getToolHighlightPath(t,e,h(e))},createHighlightingData:function(e,n){var i;(i=r.createAndAppend(e.element,"div","highlightID",""),t.is(n)&&n.length>0)?i.innerHTML=n:(i.innerHTML="",e.getElements(".cardClickable").forEach(function(t){t.onclick=null,t.parentElement.removeClassName("itemHover")}))},_extractHighlightIds:function(t){for(var e=0,n=null,i=t.split(";"),a=[],o=null;e<i.length;e+=1)o=(n=i[e].split("/"))[n.length-1],a.push(o);return a},doHighlight:function(e,n,i,a){var o,r,s,l,c,d=[],g=!1;if(!(e.length<1)){for(let u=0;u<e.length;u++)if(o=e[u].getElement(".highlightID"),t.is(o)){var h=o.innerHTML;if(l=this._extractHighlightIds(h),s=(r=n.split("/"))[r.length-1],h.length>0&&l.indexOf(s)>-1&&(g=!0,c=e[u].getElement("#prdPathList"),t.is(c)&&(d=c.getElementsByTagName("li")),d.length>0||e[u].classList.contains("toolItem")?"ADD"===i?this.setCardStyleSelected(e[u]):this.setCardStyleNotSelected(e[u]):"REMOVE"===i&&this.setCardStyleNotSelected(e[u]),!a))return!0}return g}},addToolHighlightingData:function(e,n){if(!(e.length<1))for(let i=0;i<e.length;i+=1){const a=e[i];t.is(a.toolCards)&&a.toolCards.length>0&&a.toolCards.forEach(e=>{let i=null;i=t.is(n)?this.getToolHighlightPath(e,n):e.getPID(),this.createHighlightingData(e,i)})}}})});