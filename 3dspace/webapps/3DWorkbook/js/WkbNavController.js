define("DS/3DWorkbook/js/WkbNavController",["UWA/Core","UWA/Class","DS/3DWorkbook/js/WkbNavDetailController"],function(e,t,i){"use strict";const n=Object.freeze({OPER:1,SUBOP:2,VIEW:3,DETAIL:4});var o=null,s=0;let r=0,a=0;var l=null,h=[];let u=n.OPER,c=1;var d=0,v=!1;return t.singleton({init:function(e){l=e.modelEvtManager,this._addEventListeners(l),i.init(e),this.isInitialized=!0},setNavPanel:function(e){e},setDetailsPanel:function(e){i.setDetailsPanel(e)},setEventManager:function(e){l=e},getNavMode:function(){return u},getOperIndex:function(){return s},selectView:function(e){const t=new CustomEvent("DELMOMSETVIEW",{detail:{viewID:e.toString()}});document.dispatchEvent(t)},_flashBorder:function(e){e.classList.add("flashBorder"),setTimeout(function(){e.classList.remove("flashBorder")},400)},clearOperPrehighlight:function(t){e.is(t)||(t=document.querySelectorAll("#navListDiv .wux-controls-abstract.wux-controls-responsivetileview.wux-ui-is-rendered")),t.forEach(e=>e.classList.remove("wux-ui-state-prehighlighted"))},operPrehighlight:function(e,t){this.clearOperPrehighlight(t),t[e].classList.add("wux-ui-state-prehighlighted"),t[e].scrollIntoView(!1),this._flashBorder(t[e]),s=e},nextOperPrehighlight:function(){const e=document.querySelectorAll("#navListDiv .wux-controls-abstract.wux-controls-responsivetileview.wux-ui-is-rendered"),t=s+1;t<e.length&&this.operPrehighlight(t,e)},previousOperPrehighlight:function(){const e=document.querySelectorAll("#navListDiv .wux-controls-abstract.wux-controls-responsivetileview.wux-ui-is-rendered"),t=s-1;t<e.length&&t>-1&&this.operPrehighlight(t,e)},selectPreviousOper:function(){const t=s-1;return u===n.VIEW&&t>-1?(s=t,u=c,void this.onEnterKey()):u===n.VIEW&&c===n.SUBOP&&t<0&&(this.showMainOperList(),u=n.OPER,e.is(o[d+1]))?(s=d+1,void this.onEnterKey()):void 0},_moveToSubOper:function(e){d=s,l.publish({event:"ShowSubOps-WkbNavPanel",data:e}),u=n.SUBOP,v=!0},gotoDetailNav:function(){this.subscribeDetailsReturn(),u=n.DETAIL,i.beginNav()},gotoPrevView:function(){const e=r-1;e>0&&a>0?this.selectView(e):e<1&&a>0&&this.selectPreviousOper()},gotoNextView:function(){const e=r+1;e>a&&a>0?(this.nextOperPrehighlight(),u=n.OPER,this.onEnterKey()):e<=a&&a>0&&this.selectView(e)},showMainOperList:function(){l.publish({event:"NavBackToMainList-WkbNavPanel",data:{}}),v=!1},onEnterKey:function(e){if(c=u,u===n.OPER||u===n.SUBOP){if(s<0)return;a=0,i.reset(),l.publish({event:"ManualOperSelect-WkbNavPanel",data:{object_data:{physicalId:o[s].physicalId}}}),u="OPERATION"===o[s].parentType?n.SUBOP:n.OPER}},onDownArrow:function(e){u===n.VIEW&&a>0?this.gotoNextView():u!==n.OPER&&u!==n.SUBOP||this.nextOperPrehighlight()},onUpArrow:function(e){u!==n.OPER&&u!==n.SUBOP?u===n.VIEW&&a>0&&this.gotoPrevView():this.previousOperPrehighlight()},onLeftArrow:function(){u!==n.VIEW?u===n.SUBOP&&(l.publish({event:"NavBackToMainList-WkbNavPanel",data:{}}),v=!1):u=v?n.SUBOP:n.OPER},onRightArrow:function(){if(c=u,u===n.OPER){if(s<0)return;var t=o[s];if(e.is(t.children)&&t.children.length>0)return void this._moveToSubOper(t);0===a&&this.gotoDetailNav()}u===n.VIEW&&this.gotoDetailNav(),u!==n.SUBOP||0!==a||this.gotoDetailNav()},onKeyDown:function(e){if(u!==n.DETAIL)switch(e.keyCode){case 13:this.onEnterKey(e);break;case 37:this.onLeftArrow();break;case 38:this.onUpArrow(e);break;case 39:this.onRightArrow();break;case 40:this.onDownArrow(e)}},unsubscribeDetailsReturn:function(){l.unsubscribe(this.detailReturntoken)},subscribeDetailsReturn:function(){this.detailReturntoken=l.subscribe({event:"WkbNavDetailController-Done"},this.onDetailReturn.bind(this))},onOperListPopulated:function(e){o!==e.operations&&(o=e.operations,s=-1,i.disableNav(),u="OPERATION"===e.operations[0].parentType?n.SUBOP:n.OPER)},onViewChanged:function(t){if(e.is(t)&&e.is(t.ID)&&e.is(t.From))if(r=t.ID,u!==n.DETAIL){if(u=n.VIEW,1===r){const i=0===t.From?document.getElementById("docDiv"):document.getElementById("playerDiv");if(!e.is(i))return;const n=i.getElementsByClassName("DELBaseThumbnailThumbContainer"),o=i.getElementsByClassName("ThumbnailThumbContainer");if(!(e.is(n)&&0!==n.length||e.is(o)&&0!==o.length))return a=0,void console.error("no view element detected");if(e.is(n)&&n.length>0&&e.is(o)&&o.length>0)return a=0,void console.error("both view element detected");const s=e.is(n)&&n.length>0?n:o;a=s.length}}else i.endNav(!0)},getOperIndexFromData:function(t){var i=t.object_data.physicalId,n=o.findIndex(e=>e.physicalId===i);return e.is(n)?n:0},onOperSelected:function(t){r=0,a=0,i.endNav(!0),u=e.is(t.parent)&&"OPERATION"===t.parent?n.SUBOP:n.OPER,s=this.getOperIndexFromData(t),this.clearOperPrehighlight()},onShowMainList:function(){u=n.OPER,s=-1},onDetailReturn:function(){u=c,this.unsubscribeDetailsReturn()},_addEventListeners:function(e){document.addEventListener("keydown",this.onKeyDown.bind(this));var t=e.subscribe({event:"wkbNav-ShowMainList"},this.onShowMainList);h.push(t),t=e.subscribe({event:"wkbNav-OperListPopulated"},this.onOperListPopulated),h.push(t),t=e.subscribe({event:"ViewChanged"},this.onViewChanged),h.push(t),t=e.subscribe({event:"wkbNav-SelectOper"},this.onOperSelected.bind(this)),h.push(t)}})});