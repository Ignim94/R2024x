define("DS/xPortfolioUXCommons/DialogCreation/DialogCreation",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/ENOXDataDragAndDrop/js/ENOXDataDragAndDrop","DS/UIKIT/Input/File","DS/Controls/Button","DS/ENOXEmptyContent/js/ENOXEmptyContent","i18n!DS/xPortfolioUXCommons/assets/nls/DialogCreation/DialogCreation","css!DS/xPortfolioUXCommons/DialogCreation/DialogCreation.css"],function(e,t,i,n,o,a,s,r,l,d,c){"use strict";return{createView:t.extend({className:"dialog-creation",render:function(){return this.formContent=new n({className:"vertical",fields:[{type:"text",label:c.title,placeholder:c.title,name:"title",errorText:c.titleMandatory,required:!0},{type:"text",label:c.description,placeholder:c.description,name:"description",rows:4,multiline:!0},{type:"file",label:c.image,name:"image"}]}),this.formContent}}),createViewPatch:t.extend({className:"dialog-creation",render:function(){var t=e.createElement("div"),i=e.createElement("label");i.style.color="#3d3d3d",i.setContent(c.image);var o=this;this.imageFileInput;var r=[{type:"text",label:c.title,placeholder:c.title,name:"title",errorText:c.titleMandatory,required:!0}];this.options.edit_revision&&r.push({type:"text",label:c.revision,placeholder:"A",value:"A",name:"revision",errorText:c.revisionMandatory,required:!0}),r.push({type:"text",label:c.description,placeholder:c.description,name:"description",rows:4,multiline:!0}),this.formContent=new n({className:"vertical",fields:r}),this._fileInputDiv=e.createElement("div",{class:"file-input-container"}),this._dataDragAndDropModelevent=new a,this._dragdropInstance=new s({droppableAreas:[this._fileInputDiv],modelEvents:this._dataDragAndDropModelevent}),this._dataDragAndDropModelevent.subscribe({event:"onDrop"},function(e){var t=e.data;if(t&&t.data&&1===t.data.length){var i=t.data[0];i.type.contains("image")&&o.setImageFile(i)}});var p=new l({label:c._uploadButtonLabel});this._previewDiv=e.createElement("div",{class:"file-preview-container hidden"}),this.previewImage=e.createElement("div",{class:"file-preview-image",height:"150px"}),this._imageRemoveButton=new l({label:c._uploadButtonLabel,showLabelFlag:!1,displayStyle:"lite",icon:{iconName:"clear",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this._imageRemoveButton.getContent().addEventListener("buttonclick",function(){o.uploadFileField.value="",o.imageFileInput=void 0,o._previewDiv.addClassName("hidden"),o._fileInputDiv.getElement(".empty-content").removeClassName("hidden")}),this._imageRemoveButton.getContent().addClassName("file-remove-button"),this._imageRemoveButton.inject(this.previewImage),this.previewImage.inject(this._previewDiv),this.uploadFileField=e.createElement("input",{name:"image",type:"file",events:{change:function(){if(o.uploadFileField.files[0]){var e=o.uploadFileField.files[0];o.setImageFile(e)}}}}),p.getContent().addEventListener("buttonclick",function(){o.uploadFileField.click()});var u={sentences:[{type:"icon",fonticon:"drag-drop",sizeicon:"30px",text:c._dropMessage},{type:"dom",DOMelement:p.getContent()}]};return this._ENOXEmptyContent=new d(u),this._ENOXEmptyContent.inject(this._fileInputDiv),this._previewDiv.inject(this._fileInputDiv),this.formContent.inject(t),i.inject(t),this._fileInputDiv.inject(t),this.container.setContent(t),this},setImageFile:function(t){var i=this;this.imageFileInput=t;const n=new FileReader;n.addEventListener("load",function(){var t=e.createElement("img",{styles:{height:"145px"}}).inject(i.previewImage);t.src=n.result;var o="";t.onload=function(){let e=i.previewImage.getElementsByTagName("img");e&&e.length>0&&e[0].remove(),o=i.scaleImage(t,void 0,void 0,void 0),i.previewImage.setStyle("backgroundImage",'url("'+o+'")')},i._previewDiv.removeClassName("hidden"),i._fileInputDiv.getElement(".empty-content").addClassName("hidden")},!1),t&&n.readAsDataURL(t)},destroy:function(){this._dataDragAndDropModelevent.destroy(),this._parent.apply(this,arguments)},scaleImage:function(e,t,i,n){var o=document.createElement("canvas"),a=o.getContext("2d"),s=0!==e.naturalWidth?e.naturalWidth:1500,r=0!==e.naturalHeight?e.naturalHeight:1499,l=Math.min(120/r,160/s);l<1&&(r*=l,s*=l);for(var d,c=1;o.width=s,o.height=r,a.fillStyle="white",a.fillRect(0,0,o.width,o.height),a.drawImage(e,0,0,s,r),(d=o.toDataURL("image/jpeg",c)).length>16300;)c-=.05;if(!n)return d;n(d)}}),show:function(t){var i=this;this.options=t,this._id=t.id,this._context=t.context,this._withCreateAndClose=t.withCreateAndClose,this.modelEvent=t.modelEvent;var n=new o({renderTo:document.body,events:{onShow:function(){i.modelEvent.publish({event:"enox-dialog-on-show"})},onHide:function(){i.modelEvent.publish({event:"enox-dialog-on-hide"})}}});this.view=new this.createViewPatch(t);var a=[{className:i._withCreateAndClose?"default":"primary",value:c.create,action:function(t){var n=i.view.formContent.getValue("title");i.view.formContent.setValue("title",n.trim()),i.view.formContent.validate()&&(e.log("event publish : enox-dialog-creation id : "+i._id),i.modelEvent.publish({event:"enox-dialog-creation",data:{content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id},context:this}),i._withCreateAndClose||(i.view.destroy(),t.hide()))}},{className:"default",value:c.cancel,action:function(e){e.hide()}}];this._withCreateAndClose&&a.push({className:"primary",value:c.createAndClose,action:function(t){var n=i.view.formContent.getValue("title");i.view.formContent.setValue("title",n.trim()),i.view.formContent.validate()&&(e.log("event publish : enox-dialog-creation id : "+i._id),i.modelEvent.publish({event:"enox-dialog-creation",data:{content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id},context:this}),t.hide())}}),this.view.render(),n.dialog({body:this.view.getContent(),title:t.title,buttons:a})},formatContent:function(e){var t=e.getValues();return e.getField("image")&&(t.image=e.getField("image").files[0]),t},formatContentPatch:function(e){var t=e.getValues();return this.view.imageFileInput&&(t.image=this.view.imageFileInput),t}}}),define("DS/xPortfolioUXCommons/XModelListView/js/ContextualMenuTweaker",["DS/ENOXModelListView/ModelListView/js/ContextualMenuTweaker"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)}})}),define("DS/xPortfolioUXCommons/DialogDuplicate/DialogDuplicate",["UWA/Controls/Abstract","UWA/Class/View","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/UIKIT/Input/Button","DS/Controls/LineEditor","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","css!DS/xPortfolioUXCommons/DialogDuplicate/DialogDuplicate.css","i18n!DS/xPortfolioUXCommons/assets/nls/DialogDuplicate/DialogDuplicate"],function(e,t,i,n,o,a,s,r,l,d,c,p,u,h){"use strict";return{render:function(){var e=this;e.content=new i.Element("div",{class:"duplicate-dialog-modal"});var t=new i.Element("div",{class:"dup-view-container"});if(e.selections.length>1){var n=e.selections,s=new i.Element("div",{class:"list-view-container"});s.inject(t);for(var r=new d,u=0;u<n.length;u++){var v=new c({grid:{title:n[u].title,type:n[u].type,revision:n[u].revision,maturity:n[u].maturity}});r.addChild(v)}var m=[{text:h.title,dataIndex:"title",typeRepresentation:"string"},{text:h.type,dataIndex:"type",typeRepresentation:"string"},{text:h.revision,dataIndex:"revision",typeRepresentation:"string"},{text:h.maturity,dataIndex:"maturity",typeRepresentation:"string"}],f=new p({identifier:"DataGridViewDialogDuplpicate",treeDocument:r,columns:m});f.layout.rowsHeader=!1,f.rowSelection="none",f.cellSelection="none",f.inject(s)}var _=i.createElement("div",{class:"addtext-label-container",text:h.add_prefix+":"});e.prefix_input=new a({value:h.copy_of}),e.prefix_input.elements.container.addClassName("addtext-input-container");var w=i.createElement("div",{class:"credentials-label-container",text:h.credentials+":"});e.comboBoxCred=new l({elementsList:e.credentialsInfo,enableSearchFlag:!1,value:e.credValue,recId:"duplicate-dialog-content-popup"}),_.inject(t),e.prefix_input.inject(t),w.inject(t),e.comboBoxCred.inject(t),t.inject(e.content),e.button_grp=i.createElement("div");var g=new o({value:h.duplicate,className:"primary",events:{onClick:function(){var t=e.prefix_input.value;t=t.trim();for(var i=0;i<e.selections.length;i++)e.selections[i].title=t+" "+e.selections[i].title;var n={securityContext:e.comboBoxCred.value,titleIdMap:e.selections};e.modelEvent.publish({event:"enox-dialog-duplication",data:n}),e.selections=[],e.modal.destroy()}}}),S=new o({value:h.cancel,events:{onClick:function(){e.modal.destroy()}}});g.inject(e.button_grp),S.inject(e.button_grp)},show:function(e){var t=this;t.modelEvent=e.channel;var i=h.duplicate+" - ";t.selections=e.selections,t.credValue=e.value,t.credentialsInfo=e.credentials,t.selections.length>1?i=i+t.selections.length+" "+h.objects:1===t.selections.length&&(i+=t.selections[0].title?t.selections[0].title:"");var o=t.selections.length>1?340:200;t.render(),t.modal=new n({animate:!0,autocenter:!0,closable:!0,limitParent:!0,escapeToClose:!0,overlay:!0,resizable:!0,maximizable:!1,visible:!0,className:"enox-dialog-duplicate",title:i,header:null,minHeight:o,minWidth:300,footer:t.button_grp,body:t.content,events:{onClose:function(){t.modal.destroy()}}}).inject(document.body),setTimeout(function(){var e=t.content.querySelector(".addtext-input-container");if(e){var i=e.querySelector("input");i&&(i.setSelectionRange(0,i.value.length),i.focus())}},100)}}}),define("DS/xPortfolioUXCommons/util/ScrollUtil",[],function(){"use strict";return{PIXEL_STEP:10,LINE_HEIGHT:40,PAGE_HEIGHT:800,maxWheelDelta:function(){return{y:10,x:10}},normalizeWheel:function(e){var t=0,i=0,n=0,o=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=i,i=0),n=t*this.PIXEL_STEP,o=i*this.PIXEL_STEP,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(n=e.deltaX),(n||o)&&e.deltaMode&&(1===e.deltaMode?(n*=this.LINE_HEIGHT,o*=this.LINE_HEIGHT):(n*=this.PAGE_HEIGHT,o*=this.PAGE_HEIGHT)),n&&!t&&(t=n<1?-1:1),o&&!i&&(i=o<1?-1:1),{spinX:t,spinY:i,pixelX:n,pixelY:o}}}}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension",["DS/ENOXModelListView/ModelListView/js/ModelListViewTaggerExtension"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)}})}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewEmptyContent",["DS/ENOXModelListView/ModelListView/js/ModelListViewEmptyContent"],function(e){"use strict";return class{constructor(t,i,n,o){return new e(t,i,n,o)}}}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemModel",["UWA/Class/Model"],function(e){"use strict";return e.extend({init:function(e){var t={};if(e.hasOwnProperty("id"))t=e;else if(e.hasOwnProperty("@id"))for(var i in t={id:e["@id"]},e)if(e.hasOwnProperty(i)){var n=e[i];t[i]=n}return Array.prototype.splice.call(arguments,0,1,t),this._parent.apply(this,arguments)}})}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListView",["DS/ENOXModelListView/ModelListView/js/ModelListView"],function(e){"use strict";return class{constructor(t){return new e(t)}}}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewCollectionToolBar",["DS/ENOXModelListView/ModelListView/js/ModelListViewCollectionToolBar"],function(e){"use strict";return class{constructor(t,i,n){return new e(t,i,n)}}}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension",["DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)}})}),define("DS/xPortfolioUXCommons/DialogCreation/RequirementDialogCreation",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/Controls/Button","DS/UIKIT/Input/Text","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/CKEditor/CKEditor","DS/WebappsUtils/WebappsUtils","i18n!DS/xPortfolioUXCommons/assets/nls/DialogCreation/DialogCreation","css!DS/xPortfolioUXCommons/DialogCreation/RequirementDialogCreation.css"],function(e,t,i,n,o,a,s,r,l,d,c,p){"use strict";return{createViewPatch:t.extend({className:"dialog-creation-requirement",setup:function(e){this.fields=e.fields},render:function(){var t=e.createElement("div"),i=e.createElement("label");i.style.color="#3d3d3d",i.setContent(p._content);let o=[];o.push({type:"text",label:p.title,name:"title",errorText:p.titleMandatory,required:!0}),o.push({type:"select",label:p._priority,name:"priority",options:[{label:p._preAssigned,value:"Pre-assigned"},{label:p._low,value:"Low",selected:!0},{label:p._medium,value:"Medium"},{label:p._high,value:"High"},{label:p._urgent,value:"Urgent"}]}),this.fields&&Array.isArray(this.fields)&&this.fields.length>0&&this.fields.forEach(function(t){let i=t.position;i&&e.is(i,"number")&&i>0&&i<=o.length?o.splice(i-1,0,t):o.push(t)}),this.formContent=new n({className:"vertical",fields:o}),this._editor=e.createElement("div",{class:"rich-object-content"}),this._ckEditor=e.createElement("textarea",{class:"ckeEditor-textarea",id:"editor_create_dialogue",placeholder:p._content});var a=c.getWebappsBaseUrl()+"VENREQPlugins/External/ckeditor";for(var s in this._customConfig=a+"/config.js",this._toolbar="Rich",this._plugins={sharedspace:a+"/plugins/sharedspace/",colorbutton:a+"/plugins/colorbutton/",panelbutton:a+"/plugins/panelbutton/",quicktable:a+"/plugins/quicktable/",base64image:a+"/plugins/base64image/",selectall:a+"/plugins/selectall/"},this._extraPlugins="",this._plugins)s&&(this._extraPlugins+=s+",");return this._extraPlugins=this._extraPlugins.slice(0,-1),this.defaultEditorOptions={skin:"office2013,"+a+"/skins/office2013/",customConfig:this._customConfig,extraPlugins:this._extraPlugins,toolbar:this._toolbar,language:window.widget?window.widget.lang:"en",height:"120px",startupFocus:!1,resize_enabled:!1},this.save=function(t){e.log("In Save"),this.hasBeenModified=!1;var i,n,o=t.getData().trim(),a=o.trim().replace(/\n/g,""),s=(i=o.trim(),(n=document.createElement("div")).innerHTML=i,n.textContent||n.innerText);this.attributeList={contentData:a,contentText:s,contentType:"html"}},this._ckEditor.inject(this._editor),this.formContent.inject(t),i.inject(t),this._editor.inject(t),this.container.setContent(t),this}}),disableCreateActions:function(e){var t=document.querySelector(".modal-content .modal-footer #createAnother_button"),i=document.querySelector(" .modal-content .modal-footer #create_button");t&&(e||t.setText(p.creating),t.addClassName("disabled")),i&&i.addClassName("disabled")},show:function(t){var i=this;this.options=t,this._id=t.id,this._parentId=t.parentId?t.parentId:"",this._context=t.context,this._withCreateAndClose=t.withCreateAndClose,this.modelEvent=t.modelEvent;var n=new o({renderTo:document.body,events:{onShow:function(){i.view.ck_editor_textarea=d.replace("editor_create_dialogue",i.view.defaultEditorOptions),i.modelEvent.publish({event:"enox-dialog-on-show"})},onHide:function(){i.modelEvent.publish({event:"enox-dialog-on-hide"}),i.creation_notify_token&&i.modelEvent.unsubscribe(i.creation_notify_token)}}});this.view=new this.createViewPatch(t);var a=[{className:i._withCreateAndClose?"default":"primary",id:"createAnother_button",value:p.createAnother,action:function(t){i.view.save(i.view.ck_editor_textarea);var n=i.view.formContent.getValue("title");if(i.view.formContent.setValue("title",n.trim()),i.view.formContent.validate()){e.log("event publish : enox-dialog-creation id : "+i._id);let n={content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id};i._parentId&&(n.parentId=i._parentId),i.modelEvent.publish({event:"enox-dialog-creation",data:n,context:this}),i.disableCreateActions(),i._withCreateAndClose||(i.view.destroy(),t.hide())}}},{className:"default",id:"cancel_button",value:p.cancel,action:function(e){e.hide()}}];i.creation_notify_token=i.modelEvent.subscribe({event:"enox-dialog-creation-done"},function(e){var t=document.querySelector(".modal-content .modal-footer #createAnother_button"),n=document.querySelector(".modal-content .modal-footer #create_button");t&&(e||t.setText(p.createAnother),t.removeClassName("disabled")),n&&n.removeClassName("disabled");var o=i.view.formContent.getFields()[0];o&&o.focus()}),this._withCreateAndClose&&a.push({className:"primary",id:"create_button",value:p.create,action:function(t){i.view.save(i.view.ck_editor_textarea);var n=i.view.formContent.getValue("title");if(i.view.formContent.setValue("title",n.trim()),i.view.formContent.validate()){e.log("event publish : enox-dialog-creation id : "+i._id);var o={content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id};i._parentId&&(o.parentId=i._parentId),i.modelEvent.publish({event:"enox-dialog-creation",data:o,context:this}),t.hide()}}}),this.view.render(),n.dialog({body:this.view.getContent(),title:t.title,buttons:a}),i.disableCreateActions(!0),i.view.formContent.getFields().forEach(function(e){e.required&&e.addEvent("input",function(){i.validate()?i.modelEvent.publish({event:"enox-dialog-creation-done",data:!0}):i.disableCreateActions(!0),e.focus()})});var s=i.view.formContent.getFields()[0];s&&s.focus(),document.querySelector(".modal-content ").addEventListener("keyup",function(e){"Enter"==e.key&&"createAnother_button"!=e.target.id&&(i.validate()&&document.querySelector(".modal-content .modal-footer .btn-primary").click())})},validate:function(){var e=!0;return this.view.formContent.getFields().forEach(function(t){t.required&&""===t.value&&(e=e&&!1)}),e},formatContentPatch:function(e){var t=e.getValues();return this.view.attributeList&&(t.contentData=this.view.attributeList.contentData,t.contentText=this.view.attributeList.contentText,t.contentType=this.view.attributeList.contentType),t}}}),define("DS/xPortfolioUXCommons/XModelListView/js/TitleTweaker",["DS/ENOXModelListView/ModelListView/js/TitleTweaker"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)}})}),define("DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil",["UWA/Class","UWA/Core","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,i,n){"use strict";var o=e.singleton({_notificationsMgr:{},_defaultLevel:"info",_appendAppNameToMsg:!1,_appNameStr:"",_msgLevels:{INFO:"info",WARNING:"warning",ERROR:"error",SUCCESS:"success"},init:function(e){e&&e.appName&&""!=e.appName&&(_appNameStr=e.appName),this._notificationsMgr=i,n.setNotificationManager(this._notificationsMgr)},showMessage:function(e){if(e&&e.message){let t={category:e.category,level:e.level?e.level:this._defaultLevel,message:this._appendAppNameToMsg?this._appNameStr+e.message:e.message,sticky:!!e.isSticky&&e.isSticky,title:e.title?e.title:"",subtitle:e.subtitle?e.subtitle:""};e.action&&(t.action=e.action),this._notificationsMgr.addNotif(t)}},showError:function(e){this._showMessageHelper(e,this._msgLevels.ERROR)},showInfo:function(e){this._showMessageHelper(e,this._msgLevels.INFO)},showSuccess:function(e){this._showMessageHelper(e,this._msgLevels.SUCCESS)},showWarning:function(e){this._showMessageHelper(e,this._msgLevels.WARNING)},_showMessageHelper:function(e,i){e&&""!==e&&(t.is(e,"string")?this.showMessage({level:i,message:e}):this.showMessage({level:i,message:e.message,title:e.title,subtitle:e.subtitle,category:e.category}))},removeNotificationFromCategory:function(e,t){n.removeNotifications(e,t)}});return o.init(),o}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemCollection",["UWA/Class/Collection","DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemModel"],function(e,t){"use strict";return e.extend({model:t})}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/WrappedAdvSetView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/ENOXAdvancedSetView/js/ActionsToolbar","DS/ENOXAdvancedSetView/js/ENOXAdvancedSetView","DS/ENOXAdvancedSetView/js/GridScrollView","DS/W3DXComponents/Views/Item/TileView","DS/CoreEvents/ModelEvents","DS/DataDragAndDrop/DataDragAndDrop","DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemModel","DS/Handlebars/Handlebars","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","DS/PlatformAPI/PlatformAPI","i18n!DS/xPortfolioUXCommons/assets/nls/WrappedAdvSetView","css!DS/xPortfolioUXCommons/WrappedAdvSetView/css/WrappedAdvSetView.css"],function(e,t,i,n,o,a,s,r,l,d,c,p,u,h,v){"use strict";var m=[],f=function(){};return f.prototype.init=function(e,t){this._options=t,this._options.enableRefresh=!0,this._parentUpdateChannel=e,this._bridgeModelEvent=new r,this._selectionCount=0,this._initDivs(),this._initSubViews(),this._subscribeToEvents(),this.__pendingClick=0,this.__clearTimeout=0,this._listSelectedIds=[],this._listSelectedObjects=[]},f.prototype._initDivs=function(){var t=this;if(this._container=document.createElement("div"),this._container.classList.add("wrapped-set-view-main-container"),this._titleDiv=document.createElement("div",{id:"titleContainerDiv"}),this._options.showTitle&&(this._titleDiv.classList.add("wrapped-set-view-title-container"),this._container.appendChild(this._titleDiv),this._titleSpan=document.createElement("span"),this._titleSpan.classList.add("wrapped-set-view-title-span"),this._titleSpan.innerHTML=this._options.viewTitle?this._options.viewTitle:"",this._titleDiv.appendChild(this._titleSpan)),this._stdActionbarContainer=e.createElement("div",{id:"filterContainerDiv"}),this._stdActionbarContainer.addClassName("wrapped-set-view-filter-container"),this._advSetViewContainer=e.createElement("div"),this._advSetViewContainer.classList.add("wrapped-set-view-set-container"),this._options.isDroppable){var i=h.MSG_DROP_TO_CREATE_NEW_VALUE?h.MSG_DROP_TO_CREATE_NEW_VALUE:"Drop here to create new Value";this._options.dropMessage&&(i=this._options.dropMessage);var n=e.createElement("div",{styles:{margin:"auto"},html:[{tag:"span",class:"fonticon fonticon-plus",styles:{textAlign:"center",width:"100%",fontSize:"35px"}},{tag:"div",html:i,styles:{textAlign:"center",width:"100%",fontSize:"20px"}}]}),o=e.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute",top:0,border:"5px #368ec4",borderStyle:"dashed",borderRadius:"5px",display:"flex",color:"#368ec4",backgroundColor:"#f6f3f3",opacity:".5"},html:n});l.droppable(this._advSetViewContainer,{over:function(e,i){var n=t._advSetViewContainer.getBoundingClientRect();if(i.x-10>n.left&&i.x+10<n.right&&i.y-10>n.top&&i.y+10<n.bottom){var a=t._advSetViewContainer.offsetTop;return a&&o.getStyle("top")!==a+"px"&&o.setStyles({top:a+"px",height:"calc( 100% - "+a+"px )"}),o.isInjected(t._advSetViewContainer)||o.inject(t._advSetViewContainer),!0}return o.remove(),!1},enter:function(){},leave:function(e,i){var n=t._advSetViewContainer.getBoundingClientRect();(i.x-10<n.left||i.x+10>n.right||i.y-10<n.top||i.y+10>n.bottom)&&o.remove()},drop:function(e,i,n){o.remove();var a=n.dataTransfer.items;t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-drop-event",data:a})}})}this._container.appendChild(this._stdActionbarContainer),this._container.appendChild(this._advSetViewContainer)},f.prototype._initSubViews=function(){var e=this;this._stdActionbar=new p(this._getCollectionToolbarOptions()),this._advSetView=new o(this._getSetViewOptions()),this._advSetView.render().inject(this._advSetViewContainer),this._stdActionbar.inject(this._stdActionbarContainer),this._stdActionbar._modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(t){e._bridgeModelEvent.publish({event:"advanced-set-view-sort",data:[{id:t.sortAttribute,desc:"DESC"===t.sortOrder}]})}),this._stdActionbar._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(t){e._bridgeModelEvent.publish({event:"advanced-set-view-switch",data:{id:t}})}),this._hideDefActionbar(),m.push(this._stdActionbar)},f.prototype._subscribeToEvents=function(){var t=this;this._options.enableRefresh&&u.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(i){e.log("Events from PlatformAPI"),(i&&i.data&&i.data.authored&&i.data.authored.modified?i.data.authored.modified:[]).forEach(function(i){i&&(t._options.collection.get(i)?t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-refresh-item",data:i}):e.log("This WrappedAdvSetView instance's collection does not have this id!!!"))})}),this._advSetView.listenTo(this._advSetView,{onItemViewClick:function(){e.log("On ItemView click");var i=arguments&&arguments.length>=3?arguments[2].model.id:null,n=arguments&&arguments.length>=3?arguments[2].model._attributes.name:null,o=arguments&&arguments.length>=3?arguments[2].model._attributes.version:null;t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-item-click",data:{id:i,name:n,version:o}})}}),this._advSetView.listenTo(this._advSetView,{onItemViewDblClick:function(){e.log("onItemViewDblClick");var i=arguments&&arguments.length>=3?arguments[2].model.id:null,n=arguments&&arguments.length>=3?arguments[2].model._attributes.name:null,o=arguments&&arguments.length>=3?arguments[2].model._attributes.version:null,a={};arguments.length>=3&&(a=arguments[2].model.toJSON(),arguments[2].unSelect({silent:!0})),e.merge(a,{id:i,name:n,version:o}),t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-item-dbl-click",data:a})}}),this._bridgeModelEvent.subscribe({event:"advanced-set-view-filtered"},function(){var e=t._advSetView.filteredCollection?t._advSetView.filteredCollection.length:0;t._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:e})}),this._parentUpdateChannel.subscribe({event:"wrapped-adv-set-view-resize"},function(e){for(var t,i=0;i<this.length;i++)if(this[i]._container.offsetWidth>0){t=this[i];break}t&&t._resize(),e&&"function"==typeof e&&e()}.bind(m)),this._parentUpdateChannel.subscribe({event:"wrapped-adv-set-view-fetch-selection-count"},function(e){e&&"function"==typeof e&&e(t._selectionCount)}),this._parentUpdateChannel.subscribe({event:"wrapped-adv-set-view-filter"},function(e){t._bridgeModelEvent.publish({event:"advanced-set-view-filter",data:e})}),this._bridgeModelEvent.subscribe({event:"advanced-set-view-filtered"},function(e){t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filtered",data:e})})},f.prototype.getSelectedIds=function(){return this._listSelectedIds},f.prototype.getSelectedObjects=function(){return this._listSelectedObjects},f.prototype.inject=function(e){e.appendChild(this._container)},f.prototype.getContent=function(){return this._container},f.prototype.destroy=function(){this._container&&this._container.parentElement&&this._container.parentElement.removeChild(this._container)},f.prototype._hideDefActionbar=function(){var e=this._container.getElementsByClassName("advanced-set-view-header set-header");e.length>0&&e[0].style.setProperty("display","none")},f.prototype._setReferenceCollection=function(e){this._advSetView.currentViewId&&this._advSetView.contentsViews&&this._advSetView.contentsViews[this._advSetView.currentViewId].nestedView&&this._advSetView.contentsViews[this._advSetView.currentViewId].nestedView.deactivateMultisel(),this._advSetView.collection.set(e.toArray()),this._advSetView._referenceCollection=e.clone();var t=this._advSetView.collection?this._advSetView.collection.length:0;this._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:t})},f.prototype._getSetViewOptions=function(){var t=this,i=e.clone(t._options.itemViewMapping||{});e.merge(i,{title:"title",content:"description",image:"image"});var o=t._options.filters?t._options.filters:[];return{collection:t._options.collection,lazyRender:!0,contents:{selectionMode:"nullToMany",useInfiniteScroll:!1,views:[{id:"tile",title:h.TILE?h.TILE:"Tile",view:a,itemView:s},{id:"thumbnail",title:h.THUMBNAIL?h.THUMBNAIL:"Thumbnail",view:a}],itemViewOptions:{mapping:i,attributes:{draggable:!0},contextualActions:t._options.contextualActions?t._options.contextualActions:[]},events:{onItemViewDrag:function(e,t,i){if(t&&t.model){var n=t.model.toJSON(),o={envId:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",serviceId:"3DSpace",contextId:"",objectId:n.id,objectType:"Hardware Product",displayName:n.name,displayType:"Hardware Product"},a={protocol:"3DXContent",version:"1.1",source:"xModelApp",widgetId:widget.id,data:{items:[o]}};i.dataTransfer.setData("Text",JSON.stringify(a))}},onAddSelection:function(){t.__pendingClick+=1,t.__pendingClick>=2&&clearTimeout(t.__clearTimeout);var i=arguments;t.__clearTimeout=setTimeout(function(){if(t.__pendingClick>=2)t.__pendingClick=0;else if(i&&i.length<2)e.log("Wrapped Adv Set view: Problem with received arguments!!!");else{var n=i[0].getSelection();t.__updateSelectedIdsAndObjectsList(n),t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-selection-on-add",data:{parentView:i[0],itemView:i[1],unselectedId:i[1].id,selectedObject:{id:i[1].id,attributes:i[1].attributes?i[1].attributes:i[1]._attributes?i[1]._attributes:[]},selectionCount:t._selectionCount,selectedIds:t._listSelectedIds,selectedObjects:t._listSelectedObjects}}),t.__pendingClick=0}},500)},onRemoveSelection:function(){if(arguments&&arguments.length<2)e.log("Wrapped Adv Set view: Problem with received arguments!!!");else{var i=arguments[0].getSelection();t.__updateSelectedIdsAndObjectsList(i),e.log("Wrapped Adv Set view: Item view onRemoveSelection: selection count: "+t._selectionCount),t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-selection-on-remove",data:{parentView:arguments[0],itemView:arguments[1],unselectedObject:{id:arguments[1].id,attributes:arguments[1].attributes?arguments[1].attributes:arguments[1]._attributes?arguments[1]._attributes:[]},unselectedId:arguments[1].id,selectionCount:t._selectionCount,allSelectedIds:t._listSelectedIds,allSelectedObjects:t._listSelectedObjects}})}},onDeactivateMultisel:function(){t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-selection-on-remove-all",data:arguments[1]});var e=arguments[0].getSelection();t.__updateSelectedIdsAndObjectsList(e)}}},events:{onInfiniteScroll:function(t){var i=t.collection,n={type:"json",onComplete:function(){t.scrollView.endLoading()}};null===i.state.totalRecords?i.getFirstPage(n):i.hasNextPage()?i.getNextPage(e.extend(n,{remove:!1,reset:!1})):(t.container.removeClassName("loading"),t.scrollView.useInfiniteScroll(!1))}},actions:{view:n,collection:function(){var e=[];return e.push({id:"filterby",title:"Filter By",overflow:!1,type:"filter",multiSelect:!0,key:[{name:"type",value:"Part",label:""},{name:"type",value:"Model",label:"Only models"}]}),e.push({id:"sortby",title:"Sort By",overflow:!1,type:"sort",key:[{name:"name",label:""},{name:"description",label:"Description"},{name:"type",label:"Type"},{}]}),e},modelEvents:t._bridgeModelEvent,events:{onActionClick:function(){e.log("action clicked")}}},buildMultiselActions:function(){var t=[];return t.push({id:"delete",multisel:!0,text:"Remove",fonticon:"trash",handler:function(){e.log("delete")}}),t},modelEvents:t._bridgeModelEvent,filters:o}},f.prototype._getCollectionToolbarOptions=function(){var t=this._options.actionBarOptions?this._options.actionBarOptions:{};return e.merge(t,{withmultisel:!1,showItemCount:!0,filter:{},actions:[],sort:[{id:"name",text:"Name",type:"string"}],views:[{id:"tile",text:h.TILE?h.TILE:"Tile",fonticon:"view-small-tile"},{id:"thumbnail",text:h.THUMBNAIL?h.THUMBNAIL:"Thumbnail",fonticon:"view-small-thb"}]}),t},f.prototype._getSorter=function(e){return function(t,i){return t._attributes[e]&&i._attributes[e]&&t._attributes[e]>i._attributes[e]?1:-1}},f.prototype._addSortersInAdvSetView=function(){this._advSetView.addCustomSorter("version",this._getSorter("version")),this._advSetView.addCustomSorter("id",this._getSorter("id")),this._advSetView.addCustomSorter("name",this._getSorter("name")),this._advSetView.addCustomSorter("type",this._getSorter("type"))},f.prototype.addItem=function(t,n){if(n){var o=this,a=o._advSetView.currentViewId,s=o._advSetView.contentsViews[a],r=!!s&&o._advSetView.contentsViews[a].nestedView;r&&r.listenToOnce(r,"onAfterItemAdded",function(e){this.deactivateMultisel(),this.addSelection(e.model),o._advSetView.scrollToItemView(e.model,{view:s})})}if(t instanceof i)this._advSetView.collection.add(t),this._advSetView._referenceCollection.add(t),this._options.collection.add(t);else if(e.is(t,"object")){var l=new d(t);this._advSetView.collection.add(l),this._advSetView._referenceCollection.add(l),this._options.collection.add(l)}var c=this._advSetView.collection?this._advSetView.collection.length:0;this._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:c})},f.prototype.__updateSelectedIdsAndObjectsList=function(t){var i=this;this._listSelectedIds=[],this._listSelectedObjects=[],t&&t.length>0?(t.forEach(function(e){e&&e.id&&(i._listSelectedIds.push(e.id),i._listSelectedObjects.push({id:e.id,attributes:e.attributes?e.attributes:e._attributes?e._attributes:[]}))}),this._selectionCount=t.length):this._selectionCount=0,e.log("Wrapped Adv set view:__updateSelectedIdsAndObjectsList: Selection count: "+this._selectionCount)},f}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/WrappedAdvSetViewWithFilters",["DS/xPortfolioUXCommons/WrappedAdvSetView/js/WrappedAdvSetView","DS/WildcardSearchComponent/WildcardSearchComponent","DS/TaggerOnIndexComponent/TaggerOnIndexComponent"],function(e,t,i){"use strict";var n=function(){this.WrappedAdvSetView=new e};return n.prototype.init=function(e,n,o){this.tagFriends=o.tagFriends,this._CSearch=[],this._idProxy=e;var a=this;o.filters=o.filters?o.filters:[],o.filters.push({id:"tagFilter",callback:function(e,t){var i=!0,n=a.getTagProxy(a._idProxy);return e.WrappedAdvSetViewFilters||(e.WrappedAdvSetViewFilters={}),e.collection&&e.collection._models&&e.collection._models[t]?-1===n.filteredSubjectList.indexOf(e.collection._models[t].id)?e.WrappedAdvSetViewFilters.WASVFTagger=!1:e.WrappedAdvSetViewFilters.WASVFTagger=!0:-1===n.filteredSubjectList.indexOf(e.id)?e.WrappedAdvSetViewFilters.WASVFTagger=!1:e.WrappedAdvSetViewFilters.WASVFTagger=!0,Object.keys(e.WrappedAdvSetViewFilters).forEach(function(t){!1===e.WrappedAdvSetViewFilters[t]&&(i=!1)}),i}}),o.filters.push({id:"ContextSearchFilter",callback:function(e,t){for(var i=!0,n=[],o=0;o<a._CSearch.length;o++)n.push(a._CSearch[o].id);return e.WrappedAdvSetViewFilters||(e.WrappedAdvSetViewFilters={}),e.collection&&e.collection._models&&e.collection._models[t]?-1===n.indexOf(e.collection._models[t].id)?e.WrappedAdvSetViewFilters.WASVFCSearch=!1:e.WrappedAdvSetViewFilters.WASVFCSearch=!0:-1===n.indexOf(e.id)?e.WrappedAdvSetViewFilters.WASVFCSearch=!1:e.WrappedAdvSetViewFilters.WASVFCSearch=!0,Object.keys(e.WrappedAdvSetViewFilters).forEach(function(t){!1===e.WrappedAdvSetViewFilters[t]&&(i=!1)}),i}}),o.filters.push({id:"GlobalSearchFilter",callback:function(e,t){for(var i=!0,n=[],o=0;o<a._GSearch.length;o++)n.push(a._GSearch[o].id);return e.WrappedAdvSetViewFilters||(e.WrappedAdvSetViewFilters={}),e.collection&&e.collection._models&&e.collection._models[t]?-1===n.indexOf(e.collection._models[t].id)?e.WrappedAdvSetViewFilters.WASVFGSearch=!1:e.WrappedAdvSetViewFilters.WASVFGSearch=!0:-1===n.indexOf(e.id)?e.WrappedAdvSetViewFilters.WASVFGSearch=!1:e.WrappedAdvSetViewFilters.WASVFGSearch=!0,Object.keys(e.WrappedAdvSetViewFilters).forEach(function(t){!1===e.WrappedAdvSetViewFilters[t]&&(i=!1)}),i}}),this._options=o,this._parentUpdateChannel=n,this._TaggerOnIndexComponent=i,this.WrappedAdvSetView.init(n,o),this.WildcardSearch=new t,this._subscribeToEvents()},n.prototype._initContextSearch=function(){var e=this,t=function(t){e._CSearch=t,e.WrappedAdvSetView._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filter",data:[{id:"ContextSearchFilter",exclude:!1}]})};this.WrappedAdvSetView._stdActionbar._modelEvents.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(i){e.WildcardSearch.search(i.searchValue[0],e.WrappedAdvSetView._options.collection,t)})},n.prototype._initSearch=function(){var e=this,t=function(t){e._GSearch=t,e.WrappedAdvSetView._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filter",data:[{id:"GlobalSearchFilter",exclude:!1}]})};this.WrappedAdvSetView._options.applicationChannel&&this.WrappedAdvSetView._options.applicationChannel.subscribe({event:"search-in-current-dashboard"},function(i){e.WildcardSearch.search(i,e.WrappedAdvSetView._options.collection,t)})},n.prototype._initTagger=function(e){var t=this,i={onTagFilterChange:function(){t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filter",data:[{id:"tagFilter",exclude:!1}]})},MyFriends:this.tagFriends};t._TaggerOnIndexComponent.setTagProxy(t._idProxy,i,e)},n.prototype.getTagProxy=function(e){return this._TaggerOnIndexComponent.getTagProxy(e).getCurrentFilter()},n.prototype._initDivs=function(){this.WrappedAdvSetView._initDivs()},n.prototype._initSubViews=function(){this.WrappedAdvSetView._initSubViews()},n.prototype._subscribeToEvents=function(){this._initContextSearch(),this._initSearch()},n.prototype.inject=function(e){this.WrappedAdvSetView.inject(e)},n.prototype.getContent=function(){return this.WrappedAdvSetView.getContent()},n.prototype.destroy=function(){this.WrappedAdvSetView.destroy()},n.prototype._hideDefActionbar=function(){this.WrappedAdvSetView._hideDefActionbar()},n.prototype._setReferenceCollection=function(e){this.WrappedAdvSetView._setReferenceCollection(e);for(var t=[],i=0;i<e._models.length;i++)t.push(e._models[i].get("id"));void 0!==this._options.noPublishOnCreate&&this._options.noPublishOnCreate||this._initTagger(t)},n.prototype.publishTags=function(){for(var e=[],t=0;t<this.WrappedAdvSetView._advSetView._referenceCollection.length;t++)e.push(this.WrappedAdvSetView._advSetView._referenceCollection._models[t].get("id"));0===e.length?this.clearTags():this._initTagger(e)},n.prototype.clearTags=function(){this._TaggerOnIndexComponent.killTagProxy(this._idProxy)},n.prototype._getSetViewOptions=function(){return this.WrappedAdvSetView._getSetViewOptions()},n.prototype._getCollectionToolbarOptions=function(){return this.WrappedAdvSetView._getCollectionToolbarOptions()},n.prototype._getSorter=function(e){return this.WrappedAdvSetView._getSorter(e)},n.prototype._addSortersInAdvSetView=function(){this.WrappedAdvSetView._addSortersInAdvSetView()},n.prototype.addItem=function(e,t){this.WrappedAdvSetView.addItem(e,t)},n.prototype.getSelectedIds=function(){return this.WrappedAdvSetView.getSelectedIds()},n.prototype.getSelectedObjects=function(){return this.WrappedAdvSetView.getSelectedObjects()},n});