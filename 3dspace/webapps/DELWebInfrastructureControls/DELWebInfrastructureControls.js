window.define&&define("DS/DELWebInfrastructureControls/UWAUtils",["UWA/Core","UWA/String","UWA/Object","UWA/Array","UWA/Function","UWA/Date"],function(e,t,i,s,a,n){"use strict";var r={trimLeft:function(e,t){return t||(t="s"),e.replace(new RegExp("^["+t+"]+"),"")},trimRight:function(e,t){return t||(t="s"),e.replace(new RegExp("["+t+"]+$"),"")}};for(var o in r)o in t&&delete r[o];Object.assign(t,r);var l={isPlainObject:function(e){if(window.jQuery&&window.jQuery.isPlainObject)return window.jQuery.isPlainObject(e);if(!e||e.nodeType||"object"!=typeof e||window===e)return!1;if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},isEmptyObject:function(e){return window.jQuery?window.jQuery.isEmptyObject(e):0===Object.keys(e).length},same:function(t,i,s,a,n,r){var o,l=typeof t,c=e.Array.isArraylike(t),u=typeof s;if("string"!==u&&null!==s||(s={null:function(){return!0},i:function(e,t){return(""+e).toLowerCase()===(""+t).toLowerCase()}}[s],u="function"),"function"===u)return s(t,i,a,n);if(s=s||{},t instanceof Date)return t===i;if(-1===r)return"object"===l||t===i;if(l!==typeof i||c!==e.Array.isArraylike(i))return!1;if(t===i)return!0;if(c){if(t.length!==i.length)return!1;for(var d=0;d<t.length;d++)if(o=void 0===s[d]?s["*"]:s[d],!e.Object.same(t[d],i[d],t,i,o))return!1;return!0}if("object"===l||"function"===l){var m=Object.assign({},i),p=null;for(p in t){if(o=void 0===s[p]?s["*"]:s[p],!e.Object.same(t[p],i[p],o,t,i,!1===r?-1:void 0))return!1;delete m[p]}for(p in m)if(void 0===s[p]||!e.Object.same(void 0,i[p],s[p],t,i,!1===r?-1:void 0))return!1;return!0}return!1},subset:function(t,i,s){for(var a in s=s||{},i)if(!e.Object.same(t[a],i[a],s[a],t,i))return!1;return!0},extend:function(){if(window.jQuery&&window.jQuery.extend)return window.jQuery.extend.apply(this,arguments);var e,t,i,s,a,n,r=arguments[0]||{},o=1,l=arguments.length,c=!1;for("boolean"==typeof r&&(c=r,r=arguments[o]||{},o++),"object"==typeof r||isFunction(r)||(r={}),o===l&&(r=this,o--);o<l;o++)if(null!=(e=arguments[o]))for(t in e)s=e[t],"__proto__"!==t&&r!==s&&(c&&s&&(this.isPlainObject(s)||(a=Array.isArray(s)))?(i=r[t],n=a&&!Array.isArray(i)?[]:a||this.isPlainObject(i)?i:{},a=!1,r[t]=this.extend(c,n,s)):void 0!==s&&(r[t]=s));return r}};for(var c in l)c in i&&delete l[c];Object.assign(i,l);var u={isArraylike:function(e){if(!e)return!1;var t=e.length,i=typeof e;if(window.jQuery&&window.jQuery.type&&window.jQuery.isWindow){if(i=window.jQuery.type(e),window.jQuery.isWindow(e))return!1}else if(e===window)return!1;return!(1!==e.nodeType||!t)||("array"===i||"function"!==i&&"string"!==i&&(0===t||"number"==typeof t&&t>0&&t-1 in e))}};for(var d in u)d in s&&delete u[d];Object.assign(s,u);var m={isFunction:function(e){return window.jQuery&&window.jQuery.isFunction?window.jQuery.isFunction(e):e instanceof Function||"function"==typeof e||"[object Function]"===Object.prototype.toString.call(e)}};for(var p in m)p in i&&delete m[p];Object.assign(a,m);var h={setDSDate:function(e){var t;return isNaN(e)?(e.indexOf("@")>0&&(e=(e=e.replace("@"," ")).substr(0,e.lastIndexOf(":"))+" "+e.substr(e.lastIndexOf(":")+1)),t=new Date(e).getTime()):t=1e3*e,(new Date).setTime(t)},toDSDate:function(e){var t=e.toISOString();return t.indexOf("T")>0&&(t=t.replace("T","@")),t.indexOf(".000Z")>0?t=t.replace(".000Z",":GMT"):t.endsWith("Z")&&(t=t.replace("Z",":GMT")),t.indexOf("-")>0&&(t=t.replaceAll("-","/")),t}};for(var f in m)f in n&&delete h[f];Object.assign(n,h);var g={isWindow:function(e){return window.jQuery?window.jQuery.isWindow(e):e&&e===e.window},each:function(t,i,s){if(window.jQuery&&window.jQuery.each)return window.jQuery.each(t,i,s);var a=0,n=t.length,r=e.Array.isArraylike(t);if(s){if(r)for(;a<n&&!1!==i.apply(t[a],s);a++);else for(a in t)if(!1===i.apply(t[a],s))break}else if(r)for(;a<n&&!1!==i.call(t[a],a,t[a]);a++);else for(a in t)if(!1===i.call(t[a],a,t[a]))break;return t}};for(var v in g)v in e&&delete g[v];return Object.assign(e,g),e}),define("DS/DELWebInfrastructureControls/DELWebDocFacet",["UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXAttachmentsUX/AttachmentsPane"],function(e,t,i,s,a){"use strict";return i.extend(t,s,{_docList:null,init:function(e){this._parent(e),e.platformUrls&&!e.platformUrls.platformId&&(e.platformUrls.platformId=window.widget.data.x3dPlatformId||"OnPremise"),this.platformUrls=e.platformUrls,this.collabSpace=e.collabSpace,this._initUI()},_initUI:function(){this.elements.container=e.createElement("div",{class:"relatedDocumentsv2"}),this.attachmentsPane=null},updateFacet:function(){var e=this,t=function(t){if(t)if(null===e.attachmentsPane){var i={parentObject:{parentId:t},connectorOptions:{fetchSecurityContext:function(){return e.collabSpace||window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace")},platformUrls:e.platformUrls||null}};e.attachmentsPane=new a(i),e.attachmentsPane.inject(e.elements.container)}else{if(!t)return;var s={parentId:t};e.attachmentsPane&&(e.attachmentsPane.show(),e.attachmentsPane.options.parentObject.parentId!==t&&e.attachmentsPane.setParentObject(s))}},i=this.getModel();i?"relationship"===i.get("metatype")?this.getOccurrence().addEventOnce("onChange:properties",function(){var i=e.getModel();t(i.get("objectId"))}):t(i.get("objectId")):t()},onRefresh:function(){this.updateFacet()}})}),window.define&&define("DS/DELWebInfrastructureControls/Mask",["UWA/Core","DS/Controls/Loader","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i){"use strict";return{mask:function(s,a,n){var r;this.isMasked(s)&&this.unmask(s),s.addClassName("masked"),r=e.createElement("div",{class:"mask"}),a=e.is(a,"string")?a:i.get("Loading"),e.createElement("div",{class:"mask-wrapper",html:{tag:"div",class:"mask-content",html:[new t({text:a,showButtonFlag:n||!1})]}}).inject(r),r.inject(s);var o=r.getElementsByClassName("wux-controls-loader");o&&o.length&&o[0].dsModel&&o[0].dsModel.show()},unmask:function(e){var t=e.getElement(" > .mask");t&&t.destroy(),e.removeClassName("masked")},isMasked:function(t){return t.hasClassName||e.extendElement(t),t.hasClassName("masked")}}}),window.define&&define("DS/DELWebInfrastructureControls/DELWebTweakerCombobox",["DS/DELWebInfrastructureControls/UWAUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tweakers/TweakerEnum"],function(e,t,i,s){"use strict";var a=s.inherit({}),n=s.prototype.VIEW_MODULES.combo.classObject;return n&&!n._setPossibleValues_DEFAULT&&(n.prototype._setValue_DEFAULT=n.prototype.setValue,n.prototype.setValue=function(s){if(!(this._tweaker instanceof a))return this._setValue_DEFAULT(s);var n=this._tweaker,r=this._view;function o(){if(null!=s){var e=r.elementsList;if(e&&e.length||!r.elementsTree||!r.elementsTree.getAllDescendants||(e=r.elementsTree.getAllDescendants()),e&&0!==e.length&&""!==s&&void 0!==s){for(var t=s.toString(),a=0;a<e.length;a++)if(e[a].constructor&&("TreeNodeModel"===e[a].constructor.name||e[a]instanceof i)&&e[a].options&&e[a].getLabel){if("section"!==e[a].options.comboBoxSemantics){if(s===e[a].getLabel()){r.selectedIndex=a;break}if(e[a].options&&e[a].options.grid&&(s===e[a].options.grid.valueItem||t===e[a].options.grid.valueItem)){r.selectedIndex=a;break}}}else if(s===e[a]||s===e[a].value||t===e[a]||t===e[a].value){r.selectedIndex=a;break}}else r.selectedIndex=-1}}var l=!0;if("function"==typeof n.possibleValues&&!r._isPopupOpened()){this._lockValueUpdate=!0;var c=n.possibleValues();e.Array.isArray(c)?r.elementsList=c.slice(0):c instanceof t?r.elementsTree=c:c instanceof Promise?(l=!1,c.then(function(i){r&&(e.Array.isArray(i)?r.elementsList=i.slice(0):i instanceof t?r.elementsTree=i:e.log("DELWebTweakerCombobox::_loadEntries - unknown type of retElementsList response!","error"),o())})):e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error")}l&&o()},n.prototype._setPossibleValues_DEFAULT=n.prototype.setPossibleValues,n.prototype.setPossibleValues=function(i){if(!(this._tweaker instanceof a))return this._setPossibleValues_DEFAULT(i);if(this._view)if(this._view.removeEventListener("preDropdown",this._loadEntriesBinded),"function"==typeof i)this.__loadEntriesBinded||(this.__loadEntriesBinded=this._loadEntriesBinded,this._loadEntriesBinded=function(){if(this&&this._view){var i=this._tweaker.possibleValues();e.Array.isArray(i)?this._view.elementsList=i.slice(0):i instanceof t?this._view.elementsTree=i:i instanceof Promise?i.then(function(i){this&&this._view&&(e.Array.isArray(i)?this._view.elementsList=i.slice(0):i instanceof t?this._view.elementsTree=i:e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error"))}):e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error")}}.bind(this)),this._view.addEventListener("preDropdown",this._loadEntriesBinded);else{var s=function(){var i=this._tweaker;if(void 0!==i.possibleValues){if("DELWebTweakerCombobox"!==i.valueType){if("enumString"===i.valueType){if("object"===e.typeOf(i.possibleValues)){var s=[];for(var a in i.possibleValues)i.possibleValues.hasOwnProperty(a)&&s.push({value:i.possibleValues[a],label:a});return s}return"array"===e.typeOf(i.possibleValues)?i.possibleValues.map(function(e){return"string"==typeof e?e:{label:void 0===e.label?e.value:e.label,value:e.value,icon:e.icon,description:e.description}}):i.possibleValues}if("enumDyn"===i.valueType&&"function"==typeof i.possibleValues)return[];var n=[];if(i.possibleValues.constructor===Array)for(var r=0;r<i.possibleValues.length;r++);else for(var o in i.possibleValues)"enumValueToProperty"===i.valueType&&n.push({label:i.possibleValues[o],value:o});return n}if(i.possibleValues instanceof t)return i.possibleValues;if("function"==typeof i.possibleValues)return new t}return[]}.call(this);e.Array.isArray(s)?this._view.elementsList=s.slice(0):s instanceof t?this._view.elementsTree=s:s instanceof Promise?s.then(function(i){this&&this._view&&(e.Array.isArray(i)?this._view.returnData=i.slice(0):i instanceof t?this._view.elementsTree=i:e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error"))}):e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error")}}),a}),window.define&&define("DS/DELWebInfrastructureControls/DELWebFormulaBuilder/DELWebFormulaBuilder",["DS/DELWebInfrastructureControls/UWAUtils","DS/Utilities/Dom","DS/Utilities/Array","DS/Controls/SelectionChipsEditor","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Menu/Menu","DS/Utilities/Utils","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,s,a,n,r,o){"use strict";var l=["#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036B","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#ADADAD","#127277","#6D2815","#000000","#4D62BA","#FEE000"];return s.inherit({name:"DELWebFormulaBuilder",publishedProperties:{formulaDocument:{defaultValue:void 0,type:"object",category:"Model"},parameterDocument:{defaultValue:void 0,type:"object",category:"Model"},elementsTree:{defaultValue:function(){var t=new a({});return this.formulaDocument&&e.each(this.formulaDocument.getRoots(),function(e,i){if(i){i.options.nodeType||(i.options.nodeType="formula"),i.options.icons&&i.options.icons.length||(i.options.icons=["math-function"]);var s=Object.assign({originTreeNodeModel:i},i.options);t.addRoot(new n(s))}}),this.parameterDocument&&e.each(this.parameterDocument.getRoots(),function(e,i){if(i){i.options.nodeType||(i.options.nodeType="parameter"),i.options.icons&&i.options.icons.length||(i.options.icons=["math-x-value"]);var s=Object.assign({originTreeNodeModel:i},i.options);t.addRoot(new n(s))}}),t},type:"object",category:"Model"},valueDocument:{defaultValue:new a({}),type:"object",category:"Appearance"},value:{defaultValue:void 0,type:"string",category:"Appearance"},isValid:{defaultValue:!1,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0}},_postBuildView:function(){var e=this;this._parent(),this.elements.container.addClassName(this.name),this._subscribeToEvents(),this._selectionChips&&this._selectionChips.addChip&&!this._selectionChips.addChip_orig&&(this._selectionChips.addChip_orig=this._selectionChips.addChip,this._selectionChips.addChip=function(t){e.selectionChips_addChip(t)})},_subscribeToEvents:function(){var i=this;e.Element.addEvent.call(i._lineEditor.getContent(),"keyup",function(e){i._manageDelimiterCB(e)}),this._lineEditor.addEventListener("click",function(e){e.stopPropagation();var t=i._lineEditor.valueToCommit;t||(t=""),i._showPopup(t)}),this._lineEditor.addEventListener("blur",function(e){e.stopPropagation()}),e.each([this.formulaDocument,this.parameterDocument],function(e,t){if(t&&t.getModelEvents){var s=t.getModelEvents();s&&s.subscribe&&(s.subscribe({event:"addChild"},function(){i._updateValueDocument()}),s.subscribe({event:"removeChild"},function(){i._updateValueDocument()}))}}),this.addEventListener("uncommittedChange",function(e){e.stopPropagation();var t=i._lineEditor.valueToCommit;t||(t=""),i._showPopup(t)}),this.addEventListener("change",function(){for(var s=null,a=i._selectionChips.getAllChipsOptions(),r=0;r<a.length;++r){var o=null,l=a[r],c=l.value;if(c&&c.options||(l.label&&(s||(s=i.elementsTree().getRoots().concat([new n({nodeType:"openParenthesis",label:"("}),new n({nodeType:"closeParenthesis",label:")"})])),e.each(s,function(e,s){if(l.label.toUpperCase()===s.getLabel().toUpperCase()&&(l.label=s.getLabel(),"openParenthesis"===s.options.nodeType||"closeParenthesis"===s.options.nodeType?l.value=new n(s.options):l.value=s,l.id||(l.id="_"+Math.random().toString().substring(2)),s.getIcons().length&&!l.icon&&(l.icon=s.getIcons()[0]),c=s,i._selectionChips.updateChipOptions(r,l),o=i._selectionChips._items[r].associatedChipCellView))if(o.removeClassName("error"),l.icon&&i._selectionChips._items&&i._selectionChips._items[r]){o.querySelectorAll(".wux-ui-3ds:not(.wux-chip-cell-close,.wux-ui-3ds-"+l.icon+")").forEach(function(e){e.remove()});var a=t.generateIcon(l.icon);a&&!o.querySelector(".wux-ui-3ds-"+l.icon)&&(a.setStyles({height:"12px",width:"12px","line-height":"13px","margin-right":l.label?"":"8px"}),o.prepend(a))}else o.querySelectorAll(".wux-ui-3ds").forEach(function(e){e.remove()});return!(c&&c.options)})),c&&c.options)){var u=c.options.nodeType;if("formula"===u)(a.length<r+2||a[r+1].value&&"openParenthesis"!==a[r+1].value.options.nodeType)&&(i._selectionChips.addChips([{label:")",value:new n({nodeType:"closeParenthesis",parentFormula:c,parentFormulaView:i._selectionChips._items[r].associatedChipCellView}),index:r+1},{label:"(",value:new n({nodeType:"openParenthesis",parentFormula:c,parentFormulaView:i._selectionChips._items[r].associatedChipCellView}),index:r+1}]),r+1<a.length&&a.splice(r+1,a.length),a=a.concat(i._selectionChips.getAllChipsOptions().slice(r+1)),i._moveActiveInsertDivToElement(i._selectionChips.elements.container.querySelectorAll(".wux-chip-cell-container")[(r||0)+2]));else{if((o=i._selectionChips._items[r].associatedChipCellView).addClassName(u),"openParenthesis"===u||"closeParenthesis"===u){var d=o.querySelector(".wux-chip-cell-close");d&&d.remove(),t.removeAllEventsOnElement(o),o.removeAttribute("draggable")}if(r>0&&r<a.length-1){var m=o.nextElementSibling||o.nextSibling;m&&m.nodeName&&(m.hasClassName("wux-controls-activeInsertWidget-selectionChips")||"INPUT"===m.nodeName.toUpperCase()&&m.hasClassName(i.name+"-inner-input"))||(m=new e.Element("input",{type:"text",class:i.name+"-inner-input"}),o.after(m),t.addEventOnElement(i,m,"focus",function(e){i._moveActiveInsertDivToElement(e.target)}))}var p=o.previousElementSibling||o.previousSibling;p&&p.nodeName&&"INPUT"===p.nodeName.toUpperCase()&&p.hasClassName(i.name+"-inner-input")?"openParenthesis"===u&&p.remove():"openParenthesis"!==u&&(p=new e.Element("input",{type:"text",class:i.name+"-inner-input"}),o.before(p),t.addEventOnElement(i,p,"focus",function(e){i._moveActiveInsertDivToElement(e.target)}))}}else if("error"!==l.icon){l.icon="error",l.id||(l.id="_"+Math.random().toString().substring(2)),i._selectionChips.updateChipOptions(r,l);var h=l.id;i._selectionChips._items[r].associatedChipCellView.hide(),setTimeout(function(){for(var e=i._selectionChips._items.length-1;e>=0;--e)if(i._selectionChips._items[e]&&i._selectionChips._items[e].chipOptions&&i._selectionChips._items[e].chipOptions.id&&i._selectionChips._items[e].chipOptions.id===h){i._selectionChips._items[e].associatedChipCellView.show();break}},250)}}i._updateValueDocument()}),this.addEventListener("onPostRemove",function(t){if(t&&t.options&&t.options.chips&&t.options.chips.length){var s=[];e.each(t.options.chips,function(t,a){if(a&&a.chipOptions&&a.chipOptions.value&&a.chipOptions.value.options&&"formula"===a.chipOptions.value.options.nodeType){var n=i._selectionChips.getAllChipsOptions(),r=!1;e.each(n,function(e,t){if(!r&&t.value&&t.value.options&&"openParenthesis"===t.value.options.nodeType&&t.value.options.parentFormulaView===a.associatedChipCellView)r=t,s.push(e);else{if(r&&t.value&&t.value.options&&"closeParenthesis"===t.value.options.nodeType&&t.value.options.parentFormulaView===a.associatedChipCellView)return s.push(e),!1;r&&s.push(e)}return!0})}}),s.length>0&&(s=s.sort(function(e,t){return e-t}).reverse(),i._selectionChips.removeChips(s)),i._selectionChips.getNumberOfChips()<=0&&(i._selectionChips.addLastWidget(i._lineEditor),i._selectionChips.elements.activeInsertDiv&&i._selectionChips.elements.activeInsertDiv.remove());var a=i.getContent().querySelectorAll("."+i.name+"-inner-input + ."+i.name+"-inner-input");a&&a.length&&a.forEach(function(e){e.remove()}),i._selectionChips.elements.activeInsertDiv&&i._selectionChips.elements.activeInsertDiv.previousElementSibling&&i._selectionChips.elements.activeInsertDiv.previousElementSibling.hasClassName(i.name+"-inner-input")&&i._selectionChips.elements.activeInsertDiv.previousElementSibling.remove(),i._updateValueDocument()}})},_manageDelimiterCB:function(t){if(t&&t.key)switch(t.key){case" ":case"(":case")":var i=e.String.trimRight(this._lineEditor.valueToCommit,"()\\s");this._validateInput(i),""!==i&&this.focus({preventScroll:!0})}},_validateInput:function(e){function t(e){if("string"==typeof e&&e){var t=(this.value||[]).slice(0),s=!0;return this.uniqueValue?s=i.pushUnique(t,e):t.push(e),s?(this._properties.value.value=t,this._selectionChips&&this._selectionChips.addChip({label:e}),this.fire("change"),!0):(this._selectionChips&&this._selectionChips._flashEffectOnChip("ui-modified",t.indexOf(e)),!1)}}if(this._lineEditor&&(this._lineEditor.value="",this._lineEditor.valueToCommit=""),!this.customValidator)return t.call(this,e);var s=this.customValidator(e);if(!(s instanceof Promise))return t.call(this,s);s.then(function(e){t.call(this,e)}.bind(this))},_moveActiveInsertDivToElement:function(t){t&&t.parentNode&&this._selectionChips&&(this._selectionChips.elements.activeInsertDiv||(this._selectionChips.elements.activeInsertDiv=new e.Element("div",{class:"wux-controls-activeInsertWidget-selectionChips"})),this._selectionChips.elements.activeInsertDiv.setContent(this._lineEditor),this._selectionChips.removeLastWidget(),t.before(this._selectionChips.elements.activeInsertDiv),this._lineEditor.focus())},_showPopup:function(t){var i=this,s=[],a=[];if(i.valueDocument.getRoots().length?a=this.elementsTree().getRoots():this.formulaDocument&&(a=this.formulaDocument.getRoots(),e.each(a,function(e,t){t.options.nodeType||(t.options.nodeType="formula"),t.options.icons&&t.options.icons.length||(t.options.icons=["math-function"])})),e.each(a,function(e,a){a&&(!t||a.getLabel().toLowerCase().indexOf(t.toLowerCase())>=0)&&s.push({type:"PushItem",title:a.getLabel(),fonticon:{content:"wux-ui-3ds wux-ui-3ds-"+a.options.icons[0],family:"DSFontIcon"},nodeType:a.options.nodeType,action:{callback:function(){i._addFromMenu(a)}}})}),s&&s.length>0){var n=this._lineEditor.elements.container.getBoundingClientRect();const e=o.getDocumentOwner(this.elements.container);r.show(s,{display:void 0,input:"mouse",position:{x:n.left,y:n.bottom},submenu:"auto",targetDocument:e},{onShow:()=>{i.elements.container&&i.elements.container.setAttributeNode(e.createAttribute("is-displaying-menu"))},onHide:()=>{i.elements.container&&i.elements.container.removeAttribute("is-displaying-menu")}})}else r.hide()},_addFromMenu:function(e){var t=0;if(this._selectionChips.elements.activeInsertDiv&&this._selectionChips.elements.activeInsertDiv.previousElementSibling){var i=this._selectionChips.elements.activeInsertDiv.previousElementSibling;do{i.hasClassName("wux-chip-cell-container")&&(t=(t||0)+1)}while((i=i.previousElementSibling)&&i)}this._selectionChips._items.length>=t&&this._selectionChips._items[t]&&this._selectionChips._items[t].chipOptions&&("error"===this._selectionChips._items[t].chipOptions.icon&&e.getLabel().indexOf(this._selectionChips._items[t].chipOptions.label)>=0?this._selectionChips.removeChip(t):t>0&&"error"===this._selectionChips._items[t-1].chipOptions.icon&&e.getLabel().indexOf(this._selectionChips._items[t-1].chipOptions.label)>=0&&(this._selectionChips.removeChip(t-1),t--)),this._selectionChips.addChip({label:e.getLabel(),value:e,index:t,id:"_"+Math.random().toString().substring(2),icon:e.getIcons()[0]}),this._lineEditor.valueToCommit=this._lineEditor.value="",this._updateValueDocument()},_updateValueDocument:function(){var t=this;t.valueDocument.prepareUpdate(),t.valueDocument.getRoots().length&&t.valueDocument.empty();var i=[],s=t._selectionChips?t._selectionChips.getAllChipsOptions():[],a=null,r=[],o=[];if(e.each(s,function(l,c){c.index=l;var u=c.value;if(u&&u.options){if("closeParenthesis"===u.options.nodeType){if(!u.options.parentFormula&&l>0&&s[l-1]){var d=l-1;o.length&&(d=o.pop()),s[d]&&s[d].value&&s[d].value.options&&"openParenthesis"===s[d].value.options.nodeType&&(u.options.parentFormula=s[d].value.options.parentFormula,u.options.parentFormulaView=s[d].value.options.parentFormulaView,t._selectionChips._items[l].associatedChipCellView.querySelector(".wux-chip-cell-label").setStyle("color",t._selectionChips._items[d].associatedChipCellView.querySelector(".wux-chip-cell-label").getStyle("color")))}return a&&!a.hasChildren()&&(l>1?i.push(s[l-2]):i.push(c)),void(a=a.getParent()||a)}if("openParenthesis"!==u.options.nodeType){if("formula"===u.options.nodeType||"parameter"===u.options.nodeType){var m="formula"===u.options.nodeType?t.formulaDocument:t.parameterDocument;if(m){var p=!1;if(e.each(m.getRoots(),function(e,t){return t&&t.getLabel&&t.getLabel()&&(p=t.getLabel()===u.getLabel()),!p}),!p)return c.value=null,void r.push(c)}}var h=Object.assign({},u.options),f=new n(h);a?a.addChild(f):t.valueDocument.addRoot(f),"formula"===h.nodeType&&(a=f),t._setFunctionColor(t._selectionChips._items[l],f.getNodeDepth())}else if(o.push(l),!u.options.parentFormula&&l>0&&s[l-1]&&s[l-1].value){u.options.parentFormula=s[l-1].value,u.options.parentFormulaView=t._selectionChips._items[l-1].associatedChipCellView;var g=u.options.parentFormulaView.querySelector(".wux-ui-3ds");g&&t._selectionChips._items[l].associatedChipCellView.querySelector(".wux-chip-cell-label").setStyle("color",g.getStyle("color"))}}else r.push(c)}),t.valueDocument.pushUpdate(),t.isValid=s.length>0&&0===r.length,this.isValid)i.length>0?(t.isValid=!1,t.fire("invalid",{emptyFunctions:i})):(t.fire("valid"),s&&s.length?t._selectionChips.removeLastWidget():(t._selectionChips.addLastWidget(t._lineEditor),t._selectionChips.elements.activeInsertDiv&&t._selectionChips.elements.activeInsertDiv.remove()));else{if(r&&r.length&&t._selectionChips&&t._selectionChips._items){t.valueDocument.prepareUpdate();var l=t._selectionChips._items;e.each(r,function(e,i){l&&l.length>i.index+1&&l[i.index].associatedChipCellView&&l[i.index].chipOptions&&i.id===l[i.index].chipOptions.id&&t._addErrorToChipCellView(l[i.index].associatedChipCellView,i)}),t.valueDocument.pushUpdate()}t.fire("invalid",{chips:r})}},_addErrorToChipCellView:function(e,i){var s=t.generateIcon("error");s&&e&&!e.querySelector(".wux-ui-3ds-error")&&(s.setStyles({height:"12px",width:"12px","line-height":"13px","margin-right":i&&i.label?"":"8px"}),e.addClassName("error"),e.prepend(s))},_setFunctionColor:function(t,i){for(var s=this,a=0;a<100&&i>=l.length-1;++a){var n="#"+Math.floor(16777215*Math.random()).toString(16).toUpperCase();"#FFFFFF"!==n&&l.indexOf(n)<0&&l.push(n)}if(t&&t.associatedChipCellView&&i<l.length){var r=t.associatedChipCellView.querySelector(".wux-ui-3ds");r&&r.setStyle("color",l[i]);var o=s._selectionChips.getAllChipsOptions(),c=!1;e.each(o,function(e,a){var n=null;return!c&&a.value&&a.value.options&&"openParenthesis"===a.value.options.nodeType&&a.value.options.parentFormulaView===t.associatedChipCellView?(c=a,n=s._selectionChips._items[e].associatedChipCellView.querySelector(".wux-chip-cell-label")):c&&a.value&&a.value.options&&"closeParenthesis"===a.value.options.nodeType&&a.value.options.parentFormulaView===t.associatedChipCellView&&(n=s._selectionChips._items[e].associatedChipCellView.querySelector(".wux-chip-cell-label")),n&&n.setStyle("color",l[i]),!c||!n||c!==n})}return l[i]||""},selectionChips_addChip:function(e){var t=this._selectionChips,i=[e],s=null,a="error",r=t._preventEventsCpt;if(e&&e.value&&e.value.options&&(a=e.value.options.nodeType),"formula"===a?(t._preventEventsCpt=!0,t._addMultipleChips=!0):"error"===a&&(e.id||(e.id="_"+Math.random().toString().substring(2))),!("index"in e)){var o=this.getContent().querySelector(".wux-controls-activeInsertWidget-selectionChips");for(e.index=0;o&&(o.previousElementSibling||o.previousSibling);)o.hasClassName&&o.hasClassName("wux-chip-cell-container")&&e.index++,o=o.previousElementSibling||o.previousSibling}this._lineEditor&&(this._lineEditor.value="",this._lineEditor.valueToCommit="");var l=t.addChip_orig(e);if("index"in(e=Object.assign(e,l.chipOptions))&&null!==e.index&&!isNaN(e.index)&&t._items&&t._items.length>e.index+1&&t._items[e.index].associatedChipCellView&&t._items[e.index+1].associatedChipCellView){s=this._selectionChips._items[e.index].associatedChipCellView,a&&s.addClassName(a);var c=null,u=null;if(e.index>=0&&t._items[e.index+1]&&t._items[e.index+1].associatedChipCellView){if("formula"!==a){c=t._items[e.index+1].associatedChipCellView;do{if(!((c=c.previousElementSibling||c.previousSibling)&&c.nodeName&&(c.hasClassName("wux-controls-activeInsertWidget-selectionChips")||"INPUT"===c.nodeName.toUpperCase()&&c.hasClassName(this.name+"-inner-input"))))break;u=c}while(c)}u?u.before(s):t._items[e.index+1].associatedChipCellView.before(s)}else t._items[e.index-1].associatedChipCellView.after(s)}if("formula"===a){var d=[{label:")",value:new n({nodeType:"closeParenthesis",parentFormula:e.value,parentFormulaView:t._items[e.index].associatedChipCellView}),index:(e.index||0)+1},{label:"(",value:new n({nodeType:"openParenthesis",parentFormula:e.value,parentFormulaView:t._items[e.index].associatedChipCellView}),index:(e.index||0)+1}];t.addChips(d),this._moveActiveInsertDivToElement(t.elements.container.querySelectorAll(".wux-chip-cell-container")[(e.index||0)+2]),i=i.concat(d),t._preventEventsCpt=r,t._addMultipleChips=!1}else a&&"error"!==a||(s=l?l.associatedChipCellView:null,this._addErrorToChipCellView(s,e));t._addMultipleChips||0===t._preventEventsCpt&&(t.fire("change"),t.fire("onPostAdd",{chips:i}))},setValueFromString:function(t){if(!t||"string"!=typeof t)return e.log("DELWebFormulaBuilder::setValueFromString - invalid input string = "+(t||"")),void this.fire("invalid");var i=(t=(t=(t=(t=t.replace(/\s/g,"")).replace(/\(/g," ( ")).replace(/\)/g," ) ")).replace(/  /g," ").replace(/ ,/g,",").replace(/, /g,",")).trim().split(/[\s,]/);if(i.length<1)return e.log("DELWebFormulaBuilder::setValueFromString - invalid input string = "+(t||"")),void this.fire("invalid");this.value=i},getValueAsString:function(){var t=this,i="";return this.value&&Array.isArray(this.value)&&(i="",e.each(t.value,function(e,s){i&&[",","(",")"].indexOf(s)<0&&e>0&&[",","("].indexOf(t.value[e-1])<0&&(i+=","),i+=s})),i}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebAjaxModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/CoreEvents/Events","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,s,a,n,r,o,l){"use strict";var c={},u=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:null,d=t.singleton({init:function(t){this._parent&&this._parent.apply(this,arguments),t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&(this.options=Object.assign(this.options,t)),this.setupCompassConfig(),this.setupWebRoot()},setCacheObject:function(t){t&&e.Object.isPlainObject(t)&&(c=t)},getCacheObject:function(){return c},setupWebRoot:function(){if(u)return u;var t=null,i=(t=window.widget&&window.widget.environment&&"uwa"!==window.widget.environment.name&&window.widget.getUrl?e.createElement("a",{href:window.widget.getUrl()}):e.createElement("a",{href:window.location.href})).pathname.indexOf("/",1);u=i<0?t.pathname:t.pathname.substring(0,i),e.log("in DELWebResourceParameterModel: initial webroot = "+u);var s=t.origin||"";return s||(t.protocol&&t.hostname?(s=t.protocol+"//"+t.hostname,t.port&&(s+=":"+t.port)):window.steal&&window.steal.isRhino&&(s="http://127.0.0.1")),"/"!==u[0]&&window.Configuration&&(u="/"+window.Configuration.webroot||""),u=s+u},setupCompassConfig:function(){var e=d;window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=window.enoviaServerCAWidget&&window.enoviaServerCAWidget.contextUser?window.enoviaServerCAWidget.contextUser:null,!window.COMPASS_CONFIG.userId&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&(window.COMPASS_CONFIG.userId=window.Foe.Model.Session.get("user")),!window.COMPASS_CONFIG.userId&&!window.widget.standalone&&a&&a.getUser&&a.getUser()&&(window.COMPASS_CONFIG.userId=a.getUser().login),!window.COMPASS_CONFIG.userId&&window.top&&(window.COMPASS_CONFIG.userId=window.top.dsUserLogin),!window.COMPASS_CONFIG.userId&&window.widget.standalone&&this.useFixtures()&&(window.COMPASS_CONFIG.userId="foe_session_fixture")),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=window.widget.lang||window.$&&window.$.jsperanto&&window.$.jsperanto.lang()),window.COMPASS_CONFIG.myAppsBaseUrl||(c.platform_services&&c.platform_services["3DCompass"]?window.COMPASS_CONFIG.myAppsBaseUrl=c.platform_services["3DCompass"]:window.widget.standalone?c.platform_services&&c.platform_services["3DSpace"]?window.COMPASS_CONFIG.myAppsBaseUrl=c.platform_services["3DSpace"]:u&&(window.COMPASS_CONFIG.myAppsBaseUrl=u):window.COMPASS_CONFIG.userId&&e.getServiceUrl({serviceName:"3DCompass"}).then(function(e){if(!e||"string"!=typeof e){if(!window.widget.standalone)return void reject(new Error("invalid 3DSpace URL"));window.COMPASS_CONFIG.myAppsBaseUrl?e=window.COMPASS_CONFIG.myAppsBaseUrl:c.platform_services&&c.platform_services["3DSpace"]&&(e=c.platform_services["3DSpace"])}window.COMPASS_CONFIG.myAppsBaseUrl=e}))},getPlatformServices:function(t){var s=d;return new i(function(i,a){var r=null;if(t||(t={}),!t.platformId&&window.widget.data&&(t.platformId=window.widget.data.x3dPlatformId),c.platform_services&&!1!==t.blnCachedOk&&(e.Object.isPlainObject(c.platform_services)&&!e.Object.isEmptyObject(c.platform_services)||Array.isArray(c.platform_services)&&c.platform_services.length))return e.Object.isPlainObject(c.platform_services)?r=Object.assign({},c.platform_services):Array.isArray(c.platform_services)&&(r=c.platform_services.slice(0)),i(r),r;window.COMPASS_CONFIG&&window.COMPASS_CONFIG.userId||s.setupCompassConfig(),u&&(window.widget.standalone||"uwa"===window.widget.environment.name)&&(c._i3DXCompassPlatformServices_timeout=setTimeout(function(){return delete c._i3DXCompassPlatformServices_timeout,(!c.platform_services||Array.isArray(c.platform_services)&&!c.platform_services.length)&&(c.platform_services={"3DCompass":u,"6WTags":u,"3DSpace":u,"3DSearch":!1},e.String.contains(window.widget.getUrl(),"TSK9436287=1")&&s.useFixtures()&&(c.platform_services.orderdatamgmt=u),e.String.contains(window.widget.getUrl(),"TSK9232963=1")&&s.useFixtures()&&(c.platform_services.r2vsurvey=u)),s.getPlatformServices(t).then(i,a)},5e3)),n.getPlatformServices({platformId:t.platformId,config:window.COMPASS_CONFIG,onComplete:function(t){c._i3DXCompassPlatformServices_timeout&&(clearTimeout(c._i3DXCompassPlatformServices_timeout),delete c._i3DXCompassPlatformServices_timeout);var a=t;t&&t.length&&(a=t[0]),e.String.contains(window.widget.getUrl(),"TSK9436287=1")&&!a.orderdatamgmt&&s.useFixtures()&&(a.orderdatamgmt=u),e.String.contains(window.widget.getUrl(),"TSK9232963=1")&&!a.r2vsurvey&&s.useFixtures()&&(a.r2vsurvey=u),a.r2vsurvey&&!e.String.contains(a.r2vsurvey,"/enovia")&&(a.r2vsurvey+="/enovia"),c.platform_services=a,e.Object.isPlainObject(a)?i(Object.assign({},a)):Array.isArray(a)&&i(a.slice(0))},onFailure:function(t){c._i3DXCompassPlatformServices_timeout&&(clearTimeout(c._i3DXCompassPlatformServices_timeout),delete c._i3DXCompassPlatformServices_timeout),c.platform_services&&e.Object.isPlainObject(c.platform_services)||(c.platform_services={"3DCompass":u,"6WTags":u,"3DSpace":u,"3DSearch":null}),a(t)}})})},getServiceUrl:function(t){var s=d;return new i(function(i,a){t&&t.serviceName?c.platform_services&&c.platform_services[t.serviceName]?i(c.platform_services[t.serviceName]):(window.COMPASS_CONFIG&&window.COMPASS_CONFIG.userId||s.setupCompassConfig(),!t.platformId&&window.widget.data&&(t.platformId=window.widget.data.x3dPlatformId),n.getServiceUrl({platformId:t.platformId,serviceName:t.serviceName,config:window.COMPASS_CONFIG,onComplete:function(s){var a=null;s&&s.length&&(a=1===s.length?s[0].url:s),a||(c.platform_services&&c.platform_services[t.serviceName]?a=c.platform_services[t.serviceName]:!window.widget.standalone||"3DSpace"!==t.serviceName||t.platformId&&"onpremise"!==t.platformId.toLowerCase()||(a=u)),a&&"r2vsurvey"===t.serviceName&&!e.String.contains(a,"/enovia")&&(a+="/enovia"),(!c.platform_services||e.Array.isArray(c.platform_services)&&!c.platform_services.length)&&(c.platform_services={}),c.platform_services[t.serviceName]=a,i(a)},onFailure:function(s){window.widget.standalone&&c.platform_services&&!e.Object.isEmptyObject(c.platform_services)?(e.log("DELWebResourceParameterModel::getServiceURL - onFailure A"),c.platform_services[t.serviceName]||(c.platform_services[t.serviceName]=null,"3DSpace"!==t.serviceName||t.platformId&&"onpremise"!==t.platformId.toLowerCase()||(c.platform_services[t.serviceName]=u)),i(c.platform_services[t.serviceName])):a(s)}})):a(new Error("invalid input params"))})},request:s.request,callAuthenticatedRequest:function(t,a,n,o,l,u){var m=d;return new i(function(i,p){var h=window.Foe,f=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace");if(!f&&!window.widget.standalone&&r)return r.getInstance().getSecurityContext({onSuccess:function(e){if(e&&e.SecurityContext)return window.widget.setValue("pad_security_ctx",e.SecurityContext),m.callAuthenticatedRequest(t,a,n,o,l,u).then(i,p);p(new Error("getSecurityContext"))},onFailure:function(){p(new Error("getSecurityContext"))}});for(;f&&e.String.contains(f,"ctx::ctx::");)f=f.replace("ctx::ctx::","ctx::");window.COMPASS_CONFIG&&window.COMPASS_CONFIG.userId||m.setupCompassConfig();var g=window.COMPASS_CONFIG.userId||"";if(!g&&h&&h.Model&&h.Model.Session){if(!f)for(f=h.Model.Session.get("security_ctx");f&&e.String.contains(f,"ctx::ctx::");)f=f.replace("ctx::ctx::","ctx::"),h.Model.Session.set("security_ctx",f);g||(g=h.Model.Session.get("user"))}var v={Accept:"application/json","Accept-Language":window.widget.lang,"Content-Type":!o||o.constructor&&("FormData"===o.constructor.name||o instanceof window.FormData)?null:"application/json; charset=UTF-8",SecurityContext:f,SecurityToken:g+"|"+f+"|preferred"};c.platform_services&&c.platform_services["3DSearch"]&&0===t.indexOf(c.platform_services["3DSearch"])?(delete v.SecurityContext,delete v.SecurityToken):c.platform_services&&c.platform_services.orderdatamgmt&&0===t.indexOf(c.platform_services.orderdatamgmt)?delete v.SecurityToken:c.platform_services&&c.platform_services.r2vsurvey&&0===t.indexOf(c.platform_services.r2vsurvey)&&(delete v.SecurityContext,delete v.SecurityToken),u&&e.Object.isPlainObject(u)&&e.Object.assign(v,u);var _=null;window.widget.standalone||(_=e.Data.proxies.passport?"passport":"ajax"),window.jQuery&&0==window.jQuery.active++&&window.jQuery.event.trigger("ajaxStart"),s.authenticatedRequest(t,{proxy:_,timeout:12e4,type:a,method:n,async:!0,headers:v,data:o,onComplete:function(t){var s=null;if(t&&"json"===a.toLowerCase()&&"string"==typeof t&&e.String.contains(t,"{")&&(t=JSON.parse(t)),t&&t.infos&&t.infos.sources&&1===t.infos.sources.length&&t.infos.sources[0].error&&"FS_AUTHENTICATION_ERROR__REDIRECT"===t.infos.sources[0].error.errorCode)return s=t.infos.sources[0].error.errorMessage||t.infos.sources[0].error.errorCode,p(s?new Error("Invalid auth: "+s):new Error("Invalid auth")),e.log("Invalid auth: "+s),e.log("-- Details: "+t.infos.sources[0].error.errorCode),d.publish("Auth.LoginRequired",t.infos.sources[0]),p(new Error(s)),!1;if(t&&t.error&&l&&e.Function.isFunction(l)&&"CLOUDVIEW_ERROR__SUMMARY"===t.error.errorCode&&t.error.errors&&t.error.errors.length){var n=!1;return e.each(t.error.errors,function(e,t){return!(n=t&&"CLOUDVIEW_ERROR__INVALID_ROOTS"===t.errorCode)}),n?l(t):p(new Error(t.error)),!1}if(t&&t.error)return s=t.error.errorMessage||t.error.errorCode||"Authenticated Request Error",e.log("Authenticated Request Error: "+s),p(new Error(t.error)),!1;i(t),window.jQuery&&!--window.jQuery.active&&window.jQuery.event.trigger("ajaxStop")},onFailure:function(t,i){if(e.log("Error"),window.jQuery&&!--window.jQuery.active&&window.jQuery.event.trigger("ajaxStop"),i){if("invalid_grant"===i.error){var s=i.error_description?i.error_description:t||"";return p(s?new Error("Invalid auth: "+s):new Error("Invalid auth")),e.log("Invalid auth: "+s),t&&e.log("-- Details: "+t),d.publish("Auth.LoginRequired",i),!1}!i.message&&i.error&&e.Object.isPlainObject(i.error)&&(i.error.errorMessage?i.message=i.error.errorMessage:e.each(i.error,function(e,t){i.message?i.message+="\n"+e+": "+t:i.message=e+": "+t}))}i&&(i.message||i.error)?p(i instanceof Error?i:new Error(i.message||i.error)):t&&(t.message||t.error)?p(t instanceof Error?t:new Error(t.message||t.error)):p(new Error(o))}})})},publishEvent:function(e,t){window.OpenAjax&&window.OpenAjax.hub.publish(e,t);var i={event:e};t&&(i.data=t),this.options&&this.options.modelEvents?this.options.modelEvents.publish(i):o.publish(i)},getReference:function(t){var s=this;return new i(function(i,a){var n={R:Math.random(),class_name:t.class_name?t.class_name:"PRODUCTCFG/VPMReference",Depth:t.Depth||t.depth||0,Minimum:"Minimum"in t?t.Minimum:"True",SkipCheckingResource:!0,ClearServerCache:!!t.blnForceRefresh&&t.blnForceRefresh};e.each(["OXID","PLM_ExternalID","physicalid","search_str","startindex","endindex","class_name","Extensions","SkipCheckingResource","ClearServerCache","searchByAttribute"],function(e,i){i in t&&(n[i]=t[i])}),n.Minimum instanceof Array&&(n.Minimum=JSON.stringify(n.Minimum)),"searchByAttribute"in n||!t.Discipline||(n.searchByAttribute='{"V_discipline":"'+t.Discipline+'"}'),s.getServiceUrl({serviceName:t.serviceName||"3DSpace"}).then(function(r){var o=r+"/resources/DELWebInfrastructureLite/v0/referenceFinder";t.fixtureTag&&"string"==typeof t.fixtureTag&&(o+="?"+t.fixtureTag),s.callAuthenticatedRequest(o,"json","GET",n).then(function(r){var o=s.commonAjaxJsonResponseOK(r,a);if(!o)return o;var u="VPMReference";if(t.class_name&&(u=t.class_name.substr(t.class_name.indexOf("/")+1)),r&&r[u]){var d=r[u],m=!1,p=(t.search_str||"").replace("*","");!m&&s.useFixtures()&&p&&p.length&&(e.each(d,function(e,i){i.V_Name===p||i.PLM_ExternalID===p?m=i:t.search_str.indexOf("*")>0&&i.V_Name&&0===i.V_Name.indexOf(p)&&(m=i)}),m||e.each([c.resource,c.parameter_list,c.parameter],function(i,s){e.each(s||[],function(e,i){return i&&!i.ReferenceOXID&&!i.ReferencePhysicalid&&i.V_Name&&(i.V_Name===p?(d.unshift(i),m=i):t.search_str.indexOf("*")>0&&0===i.V_Name.indexOf(p)&&d.unshift(i)),!m})})),e.each(d,function(i,a){if(s.removeNullAttributes(a),a.MatchResult&&!m&&s.useFixtures()&&t.search_str&&t.search_str.length&&!m&&("DELRmiResourceModel/Resource"===n.Extensions||n.Extensions.indexOf(a.V_discipline)>=0)&&p&&!m){var r=Object.assign({},a);r.PLM_ExternalID=p.replace("*",""),a.children&&!e.Object.isEmptyObject(a.children)&&(r.children=a.children),d.unshift(r),m=r}}),i(d)}else a(l.get("Error"))},a)},a)})},getTree:function(t){var s=this;return new i(function(i,a){if(!t)return e.log("getTree: params must be specified"),void a(new Error("params must be specified"));if(!(t.PLM_ExternalID||t.physicalid||t.OXID||t.QueryList))return e.log("getTree: Either QueryList, PLM_ExternalID, physicalid or OXID must be specified inside params"),void a(new Error("Either QueryList, PLM_ExternalID, physicalid or OXID must be specified inside params"));if(t.QueryList&&(!t.QueryList.length||!(t.QueryList instanceof Array)))return e.log("getTree: QueryList Must be an array with at least one item in it"),void a(new Error("QueryList Must be an array with at least one item in it"));var n=function(e){var t=null;void 0!==e.Minimum&&(t=e.Minimum instanceof Array?e.Minimum.slice(0):e.Minimum);var i=null,a=s.FindPLMObjectInCache(e,"True");return a?(i=void 0!==t?t:["physicalid","V_Name"],a=s.FindPLMObjectInCache(e,i)):null};s.getServiceUrl({serviceName:"3DSpace"}).then(function(r){var o=r+"/resources/DELWebInfrastructureLite/v0/resource/expand?getTree",l={R:Math.random(),url:o,class_name:t.class_name?t.class_name:"PRODUCTCFG/VPMReference",Depth:t.Depth?t.Depth:"0",Minimum:t.Minimum?t.Minimum:"True",QueryList:t.QueryList?t.QueryList:void 0};e.each(["OXID","physicalid","PLM_ExternalID"],function(){var e=this.toString();t[e]&&(l[e]=t[e])});var c={},u=[],d=function(t){if(void 0!==t.CurrentDepth&&t.CurrentDepth>t.Depth)t.CurrentDepth-=1;else{void 0!==t.CurrentDepth?t.CurrentDepth+=1:t.CurrentDepth=0;var i=n(t);if(null!==i){if(t.CurrentDepth===t.Depth)c[i.physicalid||i.OXID]=i;else if(void 0!==i.children){var s=!0;e.each(i.children,function(e,t){var i={physicalid:t.physicalid,OXID:t.OXID,PLM_ExternalID:t.PLM_ExternalID},a=n(i);a?n({physicalid:a.ReferencePhysicalid,OXID:a.ReferenceOXID})||(s=!1):s=!1}),s?(c[i.physicalid||i.OXID]=i,e.each(i.children,function(e,i){var s=n(i),a=n({physicalid:s.ReferencePhysicalid,OXID:s.ReferenceOXID});if(c[s.physicalid||s.OXID]=s,a){var r={physicalid:a.physicalid,OXID:a.OXID,PLM_ExternalID:a.PLM_ExternalID,CurrentDepth:t.CurrentDepth,Depth:t.Depth?t.Depth:0};d(r)}else u.push({PLM_ExternalID:t.PLM_ExternalID,physicalid:t.physicalid,OXID:t.OXID,Depth:t.Depth?t.Depth-t.CurrentDepth:0})})):(t.PLM_ExternalID||t.physicalid||t.OXID)&&u.push({PLM_ExternalID:t.PLM_ExternalID,physicalid:t.physicalid,OXID:t.OXID,Depth:t.Depth?t.Depth-t.CurrentDepth:0})}}else(t.PLM_ExternalID||t.physicalid||t.OXID)&&u.push({PLM_ExternalID:t.PLM_ExternalID,physicalid:t.physicalid,OXID:t.OXID,Depth:t.Depth-t.CurrentDepth});t.CurrentDepth-=1}},m=Object.assign({},l);m.QueryList?e.each(m.QueryList,function(e,t){d(t)}):d(m);var p=function(t,n){s.callAuthenticatedRequest(t,"json","GET",n).then(function(t){var n=s.commonAjaxJsonResponseOK(t,a);if(!n)return n;if(t&&t.Data){var r=Object.assign(t.Data,c);e.each(r,function(e,t){t.plmBaseObjectType&&("DELSCPLogisticsSiteRef"===t.plmObjectTypeInternal?t._objectType="workcenter":"DELSSerializedItem"===t.plmObjectTypeInternal||"VPMReference"===t.plmBaseObjectType&&("Ext(PLMDELMIAModeler/DELSerialNumber).V_SerialNumber"in t||"V_SerialNumber"in t)?t._objectType="execution_resource":"DELSAssetGroup"===t.plmBaseObjectType||"VPMReference"===t.plmBaseObjectType&&"WorkCenter"===t.V_discipline?t._objectType="execution_resource_group":"DELSAssetPool"===t.plmBaseObjectType||"VPMReference"===t.plmBaseObjectType&&"Pool"===t.V_discipline?t._objectType="execution_resource_pool":"DELLmiProductionSystemReference"===t.plmBaseObjectType&&"DELLmiProductionPlanReference"===t.plmObjectTypeInternal?t._objectType="execution_production_plan":"DELLmiWorkPlanSystemReference"===t.plmBaseObjectType||"DELLmiWorkPlanSystemReference"===t.plmObjectTypeInternal||"DELLmiHeaderWorkPlanReference"===t.plmBaseObjectType||"DELLmiHeaderWorkPlanReference"===t.plmObjectTypeInternal?t._objectType="workplan":"DELLmiProductionSystemReference"===t.plmBaseObjectType?t._objectType="process":"DELLmiOperationReference"===t.plmBaseObjectType?t._objectType="process":"DELFmiFunctionReference"===t.plmBaseObjectType?t._objectType="mbom":"DELResourceParameterListReference"===t.plmBaseObjectType?t._objectType="resource_parameter_list":"DELResourcePrm"===t.plmBaseObjectType||"DELResourcePrmINPUT"===t.plmBaseObjectType||"DELResourcePrmOUTPUT"===t.plmBaseObjectType||"DELResourceParameter"===t.plmBaseObjectType?t._objectType="resource_parameter":"R2V_FeatureOfInterest"===t.plmBaseObjectType||"R2V_FeatureState"===t.plmBaseObjectType?t._objectType="r2v_point_cloud_data":["ResourceWarehouseReference","ResourceWarehouseZoneReference","ResourceWarehouseLocationReference"].indexOf(t.plmBaseObjectType)>=0?t._objectType="warehouse":"VPMReference"===t.plmBaseObjectType&&(t._objectType="resource"))}),i(r)}else t&&t.error&&t.error.msg&&t.error.msg.text&&a(t.error.msg.text)},a)},h=null;if(Object.keys(u).length>0)delete l.PLM_ExternalID,delete l.OXID,delete l.physicalid,l.Minimum&&l.Minimum.constructor===Array&&(h=l.Minimum,l.Minimum=JSON.stringify(h)),l.QueryList=JSON.stringify(u),p(o,l);else if(Object.keys(c).length>0){var f={Data:Object.assign({},c)};i(f.Data)}else{if(l.Minimum&&l.Minimum.constructor===Array&&(h=l.Minimum,l.Minimum=JSON.stringify(h)),l.QueryList&&l.QueryList instanceof Object){var g=l.QueryList;l.QueryList=JSON.stringify(g)}p(o,l)}},a)})},getInstance:function(t){var s=this;return new i(function(i,a){return t?t.PLM_ExternalID||t.physicalid||t.OXID||t.QueryList?!t.QueryList||t.QueryList.length&&t.QueryList instanceof Array?void s.getServiceUrl({serviceName:"3DSpace"}).then(function(n){var r=n+"/resources/DELWebInfrastructureLite/v0/instanceFinder";t.Minimum&&"string"==typeof t.Minimum&&"false"!==t.Minimum.toLowerCase()&&"true"!==t.Minimum.toLowerCase()&&(t.Minimum=[t.Minimum]),t.Minimum instanceof Array&&t.Minimum.indexOf("name")>-1&&-1===t.Minimum.indexOf("PLM_ExternalID")&&t.Minimum.push("PLM_ExternalID");var o={R:Math.random(),url:r,Minimum:"Minimum"in t?t.Minimum:"True",blnForceRefresh:"blnForceRefresh"in t?t.blnForceRefresh:"false"};e.each(["physicalid","OXID","PLM_ExternalID","QueryList"],function(e,i){t[i]&&(o[i]=t[i])}),s.callAuthenticatedRequest(r,"json","GET",o).then(function(e){var n=s.commonAjaxJsonResponseOK(e,a);if(!n)return n;if(e&&e.Data){var r={PLMData:e.Data};t.blnForceRefresh&&s.publishEvent("Resource.refresh.done",Object.assign({},r)),i(r)}else e&&(e.error&&e.error.msg&&e.error.msg.text?a(new Error(e.error.msg.text)):a(new Error("invalid response from server")))},a)}):(e.log("getInstance: QueryList Must be an array with at least one item in it"),void a(new Error("QueryList Must be an array with at least one item in it"))):(e.log("getInstance: Either QueryList, PLM_ExternalID, physicalid or OXID must be specified inside params"),void a(new Error("Either QueryList, PLM_ExternalID, physicalid or OXID must be specified inside params"))):(e.log("getInstance: params must be specified"),void a(new Error("params must be specified")))})},getResourceDisciplines:function(t){var s=this;return new i(function(i,a){if(t||(t={}),s._data&&s._data.childrenArrayInterfaces&&(!("blnCachedOk"in t)||t.blnCachedOk)){var n={},r=!1;if(t.V_discipline?Array.isArray(t.V_discipline)?(r=!0,e.each(t.V_discipline,function(e,t){return s._data.childrenArrayInterfaces[t]?n[t]=s._data.childrenArrayInterfaces[t].slice(0):r=!1,r})):s._data.childrenArrayInterfaces[t.V_discipline]&&(n[t.V_discipline]=s._data.childrenArrayInterfaces[t.V_discipline].slice(0),r=!0):s._data.childrenArrayInterfaces.Resource&&(n.Resource=s._data.childrenArrayInterfaces.Resource.slice(0),r=!0),t.blnIncludeParent){var o=t.V_discipline||"Resource";s._data.interfaceDetails&&s._data.interfaceDetails[o]?(n[o]||(n[o]=[]),n[o].push(Object.assign({},s._data.interfaceDetails[o]))):r=!1}if(r)return t.addAdditionalDisciplines&&s._data.childrenArrayInterfaces.AdditionalDisciplines&&(n.AdditionalDisciplines=Object.assign({},s._data.childrenArrayInterfaces.AdditionalDisciplines)),void i(n)}var c={R:Math.random(),class_name:t.class_name?t.class_name:"PRODUCTCFG/VPMReference",Extensions:t.Extensions?t.Extensions:"DELRmiResourceModel/Resource"};t.blnIncludeParent&&(c.blnIncludeParent="True"),"DELRmiResourceModel/Area"!==c.Extensions&&"Area"!==t.V_discipline&&"Area"!==t.disciplineName||(c.Extensions="DELRmiResourceModel/ResourceArea");var u=t.V_discipline||t.disciplineName;Array.isArray(u)&&(u=JSON.stringify(u)),u&&(c.V_discipline=u),s.getServiceUrl({serviceName:"3DSpace"}).then(function(n){var r=n+"/resources/DELWebInfrastructure/v0/interface/getImmediateDerivative?getDisciplines";s.callAuthenticatedRequest(r,"json","GET",c).then(function(n){var r=s.commonAjaxJsonResponseOK(n,a);if(!r)return r;if(n&&n.Data){e.each(n.Data,function(i,a){if("name"===i||!Array.isArray(a))return delete n.Data[i],!0;e.each(a,function(e,t){t&&t.nlsName&&(t.name&&(l["V_discipline."+t.name]=t.nlsName),t.disciplineName&&(l["V_discipline."+t.disciplineName]=t.nlsName))});var r=a.slice(0);if(s._data||(s._data={}),s._data.childrenArrayInterfaces||(s._data.childrenArrayInterfaces={}),t.blnIncludeParent){var o=-1;e.each(r,function(e,t){return t.name===i&&(o=e),o<0}),o>=0&&r.splice(o,1)}return s._data.childrenArrayInterfaces[i]=r,s._data.interfaceDetails||(s._data.interfaceDetails={}),e.each(a,function(e,t){if(!s._data.interfaceDetails[t.name]){if(!t.IconPath&&t.LargeIconPath)t.IconPath=t.LargeIconPath;else if(t.IconPath&&!t.LargeIconPath){var i=t.IconPath.substring(t.IconPath.lastIndexOf("/")+1,t.IconPath.lastIndexOf("."));["I_DELRMAreaSystem","I_DELRMControlDeviceSystem","I_DELRMConveyorSystem","I_DELRMIndustrialMachineSystem","I_DELRMInspectSystem","I_DELRMLogicControllerSystem","I_DELRMManufacturingSetupSystem","I_DELRMNCMachineSystem","I_DELRMOrganizationalSystem","I_DELRMRobotSystem","I_DELRMSensorSystem","I_DELRMStorageSystem","I_DELRMToolDeviceSystem","I_DELRMTransportSystem","I_DELRMUserDefinedSystem","I_DELRMWorkerSystem","I_PPRProductionPlan","I_VPMNavProduct"].indexOf(i)<0?t.LargeIconPath=t.IconPath:t.LargeIconPath=t.IconPath.substr(0,t.IconPath.lastIndexOf("/small/"+i))+"/large/"+i+"108x144.png"}s._data.interfaceDetails[t.name]=Object.assign({},t)}}),!0});var o=Object.assign({},n.Data);return t.addAdditionalDisciplines&&s._data.childrenArrayInterfaces.AdditionalDisciplines&&(o.AdditionalDisciplines=s._data.childrenArrayInterfaces.AdditionalDisciplines),i(o),!0}},a)},a)})},getExtensions:function(t){var s=this;return new i(function(a,n){t||(t={});var r={R:Math.random(),class_name:t.class_name?t.class_name:"PRODUCTCFG/VPMReference"};Array.isArray(r.class_name)&&(r.class_name=JSON.stringify(r.class_name)),"Extensions"in t&&(r.Extensions=t.Extensions?t.Extensions:"DELRmiResourceModel/Resource"),Array.isArray(r.Extensions)&&(r.Extensions=JSON.stringify(r.Extensions)),t.blnIncludeParent&&(r.blnIncludeParent="True"),"DELRmiResourceModel/Area"!==r.Extensions&&"Area"!==t.V_discipline&&"Area"!==t.disciplineName||(r.Extensions="DELRmiResourceModel/ResourceArea");var o=t.V_discipline||t.disciplineName;Array.isArray(o)&&(o=JSON.stringify(o)),o&&(r.V_discipline=o),t.blnCustoOnly&&(r.returnCustoOnly=!0),s._data||(s._data={});var l=JSON.stringify(t);if(!1!==t.blnCachedOk&&!t.blnForceRefresh&&s._data.dictionaryFromType&&s._data.dictionaryFromType["getExtensions-"+l])a&&a(Object.assign({},s._data.dictionaryFromType["getExtensions-"+l]));else{if(s._data.getExtensions_jqXHR){if(s._data.getExtensions_jqXHR[l])return s._data.getExtensions_jqXHR[l].then(function(){return new i(function(e,i){setTimeout(function(){s.getExtensions(t).then(e,i)},500)}).then(a,n)})}else s._data.getExtensions_jqXHR={};s.getServiceUrl({serviceName:"3DSpace"}).then(function(i){if(i&&"string"==typeof i){s._data.dictionaryFromType||(s._data.dictionaryFromType={});var o=i+"/resources/DELWebInfrastructure/v0/interface/getImmediateDerivative";s.useFixtures()&&(o+="?getExtensions",t.class_name?Array.isArray(t.class_name)&&t.class_name.length?o+="&"+t.class_name[0]:o+="&"+t.class_name:t.Extensions&&t.Extensions.substr&&(o+="&"+t.Extensions.substr(t.Extensions.lastIndexOf("/")+1))),s._data.getExtensions_jqXHR[l]=s.callAuthenticatedRequest(o,"json","GET",r).then(function(r){s&&s._data&&s._data.getExtensions_jqXHR&&s._data.getExtensions_jqXHR[l]&&delete s._data.getExtensions_jqXHR[l];var o=s.commonAjaxJsonResponseOK(r,n);if(!o)return o;if(r&&r.Data){r&&r.Data&&(r=r.Data);var c=r,u={},d={};if(e.each(c,function(t,i){(e.Object.isPlainObject(i)||Array.isArray(i))&&(s._data.dictionaryFromType[t]||(s._data.dictionaryFromType[t]={})),i&&i.length&&"name"!==t&&e.each(i,function(e,i){"isOOTB"in i||(i.isOOTB=i.isOOTB||!i.IsCusto||"false"===i.IsCusto&&(!i.IsSpecialization||"false"===i.IsSpecialization)),t===i.name&&(d[t]=i.nlsName,s._data.dictionaryFromType[t]=Object.assign(s._data.dictionaryFromType[t],i))})}),t.blnCustoOnly&&e.each(c,function(t,i){if(Array.isArray(i))for(var s=(i||[]).length-1;s>=0;--s){var a=i[s];a&&e.Object.isPlainObject(a)&&(a.IsCusto||a.isOOTB)||i.splice(s,1)}(!i||i.length<=0)&&delete c[t]}),t.blnGetProperties){s._data.dictionaryFromType[t.class_name]||(s._data.dictionaryFromType[t.class_name]={});var m={classes:Object.keys(r)},p=Object.keys(r);m.classes.indexOf("name")>=0&&(m.classes.splice(m.classes.indexOf("name"),1),p.splice(p.indexOf("name"),1)),m.classes=window.UWA.Json.encode(m.classes),m.classes.length>8e3&&(e.log("DELWebAjaxModel::fix too many lookups at once!"),m.classes=window.UWA.Json.encode(p.slice(0,10)));var h={},f=i+"/resources/DELWebInfrastructure/v0/attributesDictionary";s.useFixtures()&&(f+="?getExtensionProperties",t.class_name?f+="&"+t.class_name:t.Extensions&&t.Extensions.substr&&(f+="&"+t.Extensions.substr(t.Extensions.lastIndexOf("/")+1))),s._data.dictionaryFromType["properties-"+JSON.stringify(m)]&&!1!==t.blnCachedOk&&!t.blnForceRefresh?(s._data.dictionaryFromType["getExtensions-"+l]||(s._data.dictionaryFromType["getExtensions-"+l]=s._data.dictionaryFromType["properties-"+JSON.stringify(m)]),a&&a(Object.assign({},s._data.dictionaryFromType["properties-"+JSON.stringify(m)]))):s._data.getExtensionAttributes_jqXHR=s.callAuthenticatedRequest(f,"json","GET",m).then(function(t){s._data.getExtensionAttributes_jqXHR&&delete s._data.getExtensionAttributes_jqXHR;var i=s.commonAjaxJsonResponseOK(t,n);if(!i)return i;u={},t&&t.results&&t.results.length&&(e.each(t.results,function(t,i){if(e.each(i.properties,function(e,t){h[t.name]||(h[t.name]=t)}),i.name&&r[i.name]){var a={};i.name&&(a.name=i.name),a.properties=i.properties||[],r[i.name].push(a)}s._data.dictionaryFromType[i.name]&&(s._data.dictionaryFromType[i.name].name=i.name,s._data.dictionaryFromType[i.name].nlsName=i.nlsName||i.name),u[i.name]=r[i.name]}),s._data.dictionaryFromType.properties=Object.assign(s._data.dictionaryFromType.properties||{},h)),s._data.dictionaryFromType["properties-"+JSON.stringify(m)]=u,s._data.dictionaryFromType["getExtensions-"+l]=u,a(Object.assign({},u))},n)}else e.each(c,function(t,i){(e.Object.isPlainObject(i)||Array.isArray(i))&&(u[t]=i),i&&i.length&&"name"!==t&&d&&d[t]&&i&&(u[d[t]]=i)}),s._data.dictionaryFromType["getExtensions-"+l]=u,a(Object.assign({},u));return!0}return n(new Error("Unable to retrieve extensions!")),!1},n)}else n(new Error("invalid 3DSpace URL"))},n)}})},commonAjaxJsonResponseOK:function(t,i){var s=t;s.Root&&(s=s.Root);var a=null;if(!s.auth)return(a=s.msg&&s.msg.text?s.msg.text:"")?i&&(window.$&&window.$(".ds_alert").size()>0||i!==window.alert)&&i("Invalid auth: "+a):i&&(window.$&&window.$(".ds_alert").size()>0||i!==window.alert)&&i("Invalid auth"),e.log("Invalid auth: "+a),s.msg&&s.msg.details&&e.log("-- Details: "+s.msg.details),this.publishEvent("Auth.LoginRequired"),!1;if(!s.license)return(a=s.msg&&s.msg.text?s.msg.text:"")?i&&i(a,{type:"license"}):i&&(l&&l.get?i(l.get("Valid License Required"),{type:"license"}):i("Valid License Required",{type:"license"})),e.log("License Check error: "+a),s.msg&&s.msg.details&&e.log("-- Details: "+s.msg.details),this.publishEvent("Auth.LicenseRequired"),!1;if(s.msg&&"success"!==s.msg.type){a=s.msg&&s.msg.text?s.msg.text:"";var n=s.msg&&s.msg.type?s.msg.type:"";"warning"===n&&(n="notice");var r=s.errorDetails||null;return!r&&s.msg.details&&(r={details:s.msg.details}),a?i&&i(a,r,s):i&&i("DELWebAjaxModel::commonAjaxJsonResponseOK :"+n,s.errorDetails),e.log("Error: "+a),s.msg&&s.msg.details&&e.log("-- Details: "+s.msg.details),!1}return!0},commonAjaxErrorHandler:function(e,t,i,s){var a=d;s||(s=window.alert);var n=e;n&&!n.status&&n.xhr&&n.xhr.status&&(n=n.xhr);var r=t.indexOf("abort")<0;if(504===n.status)r=!1;else if(n.responseText&&0===n.responseText.indexOf("{"))try{var o=JSON.parse(n.responseText);o&&o.error&&"invalid_grant"===o.error&&a.commonAjaxJsonResponseOK(o,s),o.error_description&&(i=o.error_description)}catch(e){}r&&s&&s("error request: "+i)},FindPLMObjectInCache:function(t,i){var s=Object.assign({},t),a=null;return e.each(c,function(t){if("platform_services"===t||"point_cloud_assoc"===t)return!0;var n,r,o,l=c[t];if(!l||!e.Object.isPlainObject(l)||e.Object.isEmptyObject(l))return!0;if(!a&&s.physicalid&&(a=l[s.physicalid]),!a&&s.OXID&&(a=l[s.OXID]),a){if(!(i&&i instanceof Array))return!i||"string"==typeof i&&"false"===i.toLowerCase()?!0===a.AllAttributesRetrieved?a:null:a;if(n=a,r=i,o=!0,e.each(r,function(e,t){return o&&(o=n.hasOwnProperty(t)),o}),o)return a}return!a&&void 0}),a},removeNullAttributes:function(t){return t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&e.each(t,function(e,i){null==i||"NULL"===i?delete t[e]:!i&&["V_description","V_Description","V_discipline"].indexOf(e)>=0&&delete t[e]}),t},getPhysicalIDForOXID:function(e){var t="";return!t&&e&&0===e.indexOf("[")&&(t=e.substring(1,e.indexOf(","))),t},useFixtures:function(){return window.Configuration&&window.Configuration.useFixtures||window.widget.getUrl().indexOf("useFixtures=1")>0},addFixture:function(t,i){if(window.$&&window.can&&window.can.fixture)window.can.fixture(t,i);else if(s){s._fixtureData||(s._fixtureData={}),s._fixtureData.overwrites||(s._fixtureData.overwrites=[]);var a=e.clone(t);a.fixture=i,s._fixtureData.overwrites.push(a)}}});if(d.useFixtures()){window.Configuration&&!window.Configuration.webroot&&window.widget&&!window.$&&(window.Configuration.webroot=d.setupWebRoot());var m=function(t){var i=s.request("../DELWebAssetMgmtUI.tst/fixtures/AppsMngt_services.json",{onComplete:function(s){s&&s.platforms&&s.platforms.length&&(e.each(s.platforms,function(t,i){i&&i.services&&e.each(i.services,function(t,i){if(i&&i.url){"3dmfgworkorder"!==i.id||e.String.contains(window.widget.getUrl(),"TSK7719527=1")||(i.id+="_DISABLED");var s=i.url;if(s.indexOf("/3DSpace")>0)s=u;else if(s.indexOf("://")>0){var a=s.indexOf("://"),n=s.substr(0,s.indexOf("/",a+3));s=s.replace(n,location.origin)}i.url=s}})}),i.responseText=JSON.stringify(s)),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})};d.addFixture({type:"get",url:u+"/resources/AppsMngt/api/v1/services"},m),d.addFixture({type:"GET",url:u+"/resources/AppsMngt/api/v1/services"},m),d.addFixture({type:"get",url:u+"/resources/AppsMngt/api/v1/services?cors=true"},m),d.addFixture({type:"GET",url:u+"/resources/AppsMngt/api/v1/services?cors=true"},m),d.addFixture({type:"GET",url:u+"/resources/AppsMngt/api/v1/public/services?cors=true"},m),d.addFixture({type:"get",url:u+"/resources/pno/person/getsecuritycontext"},"../DELWebAssetMgmtUI.tst/fixtures/getSecurityContext.json")}return d}),define("DS/DELWebInfrastructureControls/DELWebSpecificationsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/ENOXSpecificationsUX/SpecificationsPane"],function(e,t,i,s,a,n){"use strict";return t.extend(i,s,{init:function(e){this._parent(e),this._buildView(e)},_buildView:function(){var t=this;this.elements.container=e.createElement("div",{class:"SpecificationDocuments"}),a.getPlatformServices().then(function(i){!i.platformId&&window.widget.data&&(i.platformId=window.widget.data.x3dPlatformId);const s={parentObject:{parentId:t.getSelectedRefId()},connectorOptions:{fetchSecurityContext:function(){return t.options.collabSpace||window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace")},platformUrls:i,getWorkUnderHeaders:function(){var i={};return t.options.authoringCtx&&(i=e.is(t.options.authoringCtx)&&e.is(t.options.authoringCtx.AuthoringContextHeader)?t.options.authoringCtx.AuthoringContextHeader:{}),i}},webinwin:!1},a=n.extend({onRemoved:function(){}});t.SpecificationsPane=new a(s),t.SpecificationsPane.modelEvents.subscribe({event:"upload-attachment-complete"},t.addDocument.bind(t)),t.SpecificationsPane.modelEvents.subscribe({event:"attach-attachment-complete"},t.addDocument.bind(t)),t.SpecificationsPane.modelEvents.subscribe({event:"detach-attachment-complete"},t.deleteDocument.bind(t)),t.SpecificationsPane.inject(t.elements.container)})},getSelectedRefId:function(){var t=this.getModel();if(t){if("relationship"!==t.get("metatype"))return t.get("objectId");e.log("getSelectedRefId FIX ME")}return t.get("objectId")},updateFacet:function(){const e=this.getSelectedRefId();if(!e)return void this.notApplicable();const t={parentId:e};this.SpecificationsPane&&(this.SpecificationsPane.show(),this.SpecificationsPane.options.parentObject.parentId!==e&&this.SpecificationsPane.setParentObject(t))},destroyComponent:function(){this.SpecificationsPane.destroy()},onResize:function(){this.updateFacet()},onRefresh:function(){this.updateFacet()},addDocument:function(e){const t=this;let i={};e.documents&&e.documents.length>0?i=e.documents[0]:e.document&&(i=e.document),t.options.appContext&&t.options.appContext.addDocument?t.options.appContext.addDocument(e.parentObject.parentId,i):t.options.addDocument&&t.options.addDocument(e.parentObject.parentId,i)},deleteDocument:function(e){const t=this;t.options.appContext&&t.options.appContext.deleteDocument?t.options.appContext.deleteDocument(e.parentObject.parentId,e.id):t.options.deleteDocument&&t.options.deleteDocument(e.parentObject.parentId,e.id)}})}),define("DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,s){"use strict";var a=null,n=null,r=null,o=null,l=!1,c=t.singleton({init:function(){var e=window.widget.getPreference("navigateOnIndex");if(e||(e={name:"navigateOnIndex",label:"Navigate on",type:"list",options:[{value:"Index",label:"Index"},{value:"Database",label:"Database"}],value:"Index"},window.widget.addPreference(e)),"Index"===(a=e.value||"Index")){var t=window.widget.getPreference("navigateOnDatabaseStart");if(t&&t.value&&!isNaN(t.value))n=t.value;else if(window.widget.standalone&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session){var i=window.Foe.Model.Session.get("navigateOnDatabaseStart");i&&(t={name:"navigateOnDatabaseStart",label:"Navigate on Database Start",type:"hidden",value:n=parseInt(i)},window.widget.addPreference(t),window.widget.setValue("navigateOnDatabaseStart",n))}}},setDatabase:function(){if(a="Database","Database"!==window.widget.getValue("navigateOnIndex")){n=(new Date).getTime();var e=window.widget.getPreference("navigateOnDatabaseStart");e||(e={name:"navigateOnDatabaseStart",label:"Navigate on Database Start",type:"hidden",value:n},window.widget.addPreference(e)),window.widget.setValue("navigateOnDatabaseStart",n),window.widget.standalone&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.set("navigateOnDatabaseStart",n,!0),this._updateIndexedTimestamp()}},setIndex:function(){a="Index"},isDatabase:function(){a||this.init();var e="Database"===a;if(!e&&n&&(e=(new Date).getTime()-n<=6e5)&&(a="Database"),e&&"Database"!==window.widget.getValue("navigateOnIndex"))if(n?o&&!isNaN(o)&&o>n?e=!1:(new Date).getTime()-n>6e5&&(e=!1):n=(new Date).getTime(),e)if(o){var t=o+1e3;r&&(t+=o-r),(new Date).getTime()>t&&this._updateIndexedTimestamp()}else o||this._updateIndexedTimestamp();else this.setIndex(),n=null,window.widget.deleteValue("navigateOnDatabaseStart"),window.widget.standalone&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.set("navigateOnDatabaseStart",null,!0);return e&&window.widget.getUrl().indexOf("TSK7174741=FORCE")>0?e=!1:!e&&window.widget.getUrl().indexOf("TSK7174741=0")>0&&(e=!0),e},isIndex:function(){return!this.isDatabase()},convertToModelObj:function(t){var i=this,s={_objAttributesFromIndex:{}};t&&t.length||(t=i.convertNavigateExpandObj(t));var a=[];if(e.each(t,function(t,n){if(n&&n.value&&n.name){var r=n.name.substr(n.name.lastIndexOf(":")+1);r=r.substr(r.lastIndexOf(".")+1),s[r]&&(s[r]!==n.value||["v_ctdescription","v_startctdate","v_endctdate"].indexOf(r.toLowerCase())>=0)?Array.isArray(s[r])?(s[r].push(n.value),s._objAttributesFromIndex[r].push(n)):["V_discipline","originated","modified"].indexOf(r)>=0?(s[r]=n.value,s._objAttributesFromIndex[r]=n):(s[r]=[s[r],n.value],s._objAttributesFromIndex[r]=[s._objAttributesFromIndex[r],n]):(s[r]=n.value,s._objAttributesFromIndex[r]=n);var o=r;switch(r.toLowerCase()){case"resourceid":o="physicalid";break;case"identifier":o="PLM_ExternalID";break;case"created":o="originated";break;case"label":case"v_name":o="V_Name";break;case"type":o="plmBaseObjectType";break;case"v_discipline":case"kind":case"ds6w:kind":(!s.V_discipline||s.V_discipline.indexOf(",")>0)&&(o="V_discipline");break;case"ro.delrmicycleexceptionrelation.v_priority":o="V_Priority";break;case"bo.delrmicyclereferenceabstract.v_shiftdata":case"v_shiftdata":o="V_CycleData",n.value=JSON.parse(n.value);break;case"ro.delrmicycleexceptionrelation.v_exceptiondata":case"v_exceptiondata":o="cycleData",n.value=JSON.parse(n.value);break;case"taxonomies":Array.isArray(n.value)?a=a.concat(n.value):"string"==typeof n.value&&n.value.indexOf(",")>0?a=a.concat(n.value.split(",")):a.push(n.value);break;case"ds6wg:closetime.v_startctdate":case"ds6wg:closetime.v_endctdate":case"v_startctdate":case"v_endctdate":case"ro.delrmicyclerelationabstract.v_startdate":case"ro.delrmicyclerelationabstract.v_enddate":case"v_startdate":case"v_enddate":new RegExp("(00|[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9])Z").test(n.value)||(n.value+="Z"),o=i.convertSearchPredicateToAttr(n.name);break;default:o=i.convertSearchPredicateToAttr(n.name)}o!==r&&(s[o]=n.value,s._objAttributesFromIndex[o]=n)}else e.log("DELWebIndexAuthoringMgmt::_convertToModelObj - invalid attribute at idxAttribute = "+t)}),a&&a.length){s.interfaces||(s.interfaces=[]);for(var n=a.length,r=0;r<n;r++){var o=a[r];if(o&&o.indexOf("interfaces/")>=0){var l=o.replace("interfaces/","").split("/");s.interfaces.push(l.reverse())}}}return s},convertNavigateExpandObj:function(e){for(var t=[],i=Object.keys(e),s=i.length,a=0;a<s;a++)t.push({name:i[a],value:e[i[a]]});return t},convertSearchPredicateToAttr:function(t){var i=t,s=t.substr(t.indexOf("/")+1);return e.each(this._knownSearchPredicate,function(e,a){Array.isArray(a)?a.forEach(function(a){t!==a&&s!==a||(i=e)}):t!==a&&s!==a||(i=e)}),i},convertAttrToSearchPredicate:function(e){return this._knownSearchPredicate[e]||null},_knownSearchPredicate:{label:"ds6w:label",revision:"ds6wg:revision",kind:"ds6w:kind",taxonomies:"taxonomies",apsData:"bo.DELLmiAPSInternalInfo.V_APSData",workingMode:"ds6wg:DELCapacityRscAbstract.V_CapacityRscType",originated:"originated",modified:"modified",policy:"ds6w:policy",current:"current",owner:"owner",organization:"organization",project:"project",vault:"vault",reservedBy:"reserved",V_Priority:"ro.delrmicyclerelation.V_Priority",StartDateTime:"ds6wg:delrmicyclerelationabstract.v_startdate",EndDateTime:"ds6wg:delrmicyclerelationabstract.v_enddate",RepoPrivilege:"bo.RepoPrivilege",StreamDescriptors:"bo.StreamDescriptors",C_updatestamp:"bo.PLMEntity.C_updatestamp",V_Name:"bo.PLMEntity.V_Name",V_isUptodate:"bo.PLMEntity.V_isUptodate",PLM_ExternalID:"bo.PLMEntity.PLM_ExternalID",code:"bo.PLMEntity.PLM_ExternalID",V_description:"bo.PLMEntity.V_description",description:"bo.PLMEntity.V_description",V_discipline:"bo.PLMEntity.V_discipline",discipline:"bo.PLMEntity.V_discipline",V_usage:"bo.PLMEntity.V_usage",V_nature:"bo.PLMEntity.V_nature",V_CustoDiscipline:"bo.PLMEntity.V_CustoDiscipline",V_sec_level:"bo.PLMEntity.V_sec_level",workspaceid:"bo.PLMEntity.workspaceid",V_hasConfigContext:"bo.PLMReference.V_hasConfigContext",V_ApplicabilityDate:"bo.PLMReference.V_ApplicabilityDate",V_order:"bo.PLMReference.V_order",V_isLastVersion:"bo.PLMReference.V_isLastVersion",V_isVPLMControlled:"bo.PLMReference.V_isVPLMControlled",V_EffectivityKind:"bo.PLMReference.V_EffectivityKind",V_VersionID:"bo.PLMReference.V_VersionID",V_AuthorityControl:"bo.PLMReference.V_AuthorityControl",V_DerivedFrom:"bo.PLMReference.V_DerivedFrom",V_fromExternalID:"bo.PLMReference.V_fromExternalID",V_versionComment:"bo.PLMReference.V_versionComment",V_ProjectApplicability:"bo.PLMReference.V_ProjectApplicability",V_isTerminal:"bo.PLMCoreReference.V_isTerminal",V_ChangeHistory:"bo.PLMCoreReference.V_ChangeHistory",V_hasInstanciationDefinition:"bo.LPAbstractReference.V_hasInstanciationDefinition",V_hasPGPRep:"bo.LPAbstractReference.V_hasPGPRep",V_Scale:"bo.LPAbstractReference.V_Scale",V_IsManufacturable:"bo.VPMReference.V_IsManufacturable",V_CalculatedCycleTime:"bo.Resource.V_CalculatedCycleTime",V_Category:"bo.Resource.V_Category",V_ConsumableCost:"bo.Resource.V_ConsumableCost",V_CycleTime:"bo.Resource.V_CycleTime",V_EnergyCost:"bo.Resource.V_EnergyCost",V_MTBF:"bo.Resource.V_MTBF",V_MTTR:"bo.Resource.V_MTTR",V_MaintenanceCost:"bo.Resource.V_MaintenanceCost",V_Manufacturer:"bo.Resource.V_Manufacturer",V_PurchaseCost:"bo.Resource.V_PurchaseCost",V_RepairCost:"bo.Resource.V_RepairCost",V_SetUpTime:"bo.Resource.V_SetUpTime",V_SetUpTimeReduced:"bo.Resource.V_SetUpTimeReduced",V_TargetCost:"bo.Resource.V_TargetCost",V_TargetedCycleTime:"bo.Resource.V_TargetedCycleTime",V_SubType:"bo.Resource.V_SubType",V_DELRmi_ApproachReach:"bo.Robot.V_DELRmi_ApproachReach",V_DELRmi_ControllerVersion:"bo.Robot.V_DELRmi_ControllerVersion",V_DELRmi_IndustrialApplications:"bo.Robot.V_DELRmi_IndustrialApplications",V_DELRmi_KinematicClass:"bo.Robot.V_DELRmi_KinematicClass",V_DELRmi_MaxPayload:"bo.Robot.V_DELRmi_MaxPayload",V_DELRmi_MountingMethod:"bo.Robot.V_DELRmi_MountingMethod",V_DELRmi_NbDOFs:"bo.Robot.V_DELRmi_NbDOFs",V_DELRmi_Repeatability:"bo.Robot.V_DELRmi_Repeatability",V_DELRmi_RobotModelIDAliases:"bo.Robot.V_DELRmi_RobotModelIDAliases",V_IsFiniteCapacity:"ds6wg:WorkCenter.V_IsFiniteCapacity",isFiniteCapacity:"ds6wg:WorkCenter.V_IsFiniteCapacity",V_SequenceBackward:"ds6wg:WorkCenter.V_SequenceBackward",V_FollowupType:"ds6wg:WorkCenter.V_FollowupType",V_PartNumber:"bo.EnterpriseExtension.V_PartNumber",V_SerialNumber:"bo.DELSerialNumber.V_SerialNumber",V_CapacityRscType:"ds6wg:delcapacityrscabstract.v_capacityrsctype",V_MinCapacity:["ds6wg:delcapacityrscweight.v_mincapacity","ds6wg:delcapacityrsceach.v_mincapacity","ds6wg:delcapacityrscarea.v_mincapacity","ds6wg:delcapacityrsclength.v_mincapacity","ds6wg:delcapacityrscvolume.v_mincapacity"],V_MaxCapacity:["ds6wg:delcapacityrscweight.v_maxcapacity","ds6wg:delcapacityrsceach.v_maxcapacity","ds6wg:delcapacityrscarea.v_maxcapacity","ds6wg:delcapacityrsclength.v_maxcapacity","ds6wg:delcapacityrscvolume.v_maxcapacity"]},_updateIndexedTimestamp:function(){l||(l=!0,i.getServiceUrl({serviceName:"3DSpace"}).then(function(t){if(t&&"string"==typeof t){var a={select_service:["FTS","EXPAND"]};a=e.Json.encode(a);var n=window.widget.getValue("collabSpace");if(!n){var c=window.widget.getPreference("pad_security_ctx");n=c&&c.value?c.value:"preferred"}n&&0===n.indexOf("ctx::")&&(n=n.substring("ctx::".length));var u=t+"/cvservlet/indexingdate?SecurityContext="+encodeURIComponent(n);i.callAuthenticatedRequest(u,"json","POST",a).then(function(t){var i=6e5+(new Date).getTime();t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&(e.each(t,function(e,t){t&&t.allvaultsacl&&!isNaN(t.allvaultsacl)&&1e3*t.allvaultsacl<i&&(i=1e3*t.allvaultsacl)}),o&&o!==i&&(r=o),o=i),l=!1},function(t){var i=s.get("Error");t&&t.message?(i=t.message,t.stack&&(e.log(t.message),e.log(t.stack))):"string"==typeof t&&(i=t),e.log(i),l=!1})}else e.log("invalid 3DSearch URL")}))}});if(i.useFixtures()){window.Configuration&&window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay);var u=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:".";window.Fam&&window.Fam.Model&&window.Fam.Model.Platform&&window.Fam.Model.Platform.webroot&&(u=window.Fam.Model.Platform.webroot),i.addFixture({type:"POST",url:u+"/cvservlet/indexingdate"},function(t){var i=window.$.get("../DELWebInfrastructureUI.tst/fixtures/CVServlet_indexingdate.json",function(s){if(e.String.contains(window.widget.getUrl(),"TSK7174741=FORCE")||!e.String.contains(window.widget.getUrl(),"TSK7174741=0")&&e.String.contains(window.widget.getUrl(),"ODTRunning=1"))e.each(s,function(e,t){t&&t.allvaultsacl&&(t.allvaultsacl=parseInt((new Date).getTime()/1e3)-1)});else{var a=window.widget.getPreference("navigateOnIndex");if(a&&"Index"===a.value){var n=window.widget.getPreference("navigateOnDatabaseStart");n&&n.value&&!isNaN(n.value)&&parseInt(n.value/1e3)+5<=(new Date).getTime()&&(s={fixture:{allvaultsacl:parseInt(n.value/1e3)+5}})}}i.responseText=JSON.stringify(s),t.complete(i,i.statusText)})})}return c}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,s,a,n){"use strict";var r={},o=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:a.setupWebRoot()||".";window.Fam&&window.Fam.Model&&window.Fam.Model.Platform&&window.Fam.Model.Platform.webroot&&(o=window.Fam.Model.Platform.webroot);var l=t.singleton({init:function(){r=a.getCacheObject()},setCacheObject:function(t){if(t&&e.Object.isPlainObject(t)){var i=a.getCacheObject();e.Object.isEmptyObject(r)||r===i||(t=Object.assign(t,r)),e.Object.isEmptyObject(i)||(t=Object.assign(t,i)),a.setCacheObject(t),r=a.getCacheObject()}},getCacheObject:function(){return r},get3DSearchString:function(){return"flattenedtaxonomies:types/DELResourceParameterListReference"},getResourceParameterLists:function(t){var s=this;return new i(function(i,n){if(t&&(t.physicalid||t.QueryList||t.allCached)){var o={};if(t.allCached)return r.parameter_list&&(o=e.Object.extend(!0,o,r.parameter_list)),void i(o);if(t.QueryList){var l=!0;if(r.parameter_list_assoc&&!t.blnForceRefresh?e.each(t.QueryList,function(e,t){return(l=t&&t.physicalid&&r.parameter_list_assoc[t.physicalid])&&(o[t.physicalid]=r.parameter_list_assoc[t.physicalid]),!!l}):l=!1,l)return void i(o)}else{if(r.parameter_list_assoc&&t.blnIncludeDescendants&&r.parameter_list_assoc[t.V_discipline||"All"]&&r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]&&!t.blnForceRefresh)return void i(e.clone(r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]));if(r.parameter_list_assoc&&r.parameter_list_assoc[t.physicalid]&&!t.blnForceRefresh&&!t.blnIncludeDescendants)return void i(e.clone(r.parameter_list_assoc[t.physicalid]))}a.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l={};if(t.physicalid)l.target_physicalid=t.physicalid;else if(t.QueryList){var c=[];e.each(t.QueryList,function(e,t){t&&(t.physicalid?c.push({physicalid:t.physicalid}):c.push(t))}),l.target_QueryList=JSON.stringify(c)}t.blnIncludeDescendants&&(l.getAllDescendants=!0,t.V_discipline&&(l.disciplineFilter=t.V_discipline));var u=o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";a.callAuthenticatedRequest(u,"json","GET",l).then(function(o){if(o){var c=a.commonAjaxJsonResponseOK(o,n);if(!c)return c;r.parameter_list_assoc||(r.parameter_list_assoc={});var u=o.Data||{};a.useFixtures()&&r.parameter_list_assoc[t.physicalid]&&!t.blnForceRefresh?u=r.parameter_list_assoc[t.physicalid]:t.blnForceRefresh&&r.parameter_list_assoc[t.physicalid]&&delete r.parameter_list_assoc[t.physicalid],e.each(u,function(e,i){var a=i.resource;if(a||(a=i.resource={physicalid:t.physicalid}),s._cacheResource(a),i.resourceParameterList){var n=e;i&&i.properties&&i.properties.physicalid?n=i.properties.physicalid:i&&i.resourceParameterList&&i.resourceParameterList.physicalid&&(n=i.resourceParameterList.physicalid),t.blnIncludeDescendants?t.blnIncludeDescendants&&(r.parameter_list_assoc[t.V_discipline||"All"]||(r.parameter_list_assoc[t.V_discipline||"All"]={}),r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]||(r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]={}),r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid][n]=i):(r.parameter_list_assoc[a.physicalid]||(r.parameter_list_assoc[a.physicalid]={}),r.parameter_list_assoc[a.physicalid][n]=i),s._cacheResourceParameterList(i.resourceParameterList,"False"===l.Minimum)}}),t.blnIncludeDescendants?(r.parameter_list_assoc||(r.parameter_list_assoc={}),r.parameter_list_assoc[t.V_discipline||"All"]||(r.parameter_list_assoc[t.V_discipline||"All"]={}),t.physicalid&&!r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]&&(r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid]={})):t.physicalid&&!r.parameter_list_assoc[t.physicalid]&&(r.parameter_list_assoc[t.physicalid]={}),t.blnIncludeDescendants&&t.physicalid?i(e.clone(r.parameter_list_assoc[t.V_discipline||"All"][t.physicalid])):t.physicalid?i(e.clone(r.parameter_list_assoc[t.physicalid])):i(e.clone(u))}else n(new Error("invalid server response"))},n)}else n(new Error("invalid 3DSpace URL"))},n)}else n(new Error("invalid parameters"))})},getResourceParametersForList:function(t){var s=this;return new i(function(n,o){if(t&&(t.physicalid||t.QueryList||t.allCached)){var l={};if(t.allCached)return r.parameter&&(l=e.Object.extend(!0,l,r.parameter)),void n(l);if(t.QueryList){var c=!0;if(r.parameter_list&&!t.blnForceRefresh?e.each(t.QueryList,function(t,i){return(c=i&&i.physicalid&&r.parameter_list[i.physicalid]&&r.parameter_list[i.physicalid].associatedResourceParameters)&&e.each(r.parameter_list[i.physicalid].associatedResourceParameters,function(t,s){return s&&"string"==typeof s?r.parameter&&r.parameter[s]?(l[i.physicalid]||(l[i.physicalid]={}),l[i.physicalid][s]=r.parameter[s]):c=!1:(e.log("invalid physicalidParamId!"),c=!1),!!c}),!!c}):c=!1,c)return void n(e.clone(l))}else if(r.parameter_list&&r.parameter_list[t.physicalid]&&r.parameter_list[t.physicalid].associatedResourceParameters&&!t.blnForceRefresh)return void n(e.clone(r.parameter_list[t.physicalid].associatedResourceParameters));a.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={};if(t.physicalid)c.resourceParameterListphysicalid=t.physicalid;else if(t.QueryList){var u=[];e.each(t.QueryList,function(e,t){t&&(t.physicalid?u.push({physicalid:t.physicalid}):u.push(t))}),c.resourceParameterListQueryList=JSON.stringify(u)}var d=l+"/resources/DELWebInfrastructureLite/v0/resource/parameter";a.callAuthenticatedRequest(d,"json","GET",c).then(function(l){if(l){var u=a.commonAjaxJsonResponseOK(l,o);if(!u)return u;r.parameter_list||(r.parameter_list={}),r.parameter||(r.parameter={});var d=l.Data||{},m=[];e.each(d,function(i,n){t.QueryList?a.useFixtures()&&r.parameter_list[i]&&r.parameter_list[i].associatedResourceParameters&&!t.blnForceRefresh?d=r.parameter_list[i].associatedResourceParameters:t.blnForceRefresh&&r.parameter_list[i]&&r.parameter_list[i].associatedResourceParameters&&delete r.parameter_list[i].associatedResourceParameters:a.useFixtures()&&r.parameter_list[t.physicalid]&&r.parameter_list[t.physicalid].associatedResourceParameters&&!t.blnForceRefresh?d=r.parameter_list[t.physicalid].associatedResourceParameters:t.blnForceRefresh&&r.parameter_list[t.physicalid]&&r.parameter_list[t.physicalid].associatedResourceParameters&&delete r.parameter_list[t.physicalid].associatedResourceParameters;var o={physicalid:i};s._cacheResourceParameterList(o),(o=r.parameter_list[o.physicalid]).associatedResourceParameters||(o.associatedResourceParameters=[]),e.each(n,function(t,i){var a=t;i&&i.physicalid&&(a=i.physicalid),o.associatedResourceParameters.push(a),i&&i.physicalid&&(i.extensions&&!e.Object.isEmptyObject(i.extensions)?m.push(s.addConvertedDisplayUnitsToExtensions({strClassName:i.plmObjectType||i.plmObjectTypeInternal||i.plmBaseObjectType,arrExtensions:i.extensions}).then(function(){s._cacheResourceParameter(i,"False"===c.Minimum)})):s._cacheResourceParameter(i,"False"===c.Minimum))}),t.physicalid&&!r.parameter_list[t.physicalid]?r.parameter_list[t.physicalid]={associatedResourceParameters:[]}:t.QueryList&&!r.parameter_list[i]&&(r.parameter_list[i]={associatedResourceParameters:[]})}),i.all(m).then(function(){n(e.clone(d))})}else o(new Error("invalid server response"))},o)}else o(new Error("invalid 3DSpace URL"))},o)}else o(new Error("invalid parameters"))})},getOneResourceParameterList:function(t){var s=this;return new i(function(i,n){if(t&&e.Object.isPlainObject(t))if(t.physicalid){"Minimum"in t&&!0!==t.Minimum?t.Minimum&&Array.isArray(t.Minimum)||(t.Minimum="False"):t.Minimum="True";var r=t.Minimum,o=["V_Name","physicalid"];t.Minimum&&!Array.isArray(t.Minimum)&&(t.Minimum.match(/true/i)||t.Minimum.match(/yes/i)||t.Minimum.match(/on/i))&&(t.Minimum=o);var l=s._FindPLMObjectInCache(t,t.Minimum);!l&&t.Minimum&&Array.isArray(t.Minimum)&&a.useFixtures()&&(l=s._FindPLMObjectInCache(t,"True"))&&e.each(t.Minimum,function(e,t){t in l||(l[t]=null)}),l&&!l.ReferenceOXID&&!l.ReferencePhysicalid&&r&&r.match&&(r.match(/true/i)||r.match(/yes/i)||r.match(/on/i))&&(t.Minimum=o,l=s._FindPLMObjectInCache(t,t.Minimum)),l?i(Object.assign({},l)):(t.class_name||(t.class_name="DELRmiParameterModel/DELResourceParameterListReference"),!t.fixtureTag&&a.useFixtures()&&(t.fixtureTag="getOneResourceParameterList"),a.getReference(t).then(function(t){t&&(Array.isArray(t)?e.each(t,function(e,t){t&&s._cacheResourceParameterList(Object.assign({},t))}):s._cacheResourceParameterList(Object.assign({},t))),i(t)},n))}else n(new Error("no id provided!"));else n(new Error("invalid parameters"))})},createResourceParameterList:function(t){var n=this;return new i(function(i,o){t&&e.Object.isPlainObject(t)?t.name||t.V_Name?a.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={V_Name:t.V_Name||t.name};(t.V_description||t.description)&&(c.V_description=(t.V_description||t.description).trim()),t.target_resource&&e.Object.isPlainObject(t.target_resource)&&(t.target_resource.physicalid&&(c.target_physicalid=t.target_resource.physicalid),t.target_resource.OXID&&(c.target_OXID=t.target_resource.OXID),t.target_resource.QueryList&&(c.target_resource=t.target_resource)),t.target_physicalid&&(c.target_physicalid=t.target_physicalid),t.target_OXID&&(c.target_OXID=t.target_OXID);var u=l+"/resources/DELWebInfrastructureLite/v0/resource/parameterList";a.callAuthenticatedRequest(u,"json","POST",c).then(function(t){if(t){var l=a.commonAjaxJsonResponseOK(t,o);if(!l)return l;s.setDatabase();var u=t.Data||{},d=[],m=[];e.each(u,function(t,i){"SuccessfullyAssociated"!==t?(i.associatedResources||(i.associatedResources=[]),n._cacheResourceParameterList(i),d.push(i),m.push({event:"ResourceParameterList.created",data:Object.assign({},i)})):i&&(e.Object.isPlainObject(i)||Array.isArray(i))&&e.each(i,function(t,i){var s=i.resource?i.resource.physicalid||i.resource.OXID:c.target_physicalid||c.target_OXID,a=i.resourceParameterList?i.resourceParameterList.physicalid||i.resourceParameterList.OXID:null;i&&s&&a?(r.parameter_list_assoc&&r.parameter_list_assoc[s]&&n._cacheResourceToResourceParameterListAssoc(s,a,i),m.push({event:"ResourceParameterList.associated",data:Object.assign({},i)})):e.log("DELWebResourceParameterModel::createResourceParameterList - invalid connection!  idxConnection = "+t+", ResourceID = "+s+", ParamListID = "+a+", objConnection = "+i)})}),e.each(m,function(e,t){a.publishEvent(t.event,t.data)}),i(d.slice(0))}else o(new Error("invalid server response"))},o)}else o(new Error("invalid 3DSpace URL"))},o):o(new Error("No name provided!")):o(new Error("invalid parameters"))})},updateResourceParameterList:function(t){var s=this;return new i(function(i,r){if(t&&e.Object.isPlainObject(t)&&t.physicalid){var o={physicalid:t.physicalid,attributes:[]};(t.V_Name||t.name)&&o.attributes.push({V_Name:(t.V_Name||t.name).trim()}),(t.V_description||t.description)&&o.attributes.push({V_description:(t.V_description||t.description).trim()}),o.attributes.length?(o.attributes=JSON.stringify(o.attributes),a.getServiceUrl({serviceName:"3DSpace"}).then(function(n){if(n&&"string"==typeof n){var l=n+"/resources/DELWebInfrastructureLite/v0/resource";a.useFixtures()&&(l+="?updateResourceParameterList"),a.callAuthenticatedRequest(l,"json","PATCH",o).then(function(n){var o=a.commonAjaxJsonResponseOK(n,r);if(!o)return o;var l=n.Data||n.data,c=(l?l.ChangedAttributes:null)||{};s._cacheResourceParameterList(Object.assign({physicalid:t.physicalid},c));var u=Object.assign({ChangedAttributes:e.clone(c)},t);a.publishEvent("ResourceParameterList.updated",u),i(e.clone(u))},r)}else r(new Error("invalid 3DSpace URL"))},r)):r(new Error(n.get("No changes have been made.")))}else r(new Error("invalid parameters"))})},associateResourceParameterList:function(t){var o=this;return new i(function(i,l){t&&e.Object.isPlainObject(t)?t.resource&&e.Object.isPlainObject(t.resource)&&(t.resource.physicalid||t.resource.QueryList)?t.resourceParameterList&&e.Object.isPlainObject(t.resourceParameterList)&&(t.resourceParameterList.physicalid||t.resourceParameterList.QueryList)?a.getServiceUrl({serviceName:"3DSpace"}).then(function(c){if(c&&"string"==typeof c){var u={};t.resource&&t.resource.physicalid&&(u.target_physicalid=t.resource.physicalid),t.resourceParameterList&&t.resourceParameterList.physicalid?u.resourceParameterListphysicalid=t.resourceParameterList.physicalid:t.resourceParameterList&&t.resourceParameterList.QueryList&&(u.resourceParameterListQueryList=[],e.each(t.resourceParameterList.QueryList,function(e,t){t&&(t.physicalid?u.resourceParameterListQueryList.push({physicalid:t.physicalid}):u.resourceParameterListQueryList.push(t))}));var d=new window.FormData;a.useFixtures()?d=u:e.each(u,function(t,i){t&&i?"string"!=typeof i&&isNaN(i)?d.append(t,JSON.stringify(i)):d.append(t,i):e.log("DELWebResourceParameterModel::associateResourceParameterList - invalid key = "+t+", val = "+i)});var m=c+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";a.callAuthenticatedRequest(m,"json","POST",d).then(function(c){if(c){var u=a.commonAjaxJsonResponseOK(c,l);if(!u)return u;s.setDatabase(),r.parameter_list_assoc||(r.parameter_list_assoc={});var d=[],m=!0,p=[];(c.Data.SuccessfullyAssociated||c.Data.AlreadyAssociated)&&e.each({SuccessfullyAssociated:"ResourceParameterList.associated",AlreadyAssociated:"ResourceParameterList.associated.duplicate"},function(i,s){c.Data[i]&&e.each(c.Data[i],function(i,a){var n=a.resource;!n&&t.resource&&(n=a.resource=t.resource),n&&o._cacheResource(n),a.resourceParameterList&&o._cacheResourceParameterList(a.resourceParameterList),n&&n.physicalid&&a.resourceParameterList&&a.resourceParameterList.physicalid?(o._cacheResourceToResourceParameterListAssoc(n.physicalid,a.resourceParameterList.physicalid,a),p.push(a),d.push({event:s,data:a})):e.log("invalid ID in response!")})}),c.Data.FailedAssociated&&(m=!1,e.each(c.Data.FailedAssociated,function(e,t){d.push({event:"ResourceParameterList.associated.error",data:t})})),e.each(d,function(e,t){a.publishEvent(t.event,t.data)}),m&&p&&p.length?i(e.clone(p)):l(new Error(n.get("Error")))}else l(new Error("invalid server response"))},l)}else l(new Error("invalid 3DSpace URL"))},l):l(new Error("invalid resource parameter list")):l(new Error("invalid resource")):l(new Error("invalid parameters"))})},unassociateResourceParameterList:function(t){var r=this;return new i(function(i,o){if(t&&e.Object.isPlainObject(t)){if(!(t.resourceParameterListAssociation||t.resourceParameterListAssociationphysicalid||t.resourceParameterListAssociationOXID||t.resourceParameterListAssociationQueryList)){if(!(t.resource||t.target_physicalid||t.target_OXID||t.target_QueryList))return void o(new Error("No resource provided!"));if(!(t.resourceParameterList||t.resourceParameterListphysicalid||t.resourceParameterListOXID||t.resourceParameterListQueryList))return void o(new Error("No resource parameter list provided!"))}a.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={};if(e.each(["resourceParameterListAssociation","resourceParameterListAssociationphysicalid","resourceParameterListAssociationOXID","resourceParameterListAssociationQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),e.Object.isEmptyObject(c)){if(e.each(["resource","target_resource","target_physicalid","target_OXID","target_QueryList","resourceParameterList","resourceParameterListphysicalid","resourceParameterListOXID","resourceParameterListQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),e.Object.isEmptyObject(c))return void o(new Error("invalid parameters"));c.resource&&!c.target_resource&&(c.target_resource=c.resource),delete c.resource}var u=new window.FormData;a.useFixtures()?u=c:e.each(c,function(t,i){"string"!=typeof i&&isNaN(i)?u.append(t,e.Json.encode(i)):u.append(t,i)});var d=l+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";a.callAuthenticatedRequest(d,"json","DELETE",u).then(function(l){if(l){var c=a.commonAjaxJsonResponseOK(l,o);if(!c)return c;s.setDatabase();var u=l.Data||{},m=[],p=!0;e.each(u,function(i,s){if("SuccessfullyUnassociated"===i||"AlreadyUnassociated"===i)e.each(s,function(i,s){if(s&&e.Object.isPlainObject(s)&&!e.Object.isEmptyObject(s)){if(p=!0,!s.properties)if(t.resourceParameterListAssociation){var a=e.clone(s);s.properties=Object.assign(a,t.resourceParameterListAssociation)}else t.resourceParameterListAssociationOXID||t.resourceParameterListAssociationphysicalid?s.properties=Object.assign({OXID:t.resourceParameterListAssociationOXID,physicalid:t.resourceParameterListAssociationphysicalid},s):s.physicalid&&(s.properties={physicalid:s.physicalid});s.resourceParameterList||(t.resourceParameterList?s.resourceParameterList=t.resourceParameterList:(t.resourceParameterListphysicalid||t.resourceParameterListOXID)&&(s.resourceParameterList={physicalid:t.resourceParameterListphysicalid,OXID:t.resourceParameterListOXID})),s.resource||(t.resource?s.resource=t.resource:(t.target_physicalid||t.target_OXID)&&(s.resource={OXID:t.target_OXID,physicalid:t.target_physicalid})),r._cacheResourceToResourceParameterListUnassoc(s),m.push({event:"ResourceParameterList.unassociated",data:s})}else e.log("DELWebResourceParameterModel::unassociateResourceParameterList - invalid response from "+d)});else if("FailedUnassociated"===i){var a=e.clone(u);a=Object.assign(a,t),e.each(s,function(t,s){0===t.indexOf("[")?a.resourceParameterListOXID=t:a.resourceParameterListphysicalid=t,e.each(s,function(e,t){0===t.indexOf("[")?a.target_OXID=t:a.target_physicalid=t,m.push({event:"ResourceParameterList.unassociated.error",data:a}),p=!1,o(i,a)})})}else e.log("unknown response key: "+i)}),e.each(m,function(e,t){a.publishEvent(t.event,t.data)}),p&&(u&&!e.Object.isEmptyObject(u)?i(e.clone(u)):o(new Error(n.get("Error"))))}else o(new Error("invalid server response"))},o)}else o(new Error("invalid 3DSpace URL"))},o)}else o(new Error("invalid parameters"))})},_cacheResourceParameter:function(t){r.parameter||(r.parameter={});var i=r.parameter;if(!t.parameter_type&&t.interfaces&&t.interfaces.length&&e.each(t.interfaces,function(e,i){i.indexOf("DELRscPrmIOValueAbstract")>=0&&(t.parameter_type=i[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""),t.parameter_type.endsWith("Value")&&(t.parameter_type=t.parameter_type.substr(0,t.parameter_type.lastIndexOf("Value"))))}),t.OXID||t.physicalid){if(t.plmBaseObjectType||(t.plmBaseObjectType="DELResourceParameter"),t.physicalid&&t.OXID&&!i[t.physicalid]&&i[t.OXID]&&(i[t.physicalid]=i[t.OXID]),i[t.physicalid||t.OXID]){var s=e.Object.extend(!0,i[t.physicalid||t.OXID],t);t.interfaces&&(s.interfaces=t.interfaces,t.extensions||s.extensions&&e.each(s.extensions,function(i,a){e.each(a,function(e,a){e in t&&(s.extensions[i][e]=t[e])})})),i[t.physicalid||t.OXID]=s,e.Object.extend(!0,t,s)}else i[t.physicalid||t.OXID]=t;t.OXID&&t.physicalid&&(i[t.OXID]=i[t.physicalid])}},getOneResourceParameter:function(t){var s=this;return new i(function(i,n){if(t&&e.Object.isPlainObject(t))if(t.physicalid){"Minimum"in t&&!0!==t.Minimum?t.Minimum&&Array.isArray(t.Minimum)||(t.Minimum="False"):t.Minimum="True";var r=t.Minimum,o=["V_Name","physicalid"];t.Minimum&&!Array.isArray(t.Minimum)&&(t.Minimum.match(/true/i)||t.Minimum.match(/yes/i)||t.Minimum.match(/on/i))&&(t.Minimum=o);var l=s._FindPLMObjectInCache(t,t.Minimum);!l&&t.Minimum&&Array.isArray(t.Minimum)&&a.useFixtures()&&(l=s._FindPLMObjectInCache(t,"True"))&&e.each(t.Minimum,function(e,t){t in l||(l[t]=null)}),l&&!l.ReferenceOXID&&!l.ReferencePhysicalid&&r&&r.match&&(r.match(/true/i)||r.match(/yes/i)||r.match(/on/i))&&(t.Minimum=o,l=s._FindPLMObjectInCache(t,t.Minimum)),l?i(Object.assign({},l)):(t.class_name||(t.class_name="DELRmiParameterModel/DELResourcePrmAbstract"),!t.fixtureTag&&a.useFixtures()&&(t.fixtureTag="getOneResourceParameterList"),a.getReference(t).then(function(t){t&&(Array.isArray(t)?e.each(t,function(e,t){t&&s._cacheResourceParameter(Object.assign({},t))}):s._cacheResourceParameter(Object.assign({},t))),i(t)},n))}else n(new Error("no id provided!"));else n(new Error("invalid parameters"))})},createResourceParameter:function(t){var n=this;return new i(function(o,l){t&&e.Object.isPlainObject(t)?t.name||t.V_Name?a.getServiceUrl({serviceName:"3DSpace"}).then(function(c){if(c&&"string"==typeof c){var u={V_Name:t.V_Name||t.name};if((t.V_description||t.description)&&(u.V_description=(t.V_description||t.description).trim()),u.inputOutput=t.inputOutput,t.inputOutput||t.V_Direction||("DELResourcePrmOUTPUT"===t.plmObjectType||"DELResourcePrmOUTPUT"===t.plmObjectTypeInternal?u.inputOutput="Output":"DELResourcePrmINPUT"!==t.plmObjectType&&"DELResourcePrmINPUT"!==t.plmObjectTypeInternal||(u.inputOutput="Input")),t.resourceParameterExtension||t.parameter_type){(t.resourceParameterExtension||t.parameter_type)&&(u.resourceParameterExtension=(t.resourceParameterExtension||t.parameter_type).trim()),("minValue"in t||"V_MinValue"in t)&&(u.minValue=(t.minValue||t.V_MinValue||"0").toString().trim()),("maxValue"in t||"V_MaxValue"in t)&&(u.maxValue=(t.maxValue||t.V_MaxValue||"0").toString().trim()),t.minLimit&&(u.minLimit=t.minLimit.trim()),t.maxLimit&&(u.maxLimit=t.maxLimit.trim()),(t.units||t.V_Units)&&(u.units=(t.units||t.V_Units).trim()),t.target_param_list&&e.Object.isPlainObject(t.target_param_list)&&(t.target_param_list.physicalid&&(u.resourceParameterListphysicalid=t.target_param_list.physicalid),t.target_param_list.OXID&&(u.resourceParameterListOXID=t.target_param_list.OXID),t.target_param_list.QueryList&&(u.resourceParameterListQueryList=t.target_param_list.QueryList)),t.target_physicalid&&(u.resourceParameterListphysicalid=t.target_physicalid),t.target_OXID&&(u.resourceParameterListOXID=t.target_OXID),t.V_Values&&(u.V_Values=JSON.stringify(t.V_Values)),t.extensions&&(u.extensions=JSON.stringify(t.extensions));var d=c+"/resources/DELWebInfrastructureLite/v0/resource/parameter?createResourceParameter";a.callAuthenticatedRequest(d,"json","POST",u).then(function(c){if(c){var u=a.commonAjaxJsonResponseOK(c,l);if(!u)return u;s.setDatabase();var d=c.Data||{},m=t.target_param_list;m||(m={physicalid:t.target_physicalid,OXID:t.target_OXID});var p=[],h=[],f=[];e.each(d,function(t,i){i.extensions&&!e.Object.isEmptyObject(i.extensions)&&f.push(n.addConvertedDisplayUnitsToExtensions({strClassName:i.plmObjectType||i.plmObjectTypeInternal||i.plmBaseObjectType,arrExtensions:i.extensions}))}),i.all(f).then(function(){e.each(d,function(t,i){n._cacheResourceParameter(i,!0);var s=m.physicalid||m.OXID,a=i.physicalid||i.OXID||t;if(a&&s){var o={resourceParameterList:m,properties:i};(r.parameter_list||r.parameter_list[s])&&n._cacheResourceParameterToResourceParameterListAssoc(s,o),h.push({event:"ResourceParameter.associated",data:e.clone(o)})}else e.log("DELWebResourceParameterModel::createResourceParameter - invalid connection! ResourceParamID = "+a+", ParamListID = "+s)}),e.each(h,function(e,t){a.publishEvent(t.event,t.data)}),o(p.slice(0))})}else l(new Error("invalid server response"))},l)}}else l(new Error("invalid 3DSpace URL"))},l):l(new Error("No name provided!")):l(new Error("invalid parameters"))})},updateResourceParameter:function(t){var o=this;return new i(function(l,c){if(t&&e.Object.isPlainObject(t)&&t.physicalid){var u={resourceParameterPhysicalid:t.physicalid};(t.V_Name||t.name)&&(u.V_Name=(t.V_Name||t.name).trim()),(t.V_description||t.description)&&(u.V_description=(t.V_description||t.description).trim()),(t.attributes||t.attributes)&&(u.attributes=JSON.stringify(t.attributes)),t.extensions&&(u.extensions=JSON.stringify(t.extensions)),t.extensionsToRemove&&(u.extensionsToRemove=JSON.stringify(t.extensionsToRemove)),u.V_Name||u.V_description||u.attributes||u.extensions?a.getServiceUrl({serviceName:"3DSpace"}).then(function(n){if(n&&"string"==typeof n){var d=n+"/resources/DELWebInfrastructureLite/v0/resource/parameter?updateResourceParameter";a.callAuthenticatedRequest(d,"json","PATCH",u).then(function(n){var u=a.commonAjaxJsonResponseOK(n,c);if(!u)return u;s.setDatabase();var d=(n.Data&&n.Data.ChangedAttributes?n.Data.ChangedAttributes:n.Data)||{};n.Data&&(n.Data.interfaces&&!d.interfaces&&(d.interfaces=n.Data.interfaces),n.Data.extensions&&!d.extensions&&(d.extensions=n.Data.extensions));var m=[];d.extensions&&!e.Object.isEmptyObject(d.extensions)&&t.physicalid&&r.parameter&&r.parameter[t.physicalid]&&m.push(o.addConvertedDisplayUnitsToExtensions({strClassName:r.parameter[t.physicalid].plmObjectType||r.parameter[t.physicalid].plmObjectTypeInternal||r.parameter[t.physicalid].plmBaseObjectType,arrExtensions:d.extensions})),i.all(m).then(function(){o._cacheResourceParameter(Object.assign({physicalid:t.physicalid},d));var i=e.Object.extend(!0,{ChangedAttributes:e.clone(d)},t);a.publishEvent("ResourceParameter.updated",i),l(e.clone(i))},c)},c)}else c(new Error("invalid 3DSpace URL"))},c):c(new Error(n.get("No changes have been made.")))}else c(new Error("invalid parameters"))})},addConvertedDisplayUnitsToExtensions:function(t){var s=this;return new i(function(n,r){a.getExtensions({class_name:[t.strClassName,"DELResourcePrmAbstract"],Extensions:Object.keys(t.arrExtensions),blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then(function(a){if(a){var o=[];e.each(t.arrExtensions,function(t,n){a[t]&&a[t].length&&n&&e.Object.isPlainObject(n)&&!e.Object.isEmptyObject(n)&&e.each(a[t],function(t,a){a&&a.name&&a.properties&&a.properties.length&&e.each(a.properties,function(t,a){a&&a.dimension&&a.preferred_unit&&o.push(new i(function(t,i){s.getMagnitudes({filter:"dimensionName+eq+"+a.dimension,magnitude:a.dimension}).then(function(r){if(r&&r[a.dimension]){var o=r[a.dimension].MKSUnit;if(!o&&r[a.dimension].Units&&r[a.dimension].Units.length&&e.each(r[a.dimension].Units,function(e,t){return t&&t.default&&(o=t.Name),!o}),!o||a.preferred_unit===o)return void t();s.convertValueToUnit({value:n[a.name],dimension:a.dimension,toUnit:a.preferred_unit,fromUnit:o}).then(function(e){n[a.name+".displayValue"]=+e,t()},i)}else i()},i)},r))})})}),i.all(o).then(function(){n(t.arrExtensions)},r)}else r()},r)})},unassociateResourceParameterFromList:function(t){var r=this;return new i(function(i,o){t&&e.Object.isPlainObject(t)?t.resourceParameterQueryList||t.resourceParameterListQueryList?a.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={};if(e.each(["resourceParameter","resourceParameterphysicalid","resourceParameterOXID","resourceParameterQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),t.resourceParameterListphysicalid&&(c.resourceParameterListphysicalid=t.resourceParameterListphysicalid),e.Object.isEmptyObject(c)){if(e.each(["resourceParameterList","resourceParameterListphysicalid","resourceParameterListOXID","resourceParameterListQueryList","resourceParameter","resourceParameterphysicalid","resourceParameterOXID","resourceParameterQueryList"],function(e,i){t[i]&&(c[i]=t[i])}),e.Object.isEmptyObject(c))return void o(new Error("invalid parameters"));c.param_list&&!c.target_param_list&&(c.target_param_list=c.param_list),delete c.param_list}var u=new window.FormData;a.useFixtures()?u=c:e.each(c,function(t,i){"string"!=typeof i&&isNaN(i)?u.append(t,e.Json.encode(i)):u.append(t,i)});var d=l+"/resources/DELWebInfrastructureLite/v0/resource/parameter?unassociateResourceParameterFromList";a.callAuthenticatedRequest(d,"json","DELETE",u).then(function(l){if(l){var c=a.commonAjaxJsonResponseOK(l,o);if(!c)return c;s.setDatabase();var u=l.Data||{},m=[],p=!0;e.each(u,function(i,s){if("SuccessfullyDeleted"===i||"AlreadyDeleted"===i)e.each(s,function(i,s){if(s&&e.Object.isPlainObject(s)&&!e.Object.isEmptyObject(s)){if(p=!0,!s.resourceParameter)if(t.resourceParameterList){var a=e.clone(s);s.properties=Object.assign(a,t.resourceParameterList)}else t.resourceParameterListAssociationOXID||t.resourceParameterListAssociationphysicalid?s.properties=Object.assign({OXID:t.resourceParameterListAssociationOXID,physicalid:t.resourceParameterListAssociationphysicalid},s):s.physicalid&&(s.properties={physicalid:s.physicalid});s.resourceParameterList||(t.resourceParameterList?s.resourceParameterList=t.resourceParameterList:(t.resourceParameterListphysicalid||t.resourceParameterListOXID)&&(s.resourceParameterList={physicalid:t.resourceParameterListphysicalid,OXID:t.resourceParameterListOXID})),s.resource||(t.resource?s.resource=t.resource:(t.target_physicalid||t.target_OXID)&&(s.resource={OXID:t.target_OXID,physicalid:t.target_physicalid})),r._cacheResourceParameterToResourceParameterListUnassoc(s),m.push({event:"ResourceParameter.unassociated",data:s})}else e.log("DELWebResourceParameterModel::unassociateResourceParameterFromList - invalid response from "+d)});else if("FailedUnassociated"===i){var a=e.clone(u);a=Object.assign(a,t),e.each(s,function(t,s){0===t.indexOf("[")?a.resourceParameterListOXID=t:a.resourceParameterListphysicalid=t,e.each(s,function(e,t){0===t.indexOf("[")?a.target_OXID=t:a.target_physicalid=t,m.push({event:"ResourceParameter.unassociated.error",data:a}),p=!1,o(i,a)})})}else e.log("unknown response key: "+i)}),e.each(m,function(e,t){a.publishEvent(t.event,t.data)}),p&&(u&&!e.Object.isEmptyObject(u)?i(e.clone(u)):o(new Error(n.get("Error"))))}else o(new Error("invalid server response"))},o)}else o(new Error("invalid 3DSpace URL"))},o):o(new Error("No resource parameter list provided!")):o(new Error("invalid parameters"))})},_cacheResource:function(t,i){if(window.Foe&&window.Foe.Model&&window.Foe.Model.Asset&&window.Foe.Model.Asset.cacheResourcePLMObject)return window.Foe.Model.Asset.cacheResourcePLMObject(t,i);var s=t;if(!s||!s.blnDoNotCache){r.resource||(r.resource={});var n=r.resource;if(s&&(s.OXID||s.physicalid)){s.OXID&&!s.physicalid&&(s.physicalid=a.getPhysicalIDForOXID(s.OXID)),i||"False"===s.Minimum?s.AllAttributesRetrieved=!0:s.AllAttributesRetrieved=s.AllAttributesRetrieved||!1;var o=Object.assign({},s);if(n[o.physicalid]){var l=e.Object.extend(!0,n[o.physicalid],o);n[s.physicalid]=l,s.OXID&&(n[s.OXID]=n[s.physicalid])}else n[s.physicalid]=s,s.OXID&&(n[s.OXID]=n[s.physicalid])}}},_cacheResourceParameterList:function(t){r.parameter_list||(r.parameter_list={});var i=r.parameter_list;if(t.OXID||t.physicalid){if(t.plmBaseObjectType||(t.plmBaseObjectType="DELResourceParameterListReference"),i[t.physicalid||t.OXID]){var s=e.Object.extend(!0,i[t.physicalid||t.OXID],t);i[t.physicalid||t.OXID]=s,e.Object.extend(!0,t,s)}else i[t.physicalid||t.OXID]=t;t.OXID&&t.physicalid&&(i[t.OXID]=i[t.physicalid])}},_cacheResourceToResourceParameterListAssoc:function(t,i,s){if(t&&i&&s){if(r.parameter_list_assoc||(r.parameter_list_assoc={}),!r.parameter_list_assoc[t])if(0===t.indexOf("[")){var n=a.getPhysicalIDForOXID(t);r.parameter_list_assoc[n]?r.parameter_list_assoc[t]=r.parameter_list_assoc[n]:(r.parameter_list_assoc[n]={},r.parameter_list_assoc[t]=r.parameter_list_assoc[n])}else r.parameter_list_assoc[t]={};if(r.parameter_list_assoc[t]&&s&&(s.resourceParameterList||(s.resourceParameterList={physicalid:i},0===i.indexOf("[")&&(s.resourceParameterList.OXID=i,s.resourceParameterList.physicalid=a.getPhysicalIDForOXID(i))),r.parameter_list_assoc[t][s.resourceParameterList.physicalid]=s),delete r.parameter_list_assoc.All,r.resource&&r.resource[t]&&r.resource[t].V_discipline?delete r.parameter_list_assoc[r.resource[t].V_discipline]:s&&s.resource&&s.resource.V_discipline&&delete r.parameter_list_assoc[s.resource.V_discipline],r.parameter_list&&r.parameter_list[i]){var o=r.parameter_list[i];o.associatedResources||(o.associatedResources=[]),o.associatedResources.indexOf(t)<0&&o.associatedResources.push(t)}}else e.log("DELWebResourceParameterModel::_cacheResourceToResourceParameterListAssoc - missing input parameters!")},_cacheResourceToResourceParameterListUnassoc:function(t){if(t){if(r.parameter_list_assoc&&(t.resource&&t.resource.physicalid||!t.resourceParameterList||!t.resourceParameterList.physicalid||e.each(r.parameter_list_assoc,function(e,i){return i&&i[t.resourceParameterList.physicalid]&&(t.resource={physicalid:e}),!t.resource}),t.resource&&t.resource.physicalid&&r.parameter_list_assoc[t.resource.physicalid]&&(t.resourceParameterList&&t.resourceParameterList.physicalid?(t.resourceParameterList&&t.resourceParameterList.physicalid||!r.parameter_list_assoc[t.resource.physicalid][t.resourceParameterList.physicalid]||(t.resourceParameterList=r.parameter_list_assoc[t.resource.physicalid][t.resourceParameterList.physicalid].resourceParameterList),delete r.parameter_list_assoc[t.resource.physicalid][t.resourceParameterList.physicalid]):t.resourceParameterList&&t.resourceParameterList.physicalid&&e.each(r.parameter_list_assoc[t.resource.physicalid],function(e,i){i&&i.resourceParameterList&&i.resourceParameterList.physicalid===t.resourceParameterList.physicalid&&delete r.parameter_list_assoc[t.resource.physicalid][e]})),t.resourceParameterList&&t.resourceParameterList.physicalid&&t.resource&&t.resource.physicalid&&r.parameter_list&&r.parameter_list[t.resourceParameterList.physicalid]))for(var i=r.parameter_list[t.resourceParameterList.physicalid];i.associatedResources&&i.associatedResources.length&&i.associatedResources.indexOf(t.resource.physicalid)>=0;)i.associatedResources.splice(i.associatedResources.indexOf(t.resource.physicalid),1)}else e.log("DELWebResourceParameterModel::_cacheResourceToResourceParameterListUnassoc - missing input parameters!")},_cacheResourceParameterToResourceParameterListUnassoc:function(t){if(t){if(r.parameter_list)if(t.resourceParameterList&&t.resourceParameterList.physicalid||!t.properties||!t.properties.physicalid||e.each(r.parameter_list,function(e,i){return i&&i[t.properties.physicalid]&&(t.resourceParameterList={physicalid:e}),!t.resourceParameterList}),t.resourceParameterList&&t.resourceParameterList.physicalid&&t.properties&&t.properties.physicalid){if(r.parameter_list&&r.parameter_list[t.resourceParameterList.physicalid])for(var i=r.parameter_list[t.resourceParameterList.physicalid];i.associatedResourceParameters&&i.associatedResourceParameters.length&&i.associatedResourceParameters.indexOf(t.properties.physicalid)>=0;)i.associatedResourceParameters.splice(i.associatedResourceParameters.indexOf(t.properties.physicalid),1)}else t.physicalid&&r.parameter_list&&e.each(r.parameter_list,function(e,i){for(;i.associatedResourceParameters&&i.associatedResourceParameters.length&&i.associatedResourceParameters.indexOf(t.physicalid)>=0;)i.associatedResourceParameters.splice(i.associatedResourceParameters.indexOf(t.physicalid),1)})}else e.log("DELWebResourceParameterModel::_cacheResourceParameterToResourceParameterListUnassoc - missing input parameters!")},_cacheResourceParameterToResourceParameterListAssoc:function(t,i){if(t&&i){if(r.parameter_list||(r.parameter_list={}),!r.parameter_list[t])if(0===t.indexOf("[")){var s=a.getPhysicalIDForOXID(t);r.parameter_list[s]?r.parameter_list[t]=r.parameter_list[s]:(r.parameter_list[s]={},r.parameter_list[t]=r.parameter_list[s])}else r.parameter_list[t]={};r.parameter_list[t]&&i&&(i.resourceParameterList||(i.resourceParameterList={physicalid:t},0===t.indexOf("[")&&(i.resourceParameterList.OXID=t,i.resourceParameterList.physicalid=a.getPhysicalIDForOXID(t))),r.parameter_list[t].associatedResourceParameters||(r.parameter_list[t].associatedResourceParameters=[]),i.properties&&i.properties.physicalid&&r.parameter_list[t].associatedResourceParameters.push(i.properties.physicalid))}else e.log("DELWebResourceParameterModel::_cacheResourceParameterToResourceParameterListAssoc - missing input parameters!")},updateDefaultMagnitudes:function(t){var s=this;return new i(function(i,n){t&&e.Object.isPlainObject(t)?a.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l={};t&&t.dimensionList&&(l.key="preference_DimensionsList",l.value=t.dimensionList);var c=o+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";a.useFixtures()&&(c=o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateDefaultMagnitudes"),a.callAuthenticatedRequest(c,"json","PATCH",l).then(function(t){if(t){var o=a.commonAjaxJsonResponseOK(t,n);if(!o)return o;t.Data&&t.Data.preference_DimensionsList||(t.Data.preference_DimensionsList="ANGLEParameter;LENGTHParameter;MASSParameter;");var c=[];e.each(t.Data.preference_DimensionsList.split(";"),function(e,t){t&&c.push(t.replace("Parameter",""))}),l={filter:"dimensionName+eq+"+c.join(",")},s.getMagnitudes(l).then(function(t){t&&(a.useFixtures()&&c.length&&e.each(t,function(e){c.indexOf(e)<0&&delete t[e]}),r._dimensionsPreferred=t),i(e.clone(t))},n)}else n(new Error("invalid server response"))},n)}else n(new Error("invalid 3DSpace URL"))},n):n(new Error("invalid parameters"))})},getDefaultMagnitudes:function(t){var s=this;return t||(t={}),new i(function(i,o){!t.blnForceRefresh&&r&&r._dimensionsPreferred&&e.Object.isPlainObject(r._dimensionsPreferred)&&!e.Object.isEmptyObject(r._dimensionsPreferred)?i(e.clone(r._dimensionsPreferred)):a.getServiceUrl({serviceName:"3DSpace"}).then(function(t){if(t&&"string"==typeof t){var l={key:"preference_DimensionsList"},c=t+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";a.useFixtures()&&(c=t+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"),a.callAuthenticatedRequest(c,"json","GET",l).then(function(t){if(t){var c=a.commonAjaxJsonResponseOK(t,o);if(!c)return c;t.Data&&t.Data.preference_DimensionsList||(t.Data.preference_DimensionsList="ANGLEParameter;LENGTHParameter;MASSParameter;IntegerParameter;StringParameter");var u=[];e.each(t.Data.preference_DimensionsList.split(";"),function(e,t){t&&u.push(t.replace("Parameter",""))}),l={filter:"dimensionName+eq+"+u.join(",")},s.getMagnitudes(l).then(function(t){t&&(a.useFixtures()&&u.length&&e.each(t,function(e){u.indexOf(e)<0&&delete t[e]}),r._dimensionsPreferred=t),u.indexOf("Integer")>-1&&!t.Integer&&(t.Integer={Name:"Integer",NLS:n.get("Integer")}),u.indexOf("String")>-1&&!t.String&&(t.String={Name:"String",NLS:n.get("Text")}),i(e.clone(t))},o)}else o(new Error("invalid server response"))},o)}else o(new Error("invalid 3DSpace URL"))},o)})},getMagnitudes:function(t){return t||(t={}),new i(function(i,s){if(r&&r._dimensions&&e.Object.isPlainObject(r._dimensions)&&!e.Object.isEmptyObject(r._dimensions)&&!t.blnForceRefresh){if(!t.filter)return void i(e.clone(r._dimensions));if(t.magnitude&&r._dimensions[t.magnitude]){var o={};return o[t.magnitude]=e.clone(r._dimensions[t.magnitude]),void i(o)}}a.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l=o+"/resources/dictionary/dimensions";t.filter&&(l+="?$filter="+t.filter),a.callAuthenticatedRequest(l,"json","GET",{}).then(function(a){try{var o={};a.results.forEach(function(e){o[e.Name]=e}),t.filter?r._dimensions&&!e.Object.isEmptyObject(r._dimensions)&&(r._dimensions=Object.assign(r._dimensions||{},o)):r._dimensions=o,i(e.clone(o)),e.log("Dimensions loaded")}catch(t){e.log("Unexpected error when fetching dimensions"),e.log(t),s(new Error((t.message||t)+" \n"+n.get("DIMENSIONAL_ATTRIBUTES_ARE_INVALID")))}},function(t){e.log("Unable to get dimensions : "),e.log(t),s(new Error((t.message||t)+" \n"+n.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES")))},s)}else s(new Error("invalid 3DSpace URL"))},s)})},getMagnitudeUnits:function(t){var s=this;return new i(function(i,n){if(t&&e.Object.isPlainObject(t))if(t.magnitude){var o=!1;r&&r._dimensions&&r._dimensions[t.magnitude]&&r._dimensions[t.magnitude].Units&&!t.blnForceRefresh&&(o=!1,e.each(r._dimensions[t.magnitude].Units,function(e,t){return!(o=t&&t.default)}),o)?i(r._dimensions[t.magnitude].Units.slice(0)):s.getMagnitudes({filter:"dimensionName+eq+"+t.magnitude,magnitude:t.magnitude,blnForceRefresh:t.blnForceRefresh||!1}).then(function(l){l&&l[t.magnitude]?l[t.magnitude].Units&&(o=!1,e.each(l[t.magnitude].Units,function(e,t){return!(o=t&&t.default)}),o)?i(l[t.magnitude].Units.slice(0)):a.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var c={key:"preference_DisplayUnits"},u=JSON.stringify(c);if(r||(r={}),r.getMagnitudeUnits_jqXHR){if(r.getMagnitudeUnits_jqXHR[u]&&(!r.getMagnitudeUnits_jqXHR[u].readyState||4!==r.getMagnitudeUnits_jqXHR[u].readyState))return void setTimeout(function(){s.getMagnitudeUnits(t).then(i,n)},500)}else r.getMagnitudeUnits_jqXHR={};r.getMagnitudeUnits_jqXHR[u]=t;var d=o+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";a.useFixtures()&&(d=o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"),a.callAuthenticatedRequest(d,"json","GET",c).then(function(s){if(r.getMagnitudeUnits_jqXHR[u]&&delete r.getMagnitudeUnits_jqXHR[u],s){var o=a.commonAjaxJsonResponseOK(s,n);if(!o)return o;s.Data&&s.Data.preference_DisplayUnits||(s.Data||(s.Data={}),r&&r._dimensions&&!e.Object.isEmptyObject(r._dimensions)?(s.Data.preference_DisplayUnits="",e.each(r._dimensions,function(e,t){t&&t.MKSUnit&&(s.Data.preference_DisplayUnits&&(s.Data.preference_DisplayUnits+=","),s.Data.preference_DisplayUnits+=(t.Name||e)+"Parameter:"+t.MKSUnit)})):s.Data.preference_DisplayUnits=t.magnitude+":"+l[t.magnitude].MKSUnit),e.each(s.Data.preference_DisplayUnits.split(","),function(i,s){if(s){var a=s.split(":"),n=t.magnitude,o=s;2===a.length&&(n=a[0].replace("Parameter",""),o=a[1]),r&&r._dimensions&&r._dimensions[n]&&r._dimensions[n].Units&&e.each(r._dimensions[n].Units,function(e,t){return!t||t.label!==o&&t.Name!==o||(t.default=!0),!(t&&t.default)}),l[n]&&l[n].Units&&e.each(l[n].Units,function(e,t){return t&&(t.label===o||t.Name&&t.Name===o)&&(t.default=!0),!(t&&t.default)})}}),i(l[t.magnitude].Units.slice(0))}else n(new Error("invalid server response"))},n)}else n(new Error("invalid 3DSpace URL"))},n):n(new Error("No Units Defined"))},n)}else n(new Error("no magnitude provided!"));else n(new Error("invalid parameters"))})},updateMagnitudeUnits:function(t){var s=this,n=[],o=t.defaultUnits;return","===o.slice(-1)&&(o=o.slice(0,-1)),e.each(o.split(","),function(e,t){if(t){var i=t.split(":"),s="";2===i.length&&(s=i[0].replace("Parameter",""),n.push(s))}}),new i(function(i,o){t&&e.Object.isPlainObject(t)?a.getServiceUrl({serviceName:"3DSpace"}).then(function(l){if(l&&"string"==typeof l){var c={};t&&t.defaultUnits&&(c.key="preference_DisplayUnits",c.value=t.defaultUnits);var u=l+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";a.useFixtures()&&(u=l+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateMagnitudeUnits"),a.callAuthenticatedRequest(u,"json","PATCH",c).then(function(t){if(t){var l=a.commonAjaxJsonResponseOK(t,o);if(!l)return l;var c={};e.each(t.Data.preference_DisplayUnits.split(","),function(t,a){if(a){var l=a.split(":"),u="",d="";2===l.length&&(u=l[0].replace("Parameter",""),d=l[1]),c[l[0]]=l[1],r&&r._dimensions&&r._dimensions[u]&&r._dimensions[u].Units&&e.each(r._dimensions[u].Units,function(e,t){return t&&(t.label===d||!t.label&&t.Name===d)?t.default=!0:t&&t.default&&delete t.default,!(t&&t.default)}),n.indexOf(u)>-1&&s.getMagnitudeUnits({magnitude:u}).then(function(t){if(t){var s=!1;t&&(e.each(t,function(e,t){return!(s=t&&t.default)}),s)?i(t.slice(0)):t&&e.each(t,function(e,t){return t&&(t.label===d||t.Name&&t.Name===d)?t.default=!0:t&&t.default&&delete t.default,!(t&&t.default)})}else o(new Error("No Units Defined"))})}}),i(c)}else o(new Error("invalid server response"))},o)}else o(new Error("invalid 3DSpace URL"))},o):o(new Error("invalid parameters"))})},convertValueToUnit:function(t){return new i(function(i,s){t&&e.Object.isPlainObject(t)&&"value"in t&&!isNaN(t.value)&&t.dimension&&t.fromUnit&&t.toUnit?a.getServiceUrl({serviceName:"3DSpace"}).then(function(e){var n={UnitFrom:t.fromUnit,UnitTo:t.toUnit,Dimension:t.dimension,Value:""+t.value},r=e+"/resources/dictionary/dimensions/convertValue";a.callAuthenticatedRequest(r,"json","POST",JSON.stringify(n)).then(function(e){e&&"ConvertValue"in e?i(e.ConvertValue):s(new Error("invalid server response"))},s)},s):s(new Error("invalid parameters"))})},getOneResource:function(t){var s=this;return new i(function(i,n){if(t&&e.Object.isPlainObject(t))if(t.physicalid){"Minimum"in t&&!0!==t.Minimum?t.Minimum&&Array.isArray(t.Minimum)||(t.Minimum="False"):t.Minimum="True";var r=t.Minimum,o=["V_Name","physicalid"];t.Minimum&&!Array.isArray(t.Minimum)&&(t.Minimum.match(/true/i)||t.Minimum.match(/yes/i)||t.Minimum.match(/on/i))&&(t.Minimum=o);var l=s._FindPLMObjectInCache(t,t.Minimum);l&&!l.ReferenceOXID&&!l.ReferencePhysicalid&&r&&r.match&&(r.match(/true/i)||r.match(/yes/i)||r.match(/on/i))&&(t.Minimum=o,l=s._FindPLMObjectInCache(t,t.Minimum)),l?i(Object.assign({},l)):(t.class_name||(t.class_name="PRODUCTCFG/VPMReference"),t.Extensions||(t.Extensions="DELRmiResourceModel/Resource"),!t.fixtureTag&&a.useFixtures()&&(t.fixtureTag="getResourceForPhysicalId"),a.getReference(t).then(function(e){e&&s._cacheResource(Object.assign({},e)),i(e)},n))}else n(new Error("no id provided!"));else n(new Error("invalid parameters"))})},_FindPLMObjectInCache:function(t,i){var s=Object.assign({},t);if(e.each(s,function(t,i){(e.Object.isPlainObject(i)||Array.isArray(i))&&delete s[t]}),!s.OXID&&!s.physicalid&&!s.PLM_ExternalID){if(!s.id)return null;s.PLM_ExternalID=s.id}s.OXID&&!s.physicalid&&(s.physicalid=a.getPhysicalIDForOXID(s.OXID));var n=null;return e.each(["parameter_list","parameter","resource"],function(t,a){var o=r[a];if(o){if(n||!s.OXID&&!s.physicalid||!(n=o[s.physicalid||s.OXID])&&s.OXID&&(n=o[s.OXID])&&s.physicalid&&(o[s.physicalid]=o[s.OXID]),n)if(s.ForceCache?n.ForceCache=s.ForceCache:s.bForceCache&&(n.ForceCache=s.bForceCache),i&&i instanceof Array){l=n,c=i,u=!0,e.each(c,function(t,i){return i&&"string"!=typeof i&&i.dataIndex&&(i=i.dataIndex),!(u=l.hasOwnProperty(i))&&0===i.indexOf("V_")&&Object.keys&&e.each(Object.keys(l),function(e,t){return(u=t.indexOf(")."+i)>0&&0===t.indexOf("Ext("))&&(i=t),!u}),!u&&i.indexOf("__Ref_")<0&&"VPMInstance"===l.plmObjectType&&(u=l.hasOwnProperty("__Ref_"+i))&&(i="__Ref_"+i),u}),u||(n=null)}else i&&"false"!==i.toLowerCase()||n.AllAttributesRetrieved||n.ForceCache||(n=null);var l,c,u;return!n}}),n},searchForResourceParameterListData:function(t){var n=this;return new i(function(i,r){t?a.getServiceUrl({serviceName:"3DSearch"}).then(function(o){if(window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.checkApplicationFeature&&!window.Foe.Model.Session.checkApplicationFeature("TSK7174741","0")||!o||"string"!=typeof o)n._searchForResourceParameterListDataWS(t,function(e){i(e)},function(e){r(new Error("invalid 3DSearch URL - "+e))});else{var l="("+n.get3DSearchString()+")";(t.search_str||t.name)&&"*"!==(t.search_str||t.name)&&(l+=" AND ("+(t.search_str||t.name)+")"),!t.tenant&&window.widget.data&&(t.tenant=window.widget.data.x3dPlatformId);var c=window.widget.data.appId||window.widget.id;window.Foe&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&(c=window.Foe.Model.Session.get("user"));var u={query:l,label:c+"-DELWebResourceParameterModel.searchForResourceParameterListData-"+(new Date).getTime(),locale:window.widget.lang,tenant:t.platformId||t.tenant,source:["3dspace"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","bo.PLMEntity.V_description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:project","ds6w:dataSource","ds6w:community","ds6w:repository","dcterms:title","dcterms:description","ds6w:containerUid"],with_synthesis:!1,with_synthesis_attribute:!1};t.Minimum&&Array.isArray(t.Minimum)&&t.Minimum.length&&e.each(t.Minimum,function(e,t){var i=t;s&&(i=s.convertAttrToSearchPredicate(t)),i&&Array.isArray(i)?i.forEach(function(e){u.select_predicate.indexOf(e)<0&&u.select_predicate.push(e)}):i&&u.select_predicate.indexOf(i)<0&&u.select_predicate.push(i)}),t.endindex&&(u.nresults="startindex"in t?t.endindex-t.startindex:t.endindex),u=window.UWA.Json.encode(u);var d=o+"/search";a.useFixtures()&&(d+="?searchForResourceParameterListData"),a.callAuthenticatedRequest(d,"json","POST",u,function(){n._searchForResourceParameterListDataWS(t,function(e){i(e)},function(e){r(new Error("invalid 3DSearch URL - "+e))})}).then(function(r){var o={},l=[];r&&r.results&&r.results.length&&(e.each(r.results,function(e,i){var r=s.convertToModelObj(i.attributes);!r.id&&r.resourceid&&(r.id=r.resourceid),!r.name&&r["ds6w:label"]&&(r.name=r["ds6w:label"]),o[r.id]=r,a.useFixtures()&&n._cacheResourceParameterList(r,"False"===t.Minimum)}),l=Object.values(o)),i(l)},function(e){r(e)},function(e){r(e)})}},r):r(new Error("Invalid input parameters!"))})},_searchForResourceParameterListDataWS:function(t,i,s){var r=this;if(s||(s=window.alert),t){var o=t.id||t.search_str;if(o||"id"in t){if(o instanceof Array){var l=o.join(";");o=l}var c={R:Math.random(),search_str:o,class_name:t.class_name?t.class_name:"DELRmiParameterModel/DELResourceParameterListReference",Extensions:"Extensions"in t?t.Extensions:"",Depth:0,Minimum:t.Minimum?t.Minimum:"False"};t.searchByAttribute&&(c.searchByAttribute=t.searchByAttribute),c.Minimum&&"string"==typeof c.Minimum&&"false"!==c.Minimum.toLowerCase()&&"true"!==c.Minimum.toLowerCase()&&(c.Minimum=[c.Minimum]),c.Minimum instanceof Array&&(c.Minimum=JSON.stringify(c.Minimum)),t&&t.startindex>=0&&t.endindex>=0&&(c.startindex=t.startindex,c.endindex=t.endindex),a.getServiceUrl({serviceName:"3DSpace"}).then(function(t){var o=t+"/resources/DELWebInfrastructureLite/v0/referenceFinder?searchForResourceParameterListDataWS";a.callAuthenticatedRequest(o,"json","GET",c).then(function(t){if(t){var o=a.commonAjaxJsonResponseOK(t,s);if(!o)return o;var l=c.class_name.split("/")[1];if(t&&e.Object.isPlainObject(t)&&t[l]&&Array.isArray(t[l])){var u=[],d=!1;e.each(t[l],function(){if(this.name=this.name||this.V_Name||this.PLM_ExternalID||this.id,r._FindPLMObjectInCache(this,c.Minimum||"True")?r._cacheResourceParameterList(this,this.AllAttributesRetrieved||!1):a.useFixtures()&&window.Foe&&window.Foe.Model&&window.Foe.Model.Asset&&r._cacheResourceParameterList(this,this.AllAttributesRetrieved||!1),!d&&a.useFixtures()&&c.search_str&&c.search_str.length){var e=c.search_str.replace("*","");this.V_Name===e&&(d=this)}u.push(this)}),i&&i(u)}else s&&s(n.replace("Error getting {0} list",{0:n.get("Resource Parameter List")}))}else s(n.get("Error"))},s)},s)}else s("No system id provided!")}else s("Invalid input parameters!")}});if(a.useFixtures()){var c=function(){var e=Math.random().toString();return e.substr(e.indexOf(".")+1)};window.Configuration&&window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterList.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s));var a=t.data;if("string"==typeof a&&(a=JSON.parse(a)),a&&a.disciplineFilter&&(s.Data=[],r&&r.parameter_list_assoc)){var n={};e.each(r.parameter_list_assoc,function(t,i){r.resource&&r.resource[t]&&r.resource[t].V_discipline===a.disciplineFilter&&i&&e.Object.isPlainObject(i)&&!e.Object.isEmptyObject(i)&&(n=Object.assign(n,i))}),e.Object.isEmptyObject(n)||(s.Data=Object.values(n))}i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"DELETE",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/unassociateResourceParameterList.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s)),s.Data={};var n=t.data;if("string"==typeof n&&(n=JSON.parse(n)),n.target_physicalid||n.target_OXID||n.target_resource){var o=n.target_resource?n.target_resource.physicalid:n.target_physicalid||a.getPhysicalIDForOXID(n.target_OXID);if(r.parameter_list_assoc&&o&&r.parameter_list_assoc[o]){var l=null;if(n.resourceParameterListAssociationphysicalid||n.resourceParameterListAssociationQueryList)s.Data.SuccessfullyUnassociated={},delete s.Data.AlreadyUnassociated,e.each(n.resourceParameterListAssociationQueryList||[n.resourceParameterListAssociationphysicalid],function(e,t){t&&r.parameter_list_assoc[o][t]?(l=r.parameter_list_assoc[o][t],s.Data.SuccessfullyUnassociated[l.properties.physicalid]=l):(s.Data.AlreadyUnassociated||(s.Data.AlreadyUnassociated=[]),s.Data.AlreadyUnassociated.push({physicalid:t}))});else if(n.resourceParameterList||n.resourceParameterListphysicalid||n.resourceParameterListOXID||n.resourceParameterListQueryList){s.Data.SuccessfullyUnassociated={},delete s.Data.AlreadyUnassociated;var c=n.resourceParameterListQueryList||[n.resourceParameterList];c&&c.length||(c=[{physicalid:n.resourceParameterListphysicalid||a.getPhysicalIDForOXID(n.resourceParameterListOXID)}]),e.each(c,function(t,i){i&&i.physicalid&&(l=null,e.each(r.parameter_list_assoc[o],function(e,t){t.resourceParameterList&&t.resourceParameterList.physicalid===i.physicalid&&(l=r.parameter_list_assoc[o][e],s.Data.SuccessfullyUnassociated[e]=l)}),l||(s.Data.AlreadyUnassociated||(s.Data.AlreadyUnassociated=[]),s.Data.AlreadyUnassociated.push({resource:n.target_resource||{physicalid:o},resourceParameterList:n.resourceParameterList||{physicalid:i.physicalid||t}})))})}}}i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/associateResourceParameterList.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s)),s.Data={};var n=t.data;if("string"==typeof n&&(n=JSON.parse(n)),n.target_physicalid||n.target_OXID||n.target_resource){var o=n.target_resource?n.target_resource.physicalid:n.target_physicalid||a.getPhysicalIDForOXID(n.target_OXID);if(r.parameter_list_assoc&&o&&r.parameter_list_assoc[o]){var l=null;if(n.resourceParameterList||n.resourceParameterListphysicalid||n.resourceParameterListOXID||n.resourceParameterListQueryList){s.Data.SuccessfullyAssociated={},delete s.Data.AlreadyAssociated;var c=n.resourceParameterListQueryList||[n.resourceParameterList];c&&c.length||(c=[{physicalid:n.resourceParameterListphysicalid||a.getPhysicalIDForOXID(n.resourceParameterListOXID)}]),e.each(c,function(t,i){if(i&&i.physicalid&&(l=null,e.each(r.parameter_list_assoc[o],function(e,t){return t.resourceParameterList&&t.resourceParameterList.physicalid===i.physicalid&&(s.Data.AlreadyAssociated||(s.Data.AlreadyAssociated=[]),s.Data.AlreadyAssociated.push(t),l=t),!l}),!l)){var a={physicalid:o};r.resource&&r.resource[o]&&(a=r.resource[o]),r.parameter_list&&r.parameter_list[i.physicalid]&&(i=Object.assign(i,r.parameter_list[i.physicalid])),l={resource:a,resourceParameterList:i,properties:{resourcePhysicalid:a.physicalid,V_Name:a.physicalid+"-"+i.physicalid,V_description:"",physicalid:a.physicalid+"-"+i.physicalid,rplPhysicalid:i.physicalid}},s.Data.SuccessfullyAssociated[l.properties.physicalid]=l}})}}}i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/createResourceParameterList.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s));var a=s.Data;s.Data={};var n=t.data;if("string"==typeof n&&(n=JSON.parse(n)),n.target_physicalid||n.target_OXID||n.target_resource){s.Data.SuccessfullyAssociated=[],n.target_resource||(n.target_resource={},n.target_physicalid&&(n.target_resource.physicalid=n.target_physicalid),n.target_OXID&&(n.target_resource.OXID=n.target_OXID));var o=null;e.each(a.SuccessfullyAssociated,function(t,i){return i&&i.resource&&i.resourceParameterList&&(o=e.clone(i)),!o}),o&&(o.resource=n.target_resource,r&&r.resource&&r.resource[n.target_resource.physicalid||n.target_resource.OXID]&&(o.resource=r.resource[n.target_resource.physicalid||n.target_resource.OXID]),delete o.resourceParameterList.physicalid,delete o.resourceParameterList.OXID,delete o.resourceParameterList.PLM_ExternalID,delete o.resourceParameterList.name,delete o.resourceParameterList.V_Name,delete o.resourceParameterList.V_description,o.resourceParameterList=Object.assign(o.resourceParameterList,{physicalid:c(),V_Name:null,V_description:""}),e.each(o.resourceParameterList,function(e){n[e]&&(o.resourceParameterList[e]=n[e])}),s.Data[o.resourceParameterList.physicalid]=o.resourceParameterList,s.Data.SuccessfullyAssociated.push(o))}i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"PATCH",url:o+"/resources/DELWebInfrastructureLite/v0/resource?updateResourceParameterList"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/updateResourceParameterList.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s)),s.Data={ChangedAttributes:{}};var a=t.data;"string"==typeof a&&(a=JSON.parse(a)),a.attributes&&"string"==typeof a.attributes&&(a.attributes=JSON.parse(a.attributes)),e.each(a.attributes,function(e,t){(t.V_Name||"V_description"in t)&&(t.V_Name&&(s.Data.ChangedAttributes.V_Name=t.V_Name),"V_description"in t&&(s.Data.ChangedAttributes.V_description=t.V_description))}),i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/referenceFinder?getOneResourceParameterList"},"../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListOne.json"),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter"},"../DELWebInfrastructureUI.tst/fixtures/getResourceParametersForList.json"),a.addFixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter?createResourceParameter"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/createResourceParameter.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s));var a=t.data;"string"==typeof a&&(a=JSON.parse(a));var n="DELRscPrmIORangeValue_";"Integer"===a.resourceParameterExtension?n="Integer":"String"===a.resourceParameterExtension&&(n="Text");var r=null,o=null;e.each(s.Data,function(e,t){return t&&(o||(o=t),!r&&t.interfaces&&t.interfaces.length&&t.interfaces[0].length&&t.interfaces[0][0].indexOf(n)>=0&&(r=t)),!r}),!r&&o&&(r=o),s.Data={},r&&(r.physicalid=c(),delete r.OXID,r.PLM_ExternalID="rpl-fixture_"+r.physicalid,delete r.name,e.each(r,function(t){if("Integer"!==a.resourceParameterExtension&&"String"!==a.resourceParameterExtension)a[t]&&(r[t]=a[t]);else if(delete r.maxLimit,delete r.minLimit,delete r.maxValue,delete r.minValue,delete r.units,a[t]&&(r[t]=a[t]),a.V_Values){var i=JSON.parse(a.V_Values);r.V_Values=[],e.each(i,function(e,t){r.V_Values[e]=t})}}),a.resourceParameterExtension&&"Integer"!==a.resourceParameterExtension&&"String"!==a.resourceParameterExtension&&(r.interfaces=[["DELRscPrmIORangeValue_"+a.resourceParameterExtension,"DELRscPrmIOValueAbstract"]]),a.extensions&&("string"==typeof a.extensions&&(a.extensions=JSON.parse(a.extensions)),r.extensions=e.Object.extend(!0,{},a.extensions),e.each(a.extensions,function(e,t){r.interfaces.push([e])})),a.inputOutput&&(r.plmObjectTypeInternal=r.V_discipline="DELResourcePrm"+a.inputOutput.toUpperCase(),r.OXID="["+r.physicalid+","+r.plmObjectTypeInternal+",businessobject]"),s.Data[r.physicalid]=r),i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"PATCH",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter?updateResourceParameter"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/updateResourceParameter.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s)),s.Data={ChangedAttributes:{}};var a=t.data;if("string"==typeof a&&(a=JSON.parse(a)),(a.V_Name||"V_description"in a)&&(a.V_Name&&(s.Data.ChangedAttributes.V_Name=a.V_Name),"V_description"in a&&(s.Data.ChangedAttributes.V_description=a.V_description)),a.attributes&&"string"==typeof a.attributes){var n=JSON.parse(a.attributes);$.each(n,function(e,t){s.Data.ChangedAttributes[e]=t})}a.extensions&&(s.Data.extensions=a.extensions,"string"==typeof s.Data.extensions&&(s.Data.extensions=JSON.parse(s.Data.extensions)),s.Data.interfaces?"string"==typeof s.Data.interfaces&&(s.Data.interfaces=JSON.parse(s.Data.interfaces)):r.parameter&&a.resourceParameterPhysicalid&&r.parameter[a.resourceParameterPhysicalid]&&r.parameter[a.resourceParameterPhysicalid].interfaces?s.Data.interfaces=r.parameter[a.resourceParameterPhysicalid].interfaces.slice(0):s.Data.interfaces=[],e.each(Object.keys(s.Data.extensions),function(t,i){var a=!1;e.each(s.Data.interfaces,function(e,t){return t&&Array.isArray(t)&&(a=t.indexOf(i)>=0),!a}),a||s.Data.interfaces.push([[i]])})),a.extensionsToRemove&&(s.Data.removedExtensions=a.extensionsToRemove,"string"==typeof s.Data.removedExtensions&&(s.Data.removedExtensions=JSON.parse(s.Data.removedExtensions)),e.each(s.Data.removedExtensions,function(e,t){if(s.Data.extensions&&s.Data.extensions[t]&&delete s.Data.extensions[t],s.Data.interfaces){"string"==typeof s.Data.interfaces&&(s.Data.interfaces=JSON.parse(s.Data.interfaces));for(var i=s.Data.interfaces.length-1;i>=0;--i){var a=s.Data.interfaces[i];a&&Array.isArray(a)&&a.indexOf(t)>=0&&s.Data.interfaces.splice(i,1)}}})),i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"DELETE",url:o+"/resources/DELWebInfrastructureLite/v0/resource/parameter?unassociateResourceParameterFromList"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/unassociateResourceParameterFromList.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s)),s.Data={};var n=t.data;"string"==typeof n&&(n=JSON.parse(n));var o=n.resourceParameterListphysicalid,l=null;if(n.resourceParameterPhysicalid||n.resourceParameterQueryList)s.Data.SuccessfullyDeleted={},delete s.Data.AlreadyUnassociated,e.each(n.resourceParameterQueryList||[{physicalid:n.resourceParameterPhysicalid}],function(e,t){var i=t.physicalid;!n.resourceParameterListphysicalid&&i&&r.parameter&&r.parameter[i]&&r.parameter[i].rplPhysicalid&&(o=r.parameter[i].rplPhysicalid),i&&r.parameter[i]&&r.parameter_list[o]&&r.parameter_list[o].associatedResourceParameters&&r.parameter_list[o].associatedResourceParameters.indexOf(i)>=0?(l=r.parameter[i],s.Data.SuccessfullyDeleted[i]=l):(s.Data.AlreadyUnassociated||(s.Data.AlreadyUnassociated=[]),s.Data.AlreadyUnassociated.push({physicalid:i}))});else if(n.resourceParameterList||n.resourceParameterListphysicalid||n.resourceParameterListOXID||n.resourceParameterListQueryList){s.Data.SuccessfullyDeleted={},delete s.Data.AlreadyUnassociated;var c=n.resourceParameterListQueryList||(n.resourceParameterList?[n.resourceParameterList]:null);c&&c.length||(c=[{physicalid:n.resourceParameterListphysicalid||a.getPhysicalIDForOXID(n.resourceParameterListOXID)}]),e.each(c,function(t,i){i&&i.physicalid&&(l=null,e.each(r.parameter_assoc[o],function(e,t){t.resourceParameterList&&t.resourceParameterList.physicalid===i.physicalid&&(l=r.parameter_assoc[o][e],s.Data.SuccessfullyDeleted[e]=l)}),l||(s.Data.AlreadyUnassociated||(s.Data.AlreadyUnassociated=[]),s.Data.AlreadyUnassociated.push({resource:n.target_resource||{physicalid:o},resourceParameterList:n.resourceParameterList||{physicalid:o}})))})}i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"PATCH",url:o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateDefaultMagnitudes"},function(e){var t=a.request("../DELWebInfrastructureUI.tst/fixtures/updateDefaultMagnitudes.json",{onComplete:function(i){"string"==typeof i&&(i=JSON.parse(i)),i.Data={};var s=e.data;"string"==typeof s&&(s=JSON.parse(s)),"preference_DimensionsList"===s.key&&(i.Data.preference_DimensionsList=s.value),t.responseText=JSON.stringify(i),e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})}),a.addFixture({type:"PATCH",url:o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateMagnitudeUnits"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/updateMagnitudeUnits.json",{onComplete:function(s){"string"==typeof s&&(s=JSON.parse(s));var a=s.Data.preference_DisplayUnits.split(","),n=[];e.each(a,function(e,t){if(e%2==0){var i=t.split(":");n.push(i[0])}}),s.Data={};var r=t.data;"string"==typeof r&&(r=JSON.parse(r)),"preference_DisplayUnits"===r.key&&(s.Data.preference_DisplayUnits=r.value),i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"POST",url:o+"/resources/dictionary/dimensions/convertValue"},function(e){var t=a.request("../DELWebInfrastructureUI.tst/fixtures/dimensions_convertValue.json",{onComplete:function(i){"string"==typeof i&&(i=JSON.parse(i));var s=e.data;"string"==typeof s&&(s=JSON.parse(s)),i.UnitFrom=s.UnitFrom,i.UnitTo=s.UnitTo,i.ValueToConvert=s.Value||0,i.ConvertValue=-i.ValueToConvert,t.responseText=JSON.stringify(i),e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})}),a.addFixture({type:"GET",url:o+"/resources/dictionary/dimensions"},"../DELWebInfrastructureUI.tst/fixtures/getMagnitudes.json"),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace"},"../DELWebInfrastructureUI.tst/fixtures/getThreeDSpacePreferences.json"),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"},"../DELWebInfrastructureUI.tst/fixtures/getThreeDSpacePreferences.json"),a.addFixture({type:"POST",url:o.substr(0,o.lastIndexOf("/"))+"/federated/search?searchForResourceParameterListData"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListSearchData.json",{onComplete:function(a){if("string"==typeof a&&(a=JSON.parse(a)),r&&r.parameter_list&&!e.Object.isEmptyObject(r.parameter_list)){var n=[];e.each(a.results,function(t,i){e.each(i.attributes,function(e,t){return"resourceid"!==t.name||(n.push(t.value),!1)})});var o=a.results[0].attributes;e.each(r.parameter_list,function(t,i){if(t===i.physicalid&&!(n.indexOf(i.physicalid)>=0)){n.push(i.physicalid);var r=[];e.each(o,function(t,a){var n=e.Object.extend(!0,{},a),o=s.convertSearchPredicateToAttr(n.name.replace(":snippet",""));if(o){switch(o){case"resourceid":n.value=i.physicalid||null;break;case"ds6w:identifier":n.value=i.PLM_ExternalID||null;break;case"label":n.value=i.V_Name||null;break;default:n.value=i[o]||n.value||null}r.push(n)}else e.log("DELWebResourceParameterModel::getResourceParameterListSearchData fixture- unknown attribute = "+n.name)}),a.results.push({attributes:r})}})}i.responseText=JSON.stringify(a),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/referenceFinder?searchForResourceParameterListDataWS"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListSearchDataWS.json",{onComplete:function(s){if("string"==typeof s&&(s=JSON.parse(s)),r&&r.parameter_list&&!e.Object.isEmptyObject(r.parameter_list)){var a=[];e.each(s.DELResourceParameterListReference,function(e,t){t.physicalid&&a.push(t.physicalid)}),e.each(r.parameter_list,function(e,t){e===t.physicalid&&(a.indexOf(t.physicalid)>=0||(a.push(t.physicalid),s.DELResourceParameterListReference.push(t)))})}i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))}})}),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/interface/getImmediateDerivative?getExtensions&DELResourcePrmINPUT"},"../DELWebInfrastructureUI.tst/fixtures/getExtensions_DELResourcePrmINPUT.json"),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/interface/getImmediateDerivative?getExtensions&DELResourcePrmOUTPUT"},"../DELWebInfrastructureUI.tst/fixtures/getExtensions_DELResourcePrmOUTPUT.json"),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/attributesDictionary?getExtensionProperties&DELResourcePrmINPUT"},"../DELWebInfrastructureUI.tst/fixtures/attributesDictionary_DELResourcePrmINPUT.json"),a.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructure/v0/attributesDictionary?getExtensionProperties&DELResourcePrmOUTPUT"},"../DELWebInfrastructureUI.tst/fixtures/attributesDictionary_DELResourcePrmOUTPUT.json")}return l}),window.define&&define("DS/DELWebInfrastructureControls/DELWebSearchUtils",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebAjaxModel"],function(e,t,i,s){"use strict";return t.singleton({getUnifiedSearchUnserializedDataFromDrop:function(t){var i=t.originalEvent||t,s=[];if(!e.is(i))return e.log("ERROR: No dropped item found"),s;for(var a,n=null,r=e.is(i.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o="",l=["text/searchitems","text/plain","Text"],c=0;c<l.length&&""===o;c++){var u=i.dataTransfer.types[r](l[c]);(e.is(u,"number")&&u>=0||e.is(u,"boolean")&&!0===u)&&(o=l[c])}if(""===o)return e.log("ERROR: No data retrieved"),s;a=i.dataTransfer.getData(o);try{n=e.Json.decode(a)}catch(e){return s}return e.is(n)?e.is(n.data)?(e.String.contains(window.widget.getUrl(),"TSK5358265=0")||("source"in n&&"X3DSEAR_AP"!==n.source&&this.isDataStructureSameAsSearch(n)?(window.OpenAjax&&"dataSource"in n&&"index"!==n.dataSource&&window.OpenAjax.hub.publish("UnifiedSearch.Results.setAuthoring",{}),n.source="X3DSEAR_AP"):"source"in n||!this.isDataStructureSameAsSearch(n)||(n.source="X3DSEAR_AP")),n):(e.log("ERROR: No data retrieved"),s):(e.log("ERROR: Parsing returned null"),s)},getUnifiedSearchUnserializedItemsFromDrop:function(t){if(!t||!t.originalEvent&&!(t||t.originalEvent).dataTransfer)return e.log("DELWebSearchUtils::getUnifiedSearchUnserializedItemsFromDrop - invalid input params!"),null;var i=[],s=null;try{s=this.getUnifiedSearchUnserializedDataFromDrop(t)}catch(e){return i}return e.is(s)?"X3DSEAR_AP"!==s.source?(e.log("DELWebSearchUtils::getUnifiedSearchUnserializedItemsFromDrop - not unified search"),null):e.is(s.data)?e.is(s.data.items,"array")?(s.data.items.length>0&&(i=s.data.items),i):(e.log("ERROR: Items is not an array"),i):(e.log("ERROR: No data retrieved"),i):(e.log("ERROR: Parsing returned null"),i)},getUnifiedSearchObjectsFromDrop:function(t){var a=this;return new i(function(i,n){if(!t||!t.ev)return e.log("DELWebSearchUtils::getUnifiedSearchObjects - invalid input params!"),n(new Error("DELWebSearchUtils::getUnifiedSearchObjects - invalid input params!")),!1;var r=t.ev,o=a.getUnifiedSearchUnserializedItemsFromDrop(r);if(o&&o.length){for(var l={Minimum:"false",QueryList:[]},c={},u=0;u<o.length;u++){var d=o[u];if(d.objectId&&d.objectType&&"VPMReference"===d.objectType){var m={physicalid:d.objectId,Depth:0};l.QueryList.push(m)}else if(d.objectId){var p={name:d.displayName,type:d.objectType,objectType:d.objectType,serviceId:d.serviceId,id:d.objectId};c[d.objectId]=p}}if(l.QueryList.length>0)return s.getTree(l).then(function(t){e.each(t,function(e,t){c[e]=t}),i(c)},n);i(c)}else n(o?new Error("Invalid Parameters!"):new Error("Unknown source type"))})}})}),window.define&&define("DS/DELWebInfrastructureControls/CommonControllers/confirmationDialog",["DS/DELWebInfrastructureControls/UWAUtils","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,s){"use strict";return t.inherit({name:"ConfirmationDialog",contentVisibleState:!1,publishedProperties:{title:{defaultValue:s.get("Confirm"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"}},init:function(e){e?this.options=Object.assign(this.options||{},e):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){this._parent.apply(this,arguments),this._closeCallback&&this._closeCallback(),!this._createDlg&&this.options&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg&&!this._createDialogDestroyed&&(this._createDialogDestroyed=!0,this._createDlg.destroy())},_postBuildView:function(){this.elements.container.addClassName("confirm_dlg_webUX"),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this.elements.container.addClassName("wux-ui-animation-flip-out"),this._parent();var t=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var a=window.document.getElementsByClassName("wux-windows-immersive-frame");if(a&&a.length)for(var n=0;!this.immersiveFrame&&n<a.length;++n)a[n]&&a[n].dsModel&&(this.immersiveFrame=a[n].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.buttons={Ok:new i({label:s.get("Confirm"),onClick:function(){t.buttons.Ok.elements.button.addClassName("loading"),t.buttons.Ok.disabled=!0,t.options.onConfirm()}}),Cancel:new i({onClick:function(){t.hideDialog(),t.showCreateDialog()}})},this.elements.mainDiv.innerHTML="<div>Confirm?</div>",this._initEventHandlers()},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showCreateDialog:function(e){!this._createDlg&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg.showDialog(e)},showDialog:function(e){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in");var t=e&&e.confirmationMesssage?e.confirmationMesssage:"Confirm?";this.elements.mainDiv.innerHTML="<div>"+t+"</div>"},_initEventHandlers:function(){var e=this;this.addEventListener("close",function(){e.hideDialog(),e.showCreateDialog()})}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebPointCloudAssociationModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebAjaxModel"],function(e,t,i,s,a){"use strict";var n={},r=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:".";window.Fam&&window.Fam.Model&&window.Fam.Model.Platform&&window.Fam.Model.Platform.webroot&&(r=window.Fam.Model.Platform.webroot);var o=t.singleton({init:function(){n=a.getCacheObject()},get3DSearchString:function(){return"flattenedtaxonomies:types/R2V_FeatureOfInterest OR flattenedtaxonomies:types/R2V_FeatureState OR flattenedtaxonomies:types/R2V_State"},getPointCloudAssociationForResource:function(t){var s=this;return new i(function(i,r){if(t&&(t.physicalid||t.QueryList)){var o={};if(t.QueryList){var l=!0;if(n.point_cloud_assoc&&!t.blnForceRefresh?e.each(t.QueryList,function(e,t){return(l=t&&t.physicalid&&n.point_cloud_assoc[t.physicalid])&&(o[t.physicalid]=n.point_cloud_assoc[t.physicalid]),!!l}):l=!1,l)return void i(e.clone(o))}else if(n.point_cloud_assoc&&!t.blnForceRefresh&&n.point_cloud_assoc[t.physicalid]&&!e.Object.isEmptyObject(n.point_cloud_assoc[t.physicalid]))return o[t.physicalid]=n.point_cloud_assoc[t.physicalid],void i(e.clone(o));a.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l={};if(t.physicalid)l.target_physicalid=t.physicalid;else if(t.QueryList){var c=[];e.each(t.QueryList,function(e,t){t&&(t.physicalid?c.push({physicalid:t.physicalid}):c.push(t))}),l.target_QueryList=JSON.stringify(c)}var u=o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";a.callAuthenticatedRequest(u,"json","GET",l).then(function(o){if(o){var l=a.commonAjaxJsonResponseOK(o,r);if(!l)return l;n.point_cloud_assoc||(n.point_cloud_assoc={});var c=o.Data||{};a.useFixtures()&&n.point_cloud_assoc[t.physicalid]&&!t.blnForceRefresh?c[t.physicalid]=n.point_cloud_assoc[t.physicalid]:t.blnForceRefresh&&n.point_cloud_assoc[t.physicalid]&&delete n.point_cloud_assoc[t.physicalid],t.physicalid&&!n.point_cloud_assoc[t.physicalid]&&(n.point_cloud_assoc[t.physicalid]={});var u={};e.each(c,function(i,r){var o=null,l=null;a.useFixtures()&&!t.QueryList&&(i=t.physicalid),e.each(r,function(e,t){"VPMPointCloudRepReference"===t.plmObjectType?o=t:l=t}),s._cacheR2VAssociation(i,o,l),u[i]=n.point_cloud_assoc[i]}),i(e.clone(u))}else r(new Error("invalid server response"))},r)}else r(new Error("invalid 3DSpace URL"))},r)}else r(new Error("invalid parameters"))})},createPointCloudAssociationForResource:function(t){var s=this;return new i(function(i,r){t&&(t.target_physicalid||t.targetResource)&&t["V_PointCloudIdentifier.serviceId"]&&t["V_PointCloudIdentifier.objectId"]?a.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l=e.clone(t);t.physicalid&&!l.target_physicalid&&(l.target_physicalid=t.physicalid);var c=l.target_physicalid,u=o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";a.callAuthenticatedRequest(u,"json","POST",l).then(function(t){if(t){var o=a.commonAjaxJsonResponseOK(t,r);if(!o)return o;n.point_cloud_assoc||(n.point_cloud_assoc={});var l=t.Data||{};c&&!n.point_cloud_assoc[c]&&(n.point_cloud_assoc[c]={});var u={},d=null,m=null;e.each(l,function(e,t){"VPMPointCloudRepReference"===t.plmObjectType?d=t:m=t}),s._cacheR2VAssociation(c,d,m),u[c]=n.point_cloud_assoc[c],a.publishEvent("PointCloudAssociation.created",Object.assign({},u)),i(e.clone(u))}else r(new Error("invalid server response"))},r)}else r(new Error("invalid 3DSpace URL"))},r):r(new Error("invalid parameters"))})},getStateOrFOIInfoForR2VObjects:function(t){var s=this;return new i(function(i,r){var o=t.serviceId,l=t.ids;if(o&&"r2vsurvey"===o)if(l){var c={};if(t.ids&&t.ids.length>0){var u=[],d=[];if(t.blnForceRefresh?e.each(t.ids,function(e,i){i&&i.indexOf("-")<0?u=t.ids:d=t.ids}):e.each(t.ids,function(e,t){n&&n.cslId2PhysicalID&&n.cslId2PhysicalID[t]&&(t=n.cslId2PhysicalID[t]);var i=s._getR2VFOIFromCache(t);if(i)c[t]=i;else{var a=s._getR2VStateFromCache(t);a?c[t]=a:t&&t.indexOf("-")<0&&u.push(t)}t&&t.indexOf("-")>=0&&d.push(t)}),0===u.length&&0===d.length)return void i(e.clone(c));if(d.length>0)return s.getPhysicalIDForCslID(d).then(function(e){return t.cslids=d,t.ids=e,s.getStateOrFOIInfoForR2VObjects(t).then(i,r)},r);var m={ids:u,serviceId:t.serviceId};s.fetchFOIInfo(m).then(function(a){if(e.each(a,function(e,t){c[e]=t;var i=u.indexOf(e);u.splice(i,1)}),0!==u.length){var n={ids:u,serviceId:t.serviceId};s.fetchLocationStateInfo(n).then(function(t){e.each(t,function(e,t){c[e]=t;var i=u.indexOf(e);u=u.splice(i,1)}),0!==u.length&&(c.ERROR="Could not find "+u.length+" object(s)"),i(e.clone(c))})}else i(e.clone(c))})}else t.ids&&0===t.ids.length&&t.cslids&&t.cslids.length>0&&a.getServiceUrl({serviceName:"r2vsurvey"}).then(function(s){s&&"string"==typeof s?$.each(t.cslids,function(t,a){c[a]={invalid_permission_r2vObject:!0},c[a].thumbnail=s+"/common/images/foi/thumbnail.png",i(e.clone(c))}):r(new Error("invalid R2VSurvey URL"))})}else r(new Error("invalid ids"));else r(new Error("invalid serviceId"))})},getPhysicalIDForCslID:function(t){return new i(function(i,s){var r=t;if(0!==r.length){var o=[],l=0;n.cslId2PhysicalID&&e.each(r,function(e,t){n.cslId2PhysicalID[t]&&(o.push(n.cslId2PhysicalID[t]),l++),l===r.length&&i(o)});var c=null;a.getServiceUrl({serviceName:"r2vsurvey"}).then(function(e){if(e&&"string"==typeof e){var t=e+"/resources/r2v/v1/modeler/csl";a.useFixtures()?(t=e+"/resources/r2v/v1/modeler/csl?getPhysicalIDForCslID",(c={}).id=r[0]):t+="/"+r[0],a.callAuthenticatedRequest(t,"json","GET",c).then(function(e){if(e&&e.resourceid){var t=e.resourceid;n.cslId2PhysicalID||(n.cslId2PhysicalID={}),n.cslId2PhysicalID[r[0]]||(n.cslId2PhysicalID[r[0]]=t),n.physicalid2cslId||(n.physicalid2cslId={}),n.physicalid2cslId[t]||(n.physicalid2cslId[t]=r[0]),o.push(t),i(o)}else s(new Error("invalid server response"))},function(e){e.message.indexOf(r[0])>=0&&i([])})}else s(new Error("invalid R2VSurvey URL"))},s)}else s(new Error("invalid cslId"))})},fetchFOIInfo:function(t){var s=this;return new i(function(i,r){var o=t.serviceId,l=t.ids;if(o&&"r2vsurvey"===o)if(l){var c={};if(t.ids){var u=!0;if(t.blnForceRefresh?u=!1:e.each(t.ids,function(e,t){n&&n.cslId2PhysicalID&&n.cslId2PhysicalID[t]&&(t=n.cslId2PhysicalID[t]);var i=s._getR2VFOIFromCache(t);i?c[t]=i:u=!1}),u)return void i(e.clone(c));a.getServiceUrl({serviceName:"r2vsurvey"}).then(function(n){if(n&&"string"==typeof n){var o={ids:t.ids},l=JSON.stringify(o),c=n+"/resources/r2v/v1/modeler/featureofinterest/fetch";a.callAuthenticatedRequest(c,"json","POST",l).then(function(t){if(t&&t.result){var a=t.result||[],n={};e.each(a,function(e,t){var i=s._cacheR2VFOI(t);n[i.id]=i}),i(e.clone(n))}else r(new Error("invalid server response"))},r)}else r(new Error("invalid R2VSurvey URL"))},r)}}else r(new Error("invalid ids"));else r(new Error("invalid serviceId"))})},getLocationStatesForFOI:function(t){var s=this;return new i(function(i,n){var r=t.serviceId,o=t.id;if(r&&"r2vsurvey"===r)if(o){if(t.id){if(!t.blnForceRefresh){var l=s._getStatesForFOIFromCache(t.id)||{};if(!e.Object.isEmptyObject(l))return void i(e.clone(l))}a.getServiceUrl({serviceName:"r2vsurvey"}).then(function(r){if(r&&"string"==typeof r){var o={},l=r+"/resources/r2v/v1/modeler/featureofinterest/"+t.id+"/featurestates";a.useFixtures()&&(l=r+"/resources/r2v/v1/modeler/featureofinterest/id/featurestates",o.id=t.id),a.callAuthenticatedRequest(l,"json","GET",o).then(function(a){if(a&&a.result){var r=a.result||[],o={};e.each(r,function(e,i){var a=s._cacheFOIStates(t.id,i);o[a.id]=a}),i(e.clone(o))}else n(new Error("invalid server response"))},n)}else n(new Error("invalid R2VSurvey URL"))},n)}}else n(new Error("invalid id"));else n(new Error("invalid serviceId"))})},fetchLocationStateInfo:function(t){var s=this;return new i(function(i,n){var r=t.serviceId,o=t.ids;if(r&&"r2vsurvey"===r)if(o){var l={};if(t.ids){var c=!0;if(t.blnForceRefresh?c=!1:e.each(t.ids,function(e,t){var i=s._getR2VStateFromCache(t);i?l[t]=i:c=!1}),c)return void i(e.clone(l));a.getServiceUrl({serviceName:"r2vsurvey"}).then(function(r){if(r&&"string"==typeof r){var o={ids:t.ids},l=JSON.stringify(o),c=r+"/resources/r2v/v1/modeler/featurestate/fetch";a.callAuthenticatedRequest(c,"json","POST",l).then(function(t){if(t&&t.result){var a=t.result,r={};e.each(a,function(e,t){var i=s._cacheR2VState(t);r[i.id]=i}),i(e.clone(r))}else n(new Error("invalid server response"))},n)}else n(new Error("invalid R2VSurvey URL"))},n)}}else n(new Error("invalid ids"));else n(new Error("invalid serviceId"))})},updatePointCloudAssociationForResource:function(t){var s=this;return new i(function(i,r){t&&(t.repReference_physicalid||t.RepReference)&&t["V_PointCloudIdentifier.serviceId"]&&t["V_PointCloudIdentifier.objectId"]?a.getServiceUrl({serviceName:"3DSpace"}).then(function(o){if(o&&"string"==typeof o){var l=e.clone(t);t.physicalid&&!l.repReference_physicalid&&(l.repReference_physicalid=t.physicalid);var c=t.target_physicalid,u=o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";a.callAuthenticatedRequest(u,"json","PATCH",l).then(function(t){if(t){var o=a.commonAjaxJsonResponseOK(t,r);if(!o)return o;var l=t.Data||{};n.point_cloud_assoc||(n.point_cloud_assoc={});var u={};e.each(l,function(e,t){if(n.point_cloud_assoc[c]){var i=n.point_cloud_assoc[c],a=i.repReference,r=Object.assign(a,t);c&&s._cacheR2VAssociation(c,r,i.repInstance),u[c]=n.point_cloud_assoc[c]}}),a.publishEvent("PointCloudAssociation.updated",Object.assign({},u)),i(e.clone(u))}else r(new Error("invalid server response"))},r)}else r(new Error("invalid 3DSpace URL"))},r):r(new Error("invalid parameters"))})},deletePointCloudAssociationForResource:function(t){return new i(function(i,s){t&&(t.target_physicalid||t.targetResource)?a.getServiceUrl({serviceName:"3DSpace"}).then(function(r){if(r&&"string"==typeof r){var o=e.clone(t),l=t.target_physicalid||t.targetResource.physicalid,c=r+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";a.callAuthenticatedRequest(c,"json","DELETE",o).then(function(t){if(t){var r=a.commonAjaxJsonResponseOK(t,s);if(!r)return r;var o=t.Data||{},c=[],u=o.SuccessfullyDeleted||{},d=o.FailedDelete||{},m=o.TargetReferenceWithNothingToRemove||{},p=o.RepReferenceAlreadyRemoved||{},h=!1,f={};if(e.Object.isEmptyObject(m)&&e.Object.isEmptyObject(p)||(f={},e.Object.isEmptyObject(m)||f.put("NoAssociationsToDeleteResource",m),e.Object.isEmptyObject(p)||f.put("NoAssociationsToDeleteRepRef",p),c.push({event:"PointCloudAssociation.deleted.error",data:f}),h=!0),e.Object.isEmptyObject(d)||(f={},e.Object.isEmptyObject(d)||f.put("FailedDelete",d),c.push({event:"PointCloudAssociation.deleted.error",data:f}),h=!0),!e.Object.isEmptyObject(u)){n.point_cloud_assoc||(n.point_cloud_assoc={}),l&&n.point_cloud_assoc[l]&&delete n.point_cloud_assoc[l];var g={};g[l]=e.clone(u),c.push({event:"PointCloudAssociation.deleted",data:g})}e.each(c,function(e,t){a.publishEvent(t.event,t.data)}),h?s(e.clone(o)):i(e.clone(o))}else s(new Error("invalid server response"))},s)}else s(new Error("invalid 3DSpace URL"))},s):s(new Error("invalid parameters"))})},_cacheR2VAssociation:function(t,i,s){n.point_cloud_assoc||(n.point_cloud_assoc={});var a={};i&&(a.repReference=e.clone(i)),s&&(a.repInstance=e.clone(s)),n.point_cloud_assoc[t]=a},_cacheFOIStates:function(t,i){var s=this._cacheR2VState(i);return n.r2v_foi_state_assoc||(n.r2v_foi_state_assoc={}),n.r2v_foi_state_assoc[t]||(n.r2v_foi_state_assoc[t]=[]),n.r2v_foi_state_assoc[t].push(s.id),e.clone(s)},_getStatesForFOIFromCache:function(t){var i=this;if(!n.r2v_foi_state_assoc||!n.r2v_foi_state_assoc[t]||!n.r2v_State)return null;var s=n.r2v_foi_state_assoc[t],a={};return e.each(s,function(e,t){a[t]=i._getR2VStateFromCache(t)}),a},_cacheR2VFOI:function(t){n.r2v_FOI||(n.r2v_FOI={});var i=e.clone(t);return!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),!i.description&&i.grid["ds6w:description"]&&(i.description=i.grid["ds6w:description"]),n.r2v_FOI[i.id]=e.clone(i),i&&i.cslId&&!n.r2v_FOI[i.cslId]&&(n.r2v_FOI[i.cslId]=n.r2v_FOI[i.id]),i&&i.cslId&&i.cslId.indexOf("-")>=0&&(n.cslId2PhysicalID||(n.cslId2PhysicalID={}),n.cslId2PhysicalID[i.cslId]||(n.cslId2PhysicalID[i.cslId]=i.id),n.physicalid2cslId||(n.physicalid2cslId={}),n.physicalid2cslId[i.id]||(n.physicalid2cslId[i.id]=i.cslId)),e.clone(i)},_getR2VFOIFromCache:function(t){if(t&&t.indexOf("-")>=0){if(n.r2v_FOI&&n.r2v_FOI[t])return n.r2v_FOI[t];e.each(n.r2v_FOI,function(e,i){if(i.cslId===t&&i.resourceid&&i.resourceid===e)return n.r2v_FOI[e]})}else if(n.r2v_FOI&&n.r2v_FOI[t])return n.r2v_FOI[t];return null},_cacheR2VState:function(t){n.r2v_State||(n.r2v_State={});var i=e.clone(t);return!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),!i.description&&i.grid["ds6w:description"]&&(i.description=i.grid["ds6w:description"]),n.r2v_State[i.id]=e.clone(i),e.clone(i)},_getR2VStateFromCache:function(t){if(t&&t.indexOf("-")>=0){if(n.r2v_State&&n.r2v_State[t])return n.r2v_State[t];e.each(n.r2v_State,function(e,i){if(i.cslId===t&&i.resourceid&&i.resourceid===e)return n.r2v_State[e]})}else if(n.r2v_State&&n.r2v_State[t])return n.r2v_State[t];return null},searchForPointCloudData:function(t){var n=this;return new i(function(i,r){t?a.getServiceUrl({serviceName:"3DSearch"}).then(function(o){if(o&&"string"==typeof o){var l="("+n.get3DSearchString()+")";(t.search_str||t.name)&&"*"!==(t.search_str||t.name)&&(l+=" AND ("+(t.search_str||t.name)+")"),!t.tenant&&window.widget.data&&(t.tenant=window.widget.data.x3dPlatformId);var c=window.widget.data.appId||window.widget.id;window.Foe&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&(c=window.Foe.Model.Session.get("user"));var u={query:l,label:c+"-DELWebPointCloudAssociationModel.searchForPointCloudData-"+(new Date).getTime(),locale:window.widget.lang,tenant:t.platformId||t.tenant,source:["3dspace","r2vsurvey"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:project","ds6w:dataSource","ds6w:community","ds6w:repository","dcterms:title","dcterms:description","ds6w:containerUid"],with_synthesis:!1,with_synthesis_attribute:!1};t.endindex&&(u.nresults="startindex"in t?t.endindex-t.startindex:t.endindex),u=window.UWA.Json.encode(u);var d=o+"/search";a.useFixtures()&&(d+="?getPointCloudSearch"),a.callAuthenticatedRequest(d,"json","POST",u).then(function(t){var a={},n=[];t&&t.results&&t.results.length&&(e.each(t.results,function(e,t){var i=s.convertToModelObj(t.attributes);!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),a[i.id]=i}),n=Object.values(a)),i(n)},r)}else r(new Error("invalid 3DSearch URL"))}):r(new Error("Invalid input parameters!"))})}});return a.useFixtures()&&(window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay),a.addFixture({type:"GET",url:r+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/getPointCloudAssociation.json",{onComplete:function(s){var a={Data:{}};t&&t.data&&t.data.target_QueryList?(e.each(JSON.parse(t.data.target_QueryList),function(e,t){n.point_cloud_assoc&&n.point_cloud_assoc[t.physicalid]?a.Data[t.physicalid]=n.point_cloud_assoc[t.physicalid]:s.Data[t.physicalid]?a.Data[t.physicalid]=s.Data[t.physicalid]:a.Data[t.physicalid]={}}),s.Data=a.Data):t&&t.data&&t.data.target_physicalid&&e.each(s.Data,function(e){e!==t.data.target_physicalid&&(s.Data[e]={})}),i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"POST",url:r+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(e){var t=a.request("../DELWebInfrastructureUI.tst/fixtures/createPointCloudAssociation.json",{onComplete:function(i){var s=JSON.stringify(i);s=(s=s.replaceAll("16902F5EC75943118C8EB49675AC6DED",e.data.target_physicalid)).replaceAll("objectIdToReplace",e.data["V_PointCloudIdentifier.objectId"]),"V_Name"in e.data&&(s=s.replaceAll("VPMPointCloudRepReference00000001",e.data.V_Name)),"V_description"in e.data&&(s=s.replaceAll("testDescription",e.data.V_description)),t.responseText=s,e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"PATCH",url:r+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(e){var t=a.request("../DELWebInfrastructureUI.tst/fixtures/updatePointCloudAssociation.json",{onComplete:function(i){var s=JSON.stringify(i);s=s.replaceAll("95E49656AB863C0063D1BE00001A0EF9",e.data.repReference_physicalid),"V_Name"in e.data&&(s=s.replaceAll("testName2",e.data.V_Name)),"V_description"in e.data&&(s=s.replaceAll("testDescription2",e.data.V_description)),"V_PointCloudIdentifier.objectId"in e.data&&(s=s.replaceAll("objectId2",e.data["V_PointCloudIdentifier.objectId"])),"V_PointCloudIdentifier.serviceId"in e.data&&(s=s.replaceAll("serviceId2",e.data["V_PointCloudIdentifier.serviceId"])),t.responseText=s,e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"DELETE",url:r+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},function(e){var t=a.request("../DELWebInfrastructureUI.tst/fixtures/deletePointCloudAssociation.json",{onComplete:function(i){var s=JSON.stringify(i);s=s.replaceAll("95E49656AB863C0063D1BE00001A0EF9",e.data.repReference_physicalid),t.responseText=s,e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"POST",url:r+"/enovia/resources/r2v/v1/modeler/featurestate/fetch"},function(e){var t=a.request("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureStates.json",{onComplete:function(i){t.responseText=JSON.stringify(i),e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"POST",url:r+"/enovia/resources/r2v/v1/modeler/featureofinterest/fetch"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureOfInterest.json",{onComplete:function(s){var a=[],n=JSON.parse(t.data).ids;e.each(n,function(t,i){e.each(s.result,function(e,t){t.resourceid===i&&a.push(t)})}),s.result=a,i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"GET",url:r+"/enovia/resources/r2v/v1/modeler/featureofinterest/id/featurestates"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureStates.json",{onComplete:function(s){var a=[];e.each(s.result,function(e,i){i.featureOfInterestId===t.data.id&&a.push(i)}),s.result=a,i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"POST",url:r.substr(0,r.lastIndexOf("/"))+"/federated/search?getPointCloudSearch"},function(e){var t=a.request("../DELWebInfrastructureUI.tst/fixtures/getPointCloudSearchData.json",{onComplete:function(i){t.responseText=JSON.stringify(i),e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})}),a.addFixture({type:"GET",url:r+"/enovia/resources/r2v/v1/modeler/csl?getPhysicalIDForCslID"},function(t){var i=a.request("../DELWebInfrastructureUI.tst/fixtures/getPhysicalIDForCslID.json",{onComplete:function(s){var a=t.data.id;n&&n.r2v_FOI&&e.each(n.r2v_FOI,function(e,t){t.cslId!==a&&a!==t["ds6w:i3dx"]||s&&s.resourceid&&s.resourceid!=t.resourceid&&(s.resourceid=t.resourceid)}),i.responseText=JSON.stringify(s),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})})),o}),define("DS/DELWebInfrastructureControls/DELWebAddExtensionsWebServices",["UWA/Core","DS/WAFData/WAFData","DS/EditPropExtensions/WebServices/WebServices","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/EditPropExtensions/assets/nls/AddExtensionsNLS"],function(e,t,i,s,a){"use strict";i.constructor.prototype.addInterfaces&&!i.constructor.prototype._addInterfaces&&(i.constructor.prototype._addInterfaces=i.constructor.prototype.addInterfaces,i.constructor.prototype.addInterfaces=function(e,t,a,n,r,o,l){i._addInterfaces(e,t,a,n,r,function(){o(),s.publishEvent("DELWebAddExtensionsWebServices.addInterfaces",a)},function(e){l(e),s.publishEvent("DELWebAddExtensionsWebServices.addInterfaces.error",{data:a,message:e})})}),i.constructor.prototype.removeInterfaces&&!i.constructor.prototype._removeInterfaces&&(i.constructor.prototype._removeInterfaces=i.constructor.prototype.removeInterfaces,i.constructor.prototype.removeInterfaces=function(e,t,a,n,r,o,l){i._removeInterfaces(e,t,a,n,r,function(){o(),s.publishEvent("DELWebAddExtensionsWebServices.removeInterfaces",a)},function(e){l(e),s.publishEvent("DELWebAddExtensionsWebServices.removeInterfaces.error",{data:a,message:e})})});var n={};return Object.assign(n,i,{getClassInterfaces:function(s,a,n,r,o,l,c,u){e.log("getClassInterfaces");var d={classes:"VPMReference"};"bus"===o?d={classes:r}:"connection"===o&&(d={relationclass:r});var m={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang};s&&(m.SecurityContext=s.SecurityContext);!this.get3DSpaceWSUrl&&i.get3DSpaceWSUrl&&(this.get3DSpaceWSUrl=i.get3DSpaceWSUrl);var p=this.get3DSpaceWSUrl(this.tenant,n,"/resources/dictionary/interfaces","displayAttributes=true&noDeprecated=true&noAbstract=true");t.authenticatedRequest(p,{method:"POST",headers:m,timeout:864e5,data:JSON.stringify(d),type:"json",onComplete:function(t){if(e.log("getClassInterfaces:onComplete"),u&&u.interfaces&&u.interfaces.length&&t&&t.results&&t.results.length&&t.results[0].interfaces&&t.results[0].interfaces.length)for(var i=0;i<t.results.length;++i)if(t.results[i].interfaces){var s=t.results[i].interfaces;t.results[i].interfaces=[];for(var a=0;a<s.length;++a){var n=s[a];n&&n.name&&u.interfaces.indexOf(n.name)>=0&&t.results[i].interfaces.push(n)}}l(t)},onFailure:function(e){this.onFailureCallback(c,e)},onTimeout:function(){c("timeout")}})},getObjectInterfaces:function(s,a,n,r,o,l,c,u){e.log("getObjectInterfaces");var d={objects:r},m="/resources/dictionary/object/interfaces";"bus"===o?(d={objects:r},m="/resources/dictionary/object/interfaces"):"connection"===o&&(d={connections:r},m="/resources/dictionary/relation/interfaces");var p={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang};if(s)for(s.SecurityContext?p.SecurityContext=s.SecurityContext:"string"==typeof s&&(p.SecurityContext=s);p.SecurityContext&&e.String.contains(p.SecurityContext,"ctx::");)p.SecurityContext=p.SecurityContext.replace("ctx::","");!this.get3DSpaceWSUrl&&i.get3DSpaceWSUrl&&(this.get3DSpaceWSUrl=i.get3DSpaceWSUrl);var h=this.get3DSpaceWSUrl(this.tenant,n,m,"isRoleChecked=true");t.authenticatedRequest(h,{method:"POST",headers:p,timeout:864e5,data:JSON.stringify(d),type:"json",onComplete:function(t){if(e.log("getObjectInterfaces:onComplete"),u&&u.interfaces&&u.interfaces.length&&t&&t.results&&t.results.length&&t.results[0].interfaces&&t.results[0].interfaces.length)for(var i=0;i<t.results.length;++i)if(t.results[i].interfaces){var s=t.results[i].interfaces;t.results[i].interfaces=[];for(var a=0;a<s.length;++a){var n=s[a];n&&n.name&&u.interfaces.indexOf(n.name)>=0&&t.results[i].interfaces.push(n)}}l(t)},onFailure:function(e){this.onFailureCallback(c,e)},onTimeout:function(){e.log("timeout")}})},onFailureCallback:function(t,i){e.log("fail"),e.log(this);var s=t;i&&"object"==typeof i?(i.error&&i.error.Message?s=i.error.Message:i.message&&(s=i.message),e.log(i)):"object"==typeof t&&(t.message.startsWith("NetworkError:")?s=t.message.endsWith('return ResponseCode with value "0"')?a.noConnection:t.message.endsWith('return ResponseCode with value "401"')||t.message.endsWith('return ResponseCode with value "403"')?a.webServiceUnauthorized:a.webServiceError:"null"===t&&(s=a.webServiceError)),t(s,i)}}),n}),define("DS/DELWebInfrastructureControls/DELWebAddExtensionsWidget",["UWA/Controls/Abstract","DS/DELWebInfrastructureControls/UWAUtils","DS/CoreEvents/Events","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/EditPropExtensions/UI/AddExtensionsWidget","DS/DELWebInfrastructureControls/DELWebAddExtensionsWebServices","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/EditPropExtensions/assets/nls/AddExtensionsNLS","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],function(e,t,i,s,a,n,r,o,l,c,u){"use strict";var d=function(e,t){for(var i=[],s=0;s<e.length;s++)for(var a=e[s].name,n=0;n<t.length;n++)a!==t[n].name||i.push(e[s]);return i};return a.extend({init:function(e,t,i,s,a,n,r){return this._init(e,t,i,s,a,n,r)},_init:function(i,a,o,l,m,p,h){t.log("init");var f=this,g=new e(o);for(var v in g)g[v]&&(f[v]=g[v]);this.elements.SC=l;var _=[],b=m.getTenant();this.tenant=b,this.elements.myObject=m,window.Configuration&&(this.URL=window.Configuration.webroot);var y="";if(this.metatype=m.get("metatype"),o.addOnReference&&t.Object.isPlainObject(o.addOnReference)&&o.addOnReference.plmBaseObjectType&&o.addOnReference.physicalid)y="plmBaseObjectType",this.metatype="bus";else{if(o.addOnReference&&!t.Object.isPlainObject(o.addOnReference))return void r.getInstance({physicalid:m.get("objectId")}).then(function(e){if(e&&e.PLMData){var s=null;t.each(e.PLMData,function(e,t){t&&(t.ReferencePhysicalid||t.ReferenceOXID?s||(s={physicalid:t.ReferencePhysicalid,OXID:t.ReferenceOXID}):s=t)}),s?(o.addOnReference=s,f._init(i,a,o,l,m,p,h)):f._displayNotificationMessage(u.get("Error"))}else f._displayNotificationMessage(u.get("Error"))},function(e){f._displayNotificationMessage(e)});"bus"===m.get("metatype")?y="_DS_ATTR_type":"connection"===m.get("metatype")&&(y="_DS_ATTR_label")}this.setInterfaces=function(e){if(this.interfaces=[],null!==e){var t=e.results;if(1===t.length)this.interfaces=t[0].interfaces;else if(t.length){for(var i=t[0].interfaces,s=1;s<t.length;s++)i=d(i,t[s].interfaces);this.interfaces=i}if(this.allAttachedInterfaces)for(var a=0;a<this.interfaces.length;){for(var n=0;n<this.allAttachedInterfaces.length;n++)if(this.allAttachedInterfaces[n].name===this.interfaces[a].name){this.interfaces.splice(a,1),a--;break}a++}}return this.interfaces}.bind(this),this.setAttachedInterfaces=function(e){if(this.attachedInterfaces=[],null!==e){var t=e.results;if(1===t.length)this.attachedInterfaces=t[0].interfaces;else{for(var i=t[0].interfaces,s=1;s<t.length;s++)i=d(i,t[s].interfaces);this.attachedInterfaces=i}}return this.attachedInterfaces}.bind(this),this.setAllAttachedInterfaces=function(e){if(this.allAttachedInterfaces=[],null!==e){var t=e.results;if(1===t.length)this.allAttachedInterfaces=t[0].interfaces;else for(var i=0;i<t.length;i++)for(var s=t[i].interfaces,a=0;a<s.length;a++)this.allAttachedInterfaces.push(s[a])}return this.allAttachedInterfaces}.bind(this),this.buildUI=function(){this._buildUI()}.bind(this),this._initEventHandlers();var D=null;if(o.addOnReference&&t.Object.isPlainObject(o.addOnReference)&&o.addOnReference.physicalid)D=o.addOnReference.physicalid,_[0]=o.addOnReference.plmBaseObjectType,this.setObject(D);else if(m._innerModels){var w=m._innerModels;for(var L in w)if(w[L]&&w[L].get){D=w[L].get("objectId");var P=w[L].get(y);P?_.push(P.valueDB):_[0]=m.get(y).valueDB,this.setObject(D)}}else{if(D=m.get("objectId"),y&&m.get(y)&&m.get(y).valueDB){var C=m.get(y).valueDB;C&&(_[0]="string"==typeof C?C:C[0])}this.setObject(D)}s.getServiceUrl({serviceName:"3DSpace",onComplete:function(e){e.forEach(function(e){void 0===e.url?t.log("url is undefined, skipping "+e.platformId):b===e.platformId&&(this.URL=e.url)}.bind(this)),n.getObjectInterfaces(l,this.tenant,this.URL,this.models,this.metatype,function(e){this.attachedInterfaces=this.setAttachedInterfaces(e),this.allAttachedInterfaces=this.setAllAttachedInterfaces(e),n.getClassInterfaces(l,this.tenant,this.URL,_,this.metatype,function(e){this.interfaces=this.setInterfaces(e),this.buildUI(),t.log("init:onComplete"),this.showDialog(i,p,h)}.bind(this),function(e){var t=c.get("failMessage")+e;h(t)},o.jsonClassInterfaces)}.bind(this),function(e,t){var i=c.get("failMessage")+e;t&&"object"==typeof t&&t.error&&"1002"===t.error.code?require({},["DS/UIKIT/SuperModal"],function(e){new e({closable:!0,className:"Modals",events:{onHide:function(){p()}}}).alert(c.get("roleNotAllowed"))}):h(i)},o.jsonClassInterfaces)}.bind(this),onFailure:function(e){t.log(e),h(c.get("urlNotFound"))}}),this.context=o.context},_buildUI:function(){var e=this._parent.apply(this,arguments);if(e.addClassName("DELWebAddExtensionsWidget"),this.options&&"multiSelect"in this.options&&this.autoComplete&&this.autoComplete.options&&(this.autoComplete.options.multiSelect=this.options.multiSelect,!this.options.multiSelect)){var i=this.autoComplete.name;this.autoComplete.elements.container.removeClassName(i+"-multiselect"),this.autoComplete.elements.input.addClassName(i+"-single-select"),!this.autoComplete.elements.clear&&this.autoComplete.elements.inputContainer&&(this.autoComplete.elements.clear=t.createElement("span",{class:i+"-reset fonticon fonticon-clear"}).inject(this.autoComplete.elements.inputContainer)),this.autoComplete.getSelection&&!this.autoComplete._getSelection&&(this.autoComplete._getSelection=this.autoComplete.getSelection,this.autoComplete.getSelection=function(){var e=this._getSelection();return!e&&this.selectedItems&&1===this.selectedItems.length&&(e=this.selectedItems.slice(0)),e}),this.attachedInterfaces&&this.attachedInterfaces.length>0&&(this.autoComplete.disable(),this.elements.tableExtensions&&this.elements.tableExtensions.closest&&this.elements.tableExtensions.closest(".accordion-item")&&this.elements.tableExtensions.closest(".accordion-item").addClassName("active"))}return e},showDialog:function(){if(this._parent.apply(this,arguments),this.options&&this.mySuperModal&&this.mySuperModal.modals&&this.mySuperModal.modals.current&&this.options.dialogTitle){var e=this.mySuperModal.modals.current.elements.header?this.mySuperModal.modals.current.elements.header.getElement("h4"):null;e&&e.setText(this.options.dialogTitle)}},_initEventHandlers:function(){var e=this;this._eventSubscriptionTokens||(this._eventSubscriptionTokens=[]),t.each(this,function(s,a){if(a&&t.Function.isFunction(a)&&s.endsWith(" subscribe")){var n=s.replace(" subscribe","").trim(),r=null;(r=e.options&&e.options.modelEvents?e.options.modelEvents.subscribe({event:n},function(t){a.apply(e,[n,t])}):i.subscribe({event:n},function(t){a.apply(e,[n,t])}))&&e._eventSubscriptionTokens.push(r)}})},_displayNotificationMessage:function(e,i){l._getNotificationManager||(l._getNotificationManager=l.getNotificationManager,l.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),l.getNotificationManager()||l._manager||(l.setNotificationManager(o),l.setRemoveStackOnFirstTimeoutFlag(!0),l.setStackingPolicy(31)),i||(i={}),i.message||(i.message=e),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(e||"").toString()),"title"in i||(i.title=u.get(t.String.capitalize(i.level.toLowerCase()))),o.addNotif(i)},"DELWebAddExtensionsWebServices.addInterfaces subscribe":function(){this._displayNotificationMessage(u.replace("{0} Associated",{0:u.get("Extension")}),{level:"success"})},"DELWebAddExtensionsWebServices.addInterfaces.error subscribe":function(e,t){this._displayNotificationMessage(c.get("failMessage")+t.message)},"DELWebAddExtensionsWebServices.removeInterfaces subscribe":function(){this._displayNotificationMessage(u.get("Unassociation Successful"),{level:"success"})},"DELWebAddExtensionsWebServices.removeInterfaces.error subscribe":function(e,t){this._displayNotificationMessage(c.get("failMessage")+t.message)}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebRealWorldLocationManagerDlg",["UWA/Core","DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebPointCloudAssociationModel","DS/DELWebInfrastructureControls/CommonControllers/confirmationDialog","DS/DELWebInfrastructureControls/DELWebSearchUtils","DS/DELWebInfrastructureControls/Mask","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/TreeModel/TreeNodeModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,s,a,n,r,o,l,c,u,d,m,p,h){"use strict";return n.inherit({name:"DELWebRealWorldLocationManagerDlg",publishedProperties:{title:{defaultValue:h.get("Associate Real World Location Data"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,330),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/5,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){if(e&&(this.options=Object.assign(this.options||{},e)),this._parent.apply(this,arguments),e.dsModel&&(e.dsModel.label||e.dsModel.V_Name)){var t=e.dsModel.label||e.dsModel.V_Name;this.title=h.replace("Associate Real World Location Data to {0}",{0:t})}e.closeCallback&&(this._closeCallback=e.closeCallback),e.droppedPointCloudIds&&(this.droppedPointCloudIds=e.droppedPointCloudIds,this.openedFromDrop=!0)},_populateRWLTable:function(t,i){var s=this;if(t&&!e.Object.isEmptyObject(t)){var a=s.elements._uwaTree;a&&s.elements._uwaTree.prepareUpdateView();var n=[],r=t,o={label:r.name||r.V_Name,dsModel:r,grid:{description:r.description||""},icons:[r.thumbnail],children:[]};(r.currentAssociation||s.options&&s.options.currentAssociation&&s.options.currentAssociation.id===r.id)&&o.icons.push("link"),n.push(o),s._addRootNodesToTable(n).then(function(n){var r=null;s.elements._uwaTree&&s.elements._uwaTree.prepareUpdateView(),e.each(n,function(a,n){if(n.dsModel.id===t.id){if(n&&n.dsModel&&n.dsModel.droppedObj&&(r=n),!n.options||!n.options.dsModel||!n.options.dsModel.id)return delete n.options.children,void n.setState({state:"noChildren"});var o=n.getChildren();if(e.each(i,function(t,i){if(i&&i.id&&i.name){var a=!1;if(e.each(o,function(e,n){if(a=a||n._options.dsModel.id===t,n._options.dsModel.id===t){Object.assign(n.options.dsModel,i);var o=n.getIcons()||[];s.options.currentAssociation&&s.options.currentAssociation.id===n.options.dsModel.id&&o.indexOf("link")<0&&(o.push("link"),n.setIcons(o)),i.droppedObj&&(r=n)}}),!a){var l={label:i.name,dsModel:i,icons:[i.thumbnail],grid:Object.assign({description:i.description},i)};(i.currentAssociation||s.options&&s.options.currentAssociation&&s.options.currentAssociation.id===i.id)&&l.icons.push("link");var c=n.addChild(l);i.droppedObj&&(r=c)}}else e.log("invalid objStateDateObj!")}),n.dsModel.droppedObj)n.setState({state:n.hasChildren()?"collapsed":"noChildren"});else if(r&&n.getChildren().length>1){var l=n.getChildren();e.each(l,function(e,t){t._options.dsModel.id!==r._options.dsModel.id&&t.hide()}),n.setState({state:n.hasChildren()?"partiallyExpanded":"noChildren"}),n.onPreExpand(function(){var t=n.getChildren();e.each(t,function(e,t){t.show()}),setTimeout(function(){s.resize()},25)})}else n.setState({state:n.hasChildren()?"expanded":"noChildren"})}}),s.elements._uwaTree&&(s.elements._uwaTree.reapplySortModel(),s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),a&&s.elements._uwaTree&&(s.elements._uwaTree.reapplySortModel(),s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),r&&(e.each(s.elements._uwaTree.getNodesXSO().get(),function(e,t){s.elements._uwaTree.getNodesXSO().remove(t)}),r.select(),r.dsModel&&r.dsModel.droppedObj&&delete r.dsModel.droppedObj),s.enableDisableSaveButton()},function(e){s._displayNotificationMessage(e)})}},_addTable:function(e){var t=this;return new Promise(function(i){if(t.elements._uwaTree)i(t.elements._uwaTree);else{e||(e={});var s={treeDocument:new c({}),cellSelection:"none",rowDragEnabledFlag:!1,enableListSelection:!0,maxVisibleRowCount:4,cellDragEnabledFlag:!1,canMultiSelect:!1,columns:[{text:h.get("Title"),dataIndex:"tree",modelAttribute:"name"},{text:h.get("Description"),dataIndex:"description"}]};e.container||(e.container=t.elements.mainDiv.getElementsByClassName("DELWebRealWorldLocationManagerDlg-RWLTable"),e.container&&1===e.container.length&&(e.container=e.container[0])),a.unmask(e.container),t.elements._uwaTree=new u(s).inject(e.container),t.elements._uwaTree.rowSelection="single",t.elements._uwaTree.columnSelection="none",t.elements._uwaTree.cellSelection="none",t.elements._uwaTree.getNodesXSO().onChange(function(){t.enableDisableSaveButton()}),t.elements._uwaTree.getContainingImmersiveFrame&&!t.elements._uwaTree._getContainingImmersiveFrame&&(t.elements._uwaTree._getContainingImmersiveFrame=t.elements._uwaTree.getContainingImmersiveFrame,t.elements._uwaTree.getContainingImmersiveFrame=function(){var e=t._getContainingImmersiveFrame();return e||(e=t.immersiveFrame||t.options.immersiveFrame),e}),i(t.elements._uwaTree)}})},_addRootNodesToTable:function(t){var i=this;return new Promise(function(s,a){if(!t||!Array.isArray(t)||t.length<=0)return a(new Error("invalid rootNodeOptionsArr")),!1;i._addTable().then(function(n){if(!n)return a(new Error("invalid table")),!1;var r=n.getTreeDocument(),o=r.getRoots(),l=[],c=[];i.elements._uwaTree.prepareUpdateView(),e.each(t,function(t,i){if(o){var s=!0;if(e.each(o,function(e,t){return t&&t.options&&t.options.dsModel&&i.dsModel&&((s=t.options.dsModel.id!==i.dsModel.id)||Object.assign(t.options.dsModel,i.dsModel),c.push(t)),s}),!s)return}var a=new d(i);a.dsModel=i.dsModel,r.addRoot(a),l.push(a)}),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),setTimeout(function(){i.resize()},250),c&&c.length&&e.each(c,function(e,t){l.push(t)}),s(l)},a)})},resize:function(t){var i=this.elements.mainDiv.querySelector(".DELWebRealWorldLocationManagerDlg-RWLTable"),s=!1;if(i){if(this.elements._uwaTree&&this.elements._uwaTree._getScroller()&&this.elements._uwaTree._getScroller().elements&&this.elements._uwaTree._getScroller().elements.container){i.setStyle||e.extendElement(i);var a=this.elements._uwaTree._getScroller().elements.container.scrollHeight;t?a>this.elements._uwaTree._getScroller().elements.container.clientHeight?(i.setStyle("height",a),this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&i.setStyle("height",a-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight))):a>100&&this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&i.setStyle("height",Math.max(100,a-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight))):i.setStyle("height",null)}var n=Math.max(i.clientHeight,120);this.elements._uwaTree&&this.elements._uwaTree.elements&&this.elements._uwaTree.elements.container&&(n=Math.max(n,this.elements._uwaTree.elements.container.clientHeight)),this.elements.mainDiv.clientHeight<i.offsetTop+n&&(this.height+=i.offsetTop-this.elements.mainDiv.clientHeight+n,s=!0)}else this.elements.mainDiv.clientHeight<this.elements.mainDiv.children[0].clientHeight+20&&(this.height+=this.elements.mainDiv.children[0].clientHeight-this.elements.mainDiv.clientHeight+20,s=!0);if(s){var r=this.getAbsolutePosition();this.elements.container.clientHeight<window.widget.body.clientHeight&&(r.y=(window.widget.body.clientHeight-this.elements.container.clientHeight)/2,this.setAbsolutePosition(r))}},destroy:function(){this._parent.apply(this,arguments),this._closeCallback&&this._closeCallback(),this._confDialog&&!this._confDialogDestroyed&&(this._confDialogDestroyed=!0,this._confDialog.destroy())},_postBuildView:function(){this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this.elements.container.addClassName("wux-ui-animation-flip-in"),this._parent();var t=this;if(!this.immersiveFrame){var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var s=0;!this.immersiveFrame&&s<i.length;++s)i[s]&&i[s].dsModel&&(this.immersiveFrame=i[s].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.buttons={Ok:new r({label:h.get("Delete Existing Association"),onClick:function(){t.onDelete()}}),Save:new r({disabled:!0,label:h.get("Associate"),onClick:function(){t.options.associatedRepReference?t.onEditSave():t.onAssociate()}}),Cancel:new r({onClick:function(){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary",this.buttons.Ok.elements.button.setStyles({position:"absolute",left:"20px"}),this.buttons.Ok.hide(),this.elements.mainDiv.innerHTML='<table class="'+this.name+'-table"><tr class="'+this.name+'-V_Name"><th>'+h.get("Name")+'</th><td></td></tr><tr class="'+this.name+'-V_description"><th>'+h.get("Description")+'</th><td></td></tr></table><div class="'+this.name+'-SearchDirections"><span class="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-drag-drop"></span><span class="'+this.name+'-SearchDirectionsText">'+h.get("Search and drop a Real World Location, Location State, or a Resource that is already associated to one of those")+'</spin></div><div class="'+this.name+'-RWLTable"></div>',this.elements._inputName=new o({placeholder:h.get("required"),value:h.get("Real World Location")+"-"+(new Date).getTime(),requiredFlag:!0,autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Name td")),this.elements._inputDescription=new l({autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_description td")),this.elements._inputName.addEventListener("change",function(){t.enableDisableSaveButton()}),this.addEventListener("close",function(){t.destroy()}),this.addEventListener("resize",function(e){t.resize(e)}),this.resize(),this._grabRealWorldLocationInformation(),this._initDropEventHandlers(),t.options.droppedPointCloudIds&&t.onDrop()},enableDisableSaveButton:function(){var e=null;this.elements&&this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&this.elements._uwaTree.getNodesXSO().get&&(e=this.elements._uwaTree.getNodesXSO().get()),this.elements&&this.elements._inputName&&this.elements._inputName.value&&e&&1===e.length?this.buttons.Save.disabled=!1:this.buttons.Save.disabled||(this.buttons.Save.disabled=!0)},_grabRealWorldLocationInformation:function(){var i=this;this.buttons.Save.elements.button.addClassName("loading");var s=i.elements.mainDiv.getElementsByClassName("DELWebRealWorldLocationManagerDlg-RWLTable");s&&1===s.length&&(s=s[0]),s&&a.mask(s,h.get("Loading"));var n=i.options.dsModel.ReferencePhysicalid||i.options.dsModel.physicalid,r={physicalid:n,OXID:i.options.dsModel.ReferenceOXID||i.options.dsModel.OXID};t.getPointCloudAssociationForResource(r).then(function(r){if((s=i.elements.mainDiv.getElementsByClassName("DELWebRealWorldLocationManagerDlg-RWLTable"))&&1===s.length&&(s=s[0]),r&&r[n]&&!e.Object.isEmptyObject(r[n])){var o=r[n].repReference;i.options||(i.options={}),i.options.associatedRepReference=o;var l=o.V_Name;i.elements._inputName.value=l;var c=o.V_description;i.elements._inputDescription.value=c;var u=i.options.dsModel.label||i.options.dsModel.V_Name;i.title=h.replace("Edit Association of Real World Location Data to {0}",{0:u}),i.buttons.Save.label=h.get("Save"),i.buttons.Ok.show();var d=o["V_PointCloudIdentifier.serviceId"],m=o["V_PointCloudIdentifier.objectId"],p={serviceId:d,ids:[m]};t.getStateOrFOIInfoForR2VObjects(p).then(function(n){var r=null,o=null,l=n[m];if(!l&&n&&e.each(n,function(e,t){m===(t.cslId||t["ds6w:i3dx"])&&(l=n[t.resourceid],m=t.resourceid)}),l.invalid_permission_r2vObject)"cslid"in l&&!l.cslid&&m?l.cslid=m:"ds6w:i3dx"in l&&!l["ds6w:i3dx"]&&m&&(l["ds6w:i3dx"]=m),i._displayNoPermissionsMessage(l);else if(e.String.contains(l.type,"State")){var c=l.featureOfInterestId;!c&&l&&l.resourceid&&(c=l.resourceid);var u={serviceId:d,ids:[c]};t.fetchFOIInfo(u).then(function(s){r=s[c];var a={serviceId:d,id:r.id};t.getLocationStatesForFOI(a).then(function(t){o=t,i.openedFromDrop||o[m]&&(o[m].droppedObj=!0),o[m]&&(o[m].currentAssociation=!0,i.options.currentAssociation=e.clone(o[m])),i._populateRWLTable(r,o)})})}else if(e.String.contains(l.type,"Interest")){r=l,i.openedFromDrop||(r.droppedObj=!0),r.currentAssociation=!0,i.options.currentAssociation=e.clone(r);var p={serviceId:d,id:l.id};t.getLocationStatesForFOI(p).then(function(e){o=e,i._populateRWLTable(r,o)})}else i._displayNotificationMessage(h.get("Unknown Real World Location type")),s&&a.unmask(s)})}else i.enableDisableSaveButton(),s&&a.unmask(s);i.buttons.Save.elements.button.removeClassName("loading")})},_displayNoPermissionsMessage:function(e){var t=this.elements.mainDiv.getElementsByClassName("DELWebRealWorldLocationManagerDlg-RWLTable");e&&e.invalid_permission_r2vObject&&e["ds6w:i3dx"]?this._associatedR2VCslId=e["ds6w:i3dx"]:e&&e.invalid_permission_r2vObject&&e.cslid&&(this._associatedR2VCslId=e.cslid),a.unmask(t[0]),this.elements.mainDiv.getElementsByClassName("DELWebRealWorldLocationManagerDlg-SearchDirections")[0].remove();var i=document.createTextNode(h.get("Real World Location data is associated to this Resource, however you do not have permissions to access it.")),s=document.createElement("p"),n=document.createElement("span");n.classList.add("icon-main","wux-ui-3ds-alert"),s.classList.add("DELWebRealWorldLocationManagerDlg-nor2vObject_warning"),s.appendChild(n),s.appendChild(i),t[0].appendChild(s)},onAssociate:function(){var e=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&!this.elements._uwaTree.getNodesXSO().isEmpty())if(1===this.elements._uwaTree.getNodesXSO().get().length){var i=this.elements._uwaTree.getNodesXSO().get()[0],s={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_physicalid:this.options?this.options.dsModel.ReferencePhysicalid||this.options.dsModel.physicalid:null,"V_PointCloudIdentifier.objectId":i.options.dsModel?i.options.dsModel["ds6w:i3dx"]||i.options.dsModel.cslId:null,"V_PointCloudIdentifier.serviceId":i.options.dsModel?"r2vsurvey":null};this.buttons.Save.elements.button.addClassName("loading"),this.buttons.Save.disabled=!0,t.createPointCloudAssociationForResource(s).then(function(){var t=h.replace("'{0}' successfully associated",{0:i._options.dsModel.name});e._displayNotificationMessage(t,{level:"success"}),e.destroy()},function(t){t||(t=h.get("Error associating Real World Location data")),e._displayNotificationMessage(t)})}else this._displayNotificationMessage(h.get("Invalid Point Cloud Data Selection"));else this._displayNotificationMessage(h.get("Missing Point Cloud Data Selection"));else this._displayNotificationMessage(h.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},onDelete:function(){(this.options.currentAssociation||this._associatedR2VCslId)&&(this.hideDialog(),this.showConfirmationDialog())},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},showConfirmationDialog:function(t){var s=this;!this._confDialog&&this.options._confDialog&&(this._confDialog=this.options._confDialog),t=Object.assign(t||{},this.options),this._confDialog||(t._createDlg||(t._createDlg=this),t.onConfirm=function(){s.onDeleteConfirm()},this._confDialog=new i(t));var a=h.get("Point Cloud Data");s._associatedR2VCslId?t.confirmationMesssage=h.get("Unassociate the associated {0}?",{0:h.get(a)}):(e.String.contains(s.options.currentAssociation.type,"Interest")?a=h.get("Real World Location"):e.String.contains(s.options.currentAssociation.type,"State")&&(a=h.get("Location State")),t.confirmationMesssage=s.options.currentAssociation.name?h.replace("Unassociate {0} '{1}'?",{0:h.get(a),1:s.options.currentAssociation.name}):h.replace("Unassociate {0}?",{0:h.get(a)})),this._confDialog.showDialog(t)},onDeleteConfirm:function(){var e=this,i={target_physicalid:this.options?this.options.dsModel.ReferencePhysicalid||this.options.dsModel.physicalid:null,repReference_physicalid:this.options&&e.options.associatedRepReference?e.options.associatedRepReference.physicalid:null};t.deletePointCloudAssociationForResource(i).then(function(){var t=h.get("Real World Location association successfully deleted");e._displayNotificationMessage(t,{level:"success"}),e.destroy()},function(t){t||(t=h.get("Error deleting Real World Location association")),e._displayNotificationMessage(t)})},onEditSave:function(){var e=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&!this.elements._uwaTree.getNodesXSO().isEmpty())if(1===this.elements._uwaTree.getNodesXSO().get().length){var i=this.elements._uwaTree.getNodesXSO().get()[0],s={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_physicalid:this.options?this.options.dsModel.ReferencePhysicalid||this.options.dsModel.physicalid:null,"V_PointCloudIdentifier.objectId":i.options.dsModel?i.options.dsModel["ds6w:i3dx"]||i.options.dsModel.cslId:null,"V_PointCloudIdentifier.serviceId":i.options.dsModel?"r2vsurvey":null,repReference_physicalid:this.options&&e.options.associatedRepReference?e.options.associatedRepReference.physicalid:null};this.buttons.Save.elements.button.addClassName("loading"),this.buttons.Save.disabled=!0,t.updatePointCloudAssociationForResource(s).then(function(){var t=h.replace("Association to '{0}' successfully updated",{0:i._options.dsModel.name});e._displayNotificationMessage(t,{level:"success"}),e.destroy()},function(t){t||(t=h.get("Error updating Real World Location association")),e._displayNotificationMessage(t)})}else this._displayNotificationMessage(h.get("Invalid Point Cloud Data Selection"));else this._displayNotificationMessage(h.get("Missing Point Cloud Data Selection"));else this._displayNotificationMessage(h.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},_initDropEventHandlers:function(){var e=this,t=e.elements._modalDiv||e.elements.container||e.elements.mainDiv||window.widget.body;window.widget.standalone&&window.jQuery&&window.jQuery.fn&&window.jQuery.fn.droppable?(e.options._dndResultsDraggingStart=window.OpenAjax.hub.subscribe("Search.ResultsDragging.start",function(){window.jQuery(t).addClass("ds_search_result_droppable").droppable({tolerance:"pointer",drop:function(t,i){e.onDrop(t,i)},greedy:!0,over:function(t,i){e.onDragOver(t,i)}})}),e.options._dndResultsDraggingStop=window.OpenAjax.hub.subscribe("Search.ResultsDragging.stop",function(){window.jQuery(t).hasClass("ui-droppable")&&window.jQuery(t).droppable("destroy"),window.jQuery(t).removeClass("ds_search_result_droppable")})):(t.addClassName("ds_search_result_droppable"),t.addEventListener("dragover",function(t){e.onDragOver(t)}),t.addEventListener("drop",function(t){e.onDrop(t)}))},onDragOver:function(e){e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault()},onDrop:function(i,a){var n=this;i&&i.stopPropagation&&i.stopPropagation(),i&&i.preventDefault&&i.preventDefault();var r=n.options.droppedPointCloudIds||[],o=function(i){e.each(i,function(i,s){var a=null,r=null;if(s&&s.type&&e.String.contains(s.type,"State")){var o=s.featureOfInterestId;!o&&s&&s.resourceid&&(o=s.resourceid);var l=s.id,c={serviceId:"r2vsurvey",ids:[o]};t.fetchFOIInfo(c).then(function(i){if(a=e.clone(i[o])){var s={serviceId:"r2vsurvey",id:a.id};t.getLocationStatesForFOI(s).then(function(t){(r=t)&&!e.Object.isEmptyObject(r)&&(r[l].droppedObj=!0),n._populateRWLTable(a,r)})}})}else if(s&&s.type&&e.String.contains(s.type,"Interest")){(a=e.clone(s)).droppedObj=!0;var u={serviceId:"r2vsurvey",id:s.id};t.getLocationStatesForFOI(u).then(function(e){r=e,n._populateRWLTable(a,r)})}else s&&s.type&&n._displayNotificationMessage("Unknown Real World Location type")})},l=function(e){var i={serviceId:"r2vsurvey",ids:e};delete n.options.droppedPointCloudIds,t.getStateOrFOIInfoForR2VObjects(i).then(o)};if(r.length>0){var c=[];e.each(r,function(e,t){c.push(t.id)}),l(c)}else if(a&&a.draggable&&a.draggable.closest){var u=[];a.draggable.closest(".search_results_container").find(".ui-selected[data-physicalid]").each(function(){r.push({id:window.$(this).attr("data-physicalid")}),u.push(window.$(this).attr("data-physicalid"))}),u.length>0&&l(u)}else s.getUnifiedSearchObjectsFromDrop({ev:i}).then(function(i){if(i&&!e.Object.isEmptyObject(i)){var s=[],a=[],r=[];if(e.each(i,function(t,i){if(i.type&&(e.String.contains(i.type,"Interest")||e.String.contains(i.type,"State")))s.push(i.id);else if("VPMReference"===i.plmBaseObjectType&&i.interfaces){var n=!1;e.each(i.interfaces,function(t,i){e.each(i,function(e,t){n=n||"Resource"===t})}),n?r.push({physicalid:i.physicalid}):a.push(i)}else a.push(i)}),a.length>0&&(1===a.length?n._displayNotificationMessage("1 dropped object is not valid"):n._displayNotificationMessage(a.length+" dropped objects are not valid")),s.length>0&&l(s),r){var o={QueryList:r,Minimum:"True"};t.getPointCloudAssociationForResource(o).then(function(t){var i=0,s=[];e.each(t,function(a,n){if(e.Object.isEmptyObject(n))i++;else{var r=t[a].repReference;s.push(r["V_PointCloudIdentifier.objectId"])}}),i&&n._displayNotificationMessage(i>1?h.replace("The {0} resources dropped do not have any real world location data associated.",{0:i}):h.get("The resource dropped does not have any real world location data associated.")),s&&s.length>0&&l(s)})}}})},_displayNotificationMessage:function(t,i){p._getNotificationManager||(p._getNotificationManager=p.getNotificationManager,p.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),p.getNotificationManager()||p._manager||(p.setNotificationManager(m),p.setRemoveStackOnFirstTimeoutFlag(!0),p.setStackingPolicy(31)),i||(i={}),i.message||(i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=h.get(e.String.capitalize(i.level.toLowerCase()))),m.addNotif(i)}})}),window.define&&define("DS/DELWebInfrastructureControls/action_bar/pointCloudAssociationCommand",["DS/Core/Core","DS/ApplicationFrame/CommandCheckHeader","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebRealWorldLocationManagerDlg","DS/Selection/CSOManager"],function(e,t,i,s,a,n,r,o){"use strict";var l=window.$,c=window.UWA;return t.extend({init:function(e){var t=this;this._parent(e,{}),this.onStateChange(function(){this.getState()&&t._isEnabled&&l('[data-command="'+t._id+'"]').is(":visible")&&l(".DELWebRealWorldLocationManagerDlg-dlg").size()<1&&t.launchPointCloudDialog()}),t.disable(),t.r2vSurveyServiceExists=!1,i.getServiceUrl({serviceName:"r2vsurvey"}).then(function(e){e&&(t.r2vSurveyServiceExists=!0)}),t.setXSO()},setXSO:function(e){e||this._xso||(e=o),e&&(this._xso=e,this.setXSOonChangeEvent())},setXSOonChangeEvent:function(){var e=this;e._xso&&(e._xsoTokenChangeSubscribe=e._xso.onChange(function(){1===e._xso.get().length&&e.r2vSurveyServiceExists?e.enable():e.disable()}))},launchPointCloudDialog:function(){var e=this;if(!e._createDlg){var t=this.dialogOptions?c.clone(this.dialogOptions):{};if(!t.dsModel){var i=e._xso.get()[0];t.dsModel=i._options.dsModel}t.closeCallback=function(){e.setState(!1,!1),e.enable(),delete e._createDlg},e._createDlg=new r(t)}delete this.dialogOptions}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg",["UWA/Core","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListAssocDlg","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,s,a,n,r,o,l,c){"use strict";return i.inherit({name:"DELWebResourceParameterListDlg",publishedProperties:{title:{defaultValue:c.get("Create New Resource Parameter List"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,330),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/5,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){this._parent.apply(this,arguments),e&&(this.options=Object.assign(this.options||{},e)),this.options.resourceParameterList&&(this.elements._inputName&&(this.elements._inputName.value=this.options.resourceParameterList.V_Name),this.elements._inputDescription&&(this.elements._inputDescription.value=this.options.resourceParameterList.V_description||""),this.title=c.get("Update Resource Parameter List"),this.buttons&&(this.buttons.Ok&&this.buttons.Ok.hide(),this.buttons.Save&&(this.buttons.Save.label=c.get("Save"))))},destroy:function(){var e=this._assocDlg||this.options&&this.options._assocDlg;delete this._assocDlg,this.options&&delete this.options._assocDlg,this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this._parent();var t=this;if(!this.immersiveFrame){var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var r=0;!this.immersiveFrame&&r<i.length;++r)i[r]&&i[r].dsModel&&(this.immersiveFrame=i[r].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._assocDlg||this.options._assocDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in"),this.buttons={Ok:new s({label:c.get("Associate Existing"),onClick:function(){t.options.resourceParameterList||t.onAssociate()}}),Save:new s({label:c.get("Create"),onClick:function(){t.options.resourceParameterList&&t.options.resourceParameterList.physicalid?t.onSave():t.onCreate()}}),Cancel:new s({onClick:function(){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary",this.buttons.Ok.elements.button.setStyles({position:"absolute",left:"20px"}),this.elements.mainDiv.innerHTML='<table class="'+this.name+'-table"><tr class="'+this.name+'-V_Name"><th>'+c.get("Name")+'</th><td></td></tr><tr class="'+this.name+'-V_description"><th>'+c.get("Description")+"</th><td></td></tr></table>",this.elements._inputName=new a({placeholder:c.get("required"),value:c.get("Resource Parameter List")+"-"+(new Date).getTime(),requiredFlag:!0,autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Name td")),this.elements._inputDescription=new n({autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_description td")),this.options.resourceParameterList?(this.elements._inputName.value=this.options.resourceParameterList.V_Name,this.elements._inputDescription.value=this.options.resourceParameterList.V_description||""):this.elements._inputName.elements.inputField.select(),this.elements._inputName.addEventListener("change",function(){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0)}),this.addEventListener("close",function(){t.destroy()})},onCreate:function(){var e=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim()){var i={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_resource:this.options?this.options.resource:null};e.enableDisableButtons(!1),t.createResourceParameterList(i).then(function(t){var i=c.get("Resource Parameter List");t&&1===t.length&&t[0].V_Name&&(i=t[0].V_Name),e._displayNotificationMessage(c.replace("{0} Created",{0:i}),{level:"success"}),e.destroy()},function(t){e.enableDisableButtons(!0),t||(t=c.get("Error")),e._displayNotificationMessage(t)})}else this._displayNotificationMessage(c.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},onSave:function(){var i=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.options.resourceParameterList&&this.options.resourceParameterList.physicalid){var s={physicalid:this.options.resourceParameterList.physicalid},a=!1;e.each({V_Name:this.elements._inputName,V_description:this.elements._inputDescription},function(e,t){t&&e in i.options.resourceParameterList&&t.value!==i.options.resourceParameterList[e]&&(a=e,s[e]=(t.value||"").trim())}),a?(i.enableDisableButtons(!1),t.updateResourceParameterList(s).then(function(){i._displayNotificationMessage(c.replace("{0} Updated",{0:c.get("Resource Parameter List")}),{level:"success"}),i.destroy()},function(e){i.enableDisableButtons(!0),e||(e=c.get("Error")),i._displayNotificationMessage(e)})):this._displayNotificationMessage(c.get("No changes have been made."),{level:"info"})}else this._displayNotificationMessage("Missing Resource Parameter List");else this._displayNotificationMessage(c.get("Missing Name"));else this._displayNotificationMessage("incomplete dialog!")},onAssociate:function(){this.hideDialog(),this.showAssocDialog()},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},showAssocDialog:function(e){!this._assocDlg&&this.options._assocDlg&&(this._assocDlg=this.options._assocDlg),this._assocDlg||((e=Object.assign(e||{},this.options))._createDlg||(e._createDlg=this),this._assocDlg=new l(e)),this._assocDlg.showDialog(e)},_displayNotificationMessage:function(t,i){o._getNotificationManager||(o._getNotificationManager=o.getNotificationManager,o.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),o.getNotificationManager()||o._manager||(o.setNotificationManager(r),o.setRemoveStackOnFirstTimeoutFlag(!0),o.setStackingPolicy(31)),i||(i={}),i.message||("string"==typeof t?i.message=t:t.message&&(i.message=t.message)),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(i.message||"").toString()),"title"in i||(i.title=c.get(e.String.capitalize(i.level.toLowerCase()))),r.addNotif(i),t.stack&&(window.console&&window.console.warn?window.console.warn(t.stack):e.log(t.stack))}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListAssocDlg",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg","DS/DELWebInfrastructureControls/DELWebSearchUtils","DS/Windows/Dialog","DS/Controls/Button","DS/DELWebInfrastructureControls/Mask","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/CollectionView/CollectionViewStatusBar","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,s,a,n,r,o,l,c,u,d,m,p,h,f,g,v,_){"use strict";return n.inherit({name:"DELWebResourceParameterListAssocDlg",publishedProperties:{title:{defaultValue:_.replace("Associate Existing {0}",{0:_.get("Resource Parameter List")}),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,330),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/5,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e?this.options=Object.assign(this.options||{},e):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){var e=this._createDlg||this.options&&this.options._createDlg;delete this._createDlg,this.options&&(delete this.options._createDlg,this.options._dndResultsDraggingStart&&window.OpenAjax.hub.unsubscribe(this.options._dndResultsDraggingStart),this.options._dndResultsDraggingStop&&window.OpenAjax.hub.unsubscribe(this.options._dndResultsDraggingStop)),this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._createDlg||this.options._createDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in"),this._parent();var t=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var s=0;!this.immersiveFrame&&s<i.length;++s)i[s]&&i[s].dsModel&&(this.immersiveFrame=i[s].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.buttons={Ok:new r({label:_.get("Create New"),onClick:function(){t.onCreateNew()}}),Save:new r({disabled:!0,onClick:function(){t.onSave()}}),Cancel:new r({onClick:function(){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary",this.buttons.Ok.elements.button.setStyles({position:"absolute",left:"20px"}),this.elements.mainDiv.innerHTML='<div class="assoc_type"><table><tr><th>'+_.replace("Filter on {0}",{0:_.get("Resource Type")})+'</th><td><div class="assoc_type_val loading"></div></td><td><div class="assoc_type_loading_icon"></div></td></tr></table></div><div class="assoc_header"><span class="assoc_title">'+_.get("Resource Parameter Lists in Factory")+'</span><span class="assoc_help wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-help"></span><span class="assoc_refresh wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-refresh"></span><span class="assoc_search"><span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-drag-drop"></span> '+_.get("Drag from 3DSearch to add Resource Parameter Lists")+'</span></div><div class="assoc_table loading"></div>',this._addResourceDropDown(),this._addExistingResourceParamListTable(),this._initEventHandlers()},_addResourceDropDown:function(){var s=this;t.getServiceUrl({serviceName:"3DSpace"}).then(function(a){t.getResourceDisciplines({blnCachedOk:!0,addAdditionalDisciplines:!0}).then(function(n){t.getResourceDisciplines({blnCachedOk:!0,V_discipline:"Organizational",addAdditionalDisciplines:!0}).then(function(t){var r=n.Resource;t.Organizational&&e.each(t.Organizational,function(e,t){t&&t.isOOTB&&"WorkCenter"!==t.disciplineName&&r.push(t)}),n.AdditionalDisciplines&&e.each(n.AdditionalDisciplines,function(e,t){r.push(t)});var o=[{labelItem:_.get("All"),valueItem:""}];e.each(r,function(t,i){if("Pool"!==i.name&&!i.isOOTB||i.Newable&&(e.String.contains(i.Newable.toUpperCase(),"NEW")||e.String.contains(i.Newable.toUpperCase(),"ALL"))){var s=null;window.Foe&&window.Foe.Model&&window.Foe.Model.Asset&&(s=window.Foe.Model.Asset._getInterfaceIconPath(i)),s||(s=a+"/webapps/"+i.IconPath),o.push({labelItem:i.nlsName,valueItem:i.disciplineName||i.name,iconItem:s})}}),o=o.sort(function(e,t){return e&&t?"__OTHER__"!==e.valueItem&&t.valueItem?"__OTHER__"!==t.valueItem&&e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}),s.elements._disciplineDropdown=new u({elementsList:o,enableSearchFlag:!1,actionOnClickFlag:!1});var l=s.elements.mainDiv.getElementsByClassName("assoc_type_val");if(l&&1===l.length&&(l=l[0]),s.elements._disciplineDropdown.inject(l),s.elements._disciplineDropdown.getContent().addEventListener("change",function(e){s.onDisciplineDropdownChange(e)}),s.options.resource){var c=Object.assign({Minimum:["V_discipline"]},s.options.resource);i.getOneResource(c).then(function(e){e&&e.V_discipline&&("ResourceArea"===e.V_discipline?s.elements._disciplineDropdown.value="Area":"ErgoHuman"===e.V_discipline?s.elements._disciplineDropdown.value="Worker":s.elements._disciplineDropdown.value=e.V_discipline)})}e.extendElement(l).removeClassName("loading")})},function(e){s._displayNotificationMessage(e)})},function(e){s._displayNotificationMessage(e)})},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},showCreateDialog:function(e){!this._createDlg&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg||((e=Object.assign(e||{},this.options))._assocDlg||(e._assocDlg=this),this._createDlg=new s(e)),this._createDlg.showDialog(e)},onCreateNew:function(){this.hideDialog(),this.showCreateDialog()},onSave:function(){var t=this;if(this.options&&this.options.resource&&this.options.resource.physicalid)if(this.elements._uwaTree&&!this.elements._uwaTree.getNodesXSO().isEmpty()){var s=[];e.each(this.elements._uwaTree.getNodesXSO().get(),function(e,t){t&&t.dsModel&&t.dsModel.physicalid&&s.push({physicalid:t.dsModel.physicalid})}),i.associateResourceParameterList({resource:this.options.resource,resourceParameterList:{QueryList:s}}).then(function(e){var i=_.get("Resource Parameter List");e&&1===e.length&&e[0].resourceParameterList&&e[0].resourceParameterList.V_Name?i=e[0].resourceParameterList.V_Name:e&&e.length>1&&(i=_.get("Resource Parameter Lists")),t._displayNotificationMessage(_.replace("{0} Associated",{0:i}),{level:"success"}),t.destroy()},function(e){t._displayNotificationMessage(e)})}else this._displayNotificationMessage(_.replace("No {0}",{0:_.get("Resource Parameter Lists")}));else this._displayNotificationMessage(_.replace("No {0}",{0:_.get("Resource")}))},onSelectChanged:function(){this.buttons.Save.disabled=!this.elements._uwaTree||this.elements._uwaTree.getNodesXSO().isEmpty(),this.buttons.Save.disabled||!this.elements._uwaTree||this.elements._uwaTree.elements.statusBar||this.elements._uwaTree.buildStatusBar([{position:"far",type:f.STATUS.NB_SELECTED_ROWS}])},onDisciplineDropdownChange:function(t){var s=this;this._paramDisciplineListLoaded||(this._paramDisciplineListLoaded={});var a=e.extendElement(this.elements.mainDiv.querySelector(".assoc_type_loading_icon")),n=null,r=s.elements._disciplineDropdown?s.elements._disciplineDropdown.value:"";if(!s._paramDisciplineListLoaded||!s._paramDisciplineListLoaded[r]){a.addClassName("loading");var o=s.options.resource.physicalid;if(s.options.root_resource&&s.options.root_resource.physicalid&&(o=s.options.root_resource.physicalid),r)n=i.getResourceParameterLists({addAdditionalDisciplines:!0,blnIncludeDescendants:!0,physicalid:o,V_discipline:r}).then(function(e){s.addRootNodesFromData(e),s._paramDisciplineListLoaded[r]=e,s.onDisciplineDropdownChange(t)});else{var l=[];a.addClassName("loading");var c=i.getResourceParameterLists({allCached:!0,addAdditionalDisciplines:!0}).then(function(e){s.addRootNodesFromData(e)});l.push(c),n=i.getResourceParameterLists({addAdditionalDisciplines:!0,blnIncludeDescendants:!0,physicalid:o}).then(function(e){s.addRootNodesFromData(e),s._paramDisciplineListLoaded[r]=e}),l.push(n),e.Promise.all(l).then(function(){s.onDisciplineDropdownChange(t)})}}if(s.elements._uwaTree){s.elements._uwaTree.getNodesXSO().empty();var u=s.elements._uwaTree.getTreeDocument();if(u){var d=u.getRoots(),m=Object.values(s._paramDisciplineListLoaded[r]||{});if(d&&d.length)for(var p=d.length-1;p>=0;--p){var h=d[p],f=(!r||m.length>0)&&h&&h.options&&h.options.dsModel;if(f&&r&&m.length>0){var g=h.options.dsModel.resourceParameterList||h.options.dsModel;f=!1;for(var v=0;!f&&v<m.length;++v){var _=m[v];_&&_.resourceParameterList&&(f=_.resourceParameterList.physicalid===g.physicalid)}}f?h.show():h.hide()}}}s._paramDisciplineListLoaded&&s._paramDisciplineListLoaded[r]&&a.removeClassName("loading")},_addExistingResourceParamListTable:function(){var t=this,s=null;if(t.options.root_resource&&t.options.root_resource.physicalid&&(!t.options.root_resource.assocResourceParamLists||t.options.resource&&t.options.resource.physicalid&&!t.options.resource.assocResourceParamLists)){var a={QueryList:[{physicalid:t.options.root_resource.physicalid}]};return t.options.resource&&t.options.resource.physicalid!==t.options.root_resource.physicalid&&a.QueryList.push({physicalid:t.options.resource.physicalid}),o&&t.elements&&t.elements.mainDiv&&((s=t.elements.mainDiv.getElementsByClassName("assoc_table"))||(s=t.elements.mainDiv),o.mask(s[0])),void i.getResourceParameterLists(a).then(function(i){t.options.root_resource.assocResourceParamLists={},t.options.resource&&(t.options.resource.physicalid===t.options.root_resource.physicalid?t.options.resource.assocResourceParamLists=t.options.root_resource.assocResourceParamLists:t.options.resource.assocResourceParamLists={}),e.each(i,function(i,s){s.resource?s&&s.resource&&s.resourceParameterList&&(s.resource.physicalid===t.options.root_resource.physicalid?t.options.root_resource.assocResourceParamLists[s.resourceParameterList.physicalid]=s.resourceParameterList:s.resource&&s.resource.physicalid===t.options.resource.physicalid&&(t.options.resource.assocResourceParamLists[s.resourceParameterList.physicalid]=s.resourceParameterList)):e.each(s,function(e,i){i&&i.resource&&i.resourceParameterList&&(i.resource.physicalid===t.options.root_resource.physicalid?t.options.root_resource.assocResourceParamLists[i.resourceParameterList.physicalid]=i.resourceParameterList:i.resource&&i.resource.physicalid===t.options.resource.physicalid&&(t.options.resource.assocResourceParamLists[i.resourceParameterList.physicalid]=i.resourceParameterList))})}),t._addExistingResourceParamListTable()})}var n=[];if(t.options.resource||t.options.root_resource){var r=Object.assign({Minimum:["V_discipline"]},t.options.resource||t.options.root_resource),l=i.getOneResource(r).then(function(e){var s=i.getResourceParameterLists({addAdditionalDisciplines:!0,blnIncludeDescendants:!0,physicalid:e.physicalid,V_discipline:e.V_discipline}).then(function(e){t.addRootNodesFromData(e)});n.push(s)});n.push(l)}e.Promise.all(n).then(function(){var i=t.elements.mainDiv.getElementsByClassName("assoc_table");i&&1===i.length&&(i=e.extendElement(i[0])),t.elements._uwaTree||i.setText(_.replace("No {0}",{0:_.get("Resource Parameter Lists")})),i.removeClassName("loading"),o&&t&&t.elements&&t.elements.mainDiv&&(!(s=t.elements.mainDiv.getElementsByClassName("assoc_table"))&&o.isMasked(t.elements.mainDiv)&&(s=t.elements.mainDiv),s&&s.length&&o.unmask(t.elements.mainDiv))})},addTable:function(e){var t=this;return new Promise(function(i){if(t.elements._uwaTree)i(t.elements._uwaTree);else{e||(e={});var s={cellSelection:"none",enableListSelection:!0,canMultiSelect:!0,cellDragEnabledFlag:!1,enableDragAndDrop:!1,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1},shouldBeEditable:function(){return!1},isEditable:!1,roots:[],columns:[{text:_.get("Name"),dataIndex:"tree"},{text:_.get("Description"),dataIndex:"V_description"},{text:_.get("Revision"),dataIndex:"revision",width:"61px"}]};s.treeDocument||(s.treeDocument=new p),e.container||(e.container=t.elements.mainDiv.getElementsByClassName("assoc_table"),e.container&&1===e.container.length&&(e.container=e.container[0])),t.elements._uwaTree=new m(s).inject(e.container),t.elements._uwaTree.getNodesXSO().onChange(function(){t.onSelectChanged()}),t.elements._uwaTree.getContainingImmersiveFrame&&!t.elements._uwaTree._getContainingImmersiveFrame&&(t.elements._uwaTree._getContainingImmersiveFrame=t.elements._uwaTree.getContainingImmersiveFrame,t.elements._uwaTree.getContainingImmersiveFrame=function(){var e=t._getContainingImmersiveFrame();return e||(e=t.immersiveFrame||t.options.immersiveFrame),e}),i(t.elements._uwaTree)}})},addRootNodesFromData:function(t){if(t&&!e.Object.isEmptyObject(t)){var i=[];e.each(t,function(e,t){var s=null;s=t.resourceParameterList?{label:t.resourceParameterList.V_Name||t.resourceParameterList.name,dsModel:t.resourceParameterList,grid:{V_description:t.resourceParameterList.V_description||"",revision:t.resourceParameterList.revision||""}}:{label:t.V_Name||t.name,dsModel:t,grid:{V_description:t.V_description||"",revision:t.revision||""}},i.push(s)}),this.addRootNodesToTable(i)}},addRootNodesToTable:function(t){var i=this;return new Promise(function(s,a){if(t&&i.options&&i.options.root_resource&&i.options.root_resource.assocResourceParamLists&&(!i.options.resource||i.options.resource.assocResourceParamLists))for(var n=t.length-1;n>=0;--n){var r=t[n];!r.dsModel.physicalid&&r.dsModel.resourceParameterList&&(r.dsModel.resource&&(r.dsModelResource||(r.dsModelResource={}),r.dsModelResource[r.dsModel.resource.physicalid]=r.dsModel.resource),r.dsModel=r.dsModel.resourceParameterList),r.dsModel.physicalid&&(i.options.resource&&i.options.resource.assocResourceParamLists?i.options.resource.assocResourceParamLists[r.dsModel.physicalid]&&t.splice(n,1):i.options.root_resource.assocResourceParamLists[r.dsModel.physicalid]&&t.splice(n,1))}!t||!Array.isArray(t)||t.length<=0?s([]):i.addTable().then(function(i){var a=i.getTreeDocument(),n=[];i.prepareUpdateView(),e.each(t,function(t,i){var s=a.getRoots();if(s&&s.length){var r=!0;if(e.each(s,function(e,t){return!i.dsModel.physicalid&&i.dsModel.resourceParameterList&&(i.dsModel.resource&&(i.dsModelResource||(i.dsModelResource={}),i.dsModelResource[i.dsModel.resource.physicalid]=i.dsModel.resource),i.dsModel=i.dsModel.resourceParameterList),t&&t.dsModel&&i.dsModel&&((r=t.dsModel.physicalid!==i.dsModel.physicalid)||(i.dsModelResource&&(t.options.dsModelResource?t.options.dsModelResource=Object.assign(t.options.dsModelResource,i.dsModelResource):t.options.dsModelResource=i.dsModelResource),t.show())),r}),!r)return}var o=new h(i);o.dsModel=i.dsModel,a.addRoot(o),n.push(o)}),i.reapplySortModel(),i.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),s(n)},a)})},_initEventHandlers:function(){var e=this,t=e.elements._modalDiv||e.elements.container||e.elements.mainDiv||window.widget.body;window.widget.standalone&&window.jQuery&&window.jQuery.fn&&window.jQuery.fn.droppable?(e.options._dndResultsDraggingStart=window.OpenAjax.hub.subscribe("Search.ResultsDragging.start",function(){window.jQuery(t).addClass("ds_search_result_droppable").droppable({tolerance:"pointer",drop:function(t,i){e.onDrop(t,i)},greedy:!0,over:function(t,i){e.onDragOver(t,i)}})}),e.options._dndResultsDraggingStop=window.OpenAjax.hub.subscribe("Search.ResultsDragging.stop",function(){window.jQuery(t).hasClass("ui-droppable")&&window.jQuery(t).droppable("destroy"),window.jQuery(t).removeClass("ds_search_result_droppable")})):(t.addClassName("ds_search_result_droppable"),t.addEventListener("dragover",function(t){e.onDragOver(t)}),t.addEventListener("drop",function(t){e.onDrop(t)})),this.elements.mainDiv.querySelector(".assoc_header .wux-ui-3ds-help").addEventListener("click",function(t){e.onSectionHelpClicked(t)}),this.addEventListener("close",function(){e.destroy()})},onDragOver:function(e){e&&e.preventDefault&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault())},onDrop:function(t,s){var n=this;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var r=[],o=[],l=function(t){var i={};e.each(t,function(t,s){s&&(s.physicalid?i[s.physicalid]=s:s.resourceParameterList&&s.resourceParameterList.physicalid?i[s.resourceParameterList.physicalid]=s.resourceParameterList:e.Object.isPlainObject(s)&&e.each(s,function(e,t){t.physicalid?i[t.physicalid]=t:t.resourceParameterList&&t.resourceParameterList.physicalid&&(i[t.resourceParameterList.physicalid]=t.resourceParameterList)}))}),n.addRootNodesFromData(i)};s&&s.draggable&&s.draggable.closest?(s.draggable.closest(".search_results_container").find('.ui-selected[data-physicalid]:not([data-what="DELResourceParameterListReference"])').each(function(){r.push({PLM_ExternalID:window.$(this).attr("data-plm_externalid"),physicalid:window.$(this).attr("data-physicalid")})}),s.draggable.closest(".search_results_container").find('.ui-selected[data-physicalid][data-what="DELResourceParameterListReference"]').each(function(){o.push({PLM_ExternalID:window.$(this).attr("data-plm_externalid"),physicalid:window.$(this).attr("data-physicalid"),Minimum:["physicalid","V_Name","V_description","revision"]})}),r.length>0&&i.getResourceParameterLists({QueryList:r,blnIncludeDescendants:!0}).then(l,function(e){n._displayNotificationMessage(e)}),o.length>0&&e.each(o,function(e,t){i.getOneResourceParameterList(t).then(function(e){l([e])},function(e){n._displayNotificationMessage(e)})})):a.getUnifiedSearchObjectsFromDrop({ev:t}).then(function(t){t&&!e.Object.isEmptyObject(t)&&(e.each(t,function(e,t){t.objectType=t.plmBaseObjectType||t.type,"DELResourceParameterListReference"===t.objectType?o.push(t):t.isResource?r.push(t):t.V_discipline&&"VPMReference"===t.objectType&&r.push(t)}),r.length>0&&i.getResourceParameterLists({QueryList:r,blnIncludeDescendants:!0}).then(l,function(e){n._displayNotificationMessage(e)}),o.length>0&&e.each(o,function(e,t){!t.physicalid&&t.id&&(t.physicalid=t.id),t.Minimum||(t.Minimum=["physicalid","V_Name","V_description","revision"]),i.getOneResourceParameterList(t).then(function(e){Array.isArray(e)||(e=[e]),l(e)},function(e){n._displayNotificationMessage(e)})}))},function(e){n._displayNotificationMessage(e)})},onSectionHelpClicked:function(e){e&&e.stopPropagation&&e.stopPropagation();var t=new d({target:e.target,trigger:"click"}),i=_.get("Loaded Resource Parameter Lists that are associated to Resources of the specified type are shown here.");t.setBody(i),t.show()},_displayNotificationMessage:function(t,i){v._getNotificationManager||(v._getNotificationManager=v.getNotificationManager,v.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),v.getNotificationManager()||v._manager||(v.setNotificationManager(g),v.setRemoveStackOnFirstTimeoutFlag(!0),v.setStackingPolicy(31)),i||(i={}),i.message||(t||(t=_.get("Error")),i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=_.get(e.String.capitalize(i.level.toLowerCase()))),g.addNotif(i)}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterPrefDialog","DS/DELWebInfrastructureControls/Mask","DS/Windows/Dialog","DS/Controls/Accordeon","DS/Controls/Button","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Label","DS/Controls/TimePicker","DS/Controls/SelectionChipsEditor","DS/WUXAutoComplete/AutoComplete","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Controls/Abstract","DS/TreeModel/TreeNodeModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,s,a,n,r,o,l,c,u,d,m,p,h,f,g,v,_,b,y,D,w,L,P,C){"use strict";return s.inherit({name:"DELWebResourceParameterDlg",_uwaTree:null,_prefDialog_Done:!1,_arrList:[],publishedProperties:{title:{defaultValue:C.get("Create Parameter"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,700),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/3,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:700,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e&&(this.options=Object.assign(this.options||{},e)),this.options.blnForceRefreshPreferences=!0,this._parent.apply(this,arguments),this.options.resourceParameter?(this.elements._inputName&&(this.elements._inputName.value=this.options.resourceParameter.V_Name),this.elements._inputDescription&&(this.elements._inputDescription.value=this.options.resourceParameter.V_description||""),this.title=C.get("Update Resource Parameter"),this.buttons&&(this.buttons.Ok&&this.buttons.Ok.hide(),this.buttons.Save&&(this.buttons.Save.label=C.get("Save")))):this.title=C.replace("{0} in {1}",{0:this.title,1:this.options.parentModel.V_Name})},destroy:function(){var e=this._prefDialog||this.options&&this.options._prefDialog;delete this._prefDialog,this.options&&delete this.options._prefDialog,this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){var t=this;if(!t.options.resourceParameter||this.options._modelCalled||!t.options.resourceParameter.physicalid&&!t.options.resourceParameter.OXID){this._parent(),this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._prefDialog||this.options._prefDialog?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in");var s="Create";t.options.resourceParameter&&t.options.resourceParameter.physicalid&&(s="Save"),this.buttons={Ok:new l({disabled:!0,label:C.get(s),onClick:function(){"Save"===s?t.onSave({button:t.buttons.Ok}).then(function(){t.enableDisableButtons(!0)}):t.onCreate({button:t.buttons.Ok}).then(function(){t.enableDisableButtons(!0)})}}),Save:new l({disabled:!0,label:C.get(s+" and Close"),onClick:function(){"Save"===s?t.onSave({button:t.buttons.Save}).then(function(){t.destroy()}):t.onCreate({button:t.buttons.Save}).then(function(){t.destroy()})}}),Cancel:new l({onClick:function(){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary";var a=this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table"),n=null,r=a.insertRow(-1);r.className=this.name+"-V_Direction";var o=e.createElement("th");if(o.innerText=C.get("Direction"),r.appendChild(o),r.insertCell(),t.options.resourceParameter)this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td div")&&this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td div").remove(),(n=e.createElement("div")).innerText=this.options.resourceParameter.plmObjectType&&this.options.resourceParameter.plmObjectType.indexOf("OUTPUT")>0?C.get("Output"):C.get("Input"),this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td").appendChild(n);else this.elements._direction=new m({type:"radio"}),this.elements._direction.addChild(new d({type:"radio",label:C.get("Input"),value:"Input",checkFlag:!0})),this.elements._direction.addChild(new d({type:"radio",label:C.get("Output"),value:"Output",checkFlag:!1})),this.elements._direction.inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Direction td")),this.elements._direction.getContent().addEventListener("change",function(e){t._populateExtensionSection()});var c=a.insertRow(-1);c.className=this.name+"-V_ParameterType";var u=e.createElement("th");if(u.innerText=C.get("Dimension"),c.appendChild(u),c.insertCell(),t.options.resourceParameter)i.getMagnitudes().then(function(i){t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td div")&&t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td div").remove(),!t.options.resourceParameter.parameter_type&&t.options.resourceParameter.interfaces&&t.options.resourceParameter.interfaces.length&&e.each(t.options.resourceParameter.interfaces,function(e,i){i.indexOf("DELRscPrmIOValueAbstract")>=0&&(t.options.resourceParameter.parameter_type=i[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""),t.options.resourceParameter.magnitude=t.options.resourceParameter.parameter_type)});var s="";e.each(i,function(e,i){i.Name!==t.options.resourceParameter.parameter_type&&i.Name!==t.options.resourceParameter.magnitude||(s=i.NLS)}),"IntegerValue"===t.options.resourceParameter.parameter_type&&""===s||"Integer"===t.options.resourceParameter.parameter_type&&""===s?s=C.get("Integer"):("TextValue"===t.options.resourceParameter.parameter_type&&""===s||"Text"===t.options.resourceParameter.parameter_type&&""===s)&&(s=C.get("Text")),(n=e.createElement("div")).innerHTML=s||"",t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td").appendChild(n)}),t.options.resourceParameter.parameter_type.indexOf("Integer")<0&&t.options.resourceParameter.parameter_type.indexOf("Text")<0&&t.options.resourceParameter.parameter_type.indexOf("String")<0?t._populateAllMagnitudesSection(t.options.resourceParameter):(t.options.resourceParameter.parameter_type.indexOf("Integer")>=0||t.options.resourceParameter.parameter_type.indexOf("Text")>=0||t.options.resourceParameter.parameter_type.indexOf("String")>=0)&&t._populateListSection(t.options.resourceParameter.V_Values);else{var p=e.extendElement(t.elements.mainDiv.querySelector("tr."+t.name+"-V_ParameterType td"));p.addClassName("loading"),i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(i){var s=[];i||(s=[{labelItem:C.get("Integer"),valueItem:"Integer"},{labelItem:C.get("Text"),valueItem:"String"}]),i&&e.each(i,function(e,t){t&&t.Name&&t.NLS&&s.push({labelItem:t.NLS,valueItem:t.Name})}),(s=s.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0})).unshift({labelItem:C.get("Select"),valueItem:""}),s.push({labelItem:" -- "+C.get("Other")+" -- ",valueItem:"__OTHER__"}),t.elements._parameterTypeDropdown=new h({elementsList:s,enableSearchFlag:!1,actionOnClickFlag:!1}).inject(p),t.elements._parameterTypeDropdown.getContent().addClassName("parameter_type_dropdown"),t.elements._parameterTypeDropdown.getContent().addEventListener("change",function(e){t.onParameterTypeDropdownChange(e)}),t.enableDisableButtons(!1),t.elements._parameterSettings=new l({displayStyle:"lite",label:C.get("Dimension Settings"),icon:{iconName:"cog",fontIconFamily:window.WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(p),t.elements._parameterSettings.getContent().addClassName("parameter_settings"),t.elements._parameterSettings.getContent().addEventListener("buttonclick",function(){t.hideDialog(),t.showPreferencesDialog()}),p.removeClassName("loading")},function(e){e||(e=C.get("Error")),t._displayNotificationMessage(e)})}t._populateExtensionSection(),this.options.resourceParameter?(this.elements._inputName.value=this.options.resourceParameter.V_Name,this.elements._inputDescription.value=this.options.resourceParameter.V_ParameterType||""):(this.elements._inputName.value=C.get("Resource Parameter")+"-"+(new Date).getTime(),this.elements._inputName.elements.inputField.select()),this.elements._inputName.addEventListener("change",function(){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0),t.elements._parameterTypeDropdown&&!t.elements._parameterTypeDropdown.currentValue&&t.enableDisableButtons(!1)}),this.addEventListener("resize",function(e){t.resize(e)}),this.resize(),this.addEventListener("close",function(){t.destroy()})}else i.getOneResourceParameter({physicalid:t.options.resourceParameter.physicalid,OXID:t.options.resourceParameter.OXID}).then(function(e){e?(t.options._modelCalled=Object.assign({},t.options.resourceParameter),t.options.resourceParameter=Object.assign(t.options.resourceParameter,e)):t.options._modelCalled=!0,t._postBuildView()})},showPreferencesDialog:function(e){!this._prefDialog&&this.options._prefDialog&&(this._prefDialog=this.options._prefDialog),this._prefDialog||((e=Object.assign(e||{},this.options))._createDlg||(e._createDlg=this),this.options.blnForceRefreshPreferences&&(e.blnForceRefresh=!0,this.options.blnForceRefreshPreferences=!1),this._prefDialog=new a(e)),this._prefDialog.showDialog(e)},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(e){e&&e.blnForceRefresh&&(this._prefDialog_Done=!0,this._updateParameterTypeDropdown()),this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},resize:function(){var e=this.elements.mainDiv.querySelector(".listSectionTable");if(e){if(this.elements._uwaTree&&this.elements._uwaTree._getScroller()&&this.elements._uwaTree._getScroller().elements&&this.elements._uwaTree._getScroller().elements.container){var t=this.elements._uwaTree._getScroller().elements.container.scrollHeight;t>this.elements._uwaTree._getScroller().elements.container.clientHeight?(e.setStyle("height",t),this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&e.setStyle("height",t-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight))):t>100&&this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&e.setStyle("height",Math.max(100,t-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight)))}this.elements.mainDiv.clientHeight<e.offsetTop+120&&(this.height+=e.offsetTop-this.elements.mainDiv.clientHeight+120)}var i=this.getContent().querySelector("."+this.name+"-table");if(i&&this.elements.mainDiv.clientHeight<i.clientHeight&&(this.height+(i.clientHeight-this.elements.mainDiv.clientHeight)>=window.widget.body.clientHeight?this.height=window.widget.body.clientHeight:this.height+=i.clientHeight-this.elements.mainDiv.clientHeight),this.immersiveFrame&&this.elements._footerDiv&&this.elements._footerDiv.getBoundingClientRect){var s=this.elements._footerDiv.getBoundingClientRect(),a=this.immersiveFrame.elements.container.getBoundingClientRect();s&&s.bottom&&s.bottom>a.bottom&&(this.position=this._getDefaultPosition())}},onCreate:function(t){var s=this;return new Promise(function(a,n){if(!s.elements._inputName||!s.elements._inputDescription)return s._displayNotificationMessage("incomplete dialog!"),void n("incomplete dialog!");if(!(s.elements._inputName.value||"").trim())return s._displayNotificationMessage(C.get("Missing Name")),void n("Missing Name");s.listChanged("update",{});var r={V_Name:s.elements._inputName.value.trim(),V_description:(s.elements._inputDescription.value||"").trim(),target_param_list:s.options.parentModel,resourceParameterExtension:s.elements._parameterTypeDropdown&&s.elements._parameterTypeDropdown.currentValue||"",inputOutput:s.elements._direction.value[0],units:s.elements._unitsDropdown&&s.elements._unitsDropdown.currentValue||"",minValue:"",maxValue:"",minLimit:"",maxLimit:""};"String"===r.resourceParameterExtension||"Integer"===r.resourceParameterExtension?(r.V_Values=[],s._arrList&&s._arrList.length>0&&(r.V_Values=s._arrList),delete r.units,delete r.minValue,delete r.minLimit,delete r.maxValue,delete r.maxLimit):s.elements._parameterTypeDropdown&&""!==s.elements._parameterTypeDropdown.currentValue&&(r.minLimit=s.elements._minDropdown.currentValue,"NotSet"!==r.minLimit?r.minValue=s.elements._inputMinimum.value:delete r.minValue,r.maxLimit=s.elements._maxDropdown.currentValue,"NotSet"!==r.maxLimit?r.maxValue=s.elements._inputMaximum.value:delete r.maxValue);var o={},l={},c=[],u=s.elements.mainDiv.querySelector("."+s.name+"-table tr."+s.name+"-extensionAutoSection"),d=s.elements.mainDiv.querySelector("."+s.name+"-table tr."+s.name+"-extensionCustoRow");e.each([u,d],function(t,s){if(s){var a=s.querySelector(".wux-controls-accordeon-container");if(a&&a.dsModel){var n=a.dsModel;n&&n.items&&n.items.length&&e.each(n.items,function(t,s){if(s&&s.content&&s.objExtension&&s.objExtension.name){var a={};o[s.objExtension.name]=s.objExtension,s.objExtension.properties&&(o[s.objExtension.name].propertiesObj={},e.each(s.objExtension.properties,function(t,n){o[s.objExtension.name].propertiesObj[n.name]=n;var r=s.content.querySelector('tr[data-extension-attribute="'+n.name+'"] td .wux-controls-abstract');if(r){var l=r.dsModel;l&&(n.dimension&&n.preferred_unit?c.push(new Promise(function(t,s){i.getMagnitudes({filter:"dimensionName+eq+"+n.dimension,magnitude:n.dimension}).then(function(r){if(r&&r[n.dimension]){var o=r[n.dimension].MKSUnit;if(!o&&r[n.dimension].Units&&r[n.dimension].Units.length&&e.each(r[n.dimension].Units,function(e,t){return t&&t.default&&(o=t.Name),!o}),!o||n.preferred_unit===o)return a[n.name]=l.value||"",void t();i.convertValueToUnit({value:l.value,dimension:n.dimension,fromUnit:n.preferred_unit,toUnit:o}).then(function(e){a[n.name]=e,t(a)},s)}else s(new Error("unable to retrieve details for "+n.dimension))})})):l.value&&l.value instanceof Date?(l.value.setMilliseconds(0),a[n.name]=e.Date.toDSDate(l.value)):a[n.name]=l.value||"")}})),l[s.objExtension.name]=a}})}}}),e.Object.isEmptyObject(l)||(r.extensions=l),s.enableDisableButtons(!1),s._handleLoadingButtons({dsModel:t&&t.button||s.buttons.Save},!0),Promise.all(c).then(function(){r&&r.extensions&&e.Object.isPlainObject(r.extensions)&&o&&e.each(r.extensions,function(t,i){o[t]&&o[t].propertiesObj&&e.each(i,function(e,a){var n=o[t].propertiesObj[e];n&&a&&n.range&&"String"!==n.range&&(i[n.name]=s._convertPropValueType(n,a))})}),i.createResourceParameter(r).then(function(e){s._handleLoadingButtons({dsModel:t&&t.button||s.buttons.Save},!1);var i=C.get("Resource Parameter");e&&1===e.length&&e[0].V_Name&&(i=e[0].V_Name),s._displayNotificationMessage(C.replace("{0} Created",{0:i}),{level:"success"}),a(e)},function(e){s.enableDisableButtons(!0),s._handleLoadingButtons({dsModel:t&&t.button||s.buttons.Save},!1),e||(e=C.get("Error")),s._displayNotificationMessage(e),n(e)})},n)})},onParameterTypeDropdownChange:function(){var t=this,s=t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties");t.elements._parameterTypeDropdown.currentValue?"__OTHER__"===t.elements._parameterTypeDropdown.currentValue?i.getMagnitudes({blnForceRefresh:!0}).then(function(i){var s=[{labelItem:C.get("Integer"),valueItem:"Integer"},{labelItem:C.get("Text"),valueItem:"String"}];i&&e.each(i,function(e,t){t&&t.Name&&t.NLS&&s.push({labelItem:t.NLS,valueItem:t.Name})}),s=s.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}),t.elements._parameterTypeDropdown.elementsList=s,t.elements._parameterTypeDropdown.selectedIndex=-1,t.elements._parameterTypeDropdown.enableSearchFlag=!0,t.resize()},function(e){e||(e=C.get("Error")),t._displayNotificationMessage(e)}):"Integer"===t.elements._parameterTypeDropdown.currentValue||"String"===t.elements._parameterTypeDropdown.currentValue?(s&&s.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t._populateListSection()):t._populateAllMagnitudesSection():s&&s.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t.resize(),""===t.elements._parameterTypeDropdown.currentValue?t.enableDisableButtons(!1):""!==t.elements._parameterTypeDropdown.currentValue&&t.enableDisableButtons(!0),(this.elements._inputName.value||"").trim()||t.enableDisableButtons(!1)},_populateListSection:function(t){var i=this,s=i.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table");i.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties")&&i.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove();var a=i.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar");a&&(i.elements._uwaTree=null,i.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar").remove());var n=i.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection");n&&(i.elements._uwaTree=null,i.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection").remove());var r=-1;s.rows&&e.each(s.rows,function(t,s){return s&&e.extendElement(s).hasClassName(i.name+"-V_ParameterType")&&(r=t+1),r<0}),(a=s.insertRow(r++)).className=this.name+"-simpleToolbar";var o=e.createElement("td");(o=a.insertCell()).colSpan="2";var l=e.createElement("div");l.innerHTML='<div class="simple_toolbar_title"></div><div class="simple_toolbar_iconNew"><div class="sectionheader_button_icon wux-ui-3ds wux-ui-3ds-plus" title="'+C.get("New")+'"></div></div><div class="simple_toolbar_iconDelete"><div class="sectionheader_button_icon wux-ui-3ds wux-ui-3ds-trash" title="'+C.get("Delete")+'"></div></div>',l.className="simpleToolbar",o.appendChild(l),(n=s.insertRow(r++)).className=this.name+"-listSection";var c=n.insertCell();c.colSpan="2";var u=e.createElement("div");u.className="listSectionTable",c.appendChild(u),t?i.addRootNodesFromData(t):i.addRootNodesFromData(),i.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-plus").addEventListener("click",function(e){i.onNewDefinitionCallback(e)}),i.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-trash").addEventListener("click",function(e){i.onDeleteDefinitionCallback(e)})},_populateExtensionSection:function(){var i=this,s=null,a=null,r=null;if(i.elements&&i.elements.mainDiv){s=i.elements.mainDiv.querySelector("."+this.name+"-table tr."+this.name+"-extensionAutoSection"),a=i.elements.mainDiv.querySelector("."+this.name+"-table tr."+this.name+"-extensionAddRemoveRow"),r=i.elements.mainDiv.querySelector("."+this.name+"-table tr."+this.name+"-extensionCustoRow");var l=null;s?(s.empty||e.extendElement(s),s.empty()):(l||(l=i.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table")),(s=l.insertRow(-1)).className=this.name+"-extensionAutoSection");var c=s.insertCell();c.colSpan="2",n.mask(c,C.replace("Loading {0}",{0:C.get("Extensions")}));var u="Input";this.options&&this.options.resourceParameter&&this.options.resourceParameter.plmObjectType?u=this.options.resourceParameter.plmObjectType&&this.options.resourceParameter.plmObjectType.indexOf("OUTPUT")>0?"Output":"Input":this.elements&&this.elements._direction&&this.elements._direction.value&&this.elements._direction.value.length&&(u=this.elements._direction.value[0]||"Input");var d="DELResourcePrm"+u.toUpperCase();t.getServiceUrl({serviceName:"3DSpace"}).then(function(m){i._SpaceURL=m,t.getExtensions({class_name:[d,"DELResourcePrmAbstract"],blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then(function(t){if(i.elements&&i.options&&i.options.resourceParameter&&i.options.resourceParameter.plmObjectType||i.elements&&i.elements._direction&&!(i.elements._direction.value.indexOf(u)<0)){if(n.unmask(c),!t||!e.Object.isPlainObject(t)||e.Object.isEmptyObject(t))return s.remove(),a&&s.remove(),void(r&&r.remove());var d={},m={},p={},h={};e.each(t,function(t,s){e.each(s,function(t,s){s.isAbstract||s.name&&m[s.name]?m[s.name]?m[s.name]=Object.assign(m[s.name],s):m[s.name]=s:s.name&&(d[s.name]?d[s.name]=Object.assign(d[s.name],s):d[s.name]=s,d[s.name].isDeploymentInterface?d[s.name].isAutomaticDeploymentInterface?p[s.name]=d[s.name]:i.options.resourceParameter&&i.options.resourceParameter.interfaces&&e.each(i.options.resourceParameter.interfaces,function(e,t){return t.indexOf(s.name)>=0&&(p[s.name]=d[s.name]),!(s.name in p)}):h[s.name]=d[s.name])})}),m&&!e.Object.isEmptyObject(m)&&e.each(m,function(e){p[e]&&delete p[e],h[e]&&delete h[e]});var f=Object.values(p),g=Object.values(h);if(f.length){var v=i._populateExtensionAccordionSection(f),b=new o({items:v,arrowVisibleFlag:!0});b.getContent().addClassName(i.name+"-autoCustoAccordeon"),b.inject(c)}if(g.length){a?(a.empty||e.extendElement(a),a.empty()):(l||(l=i.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table")),(a=l.insertRow(-1)).className=i.name+"-extensionAddRemoveRow");var y=e.createElement("th");y.innerText=C.get("Extensions"),a.appendChild(y);var D=a.insertCell();r?(r.empty||e.extendElement(r),r.empty()):(l||(l=i.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table")),(r=l.insertRow(-1)).className=i.name+"-extensionCustoRow");var w=r.insertCell();w.colSpan="2";var L=i._populateExtensionAccordionSection(g),P=[],S=[],x=[];e.each(L,function(e,t){var s={label:t.header,value:t.objExtension.name,icon:t.objExtension.IconPath||t.objExtension.LargeIconPath||""};s.icon&&(s.icon.indexOf("http")<0&&s.icon.indexOf("/")>=0?s.icon=i._SpaceURL+"/webapps/"+s.icon:s.icon.indexOf("/")<0&&(s.icon={iconName:s.icon,fontIconFamily:window.WUXManagedFontIcons.Font3DS})),S.push(s),i.options&&i.options.resourceParameter&&i.options.resourceParameter.extensions&&i.options.resourceParameter.extensions[t.objExtension.name]&&(P.push(t.objExtension.name),x.push(t))}),S=S.sort(function(e,t){return e&&t?t.label?e.label&&e.label.toLowerCase()>t.label.toLowerCase()?1:-1:1:0});var E=new _({elementsTree:S,allowFreeInputFlag:!1});E.getContent().addClassName(i.name+"-custoAutoComplete"),E.inject(D),P.length>0&&(P=P.sort(function(e,t){return e&&t&&h[e]&&h[t]?(h[e].nlsName||e).toLowerCase()>(h[t].nlsName||t).toLowerCase()?1:-1:0}),E.value=P),x=x.sort(function(e,t){return e&&t?t.label?e.label&&e.label.toLowerCase()>t.label.toLowerCase()?1:-1:1:0});var O=new o({items:x,arrowVisibleFlag:!0});O.getContent().addClassName(i.name+"-custoAccordeon"),O.inject(w),E.addEventListener("change",function(t){e.each(E.value||[],function(t,s){var a=!1;if(O.items&&O.items.length&&(a=O.items.find(function(e){return e&&e.objExtension&&e.objExtension.name===s})),a){if(a.content){a.content.getClosest||e.extend(a.content);var r=a.content.getClosest(".wux-controls-expander");if(r){if(r.hasClassName(i.name+"-deletePending")){var o=r.querySelector(".masked");o&&n.unmask(o),r.removeClassName(i.name+"-deletePending")}r.dsModel&&r.dsModel.expand&&r.dsModel.expand()}}}else i._populateExtensionAccordionSection([d[s]],O)})}),E.addEventListener("onPostRemove",function(t){var s=!1;O.items&&O.items.length&&(s=O.items.find(function(e){return e&&e.objExtension&&e.objExtension.name===t.options.chips[0].chipOptions.value.options.value})),e.each(O.items,function(a,r){if(r&&r.objExtension&&r.objExtension.name&&r.objExtension.name===t.options.chips[0].chipOptions.value.options.value){if(!(i.options.resourceParameter&&i.options.resourceParameter.extensions&&i.options.resourceParameter.extensions[r.objExtension.name]))return void O.deleteItem(O.getIndexFrom(s));if(s.content){s.content.getClosest||e.extend(s.content);var o=s.content.getClosest(".wux-controls-expander");if(o)return o.addClassName(i.name+"-deletePending"),o.dsModel.expand(),void n.mask(o,C.get("Extension removed upon Save"));steal.dev.log(i.name+"::_populateExtensionSection - invalid expander found for delete!")}}})}),i.resize()}}},function(e){e||(e=C.get("Error")),i._displayNotificationMessage(e)})},function(e){e||(e=C.get("Error")),i._displayNotificationMessage(e)})}else setTimeout(function(){i._populateExtensionSection()},250)},_populateExtensionAccordionSection:function(t,s){var a=this,n=[];return e.each(t,function(t,s){var r={objExtension:s,header:s.nlsName||s.name};if(s.IconPath||s.LargeIconPath){var o=s.IconPath||s.LargeIconPath;o.indexOf("http")<0&&o.indexOf("/")>=0?r.icon=a._SpaceURL+"/webapps/"+o:o.indexOf("/")>=0?r.icon=o:r.icon={iconName:o,fontIconFamily:window.WUXManagedFontIcons.Font3DS}}s.properties&&s.properties.length?(r.content=e.createElement("table"),e.each(s.properties,function(t,n){var o=r.content.insertRow(-1);o.setAttribute("data-extension-attribute",n.name);var l=e.createElement("th").appendText(n.nlsName||n.name);o.appendChild(l);var m=e.createElement("td"),_=null;if(!(a.options.resourceParameter&&a.options.resourceParameter.extensions&&a.options.resourceParameter.extensions[s.name]&&n.getUIAccess&&"ReadWrite"!==n.getUIAccess)){var b={objProperty:n,value:n.default_value,autoCommitFlag:!0};switch((n.dimension||"").toUpperCase()){case"TIME":if(n.preferred_unit&&"SECOND"!==n.preferred_unit&&"MINUTE"!==n.preferred_unit)_=new u(b);else{var y=Object.assign({precision:"sec",mode:"duration",minutesStep:1,secondsStep:10},b);"MINUTE"===n.preferred_unit&&(y.precision="min");var D=new Date(0,0,0,0,0,0);D.setSeconds(b.value),y.value=D,_=new g(y)}break;default:if("Date"===n.range)delete b.value,b.timePickerFlag=!0,b.timePickerPrecision="sec",_=new c(b);else if("Boolean"===n.range)b.type="switch",b.checkFlag="true"===b.value,b.value="true",_=new d(b);else if(n.multi_valuated)Array.isArray(b.value)||(b.value=[b.value]),_=new v(b);else if(n.authorized_values&&"string"==typeof n.authorized_values&&"["===n.authorized_values[0]&&"]"===n.authorized_values[n.authorized_values.length-1]){b=Object.assign(b,{elementsList:[],enableSearchFlag:!1,actionOnClickFlag:!1});var w=n.authorized_values.substring(1,n.authorized_values.length-1);e.each(w.split(","),function(e,t){t=t.trim(),b.elementsList.push({labelItem:t,valueItem:t})}),_=new h(b)}else n.isMultiline?(b.newLineMode="enter",b.resizableFlag="vertical",_=new p(b)):_=new u(b)}}var L=null;if(_||(L=e.createElement("span").inject(m)),a.options&&a.options.resourceParameter&&a.options.resourceParameter.extensions&&a.options.resourceParameter.extensions[s.name]&&a.options.resourceParameter.extensions[s.name][n.name])if(n.dimension&&n.preferred_unit)_&&(_.disabled=!0),new Promise(function(t,r){if(a.options.resourceParameter.extensions[s.name][n.name+".displayValue"])return _?_.value=a.options.resourceParameter.extensions[s.name][n.name+".displayValue"]:L&&(L.innerText=a.options.resourceParameter.extensions[s.name][n.name+".displayValue"]),void t();i.getMagnitudes({filter:"dimensionName+eq+"+n.dimension,magnitude:n.dimension}).then(function(o){if(o&&o[n.dimension]){var l=o[n.dimension].MKSUnit;if(!l&&o[n.dimension].Units&&o[n.dimension].Units.length&&e.each(o[n.dimension].Units,function(e,t){return t&&t.default&&(l=t.Name),!l}),!l||n.preferred_unit===l)return _?_.value=a.options.resourceParameter.extensions[s.name][n.name]:L&&(L.innerText=a.options.resourceParameter.extensions[s.name][n.name]),void t();i.convertValueToUnit({value:a.options.resourceParameter.extensions[s.name][n.name],dimension:n.dimension,fromUnit:l,toUnit:n.preferred_unit}).then(function(e){isNaN(e)?r():(e=+e,a.options.resourceParameter.extensions[s.name][n.name+".displayValue"]=e,e=Math.round(1e6*(e+Number.EPSILON))/1e6,_?_.value=e:L&&(L.innerText=e),t(e))},r)}},r)}).then(function(){_&&(_.disabled=!1)},function(e){_&&(_.disabled=!1),e||(e=C.get("Error")),a._displayNotificationMessage(e)});else if(_&&Array.isArray(_.value)&&!Array.isArray(a.options.resourceParameter.extensions[s.name][n.name])){var P=a.options.resourceParameter.extensions[s.name][n.name],S=[];P&&"string"==typeof P&&"["===P[0]&&"]"===P[P.length-1]?(P=P.substring(1,P.length-1),e.each(P.split(","),function(e,t){t=t.trim(),S.push(t)})):S.push(P),_.value=S}else!_||_ instanceof g?L&&(L.innerText=a.options.resourceParameter.extensions[s.name][n.name+".displayValue"]||a.options.resourceParameter.extensions[s.name][n.name]):_.value=a.options.resourceParameter.extensions[s.name][n.name+".displayValue"]||a.options.resourceParameter.extensions[s.name][n.name];if(_)_.inject(m),_.getContent().addEventListener("change",function(){a.validate()}),"ReadOnly"===n.getUIAccess?_.placeholder=C.get("Read Only Attribute After Creation"):"None"===n.getUIAccess&&(_.placeholder=C.get("Attribute Not Visible After Creation")),n.dimension&&!(_ instanceof u)||!_.elements.inputField||"Double"!==n.range&&"Integer"!==n.range||(_.elements.inputField.type="number","Double"===n.range?_.elements.inputField.step=1e-6:"Integer"===n.range&&(_.elements.inputField.step=1)),n.max_length&&n.max_length>0&&(_ instanceof u||_ instanceof p)&&(_.maxLength=n.max_length,_.placeholder=C.replace("Maximum Length: {0}",{0:n.max_length}));else if("ReadOnly"===n.getUIAccess)_=L||e.createElement("span").inject(m),a.options.resourceParameter&&a.options.resourceParameter.extensions&&a.options.resourceParameter.extensions[s.name]&&a.options.resourceParameter.extensions[s.name][n.name]&&(_.innerText||(_.innerText=a.options.resourceParameter.extensions[s.name][n.name]));else if("None"===n.getUIAccess)return void o.remove();if(_&&n.dimension){_.elements&&_.elements.container?_.elements.container.addClassName("has-dimension"):_.nodeType&&_.nodeType===window.Node.ELEMENT_NODE&&_.addClassName("has-dimension");var x=[];i.getMagnitudeUnits({magnitude:n.dimension}).then(function(t){if(t&&(x.length=0,e.each(t,function(e,t){if(t&&t.Name&&t.NLSName){var i={labelItem:t.NLSName,valueItem:t.Name};n.preferred_unit&&n.preferred_unit===t.Name?i.default=!0:!n.preferred_unit&&t.default&&!0===t.default&&(i.default=!0),x.push(i)}}),x=x.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0}))){var i=null;e.each(x,function(e,t){return t.default&&!0===t.default&&(i=e),null===i}),i>=0&&(new f({value:x[i].labelItem}).inject(m).options.unit=x[i])}})}o.appendChild(m)})):r.content=e.createElement("div").appendText(C.replace("No {0}",{0:C.get("Attributes")})),n.push(r)}),s&&e.each(n,function(e,t){s.addItem(t),s.expandItem(s.getIndexFrom(t))}),n},_updateParameterTypeDropdown:function(){var t=this;i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(i){if(t.elements._parameterTypeDropdown){var s=[];i&&e.each(i,function(e,t){t&&t.Name&&t.NLS&&s.push({labelItem:t.NLS,valueItem:t.Name})}),(s=s.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0})).unshift({labelItem:C.get("Select"),valueItem:""}),s.push({labelItem:" -- "+C.get("Other")+" -- ",valueItem:"__OTHER__"}),t.elements._parameterTypeDropdown&&t.elements._parameterTypeDropdown.elements&&t.elements._parameterTypeDropdown.elements&&(t.blnPreventSelectedIndexUpdate=!0,t.elements._parameterTypeDropdown.elementsList=[],t.elements._parameterTypeDropdown.elementsList=s,t.blnPreventSelectedIndexUpdate=!1)}},function(e){e||(e=C.get("Error")),t._displayNotificationMessage(e)})},addRootNodesFromData:function(t){var i=[];!t||!Array.isArray(t)||t.length<=0?(i.push({dsModel:null,inEditMode:!0,grid:{tree:null}}),this.elements._parameterTypeDropdown&&("Integer"===this.elements._parameterTypeDropdown.currentValue?i[0].grid.tree=0:"String"===this.elements._parameterTypeDropdown.currentValue&&(i[0].grid.tree=""))):e.each(t,function(e,t){i.push({label:t,dsModel:t,inEditMode:!0,grid:{tree:t}})}),this.addRootNodesToTable(i)},addRootNodesToTable:function(t){var i=this;return new Promise(function(s,a){!t||!Array.isArray(t)||t.length<=0?s([]):i.addTable().then(function(a){var n=a.getTreeDocument(),r=[];a.prepareUpdateView(),e.each(t,function(e,t){var s=new w(t);s.dsModel=t.dsModel,n.addRoot(s),i.listChanged("add",s),r.push(s)}),a.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),i.resize(),i.validateIntegerStringList(null),s(r)},a)})},addTable:function(e){var t=this;return new Promise(function(i){if(t.elements._uwaTree)i(t.elements._uwaTree);else{e||(e={});var s={treeDocument:new y({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}}),cellSelection:"none",rowDragEnabledFlag:!0,enableListSelection:!0,maxVisibleRowCount:4,cellDragEnabledFlag:!1,canMultiSelect:!0,columns:[{editableFlag:!0,sortableFlag:!1,editionPolicy:"EditionInPlace",dataIndex:"tree",typeRepresentation:"string"}]};t.elements._parameterTypeDropdown&&"Integer"===t.elements._parameterTypeDropdown.currentValue&&(s.columns[0].typeRepresentation="integer",s.columns[0].getCellSemantics=function(){return{stepValue:1}}),s.treeDocument||(s.treeDocument=new y({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}})),e.container||(e.container=t.elements.mainDiv.getElementsByClassName("listSectionTable"),e.container&&1===e.container.length&&(e.container=e.container[0])),t.elements._uwaTree=new b(s).inject(e.container),t.elements._uwaTree.layout.columnsHeader=!1,t.elements._uwaTree.rowSelection="multiple",t.elements._uwaTree.columnSelection="none",t.elements._uwaTree.cellSelection="none",t.elements._uwaTree.addEventListener("postEdit",function(e,i){t.listChanged("update",i)}),t.elements._uwaTree.addEventListener("dragend",function(){t.listChanged("update")}),t.elements._uwaTree.getContainingImmersiveFrame&&!t.elements._uwaTree._getContainingImmersiveFrame&&(t.elements._uwaTree._getContainingImmersiveFrame=t.elements._uwaTree.getContainingImmersiveFrame,t.elements._uwaTree.getContainingImmersiveFrame=function(){var e=t._getContainingImmersiveFrame();return e||(e=t.immersiveFrame||t.options.immersiveFrame),e}),i(t.elements._uwaTree)}})},onNewDefinitionCallback:function(){var t=this;if(t.elements._uwaTree){var i={dsModel:null,inEditMode:!0,icons:[],grid:{tree:null}};t.elements._parameterTypeDropdown&&("Integer"===t.elements._parameterTypeDropdown.currentValue?i.grid.tree=0:"String"===t.elements._parameterTypeDropdown.currentValue&&(i.grid.tree="")),t.addRootNodesToTable([i],function(t){t&&t.length&&e.each(t,function(e,t){t.options.inEditMode=!0,t.updateOptions(t.options),t.select()})}),t.validateIntegerStringList(null)}else setTimeout(function(){t._addByTableRow()},250)},listChanged:function(){var t=this,i=[];if(t.elements._uwaTree){var s=t.elements._uwaTree.getTreeDocument().getRoots();s&&s.length>0?e.each(s,function(e,s){if("string"==typeof s._options.grid.tree&&s._options.grid.tree&&""!==s._options.grid.tree){if(t.elements._parameterTypeDropdown&&"Integer"===t.elements._parameterTypeDropdown.currentValue||t.options.resourceParameter&&("Integer"===t.options.resourceParameter.parameter_type||"IntegerValue"===t.options.resourceParameter.parameter_type)){if(isNaN(s._options.grid.tree))return t.enableDisableButtons(!1),t.validateIntegerStringList(!0),!1;"string"==typeof s._options.grid.tree&&(s._options.grid.tree=parseInt(s._options.grid.tree))}i[e]=s._options.grid.tree,t._arrList=i}else if("number"==typeof s._options.grid.tree){if((t.elements._parameterTypeDropdown&&"Integer"===t.elements._parameterTypeDropdown.currentValue||t.options.resourceParameter&&("Integer"===t.options.resourceParameter.parameter_type||"IntegerValue"===t.options.resourceParameter.parameter_type))&&isNaN(s._options.grid.tree))return t.enableDisableButtons(!1),t.validateIntegerStringList(!0),!1;i[e]=s._options.grid.tree,t._arrList=i}return t.validateIntegerStringList(null),!0}):t._arrList&&t._arrList.length&&(t._arrList=i)}},_addByTableRow:function(){var t=this;if(t.element)if(t.elements._uwaTree){var i={useAsyncPreExpand:!0,dsModel:null,grid:{tree:null}};t.elements._parameterTypeDropdown&&("Integer"===t.elements._parameterTypeDropdown.currentValue?i.grid.tree=0:"String"===t.elements._parameterTypeDropdown.currentValue&&(i.grid.tree="")),t.addRootNodesToTable([i],function(t){t&&t.length&&e.each(t,function(e,t){t.options.inEditMode=!0,t.updateOptions(t.options)})}),t.validateIntegerStringList(null)}else setTimeout(function(){t._addByTableRow()},250)},onDeleteDefinitionCallback:function(t){var i=this;if(t){t.stopPropagation&&t.stopPropagation();var s=(i.elements._uwaTree.getDocument?i.elements._uwaTree.getDocument():i.elements._uwaTree.getTreeDocument()).getSelectedNodes();e.each(s,function(e,t){if(t&&t.isSelected()){var s=t._getRowID();i._remove_a_row(s)}})}else window.steal.dev.log(i.constructor.fullName+"::onDeleteDefinitionCallback - invalid event!")},_remove_a_row:function(e){if(this.elements._uwaTree&&!isNaN(e)){var t=this.elements._uwaTree.getTreeDocument().getNthRoot(e);t.remove(),this.listChanged("remove",t)}},_populateAllMagnitudesSection:function(){var t=this,s=t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table");t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties")&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar")&&(t.elements._uwaTree=null,t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar").remove()),t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection")&&(t.elements._uwaTree=null,t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection").remove());var a=-1;s.rows&&e.each(s.rows,function(i,s){return s&&e.extendElement(s).hasClassName(t.name+"-V_ParameterType")&&(a=i+1),a<0});var n=s.insertRow(a++);n.className=this.name+"-magnitudeProperties";var r=e.createElement("td");(r=n.insertCell()).colSpan="2";var o=e.createElement("table");o.className="DELWebResourceParameterDlg-magnitudesTable",o.style.width="100%",r.appendChild(o);var l=o.insertRow(-1),c=e.createElement("th");c.innerText=C.get("Minimum"),l.appendChild(c);var d=e.createElement("th");d.innerText=C.get("Units"),l.appendChild(d);var m=e.createElement("th");m.innerText=C.get("Maximum"),l.appendChild(m);var p=o.insertRow(-1);p.insertCell().className="minProperties",p.insertCell().className="magnitudeUnits",p.insertCell().className="maxProperties";var f={value:" ",disabled:!0,autoCommitFlag:!0};t.options.resourceParameter&&(t.options.resourceParameter.minValue||0===t.options.resourceParameter.minValue)&&(f.value=t.options.resourceParameter.minValue,f.disabled=!1),this.elements._inputMinimum=new u(f).inject(this.elements.mainDiv.querySelector("td.minProperties")),this.elements._inputMinimum.elements.inputField.type="number",this.elements._inputMinimum.elements.inputField.step="0.000001",t.elements._inputMinimum.getContent().addEventListener("change",function(){t.validate()});var g=new y;g.addRoot(new w({label:C.get("Not Set"),icons:[],grid:{valueItem:"NotSet"}})),g.addRoot(new w({label:C.get("Inclusive"),icons:[{iconName:"lessthanorequal"}],grid:{valueItem:"Included"}})),g.addRoot(new w({label:C.get("Exclusive"),icons:[{iconName:"chevron-left"}],grid:{valueItem:"Excluded"}}));var v={elementsTree:g,enableSearchFlag:!1,actionOnClickFlag:!1};t.options.resourceParameter&&t.options.resourceParameter.minLimit&&(v.currentValue=t.options.resourceParameter.minLimit),this.elements._minDropdown=new h(v).inject(this.elements.mainDiv.querySelector("td.minProperties")),t.elements._minDropdown.getContent().addEventListener("change",function(e){t.onMinPropertiesChange(e)});var _={};_.magnitude=t.elements._parameterTypeDropdown&&t.elements._parameterTypeDropdown.currentValue||"",t.options.resourceParameter&&(t.options.resourceParameter.magnitude||t.options.resourceParameter.parameter_type)&&(_.magnitude=t.options.resourceParameter.magnitude||t.options.resourceParameter.parameter_type),i.getMagnitudeUnits(_).then(function(i){var s=null;t.elements.mainDiv.querySelector("td.magnitudeUnits div")&&t.elements.mainDiv.querySelector("td.magnitudeUnits div").remove();var a=[];i&&e.each(i,function(e,t){if(t&&t.Name&&t.NLSName){var i={labelItem:t.NLSName,valueItem:t.Name};t&&t.default&&!0===t.default&&(i.default=!0),a.push(i)}}),(a=a.sort(function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0}))&&(s=null,e.each(a,function(e,t){return t.default&&!0===t.default&&(s=e),null===s}));var n={elementsList:a,enableSearchFlag:!1,selectedIndex:s,actionOnClickFlag:!1};t.options.resourceParameter&&t.options.resourceParameter.units&&(n.currentValue=t.options.resourceParameter.units),t.elements._unitsDropdown=new h(n).inject(t.elements.mainDiv.querySelector("td.magnitudeUnits")),t.elements._unitsDropdown.getContent().addEventListener("change",function(e){t.onUnitsDropdownChange(e)})});var b=new y;b.addRoot(new w({label:C.get("Not Set"),grid:{valueItem:"NotSet"}})),b.addRoot(new w({label:C.get("Inclusive"),icons:[{iconName:"lessthanorequal"}],grid:{valueItem:"Included"}})),b.addRoot(new w({label:C.get("Exclusive"),icons:[{iconName:"chevron-left"}],grid:{valueItem:"Excluded"}}));var D={elementsTree:b,enableSearchFlag:!1,actionOnClickFlag:!1};t.options.resourceParameter&&t.options.resourceParameter.maxLimit&&(D.currentValue=t.options.resourceParameter.maxLimit),this.elements._maxDropdown=new h(D).inject(this.elements.mainDiv.querySelector("td.maxProperties")),t.elements._maxDropdown.getContent().addEventListener("change",function(e){t.onMaxPropertiesChange(e)});var L={value:" ",disabled:!0,autoCommitFlag:!0};t.options.resourceParameter&&(t.options.resourceParameter.maxValue||0===t.options.resourceParameter.maxValue)&&(L.value=t.options.resourceParameter.maxValue,L.disabled=!1),this.elements._inputMaximum=new u(L).inject(this.elements.mainDiv.querySelector("td.maxProperties")),this.elements._inputMaximum.elements.inputField.type="number",this.elements._inputMaximum.elements.inputField.step="0.000001",t.elements._inputMaximum.getContent().addEventListener("change",function(){t.validate()})},validate:function(){var t=this,i=0;(t.elements._parameterTypeDropdown&&!t.elements._parameterTypeDropdown.currentValue||!(t.elements._inputName.value||"").trim())&&i++;var s=null,a=null;t.elements._inputMinimum&&(s="string"==typeof t.elements._inputMinimum.value&&""!==t.elements._inputMinimum.value.trim()?parseFloat(t.elements._inputMinimum.value.trim()):"number"==typeof t.elements._inputMinimum.value?t.elements._inputMinimum.value:null),t.elements._inputMaximum&&(a="string"==typeof t.elements._inputMaximum.value&&""!==t.elements._inputMaximum.value.trim()?parseFloat(t.elements._inputMaximum.value.trim()):"number"==typeof t.elements._inputMaximum.value?t.elements._inputMaximum.value:null),t.elements._minDropdown&&("NotSet"!==t.elements._minDropdown.currentValue?(t.elements._inputMinimum.disabled=!1,"string"==typeof t.elements._inputMinimum.value?""!==t.elements._inputMinimum.value.trim()?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),i++):t.elements._inputMinimum.value||0===t.elements._inputMinimum.value?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),i++)):(t.elements._inputMinimum.disabled=!0,"NotSet"!==t.elements._maxDropdown.currentValue&&(t.elements._inputMaximum.disabled=!1,"string"==typeof t.elements._inputMaximum.value?""!==t.elements._inputMaximum.value.trim()?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),i++):t.elements._inputMaximum.value||0===t.elements._inputMaximum.value?(t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input"),t.enableDisableButtons(!0)):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),i++)))),t.elements._maxDropdown&&("NotSet"!==t.elements._maxDropdown.currentValue?(t.elements._inputMaximum.disabled=!1,"string"==typeof t.elements._inputMaximum.value?""!==t.elements._inputMaximum.value.trim()?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),i++):t.elements._inputMaximum.value||0===t.elements._inputMaximum.value?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),i++)):(t.elements._inputMaximum.disabled=!0,"NotSet"!==t.elements._minDropdown.currentValue&&(t.elements._inputMinimum.disabled=!1,"string"==typeof t.elements._inputMinimum.value?""!==t.elements._inputMinimum.value.trim()?(t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input"),t.enableDisableButtons(!0)):(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),i++):t.elements._inputMinimum.value||0===t.elements._inputMinimum.value?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),i++)))),t.elements._maxDropdown&&("Excluded"===t.elements._maxDropdown.currentValue||"Excluded"===t.elements._minDropdown.currentValue?null!==s&&""!==s&&null!==a&&""!==a&&s>=a&&(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),i++):"Included"===t.elements._maxDropdown.currentValue&&"Included"===t.elements._minDropdown.currentValue&&null!==s&&""!==s&&null!==a&&""!==a&&s>a&&(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),i++)),i>0?t.enableDisableButtons(!1):0===i&&(t.enableDisableButtons(!0),e.each(["td.minProperties input","td.maxProperties input"],function(e,i){var s=t.elements.mainDiv.querySelector(i);s&&s.hasClassName("invalid-input")&&s.removeClassName("invalid-input")}))},validateIntegerStringList:function(t){var i=null,s=this.elements._uwaTree.getTreeDocument().getRoots();s&&s.length>0&&e.each(s,function(e,s){s&&s._options&&s._options.grid&&null!==s._options.grid.tree&&""!==s._options.grid.tree&&!t||(i=s)}),i?this.enableDisableButtons(!1):this.enableDisableButtons(!0)},onUnitsDropdownChange:function(){this.validate()},onMinPropertiesChange:function(){"NotSet"!==this.elements._minDropdown.currentValue?this.elements._inputMinimum.disabled=!1:this.elements._inputMinimum.disabled=!0,this.validate()},onMaxPropertiesChange:function(){"NotSet"!==this.elements._maxDropdown.currentValue?this.elements._inputMaximum.disabled=!1:this.elements._inputMaximum.disabled=!0,this.validate()},onSave:function(t){var s=this;return new Promise(function(a,n){if(!s.elements._inputName||!s.elements._inputDescription)return s._displayNotificationMessage("incomplete dialog!"),void n("incomplete dialog!");if(!(s.elements._inputName.value||"").trim())return s._displayNotificationMessage(C.get("Missing Name")),void n("Missing Name");if(!s.options.resourceParameter||!s.options.resourceParameter.physicalid)return s._displayNotificationMessage("Missing Resource Parameter"),void n("Missing Resource Parameter");s.listChanged("update",{});var r={physicalid:s.options.resourceParameter.physicalid},o=!1;r.attributes={},e.each({V_Name:s.elements._inputName,V_description:s.elements._inputDescription},function(e,t){t&&e in s.options.resourceParameter&&t.value!==s.options.resourceParameter[e]&&(o=e,r.attributes[e]=(t.value||"").trim())}),"Integer"!==s.options.resourceParameter.parameter_type&&"Text"!==s.options.resourceParameter.parameter_type&&"IntegerValue"!==s.options.resourceParameter.parameter_type&&"TextValue"!==s.options.resourceParameter.parameter_type?e.each({units:s.elements._unitsDropdown&&s.elements._unitsDropdown.currentValue||"",minValue:s.elements._inputMinimum&&!isNaN(s.elements._inputMinimum.value)?parseFloat(s.elements._inputMinimum.value):null,maxValue:s.elements._inputMaximum&&!isNaN(s.elements._inputMaximum.value)?parseFloat(s.elements._inputMaximum.value):null,minLimit:s.elements._minDropdown&&s.elements._minDropdown.currentValue||null,maxLimit:s.elements._maxDropdown&&s.elements._maxDropdown.currentValue||null},function(e,t){t&&e in s.options.resourceParameter&&t!==s.options.resourceParameter[e]?(o=e,r.attributes[e]=t||""):e in s.options.resourceParameter&&t!==s.options.resourceParameter[e]&&(o=e,r.attributes[e]=t)}):e.each({V_Values:s._arrList},function(e,t){t&&e in s.options.resourceParameter&&t!==s.options.resourceParameter[e]&&(o=e,r.attributes[e]=t||"")});var l={},c=[],u=[],d=s.elements.mainDiv.querySelector("."+s.name+"-table tr."+s.name+"-extensionAutoSection"),m=s.elements.mainDiv.querySelector("."+s.name+"-table tr."+s.name+"-extensionCustoRow");if(e.each([d,m],function(t,a){if(a){var n=a.querySelector(".wux-controls-accordeon-container");if(n&&n.dsModel){var r=n.dsModel;r&&r.items&&r.items.length&&e.each(r.items,function(t,a){if(a&&a.content&&a.objExtension&&a.objExtension.name){if(a.content&&!a.objExtension.isAutomaticDeploymentInterface){a.content.getClosest||e.extend(a.content);var n=a.content.getClosest(".wux-controls-expander");if(n&&n.hasClassName(s.name+"-deletePending"))return void c.push(a.objExtension.name)}var r={};a.objExtension.properties&&e.each(a.objExtension.properties,function(t,n){var o=a.content.querySelector('tr[data-extension-attribute="'+n.name+'"] td .wux-controls-abstract');if(o){var l=o.dsModel;if(l){var c=null;s.options.resourceParameter.extensions&&s.options.resourceParameter.extensions[a.objExtension.name]&&s.options.resourceParameter.extensions[a.objExtension.name]&&n.name in s.options.resourceParameter.extensions[a.objExtension.name]&&(c=s.options.resourceParameter.extensions[a.objExtension.name][n.name]);var d=l.value;c!==d&&(isNaN(d)||"TIME"!==(n.dimension||"").toUpperCase()||l instanceof g&&"duration"===l.mode&&((n=e.clone(n)).preferred_unit="MS"),n.dimension&&n.preferred_unit?u.push(new Promise(function(t,s){i.getMagnitudes({filter:"dimensionName+eq+"+n.dimension,magnitude:n.dimension}).then(function(a){if(a&&a[n.dimension]){var o=a[n.dimension].MKSUnit;if(!o&&a[n.dimension].Units&&a[n.dimension].Units.length&&e.each(a[n.dimension].Units,function(e,t){return t&&t.default&&(o=t.Name),!o}),!o||n.preferred_unit===o)return r[n.name]=+(d||0),void t();i.convertValueToUnit({value:d,dimension:n.dimension,fromUnit:n.preferred_unit,toUnit:o}).then(function(e){r[n.name]=+e,t()},s)}else s(new Error("unable to retrieve details for "+n.dimension))})})):d&&d instanceof Date?(d.setMilliseconds(0),r[n.name]=e.Date.toDSDate(d)):r[n.name]=s._convertPropValueType(n,d||""))}}}),l[a.objExtension.name]=r}})}}}),e.Object.isEmptyObject(l)||(r.extensions=l,o=o||l),c&&c.length>0&&(r.extensionsToRemove=c,o=o||c),!o)return s._displayNotificationMessage(C.get("No changes have been made."),{level:"info"}),void a("No changes have been made.");s.enableDisableButtons(!1),s._handleLoadingButtons({dsModel:t&&t.button||s.buttons.Save},!0),Promise.all(u).then(function(){i.updateResourceParameter(r).then(function(){s._handleLoadingButtons({dsModel:t&&t.button||s.buttons.Save},!1),s._displayNotificationMessage(C.replace("{0} Updated",{0:C.get("Resource Parameter")}),{level:"success"}),a("success")},function(e){s._handleLoadingButtons({dsModel:t&&t.button||s.buttons.Save},!1),s.enableDisableButtons(!0),e||(e=C.get("Error")),s._displayNotificationMessage(e),n(e)})},n)})},_convertPropValueType:function(t,i){var s=i;if(!t||!t.range)return i;if("string"==typeof i)switch(t.range.toLowerCase()){case"boolean":s="true"===i.toLowerCase();break;case"double":s=+i;break;case"integer":s=Math.floor(+i);break;case"date":"string"==typeof i&&i.indexOf("@")<0&&(i=new Date(i)),i instanceof Date&&(i.setMilliseconds(0),s=e.Date.toDSDate(i))}else i instanceof Date&&(i.setMilliseconds(0),s=e.Date.toDSDate(i));return s},_handleLoadingButtons:function(e,i){var s=this;if(s._SpaceURL){var a=s.buttons.Save;e&&e.dsModel&&(a=e.dsModel),i?(a.iconSize="1em",a.icon=s._SpaceURL+"/webapps/DELWebInfrastructure/DSCommon/graphics/loading-small.gif"):a.icon=""}else t.getServiceUrl({serviceName:"3DSpace"}).then(function(t){s._SpaceURL=t||"/",s._SpaceURL?s._handleLoadingButtons(e,i):s._displayNotificationMessage(C.get("Error"))},function(e){e||(e=C.get("Error")),s._displayNotificationMessage(e)})},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterFacet",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Promise","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/buttonsBar/ButtonsBar","DS/EditPropWidget/constants/EditPropConstants","DS/DELWebInfrastructureControls/Mask","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Windows/Dialog","DS/Controls/Button","DS/CoreEvents/Events","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,s,a,n,r,o,l,c,u,d,m,p,h,f,g,v,_){"use strict";return i.extend({_eventSubscriptionTokens:[],_listOfMagnitudes:{},_listofMagnitudeUnits:{},init:function(t){this._parent.apply(this,arguments),t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)?(this.options&&this.options.modelCache&&e.Function.isFunction(this.options.modelCache)&&(o.setCacheObject(this.options.modelCache()),delete this.options.modelCache),this.options=Object.assign(this.options,t)):this.options||(this.options={}),this.elements.container||(this.elements.container=e.createElement("div",{class:"content_section "+this.getClassNames(),styles:{height:"100%"}})),this.elements.content||(this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}).inject(this.elements.container)),this._type=t.type||"resource",this._initTopBar(),this._initEventHandlers()},destroyComponent:function(){this.elements&&this.elements.TopBar&&this.elements.TopBar.container&&this.elements.TopBar.container.remove&&this.elements.TopBar.container.remove(),this.elements&&this.elements.container&&this.elements.container.remove&&this.elements.container.remove(),this._parent.apply(this,arguments),e.each(this._eventSubscriptionTokens||[],function(e,t){this.options&&this.options.modelEvents?this.options.modelEvents.unsubscribe(t):v.unsubscribe(t)}),this._eventSubscriptionTokens=[]},updateFacet:function(t){var i=this;this.addLoader();var s=i.getModel();if(!s)return!1;this.elements.TopBar.container.inject(this.elements.container.closest(".IDCardInnerBottomArea").getElementsByClassName("actionArea")[0]);var a={physicalid:s.get("objectId")};t&&t.blnForceRefresh&&(a.blnForceRefresh=!0),o.getResourceParameterLists(a).then(function(t){if(t&&!e.Object.isEmptyObject(t)){var s=i.elements._uwaTree;s&&(i.elements._uwaTree.prepareUpdateView(),i.elements._uwaTree.getTreeDocument().removeRoots());var n=[];e.each(t,function(e,t){var i=t.resourceParameterList,s={label:i.V_Name||i.name,dsModel:i,dsModelConnection:t||null,grid:{V_description:i.V_description||""},children:[]};n.push(s)}),i.addRootNodesToTable(n).then(function(t){var n=[];e.each(t,function(e,t){t.setState({state:"expanding"}),t.options&&t.options.dsModel&&t.options.dsModel.physicalid&&n.push({physicalid:t.options.dsModel.physicalid})});var r={QueryList:n,blnForceRefresh:a.blnForceRefresh||!1};i._getVisibleCols("DELWebResourceParameterFacet",r);o.getResourceParametersForList(r).then(function(s){i.elements._uwaTree&&i.elements._uwaTree.prepareUpdateView(),e.each(t,function(t,a){if(!a.options||!a.options.dsModel||!a.options.dsModel.physicalid)return delete a.options.children,void a.setState({state:"noChildren"});e.each(s,function(t,n){t&&t===a.options.dsModel.physicalid&&(e.each(n,function(t,s){s&&s.physicalid&&s.V_Name?i._addResourceParameterToResourceParameterList(a,s):e.log("invalid objResParam!")}),delete s[t])}),a.setState({state:a.hasChildren()?"expanded":"noChildren"})}),i.elements._uwaTree&&(i.hideShowColumn(),i.elements._uwaTree.reapplySortModel(),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))},function(e){i._displayNotificationMessage(e)}),s&&i.elements._uwaTree&&(i.elements._uwaTree.reapplySortModel(),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))},function(e){i._displayNotificationMessage(e)})}else i.elements._uwaTree&&(i.elements._uwaTree.destroy(),delete i.elements._uwaTree),i.elements.content.innerHTML="",i.elements.content.appendText(_.replace("No Associated {0}",{0:_.get("Resource Parameter Lists")})).addContent('<div class="create_helper" draggable="false"><i class="create_helper_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-plus"></i><h5 class="create_helper_txt">'+_.replace("Click New to Create a {0}",{0:_.get("Resource Parameter List")})+"</h5></div>");i.removeLoader()})},getTree:function(e,t,i){i||(i=window.alert),require({baseUrl:window.Configuration.webappsDir},["DS/DELWebInfrastructureControls/DELWebAjaxModel"],function(s){s.getTree(e).then(t,i)})},getClassNames:function(e){return"content_section-resource_parameter"+(e||"")},show:function(){return this.elements.TopBar.actionbar.show(),this._parent.apply(this,arguments)},hide:function(){return this.elements.TopBar.actionbar.hide(),this._parent.apply(this,arguments)},addLoader:function(){n.mask(this.elements.container)},removeLoader:function(){n.unmask(this.elements.container)},onAction:function(t){e.log("onAction = "+t);var i=[];switch(this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(i=this.elements._uwaTree.getNodesXSO().get()),t){case"add":this.onCreateParameterList(i);break;case"remove":this.onRemove(i);break;case"edit":this.onEdit(i);break;case"refresh":this.updateFacet({blnForceRefresh:!0});break;default:this._displayNotificationMessage("unknown actionId = "+t)}},onCreateParameterList:function(t){if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onCreateParameterList - _dlg.destroy = "+t.stack)}if(!t||t.length<=0){var i=this.getModel();this._dlg=new l(Object.assign({resource:{physicalid:i.get("objectId")}},this.options))}else if(1===t.length&&t[0].isRoot()){var s=t[0].options.dsModel;this._dlg=new c(Object.assign({parentModel:s},this.options))}else{var a=!1,n=null;e.each(t,function(e,t){if(a=!t.isRoot()){var i=t.getParent();n?a=n===i:n=i}return a})}},onEdit:function(t){if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onEdit - _dlg.destroy = "+t.stack)}if(t&&1===t.length)if(t[0].isRoot()){var i=this.getModel();this._dlg=new l(Object.assign({resource:{physicalid:i.get("objectId")},resourceParameterList:t[0].options.dsModel},this.options))}else this._dlg=new c(Object.assign({resourceParameter:t[0].options.dsModel},this.options))},onRemove:function(i){var s=this;if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onRemove - _dlg.destroy = "+t.stack)}var a=this.getModel(),n=_.get("Do you want to unassociate the {0} {1} from {2} {3}?"),r=[],l=[],c=null;if(1===i.length?i[0].isRoot()?(r=i,n=n.replace("{0}",_.get("Resource Parameter List")).replace("{1}",i[0].options.dsModel.V_Name)):(l=i,c=i[0].getParent(),n=_.get("Do you want to delete the {0} {1} from {2} {3}?").replace("{0}",_.get("Resource Parameter")).replace("{1}",i[0].options.dsModel.V_Name)):e.each(i,function(e,t){t.isRoot()?r.push(t):(null===c?c=t.getParent():c&&c!==t.getParent()&&(c=!1),l.push(t))}),r.length&&!l.length){if(!this.options||!this.options.resource||!this.options.resource.V_Name){this.options||(this.options={});var u={physicalid:a.get("objectId"),Minimum:["V_Name"]};return void o.getOneResource(u).then(function(t){t&&Array.isArray(t)&&t.length&&(t=t[0]),t&&t.V_Name?(s.options.resource=Object.assign(s.options.resource||{physicalid:a.get("objectId")},t),s.onRemove(i)):e.log("DELWebResourceParameterFacet::onRemove - invalid resource reference!")},function(e){s._displayNotificationMessage(e)})}n=n.replace("{0}",r.length).replace("{1}",_.get("Resource Parameter Lists")).replace("{2}",_.get("Resource")).replace("{3}",this.options.resource.V_Name)}else n=!r.length&&l.length?c?i.length>1?_.replace("Do you want to delete the selected {0} from their parent {1} {2}?",{0:_.get("Resource Parameters"),1:_.get("Resource Parameter List"),2:c.getLabel()}):n.replace("{2}",_.get("Resource Parameter List")).replace("{3}",c.getLabel()):_.replace("Do you want to delete the selected {0} from their parent {1}?",{0:_.get("Resource Parameters"),1:_.get("Resource Parameter Lists")}):_.get("Do you want to unassociate the selected objects?");var d={resizableFlag:!0,modalFlag:!0,title:_.replace("Unassociate {0}",{0:_.get("Resource Parameter List")}),immersiveFrame:this.getImmersiveFrame(),content:'<span class="icon-main wux-ui-3ds-alert"></span>'+n,buttons:{Cancel:new g({onClick:function(){s._dlg.destroy(),s._dlg=null}}),Save:new g({label:_.get("Unassociate"),disabled:!1,onClick:function(){var i=this;i.disabled=!0;var n=[],c=null,u={};r.length&&(u={resource:{physicalid:a.get("objectId")},resourceParameterListQueryList:[]},e.each(r,function(t,i){if(i&&i.options&&i.options.dsModel){var s={};i.options.dsModel.physicalid?s.physicalid=i.options.dsModel.physicalid:i.options.dsModel.OXID&&(s.OXID=i.options.dsModel.OXID),e.Object.isEmptyObject(s)||u.resourceParameterListQueryList.push(s)}}),c=o.unassociateResourceParameterList(u),n.push(c)),l.length&&(u={resourceParameterListphysicalid:null,resourceParameterQueryList:[]},e.each(l,function(t,i){var s=i.getParent();if(u&&(u.resourceParameterListphysicalid=s.dsModel.physicalid),i&&i.options&&i.options.dsModel){var a={};i.options.dsModel.physicalid?a.physicalid=i.options.dsModel.physicalid:i.options.dsModel.OXID&&(a.OXID=i.options.dsModel.OXID),e.Object.isEmptyObject(a)||u.resourceParameterQueryList.push(a)}}),c=o.unassociateResourceParameterFromList(u),n.push(c)),t.all(n).then(function(){s._displayNotificationMessage(_.get("Unassociation Successful"),{level:"success"}),s._dlg.destroy(),s._dlg=null},function(e){s._displayNotificationMessage(e),i.disabled=!1})}})}};!r.length&&l.length&&(d.title=_.replace("Delete {0}",{0:_.get("Resource Parameter")}),d.buttons.Save.label=_.get("Delete")),s._dlg=new f(d)},onNodeSelectChange:function(){var t=this,i=[];this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(i=this.elements._uwaTree.getNodesXSO().get());var s=t.elements.TopBar.actionbar._buttons.add;s&&s.element&&(s.element.disabled=!this.isAddHeaderEnabled(i)),i.length<=1?(e.each(["remove","edit"],function(e,a){(s=t.elements.TopBar.actionbar._buttons[a])&&s.element&&(s.element.disabled=i.length<=0)}),i&&i.length>0&&!i[0].isRoot()&&e.each(["add"],function(e,i){(s=t.elements.TopBar.actionbar._buttons[i]).element.disabled=!0})):e.each(["edit","add"],function(e,i){(s=t.elements.TopBar.actionbar._buttons[i]).element.disabled=!0})},isAddHeaderEnabled:function(t){!t&&this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(t=this.elements._uwaTree.getNodesXSO().get());var i=!t||t.length<=0||1===t.length&&t[0].isRoot();if(!i&&t.length>0){var s=!1,a=null;e.each(t,function(e,t){if(s=!t.isRoot()){var i=t.getParent();a?s=a===i:a=i}return s}),i=s&&a}return i},_initTopBar:function(){var t=this,i=[{name:"edit",icon:a.ACTION_SWITCH,disabled:!0,text:_.get("Edit"),handler:function(){t.onAction(this.name)}},{name:"remove",icon:"trash",disabled:!0,text:_.get("Remove"),handler:function(){t.onAction(this.name)}},{name:"add",icon:"plus",text:_.get("Add"),handler:function(){t.onAction(this.name)}},{name:"refresh",icon:"refresh",text:_.get("Refresh"),handler:function(){t.onAction(this.name)}}];this.elements.TopBar={},this.elements.TopBar.container=e.createElement("div",{class:this.getClassNames("-topbar"),styles:{height:"100%"}}).inject(this.elements.content),this.elements.TopBar.actionbar=new s({}).inject(this.elements.TopBar.container),this.elements.TopBar.actionbar.setButtons(i),this.elements.TopBar.container.dsModel=this.elements.TopBar.actionbar,this.onNodeSelectChange()},_displayNotificationMessage:function(t,i){d._getNotificationManager||(d._getNotificationManager=d.getNotificationManager,d.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),d.getNotificationManager()||d._manager||(d.setNotificationManager(u),d.setRemoveStackOnFirstTimeoutFlag(!0),d.setStackingPolicy(31)),i||(i={}),i.message||(i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=_.get(e.String.capitalize(i.level.toLowerCase()))),u.addNotif(i)},addTable:function(){var e=this;return new t(function(t,i){if(e.elements&&e.elements.container&&e.elements.content){if(!e.elements._uwaTree){var s={identifier:"DELWebResourceParameterFacet",cellSelection:"none",enableListSelection:!0,canMultiSelect:!0,isEditable:!1,cellDragEnabledFlag:!0,onDragStartCell:function(t,i){return e.onDragStartCell(t,i)},onDragOverCell:function(t,i){return e.onDragOverCell(t,i)},onDragEndCell:function(e){r.publishEvent("Dragging.stop",{ev:e})},onDropCell:function(t,i){return e.onDropCell(t,i)},columns:[{text:_.get("Title"),dataIndex:"tree",modelAttribute:"V_Name",getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.plmObjectType)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:"",updateModel:!1};var i="",s=t.nodeModel.options.dsModel.plmObjectType||t.nodeModel.options.dsModel.plmObjectTypeInternal||t.nodeModel.options.dsModel.V_discipline;if("DELResourcePrmINPUT"===s)i="("+_.get("Input")+") ";else if("DELResourcePrmOUTPUT"===s)i="("+_.get("Output")+") ";else if(e.elements._uwaTree)return e.elements._uwaTree.getCellDefaultTooltip(t);return{shortHelp:i+=t.nodeModel.getLabel(),updateModel:!1}}},{text:_.get("Description"),dataIndex:"V_description",visibleFlag:!1},{text:_.get("Dimension"),dataIndex:"parameter_type",visibleFlag:!1},{text:_.get("Values"),dataIndex:"V_Values",visibleFlag:!1},{text:_.get("Minimum"),dataIndex:"V_MinValue",allowUnsafeHTMLContent:!0,visibleFlag:!1,getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.minLimit||"NotSet"===t.nodeModel.options.dsModel.minLimit)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:_.get("Minimum"),updateModel:!1};var i=t.nodeModel.options.dsModel.minValue||t.nodeModel.options.dsModel.V_MinValue||0;return{shortHelp:"Excluded"===t.nodeModel.options.dsModel.minLimit?_.replace("Greater than (Exclusive) {0}",{0:i}):_.replace("Greater than or equal to (Inclusive) {0}",{0:i}),updateModel:!1}}},{text:_.get("Maximum"),dataIndex:"V_MaxValue",allowUnsafeHTMLContent:!0,visibleFlag:!1,getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.maxLimit||"NotSet"===t.nodeModel.options.dsModel.maxLimit)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:_.get("Maximum"),updateModel:!1};var i=t.nodeModel.options.dsModel.maxValue||t.nodeModel.options.dsModel.V_MaxValue||0;return{shortHelp:"Excluded"===t.nodeModel.options.dsModel.maxLimit?_.replace("Less than (Exclusive) {0}",{0:i}):_.replace("Less than or equal to (Inclusive) {0}",{0:i}),updateModel:!1}}}],roots:[]};s.treeDocument=new p,e.elements.content.innerHTML="",e.elements._uwaTree=new m(s).inject(e.elements.content),e.elements._uwaTree.getNodesXSO().onChange(function(){e.onNodeSelectChange.apply(e,arguments)}),e.elements._uwaTree.getContainingImmersiveFrame&&!e.elements._uwaTree._getContainingImmersiveFrame&&(e.elements._uwaTree._getContainingImmersiveFrame=e.elements._uwaTree.getContainingImmersiveFrame,e.elements._uwaTree.getContainingImmersiveFrame=function(){var e=this._getContainingImmersiveFrame();if(!e){var t=null,i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var s=0;!t&&s<i.length;++s)i[s]&&i[s].dsModel&&(t=i[s].dsModel);t&&t.getImmersiveFrame&&(e=t.getImmersiveFrame())}return e}),e._onContextualEvent&&(require({baseUrl:window.Configuration.webappsDir},["DS/DELWebAssetMgmt/controllers/resource/DataGridViewResourceContextualMenuBuilder"],function(t){e.elements._uwaTree._contextualMenuBuilder=new t(e.elements._uwaTree)}),e.elements._uwaTree.onContextualEvent=e._onContextualEvent),e.onResize()}t(e.elements._uwaTree)}else i(new Error("invalid container"))})},addRootNodesToTable:function(i,s){var a=this;return new t(function(t,n){if(!i||!Array.isArray(i)||i.length<=0)return n(new Error("invalid rootNodeOptionsArr")),!1;a.addTable().then(function(r){if(!r)return n(new Error("invalid table")),!1;s&&r.getTreeDocument()&&(r.placeholder="",r.getTreeDocument().removeRoots());var o=r.getTreeDocument(),l=o.getRoots(),c=[],u=window.widget.getUrl()||"";u&&(u=(u=u.substr(0,u.lastIndexOf("/"))).substr(0,u.lastIndexOf("/"))),a.elements._uwaTree.prepareUpdateView(),e.each(i,function(t,i){if(l){var s=!0;if(e.each(l,function(e,t){return t&&t.options&&t.options.dsModel&&i.dsModel&&(s=t.options.dsModel.physicalid!==i.dsModel.physicalid),s}),!s)return}i.icons||(i.icons=[u+"/DELWebInfrastructureControls/assets/icons/I_PPRRscPrmList.png"]);var a=new h(i);a.dsModel=i.dsModel,o.addRoot(a),c.push(a)}),a.hideShowColumn(),a.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),t(c)},n)})},getTreeNodeFromDsModel:function(t,i,s){if(!t)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid dsModel!"),null;if(i||(i=this.elements._uwaTree),!i)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid uwaTree!"),null;s&&e.Function.isFunction(s)||(s=function(e,t){return!(!e||!t)&&(!(!e.physicalid||!t.physicalid||e.physicalid!==t.physicalid)||!(!e.OXID||!t.OXID||e.OXID!==t.OXID))});var a=i.getTreeDocument();if(!a||!a.getAllDescendants)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid dataGridDocument!"),null;var n=null,r=a.getAllDescendants();return e.each(r,function(e,i){if(i&&i.options&&i.options.dsModel){var a=s(i.options.dsModel,t);!a&&i.options.dsModelConnection&&i.options.dsModelConnection.properties&&(a=s(i.options.dsModelConnection.properties,t)),a&&(n=i)}return!n}),n},getImmersiveFrame:function(){if(!this.immersiveFrame){var e=window.document.getElementsByClassName("wux-windows-immersive-frame");if(e&&e.length)for(var t=0;!this.immersiveFrame&&t<e.length;++t)e[t]&&e[t].dsModel&&(this.immersiveFrame=e[t].dsModel)}return this.immersiveFrame},onDragStartCell:function(t,i){var s=!1;if(i&&i.nodeModel&&i.nodeModel.options&&i.nodeModel.options.dsModel){t.dndInfos||(t.dndInfos=i);var a={protocol:"3DXContent",source:window.widget.data&&window.widget.data.appId?window.widget.data.appId:"DELFAMC_AP",version:"2.0",widgetId:window.widget.id,data:{items:[]}},n=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace");if(n&&0!==n.indexOf("ctx::"))n="ctx::"+n;else for(;n&&e.String.contains(n,"ctx::ctx::");)n=n.replace("ctx::ctx::","ctx::");var o=this.elements._uwaTree.getNodesXSO().get();if(o.length>0){var l=i.nodeModel.options.dsModel.plmBaseObjectType;l||(l=i.nodeModel.isRoot()?"DELResourceParameterListReference":"DELResourcePrm");var c="Resource Parameter";"DELResourceParameterListReference"===l&&(c="Resource Parameter List"),a.data.items.push({envId:window.widget.data.x3dPlatformId||"OnPremise",serviceId:"3DSpace",contextId:n,objectId:i.nodeModel.options.dsModel.physicalid,objectType:l,displayName:i.nodeModel.options.dsModel.V_Name,displayType:c}),e.each(o,function(e,t){t&&t.options&&t.options.dsModel&&i.nodeModel.options.dsModel.physicalid!==t.options.dsModel.physicalid&&((l=t.options.dsModel.plmBaseObjectType)||(l=t.isRoot()?"DELResourceParameterListReference":"DELResourcePrm"),c="Resource Parameter","DELResourceParameterListReference"===l&&(c="Resource Parameter List"),a.data.items.push({envId:window.widget.data.x3dPlatformId||"OnPremise",serviceId:"3DSpace",contextId:n,objectId:t.options.dsModel.physicalid,objectType:l,displayName:t.options.dsModel.V_Name,displayType:c}))})}t.dataTransfer.setData("text/searchitems",window.UWA.Json.encode(a)),s=a.data.items.length>0}return s&&i.nodeModel.isRoot()&&r.publishEvent("Dragging.start",{ev:t}),s},_onColumnVisibleStateChange:function(t){if(t&&t.options&&t.options.columnID&&t.options.visibleState){var i=t.dsModel||this.elements._uwaTree;if(i){var s=i.getColumnOrGroup(t.options.columnID),a=[];if(s&&s.dataIndex&&a.push(s.modelAttribute||s.dataIndex),a&&a.length){var n=i.getTreeDocument().getAllDescendants()||[],r=[],o={};i.prepareUpdateView(),e.each(n,function(t,s){if(s&&s.options&&s.options.dsModel){var n=!1;e.each(a,function(e,t){if(!(t in s.options.grid)){if(n=!0,!o[t]){var a=i.getColumnOrGroup(t);a&&!a.allowUnsafeHTMLContent&&(o[t]=a,o[t].allowUnsafeHTMLContent=!0)}s.options.grid[t]='<img src="'+window.Configuration.webappsDir+'/DELWebAssetMgmt/assets/loading-small.gif" class="loading" title="'+_.get("Loading...")+'" />'}}),n&&r.push(s.options.dsModel)}}),i.pushUpdateView({updateCellContent:!0},!0);this.getModel().get("objectId")}}else steal.dev.log(this.constructor.fullName+"::_onColumnVisibleStateChange - invalid uwaTree")}},onDragOverCell:function(t,i){var s=!1,a=null;i&&i.nodeModel&&i.nodeModel.options&&i.nodeModel.options.dsModel&&(a=i.nodeModel.isRoot()?i.nodeModel.options.dsModel.physicalid:i.nodeModel.getParent().options.dsModel.physicalid);var n=i&&(i.draggedNodes||i.droppedNodes);return n&&Array.isArray(n)&&i.nodeModel&&n.indexOf(i.nodeModel)<0&&e.each(n,function(e,t){return t&&t.options&&t.options.dsModel&&t.options.dsModel.plmBaseObjectType?(s=["DELResourcePrm","DELResourceParameter","DELResourcePrmAbstract","DELResourcePrmINPUT","DELResourcePrmOUTPUT"].indexOf(t.options.dsModel.plmBaseObjectType)>=0)&&(s=t.isRoot()?a!==t.options.dsModel.physicalid:a!==t.getParent().options.dsModel.physicalid):s=!1,s}),s&&t.preventDefault(),s},onDropCell:function(e,t){var i=this.onDragOverCell(e,t);if(i){var s=null;t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.dsModel&&(s=t.nodeModel.isRoot()?t.nodeModel.options.dsModel.physicalid:t.nodeModel.getParent().options.dsModel.physicalid),s&&this.displayCopyMoveResourceParameterDialog(e,t)}return i},hideShowColumn:function(t){var i=this;if(i.elements._uwaTree&&i.elements._uwaTree.columns){if(!t)return i._hideShowColumnAnimationFrame&&window.cancelAnimationFrame(i._hideShowColumnAnimationFrame),void(i._hideShowColumnAnimationFrame=window.requestAnimationFrame(function(){delete i._hideShowColumnAnimationFrame,i.elements._uwaTree.prepareUpdateView(),e.each(i.elements._uwaTree.columns,function(e,t){!t||!t.dataIndex||["tree","V_description"].indexOf(t.dataIndex)>=0||i.hideShowColumn(t.dataIndex)}),i.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0)}));var s=i.elements._uwaTree.getTreeDocument().getAllDescendants();if(s&&!(s.length<=0)){var a=!0;e.each(s,function(e,i){return i&&i.isVisible()&&i.options&&i.options.grid&&i.options.grid[t]&&["tree","V_description","parameter_type","V_Values","V_MinValue","V_MaxValue"].indexOf(t)>=0&&(a=!1),a});var n=i.elements._uwaTree.getColumnOrGroup(t);if(!n||"visibleFlag"in n&&!(n.visibleFlag===a&&["tree","V_description","parameter_type","V_Values","V_MinValue","V_MaxValue"].indexOf(t)>=0)){if(["tree","V_description","parameter_type","V_Values","V_MinValue","V_MaxValue"].indexOf(t)<0&&"visibleFlag"in n){i.elements._uwaTree.prepareUpdateView();var r=window.localStorage.getItem("wux-collectionView-dataGridView");r&&(r=JSON.parse(r))&&r.DELWebResourceParameterFacet&&r.DELWebResourceParameterFacet.columnsVisibleFlag&&(n.visibleFlag=t in r.DELWebResourceParameterFacet.columnsVisibleFlag&&r.DELWebResourceParameterFacet.columnsVisibleFlag[t]),i.elements._uwaTree.invalidateLayout(),i.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0)}}else i.elements._uwaTree.prepareUpdateView(),n.visibleFlag=!a,i.elements._uwaTree.invalidateLayout(),i.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0);n.visibleFlag&&i.elements._uwaTree.sizeColumnToFit(t,{computeColumnHeader:!0})}}},displayCopyMoveResourceParameterDialog:function(i,s){var a=this;if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::displayCopyMoveResourceParameterDialog - _dlg.destroy = "+t.stack)}var n=s&&(s.draggedNodes||s.droppedNodes);if(!n||!Array.isArray(n)||!n.length)return e.log("displayCopyMoveResourceParameterDialog - invalid draggedNodes!"),!1;var r=null;if(s&&s.nodeModel&&s.nodeModel.options&&s.nodeModel.options.dsModel&&(r=s.nodeModel.isRoot()?s.nodeModel.options.dsModel.physicalid:s.nodeModel.getParent().options.dsModel.physicalid),!r)return e.log("displayCopyMoveResourceParameterDialog - invalid drop target!"),!1;var l='<span class="icon-main wux-ui-3ds-alert"></span>'+_.get("Would you like to Copy or Move these items?")+'\n<table style="margin:1em auto;text-align:left;line-height:1.2em;"><tr><td style="padding-right:.5em;font-weight:bold;">'+_.get("Copy")+":</td><td>"+_.replace("Create a new {0} under the target and leave the old one unmodified.",{0:_.get("Resource Parameter")})+'</td></tr><tr><td style="padding-right:.5em;font-weight:bold;">'+_.get("Move")+":</td><td>"+_.replace("Create a new {0} under the target and delete the old one.",{0:_.get("Resource Parameter")})+"</td></tr></table>",c={resizableFlag:!0,modalFlag:!0,title:_.get("Copy or Move Confirmation"),immersiveFrame:this.getImmersiveFrame(),content:l,buttons:{Cancel:new g({onClick:function(){a._dlg.destroy(),a._dlg=null}}),Save:new g({label:_.get("Move"),onClick:function(t){a._dlg.buttons.Save.disabled=!0,a._dlg.buttons.Ok.disabled=!0,this&&this.tagName&&(a._dlg.buttons.Save.icon=window.widget.getUrl().substr(0,window.widget.getUrl().lastIndexOf("/"))+"/../DELWebInfrastructure/DSCommon/graphics/loading-small.gif"),a._dlg.buttons.Ok.onClick(t,function(){var t=[];e.each(n,function(e,i){i.options.dsModel.rplPhysicalid!==r&&t.push({physicalid:i.options.dsModel.physicalid})});var i=function(){a._displayNotificationMessage(_.get("Move Successful"),{level:"success"}),a._dlg.destroy(),a._dlg=null};if(t.length>0){var s={resourceParameterQueryList:t};o.unassociateResourceParameterFromList(s).then(i,function(e){a._displayNotificationMessage(e),a._dlg.buttons.Save.disabled=!1,a._dlg.buttons.Ok.disabled=!1,a._dlg.buttons.Save.icon=""})}else i()})}}),Ok:new g({label:_.get("Copy"),onClick:function(i,s,l){a._dlg.buttons.Ok.disabled=!0,a._dlg.buttons.Save.disabled=!0,this&&this.tagName&&(a._dlg.buttons.Ok.icon=window.widget.getUrl().substr(0,window.widget.getUrl().lastIndexOf("/"))+"/../DELWebInfrastructure/DSCommon/graphics/loading-small.gif");var c=[];e.each(n,function(t,i){var s=e.clone(i.options.dsModel);delete s.physicalid,delete s.rplPhysicalid,s.target_physicalid=r,c.push(o.createResourceParameter(s))}),s||(s=function(){a._displayNotificationMessage(_.get("Copy Successful"),{level:"success"}),a._dlg.destroy(),a._dlg=null}),l||(l=function(e){a._displayNotificationMessage(e),a._dlg.buttons.Ok.disabled=!1,a._dlg.buttons.Save.disabled=!1,a._dlg.buttons.Ok.icon=""}),t.all(c).then(s,l)}})}};a._dlg=new f(c),a._dlg.buttons.Save.emphasize="secondary"},_initEventHandlers:function(){var t=this;this._eventSubscriptionTokens||(this._eventSubscriptionTokens=[]),e.each(this,function(i,s){if(s&&e.Function.isFunction(s)&&i.endsWith(" subscribe")){var a=i.replace(" subscribe","").trim(),n=null;(n=t.options&&t.options.modelEvents?t.options.modelEvents.subscribe({event:a},function(e){s.apply(t,[a,e])}):v.subscribe({event:a},function(e){s.apply(t,[a,e])}))&&t._eventSubscriptionTokens.push(n)}})},_addResourceParameterToResourceParameterList:function(t,i){var s=this;if(t){if(t.options.dsModel){t.options.dsModel.children?t.options.dsModel.children&&e.Object.isPlainObject(t.options.dsModel.children)&&(t.options.dsModel.children=Object.values(t.options.dsModel.children)):t.options.dsModel.children=[];var a=t.getChildren(),n=null;if(a&&a.length)for(var l=0;l<a.length;++l){var c=a[l];c&&c.options&&c.options.dsModel}if(!n){var u="";if(i&&i.V_Values&&"string"==typeof i.V_Values){i.V_Values=JSON.parse(i.V_Values);var d;d=Object.size(i.V_Values),e.each(i.V_Values,function(e,t){t&&t.tree&&""!==t.tree?(u+=t.tree,e+1<d&&(u+=", ")):"number"==typeof t?(t=t.toString())&&""!==t&&(u+=t,e+1<d&&(u+=", ")):"string"==typeof t&&t&&""!==t&&(u+=t,e+1<d&&(u+=", "))}),i.V_Values=u}t.options.dsModel.children.push(e.clone(i)),s.elements._uwaTree.prepareUpdateView(),o.getMagnitudes().then(function(l){if(a=t.getChildren(),s._listOfMagnitudes=l,!i.parameter_type&&i.interfaces&&i.interfaces.length&&e.each(i.interfaces,function(e,t){t.indexOf("DELRscPrmIOValueAbstract")>=0&&(i.parameter_type=t[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""),i.magnitude=i.parameter_type)}),i.parameter_type){i.parameter_type;var c="DELResourcePrmINPUT"===i.plmBaseObjectType||"DELResourcePrmINPUT"===i.plmObjectTypeInternal?"move-to":"move-from";if(n={label:i.V_Name||i.name,dsModel:i,icons:[c],grid:{V_description:i.V_description||"",physicalid:i.physicalid,parameter_type:s._getParamTypeLabel(i),V_MinValue:s._getMinMaxLabelFromValue(i,!1),V_MaxValue:s._getMinMaxLabelFromValue(i,!0),V_Values:i.V_Values}},(!a||a.length<=0)&&(t.setState({state:"expanded"}),t.options.children=[]),i){if(n&&n.dsModel&&n.grid&&(n.grid=Object.assign(n.grid,n.dsModel),n.grid.parameter_type=s._getParamTypeLabel(i),n.grid.V_MinValue=s._getMinMaxLabelFromValue(i,!1),n.grid.V_MaxValue=s._getMinMaxLabelFromValue(i,!0),i.extensions)){var u=i.plmObjectType||i.plmBaseObjectType||i.V_discipline,d=null;r.getExtensions({class_name:[u,"DELResourcePrmAbstract"],blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then(function(t){d=t,e.each(i.extensions,function(t,i){e.each(i,function(a,r){d[t]&&e.each(d[t],function(t,l){l&&l.properties&&e.each(l.properties,function(t,l){if(l.name===a){var c=[];if(e.each(s.elements._uwaTree.columns,function(e,t){t&&t.dataIndex&&c&&c.indexOf(t.dataIndex)<0&&c.push(t.dataIndex)}),l&&"dimension"in l&&""!==l.dimension)o.getMagnitudes({filter:"dimensionName+eq+"+l.dimension,magnitude:l.dimension}).then(function(e){if("None"!==l.getUIAccess){s.elements._uwaTree.prepareUpdateView();var t=i[a+".displayValue"]||r;if(e&&e[l.dimension]&&e[l.dimension].Units&&(t=t+" "+(s._getAttributeValue(e[l.dimension].Units,"Name",l.preferred_unit||e[l.dimension].MKSUnit)||l.preferred_unit||e[l.dimension].MKSUnit)),c.indexOf(a)<0){var o={};o.dataIndex=a,o.text=l.nlsName||l.name,o.visibleFlag=s._getVisibleAttributeValue(s.elements._uwaTree.columns,"dataIndex",a)||!1,s.elements._uwaTree.addColumnOrGroup(o)}n.grid[l.name]=t,s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}});else if("None"!==l.getUIAccess){if(s.elements._uwaTree.prepareUpdateView(),c.indexOf(a)<0){var u={};u.dataIndex=a,u.text=l.nlsName||l.name;var d=!1,m=window.localStorage.getItem("wux-collectionView-dataGridView");m&&(m=JSON.parse(m))&&m.DELWebResourceParameterFacet&&m.DELWebResourceParameterFacet.columnsVisibleFlag&&(d=a in m.DELWebResourceParameterFacet.columnsVisibleFlag&&m.DELWebResourceParameterFacet.columnsVisibleFlag[a]),u.visibleFlag=d||s._getVisibleAttributeValue(s.elements._uwaTree.columns,"dataIndex",a)||!1,s.elements._uwaTree.addColumnOrGroup(u)}n.grid[l.name]=r,s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}})})})})})}t.addChild(n),"expanded"===t.getState()&&s.hideShowColumn()}}s.elements._uwaTree.pushUpdateView({updateCellContent:!0},!0)})}}}else window.steal.dev.log(s.constructor.fullName+":: - unable to locate the group in the tree!")},_getParamTypeLabel:function(t){var i=t.magnitude||t.parameter_type,s=i;if("Text"===i||"Integer"===i||"TextValue"===i||"IntegerValue"===i)s=i.replace("Value","");else if(this._listOfMagnitudes&&this._listOfMagnitudes[i]){t.magnitude||(t.magnitude=i),s=this._listOfMagnitudes[i].NLS||i;var a=t.units;a&&this._listOfMagnitudes[i].Units&&e.each(this._listOfMagnitudes[i].Units,function(e,t){return!t||t.Name!==a&&t.label!==a||(a=t.NLSName||a,!1)}),s+=" ("+a+")"}return s},_getAttributeValue:function(e,t,i){for(let s=0;s<e.length;s++)if(e[s][t]===i)return e[s].NLSName;return null},_getVisibleAttributeValue:function(e,t,i){for(let s=0;s<e.length;s++)if(e[s][t]===i)return e[s].visibleFlag;return null},_getMinMaxLabelFromValue:function(t,i){var s="";if(!t)return s;var a=0,n="NOTSET";if(i?(a=t.maxValue||t.V_MaxValue||0,n=(t.maxLimit||"NotSet").toUpperCase()):(a=t.minValue||t.V_MinValue||0,n=(t.minLimit||"NotSet").toUpperCase()),"NOTSET"===n)return s;var r=t.magnitude||t.parameter_type,o=t.units;return o&&this._listOfMagnitudes&&this._listOfMagnitudes[r]&&this._listOfMagnitudes[r].Units&&(t.magnitude||(t.magnitude=r),e.each(this._listOfMagnitudes[r].Units,function(e,t){return!t||t.Name!==o&&t.label!==o||(o=t.NLSName||o,!1)})),i?(s="EXCLUDED"===n?"<":"&le;",s+=" "+a,s+=" "+o):(s=a+" "+o+" ",s+="EXCLUDED"===n?"<":"&le;"),s},_getMaxLabelFromValue:function(t,i){var s="";if(!t)return s;if(!i)return s;var a,n;a=i.maxValue||t.maxValue||0,n=(i.maxLimit||t.maxLimit).toUpperCase();var r=t.magnitude||t.parameter_type,o=i.units||t.units;return o&&this._listOfMagnitudes&&this._listOfMagnitudes[r]&&this._listOfMagnitudes[r].Units&&(t.magnitude||(t.magnitude=r),e.each(this._listOfMagnitudes[r].Units,function(e,t){return!t||t.Name!==o&&t.label!==o||(o=t.NLSName||o,!1)})),"NOTSET"===n?s:(s="EXCLUDED"===n?"<":"&le;",s+=" "+a,s+=" "+o)},_getVisibleCols:function(t,i){var s=[];if(this&&this.elements&&this.elements._uwaTree&&this.elements._uwaTree.columns&&this.elements._uwaTree.columns.length&&e.each(this.elements._uwaTree.columns,function(e,t){!t||!t.visibleFlag&&"visibleFlag"in t||s.push(t.modelAttribute||t.dataIndex)}),!s||s.length<=0){s=null;var a=JSON.parse(window.localStorage.getItem("wux-collectionView-dataGridView"));a&&e.each(a,function(e,i){e===t&&i.columnsVisibleFlag&&Object.size(i.columnsVisibleFlag)>0&&(s=Object.keys(i.columnsVisibleFlag))})}return s},_getMinLabelFromValue:function(t,i){var s="";if(!t)return s;var a,n;a=i.minValue||t.minValue||0,n=(i.minLimit||t.minLimit).toUpperCase();var r=t.magnitude||t.parameter_type,o=i.units||t.units;return o&&this._listOfMagnitudes[r].Units&&e.each(this._listOfMagnitudes[r].Units,function(e,t){return!t||t.Name!==o&&t.label!==o||(o=t.NLSName||o,!1)}),"NOTSET"===n?s:(s=a+" "+o+" ",s+="EXCLUDED"===n?"<":"&le;")},_getUpdatedParamTypeLabel:function(t,i){var s=t.magnitude||t.parameter_type,a=s;if("Text"===s||"Integer"===s||"TextValue"===s||"IntegerValue"===s)a=s.replace("Value","");else if(this._listOfMagnitudes&&this._listOfMagnitudes[s]){t.magnitude||(t.magnitude=s),a=this._listOfMagnitudes[s].NLS||s;var n=i.units;n&&this._listOfMagnitudes[s].Units&&e.each(this._listOfMagnitudes[s].Units,function(e,t){return!t||t.Name!==n&&t.label!==n||(n=t.NLSName||n,!1)}),a+=" ("+n+")"}return a},"ResourceParameterList.updated subscribe":function(t,i){if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameterList.updated"),i&&i.physicalid&&i.ChangedAttributes&&e.Object.isPlainObject(i.ChangedAttributes)&&!e.Object.isEmptyObject(i.ChangedAttributes)){var s=this.getTreeNodeFromDsModel(i);s&&(this.elements._uwaTree.prepareUpdateView(),s.options.grid=Object.assign(s.options.grid,i.ChangedAttributes),s.options.dsModel=Object.assign(s.options.dsModel,i.ChangedAttributes),i.ChangedAttributes.V_Name&&s.setLabel(i.ChangedAttributes.V_Name),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}else e.log("DELWebResourceParameterFacet::ResourceParameterList.updated - invalid objData")},"ResourceParameterList.associated subscribe":function(t,i){var s=this;if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameterList.associated"),i&&i.resourceParameterList&&i.resource&&i.resource.physicalid){var a=s.getModel();if(!a||a.get("objectId")!==i.resource.physicalid)return!1;o.getOneResourceParameterList(Object.assign({Minimum:["V_Name","V_description","physicalid"]},i.resourceParameterList)).then(function(e){var t={label:e.V_Name||e.name,dsModel:e,dsModelConnection:i||null,grid:{V_description:e.V_description||""}};s.addRootNodesToTable([t]).then(function(){},function(e){s._displayNotificationMessage(e)})},function(e){s._displayNotificationMessage(e)})}else e.log("DELWebResourceParameterFacet::ResourceParameterList.associated - invalid objConnection")},"ResourceParameterList.unassociated subscribe":function(t,i){if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameterList.unassociated"),i&&(i.resourceParameterList||i.properties)&&i.resource&&i.resource.physicalid){var s=this.getModel();if(!s||s.get("objectId")!==i.resource.physicalid)return!1;var a=this.getTreeNodeFromDsModel(i.properties||i.resourceParameterList);a&&(this.elements._uwaTree.prepareUpdateView(),a.remove(),this.hideShowColumn(),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),this.onNodeSelectChange()}else e.log("DELWebResourceParameterFacet::ResourceParameterList.unassociated - invalid objConnection")},"ResourceParameter.updated subscribe":function(t,i){var s=this;if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameter.updated"),!i||!i.physicalid||!i.attributes&&!i.extensions||e.Object.isEmptyObject(i.attributes)&&e.Object.isEmptyObject(i.extensions)||!e.Object.isPlainObject(i.attributes))e.log("DELWebResourceParameterFacet::ResourceParameter.updated - invalid objData");else{var a=this.getTreeNodeFromDsModel(i);if(a){if(s.elements._uwaTree.prepareUpdateView(),i.attributes&&("minLimit"in i.attributes||"minValue"in i.attributes||i.attributes.units)&&(i.attributes.V_MinValue=s._getMinLabelFromValue(a.options.dsModel,i.attributes)),i.attributes&&("maxLimit"in i.attributes||"maxValue"in i.attributes||i.attributes.units)&&(i.attributes.V_MaxValue=s._getMaxLabelFromValue(a.options.dsModel,i.attributes)),i.attributes&&i.attributes.units&&(i.attributes.parameter_type=s._getUpdatedParamTypeLabel(a.options.dsModel,i.attributes)),a.options.grid=Object.assign(a.options.grid,i.attributes),a.options.dsModel=Object.assign(a.options.dsModel,i.attributes),i.extensions&&!e.Object.isEmptyObject(i.extensions)&&(a.options.dsModel.extensions=e.Object.extend(!0,a.options.dsModel.extensions||{},i.extensions)),i.extensionsToRemove&&Array.isArray(i.extensionsToRemove)&&i.extensionsToRemove.length&&e.each(i.extensionsToRemove,function(t,i){a.options.dsModel.extensions&&a.options.dsModel.extensions[i]&&delete a.options.dsModel.extensions[i],a.options.dsModel.interfaces&&e.each(a.options.dsModel.interfaces,function(e,t){return!(t&&Array.isArray(t)&&t.indexOf(i)>=0)||(a.options.dsModel.interfaces.splice(e,1),!1)})}),i.attributes.V_Name&&a.setLabel(i.attributes.V_Name),s.hideShowColumn(),a.options.dsModel.extensions){var n=a.options.dsModel.plmObjectType||a.options.dsModel.plmBaseObjectType||a.options.dsModel.V_discipline,l=null;r.getExtensions({class_name:[n,"DELResourcePrmAbstract"],blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then(function(t){l=t,e.each(a.options.dsModel.extensions,function(t,n){e.each(n,function(n,r){l[t]&&e.each(l[t],function(l,c){c&&c.properties&&e.each(c.properties,function(l,c){if(c.name===n){var u=[];if(e.each(s.elements._uwaTree.columns,function(e,t){t&&t.dataIndex&&u&&u.indexOf(t.dataIndex)<0&&u.push(t.dataIndex)}),c&&"dimension"in c&&""!==c.dimension)o.getMagnitudes({filter:"dimensionName+eq+"+c.dimension,magnitude:c.dimension}).then(function(e){if("None"!==c.getUIAccess){var r="";if(i.ChangedAttributes.extensions[t][n+".displayValue"]?r=i.ChangedAttributes.extensions[t][n+".displayValue"]:i.ChangedAttributes.extensions[t][n]&&(r=i.ChangedAttributes.extensions[t][n]),e&&e[c.dimension]&&e[c.dimension].Units&&(r=r+" "+(s._getAttributeValue(e[c.dimension].Units,"Name",c.preferred_unit||e[c.dimension].MKSUnit)||c.preferred_unit||e[c.dimension].MKSUnit)),s.elements._uwaTree.prepareUpdateView(),u.indexOf(n)<0){var o={};o.dataIndex=n,o.text=c.nlsName||c.name;var l=!1,d=window.localStorage.getItem("wux-collectionView-dataGridView");d&&(d=JSON.parse(d))&&d.DELWebResourceParameterFacet&&d.DELWebResourceParameterFacet.columnsVisibleFlag&&(l=n in d.DELWebResourceParameterFacet.columnsVisibleFlag&&d.DELWebResourceParameterFacet.columnsVisibleFlag[n]),o.visibleFlag=l||s._getVisibleAttributeValue(s.elements._uwaTree.columns,"dataIndex",n)||!1,s.elements._uwaTree.addColumnOrGroup(o)}a.options.grid[c.name]=r,s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}});else if("None"!==c.getUIAccess){if(s.elements._uwaTree.prepareUpdateView(),u.indexOf(n)<0){var d={};d.dataIndex=n,d.text=c.nlsName||c.name,d.visibleFlag=s._getVisibleAttributeValue(s.elements._uwaTree.columns,"dataIndex",n)||!1,s.elements._uwaTree.addColumnOrGroup(d)}a.options.grid[c.name]=r,s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}})})})})})}s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}},"ResourceParameter.associated subscribe":function(t,i){var s=this;if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameter.associated"),i&&i.properties&&i.resourceParameterList&&i.resourceParameterList.physicalid){if(s.elements._uwaTree&&i.properties&&i.resourceParameterList){var a=s.elements._uwaTree.getTreeDocument();if(!a)return;var n=a.getRoots(),r=null,o=null,l=[];l.push(i.properties);var c=[];c.push(i.resourceParameterList),e.each(l,function(t,i){e.each(c,function(e,t){if(n&&n.length)for(var a=0;!r&&a<n.length;++a)if((o=n[a])&&o.options&&o.options.dsModel&&t.physicalid===o.options.dsModel.physicalid){r=o,s._addResourceParameterToResourceParameterList(r,i);break}})})}}else e.log("DELWebResourceParameterFacet::ResourceParameter.associated - invalid objConnection")},"ResourceParameter.unassociated subscribe":function(t,i){if(!i&&t&&"string"!=typeof t&&(i=t,t="ResourceParameter.unassociated"),i&&(i.resourceParameterList||i.properties)){var s=this.getTreeNodeFromDsModel(i.properties);s&&(this.elements._uwaTree.prepareUpdateView(),s.remove(),this.hideShowColumn(),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),this.onNodeSelectChange()}else e.log("DELWebResourceParameterFacet::ResourceParameter.unassociated - invalid objConnection")}})}),window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterPrefDialog",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Popup","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/CollectionView/CollectionViewStatusBar","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/Utilities/TouchUtils","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],function(e,t,i,s,a,n,r,o,l,c,u,d,m,p,h,f,g,v,_){"use strict";return a.inherit({name:"DELWebResourceParameterPrefDialog",_defaultMagnitudes:null,_unitsDropdown:{},_changedAttributesObj:null,_dimensionList:null,publishedProperties:{title:{defaultValue:_.get("Magnitude Preferences"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,530),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/2,900),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e?this.options=Object.assign(this.options||{},e):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){var e=this._createDlg||this.options&&this.options._createDlg;delete this._createDlg,this.options&&(delete this.options._createDlg,this.options.onClose&&this.options.onClose.call(this)),this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this._parent();var t=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var s=0;!this.immersiveFrame&&s<i.length;++s)i[s]&&i[s].dsModel&&(this.immersiveFrame=i[s].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv&&this.elements._modalDiv.inject(window.widget.body),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),!this.options.flippable&&"flippable"in this.options||(this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._createDlg||this.options._createDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in")),this.buttons={Ok:new n({label:_.get("Apply"),onClick:function(e){t.applyClicked(e)}}),Save:new n({label:_.get("Done"),onClick:function(e){t.doneClicked(e)}}),Cancel:new n({onClick:function(){t.hideDialog();t.showCreateDialog({blnForceRefresh:!0})}})},this.buttons.Ok.emphasize="secondary",this.elements.mainDiv.innerHTML='<div class="preferencesDlgDiv"><table><tr class="default_magnitudes mainRow"><td>'+_.get("Default Magnitudes")+'</td><td class="inputField"><table><tbody><tr><td><select class="defaultMagnitudesList" name="defaultMagnitudesList" size="5" style="width:100%;"></select></td></tr><tr class="icon_toolbar"><td><div style="white-space:nowrap;"><div class="opt_DefaultMagnitudes"></div><div class="opt_DefaultMagnitudes_icons"><div style="padding-left:10px;" class="add_default_magnitude_icon"></div><div class="delete_default_magnitude_icon" style="padding-left:10px;"></div></div></div></td></tr></tbody></table></td></tr><tr class="mainRow default_unit_title"><td colspan="2" style="position:relative;">'+_.get("Default Units")+'</td></tr><tr class="default_units mainRow"><td class="inputField" colspan="2"><table><tbody class="display_units_body" colspan="2"></tbody></table></td></tr></table></div>',this._addDefaultMagnitudeIcon=new n({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,icon:{iconName:"plus",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".add_default_magnitude_icon")),this._deleteDefaultMagnitude=new n({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,icon:{iconName:"minus",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".delete_default_magnitude_icon")),this._addDefaultMagnitudeIcon.getContent().addEventListener("buttonclick",function(e){t.onAddMagnitude(e)}),this._deleteDefaultMagnitude.getContent().addEventListener("buttonclick",function(e){t.onDeleteMagnitude(e)}),this._addDefaultMagnitudesElements(),this._addDefaultUnitsTable(),this._initEventHandlers()},_addDefaultMagnitudesElements:function(){var t=this,s=e.extendElement(t.elements.mainDiv.querySelector("tr select.defaultMagnitudesList"));s.addClassName("loading"),i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(i){if(i||(i.INTEGER={Name:"Integer",NLS:_.get("Integer")},i.STRING={Name:"String",NLS:_.get("Text")}),i=Object.keys(i).sort().reduce(function(e,t){return e[t]=i[t],e},{}),t._defaultMagnitudes=i,e.each(i,function(e,t){s.options[s.options.length]=new Option(t.NLS,t.Name)}),e.extendElement(s).removeClassName("loading"),v.getTouchMode()){var a=[{labelItem:"-- "+_.get("Current Default Magnitudes")+" --",valueItem:""}];e.each(s.options,function(e,t){a.push({labelItem:t.innerText,valueItem:t.value})});var n=new l({elementsList:a,popupSizeAdjustPolicy:c.SizeAdjustPolicyEnum.AdjustToVisibleContents,enableSearchFlag:!1,selectedIndex:-1}).inject(s.parentElement);s.hide(),n.elements.container.setStyle("width","100%"),n.addEventListener("change",function(e){var i=e.dsModel.value;s.value=i,t._deleteDefaultMagnitude.disabled=!i})}},function(e){t._displayNotificationMessage(e)}),t.elements.mainDiv.querySelector("select.defaultMagnitudesList").addEventListener("change",function(e){var i=e.target.value;t._deleteDefaultMagnitude.disabled=!i})},onAddMagnitude:function(){this._changedAttributesObj||(this._changedAttributesObj={});var t=this.elements._optionalMagnitudesDropdown.currentValue,i=this.elements._optionalMagnitudesDropdown.currentLabel;this._changedAttributesObj.preference_DimensionsList=this._defaultMagnitudes,this._dimensionList=this.elements._optionalMagnitudesDropdown.currentValue.trim().replaceAll("_","")+"Parameter";var s=e.extendElement(this.elements.mainDiv.querySelector(".defaultMagnitudesList"));if(this._changedAttributesObj.preference_DimensionsList&&!this._changedAttributesObj.preference_DimensionsList[t]){this._changedAttributesObj.preference_DimensionsList[t]={};var a=e.createElement("option");if(a.value=t,a.innerHTML=i,s.appendChild(a),v.getTouchMode()){var n=s.parentElement.querySelector(".wux-controls-combobox");if(n&&n.dsModel&&n.dsModel.elementsList){var r=n.dsModel.elementsList;r.push({labelItem:a.innerHTML,valueItem:a.value}),n.dsModel.elementsList=[],n.dsModel.elementsList=r}}}if(this.elements._optionalMagnitudesDropdown){var o=this.elements._optionalMagnitudesDropdown.elementsList,l=this._getSelectedIndex(t,o);o&&o.splice(l,1),o=o.sort(function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0}),this.elements._optionalMagnitudesDropdown&&this.elements._optionalMagnitudesDropdown.elements&&this.elements._optionalMagnitudesDropdown.elements&&(this.blnPreventSelectedIndexUpdate=!0,this.elements._optionalMagnitudesDropdown.elementsList=[],this.elements._optionalMagnitudesDropdown.placeholder=" --- "+_.get("Select")+" --- ",this.elements._optionalMagnitudesDropdown.selectedIndex=-1,this.elements._optionalMagnitudesDropdown.elementsList=o,this.blnPreventSelectedIndexUpdate=!1,this._addDefaultMagnitudeIcon.disabled=!0)}},onDeleteMagnitude:function(){this._changedAttributesObj||(this._changedAttributesObj={});var t=e.extendElement(this.elements.mainDiv.querySelector(".defaultMagnitudesList"));if(1!==t.length){var i=null;this._changedAttributesObj.preference_DimensionsList=this._defaultMagnitudes;var s=t.options[t.selectedIndex];if(s){for(var a=0;a<t.length;a++)t.options[a].value===s.value&&this._changedAttributesObj.preference_DimensionsList&&(this._deleteDefaultMagnitude.disabled=!1,delete this._changedAttributesObj.preference_DimensionsList[t.options[a].value],t.options[a].remove());if(v.getTouchMode()){var n=t.parentElement.querySelector(".wux-controls-combobox");if(n&&n.dsModel&&n.dsModel.elementsList&&(i=this._getSelectedIndex(s.value,n.dsModel.elementsList))>0){var r=n.dsModel.elementsList;r.splice(i,1),n.dsModel.elementsList=[],n.dsModel.elementsList=r}}}if(this.elements._optionalMagnitudesDropdown){var o=this.elements._optionalMagnitudesDropdown.elementsList;(i=this._getSelectedIndex(s.value,o))||o.push({labelItem:s.label,valueItem:s.value}),o=o.sort(function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0}),this.elements._optionalMagnitudesDropdown&&this.elements._optionalMagnitudesDropdown.elements&&this.elements._optionalMagnitudesDropdown.elements&&(this.blnPreventSelectedIndexUpdate=!0,this.elements._optionalMagnitudesDropdown.elementsList=[],this.elements._optionalMagnitudesDropdown.placeholder=" --- "+_.get("Select")+" --- ",this.elements._optionalMagnitudesDropdown.selectedIndex=-1,this.elements._optionalMagnitudesDropdown.elementsList=o,this.blnPreventSelectedIndexUpdate=!1,this._deleteDefaultMagnitude.disabled=!0)}}},_addDefaultUnitsTable:function(){var t=this,s=e.extendElement(t.elements.mainDiv.querySelector("tr table .display_units_body"));s.addClassName("loading");var a=e.extendElement(t.elements.mainDiv.querySelector("table tr .opt_DefaultMagnitudes"));i.getMagnitudes({blnForceRefresh:this.options.blnForceRefresh||!1}).then(function(n){i.getDefaultMagnitudes({blnForceRefresh:!0}).then(function(r){var o,d=[];t.elements._unitsDropdown={},(n=Object.keys(n).sort().reduce(function(e,t){return e[t]=n[t],e},{}))&&!n.INTEGER&&d.push({labelItem:_.get("Integer"),valueItem:"Integer"}),n&&!n.STRING&&d.push({labelItem:_.get("Text"),valueItem:"String"}),e.each(n,function(a,n){var o={};n&&n.Name&&n.NLS&&!r[n.Name]&&(o={labelItem:n.NLS,valueItem:n.Name},d.push(o));var u=s.insertRow(-1);u.classList.add("magnitudeLabelRow"),u.classList.add(n.Name+"Parameter");var m=e.createElement("td");(m=u.insertCell()).className="unitsLabel",m.innerHTML=n.NLS;var p=e.createElement("td");p=u.insertCell();var h=e.createElement("div");h.className="unitsDropdown",p.appendChild(h);var f=null,g=[];n.Units&&e.each(n.Units,function(e,t){t&&t.label&&t.NLSName&&(o={labelItem:t.NLSName,valueItem:t.label},t&&t.default&&!0===t.default&&(o.default=!0),g.push(o))}),(g=g.sort(function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0}))&&(f=null,e.each(g,function(e,t){return t.default&&!0===t.default&&(f=e),null===f}));var v={elementsList:g,popupSizeAdjustPolicy:c.SizeAdjustPolicyEnum.AdjustToVisibleContents,enableSearchFlag:!1,selectedIndex:f,actionOnClickFlag:!1};if(t.options.resourceParameter&&t.options.resourceParameter.units&&(v.currentValue=t.options.resourceParameter.units),g.length>1){t.elements._unitsDropdown[n.Name+"Parameter"]=new l(v).inject(h),t.elements._unitsDropdown[n.Name+"Parameter"].disabled=g.length>1,t.elements._unitsDropdown[n.Name+"Parameter"].getContent().addClassName("loading"),t.elements._unitsDropdown[n.Name+"Parameter"].name=n.Name,t.elements._unitsDropdown[n.Name+"Parameter"].getContent().addEventListener("change",function(e){t.onUnitsDropdownChange(e)});var _={magnitude:n.Name};i.getMagnitudeUnits(_).then(function(i){i&&e.each(i,function(e,i){i&&i.default&&!0===i.default?(t.elements._unitsDropdown[n.Name+"Parameter"].value=i.label,t.elements._unitsDropdown[n.Name+"Parameter"].disabled=!1):i&&!i.default&&(t.elements._unitsDropdown[n.Name+"Parameter"].disabled=!1)})})}else 1===g.length&&h.setText(g[0].labelItem)}),d=d.sort(function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0}),o={popupSizeAdjustPolicy:c.SizeAdjustPolicyEnum.AdjustToVisibleContents,elementsList:d,placeholder:" --- "+_.get("Select")+" --- ",selectedIndex:-1,enableSearchFlag:!0,actionOnClickFlag:!1},t.elements._optionalMagnitudesDropdown=new l(o).inject(a),t.elements._optionalMagnitudesDropdown.getContent().addEventListener("change",function(){null!==t.elements._optionalMagnitudesDropdown.currentValue?t._addDefaultMagnitudeIcon.disabled=!1:t._addDefaultMagnitudeIcon.disabled=!0}),t.elements._optionalMagnitudesDropdown.addEventListener("show",function(i){if(i&&i.dsModel&&i.dsModel.elements&&i.dsModel.elements.treeListView&&i.dsModel.elements.treeListView.getRoots){var a=function(){var n=t.elements.mainDiv.querySelector("tr.default_unit_title td .wux-controls-toggle"),r=!1,o=[];if(i.dsModel.elements.popup&&i.dsModel.elements.popup.visibleFlag?o=i.dsModel.elements.treeListView.getRoots():i.dsModel._allDescendants&&(o=i.dsModel._allDescendants),e.each(o,function(e,t){if(t&&t.options&&t.options.grid&&t.options.grid.valueItem){var i=s.querySelector("tr.magnitudeLabelRow."+t.options.grid.valueItem+"Parameter");i&&(n&&n.dsModel&&n.dsModel.checkFlag?i.hidden=!1:(i.hidden=t.isHidden(),r=r||i.hidden))}}),r)if(n)n.dsModel&&n.dsModel.show();else{var l=new u({label:_.get("Show All")}).inject(t.elements.mainDiv.querySelector("tr.default_unit_title td"));(n=l.elements.container).setStyle("position","absolute").setStyle("right","1em").setStyle("bottom","0"),l.addEventListener("change",function(){a()})}else n&&n.dsModel&&n.dsModel.checkFlag&&n.dsModel.show()};a()}}),e.extendElement(s).removeClassName("loading")})},function(e){t._displayNotificationMessage(e)})},_getSelectedIndex:function(t,i){var s=null,a=i||this.elements._optionalMagnitudesDropdown&&this.elements._optionalMagnitudesDropdown.elementsList;return a&&a.length&&e.each(a,function(e,i){i.valueItem===t&&(s=e)}),s},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in"),this.options.onClose&&this.options.onClose.call(this)},showCreateDialog:function(e){this.options.blnSuppressCreateDlg||(!this._createDlg&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg||((e=Object.assign(e||{},this.options))._prefDialog||(e._prefDialog=this),this._createDlg=new s(e)),this._createDlg.showDialog(e))},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in")},onUnitsDropdownChange:function(e){if(this._changedAttributesObj||(this._changedAttributesObj={}),e.target.hasClassName("loading"))e.target.removeClassName("loading");else{var t=e.target.dsModel,i=t.name+"Parameter",s=t.value,a=t.label;i&&s&&(this._changedAttributesObj.preference_DisplayUnits||(this._changedAttributesObj.preference_DisplayUnits={}),this._changedAttributesObj.preference_DisplayUnits[i]={},this._changedAttributesObj.preference_DisplayUnits[i].currentUnitValue=s,this._changedAttributesObj.preference_DisplayUnits[i].currentUnitLabel=a)}},applyClicked:function(){var t=this,s={};if(t._changedAttributesObj&&(!t._changedAttributesObj||t._changedAttributesObj.preference_DimensionsList||t._changedAttributesObj.preference_DisplayUnits)){if(t._changedAttributesObj.preference_DimensionsList){for(var a=Object.keys(t._changedAttributesObj.preference_DimensionsList),n="",r=0;r<a.length;r++)n+=a[r]+"Parameter;";s.dimensionList=n}if(t._changedAttributesObj.preference_DisplayUnits){var o="";e.each(t._changedAttributesObj.preference_DisplayUnits,function(e,t){o+=e+":"+t.currentUnitValue+","}),s.defaultUnits=o}t.enableDisableButtons(!1),s&&s.dimensionList&&i.updateDefaultMagnitudes(s).then(function(){t._displayNotificationMessage(_.get("Updated Default Magnitudes"),{level:"success"}),t.enableDisableButtons(!0),t._changedAttributesObj={}},function(e){e||(e=_.get("Error")),t._displayNotificationMessage(e)}),s&&s.defaultUnits&&i.updateMagnitudeUnits(s).then(function(){t._displayNotificationMessage(_.get("Updated Magnitude Units"),{level:"success"}),t.enableDisableButtons(!0),t._changedAttributesObj={}},function(e){t.enableDisableButtons(!0),e||(e=_.get("Error")),t._displayNotificationMessage(e)})}},doneClicked:function(t){var s=this;if(!s._changedAttributesObj)return s.hideDialog(),t.blnForceRefresh=!0,void s.showCreateDialog(t);if(s._changedAttributesObj&&!s._changedAttributesObj.preference_DimensionsList&&!s._changedAttributesObj.preference_DisplayUnits)return s.hideDialog(),t.blnForceRefresh=!0,void s.showCreateDialog(t);if(t={},s._changedAttributesObj.preference_DimensionsList){for(var a=Object.keys(s._changedAttributesObj.preference_DimensionsList),n="",r=0;r<a.length;r++)n+=a[r]+"Parameter;";t.dimensionList=n}if(s._changedAttributesObj.preference_DisplayUnits){var o="";e.each(s._changedAttributesObj.preference_DisplayUnits,function(e,t){o+=e+":"+t.currentUnitValue+","}),t.defaultUnits=o}s.enableDisableButtons(!1),t&&t.dimensionList&&i.updateDefaultMagnitudes(t).then(function(){s._displayNotificationMessage(_.get("Updated Default Magnitudes"),{level:"success"}),s.enableDisableButtons(!0),s._changedAttributesObj={},s.hideDialog(),t.blnForceRefresh=!0,s.showCreateDialog(t)},function(e){s.enableDisableButtons(!0),e||(e=_.get("Error")),s._displayNotificationMessage(e)}),t&&t.defaultUnits&&i.updateMagnitudeUnits(t).then(function(){s._displayNotificationMessage(_.get("Updated Magnitude Units"),{level:"success"}),s.enableDisableButtons(!0),s._changedAttributesObj={},s.hideDialog(),t.blnForceRefresh=!0,s.showCreateDialog(t)},function(e){s.enableDisableButtons(!0),e||(e=_.get("Error")),s._displayNotificationMessage(e)})},_initEventHandlers:function(){var e=this;this.addEventListener("close",function(){e.destroy()})},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}},_displayNotificationMessage:function(t,i){g._getNotificationManager||(g._getNotificationManager=g.getNotificationManager,g.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),g.getNotificationManager()||g._manager||(g.setNotificationManager(f),g.setRemoveStackOnFirstTimeoutFlag(!0),g.setStackingPolicy(31)),i||(i={}),i.message||(i.message=t),i.level||(i.level="error"),"subtitle"in i||(i.subtitle=""),"sticky"in i||(i.sticky=!1),"category"in i||(i.category=(t||"").toString()),"title"in i||(i.title=_.get(e.String.capitalize(i.level.toLowerCase()))),f.addNotif(i)}})});