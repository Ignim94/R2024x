define("DS/XCADIFCDocument/IFCTessellatedRepresentation",["DS/XCADInputDocuments/XCADTessellatedRepresentation","DS/XCADInputDocuments/XCADRepresentation","DS/XCADInputDocuments/XCADFaceData","DS/XCADInputDocuments/XCADEdgeData","DS/Mesh/ThreeJS_Base"],function(t,e,i,r,s){"use strict";var o=/([^,]+)/g,n=/\(([^)]+)\)/g;t.KindOfNode.NOD_SolidNode,t.KindOfNode.NOD_GP,t.KindOfGP.GP_Face;return t.extend(function(t,i){this._associatedDocument=t,this._ifcTokenizeArgs=t.ifcTokenizeArgs,this._representationType=e.XCAD_TESSELLATED_REPRESENTATION,this._ifcRepresentationIndex=i;var r=[];t.ifcTokenizeArgs(t.ifcEntities[i.substr(1)],r),this._rootNodes=[],t.ifcTokenizeArgs(r[3],this._rootNodes),this._verticelist={},this._idxCoordList=void 0,this._associatedDocument.CoordSystem.Coord=!1,this._associatedDocument.CoordSystem.Origin=void 0,this._associatedDocument.CoordSystem.Axis=void 0,this._associatedDocument.CoordSystem.RefDir=void 0,this._isNodeGP=!1},{_fillVerticesList:function(t){let e=this._associatedDocument.ifcEntities[t];if(null!=e){let r=e.substr(e.indexOf("((")+2,e.indexOf("))")-2).match(n);this._verticelist[t]=[],this._idxCoordList=t;let s=[],c=0;null!=r&&(c=r.length);for(var i=0;i<c;i++)3===(s=r[i].substr(1,r[i].length-2).match(o)).length&&this._verticelist[t].push(s[0],s[1],s[2]),s=null}},_processTriangleStrips:function(t,e,i){var r=e.substr(1,e.length-2).match(n);if(null!==r){var c=null==i||1===i.length;let e=r.length;for(let n=0;n<e;n++){let e=r[n].substr(1,r[n].length-2).match(o);if(null==i){var a,d,u,l=new s.Vector3,f=new s.Vector3,h=new s.Vector3;a=3*(e[0]-1);var g=new s.Vector3(this._verticelist[this._idxCoordList][a],this._verticelist[this._idxCoordList][a+1],this._verticelist[this._idxCoordList][a+2]);d=3*(e[1]-1);var p=new s.Vector3(this._verticelist[this._idxCoordList][d],this._verticelist[this._idxCoordList][d+1],this._verticelist[this._idxCoordList][d+2]);u=3*(e[2]-1);var m=new s.Vector3(this._verticelist[this._idxCoordList][u],this._verticelist[this._idxCoordList][u+1],this._verticelist[this._idxCoordList][u+2]);l.subVectors(g,p),f.subVectors(g,m),h.crossVectors(l,f),h.normalize(),t.setNormalAt(a/3,h.getComponent(0).toString(),h.getComponent(1).toString(),h.getComponent(2).toString()),t.setNormalAt(d/3,h.getComponent(0).toString(),h.getComponent(1).toString(),h.getComponent(2).toString()),t.setNormalAt(u/3,h.getComponent(0).toString(),h.getComponent(1).toString(),h.getComponent(2).toString()),t.stripTrianglesIndices.push(a/3,d/3,u/3)}else{let r=e.length;for(let s=0;s<r;s++){let r=e[s];if(r-=1,t.stripTrianglesIndices.push(r),!c){let e=i[r].substr(1,i[r].length-2).match(o);t.setNormalAt(r,e[0],e[1],e[2]),e=null}}}t.nbVertexPerStripTriangle.push(e.length),e=null}}r=null},_processTriangleFans:function(t,e,i){throw"Error: not implemented method"},getChildren:function(t,e){var i=[];return i.push(t),i},getChild:function(t,e){throw"Error: not implemented method"},getChildCount:function(t,e){throw"Error: not implemented method"},getAssociatedTransfo:function(t){throw"Error: not implemented method"},getGeomSet:function(t){throw"Error: not implemented method"},getCircleData:function(t){throw"Error: not implemented method"},getConeData:function(t){throw"Error: not implemented method"},getCoordinateSystem:function(){return this._associatedDocument.CoordSystem},getCylinderData:function(t){throw"Error: not implemented method"},getVertexData:function(t){throw"Error: not implemented method"},getEdgeData:function(t){throw"Error: not implemented method"},getFaceData:function(t){var e=this._associatedDocument._ifcGetEntityType(t.substring(1)),r=[];this._ifcTokenizeArgs(e.second,r);var s=new i,o=r[0].substring(1);if(void 0===this._verticelist[o]&&this._fillVerticesList(o),null!=this._verticelist[o]){for(var c=this._verticelist[o].length,a=0,d=0;d<c/3;d++){for(var u=0;u<3;u++)s.vertices[3*d+u]=this._verticelist[o][a+u];a+=3}if(null!=r[1]){var l=r[1].substr(1,r[1].length-2).match(n);r[3].length>2&&this._processTriangleStrips(s,r[3],l)}}return s},getGPType:function(e){return t.KindOfGP.GP_Face},getNodeBoundingSphere:function(t){throw"Error: not implemented method"},getNodeColor:function(t){t=t.substring(1);var e=this._associatedDocument.overridingFaceColors[t];return void 0!==e?e:this._associatedDocument.bodyColors[t]},getNodeOrientationMatrix:function(t){throw"Error: not implemented method"},getNodeType:function(e){var i=t.KindOfNode.NOD_SolidNode;return this._isNodeGP?(this._isNodeGP=!1,i=t.KindOfNode.NOD_GP):this._isNodeGP=!0,i},getNodeUID:function(t){throw"Error: not implemented method"},getPlaneData:function(t){throw"Error: not implemented method"},getPointData:function(t){throw"Error: not implemented method"},getPolyLineData:function(t){throw"Error: not implemented method"},getRootNode:function(t){return this._rootNodes[t]},getRootNodesCount:function(){return this._rootNodes.length},getSAG:function(t){throw"Error: not implemented method"},getSphereData:function(t){throw"Error: not implemented method"},isIndexed:function(){return!0}})}),define("DS/XCADIFCDocument/IFCProductInstance",["DS/XCADInputDocuments/XCADProductInstance"],function(t){"use strict";return t.extend(function(t,e){this._document=t,this._ifcProductInstance=e},{getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceAttributes:function(){var t=[];return t.push(this._ifcProductInstance.instanceName),t},getReferenceProduct:function(){return this._document.getProductReference(this._ifcProductInstance.productReferenceIdx)},getUID:function(){throw"Error: not implemented method"},getTransformation:function(){var t,e=this._ifcProductInstance.transfo;if(void 0!==e){var i=e.rotation.elements,r=e.translation;t=[[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],[r.x,r.y,r.z]]}return t}})}),define("DS/XCADIFCDocument/IFCProductRepresentation",["DS/XCADInputDocuments/XCADProductRepresentation"],function(t){"use strict";return t.extend(function(t,e,i){this._name=i,this._associatedDocument=t,this._representationType=e,this._rootProducts=[]},{addRootProduct:function(t){this._rootProducts.push(t)}})}),define("DS/XCADIFCDocument/IFCProduct",["exports","DS/XCADInputDocuments/XCADProduct","DS/XCADIFCDocument/IFCProductInstance"],function(t,e,i){"use strict";var r=e.extend(function(t,e){this._document=t,this._ifcProduct=e},{getDocument:function(){var t=void 0;if(null!=this._ifcProduct){var e=this._ifcProduct.geomRep;null!=e&&((t=this._document)._internalRepresentationIndex=e.location)}return t},getFilePath:function(){},getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceList:function(){var t=[];if(null!=this._ifcProduct)for(var e=this._ifcProduct.childrenList.length,r=0;r<e;r++){var s=new i(this._document,this._ifcProduct.childrenList[r]);null!=s&&t.push(s)}return t},getProductAttributes:function(){var t=[];return null!=this._ifcProduct?t.push(this._ifcProduct.referenceName):t.push("unknow"),t.push(""),t.push(""),t.push(""),t.push(""),t.push(e.SourceTypes.Unknown),t},getUID:function(){throw"Error: not implemented method"}});return t.IFCProduct=r,r}),define("DS/XCADIFCDocument/IFCInputDocument",["DS/XCADInputDocuments/XCADInputDocument","DS/XCADInputDocuments/XCADRepresentation","DS/XCADIFCDocument/IFCTessellatedRepresentation","DS/XCADIFCDocument/IFCProductRepresentation","DS/XCADIFCDocument/IFCProduct","DS/XCADInputDocuments/XCADFaceData","DS/Mesh/ThreeJS_Base","DS/XCADLoader/XCADError"],function(t,e,i,r,s,o,n,c){"use strict";e.XCAD_TESSELLATED_REPRESENTATION;return t.extend(function(){this.tesselatedReps=[],this.ifcEntities=[],this.bodyColors=[],this.overridingFaceColors=[],this.assyProducts=[],this.nbInstPart=0,this.rootProducts=[],this.CoordSystem={Coord:!1,Origin:void 0,Axis:void 0,RefDir:void 0},this.assyProducts2=[],this.rootProducts2=[],this.productTypeMapping=[]},{forceRead:void 0,zipped:!1,requestResponseType:"arraybuffer",tokenizeComplexArgs:function(t,e){var i=0,r="";e.length=0;for(var s=0;s<t.length;s++)"("===t[s]?(i>=1&&(r+=t[s]),i++):")"===t[s]?--i>=1&&(r+=t[s],1===i&&(e.push(r),r="")):r+=t[s]},tokenizeArrayArgs:function(t,e){var i="";e.length=0;for(var r=0;r<t.length;r++)"("!==t[r]&&(","===t[r]||")"===t[r]?(e.push(i),i=""):i+=t[r])},ifcTokenizeArgs:function(t,e){if(void 0!==t){e.length=0;t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).match(/(\'[a-zA-Z0-9\s.,+-_#()~:&$|\\\"]*\')*(\([()]*(\([^()]*\)[^()]*)*\))*(\([a-zA-Z0-9\s.,-_#]*\))*(\.[a-zA-Z0-9\s.,-_#]*\.)*(\#?\-?[0-9]+[.-E0-9]*)*(\$)*/g).filter(function(t){return""!=t}).forEach(t=>{"string"==typeof t&&t.startsWith("'")&&t.endsWith("'")&&(t=t.slice(1,-1));let i=[...t.matchAll(/\\X2\\[^\\]+\\X0\\/g)],r=0,s="",o=0;i.forEach(e=>{s+=t.substring(o,e.index),o=e.index+i[r][0].length;var n=i[r][0].substring(i[r][0].indexOf("\\X2\\")+4,i[r][0].indexOf("\\X0\\")).match(/.{1,4}/g);n.forEach((t,e,i)=>{i[e]="0x"+t});var c=String.fromCharCode.apply(String,n);s+=c,r++});let n=(s+=t.substring(o,t.length)).indexOf("\\S\\");const c=/\\S\\./gi;if(n>0){let t=String.fromCharCode(128|s.substring(n+3,n+4).charCodeAt(0));s=s.replaceAll(c,t)}const a=/\\X\\../gi;if((n=s.indexOf("\\X\\"))>0){let t=String.fromCharCode(parseInt(s.substring(n+3,n+5),16));s=s.replaceAll(a,t)}e.push(s)})}},_ifcGetEntityType:function(t){var e,i=this.ifcEntities[t];void 0!==i&&(e=i.match(/^\w+/)[0]);return{first:e,second:i}},close:function(){void 0!==this._internalRepresentationIndex&&delete this._internalRepresentationIndex},getProductReference:function(t){return new s(this,this.assyProducts[t])},getRootProducts:function(){return this.rootProducts},getRepresentation:function(t){var s;if(void 0!==this._internalRepresentationIndex)t===e.XCAD_TESSELLATED_REPRESENTATION&&(s=new i(this,this._internalRepresentationIndex));else if(2===Object.keys(this.assyProducts).length&&0!==this.tesselatedReps.length&&t===e.XCAD_TESSELLATED_REPRESENTATION)s=new i(this,this.tesselatedReps[0]);else if(Object.keys(this.assyProducts).length>2&&t===e.XCAD_PRODUCT_REPRESENTATION){s=new r(this,e.XCAD_PRODUCT_REPRESENTATION,"root");var o,n=this.getRootProducts();if(n.length>0)o=n[0];else for(var c in this.assyProducts)if(this.assyProducts[c].isRoot){o=c;break}var a=this.getProductReference(o);s.addRootProduct(a)}return s},initialize:async function(t){var e=[];if("string"==typeof t)e[0]=t;else{var i=new TextDecoder("utf-8");if(t.byteLength>268435456){let r=0,s=268435456,o=0;for(;s<t.byteLength;)e[o]=i.decode(t.slice(r,s)),o++,r=s+1,s+=268435456;e[o]=i.decode(t.slice(r,t.byteLength))}else e[0]=i.decode(t)}if(""!==e[0]){for(var r=1;r<e.length;r++){let t=e[r].indexOf("\n#"),i=e[r].substring(0,t+1);e[r-1]+=i,e[r]=e[r].slice(t+1,e[r].length)}if(null==this.forceRead&&null===e[0].match(/FILE_SCHEMA\s*\(\s*\(\s*\'\s*IFC4/))return console.error("Only IFC4 files are supported"),(s=new c).setError("XCADLoader/XCADLoader","error.IFC_UNSUPPORT",null),s;var s,o=!0;for(r=0;r<e.length;r++)null!=e[r].match(/#\d+=[ ]*IFCTRIANGULATEDFACESET/)&&(o=!1);if(null==this.forceRead&&!0===o)return console.error("Only IFC file with tessellated data are supported"),(s=new c).setError("XCADLoader/XCADLoader","error.NO_TESSELLATION",null),s;for(r=0;r<e.length;r++)e[r]=e[r].replace(/\r?\n/g,""),e[r]=e[r].split(";");this.forceRead=!1,t="";var a=this,d=[],u=[],l=[],f="",h=[],g=[],p=[],m=/^(#[0-9]+)\=(.+)$/,v=/^\w+/,C="";for(r=0;r<e.length;r++){C=e[r];for(var D=0;D<C.length;D++){var A=C[D].replace(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/,"");let t=[...A.matchAll(/'[^']+'/g)],e=0,i="",r=0;t.forEach(s=>{i+=A.substring(r,s.index).replace(/\s+/g,""),r=s.index+t[e][0].length,i+=t[e][0],e++}),i+=A.substring(r,A.length).replace(/\s+/g,"");for(var E=(A=i).test(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/);1==E;)E=(A=A.replace(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/,"")).test(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/);var _=A.match(m);if(null!==(_=A.match(m))){var P=_[2].match(v);if(null===P)continue;if(null===P)console.error("IFCInputDocument::initialize entityType is null for tokens : "+_);else{var T=_[1].substr(1);switch(this.ifcEntities[T]=_[2],P[0]){case"IFCSHAPEREPRESENTATION":var R=[];a.ifcTokenizeArgs(_[2],R);var y=R[2];"Tessellation"==(y=y.replace("'",""))&&this.tesselatedReps.push(_[1]);break;case"IFCPROJECT":f=T;break;case"IFCRELAGGREGATES":d.push(T);break;case"IFCINDEXEDCOLOURMAP":p.push(T);break;case"IFCRELCONTAINEDINSPATIALSTRUCTURE":u.push(T);break;case"IFCRELDEFINESBYTYPE":l.push(T)}}}}e[r].length=0}for(var I=0;I<p.length;I++)N(p[I]);for(I=0;I<u.length;I++)b(u[I],!1);for(I=0;I<d.length;I++)b(d[I],!0);for(I=0;I<l.length;I++){let t=[];a.ifcTokenizeArgs(a.ifcEntities[l[I]],t);let e=t[4].substring(1,t[4].length-1).split(","),i=a.ifcEntities[t[5].substr(1)].substring(0,a.ifcEntities[t[5].substr(1)].indexOf("("));for(var S=0;S<e.length;S++)a.productTypeMapping[e[S].substr(1)]=i}!function t(e,i,r=!1){var s="#"+e;var o="#"+i;var n=[];a.ifcTokenizeArgs(a.ifcEntities[e],n);var c=[];a.ifcTokenizeArgs(a.ifcEntities[i],c);a._ifcGetEntityType(e);a._ifcGetEntityType(i);var d=n[2];var u=c[2];if(0==r){let t=!1;if(null==i&&(t=!0,a.rootProducts2.push("#"+e)),a.assyProducts2[e]={referenceName:d,isRoot:t,childrenList:[],geomRep:void 0},!t){var l=x(n[5]),f={instanceName:d,productReferenceIdx:"#"+e,transfo:l};a.assyProducts2[i].childrenList.push(f)}}var p=h[e];var m=g[e];var v=0;var C=0;var D=0;0==r&&void 0!==m&&void 0!==p&&t(e,i,!0);0==r&&void 0!==m?(v=5,C=4,D=m):void 0!==p&&(v=4,C=5,D=p);if(0!==v&&0!==D&&null!=n[5]&&null!=n[6]){var A=n[5].substr(1),E=a._ifcGetEntityType(A);if(void 0!==E.first||void 0!==E.second){var _=n[6].substr(1),P=a._ifcGetEntityType(_);if(void 0!==P.first||void 0!==P.second){var T=[];a.ifcTokenizeArgs(a.ifcEntities[_],T);var R=[],y=T[2];a.tokenizeArrayArgs(y,R);for(var I=0;I<R.length;I++){var S=R[I].substr(1),b=[];a.ifcTokenizeArgs(a.ifcEntities[S],b);var N=b[2];N=N.replace("'","");var L=void 0;switch(N){case"MappedRepresentation":var k=[];a.ifcTokenizeArgs(a.ifcEntities[S],k);var z=k[3].substr(2,k[3].length-3),w=[];a.ifcTokenizeArgs(a.ifcEntities[z],w);var X=w[0].substr(1),F=[];a.ifcTokenizeArgs(a.ifcEntities[X],F);var O=F[1].substr(1),G=[];a.ifcTokenizeArgs(a.ifcEntities[O],G),L=F[1];break;case"Tessellation":L=R[I]}s in a.assyProducts?a.assyProducts[s].geomRep={type:void 0,location:L}:0==a.rootProducts.length?(a.assyProducts[s]={referenceName:d,isRoot:!0,childrenList:[],geomRep:{type:void 0,location:L}},a.rootProducts.push(s)):a.assyProducts[s]={referenceName:d,isRoot:!1,childrenList:[],geomRep:{type:void 0,location:L}}}}else{var l=x(n[5]);if(0==a.rootProducts.length?(a.assyProducts[s]={referenceName:d,isRoot:!0,childrenList:[],geomRep:void 0},a.rootProducts.push(s)):a.assyProducts[s]={referenceName:d,isRoot:!1,childrenList:[],geomRep:void 0},o in a.assyProducts){var f={instanceName:d,productReferenceIdx:s,transfo:l};a.assyProducts[o].childrenList.push(f)}}}for(var V=0;V<D.length;V++){var U=[];a.ifcTokenizeArgs(a.ifcEntities[D[V]],U);var $=[],M=U[C];a.tokenizeArrayArgs(M,$);for(var K=[],I=0;I<$.length;I++){var B=$[I].substr(1),J=a._ifcGetEntityType(B);a.ifcTokenizeArgs(a.ifcEntities[B],K);J.first;t(B,e)}}}else{var P=void 0;if(null!=n[6]){var _=n[6].substr(1);P=a._ifcGetEntityType(_)}if(!P||void 0===P.first&&void 0===P.second){var l=x(n[5]);if(0==a.rootProducts.length?(a.assyProducts[s]={referenceName:d,isRoot:!0,childrenList:[],geomRep:void 0},a.rootProducts.push(s)):a.assyProducts[s]={referenceName:d,isRoot:!1,childrenList:[],geomRep:void 0},o in a.assyProducts){var f={instanceName:d,productReferenceIdx:s,transfo:l};a.assyProducts[o].childrenList.push(f)}}else{o in a.assyProducts||(0==a.rootProducts.length?(a.assyProducts[o]={referenceName:u,isRoot:!0,childrenList:[],geomRep:void 0},a.rootProducts.push(o)):a.assyProducts[o]={referenceName:u,isRoot:!1,childrenList:[],geomRep:void 0});var T=[];a.ifcTokenizeArgs(a.ifcEntities[_],T);var R=[],y=T[2];null!=T[2]&&a.tokenizeArrayArgs(y,R);for(var I=0;I<R.length;I++){var S=R[I].substr(1),b=[];a.ifcTokenizeArgs(a.ifcEntities[S],b);var N=b[2];null!=N&&(N=N.replace("'",""));var L=void 0;switch(N){case"MappedRepresentation":var k=[];a.ifcTokenizeArgs(a.ifcEntities[S],k);var z=k[3].substr(2,k[3].length-3);let t=z.split(",");t.length>1&&(z=t[0]);var w=[];a.ifcTokenizeArgs(a.ifcEntities[z],w);var X=w[0].substr(1),F=[];a.ifcTokenizeArgs(a.ifcEntities[X],F);var O=F[1].substr(1),G=[];a.ifcTokenizeArgs(a.ifcEntities[O],G),L=F[1];break;case"Tessellation":L=R[I]}if(s in a.assyProducts){a.assyProducts[s].isRoot=!1;var Z=a.rootProducts.indexOf(s);-1!=Z&&a.rootProducts.splice(Z,1)}else a.assyProducts[s]={referenceName:d,isRoot:!1,childrenList:[],geomRep:{type:void 0,location:L}}}var l=x(n[5]);o in a.assyProducts&&a.assyProducts[o].childrenList.push({instanceName:d,productReferenceIdx:s,transfo:l}),a.assyProducts[s]&&void 0!==a.assyProducts[s].geomRep&&a.nbInstPart++}}}(f,void 0)}function b(t,e){var i=[];if(a.ifcTokenizeArgs(a.ifcEntities[t],i),e){var r=i[4].substr(1);void 0===h[r]&&(h[r]=[]),h[r].push(t)}else{r=i[5].substr(1);void 0===g[r]&&(g[r]=[]),g[r].push(t)}}function N(t){var e=[],i=[];a.ifcTokenizeArgs(a.ifcEntities[t],i);var r=i[0].substr(1),s=i[2].substr(1),o=[];a.ifcTokenizeArgs(a.ifcEntities[s],o);var n=[];a.tokenizeComplexArgs(o[0],n);for(var c=0;c<n.length;c++)n[c]=n[c].replace(",(","("),a.ifcTokenizeArgs(n[c],e);a.bodyColors[r]=[e[0],e[1],e[2]]}function x(t){if(null!=t){var e={},i=t.substr(1),r=a._ifcGetEntityType(i);if(void 0!==r.first||void 0!==r.second){var s=[];if(a.ifcTokenizeArgs(a.ifcEntities[i],s),null==s[1])return;var o=s[1].substr(1),c=[];if(a.ifcTokenizeArgs(a.ifcEntities[o],c),c.length<3)return;var d=[],u=[],l=[],f=[];c[0]=c[0].substr(1),c[1]=c[1].substr(1),c[2]=c[2].substr(1),a.ifcTokenizeArgs(a.ifcEntities[c[0]],d),a.ifcTokenizeArgs(d[0],u),a.ifcTokenizeArgs(a.ifcEntities[c[1]],d),a.ifcTokenizeArgs(d[0],l),a.ifcTokenizeArgs(a.ifcEntities[c[2]],d),a.ifcTokenizeArgs(d[0],f),e.rotation=new n.Matrix3;var h=new n.Vector3(l[0],l[1],l[2]),g=new n.Vector3(f[0],f[1],f[2]),p=new n.Vector3;return p.crossVectors(h,g),e.rotation.set(f[0],f[1],f[2],p.x,p.y,p.z,l[0],l[1],l[2]),e.translation=new n.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])),e}}}}})});