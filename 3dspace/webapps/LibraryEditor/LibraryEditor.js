function LibraryEditor(e){"use strict";var t={leftPanelState:!0,isWelcomePanelCollapsed:!1},r={rightPanelState:!1,size:300},i={widget:null,filterFromWin:null,libraryContent_Cont:null,libraryContentController:null,libraryTree_div:null,libraryTreeDoc_div:null,libraryTree_Cont:null,libraryIdCard_div:null,libraryIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,libraryTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(e){var i=this;require(["DS/LibraryEditor/utils/LibraryEditorUtil"],function(e){var i=e.getLeftPanelStatus(),n=e.getRightPanelStatus();Promise.all([i,n]).then(function(e){t=e[0],r=e[1]})}),require(["DS/PADUtils/PADSettingsMgt"],function(e){e.setSetting("columnParametrization",!0),e.setSetting("activateTXO",!0)}),require(["DS/IPClassifyUtil/IPClassifyUtility"],function(e){e.isCustomizedEnv(),e.initURLSAsync().then(function(){i.migratePreferences()})}),this.widget=e.widget,this.dataForActiveClassODT=e.dataForActiveClassODT,e.filter?this.filterFromWin=e.filter:this.filterFromWin=null,e.defaultSelectionPath&&(this.widget.defaultSelectionPathFromWin="root,LibrarySection_AllLibraries,"+e.defaultSelectionPath),this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.changeInPreference={};var n={},a={};this.widget.addEvent("onEdit",function(){i.widget.preferences.forEach(function(e){"hidden"!==e.type&&(n[e.name]=i.widget.getValue(e.name))})}),this.widget.addEvent("endEdit",function(e){!(!e||!e.submitted&&!e.needRefresh)&&(i.widget.changeInPreference={},Object.keys(n).forEach(function(e){a[e]=i.widget.getValue(e),n[e]!==a[e]&&(i.widget.changeInPreference[e]=a[e])}))})},onRefresh:function(e){var t=this;require(["DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADSettingsMgt","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/IPClassifyUtil/IPClassifyUtility"],function(r,i,n,a,o,s){var l=[];l.push(s.initURLSAsync()),t.widget.changeInPreference.x3dPlatformId&&(t.widget.changeInPreference={}),Promise.all(l).then(function(){var a=s.isIndexedMode();if(o.getContent().updateFilterBI(a),o.getContent().updateComputedColumns(),t.libraryContent_Cont.addEvent("onCompleteRefreshNodes",function(e){this.removeEvent("onCompleteRefreshNodes"),i.displayNotification({message:n.msg_info_refresh,className:"primary"})}),e&&UWA.is(e.authored.deleted,"array")){var l=r.getCurrentLibrary();l.getID()===e.authored.deleted[0]&&l.getParent().select(!0)}o.getTreeCont().refreshLibraryTree(),o.getContent().refreshLibraryContent()})})},setCtxMenu:function(e,t,r){this.libraryContentController&&this.libraryContentController.webInWinCtxMenu(e,t)},insertSelectedSearchObjs:function(e){var t=e[0].split(",");require(["DS/ApplicationFrame/CommandsManager"],function(e){if(e)try{e.getCommand("AddExistingContent")._processInsertOperation(t)}catch(e){console.error("Error trying to execute command","AddExistingContent",e)}})},showMessage:function(e,t){require(["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(r,i){r.displayNotification({message:i.get(e),className:t})})},onWebInWinFilterChange:function(e){this.libraryContentController&&this.libraryContentController.onWebInWinFilterChange(e)},onWebInWinTaggerVisChange:function(e){},onClearSelection:function(){require(["DS/LibraryEditor/utils/LibraryEditorcontrol"],function(e){e.getContent().getView().getPADTreeDocument().getXSO().empty()})},onDestroy:function(){},onResize:function(){var e=this;setTimeout(function(){e.libraryGlobal_div&&e.libraryIdCard_Cont&&0!==e.libraryGlobal_div.clientWidth&&e.libraryIdCard_Cont.updateDisplayPath()},500)},preferenceIsNotSet:function(e){return void 0===widget.getValue(e)||null===widget.getValue(e)},migratePreferences:function(){return new Promise(function(e){require(["text!DS/LibraryEditor/assets/libraryVersion.json","DS/LibraryEditor/utils/LibraryMigration","DS/IPClassifyUtil/IPClassifyPreference"],function(t,r,i){let n=JSON.parse(t);var a=[];let o=new Promise(function(e){i.get("LibraryFavPrefVersion",function(t){!t||!t.version||t.version<n.LibraryFavPrefVersion?r.migrateFavPreferences(null,n.LibraryFavPrefVersion).then(function(){e()}):e()},!1)});a.push(o);let s=new Promise(function(e){i.get("LibraryTreeStrcutPrefVersion",function(t){!t||!t.version||t.version<n.LibraryTreeStrcuturePrefVersion?r.migrateTreeStructurePreferences(null,n.LibraryTreeStrcuturePrefVersion).then(function(){e()}):e()})});a.push(s),Promise.all(a).then(function(){e()})})})},onLoad:function(){this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_",window.top.performance.mark("onLoad_begin"),window.top.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var e=this;require(["DS/PADUtils/Configuration","text!DS/LibraryEditor/assets/LibraryEditorConf.json","DS/PADServices/utils/AttributesMgt"],function(t,r,i){var n=JSON.parse(r);t.mergeConfig(n),i.updateAttributesList(n.columnsCusto),require(["UWA/Core","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/IPClassifyUX/LibraryContent","DS/LibraryEditor/dataProvider/LibraryContentDataProvider","DS/IPClassifyUX/LibraryIdCardCont","DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider","DS/IPClassifyUX/LibraryTree","DS/LibraryEditor/dataProvider/LibraryTreeDataProvider","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/dataProvider/LibraryCSODataProvider","DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/UIKIT/Mask","DS/LibraryEditor/utils/LibraryEditorKeyboardListener","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUtil/IPClassifyUtility","DS/PADUtils/PADProbes","DS/LibraryEditor/utils/FilterUtils","DS/IPClassifyUXUtil/CredentialsView","text!DS/LibraryEditor/assets/library_settings.json","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/PADUtils/PADContext","DS/Windows/ImmersiveFrame"],function(t,r,n,a,o,s,l,d,c,u,f,y,p,g,b,m,v,h,C,_,S,L,E,D,A,w,P,I,T,x){var U=e.filterFromWin;U?UWA.is(U,"string")?A.setUQLFilter(U):A.setFilters(U):A.resetEndItemFilter(),window.top.performance.mark("loadRequire_end"),window.top.performance.measure(e.probeHeader+"loadRequire","createWidget_begin","loadRequire_end"),widget.setValue("tenantAware",!0),n.addEventOnce("onNoSecurityContext",function(e){if(!0!==e){C._isSecurityCTXInitialized=!1,widget.setBody(" ");var t=UWA.createElement("div",{text:b.get("authentication_error")});t.set("styles",{position:"absolute",top:"40%",bottom:"30%",left:"30%",right:"30%"}),t.inject(widget.body)}}),n.addEvent("onPad_security_ctx",function(e){C.getContent()&&C.getContent().getView()&&C.getContent().getView().options&&C.getContent().getView().options.model&&C.getContent().getView().options.model.getModelEvents()&&C.getContent().getView().options.model.getModelEvents().publish({event:"titleRecalc",data:y.getCurrentLibrary()._options.label})}),widget.addPreference({name:"pad_security_ctx",type:"hidden"});var N=JSON.parse(P);n.setApp(N.padsettings,"enopad",!0),n.setSetting("activate_padprobes",!0),n.setSetting("add_objects_when_select",!1),D.initialize({padid:widget.id,padtitle:widget.getTitle()}),a.addSharedSettings(widget,["x3dPlatformId"]),widget.setValue("editProperties_readOnly",!1),widget&&widget.lang&&n.setSetting("lang",widget.lang),e.widget.addEvent("endEdit",n.updateWidgetPreferences.bind(n)),n.updateWidgetPreferences(),e.updateSecurityPreference();var O=e;if(O.options={},O.addEvent=(()=>{}),O.checkOnCommand=!1,T.set(O),I.addModeIntervalPreferences({refreshView:function(){require(["DS/LibraryEditor/utils/LibraryEditorcontrol"],function(e){e.getTreeCont().refreshLibraryTree(),e.getContent().refreshLibraryContent()})},updateTaggerAndComputeColumns:function(e){require(["DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO"],function(t,r){t.getContent().updateComputedColumns(),"Library"===(r.getCurrentLibrary()&&r.getCurrentLibrary().getType())&&t.getContent().updateFilterBI(e)})}}),e.widget.getValue("x3dSharedId")||e.widget.getValue("x3dAppId")||e.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOCLRX_AP"}),e.widget.getValue("x3dSharedId")||e.widget.addPreference({name:"x3dSharedId",type:"hidden",defaultValue:"LibraryEditor_"+o.getWidgetId()}),w.render(),null===e.libraryTree_Cont||void 0===e.libraryTree_Cont){e.core=t,e.widget.body.empty(),e._buildSkeleton();e.widget.addEvent("endEdit",function(){e.widget.getPreferences().forEach(function(t){var r="boolean"===t.type&&UWA.is(t.value,"string")?e.convertToBool(t.value):t.value;e.widget.setValue(t.name,r)})}),e.libraryGlobal_div=e.widget.body.container,e.libraryTreeDoc_div=e.widget.body.right_side_div,e.libraryIdCard_div=e.widget.body.top_right_side_div,e.libraryContent_div=e.widget.body.bottom_right_side_div;var M=e._initializeLibraryEditorComponent.bind(e);if(null===e.libraryContent_Cont){var F={x3dAppId:e.widget.getValue("x3dAppId"),lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),layout:{view_customization:null,css_view_class:e.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:N},R=function(){try{JSON.parse(E.jsonUnzip(e.widget.getValue("LibraryCusto_treelistview_v1")))}catch(e){return!1}return!0}();e.widget.getValue("LibraryCusto_treelistview_v1")&&R?(F.layout.view_customization=JSON.parse(E.jsonUnzip(e.widget.getValue("LibraryCusto_treelistview_v1"))),F.layout&&F.layout.view_customization&&Array.isArray(F.layout.view_customization.selectedExtensions)&&Array.isArray(F.layout.view_customization.selectedTypes)&&i.updateSelectedParams({selectedExtensions:F.layout.view_customization.selectedExtensions,selectedTypes:F.layout.view_customization.selectedTypes}),M(F)):o.app_initialization(function(){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService"],function(t){t.getUserPreferences({name:e.widget.getValue("x3dAppId")+"_Library_v1",onComplete:function(e){var t=null;e&&e.length>0&&(t=JSON.parse(JSON.stringify(E.jsonUnzip(e))));var r=function(){try{JSON.parse(t)}catch(e){return!1}return!0}();F.layout.view_customization=r?JSON.parse(t):t,F.layout&&F.layout.view_customization&&Array.isArray(F.layout.view_customization.selectedExtensions)&&Array.isArray(F.layout.view_customization.selectedTypes)&&i.updateSelectedParams({selectedExtensions:F.layout.view_customization.selectedExtensions,selectedTypes:F.layout.view_customization.selectedTypes}),M(F)},onFailure:function(e){M(F)}})})}),e.getSelectedNodes=function(){return y.getSelectedNodes()},e.getCurrentLibrary=function(){var e=L.getCurrentSecurityContextAndLibraryData(!0);return JSON.stringify(e)},e.getSecurityContext=function(){return{SecurityContext:n.getSetting("pad_security_ctx"),tenant:widget.getValue("pad_tenant")}},e.beginBlockingTransaction=function(t){_.mask(e.libraryContent_div,t)},e.endBlockingTransaction=function(){_.unmask(e.libraryContent_div)},e.author=function(e){},e.displayNotification=function(e){h.displayNotification({message:e.msg,className:e.eventID})},e.getPADTreeDocument=function(){return C.getContent().getView()?C.getContent().getView().getPADTreeDocument():null},e.toggleView=function(e){UWA.is(C.getContent().getView().toggleView(e))&&C.getContent().getView().toggleView(e)},e.getPADTreeListView=function(){return C.getContent().getView().getPADTreeListView()},e.getContent=function(){return C.getContent()}}}})})},_slidderMoveEndCallback:function(){this.libraryIdCard_Cont&&this.libraryIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){var e=require("DS/Windows/ImmersiveFrame"),t=require("DS/WebUAUtils/WebUAUtils"),r=new UWA.Element("div",{class:"LibraryEditor-widget-help",style:{"vertical-align":"top"}});if(r.inject(widget.body),this.widget.myImmersiveFrame){this.widget.bottom.destroy();var i=this.widget.myImmersiveFrame}else{i=new e;this.widget.myImmersiveFrame=i,t.setPanelHelpMode({immersiveFrame:this.widget.myImmersiveFrame})}try{t.closePanelHelp()}catch(e){console.log("UA Panel already closed")}i.inject(r),i.getFreeZone().replaceChildren(),this.widget.body.container=UWA.createElement("div",{class:"LibraryEditor_global_container"}).inject(i.getFreeZone(),"top"),this.widget.body.right_side_div=UWA.createElement("div",{class:"LibraryEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=UWA.createElement("div",{class:"LibraryEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.bottom=this.widget.body.bottom_right_side_div=UWA.createElement("div",{class:"LibraryEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div);var n=UWA.createElement("div",{class:"LibraryEditor_containerTools"});require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.getModelEvents().subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},function(e){e.html?(n.empty(),e.html.inject(n),n.inject(widget.body)):!0===e.restore&&n.remove()})})}},convertToBool:function(e){return"true"===e.toLowerCase()},_initializeLibraryEditorComponent:function(e){var i=this,n=require("DS/IPClassifyUX/LibraryTree"),a=require("DS/LibraryEditor/dataProvider/LibraryTreeDataProvider"),o=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),s=require("DS/IPClassifyUX/LibraryIdCardCont"),l=require("DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider"),d=require("DS/IPClassifyUX/LibraryContent"),c=require("DS/LibraryEditor/dataProvider/LibraryContentDataProvider"),u=require("DS/LibraryEditor/utils/LibraryEditorKeyboardListener"),f=require("DS/PADUtils/PADUtilsServices"),y=require("DS/LibraryEditor/dataProvider/LibraryCSODataProvider"),p=require("DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider"),g=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),b=require("DS/LibraryEditor/service/LibraryTypeService"),m=(require("DS/LibraryEditor/utils/LibraryEditorUtil"),require("DS/PADServices/utils/GlobalModelEvents")),v=require("DS/IPClassifyUtil/IPClassifyCommunication"),h=require("DS/WidgetServices/WidgetServices");f.app_initialization(function(){f.getSecurityContext(function(C){C&&""!==C.securityContext&&C.securityContextList.length>0&&(null===i.libraryTree_Cont&&f.app_initialization(function(){var u=new n({lang:i.widget.lang?i.widget.lang:i.widget.getValue("lang"),css_view_class:i.css_view_class,dataProvider:a,CSOProvider:y,DnDProvider:p,LibraryTypeService:b,events:{onReady:function(){if(o.setTreeCont(this),i.libraryTree_Cont=this._libraryTreeView,null!==i.libraryTree_Cont)i.libraryTree_Cont.setOption("_libraryContentView",this._libraryTreeView);else{if(!0===i.libraryTree_W_NotLinked)throw"LibraryTree are not linked !!!";i.libraryTree_W_NotLinked=!0}var n=i._retrieveinitializationOpts(),a=UWA.extend(e,n);a.placeholderData={},a.placeholderData.multiplePlaceholders=!1,a.placeholderData.placeholders={},a.placeholderData.placeholders.addExistingCI={},a.placeholderData.placeholders.addExistingCI.labelNLS=g.placeholder_msg,a.placeholderData.placeholders.addExistingCI.commandNLS=g.placeholder_CMD1,a.placeholderData.placeholders.addExistingCI.command="AddExistingContent",a.leftTriptychElem=i.libraryTree_Cont.elements.container,a.dataProvider=c,a.CSOProvider=y,a.DnDProvider=p,a.thumbnailAttributeDelayed=!0,i.migrateContentPreferences(e.layout.view_customization).then(function(){i.libraryContentController=new d(a),o.setContent(i.libraryContentController),null===i.libraryIdCard_Cont&&(i.libraryIdCard_Cont=new s({lang:i.widget.lang?i.widget.lang:i.widget.getValue("lang"),css_view_class:i.css_view_class,parentDiv:i.libraryIdCard_div,leftState:t,rightState:r,modelEvents:m.getModelEvents(),libraryCSODataProvider:y,libraryDataProvider:l,events:{onReady:function(){i.libraryIdCard_Cont=this,i.libraryIdCard_Cont.render().inject(i.libraryIdCard_div)}}})),i.widget.dispatchEvent("onLibraryEditorReady"),h.isWebInWinEnvironment()&&v.publish("onLibraryEditorReady","")})}}});o.setTreeCont(u)}),i._keyboardListener||(i._keyboardListener=new u,i._keyboardListener.startObservingKeyboard()),i.libraryIdCard_Cont.getView().buildIconBar())})})},migrateContentPreferences:function(e){return new Promise(function(t){e?require(["text!DS/LibraryEditor/assets/libraryVersion.json"],function(r){var i=JSON.parse(r).LibraryContentViewVersion;i!==e.version?require(["DS/LibraryEditor/utils/LibraryMigration"],function(r){r.migrateContentPreferences(e,i).then(function(){t()})}):t()}):t()})},updateSecurityPreference:function(){window.library&&require(["DS/PADUtils/PADSettingsMgt"],function(e){var t="ctx::"+window.library.params.securityContext;e.setSetting("pad_security_ctx",t)})},_retrieveinitializationOpts:function(){var e=this;return{renderTo:e.libraryContent_div,events:{onActionBarReadyToBuild:function(){var i=require("DS/IPClassifyUX/LibraryIdCardCont"),n=require("DS/PADServices/utils/GlobalModelEvents"),a=require("DS/LibraryEditor/dataProvider/LibraryCSODataProvider"),o=require("DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider");window.DEBUG_ActionBar_Require=!0,window.DEBUG_ActionBar_CmdInstantiation=!0,window.DEBUG_ActionBar_Xml=!0,window.DEBUG_ActionBar_ProcessCommandHeader=!0,window.DEBUG_ActionBar_Init=!0,e.elements=this.elements,e.options=this.options,e.togglePanel=this.togglePanel,null===e.libraryIdCard_Cont&&(e.libraryIdCard_Cont=new i({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,parentDiv:e.libraryIdCard_div,leftState:t,rightState:r,modelEvents:n.getModelEvents(),libraryCSODataProvider:a,libraryDataProvider:o,events:{onReady:function(){e.libraryIdCard_Cont=this,e.libraryIdCard_Cont.render().inject(e.libraryIdCard_div)}}}))},onReady:function(){e.libraryContent_Cont=this,e.addEvent=e.libraryContent_Cont.addEvent.bind(e.libraryContent_Cont),e.libraryContent_Cont.dropInvitContainer&&(e.libraryContent_Cont._dropInvitContainer=e.libraryContent_Cont.dropInvitContainer),e.libraryContent_Cont.options.renderTo&&(e.libraryContent_Cont._dropInvitContainer.hide(),e.libraryContent_Cont.render().inject(e.libraryContent_Cont.options.renderTo));require("DS/PADUtils/PADSettingsMgt");e.updateSecurityPreference(),require(["DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyCommunication","DS/LibraryEditor/utils/LibraryEditorcontrol"],function(e,t,r){e.isNatifEnvironnement()&&r.getContent().getView().getPADTreeDocument().getXSO().onChange(function(){var i=r.getContent().getView().getPADTreeDocument().getXSO().get(),n=[];i.forEach(function(t){if(e.isWebInWinEnvironment()){var r={};r.id=t.getID(),r.type=t._options.type,n.push(r)}else n.push(t.getID())}),t.publish("onObjectSelected",n)})});var t=e.widget.getValue("X3DContentId");if(t){var r=UWA.is(t,"string")?JSON.parse(t):t;if(r.data.items.length>0){var i=r.data.items[0].objectId;e.widget.setValue("X3DContentId","");var n=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),a=require("DS/IPClassifyUtil/IPClassifyAlert");n.getTreeCont().expandTreeAndSelectLibrary({libraryToFindAndSelect:{id:i},onFailure:function(e){a.displayNotification({message:e instanceof Error?e.message:e,className:"error"})},isInvisible:!0})}}},onCustoViewChange:function(t){require(["DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/AttributesMgtV2"],function(r,i){try{t.selectedTypes=i.getSelectedTypes(),t.selectedExtensions=i.getSelectedExtensions()}catch(e){}e.widget.setValue("LibraryCusto_treelistview_v1",r.jsonZip(JSON.stringify(t)))})},onSaveAsTemplate:function(t){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/AttributesMgtV2"],function(r,i,n){try{t.selectedTypes=n.getSelectedTypes(),t.selectedExtensions=n.getSelectedExtensions()}catch(e){}t.hasOwnProperty("columnsOptimized")&&t.columnsOptimized.forEach(function(e){e.hasOwnProperty("label")&&delete e.label}),e.widget.setValue("LibraryCusto_treelistview_v1",i.jsonZip(JSON.stringify(t))),r.saveUserPreferences({name:e.widget.getValue("x3dAppId")+"_Library_v1",value:i.jsonZip(JSON.stringify(t)),onComplete:function(e){console.log("Saved as template")},onFailure:function(e){console.warn("Cannot save customization template")}})})},onSwitchView:function(){require("DS/LibraryEditor/ActionBar/LibraryCommandManager").updateCommands()},onToggleView:function(){require("DS/LibraryEditor/ActionBar/LibraryCommandManager").updateCommands()}}}}};return i.init(e),i}define("DS/LibraryEditor/service/LibraryServices",["DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,r,i,n){"use strict";return{AddContent:function(r){if(!UWA.is(r.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(r.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(r.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");if(r.IDs.length>0){var i,n=r.library,a=(i=n||e.getCurrentLibrary())?i.id||i.getID():"";a&&a.length?t.addcontent({pid:a,IDs:r.IDs,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var i=t.error;console.log("AddContent WebService Err : "+i),i.length>200&&(i=null),r.callbacks.onFailure(i)}else r.callbacks.onComplete(e)},onFailure:r.callbacks.onFailure}):r.callbacks.onFailure(r)}else r.callbacks.onFailure(r)},RemoveContent:function(r){if(!UWA.is(r.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(r.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(r.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");if(r.IDs.length>0){var i,n=r.library,a=(i=n||e.getCurrentLibrary())?i.id||i.getID():"";a&&a.length?t.removecontent({pid:a,IDs:r.IDs,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var i=t.error;console.log("Remove WebService Err : "+i),i.length>200&&(i=null),r.callbacks.onFailure(i)}else r.callbacks.onComplete(e)},onFailure:r.callbacks.onFailure}):r.callbacks.onFailure(r)}else r.callbacks.onFailure(r)},getLatestRevision:function(e){if(!UWA.is(e.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(e.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(e.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");var r=e.objectsToTreat;t.getLatestRevision({objectsToTreat:r,onComplete:function(t){var r=t?JSON.parse(t):void 0;if(r&&r.error){var n=r.error;console.log("getLatestRevision WebService Err : "+n),n.length>200&&(n=null),r.information&&i.displayNotification({message:r.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure})},replaceContent:function(r){if(!UWA.is(r.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(r.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(r.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");var i=r.IDsRemoved.length;if(i===r.IDsAdded.length&&i>0){var n=e.getCurrentLibrary(),a=n?n.id||n.getID():"";a&&a.length?t.replaceContent({pid:a,IDsRemoved:r.IDsRemoved,IDsAdded:r.IDsAdded,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var i=t.error;console.log("ReplaceContent WebService Err : "+i),i.length>200&&(i=null),r.callbacks.onFailure(i)}else r.callbacks.onComplete(e)},onFailure:r.callbacks.onFailure}):r.callbacks.onFailure(r)}else r.callbacks.onFailure(r)}}}),define("DS/LibraryEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/IPClassifyUtil/IPClassifyCommunication","UWA/Utils/InterCom"],function(e,t,r,i,n,a){"use strict";return t.extend({labelTopBar:e.i18n("Add Content"),isInsert:!0,data:{},_modalChooser:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/views/PADModalChooser","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/service/LibraryServices","DS/PADUtils/PADUtilsServices"],function(e,t,r,i,n,a,o){});var t=this;widget.addEvent("onRefresh",function(){UWA.is(t._modalChooser)&&(t._modalChooser.close(),t._modalChooser=null)})},beginExecute:function(){this._buildCellSkeleton()},initialize:function(){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new a.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.selected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener);var e=this.option_s();return this.socket.dispatchEvent("RegisterContext",e),this},selected:function(e){var t,r,i=[];if(this.callback){for(t=0,r=e.length;t<r;t++)i.push(e[t]);this.callback(i)}},option_s:function(e,t,r,i,n,a,o){var s=require("DS/LibraryEditor/utils/Library_CSO")._currentLibrary.id,l={};return l.title=e,l.mode="furtive",l.app_socket_id=this.socketName,null!==widget&&void 0!==widget?l.widget_id=widget.id:l.widget_id="",l.default_with_precond=!0,l.show_precond=!0,l.idcard_activated=!1,l.multiSel=n,l.role=r,l.precond="",l.specific_source_parameter={"3dspace":{additional_query:"NOT (interface:"+s+")"}},t&&(t=t.split(",")).forEach(function(e,t){0!==t&&(l.precond+=" OR "),l.precond+=e}),o&&o.length>0&&(l.columns=o),l},activate:function(e,t,r,i,a,o,s,l){var d=this.option_s(e,t,r,i,a,s,l);this.callback=o,!0===widget.getValue("noCompass")?n.publish("SelectFromSearch",d.specific_source_parameter["3dspace"].additional_query+" AND NOT (flattenedtaxonomies:(types/Libraries)) AND NOT (flattenedtaxonomies:(types/Classification))"):this.socket.dispatchEvent("InContextSearch",d)},launchSearch:function(e){e.additionalQuery="",this.initialize(),this.activate("Add Existing Item",e.allowedTypes,e.role||"",e.criteria,e.bMultiSel,function(e){this._objects_selected(e)},e.additionalQuery,e.selectable)},execute:function(){var e=this,t=require("DS/LibraryEditor/utils/Library_CSO"),r=require("DS/IPClassifyUtil/IPClassifyAlert"),i=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),n="";t.getCurrentLibrary()&&(n=t.getCurrentLibrary().getID()),n.length?(UWA.is(this._modalChooser)&&this._modalChooser.close(),setTimeout(function(){e.launchSearch({allowedTypes:"",role:"",criteria:"",additionalQuery:"",bMultiSel:!0,dg:e})})):r.displayNotification({message:i.msg_warning_nocurrentlibrary,className:"warning"})},_objects_selected:function(e){var t=require("DS/PADUtils/PADUtilsServices").getPlatformId(),r=[],i=!1;e.forEach(function(e){var n=e.resourceid,a=e.sourceid,o=null;if(a){var s=a.split(":");s.length>0&&(o=s[1])}o&&o!==t?i=!0:r.push(n)}),!0===i?IPClassifyAlert.displayNotification({message:Nls.msg_warning_addnotsupported_from_different_tenant,className:"warning"}):this._processInsertOperation(r)},_processInsertOperation:function(t){var r=require("DS/LibraryEditor/utils/Library_CSO"),n=require("DS/IPClassifyUtil/IPClassifyAlert"),a=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),o=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),s=require("DS/LibraryEditor/commands/LibraryCommands"),l=require("DS/LibraryEditor/service/LibraryServices"),d=(require("DS/LibraryEditor/service/LibraryEditorWebService"),r.getCurrentLibrary());t.length>0&&(s._startProgressBar(a.AddExisting_content_loading),l.AddContent({IDs:t,callbacks:{onComplete:function(r){s._offProgressBar();var l="",c=!1,u=(t.length,l=a.replace(a.add_in_class,{libraryname:d.options.label}));if(r){var f,y,p=JSON.parse(r),g=p.totalCount,b=p.failedCount,m=p.alreadyExistCount,v=p.errorMsg;b>0?(m>0?b==m?g==b?(l=a.all_in_class,f="info"):g>b&&(l=a.replace(a.few_added_few_exist,{OK:g-b,exist:m}),c=!0):b>m&&(g==b?l=a.replace(a.few_exist_few_failed,{exist:m,KO:b-m}):g>b&&(l=a.replace(a.few_added_few_exist,{OK:g-b,exist:m}),c=!0,y=a.replace(a.few_failed,{KO:b-m}),f="error")):b==g?l=a.all_failed:b<g&&(l=a.replace(a.few_added,{OK:g-b}),c=!0,y=a.replace(a.few_failed,{KO:b}),f="error"),l&&(l=u+": "+l)):(l=a.replace(a.msg_info_Addinlibrary,{number:g,libraryname:d.options.label}),c=!0),1==c?(i.setAuthoringMode("authoring",l),e.is(o.getContent())&&o.getContent().loadContentAndSelect(d),y&&(v&&(y=v),n.displayNotification({message:u+": "+y,className:f}))):(v&&(l=u+": "+v),f||(f="error"),n.displayNotification({message:l,className:f}))}},onFailure:function(e){s._offProgressBar(),n.displayNotification({message:e?a.msg_error_Addinlibrary+"<br>"+e:a.msg_error_Addinlibrary,className:"error"})}}}))},_buildCellSkeleton:function(){var t=require("DS/LibraryEditor/utils/LibraryEditorcontrol");e.is(t.getContent()._libraryContentView.elements.container)||(t.getContent().elements.container=e.createElement("span",{class:"fonticon fonticon-1x fonticon-search",title:"Find in Context"}))},endExecute:function(){}})}),define("DS/LibraryEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","DS/PADUtils/views/PADLevelSel","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,r,i){})},beginExecute:function(){},execute:function(){var e=require("DS/IPClassifyUtil/IPClassifyAlert"),t=require("DS/PADUtils/views/PADLevelSel"),r=require("DS/LibraryEditor/utils/Library_CSO"),i=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),n=null;null===(n=r.getCurrentLibrary())?e.displayNotification({message:i.msg_warning_noselection,className:"warning"}):new t({css_style:"",events:{onApply:function(e){n.expandNLevels({numberOfLevelsToExpand:parseInt(e),initialLevel:n.getNodeDepth()})}}})},endExecute:function(){}})}),define("DS/LibraryEditor/utils/FilterUtils",["UWA/Class"],function(e){"use strict";return e.singleton({init:function(e){this.libraryFilter='flattenedtaxonomies:"types/General Library"',this.classFilter=["General Class"],this.classTreeFilter='flattenedtaxonomies:"types/General Class"',this.endItemFilter=null,this.excludeBOTypesFromContentView=["Document Family","Part Family"]},setUQLFilter:function(e){this.endItemFilter=e},setFilters:function(e){for(var t,r=0;r<e.length;r++){var i,n,a=null,o=null;try{if((i=(a=e[r]).values)&&i.length>0){for(var s=0;s<i.length;s++)o=o&&null!=o?o+' OR "'+i[s]+'"':'"'+i[s]+'"';n="("+a.name+": ("+o+"))",t=t?t+" AND "+n:n}}catch(t){console.warn("Failed to decode","",e[r],t)}}this.endItemFilter=t},resetLibraryFilter:function(){this.libraryFilter=null},resetClassFilter:function(){this.classFilter=null},resetEndItemFilter:function(){this.endItemFilter=null}})}),define("DS/LibraryEditor/service/LibraryTypeService",["UWA/Controls/Abstract","text!DS/PADUtils/assets/PADOpenCommandsSettings.json"],function(e,t){return e.singleton({TYPE_ROOT_LIBRARY_1:"General Library",TYPE_ROOT_LIBRARY_2:"Part Library",TYPE_ROOT_LIBRARY_3:"RootLibrary",TYPE_LIBRARY_1:"General Class",TYPE_LIBRARY_2:"Library",TYPE_LIBRARIES_SECTION:"LibrarySection_AllLibraries",TYPE_FAVORITES_SECTION:"LibrarySection_favorite",STANDARD_USAGE:"Standard",RELATIONSHIP_STANDARD_CLASSIFIED_ITEM:"Standard Classified Item",RELATIONSHIP_CLASSIFIED_ITEM:"Classified Item",RELATIONSHIP_SUBCLASS:"Subclass",TYPE_CONTENT:"Content",openTypes:[],getOpenAvailableForTypes:function(e){if(0==this.openTypes.length&&e){var r=JSON.parse(t);r["openInCAD_"+e+"_supported_types"]&&(this.openTypes=r["openInCAD_"+e+"_supported_types"])}return this.openTypes},init:function(){},isRootLibrary:function(e){return e===this.TYPE_ROOT_LIBRARY_1||e===this.TYPE_ROOT_LIBRARY_2||e===this.TYPE_ROOT_LIBRARY_3},isLibrary:function(e){return e===this.TYPE_LIBRARY_1||e===this.TYPE_LIBRARY_2},isContent:function(e){return e===this.TYPE_CONTENT},inFamilyLibrary:function(e){return this.isRootLibrary(e)||this.isLibrary(e)},isSection:function(e){return e===this.TYPE_LIBRARIES_SECTION||e===this.TYPE_FAVORITES_SECTION},getPlmTypeFromContentDetails:function(e){if(e&&!(e.length<1)){for(var t,r,i,n,a="Content",o=0,s=e.length;o<s;++o)if("flattenedtaxonomies"===e[o].name){if("types/Classification"===e[o].value?t=!0:"types/General Class"===e[o].value?r=!0:"types/Libraries"===e[o].value?i=!0:"types/General Library"===e[o].value&&(n=!0),"types/Classification"===e[o].value[0]&&"types/General Class"===e[o].value[1]){a="Library";break}if("types/Libraries"===e[o].value[0]&&"types/General Library"===e[o].value[1]){a="RootLibrary";break}}return t&&r&&(a="Library"),i&&n&&(a="RootLibrary"),a}},getPLMTypeOfLibraryTreeNode:function(e){var t="";if(e){var r=e.plmType;t="Library"==r?"General Class":"RootLibrary"==r?"General Library":r}return t}})}),define("DS/LibraryEditor/utils/LibraryEditorcontrol",["UWA/Controls/Abstract"],function(e){return e.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_widgetOptions:{},getContent:function(){return this._Content},setContent:function(e){this._Content=e},getTreeCont:function(){return this._TreeCont},setTreeCont:function(e){this._TreeCont=e},getIdCardCont:function(){return this._IdCardCont},setIdCardCont:function(e){this._IdCardCont=e},setWidgetOptions:function(e){this._widgetOptions=e},getWidgetOptions:function(){return this._widgetOptions}})}),define("DS/LibraryEditor/LibraryWebInWin",["UWA/Widget","DS/i3DXCompass/Data","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/WidgetProxy","UWA/Drivers/Alone"],function(e,t,r,i,n){var a=window.library.params;window.widget=new e,console.log("Inside LibraryWebInWin"),widget.setValue("noCompass",!0);var o=i.getTenantId();o&&(widget.setValue("x3dPlatformId",o),r.setSetting("x3dPlatformId",o),n.setValue("x3dPlatformId",o)),widget.body=UWA.createElement("div",{class:"libraryEditor",styles:{height:"100%",width:"100%"}}),t.initialize({myAppsBaseUrl:a.myAppsUrl,userId:a.userId,passportUrl:"",proxyTicketUrl:""}),document.body.innerHTML="",widget.body.inject(document.body,"top"),window.top.performance.mark("createWidget_begin");var s=new LibraryEditor({widget:widget,filter:window.library.filter||window.library.UQLFilter,defaultSelectionPath:a.defaultSelectionPath,contextID:a.contextID});return widget.dispatchEvent("onLoad"),widget.dispatchEvent("onRefresh"),widget.dispatchEvent("onDestroy"),widget.dispatchEvent("onResize"),s}),define("DS/LibraryEditor/utils/LibrarySearch",["UWA/Class","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","text!DS/LibraryEditor/assets/library_exclude_columns.json"],function(e,t,r){"use strict";return e.singleton({init:function(e){this._parent(e),this._predicateToHeaderMap=null,this._dynamicHeaderMap=[],this._dynamicMapSorted=!1,this._searchInfo=null,this._predAttrMap=new Map,this._attrPredicateMap=new Map,this._defaultPredicates=["ds6w:label","physicalid","mxid","owner","ds6w:classificationUsage","ds6w:status"],this._authModePredicates=["ds6w:label","physicalid","mxid","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6wg:revision","ds6w:type","ds6w:identifier","ds6w:status","ds6w:reservedBy","policy","owner","ds6w:classificationUsage"],this._authPersonAttributes=["ds6w:reservedby","ds6w:responsible"];this._searchInfo={with_indexing_date:!0,select_predicate:this._defaultPredicates.slice(0),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25}},getAuthModeNoSortColumns:function(e,t){var r=[],i=this;return Array.isArray(e)&&e.forEach(function(e){var n=e.ds6w||e.dataIndex;if(-1==i._authModePredicates.indexOf(n)){var a=e.attrDBName;a&&1==a.length?t&&r.push(e):t?(e.sortableFlag=!1,r.push(e)):r.push(n)}else t&&("ds6w:description"===e.ds6w&&(e.sortableFlag=!1),r.push(e))}),r},getOrderFiledForAuthMode:function(e){return-1==this._authModePredicates.indexOf(e)&&this._predAttrMap.get(e)?this._predAttrMap.get(e)[0]||"ds6w:modified":e},getSearchInfo:function(e,t){var r=Object.assign({},this._searchInfo);return!0===e?r.select_predicate=this._authModePredicates:t&&(r.select_predicate=this._authModePredicates.concat(this.getAuthAttributes())),r},filterExcludeListColumns:function(e){var t=[],i=JSON.parse(r);if(i){i=i.columnToExclude;for(var n=0;n<e.length;++n)-1==i.indexOf(e[n].dataIndex)&&t.push(e[n])}return t},getAuthAttributes:function(){var e=Array.from(this._predAttrMap.values());return e=e.filter(function(e){return null!=e}),[].concat.apply([],e)},setPredicates:function(e,t){var i=this,n=JSON.parse(r),a=[];n&&(a=n.predicateToExclude,n=n.columnToExclude),Array.isArray(e)&&e.forEach(function(e){if(e){var t=e.ds6w;t||(t=e.dataIndex),"tree"===t||e.isDynamic||-1===i._searchInfo.select_predicate.indexOf(t)&&-1===n.indexOf(t)&&-1===a.indexOf(t)&&i._searchInfo.select_predicate.push(t);var r=e.attrDBName;if(r)for(var o in i._predAttrMap.set(t,r),r)i._attrPredicateMap.set(r[o],t)}})},removeAllPredicates:function(){this._searchInfo.select_predicate=[],this._predAttrMap=new Map,this._attrPredicateMap=new Map,this._searchInfo.select_predicate=this._searchInfo.select_predicate.concat(this._defaultPredicates)},removePredicates:function(e){for(var t=[],r=[],i=0;i<e.length;++i){r.push(e[i].dataIndex),this._predAttrMap.delete(e[i].dataIndex);var n=e[i].attrDBName||[];for(var a in n)this._attrPredicateMap.delete(n[a])}this._searchInfo.select_predicate.forEach(function(e){-1===r.indexOf(e)&&t.push(e)}),this._searchInfo.select_predicate=t},getPersonPredicatesForAuth:function(){return this._authPersonAttributes},setAttrNameToPredMapping:function(e){this._attrNameToPredMapping||(this._attrNameToPredMapping={}),this._attrNameToPredMapping&&e&&(this._attrNameToPredMapping[e.key]=e.value)},getAttrNameToPredMapping:function(){return this._attrNameToPredMapping||(this._attrNameToPredMapping={}),this._attrPredicateMap.forEach((e,t)=>{this._attrNameToPredMapping[t]=e}),this._attrNameToPredMapping},resetAttrNameToPredMapping:function(){this._attrNameToPredMapping=null},setPredicateUnitMapping:function(e){UWA.extend(this.getPredicateUnitMapping(),e,!0)},getPredicateUnitMapping:function(){return this._predicateUnitMapping||(this._predicateUnitMapping={}),this._predicateUnitMapping},initPredicateToHeaderMap:function(e){if(!this._predicateToHeaderMap){this._predicateToHeaderMap=[];for(var t=0;t<e.length;t++){var r=e[t],i=r.text?r.text.toLowerCase():null;if(i&&r.ds6w){var n={header:i,predicate:r.ds6w};this._predicateToHeaderMap.push(n)}}}},addToPredicateHeaderMap:function(e){for(var t=0;t<e.length;++t){var r=e[t],i=r.text?r.text.toLowerCase():null;if(i&&r.ds6w){var n={header:i,predicate:r.ds6w};this._predicateToHeaderMap.push(n)}}},removeFromPredicateHeaderMap:function(e){this._predicateToHeaderMap=this._predicateToHeaderMap.filter(function(e){for(var t=0;t<this.length;++t)if(this[t].ds6w==e.predicate)return!1;return!0},e)},addToDynamicHeaderMap:function(e){var t=e.text?e.text.toLowerCase():null;if(t&&e.dataIndex){var r={toolTip:e.text,header:t,dataIndex:e.dataIndex,dbAttribute:e.dbAttribute};this._dynamicHeaderMap.push(r)}},resetDynamicHeaderMap:function(){this._dynamicHeaderMap=[],this._dynamicMapSorted=!1},getDynamicHeaderMap:function(){return this._dynamicHeaderMap},convertSearchQueryToFederated:function(e){for(var t=e.split(""),r="",i="",n=0;n<t.length;n++)if(r+=t[n],":"==t[n]||"="==t[n]||">"==t[n]||"<"==t[n]){i=i.concat(this.replaceHeader(r));var a=e.substring(n+1).trim();if(a.startsWith("=")&&(i=i.concat("="),a=a.substring(1).trim()),a.startsWith('"')){i=i.concat('"');var o=(a=a.substring(1)).indexOf('"'),s=a.substring(0,o),l=s.trim().split(" ");if(2==l.length&&this._nlsUnitData&&this._nlsUnitData[l[1]]&&this._nlsUnitData[l[1]].factor){var d=l[0]*this._nlsUnitData[l[1]].factor+parseFloat(this._nlsUnitData[l[1]].offset);i=i.concat(d),this._nlsUnitData=null}else i=i.concat(s);i=i.concat('"'),a=a.substring(o+1)}else if(a.startsWith("(")){i=i.concat("(");var o=(a=a.substring(1)).indexOf(")");i=i.concat(a.substring(0,o+1)),a=a.substring(o+1)}-1!=(o=a.indexOf(" "))?(i=i.concat(a.substring(0,o+1)),a=a.substring(o+1),i=i.concat(this.convertSearchQueryToFederated(a))):i=i.concat(a);break}return""===i?e:i},replaceHeader:function(e){var t=e,r=this._predicateToHeaderMap;this._dynamicMapSorted||(this._dynamicHeaderMap=this._dynamicHeaderMap.sort(function(e,t){return t.header.length-e.header.length}),this._dynamicMapSorted=!0),r=r.concat(this._dynamicHeaderMap);for(var i=0;i<r.length;i++){var n=r[i].header,a=r[i].predicate?r[i].predicate:r[i].dataIndex,o=e.toLowerCase().indexOf(n);if(-1!=o){t=(t=(t=(t="").concat(e.substring(0,o))).concat("["+a+"]")).concat(e.substring(o+n.length)),this._predicateUnitMapping[a]&&(this._nlsUnitData=this._predicateUnitMapping[a].nlsToUnits);break}}return t}})}),define("DS/LibraryEditor/utils/LibraryEditorDataConversion",["DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/service/LibraryTypeService","DS/PADServices/utils/AttributesMgt","DS/LibraryEditor/utils/LibrarySearch","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,r,i,n){var a=function(e){var t=e.toLowerCase(),i=null;r.getAvailableColumns()&&(i=r.getAvailableColumns());var n=r.getTreeColumn(),a=null;return Array.isArray(i)&&i.every(function(e){return"tree"===e&&(e=n),t==e.toLowerCase()&&(a=e),null===a}),a=a||e},o={convertToExaleadDataFormatFederated:function(e){var t={children:null},r=e.attributes,o=i.getAttrNameToPredMapping(),s=i.getPredicateUnitMapping(),l={"ds6w:type":"type","ds6w:label":"label"},d={},c={};for(var u in r.forEach(function(e){if("resourceid"==e.name||"physicalid"==e.name)t.physicalid=e.value,t.resourceid=e.value;else if("mxid"==e.name)t.mxid=e.value;else if("nonNlsStatus"==e.name)t.status=e.value;else if("type_icon_url"===e.name)t.icons=[e.value];else if("preview_url"===e.name)t.thumbnail=e.value;else if(e.name.endsWith("inputunit")){if((f=e.name.substring(0,e.name.length-9)).startsWith("attribute["))f=f.substring(0,f.length-1);else(y=s.generatedPredicates)&&y[f]&&(f=y[f]);var r=c[a(f)];o[v=f]&&(v=o[f]);var i=s[f],u=e.value;i&&i[e.value]&&(u=i[e.value]),r?(c[a(f)]=r+" "+u,c[v]=r+" "+u):(c[a(f)]=u,c[v]=u)}else if(e.name.endsWith("inputvalue")){var f,y;if((f=e.name.substring(0,e.name.length-10)).startsWith("attribute["))f=f.substring(0,f.length-1);else(y=s.generatedPredicates)&&y[f]&&(f=y[f]);r=c[a(f)];o[v=f]&&(v=o[f]);u=e.value;r?(c[a(f)]=u+" "+r,c[v]=u+" "+r):(c[a(f)]=u,c[v]=u)}else if(e.name.startsWith("ds6w")){var p=e.name.split("/");if("ds6w:type"===(v=p[p.length-1])&&(S=e.value,["CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"].indexOf(S)>=0)?t.children=[]:"ds6w:created"===v&&(t.created=e.value),(u=e.object?e.object:e.dispValue)&&"boolean"!==e.type||(u=e.value),o[v]&&(v=o[v]),d[v]){u=[u];var g=d[v];Array.isArray(g)||(g=[g]),u=u.concat(g)}if("ds6w:created"===v||"ds6w:modified"===v)if(u.indexOf("T")<0&&(!n.isOnPremise()||n.isOnPremise()&&!0===n.isIndexedMode())){u=new Date(u);var b=new Date(u).getTimezoneOffset();u=new Date(new Date(u).getTime()+Math.abs(60*b*1e3))}else u=new Date(u);d[v]=u,d[e.name]=u;var m=l[v];m&&(t[m]=u,"ds6w:type"===v&&e.value&&(t[m]=e.value))}else if(e.value&&e.value.length>0){var v=e.name;o[v]&&(v=o[v]);var h=d[a(e.name)]||d[v];if(h)if(Array.isArray(h))h.push(e.value);else{var C=[h,e.value];d[a(e.name)]=C,d[v]=C}else{var _=e.value;-1!=_.indexOf(",")&&(_=_.split(",")),d[a(e.name)]=_,d[v]=_}}var S}),e.id||(e.id=t.resourceid),s)if(d[u+"_mksvalue"]=d[u],c[u])d[u]=c[u];else if(d[u]&&s[u]){var f=d[u];if(Array.isArray(f)){var y=[];f.forEach(function(e){if(e){var t=+e;t=t.toString().indexOf(".")>-1?t:t+".0",y.push(t+" "+s[u].defaultUnit)}}),d[u]=y}else{var p=+f;p=p.toString().indexOf(".")>-1?p:p+".0",d[u]=p+" "+s[u].defaultUnit}}return t.grid=d,t.padgrid={"ds6w:leaf":"False","ds6w:root":"True"},t},convertExpandToSearchFormat:function(e,t){var r=[];return t.forEach(function(t){var i=!1;t.attributes&&t.attributes.forEach(function(t){"physicalid"===t.name&&t.value!=e&&(i=!0)}),i&&r.push(t)}),r},convertNavigateToSearchFormat:function(e){var t=[],r=e[0].outputs.GET_CONTENT;return r&&r.forEach(function(e){var r=[];for(var i in e)r.push({name:i,value:e[i]});t.push({attributes:r})}),t},convertNavigateToFlatFormat:function(e,t){var r=[];if(t.length<=0)return r;for(var i=t[0],n=i.input_object,a=i.outputs,o=e,s=0;o>0;o--){var l=a["GET_PARENT_"+o+"_LIBRARY"];l&&((l=l[0]).level=s++,r.push(l))}return r.push(n),r},getLibraryDepth:function(e){var t=e.results[0].attributes,r=[];return t.forEach(function(e){"classification"===e.name&&r.push(e.value)}),r.length+1},getPathsAndObjectsFromExpand:function(e){if(e&&!(e.length<=0)){for(var t=[],r={},i={},n={},a=0,s=e.length;a<s;++a){var l=e[a];if(l.attributes){for(var d,c,u=!0,f=0,y=l.attributes.length;f<y;++f)"physicalid"===l.attributes[f].name?(u=!1,c=l.attributes[f].value):"did"===l.attributes[f].name&&(d=l.attributes[f].value);u||(r[c]=l,i[d]=c)}else if(l.path)t.push(l.path);else if(l.Path)t.push(l.Path);else if(l.icon__default_thumbnail_2d)for(var p=0;p<l.icon__default_thumbnail_2d.length;p++)for(var g=l.icon__default_thumbnail_2d[p].did,b=0;b<g.length;b++){var m=[];m.push(l.icon__default_thumbnail_2d[p].icon),m.push(l.icon__default_thumbnail_2d[p].thumbnail_2d),n[g[b]]=m}}for(var v in r)for(var h,C=r[v],_=0;_<C.attributes.length;_++)if("did"===C.attributes[_].name){h=C.attributes[_].value,C.attributes.push({name:"icons",value:n[h]});break}for(var S in r){var L=r[S],E=o.convertToExaleadDataFormatFederated(L);r[S]=E}var D=[];for(a=0;a<t.length;++a){var A=t[a],w=[];for(f=0;f<A.length;f+=2)w.push(i[A[f]]);D.push(w)}return{paths:D,objects:r}}}};return o}),define("DS/LibraryEditor/commands/ChangeMaturityFilterCmd",["i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],function(e,t,r){"use strict";return{applyMaturityFilter:function(e){var r=widget.getValue("filteredStates"),i=e.context;if(("AllMaturityStates"!=i||"selected"!==r[i])&&!function(e,t){var r=!0;if("selected"===e[t])for(const i in e)i!=t&&"selected"==e[i]&&(r=!1);else r=!1;return r}(r,i)){var n=[];for(const e in r)if("AllMaturityStates"!=e&&"selected"==r[e]){if(e==i)continue;n.push(e)}"unselected"==r[i]&&n.push(i),function(e,r){var i,n=t.getIdCardCont()._libraryCSO.getCurrentObject().plmType;if("LibrarySection_AllLibraries"!=n&&"LibrarySection_favorite"!=n&&"AllMaturityStates"!=e){i=t.getIdCardCont()._libraryCSO.getCurrentObject().options.grid["ds6w:status"];var a=!0;for(const e of r)if(i=="Classification."+e||i=="Libraries."+e){a=!1;break}if(a){var o=t.getTreeCont().getView()._rootNodeLibraries;o.getID||(o.getID=function(){return this.id}),o.getType||(o.getType=function(){return this.plmType}),t.getIdCardCont()._libraryCSO.addInCSO(o,"TREE")}}}(i,n),t.getTreeCont().dataProvider.updateMenuForStatesFilter(i),console.log("states applied "+n.toString())}},switchToAllMaturityFilterIfPathNotCompliant:function(e){var r=widget.getValue("filteredStates");if("selected"!=r.AllMaturityStates){var i=[];for(const e in r)"AllMaturityStates"!=e&&"selected"==r[e]&&i.push(e);var n="";if(Array.isArray(e))for(var a=0;a<e.length;a++){n=e[a]._options?e[a]._options.grid["ds6w:status"]?e[a]._options.grid["ds6w:status"]:e[a]._options.status:e[a]["ds6w:status"];var o=!0;for(const e of i)n!="Classification."+e&&n!="Libraries."+e||(o=!1);if(o)break}else{n=e._options?e._options.grid["ds6w:status"]?e._options.grid["ds6w:status"]:e._options.status:e["ds6w:status"];o=!0;for(const e of i)if(n=="Classification."+e||n=="Libraries."+e){o=!1;break}}o&&t.getTreeCont().dataProvider.updateMenuForStatesFilter("AllMaturityStates",!0)}}}}),define("DS/LibraryEditor/commands/ChangeMaturityFilterCmdUtil",["i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],function(e,t,r){"use strict";return{getMaturityFilterForIndexedSearch:function(e){var t=widget.getValue("filteredStates");e||(e={});var r={"ds6w:what/ds6w:status":[]},i=[];if("selected"==t.AllMaturityStates)return e;for(const e in t)"AllMaturityStates"!=e&&"unselected"==t[e]&&i.push(e);if(0==i.length)return e;if(i.forEach(e=>{let t={object:"Classification."+e,type:"string",field:"internal",excluded:"true"},i={object:"Libraries."+e,type:"string",field:"internal",excluded:"true"};r["ds6w:what/ds6w:status"].push(t),r["ds6w:what/ds6w:status"].push(i)}),e)for(const t in e)"ds6w:what/ds6w:status"==t?r["ds6w:what/ds6w:status"]=r["ds6w:what/ds6w:status"].concat(e[t]):r[t]=e[t];return r},getFiltersForExpand:function(){var e=widget.getValue("filteredStates"),t="";if("selected"==e.AllMaturityStates)return t;for(const r in e)"AllMaturityStates"!=r&&"selected"==e[r]&&("Private"==r?(""!=t&&(t+=" OR "),t+="([ds6w:status]:Classification.Inactive) OR ([ds6w:status]:Libraries.Inactive)"):(""!=t&&(t+=" OR "),t=t+"([ds6w:status]:Classification."+r+") OR ([ds6w:status]:Libraries."+r+")"));return"AND ("+t+")"},getMaturityFilterForAuthSearch:function(){var e=widget.getValue("filteredStates"),t=[];if("selected"==e.AllMaturityStates)return t;for(const r in e)"AllMaturityStates"!=r&&"selected"==e[r]&&t.push(r);return t}}}),define("DS/LibraryEditor/service/LibraryEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/utils/FilterUtils","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/commands/ChangeMaturityFilterCmdUtil"],function(e,t,r,i,n,a,o,s,l,d){"use strict";function c(e){return UWA.is(e,"array")?e.toString():e}return{_pageCount:50,content:function(e){var t={};UWA.extend(t,e);var r=o.endItemFilter,i=!1;r&&null!=r?("Library"==t.selectedType&&(i=!0),r=" AND ("+r+")"):r="";var n="";if(t.searchQuery)t.isSearchWithin=!0,e.isExactSearch?(n=a.convertSearchQueryToFederated(e.searchQuery),n="classification: "+e.mxid+' AND NOT (flattenedtaxonomies: ("types/Part Family" OR "types/Document Family"))'+r+" AND ("+n+")"):n="("+e.searchQuery.trim()+"* ) AND classification: "+e.mxid+' AND NOT (flattenedtaxonomies: ("types/Part Family" OR "types/Document Family"))'+r;else if(i)n='flattenedtaxonomies:"types/General Class" OR ('+o.endItemFilter+")",t.isExpand=!0;else{n=function(e,t,r){if(t&&t.length>0){var i="";!0===r&&(i="NOT");for(var n=0,a=t.length;n<a;++n)e=e?e+" AND "+i+'(type == "'+t[n]+'" )':i+'( type == "'+t[n]+'" )'}return e}(n,o.excludeBOTypesFromContentView,!0),t.isExpand=!0}"Library"==t.selectedType&&(t.dynamicattrs=t.dynamicattributes),t.searchPageCount=this._pageCount,this._performSearchQuery(t,n,"content")},roots:function(e){var t='flattenedtaxonomies:"types/Libraries"',r=o.libraryFilter;r&&null!=r&&(t=r),!0!==e.fetchAll&&(e.searchPageCount=this._pageCount),e.searchQuery&&(t=t+" AND "+e.searchQuery),this._performSearchQuery(e,t,"roots")},favourites:function(e){this._performFetchQuery(e,"favourites")},libraries:function(e){var t={};UWA.extend(t,e),t.expand_iter="1",e.isExpandAll&&(t.expand_iter="-1");var r=o.classTreeFilter;t.filter=r,this._performExpandQuery(t,"libraries")},checkModifyAccessOnItems:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.addcontent");var r=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/checkModifyAccess";t.headers={"content-type":"application/json"},t.data={objectIds:e.objectIds},t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(r,t,"checkModifyAccess")},addcontent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.addcontent");var r=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/addItemsV2";if(t.headers={"content-type":"application/json"},t.IDs){var i=t.IDs,n=[];i.forEach(function(e){n.push({id:e})}),t.data={objectId:n},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(r,t,"addContent")},replaceContent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.replaceContent");var r=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/replaceByRevision";t.headers={"content-type":"application/json"},t.IDsRemoved&&t.IDsAdded&&(t.data={IDsRemoved:c(t.IDsRemoved),IDsAdded:c(t.IDsAdded)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(r,t,"replaceContent")},getLatestRevision:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getLatestRevision");var r=s.get3DSpaceUrl()+"/resources/v1/dslc/getlastversions?validIntents=E&";t.headers={"content-type":"application/json"};var i=t.objectsToTreat;i&&(t.data=i),t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(r,t,"getLatestRevision")},removecontent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.removecontent");var r=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/removeClassifiedItems";if(t.headers={"content-type":"application/json"},t.IDs){var i=[];t.IDs.forEach(function(e){i.push({id:e})}),t.data={objectId:i},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(r,t,"removeContent")},getLibraryPathLength:function(e){e.fetchClassification=!0,this._performFetchQuery(e,"getLibraryPathLength")},getLibraryPath:function(e){var t={};UWA.extend(t,e);for(var r={},i=t.depth,n=1;n<=i;n++)r["GET_PARENT_"+n+"_LIBRARY"]=[{id:2,iter:n}];t.patterns=r,this._performNavigateQuery(t,"getLibraryPath")},_performNavigateQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t={};UWA.extend(t,e);var r=i.getSetting("pad_security_ctx"),n=s.get3DSpaceUrl()+"/cvservlet/navigate";n+="?SecurityContext="+r;var l=widget.lang?widget.lang:widget.getValue("lang"),d=[];d.push(e.pid),t.payload={},t.payload.input_physical_ids=d;var c=o.classFilter;c&&null!=c&&"RootLibrary"==e.selectedType?t.payload.primitives=[{navigate_to_rel:{id:1,filter:{bo_type:c}},navigate_from_rel:{id:2}}]:t.payload.primitives=[{navigate_to_rel:{id:1},navigate_from_rel:{id:2}}],t.payload.patterns=t.patterns;var u=a.getSearchInfo(!0).select_predicate;if(u=u.concat(["flattenedtaxonomies"]),e.dynamicattrs&&e.dynamicattrs.length>0){var f=u.concat(e.dynamicattrs);t.payload.attributes=f}else t.payload.attributes=u;t.payload.version=3;var y=new Date;return t.payload.label=("LibraryWidgetNavigate_"+y.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(n,t,"searchInLibrary")},_performExpandQueryIndex:function(e,t,r){var a={};UWA.extend(a,e);let o=n.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson",s=[];a.pid&&(a.children||(a.children=[]),a.children.push(a.pid));var l='((flattenedtaxonomies:"types/General Class")OR (flattenedtaxonomies:"types/General Library")) '+d.getFiltersForExpand();return a.children.forEach((e,r)=>{let i={label:t+"_"+r,root:{physical_id:e},parameters:{graph_advise:1,limit_max_path:1e4},graph:{descending_condition_object:{uql:l}},filter:{all:1}};a.expand_iter>=0&&(i.aggregation_processors=[{truncate:{max_distance_from_prefix:a.expand_iter,prefix_filter:{prefix_path:[{physical_id_path:[e]}]}}}]),s.push(i)}),a.payload={batch:{expands:s},outputs:{select_object:r,format:"entity_relation_occurrence",hits:{predefined_computation:["mythumbnail2d","icons"]}}},a.headers={SecurityContext:i.getSetting("pad_security_ctx"),"content-type":"application/json"},a.type="json",a.data=UWA.Json.encode(a.payload),a.method="POST",this._executeRequest(o,a,"expandFolder")},_performExpandQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t=a.getSearchInfo(!0).select_predicate;t=t.concat(["flattenedtaxonomies"]);var r=["svg","bi_color"],i=t.filter(function(e){return r.indexOf(e)<0});let n=("LibraryWidgetExpand_"+(new Date).getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");return e.dynamicattrs&&e.dynamicattrs.length>0&&(i=i.concat(e.dynamicattrs)),this._performExpandQueryIndex(e,n,i)},_performFetchQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t={};UWA.extend(t,e);var r=i.getSetting("pad_security_ctx"),n=s.get3DSpaceUrl()+"/cvservlet/fetch/v2";n+="?SecurityContext="+r;var o=widget.lang?widget.lang:widget.getValue("lang"),l=a.getSearchInfo(!1,e.isAuthoringMode).select_predicate;l=l.concat(["flattenedtaxonomies"]),t.payload={},e.dynamicAttrs&&e.dynamicAttrs.length>0&&(t.payload.classification_attribute=e.dynamicAttrs,e.dynamicAttrs.forEach(function(e){-1===l.indexOf(e)&&l.push(e)}));var d=["svg","bi_color"],c=l.filter(function(e){return d.indexOf(e)<0});!0===e.fetchClassification&&c.push("classification"),t.payload.physicalid=t.ids,t.payload.select_predicate=c,!0===e.isAuthoringMode&&(n=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/getContentDetails",t.payload.person_predicate=a.getPersonPredicatesForAuth(),t.payload.compute_select_bo=["icon","thumbnail_2d"]);var u=new Date;return t.payload.label=("LibraryWidgetFetch_"+u.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":o},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(n,t,"Fetch")},_performSearchQuery:function(e,t){var r;if(e&&e.grid&&(r=e.grid["ds6w:classificationUsage"]),!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var n={};UWA.extend(n,e);var o=s.get3DSearchUrl()+"/search",l=widget.lang?widget.lang:widget.getValue("lang");n.payload=Object.assign({},a.getSearchInfo(!1,e.isAuthoringMode));var c=n.payload.select_predicate;if(n.securityContextRequired=!1,!0===e.isAuthoringMode){n.securityContextRequired=!0,o=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/Search/search",n.payload.person_predicate=a.getPersonPredicatesForAuth(),n.payload.root_physicalid=e.pid;var u=d.getMaturityFilterForAuthSearch();u.length&&(n.payload.states_to_fetch=u)}c=c.concat(["flattenedtaxonomies"]),e.dynamicattributes&&e.dynamicattributes.length>0&&(c=c.concat(e.dynamicattributes)),n.payload.select_predicate=c;var f=new Date,y=Math.random();y.toString(36);var p=this.getRelationsByUsage(r),g=y.toString(36).substr(2,9);return n.payload.label=("LibraryWidgetSearch_"+g+"_"+f.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),n.payload.locale=l,n.payload.query=t,n.payload.tenant=s.getTenantId(),n.payload.next_start=e.next_start,n.payload.start=e.start,n.method="POST",n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l},n.type="json",e.order_field&&(e.isAuthoringMode?n.payload.order_field=a.getOrderFiledForAuthMode(e.order_field):n.payload.order_field=e.order_field,n.payload.order_by=e.order_by),e.searchPageCount&&(n.payload.nresults=e.searchPageCount),!0===e.fetchAll&&(n.payload.nresults=1e3),r&&(n.payload.usage=r),e.isAuthoringMode||(n.payload.source=["3dspace"],n.payload.login={"3dspace":{SecurityContext:i.getSetting("pad_security_ctx")}},e.isExpand?n.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,expand_iter:"1",type_filter_rel:p}},option:{with_Idx_Search:!0}}}:e.isSearchWithin&&(n.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0}}}),e.filters&&(n.payload.refine=e.filters),n.payload.refine=d.getMaturityFilterForIndexedSearch(e.filters)),n.data=UWA.Json.encode(n.payload),this._executeRequest(o,n,"searchInLibrary")},_executeRequest:function(e,n,a){var o=Math.round(1e3*Math.random()).toString(),s=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("libraryRequest_begin"+o);var l={};if(UWA.extend(l,n),!l.payload&&e.indexOf("cvservlet")>-1){l.payload={};var d=new Date;l.payload.label=("LibraryWidgetExecute_"+d.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-")}UWA.is(l.onTimeout,"function")||(l.onTimeout=function(){var e={type:"timeout",toString:function(){return r.msg_InfoAction_Timeout}};l.onFailure(e)},l.onComplete=function(e){window.top.performance.mark("libraryRequest_end"+o);var t=window.top.performance.getEntriesByName("libraryRequest_begin"+o);t&&1===t.length&&(window.top.performance.measure(s+"_Request"+a,"libraryRequest_begin"+o,"libraryRequest_end"+o),window.top.performance.clearMarks("libraryRequest_end"+o),window.top.performance.clearMarks("libraryRequest_begin"+o)),n.onComplete(e)});var c={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};return!1!==l.securityContextRequired&&(c.SecurityContext=i.getSetting("pad_security_ctx")),l.informationPanelContext&&(c.SecurityContext=l.informationPanelContext),n.headers?l.headers=UWA.extend(c,n.headers):l.headers=c,t.authenticatedRequest(e,l)},getClassificationAttributes:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes");var r=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.classid+"/getclassificationattributes";return t.method="GET",this._executeRequest(r,t,"getClassificationAttributes")},getDimensionsInfos:function(e){return this._executeRequest(s.get3DSpaceUrl()+"/resources/dictionary/dimensions",e,"getDimensionsInfos")},convertDimensionUnits:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.convertDimensionUnits");var t=s.get3DSpaceUrl()+"/resources/dictionary/dimensions/convertValues",r={};return UWA.extend(r,e),r.payload=e.data,r.method="POST",r.headers={Accept:"application/json","content-type":"application/json"},r.data=UWA.Json.encode(r.payload),this._executeRequest(t,r,"convertToPreferedUnit")},getRelationsByUsage:function(e){var t=[l.RELATIONSHIP_SUBCLASS];return e===l.STANDARD_USAGE?t.push(l.RELATIONSHIP_STANDARD_CLASSIFIED_ITEM):t.push(l.RELATIONSHIP_CLASSIFIED_ITEM),t},fetchExistingClassesAndAttributes:async function(e){var t,r=e;if(!UWA.is(r,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes");return t=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/"+e.objectId+"/getAllClassesAndAttributes",r.method="GET",this._executeRequest(t,r,"fetchExistingClassesAndAttributes")},getClassificationAttributesForClassifedObjectOnOneClass:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.convertDimensionUnits");var t=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/getAttributesOfObjectForClass",r={};return UWA.extend(r,e),r.payload=e.data,r.method="POST",r.headers={Accept:"application/json","content-type":"application/json"},r.data=UWA.Json.encode(r.payload),this._executeRequest(t,r,"getClassificationAttributesForClassifedObjectOnOneClass")},updateAttributesFromInformationPanel:function(e){console.log("Calls Libraryeditorwebservice",e);var t={};UWA.extend(t,e);var r={requests:[]};(new Date).getTime();var i={method:"PATCH",body:[],queryParams:{select:["physicalid","modified"]}};i.path="model/bus/"+e.pid,i.classUsage=e.classUsage,i.classId=e.classId,i.body=[];var n={op:"replace"};n.path=e.attributeName,Array.isArray(e.value)?n.value=e.value.slice():n.value=e.value,null!=e.unit&&(n.unitName=e.unit,n.dimensionType=e.dimension),i.body.push(n),i.queryParams.select.push("attribute["+e.attributeName+"]"),r.requests.push(i),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json"},t.type="json",t.payload=r,t.data=UWA.Json.encode(t.payload);var a=s.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/attributes/update",o=this._executeRequest(a,t,"updateAttributes");return console.log(o),o}}}),define("DS/LibraryEditor/utils/Library_CSO",["DS/Selection/XSO","DS/Logger/Logger","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/commands/ChangeMaturityFilterCmd","DS/IPClassifyUX/IPClassifyUXEvents","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/PADUtils/PADProbes"],function(e,t,r,i,n,a,o,s){"use strict";var l=e.singleton({name:"library_cso",_logger:null,_currentLibrary:null,init:function(e){var r={areEquals:function(e,t){return e===t}};UWA.extend(r,e),this._parent(r),this._logger=t.getLogger(l);var i=this;this.onPostAdd(function(e){var t="CONTENT";UWA.is(e,"array")&&(e=e[0]),e&&UWA.is(e.getID,"function")&&e.getID()==i.getCurrentLibraryID()&&(t="TREE"),UWA.is(e)&&a.notifyLibrarySelected({context:t,selectedNode:e})})},addInLibraryCSO:function(e,t){if(!UWA.is(e))throw new Error("No libraryNode specified");if(!UWA.is(t))throw new Error("No context specified");var l=s.createProbe("library_addInLibraryCSO");if("TREE"==(t=t.toUpperCase())){var d=this;this.empty(!1);var c=this._currentLibrary;this._currentLibrary=e;var u=function(e,t){a.notifyCurrentLibraryChange({previousNode:e,currentNode:t}),d.add(t),l.end()};this._currentLibraryPath=[{id:e.id,type:r.getPLMTypeOfLibraryTreeNode(e),label:e.getLabel(),mxid:e.options.mxid}];var f=!1;if(r.inFamilyLibrary(e.plmType)){if(e.isVisible&&e.isVisible()&&e.getPath){var y=e.getPath();if(Array.isArray(y)&&y.length>=2&&y[0]&&"LibrarySection_AllLibraries"===y[0].plmType){this._currentLibraryPath=[];for(var p=1;p<y.length;p++){var g=y[p];this._currentLibraryPath.push({id:g.id,type:r.getPLMTypeOfLibraryTreeNode(g),label:g.getLabel()})}f=!0}}}else f=!0;f?u(c,e):i.getLibraryPathLength({ids:[e.id],onComplete:function(t){!t.results&&t.error&&(d._logger.warn("Unable to retrieve LibraryPath using Index/Search"),u(c,d._currentLibrary));var r=o.getLibraryDepth(t);if(1===r){var a={};a.id=e.id,a.type=e.plmType,a.label=e.options.label,n.switchToAllMaturityFilterIfPathNotCompliant(e),d._currentLibrary&&a.id==d._currentLibrary.id?(d._currentLibraryPath=[],d._currentLibraryPath.push({id:a.id,type:a.type,label:a.label}),u(c,d._currentLibrary)):d._logger.log("LibraryPath returned by Index do not corresponds to the current Library")}else if(r>1){var s=r-1;i.getLibraryPath({depth:s,pid:e.id,onComplete:function(e){var t=o.convertNavigateToFlatFormat(s,e.result);n.switchToAllMaturityFilterIfPathNotCompliant(t),d._currentLibrary&&t[r-1].physicalid==d._currentLibrary.id&&(d._currentLibraryPath=[],t.forEach(function(e){d._currentLibraryPath.push({id:e.physicalid,type:e["ds6w:type"],label:e["ds6w:label"]})}),u(c,d._currentLibrary))},onFailure:function(e){d._logger.warn("Unable to retrieve LibraryPath using Index/Navigate"),u(c,d._currentLibrary)}})}},onFailure:function(e){d._logger.warn("Unable to retrieve LibraryPathLength using Index/Search"),u(c,d._currentLibrary)}})}else{this.empty(!1);var b=null;0===(b="array"==UWA.typeOf(e)?e:[e]).length?(this.add(this._currentLibrary),l.end()):(this.add(b),l.end())}},removeFromLibraryCSO:function(e){if(!UWA.is(e))throw new Error("No libraryNode specified");this.remove(e),0===this.getSelectedNodes().length&&e!=this._currentLibrary&&this.add(this._currentLibrary)},removeAllFromLibraryCSO:function(){this.empty(!0)},getCurrentLibrary:function(){return this._currentLibrary},getCurrentLibraryID:function(){var e=null;return this._currentLibrary&&this._currentLibrary.getID&&(e=this._currentLibrary.getID()),e},getCurrentLibraryPath:function(){var e=[];return this._currentLibraryPath&&this._currentLibraryPath.forEach(function(t){e.push({id:t.id,type:t.type,label:t.label})}),e},getSelectedNodes:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t)}),e},getSelectedNodesID:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t.getID())}),e}});return l}),define("DS/LibraryEditor/dataProvider/LibraryCSODataProvider",["UWA/Class","DS/LibraryEditor/utils/Library_CSO"],function(e,t){"use strict";return e.singleton({getCurrentObject:function(){return t.getCurrentLibrary()},getCurrentObjectPath:function(){return t.getCurrentLibraryPath()},addInCSO:function(e,r){t.addInLibraryCSO(e,r)},getSelectedNodes:function(){return t.getSelectedNodes()},getSelectedNodesID:function(){return t.getSelectedNodesID()}})}),define("DS/LibraryEditor/commands/ActionBar_ReplaceByLatestRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/service/LibraryServices","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUX/utils/IPClassifyModeManager"],function(e,t,r,i,n,a,o,s,l,d){"use strict";var c=[];function u(e,t,r){var i=t;!UWA.is(r)||r instanceof Error||(i+="<br>"+r),o.displayNotification({message:i,className:"error"})}return t.extend({labelTopBar:e.i18n("Replace By Latest Revision"),isInsert:!0,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e={},t=[],r=i.getSelectedNodes(),n=r.length;r&&r.length<101?(r.forEach(function(e){var r={id:e.id};t.push(r)}),e={lastVersionRequests:t},s.getLatestRevision({objectsToTreat:e,callbacks:this._treatLatestRevision(n,r)})):o.displayNotification({message:l.msg_warning_replaceByLatestRevision_NotMorethan100Objects,className:"warning"}),this.end()},_treatLatestRevision:function(t,r){return{onComplete:function(t){var n=[],a=[],f=JSON.parse(t);f.lastVersionRequests.length>0&&f.lastVersionRequests.forEach(function(e){if(e.islast){var t=r.find(function(t){return t.id===e.id}),i={};i[t.options.label+" "+t.options.grid["ds6wg:revision"]]="isLatestRevision",c.push(i)}else n.push(e.id),a.push(e.candidates[0])});var y=n.length,p=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),g=require("DS/LibraryEditor/commands/LibraryCommands"),b=i.getCurrentLibrary();if(y>0){n.length;g._startProgressBar(l.ReplaceByRevision_content_loading),s.replaceContent({IDsRemoved:n,IDsAdded:a,callbacks:{onComplete:function(t){g._offProgressBar();var r="",i=n.length;if(t){var a=JSON.parse(t);r=a.information?" ("+a.information+")":r}var o=l.replace(l.msg_warning_replaceByLatestRevision_MultiObject_AlreadyLatest,{number:c.length}),s=l.replace(l.msg_info_ReplaceByLatestRevision,{number:i,libraryname:b.options.label}),u=c.length?s+"\n"+o+r:s+r;d.setAuthoringMode("authoring",u),e.is(p.getContent())&&p.getContent().loadContentAndSelect(b)},onFailure:function(e){g._offProgressBar(),u(0,l.msg_error_ReplaceBylatestRevision,e)}}})}else o.displayNotification({message:l.msg_warning_replaceByLatestRevision_sameObject,className:"warning"})},onFailure:function(e){LibraryCommands._offProgressBar(),u(0,l.msg_error_ReplaceBylatestRevision,e)}}},endExecute:function(){c=[]}})}),define("DS/LibraryEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],function(e,t,r,i,n,a){"use strict";return t.extend({labelTopBar:i.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(t){this._parent(t,{});var o=this;r.onChange(function(){o._adaptStateToCurrentLibrary()}),this.onStateChange(function(){if(o.getState()){if(t=r.getCurrentLibrary()){s=t.getID(),l=t.getType(),d=t.options.label;if(s&&a.inFamilyLibrary(l))if(e.is(n.getTreeCont()))0==n.getTreeCont().isLibraryAmongFavoriteLibraries(s)&&n.getTreeCont().addFavorite({id:s,name:d})}o.labelTopBar=i.label_ActionBar_RemoveFromFavorites}else{var t;if(t=r.getCurrentLibrary()){var s=t.getID(),l=t.getType(),d=t.options.label;if(s&&a.inFamilyLibrary(l))if(e.is(n.getTreeCont()))if(1==n.getTreeCont().isLibraryAmongFavoriteLibraries(s))!1===n.getTreeCont().removeFavorite({id:s,name:d})&&o.setState(!0,!1)}o.labelTopBar=i.label_ActionBar_AddToFavorites}})},_adaptStateToCurrentLibrary:function(){var t=r.getCurrentLibrary();if(t&&t.getID){var i=t.getID();if(e.is(n.getTreeCont())){var a=!1;n.getTreeCont().isLibraryAmongFavoriteLibraries(i)&&(a=!0),this.setState(a,!1)}}}})}),define("DS/LibraryEditor/commands/ActionBar_ReplaceByRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/service/LibraryServices","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUX/utils/IPClassifyModeManager"],function(e,t,r,i,n,a,o,s,l,d,c,u,f,y){"use strict";return t.extend({labelTopBar:e.i18n("Replace By Revision"),isInsert:!0,_selectedNodes:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e=null;if(1==(e=null===this._selectedNodes?i.getSelectedNodes():this._selectedNodes).length){var t=this.validPhysicalIDtobeReplaced=e[0].getID();this._launchVersionExplorer(t),this.end()}else c.displayNotification({message:f.msg_warning_replaceByRevision_MultiObject,className:"warning"})},endExecute:function(){this._selectedNodes=null},_launchVersionExplorer:function(t){var r=this,i=e.createElement("div",{class:"revisionUpdate-dialog-versionexplorer"}).inject(document.body);this._myVersionExplorer=new o({versionGraphContainer:null,selectionMode:l.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:widget}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},i,!0),s.loadUserSettingsPromise({displayMode:l.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:r.validPhysicalIDtobeReplaced,tenantId:n.getPlatformId()?n.getPlatformId():"",securityContext:a.getSetting("pad_security_ctx"),onComplete:function(){},dataModelType:l.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,t),!1),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,t),!1),this._dlgVersionExplorer=d._dlg,d._dlg&&d._dlg.rightButtons&&d._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,t)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._myVersionExplorer.subscribeEvent("select",function(e){r._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1}),this._myVersionExplorer.subscribeEvent("unselect",function(e){r._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0})},_onVersionExplorerModalCancel:function(e){this._myVersionExplorer.unsubscribeAll()},_onVersionExplorerModalOK:function(t){var r=require("DS/LibraryEditor/commands/LibraryCommands"),n=require("DS/LibraryEditor/utils/LibraryEditorcontrol");this._myVersionExplorer.unsubscribeAll();var a=this._myVersionExplorer.getSelectedNodes().shift().getAttribute("id"),o=i.getCurrentLibrary();if(a!==this.validPhysicalIDtobeReplaced){r._startProgressBar(f.ReplaceByRevision_content_loading);var s=[],l=[];s.push(this.validPhysicalIDtobeReplaced),l.push(a),u.replaceContent({IDsRemoved:s,IDsAdded:l,callbacks:{onComplete:function(t){r._offProgressBar();var i="",a=l.length;if(t){var s=JSON.parse(t);i=s.information?" ("+s.information+")":i}y.setAuthoringMode("authoring",f.replace(f.msg_info_Replaceinlibrary,{number:a,libraryname:o.options.label})+i),e.is(n.getContent())&&n.getContent().loadContentAndSelect(o)},onFailure:function(e){r._offProgressBar(),function(e,t,r){var i=t;!UWA.is(r)||r instanceof Error||(i+="<br>"+r),c.displayNotification({message:i,className:"error"})}(0,f.msg_error_ReplaceByRevision,e)}}})}else c.displayNotification({message:f.msg_warning_replaceByRevision_sameObject,className:"warning"})},_getVersionExploreforODT:function(){return this._myVersionExplorer?this._myVersionExplorer:null},setNode:function(e){this._selectedNodes=[e]}})}),define("DS/LibraryEditor/utils/LibraryEditorUtil",["UWA/Utils","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUX/events/IPClassifyEvents","DS/IPClassifyUX/utils/IPClassifyModeManager","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUX/IPClassifyUXEvents","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyPreference","UWA/Utils/Client"],function(e,t,r,i,n,a,o,s,l,d,c,u,f){var y={nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},shouldBeEditable:function(e){return!1},onNodeModelUpdate:function(e){var n=e.data.nodeModel;if(r.inFamilyLibrary(n.plmType)){H=n._lastUpdateTime?n._lastUpdateTime:0,J=Date.now()-H;if(n._lastUpdateTime=Date.now(),console.log("lastUpdateTime : "+H+", elapsedTime : "+J),!(0!==H&&J<300))if(n._resetting)n._resetting=!1;else{k=n.getID();var c=n.options.label,u=n.options.oldLabel;if(void 0===u&&(u=""),c!==u){c&&c.trim&&(c=c.trim());var f=!0;c.length>y.nameRules.maxLength&&(i.displayNotification({message:o.replace(o.get("msg_error_name_maxlength"),{name:c,maxLength:y.nameRules.maxLength}),className:"error"}),f=!1),0==c.trim().length&&(i.displayNotification({message:o.get("msg_error_name_empty"),className:"error"}),f=!1);var p=y.nameRules.notAllowedChars;for(W=0;W<p.length;W++){var g=p[W];if(-1!=c.indexOf(g)){i.displayNotification({message:o.replace(o.get("msg_error_name_badchars"),{name:c,badChars:y.nameRules.notAllowedChars.join(", ")}),className:"error"}),f=!1;break}}if(f){if(n.isFavorite&&UWA.is(s.getTreeCont())){var b={id:k,name:u};s.getTreeCont().renameFavorite(b,c,n)}}else n.withTransactionUpdate(function(){this.setLabel(u)})}}}else{var m=e.data.attributes,v=Object.keys(m).toString(),h=e.attributeInfo.predicates;if(Object.keys(h).includes(v)&&!(Object.keys(m).length>1)){if(n._resetting)return void(n._resetting=!1);var C=v.split(":")[1];C!==h[v]&&(C=h[v]);var _=C;if(C=C.replace(/_/g," "),void 0===m[v])return;var S=n.attributeValue[v],L="",E=null,D=null,A=null,w=e.attributeInfo.dimensions,P=!1,I=!1,T=e.attributeInfo.rangeAttributes,x=!1,U=!1,N=null,O=e.attributeInfo.attributeTitle[C];Array.isArray(m[v])?(A=[],A=m[v].slice(),I=!0):(A=m[v].toString(),N=A,A=A.trim());var M,F,R=null;if(T[C]&&T.isNLSavailable)if(U=!0,I){R=[];for(var W=0;W<A.length;W++)if(!T[C][A[W]]){var V=Object.keys(T[C]).find(e=>T[C][e]===A[W]);R.push(A[W]),A[W]=V}}else if(!T[C][A]){V=Object.keys(T[C]).find(e=>T[C][e]==N);R=A,A=V}if(S&&N&&(S==A||S==N))return;void 0!==e.attributeInfo.integers&&e.attributeInfo.integers.length>0&&!U&&e.attributeInfo.integers.forEach(e=>{if(e.predicate==v&&1!=n._resetting)if(x=!0,I){for(var t=0;t<A.length;t++)if(isNaN(A[t]))n._resetting=!0;else if(!Number.isInteger(parseFloat(A[t]))){n._resetting=!0;var r=o.replace(o.get("msg_warning_attributeValue"),{value:A[t],attributeName:O});i.displayNotification({message:r,className:"warning"});break}}else if(isNaN(m[v]))n._resetting=!0;else if(!Number.isInteger(parseFloat(m[v]))){n._resetting=!0;r=o.replace(o.get("msg_warning_attributeValue"),{value:A,attributeName:O});i.displayNotification({message:r,className:"warning"})}}),void 0!==w&&w.length>0&&w.forEach(e=>{if(e.predicate==v&&void 0!==e.unit)if(P=!0,L=e.unit,D=e.dimension,E=e.unitName,Array.isArray(A)){A.length<1&&(A=[]),P=!1,F=!0;var t=[];M=[],A.forEach(e=>{let r=(e=e.replace(" "+L,""))+" "+L;M.push(r),t.push(e)}),A=t}else A||(A=""),A=A.replace(" "+L,"")}),P&&(Number.isInteger(Number(A))&&(A=parseFloat(A).toFixed(1).toString()),M=A+" "+L,n.prepareUpdate(),n.setAttribute(v,M),n.pushUpdate());var k=n.id,B=m[v],j=!1,q=function(e){return parseInt(e)<9?"0"+e:e};if(Date.parse(A)&&"function"==typeof B.getMonth){j=!0;var G=B.getUTCFullYear()+"/"+(parseInt(q(B.getUTCMonth()))+1)+"/"+q(B.getUTCDate())+"@"+q(B.getUTCHours())+":"+q(B.getUTCMinutes())+":"+q(B.getUTCSeconds())+":GMT";console.log("Converted to GMT date: "+G),A=G}var H=n._lastUpdateTime?n._lastUpdateTime:0,J=Date.now()-H;if(n._lastUpdateTime=Date.now(),0!==H&&J<300)return;if(n._resetting)return n.prepareUpdate(),n.setAttribute(v,S),void n.pushUpdate();var z=l.getCurrentLibrary().id,X=l.getCurrentLibrary()._options.usage;t.updateAttributesFromInformationPanel({attributeName:_,value:A,pid:k,unit:E,dimension:D,classId:z,classUsage:X,onComplete:function(e){d&&d.notifyLibrarySelected({context:"CONTENT",selectedNode:l.getSelectedNodes()[0]});var t=o.replace(o.get("msg_warning_attributeValue"),{value:A,attributeName:O});if(x&&(t=o.get("msg_warning_integer")),e&&e.errors){e.errors=e.errors.replace(C,O);var r=e.errors.split("\n");t=r[0],r[1]&&(t=r[1]),i.displayNotification({message:t,className:"warning"}),n._resetting=!0,n.prepareUpdate(),n.setAttribute(v,S),n.pushUpdate()}else{P?n.attributeValue[v]=M:F?(M.length>1&&(n._resetting=!0),n.prepareUpdate(),n.setAttribute(v,M),n.pushUpdate(),R=M,n.attributeValue[v]=M):n.attributeValue[v]=A,t=j?o.replace(o.get("msg_info_updateAttribute"),{attribute:O,value:B}):o.replace(o.get("msg_info_updateAttribute"),{attribute:O,value:R||A}),console.log("Updated the attribute"),a.setAuthoringMode("authoring",t),a.updateRefreshTime();var s={},c=[];c.push(k),s.modified=c,s.fromRenameOp=!1}},onFailure:function(e,t,r,a){var s=o.replace(o.get("msg_error_update"),{attribute:O});t&&t.contains("NumberFormatException")?(s=o.replace(o.get("msg_error_validNumber"),{attributeName:O}),i.displayNotification({message:s,className:"warning"})):i.displayNotification({message:s,className:"error"}),console.log("Error while updating the attribute :"+e),n._resetting=!0,n.prepareUpdate(),n.setAttribute(v,S),n.pushUpdate()}})}}},getCurrentSecurityContextAndLibraryData:function(e){var t=l.getCurrentLibrary(),i=c.getSetting("pad_security_ctx"),n=widget.getValue("pad_tenant"),a={From:"LibraryEditor",LibraryID:null,LibraryType:null,IsInDeletedItems:!1,Timestamp:Date.now(),Tenant:n,SecurityContext:i};return t&&(r.inFamilyLibrary(t.plmType)||e)&&(a.LibraryID=t.getID(),a.LibraryType=t.getType()),a},sortColumn:function(e,t){var i=r.inFamilyLibrary(e.plmType),n=r.inFamilyLibrary(t.plmType);return i&&!n?-1:!i&&n?1:0},_repeatMode:0,getRepeatMode:function(){return this._repeatMode},setRepeatMode:function(e){this._repeatMode=e?1:0},setContentViewPreference:function(e,t){return new Promise(function(r){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUtil/IPClassifyUtility"],function(i,n){widget.setValue("LibraryCusto_treelistview_v1",n.jsonZip(JSON.stringify(e))),t?i.saveUserPreferences({name:self.widget.getValue("x3dAppId")+"_Library_v1",value:n.jsonZip(JSON.stringify(e)),onComplete:function(e){r()},onFailure:function(e){r()}}):r()})})},getClassAttrPos:function(){return new Promise(function(e){u.get("LibraryEditor_v1_ClassAttrsToLeft",function(t){t&&t.hasOwnProperty("dynamicAttributesTop")?e(t.dynamicAttributesTop):u.get("LibraryEditor_v1_ClassAttrsToLeft",function(t){t&&t.hasOwnProperty("dynamicAttributesTop")?e(t.dynamicAttributesTop):e(!1)},!1)},!0)})},setClassAttrPos:function(e,t){var r={dynamicAttributesTop:e};u.set("LibraryEditor_v1_ClassAttrsToLeft",r),t||u.set("LibraryEditor_v1_ClassAttrsToLeft",r,!t)},setLeftPanelStatus:function(e){u.set("lib_view_status",{leftPanelState:e},!0,!1)},setRightPanelStatus:function(e){u.set("lib_view_status",{rightPanelState:e},!0,!1)},getLeftPanelStatus:function(){return new Promise(function(e){u.get("lib_view_status",function(t){t&&t.hasOwnProperty("leftPanelState")?e(t.leftPanelState):e({leftPanelState:!0,isWelcomePanelCollapsed:!1})},!0)})},copyUrlToCLipboard:function(e){var t="";return new Promise((r,i)=>{!navigator.clipboard||f.Platform.hasOwnProperty("ios")&&!0===f.Platform.ios?(!function(e){var r=document.createElement("textarea");if(r.value=e,document.body.appendChild(r),f.Platform.hasOwnProperty("ios")&&!0===f.Platform.ios){r.contentEditable=!0,r.readOnly=!0;var i=document.createRange();i.selectNodeContents(r);var n=window.getSelection();n.removeAllRanges(),n.addRange(i),r.setSelectionRange(0,r.value.length)}else r.select();try{t=document.execCommand("copy")}catch(e){}document.body.removeChild(r)}(e),t?r([""]):i([""])):navigator.clipboard.writeText(e).then(function(){r([""])},function(e){i([""])})})},getRightPanelStatus:function(){return new Promise(function(e){u.get("lib_view_status",function(t){t&&t.hasOwnProperty("rightPanelState")?e(t.rightPanelState):e({rightPanelState:!1,size:250})},!0)})}};return y}),define("DS/LibraryEditor/commands/ActionBar_RepeatModeCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,r,i){"use strict";return e.extend({labelTopBar:i.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{}),this.onStateChange(function(){var e=this.getState();t.setRepeatMode(e);var n=i.msg_info_repeatModeDisabled;e&&(n=i.msg_info_repeatModeEnabled),r.displayNotification({message:n,className:"primary"})})}})}),define("DS/LibraryEditor/commands/ActionBar_ColumnVisibilityCmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/WidgetServices/WidgetServices","DS/LibraryEditor/utils/LibrarySearch","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/library_exclude_columns.json","DS/LibraryEditor/utils/LibraryEditorUtil"],function(e,t,r,i,n,a,o,s){"use strict";var l=JSON.parse(o).columnToExclude;return e.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{});var r=t.get();UWA.is(r.addEvent,"function")&&r.addEvent("onToggleView",this._check_if_treeview.bind(this))},execute:function(){var e=this;s.getClassAttrPos().then(function(o){require(["DS/IPClassifyColumnCusto/IPClassifyColumnCusto","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2"],function(l,d,c){var u=t.get(),f=u.options.views?u.options.views.datagridview:void 0;if(f){for(var y=d.getModelEvents(),p=[],g=f.options.dgvLayout.getOrderedColumnsIndexes(),b=0;b<g.length;++b){var m=f.options.dgv.getColumnOrGroup(g[b]);p.push(m)}var v=f.options.viewMode,h=f.options.dgvLayout.rowsHeader,C=c.getDefaultTypesAndExtensions();f.columnOrdering=!0,e.columnCusto=new l({modelEvents:y,viewMode:v,appColumns:p,baseInstanceTypes:[],selectedTypes:c.getSelectedTypes(),selectedExtensions:c.getSelectedExtensions(),defaultTypes:C.defaultTypes,defaultExtensions:C.defaultExtensions,fetchTypesFromDictionary:!1,withDgv:!0,dgvInfo:f,rowHeaderActivated:h,manageAttrFromInstance:!1,dbOnlyAttributes:!0,showNonDBAttributesAsWell:!0,addValueInAuthoringColumn:!i.isNatifEnvironnement(),preMappedAttriForAuthoring:{"ds6w:description":!0,"ds6w:label":!0,"ds6w:type":!0,"ds6w:responsible":!0,"ds6w:reservedBy":!0},enableDynamicAttributesPos:!0,dynamicAttrCheckBoxName:r.dynamicAttrCheckBoxName,dynamicAttrCheckBoxValue:o});var _=[];_.push(y.subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":if(t.removedColumns&&f.removeColumnCB(t.removedColumns),t.addedColumns){var r=e._filterExcludeColumns(t.addedColumns),i=r.filter(function(e){return f.options.dgv.getColumnOrGroup(e.dataIndex)});f&&i.length>0&&f.changeDBAttributeCB(i),(r=r.filter(function(e){return!f.options.dgv.getColumnOrGroup(e.dataIndex)}))&&r.length>0&&(a.isIndexedMode()||(r=n.getAuthModeNoSortColumns(r,!0)),f.addColumnCB(r))}break;case"visibilityColumn":f.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag);break;case"moveColumn":if(t.move2perform){var o=f.options.dgvLayout.getVisibleOrderedLeafColumns();if(o&&o.length>0){var l=t.move2perform.fromIndex?t.move2perform.fromIndex:o[f.options.dgvLayout.getColumnIndex(t.move2perform.fromID)].dataIndex,d=t.move2perform.toIndex?t.move2perform.toIndex:o[f.options.dgvLayout.getColumnIndex(t.move2perform.toID)].dataIndex;f.options.dgvLayout.moveColumn(l,d,{isUserInteraction:!0}),f.columnOrdering=!0}}void 0!==t.dynamicAttributesTop&&s.setClassAttrPos(t.dynamicAttributesTop,!0);break;case"changeTitle":f.changeTitleCB(t.modifiedColumn,t.newTitle);break;case"pinChange":f.changePinCB(t.modifiedColumn,t.pin);break;case"rowsHeaderModification":f.changeDgvLayout({rowsHeader:t.rowsHeader});break;case"changeViewMode":f.compactMode(t);break;case"close":t.selectedExtensions&&t.selectedTypes&&c.updateSelectedParams({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}),f.saveCustoView(t.applyOnlyToThisApp),void 0!==t.dynamicAttributesTop&&s.setClassAttrPos(t.dynamicAttributesTop,t.applyOnlyToThisApp),_.forEach(function(e){y.unsubscribe(e)});break;case"reset":c.resetSelectedParams(),f.options.dgvLayout.deleteDataGridViewPreferences(),f.reset(t.parameters),s.setClassAttrPos(!1,!0),_.forEach(function(e){y.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+t.what)}}))}})})},_filterExcludeColumns:function(e){var t=[];return e.forEach(function(e){-1===l.indexOf(e.dataIndex)&&t.push(e)}),t},_check_if_treeview:function(){"datagridview"===t.get().getPADTreeDocument().options.active_view?this.enable():this.disable()},_getColumnCusto:function(){return this.columnCusto}})}),define("DS/LibraryEditor/utils/LibraryMigration",["DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyNav/views/customize_views/_xNavDGVUtils","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,r,i){return{migrateContentPreferences:function(r,i){var n=[];if((!r.version||r.version<1)&&i>=1){var a=new Promise(function(n){r.columnsOptimized?(new t).buildColumns("datagridview").then(function(t){for(var a=t.columns,o=0;o<a.length;++o){var s=a[o].dataIndex;if("ds6w:status"===s){for(var l=!1,d=0;d<r.columnsOptimized.length;++d)if(r.columnsOptimized[d].dataIndex===s){l=!0;break}if(!l){var c=a[o];c.visibleFlag=!1,r.columnsOptimized.push(c)}}}r.version=i,e.setContentViewPreference(r,!0).then(function(){n()})}):n()});n.push(a)}return Promise.all(n)},migrateFavPreferences:function(e,t){return new Promise(function(e){1==t?r.get("ipcFavoriteList_v1",function(n){r.set(i.getTenantAwarePreferenceName("ipcFavoriteList_v1"),n,!1,!1),r.set("LibraryFavPrefVersion",{version:t},!1),e()},!1):e()})},migrateTreeStructurePreferences:function(e,t){return new Promise(function(e){1==t?r.get("ipcTreeStrucure_v1",function(n){r.set(i.getTenantAwarePreferenceName("ipcTreeStrucure_v1"),n),r.get("ipcTreeSelectedNode_v1",function(n){r.set(i.getTenantAwarePreferenceName("ipcTreeSelectedNode_v1"),n),r.set("LibraryTreeStrcutPrefVersion",{version:t}),e()})}):e()})}}}),define("DS/LibraryEditor/ActionBar/LibraryCommandManager",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUX/IPClassifyUXEvents","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/PADServices/utils/GlobalModelEvents","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/LibraryProbesCommandMapping.json"],function(e,t,r,i,n,a,o,s,l,d,c){"use strict";var u={},f=JSON.parse(c);return e.singleton(o,{noSizeToFit:["libraryLocation"],initialize:function(){a.onLibrarySelected(()=>{this.updateCommands()}),n.onEmpty(()=>{this.enableAllCommands(!1)}),t.onCommandStart(e=>{var t=u[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})});var e=new Promise(e=>{require(["text!DS/LibraryEditor/assets/afr/LibraryEditor.json"],e)});return new Promise(t=>{e.then(e=>{var r={};if(e)for(var i in(r=JSON.parse(e)).headers){r.headers[i].ID=i}u=r.Rules,t(r)})})},revaluateContentValue:function(e,t){if(!0===e.CONTENT)return!0;if(!t.checkWhiteClick&&!t.isFavoriteNode&&t.isCtxMenu&&!1===e.CONTENT.ctxMenu)return!1;var r=!0;return!0===e.CONTENT.Libraries?r=t.isLibrary||t.isRoot:!1===e.CONTENT.Libraries&&(r=!t.isLibrary&&!t.isRoot),!1!==r&&1==e.CONTENT.favCtxMenuOnly&&(r=t.isCtxMenu&&!t.isMultiSelect&&t.isFavoriteNode),!1!==r&&(!0===e.CONTENT.classifiedItem?r=t.isclassifiedItem:!1===e.CONTENT.classifiedItem&&(r=!1)),!1!==r&&1==t.isCtxMenu&&t.isFavoriteNode&&e.CONTENT&&!0===e.CONTENT.ctxFavOnMultiSel&&(r=!0),r},revaluateTreeValue:function(e,t){if(!0===e.TREE)return!0;if(!t.checkWhiteClick&&!t.isFavoriteNode&&t.isCtxMenu&&!1===e.TREE.ctxMenu)return!1;var r=!0;return!0===e.TREE.Sections?r=t.isSection:!1===e.TREE.Sections&&(r=!t.isSection),!1!==r&&(!0===e.TREE.RootLibraries?r=t.isRoot:!1===e.TREE.RootLibraries&&(r=!t.isRoot)),!1!==r&&(!0===e.TREE.Libraries?r=t.isLibrary||t.isRoot:!1===e.TREE.Libraries&&(r=!t.isLibrary&&!t.isRoot)),r},_manageSwitchOfCommands:function(e,t,n,a){var o=!1,s=n&&!!t&&0===t.length;e&&!s?o=e.isFavorite:t&&t.length>0&&(o=t[0].isFavorite);var d=!1,c=!1,f=!1,y=!1,p=!1,g=!1,b=!1;e&&(g="LibrarySection_favorite"==e.plmType,b="LibrarySection_AllLibraries"==e.plmType,y=i.isRootLibrary(e.plmType),p=i.isLibrary(e.plmType));var m=g||b,v=!1;t&&t.every(function(e){return d=d||i.isRootLibrary(e.plmType),c=c||i.isLibrary(e.plmType),v=v||"Busy"===e.plmType,f=f||i.isContent(e.plmType),!d||!c||!v});var h=!0;if((g||v||(b||!e)&&t&&0===t.length)&&(h=!1),n||this.enableAllCommands(h),!v){var C={},_=Object.keys(u);a&&(_=a);var S={};return S.isCtxMenu=n,S.isFavoriteNode=o,S.checkWhiteClick=s,_.forEach(i=>{var a=u[i];if(a){var g=t&&t.length>0,b=e&&(!g||void 0===a.CONTENT),v=!0;"object"==typeof a&&(a.isContentItem&&g&&"Content"==t[0].plmType&&(v=!1),a.isContentItem&&l.isNatifEnvironnement()&&(v=!1),(v&&!1===a.TREE&&b||!1===a.CONTENT&&g)&&(v=!1),v&&s&&!0!==a.white_click&&(v=!1),v&&void 0!==a.multisel&&(v=!t||t.length<=1),v&&!1===a.NoSelection&&(v=t&&t.length>0),v&&a.views&&(v=a.views.indexOf(r.getContent().getView().getActiveView())>=0),v&&n&&o&&!0!==a.ctxFavorite&&!a.isContentItem&&(v=t&&t.length>1&&1==a.CONTENT.ctxFavOnMultiSel),v&&!1===a.CATIAV6&&(v=!0!==widget.getValue("noCompass")),v&&!1===a.NOT_WEBInWin&&(v=!0===widget.getValue("noCompass")),v&&a.TREE&&b&&(S.isSection=m,S.isRoot=y,S.isLibrary=p,b=this.revaluateTreeValue(a,S)),v&&a.CONTENT&&g&&(S.isRoot=d,S.isLibrary=c,S.isclassifiedItem=f,S.isMultiSelect=t&&t.length>1,g=this.revaluateContentValue(a,S)),v=v&&(!0===g||!0===b||null===g&&null===b)),C[i]=v,n&&!s||this._switchCommand(i,v,a.type),n||"openWith"!==i||this.getModelEvents().publish({event:"build_openwith",data:{visible:v,nodes:g?t:[e]}})}}),C}},getCommand:function(e){var r=t.getCommands(e);return r=r||t.getCommandCheckHeader(e)},enableAllCommands:function(e){var r=t.getCommands();for(var i in r){var n=t.getCommand(i);UWA.is(n)&&n.enable&&(e?this._switchCommand(i,!0):this._switchCommand(i,!1))}},getModelEvents:function(){return s.getModelEvents()},updateCommands:function(e,t){if(t||(t=n.getCurrentLibrary()),r.getContent().getView().getPADTreeDocument()){var i=r.getContent().getView().getPADTreeDocument().getSelectedNodes();i=i||(e?[e]:[]),this._parent(t,i)}},launchCommand:function(e,t,r,i){let n=e;f&&f[e]&&(n=f[e]),"ContextualMenu"===i?d.sendTrackerPageEvent("LibraryWidget_contextual",n):d.sendTrackerPageEvent("LibraryWidget_iconBar",n),this._parent.apply(this,arguments)}})}),define("DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider",["UWA/Class","UWA/Class/Promise","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/ActionBar/LibraryCommandManager","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUX/LibrarySearchWithinController"],function(e,t,r,i,n,a,o,s){"use strict";return e.singleton({getChildrenInfos:function(e){return new t(function(t){var a=r.getTreeCont()._getVisibleNodeById(e);if(a){var o=a.getChildren();t(o)}else i.libraries({pid:e,onComplete:function(r){var i=[];r.results?i=n.convertExpandToSearchFormat(e,r.results):r.result&&(i=n.convertNavigateToSearchFormat(r.result)),i.forEach(function(e){e.plmType=e.plmType||"Library"}),t(i)},onFailure:function(e){console.warn("WebService libraries Err : "+e),t([])}})})},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},getStableAreaWidth:function(e,t){try{var i=[],n=o.isSection(t.getType());return i=(i=r.getContent().getView().getPADTreeDocument().getSelectedNodes())||(iData?[iData]:[]),n&&0==i.length?143:e?212:175}catch(e){}},getLibraryControl:function(){return r},getSearchWithinController:function(){return s},getCommandManager:function(){return a},getLibraryTypeService:function(){return o}})}),define("DS/LibraryEditor/commands/LibraryCommands",["DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADProgressBar","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/OpenWithMenuBuilder","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/LibraryProbesCommandMapping.json","DS/LibraryEditor/ActionBar/LibraryCommandManager"],function(e,t,r,i,n,a,o,s,l,d,c,u,f){"use strict";JSON.parse(u);return{_endProgressBarListener:function(){var e=this;n.getContent().getView().addEvent("onCompleteRefreshNodes",function(t){this.removeEvent("onCompleteRefreshNodes"),e._offProgressBar()})},_offProgressBar:function(){if(0===s._counter)return null;s.off()},_commonError:function(t,r,i){console.error(t,i);var n=r;!UWA.is(i)||i instanceof Error||(n+="<br>"+i),e.displayNotification({message:n,className:"error"})},_startProgressBar:function(e){1===s._counter&&s.off(),s.on(e)},_nbItemsNotNull:function(e){var t,r=e.length,i=0;for(t=0;t<r;++t)e&&i++;return i},RenameCmd:function(e,t){if("CONTENT"==t){var r=e.manager.layout.getColumnIndex("tree"),i=e.manager.layout.getCellsFromNodeModel(e.nodeModel)[r];(n=e.manager.getEditionManager(i)).onF2&&(e.manager.setActiveCell(i),n.onF2(i))}else{var n;r=e.manager.layout.getColumnIndex("tree"),i=e.manager.layout.getCellsFromNodeModel(e.nodeModel)[r];(n=e.manager.getEditionManager(i)).onF2&&(e.manager.setActiveCell(i),n.onF2(i))}},RemoveContentCmd:function(e,t){var r=o.getCommand("RemoveContent",n.getContent());r&&r.begin()},ExpandAllCmd:function(i,n){i.plmType;var a=[];"TREE"===n&&i?a.push(i):a=t.getSelectedNodes();var o=null;o=t.getCurrentLibrary(),a.length?a.forEach(function(e){null===e.options.children||e.expandAll()}):null===o?e.displayNotification({message:r.msg_warning_nocurrentlibrary,className:"warning"}):o.expandAll()},CollapseAllCmd:function(i,n){i.plmType;var a=[],o=t.getCurrentLibrary();"TREE"===n&&i?a.push(i):a=t.getSelectedNodes(),a.length?a.forEach(function(e){e.collapseAll()}):null===o?e.displayNotification({message:r.msg_warning_noselection,className:"warning"}):o.collapseAll()},Information:function(){var e=n.getContent()._infoPanelView;e._context.elements.padshell._isRightOpen||e._modelEv.publish({event:"information-panel-open"})},RemoveFavoriteCmd:function(e,t){var r=e;if(console.log("  RemoveFavoriteCmd currentFavoriteTreeNode : ",r),r&&r.isFavorite){var i=r.getID(),a=r.options.label;console.log("  currentLibrary Id : ",i),i&&UWA.is(n.getTreeCont())&&n.getTreeCont().removeFavorite({id:i,name:a})}},AddExistingCmd:function(e,t){var r=o.getCommand("AddExistingContent",n.getContent());r&&r.begin()},CreateLink:function(e,t){var r=o.getCommand("CreateLink",n.getContent());openInCADCmd&&r.begin()},OpenInCADCmd:function(e,t){var r=o.getCommand("OpenInCADHdr",n.getContent());r&&r.begin()},GetContextualMenu:function(e,r,i){var a,o=!!e.white_Click&&e.white_Click,s=i?n.getContent().getView().getPADTreeDocument().getSelectedNodes():[];if(void 0===(a=!0===o?a=t.getCurrentLibrary():s&&s.length>0?s:e.nodeModel)&&(a=e),a&&!Array.isArray(a)&&(a=[a]),!i)i={cellInfos:e,data:{event:{pageX:0,pageY:0}}};return f.getContextualMenu(a,"TREE"===r,i)},_addHiddenInput:function(e){var t=n.getContent().getView();UWA.createElement("a",{href:e,styles:{display:"hidden"}}).inject(t.elements.container).click()}}}),define("DS/LibraryEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/PADUtils/PADContext"],function(e,t,r){"use strict";return e.extend({execute:function(){var e=r.get().ctxInfo;switch(this.options.ID){case"RenameCmd":!function(e){var r=e.options.cellInfos,i=e.options.isTree;t.RenameCmd(r,i?"TREE":"CONTENT")}(e);break;case"Information":t.Information()}}})}),define("DS/LibraryEditor/utils/LibraryEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/ActionBar/LibraryCommandManager","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUX/events/IPClassifyEvents","DS/Logger/Logger"],function(e,t,r,i,n,a,o,s,l,d){var c=t.extend({name:"LibraryEditorKeyboardListener",init:function(e){this._parent(e),this._logger=d.getLogger(c),this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown_binded)},_onKeyDown:function(e){var t=this,n=r.whichKey(e);e.ODTENVKeyName&&(n=e.ODTENVKeyName);var d,c,u,f=function(){var e=document.activeElement;return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)};switch(n){case"ctrl+a":d=n,c="SelectAll",(u=a.getCommand(c))&&u.isEnabled()?f()?t._logger.log("Info : '"+d+"' key pressed in INPUT field, no command launched"):(u.begin(),r.stop(e)):t._logger.log("Info : '"+d+"' key pressed, but command '"+c+"' is disabled");break;case"alt+return":l.notifyInfoExpand();break;case"ctrl+f":var y=i.getIdCardCont();y._isSearchAvailable()&&(y.switchSearch(!0),r.stop(e));break;case"f2":if(f())t._logger.log("Info : '"+n+"' key pressed in INPUT field, no command launched");else{var p=o.getSelectedNodes(),g=o.getCurrentLibrary();if(g.pathId&&!g.pathId.includes("LibrarySection_favorite"))break;if((Array.isArray(p)?p.length:0)>=1){var b=p[0];if(b&&s.inFamilyLibrary(b.plmType)&&i.getTreeCont().getView().isTreeNodeModelInstance(b))if(g.getID()==b.getID()){var m=i.getTreeCont();m&&m.switchLibraryTreeNodeLabelToWriteView&&m.switchLibraryTreeNodeLabelToWriteView(g)}else{var v=i.getContent();v&&v.switchLibraryTreeNodeLabelToWriteView&&v.switchLibraryTreeNodeLabelToWriteView(b)}else t._logger.log("Info : '"+n+"' key pressed but selected element is not a Library, no command launched")}else t._logger.log("Info : '"+n+"' key pressed when no element selected, no command launched")}}}});return c}),define("DS/LibraryEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],function(e,t,r,i){"use strict";return t.extend({labelTopBar:e.i18n("Collase All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=i.getSelectedNodes();if(e.length){var t=e[0];r.CollapseAllCmd(t,"CONTENT")}else{var n=i.getCurrentLibrary();r.CollapseAllCmd(n,"TREE")}},endExecute:function(){}})}),define("DS/LibraryEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/LibraryEditor/commands/LibraryCommands","DS/WidgetServices/WidgetServices"],function(e,t,r,i,n,a){"use strict";return t.extend({labelTopBar:e.i18n("Remove Content"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/LibraryEditor/commands/LibraryCommands"],function(e){})},beginExecute:function(){},execute:function(){require(["DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUtil/IPClassifyAlert","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryEditorWebService","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(t,r,a,o,s,l,d,c){var u=t.getCurrentLibrary();if(u){var f={},y=[],p=t.getSelectedNodes(),g=p.length;if(g>0){y=[];p.forEach(function(t){y.push(e.is(t.id)?t.id:t.options.resourceid)})}var b=!1;function m(d){r.confirmDialog(d,function(){u.getType();var r=t.getSelectedNodes();if(r.length>0){n._startProgressBar(c.Remove_content_loading);var d=o.getCommand("RemoveContent",l.getContent());d.disable();var f=[],y=null;r.forEach(function(t){null===y&&"noExpandState"!==t._expandState&&!0===widget.getBool("filtered-content")&&(y=!0),f.push(e.is(t.id)?t.id:t.options.resourceid)}),s.RemoveContent({IDs:f,callbacks:{onComplete:function(e){if(i.setAuthoringMode("authoring",c.replace(c.msg_info_objetremoved,{number:f.length,libraryname:u.options.label})),y||f.length>10)l.getContent().RefreshProductStructure=!0,l.getContent().loadContentAndSelect(u);else{for(var t=0;t<f.length;t++){var r=f[t];l.getContent()._libraryContentView.removeNodeInContent(r)}i.updateRefreshTime()}0===l.getContent()._libraryContentView.options.model.getAllDescendants().length&&l.getContent().getView()._addPlaceHolder(),n._offProgressBar()},onFailure:function(e){if(n._offProgressBar(),d.enable(),"string"==typeof e)n._commonError("RemoveContentCmd",c.msg_error_Removefromlibrary,e);else{var t=e.errorMsg;e.itemsNotRemovedCount>1&&(t=t||c.msg_error_itemsNotRemoved+"<br>"+e.itemsNotRemovedCount),a.displayNotification({message:e?t:c.msg_error_Removefromlibrary,className:"warning"}),e.itemsNotRemovedCount&&e.itemsNotRemovedCount<f.length&&(i.setAuthoringMode("authoring","none"),l.getContent().RefreshProductStructure=!0,l.getContent().loadContentAndSelect(u))}}}})}else a.displayNotification({message:c.msg_warning_nocontent,className:"warning"})})}function v(t,r,i){var n=[],a=[{dataIndex:"Tree",text:c.Title},{dataIndex:"modifyAccess",text:c.Access,typeRepresentation:"boolean"},{dataIndex:"Maturity",text:c.Maturity},{dataIndex:"Type",text:c.Type}];r.forEach(function(t){var r={};r.Tree=e.is(t.options.label)?t.options.label:t.options.grid.Name,r.Type=t._options.grid["ds6w:type"],r.Maturity=t._options.grid["ds6w:status"],r.modifyAccess=!i||!i.includes(t.id),n.push(r)}),t.cols=a,t.data=n}f.deleteButtonLabel=c.title_remove,g>1?(b=!0,f.titleLabel=c.title_remove+" "+g+" classified items",f.warningMessage=c.replace(c.msg_removeContents,{className:u._options.label})):(f.titleLabel=c.title_remove+" - "+p[0]._options.label,f.warningMessage=c.replace(c.msg_removeContent,{objectLabel:p[0]._options.label,className:u._options.label})),u._options&&u._options.grid&&"Definition"==u._options.grid["ds6w:classificationUsage"]?d.checkModifyAccessOnItems({objectIds:y,onComplete:function(e){var t=e?JSON.parse(e):void 0;b&&v(f,p,t.unModifiableIds),b&&t.unModifiableIds.length>0&&(f.confirmationBoxText=c.confirmationMsgMultiple,f.showDGV=!0,f.enableConfirmationBox=!0,f.moreInfo=c.msg_removeContentsMoreInfo,v(f,p,t.unModifiableIds)),t.unModifiableIds.length>0&&(f.confirmationBoxText=c.confirmationMsg,f.moreInfo=c.msg_removeContentMoreInfo,f.enableConfirmationBox=!0),m(f)},onFailure:function(e){console.log(" Error while fetching modify access on items")}}):(b&&(f.showDGV=!0,v(f,p,[])),m(f))}else a.displayNotification({message:c.msg_warning_nocurrentlibrary,className:"warning"})})},endExecute:function(){}})}),define("DS/LibraryEditor/dataProvider/LibraryTreeDataProvider",["UWA/Class","UWA/Class/Promise","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/commands/LibraryCommands","DS/WebappsUtils/WebappsUtils","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/ChangeMaturityFilterCmd","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,r,i,n,a,o,s,l,d,c,u,f){"use strict";var y={AllMaturityStates:"unselected",Inactive:"unselected",InWork:"unselected",Active:"selected",Obsolete:"unselected"},p="",g={FAVORITES:"ipcFavoriteList_v1",getFavorites:function(){return u.getTenantAwarePreferenceName(this.FAVORITES)}};return e.singleton({expandObject:function(e){return new t(function(t,r){n.libraries({pid:e.pid,mxid:e.mxid,children:e.children,isExpandAll:e.isExpandAll,onComplete:function(r){(r="string"==typeof r?JSON.parse(r):r).results=u.convertExpandV2toV1(r.results);var i=a.getPathsAndObjectsFromExpand(r.results);if(null==i)t({paths:[],objects:[]});else if(i.paths&&i.paths.length<=0){var n=[];r.results&&(n=a.convertExpandToSearchFormat(e.pid,r.results));var o=[];for(var s in i.objects)i.objects.hasOwnProperty(s)&&s!==e.pid&&o.push(s);t({objects:function(e){var t=[];e&&e.length>0&&e.forEach(function(e){var r=a.convertToExaleadDataFormatFederated(e);"Standard"==r.grid["ds6w:classificationUsage"]?r.icons=[{iconName:"library-class"}]:r.icons=[{iconName:"library-class-filled"}],r.plmType="Library",t.push(r)});return t}(n),childIds:o,paths:i.paths})}else{for(var s in i.objects)i.objects.hasOwnProperty(s)&&("Standard"==i.objects[s].grid["ds6w:classificationUsage"]?i.objects[s].icons=[{iconName:"library-class"}]:i.objects[s].icons=[{iconName:"library-class-filled"}],i.objects[s].plmType="Library");t({paths:i.paths,objects:i.objects})}},onFailure:function(e){r(e)}})})},getRootSectionContents:function(e){return new t(function(e,t){n.roots({fetchAll:!0,onComplete:function(t){var r=(t="string"==typeof t?JSON.parse(t):t).results?t.results:[],i=[],n=[];r.forEach(function(e){var t=a.convertToExaleadDataFormatFederated(e);"Standard"==t.grid["ds6w:classificationUsage"]?t.icons=[{iconName:"library-lined"}]:t.icons=[{iconName:"library"}],t.plmType="RootLibrary",n.push(t),i.push(t.physicalid)}),e({objects:n,ids:i,infos:t.infos})},onFailure:function(e){t(e)}})})},getObjectPathLength:function(e){return new t(function(t,r){n.getLibraryPathLength({ids:e.ids,onComplete:function(e){if(e.results){var i=a.getLibraryDepth(e);t(i)}else f.displayNotification({message:l.msg_error_BOdeleted,className:"error"}),r()},onFailure:function(e){console.log("WebService getObjectPathLength Err : "+e),r(e)}})})},getObjectPath:function(e){return new t(function(t,r){n.getLibraryPath({depth:e.depth,pid:e.pid,onComplete:function(r){var i=a.convertNavigateToFlatFormat(e.depth,r.result);t(i)},onFailure:function(e){that._logger.log("WebService getObjectPath Err : "+e),r(e)}})})},getPreferenceSectionContents:function(e){return new t(function(t,i){n.favourites({ids:e.ids,onComplete:function(e){for(var i=(e="string"==typeof e?JSON.parse(e):e).results?e.results:[],n=[],o=0;o<i.length;++o){var s=r.getPlmTypeFromContentDetails(i[o].attributes),l=a.convertToExaleadDataFormatFederated(i[o]);l.plmType=s,"RootLibrary"===l.plmType?"Standard"==l.grid["ds6w:classificationUsage"]?l.icons=[{iconName:"library-lined"}]:l.icons=[{iconName:"library"}]:"Standard"==l.grid["ds6w:classificationUsage"]?l.icons=[{iconName:"library-class"}]:l.icons=[{iconName:"library-class-filled"}],n.push(l)}t(n)},onFailure:function(e){i(e)}})})},comparator:function(e,t){var r,i="LibrarySection_favorite"===e.getParent().plmType;if(i)return null;if(e.isRoot()&&t.isRoot()||i)return null;if("date"!==widget.getValue("sortMode"))return e.options.label.localeCompare(t.options.label);try{r=new Date(e.options.created)>new Date(t.options.created)?1:new Date(e.options.created)<new Date(t.options.created)?-1:0}catch(i){r=e.options.created<t.options.created?-1:1}finally{return r}},shouldBeEditable:function(e){return i.shouldBeEditable(e)},getContextualMenu:function(e){return!1===d.getWidgetOptions().enableTreeCtxMenu?[]:o.GetContextualMenu(e,"TREE")},onContentUpdate:function(e){return i.onNodeModelUpdate(e)},isValidType:function(e){return r.inFamilyLibrary(e)},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},isTreeNodeEditable:function(e){return!!(e&&e.nodeModel&&e.nodeModel.getParent())&&"LibrarySection_favorite"===e.nodeModel.getParent().plmType},isPreferenceSection:function(e){return"LibrarySection_favorite"==e},getSectionsData:function(){var e=[],t={};t.label=l.name_Section_FavoriteLibraries,t.icon=s.getWebappsAssetUrl("LibraryEditor","icons/libraryfavorites.png"),t.plmType="LibrarySection_favorite",e.push(t);var r={};return r.label=l.name_Section_AllLibraries,r.icon=s.getWebappsAssetUrl("LibraryEditor","icons/librarysectionall.png"),r.plmType="LibrarySection_AllLibraries",r.defaultSelectedSection=!0,e.push(r),e},getPreferenceSectionName:function(){return g.getFavorites()},getSecurityContextAndData:function(){return i.getCurrentSecurityContextAndLibraryData()},getObjectNotVisiblemessage:function(){return l.msg_error_NoVisibleRootLibrary},isDNDSupported:function(){return!1!==d.getWidgetOptions().enableDnd},isRoot:function(e){return!(!e||!e.flattenedtaxonomies||"types/Libraries"!==e.flattenedtaxonomies[0]||"types/General Library"!==e.flattenedtaxonomies[1])},getStatesFilterModel:function(){var e={id:"filterByStates",dataElements:{typeRepresentation:"functionMenuIcon",value:{menu:[]},tooltip:{title:l.CMDMaturityStates_label,shortHelp:l.CMDMaturityStates_shortHelp},label:l.CMDMaturityStates_longTitle,icon:{},position:"far",category:"1"}};return e.dataElements.value.menu=this.getMenuForStatesFilter(),e.dataElements.icon={iconName:"filter",className:p,fontIconFamily:1},e},getMenuForStatesFilter:function(){widget.getValue("filteredStates")?(y=null,y=UWA.clone(widget.getValue("filteredStates"))):widget.setValue("filteredStates",UWA.clone(y)),p="selected"==y.AllMaturityStates?"":"filter-active";var e=Object.keys(y),t=[];return e.forEach(e=>{var r={type:"CheckItem",state:y[e]};r.action={callback:function(e){c.applyMaturityFilter(e)},context:e},r.title=l["state_"+e],t.push(r)}),t},updateMenuForStatesFilter:function(e,t){if("AllMaturityStates"==e){for(const e in y)y[e]="unselected";y.AllMaturityStates="selected"}else y.AllMaturityStates="unselected","unselected"==y[e]?y[e]="selected":y[e]="unselected";widget.setValue("filteredStates",UWA.clone(y));var r=this.getMenuForStatesFilter(),i={iconName:"filter",className:p,fontIconFamily:1};d.getTreeCont().getView().leftToolbar.updateNodeModel("filterByStates",{grid:{data:{menu:r}},icon:i}),d.getTreeCont().refreshLibraryTree(),d.getContent().refreshLibraryContent(),t&&f.displayNotification({message:l.msg_info_stateSwitch,className:"primary"})},getCurrentFilteredStates:function(){return y},setCurrentFilteredStates:function(e){y=null,y=e},resetFilterIfNodeIsNotCompliant:function(e){c.switchToAllMaturityFilterIfPathNotCompliant(e)}})}),define("DS/LibraryEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],function(e,t,r,i){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=i.getSelectedNodes();if(e.length){var t=e[0];r.ExpandAllCmd(t,"CONTENT")}else{var n=i.getCurrentLibrary();r.ExpandAllCmd(n,"TREE")}},endExecute:function(){}})}),define("DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider",["UWA/Class","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,r,i,n,a,o,s,l,d){"use strict";return e.singleton({shouldAcceptDrag:function(){var e=!0,t=a.getSelectedNodes();if(t.length>0){for(var r=0;r<t.length;++r)if("Content"!==t[r].plmType){e=!1;break}}else e=!1;return e},shouldAcceptDrop:function(e){var t=!1;return e||(e=a.getCurrentLibrary()),"RootLibrary"!==e.plmType&&o.inFamilyLibrary(e.plmType)&&(t=!0),t},addContentInObject:function(e,s,c,u){if(r._startProgressBar(d.Paste_content_loading),e&&e.plmType&&o.inFamilyLibrary(e.plmType)&&c){if(e.id===s)return r._offProgressBar(),void t.displayNotification({message:d.msg_error_MoveInSamelibrary,className:"error"});var f=c,y=f.length;if(y<1)return void console.log("  Error in LibraryDnDService.addContentInLibrary, lContentId list is empty");i.AddContent({IDs:f,library:e,callbacks:{onComplete:function(i){var o,s,c,u=!1,p=(f.length,o=d.replace(d.add_in_class,{libraryname:e.options.label}));if(i){var g=JSON.parse(i),b=g.totalCount,m=g.failedCount,v=g.alreadyExistCount,h=g.errorMsg;m>0?(v>0?m==v?b==m?(o=d.all_in_class,c="info"):b>m&&(o=d.replace(d.few_added_few_exist,{OK:b-m,exist:v}),u=!0):m>v&&(b==m?o=d.replace(d.few_exist_few_failed,{exist:v,KO:m-v}):b>m&&(o=d.replace(d.few_added_few_exist,{OK:b-m,exist:v}),u=!0,s=d.replace(d.few_failed,{KO:m-v}),c="error")):m==b?o=d.all_failed:m<b&&(o=d.replace(d.few_added,{OK:b-m}),u=!0,s=d.replace(d.few_failed,{KO:m}),c="error"),o&&(o=p+": "+o)):(o=d.replace(d.msg_info_Addinlibrary,{number:b,libraryname:e.options.label}),u=!0)}if(1==u){l.setAuthoringMode("authoring",o);var C=n.getContent(),_=a.getCurrentLibrary();if(C&&_&&_.id===e.id){r._endProgressBarListener();var S=C._libraryContentView.getPADTreeDocument();S&&S.keepExpandedState(),C.loadContentAndSelect(_,f[y-1]),C.getView().maskContentDiv(!1)}s&&(h&&(s=h),t.displayNotification({message:p+": "+s,className:c}))}else h&&(o=p+": "+h),c||(c="error"),t.displayNotification({message:o,className:c})},onFailure:function(i){var o=n.getContent(),s=a.getCurrentLibrary();r._offProgressBar(),o&&s&&s.id===e.id&&o.getView().maskContentDiv(!1),t.displayNotification({message:i?d.msg_error_Addinlibrary+"<br>"+i:d.msg_error_Addinlibrary,className:"error"})}}}),r._offProgressBar()}else r._offProgressBar(),console.log("  Error in LibraryDnDService.addContentInLibrary, dropTarget_LibraryNodeModel is not a Library")},addClassesInLibrary:function(){t.displayNotification({message:d.msg_warning_dndnotsupported,className:"warning"})},getDroppedData:function(e){var t=[],r=[],i=[];if(e&&e.data&&e.data.items&&Array.isArray(e.data.items)){for(var n=0;n<e.data.items.length;n++){var a=e.data.items[n],s=a.objectId,l=a.objectType_Internal;if(l||(l=a.objectType),Array.isArray(l)){for(var d=l.length,c=d>0?l[d-1]:void 0,u=0;u<d;++u)if(o.inFamilyLibrary(l[u])){c=l[u];break}l=c}var f=a.displayName;f||(f=l),f||(f=s);var y={droppedItem_id:s,droppedItem_type:l,droppedItem_name:f,droppedSourceLibrary_id:a.libraryId,droppedItem_tenantId:a.envId};o.isRootLibrary(l)?t.push(y):o.isLibrary(l)?r.push(y):i.push(y)}var p={};return p.RootLibrary_itemList=t,p.Library_itemList=r,p.Content_itemList=i,p}},inFamilyLibrary:function(e){return o.inFamilyLibrary(e)}})}),define("DS/LibraryEditor/commands/ActionBar_CreateLinkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/service/LibraryEditorWebService","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/commands/LibraryCommands","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/WidgetServices/WidgetServices","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/utils/LibraryEditorUtil"],function(e,t,r,i,n,a,o,s,l){"use strict";return t.extend({labelTopBar:e.i18n("Copy Link"),init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){require(["DS/LibraryEditor/utils/Library_CSO"],function(e){var t=e.getSelectedNodes(),r=null,n=t[0].getID(),s=t[0].getLabel();null!=n&&o.getSourceUrlAsync({platformId:o.getTenantID(),source:"3DDashboard",onComplete:function(e){var t={data:{items:[{objectId:n,envId:widget.getValue("x3dPlatformId")}]}};r=e+"#app:ENOCLRX_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(t)),l.copyUrlToCLipboard(r).then(e=>{i.displayNotification({message:a.replace(a.msg_success_copyLink,{libraryname:s}),className:"success"})}).catch(e=>{i.displayNotification({message:a.msg_error_copyLink,className:"error"})})}})})},endExecute:function(){}})}),define("DS/LibraryEditor/utils/DimensionUtils",["UWA/Class","DS/LibraryEditor/service/LibraryEditorWebService"],function(e,t){"use strict";return e.singleton({init:function(e){},setUnitPreferedMe:function(e){this.unitPreferedMe=e},getUnitPreferedMe:function(e){return this.unitPreferedMe[e]},getDimensions:function(){var e=this;return new Promise(function(r){e._dimensions?r(e._dimensions):t.getDimensionsInfos({method:"GET",Accept:"application/json","content-type":"application/json",onComplete:function(t){try{t="string"==typeof t?JSON.parse(t):t;var i={};t.results.forEach(function(e){var t={};t.mksUnitDBName=e.MKSUnit;e.Units.forEach(function(e){t[e.Name]=e.NLSName,t.mksUnitDBName==e.Name&&(t.defaultUnit=e.NLSName)}),i[e.Name]=t}),e._dimensions=i,console.info("Dimensions Loaded ..."),r(e._dimensions)}catch(e){console.error("Unexpected error when fetching dimensions"),console.error(e),r(null)}},onFailure:function(e){console.error("Unable to get dimentions : "),console.error(e),r(null)}})})}})}),define("DS/LibraryEditor/dataProvider/LibraryContentDataProvider",["UWA/Class","UWA/Class/Promise","DS/PADUtils/PADProbes","DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/service/LibraryEditorWebService","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyPreference","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/commands/LibraryCommands","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/DimensionUtils","DS/LibraryEditor/utils/Library_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUX/LibrarySearchWithinController"],function(e,t,r,i,n,a,o,s,l,d,c,u,f,y,p,g,b,m,v,h){"use strict";var C={dimensions:[],integers:[],predicates:{},rangeAttributes:{isNLSavailable:!0},attributeTitle:{}},_={FAVORITES:"ipcFavoriteList_v1",getFavorites:function(){return g.getTenantAwarePreferenceName(this.FAVORITES)}},S=e.singleton({getObjectsForRefresh:function(e,r){var i=this;return new t(function(t){var o=[],s=c.getPredicateUnitMapping();r.forEach(function(e){e.isDynamic?(-1===o.indexOf(e.dbAttribute)&&o.push(e.dbAttribute),s[e.dbAttribute]&&s[e.dbAttribute].fetchInputUnit&&(o.push(e.dbAttribute+".inputunit"),o.push(e.dbAttribute+".inputvalue"))):e.attrDBName&&e.attrDBName.length>0&&e.attrDBName.forEach(function(e){e.startsWith("attribute[")&&o.push(e)})}),a._performFetchQuery({ids:e,dynamicAttrs:o,isAuthoringMode:!0,onComplete:function(e){var a=[];e.results&&e.results.length>0&&e.results.forEach(function(e){a.push(n.convertToExaleadDataFormatFederated(e))}),C.rangeAttributes&&C.rangeAttributes.isNLSavailable&&a.forEach(e=>{for(const n in C.rangeAttributes){var t=Object.keys(C.predicates).find(e=>C.predicates[e]===n),r=e.grid[t];if(Array.isArray(r))for(var i=0;i<r.length;i++)e.grid[t][i]=C.rangeAttributes[n][r[i]];else e.grid[t]=C.rangeAttributes[n][r]}}),i.getInputWSConvsionUnits(r,a,!0).then(function(e){var r=e.mapping,n=e.data;n.Data&&n.Data.length>0?i.convertToPreferdUnits(n).then(function(e){null!==e&&(e="string"==typeof e?JSON.parse(e):e,r.forEach(function(t){e.forEach(function(e){if(t.UnitFrom===e.UnitFrom&&t.UnitTo===e.UnitTo){var r=i.formatResult(t.isMultiVal,t.mksValue,e.ValuesToConvert,e.ConvertedValues);r.length>0&&(a[t.rowIdx].grid[t.dataIndex]=r.join(",")+" "+t.UnitTo_nls)}})})),t(a)}):t(a)})},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties"),t(null)}})})},setIconsForLibraries:function(e,t){var r,n=e.options.thumbnail;"General Class"==e.options.type&&"Definition"==e.options.grid["ds6w:classificationUsage"]&&((r=[]).push(i.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralClass_small.png")),n.includes("I_GeneralClass")&&(e.options.thumbnail=i.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralClass_Tile.png")),e.options.icons=r);"General Library"==e.options.type&&"Standard"==e.options.grid["ds6w:classificationUsage"]&&((r=[]).push(i.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralLibrary_small.png")),n.includes("I_GeneralLibrary")&&(e.options.thumbnail=i.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralLibrary_Tile.png")),e.options.icons=r)},getNlsForAttributes:function(){},getObjectDynamicAttributes:function(e,i){var n=r.createProbe("probeFetchClassificationAttrs"),o=[],s=[],l=[],u=[],f={generatedPredicates:{}},p=[],g=[],b=[],m=[],_=[],S={};return new t(function(t,r){"RootLibrary"!==e.type?d.getClassAttrPos().then(function(d){a.getClassificationAttributes({classid:e.id,onComplete:function(e){var r=JSON.parse(e),a=r.attribute;a||(a=r.Attribute);var y=a;if(a.length>0){for(var L=[],E=0,D=a.length;E<D;++E){var A=a[E].predicate,w=a[E].name,P=!1;if(o[E]=a[E].nls_label||w,C.attributeTitle[w]=o[E],A?s[E]=A:(A="ds6wg:"+w.replace(new RegExp(" ","g"),"_"),s[E]=A),l[E]="attribute["+w+"]",p[E]=a[E].type,b[E]=a[E].valuetype,_[E]=[],a[E].range&&Array.isArray(a[E].range)&&a[E].range.length>0&&(1==a[E].range.length&&"between"==a[E].range[0].operator||(C.rangeAttributes[w]=[],a[E].range.forEach(e=>{let t=e.value;a[E].nls_range&&a[E].nls_range[t]?(C.rangeAttributes[w][t]=a[E].nls_range[t],_[E].push(a[E].nls_range[t])):(C.rangeAttributes[w][t]=t,_[E].push(t))}),y[E].authRange=_[E])),m[E]=a[E].manipulationUnit,a[E].dimension){var I=!0,T=null;m[E]&&(T=a[E].dimensionUnits[m[E]]);var x="";a[E].dimensionUnits&&a[E].dimensionUnits.defaultUnit&&(x=a[E].dimensionUnits.defaultUnit),x==T&&(I=!1);let e={preferredUnit:I,unit:T||x,predicate:s[E],dimension:a[E].dimension,unitName:a[E].manipulationUnit};C.dimensions.push(e)}if("multival"==a[E].valuetype&&"timestamp"==p[E]&&(m[E]="multivalueTimestamp"),C.predicates[s[E]]=w,"integer"==p[E]){let e={predicate:s[E]};C.integers.push(e)}if("real"==p[E]&&a[E].dimension||a[E].valuetype&&"multival"==a[E].valuetype?p[E]="string":"timestamp"==p[E]?p[E]="date":"real"==p[E]?p[E]="float":"TRUE"==a[E].multiline&&(p[E]="multiline"),g[E]=d?E:void 0,a[E].dimension){var U=a[E].manipulationUnit;if(U&&U.length>0)S["attribute["+w+"].manipulationUnit"]=U;else if(a[E].valuetype&&"multival"!=a[E].valuetype&&!v.isNatifEnvironnement()){if(i)u.push("attribute["+w+"].inputunit"),u.push("attribute["+w+"].inputvalue");else if(A)if(A.startsWith("ds6wg:"))u.push(A+"inputunit"),u.push(A+"inputvalue");else{var N="ds6wg:"+w.replace(new RegExp(" ","g"),"_");u.push(N+"inputunit"),u.push(N+"inputvalue"),f.generatedPredicates[N]=A}P=!0}A&&(f[A]=a[E].dimensionUnits),f["attribute["+w+"]"]=a[E].dimensionUnits,P&&(f["attribute["+w+"]"].fetchInputUnit=!0),S["attribute["+w+"].dimension"]=a[E].dimension.substring(a[E].dimension.indexOf("_")+1),L.push("attribute["+w+"]")}}S.attrsToConvert=L}c.resetAttrNameToPredMapping(),c.setPredicateUnitMapping(f),c.resetDynamicHeaderMap();for(E=0;E<l.length;++E)c.addToDynamicHeaderMap({text:o[E],dataIndex:s[E],dbAttribute:l[E]}),c.setAttrNameToPredMapping({key:l[E],value:s[E]});y._attributesInfo=C,h.feedClassificationAttributes(y),h.feedUnitManipulationDatas(f),t({dynamicattributes:s,dynamicattributesForUIView:o,dynamicattributesName:l,unitPredicates:u,unitData:f,dynamicattributesType:p,dynamicattributesValueType:b,dynamicattributesIndex:g,convUnitInfos:S,dynamicattributesRange:_,dynamicattributesUnit:m}),n.end()},onFailure:function(){console.log(y.get("msg_classificationattributes_webservicefailed")),r(),n.end()}})}):t()})},getTooltipIfDynamicColumn:function(e,t){if(t&&t.isDynamic){e.dataIndex=t.dataIndex;for(var r=c.getDynamicHeaderMap(),i=0;i<r.length;i++)if(e.dataIndex==r[i].dataIndex)return r[i].toolTip}return null},getObjectContents:function(e){return new t(function(t,r){a.content({pid:e.pid,mxid:e.mxid,searchQuery:e.searchQuery,isExactSearch:e.isExactSearch,selectedType:e.selectedType,dynamicattributes:e.dynamicattributes,filters:e.filters,start:e.start,next_start:e.next_start,order_field:e.order_field,order_by:e.order_by,isAuthoringMode:e.isAuthoringMode,grid:e.grid,onComplete:function(r){if((r="string"==typeof r?JSON.parse(r):r).result)return i=n.convertNavigateToSearchFormat(r.result),void t({contents:a(i),infos:r.infos,facets:r.facets});var i=function(e,t){var r=[];null!=e&&e.forEach(function(e){var i=!1;e.attributes&&e.attributes.forEach(function(e){"physicalid"===e.name&&e.value!=t&&(i=!0)}),i&&r.push(e)});return r}(r.results,e.pid);function a(e){var t=[];return e.forEach(function(e){var r=n.convertToExaleadDataFormatFederated(e),i=e.attributes;r.plmType=s.getPlmTypeFromContentDetails(i),r.Documentlocked=e.Documentlocked,r.publishOnConnect=e.publishOnConnect,t.push(r)}),t}S.loadDimensions(e.attributesDimMap).then(function(){t({contents:a(i),infos:r.infos,facets:r.facets})})},onFailure:function(e,t){r({err:e,serverErr:t,msg:y.msg_error_contentnotavailable})}})})},getInputWSConvsionUnits:function(e,r,i){return new t(function(t){var n=[],a=[];b.getDimensions().then(function(o){for(var s=0;e&&s<e.length;++s){var l={},d=e[s];try{var c=o[d.convertInfos.dimension],u=c.mksUnitDBName,f=d.convertInfos.manipulationUnit;!f&&v.isNatifEnvironnement()&&(f=b.getUnitPreferedMe(d.convertInfos.dimension));var y=c[f];if(y&&y.length>0&&u!==f){var p=d.dataIndex,g=u+":"+f+":"+d.convertInfos.dimension;a[g]?l=a[g]:(l.UnitFrom=u,l.UnitTo=f,l.Dimension=d.convertInfos.dimension);for(var m=0;m<r.length;m++){var h=r[m],C=h.grid||h.options.grid;if(C[p+"_mksvalue"]&&C[p+"_mksvalue"].length>0&&("Content"===h.plmType||i)){var _=C[p+"_mksvalue"],S=Array.isArray(_)||_.indexOf(",")>-1;(S&&!Array.isArray(_)||!S)&&(_=_.trim().split(","));var L=_.join(";");try{var E=l.Values.split(";");_.forEach(function(e){-1==E.indexOf(e)&&E.push(e)}),l.Values=E.join(";")}catch(e){l.Values=L}l.Values&&l.Values.length>0&&(a[g]=l,n.push({modelId:h._id,rowIdx:i?m:h._getRowID(),dataIndex:d.dataIndex,mksValue:L,UnitFrom:u,UnitTo:f,UnitTo_nls:y,isMultiVal:S}))}}}}catch(e){}}var D={Data:[]};for(var A in a)D.Data.push(a[A]);t({mapping:n,data:D})})})},updateAttributesDelayedForUnits:function(e,t){if("OnSyncModel"===e.context||"OnScrollEnd"===e.context){var r=this;if(t){var i=t.layout.getLeafColumns(),n=e.collectionView;r.getInputWSConvsionUnits(i,n.model,!1).then(function(e){var t=e.mapping,i=e.data;i.Data&&i.Data.length>0&&r.convertToPreferdUnits(i).then(function(e){null!==e&&(e="string"==typeof e?JSON.parse(e):e,t.forEach(function(t){var i=n.model[t.rowIdx];e.forEach(function(e){if(t.modelId==i._id&&"Content"===i.plmType&&t.UnitFrom===e.UnitFrom&&t.UnitTo===e.UnitTo){var a=r.formatResult(t.isMultiVal,t.mksValue,e.ValuesToConvert,e.ConvertedValues);if(a&&a.length>0){var o=[];a.forEach(e=>{o.push(e+" "+t.UnitTo_nls)}),i.attributeValue[t.dataIndex]=o,i._resetting=!0,n.setNodeModelValue(i,t.dataIndex,o),i._resetting=!0,n.setNodeModelValue(i,t.dataIndex+"_mksvalue",void 0),i._resetting=!1}}})}))})})}}},formatResult:function(e,t,r,i){var n=[],a=r.split(";"),o=i.split(";");if(e)for(var s=t.split(";"),l=0;l<s.length;l++){if((c=a.indexOf(s[l]))>-1){var d=+o[c];if(isNaN(d))return;n.push(d.toString().indexOf(".")>-1?d:d+".0")}}else{var c;d=+o[c=a.indexOf(t)];if(isNaN(d))return;n.push(d.toString().indexOf(".")>-1?d:d+".0")}return n},hasWelcomePanel:function(){return!0},convertToPreferdUnits:function(e){return new t(function(t){a.convertDimensionUnits({data:e,onComplete:function(e){var r=(e="string"==typeof e?JSON.parse(e):e).Response?e.Response:[];t(r)},onFailure:function(e){console.error("Unable to convert dimentions units : "),console.error(e),t(null)}})})},getPaginatedSectionContents:function(e){return new t(function(t,r){a.roots({filters:e.filters,start:e.start,next_start:e.next_start,order_field:e.order_field,order_by:e.order_by,searchQuery:e.searchQuery,onComplete:function(e){var r=[];e.results&&e.results.forEach(function(e){var t=n.convertToExaleadDataFormatFederated(e),i=e.attributes;t.plmType=s.getPlmTypeFromContentDetails(i),t.Documentlocked=e.Documentlocked,t.publishOnConnect=e.publishOnConnect,r.push(t)}),t({results:r,infos:e.infos,facets:e.facets})},onFailure:function(){r()}})})},loadDimensions:function(e){return new t(function(t){b.getDimensions().then(function(r){if(null!=r){var i={},n=c.getPredicateUnitMapping();for(var a in e)if(r[e[a]]&&!n[a]){var o={};o[a]=r[e[a]],UWA.extend(i,o,!0)}c.setPredicateUnitMapping(i)}t()})})},getPreferenceSectionContents:function(e){return new t(function(t,r){a.favourites({ids:e.ids,onComplete:function(e){for(var r=(e="string"==typeof e?JSON.parse(e):e).results?e.results:[],i=[],a=0;a<r.length;++a){var o=s.getPlmTypeFromContentDetails(r[a].attributes),l=n.convertToExaleadDataFormatFederated(r[a]);l.plmType=o,i.push(l)}t(i)},onFailure:function(e){r(e)}})})},checkEditable:function(e,t){return"Content"==e&&("FALSE"==t||!1===t)},getAttributesInfo:function(){return C},getContextualMenu:function(e,t,r,i){return!1===p.getWidgetOptions().enableCtxMenu?[]:u.GetContextualMenu(e,t,i)},comparator:function(e,t){return d.sortColumn(e,t)},getPreferenceSectionName:function(){return _.getFavorites()},isValidType:function(e){return s.inFamilyLibrary(e)},isValidTypeForPlaceholder:function(e){return!this.isSection(e)&&"RootLibrary"!==e},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},isPreferenceSection:function(e){return"LibrarySection_favorite"==e},toEnableTreeColumnEdit:function(e){return this.isPreferenceSection(e)},isPaginatedSection:function(e){return"LibrarySection_AllLibraries"==e},shouldBeEditable:function(e){return d.shouldBeEditable(e)},onContentUpdate:function(e){return e.attributeInfo=C,d.onNodeModelUpdate(e)},getRepeatMode:function(){return d.getRepeatMode()},onAddColumn:function(e){c.filterExcludeListColumns(e).length>0&&(c.setPredicates(e),c.addToPredicateHeaderMap(e))},onRemoveColumn:function(e){c.removePredicates(e),c.removeFromPredicateHeaderMap(e)},onResetColumn:function(e,t){c.removeAllPredicates(),c.setPredicates(e,t)},setColumnNames:function(e,t){c.setPredicates(e,t)},initColumns:function(e){c.initPredicateToHeaderMap(e)},showContentPlaceholder:function(){return!0},isDNDSupported:function(){return!1!==p.getWidgetOptions().enableDnd},getAuthModeNoSortColumns:function(e){return c.getAuthModeNoSortColumns(e)},hasLibrarianRole:function(){return new t(function(e,t){e({readOnly:!0})})},getLibraryControl:function(){return p},getLibraryEditorUtil:function(){return d},getLibraryTypeService:function(){return s},getAdditionalTooltipAttribute:function(){return[{label:"ds6w:classificationUsage",order:2}]},getStatus:function(e,t){return!1===e.contains(".")&&(e=t&&t.contains(" ")?t+"."+e.toUpperCase():t&&t.contains("_")?t+"."+(e=e.replace(" ","_")).toUpperCase():t&&e.contains(" ")?t+"."+(e=e.replace(" ","")):t+"."+e),e}});return S});