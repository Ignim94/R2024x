define("DS/WAfrExecutionContext/mod_ExecutionContextInterpreter",["UWA/Class/Promise"],function(e){"use strict";class t{constructor(){this._executionContext=void 0,this._components=[],this._UIModel=void 0}interpret(t,n,o){this._executionContext=n,this._components=t.components,this._UIModel=t.UIModel;let r=!1;return this._components&&this._components.forEach(function(e){e&&"mod_WelcomeScreen"===e.key&&(r=!0)}),this._components&&r&&!this._executionContext.getSourceApp()?this._executionContext._doIWantToBeInWSContext=!0:r||(this._executionContext._doIWantToBeInWSContext=!1,this._executionContext.WSState=!1),e.resolve()}}var n={generateExecutionContextInterpreter:function(e){return new t}};return n}),define("DS/WAfrExecutionContext/mod_Component",["UWA/Core"],function(e){"use strict";var t=Object.create(null),n=function(){};function o(e,t){if("object"!=typeof t)throw new Error("target obj to update must be an object");var n;n=e.prototype,Object.keys(n).forEach(function(e){t.hasOwnProperty(e)||Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}function r(e,t){if("function"!=typeof t)throw new Error("parameters must be constructors (i.e. functions)");o(e,t.prototype)}t.Component=n,n.implementsBy=function(e){r(n,e)},n.mixinProperties=function(e){o(n,e)},n.prototype.getExecutionContext=function(){return this._private._executionContext},n.prototype.setExecutionContext=function(e){this._private=this._private||Object.create(null),this._private._executionContext=e},n.prototype.getRegisteredIdentifier=function(){return this._private._identifier},n.prototype.setRegisteredIdentifier=function(e){this._private=this._private||Object.create(null),this._private._identifier=e},n.prototype.setInitializedState=function(e){if("boolean"!=typeof e)throw new Error("Initialization state must be a boolean value");this._private=this._private||Object.create(null),this._private._initialized=e},n.prototype.isInitialized=function(){return this._private._initialized},n.prototype.initialize=function(){return e.Class.Promise.resolve()},n.prototype.clean=function(){return e.Class.Promise.resolve()},n.prototype.destroy=function(){return e.Class.Promise.resolve()},n.prototype.canBeParallelized=function(){return!0};var i=function(){};t.StandardComponent=i,n.implementsBy(i),i.implementsBy=function(e){r(i,e)},i.prototype.configure=function(){return e.Class.Promise.resolve()},i.prototype.getExposedComponentCtor=function(){return null},i.prototype.getExposedComponent=function(){return this._private?this._private._publicComponent:null},i.prototype.setExposedComponent=function(e){this._private=this._private||Object.create(null),this._private._publicComponent=e},i.prototype.generateInterpreter=function(e){return null},i.prototype.getCurrentInterpreter=function(){return this._private._currentInterpreter},i.prototype.setCurrentInterpreter=function(e){this._private=this._private||Object.create(null),this._private._currentInterpreter=e};var s=function(){};return t.Interpreter=s,s.prototype.interpret=function(e,t){throw new Error("Not implemented")},s.prototype.commit=function(e,t){throw new Error("Not implemented")},s.prototype.enrich=function(e,t){},t}),define("DS/WAfrExecutionContext/mod_ExecutionContext",["UWA/Utils","UWA/Core","DS/WAfrExecutionContext/mod_Component","UWA/Class/Promise","DS/WAfrExecutionContext/mod_ExecutionContextInterpreter","DS/WAfrUtils/Logger","DS/WAfrContainer/App","DS/WAfrDebug/mod_Performances","i18n!DS/WAfrContainer/assets/nls/Notification","DS/Controls/ModalContainer","DS/Controls/Loader","i18n!DS/WAfrExecutionContext/assets/nls/Transition","DS/WebUAUtils/WebUAUtils"],function(e,t,n,o,r,i,s,p,a,c,u,d,l){"use strict";var h=p.Performances,f=Object.create(null);function m(e){var t={},n=function(e){var n=e.split("==");if(2!==n.length)throw new Error("Bad syntax, expected expression like A == B, found "+e);var o=n[0].trim(),r=n[1].trim();if(o.indexOf('"')>=0||r.indexOf('"')>=0)throw new Error('Bad syntax, key and value should not contain double quote ", found '+e);if(o.indexOf(" ")>=0||r.indexOf(" ")>=0)throw new Error("Bad syntax, key and value should not contain space, found "+e);t[o]=r};if(e.indexOf("&&")>=0){var o=e.split("&&");if(o.length<2)throw new Error("Bad syntax, expected expression like A == B && C == D, found "+e);o.forEach(n)}else n(e);return t}function g(e,t,n){var o=!0;return Object.keys(t.when).forEach(function(n){o=o&&t.when[n]===e[n]}),o&&!t.fit?(t.fit=!0,!n&&t.onDidFitContext&&t.onDidFitContext(t.element)):o||(t.fit=!1,!n&&t.onDidUnfitContext&&t.onDidUnfitContext(t.element)),t.fit}function _(e){return{current:0,next:function(){return this.current>=e.length?null:e[this.current++]}}}function C(e){for(var t=n.Component.prototype,o=Object.keys(t),r=0;r<o.length;r++){const t=o[r];if(!e.hasOwnProperty(t))return!1}return!0}function x(e,t,n){return e(n)?t(n).then(x.bind(null,e,t)):n}function v(e){var t=e.iterator,n=e.action,r=e.generatedData,i=e.inverse;if(null===n||"function"!=typeof n)throw new Error("The action cannot be null and must be a function returning a promise");for(var s=[],p=[],a=[],c=[],u=t.next(),d=null,l=0;u;)d=r?r[l]:null,u.canBeParallelized()?(s.push(u),a.push(d)):i?(p.unshift(u),c.unshift(d)):(p.push(u),c.push(d)),u=t.next(),l+=1;var h=function(){return!p||p.length<=0?o.resolve():x(function(e){return e<p.length},function(e){return n(p[e],c[e]).then(function(){return++e})},0).then(function(e){return o.resolve(e)}).catch(function(e){return o.reject(e)})},f=function(){var e=s.length,t=null,r=[];for(l=i?e-1:0;i?l>=0:l<e;i?--l:++l)d=a[l],t=n(s[l],d),r.push(t);return o.all(r)};return i?f().then(h):h().then(f)}function A(e,t){return{current:0,next:function(){for(var n;this.current<e.length&&!n;){var o=e[this.current];n=t[o]?t[o].component:void 0,this.current+=1}return n}}}function w(e,t,n){var o,r,i=e._appComponents.length+e._stdComponents.length;if(n)for(r=i-1;r>=0;r--)o=r>=e._appComponents.length?e._stdComponents[r-e._appComponents.length]:e._appComponents[r],t(e._components[o],o);else for(r=0;r<i;r++)o=r>=e._stdComponents.length?e._appComponents[r-e._stdComponents.length]:e._stdComponents[r],t(e._components[o],o)}function y(e,t,o){return o?n.Component.implementsBy(e):n.StandardComponent.implementsBy(e),new e(t)}function I(e,t){return Boolean(e&&t&&e.stdConf&&e.stdConf[t])}function S(e){let t;return e&&e.stdConf&&(t=e.stdConf),t}function E(e,t){if(!e||!t)throw new Error("Missing parameters. Please provide modules to require and thier corresponding keys");let n=[].concat(t),o=[].concat(e);return new Promise(function(e,t){require(o,function(){let t=Object.create(null);for(let e=0;e<arguments.length;e++)t[n[e]]=arguments[e];e(t)},function(e){t(new Error(`Unable to load module : ${e.requireModules}. Please check your packaging`))})})}function W(e){const t=e.getComponent("mod_WelcomeScreen");t&&e.a2xConfig.isWelcomeScreenLoaded&&(t.hideWelcomeScreen(),e.a2xConfig.isWelcomeScreenLoaded=!1),e._doIWantToBeInWSContext=!1}function D(e,t){return new Promise((n,o)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Data"],function(r,i){r.getAppInfo({appId:t,onComplete:r=>{var s="";r&&r.brand&&"string"==typeof r.brand&&"3DEXPERIENCE"!==r.brand&&"SOLIDWORKS"!==r.brand&&(s=r.brand),e._container._view.setBrand(s);let p=null;if(r.config)p=r.config;else for(var a=0;a<r.platforms.length;a++)if(r.platforms[a].id===r.platformId&&r.platforms[a].config){p=r.config;break}return p?(p=>{i.request(p,{type:"json",responseType:"json",onComplete:function(i){return new Promise((e,t)=>i.afrConfigurations?i.afrPreferences?function(e){return new Promise(function(t,n){require(["DS/MePreferencesClientAPI/MePreferencesClientAPI"],function(o){if(!o||!o.readPreferences)return t(!1);o.readPreferences([{Repository:e.repositoryName,PreferenceNames:[e.preferenceName]}]).then(function(e){var o;return e&&e.repositories&&e.repositories[0]&&e.repositories[0].preferences&&e.repositories[0].preferences[0]&&e.repositories[0].preferences[0].value&&(o=e.repositories[0].preferences[0].value),"boolean"==typeof o?t(o):"string"==typeof o?t("true"===o.toLowerCase()):n(new Error("[AFR] The AFR preference is not of a good type"))})})})}(i.afrPreferences).then(function(t){return e(t?i.afrConfigurations[1]:i.afrConfigurations[0])},function(t){return console.warn("[AFR] Preference has no value, fallback to default configuration"),e(i.afrConfigurations[1])}):t(new Error("[AFR] Cannot retrieve the correct configuration without preference")):e(i)).then(function(o){for(var i in o)e._container._view.setValue(i,o[i]);return o.appId=t,o.title=r.title,o.brand=s,n(o)}).catch(e=>o(e))}})})(p):n()}})})})}function b(e){if(!e)throw new Error("The execution context must be defined to fetch its widget's data");return e._container&&e._container._view?Promise.resolve(e._container._view.getValues()):Promise.reject(new Error("Impossible to retrieve the execution context's widget data."))}f.hasConfigurationFor=I,f.getConfigurationFor=function(e,t){let n;return e&&t&&e.stdConf&&e.stdConf[t]&&(n=e.stdConf[t]),n},f.getConfiguration=S;var T=function(e){return{getId:e.getId.bind(e),getComponent:function(t){return e.getComponent(t,!0)},registerComponent:function(t,n){e.registerApplicationComponent(t,n)},createAndRegisterComponent:e.createAndRegisterApplicationComponent.bind(e),unregisterComponent:e.unregisterApplicationComponent.bind(e),isRegisteredComponent:e.isRegisteredComponent.bind(e),recycleComponent:e.recycleComponent.bind(e),getData:function(){},getSourceApp:e.getSourceApp.bind(e),getTargetApp:e.getTargetApp.bind(e),getComponents:function(t){return e.getComponents(t,!0)},getContext:function(){return t.clone(e._contexts)},setContext:e.setContext.bind(e),switchApp:function(t,n){return t&&n?function(e,t,n){if(!e)throw new Error("Execution context must be defined to perform a switch of application specialization");const o=e.getSourceApp(),r=e._masterAppId;let i;return(i="localhost"===location.hostname?b(e):o&&o.getId()===t||r&&r===t?b(e).then(n=>n&&n.afrSpecializations?Promise.resolve(n):D(e,t)):D(e,t)).then(t=>{let o=t&&t.afrSpecializations;return o?o&&Array.isArray(o)&&!o.includes(n)?Promise.reject(new Error("The given application is not authorized to switch in the current exeuction context")):e._container?e._container.getApplicationJSON({afrAppId:n}):Promise.reject(new Error("Cannot find the related container.")):Promise.reject(new Error("The given application is not authorized to switch in the current exeuction context"))}).then(n=>(e._masterAppId=t,e.load(n))).catch(e=>Promise.reject(e))}(e,t,n):function(e,t){if(!e)throw new Error("Execution Context must be defined !");return D(e,t).then(n=>{if(n&&n.afrVersion&&"0.1"===n.afrVersion)return e.load(n);{e._masterAppId&&e._masterAppId!==t&&delete e._masterAppId;let o=n&&n.afrAppId||t;return e._container?e._container.getApplicationJSON({afrAppId:o}).then(t=>e.load(t)):Promise.reject(new Error("Cannot find the related container."))}})}(e,t)},gotoWelcomeScreen:function(){return e.gotoWelcomeScreen()},gotoApp:function(){return e.gotoApp()},getWelcomeScreenState:function(){return e.getWelcomeScreenState()},getWidgetID:e.getWidgetID.bind(e)}},k=function(n){var s=this;this._perf=new h,n=t.merge(n||{},{config:{components:[],interpreters:[]}}),this._id=n.id||e.getUUID(),this._config=n.config,this._config.interpreters=this._config.interpreters||[],this._interpreter=r.generateExecutionContextInterpreter(),this._components=Object.create(null),this._stdComponents=[],this._appComponents=[],this._contextualElements=[],this._WSComponents=[],this._handlers={},this.exposedApi=T(this),this.applicationContext=this.exposedApi,this._version=null,this._container=n.container,this._contexts=Object.create(null),this.onWillLoadApp=null,this.onDidLoadApp=null,this.onDidFailToLoadApp=null,this.onDidContextualComponentsUpdate=null,this._container=n.container,this._loader=null,this._container&&(this._container.subscribe("onReuseContext."+this.getId(),function(e){let t=10*parseFloat(e.afrVersion);(s._masterAppId&&delete s._masterAppId,t!==s._container._view._version)?require([t>=2?"DS/WAfrContainerAsWidget/default_config":"DS/WAfrContainerAsWidget/old_config"],function(t){s._container._config=t,s._config=t,s.load(e).then(console.log,console.warn)}):s.load(e).then(console.log,console.warn)}),this._container.subscribe("displayAfrLoader",function(e){s.displayLoader(e)}),this._container.subscribe("hideAfrLoader",function(){s.hideLoader()}),this._widgetID=this._container.id,this._winID=n.container._winID),this.applicativeMainUIComponentAvailability=!0,this._doIWantToBeInWSContext=!1,this.WSState=!1,this.isA2X=!1,this._isConfigured=!1,this._initExecutionContext=function(e,n,o){let r=Promise.resolve();return this.isA2X&&(r=this._initA2XExecutionContext(e)),r.then(()=>(function(e,t){function n(e,n){let o="["+e.module+"] "+e.func,r=t._perf.start(o);return new Promise((o,i)=>{function s(){t._perf.stop(r),o()}function p(){t._perf.stop(r),i()}require([e.module],function(t){return(0,t[e.func])(s,p,n)},function(e){return t._perf.stop(r),i(e)})})}let o=Promise.resolve();if(e.conditions){const t={appId:e.appId};let r=[],i=[];for(const[o,s]of Object.entries(e.conditions))r.push(o),i.push(n(s,t));o=Promise.allSettled(i).then(t=>{let n={};for(let e=0;e<r.length;++e)n[r[e]]=t[e];let o=e.components;if(o)for(let e=o.length-1;e>=0;--e)o[e].condition&&"rejected"===n[o[e].condition].status&&o.splice(e,1);let i=e.handlers.default;if(i)for(let e=i.length-1;e>=0;--e)i[e].condition&&"rejected"===n[i[e].condition].status&&i.splice(e,1);let s=e.handlers.check;if(s)for(let e=s.length-1;e>=0;--e)s[e].condition&&"rejected"===n[s[e].condition].status&&s.splice(e,1);let p=e.radioGroup;if(p&&(p=p.items))for(let e=p.length-1;e>=0;e--)p[e].condition&&"rejected"===n[p[e].condition].status&&p.splice(e,1);let a=e.UIModel;if(a&&(a=a.handlerList))for(let e=a.length-1;e>=0;e--)a[e].condition&&"rejected"===n[a[e].condition].status&&a.splice(e,1);let c=e.UIModel;if(c&&(c=c.categories))for(let e=c.length-1;e>=0;e--)c[e].condition&&"rejected"===n[c[e].condition].status&&c.splice(e,1)})}return o})(e,s).then(function(){return s._interpreter.interpret(e,s)}).then(function(){return s.registerStandardComponents()}).then(function(){return s.loadApp(e)}).then(function(e){if(s._targetApp=e.app,!s._targetApp)throw new Error("Not found a target app !");return s.prepareTransition(e)}).then(function(o){s._isConfigured=!1,s._components=t.merge(s._components,o.metaDatas),Object.keys(o.metaDatas).forEach(e=>{s._components[e].resetInfo&&!s._components[e].ctor&&(delete s._components[e],s._components[e]=o.metaDatas[e])}),s._appComponents=o.componentsKeys,s._WSComponents=o.WSComponentsKeys;var r=!1;for(var p in s._handlers){r=!1;for(var a=0;a<e.handlers.check.length;a++)e.handlers.check[a].identifier===p&&(e.handlers.check[a].defaultState=s._handlers[p],r=!0);if(!r)for(var c=0;c<e.radioGroup.items.length;c++)e.radioGroup.items[c].identifier===p&&(e.radioGroup.items[c].default=s._handlers[p])}return s.callAllInterpreters(e,n).then(function(e){return i.log("[Execution context] Initialize standard components"),s.initializeStandardComponents({generatedData:e})}).then(function(){return o})}))},this._welcomeScreenPromiseSequence=function(e){return i.log("[Execution context] Initialize WS applicative components"),s.initializeWSApplicativeComponents(e).then(function(){return i.log("[Execution context] Initialize application"),s.initializeWelcomeScreen()}).then(function(){i.log("[Execution context] Set Up the application Home Screen"),s.WSState=!0})},this._appPromiseSequence=function(e){let t=e,n=[],r=[],p=[];return e&&0!==Object.keys(e).length&&e.componentsKeys&&e.componentsKeys.forEach(function(e){s._components[e].component&&r.push(s._components[e].component)}),w(s,function(e,o){e.standard||(e.component?t||e.component.isInitialized()||(e.context&&e.context.fit||!e.context)&&r.push(e.component):(e.context&&e.context.fit||!e.context)&&(e.ctor?(s.registerComponentThruMetaData(o,e),r.push(e.component)):(p.push(e.module),n.push(o))))}),s.appModules=p,new o(function(e,t){let o,i,a,c;require(p,function(){for(arguments.length!=s.appModules.length&&e(),o=0;o<arguments.length;o++)i=arguments[o],a=n[o],(c=s._components[a]).ctor=i,s.registerComponentThruMetaData(a,c),r.push(c.component);e()},t)}).then(function(){return s.initializeApplicativeComponents({iterator:_(r)})}).then(function(){return i.log("[Execution context] Configure standard components"),s._isConfigured?Promise.resolve():s.configureComponents({setConfiguredFlag:!0})}).then(function(){return i.log("[Execution context] Initialize application"),s.initializeApp()}).then(function(e){return i.log("[Execution context] set the target app "+s._targetApp+" as source app"),e&&(i.warn("[WARNING] App should use the UIFrame component to add UI to their App"),e.inject(s.getUiContainer())),s.WSState=!1,o.resolve()})},this._launchA2XNativeApp=function(e){var t=this;if(!e.appId)throw new Error("Missing parameter appId!");return E("DS/WAfrA2XLoader/WAfrA2XAppLoader","AppLoader").then(n=>n.AppLoader.loadA2XApp({appId:e.appId,widgetID:t._widgetID}).then(e=>Promise.resolve(e)))},this._addNativeContent=function(e){return this.enrichStandardComponents(e).then(()=>{const e=this.getComponent("Afr_UIComponent");return e&&e.showMainComponent(),W(this),this._appPromiseSequence()})},this.whenAvailable=function(){return Promise.resolve()},this._subscribeToNativeTransitionEvent=function(){let e=Promise.resolve();return E("DS/WAfrA2XLoader/WAfrA2XAppLoader","AppLoader").then(t=>{this.a2xConfig.subscriptionToken=t.AppLoader.subscribeToNativeTransitionEvent({widgetID:this._widgetID,callback:t=>{i.log("Widget reacting to the Transition Event : "+this._widgetID),e=this._subscribeToNativeTransitionEventCallback(t),this.whenAvailable=(()=>new Promise((t,n)=>{e.then(t,n)}))}}),this.a2xConfig.subscribedToNative=!0})},this._unsubscribeToNativeTransitionEvent=function(){let e=this.a2xConfig.subscriptionToken;return E("DS/WAfrA2XLoader/WAfrA2XAppLoader","AppLoader").then(t=>{t.AppLoader.unsubscribeToNativeTransitionEvent(e)})},this._subscribeToNativeTransitionEventCallback=function(e){return new Promise((t,n)=>{const o=e.readString("winID"),r=e.readString("widgetID"),i=e.readString("wkName"),s=e.readString("appContent");if(this._widgetID!=r)console.log("INFO - the current window "+this._widgetID+" is not the target one.");else{if(!i||!s){const e=new Error("Impossible to retrieve the application name or the application content.");return console.error(e),n(e)}{const e=JSON.parse(s);if(!this._winID&&o&&(this._winID=o),(this.getSourceApp()?this.getSourceApp().getId():this.getTargetApp().getId())===`${i}_AP`&&this.getWelcomeScreenState())return this._addNativeContent(e).then(t).catch(e=>(console.error(e),n(e)));{this.a2xConfig.loadedFromNative=!0;const o=`${i}_AP`;this._container.getApplicationJSON({afrAppId:o}).then(e=>(W(this),this.load(e))).then(()=>this._addNativeContent(e).then(()=>(this.a2xConfig.loadedFromNative=!1,t())).catch(e=>(console.error(e),n(e))))}}}})},this._setPreferredWorkbench=function(e){if(!e.appId)throw new Error("Missing parameter appId!");return E("DS/WAfrA2XLoader/WAfrA2XAppLoader","AppLoader").then(t=>t.AppLoader.setPreferredWorkbench({appId:e.appId,widgetId:this._container._view.getId()}))},this._initA2XExecutionContext=function(e){this.a2xConfig||(this.a2xConfig={subscribedToNative:!1,loadedFromNative:!1,subscriptionToken:null,isWelcomeScreenLoaded:!1}),this.stdConfig=S(e);const t=e.appId;return this._setPreferredWorkbench({appId:t}).then(()=>{if(!this.a2xConfig.subscribedToNative)return this._subscribeToNativeTransitionEvent()})},this._closeA2XNativeWindow=function(){var e=this;return E("DS/WAfrA2XWidgetWindowSync/WAfrA2XWidgetWindowSync","WAfrA2XWidgetWindowSync").then(t=>t.WAfrA2XWidgetWindowSync.closeA2XWindow({widgetID:this._widgetID,winID:this._winID}).then(t=>e._winID!=t.readString("winID")||e._widgetID!=t.readString("widgetID")?(i.log("[Execution context] Error during CATFrmWindow destruction"),o.reject()):(i.log("[Execution context] Successful CATFrmWindow destruction"),o.resolve())))},this._disposeExecutionContext=function(){this._timerHandle&&clearTimeout(this._timerHandle),this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment);var e=this;this._sourceApp&&this._sourceApp.dispose(),w(this,function(t){t.component&&(t.component.clean(!0),t.component.setInitializedState(!1),t.component.destroy(!0),t.component.setExecutionContext(null),e.removeComponent(t))},!0),this.isA2X&&(this._unsubscribeToNativeTransitionEvent(),delete this.a2xConfig.loadedFromNative,delete this.a2xConfig.subscribedToNative,delete this.a2xConfig.subscriptionToken,delete this.a2xConfig,delete this.isA2X),delete this._components,delete this._stdComponents,delete this._appComponents,delete this.exposedApi,delete this._contexts,this.onWillLoadApp=null,this.onDidLoadApp=null,this.onDidFailToLoadApp=null,this.onDidContextualComponentsUpdate=null,this._container=null},this._setWidgetIDOnCATFrmWindow=function(){if(!this._widgetID||!this._winID)throw new Error("Missing parameter widgetID or winID!");return E("DS/WAfrA2XWidgetWindowSync/WAfrA2XWidgetWindowSync","WAfrA2XWidgetWindowSync").then(e=>e.WAfrA2XWidgetWindowSync.setWidgetID({widgetID:this._widgetID,winID:this._winID}))}};return f.ExecutionContext=k,k.prototype.setUiContainer=function(e){this._view=e},k.prototype.getUiContainer=function(){return this._view},k.prototype.getContainerView=function(){return this._container?this._container._view:null},k.prototype.getTargetApp=function(){return this._targetApp},k.prototype.getWidgetID=function(){return this._widgetID},k.prototype.getSourceApp=function(){return this._sourceApp},k.prototype.getId=function(){return this._id},k.prototype.getWinID=function(){return this._winID},k.prototype.getComponent=function(e,t){if(null==e)throw new Error("Invalid identifier "+e);var n=void 0;if(this._components&&(n=this._components[e]),n){var o=n.component;if(o){if(t&&o.getExposedComponent&&o.getExposedComponent())return o.getExposedComponent();if(!t||!n.standard)return o}}},k.prototype.cleanComponent=function(e,t){if(!e)throw new Error("Component must be defined ");var n=e.getRegisteredIdentifier();if(null==n||"string"!=typeof n)throw new Error("Invalid identifier "+n);var r=this._components[n];if(!r)throw new Error("The MetaData for this component do not exists");var s=this;if(i.log("[Execution context] clean component "+n),r.new)return r.new=!1,o.resolve();var p=e.clean()||o.resolve();return r.recycled&&r.context&&(r.recycled=g(s._contexts,r.context,!0)),!r.recycled&&!r.standard||r.standard&&r.clear||r.welcomeScreen?p.then(function(){return e.setInitializedState(!1),i.log("[Execution context] destroy component "+n),e.destroy()}).then(function(){return i.log("[Execution context] Remove component "+n+" from execution context"),t=!!r.clear||t&&!r.standard,s.removeComponent(r,t),o.resolve(e)}):(r.recycled=!1,r.standard||e.setInitializedState(!1),p.then(function(){return o.resolve(e)}))},k.prototype.unregisterComponent=function(e,t){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);if(void 0!==this._components[e]){var n=this._components[e];if(n.standard&&t)throw new Error("Invalid access, try to unregister a standard component from application side");var r=n.component,s=this;return i.log("[Execution context] clean component "+e),(r.clean()||o.resolve()).then(function(){return i.log("[Execution context] destroy component "+e),r.destroy()}).then(function(){return i.log("[Execution context] Remove component "+e+" from execution context"),s.removeComponent(n,!0),o.resolve(r)})}return o.resolve()},k.prototype.isRegisteredComponent=function(e){if(!e)throw new Error("The component is null or undefined");var t=!1,n=e.getRegisteredIdentifier(),o=this._components[n];return o&&o.component&&(o.component===e||o.component.getExposedApi&&o.component.getExposedApi()===e)&&(t=!0),t},k.prototype.cleanComponents=function(e){var t=this;return v({action:function(n){return t.cleanComponent(n,!!e&&e.removeForGood)},inverse:!0,iterator:e&&e.iterator?e.iterator:A(t._appComponents.concat(t._stdComponents),t._components)})},k.prototype.destroyComponents=function(e){var t=this;return v({action:function(e){i.log("[Execution context] destroy component "+e.getRegisteredIdentifier());var n=t._components[e.getRegisteredIdentifier()];return e.destroy().then(function(){return t.removeComponent(n,n.clear)})},inverse:!0,iterator:e&&e.iterator?e.iterator:A(that._appComponents.concat(that._stdComponents),that._components)})},k.prototype.recycleComponent=function(e,t){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);var n=this._components[e];if(!n)return!1;if(n.standard)throw new Error("Cannot recycle a standard component");if(n.recycled)return!1;var o=!0;if(t){var r=this._targetApp.options.appConfig.components.find(t=>t.key==e);n.options=r.options,n.component&&(n.component.options=r.options),r.when?(n.context={element:r.key,when:m(r.when),onDidFitContext:this.onDidFitContextForComponent.bind(this),onDidUnfitContext:this.onDidUnFitContextForComponent.bind(this)},o=g(this._contexts,n.context,!0)):delete n.context}return o&&(n.recycled=!0),!0},k.prototype.isComponentRecycled=function(e){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);var t=this._components[e];return!!t&&t.recycled},k.prototype.getComponents=function(e,t){if(!e)throw new Error("Predicate function is mandatory");var n,o=[],r=this;return w(this,function(i,s){(n=r.getComponent(s,t))&&e(n)&&o.push(n)}),o},k.prototype.registerComponent=function(e,t,n,o){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);if(null==t)throw new Error("Component cannot be null");if(o&&!C(Object.getPrototypeOf(t))&&!C(t))throw new Error("the given component do not contains some methods of DS/WAfrExecutionContext/mod_Component");if("setExecutionContext"in t==!1||"setRegisteredIdentifier"in t==!1)throw new Error("The component do not implements module:DS/WAfrExecutionContext/mod_Component~Component. Use applyComponentMixin first from the context.");if(this._components[e])throw new Error("An component has already been registered with this identifier "+e);var r=n?this._appComponents:this._stdComponents,i={standard:!n,position:r.length};this._components[e]=i,r.push(e),this.registerComponentThruMetaData(e,i,t)},k.prototype.removeComponent=function(e,t){if(!e)throw new Error("You must provide a metaData");if(!e.component)throw new Error("The component is already removed");var n=e.component.getRegisteredIdentifier();if(e.component.setExecutionContext(null),e.component.setRegisteredIdentifier(null),delete e.component,t){var o=e.standard?this._stdComponents:this._appComponents,r=o.indexOf(n);if(r>=0&&o.splice(r,1),!e.standard){let e=this._WSComponents.findIndex(function(e){return e===n});-1!==e&&this._WSComponents.splice(e,1)}delete this._components[n]}},k.prototype.registerComponentThruMetaData=function(e,t,o){if(!t)throw new Error("The metaData do not exist: the module may not be required");if(t.component)throw new Error("The component: "+t.component._private._identifier+" is already created");if(!o){if(!t.ctor)throw new Error("The Component constructor must be defined.");if("function"!=typeof t.ctor)throw new Error(" Component constructor must be a constructor (i.e. functions)");o=y(t.ctor,t.options,!t.standard)}t.component=o;var r=t.standard?this:this.exposedApi;t.component.setExecutionContext(r),t.component.setRegisteredIdentifier(e);var i=t.component.createExposedComponent&&t.component.createExposedComponent();if(i)n.Component.mixinProperties(i),i.setExecutionContext(this.exposedApi),i.setRegisteredIdentifier(e),t.component.setExposedComponent(i);else{var s=t.component.getExposedComponentCtor&&t.component.getExposedComponentCtor();if(s){var p=y(s,void 0,!0);p.setExecutionContext(this.exposedApi),p.setRegisteredIdentifier(e),t.component.setExposedComponent(p)}}return t.component},k.prototype.createAndRegisterComponent=function(e,t,n,o){if(!this._components[e]){var r=y(t,n,o);if(this.registerComponent(e,r,o),!this._components[e])throw new Error("The metaData for component do not exist !");return this._components[e].ctor=t,r}},k.prototype.requireStandardComponents=function(e,t){var n,r,i,s,p,a=this;if(e.length!==t.length)throw new Error("Modules and keys do not have the same size !");return new o(function(o,c){require(e,function(){var e;for(n=0;n<arguments.length;n+=1)r=arguments[n],i=t[n],e=a._components[i],s=e.ctorImport,p=s?r[s]:r,e.ctor=p,a.registerComponentThruMetaData(i,e);o()},c)})},k.prototype.registerStandardComponents=function(){i.log("[Execution context] Register standard components if need ");var e=this;if(e._stdComponents.length>0){var n,o=[],r=[],s=[],p=[],a=Array.from(e._config.components);if(w(this,function(t,i){if(e._stdComponents.length!=e._config.components.length&&t.standard){0==a.length&&(t.component?(s.push(t.component),t.clear=!0):delete e._components[i]);for(let n=0;n<a.length;n++){if(a[n].key===i){a.splice(n,1);break}n===a.length-1&&(t.component?(s.push(t.component),t.clear=!0):delete e._components[i])}}t.standard&&t.context&&(n=g(e._contexts,t.context,!0),t.component?!n&&t.component&&(s.push(t.component),p.push(t.component)):n&&(o.push(t.module),r.push(i)))}),e._stdComponents.length!=e._config.components.length){var c=e.parseComponents(a,!1,!0);e._components=t.merge(e._components,c.metaDatas),e._stdComponents=e._config.components.map(e=>e.key),o=o.concat(c.readyModules),r=r.concat(c.readyKeys)}return e.cleanComponents({iterator:_(s)}).then(function(){return e.destroyComponents({iterator:_(p)})}).then(function(){return e.requireStandardComponents(o,r)})}var u=e.parseComponents(e._config.components);return e._components=t.merge(e._components,u.metaDatas),e._stdComponents=u.componentsKeys,e.requireStandardComponents(u.readyModules,u.readyKeys)},k.prototype.initializeStandardComponents=function(e){var t=this,n=null;return v({action:function(e,o){(n=e.getCurrentInterpreter&&e.getCurrentInterpreter())&&n.commit&&n.commit(t,{componentId:e.getRegisteredIdentifier()});let r=t._perf.start("WAFR: initialize std :"+e._private._identifier);return e.initialize(o).then(function(){t._perf.stop(r)})},generatedData:e.generatedData,iterator:e&&e.iterator?e.iterator:A(this._stdComponents,this._components)})},k.prototype.enrichStandardComponents=function(e){const t=this._interpreters,n=this;let o=Promise.resolve();return this._interpreters.length>0&&(o=x(function(e){return e<t.length},function(o){const r=t[o];let i=Promise.resolve();return r.enrich&&(i=r.enrich(e,n).then(function(){},function(e){throw e})),i.then(()=>++o)},0)),o},k.prototype.initializeWSApplicativeComponents=function(e){var t=this;return v({action:function(e,n){let o=t._perf.start("WAFR: initialize "+e._private._identifier);var r=e.initialize(n);return r&&r.then||i.warn(`[Execution Context] The initialize method of your component ${e._private._identifier} is not a Promise object. Make sure it is not asynchronous.`),Promise.resolve(r).then(function(){e.setInitializedState(!0),t._perf.stop(o)})},iterator:e&&e.iterator?e.iterator:A(this._WSComponents,this._components)})},k.prototype.cleanNonWSComponentsMetadatasMap=function(){const e=this._targetApp.getTransitionFrom(this._sourceApp.getId());let t=[];e&&e.components&&e.components.keep&&(t=e.components.keep);const n=this._targetApp.getTransitionFromFamily(this._sourceApp.getFamily());let o=[];n&&n.components&&n.components.keep&&(o=n.components.keep),(this._sourceApp.options.appConfig.components||[]).forEach(e=>{-1===t.indexOf(e.key)&&-1===o.indexOf(e.key)&&(e.options&&e.options.welcomeScreen||delete this._components[e.key])})},k.prototype.configureComponents=function(e){var t=this;return v({action:function(e){return e.configure()},iterator:e&&e.iterator?e.iterator:A(this._stdComponents,this._components)}).then(function(){e&&e.setConfiguredFlag&&(t._isConfigured=!0)})},k.prototype.cleanStandardComponents=function(){return v({action:function(e){return e.clean()},iterator:A(this._stdComponents,this._components)})},k.prototype.parseApplicativeComponents=function(e){return this._appConfig={components:e},this.parseComponents(e,!0)},k.prototype.registerApplicationComponent=function(e,t){if(!t)throw new Error("Component is null");return this.registerComponent(e,t,!0,!0)},k.prototype.createAndRegisterApplicationComponent=function(e,t,n){if(!t)throw new Error("Component is null");return this.createAndRegisterComponent(e,t,n,!0)},k.prototype.createAndRegisterApplicationComponentsList=function(e){if(i.log("[Execution Context] Register Application Components :"+e),e)for(var t=0;t<e.length;t++){var n=e[t];this.createAndRegisterApplicationComponent(n.key,n.mod,n.options)}},k.prototype.getApplicationComponent=function(e){return this.getComponent(e,!0)},k.prototype.unregisterApplicationComponent=function(e){return this.unregisterComponent(e,!0)},k.prototype.isRegisteredApplicationComponent=function(e){return this.isRegisteredComponent(e)},k.prototype.recycleApplicationComponent=function(e,t,n){if(t&&!t.metaDatas[e])throw new Error('The App "'+this._targetApp.getId()+'" has requested to recyle the component "'+e+'" but do not declare it in its list of components :\n'+JSON.stringify(t.metaDatas,null,2));return this.recycleComponent(e,n)},k.prototype.isApplicationComponentRecycled=function(e){return this.isComponentRecycled(e)},k.prototype.prepareTransition=function(e){var t,n,r=this,i=0;return this._sourceApp?this._sourceApp.onWillLeave(this._targetApp).then(function(){return r._targetApp.onWillEnter(r._sourceApp)}).then(function(){var o=!0,s=r._targetApp.getTransitionFrom(r._sourceApp.getId());if(s||(s=r._targetApp.getTransitionFromFamily(r._sourceApp.getFamily())),s){var p=s.components||{},a=s.handlers||{};if(null!=s.resetInfo&&(o=s.resetInfo),p.keep)if("@all"===p.keep)for(t in r.applicationContext._components)r.recycleApplicationComponent(t,e,o);else if(Array.isArray(p.keep))for(;i<p.keep.length;i++)n=p.keep[i],r.recycleApplicationComponent(n,e,o);if(a.keep&&Array.isArray(a.keep)){var c=r._sourceApp.options.appConfig.handlers.check,u=e.app.options.appConfig.handlers.check,d=r._sourceApp.options.appConfig.radioGroup.items,l=e.app.options.appConfig.radioGroup.items,h="",f=h,m=h,g=r.getComponent(WAfrStandardComponentKey.HandlerComponent);for(i=0;i<a.keep.length;i++){m=a.keep[i],h=f="";for(var _=0;_<c.length;_++)if(c[_].identifier==m){h=c[_].identifier+"-"+c[_].check.identifier+"-"+c[_].uncheck.identifier;break}for(_=0;_<u.length;_++)if(u[_].identifier===m){f=u[_].identifier+"-"+u[_].check.identifier+"-"+u[_].uncheck.identifier;break}if(f===h&&""!=h){var C=g.getCheckState({id:m});r._handlers[m]=C}else{for(_=0;_<d.length;_++)if(d[_].identifier==m)for(var x=0;x<d[_].items.length;x++)1==g.getRadioItemState({radioId:d[_].identifier,id:d[_].items[x].identifier})&&(h=d[_].identifier+"-"+d[_].items[x].identifier+"-"+d[_].items[x].check.identifier+"-"+d[_].items[x].uncheck.identifier);for(_=0;_<l.length;_++)if(l[_].identifier==m)for(x=0;x<l[_].items.length;x++)if((f=l[_].identifier+"-"+l[_].items[x].identifier+"-"+l[_].items[x].check.identifier+"-"+l[_].items[x].uncheck.identifier)==h){C=l[_].items[x].identifier;r._handlers[m]=C;break}}}}}return r.cleanComponents({removeForGood:!0})}).then(function(){return r._doIWantToBeInWSContext&&r.cleanNonWSComponentsMetadatasMap(),o.resolve(e)}):o.resolve(e)},k.prototype.initializeApplicativeComponents=function(e){var t=this;return v({action:function(e,n){let o=t._perf.start("WAFR: initialize "+e._private._identifier);var r=e.initialize(n);return r&&r.then||i.warn(`[Execution Context] The initialize method of your component ${e._private._identifier} is not a Promise object. Make sure it is not asynchronous.`),Promise.resolve(r).then(function(){e.setInitializedState(!0),t._perf.stop(o)})},iterator:e&&e.iterator?e.iterator:A(this._appComponents,this._components)})},k.prototype.load=function(e,t){var n=this;if(!e.appId&&!e.afrAppId)throw new Error("Not found a valid App id from the current Id Card ");l.setAppid(e.appId||e.afrAppId),this.onWillLoadApp&&this.onWillLoadApp(e.appId||e.afrAppId),n._perf.start("WAFR:  load entire App "),t||(t=e.afrVersion||"0.1"),i.log("[Execution context] load new app "+e.appId),this.isA2X=I(e,"a2x");let r=this.isA2X?{...e.initialContext,a2x:!0}:e.initialContext;n.setInitialContext(r);var s=void 0;if(n._sourceApp&&e.afrTransitionsFrom&&((s=e.afrTransitionsFrom[n._sourceApp.getId()])||(s=e.afrTransitionsFromFamily?e.afrTransitionsFromFamily[n._sourceApp.getFamily()]:null),s&&"ReuseContext"===s.type)){var p=s.components||{};if(p.keep){if("@all"===p.keep)throw"TODO";if(Array.isArray(p.keep)){for(var a={},c=0;c<p.keep.length;c++){var u=p.keep[c],d=n._components[u];d&&d.context&&!0===d.context.fit&&Object.keys(d.context.when).forEach(function(e){a[e]=d.context.when[e]})}Object.keys(a).forEach(function(e){var t=a[e];null!=t&&(n._contexts[e]=String(t))})}}}let h=Promise.resolve();return this.isA2X&&(h=this._initA2XExecutionContext(e),this.stdConfig=S(e)),h.then(()=>this._initExecutionContext(e,t,s)).then(function(e){if(n._doIWantToBeInWSContext&&!n._winID)return n._welcomeScreenPromiseSequence(e);if(!n.isA2X)return n._appPromiseSequence(e);if(n._winID&&n._container._appContent)return n._appPromiseSequence(e).then(e=>n._addNativeContent(n._container._appContent).then(e=>(delete n._container._appContent,n._setWidgetIDOnCATFrmWindow().then(()=>{}))));if(!n.a2xConfig.loadedFromNative&&n.getTargetApp()){const e=n.getTargetApp().getId();return n._launchA2XNativeApp({appId:e})}}).then(function(){n.getSourceApp()&&!n.getSourceApp().isDisposeCalled()&&n.getSourceApp().dispose(),n._sourceApp=n._targetApp,n._targetApp=null,n.hideLoader(),n.onDidLoadApp&&n.onDidLoadApp()}).catch(function(e){return n.getSourceApp()&&l.setAppid(n.getSourceApp().getId()),n.hideLoader(),n.onDidFailToLoadApp&&n.onDidFailToLoadApp(e),o.reject(e)})},k.prototype.loadApp=function(e){var t=this;return new o(function(n,o){var r=e.afrCode;r||(r="DS/WAfrAppManager/App"),r=r.replace(/\./g,"/");var p,a,c,u,d,l,h=t.parseComponents(e.components||[],!0),f=[r].concat(h.readyModules);i.log("[Execution Context] Require modules "+f),require(f,function(){var r=arguments[0];if(arguments.length!==h.readyKeys.length+1)throw new Error("The count of arguments and components do not fit");for(p=0;p<h.readyKeys.length;p++)a=h.readyKeys[p],c=h.metaDatas[a],u=arguments[p+1],d=c.ctorImport,l=d?u[d]:u,c.ctor=l,t.registerComponentThruMetaData(a,c);var f=new r({appConfig:e});f instanceof s!=!1?f.getId()?(i.log("[App Interpreter] Success require App and components "),n({app:f,metaDatas:h.metaDatas,componentsKeys:h.componentsKeys,WSComponentsKeys:h.WSComponentsKeys})):o(new Error("The app loaded do not have an id")):o(new Error("The app loaded is not an instance of DS/WAfrAppManager/App"))},o)})},k.prototype.callAllInterpreters=function(e,t){i.log("[Execution context] Start interpret id card");var n=[],r=this._version!==t;function s(t,r){const i=t?this.getComponent(t):void 0;if(!i)throw new Error("No component associated to the given interpreter");if(i.setCurrentInterpreter(r),r){var s=r.interpret(e,this,{componentId:t});n.push(s)}else n.push(o.resolve(null))}let p=Promise.resolve();return this._interpreters&&this._config.interpreters.length==this._interpreters.length||(this._interpreters=[],r=!1,this._config.interpreters.length>0&&(p=x(e=>e<this._config.interpreters.length,e=>{return this._config.interpreters[e].module.generateInterpreter(t,this.stdConfig).then(t=>(this._interpreters.push(t),++e))},0))),p.then(function(){return this._interpreters||(this._interpreters=[]),x(e=>e<this._interpreters.length,e=>{var n=this._interpreters[e];return r?this._config.interpreters[e].module.generateInterpreter(t,this.stdConfig).then(t=>(this._interpreters[e]=t,s.bind(this)(this._config.interpreters[e].target,t),Promise.resolve(++e))):(s.bind(this)(this._config.interpreters[e].target,n),Promise.resolve(++e))},0)}.bind(this)).then(()=>o.all(n))},k.prototype.initializeApp=function(){var e=this.getTargetApp();if(!e&&!(e=this.getSourceApp()))return o.reject(new Error("No app has been loaded by the interpreter !"));var t=this;return e._executionContext=this.exposedApi,e.setContainer(t._container?t._container._view:null),new o(function(n,o){if(e){var r=e.setUp({sourceApp:t._sourceApp,done:function(e){n(e)},failure:function(e){o(e)}});r&&r.then(n,o)}})},k.prototype.initializeWelcomeScreen=function(){var e=this.getTargetApp();if(!e&&!(e=this.getSourceApp()))return o.reject(new Error("No app has been loaded by the interpreter !"));var t=this;e._executionContext=this.exposedApi,e.getContainer()||e.setContainer(t._container?t._container._view:null);var n=new o(function(n,o){if(e){var r=e.setUpWS({sourceApp:t._sourceApp,done:function(e){n(e)},failure:function(e){o(e)}});r&&r.then(n,o)}}).then(function(){if(t.isA2X){const e=t.getComponent("mod_WelcomeScreen");e&&e.showWelcomeScreen()}});return this.isA2X&&(this.a2xConfig.isWelcomeScreenLoaded=!0),n},k.prototype.dispose=function(){return this._winID&&""!=this._winID?this._closeA2XNativeWindow().then(()=>(this._disposeExecutionContext(),o.resolve()),function(e){return alert("Error during closing of Window on server side"),o.reject(e)}):(this._disposeExecutionContext(),o.resolve())},k.prototype.registerContextualElement=function(e,t){if(!e||!e.when)throw new Error("The contextual element must be defined and must contain a when expression");t=t||{};var n={element:e,when:m(e.when),onDidFitContext:t.onDidFitContext,onDidUnfitContext:t.onDidUnfitContext};return this._contextualElements.push(n),g(this._contexts,n),n},k.prototype.onDidChangeContext=function(){this._timerHandle=null;var e=this._contexts;w(this,function(t){t.context&&g(e,t.context)}),this._contextualElements.forEach(function(t){g(e,t)})},k.prototype.parseComponents=function(e,t,n){var o,r,i=[],s=[],p={},a=[],c=[],u=this;return e.forEach(function(e){o=!0,r={module:e.code,ctorImport:e.ctor,options:e.options,standard:!t,position:a.length,new:1==n,resetInfo:e.resetInfo},"mod_WelcomeScreen"===e.key&&(r.welcomeScreen=!0),p[e.key]=r,a.push(e.key),e.when&&(r.context={element:e.key,when:m(e.when),onDidFitContext:u.onDidFitContextForComponent.bind(u),onDidUnfitContext:u.onDidUnFitContextForComponent.bind(u)},o=g(u._contexts,r.context,!0)),t&&u._doIWantToBeInWSContext&&(e.options&&e.options.welcomeScreen||"mod_WelcomeScreen"===e.key?c.push(e.key):o=o&&!u._doIWantToBeInWSContext),o&&(i.push(e.code),s.push(e.key))}),{readyModules:i,readyKeys:s,metaDatas:p,componentsKeys:a,WSComponentsKeys:c}},k.prototype.onDidFitContextForComponent=function(e){var t=this._components[e];if(t&&t.context){if(!t.context.fit)throw new Error("Unexpected state of context");this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment),this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)}},k.prototype.onDidUnFitContextForComponent=function(e){var t=this._components[e];if(t&&t.context){if(t.context.fit)throw new Error("Unexpected state of context");this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment),this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)}},k.prototype.setInitialContext=function(e){var t,n=Object.create(null);Object.keys(e||n).forEach(function(o){null!=(t=e[o])&&(n[o]=String(t))}),this._contexts=n},k.prototype.setContext=function(e,t){return this._contexts[e]!==t&&(t?this._contexts[e]=String(t):delete this._contexts[e],this._timerHandle&&clearTimeout(this._timerHandle),this._timerHandle=setTimeout(this.onDidChangeContext.bind(this,this._contexts),0)),this},k.prototype.onDidProcessContextualComponent=function(){var e=[],t=[],n=[],r=[],i=[],s=[],p=this;return w(this,function(o,a){if(o.context){var c=!0;o.standard||p._WSComponents.includes(a)||(c=c&&!p.WSState),c&&o.context.fit&&!o.component?o.ctor?(p.registerComponentThruMetaData(a,o),o.standard?i.push(o.component):s.push(o.component)):(e.push(o.module),t.push(a)):o.context.fit||o.component&&(n.push(o.component),o.standard&&r.push(o.component))}}),this._timerHandleTreatment=null,p.modules=e,new o(function(n,o){var r,a,c,u;require(e,function(){if(arguments.length!==p.modules.length)return n();for(r=0;r<arguments.length;r++)a=arguments[r],c=t[r],(u=p._components[c]).ctor=a,u=p._components[c],p.registerComponentThruMetaData(c,u),u.standard?i.push(u.component):s.push(u.component);n()},o)}).then(function(){return p.cleanComponents({iterator:_(n)})}).then(function(){return p.destroyComponents({iterator:_(r)})}).then(function(){return p.initializeStandardComponents({iterator:_(i)})}).then(function(){return p.initializeApplicativeComponents({iterator:_(s)})}).then(function(){return p.getWelcomeScreenState()||p._doIWantToBeInWSContext?Promise.resolve():p.configureComponents({iterator:_(i),setConfiguredFlag:!1})}).then(function(){return p.onDidContextualComponentsUpdate&&p.onDidContextualComponentsUpdate(),o.resolve()})},k.prototype.displayLoader=function(e){if(!(this._container&&this._container.id!=e.id||this._loader)){this._loader=new u;var t=d.get("WAfrTransitionLaunched.title");this._loader.on(t+e.appTitle+"..."),c.createModal(this._view,this._loader.elements.container)}},k.prototype.hideLoader=function(){this._loader&&this._view&&(this._loader.off(),c.removeModal(this._view),this._loader=null)},k.prototype.gotoWelcomeScreen=function(){var e=this;return e._doIWantToBeInWSContext=!0,this.initializeWelcomeScreen().then(function(){let t=e.getComponent("AFR_UIFrameManager");return t&&t.isStatusBarDisplayed()&&t._privateSetStatusBarWrapperVisibility(!1),e.WSState=!0,Promise.resolve()})},k.prototype.gotoApp=function(){this._doIWantToBeInWSContext=!1;Promise.resolve();if(this.isA2X&&this.getSourceApp()){let e=this.getSourceApp().getId();return this._launchA2XNativeApp({appId:e})}let e=this.getComponent("AFR_UIFrameManager");return e&&e.isStatusBarDisplayed()&&e._privateSetStatusBarWrapperVisibility(!0),this._appPromiseSequence()},k.prototype.getWelcomeScreenState=function(){return this.WSState},f});