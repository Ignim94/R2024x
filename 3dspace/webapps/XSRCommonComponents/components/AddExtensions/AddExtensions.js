define("DS/XSRCommonComponents/components/AddExtensions/AddExtensions",["UWA/Class","DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Expander","DS/Controls/Accordeon","DS/WUXAutoComplete/AutoComplete","DS/Controls/LineEditor","DS/Controls/DatePicker","DS/Controls/ComboBox","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/Notification","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,a,n,l,s,i,o,r,d,c,m){"use strict";return e.extend({init:function(e){this.itemId=e.itemId,this.type=e.type,this.parentId=e.parentId,this.modelEvents=e.modelEvents,this.applicableExts=e.applicableExtensions,this.attachedExts=e.attachedExtensions.filter(e=>"Change Control"!=e.name)},render:function(){var e=this;let i=e.attachedExts.map(e=>e.nameNLS),o=e.applicableExts.map(e=>e.nlsName).filter(e=>!i.includes(e));e.extensionsNameToObjMap=e.applicableExts.reduce((e,t)=>(e[t.nlsName]=t,e),{}),e.extensionsToAdd={},e.extensionsAttribInfo={},e.extensionsToRemove=[];var r=UWA.createElement("div",{class:"add-extensions-container",styles:{height:"inherit"}}),d=UWA.createElement("div",{id:"ext-autocomplete-container",styles:{overflow:"visible"}}).inject(r),u=UWA.createElement("div",{id:"new-extension-container",styles:{overflow:"auto","padding-top":"1em"}}).inject(r),p=UWA.createElement("div",{id:"attachedExtDiv"}).inject(r),f=new s({elementsTree:o,allowFreeInputFlag:!1,placeholder:m.placeholder_enter_extensions}).inject(d);let v={};f.addEventListener("change",function(t){let a=t.dsModel.value,n=x.items.map(e=>e.header);n.forEach(e=>{if(!a.includes(e)){let t=v[e];x.deleteItem(x.getIndexFromId(t)),delete v[e]}});for(const t of a)if(!n.includes(t)){let a=x.addItem({header:t,content:e.getAttributesUI(e.extensionsNameToObjMap[t]),selected:!0});v[t]=a,x.expandItem(a)}});var x=new l({style:"divided",exclusive:!1}).inject(u);let h=UWA.createElement("div",{id:"attachedExtsContainer"});e.attachedExts.forEach(t=>{let a=UWA.createElement("div",{class:"attachedExt",styles:{display:"flex","justify-content":"space-between","background-color":"#f1f1f1",padding:"0.6em","margin-bottom":"1em","border-radius":"1em"}}),n=(UWA.createElement("span",{class:"attachedExt-label",text:t.nameNLS}).inject(a),UWA.createElement("span",{class:"attachedExt-remove wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-exchange-delete",icon:"table",title:m.tooltip_remove_extension}).inject(a));a.inject(h),n.addEventListener("click",a=>{e.extensionsToRemove.push(t.name),a.target.getParent().destroy()})});new n({header:m.label_attached_extensions,body:h}).inject(p);var b=new a({title:m.label_add_extensions,content:r,minHeight:300,width:600,activeFlag:!1,modalFlag:!0,resizableFlag:!0,buttons:{Ok:new t({onClick:function(){let t=x.items.map(e=>e.header),a=!1;const n=e=>{for(const t of e)if(t.mandatory){let e=!t.value||""===t.value.trim();if("ReadOnly"==t.uiaccess?a=!1:(""==t.default&&(a=e),""!=t.default&&(t.ranges||null==t.value&&(t.value=t.default),t.value||(a=!1,""!==t.value&&void 0!==t.value||(a=!0))),t.ranges&&""!=t.default&&(a=!1),"Date"==t.primitive&&(t.value||(t.value=(new Date).toDateString()),a=!1)),a)return c.clearNotifications(),c.displayNotification({eventID:"warning",msg:m.mandatoryValue}),!1}return!0};if(t.length>0&&((()=>{for(const a of t){let t=e.extensionsNameToObjMap[a].attributes;if(!n(t))return;let l={},s={};t.forEach(e=>{let t=null,a=null;e.ranges?(e.value&&(t=Object.keys(e.ranges).find(t=>e.ranges[t]===e.value)),e.default&&(a=Object.keys(e.ranges).find(t=>e.ranges[t]===e.default))):(e.value&&(t=e.value),e.default&&(a=e.default)),s[e.path]={value:t||a||e.default,type:e.primitive,ranges:e.ranges,hasRange:e.hasRange,readOnly:"ReadOnly"===e.uiaccess,mandatory:e.mandatory},l[e.path]=t||a||e.default}),e.extensionsToAdd[e.extensionsNameToObjMap[a].name]=l,e.extensionsAttribInfo[e.extensionsNameToObjMap[a].name]=s}})(),a))return;let l={extToAdd:e.extensionsToAdd,extToRemove:e.extensionsToRemove,extAttribsInfo:e.extensionsAttribInfo,itemId:e.itemId,type:e.type,parentId:e.parentId};e.modelEvents.publish({event:"handle-modified-extensions",data:l}),b.close()}}),Cancel:new t({onClick:function(){b.close()}})}})},getAttributesUI:function(e){var t=this;let a=UWA.createElement("div",{class:"ext-attributes-container"});return e.attributes.forEach(n=>{let l=UWA.createElement("div",{class:"attribute-container",styles:{display:"flex","align-items":"center","padding-bottom":"0.5em"}}).inject(a),s=UWA.createElement("div",{class:"attribute-label-container",text:n.nlsName,styles:{"padding-right":"2em",width:"50%"}}).inject(l);if(n.mandatory)new UWA.Element("span",{class:"xsr-mandatory-flag",text:" *"}).inject(s);let c=UWA.createElement("div",{class:"attribute-field-container",styles:{width:"50%",display:"flex"}}).inject(l),u="";if("ReadOnly"==n.uiaccess){UWA.createElement("div",{class:"attribute-value-read-only",text:n.default}).inject(c)}else{if(n.hasRange)u=new r({elementsList:Object.values(n.ranges),value:n.ranges[n.default]}).inject(c);else switch(n.primitive){case"Date":u=new o({placeholder:m.placeholder_enter_value,value:n.default,displayClearFieldButtonFlag:!0}).inject(c);break;case"String":u=new i({placeholder:m.placeholder_enter_value,value:n.default,displayClearFieldButtonFlag:!0,maxLength:0!=n.maxLength?n.maxLength:""}).inject(c);break;case"Integer":u=new i({placeholder:m.placeholder_enter_number,value:n.default,pattern:"-?[0-9]+",displayClearFieldButtonFlag:!0}).inject(c);break;case"Double":u=new i({placeholder:m.placeholder_enter_real_number,value:n.default,pattern:"-?[0-9]+(.[0-9]+)?",displayClearFieldButtonFlag:!0}).inject(c);break;case"Boolean":u=new r({elementsList:[m.label_true.toUpperCase(),m.label_false.toUpperCase()],value:n.default.toUpperCase()===m.label_true.toUpperCase()?m.label_true.toUpperCase():m.label_false.toUpperCase()}).inject(c)}u.addEventListener("change",a=>{let l=a.dsModel.value,s=e.nlsName,i=n.name,o=t.extensionsNameToObjMap[s].attributes;for(let e=0;e<o.length;e++){let t=o[e];if(t.name===i){t.value=l instanceof Date?d.convertDateToStandard(l):l;break}}})}if(n.unitNLSName&&""!==n.unitNLSName){UWA.createElement("span",{class:"dimension-unit-read-only",text:`(${n.unitNLSName})`,styles:{"margin-left":".5em"}}).inject(s)}}),a}})});