define("DS/XSRCommonComponents/service/CommandsService",["UWA/Class","UWA/Class/Promise","DS/ApplicationFrame/CommandsManager","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/alternate/services/XSpecsAlternateCtxManager","DS/XSRCommonComponents/utils/Notification","text!DS/XSRCommonComponents/assets/config/Commands.json","DS/XSRCommonComponents/utils/ContextManager","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,a,n,o,i,r,d,m){"use strict";return e.singleton({init:function(e){this._commandConfig=JSON.parse(r)},initialize:function(e){var t=this;t.modelEvents=e.modelEvents,t.modelEvents.subscribe({event:n.EVENT_LAUNCH_COMMAND},function(e){t._commandsListener(e)}),t._loadAllCommands(e),widget&&void 0!==widget.data&&widget.data.appId===n.XSR_APP_ID&&(widget.appMediator=t.modelEvents)},_commandsListener:function(e){var t=this,o=["UPSAuthUnparent","UPSAuthReorderProduct","UPSAuthReplaceByRevision","UPSReplaceByLatestRevision"];if(!e.commandId)throw new Error("commandId is a mandatory parameter");if(!t._commandConfig[e.commandId])throw new Error("command doesn't existing");var i=t._commandConfig[e.commandId];t.commandLoaderStatus.then(function(r){var d;UWA.is(r,"array")&&r.length>0&&r.forEach(function(e){e&&e.value&&e.value._id===i.commandHdr&&(d=e.value._ctx)});var m=t.prepareCmdInput(e.context,e.commandId);e.commandId!==n.SUBSCRIBE_CMD&&e.commandId!==n.UNSUBSCRIBE_CMD&&e.commandId!==n.EDIT_SUBSCRIBE_CMD&&e.commandId!==n.MY_SUBSCRIPTIONS_CMD||(m._selectedItems[0].options.type=m._selectedItems[0].getTypeActualName()),e.commandId===n.INFORMATION_CMD&&(e.context.item&&e.context.item.cmdLaunchAt&&(m.cmdLaunchAt=e.context.item.cmdLaunchAt),m.commandId=e.commandId);var c=a.getCommand(i.commandHdr,d),s=function(){o.includes(e.commandId)?c.begin(m):c.execute(m)};if(t.modelEvents&&t.modelEvents.getEventByName(n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN))t.modelEvents.publish({event:n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN,data:{callBackFunc:s,cmdId:e.commandId,selNodes:m._selectedItems}});else if(s(),"UPSAuthReorderProduct"==i.commandHdr){let e=0;const t=()=>{setTimeout(()=>{console.log(e++),!c.isEnabled()||c.reorderDlg&&c.reorderDlg._dialog?c.reorderDlg&&c.reorderDlg._dialog?d.gridView.modelEvents.publish({event:"reorder-close-event-listener-"+d.gridView.currentTabKey,data:c}):t():d.gridView.modelEvents.publish({event:"reorder-close-event-listener-"+d.gridView.currentTabKey,data:""})},200)};t()}}).catch(function(e){console.log(e)})},_loadAllCommands:function(e){var a=this,n=[];for(var o in a._commandConfig)if(a._commandConfig.hasOwnProperty(o)){var i=a._commandConfig[o],r=new t(function(t,n){a.loadCommand(i,e,t,n)});n.push(r)}return a.commandLoaderStatus=t.allSettled(n),a.commandLoaderStatus},loadCommand:function(e,t,a,n){if(!e||!e.commandHdr||!e.AmdLoader)return console.error("Oups ! no valid command description"),void n("Oups ! no valid command description");var o=this;return require([e.AmdLoader,t],function(n){var i={context:t.appContext?t.appContext.contextManager:d.getContext(),ID:e.commandHdr,modelEvents:o.modelEvents};n&&a(new n(i))},function(e){n(e)})},_getObjectAdditionnalData:function(e){return{type:e.getTypeActualName(),name:e.getTitle(),displayName:e.getTitle(),revision:e.getRevision(),physicalid:e.getID()}},prepareCmdInput:function(e,t){var a={},i=[];if(e.item){var r=[],m=e.item.data||e.item;if(m)if(Array.isArray(m))for(var c=0;c<m.length;c++)i.push(this._getObjectAdditionnalData(m[c])),r.push(m[c]);else m=[e.item.data||e.item],r.push(e.item.data||e.item);var s=r.length>1;if(e.item.nodeModels){let t=e.item.nodeModels;d.setGridChildNodes(t)}d.addSelection(r);let p=e.item.selectFacet?e.item.selectFacet:void 0;if(a={_selectedItems:m},t)switch(t){case n.ENGINEERING_ITEM_REVISE:case n.DUPLICATE_CMD:case n.CHANGE_OWNER_CMD:case n.MULTI_OWNERSHIP_CMD:a.type=m[0].getTypeActualName(),a.typeDisplayName=m[0].getType(),a.name=m[0].getTitle(),a.displayName=m[0].getTitle(),a.revision=m[0].getRevision(),a.physicalid=m[0].getID();break;case n.MATURITY_GRAPH_CMD:s?(a=i)._selectedItems=m:(a.physicalid=m[0].getID(),a.type=m[0].getTypeActualName?m[0].getTypeActualName():m[0].getType(),a.typeDisplayName=m[0].getType(),a.name=m[0].getTitle?m[0].getTitle():m[0].getLabel(),a.displayName=m[0].getTitle?m[0].getTitle():m[0].getLabel(),a.revision=m[0].getRevision?m[0].getRevision():m[0].getReferenceVersion());break;case n.INFORMATION_CMD:if(a.physicalid=m[0].getID(),a.propWidth=e.item.propWidth,a.selectFacet=p,m[0].appCore){m[0].appCore.contextManager=o.getContext();let e=null;(e=m[0].getParent()&&m[0].getParent().getID?m[0].getParent():m[0].appCore.specRouteManager.getActiveSpecItem())?m[0].appCore.contextManager.setActiveEngItem(e):m[0].appCore.contextManager.setActiveEngItem(m[0]),m[0].appCore.contextManager.setSelectedNodes([m[0]])}break;case n.FILTER_CMD:a.commandId=t,a.appCore=e.item.appCore;break;case n.SUBSCRIBE_CMD:case n.UNSUBSCRIBE_CMD:case n.EDIT_SUBSCRIBE_CMD:case n.MY_SUBSCRIPTIONS_CMD:a.type=m[0].getTypeActualName();break;case n.OPEN_ALTERNATES:if(a.physicalid=m[0].getID(),m[0].appCore){m[0].appCore.orgContextManager=m[0].appCore.contextManager,m[0].appCore.contextManager=o.getContext();let e=null;void 0===m[0].appCore.specRouteManager?e=m[0].parentNode:null==(e=m[0].appCore.specRouteManager.getActiveSpecItem())&&(e=m[0].parentNode),m[0].appCore.contextManager.setActiveEngItem(e),m[0].appCore.contextManager.setSelectedNodes([m[0]])}a.commandId=n.OPEN_ALTERNATES;break;case n.OPEN_INFO_WIDGET:if(a.physicalid=m[0].getID(),m[0].appCore){m[0].appCore.orgContextManager=m[0].appCore.contextManager,m[0].appCore.contextManager=o.getContext();let e=null;void 0===m[0].appCore.specRouteManager?e=m[0].parentNode:null==(e=m[0].appCore.specRouteManager.getActiveSpecItem())&&(e=m[0].parentNode),m[0].appCore.contextManager.setActiveEngItem(e),m[0].appCore.contextManager.setSelectedNodes([m[0]])}a.commandId=n.OPEN_INFO_WIDGET;break;default:a.physicalid=m?m[0].getID():e.item.physicalid}return a}}})});