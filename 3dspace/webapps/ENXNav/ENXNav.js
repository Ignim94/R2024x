/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/ENXNav/models/AdditionalRelDummyInfo",[],function(){function e(e,t){-1===e.indexOf(t)&&e.push(t)}function t(e){switch(e){case"hasDO":case"hasSync":return"NA";default:return" "}}function o(e){this.options=e,this._relationNodes=[],this._otherKeys=[]}return o.prototype={addRelationNode:function(e){this._relationNodes.push(e)},addOtherKeys:function(t){for(let o=0;o<t.length;o++)e(this._otherKeys,t[o])},applyMerger:function(o){if(this._relationNodes.length){let i=[],n=Object.keys(o.pids),s=Object.keys(o.relids);for(let t=0;t<n.length;t++){let s=Object.keys(o.pids[n[t]]);for(let t=0;t<s.length;t++)e(i,s[t])}for(let t=0;t<s.length;t++){let n=Object.keys(o.relids[s[t]]);for(let t=0;t<n.length;t++)e(i,n[t])}for(let t=0;t<this._otherKeys.length;t++)e(i,this._otherKeys[t]);let r={grid:{}};for(let e=0;e<i.length;e++){let o=i[e],n=t(o);r.grid[o]=n}for(let e=0;e<this._relationNodes.length;e++){this._relationNodes[e].updateOptions(r)}}}},o}),define("DS/ENXNav/models/Algos",[],function(){return{extractGridChanges:function(e,t){var o={grid:{}},i=!1;let n=[];for(var s=Object.keys(e.grid),r=0;r<s.length;r++){var a=s[r];n.push(a);var l=e.grid[a];l!==t.grid[a]&&(i=!0),o.grid[a]=l}return{updatedProps:n,hasChanged:i,finalResults:o}}}}),define("DS/ENXNav/mixins/xNavChangeActionV2",["UWA/Class","DS/PADUtils/views/PADAlert","DS/PADUtils/PADChangeActionHandler","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,i,n,s){return e.extend({loadChangeV2:function(e){var t=this;t.beginBlockingTransaction(s.retrieveChangeAction);this.getPADTreeDocument().getRoots();var n=e.objects.map(function(e){return e.objectId});o.getInfos(n,function(o){t.beginBlockingTransaction(s.loadChangeAction);var n=-1,r=function(){if(++n<o.length){var s=o[n];t._processCAV2(s,r)}else{t.endBlockingTransaction(),t._checkIfEmptyV2(),e.callback&&e.callback();var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!0===i.getSetting("changeControlDlgOpen")?(t._commandProxy.changeControlDlgOpen({isOpen:!1,widget:"2D"}),UWA.is(a.setFromDrop,"function")&&a.setFromDrop(o,function(){console.log("Change set on Singleton from 2D")})):i.setSetting("changeControlDlgOpen",!0)}};r()},function(e){t.endBlockingTransaction(),t._checkIfEmptyV2()})},_checkIfEmptyV2:function(){0===this.options.model.getRoots().length&&this.dispatchEvent("onEmptyView")},_processCAV2:function(e,i){var n=this;o.determineExecution(e,{addAndFind:function(e){var r=o.extractIds(e.changeaction.context),a=o.extractRealizedAndProposed(e),l=n.getPADTreeDocument().getRoots(),d=l.map(function(e){return e.getID()});l.length&&n.dropInvitContainer.hide(n.dropInvitContainer.active_invite);var c=r.filter(function(e){return-1===d.indexOf(e)});c.length!==r.length&&(t.displayNotification({msg:s.root_already_loaded}),0===c.length&&i&&i()),c.length>0&&n.performCAFindInContextV2({rootIds:c,findIds:a},i)},add:function(e){var o=i||void 0,r=n.getPADTreeDocument().getRoots(),a=r.map(function(e){return e.getID()});r.length&&n.dropInvitContainer.hide(n.dropInvitContainer.active_invite);var l=e.filter(function(e){return-1===a.indexOf(e)});0===l.length?(t.displayNotification({msg:s.root_already_loaded}),i&&i()):n.add({content:"idslist",pids:l,callback:o})},wasEmpty:function(){n.dropInvitContainer.options.active_invite&&n.dropInvitContainer.hide(),i&&i()}})},performCAFindInContextV2:function(e,o){var i=this,r=e.rootIds,a=e.findIds;i.getPADTreeDocument();let l="";for(let e=0;e<a.length;e++)e>0&&(l+=" OR "),l+="physicalid:"+a[e];new Promise(function(e,t){i.add({content:"idslist",pids:r,broadcast:!1,callback:function(){e()}})}).then(function(){for(var e=[],a=0;a<r.length;a++){var d=new Promise(function(e,t){let o=r[a],s=i.options.model.getNodesById(o);n.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:s,searchFts:l,searchFtsOriginal:l,noPager:!0,doNotBroacast:!0}}),n.getModelEvents().subscribeOnce({event:"ENXViews/Model/FindInCtx/complete"},function(o){o.foundNodes&&0===o.foundNodes.length&&t(),e(o)})});e.push(d),d.then(function(e){if(0===e.foundNodes.length){t.displayNotification({msg:s.find_in_context_no_result,eventID:"info"});var o=require("DS/PADUtils/PADUtilsServices"),n={pids:[rootId],tenant:o.getPlatformId()};i._commandProxy.drop(n)}}).catch(function(e){console.error(e)})}Promise.all(e).then(function(){o&&o()}).catch(function(e){o&&o()})})}})}),define("DS/ENXNav/commands/view/_xNavCollapseAll",[],function(){"use strict";return{execute:function(e){require(["DS/Utilities/Data"],function(t){var o=e.model,i=o.getSelectedNodes();o.prepareUpdate(),t.forEach(i,function(e){e.hasChildren()&&e.collapseAll()},10,function(){o.pushUpdate()})})}}}),define("DS/ENXNav/commands/view/xNavRightSidePanel",["DS/PADUtils/commands/RightSidePanel","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o){"use strict";return e.extend({getXSO:function(){return t.get().options.model.getXSO()},getID:function(e){return e.getID()},getTriptych:function(){return t.get().elements.padshell},onTriptychReady:function(e){var i=o.subscribe({event:"on2DTriptychReady"},function(n){e.call(t.get().elements.padshell),o.unsubscribe(i)})},isNodeValid:function(e){return!0!==e.isGroupingNode&&!1===e.isSupplemental()}})}),define("DS/ENXNav/commands/ExpandAllGroups",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/ExpandAllGroups",data:{}})}})}),define("DS/ENXNav/views/xNavGraphView",["css!DS/ENXNav/ENXNav","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/etree/syncwidget","css!egraph/views","css!etree/syncviews","css!DS/etree/overviewui.css"],function(e,t,o,i,n,s,r,a){"use strict";return o.extend(i,n,{_treegraph:null,defaultOptions:{fittingArea:{paddingLeft:15,paddingRight:0,paddingTop:0,paddingBottom:80},layout:s.LayoutMode.LAYERED,viewport:null},init:function(e){this._parent(e),this._buildSkeleton(),this.getOption("renderTo")&&!0===e.isActiveView&&this.render().inject(this.getOption("renderTo"))},getThumbnailState:function(e){return this._treegraph.getThumbnailState(e)},setGroupThumbnailState:function(e){for(var t=e.expanded?s.ThumbnailState.COLLAPSED:s.ThumbnailState.EXPANDED,o=0;o<e.nodes.length;o++){var i=e.nodes[o];this._treegraph.setThumbnailState(i,t)}},setAllThumbnailsState:function(e){this._treegraph.setAllThumbnailsState(e)},getContainer:function(){return this.elements.container},render:function(){return this},setModel:function(e){this.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this._treegraph.setSize(),this._treegraph.setModel(e),null!==e.options.viewport.graph&&void 0!==e.options.viewport.graph&&this._treegraph.setViewport(e.options.viewport.graph)},unsetModel:function(){var e=this._treegraph.getModel();e&&(e.options.viewport.graph=this._treegraph.getViewport()),this.options.isActiveView=!1,this._treegraph.setModel(null),this.getOption("renderTo").removeChild(this.elements.container)},setSize:function(){this._treegraph.setSize()},reframeOn:function(){this._treegraph.reframeOn()},reframeAll:function(){this._treegraph.reframeAll()},toggleOverview:function(){this._treegraph.swapOverviewVisibility()},toggleLayout:function(e){switch(e){case"LayoutRight":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_LEFT);break;case"LayoutDown":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_TOP);break;case"LayoutLeft":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_RIGHT);break;case"LayoutUp":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_BOTTOM);break;default:this._treegraph.swapLayoutOrientation()}},_buildSkeleton:function(){t.is(this.elements.container)||(this.elements.container=UWA.createElement("div",{class:"xnav_graph"}),this._treegraph=new s.SyncEGraphTree(this.elements.container,this.options),this._treegraph.createOverview(),this._treegraph.setAutogroups&&this._treegraph.setAutogroups(!0),this._treegraph.setFittingArea(this.options.fittingArea),UWA.is(this._treegraph.setHTML5DnD,"function")&&(this._treegraph.setHTML5DnD(!0),this._treegraph.setMultiSelectionDrag(!0)))},updateView:function(){this._treegraph.updateUnlock()}})}),define("DS/ENXNav/mixins/_xNavBIFilter",["i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Class","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession","DS/PADUtils/views/PADAlert","DS/Utilities/Utils","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/settings/AppSettings","DS/PADUtils/Utility","DS/ENOXParser/modules/ColorMapParser","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/utilsWS/CVServletServices","DS/ENOXParser/modules/TwoDParser","DS/PADServices/utils/Batches","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/private/TreeDocUpdate","DS/PADServices/utils/PromiseHook","DS/ENOXInterWdgCom/LinkManager","DS/PADServices/utils/PConfigUtils","DS/PADServices/utils/GlobalUtils"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f,v,m,D,b,S,_,x,y){"use strict";const C="rgba(255, 255, 255, 0.3)",N={colorInstance:C},P={};function A(e,t,o,i){let n=e.get(t);n?(n.nodes.push(o),e.set(t,n)):(n={nodes:[o],isByResId:i},e.set(t,n))}return s.softInit(),o.extend({_biFilter:null,_biSlave3D:!0,_id2removeFromFilterProxy:[],_filterAlreadyTreatedRoot:[],_isRootAddedFromFilter:!1,initializeBI:function(){var e=this;i.addEvent("onX3dPlatformId",function(e){this._biFilter&&this._biFilter.updateTenant(e)}.bind(this)),i.addEvent("onPad_security_ctx",function(e){this._biFilter&&this._biFilter.setDefaultSecurityContext&&this._biFilter.setDefaultSecurityContext(e)}.bind(this)),this._createProxy(),g.subscribe({event:"__removePConfigSupportInAuthForMultiRoot"},this.removeNGFilter.bind(this)),s.subscribe({event:"authoringStateModified"},function(t){if(e._biFilter&&!0===t.authored&&e.options.model.getRoots().length){var o=[],s=[],r=[],a=e.options.model.getRoots();if(x.keepFilterForRoot(a))a=e.removeFilterIdsForPConf(a);e.xNavPersistFilterSpec.readOnlyRootsFilterSpec.clear(),e.xNavPersistFilterSpec.readOnlyRootsList=[];for(let t=0;t<a.length;t++){a[t].keepFilterBadge=!1;let i=e.HasFilter(a[t].getID());i&&!0===i.hasFilter&&!1===a[t].options.isReadOnly&&(o.push(a[t].getID()),a[t].options.filtered=!0),i&&!0===i.hasFilter&&!0===a[t].options.isReadOnly&&(a[t].keepFilterBadge=!0,e.xNavPersistFilterSpec.retainingFilterSpecForReadOnlyRoot(a[t].getID()),e.xNavPersistFilterSpec.readOnlyRootsList.push(a[t].getID())),i&&!1===i.hasFilter&&s.push(a[t].getID()),r.push(a[t].getID())}if(i.getSetting("resetFiltersOnIndexModeSwitch")||0!==e.xNavPersistFilterSpec.readOnlyRootsList.length){if(i.getSetting("resetFiltersOnIndexModeSwitch")||!i.getSetting("resetFiltersOnIndexModeSwitch")&&e.xNavPersistFilterSpec.readOnlyRootsList.length>0){for(let t=0;t<o.length;t++)e.xNavPersistFilterSpec.filterSpec.has(o[t])?e.xNavPersistFilterSpec.validFilterIdCopy.push(o[t]):e.xNavPersistFilterSpec.unresolvedSpec.push(o[t]),o.length-1===t&&e.removeNGFilter(o);if(e.xNavPersistFilterSpec.validFilterId=o,e.xNavPersistFilterSpec.readOnlyRootsList.length>0)for(let t=0;t<e.xNavPersistFilterSpec.readOnlyRootsList.length;t++)e.xNavPersistFilterSpec.validFilterId.push(e.xNavPersistFilterSpec.readOnlyRootsList[t]),e.xNavPersistFilterSpec.validFilterIdCopy.push(e.xNavPersistFilterSpec.readOnlyRootsList[t]);e._biFilter.removeRoots(r)}}else e._biFilter.resetNGFilterUI({widgetId:n.getWidgetId(),NGFUXId:e.getNGFUXID(),appId:n.getAppId(),rootIds:o}),e.removeNGFilter(o),e._biFilter.removeRoots(r)}else e._biFilter&&!1===t.authored&&e.options.model.getRoots().length&&(e._biFilter.setTagsWithExpandSynthesis&&e._filterAlreadyTreatedRoot.length>0&&e._biFilter.setTagsWithExpandSynthesis(e._filterAlreadyTreatedRoot),i.getSetting("resetFiltersOnIndexModeSwitch")&&setTimeout(function(){for(let t=0;t<e.xNavPersistFilterSpec.validFilterId.length;t++){let o=e.xNavPersistFilterSpec.validFilterId[t];if(e.xNavPersistFilterSpec.filterSpec.has(o)&&e._filterAlreadyTreatedRoot.includes(o)){let t={rootId:o,specification:e.xNavPersistFilterSpec.filterSpec.get(o),eventName:"setFilterSpec-"+o,applyFilter:1,displayFilter:0};e._biFilter.setPublicFilterSpecification(t)}}},1e3),!i.getSetting("resetFiltersOnIndexModeSwitch")&&e.xNavPersistFilterSpec.readOnlyRootsList.length>0&&setTimeout(function(){for(let t=0;t<e.xNavPersistFilterSpec.readOnlyRootsList.length;t++){let o=e.xNavPersistFilterSpec.readOnlyRootsList[t];if(e.xNavPersistFilterSpec.filterSpec.has(o)&&e._filterAlreadyTreatedRoot.includes(o)){let t={rootId:o,specification:e.xNavPersistFilterSpec.filterSpec.get(o),eventName:"setFilterSpec-"+o,applyFilter:1,displayFilter:0};e._biFilter.setPublicFilterSpecification(t)}}},1e3))})},removeFilterIdsForPConf:function(t){var o=this,n=[];return t.forEach(function(t){if(!1===t.options.isReadOnly){var s=[];s.push({physical_id_path:t.getID()});var a=o._biFilter.getFilterSpec(t.getID(),{V2:{prefixPathArray:s,appQueryObj:{keep:'((typecode:0 OR typecode:1) AND (ds6w_58_globaltype:"ds6w:Document" OR ds6w_58_globaltype:"ds6w:Part"))  OR (typecode:2 AND NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency"))'}}});x.validateFIlters(a).isValid?(t.keepFilterBadge=!0,t.validFilter=!0,!0===i.getSetting("keepFilterAuthoring")&&(o.options.model.prodConfigSupportInAuth=!0)):o._biFilter.hasFilter(t.getID()).hasFilter&&(n.push(t),r.displayNotification({msg:e.invalidFilterInAuth,eventID:"warning"}))}else n.push(t)}),n},keepFilterForDroppedRoot:function(e){var t=this.options.model.getRoots();return!0===i.getSetting("keepFilterAuthoring")&&(!0===i.getSetting("multiRootFilterAuthoring")||0===t.length&&e&&e.length<=1)},getFilterProxy:function(){return this._biFilter},removeRootFromFilterProxy:function(e){var t=this;this._biFilter&&(this.__doRemoveOnBI=this.__doRemoveOnBI?this.__doRemoveOnBI:a.debounce(function(){t._id2removeFromFilterProxy.length&&!_.isWidgetSynchronizing()&&(t._biFilter.resetNGFilterUI({widgetId:n.getWidgetId(),NGFUXId:t.getNGFUXID(),appId:n.getAppId(),rootIds:t._id2removeFromFilterProxy}),t._id2removeFromFilterProxy=[]),g.publish({event:"DS/InternalWdgtCom/NGFilterReset"})},250),-1===t._id2removeFromFilterProxy.indexOf(e.rootId2remove)&&t._id2removeFromFilterProxy.push(e.rootId2remove),this._filterAlreadyTreatedRoot.indexOf(e.rootId2remove)>-1&&this._filterAlreadyTreatedRoot.splice(this._filterAlreadyTreatedRoot.indexOf(e.rootId2remove),1),this.__doRemoveOnBI())},addFilter:function(o){var n=this;if(!0===s.determineAuthoredFlag()&&!1===n.keepFilterForDroppedRoot(o.filter_objects)){r.displayNotification({msg:e.filterInAuthoring,eventID:"warning",key:"enxNav-addFilter"});var a=g.getModelEvents();0===n.options.model.getRoots().length?n.dropInvitContainer.show("drop"):n.dropInvitContainer&&(n.dropInvitContainer.hide(),a.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}))}else{if(!this._biFilter)return void(this._filterLoadQueue=o);var l=require("DS/PADServices/utils/Storage"),d=l.buildKey("ENXNav","pendingFilters");if(o.fromProxy){var p,u=l.sess.get(d);if(u&&(p=u.filter_objects),UWA.equals(p,o.filter_objects))return;var h={filter_objects:o.filter_objects};l.sess.setWithExpire(d,h,3500)}else{h={filter_objects:o.filter_objects};l.sess.setWithExpire(d,h,3500)}if(this.beginBlockingTransaction(t.retrieveFilter),o.filter_objects){var f="fromDropOnFilter"===o.behavior,v="fromDrop"===o.behavior,m=o.filter_objects.length>1,D=function(t){if(t.success.length&&(!0===(f=t.success[0].fromDropOnFilter?t.success[0].fromDropOnFilter:f)&&(o.behavior="fromDropOnFilter"),n._isRootAddedFromFilter=!0,n.add({content:"filters",rootsWithFilters:t.success,broadcast:!0!==o.fromWP&&(UWA.is(o.broadcast,"boolean")?o.broadcast:f),loadWithFilter:f,fromProxy:o.fromProxy,callback:function(a,l){if(a){for(var d=l&&l.alreadyLoadedRoots?l.alreadyLoadedRoots:[],c=!1,p=0;p<a.length;p++)if(-1===d.indexOf(a[p].rootId))if(c=!0,"fromDropOnFilter"===o.behavior){if(s.isAuthoring())n.disableFilterWaiting(),r.displayNotification({msg:e.noFilterOnAuthoring,eventID:"warning",key:"enxNav-NoFilterOnAuthoring"}),n.disableFilterWaiting();else if(!0!==o.fromProxy){var u=a[p].rootId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.setOpenFilterNow(u),t.begin(),n._filterRootIds=[u],n._filterPanelOpen=!0)})}else if(!0===o.fromProxy){u=a[p].rootId;n._filterRootIds=[u],n._filterPanelOpen=!0}}else{var h=UWA.clone(a[p].filter);if(h.filterId=a[p].filterId,h){if(h.filterRootIds=[a[p].rootId],void 0===h.CVQuery)if(h.union)h.CVQuery={union:h.union},delete h.union;else{for(var g=0;g<h.union.expand.length;g++){var f=h.union.expand[g];f.root_path_physicalid[0][0]===a[p].rootId&&(h.sequence_filter=f.sequence_filter,h.config_filter=f.config_filter)}var v=[[a[p].rootId]];h.root_path_physicalid&&(v=h.root_path_physicalid),h.CVQuery={root_path_physicalid:v,sequence_filter:h.sequence_filter,config_filter:h.config_filter,expand_iter:"-1"},delete h.sequence_filter,delete h.config_filter}n.applyFilter(h),i.hasSetting("resetFiltersOnIndexModeSwitch")&&(i.getSetting("resetFiltersOnIndexModeSwitch")&&n.xNavPersistFilterSpec.addEventForEachFilter(h.filterRootIds),!i.getSetting("resetFiltersOnIndexModeSwitch")&&n.isFilterReadOnly(h)&&n.xNavPersistFilterSpec.addEventForEachFilter(h.filterRootIds))}else console.error("No filter pass")}!1===c&&"fromDropOnFilter"===o.behavior&&n.disableFilterWaiting(),n._isRootAddedFromFilter=!1}if(o.callback){var m=[];t.success.forEach(function(e){m.push(e.rootId)}),o.callback(m)}}})),t.failure.length){for(var a=0;a<t.failure.length;a++){var l={msg:t.failure[a].msg,eventID:t.failure[a].eventID};r.displayNotification(l)}n._commandProxy.retrieveFilterFailure(t),0===n.options.model.getRoots().length?n.dropInvitContainer.show("drop"):n.dropInvitContainer&&n.dropInvitContainer.hide(),0===t.success.length&&(("fromDropOnFilter"===o.behavior||void 0===o.behavior&&o.filter_objects.length>0)&&(n.disableFilterWaiting(),n.endBlockingTransaction()),o.callback&&o.callback(t))}v&&n.endBlockingTransaction()};if(m){var b=o.callback,S=c.createStepper(o.filter_objects,null,function(e,t){n._biFilter.retrieveFilters({filterObjects:[e],filterIds:[e.objectId],fromDropOnFilter:f,callback:function(e){o.callback=function(){b&&b.apply(null,arguments),S()},D(e)}})},function(){});S()}else this._biFilter.retrieveFilters({filterObjects:o.filter_objects,fromDropOnFilter:f,callback:D})}}},HasFilter:function(e){return this._biFilter&&UWA.is(this._biFilter.HasFilter,"function")?this._biFilter.HasFilter(e):void 0},GetFilterSpec:function(e,t){return this._biFilter&&UWA.is(this._biFilter.GetFilterSpec,"function")?this._biFilter.GetFilterSpec(e,t):void 0},RetrievePrdFromFilterId:function(e){return this._biFilter&&UWA.is(this._biFilter.RetrievePrdFromFilterId,"function")?this._biFilter.RetrievePrdFromFilterId(e):void 0},getCtxForSharing:function(){return this._biFilter&&UWA.is(this._biFilter.getCtxForSharing,"function")?this._biFilter.getCtxForSharing():void 0},onSynthesisModeOnInstance:function(e){this._biFilter&&(!0===e?this._biFilter.setSynthesisMode("flat"):this._biFilter.setSynthesisMode("occurrence"),this.getPADTreeDocument().colorizeActivated&&(this.onUnColorize(),setTimeout(()=>{this.onColorize(null,!0)},10)))},onApplyNGFilter:function(t){if(s.determineAuthoredFlag())t&&!t.empty&&r.displayNotification({msg:e.filterInAuthoring2,eventID:"warning",key:"EnxNav-applyNGFilterFilterInAuthoring"});else{var o=t||null;if(o=UWA.is(o,"string")?JSON.parse(o):o,i.hasSetting("resetFiltersOnIndexModeSwitch")){if(void 0!==t.filterRootIds&&i.getSetting("resetFiltersOnIndexModeSwitch")||!i.getSetting("resetFiltersOnIndexModeSwitch")&&this.isFilterReadOnly(o)){var n="true"==y.getURLParameter("keepCollapsedFilter");if(this.xNavPersistFilterSpec.validFilterIdCopy.length>0){let e=this.xNavPersistFilterSpec.validFilterIdCopy.findIndex(e=>e===t.filterRootIds[0]);-1!=e&&this.xNavPersistFilterSpec.validFilterIdCopy.splice(e,1);let i=!1;0===this.xNavPersistFilterSpec.validFilterIdCopy.length&&(i=!0);let s=this.getPADTreeDocument();(s.isDGVGroupingApplied()||s.isBSDGroupingApplied())&&(n=!0),n?this.applyFilter(o):this.resetFilterAndRefresh(t.filterRootIds,i)}else this.applyFilter(o),this.xNavPersistFilterSpec.addEventForEachFilter(t.filterRootIds)}else this.applyFilter(o)}else this.applyFilter(o)}},resetFilterAndRefresh:function(e,t){var o=this.getPADTreeDocument();if(e.length){let i=e.reduce(function(e,t){return e.concat(o.getNodesById(t))},[]);new Promise(function(e,t){o.withTransactionUpdate(function(){o.options.removeChildrenInProgress=!0;for(var e=0;e<i.length;e++){var t=i[e],n=t.getState();u.node.setFilterBadge(t),t.options.filtered=!0,t.hasChildren()&&t._isExpanded?t.setState({state:"expanded"}):t.setState({state:"collapsed"}),"collapsed"===n?(t.removeChildren(),t.options.children=[],t.setState({state:"collapsed"})):t.processDescendants({processNode:function(){var e=this.getState();let t=void 0!==this.options.expandedState||("expanded"===e||"partiallyExpanded"===e);this.hasChildren()&&t?this.setState({state:"expanded"}):this.setState({state:"collapsed"}),"collapsed"===e&&(this.removeChildren(),this.options.children=[],this.setState({state:"collapsed"}))}})}o.options.removeChildrenInProgress=!1}),e()}).then(function(e){t&&o.refresh()},function(e){console.log("reject - error while update")})}},isFilterReadOnly:function(e){var t=this.getPADTreeDocument().getRoots();for(let o=0;o<t.length;o++){let i=this.HasFilter(t[o].getID());if(i&&!0===i.hasFilter&&!0===t[o].options.isReadOnly&&e.filterRootIds.includes(t[o].getID()))return!0}return!1},onSaveNGFilter:function(e){var t=this;(e=e&&UWA.is(e,"string")?JSON.parse(e):e)&&e.rootId&&this.options.model.withTransactionUpdate(function(){let o=t.options.model.searchRootById(e.rootId);o&&(o.options.filterId=e.filterId)})},removeNGFilter:function(e){var t=this.getPADTreeDocument();if(delete t._hideChildrenFilter,t.options.removeChildrenInProgress=!0,e.length){let o=e.reduce(function(e,o){return e.concat(t.getNodesById(o))},[]);t.withTransactionUpdate(function(){for(var e=0;e<o.length;e++){var i=o[e];if(i.options.filtered){delete i.options.filtered,i.options.CVQuery=null,i.options.sequence_filter=null,i.options.config_filter=null,u.node.clearBadges(i);var n=i.getState();i.setState({state:"partiallyExpanded"}),i.options.padstate="partiallyExpanded",u.node.clearChildComputed(t),"collapsed"===n?(i.removeChildren(),i.options.children=[],i.setState({state:"partiallyExpanded"})):(i.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();this.options.childComputed=!1,"collapsed"===e&&(this.removeChildren(),this.options.children=[]),null!==this.options.children&&void 0!==this.options.children||(this.options.children=[]),this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded"}}}),null===i.options.children&&(i.options.children=[]))}}})}t.options.removeChildrenInProgress=!1},onSetTagsWithExpandSynthesis:function(){if(!s.determineAuthoredFlag()&&this._biFilter&&!0!==this.addInProgressFlag&&!this._wait4Filter){var e=this;this.__debounceSetTags=this.__debounceSetTags?this.__debounceSetTags:a.debounce(()=>{setTimeout(function(){let t=function(e,t){for(var o=[],i=e.length,n=0;n<i;n+=t)o.push(e.slice(n,n+t));return o}(e.options.model.getRoots(),1e3),o=c.createStepper(t,null,function(t){let i=[];for(let o=0;o<t.length;o++){let n=t[o].getID();-1===e._filterAlreadyTreatedRoot.indexOf(n)&&(e._filterAlreadyTreatedRoot.push(n),i.push(n))}e._biFilter.setTagsWithExpandSynthesis&&i.length>0&&e._biFilter.setTagsWithExpandSynthesis(i),setTimeout(o,100)},function(){});o()})},250),this.__debounceSetTags()}},onColorize:function(e,o){let n=this,s=function(){!0===n._biSlave3D&&D._colorize3D(D)};var r=!1,a=setTimeout(()=>{r=!0,this.beginBlockingTransaction(t.applyColor)},750);let d=function(){!0===r?n.endBlockingTransaction():clearTimeout(a)},g="",f={};if(e){this.getPADTreeDocument().colorizeActivated=!0;let t=new p(e);this.colorMapAll=t.data,g=this.predicateKind=t.data.predicateKind,f=this.colorMap=t.data.colorMap}else o?(f=this.colorMap=this.colorMapAll.colorMap,g=this.predicateKind=this.colorMapAll.predicateKind):console.warn("xNavFilter:onColorize: Invalid Input");let v=[],m=[],D=this.options.model,b=i.getSetting("synthesisModeOnInstance"),S=f.predicate+"-alreadyRetrieved",_=f.predicate+"-Instance",x=f.predicate+"-Instance-alreadyRetrieved",w=[f.predicate],I=function(e){let t=e.model,o=e.colorMap,i=e.predicateKind,n=e.nodes2Update,s=e.nodes43DSlave,r=e.synthesisFlag,a=e.namePred,d=e.instPred,p=e.instRetrieved,g=(e.thisPtr,e.nodeArray),f=new Map,v=u.divideAndConquer(g,{},{notRoots:function(e){let t=!e.isRoot();return l.addBIColumn(o.predicate,!0),t},everything:function(e){return!0}});return t.withTransactionUpdate(function(){var e=[];h.iterate(v.everything,function(r){if(y.isFakeTreeNodeModel(r))return;const l=r.getPLMValue(o.predicate);if(null!==l){const n=c.getBIColor(i,o,l),a={color:n,isBeingCut:!1,grid:{bi_color:n}};r.ghostMode=!1,n===C&&(e.push(r),a.isBeingCut=!0,r.ghostMode=!0),r.updateOptions(a),t.options.shouldBeSelected(r),s.push(r)}else if(!0!==r.getReferenceValue(a)){r.options.grid[a]=!0;let e=r.getID();n.push(e),A(f,e,r,!0)}else e.push(r)}),r&&h.iterate(v.notRoots,function(e){if(y.isFakeTreeNodeModel(e))return;const t=e.getPLMValue(d);if(null!==t){const n={colorInstance:c.getBIColor(i,o,t)};e.ghostMode=!1,e.updateOptions(n),s.push(e)}else if(!0!==e.getReferenceValue(p)){e.options.grid[p]=!0;let t=e.getRelationID();n.push(t),A(f,t,e,!1)}});for(let t=0;t<e.length;t++)e[t].options.color===C&&e[t].options.colorInstance===C&&(e[t].ghostMode=!0,delete e[t].options.color,delete e[t].options.colorInstance,e[t].updateOptions({isBeingCut:!0}))}),f}({nodeArray:D.getAllDescendants().filter(function(e){return e.isVisible()&&!0!==e.isGroupingNode&&!0!==e.isRelationsObjectNode}),thisPtr:this,model:D,predicateKind:g,colorMap:f,nodes2Update:v,nodes43DSlave:m,synthesisFlag:b,namePred:S,instPred:_,instRetrieved:x});if(m.length&&s(),v.length){let e=[],t=D.updateNodesAttributesValue(v,w);h.iterate(t,function(t){t.then(function(t){e.push(new Promise(function(e,o){!function(e){let t=e.model,o=e.nodeIds,i=e.colorMap,n=e.predicateKind,s=(e.synthesisFlag,e.namePred,e.instPred),r=e.nodes43DSlave,a=e.finalNodeMap,l=o.map(function(e){let t=a.get(e);return t.plmValue=t.nodes[0].getPLMValue(i.predicate),t}).filter(function(e){return null!==e}),d=u.divideAndConquer(l,P,{references:function(e){return e.isByResId},instances:function(e){return!1===e.isByResId}});t.withTransactionUpdate(function(){var e=[];h.iterate(d.references,function(o){let s=o.plmValue;if(null!==s){var a=c.getBIColor(n,i,s),l={color:a,isBeingCut:!1,grid:{bi_color:a}};h.iterate(o.nodes,function(o){o.ghostMode=!1,a===C&&e.push(o),o.updateOptions(l),t.options.shouldBeSelected(o),r.push(o)})}else l={grid:{bi_color:C}},h.iterate(o.nodes,function(o){delete o.options.color,e.push(o),o.updateOptions(l),t.options.shouldBeSelected(o),r.push(o)})}),h.iterate(d.instances,function(t){h.iterate(t.nodes,function(t){let o=s?t.getReferenceValue(s):null;if(null!==o){var r=c.getBIColor(n,i,o),a={colorInstance:r};r===C&&(delete t.options.colorInstance,e.push(t)),t.updateOptions(a)}else t.updateOptions(N)})});for(let t=0;t<e.length;t++)e[t].isRoot()?e[t].options.color&&e[t].options.color!==C||(e[t].ghostMode=!0,delete e[t].options.color,e[t].updateOptions({isBeingCut:!0})):e[t].options.color&&e[t].options.color!==C||e[t].options.colorInstance&&e[t].options.colorInstance!==C||(e[t].ghostMode=!0,delete e[t].options.color,delete e[t].options.colorInstance,e[t].updateOptions({isBeingCut:!0}))})}({model:D,nodeIds:t.localIds,colorMap:f,predicateKind:g,synthesisFlag:b,namePred:S,instPred:_,nodes43DSlave:m,finalNodeMap:I}),e()}))})}),Promise.all(t).then(function(){Promise.all(e).then(function(){s(),d()})})}else d()},onUnColorize:function(){this.getPADTreeDocument().colorizeActivated=!1;var e=this;e.options.model.withTransactionUpdate(function(){var t={color:"rgba(255, 255, 255, 0.3)",colorInstance:"rgba(255, 255, 255, 0.3)",isBeingCut:!1,grid:{bi_color:"rgba(255, 255, 255, 0.3)"}};e.options.model.getAllDescendants().forEach(function(o){o.isGroupingNode||(delete o.options.color,!0===i.getSetting("synthesisModeOnInstance")&&delete o.colorInstance,o.ghostMode=!1,o.updateOptions(t),e.getPADTreeDocument().options.shouldBeSelected(o))})}),l.removeBIColumn(this.colorMap.predicate),delete this.colorMap,delete this.predicateKind,this.options.views.treelistview&&!0!==this.options.views.treelistview.getManager().isColumnHidden("bi_color")&&this.options.views.treelistview.getManager().hideColumn("bi_color"),!0===e._biSlave3D&&void 0!==e._commandProxy&&e._commandProxy.padFilterBI({filterBIUnColorize:!0})},onBroadcastColor:function(){var e=this,t=[];!0===e._biSlave3D&&UWA.is(e.colorMap)&&(e.options.model.getAllDescendants().forEach(function(o){o.isVisible()&&!0!==o.isGroupingNode&&(null!==o.getPLMValue(e.colorMap.predicate)?t.push(o):-1!==e.options.model.getRoots().indexOf(o)&&t.push(o))}),t.length&&e.colorizeSlave3D(t))},onFilterClose:function(e){if("dataFilterPanelCtn"===e.tag){var t=e||{};if(void 0===t.rootIds){t.rootIds=[];for(var o=this.options.model.getRoots(),i=0;i<o.length;i++)t.rootIds.push(o[i].getID())}this.disableFilterWaiting(t)}},onGroupingEvent:function(e){if(e.fromApplyFilter?e=this.options.groups:this.options.groups=e,this.options.fromGroupingEvent=!0,!0!==this.__grpInProgress){this.__grpInProgress=!0,e.fromGroupingEvent=!0,g.publish({event:"ENXModel/Model/ApplyGrouping",data:e});var t=g.subscribe({event:"ENXModel/Model/ApplyGrouping/Done"},e=>{g.unsubscribe(t),this.options.fromGroupingEvent&&(this._biFilter.setGroupingStatus(e),delete this.options.fromGroupingEvent),delete this.__grpInProgress})}},onSelectEvent:function(o){var i=s.determineAuthoredFlag();if(i)return r.displayNotification({msg:e.taggerSelectAuth,eventID:"warning",key:"enxNav-selectFromTaggerAuth"}),void this._biFilter.setSelectStatus({status:!0});let n={eventData:o,authored:i,doNotBroacast:!0};g.publish({event:"ENXViews/Model/SelectFromTagger",data:n});var a=g.subscribe({event:"ENXViews/Model/SelectFromTagger/Failure"},function(o){if(g.unsubscribe(l),g.unsubscribe(a),o&&o.reason)switch(o.reason){case"requestFailure":r.displayNotification({title:t.select_from_tagger_errorTitle,subtitle:t.select_from_tagger_error,eventID:"error",key:"enxNav-selectFromTagger-failure"});break;case"requestTimeout":r.displayNotification({title:t.select_from_tagger_errorTitle,subtitle:t.select_from_tagger_error,eventID:"error",key:"enxNav-selectFromTagger-timeout"});break;case"tooManyResults":r.displayNotification({msg:e.replace(e.tooManyResultSelectInApp,{maxResult:d.getSetting("maxPathsForSearch")}),eventID:"warning",key:"enxNav-selectFromTaggerTooManyResults"});break;case"noResults":r.displayNotification({msg:e.tagger_select_no_result,eventID:"info"})}}),l=g.subscribe({event:"ENXViews/Model/SelectFromTagger/Success"},function(t){g.unsubscribe(l),g.unsubscribe(a),t&&t.nbSelected&&r.displayNotification({msg:e.replace(e.get("tagger_select_success"),{nbSelected:t.nbSelected}),eventID:"info"})})},_createProxy:function(){var e=this;require(["DS/ENOFilterBIUX/FilterBIComponentProxy","DS/PADServices/utils/GlobalUtils"],function(t,o){var s=!0!==i.getSetting("activateGrouping")&&"true"!==o.getURLParameter("activateGrouping")||!0===d.getSetting("grpBSD")?void 0:{},r={tenant:n.getPlatformId(),processingMode:"appProcessing",colorize:!0,selection:{},widgetId:n.getWidgetId(),NGFUXId:e.getNGFUXID(),appId:n.getAppId(),volumeFilterAvailable:0,ExpandSynthesisON:!0,appQueryParam:{},synthesis_priority:1,shareFilterSpec:!0,enableGrouping:s};UWA.is(e.onFilterFilteringEvent,"function")&&(r.events={addFilterChangeListener:e.onFilterFilteringEvent.bind(e)}),i.getSetting("activateGraph")?r.appQueryParam={graph:i.getSetting("structureGraph")}:r.appQueryParam={"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency","Reference Document"]},e._biFilter=new t(r),_.setPreviousNGFUXID(e.getNGFUXID()),e._biFilter.resetNGFilterUI({widgetId:r.widgetId}),e._biFilter.addEvent("NGFilter_Close",e.onFilterClose,e),e._biFilter.addEvent("FilterBIColorize",e.onColorize,e),e._biFilter.addEvent("FilterBIUnColorize",e.onUnColorize,e),!0!==d.getSetting("grpBSD")&&e._biFilter.addEvent("FilterBIGroupingEvent",e.onGroupingEvent,e),e._biFilter.addEvent("FilterBISelectionEvent",e.onSelectEvent,e),e.options.model.getModelEvents().subscribe({event:"onRootAdded"},e.onSetTagsWithExpandSynthesis.bind(e)),g.subscribe({event:"ENXModel/Root/AllAdded"},e.onSetTagsWithExpandSynthesis.bind(e)),g.subscribe({event:"ENXNav/FilterBIGroupingEvent"},e.onGroupingEvent.bind(e)),e.options.model.getModelEvents().subscribe({event:"broadcastColor"},e.onBroadcastColor.bind(e));var a={expandServices:"expand",expandIntent:"partialPaths",NGFUXId:e.getNGFUXID(),appId:n.getAppId(),lightCBMsg:!0};if(e._biFilter.setNGFilterOptions(a),e._biFilter.addEvent("ApplyNGFilter",e.onApplyNGFilter,e),e.options.isDeEnabled&&e._biFilter.addEvent("SaveNGFilter",e.onSaveNGFilter,e),"function"==typeof e.options.model.setFBIProxyOptions?e.options.model.setFBIProxyOptions({FBIProxy:e._biFilter}):"function"==typeof e.options.model.setFilterBIProxy?e.options.model.setFilterBIProxy(e._biFilter):e.options.model._isVolumeFilter=!0,!0===i.getSetting("synthesisModeOnInstance")?e._biFilter.setSynthesisMode("flat"):e._biFilter.setSynthesisMode("occurrence"),i.addEvent("onSynthesisModeOnInstance",e.onSynthesisModeOnInstance.bind(e)),e._filterLoadQueue){var l=e._filterLoadQueue;delete e._filterLoadQueue,e.addFilter(l)}e._biFilter.setDefaultSecurityContext&&e._biFilter.setDefaultSecurityContext(i.getSetting("pad_security_ctx")),!0===d.getSetting("splitActivation")&&e._biFilter.setHighDepthTagsAvailability(!0),null!==o.getURLParameter("redirectQueryToSGI")&&"function"==typeof e._biFilter._addURLParam&&e._biFilter._addURLParam({services:"progressive",param:"redirectQueryToSGI=true&expandIndexUnit=3DSpaceTransformedForIFC"}),"function"==typeof e._biFilter.activateNewOther&&!0===d.getSetting("grpBSD")&&e._biFilter.activateNewOther(!0),g.publish({event:"ENXModel/Root/FBIProxy",data:{HasFilter:e._biFilter.HasFilter.bind(e._biFilter),getCtxForSharing:e._biFilter.getCtxForSharing.bind(e._biFilter)}})})},colorizeSlave3D:function(e){for(var t,o=this,i=[],n=[],s=[],r=function(e){var t;-1===i.indexOf(e)&&((t=o.options.model.getNodesById(e)).length?(i.push(e),s.push({color:t[0].options.color?t[0].options.color:"rgba(255, 255, 255, 0.3)",pid:e,ghostMode:t[0].ghostMode})):(t=o.options.model.getNodesByRelId(e)).length?(i.push(e),s.push({color:t[0].options.color?t[0].options.color:"rgba(255, 255, 255, 0.3)",pid:e,ghostMode:t[0].ghostMode})):console.error("Unknown node with id ["+e+"]"))},a=0;a<e.length;a++){var l=e[a];if(-1===i.indexOf(l.getID())&&(i.push(l.getID()),s.push({color:l.options.color?l.options.color:"rgba(255, 255, 255, 0.3)",pid:l.getID(),ghostMode:l.ghostMode,metaType:"reference"})),!1===l.isRoot()&&-1===i.indexOf(l.getRelationID())&&(i.push(l.getRelationID()),s.push({color:l.options.colorInstance?l.options.colorInstance:"rgba(255, 255, 255, 0.3)",pid:l.getRelationID(),ghostMode:l.ghostMode,metaType:"instance"})),"collapseState"===l._expandState||"partiallyExpandedState"===l._expandState){var d=l.getOccurencePath(l.options.resourceid);n.push(d.map(function(e){return r(e),i.indexOf(e)}))}else{var c=l.getOccurencePath(l.options.resourceid);n.push(c.map(function(e){return r(e),i.indexOf(e)}))}}t={nodes:s,path:n},void 0!==o._commandProxy&&0!==t.nodes.length&&o._commandProxy.padFilterBI({filterBIColorize:t})},_checkIfFilterAvailable:function(t,o){var i=this;return new Promise(function(n){var a=[],l={rootsWithFilter:void 0,objectsWithoutFilterDrop:t},d=UWA.clone(t);if(t.paths)for(let e=0;e<t.paths.length;e++)1===t.paths[e].length&&a.push(t.paths[e][0]);else t.rootIds&&(a=[].concat(t.rootIds));for(var c=i.options.model.getRoots(),p=[],u=0;u<c.length;u++){var h=a.indexOf(c[u].getID());-1!==h&&(a.splice(h,1),p.push(c[u].getID()))}if(p.length){r.displayNotification({msg:e.root_already_loaded});for(var g=0;g<p.length;g++){var f=p[g];if(l.objectsWithoutFilterDrop.paths)for(let e=0;e<l.objectsWithoutFilterDrop.paths.length;e++)if(1===l.objectsWithoutFilterDrop.paths[e].length&&l.objectsWithoutFilterDrop.paths[e][0]===f){l.objectsWithoutFilterDrop.paths.splice(e,1);break}l.objectsWithoutFilterDrop.rootIds&&-1!==l.objectsWithoutFilterDrop.rootIds.indexOf(f)&&l.objectsWithoutFilterDrop.rootIds.splice(l.objectsWithoutFilterDrop.rootIds.indexOf(f),1),l.objectsWithoutFilterDrop.pids&&-1!==l.objectsWithoutFilterDrop.pids.indexOf(f)&&l.objectsWithoutFilterDrop.pids.splice(l.objectsWithoutFilterDrop.pids.indexOf(f),1)}}if(a.length){var v=s.determineAuthoredFlag(),m=!1;i._biFilter.areRootsSharable(a,o).then(function(t){for(var s=0;s<t.length;++s)if(!0===t[s].hasFilter){if(!1!==v&&(!0!==v||!0!==i.keepFilterForDroppedRoot(a))){m=!0;break}if(l.rootsWithFilter||(l.rootsWithFilter=d,l.rootsWithFilter.biProxyCtx=o,l.rootsWithFilter.filteredRoots=[]),l.rootsWithFilter.filteredRoots.push(t[s].rootId),l.objectsWithoutFilterDrop.paths)for(let e=0;e<l.objectsWithoutFilterDrop.paths.length;e++)if(1===l.objectsWithoutFilterDrop.paths[e].length&&l.objectsWithoutFilterDrop.paths[e][0]===t[s].rootId){l.objectsWithoutFilterDrop.paths.splice(e,1);break}l.objectsWithoutFilterDrop.rootIds&&-1!==l.objectsWithoutFilterDrop.rootIds.indexOf(t[s].rootId)&&l.objectsWithoutFilterDrop.rootIds.splice(l.objectsWithoutFilterDrop.rootIds.indexOf(t[s].rootId),1),l.objectsWithoutFilterDrop.pids&&-1!==l.objectsWithoutFilterDrop.pids.indexOf(t[s].rootId)&&l.objectsWithoutFilterDrop.pids.splice(l.objectsWithoutFilterDrop.pids.indexOf(t[s].rootId),1)}l.objectsWithoutFilterDrop.pids&&0===l.objectsWithoutFilterDrop.pids.length&&(l.objectsWithoutFilterDrop=void 0),v&&m&&r.displayNotification({msg:e.dropFilteredRootAuth,eventID:"warning",key:"enxNav-dropFilteredRootAuth"}),n(l)})}else l.objectsWithoutFilterDrop.pids&&0===l.objectsWithoutFilterDrop.pids.length&&(l.objectsWithoutFilterDrop=void 0),n(l)})},_addDroppedRootsWithFilter:function(o){var n=this;return new Promise(function(a){n.beginBlockingTransaction(t.retrieveFilter);var l=o.filteredRoots,d=o.biProxyCtx,c="fromDropOnFilter"===o.behavior||!0===o.loadWithFilter;(function(a){return a.reduce((a,l)=>a.then(()=>(function(a){return new Promise(function(l){var p=setTimeout(function(){r.displayNotification({msg:e.noShareFilterTimeout,eventID:"warning",key:"EnxNav-noShareFilterTimeout"});var t=UWA.clone(o);delete t.biProxyCtx,delete t.filteredRoots,t.content="idslist",t.callback=function(){console.log("Root without filter added")},n.add(t),l()}.bind(a),5e3);n._biFilter.shareFilterSpec({fromRootId:a,fromSourceCtx:d,fromDropOnFilter:c,callback:function(a){if(clearTimeout(p),a.success.length&&(n._isRootAddedFromFilter=!0,n.add({content:"filters",rootsWithFilters:a.success,broadcast:UWA.is(o.broadcast,"boolean")?o.broadcast:c,loadWithFilter:c,behavior:o.behavior,fromProxy:o.fromProxy,noNotif:!0,callback:function(a,l){if(a){for(var d=l&&l.alreadyLoadedRoots?l.alreadyLoadedRoots:[],c=!1,p=0;p<a.length;p++)if(-1===d.indexOf(a[p].rootId))if(c=!0,"fromDropOnFilter"===o.behavior)if(s.isAuthoring())n.disableFilterWaiting(),r.displayNotification({msg:e.noFilterOnAuthoring,eventID:"warning",key:"EnxNav-noFilterOnAuthoringBIFilter"}),n.disableFilterWaiting();else if(!0!==o.fromProxy){var u=a[p].rootId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.setOpenFilterNow(u),t.begin(),n._filterRootIds=[u],n._filterPanelOpen=!0)})}else!0===o.fromProxy&&(u=a[p].rootId,n._filterRootIds=[u],n._filterPanelOpen=!0);else{var h=UWA.clone(a[p].filter);if(h){if(h.filterRootIds=[a[p].rootId],void 0===h.CVQuery)if(h.union)h.CVQuery={union:h.union},delete h.union;else{for(var f=0;f<h.union.expand.length;f++){var v=h.union.expand[f];v.root_path_physicalid[0][0]===a[p].rootId&&(h.sequence_filter=v.sequence_filter,h.config_filter=v.config_filter)}var m=[[a[p].rootId]];h.root_path_physicalid&&(m=h.root_path_physicalid),h.CVQuery={root_path_physicalid:m,sequence_filter:h.sequence_filter,config_filter:h.config_filter,expand_iter:"-1"},delete h.sequence_filter,delete h.config_filter}var D=g.subscribe({event:"ENXModel/SyncModel"},function(e){e&&"applyFilter"===e.what&&(D=g.unsubscribe(D),r.displayNotification({eventID:"success",msg:t.addRootWithFilterSuccessNotif}))});n.applyFilter(h),i.hasSetting("resetFiltersOnIndexModeSwitch")&&(i.getSetting("resetFiltersOnIndexModeSwitch")&&n.xNavPersistFilterSpec.addEventForEachFilter(h.filterRootIds),!i.getSetting("resetFiltersOnIndexModeSwitch")&&n.isFilterReadOnly(h)&&n.xNavPersistFilterSpec.addEventForEachFilter(h.filterRootIds))}else console.error("No filter pass")}!1===c&&"fromDropOnFilter"===o.behavior&&n.disableFilterWaiting(),n._isRootAddedFromFilter=!1}}})),a.failure.length){for(var d=0;d<a.failure.length;d++){var u={msg:a.failure[d].msg,eventID:a.failure[d].eventID};r.displayNotification(u)}0===n.options.model.getRoots().length?n.dropInvitContainer.show("drop"):n.dropInvitContainer&&n.dropInvitContainer.hide()}l()}})})})(l)),Promise.resolve())})(l).then(function(){n.endBlockingTransaction(),a()})})}})}),define("DS/ENXNav/mixins/_xNavRefresh",["UWA/Class","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var o=e.extend({});return!0===t.getSetting("refresh_v2")&&(o.prototype.refresh=function(e){e=void 0===e||e,require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("Uncut");t&&t.begin()}),e&&this._commandProxy.refreshModel();let t=this.getPADDGVView();t&&(t.options.shouldClearSort=!1,t.removeFilterView(),t.refreshStatusBar()),this.getPADTreeDocument().refresh()}),o}),define("DS/ENXNav/commands/FocusOnGroups",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/FocusOnGroups",data:{}})}})}),define("DS/ENXNav/commands/view/_xNavSelectLeaves",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();require(["DS/ENXNav/commands/view/_xNavSelectCmdsUtils"],function(e){let i=[];o.forEach(function(e){0===e.getParents().filter(e=>e.isSelected()).length&&i.push(e)}),t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var n=[];i.forEach(function(e){e.processDescendants({processNode:function(){this.isVisible()&&(!1===this.hasChildren()?n.push(this):"collapsed"===this.getState()&&n.push(this))}})}),t.multiselect(n),t.pushUpdate(),t.pushBroadcastSelect()})}}}),define("DS/ENXNav/commands/OpenCommands",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t){"use strict";const o=new Map([["OpenContent","searchContent"],["OpenProducts","availableproducts"],["OpenFilters","availablefilters"]]);return e.extend({execute:function(){var e=this;require(["DS/PADServices/utils/GlobalModelEvents"],function(t){let i=o.get(e.options.ID);i&&t.publish({event:"welcome-panel-action-selected",data:{id:i}})})}})}),define("DS/ENXNav/commands/view/_xNavSelectCmdsUtils",[],function(){"use strict";return{_filterParentsOnly:function(e){for(var t=[],o=e.length-1;o>=0;o--){var i=e[o];!1===this._isAParentSelected(i,e)&&t.push(i)}return t},_isAParentSelected:function(e,t){for(var o=!1,i=0;i<t.length&&!1===o;i++)e.getID()!==t[i].getID()&&(o=e.isDescendantOf(t[i]));return o}}}),define("DS/ENXNav/views/customize_views/positionMatrix",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","text!DS/ENXNav/assets/templates/positionMatrixTooltip.html","DS/Handlebars/Handlebars","DS/PADServices/views/ENXModal","DS/Controls/Button"],function(e,t,o,i,n,s){"use strict";var r=i.compile(o);function a(e,t,o){var i=e.split(","),n={className:o,x1:Number(i[0]).toFixed(t).toString(10).substring(0,t+3),x2:Number(i[1]).toFixed(t).toString(10).substring(0,t+3),x3:Number(i[2]).toFixed(t).toString(10).substring(0,t+3),y1:Number(i[3]).toFixed(t).toString(10).substring(0,t+3),y2:Number(i[4]).toFixed(t).toString(10).substring(0,t+3),y3:Number(i[5]).toFixed(t).toString(10).substring(0,t+3),z1:Number(i[6]).toFixed(t).toString(10).substring(0,t+3),z2:Number(i[7]).toFixed(t).toString(10).substring(0,t+3),z3:Number(i[8]).toFixed(t).toString(10).substring(0,t+3),t1:Number(i[9]).toFixed(t).toString(10).substring(0,t+3),t2:Number(i[10]).toFixed(t).toString(10).substring(0,t+3),t3:Number(i[11]).toFixed(t).toString(10).substring(0,t+3)};return r(n)}return{getTypeRepresentation:function(){return{"positionMatrix-Instance":{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-position",fontIconFamily:1}}},blankPositionMatrix:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:1}}}}},"positionMatrix-Instance":{getCellTooltip:function(e,o){let i;if(-1===e.rowID)i=o.getCellDefaultTooltip(e);else{let o=e.nodeModel.getReferenceValue("positionMatrix-Instance");if(o&&"Position Matrix"!==o){let e=a(o,6);i={title:t.columnsDef.instanceMatrix,shortHelp:e,allowUnsafeHTMLShortHelp:!0,wrapThreshold:315,updateModel:!1}}}return i},buildColumn:function(e){return Object.assign({dataIndex:"positionMatrix-Instance",kind:"functionIcon",width:40,minWidth:40,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!1}},getCellTypeRepresentation:function(e){if(e.nodeModel&&"Position Matrix"!==e.nodeModel.getReferenceValue("positionMatrix-Instance"))return e.nodeModel.getReferenceValue("positionMatrix-Instance")?"positionMatrix-Instance":"blankPositionMatrix"},getCellValueForExport:function(e){var o="";return-1===e.rowID?o=t.columnsDef.instanceMatrix:e&&e.nodeModel&&e.nodeModel.getReferenceValue("positionMatrix-Instance")&&(o=e.nodeModel.options.grid["positionMatrix-Instance"]),o}},e)},actionOnClick:function(e,t){if(e.nodeModel){let i=e.nodeModel.getReferenceValue("positionMatrix-Instance");if(void 0!==i&&"Position Matrix"!==i){let r=a(i,16,"large"),l=document.querySelector(".enx-appMainBody"),d=e.cellView.getContent().getBoundingClientRect(),c={of:l,my:"top left",at:"top left",offsetX:d.x,offsetY:d.y};var o=new n({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.getPADDGVView().options.dgv.getColumnOrGroup(e.columnID).text,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:r,position:c,buttons:{Close:new s({onClick:function(){o.close()}})},events:{onClickOutsideContent:function(){o.close()}}})}}}}}}),define("DS/ENXNav/commands/_xNavGraphCmds",[],function(){"use strict";var e=null;return{execute:function(t){var o=t.xnav_app.options.views.graphview;switch(t.command_id){case"ReframeAll":o.reframeAll();break;case"ReframeOn":o.reframeOn();break;case"ToggleOverview":o.toggleOverview();break;case"LayoutDown":case"LayoutRight":case"LayoutUp":case"LayoutLeft":o.toggleLayout(t.command_id);break;case"SwapThumbState":require(["DS/etree/syncwidget"],function(t){null===e&&(e=t.ThumbnailState.EXPANDED);var i=!1;e===t.ThumbnailState.EXPANDED?(e=t.ThumbnailState.COLLAPSED,i=!0):e===t.ThumbnailState.COLLAPSED&&(e=t.ThumbnailState.EXPANDED,i=!0),!0===i&&o.setAllThumbnailsState(e)})}}}}),define("DS/ENXNav/models/RefreshHandler",["UWA/Core","UWA/Class"],function(e,t){return t.extend({init:function(e){this.options=e,this.treeDocument=e.treeDocument},complete:function(e){this._clearAllHidden(this.treeDocument),this.treeDocument.getXSO().empty()},_clearAllHidden:function(e){!function(e,t){for(var o=e.getRoots(),i=0;i<o.length;i++){var n=o[i];t(n),n.processDescendants({processNode:function(e){t(this)}})}}(e,function(e){!0===e.options.isPADHiddenBackEnd?delete e.options.isPADHiddenBackEnd:e.options.isPADHidden=!1})}})}),define("DS/ENXNav/commands/view/_xNavSelectAll",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getRoots();if(o.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t._selected_paths=[];var i=[];o.forEach(function(e){e.select(),e.processDescendants({processNode:function(){this.isVisible()&&i.push(this)}})}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()}}}}),define("DS/ENXNav/models/mixins/TreeDocProxy",["DS/PADServices/utils/CommandProxy","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/Numbers","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","i18n!DS/PADServices/assets/nls/PADServices"],function(e,t,o,i,n,s,r,a,l){"use strict";function d(){}return d.prototype={_cmdProxy:null,_pagerview:null,initProxy:function(){this._cmdProxy=e.create({events:{onSelect:this._onSelectProxy.bind(this),onFocus:this._onFocus.bind(this),onFocusChange3D:this._onFocusChange3D.bind(this),onShow:this._onShow.bind(this),onHide:this._onHide.bind(this),onUpdate2DPosMatrix:this._onUpdate2DPosMatrix.bind(this),onSendFilterInfo:this._onSendFilterInfo.bind(this),onReframeSelection:this._onReframeSelection.bind(this),onUpdateViewPoint:this._onUpdateViewPoint.bind(this)}})},_onReframeSelection:function(){this.closePager()},_onFocus:function(e,t){var o=this;if("focus"===e.intent&&!0!==e.findInCtx&&("graphview"===o.options.active_view||"datagridview"===o.options.active_view)){let t=function(){let e=!1;if(widget.getValue("enableProdConfig")&&o.isEditor()&&a.getSetting("activateExcludeOccProxy"))for(let t=0;t<o._selection.length;t++){let i=o._selection[t],n=o.getNodeByOccurencePath(i);if(n&&!o.pathsAreEqual(i,n.getOccurencePath())){o.pathIsInExcludes(n,i)&&(e=!0)}}return e};require(["DS/PADUtils/views/PADPager","DS/ENOXInterWdgCom/LinkManager"],function(n,s){o._doNotBroadcastSelect=!0,o._selectedIdx=0;var r=!1;if(o._selection=[],e.paths.forEach(function(t){var n=o.getNodeByOccurencePath(t);if(n){var a=(l=n.getRoot()).options.filtered;a&&(n.options.retrievedFromFocus=!0);let d=n.getParent();for(;d&&("expanded"!==d.getState()&&d.setState(i.NODE_STATES.PARTIALLY_EXPANDED),!d.isRoot());)a&&(d.options.retrievedFromFocus=!0),d=d.getParent();if(n.getID()===t[t.length-1]&&!0!==n.options.isPADHidden)o._selection.push(t);else if(n.getID()===t[0]&&!0!==n.filtered)o._selection.push(t),r=!0;else if(-1!==t.indexOf(n.getID())){var l;(l=n.getRoot()).options.filtered&&s.isLinkedWithPartnerApp(e.sharedID)?(o._selection.push(t),r=!0):l.options.filtered||(o._selection.push(t),r=!0)}}}),o.originalSelection=o._selection,o._selection.length>1){let e=Promise.resolve();null===o._pagerview&&(e=o.displayPager()),t()?(o._doNotBroadcastSelect=!0,o._checkColorize3D()):o.insertBranches(o._selection,{node_state:"partiallyExpanded",from:"select",onComplete:function(){o._doNotBroadcastSelect=!0,o._checkColorize3D()}}),!0===r&&o._cmdProxy.padExpand({paths:o._selection,expand_level:"1",updatePager:!0}),e.then(()=>{o._reframeOn({idx:o._selectedIdx})})}else{o.closePager(),t()?(o._doNotBroadcastSelect=!0,o._checkColorize3D()):o.insertBranches(o._selection,{node_state:"partiallyExpanded",from:"select",onComplete:function(){o._doNotBroadcastSelect=!0,o._checkColorize3D()}}),!0===r&&o._cmdProxy.padExpand({paths:o._selection,expand_level:"1",updatePager:!0}),o._reframeOn({idx:o._selectedIdx})}})}},_onFocusChange3D:function(e){e.sharedID===t.getSharedId()&&this._focusChange(e)},_focusChange:function(e){this._selection&&("previous"==e.event&&(this._selectedIdx--,this._reframeOn()),"next"==e.event&&(this._selectedIdx++,this._reframeOn()))},_reframeOn:function(){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var e=this._selectedIdx%this._selection.length;if(this._pagerview){var t=e+1+"/"+this._selection.length;this._pagerview.setLabel(t)}var o=this.getNodeByOccurencePath(this._selection[e]);o&&(this._focusOn=!0,o.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:o}),this._selection.length>1&&this._pagerview.show(),this._focusOn=!1)},_onShow:function(e){var t=[];this.withTransactionUpdate(function(){for(var o=0;o<e.paths.length;o++){var i=this.getNodeByOccurencePath(e.paths[o]);if(i){i.updateOptions({isPADHidden:!1}),t=t.concat(i)}}}.bind(this)),o.publish({event:"ENXModel/hideShowState",target:t,data:{toggle:"show",fromUI:e.fromUI}}),o.publish({event:"ENXModel/HideShowTriggered",data:{name:"show"}})},_onHide:function(e){var t=this,i=[];this._doNotBroadcastSelect=!0;let n=!1,s=[];if(widget.getValue("enableProdConfig")&&a.getSetting("activateExcludeOccProxy")&&this.isEditor()&&e.paths.length){let o=e.paths.map(function(e){return{path:e,node:t.getNodeByOccurencePath(e)}});for(let e=0;e<o.length;e++){let t=o[e],i=t.node.getOccurencePath();if(this.pathsAreEqual(i,t.path))s.push(t.path);else{this.pathIsInExcludes(t.node,t.path)&&(n=!0)}}}n?(s.forEach(function(e){var o=t.getNodeByOccurencePath(e);if(o){o.updateOptions({isPADHidden:!0}),i=i.concat(o)}}),t._doNotBroadcastSelect=!1,o.publish({event:"ENXModel/hideShowState",target:i,data:{toggle:"hide",fromUI:e.fromUI}}),o.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})):this.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){t.withTransactionUpdate(function(){e.paths.forEach(function(e){var o=t.getNodeByOccurencePath(e);if(o){o.updateOptions({isPADHidden:!0}),i=i.concat(o)}})}),t._doNotBroadcastSelect=!1,o.publish({event:"ENXModel/hideShowState",target:i,data:{toggle:"hide",fromUI:e.fromUI}}),o.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})}})},_onUpdate2DPosMatrix:function(e){if(!this.getXSO().isEmpty()){this.prepareUpdate();for(var o=0;o<e.instances.length;o++)for(var i=this.getNodesByRelId(e.instances[o].instance),n=0;n<i.length;n++){var d=e.instances[o].hasPositioningMatrix.join(),c={relationId:e.instances[o].instance,grid:{"positionMatrix-Instance":s.checkNotIdentity(d)?d:null}};i[n].updateOptions(c)}t.displayNotif({message:l.infos.pastePositionSucceeded,level:"info"}),this.pushUpdate(),a.getSetting("activateAutoSwitchAuthoringToIndex")&&r.determineAuthoredFlag()&&r.setAuthoringState(!0)}},_onUpdateViewPoint:function(e){this._viewPointTimer&&clearTimeout(this._viewPointTimer),this._pendingViewPoint&&(this._pendingViewPoint({success:!0,viewpoint:e}),delete this._pendingViewPoint)},_onSendFilterInfo:function(){this._cmdProxy.receiveFilterInfo({filterAvailable:!0})},displayPager:function(){this._selectedIdx=0;let e=this;return new Promise(function(t,o){"graphview"===e.options.active_view||"datagridview"===e.options.active_view?require(["DS/PADUtils/views/PADPager"],function(o){null===e._pagerview?(e._pagerview=new o({renderTo:document.body,injectNow:!0,callbacks:{onSelectAll:function(){e.restoreSelection(!0)},onPrevious:function(){e._focusChange({event:"previous"})},onNext:function(){e._focusChange({event:"next"})},onClose:function(){e.closePager(),e._focusOn=!1,e.searchProgress=!1}}}),t()):t()}):t()})},closePager:function(){this._pagerview&&(this._pagerview.hide(),this._focusOn=!1,delete this._pagerview)},reframeOn:function(e){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var t=this._selectedIdx%this._selection.length;if(this._pagerview){var o=t+1+"/"+this._selection.length;this._pagerview.setLabel(o)}var i=this.getNodeByOccurencePath(this._selection[t]);i&&(this._focusOn=!0,e&&!0===e.noSelect||i.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:i}),this._pagerview&&this._selection.length>1&&this._pagerview.show(),this._focusOn=!1)},_getLastViewpoint:function(e){let t=this;this._pendingViewPoint=e,this._viewPointTimer=setTimeout(function(){t._pendingViewPoint&&(t._pendingViewPoint({success:!1}),delete t._pendingViewPoint)},500),this._cmdProxy.requestViewPoint()}},d}),define("DS/ENXNav/models/mixins/TreeDocSupport",["DS/PADServices/utils/Iterator","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,i,n,s){function r(e,t){if(Array.isArray(e)&&Array.isArray(t)){var o=e.length;if(o===t.length){for(var i=0;i<o;i++)if(e[i]!==t[i])return!1;return!0}return!1}return!1}function a(){}return a.prototype={pathsAreEqual:function(e,t){return r(e,t)},pathIsInExcludes:function(e,t){let o=e.getRoot().getExcludedOccurrences().filter(e=>e.length===t.length),i=!1;for(let e=0;e<o.length;e++){let n=o[e];if(r(t,n)){i=!0;break}}return i}},a}),define("DS/ENXNav/views/xNavResponsiveTilesView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/ApplicationFrame/CommandsManager","DS/CollectionView/ResponsiveTilesCollectionView"],function(e,t,o,i,n,s){"use strict";return e.extend(o,i,{name:"xNavResponsiveTileView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0),o=this.options.grid=new s(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){n.getCommand("Copy").begin()}),o.onCellsPaste(function(e){n.getCommand("Paste").begin()}),o.onCellsCut(function(e){n.getCommand("Cut").begin()}),UWA.is(o.onCellsEscape,"function")&&o.onCellsEscape(function(e){n.getCommand("Uncut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})}})}),define("DS/ENXNav/models/mixins/TreeDocOccurenceIdx",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Meas","DS/PADServices/utils/Iterator","DS/PADServices/utils/PADTrackerManager","DS/PADServices/ws/WSAccess","DS/ENOXParser/ParserCV","DS/ENOXInterWdgCom/LinkManager","DS/Selection/HSOManager","DS/PADUtils/Utility","DS/TreeModel/TreeNodeModel"],function(e,t,o,i,n,s,r,a,l,d,c,p,u){"use strict";let h;const g="expanded",f="collapsed";function v(){}function m(e){return this.__nodesMaps.get(e[0])}function D(e,t){return e.get(t.join("/"))}function b(e){return e.processSearch}function S(){return!!t.getSetting("redirectQueryToSGI")}function _(e,t,o){("3D Shape"===e.options.grid["ds6w:type"]||e.options.isIFCShape)&&e.updateOptions({isIFCShape:t,children:o})}function x(){if(h)return h;{const e=require("DS/PADUtils/PADContext");return h=e.get()}}function y(){let e=x();return!(!e||!e.colorMap)}function C(e){const t="ds6w:globalType",o="ds6w:Document";if(e.options.isIFCShape){return false}else{return e.options.grid[t]===o||e.options.padgrid&&e.options.padgrid[t]===o}}function N(e){if(e.getNodeSource()===u.NODE_SOURCE.GROUPING){return e.getNodeDepth()}else{return e.getDepth()}}async function P(e,t){let o=n.addOrGetSection("checkModelForExpand");o.start("validateExistingTree",{stats:true});const i=N(e);let s=true;const r=t===-1||i<t;const a=e.options.childComputed;async function l(o){if(o){const o=e.getChildren();for(let i=0;o&&i<o.length;i++){const n=await P(o[i],t);if(n){e.setState({state:"expanded"});s=true;break}else{s=false}}}else{s=false;e.setState({state:"collapsed"})}}if(r&&a){e.setState({state:"expanded"});const o=t===-1||i+1<=t;await l(o)}else if(C(e)){s=false;if(e&&e.getParent()){const o=e.getParent();const i=o.getState();if(o.getChildren().length===1&&t===-1){o.setState({state:f})}else if(i!==g){if(e.options.type==="Rendering Representation"){s=true;o.setState({state:g})}else{o.setState({state:f})}}else if(i===g&&e.options.type==="Drawing"){s=true}}}else if(i===t){s=false}else{if(e&&typeof a==="undefined"){s=true}}o.end("validateExistingTree");o.end();return s}v.prototype.initModelMap=function(){this.isOccModel=!0,this.__nodesMaps=new Map,this.subscribe({event:"addChild"},this.__manageNode.bind(this)),this.subscribe({event:"preRemoveChild"},this.__manageNode.bind(this))},v.prototype.getNodeFromCustomSearch=function(e,t){let o=void 0;if(e.length>1){let i=m.call(this,e);if(i){let n=e.join("/"),s=i.keys();for(let e of s)if(e.startsWith(b(t))){const t=D(i,e.split("/"));t.getOccurencePath().join("/")===n&&(o=t)}}}return o},v.prototype.getNodeFromPath=function(e,t={processSearch:!1}){const o=m.call(this,e);if(!o)return;const i=D(o,e);return i||(b(t)?this.getNodeFromCustomSearch(e,t):void 0)},v.prototype.displayErrorNotif=async function(t,i){await o.getLastDataIndexTime().then(n=>{o.displayNotif({subtitle:i.nlsSubtitle,message:e.replace(e.errors.lastIndexed,{lastIndexed:n}),level:"error",key:i.key}),t&&t.callback&&t.callback("error")})},v.prototype.__manageNode=function(e){let t,i,n,s,r=e.data.nodeModel;switch(o.isFakeTreeNodeModel(r)?(n=r.getParent().getOccurencePath().join("/"),s="fakeTreeNodeModel"+n,r.options.isGroupingNode=!0,i=this.__nodesMaps.get(s)):!0===r.isRelationsObjectNode?(t=[r.getID()],i=this.__nodesMaps.get(r.getRoot().getID())):r.getRoot()?(t=r.getOccurencePath(),i=this.__nodesMaps.get(t[0])):(t=r.options.occPath,i=this.__nodesMaps.get(t[0])),e.event){case"addChild":(function(){i||(i=new Map,o.isFakeTreeNodeModel(r)?(this.__nodesMaps.set(s,i),i.has(s)||i.set(s,r)):this.__nodesMaps.set(t[0],i));if(o.isFakeTreeNodeModel(r))i.has(s)||i.set(s,r);else{const e=t.join("/");i.has(e)||i.set(e,r),r.isRoot()&&this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:this.getRoots().length,added_node:r}})}if(r.hasChildren()){const e=r.getChildren();for(let t=0;t<e.length;t++){let n=e[t];if(o.isFakeTreeNodeModel(n))n.options.isGroupingNode=!0,this.__manageNode({event:"addChild",data:{nodeModel:n}});else{const o=e[t].options.occPath?e[t].options.occPath:e[t].getOccurencePath();i.get(o.join("/"))||this.__manageNode({event:"addChild",data:{nodeModel:e[t]}})}}}}).call(this);break;case"preRemoveChild":(function(){if(o.isFakeTreeNodeModel(r)){if(this.__nodesMaps.delete(s),!0===this.options.removeChildrenInProgress||!0===this.options.groupingFilterInProgress&&(!0===(n=r).options.isGroupingNode&&n.getNodeSource()!==u.NODE_SOURCE.GROUPING)){let e=[],o=r.getParent();for(;o&&(!0===o.isGroupingNode||o.getNodeSource()===u.NODE_SOURCE.GROUPING);)o=o.getParent();if(o){let n=(t=o.getOccurencePath()).join("/");if(1===t.length&&(n+="/"),i=this.__nodesMaps.get(t[0])){for(const t of i.keys())t.startsWith(n)&&t!==n&&e.push(t);for(const t of e)i.delete(t)}}}}else if(i){const o=e.data.nodeModel;if("function"==typeof this.cleanGroupingForNodes&&!0!==o.options.isGroupingNode&&!0!==o.isRelationsObjectGroupingNode&&this.cleanGroupingForNodes({node:o}),o.isRoot())i.clear(),this.__nodesMaps.delete(t[0]);else{let e=t.join("/"),n=[],s=o.getParent();if(!0===o.isRelationsObjectNode){for(;!0===s.isRelationsObjectNode||o.getNodeSource()===u.NODE_SOURCE.GROUPING;)s=s.getParent();t=s.getOccurencePath(),e=t.join("/"),1===t.length&&(e+="/");for(const e of i.keys())e===o.getID()&&n.push(e);if(o.options.isGroupingNode)for(const t of i.keys())t.startsWith(e)&&t!==e&&n.push(t)}else{1===t.length&&(e+="/");for(const t of i.keys())t.startsWith(e)&&n.push(t)}for(const e of n)i.delete(e)}}var n}).call(this);break;default:console.error("TreeDocOccurenceIdx::__manageNode# Unknown event: "+e.event)}},v.prototype.add=async function(t){let i=n.addOrGetSection("add");console.groupCollapsed("TreeDocOccurenceIdx::add# Nb Ids="+t.pids.length),this._directSelection=!0;let s=t.pids.filter(function(e,o){return t.pids.indexOf(e)===o}),r={alreadyLoadedRoots:[]},c=this.getRoots(),p=s.length;for(let e=0;e<c.length;e++){let t=s.indexOf(c[e].options.resourceid);-1!==t&&(s.splice(t,1),r.alreadyLoadedRoots.push(c[e].options.resourceid))}let u=()=>{s.length!==p&&(d.isWidgetSynchronizing()||o.displayNotif({message:e.infos.rootAlreadyLoaded}),t.callback&&(r.noNotif=!0,t.callback(r))),console.groupEnd()};if(0===s.length)u();else if(s.length>0){i.start("Add.fetchRoots",{stats:!0});try{let n=await a.fetch({pids:s,autoAttSelection:!0});n="string"==typeof n?JSON.parse(n):n,i.end("Add.fetchRoots"),n.results&&0!==n.results.length?n.results.length>s.length?(o.displayNotif({message:e.errors.tooManyResults,level:"error",key:"xNavDoc-add-too-many-results"}),t.callback&&t.callback("error")):(i.start("ParserCV.parseAddOcc",{stats:!0}),this.invalidateViewPort(),this._parseLoadModel=!0,await l.parseAddOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:n}),this._parseLoadModel=!1,i.end("ParserCV.parseAddOcc"),this.isGroupingApplied()&&this.getActiveGrouping().length>0&&this.__applyGroupingTagger({groups:this.getActiveGrouping(),fromGroupingEvent:!0}),t.callback&&t.callback(r)):await this.displayErrorNotif(t,{nlsSubtitle:e.errors.objectNotFoundInDB,key:"xNavDoc-add-obj-not-found"})}catch(o){await this.displayErrorNotif(t,{nlsSubtitle:e.errors.genericWSFailure,key:"xNavDoc-addOcc"})}finally{i.end("Add.roots"),u()}}},v.prototype.displayMemoryUsage=function(e){if(console.groupCollapsed("Memory Usage"),e&&e.usedJSHeapSize&&e.totalJSHeapSize&&e.jsHeapSizeLimit){const t=2;console.log(`usedJSHeapSize : ${e.usedJSHeapSize.toFixed(t)} MB`),console.log(`totalJSHeapSize : ${e.totalJSHeapSize.toFixed(t)} MB`),console.log(`jsHeapSizeLimit : ${e.jsHeapSizeLimit.toFixed(t)} MB`)}},v.prototype.addPaths=async function(i){let s=n.addOrGetSection("addPaths");if(!i.paths)throw new Error("TreeDocOccurenceIdx::addPaths## Invalid parameters, no paths");console.groupCollapsed("TreeDocOccurenceIdx::addPaths# Nb Paths="+i.paths.length),r.addCommandHit("addPaths",""+i.paths.length);let d={alreadyLoadedRoots:[]};s.start("performAddPath",{stats:!0}),s.start("progressiveExpand",{stats:!0}),this._parseLoadModel=!0,await l.insertTempPaths({treeDoc:this,FBIProxy:this.options.FBIProxy,paths:i.paths,nodeModelClass:this.options.nodeModelClass,nls:e.parser,state:i.state?i.state:"partiallyExpanded"}),this._parseLoadModel=!1;let c=!1,p=e=>{let t=this.getNodeFromPath(e);if(t&&!0===t.options.waiting4validation){let o=t.getParent();t.remove(),c=!0;let i=e.slice(0,e.length-2);null===o.options.children&&(o.options.children=[],o.setState({state:"collapsed"})),p(i)}},u=!1,h=t=>{if(!1===u){u=!0;for(let e=0;e<i.paths.length;e++)p(i.paths[e]);c&&(t&&t.removedByFilter?o.displayNotif({message:e.errors.cannotInsertBranchFiltered,eventID:"info",key:"xNavDoc-addPaths-cannot-add-branch-filtered"}):o.displayNotif({message:e.errors.cannotInsertBranch,level:"error",key:"xNavDoc-addPaths-cannot-add-branch"}))}},g=!1;for(let e=0;e<i.paths.length;e++){if(!0===this.options.FBIProxy.HasFilter(i.paths[e][0]).hasFilter){g=!0;break}}let f={pathIds:i.paths,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0,addPathSGIEnv:S()};try{let e=await a.expandv2(f);if(e="string"==typeof e?JSON.parse(e):e,s.end("progressiveExpand"),e.errors&&e.errors.length||e.results&&0===e.results.length){if(h({removedByFilter:g}),i.callback){let e={success:!1};i.callback(e,d)}}else{let t={success:!1};s.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0;let o=await l.parsePathsOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:e,nodeModelClass:this.options.nodeModelClass,state:i.state?i.state:"partiallyExpanded"});this._parseLoadModel=!1,s.end("ParserCV.parseExpandOcc");for(let e=0;e<o.rootIds.length;e++){let t=this.getNodeFromPath([o.rootIds[e]]);this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:this.getRoots().length,added_node:t}})}t.success=!0,i.callback&&i.callback(t,d)}}catch(e){if(console.log(" -- Request exception"),i.callback){let e={success:!1};i.callback(e,d)}}finally{s.end("performAddPath"),h()}},v.prototype.onPreExpandChecker=async function(e){let t=e.data,o=t.nodeModel,n=!!t.expandAll&&t.expandAll;if(1!==o.getNodeSource())if(!0===o.isGroupingNode){if(!0===this.__findInProgress)return void e.target.preExpandDone({preventExpandAll:!0});await this.__expandGrpNode(e),e.target.preExpandDone({preventExpandAll:!0,state:"expanded"})}else{if(this._parseLoadModel)return void i.subscribeOnce({event:"ENXModel/parseEnded"},function(){this.preExpandDone({preventExpandAll:!1})}.bind(e.target));if(n){let t=document.getElementsByClassName("enx-appMainBody");if(t&&1===t.length){t=t[0];let i=o.isRoot()?o:o.getRoot();require(["DS/ENXNav/views/private/ExpandChecker"],o=>{o.check({targetDiv:t,roots:[i]}).then(t=>{!0===t.performExpandAll?this.__expandCB(e):e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})})})}else this.__expandCB(e)}else this.__expandCB(e)}else e.target.preExpandDone({preventExpandAll:!0,state:"expanded"})},v.prototype.__expandCB=async function(s){const d=n.addOrGetSection("expandOcc");let c=Date.now(),p=s.data,h=p.nodeModel,v=!!p.expandAll&&p.expandAll,m=p.numberOfLevelsToExpand?p.numberOfLevelsToExpand.toString():t.getSetting("expand_iter");if(h.getNodeSource()===u.NODE_SOURCE.GROUPING)return s.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),void(h.options.isGroupingNode=!0);v&&(m="-1"),console.groupCollapsed(`TreeDocOccurenceIdx::__expandCB# [${h.getLabel()}] with level (${m})`),r.addCommandHit("ExpandOcc","ExpandCB-"+m=="-1"?"all":m),v&&(h._expandAllPending=!0,i.publish({event:"ENXNav/parser/expandAll/begin"}));let D=h.options.filtered,b=!1;"partiallyExpanded"!==h.options.padstate||D||(b=!0);let S=m,_=parseInt(m,10),x=!0;const C=v?-1:h.getDepth()+_;x=await async function(e,t){let o=n.addOrGetSection("checkModelForExpand");o.start("validateExistingTree",{stats:!0});const i=function(e){return e.getNodeSource()===u.NODE_SOURCE.GROUPING?e.getNodeDepth():e.getDepth()}(e);let s=!0;const r=-1===t||i<t;const a=e.options.childComputed;if(r&&a){e.setState({state:"expanded"});const o=-1===t||i+1<=t;await async function(o){if(o){const o=e.getChildren();for(let i=0;o&&i<o.length;i++){const n=await P(o[i],t);if(n){e.setState({state:"expanded"}),s=!0;break}s=!1}}else s=!1,e.setState({state:"collapsed"})}(o)}else if(function(e){const t="ds6w:globalType";return!e.options.isIFCShape&&("ds6w:Document"===e.options.grid[t]||e.options.padgrid&&"ds6w:Document"===e.options.padgrid[t])}(e)){if(s=!1,e&&e.getParent()){const o=e.getParent(),i=o.getState();1===o.getChildren().length&&-1===t?o.setState({state:f}):i!==g?"Rendering Representation"===e.options.type?(s=!0,o.setState({state:g})):o.setState({state:f}):i===g&&"Drawing"===e.options.type&&(s=!0)}}else i===t?s=!1:e&&void 0===a&&(s=!0);o.end("validateExistingTree");o.end();return s}(h,C);if(!1===x)s.target.preExpandDone({preventExpandAll:!0}),this._selectOccurence(),y()&&this._colorize3D(that),delete h._expandAllPending,v&&i.publish({event:"ENXNav/parser/expandAll/complete"}),d.end("performExpand-"+_),console.groupEnd();else{let n=h;const p=n.getAllDescendants().length;let u=0;h.isRoot()||(n=h.getRoot());const g=h.getOccurencePath();u=g.length-1;const f={pathIds:[g],data:{expandLevel:m},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0,isIFCShape:function(e,o){let i=!1;return t.getSetting("redirectQueryToSGI")&&!(i=o.options.isIFCShape)&&o.isSupplemental()&&(o.options.isIFCShape=!0,i=!0),i}(0,h)};d.start("performExpand-"+_,{stats:!0}),d.start("progressiveExpand",{stats:!0});try{let u=await a.expandv2(f);if(u="string"==typeof u?JSON.parse(u):u,d.end("progressiveExpand"),u.results&&(0===u.results.length?(D?o.displayNotif({message:e.infos.findInCtxNoResult,level:"info"}):await this.displayErrorNotif(void 0,{nlsSubtitle:e.errors.genericWSFailure,key:"xNavDoc-expand-generic-error"}),v&&i.publish({event:"ENXNav/parser/expandAll/complete"}),s.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})):(!0===b&&this._cmdProxy.padExpand({paths:[h.getOccurencePath()],expand_level:_}),d.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0,await l.parseExpandOcc({treeDoc:this,expandedNodes:[h],FBIProxy:this.options.FBIProxy,wsResponse:u,nodeModelClass:this.options.nodeModelClass,expandLevel:_,expandLevelRequest:parseInt(S,10),filter:n.options.filtered}),this._parseLoadModel=!1,d.end("ParserCV.parseExpandOcc"),v&&i.publish({event:"ENXNav/parser/expandAll/complete"}),s.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),i.publish({event:"ENXModel/parseEnded"}),this._selectOccurence(),t.getSetting("debug_2D")&&(d.start("memoryUsage",{stats:!0}),this.displayMemoryUsage(function(){if(window.performance&&performance.memory){const e=1048576,t=t=>t/e;return{usedJSHeapSize:t(performance.memory.usedJSHeapSize),totalJSHeapSize:t(performance.memory.totalJSHeapSize),jsHeapSizeLimit:t(performance.memory.jsHeapSizeLimit)}}return console.warn("performance.memory is not available on this browser."),null}()),d.end("memoryUsage")))),u.errors){let t=!1,n="",r="",a=[];for(let e=0;e<u.errors.length;e++)if("UNKNOWN_META"===u.errors[e].code)if(t=!0,void 0!==u.errors[e].unknownmetas)a=a.concat(u.errors[e].unknownmetas),r=u.errors[e].unknownmetas;else{let t=u.errors[e].reason,o="com.exalead.expand.progressive.ProgressiveExpandException: [",i=t.indexOf(o)+o.length;n=t.substring(i,t.length-1),r=n,n=n.replace(/,\s+/g,","),a=a.concat(n.split(","))}!0===t?(i.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,h.setState({state:"collapsed"}),i.publish({event:"ENXNav/parser/expandAll/complete"});let t=require("DS/PADServices/utils/PlatformURL");o.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:r,envId:t.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),i.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:a}})):(s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,h.setState({state:"collapsed"}),o.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:h.getLabel(),expandLevel:"-1"===m?"all":m}),level:"error",key:"xNavDoc-expand-api-error"}),i.publish({event:"ENXNav/parser/expandAll/complete"}))}}catch(t){if(d.end("progressiveExpand"),t.timeoutOccurs)return s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,i.publish({event:"ENXNav/parser/expandAll/complete"}),void o.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-request-timeout"});s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,h.setState({state:"collapsed"}),v&&i.publish({event:"ENXNav/parser/expandAll/complete"}),o.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:h.getLabel(),expandLevel:"-1"===m?"all":m}),level:"error",key:"xNavDoc-expand-parse-error"})}finally{d.end("progressiveExpand"),d.end("performExpand-"+_);let e=r.getPADTracker({eventCategory:"performance",eventAction:"expand"}),t=Date.now();e.setEventData({eventLabel:"expandOcc",eventValue:t-c,txKey:n.getID()});let o=n.getAllDescendants().length;e.setDims({dims:{pd2:"-1"===m?"ExpandAll":"1"===m?"Expand1":"ExpandN"},vals:{pv2:o-p,pv3:o}}),e.trackPageEvent(),console.groupEnd()}}},v.prototype.expandMultiSelect=async function(d){let c=!!d.expandAll&&d.expandAll,p=d.numberOfLevelsToExpand?d.numberOfLevelsToExpand.toString():t.getSetting("expand_iter"),u=d.nodes2Expand;c&&(p="-1"),console.groupCollapsed(`TreeDocOccurenceIdx::expandMultiSelect# Nb Nodes [${u.length}] with level (${p})`),r.addCommandHit("ExpandOcc","MultiSelect-"+p=="-1"?"all":p);let h=[];for(let e=0;e<u.length;e++)h.push(u[e]);if(0===h.length)this.prepareUpdate(),y()&&this._colorize3D(this),this.pushUpdate(),d.callback&&d.callback(),console.groupEnd();else{let r=0,u=[],g=[],f=[];this.prepareUpdate(),h.forEach(e=>{e.setState({state:"expanding"})}),this.pushUpdate(),this.prepareUpdate(),s.iterate(h,function(e){let t=e;t.isRoot()||(t=t.getRoot());let o=e.getOccurencePath();t&&-1===f.indexOf(t.getID())&&(f.push(t.getID()),g.push(t)),r=Math.max(o.length-1,r),u.push(o)});let v=n.addOrGetSection("expandOcc"),m={pathIds:u,data:{expandLevel:p},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};v.start("performExpand-"+p,{stats:!0}),v.start("progressiveExpand",{stats:!0});try{let t=await a.expandv2(m);if(t="string"==typeof t?JSON.parse(t):t,v.end("progressiveExpand"),t.results&&(0===t.results.length?(await this.displayErrorNotif(void 0,{nlsSubtitle:e.errors.genericWSFailure,key:"xNavDoc-expand-generic-error"}),c&&i.publish({event:"ENXNav/parser/expandAll/complete"})):(v.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0,await l.parseExpandOcc({treeDoc:this,expandedNodes:h,FBIProxy:this.options.FBIProxy,wsResponse:t,nodeModelClass:this.options.nodeModelClass,expandLevel:parseInt(p)}),this._parseLoadModel=!1,v.end("ParserCV.parseExpandOcc"),c&&i.publish({event:"ENXNav/parser/expandAll/complete"}),i.publish({event:"ENXModel/parseEnded"}),v.end("performExpand-"+p),this._selectOccurence())),t.errors){let n=!1,s="",r="",a=[];for(let e=0;e<t.errors.length;e++)if("UNKNOWN_META"===t.errors[e].code)if(n=!0,void 0!==t.errors[e].unknownmetas)a=a.concat(t.errors[e].unknownmetas),r=t.errors[e].unknownmetas;else{let o=t.errors[e].reason,i="com.exalead.expand.progressive.ProgressiveExpandException: [",n=o.indexOf(i)+i.length;s=o.substring(n,o.length-1),r=s,s=s.replace(/,\s+/g,","),a=a.concat(s.split(","))}if(!0===n)i.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{for(let e=0;e<g.length;e++)delete g[e]._expandAllPending,g[e].setState({state:"collapsed"});i.publish({event:"ENXNav/parser/expandAll/complete"});const t=require("DS/PADServices/utils/PlatformURL");o.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:r,envId:t.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),i.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:a}});else{for(let e=0;e<g.length;e++)delete g[e]._expandAllPending,g[e].setState({state:"collapsed"});await this.displayErrorNotif(void 0,{nlsSubtitle:e.errors.genericWSFailure,key:"xNavDoc-multiExpand-error-1"}),i.publish({event:"ENXNav/parser/expandAll/complete"})}}}catch(t){v.end("progressiveExpand"),v.end("performExpand-"+d.expandLevel),await this.displayErrorNotif(void 0,{nlsSubtitle:e.errors.genericWSFailure,key:"xNavDoc-multiExpand-error-2"})}finally{d.callback&&d.callback(),i.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}}),s.iterate(h,function(e){e.setState({state:"expanded"})}),this.pushUpdate(),console.groupEnd()}}},v.prototype.findInCtx=async function(s){console.groupCollapsed("TreeDocOccurenceIdx::findInCtx# searchFTS:"+s.searchFtsOriginal);let r=n.addOrGetSection("findInCtxOcc"),d=()=>{s.doNotBroacast&&(this._doNotBroadcastSelect=!0,this._inBatchingForUpdate=!0)},c=()=>{s.doNotBroacast&&(this._doNotBroadcastSelect=!1,this._inBatchingForUpdate=!1)},p=s.nodes.length>1,u=[],h=[];this.closePager(),this._selection=[],this.searchProgress=!0,d(),this.prepareBroadcastSelect(),this.getXSO().empty(),c();let g=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest();this.prepareUpdate();var f=[];for(let n=0;n<s.nodes.length;n++){let v=s.nodes[n],m=v.getState(),D=function(){v.setState({state:m})};v.setState({state:"expanding"});let b={FBIProxy:this.options.FBIProxy,data:{rootPhID:v.getOccurencePath(),select_bo:g.select_object,select_rel:g.select_relation,compute_select_bo:g.select_file,ftsString:s.searchFts,rscIdToSearch:s.rscId,max_count_path:t.getSetting("maxPathsForSearch")},iterativeFilter:s.iterativeFilter,filterRel:s.no_type_filter_rel,withOccResponse:!0};-1===b.data.select_rel.indexOf("ds6w:type")&&b.data.select_rel.push("ds6w:type"),-1===b.data.select_rel.indexOf("ro.plminstance.v_treeorder")&&b.data.select_rel.push("ro.plminstance.v_treeorder"),r.start("findInCtx",{stats:!0});try{let n=await a.findInCtxV2(b);if(n="string"==typeof n?JSON.parse(n):n,r.end("findInCtx"),n.results&&n.results.length){r.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0,d(),await l.parseExpandOcc({treeDoc:this,expandedNodes:[v],FBIProxy:this.options.FBIProxy,wsResponse:n,nodeModelClass:this.options.nodeModelClass,state:"partiallyExpanded",isFindInCtx:!0}),c(),this._parseLoadModel=!1,r.end("ParserCV.parseExpandOcc");let i=this.getXSO().get();i.length>t.getSetting("maxPathsForSearch")&&(i.pop(),o.displayNotif({message:e.replace(e.warnings.tooManyResultFound,{maxResult:t.getSetting("maxPathsForSearch")}),level:"warning",key:"FindInCtx-tooManyResult"}));let s=h.slice(),a=i.filter(function(e){return-1===s.indexOf(e)});h=h.concat(a),this._selection.length&&p&&(u=[...this._selection],this._selection.length=0),a.forEach(e=>{this._selection.push(e.getOccurencePath())}),u=[...u,...this._selection],this.originalSelection=p?u:this._selection,v.setState({state:"partiallyExpanded"})}else this._parseLoadModel=!1,console.log("Find in Ctx failed - No Results"),D()}catch(e){this._parseLoadModel=!1,console.log("Find in Ctx failed"),D()}finally{i.publish({event:"ENXModel/SyncModel",data:{what:"FindInCtx"}}),s.doNotBroacast||that.pushBroadcastSelect();for(let e=0;e<u.length;e++){let t=this.getNodeByOccurencePath(u[e]);t&&f.indexOf(t)<0&&f.push(t)}this._selection=u,!0!==s.noPager&&this._selection.length&&this.displayPager().then(()=>{d(),this.reframeOn({idx:this._selectedIdx}),c()})}}0===f.length?o.displayNotif({message:e.infos.findInCtxNoResult,level:"info"}):(d(),this.unselectAll(),c()),i.publish({event:"ENXViews/Model/FindInCtx/complete",data:{foundNodes:f}}),i.publish({event:"ENXModel/parseEnded"}),this.searchProgress=!1,console.groupEnd(),this.pushUpdate()},v.prototype.refresh=async function(s){console.groupCollapsed("TreeDocOccurenceIdx::refresh");let d=n.addOrGetSection("measRefresh"),c=[];const p=(e=>{let t=[];const o=e.getRoots();for(let e=0;e<o.length;e++){t.push(o[e]);let i=o[e].getLeaves(),n=[],s=[],r=[];for(let e=0;e<i.length;e++){const t=i[e];if(S()?_(t,!0,[]):_(t,!1,null),!0===t.isRelationsObjectNode){let e=!0===t.isGroupingNode?t:t.getParent();for(;!0===e.getParent().isGroupingNode;)e=t.getParent();-1===r.indexOf(e.getID())&&(s.push(e),r.push(e.getID()))}else n.push(t)}s.length&&this.withTransactionUpdate(()=>{for(let e=0;e<s.length;e++)!0!==s[e].isRoot()&&!0!==s[e].isGroupingNode&&s[e].remove()}),t=t.concat(n)}return t})(this);let u=[],h=0;for(let e=0;e<p.length;e++)if(p[e].isRoot())u.push([p[e].getID()]);else{let t=p[e].options.occPath;h<(t.length-1)/2&&(h=(t.length-1)/2),u.push(t)}d.start("Refresh.refresh",{stats:!0});let g=!1,f=e=>{if(-1===c.indexOf(e.join("/"))){let t=this.getNodeFromPath(e);if(t){let o=t.getParent();t.remove(),!o||"ds6w:Document"!==o.options.globaltype||o.options.children&&0!==o.options.children.length||(o.options.children=null,o.setState({state:"noChildren"})),g=!0;let i=e.slice(0,e.length-2);f(i)}}},v=()=>{this.withTransactionUpdate(()=>{d.start("Refresh.removeNotUpdPaths",{stats:!0});for(let e=0;e<u.length;e++)f(u[e]);d.end("Refresh.removeNotUpdPaths"),!0===g?o.displayNotif({message:e.warnings.removeNodeDuringRefresh,level:"warning"}):(u.length>0||c.length>0)&&o.displayNotif({message:e.infos.refreshOK,level:"info"}),i.publish({event:"ENXModel/refresh/complete"}),d.end("Refresh.refresh");let t=d.meas("Refresh.refresh");if(t){let e=r.getPADTracker({eventCategory:"performance",eventAction:"refresh"});if(e){const o=t.duration,i=t.startTime;e.addMultivaluedEventData("2d_app_refresh",{call_refresh_start:i,call_refresh_duration:o}),e.trackPageEvent()}}console.groupEnd()})};i.publish({event:"ENXModel/refresh/begin"});let m=s&&s.roots;if(m||(m=this.getRoots()),0===m.length)return void v();const D=m.map(function(e){return e.getOccurencePath()});if(this.unselectAll(),0===h){d.start("Refresh.roots",{stats:!0}),d.start("Refresh.fetchRoots",{stats:!0});const o=m.map(function(e){return e.getID()});try{let i=await a.fetch({pids:o,autoAttSelection:!0});i="string"==typeof i?JSON.parse(i):i,d.end("Refresh.fetchRoots"),d.start("ParserCV.parseRefreshOcc",{stats:!0}),this._parseLoadModel=!0;let n=await l.parseRefreshOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:i});if(this._parseLoadModel=!1,d.end("ParserCV.parseRefreshOcc"),!0!==t.getSetting("grpBSD")&&this.isGroupingApplied()){console.log("Reapply grouping");for(let e=0;e<D.length;e++){let t=D[e].join("/"),o=this.options.mappedNodes.get(t);this.applyGroupingOnNode(o.grpParams)}}c=n.refreshPaths}catch(t){await this.displayErrorNotif(void 0,{nlsSubtitle:e.errors.genericWSFailure,key:"xNavDoc-refreshOcc"})}finally{v(),d.end("Refresh.roots")}}else{d.start("Refresh.paths",{stats:!0});let o={pathIds:D,data:{expandLevel:h},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};d.start("progressiveExpand",{stats:!0});try{let t=await a.expandv2(o);t="string"==typeof t?JSON.parse(t):t,d.end("progressiveExpand"),d.start("ParserCV.parseRefreshOcc",{stats:!0}),this._parseLoadModel=!0;const i=await l.parseRefreshOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:t});this._parseLoadModel=!1,d.end("ParserCV.parseRefreshOcc"),c=i.refreshPaths}catch(t){await this.displayErrorNotif(void 0,{nlsSubtitle:e.errors.genericWSFailure,key:"xNavDoc-refreshOcc-expand"})}finally{d.end("Refresh.paths"),v()}}},v.prototype.expandZeroForFilterRoots=async function(e){console.groupCollapsed("TreeDocOccurenceIdx::expandZeroForFilterRoots# Nb Nodes ["+e.filteredRoots.length+"]"),console.groupEnd()},v.prototype.insertBranches=async function(t,o){console.groupCollapsed("TreeDocOccurenceIdx::insertBranches Nb Paths="+t.length);let i=n.addOrGetSection("insertBranches");if(o&&"select"===o.from){const e=t.filter(e=>this.searchRootById(e[0]));if(1===e.length){const t=this.getNodeFromPath(e[0]),o=this.getNodesById(e[0][e[0].length-1]).includes(this.getSelectedNodes()[0]);if(t||o)return this._selectOccurence(),void console.groupEnd()}if(t&&t.length>0&&t[0].length>0&&!this.searchRootById(t[0][0]))return void console.groupEnd();await this.addPaths({paths:t,state:o.node_state})}else i.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0,await l.insertTempPaths({treeDoc:this,FBIProxy:this.options.FBIProxy,paths:t,nodeModelClass:this.options.nodeModelClass,nls:e.parser,state:o.node_state}),this._parseLoadModel=!1,i.end("ParserCV.insertTempPaths");console.groupEnd(),o.onComplete()},v.prototype.dispatchColorize=function(e,i,n,s,r,a){const l=this;return new Promise(function(d,c){let u=[],h=[],g=n.predicate+"-Instance";const f=!0===t.getSetting("synthesisModeOnInstance"),v=!1===a.getConfig("readOnlyApp");e.withTransactionUpdate(function(){for(let t=0;t<i.length;t++){const r=i[t];if(!0!==r.isGroupingNode&&!0!==o.isFakeTreeNodeModel(r)){const t=r.getPLMValue(n.predicate);if(null!==t){const o=p.getBIColor(s,n,t);let i={color:o,isBeingCut:!1,grid:{bi_color:o}};r.ghostMode=!1,o===A&&(delete r.options.color,r.ghostMode=!0,i.isBeingCut=!0),r.updateOptions(i),e.options.shouldBeSelected(r),h.push(r)}else if(v)u.push(r.getID());else{const t={color:A,grid:{bi_color:A}};r.updateOptions(t),e.options.shouldBeSelected(r)}if(f&&!1===r.isRoot()){let e=r.getPLMValue(g);if(null!==e){const t={colorInstance:p.getBIColor(s,n,e)};r.updateOptions(t),l.safeRemove(u,r.getID())}else if(v)-1===h.indexOf(r)&&u.push(r.getID());else{const e={colorInstance:A};r.updateOptions(e)}}if(r.options.color===A&&r.options.colorInstance===A){const e={isBeingCut:!0,grid:{bi_color:A}};delete r.options.color,delete r.options.colorInstance,r.ghostMode=!0,r.updateOptions(e)}}}}),0===u.length?(!0===e.fromTransactionEnd&&delete e.fromTransactionEnd,!0===r&&e._colorize3D(e),d()):e.updateNodesAttrValue(u,[n.predicate],function(t){e.withTransactionUpdate(function(){for(let t=0;t<u.length;t++){const o=e.getNodesById(u[t]);if(o.length>0){const t=o[0].getPLMValue(n.predicate);if(null!==t){const i=p.getBIColor(s,n,t),r={color:i,isBeingCut:!1,grid:{bi_color:i}};for(let t=0;t<o.length;t++)o[t].ghostMode=!1,i===A&&(delete o[t].options.color,o[t].ghostMode=!0,r.isBeingCut=!0),o[t].updateOptions(r),e.options.shouldBeSelected(o[t])}else{const t={grid:{bi_color:A}};for(let i=0;i<o.length;i++)delete o[i].options.color,t.isBeingCut=!0,o[i].ghostMode=!0,o[i].updateOptions(t),e.options.shouldBeSelected(o[i])}}}}),!0===r&&e._colorize3D(e),d()})})},v.prototype.safeRemove=function(e,t){let o=e.indexOf(t);-1!==o&&e.splice(o,1)},v.prototype.compareSpecific=function(e,t){const o=e.length,i=t.length;let n=!1;if(o===i){let o=!1;for(let n=0;n<i;n++){const i=t[n];if(-1===e.indexOf(i)){o=!0;break}}return o||(n=!0),n}return!1},v.prototype.updateColorForNodes=function(e,t,o){const i=require("DS/PADUtils/Configuration"),n=this,s=e.length<1e3?100:200;n.dispatchColorize(n,e,t,o,!0,i).then(function(){setTimeout(function(){const s=n.getAllDescendants();n.compareSpecific(e,s)||n.dispatchColorize(n,n.getAllDescendants(),t,o,!0,i).then(function(){console.log("Colorization done")})},s)})},v.prototype.selectFromTagger=async function(e){console.groupCollapsed("TreeDocOccurenceIdx::selectFromTagger");let o,s=n.addOrGetSection("measSelectFromTagger"),r=[];const d=()=>{e.doNotBroacast&&(this._doNotBroadcastSelect=!1,this._inBatchingForUpdate=!1)};(()=>{e.doNotBroacast&&(this._doNotBroadcastSelect=!0,this._inBatchingForUpdate=!0)})(),this.getXSO().empty(),c.empty();let p=[],u=this.getRoots(),h=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest();for(let n=0;n<u.length;n++){let r=u[n];p.push(new Promise(async d=>{const c={rootPhID:r.getOccurencePath(),select_bo:h.select_object,select_rel:["ro.plminstance.v_treeorder"].concat(h.select_relation),compute_select_bo:h.select_file,max_count_path:t.getSetting("maxPathsForSearch"),boundingbox:!1,taggerSelect:e.eventData};s.start("selectFromTagger-Root-"+n,{stats:!0}),o=r.getState();try{let e=await a.selectFromTagger({data:c,FBIProxy:this.options.FBIProxy});s.end("selectFromTagger-Root-"+n),e="string"==typeof e?JSON.parse(e):e,s.start("ParserCV.parseExpandOcc-Root-"+n,{stats:!0}),this._parseLoadModel=!0,await l.parseExpandOcc({treeDoc:this,expandedNodes:[r],FBIProxy:this.options.FBIProxy,wsResponse:e,nodeModelClass:this.options.nodeModelClass,state:"expanded",selectPaths:!0}),this._parseLoadModel=!1,s.end("ParserCV.parseExpandOcc-Root-"+n),d()}catch(e){this.options.FBIProxy.setSelectStatus({status:!0}),r.setState({state:o}),"TIMEOUT"===e.message?i.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestTimeout"}}):i.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestFailure"}}),d()}}))}Promise.all(p).then(()=>{if(this.options.FBIProxy.setSelectStatus({status:!0}),d(),(r=this.getXSO().get()).length>t.getSetting("maxPathsForSearch"))i.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"tooManyResults"}});else if(0===r.length)i.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"noResults"}});else{this._selected_paths=[];for(let e=0;e<r.length;e++)this._selected_paths.push(r[e].getOccurencePath());this._selectOccurence(),i.publish({event:"ENXViews/Model/SelectFromTagger/Success",data:{nbSelected:r.length}})}})},v.prototype._checkColorize3D=function(){y()&&this._colorize3D(this)},v.prototype._colorize3D=function(e){if(!0!==this._collapseRepDuringExpandAll){let t=this,o=[],i={},n=[],s=[];t.getRoots().forEach(function(i){if(i.options.color||(i.options.color=A),i.options.color)if(o.push(i.options.resourceid),s.push({color:i.options.color?i.options.color:A,pid:i.options.resourceid,ghostMode:i.ghostMode}),"collapseState"===i._expandState||"partiallyExpandedState"===i._expandState)if(null!==i.getChildren()&&i.getChildren().length>0)t._colorChildren(i,o,s,n,e);else{const e=i.getOccurencePath(i.options.resourceid);n.push(e.map(function(e){return o.indexOf(e)}))}else{const e=i.getOccurencePath(i.options.resourceid);n.push(e.map(function(e){return o.indexOf(e)}))}}),i={nodes:s,path:n},void 0!==t._cmdProxy&&0!==i.nodes.length&&t._cmdProxy.padFilterBI({filterBIColorize:i})}},v.prototype._colorChildren=function(e,t,i,n,s){let r=this;const a=e.getChildren();for(let e=0;e<a.length;e++)if(!o.isFakeTreeNodeModel(a[e]))if(t.push(a[e].options.resourceid),t.push(a[e].options.relationid),i.push({color:a[e].options.color?a[e].options.color:A,pid:a[e].options.resourceid,ghostMode:a[e].ghostMode}),i.push({color:a[e].options.colorInstance?a[e].options.colorInstance:A,pid:a[e].options.relationid,ghostMode:a[e].ghostMode}),"collapseState"===a[e]._expandState||"partiallyExpandedState"===a[e]._expandState)if(a[e].hasChildren())r._colorChildren(a[e],t,i,n,s);else{const o=a[e].getOccurencePath(a[e].options.resourceid);n.push(o.map(function(e){return t.indexOf(e)}))}else{const o=a[e].getOccurencePath(a[e].options.resourceid);n.push(o.map(function(e){return t.indexOf(e)}))}};const A="rgba(255, 255, 255, 0.3)";return v}),define("DS/ENXNav/mixins/_xNavDnD",["UWA/Class","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADDropTooltip","DS/PADUtils/Utility","DS/ApplicationFrame/CommandsManager","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,i,n,s,r,a,l,d){"use strict";return e.extend({setDnD_onGraph:function(){this.options.views.graphview.getContainer().addEventListener("dragover",this.onDragOverGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("drop",this.onDropBlankGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragenter",this.onDragLeaveGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragleave",this.onDragLeaveGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragend",this.onDragLeaveGraph.bind(this))},doDnDDragStart:function(e,o,i){var n=t.dropdata_from_selected_nodes(o);return this._updateWithBIProxyInfos(o,n),e.setData("Text",JSON.stringify(n)),!0},shouldAcceptDnDDrop:function(e,t,o,i){var n={shiftKey:2===i.modifiers};return this._add_drop_invite(n),!0},doDnDDrop:function(e,t,o,i){var n={dataTransfer:e,preventDefault:function(){},stopPropagation:function(){},shiftKey:i.modifiers};this._onDropContent(n)},onDragOverGraph:function(e){return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),this.options.views.graphview.getContainer().addClassName("bordered"),!0},onDragLeaveGraph:function(e){return this.options.views.graphview.getContainer().removeClassName("bordered"),this.onDragLeaveBlank(e)},onDropBlankGraph:function(e){this.options.views.graphview.getContainer().removeClassName("bordered")},onDragEnterBlank:function(e,t){return this.onDragOverBlank(e,t)},onDragOverBlank:function(e,t){return e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&(this._add_drop_invite(e),!0)},onDragEndBlank:function(e,t){return this.onDragLeaveBlank(e,t)},onDragLeaveBlank:function(e,t){if(!this._isDroppableInBody())return!1;var o=e.relatedTarget,i=!o||o instanceof SVGPathElement?"":o.className;if(!(!i||-1===i.indexOf("paddnd_invite_")))return e.preventDefault(),e.stopPropagation(),!1;if(this.dropInvitContainer){var n=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;if(0===this.options.model.getRoots().length&&0===n)this.dropInvitContainer.show("drop");else{if(this.dropInvitContainer.isEventInside(e))return e.preventDefault(),e.stopPropagation(),!1;this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)}}return!0},onDropBlank:function(e,t){return this._onDropContent(e),!0},onDragEnterCell:function(e,t){return this.onDragOverBlank(e,t)},onDragEndCell:function(e,t){return this.onDragLeaveCell(e,t)},onDragStartCell:function(e,o){(t.isTouchDevice()||t.isSurface())&&(this._dnd_startCell=!0,this._dnd_start_target=e.target);var i=o.nodeModel;if(!i.isGroupingNode){var n=this.options.model.getXSO().get().slice(0);if(n[0]!==i){var s=n.indexOf(i),r=n[0];n[0]=i,n[s]=r}var a=t.dropdata_from_selected_nodes(o.draggedNodes);return this.options.isDeEnabled&&this.hasActiveDesignExp()&&a&&a.data.items&&a.data.items.length&&o.draggedNodes.forEach(e=>{if(e.options.filtered){let t=a.data.items.find(t=>t.objectId==e.options.resourceid);t&&(t.filterId=e.options.filterId,t.isFiltered=!0,t.filterTitle=e.options.filterTitle)}}),this._updateWithBIProxyInfos(o.draggedNodes,a),e.dataTransfer.setData("Text",JSON.stringify(a)),e.stopPropagation(),!1}e.preventDefault()},onDragOverCell:function(e,t){return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&(this.dropInvitContainer&&"find_in_ctx"===t.dataIndex&&this.dropInvitContainer.show("find"),e.preventDefault(),!0)},onDragLeaveCell:function(e,o){if((t.isTouchDevice()||t.isSurface())&&this._dnd_startCell&&(this._dnd_leaveCell=!0),this.dropInvitContainer){var i=e.relatedTarget,n=i?i.className:" ";if(!(!n||-1===n.indexOf("paddnd_invite_"))||this.dropInvitContainer.isEventInside(e))return e.stopPropagation(),e.preventDefault(),!1;this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)}return!0},onDropCell:function(e,n){if(this.onDragLeaveCell(e),e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),(t.isTouchDevice()||t.isSurface())&&(this._dnd_leaveCell||this._dnd_startCell)&&(this._dnd_leaveCell=!1,this._dnd_startCell=!1,a.elementIsOrIsWithin(e.target,this._dnd_start_target)))return this._dnd_start_target=null,void(this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite));function s(){return r}if("top"!==n.dropPosition&&"bottom"!==n.dropPosition){var r=[];"find_in_ctx"===n.dataIndex&&i.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:!0,callback:function(e){var t=0;for(t=0;t<e.authorized_objects.length;t++)r.push([e.authorized_objects[t].objectId]);r.length&&(n.nodeModel.options.partialPreExpand=s,n.nodeModel.expand())}})}else o.displayNotification({msg:d.drop_between_lines,eventID:"warning",key:"enxNav-dropBetweenLines"});return!1},onDragEnterColumnHeader:function(e,t){},onDragEndColumnHeader:function(e,t){return delete sessionStorage.isNotDroppableInBody,this.onDragLeaveColumnHeader(e,t)},onDragOverColumnHeader:function(e,t){return this._isDroppableInBody()&&(this._add_drop_invite(e),e.preventDefault()),!0},onDragLeaveColumnHeader:function(e,t){var o=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;return this.dropInvitContainer&&(0===this.options.model.getRoots().length&&0===o?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)),!0},onDropColumnHeader:function(e,o){if("bi_color"==o.dataIndex)return!1;var i=!0;switch(t.retrieveDroppedDataType(e)){case"3DXContent":this.options.model.unselectAll(),this._onDropContent(e),i=!1;break;default:this.dropInvitContainer&&(0===this.options.model.getRoots().length?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide())}return i},onDragStartColumnHeader:function(e,t){return sessionStorage.isNotDroppableInBody="true",!0},_add_drop_invite:function(e){this.dropInvitContainer&&(e.shiftKey?this.dropInvitContainer.show("add_as_object"):(this.dropInvitContainer.show("add_in_context"),this.dropInvitContainer&&this.dropInvitContainer.elements&&this.dropInvitContainer.elements.container&&this.dropInvitContainer.elements.container.filterDiv&&(this.dropInvitContainer.elements.container.filterDiv.style.display="none",this.dropInvitContainer.elements.container.classList.remove("withFilterOpen"))))},_onDropContent:function(e){var n=this;if(e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),this.dropInvitContainer&&e.dataTransfer.files&&e.dataTransfer.files.length>0)return 0===n.options.model.getRoots().length?n.dropInvitContainer.show("drop"):n.dropInvitContainer.hide(),!1;function s(i){if(0===i.authorized_objects.length)n.dropInvitContainer&&(0===n.options.model.getRoots().length?n.dropInvitContainer.show("drop"):n.dropInvitContainer.hide()),!0===i.unsupportedDropNotified&&(0===i.authorized_objects.length&&0===i.unauthorized_objects.length?o.displayNotification({msg:d.root_already_loaded}):o.displayNotification({msg:d.invalidDropOperation,eventID:"error",key:"enxNav-onDropContent-invalid-drop"}));else{var s=e.shiftKey||!0===n.options.layout.dndEvo?"WITHOUT_CONTEXT":"WITH_CONTEXT",r=n.options.model.getRoots();t.multiTenantMgt(i.authorized_objects,r,function(e){e.isMultiTenant?e.isMultiTenant&&e.invalidTenant&&n.dropInvitContainer&&(0===n.options.model.getRoots().length?n.dropInvitContainer.show("drop"):n.dropInvitContainer.hide()):i.authorizedWithKind?(i.authorizedWithKind.Product&&i.authorizedWithKind.Product.length>0&&n.add({content:"3DXContent",authorized_objects:i.authorizedWithKind.Product,callback:void 0,behavior:s,isDrop:!0,biProxyCtx:i.source_data.biProxyCtx}),i.authorizedWithKind.Filter&&i.authorizedWithKind.Filter.length>0&&n.addFilter({content:"3DXContent",filter_objects:i.authorizedWithKind.Filter,broadcast:!0,callback:void 0,behavior:"fromDrop"}),i.authorizedWithKind.Change&&i.authorizedWithKind.Change.length>0&&n.loadChangeV2&&n.loadChangeV2({content:"3DXContent",objects:i.authorizedWithKind.Change,callback:void 0,behavior:s}),i.authorizedWithKind.DesignEnv&&i.authorizedWithKind.DesignEnv.length>0&&(require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXModel/DesignEnv/add",data:{designEnv:i.authorizedWithKind.DesignEnv,pseModel:n.options.model,resolve:function(e){n.dropInvitContainer&&n.dropInvitContainer.hide()}}}),n.dispatchEvent("onAddDesignEnv",{designEnvIds:i.authorizedWithKind.DesignEnv.map(e=>e.objectId)}))):n.add({content:"3DXContent",authorized_objects:i.authorized_objects,callback:void 0,behavior:s})})}}return e.dataTransfer.params?s(e.dataTransfer.params):i.retrieveAuthorizedObjects({notifPerObjects:!0,displayNotif:!1,dnd_event:e,callback:s,version:"2.0"}),!1},dropOnInvite:function(e){if(this._onDropContent(e),this.dropInvitContainer){var t=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;0===this.options.model.getRoots().length&&0===t?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide(this.dropInvitContainer.active_invite),"treelistview"===this.options.active_view&&this.getPADTreeListView().getManager().getScroller().getContent().removeClassName("wux-ui-state-drag-over")}},_isDroppableInBody:function(){return null===sessionStorage.isNotDroppableInBody||"true"!==sessionStorage.isNotDroppableInBody},_updateWithBIProxyInfos:function(e,t){var o=!1;for(let t=0;t<e.length&&!1===o;t++)e[t].isRoot()&&!0===e[t].options.filtered&&(o=!0);if(this._biFilter&&o){var i=this._biFilter.getCtxForSharing();i&&(t.biProxyCtx=i)}}})}),define("DS/ENXNav/utils/FindInCtx",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";function o(){return"object"==typeof o.instance?o.instance:(o.instance=this,this)}return o.prototype.launchFindWithDialog=function(t){var o=this;require(["DS/ENXNav/views/private/SearchView"],function(i){new i({placeholder:e.searchview.searchPlaceholder,target:t.dgvView?t.dgvView:t.renderTo,position:t.position,events:{onSearch:function(e){o.launchFind({nodes:[t.node],searchFts:e.searchFts,rscId:e.rscId})}}})})},o.prototype.launchFind=function(e){require(["DS/PADServices/utils/PredefinedQueryUtils"],function(o){e.searchFts?o.isPredefinedQry(e.searchFts).then(function(o){t.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFts:o,searchFtsOriginal:e.searchFts,rscId:e.rscId,doNotBroacast:e.doNotBroacast}})}):t.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFtsOriginal:e.searchFts,rscId:e.rscId,doNotBroacast:e.doNotBroacast}})})},new o}),define("DS/ENXNav/views/private/externalColumnsViews/UtilsColumns",["DS/PADServices/utils/Dimensions","DS/PADServices/settings/AppSettings"],function(e,t){"use strict";var o=null;const i=-1;function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.getURLParameter=function(e){return null===o&&((o=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null)||(o=location.search.length?location.search:null)),o&&decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(o)||[null,""])[1].replace(/\+/g,"%20"))||null},n.prototype.createCSSClass=function(e,t,o){if(null===document.getElementById(e)){var i=document.createElement("style");i.type="text/css",i.id=e;let n=o||"."+e;i.innerHTML=n+t,document.getElementsByTagName("head")[0].appendChild(i)}},n.prototype.launchIfEnabled=function(e,t){let o=e.getCommand(t);o&&o.isEnabled()&&o.begin()},n.prototype.executeGenericTooltip=function(o,n){let s;return s=o.rowID===i?n.getCellDefaultTooltip(o):function(o,i){let n;if(!0===t.getSetting("activateUnits")){let t,s="tree"===i?o.nodeModel.getLabel():o.nodeModel.getReferenceValue(i);n={shortHelp:t="object"==typeof s&&s.inputValue?s.inputValue+" "+e.getNLSForUnit(s.inputUnit):s,updateModel:!1}}else n={shortHelp:o.nodeModel.options.grid[i],updateModel:!1};return n}(o,o.dataIndex)},new n}),define("DS/ENXNav/commands/tools/_xNavColumnParam",[],function(){"use strict";return{execute:function(e){require(["DS/PADServices/views/AttributesCustomization","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2"],function(t,o,i){let n=o.getModelEvents(),s=[];if(e.dgv&&e.dgv.options.dgvLayout){let t=e.dgv.options.dgvLayout.getOrderedColumnsIndexes();for(let o=0;o<t.length;o++){let i=e.dgv.options.dgv.getColumnOrGroup(t[o]);s.push(i)}}else s=e.tree.options.columns;let r=e.dgv?e.dgv.options.viewMode:e.tree.options.viewMode,a=!!e.dgv,l=e.dgv?e.dgv.options.dgvLayout.rowsHeader:void 0,d=i.getDefaultTypesAndExtensions();e.dgv.columnOrdering=!0,new t({modelEvents:n,viewMode:r,appColumns:s,baseTypes:i.getBaseTypes(),baseInstanceTypes:i.getBaseInstanceTypes(),selectedTypes:i.getSelectedTypes(),selectedExtensions:i.getSelectedExtensions(),defaultTypes:d.defaultTypes,defaultExtensions:d.defaultExtensions,withDgv:a,dgvInfo:e.dgv,rowHeaderActivated:l,attributesToIgnore:i.getAttributesToIgnore()});let c=[];c.push(n.subscribe({event:"ENXViews/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&(e.tree&&e.tree.removeColumnCB(t.removedColumns),e.dgv&&e.dgv.removeColumnCB(t.removedColumns)),t.addedColumns&&(e.tree&&e.tree.addColumnCB(UWA.clone(t.addedColumns)),e.dgv&&e.dgv.addColumnCB(UWA.clone(t.addedColumns)));break;case"visibilityColumn":e.tree&&e.tree.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag),e.dgv&&e.dgv.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag);break;case"exportColumn":e.tree&&e.tree.changeExportCB(t.modifiedColumn,t.exportFlag),e.dgv&&e.dgv.changeExportCB(t.modifiedColumn,t.exportFlag);break;case"moveColumn":e.tree&&e.tree.moveColumnCB(t),e.dgv&&e.dgv.moveColumnCB(t);break;case"changeTitle":e.tree&&e.tree.changeTitleCB(t.modifiedColumn,t.newTitle),e.dgv&&e.dgv.changeTitleCB(t.modifiedColumn,t.newTitle);break;case"pinChange":e.dgv.changePinCB(t.modifiedColumn,t.pin);break;case"rowsHeaderModification":e.dgv.changeDgvLayout({rowsHeader:t.rowsHeader});break;case"changeColor":e.tree&&e.tree.changeColorCB(t.modifiedColumns,{"background-color":t["background-color"],color:t.color}),e.dgv&&e.dgv.changeColorCB(t.modifiedColumns,{"background-color":t["background-color"],color:t.color});break;case"changeViewMode":e.tree&&e.tree.compactMode(t),e.dgv&&e.dgv.compactMode(t);break;case"close":e.xnav_app.options.isDeEnabled&&e.xnav_app.hasActiveDesignExp()&&e.xnav_app.getPseService().addOrRemoveCompareFunction(e.dgv,"add"),t.selectedExtensions&&t.selectedTypes&&i.updateSelectedParams({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}),e.dgv?e.dgv.saveCustoView(t.applyOnlyToThisApp):e.tree&&e.tree.saveCustoView(t.applyOnlyToThisApp),c.forEach(function(e){n.unsubscribe(e)});break;case"reset":i.resetSelectedParams(),e.dgv&&e.dgv.reset(t.parameters),e.tree&&e.tree.reset(t.parameters),c.forEach(function(e){n.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+t.what)}}))})}}}),define("DS/ENXNav/commands/GroupsLayoutCompact",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/GroupsLayout",data:{mode:"compact"}})}})}),define("DS/ENXNav/views/private/ExpandChecker",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/PADUtils/PADSettingsMgt","DS/Controls/Toggle","DS/PADServices/utils/GlobalUtils"],function(e,t,o,i){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this.storageKey=i.getAppId()+"-NoCheckExpanAll",this)}return n.prototype.check=function(o){var i=this;return new Promise(function(n){for(var s=function(e){n({performExpandAll:e})},r=!1,a=0;a<o.roots.length;a++){var l=o.roots[a];l.hasSynthesis()&&(t.getSetting("maxNumberOfLeaves")<=l.getSynthesis("leafSynthesis")?(r=!0,console.log("Too many leaves (>"+t.getSetting("maxNumberOfLeaves")+")")):t.getSetting("maxNumberOfOcc")<=l.getSynthesis("occSynthesis")?(r=!0,console.log("Too many occurences (>"+t.getSetting("maxNumberOfOcc")+")")):t.getSetting("maxNumberOfObj")<=l.getSynthesis("flatSynthesis")&&(r=!0,console.log("Too many objects (>"+t.getSetting("maxNumberOfObj")+")")))}r?"TRUE"!==localStorage.getItem(i.storageKey)?require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(t,n){i.modalStop=new t({target:o.targetDiv,title:e.expandChecker.title,content:i.buildContent(),modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,width:"auto",height:"auto",position:{my:"center",at:"center"},buttons:{No:new n({domId:"enxnav-expand-checker-no",touchMode:!0,onClick:function(){s(!1),i.modalStop.close()}}),Yes:new n({domId:"enxnav-expand-checker-yes",touchMode:!0,onClick:function(){var e=i.toggleAskAgain.checkFlag;localStorage.setItem(i.storageKey,e?"TRUE":null),s(!0),i.modalStop.close()}})}})}):s(!0):s(!0)})},n.prototype.buildContent=function(){var t=new UWA.Element("div",{class:"enx-expandchecker-content"});new UWA.Element("div",{class:"enx-expandchecker-text"}).inject(t).setHTML(e.expandChecker.content);var i=new UWA.Element("div",{class:"enx-expandchecker-checker"}).inject(t),n=this.toggleAskAgain=new o({type:"checkbox",label:e.expandChecker.askAgain}).inject(i);return n.getContent().addClassName("enx-expandchecker-toggle"),n.addEventListener("change",function(e){e.dsModel.checkFlag?this.helpCheckerDiv.removeAttribute("hidden"):this.helpCheckerDiv.setAttribute("hidden","")}.bind(this)),(this.helpCheckerDiv=new UWA.Element("div",{class:"enx-expandchecker-checkerhelp"}).inject(t)).setText(e.expandChecker.checkerhelp),this.helpCheckerDiv.setAttribute("hidden",""),t},new n}),define("DS/ENXNav/commands/_xNavActionBar",["UWA/Core","DS/ApplicationFrame/ActionBar","DS/RuntimeView/NLSManager","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt"],function(e,t,o,i,n,s){"use strict";function r(s){this.options={action_bar:{file:null,module:null,context:null,hidden:null,language:"en"},renderTo:null,callback:{onactionbarcb:null}},i.set(s.xnav_app),this.options=e.extend(this.options,s,!0),o.DEFAULT_LANGUAGE=this.options.action_bar.language;var r=new t(this.options.action_bar),a=this;if(UWA.is(this.options.callback.onactionbarcb,"function")){if(UWA.is(r.onActionBarDisplay,"function"))var l=r.onActionBarDisplay(function(){r._modelEvents.unsubscribe(l),a.options.callback.onactionbarcb.call(null,"onActionBarDisplay")});var d=r.onActionBarReady(function(){r._modelEvents.unsubscribe(d),a.options.callback.onactionbarcb.call(null,"onActionBarReady")})}"ENOPS_app"===r.options.module?r.elements.container.addClassName("xnav_actionbar_ENOPS"):r.elements.container.addClassName("xnav_actionbar"),r.elements.container.addEventListener("click",function(e){const t=e.currentTarget.getAttribute("data-open");a.options.action_bar.hidden?a.options.action_bar.hidden!==t&&(a.options.action_bar.hidden=t,n.publish({event:"ENXViews/ActionBar/statusChanged",data:{dataOpen:t}})):(a.options.action_bar.hidden=t,n.publish({event:"ENXViews/ActionBar/statusChanged",data:{dataOpen:t}}))}),!0===r._preferences.getIsCollapsedPreference()?a.options.action_bar.hidden=!1:a.options.action_bar.hidden=!0,r.inject(this.options.renderTo),this.options.xnav_ab=r,n.subscribe({event:"ENXViews/ActionBar/hide"},function(){a.options.xnav_ab.close()}),n.subscribe({event:"ENXViews/ActionBar/status"},function(){n.publish({event:"ENXViews/ActionBar/statusChanged",data:{dataOpen:a.options.action_bar.hidden.toString()}})})}return r.prototype={mergeGraphSection:function(){this.options.xnav_ab.loadModel({merge:!0,file:"GraphViewAB.xml",module:"ENXNav"})}},r}),define("DS/ENXNav/mixins/xNavWidgetLink",["UWA/Class","DS/ENOXInterWdgCom/LinkManager","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/GlobalUtils","DS/PADUtils/PADPromise","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/settings/AppSettings","DS/PADUtils/PADUtilsServices","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt"],function(e,t,o,i,n,s,r,a,l,d,c,p){return e.extend({setupWidgetLink:function(){if(!window.__karma__||p.getSetting("widgetlink-odt")){this._initialPathes=new Map,this.addEvent("onAddPaths",function(e){for(let t=0;t<e.addedPaths.length;t++){let o=e.addedPaths[t][0];this._initialPathes.get(o)?this._initialPathes.get(o).push(e.addedPaths[t]):this._initialPathes.set(o,[e.addedPaths[t]])}}),this.addEvent("onAddFilters",function(e){for(let t=0;t<e.rootIds.length;t++){let o=e.rootIds[t];this._initialPathes.get(o)?this._initialPathes.get(o).push(e.rootIds[t]):this._initialPathes.set(o,[[e.rootIds[t]]])}});var e=this;r.subscribeOnce({event:"ENXModel/Root/FBIProxy"},()=>{e.getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},function(t){e._initialPathes.delete(t.data.pid)})}),t.subscribe("DS/ExternalWdgtCom/LoadData",this._onLoadData.bind(this)),t.subscribe("DS/ExternalWdgtCom/RemoveAll",this._onRemoveAll.bind(this)),t.subscribe("DS/ExternalWdgtCom/RemoveRoot",this._onRemoveRoots.bind(this)),t.subscribe("DS/ExternalWdgtCom/GetInfosForSync",this._onGetInfosForSync.bind(this)),t.subscribe("DS/ExternalWdgtCom/SyncContent",this._onSyncContent.bind(this)),t.subscribe("DS/ExternalWdgtCom/EndSync",this._endSync.bind(this))}else console.warn("We are in karma test environment, thus preventing the use of WidgetLink.")},_onUnLink:function(e){},_onLink:function(e){},_isEventSourceCorrect:function(e,o,i){let n=!0;if(e&&"Widgets"===o){t.getLinked().filter(t=>t.id===e).length>0&&(console.warn("Please use WidgetLink instead of PlatformAPI to publish this "+i+" event if your widget "+e+" is linked to a Product Structure app"),n=!1)}return n},_onLoadData:function(e,o){if(this._isEventSourceCorrect(e.fromWidgetId,o.channel,"LoadData")){e.dropData.broadcast=!1,e.dropData.behavior="WITHOUT_CONTEXT",t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/LoadData");var n=e.dropData;if(!a.getSetting("loadWithFilterSpec"))return this.openDroppedObjects(n);if(!n.filter)return this.openDroppedObjects(n);{let e=0,t=[];const o=e=>{for(let e=0;e<t.length;++e)this._biFilter.removeEvent(t[e]);if(0===e.status&&null!==e.error)i.displayNotif({eventID:e.error.level,title:e.error.title,msg:e.error.message,key:"openWdgLnkWithFilter"});else{if("APPLY"===n.filter.intent){const e=this.options.model.getModelEvents().subscribe({event:"onRootAdded"},()=>{this.options.model.getModelEvents().unsubscribe(e),r.getModelEvents().publish({event:"ENXViews/WelcomePanel/closeLandingPage"})});return}n.withFilter=!0,this.openDroppedObjects(n)}},a=n.unserializedData.data.items;for(let i=0;i<a.length;++i){var s=`DroppedFilterSpec2D-${i}`;t.push(s),this._biFilter.addEvent(s,t=>{++e===a.length&&o(t)}),this._biFilter.setPublicFilterSpecification({rootId:a[i].objectId,rootAlias:a[i].displayName,specification:n.filter.specification,applyFilter:"APPLY"===n.filter.intent?1:0,displayFilter:"WAIT"===n.filter.intent?1:0,eventName:s})}}}},_onRemoveAll:function(e,o){this._isEventSourceCorrect(e.fromWidgetId,o.channel,"RemoveAll")&&(t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/RemoveAll"),this.empty(!1))},_onRemoveRoots:function(e,o){this._isEventSourceCorrect(e.fromWidgetId,o.channel,"RemoveRoot")&&(t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/RemoveRoot"),delete e.fromWidgetId,this._onRemoveRoot(e))},_onGetInfosForSync:function(e){if(e&&e.fromLinkManager){t.setWidgetSynchronizing(!0);let o=this.getRoots(),i=[];o&&o.length>0&&(i=o.map(e=>{const t=e.getID();e=this.options.model.searchRootById(t);return{rootID:t,pathes:this._initialPathes.get(t),serviceID:null,filterId:this._biFilter.HasFilter(t).filterId,type:e.options.type}}));let n,s=widget.getValue("x3dSharedId");n=!0===a.getSetting("explorerOcc")?require("DS/PADServices/utils/HideShowCtrl"):require("DS/PADServices/utils/HideShowController");let r={id:widget.id,sharedID:s,content:i,hiddenPaths:n.getHiddenPathsAsArray(),shownPaths:n.getShownPathsAsArray()};if(!e||!e.get)return r;t.publish("DS/ExternalWdgtCom/GetInfosForSync",r)}},_onSyncContent:function(e){var o=this;this.disableUX(),e.srcWidgetID!==widget.id?t._initiatorLinks.set(e.srcWidgetID,!1):t._initiatorLinks.set(e.fromWidgetId,!0);let i=!1;if(t.setSourceWidgetId(e.srcWidgetID),t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/SyncContent"),e.srcWidgetID===widget.id&&"function"==typeof this._biFilter.linkWith)return t._nbWdgtsToSync=e.nbWdgtsToSync,e.rootsToSync.length>0&&r.subscribeOnce({event:"ENXModel/refresh/complete"},function(){e.hiddenPaths&&e.hiddenPaths.length>0&&o.onHide({paths:e.hiddenPaths}),e.shownPaths&&e.shownPaths.length>0&&o.onShow({paths:e.shownPaths})}),void this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:function(){i||(o.refresh(!1),t._onFinishSync(),i=!0),console.log("Linked BIProxy of "+widget.id+" with "+e.srcWidgetID)}});let s=t.createView(t=>t.id===e.srcWidgetID),a=null,l=new Promise(function(e,t){a=e});this.options.model.getRoots().length>0?r.subscribeOnce({event:"DS/InternalWdgtCom/NGFilterReset"},function(){a()}):a();var p=function(){if(console.log("Linked BIProxy of "+widget.id+" with "+e.srcWidgetID),!i){i=!0;let r=[];e.rootsToSync.forEach(e=>{r.push({rootId:e.rootID,pathes:e.pathes,filterId:e.filterId,type:e.type})}),o.empty(!1,!1,!0);let a=r.map(function(e){return{type:e.type}});if(r.length>0){var t=n.getPromises();Promise.all(t).then(function(){l.then(function(){c.isTypesAuthorized(a,function(t,i){let n=r.filter(function(e){return t.includes(e.type)});if(n.length>0){let t=[];for(let e=0;e<n.length;e++){let i=n[e];i.filterId,t.push(new Promise(function(e){o.add({paths:i.pathes,content:"pathslist",callback:function(){e()}})}))}Promise.all(t).then(function(){e.hiddenPaths&&e.hiddenPaths.length>0&&o.onHide({paths:e.hiddenPaths}),e.shownPaths&&e.shownPaths.length>0&&o.onShow({paths:e.shownPaths}),s.publish("DS/ExternalWdgtCom/FinishedSync"),r.forEach(function(e){if(o._biFilter.HasFilter(e.rootId).hasFilter){var t=o.options.model.searchRootById(e.rootId);t&&d.node.setFilterBadge(t)}})})}else s.publish("DS/ExternalWdgtCom/FinishedSync",{notSupportedError:widget.id})},!0,!1,"2.0")})})}else s.publish("DS/ExternalWdgtCom/FinishedSync")}};"function"==typeof this._biFilter.linkWith?this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:p}):r.subscribe({event:"ENXModel/Root/FBIProxy"},()=>{this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:p})})},_unLinkBIProxy:function(e){"function"==typeof this._biFilter.unlink&&(this._biFilter.unlink({widgetId:widget.id,srcWgtId:e,NGFUXId:t.getPreviousNGFUXID(),callback:()=>{console.log("Unlinked BIProxy of"+widget.id+" from "+e)}}),t.setPreviousNGFUXID(this.getNGFUXID(!0)))},_linkBIProxy:function(e){"function"==typeof this._biFilter.linkWith&&this._biFilter.linkWith({srcWgtId:e,callback:()=>{console.log("Linked BIProxy of "+widget.id+" with "+e)}})},_endSync:function(e){var o=this,r=n.getPromises();Promise.all(r).then(function(){t.setWidgetSynchronizing(!1),o.enableUX(),e&&e.isInitiator||"undefined"!=typeof widget&&e&&!e.widgetsWithErrors.includes(widget.id)&&i.displayNotif({level:"success",message:s.syncSuccessNotif,sticky:!1})})}})}),define("DS/ENXNav/commands/view/_xNavSelectInversion",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getRoots(),i=t.getSelectedNodes(),n=[],s=[];if(o.length){t.prepareBroadcastSelect(),t.prepareUpdate();let e=t.getAllDescendants(),o=t.getRoots();if(0===i.length)n=e.filter(e=>!e.isRoot()),s=i.slice(0);else{n=e.filter(e=>!e.isSelected());let t=e.filter(e=>(function(e,t){let o=!1,i=e.getParent();for(;i;){if(t.includes(i)){o=!0;break}if(i.isRoot())break;i=i.getParent()}return o})(e,i));s=(s=i.slice(0)).concat(t),s=Array.from(new Set(s))}s.push(...o),i.forEach(function(e){if(!e.isRoot()){let t=e.getParent();for(;t&&(s.push(t),!t.isRoot());)t=t.getParent()}}),t.multiselect(n),t.multiunselect(s),t.pushUpdate(),t.pushBroadcastSelect()}}}}),define("DS/ENXNav/commands/xNavActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils"],function(e,t,o,i,n,s,r){"use strict";const a=["ExpandAll","CollapseAll","ExpandN","SelectChildren","SelectParent","SelectSiblings","SelectLeaves","ReframeOn"];var l=["ReframeAll","ReframeOn","ToggleOverview","LayoutDown","LayoutRight","LayoutUp","LayoutLeft","SwapThumbState"];const d=["RootPanel","Home","Print","PrintOptions","ExportCSV","ExportCSVOptions","CleanAll"],c=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],p=["ExpandAll","CollapseAll","ExpandN"],u=["Print","ExportCSV","CleanAll"],h=["ColumnVisibility"],g=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],f=["ProductToPart"],v=["ProductToPart"];let m=[];!0===n.getSetting("grpBSD")&&(m=["ExpandAll","CollapseAll","ExpandN"]);const D=["RelationIPExplorer"];function b(e,t){return-1!==e.indexOf(t)}return e.extend({init:function(e){this._parent(e);var i=this,n=(p=t.get()).options.model?p.options.model:p.getPADTreeDocument();if(o.isMobileDevice()&&-1!==g.indexOf(this.options.ID))this.disable();else if(-1!==a.indexOf(this.options.ID)&&-1!==l.indexOf(this.options.ID))this._check_view(!0),p.addEvent("onToggleView",function(){i._check_view(!0)}),n.getXSO().onPostAdd(function(){i._check_view(!0)}),n.getXSO().onPostRemove(function(){i._check_view(!0)}),n.getXSO().onEmpty(function(){i._check_view(!0)});else if(-1!==a.indexOf(this.options.ID))this._check_select(),n.getXSO().onPostAdd(this._check_select.bind(this)),n.getXSO().onPostRemove(this._check_select.bind(this)),n.getXSO().onEmpty(this._check_select.bind(this)),s.subscribe({event:"ENXNav/UpdateCmdAvailability"},()=>{this._check_select()});else if(-1!==l.indexOf(this.options.ID))this._check_view(),p.addEvent("onToggleView",this._check_view.bind(this));else if(-1!==d.indexOf(this.options.ID)){this._check_roots();var r=this._check_roots.bind(this);n.addEventListener("addChild",r),n.addEventListener("removeChild",r),b(c,this.options.ID)&&(this._check_roots(),p.addEvent("onRootsVisibility",this._check_roots.bind(this)))}else if(u.indexOf(this.options.ID)&&-1!==u.indexOf(this.options.ID)){this._parent(e);var p;n=(p=t.get()).options.model?p.options.model:p.getPADTreeDocument();this.disable(),p.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}else if(b(h,this.options.ID))this._check_if_treeview(),UWA.is(p.addEvent,"function")&&p.addEvent("onToggleView",this._check_if_treeview.bind(this));else if(-1!==f.indexOf(this.options.ID)){var m=-1!==v.indexOf(this.options.ID);this._check_mono_select(m),m&&t.get().addEvent("editModeModified",function(){i._check_mono_select(m)}),n.getXSO().onPostAdd(function(){i._check_mono_select(m)}),n.getXSO().onPostRemove(function(){i._check_mono_select(m)}),n.getXSO().onEmpty(function(){i._check_mono_select(m)})}else-1!==D.indexOf(this.options.ID)&&(this.__checkDisableSupplemental(),n.getXSO().onPostAdd(this.__checkDisableSupplemental.bind(this)),n.getXSO().onPostRemove(this.__checkDisableSupplemental.bind(this)),n.getXSO().onEmpty(this.__checkDisableSupplemental.bind(this)))},execute:function(){var e=this,o=t.get(),n=o.options.model?o.options.model:o.getPADTreeDocument();switch(this.options.ID){case"treelistview":case"graphview":case"tileview":case"thumbnailview":case"treeview":require(["DS/ENXNav/commands/_xNavSwitchView"],function(t){t.execute({command_id:e.options.ID,xnav_app:o})});break;case"ExpandAll":require(["DS/ENXNav/commands/view/_xNavExpandAll"],function(e){e.execute({xnav_app:o,model:n})});break;case"CollapseAll":require(["DS/ENXNav/commands/view/_xNavCollapseAll"],function(e){e.execute({xnav_app:o,model:n})});break;case"ExpandN":require(["DS/ENXNav/commands/view/_xNavExpandN"],function(t){t.execute({xnav_app:o,model:n,position:e.options.position}),delete e.options.position});break;case"SelectAll":require(["DS/ENXNav/commands/view/_xNavSelectAll"],function(e){e.execute({xnav_app:o,model:n})});break;case"SelectChildren":require(["DS/ENXNav/commands/view/_xNavSelectChildren"],function(e){e.execute({xnav_app:o,model:n})});break;case"SelectInversion":require(["DS/ENXNav/commands/view/_xNavSelectInversion"],function(e){e.execute({xnav_app:o,model:n})});break;case"SelectParent":require(["DS/ENXNav/commands/view/_xNavSelectParent"],function(e){e.execute({xnav_app:o,model:n})});break;case"SelectSiblings":require(["DS/ENXNav/commands/view/_xNavSelectSiblings"],function(e){e.execute({xnav_app:o,model:n})});break;case"SelectLeaves":require(["DS/ENXNav/commands/view/_xNavSelectLeaves"],function(e){e.execute({xnav_app:o,model:n})});break;case"CleanAll":require(["DS/ENXNav/commands/view/_xNavCleanAll"],function(e){e.execute({xnav_app:o})});break;case"ProductToPart":require(["DS/ENXNav/commands/ProductToPart"],function(t){t.execute({command_id:e.options.ID,xnav_app:o,model:n})});break;case"ReframeAll":case"ReframeOn":case"ToggleOverview":case"LayoutDown":case"LayoutRight":case"LayoutUp":case"LayoutLeft":case"SwapThumbState":require(["DS/ENXNav/commands/_xNavGraphCmds"],function(t){t.execute({command_id:e.options.ID,xnav_app:o,model:n})});break;case"RelationIPExplorer":require(["DS/ENXNav/commands/tools/_xNavRelationIPExplorer"],function(t){t.execute({command_id:e.options.ID,xnav_app:o,model:n})});break;case"ColumnVisibility":require(["DS/ENXNav/commands/tools/_xNavColumnParam"],function(t){var i=o.options.views?o.options.views.treelistview:o.getPADTreeListView(),n=o.options.views?o.options.views.datagridview:void 0;t.execute({command_id:e.options.ID,cmd:e,xnav_app:o,tree:i,dgv:n})});break;default:throw new Error("Unknown command")}if(!0===this.options.fromCtx)delete this.options.fromCtx;else{var s=i.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});s.setEventData({eventLabel:this.options.ID}),s.trackPageEvent()}},_check_roots:function(){t.get().getPADTreeDocument().getRoots().length>0?this.enable():this.disable()},_check_added_roots:function(e){t.get().getPADTreeDocument();0===e.data.nb_root?this.disable():this.enable()},_check_select:function(){var e=t.get().getPADTreeDocument(),o=t.get().getPADTreeDocument().getXSO().get();!0===!!o.length?b(m,this.options.ID)&&(!0===e.isGroupingApplied()&&o.length>1||!0===o[0].getReferenceValue("groupApplied"))?this.disable():b(p,this.options.ID)&&!function(e){for(var t=0,o=0;o<e.length;o++){var i=e[o],n=i.getChildren();"Drawing"!==i.options.type?null!==n&&t++:n&&n.length&&t++}return t>0}(o)?this.disable():this.enable():this.disable(),s.getModelEvents().publish({event:"ENXModel/ReadWriteTriggered",data:!!o.find(e=>e.options.isReadOnly)})},_check_mono_select:function(e){if(e&&!0!==t.get().getEditMode())this.disable();else{var o=t.get().getPADTreeDocument().getXSO().get(),i=1===o.length;(n=o).filter(e=>!r.isFakeTreeNodeModel(e)&&!0!==e.isGroupingNode).length!==n.length?this.disable():i&&!0!==o[0].isRelationsObjectNode?this.enable():this.disable()}var n},__checkDisableSupplemental:function(e){let o=!0;var i=t.get().getPADTreeDocument().getXSO().get();for(let e=0;e<i.length;e++)if("function"==typeof i[e].isSupplemental&&!0===i[e].isSupplemental()){o=!1;break}o?this.enable():this.disable()},_check_edit_mode:function(){1==t.get().getEditMode()&&this.disable()},_check_view:function(e){if(!0===e){var o=!!t.get().getPADTreeDocument().getXSO().get().length;"graphview"===t.get().options.active_view&&!0===o?this.enable():this.disable()}else{switch(t.get().options.active_view){case"tileview":case"thumbnailview":t.get().getPADTreeDocument()._pagerview&&t.get().getPADTreeDocument()._pagerview.hide();break;case"treelistview":case"graphview":t.get().getPADTreeDocument()._pagerview&&t.get().getPADTreeDocument()._pagerview.show()}"graphview"===t.get().options.active_view?this.enable():this.disable()}},_check_if_treeview:function(){if(n.getSetting("readOnlyDashboard"))this.disable();else switch(t.get().getPADTreeDocument().options.active_view){case"treelistview":case"datagridview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}}})}),define("DS/ENXNav/views/private/externalColumnsViews/responsible",["css!DS/ENXNav/ENXNav.css","text!DS/ENXNav/assets/templates/responsibleTooltip.html","DS/PADServices/utils/AttributesMgtV2","DS/i3DXCompassServices/i3DXCompassServices","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/ApplicationFrame/CommandsManager","DS/Handlebars/Handlebars","DS/PADUtils/Configuration","DS/PADUtils/PADContext"],function(e,t,o,i,n,s,r,a,l,d){"use strict";var c=a.compile(t),p=null,u=function(e,t){let o;return p&&(o=p+"/api/user/getpicture/login/"+e,t&&(o+="/format/"+t)),o},h={"ds6w:responsible":{getCellTooltip:function(e,t){let o;if(-1===e.rowID)o=t.getCellDefaultTooltip(e);else{var i=e.nodeModel?e.nodeModel.options.grid.owner:void 0;if(i&&p){o={shortHelp:c({responsible:e.nodeModel.getReferenceValue("ds6w:responsible"),url:u(i,"normal")}),allowUnsafeHTMLShortHelp:!0,updateModel:!1}}else o={shortHelp:e.nodeModel.getReferenceValue("ds6w:responsible")}}return o},buildColumn:function(e){o.addBIColumn("owner",!1);var t=!0;return!l.getConfig("readOnlyApp")&&(t=!1),Object.assign({dataIndex:"ds6w:responsible",kind:"user",minWidth:150,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"user"},getCellValue:function(e){var o=e.nodeModel&&e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:void 0,i=o?u(o):void 0;let n;n=i?{iconPath:"url("+i+")",className:"dgv-user-thumbnail"}:{iconName:"topbar-user",fontIconFamily:1};var s=e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0;if(s){let o={icon:n,label:s};return!1===t&&(o.module="DS/ENXNav/views/private/externalColumnsViews/responsible",o.func="launchCmd",o.argument={nodeModel:e.nodeModel}),o}},getCellValueForExport:function(e){return e&&e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0}},e)}},launchCmd:function(e){if(!0===d.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{var e=r.getCommand("ActionBar_TransferOwnership");e&&e.begin()},t)}}};return new Promise(e=>{p?e(!0):void 0===p?e(!1):i.getServiceUrl({serviceName:"3DSwym",platformId:s.getPlatformId(),onComplete:t=>{e(void 0!==(p=t))},onFailure:()=>{p=void 0,e(!1)}})}),h}),define("DS/ENXNav/mixins/xNavLeftSidePanel",["DS/PADServices/views/ENXLeftSidePanel","DS/PADServices/utils/GlobalModelEvents","DS/Utilities/Utils","DS/TreeModel/TreeNodeModel"],function(e,t,o,i){"use strict";function n(){}return n.prototype.createRootListSlidder2=function(){var n=this;return this.leftsidepanel=new e,this.options.model.onNodeModelUpdate(function(e){var n=[],s=[];e.data.nodeModel.isRoot()&&e.data.nodeModel.getNodeSource()!==i.NODE_SOURCE.GROUPING&&(-1===s.indexOf(e.data.nodeModel.getID())&&(s.push(e.data.nodeModel.getID()),n.push(e.data.nodeModel)),this.__debounceRootSync=this.__debounceRootSync?this.__debounceRootSync:o.debounce(()=>{0;for(let e=0;e<n.length;e++)t.publish({event:"ENXModel/Root/sync",data:n[e]})},350),this.__debounceRootSync())}),t.subscribe({event:"ENXModel/Root/select"},this._onTileSelect.bind(this)),t.subscribe({event:"ENXModel/Root/addTile"},this.openDroppedObjects.bind(this)),t.subscribe({event:"ENXModel/Root/removeTile"},this._onRemoveTile.bind(this)),t.subscribe({event:"ENXModel/DesignEnv/added"},function(){n.openPanel("left")}),this.leftsidepanel.getContent()},n.prototype._onTileSelect=function(e){if(!UWA.is(e.tile_ids,"array"))throw new Error("Invalid input param, no params.tile_ids defined");var t=this;t.options.model.withBroadcastSelect(function(){t.options.model.unselectAll(),e.tile_ids.forEach(function(o){var i=t.options.model.searchRootById(o);i&&!0!==i.isFiltered()?(i.select(),1===e.tile_ids.length&&t.options.model.getModelEvents().publish({event:"onCenterGraph",data:i})):console.log("Cannot find ["+o+"] in the TreeDocument")})})},n.prototype._onRemoveTile=function(e){if(!e.all){if(!UWA.is(e.tile_id))throw new Error("Invalid input parameter");var t=this.options.model.searchRootById(e.tile_id);return UWA.is(t)&&this.options.model.removeRoot(t),!1}this.options.model.empty()},n}),define("DS/ENXNav/views/customize_views/_xNavDGVUtils",["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/HideShowController","i18n!DS/ENXNav/assets/nls/ENXNav"],function(e,t,o,i,n){"use strict";function s(e){e.typeRepresentation=void 0===e.typeRepresentation?"string":e.typeRepresentation;const t=e.dataIndex;e.filterOptions={mapPossibleValues:function(e){return new Promise(function(i){setTimeout(function(){let n={};n[t]=e,o.retrieveNLS({nlsData:n}).then(function(e){if(e&&Object.keys(e).length>0){const o=Object.values(e[t]);i(o)}else i({})})},0)})}}}function r(e){}return r.prototype.buildColumns=function(t){return new Promise(function(t,i){var n=[],s=0,r=e.getColumnsOrder(void 0);e.updateAttributesWithKind(void 0).then(function(){for(s=0;s<r.length;s++){var i=e.getColumn(r[s],void 0);if(i){let e=null;i.ds6w&&this.options.columnViews[i.ds6w]?e=this.options.columnViews[i.ds6w].AMD[i.ds6w].buildColumn(i):i.dataIndex&&this.options.columnViews[i.dataIndex]&&(e=this.options.columnViews[i.dataIndex].AMD[i.dataIndex].buildColumn(i)),null===e&&(e=this.buildColumnFromSetting(i)),null!==e&&n.push(e)}}var a=UWA.clone(n);o.updateColumnsWithNLS(a,function(e){var o={};o.columns=a,"success"===e.status&&(o.columns=e.columns),t(o)})}.bind(this)).catch(i)}.bind(this))},r.prototype.buildColumnFromSetting=function(t){var o=Object.assign({minWidth:50,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},t);if(!UWA.is(o.dataIndex)&&"actualIndex"!==o.dataIndex){if(!UWA.is(o.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(t)+"]");o.dataIndex=o.ds6w}!UWA.is(o.ds6w)&&!0!==o.isAdditionalColumn&&e.isAttributeColumn(o.dataIndex)&&"asset-type"!=o.dataIndex&&(o.ds6w=o.dataIndex,UWA.is(o.kind)||(o.kind=null),"actualIndex"!==o.dataIndex&&console.warn(o.dataIndex+" column attribute missing ds6w"));switch(-1!==["hide_show","find_in_ctx","actualIndex"].indexOf(o.dataIndex)&&(o.customisation=UWA.extend(o.customisation,{exportable:{lock:!0,value:!1}})),o.kind&&("timestamp"===o.kind||"dateTime"==o.kind?o.typeRepresentation="datetime":o.typeRepresentation||(o.typeRepresentation=o.kind)),o.typeRepresentation||(o.typeRepresentation="string"),o.dataIndex){case"thumbnail":o.ds6w=void 0,o.alignment="center",o.typeRepresentation="image";break;case"tree":o.getCellKPIColor=function(e){if(!e.isHeader&&e.nodeModel){if(e.nodeModel.options.color)return e.nodeModel.options.color;if(e.nodeModel.options.grid.bi_color)return e.nodeModel.options.grid.bi_color}};break;case"ds6w:label-Instance":o.getCellKPIColor=function(e){if(!e.isHeader&&e.nodeModel&&e.nodeModel.options.colorInstance)return e.nodeModel.options.colorInstance},o.getCellValueForExport=function(e){var t="";return-1===e.rowID?t=n.instanceName:e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid["ds6w:label-Instance"]&&(t=e.nodeModel.options.grid["ds6w:label-Instance"]),t}}return"rel"===o.ds6wFrom&&(o.icon={iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}),"boolean"!==o.typeRepresentation||o.getCellValue||(o.getCellValue=function(e){if(e.nodeModel){let n=this.getColumnOrGroup(e.columnID);var t=e.nodeModel.getReferenceValue(n.dataIndex);return i=!1,"boolean"==typeof(o=t)?i=o:"string"==typeof o?i="true"===o.toLowerCase():void 0===o&&(i=void 0),t=i}var o,i}),o},r.prototype.buildColumnsFromStorage=function(t){var o=this;return new Promise(function(i,n){var s=[],r=0;t=function(e){for(var t=[],o=!1,i=0;i<e.length;i++)"instanceName"===e[i].dataIndex?e[i].dataIndex="ds6w:label-Instance":"instanceMatrix"===e[i].dataIndex&&(e[i].dataIndex="positionMatrix-Instance"),"findinctx"===e[i].dataIndex&&(o=!0),t.push(e[i]);return!1===o&&t.push({dataIndex:"findinctx",alignment:"center",typeRepresentation:"findInCtx",width:40,minWidth:40,maxWidth:40,hasNLS:!1,noTitleColumn:!0,pinned:"right",kind:"functionIcon",visibleFlag:!1,getCellSemantics:function(e){return!0===e.nodeModel.isRelationsObjectNode?null:{}},customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}}),t}(t),e.updateAttributesWithKind(void 0,t).then(function(t){e.updateAttributesWithKind().then(function(){var n=[];for(r=0;r<t.length;r++)n.push(new Promise(function(i){var n=t[r].dataIndex;e.addAvailableColumn(n,t[r]).then(function(e){var t=null;e.ds6w&&o.options.columnViews[e.ds6w]?t=o.options.columnViews[e.ds6w].AMD[e.ds6w].buildColumn(e):e.dataIndex&&o.options.columnViews[e.dataIndex]&&(t=o.options.columnViews[e.dataIndex].AMD[e.dataIndex].buildColumn(e)),null===t&&(t=o.buildColumnFromSetting(e)),t&&s.push(t),i()})}));Promise.all(n).then(function(){var e=UWA.clone(s);i(e)})})})})},r.prototype.getTypeRepresentations=function(){return JSON.stringify(this.options.typeRepresentations)},r.prototype._exportAsCmd=function(e){if("csv"===e.exportAs){var o=this.getColumnsForExport(),i=this.options.dgv.getAsCSV({columnKeys:o,addLevelInformation:!0});t.downloadfile(i,t.getAppId()+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")}else this.options.dgv.openPrintableViewWindow(!0)},r.prototype.__addFilterModel=function(e){return new Promise(t=>{this.options.filterModel={};for(const t of e.columns){const e=this.options.columnsDefaultfilterDefinition;!0!==t.neverVisible&&!0!==t.isAdditionalColumn&&-1===e.excluded.indexOf(t.dataIndex)&&(-1!==e.set.indexOf(t.dataIndex)?(this.options.filterModel[t.dataIndex]={filterId:"set"},-1!==e.keyWithTranslation.indexOf(t.dataIndex)&&s(t)):"tree"===t.dataIndex?this.options.filterModel.label={filterId:"stringRegexp",filterModel:{}}:"string"===t.typeRepresentation?this.options.filterModel[t.dataIndex]={filterId:"stringRegexp",filterModel:{}}:"boolean"===t.typeRepresentation&&(this.options.filterModel[t.dataIndex]={filterId:"set"}))}t()})},r}),define("DS/ENXNav/commands/view/_xNavExpandAll",["DS/PADUtils/Utility","DS/PADUtils/PADSettingsMgt","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o){"use strict";return{execute:function(t){var i,n=t.model.getSelectedNodes().filter(function(e){return e.isVisible()}).sort(function(e,t){return e._getRowID()>t._getRowID()}),s=[];let r=n.filter(function(e){return e.getChildren()}),a=r.map(function(e){return e.getRoot()}).filter(function(e,t,o){return o.indexOf(e)===t});i=a;var l=function(){let i=5;s.length>2e3&&(i=1e3);var n,r,a,l=function(e,t){for(var o=[],i=e.length,n=i-1,s=[],r=0;r<i;r++)s.push(e[r]),0===r||(r+1)%t!=0&&r!==n||(o.push(s),s=[]);return o}(s,i);n=t.model,t.xnav_app,(r=l).length,o.loadingText,(a=e.createStepper(r,n,function(e,t){t.expandMultiSelect({nodes2Expand:e,expandAll:!0,tagger:!1,callback:function(){a()}})},function(){n.notifyTagger()}))()};(s=r).length>1?require(["DS/ENXNav/views/private/ExpandChecker"],function(e){var t=document.getElementsByClassName("enx-appMainBody");t&&1===t.length?(t=t[0],e.check({targetDiv:t,roots:i}).then(function(e){!0===e.performExpandAll&&l()})):l()}):1===s.length&&s[0].expandAll()}}}),define("DS/ENXNav/views/xNavResponsiveThumbnailsView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/ApplicationFrame/CommandsManager"],function(e,t,o,i,n,s){"use strict";return e.extend(o,i,{name:"xNavResponsiveThumbnailView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0),o=this.options.grid=new n(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),this._originalApplyAttributes=o._applyAttributesOnCell.bind(o),o._applyAttributesOnCell=this._applyAttributesOnCell.bind(this),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){s.getCommand("Copy").begin()}),o.onCellsPaste(function(e){s.getCommand("Paste").begin()}),o.onCellsCut(function(e){s.getCommand("Cut").begin()}),UWA.is(o.onCellsEscape,"function")&&o.onCellsEscape(function(e){s.getCommand("Uncut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})},_applyAttributesOnCell:function(e){var t=e;void 0===e.nodeModel&&(t.nodeModel=this.options.grid._getModelAt(e.cellID),t.cellView=this.options.grid._getViewAt(e.cellID)),t.nodeModel.options.isBeingCut?t.cellView.getContent().addClassName("pad-state-is-being-cut"):t.cellView.getContent().removeClassName("pad-state-is-being-cut"),this._originalApplyAttributes(e)}})}),define("DS/ENXNav/utils/xNavKindProcessor",["UWA/Class"],function(e){return e.singleton({loadKinds:function(e,t,o,i,n){t.authorizedWithKind?(t.authorizedWithKind.Product&&t.authorizedWithKind.Product.length>0&&e.add({content:"3DXContent",authorized_objects:t.authorizedWithKind.Product,callback:n,behavior:o,initLoad:!0}),t.authorizedWithKind.Filter&&t.authorizedWithKind.Filter.length>0&&e.addFilter({content:"3DXContent",filter_objects:t.authorizedWithKind.Filter,callback:n,behavior:o,initLoad:!0}),t.authorizedWithKind.Change&&t.authorizedWithKind.Change.length>0&&e.loadChangeV2&&e.loadChangeV2({content:"3DXContent",objects:t.authorizedWithKind.Change,callback:n,behavior:o,initLoad:!0})):e.add({content:"3DXContent",authorized_objects:t.authorized_objects,behavior:o,kindProcessor:!0})}})}),define("DS/ENXNav/commands/RemoveGroupColor",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/RemoveGroupColor",data:{}})}})}),define("DS/ENXNav/commands/view/_xNavSelectSiblings",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[],n=[];for(let e=0;e<o.length;e++){let t=o[e],s=t.getParent();if(i.includes(s))continue;i.push(s);let r=(s.hasChildren()?s.getChildren():[]).filter(e=>e!==t);n.push(...r)}t.multiselect(n),t.pushUpdate(),t.pushBroadcastSelect()}}}),define("DS/ENXNav/views/private/externalColumnsViews/cadMaster",["DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeNodeModel"],function(e,t){"use strict";const o=new Map,i=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE","EPLAN","SURPAC","CADENCEPULSE","XPEDITIONEDM","ZUKENDSCR","ICAD","SUPPLEMENTAL"];for(var n=0;n<i.length;n++)o.set(i[n],e.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+i[n]+".png"));return{"ds6w:cadMaster":{getCellTooltip:function(e,t){let o;return o=-1===e.rowID?t.getCellDefaultTooltip(e):{shortHelp:e.nodeModel.getReferenceValue("ds6w:cadMaster"),updateModel:!1}},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:cadMaster",kind:"image",width:40,minWidth:40,editableFlag:!1,typeRepresentation:"image",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(e){var i;if(!0!==e.isHeader&&e&&e.nodeModel&&e.nodeModel.options.grid)return e.nodeModel.options.grid["ds6w:cadMaster"]?i=o.get(e.nodeModel.options.grid["ds6w:cadMaster"]):e.nodeModel.isRelationsObjectNode||e.nodeModel.getNodeSource()===t.NODE_SOURCE.GROUPING||(i=o.get("3DEXPERIENCE")),i?{iconPath:i,iconSize:{height:"22px"}}:""},getCellValueForExport:function(e){if(-1===e.rowID)return null;var t="";return e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid["ds6w:cadMaster"]&&(t=e.nodeModel.options.grid["ds6w:cadMaster"]),t}},e)}}}}),define("DS/ENXNav/views/xNavInitError",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,o,i,n){"use strict";return i.extend(n,{name:"pad_bigerror",init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"pad_error_all"}),this.elements.errormsg=UWA.createElement("span",{class:"pad_error_msg"}),this.elements.errormsg.innerHTML=e.msg,this.elements.errormsg.inject(this.elements.container)}})}),define("DS/ENXNav/mixins/EventHooks",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/views/PADProgressBar","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o,i,n){function s(e){var o=t.getCommand("ExpandAll");o&&(e?o.enable():o.disable())}return e.extend({setupEventHooks:function(e){let t=this;o.subscribe({event:"ENXNav/parser/expandAll/begin"},function(){s(!1),t.beginBlockingTransaction(n.expand.expandPending)}),o.subscribe({event:"ENXNav/parser/expandAll/complete"},function(){s(!0),t.endBlockingTransaction()}),o.subscribe({event:"ENXModel/refresh/begin"},function(){t.beginBlockingTransaction(n.refresh_ongoing)}),o.subscribe({event:"ENXModel/refresh/complete"},function(e){t.endBlockingTransaction(),e&&e.skipSyncModel||setTimeout(function(){o.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})},100)}),o.subscribe({event:"ENXModel/Model/ApplyGrouping"},function(e){(e.fromGroupingEvent||e.fromApplyFilter||e.fromLayoutChange)&&e.groups.length&&t.beginBlockingTransaction(n.groupingNode.applyGrouping)}),o.subscribe({event:"ENXModel/Model/ApplyGrouping/Done"},function(e){e.fromEvent&&t.endBlockingTransaction()}),o.subscribe({event:"ENXModel/Model/ApplyGrouping/Active"},function(e){t.options.groupingActivated=e.active})}})}),define("DS/ENXNav/commands/CmdUtils",["DS/PADUtils/PADContext","DS/ApplicationFrame/CommandsManager","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/etree/syncwidget"],function(e,t,o,i,n){"use strict";function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this.context=e.get(),this.model=this.context.options.model,this.availabilities={managedCommands:[],selection:{sensitiveToselection:[],monoselection:[],onlyRoot:[],atleastonehidden:[],atleastonevisible:[],lessExpandedThumbs:[],moreExpandedThumbs:[]},notInView:{sensitiveToView:[],dgv:[],graph:[],thumbs:[],tiles:[]},noGrp:[],onlyInCtxMenu:[]},this.model.getXSO().onPostAdd(this._checkCommands.bind(this)),this.model.getXSO().onPostRemove(this._checkCommands.bind(this)),this.model.getXSO().onEmpty(this._checkCommands.bind(this)),o.subscribe({event:"ENXModel/HideShowTriggered"},this._checkCommands.bind(this)),o.subscribe({event:"ENXModel/Model/ApplyGrouping/Active"},this._checkCommands.bind(this)),o.subscribe({event:"ENXNav/UpdateCmdAvailability"},this._checkCommands.bind(this)),this.context.addEvent("onToggleView",this._checkCommands.bind(this)),this)}return s.prototype.checkAvailability=function(){this._checkCommands()},s.prototype.selectionMgt=function(e,t){-1===this.availabilities.managedCommands.indexOf(e)&&this.availabilities.managedCommands.push(e),this.availabilities.selection.sensitiveToselection.push(e),!0===(t=t||{}).monoselection&&this.availabilities.selection.monoselection.push(e),!0===t.onlyRoot&&this.availabilities.selection.onlyRoot.push(e),!0===t.atleastonehidden&&this.availabilities.selection.atleastonehidden.push(e),!0===t.atleastonevisible&&this.availabilities.selection.atleastonevisible.push(e),!0===t.lessExpanded&&this.availabilities.selection.lessExpandedThumbs.push(e),!0===t.moreExpanded&&this.availabilities.selection.moreExpandedThumbs.push(e),!0===t.noGrp&&this.availabilities.noGrp.push(e)},s.prototype.viewMgt=function(e,t){-1===this.availabilities.managedCommands.indexOf(e)&&this.availabilities.managedCommands.push(e),this.availabilities.notInView.sensitiveToView.push(e),!0===(t=t||{}).nodgv&&this.availabilities.notInView.dgv.push(e),!0===t.nograph&&this.availabilities.notInView.graph.push(e),!0===t.nothumbs&&this.availabilities.notInView.thumbs.push(e),!0===t.notiles&&this.availabilities.notInView.tiles.push(e)},s.prototype._checkCommands=function(){for(var e=this.model.getXSO().get(),o=!0,n=!0,s=!0,r=!0,a=0;a<e.length;a++){var l=!!e[a].options.isPADHidden;e[a].isRoot()||(o=e[a].isRoot()),l?s=!1:n=!1,i.isFakeTreeNodeModel(e[a])&&(r=!1)}var d=this.context.getCurrentView();for(a=0;a<this.availabilities.managedCommands.length;a++){var c=this.availabilities.managedCommands[a],p=t.getCommand(c,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);p&&this._checkCmdView(c,p,d,o,n,s,r,e.length,e)}},s.prototype._checkCmdView=function(e,t,o,i,n,s,r,a,l){if(-1!==this.availabilities.notInView.sensitiveToView.indexOf(e))switch(o){case"datagridview":-1===this.availabilities.notInView.dgv.indexOf(e)?this._checkCmdSelection(e,t,i,n,s,r,a,l):t.disable();break;case"graphview":-1===this.availabilities.notInView.graph.indexOf(e)?-1!==this.availabilities.selection.lessExpandedThumbs.indexOf(e)||-1!==this.availabilities.selection.moreExpandedThumbs.indexOf(e)?this._checkCmdThumb(e,t,i,n,s,r,a,l):this._checkCmdSelection(e,t,i,n,s,r,a,l):t.disable();break;case"thumbnailview":-1===this.availabilities.notInView.thumbs.indexOf(e)?this._checkCmdSelection(e,t,i,n,s,r,a,l):t.disable();break;case"tileview":-1===this.availabilities.notInView.tiles.indexOf(e)?this._checkCmdSelection(e,t,i,n,s,r,a,l):t.disable()}else this._checkCmdSelection(e,t,i,n,s,r,a,l)},s.prototype._checkCmdThumb=function(e,t,o,i,s,r,a,l){l=this.model.getXSO().get();var d=function(e,t){for(var o=t.length,i=0,s=0,r=0;r<o;r++){var a=t[r];e.getThumbnailState(a)===n.ThumbnailState.EXPANDED?i++:s++}return i>s}(this.context.options.views.graphview,l);-1===this.availabilities.selection.lessExpandedThumbs.indexOf(e)?d?t.disable():this._checkCmdSelection(e,t,o,i,s,r,a,l):-1===this.availabilities.selection.moreExpandedThumbs.indexOf(e)&&(d?this._checkCmdSelection(e,t,o,i,s,r,a,l):t.disable())},s.prototype._checkCmdSelection=function(e,t,o,i,n,s,r,a){if(-1!==this.availabilities.selection.sensitiveToselection.indexOf(e))if(-1!==this.availabilities.noGrp.indexOf(e)&&(this.model.isGroupingApplied()&&r>1||a[0]&&!0===a[0].getReferenceValue("groupApplied")||!1===s))t.disable();else if(r)if(!1===o&&-1!==this.availabilities.selection.onlyRoot.indexOf(e))t.disable();else{var l=!0;-1!==this.availabilities.selection.atleastonevisible.indexOf(e)&&(l=!1,!1===i?this._checkCmdVisibility(e,t,i,n):t.disable()),-1!==this.availabilities.selection.atleastonehidden.indexOf(e)&&(l=!1,!1===n?this._checkCmdVisibility(e,t,i,n):t.disable()),l&&(1===r?this._checkCmdVisibility(e,t,i,n):-1===this.availabilities.selection.monoselection.indexOf(e)?this._checkCmdVisibility(e,t,i,n):t.disable())}else t.disable();else this._checkCmdVisibility(e,t,i,n)},s.prototype._checkCmdVisibility=function(e,t,o,i){var n=!0;-1!==this.availabilities.selection.atleastonevisible.indexOf(e)&&(n=!1,!1===o?t.enable():t.disable()),-1!==this.availabilities.selection.atleastonehidden.indexOf(e)&&(n=!1,!1===i?t.enable():t.disable()),n&&t.enable()},new s}),define("DS/ENXNav/commands/_xNavSwitchView",[],function(){"use strict";return{execute:function(e){e.xnav_app.toggleView(e.command_id)}}}),define("DS/ENXNav/commands/view/_xNavSelectChildren",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();let i=o.filter(e=>e.hasChildren()).map(e=>e.getAllDescendants()).flat().concat(o);t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()}}}),define("DS/ENXNav/utils/OpenWithMenuBuilder",["DS/i3DXCompassPlatformServices/OpenWith","UWA/Promise","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/PADTrackerManager"],function(e,t,o,i){function n(){}var s;return n.prototype={openWithApps:function(n,s){return new t(function(t,r){o.contentOpenWith(n,function(o){var n=new e;n.set3DXContent(o,!0),UWA.is(n.retrieveCompatibleApps,"function")?n.retrieveCompatibleApps(function(e){var o=[],n=[];if(e.forEach(function(e){n.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:function(){var t=i.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});t?(t.setEventData({eventLabel:"Ctx-openWith-"+e.name}),t.trackPageEvent()):console.warn("tracker not defined"),e.handler()}}})}),n.length>0){var r={type:"PushItem",icon:s.iconOpenWith,title:s.nlsOpenWith,submenu:n};o.push(r),o.push({type:"SeparatorItem"})}t(o)}):t([])})})}},s||(s=new n),s}),define("DS/ENXNav/commands/GroupsLayoutPath",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/GroupsLayout",data:{mode:"structured"}})}})}),define("DS/ENXNav/utils/TwoDAppEvents",["DS/PADServices/utils/GlobalModelEvents"],function(e){const t="ENX2DApp/Model/Expand",o="ENX2DApp/Model/addRoot",i="ENX2DApp/Model/addChild",n="ENX2DApp/Model/removeRoot",s="ENX2DApp/Model/bsd/apply",r="ENX2DApp/Model/bsd/apply/fail",a="ENX2DApp/View/clearSort",l="ENX2DApp/View/refresh",d="ENXViews/WelcomePanel/closeLandingPage";function c(){}let p;return c.prototype={expand:function(o){e.publish({event:t,data:o})},addRoot:function(t){e.publish({event:o,data:t})},addChild:function(t){e.publish({event:i,data:t})},removeRoot:function(t){e.publish({event:n,data:t})},clearSort:function(t){e.publish({event:a,data:t})},refresh:function(t){e.publish({event:l,data:t})},bsdApply:function(t){e.publish({event:s,data:t})},bsdFail:function(t){e.publish({event:r,data:t})},onClearSort:function(t){e.subscribe({event:a},t)},onExpand:function(o){e.subscribe({event:t},o)},onAddRoot:function(t){e.subscribe({event:o},t)},onAddChild:function(t){e.subscribe({event:i},t)},onRemoveRoot:function(t){e.subscribe({event:n},t)},onRefresh:function(t){e.subscribe({event:l},t)},onLandingPageClosed:function(t){e.subscribe({event:d},t)},onBsdApply:function(t){e.subscribe({event:s},t)},onBsdFail:function(t){e.subscribe({event:r},t)}},p||(p=new c),p}),define("DS/ENXNav/commands/ColorizeGroup",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/ColorizeGroup",data:{}})}})}),define("DS/ENXNav/utils/OFW",["UWA/Core","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/settings/AppSettings","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser"],function(e,t,o,i,n,s,r,a){const l={version:"2.2",results:[],structures:[],viewpoint:[]},d="resetTypes",c="setTypes",p="setTypesCallback",u="setObject",h="launchApp",g="launchAppCallback";var f,v=!1;var m,D=0;function b(e,t,o){let i=e.search({match:function(e){let i=e.nodeModel.options;return o?i.relationid===t:i.resourceid===t},shouldStop:function(){return!1},useTransaction:!1});if(i.length)return i[0]}function S(e,o,i,n,s,r){D++,n.id=""+D;let a=!1,l=!0,d=n.resourceid;if(n.isInstance){d=n.relationid;let e=b(i,d,!0);e&&(r.isFinderApp&&(a=e.isSelected()),l=!e.options.isPADHidden)}else{let e=b(i,d,!1);e&&(a=e.isSelected(),l=!e.options.isPADHidden)}var c={id:n.id,phid:d,CADOrigin:n.grid["ds6w:cadMaster"]?n.grid["ds6w:cadMaster"]:n.grid["ds6w:cadmaster"]},p={id:n.id,show:l,select:a,children:[]};if(s)o.results.push(c),s.children.push(p);else{o.results.push(c);var u={structure:[p]};o.structures.push(u)}n.children&&t.iterate(n.children,function(t){S(e,o,i,t,p,r)})}function _(e,t,o,i){D++,e.id=""+D;let n=e.resourceid;var s={id:e.id,phid:n,CADOrigin:"3DEXPERIENCE"};let r=t.getNodeByOccurencePath(o);if(!r&&i){let e=t.getNodesById(o[0]);for(let t=0;t<e.length&&!r;t++)!0===e[t].isRelationsObjectNode&&(r=e[t])}let a=!1,l=!0;if(r){(function(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var i=0;i<o;i++)if(e[i]!==t[i])return!1;return!0}return!1}return!1}(r.getOccurencePath(),o)||i)&&(s.CADOrigin=r.options.grid["ds6w:cadMaster"],e.isEndOfPath&&(a=r.isSelected()),l=!r.options.isPADHidden)}return{entry:s,struct:{id:e.id,show:l,select:a,children:[]}}}function x(){}return x.prototype={setTypesForOFW:function(e){if(!v){var t=this;s.subscribe(p,function(i){if(i.widgetId===o.getWidgetId()){var n=e.getSelectedNodesForOFW();if(n.length){var r;try{var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");r=a.get()}catch(e){console.warn("CfgAuthoringContext throw an error")}var p,u=e.options.context;if(u&&u.options.isDeEnabled&&u.hasActiveDesignExp()){l&&l.version&&(l.version="2.5");var g={phid:u.getActiveDesignExp().getID()}}if("ENOUC5C_AP"===i.appId&&1===n.length&&n[0].relatedCADDocs&&(p=n[0].relatedCADDocs.getSelectedNodes()),!t._checkDirectOpen(i,n,p,r)){let o=Promise.resolve();if("function"==typeof e.isGroupingApplied&&e.isGroupingApplied()){let t=[];for(let e=0;e<n.length;e++)!0===n[e].isGroupingNode&&t.push(n[e]);t.length&&(o=new Promise(t=>{e.focusOnGroups().then(()=>{let o=e.getSelectedNodesForOFW();n=[];for(let e=0;e<o.length;e++)!0!==o[e].isGroupingNode&&n.push(o[e]);t()})}))}o.then(function(){var o="SWXCSWK_AP"!==i.appId&&"ENOUSWC_AP"!==i.appId;let a="ENOPRFI_AP"===i.appId||"ENOMAFI_AP"===i.appId||"ENOSYFI_AP"===i.appId;t.buildDataForSetTypes(n,e,o,{isFinderApp:a}).then(function(o){e._getLastViewpoint(function(n){if(n.success&&o.viewpoint.push(n.viewpoint),r&&(o.workUnder=r),u&&u.options.isDeEnabled&&g&&(o.designExp=g),"function"==typeof e.isGroupingApplied&&e.isGroupingApplied()){let t=e.getGroupingForOpen();e.isOccModel?(o.grouping=t.grouping,o.organize=t.organize):o.grouping=t}p&&t._appendCADDocs(o,p);var a=JSON.stringify(o),l={appId:i.appId,widgetId:i.widgetId,fileName:"-file",fileContent:a};s.publish(h,l)})})})}}else{s.publish(d);var v={appId:i.appId,widgetId:i.widgetId};s.publish(h,v,function(e){s.publish(c,f)})}}}),v=!0}f||(f={widgetId:o.getWidgetId()}),s.publish(c,f)},buildDataForSetTypes:function(o,i,n,s){n=void 0===n||n,s=void 0===s?{}:s;var d=e.clone(l);return new Promise(function(e,l){let c={};if(t.iterate(o,function(e){var t=e.getRoot().getID();c[t]||(c[t]={paths:[],isFiltered:!1}),!0===e.isRelationsObjectNode?(c[e.options.resourceid]||(c[e.options.resourceid]={paths:[],isFiltered:!1}),c[e.options.resourceid].paths.push([e.options.resourceid]),c[e.options.resourceid].isRelationsObjectNode=!0,n=!1):c[t].paths.push(e.getOccurencePath())}),n){var p=[];let t=Object.keys(c);t=function(e,t){if(e.length>1){let o=t.map(function(e){return e.getID()}),i=o.slice();return e.length<o.length&&(i=i.filter(function(t){return e.includes(t)})),i}return e}(t,i.getRoots());for(var u=0;u<t.length;u++)p=p.concat(c[t[u]].paths);D=0,(h=p,g=t,f=i,new Promise(function(e,t){let o=Promise.resolve();void 0===r.expandv2&&(o=r.initialize({addDefaults:!0})),o.then(()=>{if(void 0===f.options.FBIProxy)return void console.log("OFW: Missing parameter FBIProxy on the given treedocument");let o={pathIds:h,data:{expandLevel:"-1"},FBIProxy:f.options.FBIProxy,timeout:3e4};("function"==typeof f._getExpandFunc?f._getExpandFunc(f._getAuthoringFlag()):r.expandv2.bind(r))(o).then(function(t){let o="string"==typeof t?JSON.parse(t):t;a.ofwPrep({wsResponse:o,expandLevel:-1,rootIds:g}).then(function(t){e(t)})}).catch(t)})})).then(function(t){for(let e=0;e<t.length;e++)S(o,d,i,t[e],void 0,s);e(d)})}else{let o={};t.iterateObj(c,function(e,n){let s,r=e.paths,a=e.isRelationsObjectNode,l=[];t.iterate(r,function(e){let n=e.length-1;s=null,t.iterate(e,function(t,r){let c=o[t];void 0===c&&(c=_({resourceid:t,isEndOfPath:r===n},i,e,a),d.results.push(c.entry),o[t]=c);let p=e.slice(0,r+1).join("|");-1===l.indexOf(p)&&(s?s.children.push(c.struct):d.structures.push({structure:[c.struct]}),l.push(p)),s=c.struct})})}),e(d)}var h,g,f})},_checkDirectOpen:function(t,r,a,l){if((!a||0===a.length)&&"ENOUC5C_AP"===t.appId&&1===r.length&&r[0].isRoot()&&!r[0].options.filtered&&(!e.is(l)||""===l.change.id)&&!0===n.getSetting("directOpenPCS")){var d={objectId:r[0].getID(),envId:i.getPlatformId(),contextId:o.getSecurityContext(),serviceId:"3DSpace"};s.publish(u,d),s.subscribe(g,function(e){e.appId===t.appId&&e.widgetId===t.widgetId&&s.publish(u,{objectId:"",envId:i.getPlatformId(),contextId:"",serviceId:"3DSpace"})});var p={appId:t.appId,widgetId:t.widgetId};return s.publish(h,p,function(e){s.publish(c,f)}),!0}return!1},_appendCADDocs:function(e,t){let o,i,n;for(i=(new Date).valueOf(),o=0;o<t.length;o++)"XCADNonPSBaseRepReference"!==t[o].options.type&&"Drawing"!==t[o].options.type||(i++,n=""+t[o].options.physicalid,e.results.push({id:""+i,phid:n}),e.structures.push({structure:[]}),e.structures[e.structures.length-1].structure.push({id:""+i,show:!0,select:!1,children:[]}))}},m||(m=new x),m}),define("DS/ENXNav/utils/xNavCustoStorageOptim",["UWA/Core","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var o={dataIndex:void 0,text:void 0,isDraggable:!0,width:150,minWidth:10,maxWidth:999,visibleFlag:!0,isHidden:!1,isSortable:void 0,type:void 0,isAdditionalColumn:void 0,xnav_options:{name:void 0,dataIndex:void 0,tree:void 0,hardcoded:void 0,exportable:{lock:!1,value:!0},layout:{removable:void 0,hidden:void 0,width:150,minWidth:void 0,maxWidth:void 0},kind:void 0}},i={dataIndex:void 0,text:void 0,isDraggable:!0,width:150,minWidth:10,maxWidth:999,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,kind:void 0,isAdditionalColumn:void 0,customisation:{layout:{width:200,minWidth:100,maxWidth:300,removable:!0,pinEditable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};function n(e,t){var o={};if(void 0===t)o=e;else for(var i=Object.getOwnPropertyNames(e),s=0;s<i.length;s++)if(UWA.is(e[i[s]],"object")){var r=n(e[i[s]],t[i[s]]);Object.getOwnPropertyNames(r).length>0&&(o[i[s]]=r)}else e[i[s]]!==t[i[s]]&&"text"!==i[s]&&"label"!==i[s]&&(o[i[s]]=e[i[s]]);return o}function s(e,t,o){var i={};if(void 0===e)i=t;else{for(var n=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e),a=0;a<n.length;a++)if(UWA.is(t[n[a]],"object")){if("bi_color"!==o){var l=s(e[n[a]],t[n[a]],o);Object.getOwnPropertyNames(l).length>0&&(i[n[a]]=l)}}else void 0===e[n[a]]?i[n[a]]=t[n[a]]:i[n[a]]=e[n[a]];for(var d=0;d<r.length;d++)void 0===i[r[d]]&&(i[r[d]]=e[r[d]])}return i}return{convertCusto4Preference:function(e,s,r){var a={custoOptimized:!0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:t.getSetting("lang")};"treelistview"===r?a.custoFromTree=!0:"datagridview"===r&&(a.custoFromDGV=!0);for(var l=0;l<e.columns.length;l++){var d=e.columns[l],c=o;if("datagridview"===r&&(c=i),"ContextualMenuColumn"!==d.dataIndex){var p=n(d,c);s&&s[d.dataIndex]&&(p.text=d.text),a.columnsOptimized.push(p)}else a.ctxMenuColumn={pinned:d.pinned,columnIdx:d.columnIdx,visibleFlag:d.visibleFlag}}return a},convertPreference2Custo:function(n,r){var a={viewMode:n.viewMode,defaultCellHeight:n.defaultCellHeight,rowsHeader:n.rowsHeader,selectedTypes:n.selectedTypes,selectedExtensions:n.selectedExtensions,columns:[],ctxMenuColumn:n.ctxMenuColumn};n.custoFromTree||"treelistview"===r?a.custoFromTree=!0:"datagridview"===r&&(a.custoFromDGV=!0),n.lang&&n.lang!==t.getSetting("lang")&&function(e){for(var t=0;t<e.columnsOptimized.length;t++){var o=e.columnsOptimized[t];o.xnav_options&&o.xnav_options.titleModified&&(delete o.text,delete o.xnav_options.titleModified)}}(n);for(var l=0;l<n.columnsOptimized.length;l++){var d=n.columnsOptimized[l],c=o;"datagridview"===r&&(c=i);var p=s(d,e.clone(c),d.dataIndex);p.typeRepresentation&&p.typeRepresentation.startsWith("enum")&&delete p.typeRepresentation,a.columns.push(p)}let u=a.columns.map(function(e){return e.dataIndex});if(u.filter(function(e,t,o){return o.indexOf(e)===t}).length!==u.length){let e={},t=a.columns.reduce(function(t,o){let i=o.dataIndex;return e[i]||(e[i]=!0,t=t.concat(o)),t},[]);a.columns=t}return a}}}),define("DS/ENXNav/commands/view/_xNavRootInfoPanel",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,i){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=o.get(),this._change_state_from_close=!1;var t=this;t._context.elements.padshell&&t._context.elements.padshell._modelEvents&&t.addCallback(),t=this,this.onStateChange(function(){t._change_state_from_close?t._change_state_from_close=!1:t._context.togglePanel("left")})},addCallback:function(){var e=this;!1===this._callbackAdd&&(this._context.elements.padshell._modelEvents.subscribe({event:"triptych-hide-panel"},function(t){"left"===t&&(e._change_state_from_close=!0,e.setState(!1,!1))}),i.subscribe({event:"ENXViews/Triptych/onOverlayClick"},function(t){t&&"left"===t&&!0===e.getState()&&(e._change_state_from_close=!0,e.toggleState(!1,!1))}),e._callbackAdd=!0)}})}),define("DS/ENXNav/commands/tools/_xNavRelationIPExplorer",[],function(){"use strict";return{execute:function(e){require(["DS/PADUtils/PADUtilsServices","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(t,o){let i=e.xnav_app.options.model.getSelectedNodes().filter(function(e){return!("function"==typeof e.getNodeSource&&1===e.getNodeSource())});t.setObject_on_compass({nodes_2_open:i}),t.launchApp({appId:"ENORIPE_AP",widgetId:t.getWidgetId()})})}}}),define("DS/ENXNav/commands/view/_xNavCleanAll",[],function(){"use strict";return{execute:function(e){e.xnav_app.empty()}}}),define("DS/ENXNav/mixins/DesignExpLeftSidePanel",["DS/PADServices/utils/GlobalModelEvents"],function(e){function t(){}return t.prototype={createRootListSlidder2:function(){let t=this._parent();var o=this,i=this.leftsidepanel.elements;return e.subscribe({event:"ENXModel/DesignEnv/add"},function(t){require(["DS/DesignEnvironmentUX/DesignEnvironment"],function(n){if(void 0===i.designenvpanel){new n({designEnvCtx:t.designEnv,globalModelEvent:e,pseModel:t.pseModel,isReadOnlyInWeb:t.isReadOnlyInWeb,modelEvent:e.getModelEvents()});e.subscribeOnce({event:"ENXModel/DesignEnv/leftSidePanel/loadTab"},function(e){i.designenvpanel=e.designenvpanel,s(),i.rootLst.setVisible(!1)})}else{o.wasDETabCreated=!0,i.leftsidetabbar._historySelection.find(e=>"designenv"==e.value)||s(),r()}function s(){let e=require("DS/WebappsUtils/WebappsUtils").getWebappsAssetUrl("DesignEnvironmentUX","icons/32/I_Design-Experience_Font-Icon_32x32.png");o.leftsidepanel.addTab({label:i.designenvpanel.getTabLabel(),key:"designenv",isSelected:!0,icon:e,container:i.designenvpanel,content:i.designenvpanel.getDEContainer()})}function r(){i.designenvpanel.options.isDeEnabled=!(!self||!self.widget)&&self.widget.isDeEnabled,i.designenvpanel.options.is3dExcite=!(!self||!self.widget)&&self.widget.is3dExcite,i.designenvpanel.addDesignEnv(t.designEnv).then(function(o){t.resolve&&t.resolve(o),i.leftsidetabbar.getButtonFromValue("designenv").checkFlag=!0,e.publish({event:"ENXModel/DesignEnv/added"}),i.leftsidetabbar._setTabVisibility("designenv",!0)})}e.subscribeOnce({event:"ENXModel/DesignEnv/leftSidePanel/content"},r)})}),e.subscribe({event:"ENXModel/DesignEnv/removeColumn"},function(){i.designenvpanel&&i.designenvpanel.core.pseCommonService.addOrRemoveEvents("remove")}),e.subscribe({event:"ENXModel/DesignEnv/close"},function(t){i.leftsidetabbar._setTabVisibility("designenv",!1),i.designenvpanel.core.pseCommonService.removeItemsOnPreference(!0),i.designenvpanel.core.pseCommonService.addOrRemoveEvents("remove"),e.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:[t.designExp.getID()],fromWLSync:!1}}),e.publish({event:"ENXModel/ReadWriteTriggered",data:!1}),i.designenvpanel.core.contextManager.removeActiveDesignExp()}),t}},t}),define("DS/ENXNav/views/customize_views/commands",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/HideShowController","DS/PADServices/views/ENXModal","DS/Controls/Button","DS/Utilities/Dom","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/HideShowCtrl","DS/PADServices/settings/AppSettings"],function(e,t,o,i,n,s,r,a,l){"use strict";var d=o;return"true"!==r.getURLParameter("explorerOcc")&&!0!==l.getSetting("explorerOcc")||(d=a),{getTypeRepresentation:function(){return{findInCtx:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"find dgv-find",fontIconFamily:1}}}}},hide_show:{getCellTooltip:function(e,o){let i={shortHelp:t.columnsDef.hide_show,updateModel:!1};return i=-1!==e.rowID?d.determineTooltip(e.nodeModel,t):o.getCellDefaultTooltip(e)},buildColumn:function(e){return Object.assign({dataIndex:"hide_show",kind:"functionIcon",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",customisation:{exportable:{lock:!0,value:!1}},getCellSemantics:function(e){return d.determineIcon(e.nodeModel)}},e)},actionOnClick:function(e,t){var o=e.nodeModel;void 0!==o.options.isPADHidden&&!0===o.options.isPADHidden||o.options.isHiddenState===d.STATES.HIDDEN?t.onShow({paths:[o.getOccurencePath()],fromUI:!0}):t.onHide({paths:[o.getOccurencePath()],fromUI:!0})}},findinctx:{getCellTooltip:function(e,o){let i={shortHelp:t.columnsDef.find,updateModel:!1};return-1===e.rowID&&(i=o.getCellDefaultTooltip(e)),i},buildColumn:function(e){return Object.assign({dataIndex:"findinctx",kind:"findInCtx",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"findInCtx",alignment:"center",customisation:{exportable:{lock:!0,value:!1}}},e)},actionOnClick:function(e,t){require(["DS/ApplicationFrame/CommandsManager"],function(t){var o=e.cellView.getContent().getBoundingClientRect(),i=t.getCommand("FindCmd",null);i&&(o&&(i.options.position=o),i.options.fromCtx=!0,i.begin())})}},thumbnail:{getCellTooltip:function(e){let o=null;return o=-1===e.rowID?{shortHelp:t.columnsDef.thumbnail,updateModel:!1}:{title:t.columnsDef.thumbnail,shortHelpImage:e.nodeModel.getReferenceValue("thumbnail"),shortHelpImageDimension:{x:120,y:100}}},buildColumn:function(e){return Object.assign(e,{dataIndex:"thumbnail",kind:"image",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"image",alignment:"center",hasNLS:!1,noTitleColumn:!0,customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}})},actionOnClick:function(e,o){if(e.nodeModel){let o=e.nodeModel.getReferenceValue("thumbnail");if(void 0!==o){let a=s.createElement("div",{class:"enx-thumbnail-pop-up"});a.style.backgroundImage="url('"+o+"')";let l=document.querySelector(".enx-appMainBody"),d=e.cellView.getContent().getBoundingClientRect(),c={of:l,my:"top left",at:"top left",offsetX:d.x,offsetY:d.y};var r=new i({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.columnsDef.thumbnail,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:a,position:c,buttons:{Close:new n({onClick:function(){r.close()}})},events:{onClickOutsideContent:function(){r.close()}}})}}}}}}),define("DS/ENXNav/models/SmartNodeOptions",["DS/PADServices/utils/Iterator","DS/PADServices/utils/NlsCache"],function(e,t){const o=["label","display","type","icons","relcount","thumbnail","isPADHidden","isHiddenState","grid","padgrid","ensureNLS"];var i=new Map([["label","value"],["display","value"],["type","value"],["relcount","value"],["thumbnail","value"],["isPADHidden","value"],["isHiddenState","value"],["grid","object"],["padgrid","object"],["icons","array"],["ensureNLS","value"]]);var n=new Map([["array",function(e,t){return function(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var i=0;i<o;i++)if(typeof e[i]!=typeof t[i]&&"object"==typeof e[i]){if(void 0!==e[i]&&void 0!==t[i]&&e[i].iconPath!==t[i].iconPath)return!1}else if(e[i]!==t[i])return!1;return!0}return!1}return!1}(e,t)?{change:!0,value:t}:{change:!1}}],["value",function(e,t){return e!==t?{change:!0,value:t}:{change:!1}}],["object",function(o,i){let n=!1;if(!o&&!i)return!1;if(o&&!i)return!1;let s={};return e.iterateObj(i,function(e,i){let r=o[i];if(r){if(e!==r){let o=t.hasChange(i,r,e);o.found?o.hasChange&&(n||(n=!0),s[i]=e):(n||(n=!0),s[i]=e)}}else n||(n=!0),s[i]=e}),{change:n,value:s}}]]);function s(e){this.node=e}return s.prototype={update:function(t){if(!t)return void console.error("You passed NULL");let s=this.node.options,r={},a=!1,l=0,d=!1;e.iterateObj(s,function(e,s){if(-1!==o.indexOf(s)){let o=function(e,t,o){let s=i.get(e);return n.get(s)(t,o)}(s,e,t[s]);if(o.change){r[s]=o.value;let e=r[s];null==e||"thumbnail"===s&&0===e.length?delete r[s]:("ensureNLS"===s&&(a=!0),d=!0,l++)}}}),d&&(this.doUpdate=d,this.specifics=r,a&&1===l&&(this.doUpdate=!1))},execute:function(){this.doUpdate&&this.node.updateOptions(this.specifics)}},s}),define("DS/ENXNav/views/private/LevelSelector",["i18n!DS/ENXNav/assets/nls/ENXNav","UWA/Core","DS/Utilities/Utils","DS/Controls/Abstract","DS/Controls/SpinBox","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,o,i,n,s,r){"use strict";return i.inherit({name:"LevelSelector",markForRecordFlag:!0,publishedProperties:{expandLevel:{defaultValue:"1",type:"string",category:"Appearance"},onLevelSelectorSet:{defaultValue:void 0,type:"function"},onLevelSelectorClose:{defaultValue:void 0,type:"function"}},buildView:function(){var o=this;this.elements.container.addClassName("enx-controls-levelselector"),this.elements.levelSelContainer=new t.Element("div",{class:"enx-controls-levelselector-container"}).inject(this.elements.container),this.elements.spinBox=new n({value:1,minValue:1,stepValue:1,pageStepValue:1,typingFilter:!0,decimals:0}).inject(this.elements.levelSelContainer),this.elements.spinBox.getContent().addClassName("enx-controls-levelselector-spinbox"),r.addEventOnElement(this,this.elements.spinBox.getContent(),"keydown",function(e){var i=t.Event.whichKey(e);"return"===i?o._levelSelected():"esc"===i&&o.close()}),this.elements.separator=new t.Element("div",{class:"enx-controls-levelselector-separator",html:"|"}).inject(this.elements.levelSelContainer),this.elements.checkSelBtn=new t.Element("div",{class:"enx-controls-levelselector-checkSel-btn",title:e.levelselector.checkLevel}).inject(this.elements.levelSelContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),r.addEventOnElement(this,this.elements.checkSelBtn,s.POINTERHIT,function(e){o._levelSelected(),e.stopPropagation()})},close:function(){this.visibleFlag=!1,this.onLevelSelectorClose&&this.onLevelSelectorClose()},_levelSelected:function(){var e=this.elements.spinBox.value;this.onLevelSelectorSet&&this.onLevelSelectorSet(e)}})}),define("DS/ENXNav/commands/view/_xNavSelectParent",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();if(o.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[];o.forEach(function(e){var t=e.getParent();t.options._isTrueRoot||i.push(t)}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()}}}}),define("DS/ENXNav/views/private/Search",["i18n!DS/ENXNav/assets/nls/ENXNav","UWA/Core","DS/Utilities/Utils","DS/Controls/Abstract","DS/Controls/LineEditor","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,o,i,n,s,r){"use strict";return i.inherit({name:"Search",markForRecordFlag:!0,publishedProperties:{findStr:{defaultValue:"",type:"string",category:"Appearance"},disableSelectProxy:{defaultValue:!1,type:"boolean"},onSearchRequest:{defaultValue:void 0,type:"function"},onSearchIdRequest:{defaultValue:void 0,type:"function"},onSearchClose:{defaultValue:void 0,type:"function"},placeholder:{defaultValue:"",type:"string",category:"Appearance"}},buildView:function(){var o=this;this.elements.container.addClassName("enx-controls-search"),this.elements.findContainer=new t.Element("div",{class:"enx-controls-search-container"}).inject(this.elements.container),this.elements.findEditor=new n({selectAllOnFocus:!0,sizeInCharNumber:22,displayClearFieldButtonFlag:!0,displayStyle:"lite"}).inject(this.elements.findContainer),this.elements.findEditor.getContent().addClassName("enx-controls-search-editor"),r.addEventOnElement(this,this.elements.findEditor.getContent(),"keydown",function(e){var i=t.Event.whichKey(e);"return"===i?o.elements.findEditor.valueToCommit===o.findStr&&o._launchSearch():"esc"===i&&o.elements.findEditor.valueToCommit===o.findStr&&o.close()}),this.elements.separator=new t.Element("div",{class:"enx-controls-search-separator",html:"|"}).inject(this.elements.findContainer),this.elements.checkSelBtn=new t.Element("div",{class:"enx-controls-checkSel-btn",title:e.searchview.check}).inject(this.elements.findContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),this.elements.checkSelBtn.setAttributeNode(document.createAttribute("disabled")),this._applySelectProxy(this.disableSelectProxy),this.elements.searchBtn=new t.Element("div",{class:"enx-controls-search-btn",title:e.searchview.searchBtn}).inject(this.elements.findContainer),r.generateIcon("search-filter",{target:this.elements.searchBtn}),this.elements.searchBtn.setAttributeNode(document.createAttribute("disabled"))},_launchSearch:function(e,t){var i=this;this.findStr=this.elements.findEditor.valueToCommit;var n=function(){i.onSearchRequest&&i.onSearchRequest(i.findStr,i.matchCase,e)},s=o.debounce(n,500);t?s():n()},_launchSearchId:function(){this.onSearchIdRequest&&this.rscIdToSearch&&(this.onSearchIdRequest(this.rscIdToSearch),delete this.rscIdToSearch)},_applyProperties:function(e){this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("disableSelectProxy")&&this._applySelectProxy(e.disableSelectProxy)},_applySelectProxy:function(){if(this.disableSelectProxy)this._cmdProxy&&(this._cmdProxy.destroy(),this._cmdProxy=null),this.elements.checkSelBtn.style.display="none";else{var t=this;require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTypesMgt"],function(o,i){this._cmdProxy=o.create({events:{onSelect:function(n,s){var r=function(o){function n(e){t.rscIdToSearch=e.rscId,t.elements.findEditor.value=e["ds6w:label"],t.elements.checkSelBtn.removeAttribute("disabled")}if(1===o.paths.length){var s=o.paths[0],r=s[s.length-1],a=[];a.push({type:o.attributes[r].type}),i.isTypesAuthorized(a,function(i){if(i.length>0){var s={rscId:r,"ds6w:type":o.attributes[r].type,"ds6w:label":o.attributes[r].label};void 0===s["ds6w:label"]?(t.elements.findEditor.value=e.searchview.loadingLabel,t.loadingInProgress=!0,require(["DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/ParserUtils","DS/PADServices/utils/GlobalUtils"],function(o,i,r,a){(o.fetch?Promise.resolve():i.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){var i={pids:[s.rscId],data:{select_predicate:["ds6w:label","ds6w:type"],select_file:[]}};o.fetch(i).then(function(o){var i="string"==typeof o?JSON.parse(o):o;if(i.results&&1===i.results.length){var l=i.results[0],d=r.parseAttributes(l.attributes);s["ds6w:label"]=d.label,delete t.loadingInProgress,n(s)}else a.displayNotif({message:e.searchview.cannotRetrieveLabel,level:"error",key:"Search-cannotRetrieveLabel"})}).catch(function(){a.displayNotif({message:e.searchview.cannotRetrieveLabel,level:"error",key:"Search-cannotRetrieveLabel"})})})})):n(s)}})}else t.rscIdToSearch="",t.elements.findEditor.value=""};s.appid!==o.appId()&&(t.timeoutSelect?(clearTimeout(t.timeoutSelect),t.timeoutSelect=setTimeout(function(){r(n),delete t.timeoutSelect},200)):t.timeoutSelect=setTimeout(function(){r(n)},200))}}}),this.elements.checkSelBtn.style.display=""}.bind(this))}},_applyFindStr:function(e){this.findStr!==e&&(this.elements.findEditor.valueToCommit!==this.findStr&&(this.elements.findEditor.value=this.findStr),this.findStr.length&&!0!==this.loadingInProgress?this.elements.searchBtn.removeAttribute("disabled"):(this.elements.searchBtn.setAttributeNode(document.createAttribute("disabled")),this.elements.checkSelBtn.setAttributeNode(document.createAttribute("disabled"))))},_applyPlaceholder:function(){this.elements.findEditor&&(this.elements.findEditor.placeholder=this.placeholder)},handleEvents:function(){var e=this;r.addEventOnElement(this,this.elements.findEditor,"uncommittedChange",function(t){e.findStr=e.elements.findEditor.valueToCommit}),r.addEventOnElement(this,this.elements.checkSelBtn,s.POINTERHIT,function(t){e._launchSearchId(),t.stopPropagation()}),r.addEventOnElement(this,this.elements.searchBtn,s.POINTERHIT,function(t){e._launchSearch(),t.stopPropagation()}),r.addEventOnElement(this,this.elements.findContainer,s.POINTERHIT,function(t){e._giveFocus()})},setCurrentValue:function(e){this.currentValue=e},close:function(){this.visibleFlag=!1,this.onSearchClose&&this.onSearchClose()},focus:function(){this._giveFocus()},_giveFocus:function(){this._parent(),this.elements.findEditor&&document.activeElement!==this.elements.findEditor._myInput&&this.elements.findEditor._giveFocus()}})}),define("DS/ENXNav/commands/FilterDropObjects",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(e,t,o,i){"use strict";return e.extend({execute:function(e,n){var s=t.get(),r=s.options.model?s.options.model:s.getPADTreeDocument(),a=!(!n||!n.fromWP)&&n.fromWP,l=!(!n||!n.fromProxy)&&n.fromProxy,d=!a&&!l,c=e.biProxyCtx;require(["DS/PADUtils/PADTypesMgt","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSession"],function(t,p,u,h){t.retrieveAuthorizedObjects({notifPerObjects:!0,displayNotif:!1,unserializedData:e,callback:function(e){var t=e.authorizedWithKind.Product?e.authorizedWithKind.Product.length:0;if(t+=e.authorizedWithKind.Filter?e.authorizedWithKind.Filter.length:0,0===e.authorized_objects.length&&0===t||0===t){if(e.authorizedWithKind.DesignEnv&&e.authorizedWithKind.DesignEnv.length){let e=require("i18n!DS/ENXNav/assets/nls/ENXNav.json");p.displayNotification({msg:e.design_exp_unable_to_filter,eventID:"error"})}}else{var g=r.getRoots();o.multiTenantMgt(e.authorized_objects,g,function(t){if(t.isMultiTenant)t.isMultiTenant&&t.invalidTenant;else{var o="WITHOUT_CONTEXT";n&&n.behavior&&(o=n.behavior);var r=[];e.authorizedWithKind&&(e.authorizedWithKind.Product&&e.authorizedWithKind.Product.length>0&&(1===e.authorized_objects.length?r.push(new Promise(function(t){s.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,loadWithFilter:1===e.authorizedWithKind.Product.length,biProxyCtx:c,dropOnFilter:!0,callback:function(o){if(h.isAuthoring())s.disableFilterWaiting(),p.displayNotification({msg:u.filterInAuthoring,eventID:"warning",key:"enxNav-filterInAuthoring"}),t();else if("error"!==o)if(!0!==l)if(1===e.authorized_objects.length){var i=e.authorizedWithKind.Product[0].objectId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var o=e.getCommand("DefineFilter");o&&(o.setOpenFilterNow(i),o.begin(),s._filterRootIds=[i],s._filterPanelOpen=!0),t()})}else t();else!0===l&&(s._filterRootIds=[i],s._filterPanelOpen=!0);else s.disableFilterWaiting(),t()},behavior:o,broadcast:d})})):r.push(new Promise(function(t){s.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,biProxyCtx:c,callback:function(){t()},behavior:o,broadcast:d,fromWP:a})}))),e.authorizedWithKind.Filter&&e.authorizedWithKind.Filter.length>0)&&(o=1===e.authorizedWithKind.Filter.length?"fromDropOnFilter":void 0,(e.authorizedWithKind.Filter.length>1||e.authorized_objects.length>1)&&(o="fromDrop"),r.push(new Promise(function(t){s.addFilter({content:"3DXContent",filter_objects:e.authorizedWithKind.Filter,callback:t,behavior:o,broadcast:d,fromWP:a,fromProxy:l})}))),Promise.all(r).then(function(){i.getSetting("welcomeonempty")&&require("DS/PADServices/utils/GlobalModelEvents").getModelEvents().publish({event:"ENXViews/WelcomePanel/closeLandingPage"})})}})}},version:"2.0"})})}})}),define("DS/ENXNav/commands/tools/xNavFilterCmds",["DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADContext","DS/PADUtils/PADSession","DS/ENOXInterWdgCom/LinkManager"],function(e,t,o,i,n,s){"use strict";var r;return o.getSetting("activateFUN087933")&&(r=e.extend({_openFilterPanelNow:!1,_selectionId:-1,init:function(e){this._parent(e);var t=this;i.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},function(e){!0!==e.data.skipFilterProxy&&i.get()._biFilter&&!s.isWidgetSynchronizing()&&i.get()._biFilter.removeRoot(e.data.pid),0===i.get().getPADTreeDocument().getRoots().length&&t.disable()}),i.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},function(e){n.determineAuthoredFlag()||t.enable()}),i.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoots"},function(e){i.get()._biFilter&&i.get()._biFilter.removeRoots(e.data.pids)}),n.subscribe({event:"authoringStateModified"},function(e){e.authored||0===i.get().getPADTreeDocument().getRoots().length?t.disable():t.enable()})},setOpenFilterNow:function(e){this._openFilterPanelNow=!0,this._selectionId=e},hasSelection:function(){var e=this.getSelection();return!!(e&&e.path.length>0)},getAppParams:function(){return{widgetId:t.getWidgetId(),NGFUXId:i.get().getNGFUXID(!0),appId:t.getAppId(),shareFilterSpec:!0}},getSelectorManager:function(){return i.get().getPADTreeDocument().getXSO()||null},getRoots:function(){if(!1!==this._openFilterPanelNow){this._openFilterPanelNow=!1;var e=[],t=i.get().options.model.getNodesById(this._selectionId)[0],o={};return t.isRoot()?o=t:(o=t.getRoot()).select(),e.push({id:o.getID(),label:o.getLabel(),filtered:o.options.sequence_filter||o.options.config_filter?1:0}),e}return i.get().getPADTreeDocument().getRoots().map(function(e){return{id:e.getID(),label:e.getLabel(),filtered:e.options.sequence_filter||e.options.config_filter?1:0,revision:e.getReferenceValue("ds6wg:revision")}})},getSelection:function(){var e={path:[],label:[],revision:[],directSelection:i.get().getPADTreeDocument().isDirectSelection()};return i.get().getPADTreeDocument().getSelectedNodes().forEach(function(t){e.path.push(t.getOccurencePath()),e.label.push([t.getLabel()]),e.revision.push([t.getReferenceValue("ds6wg:revision")])}),e}})),r}),define("DS/ENXNav/views/private/externalColumnsViews/designExpColumn",["i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e){"use strict";return{"asset-type":{getCellTooltip:function(e,t){let o={shortHelp:"",updateModel:!1};return e&&t&&t.hasActiveDesignExp()&&(o=t.getPseService().getCellTooltip(e)),o},buildColumn:function(t){var o=this;return Object.assign({dataIndex:"asset-type",columnIdx:0,hasNLS:!1,visibleFlag:!1,label:e.columnsDef.DesignExpItemColumn,typeRepresentation:"image",noTitleColumn:!1,alignment:"center",pinned:"left",customisation:{exportable:{lock:!0,value:!1},layout:{removable:!1}},compareFunction:function(){if(arguments[2]){let e=arguments[2].getTreeDocument();e&&e.options.context.hasActiveDesignExp()&&(e.options.context.getPseService().deSortModel={isSorted:!0,sort:-1==this.reverseFactor?"desc":"asc"})}return arguments[2].options.sortIdentifier-arguments[3].options.sortIdentifier},width:40,text:e.columnsDef.DesignExpItemColumn,getCellValue:function(e){return o.ctx||(o.ctx=this._properties.treeDocument.value.options.context),{iconPath:o.ctx.hasActiveDesignExp()?o.ctx.getPseService().getAssetTypeCellValue(e):"",iconSize:{height:"65%"},className:["ContextModified","WIPModified"].includes(e.nodeModel.options.deType)?"de-clickable-icon":""}},getCellTypeRepresentation:function(){return"image"}},t)},actionOnClick:function(e,t){e&&e.nodeModel&&t.hasActiveDesignExp()&&t.getPseService().confirmCellAction(e)}}}}),define("DS/ENXNav/views/private/externalColumnsViews/lockRO",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PlatformAPI/PlatformAPI"],function(e,t,o){"use strict";var i=null;function n(e){return"string"==typeof e?"TRUE"===e.toUpperCase():e}function s(){return null==i&&(i=o.getUser()),i}const r={NOT_LOCKED:0,LOCKED_BY_ME:1,LOCKED_BY_OTHER:2};function a(e,t){let o=r.NOT_LOCKED;var i,n,a,l;if(t?(i=void 0!==e.nodeModel.options.grid["ds6w:reserved-Instance"]?e.nodeModel.options.grid["ds6w:reserved-Instance"]:void 0,n=e.nodeModel.options.grid["ds6w:reservedBy-Instance"]?e.nodeModel.options.grid["ds6w:reservedBy-Instance"]:"",void 0===i||e.nodeModel.options.relationid.length||(i=void 0)):(i=void 0!==e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:void 0,n=e.nodeModel.options.grid["ds6w:reservedBy"]?e.nodeModel.options.grid["ds6w:reservedBy"]:""),void 0!==i&&(Array.isArray(n)&&(n=n.join(",")),"boolean"==typeof i?i:"TRUE"===i.toUpperCase())){var d=(a=s(),l="",void 0!==a&&(l=a.login),l),c=function(){var e=s(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t}(),p=!0;n.trim().length>0&&((p=n.toUpperCase().trim()===d.toUpperCase().trim()||!1)||(p=n.toUpperCase().trim()===c.toUpperCase().trim()||!1)),o=p?r.LOCKED_BY_ME:r.LOCKED_BY_OTHER}return o}function l(e){var o=e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:"";if(void 0!==o)return("boolean"==typeof o?o:"TRUE"===o.toUpperCase())?t.columnsDef.tooltipReserved:t.columnsDef.tooltipUnreserved}return{"ds6w:reserved":{getCellTooltip:function(e,o){let i="";if(-1===e.rowID)i=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){if(n(e.nodeModel.getReferenceValue("ds6w:reserved"))){let o=a(e);r.LOCKED_BY_ME===o?i={shortHelp:t.tooltipLockedByMeRO}:r.LOCKED_BY_OTHER===o&&(i={shortHelp:t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy")})})}else i={shortHelp:t.tooltipUnLockedRO}}return i},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved",kind:"icon",minWidth:50,editableFlag:!1,typeRepresentation:"icon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(-1===e.rowID)return null;let t="",o=a(e);return r.LOCKED_BY_ME===o?t="enx_dgv_lock_by_me":r.LOCKED_BY_OTHER===o&&(t="enx_dgv_lock_other"),t},getCellValue:function(e){if(-1===e.rowID)return null;let t="",o=a(e);return r.LOCKED_BY_ME===o?t="key":r.LOCKED_BY_OTHER===o&&(t="lock"),t},getCellValueForExport:function(e){return-1===e.rowID?null:l(e)},getCellGroupingKey:function(e){let o=a(e),i="";return i=r.LOCKED_BY_ME===o?t.tooltipLockedByMeRO:r.LOCKED_BY_OTHER===o?t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy")}):t.tooltipUnLockedRO,this.getColumnOrGroup("ds6w:reserved").text+": "+i}},e)}},"ds6w:reserved-Instance":{getCellTooltip:function(e,o){let i="";if(-1===e.rowID)i=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){if(n(e.nodeModel.getReferenceValue("ds6w:reserved-Instance"))){let o=a(e);r.LOCKED_BY_ME===o?i={shortHelp:t.tooltipLockedByMeRO}:r.LOCKED_BY_OTHER===o&&(i={shortHelp:t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy-Instance")})})}else i={shortHelp:t.tooltipUnLockedRO}}return i},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved-Instance",kind:"icon",minWidth:50,editableFlag:!1,typeRepresentation:"icon",alignment:"center",icon:{iconName:"flow-cascade dgv-header-icon",fontIconFamily:1},customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(-1===e.rowID)return null;let t="",o=a(e,!0);return r.LOCKED_BY_ME===o?t="enx_dgv_lock_by_me":r.LOCKED_BY_OTHER===o&&(t="enx_dgv_lock_other"),t},getCellValue:function(e){if(-1===e.rowID)return null;let t="",o=a(e,!0);return r.LOCKED_BY_ME===o?t="key":r.LOCKED_BY_OTHER===o&&(t="lock"),t},getCellValueForExport:function(e){return-1===e.rowID?null:l(e)},getCellGroupingKey:function(e){let o=a(e),i="";return i=r.LOCKED_BY_ME===o?t.tooltipLockedByMeRO:r.LOCKED_BY_OTHER===o?t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy")}):t.tooltipUnLockedRO,this.getColumnOrGroup("ds6w:reserved-Instance").text+t.groupingNode.fromInstance+i}},e)}}}}),define("DS/ENXNav/commands/view/_xNavExpandN",[],function(){"use strict";return{execute:function(e){require(["DS/ENXNav/views/private/ExpandLevelSelector"],function(t){new t({position:e.position,events:{onLevelSelectorSet:function(t){var o=e.model,i=o.getSelectedNodes();i.length>1?o.expandMultiSelect({nodes2Expand:i,numberOfLevelsToExpand:t}):1===i.length&&i[0].expandNLevels({numberOfLevelsToExpand:t})}}})})}}}),define("DS/ENXNav/utils/LocalStorageForAppState",["DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PersistBlob"],function(e,t,o){function i(){this._appKey=e.buildKey(t.getUserLogin()+"."+t.getAppId(),"AppState",!0),this._blob=new o({key:this._appKey,version:1,storageWrapper:e.local})}let n;return i.prototype={get:function(e){let t=this._getAll();if(t)return t[e]},set:function(e,t){let o=this._getAll();o||(o={}),o[e]=t,this._setAll(o)},del:function(e){let t=this._getAll();t||(t={}),delete t[e],this._setAll(t)},_getAll:function(){return e.local.get(this._appKey)},_setAll:function(t){e.local.set(this._appKey,t)}},n||(n=new i),n}),define("DS/ENXNav/commands/ShowIn3DCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{atleastonehidden:!0})},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes(),t=[];e.length>=1&&e.forEach(function(e){t.push(e.getOccurencePath())}),o.get().onShow({paths:t})}})}),define("DS/ENXNav/commands/FocusOnCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID)},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes(),t=require("DS/PADUtils/PADUtilsServices"),i=[];e.length>=1&&e.forEach(function(e){i.push(e.getOccurencePath())}),o.get()._commandProxy.focus({intent:"focus",paths:i,widget:"2D",sharedID:t.getSharedId(),appID:t.getAppId()})}})}),define("DS/ENXNav/commands/FindCmd",["i18n!DS/ENXNav/assets/nls/ENXNav","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/TreeModel/TreeNodeModel","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalUtils","DS/PADServices/settings/AppSettings"],function(e,t,o,i,n,s,r,a,l,d,c,p,u){"use strict";return i.extend({init:function(e){this._parent(e),o.viewMgt(this.options.ID,{nograph:!0,notiles:!0,nothumbs:!0}),!0===u.getSetting("grpBSD")&&o.selectionMgt(this.options.ID,{noGrp:!0})},execute:function(){var o=this;require(["DS/ENOXFindUX/FindView","DS/ENOXFindUX/ENOXFindUtils"],function(i,u){o.findView=null;var h,g,f=o.dgv=n.get().getPADDGVView()?n.get().getPADDGVView().options.dgv:void 0,v=o.model=n.get().getPADTreeDocument(),m=o.getArguments();if(1!==m.length)return;if(o.targetDiv=document.querySelector("."+m[0].Value),!o.targetDiv)return;null!==o.findView&&o.findView.closePanel(),l.subscribe({event:"ENXModel/refresh/begin"},o._resetFindResult.bind(o)),l.subscribeOnce({event:"ENXViews/Model/FindInCtx/ui/close"},function(){!0!==v.isOccModel&&a.node.clearChildComputed(v)}),l.subscribe({event:"ENXModel/toggleView"},o.end.bind(o)),l.subscribe({event:"ENXModel/Root/remove"},o._handleRemovalOfRoot.bind(o));var D=v.getSelectedNodes();0===D.length?h=e.find.title:1===D.length?(h=e.replace(e.find.title1Node,{label:D[0].getLabel()}),g=D[0].options.resourceid):h=e.replace(e.find.titleNNodes,{nbNodes:D.length});let b=o.options.position;delete o.options.position;let S,_=f.layout.getVisibleOrderedColumnsIndexes(),x=[],y=[];for(S=0;S<_.length;S++){var C=f.getColumnOrGroup(_[S]);!0!==d.isAttributeColumn(C.dataIndex)||"matrixtxt"===C.ds6w||"string"!==C.typeRepresentation&&"tag"!==C.typeRepresentation&&"url"!==C.typeRepresentation||!C.ds6w||-1!==x.indexOf(C.ds6w)||(x.push(C.ds6w),y.push(C))}let N=c.buildKey("ENXFindCmd","selectedColKey",!0),P=c.local.get(N),A=c.buildKey("ENXFindCmd","selectedMatchKey",!0),w=c.local.get(A),I=c.buildKey("ENXFindCmd","selectedNavigateModeKey",!0),E=c.local.get(I),O=c.buildKey("ENXFindCmd","includeType3dShapeKey",!0),M=c.local.get(O),F=c.buildKey("ENXFindCmd","includeTypeInstanceKey",!0),R=c.local.get(F),T=[];if(P)T=JSON.parse(P);else for(S=0;S<y.length;S++)T.push(y[S].ds6w);o.findView=new i({placeholder:e.find.placeholder,title:h,renderTo:o.targetDiv,position:b,listenSelect:!0,authorizedTypes:["VPMReference","VPMRepReference"],associatedNodeResourceId:g,availableCols:{withChooser:!0,selectedCols:T,allCols:y,selectedMatch:w,selectedNavigateMode:E,includeType3dShape:M,includeTypeInstance:R},events:{onSearch:function(e){var i;f&&f.closeFind(),(i=D&&D.length?D:o.model.getRoots())&&i.length&&e.searchFts.length?(o._selectMatch=e.selectMatch,c.local.set(A,o._selectMatch),o._selectNavigateMode=e.selectNavigateMode,c.local.set(I,o._selectNavigateMode),o._includeType3dShape=e.includeType3dShape,c.local.set(O,o._includeType3dShape),o._includeTypeInstance=e.includeTypeInstance,c.local.set(F,o._includeTypeInstance),o._selectedPredicates=e.selectedPredicates,c.local.set(N,JSON.stringify(o._selectedPredicates)),v.__findInProgress=!0,o._launchFind({nodes:i,searchFts:e.searchFts,rscId:e.rscId,selectedPredicates:e.selectedPredicates}).then(function(t){o.foundNodes=t.foundNodes;let i=0;if(f){f.findWidget=o.findView,f.getNodeModelToProcessForFind=function(e,o){return t.foundNodes};let s=o._selectNavigateMode?"row":"substring";f.findNavigationMode=s;let r=void 0;if(Array.isArray(e.findInContentSelected)&&e.findInContentSelected.length){r=[];let t=f.layout.getVisibleOrderedColumnsIndexes(),o=[];for(let e=0;e<t.length;e++){var n=f.getColumnOrGroup(t[e]);!0===d.isAttributeColumn(n.dataIndex)&&"matrixtxt"!==n.ds6w&&("string"===n.typeRepresentation||"tag"===n.typeRepresentation||"url"===n.typeRepresentation)&&n.ds6w&&n.text&&o.push(n.text)}for(let t=0;t<e.findInContentSelected.length;t++)r.push(e.findInContentSelected[t]),-1!==o.indexOf(e.findInContentSelected[t]+" ")&&r.push(e.findInContentSelected[t]+" ")}f.onFindRequest({findStr:e.searchFts?e.searchFts.trim():e.searchFts,matchCase:!1,navigationMode:s,findInContentSelected:r}),i=f.matchingStringCount,"row"===f.findNavigationMode&&(i=f._matchingRowsCount),o._selectNodeFromMatchCell(),delete v.__findInProgress}o.findView.setMatchingStringCount(i)})):(o.foundNodes=[],o.findView.setMatchingStringCount(0),i&&i.length||!e.searchFts.length||p.displayNotif({message:t.find_in_context_no_result,eventID:"info"}))},onSelect:function(){if(o.foundNodes&&o.foundNodes.length){var e=o.model;e.prepareUpdate();for(var t=0;t<o.foundNodes.length;t++)o.foundNodes[t].select();e.pushUpdate()}},onClose:function(){f&&f.closeFind(),o.dgv.getNodeModelToProcessForFind=void 0,f.findWidget=null,o.findView=null,l.publish({event:"ENXViews/Model/FindInCtx/ui/close"})},onListenSelect:function(t,i){if(null!==o.findView){var n=o.findView;if((void 0===n.options.strString||0===n.options.strString.length)&&1===t.paths.length){var a=t.paths[0],l=a[a.length-1],d={};t.attributes&&(d=t.attributes[l]);let e=Object.assign({rscId:l},d);u.getTypeTaxonomies({typesToSearch:[{rscId:e.rscId,type:e.type}]}).then(o=>{var i=o[e.type]?o[e.type]:o.XP_VPMReference_Ext,r=!1;if(n.options.authorizedTypes)for(let e=0;e<n.options.authorizedTypes.length;e++)if(-1!==i.indexOf(n.options.authorizedTypes[e])){r=!0;break}r?(e.label=t.attributes[e.rscId].label,UWA.is(e.label)?c(e):require(["DS/PADUtils/PADWSAccess"],function(t){var o=s.getWebAPI_Options("fetch");t.fetch({enopad_webapis:s.getSetting("enopad_webapis"),data:o,pids:[e.rscId],onComplete:function(t){var o=UWA.is(t,"string")?JSON.parse(t):t;if(o.results&&1===o.results.length){var i,n=o.results[0],s=null,r=n.attributes.length;for(i=0;i<r&&!s;i++)"ds6w:label"===n.attributes[i].name&&(s=n.attributes[i].value);e.label=s,c(e)}else e.label=null,c(e)},onFailure:function(){e.label=null,c(e)}})})):console.log("FindView## type ["+e.type+"] not authorized")})}}function c(t){var n,s=o.findView,a=s.options.autocompleteModel.search({match:function(e){return e.nodeModel.getReferenceValue("rscId")===t.rscId}});if(0===a.length){var l=s.options.autocompleteModel.getRoots();l.length===i&&(s.options.autocompleteModel.removeRoot(l[i-1]),l=s.options.autocompleteModel.getRoots());var d=t.label;d||(d=e.find.selectNodeWithoutLabel);var c=new r({label:d,grid:{rscId:t.rscId},icons:[{iconName:"3d-object",fontIconFamily:1}]});0===l.length?s.options.autocompleteModel.addRoot(c):s.options.autocompleteModel.insertBefore(c,l[0]),n=c,s.__storeAutocompleteModel()}else n=a[0];s.elements.wuxautocomplete._editor.value=n.getLabel(),s.elements.findBtn.disabled=!1}},onFindPreviousResult:o._goToPreviousMatchingCell.bind(o),onFindNextResult:o._goToNextMatchingCell.bind(o),onResetFindResult:o._resetFindResult.bind(o)}})})},_resetFindResult:function(){this.dgv&&this.dgv.closeFind(),this.foundNodes=[],null!==this.findView&&this.findView.setMatchingStringCount(void 0)},_handleRemovalOfRoot:function(e){var t=this.model.getRoots();if(this.findView)if(t.length){if(this.findView.options.associatedNodeResourceId){this.model.getNodesById(this.findView.options.associatedNodeResourceId).length||this.end()}}else this.end()},end:function(){this.findView&&(this.model._doNotBroadcastSelect=!1,this.findView.closePanel()),this._parent()},_should3DFocusChange:function(){var e=this.dgv._matchingAllNodeModelsArray[this.dgv._currentMatchingCellIDIndex].options.resourceid;return e!==this._currentResId&&(this._currentResId=e,!0)},_goToPreviousMatchingCell:function(){this.dgv.goToPreviousMatchingCell(),this._selectNodeFromMatchCell()},_goToNextMatchingCell:function(){this.dgv.goToNextMatchingCell(),this._selectNodeFromMatchCell()},_selectNodeFromMatchCell:function(){if(this._selectMatch){let e=this.dgv.getNodeModelAt(this.dgv._getMatchingCellID(this.dgv._currentMatchingCellIDIndex));!0!==e.isSelected()&&e.select(!0)}},_launchFind:function(e){var t=this;return new Promise(function(o){require(["DS/PADServices/utils/PredefinedQueryUtils"],function(i){var n=!0;if(e.searchFts?i.isPredefinedQry(e.searchFts,{version:2}).then(function(o){var i=o.realQry;!1===o.isPredefinedQry&&(i=t._buildQryRestrictedToColumns(i)),t._includeType3dShape&&t._includeTypeInstance||(i=t._filterTypeFromSearch(i)),l.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFts:i,searchFtsOriginal:e.searchFts,rscId:e.rscId,noPager:!0,doNotBroacast:!0}})}):e.rscId?l.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,rscId:e.rscId,noPager:!0,doNotBroacast:!0}}):n=!1,n)var s=l.subscribe({event:"ENXViews/Model/FindInCtx/complete"},function(e){l.unsubscribe(s),o(e)})})})},_filterTypeFromSearch:function(e){let t="";return`(${e}) AND ${t=this._includeType3dShape||this._includeTypeInstance?this._includeType3dShape?"(([ds6w:type]:VPMReference OR [ds6w:type]: 3DShape) AND (NOT([ds6w:type]:VPMInstance)))":"(([ds6w:type]:VPMInstance OR [ds6w:type]:VPMReference) AND (NOT([ds6w:type]: 3DShape)))":"(([ds6w:type]:VPMReference) AND (NOT([ds6w:type]: 3DShape AND [ds6w:type]:VPMInstance)))"}`},_buildQryRestrictedToColumns:function(e){var t="";e.includes(" ")&&(e=`"${e}"`);for(let o=0;o<this._selectedPredicates.length;o++){this._selectedPredicates[o].endsWith("-Instance")&&(this._selectedPredicates[o]=this._selectedPredicates[o].replace("-Instance","")),0!==o&&(t+=" OR "),t=t+("["+this._selectedPredicates[o]+"]")+":*"+e+"*"}return t}})}),define("DS/ENXNav/commands/ExpandThumbsCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{moreExpanded:!0}),e.viewMgt(this.options.ID,{nodgv:!0,notiles:!0,nothumbs:!0})},execute:function(){var t=o.get(),i=t.getSelectedNodes();t.options.views.graphview.setGroupThumbnailState({nodes:i,expanded:!1}),e.checkAvailability()}})}),define("DS/ENXNav/views/private/externalColumnsViews/lifecycleCols",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","DS/PlatformAPI/PlatformAPI","DS/PADUtils/Configuration","DS/PADServices/utils/MaturityUtils","DS/ApplicationFrame/CommandsManager","DS/PADUtils/PADContext"],function(e,t,o,i,n,s,r,a){"use strict";var l=null;function d(e){if("string"==typeof e)return"TRUE"===e.toUpperCase()}function c(){return null==l&&(l=i.getUser()),l}function p(e,t){var o,i,n,s,r=!1;if(t?(o=void 0!==e.nodeModel.options.grid["ds6w:reserved-Instance"]?e.nodeModel.options.grid["ds6w:reserved-Instance"]:void 0,i=e.nodeModel.options.grid["ds6w:reservedBy-Instance"]?e.nodeModel.options.grid["ds6w:reservedBy-Instance"]:"",void 0===o||e.nodeModel.options.relationid.length||(o=void 0)):(o=void 0!==e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:void 0,i=e.nodeModel.options.grid["ds6w:reservedBy"]?e.nodeModel.options.grid["ds6w:reservedBy"]:""),void 0!==o){Array.isArray(i)&&(i=i.join(","));var a=e.nodeModel.options.grid["ds6w:displayName"]?e.nodeModel.options.grid["ds6w:displayName"]:"";r="boolean"==typeof o?o:"TRUE"===o.toUpperCase();var l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock";if(l)if(r){var d=(n=c(),s="",void 0!==n&&(s=n.login),s),p=function(){var e=c(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t}(),u=!0;i.trim().length>0?(u=i.toUpperCase().trim()===d.toUpperCase().trim()||!1)||(u=i.toUpperCase().trim()===p.toUpperCase().trim()||!1):a.trim().length>0&&(u=p.toUpperCase().trim()===a.toUpperCase().trim()||!1),l=u?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other"}else l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open lc_dgv_unlock";return{icon:{iconClasses:l},label:a}}}function u(e){var o=e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:"";if(void 0!==o)return("boolean"==typeof o?o:"TRUE"===o.toUpperCase())?t.columnsDef.tooltipReserved:t.columnsDef.tooltipUnreserved}var h=[];return{"ds6w:reserved":{getCellTooltip:function(e,o){let i="";if(-1===e.rowID)i=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){i=("boolean"!=typeof e.cellModel?d(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.tooltipReserved}:{shortHelp:t.columnsDef.tooltipUnreserved}}return i},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved",kind:"functionIcon",minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellSemantics:function(e){if(!e.isHeader)return p(e,!1)},getCellValueForExport:function(e){return-1===e.rowID?null:u(e)}},e)},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{let t=e.nodeModel.getReferenceValue("ds6w:reserved");var o="ActionBar_ReserveCmd";!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(o="ActionBar_UnreserveCmd");var i=r.getCommand(o);i&&i.isEnabled()?i.begin():setTimeout(function(){i&&i.isEnabled()&&i.begin()},600)},t)}}},"ds6w:reserved-Instance":{getCellTooltip:function(e,o){let i="";if(-1===e.rowID)i=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){i=("boolean"!=typeof e.cellModel?d(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.tooltipReserved}:{shortHelp:t.columnsDef.tooltipUnreserved}}return i},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved-Instance",kind:"functionIcon",minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",icon:{iconName:"flow-cascade dgv-header-icon",fontIconFamily:1},customisation:{exportable:{lock:!1,value:!0}},getCellSemantics:function(e){if(!e.isHeader)return p(e,!0)},getCellValueForExport:function(e){return-1===e.rowID?null:u(e)}},e)},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{let t=e.nodeModel.getReferenceValue("ds6w:reserved-Instance");var o="ActionBar_ReserveCmd";!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(o="ActionBar_UnreserveCmd");var i=r.getCommand(o);i&&i.isEnabled()?i.begin():setTimeout(function(){i&&i.isEnabled()&&i.begin()},600)},t)}}},"ds6wg:PLMReference.V_isLastVersion":{getCellTooltip:function(e,o){let i;return i=-1===e.rowID?o.getCellDefaultTooltip(e):e.cellModel?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}},buildColumn:function(e){return Object.assign({dataIndex:"ds6wg:PLMReference.V_isLastVersion",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"]){var t=e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:isLastRevision":{getCellTooltip:function(e,o){let i;if(-1===e.rowID)i=o.getCellDefaultTooltip(e);else{i=("boolean"!=typeof e.cellModel?d(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}}return i},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:isLastRevision",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6w:isLastRevision"]){var t=e.nodeModel.options.grid["ds6w:isLastRevision"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:isLastRevisionPerState":{getCellTooltip:function(e,o){let i;if(-1===e.rowID)i=o.getCellDefaultTooltip(e);else{i=("boolean"!=typeof e.cellModel?d(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}}return i},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:isLastRevisionPerState",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6w:isLastRevisionPerState"]){var t=e.nodeModel.options.grid["ds6w:isLastRevisionPerState"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:status":{buildColumn:function(e){return s.addCSSMaturityClasses(void 0,"wux-controls-label"),Object.assign({dataIndex:"ds6w:status",kind:"tag",minWidth:50,editableFlag:!1,typeRepresentation:"tag",className:"lc-maturity-state",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel){var t,o=e.nodeModel.getReferenceValue("ds6w:status-original")?e.nodeModel.getReferenceValue("ds6w:status-original"):e.nodeModel.getReferenceValue("ds6w:status");if(o){if(!1===o.contains(".")){let t=e.nodeModel.getReferenceValue("ds6w:policy-original")?e.nodeModel.getReferenceValue("ds6w:policy-original"):e.nodeModel.getReferenceValue("ds6w:policy");o=t?t+"."+o:e.nodeModel.getReferenceValue("ds6w:status")}t=s.getAndCreateMaturityClass(o,"wux-controls-label")}return t}}},e)},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{o.launchIfEnabled(r,"MaturityHdr")},t)}},updateAttributesDelayed:function(e,t,o){let i=[];for(let t=0;t<e.length;t++){var n=e[t].getReferenceValue("ds6w:status-original")?e[t].getReferenceValue("ds6w:status-original"):e[t].getReferenceValue("ds6w:status");if(n){let o;o=!1===n.contains(".")?e[t].getReferenceValue("ds6w:policy-original")?e[t].getReferenceValue("ds6w:policy-original"):e[t].getReferenceValue("ds6w:policy"):n.split(".")[0],-1===h.indexOf(o)&&i.push(o)}}i.length&&s.addCSSMaturityClasses(i,"wux-controls-label")}},"ds6wg:revision":{buildColumn:function(e){var t=null;let o=!0,i="string";return!n.getConfig("readOnlyApp")&&(o=!1,i="url"),(t=Object.assign({dataIndex:"ds6wg:revision",kind:i,minWidth:50,editableFlag:!1,typeRepresentation:"url",customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"url"},getCellValue:function(e){var t=e&&e.nodeModel?e.nodeModel.options.grid["ds6wg:revision"]:void 0;return t?{label:t,func:function(){console.log("Revision Column Value: "+t)}}:void 0},getCellValueForExport:function(e){return e&&e.nodeModel?e.nodeModel.options.grid["ds6wg:revision"]:void 0}},e)).kind=i,t},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{var e=r.getCommand("HistoryHdr");e&&e.begin()},t)}}}}}),define("DS/ENXNav/commands/Download",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalUtils","DS/ENXNav/commands/CmdUtils"],function(e,t,o,i,n){"use strict";return e.extend({init:function(e){this._parent(e),n.selectionMgt(this.options.ID,{})},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes();require(["DS/DocumentManagement/DocumentManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/ModelEvents","DS/DocumentCommands/DocumentCommandsV2"],function(t,o,n,s){let r=e.map(e=>e.getID());r=r.filter((e,t)=>r.indexOf(e)===t),o.getPlatformServices({platformId:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",onComplete:function(e){t.getDocuments(r,{tenant:e.platformId,tenantUrl:e["3DSpace"],additionalURLParams:"$fields=isDocumentType",onComplete:function(t){if(t.success){var o=new n;o.subscribe({event:"docv2-show-notification"},function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.lable};i.displayNotif(t)}),new s({fetchSecurityContext:function(){},getSelectedNodes:function(){return t.data},getDocumentFromNodeModel:function(e){return e},platformUrls:e,isFromContextMenu:!0,events:o}).commands.Download.execute()}},onFailure:function(e){console.log(e)}})}})})}})}),define("DS/ENXNav/models/_xNavDocumentRefresh",["UWA/Class","UWA/Promise","DS/ENXNav/models/RefreshHandler","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADProgressBar","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o,i,n,s,r,a,l,d){"use strict";var c=e.extend({});return console.warn("Deprecated use of DS/ENXNav/models/_xNavDocumentRefresh"),c}),define("DS/ENXNav/commands/CloseSelectedCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{onlyRoot:!0})},execute:function(){var e=o.get().getPADTreeDocument(),t=e.getSelectedNodes();let i=t.length;e.withTransactionUpdate(function(){if(i>1)e.removeRootsQuiet(t);else for(var o=0;o<t.length;o++)e.removeRoot(t[o])})}})}),define("DS/ENXNav/views/private/SearchView",["css!DS/ENXNav/ENXNav.css","DS/ENXNav/views/private/Search","DS/PADServices/views/ENXModal","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,i){"use strict";function n(e){return this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.__buildView(),this}return n.prototype.getContent=function(){return this.elements.container},n.prototype.__buildView=function(){var e=this;this.elements.findContainer=new t({placeholder:this.options.placeholder,onSearchRequest:function(t,o){e.options.events.onSearch&&e.options.events.onSearch({searchFts:t,matchCase:o}),e.close()},onSearchIdRequest:function(t){e.options.events.onSearch&&e.options.events.onSearch({rscId:t}),e.close()},onSearchClose:function(){e.close()}});var n=this.options.position.x-250;n<0&&(n=this.options.position.x);var s=this.options.target.getBoundingClientRect(),r=this.options.position.y+30;r>s.bottom-75&&(i.publish({event:"ENXViews/ActionBar/hide"}),r>s.bottom&&(r=this.options.position.y-40));var a=document.querySelector(".enx-appMainBody");e.elements.modalFts=new o({target:a,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",content:this.elements.findContainer.getContent(),position:{of:this.options.target,my:"top left",at:"top left",offsetX:n,offsetY:r},events:{onClickOutsideContent:function(){e.close()}}}),e.elements.modalFts.getContent().addClassName("enx-searchviewModal"),e.elements.modalFts.getContent().querySelector(".wux-windows-window-content").setStyle("padding","3px")},n.prototype.close=function(){this.options.events.onClose&&this.options.events.onClose(),this.elements.modalFts.close()},n}),define("DS/ENXNav/views/private/externalColumnsViews/classification",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","text!DS/ENXNav/assets/templates/bookmarksTemplate.html","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","UWA/Utils","DS/Handlebars/Handlebars","DS/PADServices/views/ENXModal","DS/Controls/Button"],function(e,t,o,i,n,s,r,a){"use strict";var l=s.compile(o);function d(e,t){return l({className:t,bookmarks:e})}return{"ds6w:bookmarks":{getCellTooltip:function(e,t){let o=null;if(-1===e.rowID)o=t.getCellDefaultTooltip(e);else{let i=e.nodeModel.getReferenceValue("ds6w:bookmarks");if(i){let s=d(i=n.splat(i));o={title:t.getColumnOrGroup(e.columnID).text,shortHelp:s,allowUnsafeHTMLShortHelp:!0,wrapThreshold:315,updateModel:!1}}}return o},buildColumn:function(e){return Object.assign(e,{dataIndex:"ds6w:bookmarks",width:100,minWidth:40,editableFlag:!1,kind:"url",typeRepresentation:"url",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(e){var o=e.nodeModel?e.nodeModel.options.grid["ds6w:bookmarks"]:void 0,i=void 0;return o&&(i=1===(o=n.splat(o)).length?{label:o[0]}:{label:t.replace(t.columnsDef.bookmarks,{nbBookmarks:o.length})}),i},getCellValueForExport:function(e){var t="";if(-1===e.rowID)t=e.cellModel;else if(e.nodeModel){var o=e.nodeModel?e.nodeModel.options.grid["ds6w:bookmarks"]:void 0;o&&(t=(o=n.splat(o)).join(","))}return t}})},actionOnClick:function(e,t){if(e.nodeModel){let i=e.nodeModel.getReferenceValue("ds6w:bookmarks");if(void 0!==i){let s=d(i=n.splat(i)),l=document.querySelector(".enx-appMainBody"),c=e.cellView.getContent().getBoundingClientRect(),p={of:l,my:"top left",at:"top left",offsetX:c.x,offsetY:c.y};var o=new r({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.getPADDGVView().options.dgv.getColumnOrGroup(e.columnID).text,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:s,position:p,buttons:{Close:new a({onClick:function(){o.close()}})},events:{onClickOutsideContent:function(){o.close()}}})}}}}}}),define("DS/ENXNav/models/RefreshMask",["DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/PromiseCompletion","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o){return{}}),define("DS/ENXNav/commands/CopyLink",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/commands/CmdUtils"],function(e,t,o){"use strict";return e.extend({init:function(e){this._parent(e),o.selectionMgt(this.options.ID,{monoselection:!0})},execute:function(){t.publish({event:"ENXModel/Model/CopyLink",data:{}})}})}),define("DS/ENXNav/commands/tools/ExportAs",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/Utility","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/views/ProgressDialog","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSettingsMgt","i18n!DS/PADServices/assets/nls/PADServices","DS/UIKIT/Mask","DS/ENXNav/utils/LocalStorageForAppState"],function(e,t,o,i,n,s,r,a,l,d,c,p,u){"use strict";var h;return t.extend({init:function(e){this._parent(e);var t=o.get();t.options.model?t.options.model:t.getPADTreeDocument();this._checkIfTreeView(),UWA.is(t.addEvent,"function")&&t.addEvent("onToggleView",this._checkIfTreeView.bind(this)),i.isMobileDevice()&&this.disable()},_checkIfTreeView:function(){switch(o.get().getPADTreeDocument().options.active_view){case"treelistview":case"datagridview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}},execute:function(){this.disable(),this._setCancelProcess(!1);for(var e=this.getArguments(),t="csv",o=0;o<e.length;o++)"ExportAs"===e[o].ID?t=e[o].Value:"TargetDiv"===e[o].ID&&(this.targetDiv=document.querySelector("."+e[o].Value));var i=this;r.getModelEvents().subscribeOnce({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete"},function(e){e.cancelPrintOrExport||r.publish({event:"ENXViews/DatagridView/ExportAs",data:{exportAs:t}}),i.enable()}),this._populateBeforeExport(t)},_populateBeforeExport:function(t){var i,g=this,f=o.get().getPADTreeDocument(),v=this._getAllVisibleNodes(f),m=[],D=d.getSetting("printobjectslimit");if("Print"===g._id&&v.length>D)return l.displayNotification({msg:e.replace(e.PrinteLargeDataLimit,{maxResult:D}),eventID:"warning",key:"EnxNav-printeLargeDataLimit"}),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!0}}),void g.enable();if(v.length>1e3&&!u.get("continueOrSkip"))i=this.__askStopOrContinue();else{let e=u.get("dontAskDecision");i=!0===e||!1===e?Promise.resolve(e):Promise.resolve(!1)}i.then(function(i){if(h)g.enable();else if(!0===i)console.log("Launch real Export/Print without update"),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!1}});else{this._progressDiag=new a({target:g.targetDiv,title:e["ExportAs-"+t],width:260,progressBar:{displayStyle:"normal"}}),this._progressDiag.setProgress(0),this._progressDiag.setProgress(5);var l=function(e,t){for(var o=[],i=e.length,n=0;n<i;n+=t)o.push(e.slice(n,n+t));return o}(v,500);f.setUseChangeTransactionMode(!0);var d=o.get().getPADDGVView().getColumnsForExport(),u=85/l.length,D=1,b=!1;console.log("Nb Batches:"+l.length+"\n Step:"+u),r.subscribeOnce({event:"ENXViews/ExportAs/CancelExportOrPrint"},function(){p.mask(g._progressDiag.options.target,c.documentsList.masks.cancelExport),g.disable(),b=!0}),m.push(new Promise(function(e,t){var o=n.createStepper(l,{model:f},function(t,i){s.updateNLSforexport(f,t).then(function(){b?e():i.model.fillAdditionalColumns(t,d,"ExportAs").then(function(){var e=Math.floor(D*u)+5;console.log("Progress:"+e+"\n"),g._progressDiag.setProgress(e),D++,o()})})},e);o()})),Promise.all(m).then(function(){p.unmask(g._progressDiag.options.target),b?r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!0}}):(f.setUseChangeTransactionMode(!1),console.log("Launch real Export/Print"),g._progressDiag.setProgress(100),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!1}})),setTimeout(function(){g._progressDiag.close(),delete g._progressDiag},200),g.enable()}),g.enable()}}.bind(this))},__askStopOrContinue:function(){var t=this,o=!1,i=!1;return new Promise(function(n){require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(s,r){t.modalStop=new s({domId:"enx-exportAsCmd",target:t.targetDiv,title:e.ExportAsContinueTitle,width:310,content:e.replace(e.ExportAsContinueContent,{nbNodes:1e3}),buttons:{No:new r({domId:"enx-exportAsCmd-skip",label:e.ExportSkip,onClick:function(){o=!0,n(!0),t.modalStop.options.checkboxInfos.checkFlag&&(u.set("continueOrSkip",!0),u.set("dontAskDecision",!0)),t.modalStop.close()}}),Yes:new r({domId:"enx-exportAsCmd-continue",label:e.ExportContinue,onClick:function(){i=!0,n(!1),t.modalStop.options.checkboxInfos.checkFlag&&(u.set("continueOrSkip",!0),u.set("dontAskDecision",!1)),t.modalStop.close()}})},checkboxInfos:{label:e.DonotShowAgain,checkFlag:!1},closeCB:function(){o||i||t._setCancelProcess(!0),n(!0)}}),document.querySelector(".wux-windows-window-content").style.background="white"})})},_getAllVisibleNodes:function(e){var t=[],o=e.getRoots();return o.length&&o.forEach(function(e){e.isVisible()&&(t.push(e),e.processDescendants({processNode:function(){this.isVisible()&&t.push(this)}}))}),t},_setCancelProcess:function(e){h=e}})}),define("DS/ENXNav/commands/FindInCtxCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{monoselection:!0})},execute:function(){var e=this;require(["DS/ENXNav/utils/FindInCtx"],function(t){var i=o.get().getSelectedNodes(),n=e.getArguments();1===n.length&&(e.targetDiv=document.querySelector("."+n[0].Value),t.launchFindWithDialog({position:e.options.position,renderTo:e.targetDiv,node:i[0]}))})}})}),define("DS/ENXNav/commands/CollapseThumbsCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{lessExpanded:!0}),e.viewMgt(this.options.ID,{nodgv:!0,notiles:!0,nothumbs:!0})},execute:function(){var t=o.get(),i=t.getSelectedNodes();t.options.views.graphview.setGroupThumbnailState({nodes:i,expanded:!0}),e.checkAvailability()}})}),define("DS/ENXNav/views/private/ExpandLevelSelector",["css!DS/ENXNav/ENXNav.css","DS/ENXNav/views/private/LevelSelector","DS/PADServices/views/ENXModal","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,i){"use strict";function n(e){return this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.__buildView(),this}return n.prototype.getContent=function(){return this.elements.container},n.prototype.__buildView=function(){var e=this;this.elements.levelSelectorContainer=new t({onLevelSelectorSet:function(t){"function"==typeof e.options.events.onLevelSelectorSet&&e.options.events.onLevelSelectorSet(t),e.close()},onLevelSelectorClose:function(){e.close()}});var i={of:this.options.target,my:"bottom center",at:"bottom center",offsetX:0,offsetY:-80};if(this.options.position&&this.options.position.x){var n=this.options.position.x-250;n<0&&(n=this.options.position.x);var s=this.options.position.y+30;i={of:this.options.target,my:"top left",at:"top left",offsetX:n,offsetY:s}}var r=document.querySelector(".enx-appMainBody");e.elements.modalFts=new o({target:r,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",content:this.elements.levelSelectorContainer.getContent(),position:i,events:{onClickOutsideContent:function(){e.close()}}}),e.elements.modalFts.getContent().addClassName("enx-ExpandLevelSelectorModal"),e.elements.modalFts.getContent().querySelector(".wux-windows-window-content").setStyle("padding","3px")},n.prototype.close=function(){this.options.events&&this.options.events.onClose&&this.options.events.onClose(),this.elements.modalFts.close()},n}),define("DS/ENXNav/models/xNavNodeModel",["DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/AttributesMgtV2","DS/ENOXParser/modules/common/Helpers","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalUtils"],function(e,t,o,i,n,s,r,a){"use strict";function l(e){e._getFilterInfo||(e._getFilterInfo=c.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=c.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=c.prototype._removeChildrenFilterInfo.bind(e),e.filterInChild=c.prototype.filterInChild.bind(e),e.filterOutChild=c.prototype.filterOutChild.bind(e))}var d={label:"",icons:[],grid:{},padgrid:{},resourceid:"",type:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,isReadOnly:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,contextualMenu:[{type:"SeparatorItem"}],synthesis:{},excludedOccurences:[],uniqueIdentifier:null};function c(o){if(!0===o.isGroupingNode)return function(o){this.options=UWA.clone(p),!0===r.getSetting("grpBSD")&&(this.options.icons=[t.getWebappsAssetUrl("ENXNav","icons/22/I_OrganizeBSD.png")]);this.options=UWA.extend(this.options,o),e.call(this,this.options),this.isGroupingNode=!0,this.isRelationsObjectNode=!0}.call(this,o);if(this.options=UWA.clone(d),o&&o.grid){this.options.subLabel=o.grid["ds6w:responsible"],this.options.description=o.grid["ds6w:identifier"],this.options.thumbnail=o.thumbnail?o.thumbnail:t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png");var s=o.grid["ds6w:reserved"]?o.grid["ds6w:reserved"]:o.padgrid&&o.padgrid["ds6w:reserved"]?o.padgrid["ds6w:reserved"]:null;if(null!==s)if("boolean"==typeof s?s:"TRUE"===s.toUpperCase())this._isLockedByMe(o)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]);else this.options.statusbarIcons=["lock-open"],this.options.statusbarIconsTooltips=[i.tooltip_unreserved]}o&&UWA.is(o.relcount)&&0===o.relcount&&(o.children=null),this.options.acceptNodeDropAt=function(e,t){return this.isRoot()?0===t:-1===t||1===t},this.options=UWA.extend(this.options,o),this.options.relationOrder||(this.options.relationOrder=-1),this.options.grid||(this.options.grid={}),this.options.grid.instanceName&&(console.warn("xNavNodeModel: Please use ds6w:label-Instance instead of instanceName"),this.options.grid["ds6w:label-Instance"]=this.options.grid.instanceName,delete this.options.grid.instanceName);for(var a=this.options,l=n.getColumnsOrder(),c=Object.keys(a.grid),u=0;Array.isArray(l)&&u<l.length;u++)"tree"!==l[u]&&-1===c.indexOf(l[u])&&(a.grid[l[u]]=void 0),a.grid[l[u]]&&!isNaN(a.grid[l[u]])&&(this.isNumber(a.grid[l[u]])?a.grid[l[u]]=parseInt(a.grid[l[u]],10):this.isFloating(a.grid[l[u]])&&(a.grid[l[u]]=parseFloat(a.grid[l[u]])));var h=n.getAdditionalColumns();for(u=0;Array.isArray(h)&&u<h.length;u++)a.grid&&void 0===a.grid[h[u]]&&(a.grid[h[u]]="");a.getAttributeValueForFiltering=function(t){return a.grid[t+"-original"]?a.grid[t+"-original"]:e.prototype.getAttributeValue.call(this,t)}.bind(this),e.call(this,this.options)}var p={kind:"groupingNode",label:"",resourceid:"",icons:[{iconName:"group"}],grid:{},children:[],thumbnail:null,useAsyncPreExpand:!0,parentNode:null,contentRetrieved:!1,ds6w:"",grp:"",uql:null,grpSelected:!1};function u(e,t){return!!(e instanceof c)&&e.getID()===t}function h(e,t,o){if(e)for(let i=0;i<e.length;i++){const n=e[i];if(a.isFakeTreeNodeModel(n)){h(n.getChildren(),t,o)}else n.isGroupingNode?n._getNodesByRelIdInGroup(t,o):n._getNodesByRelId(t,o)}}return c.prototype=Object.create(e.prototype),c.prototype.isSupplemental=function(){return!0===this.options.supplementalNode},c.prototype.queueNls=function(){let e=this;require(["DS/PADServices/utils/DictionaryAccess"],function(t){t.updateNLS(e)})},c.prototype.reverseExpand=function(t){var o=t||{},i={ids:[],relids:[]};if(o.state&&"partiallyExpanded"===o.state)for(var n=this;n&&!n.isRoot();)!0===n.options.waiting4validation&&(-1===i.ids.indexOf(n.getID())&&i.ids.push(n.getID()),-1===i.relids.indexOf(n.getRelationID())&&i.relids.push(n.getRelationID())),(n=n.getParent()).isExpanded()||n.setState({state:o.state});else e.prototype.reverseExpand.call(this);return i},c.prototype.isFloating=function(e){return"number"==typeof e&&!Number.isInteger(e)},c.prototype.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},c.prototype.getFarthestParent=function(){for(var e=this;e&&!e.isRoot();)if(!(e=e.getParent())){e=this;break}return e},c.prototype.getOccurencePath=function(t){if(this.getParent()&&(!0===this.options.isGroupingNode||this.getNodeSource()===e.NODE_SOURCE.GROUPING))return this.getParent().getOccurencePath(t);if(UWA.is(t,"function")&&t(this),!this.isRoot()&&this.getParent()){for(var o=this.getParent();o.getNodeSource()===e.NODE_SOURCE.GROUPING;)o=o.getParent();var i=o.getOccurencePath(t);return this.options.relationid&&i.push(this.options.relationid),this.options.resourceid&&!this.options.resourceid.includes("fakeNode")&&i.push(this.options.resourceid),i}return[this.options.resourceid]},c.prototype.getOccurencePathWithType=function(){if(!0===this.options.isGroupingNode||this.getNodeSource()===e.NODE_SOURCE.GROUPING)return this.getParent().getOccurencePathWithType();if(!this.isRoot()&&this.getParent()){for(var t=this.getParent();t.getNodeSource()===e.NODE_SOURCE.GROUPING;)t=t.getParent();var o=t.getOccurencePathWithType();return o.push({resourceid:this.options.relationid,type:this.options.relationtype}),o.push({resourceid:this.options.resourceid,type:this.options.type}),o}return[{resourceid:this.options.resourceid,type:this.options.type}]},c.prototype.getNodeByPath=function(t,o,i,n){("number"!=typeof o||o<0)&&(o=0),("number"!=typeof i||i<0||i>=t.length)&&(i=t.length-1);var s=t.indexOf(this.options.resourceid),r=function(){if(o!==i&&(this.isExpanded()||this.childComputed||void 0!==n&&!1!==n)){var s=t[o+1],r=this.getChildren();if(r&&0!==r.length){for(var a=null,l=0;l<r.length&&null===a;l++){var d=r[l];if(!0===d.isGroupingNode)a=d.getNodeByRelIDInGroup(s);else if(d.getNodeSource()===e.NODE_SOURCE.GROUPING){let e=d.getChildren();for(var c=0;c<e.length&&null===a;c++){let t=e[c];!0===t.isGroupingNode?a=t.getNodeByRelIDInGroup(s):s===t.options.relationid&&(a=t)}}else s===d.options.relationid&&(a=d)}return null===a?this:a.getNodeByPath(t,o+2,i,n)}return this}return this}.bind(this);return this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(t[o])>=0||this.options.resourceid===t[o]?r():void 0!==typeof s&&-1!==s?(t=t.slice(s,t.length),r()):void 0},c.prototype.getFirstNodeInPath=function(e,t,o){var i={node:null,find_in_ctx_path:[]};if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t===o||!this.isExpanded())return i.node=this,t!==o&&(i.find_in_ctx_path=e.slice(t,e.length)),i;var n=e[t+1],s=this.getChildren();if(0===s.length)return i.node=this,i.find_in_ctx_path=e.slice(t,o-t+1),i;for(var r=!0,a=0;a<s.length;a++){var l=s[a];if(n===l.options.relationid)return r=!1,l.getFirstNodeInPath(e,t+2,o)}if(!0===r)return i.node=this,i.find_in_ctx_path=e.slice(t,o-t+1),i}},c.prototype.getID=function(){return this.options.resourceid},c.prototype.getRelationID=function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},c.prototype.setRelationID=function(e,t){this.options.relationid=e,this.options.relationtype=t},c.prototype.setUniqueIdentifier=function(e){this.options.uniqueIdentifier=e},c.prototype.getUniqueIdentifier=function(){return this.options.uniqueIdentifier},c.prototype.getNodesById=function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},c.prototype.getChildById=function(e){var t,o=this.getChildren();if(o)for(var i=0;i<o.length;i++)if(o[i].getID()===e){t=o[i];break}return t},c.prototype.getChildByIds=function(e,t){if(!0===this.options.isGroupingNode)return function(e,t,o){var i,n=e.getChildren();for(let e=0;n&&e<n.length;e++){var s=n[e];if(!0===s.isGroupingNode){if(void 0!==(i=s.getChildByIds(t,o)))break}else if(void 0===t){if(s.getID()===o){i=s;break}}else if(s.getRelationID()===t){i=s;break}}return i}(this,e,t);var o,i=this.getChildren();if(i)for(var n=0;n<i.length&&void 0===o;n++){var s=i[n];if(!0===s.isGroupingNode){var r=s.getChildren();for(let i=0;r&&i<r.length&&void 0===o;i++){var a=r[i];if(!0===a.isGroupingNode){if(void 0!==(o=a.getChildByIds(e,t)))break}else if(void 0===e){if(a.getID()===t){o=a;break}}else if(a.getRelationID()===e){o=a;break}}}else if(void 0===e){if(s.getID()===t){o=s;break}}else if(s.getRelationID()===e){o=s;break}}return o},c.prototype.getChildNodesByRelId=function(e){let t=this.getChildren(),o=null;if(t&&t.length)for(let i=0;null===o&&i<t.length;i++){let n=t[i];n.getRelationID()===e&&(o=n)}return o?[o]:[]},c.prototype.getNodesByRelId=function(e){var t={listOfFoundNodes:[],foundId:void 0};return this._getNodesByRelId(e,t),t.listOfFoundNodes},c.prototype._removeFilterInfo=function(){delete this.options._filterInfo},c.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},c.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},c.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},c.prototype.filterOut=function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(l(e),e.filterOutChild(this))},c.prototype.filterIn=function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var o=t.parentBeforeFiltering;l(o),o.filterInChild(this)}if(Boolean(e)){var i,n=this._getChildrenFilterInfo();(i=n&&n.childrenBeforeFiltering?n.childrenBeforeFiltering:this.getChildren())&&i.forEach(function(t){t.filterIn(e)})}},c.prototype.filterOutChild=function(e){var t=this.getChildren();if(t.indexOf(e)<0)throw"Not a child";var o=this._getChildrenFilterInfo(!0);if(!o.childrenBeforeFiltering){o.childrenBeforeFiltering=t&&t.length>0?t.slice(0):[];UWA.is(this._expandState)&&(o.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}e._getFilterInfo(!0).parentBeforeFiltering=this,UWA.is(this.removeChild,"function")?this.removeChild(e):this.removeRoot(e,!0,!0),UWA.is(this.setState,"function")&&this.setState({state:o.expandStateBeforeFiltering}),o.filteredOutChildren||(o.filteredOutChildren=[]),o.filteredOutChildren.push(e)},c.prototype.filterInChild=function(e){var t=this._getChildrenFilterInfo();if(t){var o=t.childrenBeforeFiltering;if(o){var i=o.indexOf(e);if(i>=0){var n=e._getFilterInfo();if(n&&n.parentBeforeFiltering===this){var s,r=this.getChildren();if(r)for(var a=0;a<r.length;a++){var l=r[a];if(o.indexOf(l)>i){s=l;break}}delete n.parentBeforeFiltering,void 0!==e.options.isRootAttached?!0===e.options.isRootAttached&&this.insertBefore(e,s):this.insertBefore(e,s),UWA.is(this.setState,"function")&&this.setState({state:t.expandStateBeforeFiltering}),e._removeFilterInfo();var d=t.filteredOutChildren.indexOf(e);t.filteredOutChildren.splice(d,1),0===t.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}}},c.prototype._getNodesById=function(e,t){var o=!1;if(u(this,e))t.listOfFoundNodes.push(this),o=!0;else{let i=this.search({useTransaction:!1,match:function(t){return u(t.nodeModel,e)}});t.listOfFoundNodes.push(...i),o=i.length>0}return o},c.prototype._getNodesByRelId=function(e,t){var o=this.options.relationid,i=this.getID();if(o===e)t.listOfFoundNodes.push(this),t.foundId=i;else if(i!==t.foundId){h(this.getChildren(),e,t)}},c.prototype._getNodesByRelIdInGroup=function(e,t){this.getID();h(this.getChildren(),e,t)},c.prototype.updateFromFetch=function(e,t){this.updateAttributes(e.attributes,t)},c.prototype.updateAttributes=function(e,t){if(!UWA.is(e,"array")||!UWA.is(t,"array"))throw new Error("Invalid argument(s)");var o=t,i=t.tree?t.tree:n.getTreeColumn(),s={};e.forEach(function(e){UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(s.type=e.value),e.name===i?s.label=e.value:"type_icon_url"===e.name?(s.icons=[],s.icons.push(e.value)):"preview_url"===e.name||"thumbnail_2d"===e.name?(s.thumbnail=e.value,s.grid||(s.grid={}),s.grid.thumbnail="url("+e.value+")"):-1!==o.indexOf(e.name)?(s.grid||(s.grid={}),s.grid[e.name]=e.value):-1!==o.indexOf(e.name)||"ds6w:reservedBy-Instance"!==e.name&&"ds6w:reservedBy"!==e.name||(s.grid||(s.grid={}),s.grid[e.name]=e.value)}),this.updateOptions(s)},c.prototype.updateNlsAttributes=function(e){var t={};for(var o in e)for(var i in t.grid||(t.grid={}),e[o])this.options.grid[o]===i&&(t.grid[o]=e[o][i]);t.grid=UWA.extend(this.options.grid,t.grid,!0),this.updateOptions(t)},c.prototype.getFirstCommonAncestor=function(e){if(this===e)return e;for(var t,o,i=this.getPath(),n=e.getPath(),s=Math.min(i.length,n.length),r=0;r<s;r++)if(i[r]!==n[r]){t=r;break}return t>0?o=i[t-1]:void 0===t&&(o=i[s-1]),o},c.prototype.isDescendantOf=function(e){if(!0===this.options.isGroupingNode)return this.getParent().isDescendantOf(e);var t;if(t=e instanceof c?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var o=this.getRealParent();if(o)return o.isDescendantOf(t)}return!1},c.prototype.getDepth=function(){for(var e=this,t=0;!e.isRoot();){var o=e.getParent();if(null===o)break;!0!==o.isGroupingNode&&t++,e=o}return t},c.prototype.getLeaves=function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},c.prototype.getRealParent=function(){let t=this.getParent();if(!this.isRoot()&&t)for(;t&&(!0===t.isGroupingNode||t.getNodeSource()===e.NODE_SOURCE.GROUPING);)t=t.getParent();return t},c.prototype.getAttribute=function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},c.prototype.updateOptions=function(o){if(o.grid){this.options.thumbnail||o.thumbnail||(o.thumbnail=t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),o.subLabel=o.grid["ds6w:responsible"]?o.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",o.description=o.grid["ds6w:identifier"]?o.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"";var n=void 0!==o.grid["ds6w:reserved"]?o.grid["ds6w:reserved"]:o.padgrid&&void 0!==o.padgrid["ds6w:reserved"]?o.padgrid["ds6w:reserved"]:null;if(null!==n)if("boolean"==typeof n?n:"TRUE"===n.toUpperCase())this._isLockedByMe(o)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]);else o.statusbarIcons=["lock-open"],o.statusbarIconsTooltips=[i.tooltip_unreserved]}if(this.options.edit&&(o.edit=this.options.edit),o.grid){let e=Object.keys(this.options.grid);for(let t=0;t<e.length;t++)e[t].contains("-original")&&o.grid[e[t].replace("-original","")]&&delete this.options.grid[e[t]]}if(this.options.deType&&o.display){let e=this.getTreeDocument().options.context;e.hasActiveDesignExp()&&e.getPseService().updateModifiedAssetTitle(o.display,o.resourceid)}let s=this.getTreeDocument(),r=!1;this.isRoot()&&o.label&&o.label!==this.options.label&&(r=!0),e.prototype.updateOptions.call(this,o),r&&function(e){var t=e.getRoots();e.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.length,added_node:t[t.length-1]}})}(s)},c.prototype.childValidationChecker=function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])}))})}},c.prototype._isLockedByMe=function(e){var t=!0,o=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"";Array.isArray(o)&&(o=o.join(","));var i=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",n=require("DS/PADUtils/PADUtilsServices"),s=n.getUserLogin()?n.getUserLogin():"",r=n.getUserName()?n.getUserName():"";t=!0;return o.trim().length>0?(t=o.toUpperCase().trim()===s.toUpperCase().trim()||!1)||(t=o.toUpperCase().trim()===r.toUpperCase().trim()||!1):i.trim().length>0&&(t=r.toUpperCase().trim()===i.toUpperCase().trim()||!1),t},c.prototype.childValidationChecker=function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])}))})}},c.prototype.getPLMValue=function(e){var t=null;return n.getTreeColumn()===e?t=this.getLabel():void 0!==this.options.grid[e]?t=this.options.grid[e]:this.options.padgrid&&void 0!==this.options.padgrid[e]&&(t=this.options.padgrid[e]),t},c.prototype.hasSynthesis=function(){return!0===this.options.filtered?void 0!==this.options.synthesis.filteredSynthesis:void 0!==this.options.synthesis.global},c.prototype.setSynthesis=function(e){!0===this.options.filtered?this.options.synthesis.filteredSynthesis=e:this.options.synthesis.global=e},c.prototype.getSynthesis=function(e){return!0===this.options.filtered?this.options.synthesis.filteredSynthesis[e]:this.options.synthesis.global[e]},c.prototype.setExcludedOccurrences=function(e){this.options.excludedOccurences=e;let t=this.getTreeDocument();e&&e.length&&t.isEditor()&&t.bubbleStaticMapMessageOnce()},c.prototype.getExcludedOccurrences=function(){return this.options.excludedOccurences},c.prototype.cleanUpPathes=function(){if(this.options.excludedOccurences&&this.options.excludedOccurences.length)for(let e=0;e<this.options.excludedOccurences.length;e++){let t=this.options.excludedOccurences[e],o=t[t.length-1],i=this.getNodesById(o);for(let e=0;e<i.length;e++)s.array.compare(t,i[e].getOccurencePath())&&i[e].remove()}},c.prototype.getGroupID=function(){return this.getGroups().join("/")},c.prototype.getGroupObjID=function(){return!0===this.getParent().isGroupingNode?this.getParent().getGroupObjID():this.getParent().getID()},c.prototype.getPredicate=function(){return this.options.ds6w},c.prototype.getGroups=function(){var e;!0===this.options.merged?e=this.options.grp:e=require("UWA/Utils").splat(this.options.grp);return e},c.prototype.getFilterUQL=function(){if(null===this.options.uql){var e=this.getGroups().join("/");this.options.uql="["+this.options.ds6w+"]=("+e+")"}return this.options.uql},c.prototype.getNodeByRelIDInGroup=function(t){var o=null,i=this.getChildren();for(let n=0;n<i.length&&null===o;n++)if(!0===i[n].isGroupingNode)o=i[n].getNodeByRelIDInGroup(t);else if(i[n].getNodeSource()===e.NODE_SOURCE.GROUPING){let e=i[n].getChildren();for(let i=0;i<e.length&&null===o;i++){let n=e[i];o="function"==typeof n.getRelationID&&n.getRelationID()===t?n:n.getNodeByRelIDInGroup(t)}}else i[n].getRelationID()===t&&(o=i[n]);return o},c.prototype.isGrpSelected=function(){var e=this.options.grpSelected;if(!1===e){var t=this.getParent();!0===t.isGroupingNode&&(e=t.isGrpSelected())}return e},c.prototype.getCellTooltip=function(e){var t,n=e.nodeModel.getTreeDocument(),s=!1;if(n&&"structured"===n.getGroupLayout()&&(s=!0),this.options.dispText)t={shortHelp:this.options.dispText,updateModel:!1};else if(!0===s||!0===this.options.isOther)t={shortHelp:this.getLabel(),updateModel:!1};else{let n=this.getTreeDocument();if(n&&n.isGroupingApplied())t=0===(t=this.getGroups().join("/")).length?{shortHelp:this.getLabel(),updateModel:!1}:{title:this.options.bsIntent?i.replace(i.organizeBS.groupBy,{label:this.options.bsIntent.predicate.label}):void 0,updateModel:!1};else{let i=e.cellView.collectionView;t=o.executeGenericTooltip(e,i)}}return t},c}),define("DS/ENXNav/models/mixins/TreeDocShared",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/Batches","DS/PADServices/utils/Iterator","DS/ENOXParser/modules/TwoDParser","DS/ENXNav/models/SmartNodeOptions","DS/ENOXParser/modules/common/Helpers","DS/PADServices/ws/WSAccess"],function(e,t,o,i,n,s,r){function a(){}return a.prototype={updateNodesAttributesValue:function(o,n){for(var a=this,l=require("DS/PADServices/utils/AttributesMgtV2"),d=0;d<n.length;d++)l.addBIColumn(n[d],e.getSetting("synthesisModeOnInstance"));var c=n.slice();-1===c.indexOf("ds6w:globaltype")&&c.push("ds6w:globaltype");var p={select_predicate:c,select_file:[]};let u=e.getSetting("webapi_timeout");u<=3e4&&o.length>=1e3&&(u=6e4);return t.waiting(o,1e3,1e3,function(e,t){return new Promise(function(o,n){p.physicalid=e;let l=function(){console.log(`>> complete ${t}`),o({batchId:t,localIds:e})};r.fetch({data:p,enopad_webapis:!1,pids:e,noCompletion:!0,timeout:u}).then(function(t){var o=s.data.jsonParse(t);i.parseMultiFetch({treeDoc:a,results:o.results,refresh_parameters:{modified:e}}).then(function(){setTimeout(l,50)})}).catch(function(e){console.error(e),n({err:e})})})})},additionalColumnUpdateByModule:function(e,t){let i=this;if(!t.pids&&!t.relids)return void console.error("no to refresh");let r=new Map;t.pids&&o.iterate(t.pids,function(e){r.set(e,i.getNodesById(e))});let a=new Map;t.relids&&o.iterate(t.relids,function(e){a.set(e,i.getNodesByRelId(e))});let l=this.getVisibleAdditionalColumns(),d=null;if(o.iterate(l,function(t){t.module.getName()===e&&(d=t.module)}),d){let l={pids:t.pids,relids:t.relids};function c(e){o.iterate(e,function(e){o.iterate(e.nodeArray,function(t){let o=new n(t);o.update(e.attrUpdate),o.execute()})})}l.pids||(l.pids=[]),l.relids||(l.relids=[]),new Promise(function(t,o){console.time(e),d.updateAttributes(l,function(o){console.timeEnd(e);let i=s.data.jsonParse(o);t(i)})}).then(function(e){i.setUseChangeTransactionMode(!0),i.withTransactionUpdate(function(){if(e.pids&&t.pids){c(t.pids.map(function(t){return{attrUpdate:{grid:e.pids[t]},nodeArray:r.get(t)}}))}if(e.relids&&t.relids){c(t.relids.map(function(t){return{attrUpdate:{grid:e.relids[t]},nodeArray:a.get(t)}}))}}),i.setUseChangeTransactionMode(!1)})}}},a}),define("DS/ENXNav/models/mixins/TreeDocAdditionals",["UWA/Core","DS/PADServices/settings/AppSettings","DS/PADServices/utils/Iterator","DS/ENXNav/models/AdditionalRelDummyInfo","DS/PADServices/utils/GlobalUtils"],function(e,t,o,i,n){const s=["SyncModelRefresh","SyncModelNodes","OnReady","OnSyncModel","OnScrollEnd","ExportAs"],r=["ENODOFormatStatus_Col","ENOXCADSyncStatus_Col"];function a(e,t){let o={};for(let i=0;i<e.length;i++)o[e[i]]=t.options.grid[e[i]];return o}function l(e){return n.isFakeTreeNodeModel(e)?e.getParent().getID():e.getID()}function d(e){return n.isFakeTreeNodeModel(e)?e.getParent().getRelationID():e.getRelationID()}function c(e,t,o,i,n,c){let p=Array.isArray(i);if(!0!==e.isRelationsObjectNode)for(let u=0;u<o.length;u++){const h=o[u],g=h.getManagedColumnNames();let f=a(g,e),v=!1;const m="function"==typeof h.getAutoReloadNames?h.getAutoReloadNames():[];f={...f,...a(m,e)};const D=Object.keys(f);if(p){let e={};for(let t=0;t<D.length;t++)-1!==i.indexOf(D[t])&&(e[D[t]]=f[D[t]],v=!0);f=e}else D.length&&(v=!0);if(!0===v&&h.toBeUpdated(f,c)&&s.includes(c)){void 0===t[h.getName()]&&(t[h.getName()]={pids:[],relids:[],pairs:{}});let o=l(e);-1===t[h.getName()].pids.indexOf(o)&&t[h.getName()].pids.push(o);const i=d(e);i&&-1===t[h.getName()].relids.indexOf(i)&&(t[h.getName()].relids.push(i),t[h.getName()].pairs[o]=i)}else s.includes(c)&&r.includes(h.getName())&&n.addOtherKeys(g)}else n.addRelationNode(e)}function p(o,i,n){var s=n;return e.is(o.filterAttributesForUpdate,"function")&&(s=o.filterAttributesForUpdate({node:i,node_opts:s})),-1===s.relationOrder&&(s.relationOrder=i.options.relationOrder),!0===t.getSetting("tree_order_in_label")&&s.label&&(s.label+="(treeorder="+s.relationOrder+")"),s}function u(e){this.name=e,console.time(this.name)}function h(){}return u.prototype={end:function(){console.timeEnd(this.name)}},h.prototype={fillAttributesAsync4VisibleNodes:function(e,t,o){this.fillAttributesAsync(e,o)},fillAttributesAsync:function(e,t){if(this._pendingNodes||(this._pendingNodes=[]),this._pendingAttr)return void(this._pendingNodes=this._pendingNodes.concat(e));e=e.concat(this._pendingNodes),this._pendingNodes.length=0,this._pendingAttr=!0;let o=this;var i=function(){o._pendingAttr=!1},n=function(){o.fillAttributesAsync([],t)};this.fillAdditionalColumns(e,null,t).then(function(t){var s,r;i(),t&&t.updates&&(o._pendingNodes=(s=o._pendingNodes,r=e,s.filter(function(e){return-1===r.indexOf(e)})),o._pendingNodes.length&&setTimeout(n,0))}).catch(i)},fillAdditionalColumns:function(t,n,s){let r=this;return new Promise(function(a,l){let d=new i;if(t.length)if(r.options.additionalColumnsModules&&r.options.additionalColumnsModules.length){let i=!1;"ExportAs"===s&&(i=!0);var h=r.getVisibleAdditionalColumns(i);h.length?require(["DS/ENXNav/models/Algos"],function(i){var l={};new Promise(function(e){for(var o=0;o<t.length;o++)c(t[o],l,r.options.additionalColumnsModules,n,d,s);e()}).then(function(){for(var t=[],n=0;n<h.length;n++){var s=h[n],c=s.module.getName();if(l[c]){let o=new u(c+"...updateAttributes");var g=new Promise(function(t){s.module.updateAttributes(l[c],function(i){var n=e.is(i,"string")?JSON.parse(i):i;t(n),o.end()},r)});t.push(g)}}t.length?Promise.all(t).then(function(t){let n=function(t){var o={},i=!1,n=!1;let s=[];for(var r=0;r<t.length;r++){let n=t[r],a=Object.keys(n.pids),l=Object.keys(n.relids),d=a.length>0&&0===l.length;s.push(d),!i&&d&&(i=d),e.extend(o,n,!0)}return s.filter(function(e){return!1===e}).length!==s.length&&(n=!0),{merger:o,hasPidOnlyUpdate:i,isMixed:n}}(t),s=n.merger,l=n.hasPidOnlyUpdate,c=n.isMixed;r.setUseChangeTransactionMode(!0),r.withTransactionUpdate(function(){var e=0,t=Object.keys(s.pids),n=Object.keys(s.relids),a=[];if(n)for(var d=0;d<n.length;d++){if((f=r.getNodesByRelId(n[d]))&&f.length)for(e=0;e<f.length;e++){let l=f[e];var u=i.extractGridChanges(p(r,f[e],{grid:s.relids[n[d]]}),l.options);u.hasChanged&&l.updateOptions(u.finalResults);var h=l.getID();if(-1!==t.indexOf(h)&&(a.push(h),c)){let e=s.pids[h];o.iterate(u.updatedProps,function(t){delete e[t]})}}else console.warn("Should not happen. The node should be found")}if(l||a.length&&o.iterate(a,function(e){var o=t.indexOf(e);-1!==o&&t.splice(o,1)}),t&&t.length>0)for(var g=0;g<t.length;g++){var f;if((f=r.getNodesById(t[g]))&&f.length)for(e=0;e<f.length;e++){var v=i.extractGridChanges(p(r,f[e],{grid:s.pids[t[g]]}),f[e].options);v.hasChanged&&f[e].updateOptions(v.finalResults)}else console.warn("Should not happen. The node should be found")}}),d.applyMerger(s),r.setUseChangeTransactionMode(!1),a({updates:!0})}):a()})}):a()}else a();else a()})}},h}),define("DS/ENXNav/models/mixins/TreeDocAccess",["DS/TreeModel/TreeDocument","DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/HideShowCtrl","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt"],function(e,t,o,i,n){"use strict";const s=[];function r(){}return r.prototype={forceSyncModel4TreeListView:function(){},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(o){var i=o.getNodesById(e);t=t.concat(i)}),t},getNodeByOccurencePath:function(e){if(n.getSetting("explorerOcc"))return this.getNodeFromPath(e)||this.getNodeFromPath([e[0]]);{const t=this.getRoots();for(let o=0;o<t.length;o++){const i=t[o].getNodeByPath(e,void 0,void 0,!0);if(i)return i}}},removeRootsQuiet:function(e,t){let o=this,i=void 0===t||!t,n=e.map(function(e){return e.getID()});if(this.wrapInTransaction(function(){o._doNotBroadcastSelect=!0;for(let t=0;t<e.length;t++){let i=e[t];o._skipFilterProxy=!0,o.removeRoot(i),o._skipFilterProxy=!1}o._doNotBroadcastSelect=!1}),i){this.getModelEvents().publish({event:"onRemoveRoots",data:{pids:n}});let e=this.getRoots(),t=(this.detachedRoots?this.detachedRoots.length:0)+e.length;if(t){let o=e[0];this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:o,nb_root:t}})}}},removeRoot:function(e,o,i){if(this._doNotBroadcastSelect=!0,this.invalidateViewPort(),this._parent(e),t.removeRoot(),this._doNotBroadcastSelect=!1,!UWA.is(o,"boolean")||!o){var n=this.getRoots().length;if(this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:e.getID(),remainingRoots:n}}),n>0){var s=null;this.getRoots().length>0&&(s=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:s,nb_root:n}})}}},searchRootById:function(e){for(var t,o=this.getRoots(!0),i=0;i<o.length;i++)if(o[i].options.resourceid===e){t=o[i];break}return t},getNodesByRelId:function(e){var t=[];return this.getRoots().forEach(function(o){var i=o.getNodesByRelId(e);t=t.concat(i)}),t},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(o){!function e(t,o,i,n){if(t.getID()===o[i])if(i===o.length-1)n.push(t);else{var s=t.getChildren();s&&s.length>0&&(i+=1,s.forEach(function(t){e(t,o,i,n)}))}}(o,e,0,t)}),t},deleteNodes:function(e,t){var n=this;let s=[];n.withTransactionUpdate(function(){var r={detach:{deleted:[]}};e.forEach(function(e){if(e.isRoot())n.removeRoot(e);else{var t=e.getParent(),a=t.getState();e.remove(),t.hasChildren()?s.push(...t.getLeaves()):(t.options.isHiddenState!==o.STATES.MIXED&&t.options.isHiddenState!==o.STATES.HIDDEN||t.options.isHiddenStateFrom===o.FROM.PGP||t.updateOptions({isHiddenState:o.STATES.SHOWN}),s.push(t)),r.detach.deleted.push(e.getID()),"partiallyExpanded"!==a||t.options.children||(t.options.children=[],t.setState({state:"collapsed"}));let n=s.filter(e=>e.options.isHiddenState===o.STATES.SHOWN),l=s.filter(e=>e.options.isHiddenState===o.STATES.HIDDEN);n.length&&i.publish({event:"ENXModel/hideShowState",target:n,data:{toggle:"show",fromUI:!0}}),l.length&&i.publish({event:"ENXModel/hideShowState",target:l,data:{toggle:"hide",fromUI:!0}})}}),!0===t&&n._cmdProxy.padRefresh(r)})},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var i=0;i<t.length;i++){var n=o.getNodeByPath(t[i],void 0,void 0,!0);n&&e.push(n)}}):e=this.getXSO().get();return e},getDetachedRoots:function(){return s},getVisibleNodes:function(){let e=[];return this.processDescendants({processNode:function(){this.isHidden()||e.push(this)}}),e},wrapInTransaction:function(e){try{e()}catch(e){}}},r}),define("DS/ENXNav/models/mixins/TreeDocSelect",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/CompassUtils","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/CommandProxy","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/utils/OFW"],function(e,t,o,i,n,s,r,a){"use strict";function l(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var i=0;i<o;i++)if(e[i]!==t[i])return!1;return!0}return!1}return!1}function d(){}return d.prototype={_broadcastSelect:!0,_selected_paths:!0,initSelectCB:function(){var e=this,t=function(){r.publish({event:"ENXModel/NodeModelUpdate"}),e._doNotBroadcastSelect||(e._directSelection=!0,e._selected_paths=[],e._cmdProxy.select(e._buildSelectData()),!0===e._broadcastSelect&&!0===e.options.authorize_setStructure&&(o.setObject({nodes:e.getXSO().get()}),a.setTypesForOFW(e))),0===e.getSelectedNodes().length&&null!==e._pagerview&&!0!==e._focusOn&&!0!==e._reframeFocus&&(e._pagerview.hide(),delete e._pagerview,e._reframeFocus=!1)};this.getXSO().onPostAdd(function(){t()}),this.getXSO().onPostRemove(t),this.getXSO().onEmpty(function(){!1===e._emptyFromProxy?e._pagerview?(e.searchProgress||!0===e._focusOn||e.closePager(),!0!==e._focusOn&&e.closePager()):e._inBatchingForUpdate||(e._doNotBroadcastSelect=!1):e._emptyFromProxy=!1,t()}),this.getXSO().onPreEmpty(function(){!1===e._emptyFromProxy&&(e._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(t){27===t.keyCode&&(e.getXSO().empty(),e.restoreSelection())})},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(o.setObject({nodes:this.getSelectedNodes()}),a.setTypesForOFW(this))},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){this._cmdProxy.select(this._buildSelectData()),this.broadcastSelect(!0),this._doNotBroadcastSelect=!1},restoreSelection:function(e){if(this.originalSelection){let t=this,o=function(){t._selected_paths=t.originalSelection,t._selectOccurence("FocusOn")};e?o():this.withBroadcastSelect(o)}},isDirectSelection:function(){return this._directSelection},_onSelectProxy:function(e,o){let n=this;if(!this._insertFlag&&!0!==e.searchDone){if(1==e.focusOn&&e.sharedID&&e.sharedID!==i.getSharedId()||(d=e.paths).filter(function(e){return e.length%2==1}).length!==d.length)return;var r=!1,a=e.paths;let c=!1;this._selected_paths=UWA.clone(a);var l=function(){try{this._doNotBroadcastSelect=!0,this._selected_paths.length?this._selectOccurence("",!0,!0):o.appid===s.appId()&&(this._emptyFromProxy=!0,this.unselectAll(),this._directSelection=!1);var e=[];let g=widget.getValue("enableProdConfig")&&t.getSetting("activateExcludeOccProxy")&&this.isEditor();for(var i=0;i<this._selected_paths.length;i++){var l=this.getNodeByOccurencePath(this._selected_paths[i]);if(l){let t=l.getOccurencePath();if(this.pathsAreEqual(t,this._selected_paths[i]))e.push(this._selected_paths[i]);else if(g){this.pathIsInExcludes(l,this._selected_paths[i])&&(c=!0)}}}if(e.length===a.length&&e.length>0)for(var d=0;d<e.length&&!r;d++){var p=e[d],u=p.length;if(u>2){var h=n.getNodesById(p[u-1]);h&&h.length>0&&(r=!0)}}this._selected_paths=e}finally{setTimeout(function(){this._doNotBroadcastSelect=!1}.bind(this),500)}}.bind(this);l(),!1===c&&!0!==e.doNotSetOnCompass&&a.length&&o.appid===s.appId()&&!0!==this._hideChildrenFilter&&!r&&(this._selected_paths=a,this.insertBranches(e.paths,{node_state:"collapsed",from:"select",forceCollapsed:!0,novalidation:!0,skipDrop:!0,onComplete:function(){l()}}))}var d},_selectOccurence:function(e,t,o){var i=this.getRoots(),n=this._selected_paths,s=0;if(n.length>0){var r=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var a=[];if(this.isOccModel)for(let e=0;e<n.length;e++){let t=n[e],o=this.getNodeFromPath(t);if(o&&(r=!0,a.push(o),!o.isVisible())){for(var l=o.getRealParent();!l.isVisible();)l=l.getRealParent();l&&!a.includes(l)&&a.push(l)}}else for(s=0;s<i.length;s++){let e=i[s];for(let t=0;t<n.length;t++){var d=e.getNodeByPath(n[t]);if(d&&(r=!0,a.push(d),!d.isVisible())){for(l=d.getParent();!l.isVisible();)l=l.getParent();l&&-1===a.indexOf(l)&&a.push(l)}}}var c=!1;if(!0!==t||!0===r){var p=this.getSelectedNodes();for(s=0;s<p.length;s++){var u=p[s];a.indexOf(u)<0&&(this._checkIfCurrentSelectionIsStillValid.call(this,u)||(u.unselect(),c=!0))}}var h=a.filter(function(e){return!e.isSelected()});c=h.length>0,this.multiselect(h),!0===o&&c&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_checkIfCurrentSelectionIsStillValid:function(e){let t=!1,o=this._selection;if(!o)return t;for(let i=0;i<o.length;i++){if(l(o[i],e.getOccurencePath())){t=!0;break}}return t},_buildSelectData:function(){var e=[],t=this._selected_paths;t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var i=0;i<t.length;i++){var n=o.getNodeByPath(t[i],void 0,void 0,!0);n&&e.push(n)}}):e=this.getXSO().get();this.isGroupingApplied()&&(e=e.filter(function(e){return!0!==e.isGroupingNode}));var o,s={paths:[],tenant:n.getPlatformId()};s.attributes={},s.version="1.1";o=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(s),s.paths=e.map(function(e){return 1===e.getNodeSource()?e.getParent().getOccurencePath(o):e.getOccurencePath(o)});var r=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");try{s.changeControl=r.get()}catch(e){console.warn("No Change")}return this._currentApp=i.getSharedId(),s.sharedID=this._currentApp,null===this._pagerview&&!0!==this._focusOn?s.focusOn=!1:s.focusOn=!0,this.options.context&&this.options.context.hasActiveDesignExp()&&this.options.context.getPseService().app.core.contextManager.handleDesignExpItemsSelection(s),s},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var i=0;i<t.length;i++){var n=o.getNodeByPath(t[i],void 0,void 0,!0);n&&e.push(n)}}):e=this.getXSO().get();return e},multiselect:function(e){var t=this,o=t.getXSO();this.prepareUpdate(),e=e.filter(function(e){return t.options.shouldBeSelected(e)}),o.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},notifyTagger:function(){this.getModelEvents().publish({event:"setPathTags",context:this})},__copyLink:async function(){let t=n.getPlatformURL("3DDashboard"),s="#app:"+i.getAppId()+"/content:X3DContentId=",r=o.buildX3DContent(this.getSelectedNodes());var a=t+s+encodeURIComponent(JSON.stringify(r));await i.copyTexttoCLipboard(a)?i.displayNotif({message:e.replace(e.msg_success_copyLink,{label:this.getSelectedNodes()[0].getLabel()}),level:"success"}):i.displayNotif({title:e.msg_error_copyLinkTitle,message:e.msg_error_copyLink,level:"error",key:"xNavDoc-copy-link-error"})}},d}),define("DS/ENXNav/models/_xNavCVParser",["i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/HideShowController","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADProbes","DS/PADUtils/PADCommandProxy","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADPredicatesNls","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Utils"],function(e,t,o,i,n,s,r,a,l,d,c,p){"use strict";var u={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}};Object.freeze(u);var h,g,f,v="ds6w:Document",m=r.create(),D={},b={};function S(e,t){var o=!1;if(UWA.is(e,"object")&&UWA.is(t,"array")){var i=0,n=t.length,s=e.getID();do{s===t[i].getID()&&(o=!0),i++}while(!1===o&&i<n)}return o}function _(e,t){for(var o={},i=e||{},n=Object.getOwnPropertyNames(i),s=0;s<n.length;s++)t[n[s]]?t[n[s]]!==e[n[s]]&&(o[n[s]]=e[n[s]]):o[n[s]]=e[n[s]];return o}function x(e,t,o){var i=!1,n=null,s={};t.label!==e.options.label&&(s.label=t.label,!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(s.label+="(treeorder="+t.relationOrder+")"),i=!0);if(function(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var i=0;i<o;i++)if(typeof e[i]!=typeof t[i]&&"object"==typeof e[i]){if(void 0!==e[i]&&void 0!==t[i]&&e[i].iconPath!==t[i].iconPath)return!1}else if(e[i]!==t[i])return!1;return!0}return!1}return!1}(t.icons,e.options.icons)||(s.icons=t.icons,i=!0),t.thumbnail!==e.options.thumbnail&&(s.thumbnail=t.thumbnail,i=!0),t.display!==e.options.display&&(s.display=t.display,i=!0),t.type!==e.options.type&&(s.type=t.type,i=!0),t.relcount!==e.options.relcount){s.relcount=t.relcount,i=!0;var r=e.getChildren();0===s.relcount&&null!==r&&(s.children=null,n=u.NO_CHILDREN),s.relcount>0&&null===r&&(s.children=[],n=u.COLLAPSED)}null!==n||"expanding"!==e.getState()||o&&!1===o.changeState||(n=u.EXPANDED),t.relationOrder!==e.options.relationOrder&&(s.relationOrder=t.relationOrder,i=!0),!UWA.is(t.isPADHidden,"boolean")&&!UWA.is(t.isPADHiddenBackEnd,"boolean")||t.isPADHidden===e.options.isPADHidden&&e.options.isPADHidden===t.isPADHiddenBackEnd||(s.isPADHidden=t.isPADHidden,s.isPADHiddenBackEnd=t.isPADHiddenBackEnd,s.isPADHiddenBackEndReference=t.isPADHiddenBackEndReference,s.isPADHiddenBackEndInstance=t.isPADHiddenBackEndInstance,s.isPADHiddenBackEndOcc=t.isPADHiddenBackEndOcc,s.hsStatusOn=t.hsStatusOn,i=!0),void 0!==t.isHiddenState&&t.isHiddenState!==e.options.isHiddenState&&(s.isHiddenState=t.isHiddenState,i=!0),e.isRoot()&&(t.grid||(t.grid={}),t.grid.instanceName||(t.grid.instanceName=""));var a=_(t.grid,e.options.grid);if(UWA.equals(a,{})||(s.grid=a,i=!0),t.padgrid){var l=_(t.padgrid,e.options.padgrid);UWA.equals(l,{})||(s.padgrid=l,i=!0)}i&&(o&&!0===o.deleteTempOptions&&(delete e.options.waiting4validation,delete e.options.alternText),e.updateOptions(s),e._manageNLS=!0,o&&o.needRequestNls&&e.isVisible()&&d.updateNLS(e)),n&&e.setState(n)}function y(e,t,i,n,s,r,a,l){var d=e.getID(),c=[];if(!0===r&&C(e),i.nodes[d]){var p=UWA.clone(i.nodes[d]);UWA.is(p.isPADHiddenBackEnd,"boolean")&&(p.isPADHidden=p.isPADHiddenBackEnd,p.isPADHiddenBackEnd=p.isPADHiddenBackEnd,p.isPADHiddenBackEndReference=p.isPADHiddenBackEnd,p.hsStatusOn="reference",e.options.isPADHidden=void 0);var u=e.getRelationID(),h=i.nodes[u];h&&(p.relationOrder=h.relationOrder,p.grid=UWA.extend(h.grid,p.grid),UWA.is(h.isPADHiddenBackEnd,"boolean")&&(p.isPADHidden=h.isPADHiddenBackEnd,p.isPADHiddenBackEnd=h.isPADHiddenBackEnd,p.isPADHiddenBackEndInstance=h.isPADHiddenBackEnd,p.hsStatusOn="instance",e.options.isPADHidden=void 0)),o.defaultHiddenState(p),l&&l.needRequestNls?x(e,p,l):x(e,p),o.gatherParentsIfHidden(c,e),o.calculateParents(c);for(var g=e.getChildren(),f=0;g&&f<g.length;f++){var v=g[f].getRelationID(),m=a&&i.nodes[v]&&i.nodes[v].did?a[i.nodes[d].did][i.nodes[v].did]:void 0;l&&l.needRequestNls?y(g[f],e,i,n,s,r,m,l):y(g[f],e,i,n,s,r,m)}void 0!==a&&UWA.is(a[i.nodes[d].did].isPADHiddenBackEndOcc,"boolean")&&(e.options.hsStatusOn="occurence",e.options.isPADHidden=a[i.nodes[d].did].isPADHiddenBackEndOcc,e.options.isPADHiddenBackEnd=a[i.nodes[d].did].isPADHiddenBackEndOcc,e.options.isPADHiddenBackEndOcc=a[i.nodes[d].did].isPADHiddenBackEndOcc)}else{for(var D,b=!1,S=0;S<n.length&&!1===b;S++)(b=n[S].node.isDescendantOf(e))&&(D=n[S].root);if(!0===b){var _=e.getLeaves();if(_.length)for(var N=0;N<_.length;N++){var P=_[N];(t=P.getParent()).removeChild(P),s.push({node:t,root:D})}else t.removeChild(e)}}}function C(e){e.getState()===u.EXPANDED.state&&e.setState(u.PARTIALLY_EXPANDED)}function N(e){return UWA.is(e,"string")?"true"===e.toLowerCase():UWA.is(e,"boolean")?e:void 0}function P(e,t,o,i,n){o===t.length?e[i]=n:e[t[o]]&&P(e[t[o]],t,o+1,i,n)}function A(e,t,o){e[t]?e[t].push(o):(e[t]=[],e[t].push(o))}function w(e,t){if(void 0!==e&&Date.now()-t>e)throw{type:"TimeoutError"}}return D.buildStructure=function(e){var t={nodes:{},did_to_resourceid:{},structure:{}},o=[],i=[],n=[];e.results.forEach(function(e){if(e.attributes){var s={};e.attributes.forEach(function(e){"resourceid"===e.name||"physicalid"===e.name?s.resourceid=e.value:"did"===e.name&&(s.did=e.value)}),t.nodes[s.resourceid]=s,s.did&&(t.did_to_resourceid[s.did]=s.resourceid)}if(e.path){var r=e.path,a=r.length,l=r[0];if(3===a){r[1];var d=r[2];-1===i.indexOf(d)&&i.push(d)}-1===n.indexOf(l)&&n.push(l),o.push(r)}});var s=[],r=[],a={};try{n.forEach(function(e){0===i.length||-1===i.indexOf(e)?s.push(e):r.push(e),a[e]={children:[]},o.forEach(function(t){3===t.length&&e===t[0]&&a[e].children.push(t)})})}catch(e){console.error(e)}var l={};try{var d=function(e,o){var i=o[1],n=o[2],s=t.did_to_resourceid[i],r=t.did_to_resourceid[n];if(e&&void 0===e[s]&&(e[s]={},e[s][r]={},a[n])){var l=a[n].children;l&&l.forEach(function(t){d(e[s][r],t)})}};s.forEach(function(e){var o=t.did_to_resourceid[e],i={};a[e].children.forEach(function(e){d(i,e)}),l[o]=i})}catch(e){console.error(e)}return l},D.parse_expand=function(e,t,o,i,n){var r=s.createProbe("parse_expand"),a={nodes:{},did_to_resourceid:{},structure:{}},l=require("DS/PADUtils/PADSettingsMgt");void 0===f&&(f=l.getSetting("activateDGV"));let d=e.length;for(let s=0;s<d;s++){let r=e[s];if(r.attributes){var c=b.parse_attributes(r.attributes,t,o);a.nodes[c.resourceid]=c,UWA.is(c.did)&&(a.did_to_resourceid[c.did]=c.resourceid)}else if(r.path){var p;if(!1===i){p=r.path.length;var u=function(e){if(e){for(var t=Object.getOwnPropertyNames(e),o=0;o<t.length;o++)a.nodes[t[o]]&&(e[a.nodes[t[o]].did]=e[t[o]],delete e[t[o]],UWA.is(e[a.nodes[t[o]].did],"object")&&u(e[a.nodes[t[o]].did]),void 0===e.order&&(e.order=[]),e.order.push(a.nodes[t[o]].did));void 0===e.order&&(e.order=[])}};u(n),a.structure=n}else{var h=a.structure;p=r.path.length,1===Math.abs(p%2)?r.path.forEach(function(e,t){h.hasOwnProperty(e)||(h[e]={},p===t+1&&(h[e].pathLeaf=!0),0===Math.abs(t%2)&&(h[e].order=[])),h.order&&-1===h.order.indexOf(e)&&h.order.push(e),h=h[e]}):!0}}else if(r.icon__default_thumbnail_2d)r.icon__default_thumbnail_2d.forEach(function(e){e.did.forEach(function(t){var o=a.did_to_resourceid[t],i=a.nodes[o];i.icons&&0!==i.icons.length||(i.icons||(i.icons=[]),!0===f?i.icons.push({iconPath:"url("+e.icon+")"}):i.icons.push(e.icon)),i.thumbnail&&0!==i.thumbnail.length||(i.thumbnail=e.thumbnail_2d,i.grid||(i.grid={}),i.grid.thumbnail=!0===f?e.thumbnail_2d:"url("+e.thumbnail_2d+")")})});else if(r.pgp_overload)for(var g=Object.getOwnPropertyNames(r.pgp_overload),v=0;v<g.length;v++){var m=g[v],D=(m=m.replace(/[\[\]']+/g,"")).split(",").map(function(e){return e.trim()});r.pgp_overload[g[v]]["PGPShowExtension.V_PGP_Show"]&&P(a.structure,D,0,"isPADHiddenBackEndOcc",!N(r.pgp_overload[g[v]]["PGPShowExtension.V_PGP_Show"]))}else r.status&&"EXPAND_WAS_CUT_MAX_OUTPUT_PATHS"===r.status&&(a.status={expandTooLarge:!0})}return r.end(),a},b.internalsForTestAccess=function(e){return D.buildStructure(e)},b.parse_attributes=function(e,t,o){var i=require("DS/PADUtils/PADSettingsMgt");void 0===h&&(h=!0===i.getSetting("pgpFromServer")||!0===i.getSetting("supportPgpBasedOnDescription"))&&(g=i.getSetting("pgpFromServer")?["bo.pgpshowextension.v_pgp_show","ro.pgpshowextension.v_pgp_show"]:["ro.plminstance.V_description"]),void 0===f&&(f=i.getSetting("activateDGV"));for(var n={},s=void 0,r=0;void 0===s&&r<e.length;r++)"ds6w:globaltype"===e[r].name.toLowerCase()&&(s=e[r].value);if("ds6w:Instance"!==s&&""!==s&&void 0!==s){let r=e.length;for(let m=0;m<r;m++){let r=e[m];if("type"===r.name)r.name="ds6w:type";else if(-1!==r.name.indexOf("/")){var a=r.name.split("/");r.name=a[a.length-1]}if(UWA.is(r.value)&&UWA.is(r.value.replace,"function")&&(r.value=r.value.replace(/\n/g," ")),"ds6w:type"===r.name&&(n.type=r.value),"FALSE"!==r.value&&"TRUE"!==r.value||(r.value="TRUE"===r.value),r.value&&UWA.is(r.value,"string")&&-1!==r.value.indexOf("[")&&-1!==r.value.indexOf("]")){r.value=JSON.parse(r.value);var d=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i,c=[];Array.isArray(r.value)&&r.value.length>0&&(r.value.forEach(function(e){if(d.test(e)){var t=e.slice(0,10).replace(/-/g,"/");c.push(t)}}),c.length>0&&(r.value=c))}if(""===r.value){var u=require("DS/PADServices/utils/AttributesMgtV2").getColumn(r.name);!u||"boolean"!=u.kind&&"boolean"!=u.typeRepresentation||(r.value=void 0)}if("resourceid"===r.name||"physicalid"===r.name)n.resourceid=r.value;else if("did"===r.name)n.did=r.value;else if("TreeOrder"===r.name||"ro.plminstance.V_treeorder"===r.name)n.relationOrder=parseFloat(r.value),isNaN(n.relationOrder)&&(n.relationOrder=-1);else if("matrixtxt"===r.name)l.checkNotIdentity(r.value)&&(n.grid||(n.grid={}),n.grid["positionMatrix-Instance"]=r.value);else if("type_icon_url"===r.name)n.icons||(n.icons=[]),!0===f?n.icons.push({iconPath:"url("+r.value+")",className:"dgv-icons"}):n.icons.push(r.value);else if("preview_url"===r.name||"thumbnail_2d"===r.name)n.thumbnail=r.value,n.grid||(n.grid={}),n.grid.thumbnail=!0===f?r.value:"url("+r.value+")";else if("svg"===r.name){var v=r.value;v&&v.length>0&&(n.grid||(n.grid={}),n.grid.svg||(n.grid.svg=[]),n.grid.svg.push({format:r.name,id:r.value}))}else if("relcount"===r.name)n.relcount=parseInt(r.value),0===n.relcount&&(n.children=null);else if("ds6w:kind"===r.name)n.grid||(n.grid={}),n.grid["ds6w:kind"]||(n.grid["ds6w:kind"]=[]),n.grid["ds6w:kind"].push(r.value);else if(o&&r.name===o&&"ds6w:Instance"!==s)n.label=r.value,n.display=n.label;else if(t&&-1!==t.indexOf(r.name))n.grid||(n.grid={}),void 0!==n.grid[r.name]?(n.grid[r.name]=p.splat(n.grid[r.name]),n.grid[r.name].push(r.value)):n.grid[r.name]=r.value;else if(n.padgrid||(n.padgrid={}),h&&-1!==g.indexOf(r.name.toLowerCase()))n.isPADHiddenBackEnd=!N(r.value);else{n.grid||(n.grid={});let e=r.dispValue?r.dispValue:r.value;void 0!==n.grid[r.name]?(n.grid[r.name]=p.splat(n.grid[r.name]),n.grid[r.name].push(e)):n.grid[r.name]=e,n.padgrid[r.name]=e}i.getSetting("activateFUN085903")&&"ds6w:globalType"===r.name&&(n.grid||(n.grid={}),n.grid.globaltype=r.value)}}else{let o=e.length;for(let s=0;s<o;s++){let o=e[s];if("ds6w:type"===o.name&&(n.type=o.value),"resourceid"===o.name||"physicalid"===o.name)n.resourceid=o.value;else if("did"===o.name)n.did=o.value;else if("TreeOrder"===o.name||"ro.plminstance.V_treeorder"===o.name)n.relationOrder=parseFloat(o.value),isNaN(n.relationOrder)&&(n.relationOrder=-1);else if("matrixtxt"===o.name)l.checkNotIdentity(o.value)&&(n.grid||(n.grid={}),n.grid["positionMatrix-Instance"]=o.value);else if(t&&-1!==t.indexOf(o.name+"-Instance"))n.grid||(n.grid={}),void 0!==n.grid[o.name+"-Instance"]?(n.grid[o.name+"-Instance"]=p.splat(n.grid[o.name+"-Instance"]),n.grid[o.name+"-Instance"].push(o.value)):n.grid[o.name+"-Instance"]=o.value;else if(n.padgrid||(n.padgrid={}),h&&-1!==g.indexOf(o.name.toLowerCase()))n.isPADHiddenBackEnd=!N(o.value);else{n.grid||(n.grid={});let e=o.dispValue?o.dispValue:o.value;void 0!==n.grid[o.name+"-Instance"]?(n.grid[o.name+"-Instance"]=p.splat(n.grid[o.name+"-Instance"]),n.grid[o.name+"-Instance"].push(e)):n.grid[o.name+"-Instance"]=e,n.padgrid[o.name+"-Instance"]=e}i.getSetting("activateFUN085903")&&"ds6w:globalType"===o.name&&(n.grid||(n.grid={}),n.grid.globaltypeInstance=o.value)}}return n.relationOrder||(n.relationOrder=-1),n.grid||(n.grid={}),n},b.update_instances=function(e){var t=[];e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(o){if(o.attributes){for(var n="",s=0;s<o.attributes.length;s++){var r=o.attributes[s];if("resourceid"===r.name){n=r.value;break}}e.newRelIds&&-1!==e.newRelIds.indexOf(n)&&e.treedocument.getRoots().forEach(function(s){var r=s.getNodesByRelId(n);r.length&&r.forEach(function(s){var r=function(t,o){var n=b.parse_attributes(o.attributes,i.getAvailableColumns(),i.getTreeColumn());return UWA.is(e.treedocument.filterAttributesForUpdate,"function")&&(n=e.treedocument.filterAttributesForUpdate({node:t,node_opts:n})),n&&0===n.relcount&&(n.children=null),n}(s,o),a=s.getLabel();delete r.resourceid,r&&"VPMInstance"===r.type&&delete r.type,r.display=a,r.label=a,r.instanceMatrix&&(r.relationid=n,r.grid.instanceMatrix=r.instanceMatrix);var l=s.getState();s.updateOptions(r),d.updateNLS(s),l===u.EXPANDED&&s.setState({state:u.PARTIALLY_EXPANDED}),t.push(s)})})}})}),e.editCfg?e.treedocument.refreshCfgValues({relids:e.newRelIds}):t.length&&e.treedocument.fillAttributesAsync4VisibleNodes(t)},b.process={fetch:function(e){s.createProbe("process_fetch");if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");require("DS/PADUtils/PADSettingsMgt");e.treedocument.withTransactionUpdate(function(){var s=[],r=[],a=function(e){for(var t=[],o=[],i={},n=e.length,s=0;s<n;s++)for(var r=e[s],a=r.attributes,l=a.length,d=0;d<l;d++){var c=a[d],p=c.name,u=p.split("/");if("ds6w:type"===(p=u[u.length-1])||"type"===p){var h=c.value;-1===o.indexOf(h)?(o.push(h),t.push({type:h,displayType:c.dispValue}),A(i,h,r)):A(i,h,r)}}return{types:t,resultsByType:i}}(e.response.results);0===a.types.length&&console.error("No types to validate"),n.isTypesAuthorized(a.types,function(n){n.forEach(function(n){var r=a.resultsByType[n];UWA.is(r,"array")&&r.forEach(function(n){if(UWA.is(n.attributes,"array")){var r=b.parse_attributes(n.attributes,i.getAvailableColumns(),i.getTreeColumn());UWA.is(r.isPADHiddenBackEnd,"boolean")&&(r.isPADHidden=r.isPADHiddenBackEnd,r.isPADHiddenBackEndReference=r.isPADHiddenBackEnd,r.hsStatusOn="reference"),o.defaultHiddenState(r);var a=new t(r);if(e.rootsWithFilters){var l=function(e,t){for(var o,i=0;i<t.length;i++)if(e===t[i].rootId&&t[i].filter){(o=t[i].filter).filterId=t[i].filterId,o.filterName=t[i].filterName;break}return UWA.is(o,"string")?JSON.parse(o):o}(a.getID(),e.rootsWithFilters);l&&(a.options.config_filter=l.config_filter,a.options.sequence_filter=l.sequence_filter,a.options.filterId=l.filterId,a.options.filterName=l.filterName)}if(e.config_filter&&e.config_filter[r.resourceid]&&(a.options.config_filter=e.config_filter[r.resourceid]),a.options.config_filter||a.options.sequence_filter)if(!0===f){if(a.options.icons&&a.options.icons.length){var c=UWA.clone(a.options.icons[0]);c.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},a.updateOptions({icons:[c]})}}else{a.setBadges({bottomRight:"filter"})}e.treedocument.addRoot(a),s.push(a);var p=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(p+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:p,added_node:a}}),d.updateNLS(a)}else e.onFailure&&e.onFailure(new Error("Invalid result format - attributes isn't an array"))})}),e.onComplete&&e.onComplete({toselect:s,hidden:r})},!0)})},expand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.root_nodes,"array")&&!0!==e.root2Create||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.starting_from_root=void 0===e.starting_from_root||e.starting_from_root;var n=require("DS/PADServices/utils/GlobalModelEvents"),r=Date.now(),a=e.treedocument.isGroupingApplied();w(e.parseTimeout,r);var l=[],c=require("DS/PADUtils/PADSettingsMgt"),p=c.getSetting("activateFUN085903")&&(-1===e.expand_level||e.expand_level>1),h=(c.getURLParameter("filter3DPartRep"),!0===c.getSetting("alwaysExpandPath")||c.getSetting("pgpFromServer")),g=s.createProbe("transactionWithUpdate_expand"),f=e.selectPathLeaf;e.treedocument.prepareBroadcastSelect(),e.treedocument.withTransactionUpdate(function(){var g;if("refresh"===e.mode&&!1===e.response.full_path)if(e.needNewStructure)g=D.buildStructure(e.response);else{g={};for(var b=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var o=t.getChildren(),i=0;o&&i<o.length;i++)b(e[t.getRelationID()][t.getID()],o[i])}},_=e.treedocument.getRoots(),y=0;y<_.length;y++){g[_[y].getID()]={};for(var C=_[y].getChildren(),N=0;C&&N<C.length;N++)b(g[_[y].getID()],C[N])}}var P=D.parse_expand(e.response.results,i.getAvailableColumns(),i.getTreeColumn(),e.response.full_path,g);w(e.parseTimeout,r);var A,I="expanded",E=!1,O=!1,M=!1,F=e.expand_level;switch(e.mode){case"find_in_ctx":I="partiallyExpanded",E=!0,F=-1,A=[],p=!1;break;case"insert":I="partiallyExpanded",O=!0,f="boolean"!=typeof f||f,p=c.getSetting("activateFUN085903");break;case"refresh":F=-1,M=!0,p=!1;break;case"filter":!0,p=!1}var R=!1;P.status&&(n.publish({event:"ENXModel/Expand/expandStatus",data:{mode:e.mode,status:P.status}}),!0===P.status.expandTooLarge&&(R=!0,I="partiallyExpanded","function"==typeof e.setExpandStatus&&e.setExpandStatus({expandTooLarge:!0})));var T=function(t){for(var o=[],i=0;e.root_nodes&&i<e.root_nodes.length;i++){if(e.root_nodes[i].getID()===t){o=[e.root_nodes[i]];break}var n=e.root_nodes[i].getNodesById(t);void 0!==n&&n.length>0&&(o=o.concat(n))}return o},k=function(e,t){var o=!1;t&&t.length>0&&(t=(t=t.trim().split("*").join("")).toLowerCase());try{var i=[];i.push(e.options.label),i.push(e.options.subLabel),i.push(e.options.description),i.push(e.options.type),i.push(e.options.grid["ds6w:cadMaster"]),i.push(e.options.grid["ds6wg:revision"]),e.options.grid["ds6w:status"]&&(-1!==e.options.grid["ds6w:status"].toLowerCase().indexOf("work")?(i.push("In Work"),i.push("IN_WORK")):i.push(e.options.grid["ds6w:status"])),i.push(e.options.grid.globaltype),e.options.grid["ds6w:description"]&&i.push(e.options.grid["ds6w:description"]),e.options.grid["ds6w:label-Instance"]&&i.push(e.options.grid["ds6w:label-Instance"]),e.options.relationtype&&i.push(e.options.relationtype);for(var n=0;n<i.length;n++)if(i[n]&&i[n].length>0&&-1!==i[n].trim().toLowerCase().indexOf(t)){o=!0;break}}catch(e){console.error(e)}return o},U=e.findInCtx_query,B=[],V=function(i,n,s,l,d){var c=n.getChildren(),g=M&&null!==c?[].concat(c):void 0,D=[],b=!1,_=[];w(e.parseTimeout,r);var y=!1;!0===i.pathLeaf&&(U&&0!==U.length?(y=k(n,U),f&&y&&n.select(),UWA.is(e.addedPaths,"function")&&A.push(n.getOccurencePath())):(f&&n.select(),UWA.is(e.addedPaths,"function")&&A.push(n.getOccurencePath())));var C,N,F,T=i.order;if(T.length>0){var G,L=-1,X=[];if(c&&c.length>0)for(G=0;G<c.length;G++)X.push(c[G].options.relationOrder),c[G].options.relationOrder>L&&(L=c[G].options.relationOrder);-1===L&&(b=!0);var W=n.hasChildren();for(!1===W&&n.options._childrenFilterInfo&&n.options._childrenFilterInfo.filteredOutChildren.length&&(W=!0),G=0;G<T.length;G++){var j=T[G];if(void 0!==P.did_to_resourceid[j]){var H=P.did_to_resourceid[j],z=P.nodes[H].type,q=P.nodes[H].relationOrder,K=P.nodes[H],J=Object.getOwnPropertyNames(i[j])[0],Q=P.did_to_resourceid[J],Y=null;W&&(Y=n.getChildByIds(H,Q));var $=!1;if(UWA.is(Y,"object")){if(!0===M||!0===Y.options.waiting4validation){var Z=UWA.clone(P.nodes[Q]);Z.relationOrder=q,Z.grid=UWA.extend(K.grid,Z.grid);var ee=!1;Y.options.isPADHidden=void 0,UWA.is(Z.isPADHiddenBackEnd,"boolean")&&(Z.isPADHidden=Z.isPADHiddenBackEnd,Z.isPADHiddenBackEndReference=Z.isPADHiddenBackEnd,Z.hsStatusOn="reference",ee=!0),UWA.is(K.isPADHiddenBackEnd,"boolean")&&(Z.isPADHidden=K.isPADHiddenBackEnd,Z.isPADHiddenBackEndInstance=K.isPADHiddenBackEnd,Z.hsStatusOn="instance",ee=!0),void 0!==Y.options.isPADHiddenBackEndOcc&&(Z.isPADHidden=Y.options.isPADHiddenBackEndOcc,ee=!0),!1===ee&&(Z.isPADHidden=void 0,Z.isPADHiddenBackEnd=void 0,Z.isPADHiddenBackEndReference=void 0,Z.isPADHiddenBackEndInstance=void 0,Z.hsStatusOn=void 0),delete Y.options.waiting4validation,delete Y.options.alternText;var te={};!0===M&&(Z.isPADHiddenBackEndInstance||Z.isPADHiddenBackEndReference||o.defaultHiddenState(Z),te.needRequestNls=!0),!0===h&&S(Y,e.realExpandedNodes)&&(te.changeState=!1),x(Y,Z,te),!0===Y.options.isPADHidden&&m.hide({paths:[Y.getOccurencePath()]}),D.push(Y);let t=!1,i=Y.getReferenceValue("ds6w:kind");!i||-1===i.indexOf("3DPart")||Y.getReferenceValue("ds6w:globalType")!==v&&Y.getReferenceValue("ds6w:globaltype")!==v||(t=!0),!0===t?(Y.setState({state:"noChildren"}),Y.options.children=null):("noChildren"===Y.getState()||"expanded"===Y.getState()&&(Y.options.children&&0===Y.options.children.length||null===Y.options.children))&&(Y.setState({state:"collapsed"}),Y.options.children=[])}g&&(N=Y,F=void 0,-1!==(F=(C=g).indexOf(N))&&C.splice(F,1))}else{$=!0;var oe=UWA.clone(P.nodes[Q]);oe.relationid=H,oe.relationtype=z,oe.relationOrder=q,oe.grid=UWA.extend(K.grid,oe.grid,!0),UWA.is(oe.isPADHiddenBackEnd,"boolean")&&(oe.isPADHidden=oe.isPADHiddenBackEnd,oe.isPADHiddenBackEndReference=oe.isPADHiddenBackEnd,oe.hsStatusOn="reference"),UWA.is(K.isPADHiddenBackEnd,"boolean")&&(oe.isPADHidden=K.isPADHiddenBackEnd,oe.isPADHiddenBackEndInstance=K.isPADHiddenBackEnd,oe.hsStatusOn="instance"),o.defaultHiddenState(oe),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(oe.label+="(treeorder="+q+")"),Y=new t(oe);var ie=null,ne=!1;if(a&&n.isRoot()){var se="refresh"!==e.mode&&e.stateGrouping!==u.COLLAPSED.state;if(ie=e.treedocument.getGroupingNode(n,Y),e.realExpandedNodes&&!0===e.realExpandedNodes[0].isGroupingNode&&e.realExpandedNodes[0].getGroupID()!==ie.getGroupID()){if(!0!==ie.options.isOther){console.warn("Ignore node ["+Y.getLabel()+"] because it doesn't belong to the expected classification node");continue}ne=!0}else!0===se&&e.treedocument.setGrpPartialExpandState(ie)}if(d&&d[Y.options.relationid]){var re=d[Y.options.relationid];if(re.before){var ae=null;if((Ce=n.getChildren())&&Ce.length)for(var le=0;le<Ce.length;le++){var de=Ce[le].options.relationid;if(de&&de===re.before){ae=Ce[le],X.splice(le,0,q);break}}ie?ie.insertBefore(Y,ae):n.insertBefore(Y,ae)}else ie?ie.addChild(Y):n.addChild(Y),L=q,X.push(q)}else if(q>=L)ie?ie.addChild(Y):n.addChild(Y),L=q,X.push(q);else{ae=null;if(Ce=n.getChildren()){le=0;for(var ce=Ce.length;le<ce;le++)if(X[le]>q){ae=Ce[le],X.splice(le,0,q);break}}ie?ie.insertBefore(Y,ae):n.insertBefore(Y,ae)}o.gatherParentsIfHidden(_,Y),B=B.concat(_),Y.options.grid.globaltype===v&&(Y.setState({state:"noChildren"}),Y.options.padstate="noChildren",Y.childComputed=!R),!0===b&&D.push(Y),Y._manageNLS=!0,!0===ne&&ie.setState(u.PARTIALLY_EXPANDED)}o.calculateParents(_);var pe=-1===l?l:l-1;(pe>0||-1===pe)&&($||Y.getTreeDocument())?V(i[j][J],Y,s,pe):O&&Y.select()}else console.error("Invalid CV id ["+j+"]")}var ue=S(n,e.realExpandedNodes),he=function(e,t,o){var i=!1;if(e&&Array.isArray(t)){var n=0,s=t.length,r=!1;do{if(e.isDescendantOf(t[n])){if(-1===o)i=!0;else{var a=e.getOccurencePath(),l=a.indexOf(t[n].getID());(a.length-l)%2<=o&&(i=!0)}r=!0}n++}while(!1===r&&n<s)}return i}(n,e.realExpandedNodes,s),ge=n.getState(),fe=n.getRoot();if(E||O?n.childComputed=!1:!0===h&&!1===ue&&!1===he&&("filter"!==fe.options.badges.bottomRight||fe.options.icons&&fe.options.icons[0].badges&&"filter"!==fe.options.icons[0].badges.bottomRight)&&R?n.childComputed=!1:n.childComputed=!R&&("expandingState"!==ge&&"expandState"!==ge&&"partiallyExpanded"!==ge),!0!==M){let e=n.getReferenceValue("ds6w:kind");p&&e&&-1!==e.indexOf("3DPart")&&1===n.getChildren().length?(n.setState({state:"collapsed"}),n.options.padstate="collapsed"):!0===h?(ue||he||O||E)&&(n.setState({state:I}),n.options.padstate=I):(n.setState({state:I}),n.options.padstate=I)}}else if(!0!==M){var ve=n.getDepth();s&&(-1===s||s>ve)?E||O?(n.childComputed=!1,O?n.select():U&&0!==U.length?n.isSelected()||(y=k(n,U))&&n.select():n.select()):!0===h?-1===s?null!=c&&0!==c.length||(n.childComputed=!R,n.options.children=null,n.setState({state:"noChildren"}),n.options.padstate="noChildren",n._expandState="noExpandState"):T.length&&(n.setState({state:I}),n.options.padstate=I):(n.childComputed=!R,n.options.children=null,n.setState({state:"noChildren"}),n.options.padstate="noChildren",0!==ve&&-1!==s||(n._expandState="noExpandState")):null!==n.options.relcount&&0===n.options.relcount&&(n.setState({state:"noChildren"}),n.options.padstate="noChildren",n.childComputed=!R,n.options.children=null,O&&n.select(),E&&(U&&0!==U.length?n.isSelected()||(y=k(n,U))&&n.select():n.select()))}if(null!=g&&g.length>0&&g.forEach(function(e){null!=e&&!0===M&&!0!==e.isGroupingNode&&n.removeChild(e)}),D.length>0&&!0!==e.treedocument.isGroupingApplied()&&!0!==M){var me=!1;if(!e.noCheckOrder)for(var De=0;De<D.length;De++)for(var be=D[De].getParent().getChildren(),Se=1;Se<be.length;Se++){var _e=be[Se-1],xe=be[Se];if(_e.options.relationOrder>xe.options.relationOrder){me=!0,console.warn("Wrong order between "+_e.getLabel()+" with order "+_e.options.relationOrder+" and "+xe.getLabel()+" with order "+xe.options.relationOrder);break}}if(me)for(var ye=0;ye<D.length;ye++){var Ce,Ne=D[ye],Pe=Ne.getParent(),Ae=Ne.getBrothers();if((Ce=Pe.getChildren()).length>1)for(var we=0;we<Ae.length;we++)if(Ae[we].options.relationOrder>Ne.options.relationOrder){var Ie=Ce.indexOf(Ne);if(Ce.indexOf(Ae[we])<Ie){var Ee=Pe.removeChild(Ne);Pe.insertBefore(Ee,Ae[we]);break}}}}UWA.is(i.isPADHiddenBackEndOcc,"boolean")&&(n.options.hsStatusOn="occurence",n.options.isPADHidden=i.isPADHiddenBackEndOcc,n.options.isPADHiddenBackEndOcc=i.isPADHiddenBackEndOcc,o.defaultHiddenState(n.options),o.gatherParentsIfHidden(_,n),B=B.concat(_),o.calculateParents(_))},G=Object.getOwnPropertyNames(P.structure),L=UWA.clone(e.root_nodes?e.root_nodes:[],!1),X=s.createProbe("treat_expand");if(e.occurencePaths&&e.occurencePaths.length>0)e.occurencePaths.forEach(function(t){var o,i=e.treedocument.getNodeByOccurencePath(t);if(e.pathOrdering&&(o=e.pathOrdering),i){var n=P.nodes[i.getID()];UWA.is(n.isPADHiddenBackEnd,"boolean")&&(n.isPADHidden=n.isPADHiddenBackEnd,n.isPADHiddenBackEndReference=n.isPADHiddenBackEnd,n.hsStatusOn="reference");for(var s,r=Object.keys(P.did_to_resourceid),a=0;a<r.length;a++)if(P.did_to_resourceid[r[a]]===i.getID()){s=r[a];break}var l=P.structure[s];V(l,i,F,F,o),x(i,n)}});else if(G.length>0)for(var W=0;W<G.length;W++){var j=G[W];if(P.did_to_resourceid.hasOwnProperty(j)){var H=T(P.did_to_resourceid[j]);if(0===H.length&&!0===e.root2Create){var z=P.nodes[P.did_to_resourceid[j]];UWA.is(z.isPADHiddenBackEnd,"boolean")&&(z.isPADHidden=z.isPADHiddenBackEnd,z.isPADHiddenBackEndReference=z.isPADHiddenBackEnd,z.hsStatusOn="reference");var q=new t(z);e.treedocument.addRoot(q),q._manageNLS=!0;var K=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(K+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:K,added_node:q}}),H.push(q)}0!==H.length?(H.forEach(function(t){if(void 0!==t){var i=L.indexOf(t);i>-1&&L.splice(i,1);var n=P.nodes[P.did_to_resourceid[j]];t.options.isPADHidden=void 0,UWA.is(n.isPADHiddenBackEnd,"boolean")&&(n.isPADHidden=n.isPADHiddenBackEnd,n.isPADHiddenBackEndReference=n.isPADHiddenBackEnd,n.hsStatusOn="reference"),!0===M&&(delete n.relationOrder,n.isPADHiddenBackEndReference||o.defaultHiddenState(n));var s,r=P.structure[j];V(r,t,F,F),!0===h&&S(t,e.realExpandedNodes)&&(s={changeState:!1}),x(t,n,s),!0===M&&("noChildren"===t.getState()||"expanded"===t.getState()&&(t.options.children&&0===t.options.children.length||null===t.options.children))&&(t.setState({state:"collapsed"}),t.options.children=[]),d.updateNLS(t)}}),o.calculateParents(B,!0),UWA.is(e.addedPaths,"function")&&e.addedPaths(A),UWA.is(e.hideToggleNodes,"function")&&e.hideToggleNodes(l),n.publish({event:"ENXModel/Expand/parseDone"})):console.error("Invalid root id: "+j)}}e.treedocument.pushBroadcastSelect(),X.end()}),g.end()},insert_temporary_branches:function(o){if(!UWA.is(o.treedocument,"object")||!UWA.is(o.branches,"array"))throw new Error("Invalid input parameters");var i=[],n=[],s=[],r=[],l=[],d=o.treedocument,p=o.node_state?o.node_state:"partiallyExpanded",u=o.branches;return d.withTransactionUpdate(function(){u.forEach(function(u){var h,g=null,v=o.treedocument.getRoots(),m=o.treedocument.getDetachedRoots(),D=0;for(h=0;h<v.length&&null===g;h++)if(u[0]===v[h].getID()){r.push(u[0]);var b=(g=v[h]).getNodeByPath(u,void 0,void 0,!0);b&&(g=b,D=u.indexOf(g.getID()))}for(h=0;h<m.length&&null===g;h++)if(u[0]===m[h].getID()){r.push(u[0]);var S=(g=m[h]).getNodeByPath(u,void 0,void 0,!0);if(S)if(g=S,D=u.indexOf(g.getID()),!0===o.temporary_root)require("DS/PADUtils/views/PADAlert").displayNotification({msg:e.detachRootFound,eventID:"info"})}if(!0===o.temporary_root&&null===g){var _={resourceid:u[0],label:c.loadingText,icons:[{iconPath:"url("+a.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")"}],thumbnail:a.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:c.loadingText,waiting4validation:!0};if(g=new t(_),o.config_filter&&o.config_filter[u[0]]&&(g.options.config_filter=o.config_filter[u[0]]),g.options.config_filter||g.options.sequence_filter)if(!0===f){if(g.options.icons&&g.options.icons.length){var x=UWA.clone(g.options.icons[0]);x.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},g.updateOptions({icons:[x]})}}else{g.setBadges({bottomRight:"filter"})}d.addRoot(g),-1===i.indexOf(u[0])&&i.push(u[0]);var y=d.getRoots().length;UWA.is(d.detachedRoots,"array")&&(y+=d.detachedRoots.length),d.getModelEvents().publish({event:"onRootAdded",data:{nb_root:y,added_node:g}})}if(g)if(g.getID()===u[u.length-1]){if(!0!==o.forceCollapsed&&null!==g.getRoot()){var C=g.reverseExpand({state:p});C.ids.length&&(i=i.concat(C.ids)),C.relids.length&&(l=l.concat(C.relids))}}else for(var N=D+1;N<u.length;N+=2){var P=u[N],A=u[N+1],w={resourceid:A,relationid:P,label:c.loadingText,icons:[{iconPath:"url("+a.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")"}],thumbnail:a.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:c.loadingText,waiting4validation:!0},I=new t(w),E=g.getState();d.isGroupingApplied()&&g.isRoot()&&I.hide(),g.addChild(I),"collapsed"===E?(p!==E&&(g.setState({state:p}),g.options.padstate=p),g.childValidationChecker()):"partiallyExpanded"===E&&(g.setState({state:E}),g.options.padstate=E,-1===n.indexOf(A)&&n.push(A),-1===s.indexOf(P)&&s.push(P)),g=I,-1===i.indexOf(A)&&i.push(A),-1===l.indexOf(P)&&l.push(P)}})}),{ids_to_fetch:i,relationids:l,rootsAlreadyLoaded:r,visibleNodesIds:n,visibleNodesRelIds:s}},refresh_nodes:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.refresh_parameters,"object"))throw new Error("Invalid input parameters");var o=[],n=[],s=function(t,o){var n=b.parse_attributes(o.attributes,i.getAvailableColumns(),i.getTreeColumn());return UWA.is(e.treedocument.filterAttributesForUpdate,"function")&&(n=e.treedocument.filterAttributesForUpdate({node:t,node_opts:n})),n&&0===n.relcount&&(n.children=null),n},r=require("DS/PADUtils/PADSettingsMgt");return e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(a){for(var l="",c=0;c<a.attributes.length;c++){var p=a.attributes[c];if("resourceid"===p.name){l=p.value;break}}if(""===l)throw new Error("Resourceid not found in fetch result for "+JSON.stringify(a));if(e.refresh_parameters.created&&-1!==e.refresh_parameters.created.indexOf(l)){var u=b.parse_attributes(a.attributes,i.getAvailableColumns(),i.getTreeColumn()),h=new t(u);e.treedocument.addRoot(h),d.updateNLS(h);e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&e.treedocument.detachedRoots.length,e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:h}}),n.push(h),o.push(h.getID())}else if(e.refresh_parameters.modified&&(-1!==e.refresh_parameters.modified.indexOf(l)||e.ids_modified&&-1!==e.ids_modified.indexOf(l))){e.treedocument.getRoots().forEach(function(e){var t=e.getNodesById(l);if(t.length)t.forEach(function(e){e.updateOptions(s(e,a)),d.updateNLS(e),null===e.options.children&&e.setState({state:"noChildren"}),n.push(e)});else{var o=e.getNodesByRelId(l);o.length&&o.forEach(function(e){var t=s(e,a);delete t.resourceid,e.updateOptions(t),d.updateNLS(e),n.push(e)})}});var g=e.treedocument.searchRootById(l);g&&(g.updateOptions(s(g,a)),d.updateNLS(g),0===g.options.relcount&&g.setState({state:"noChildren"}),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:g}}),n.push(g))}else e.refresh_parameters.relationids&&-1!==e.refresh_parameters.relationids.indexOf(l)&&e.treedocument.getRoots().forEach(function(e){e.getNodesByRelId(l).forEach(function(e){var t=b.parse_attributes(a.attributes,i.getAvailableColumns(),i.getTreeColumn()),o=e.getLabel();!0===r.getSetting("tree_order_in_label")&&(o+="(treeorder="+t.relationOrder+")"),e.updateOptions({label:o,relationOrder:t.relationOrder}),d.updateNLS(e);var s=e.getParent(),l=e.getBrothers(),c=s.getChildren();if(c.length>1)for(var p=0;p<l.length;p++)if(l[p].options.relationOrder>e.options.relationOrder){var u=c.indexOf(e);if(c.indexOf(l[p])<u){var h=s.removeChild(e);s.insertBefore(h,l[p]);break}}n.push(e)})})})}),n.length&&e.treedocument.fillAttributesAsync4VisibleNodes(n),o},validateAndUpdateBranches:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");var t=s.createProbe("transactionWithUpdate_validateBranch"),n=e.selectPathLeaf,r=e.forcePartiallyExpanded;e.treedocument.withTransactionUpdate(function(){var t=D.parse_expand(e.response.results,i.getAvailableColumns(),i.getTreeColumn(),e.response.full_path),a=function(t){for(var o=null,i=e.treedocument.getRoots(),n=e.treedocument.getDetachedRoots(),s=0;s<i.length;s++)if(i[s].getID()===t){o=[i[s]];break}for(var r=0;r<n.length&&null===o;r++)if(n[r].getID()===t){o=[n[r]];break}return o},l=[],c=function(e,i,s){var a=i.getChildren(),p=(null!==a&&[].concat(a),[]);!0===e.pathLeaf&&n&&i.select();var u=e.order;if(u.length>0){for(var h=-1,g=[],f=0;null!==a&&f<a.length;f++)g.push(a[f].options.relationOrder),a[f].options.relationOrder>h&&(h=a[f].options.relationOrder);for(var v=0;v<u.length;v++){var m=u[v];if(t.did_to_resourceid.hasOwnProperty(m)){var D=t.did_to_resourceid[m],b=(t.nodes[D].type,t.nodes[D].relationOrder),S=t.nodes[D],_=Object.getOwnPropertyNames(e[m])[0],y=t.did_to_resourceid[_],C=i.getChildByIds(D,y);if(!UWA.is(C,"object")){console.error("All nodes should have been created");break}var N=UWA.clone(t.nodes[y]);N.grid=UWA.extend(S.grid,N.grid),UWA.is(N.isPADHiddenBackEnd,"boolean")&&(N.isPADHidden=N.isPADHiddenBackEnd,N.isPADHiddenBackEndReference=N.isPADHiddenBackEnd,N.hsStatusOn="reference"),UWA.is(S.isPADHiddenBackEnd,"boolean")&&(N.isPADHidden=S.isPADHiddenBackEnd,N.isPADHiddenBackEndInstance=S.isPADHiddenBackEnd,N.hsStatusOn="instance"),o.defaultHiddenState(N),x(C,N,{deleteTempOptions:!0}),C.isVisible()&&(C._manageNLS=!0,d.updateNLS(C)),!0===r&&"expanded"===C.getState()&&C.setState({state:"partiallyExpanded"});var P=C.getLabel();!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(P+="(treeorder="+opts_2_modified.relationOrder+")"),C.updateOptions({label:P,relationOrder:b}),o.gatherParentsIfHidden(p,C),l=l.concat(p);var A=C.getParent(),w=C.getBrothers(),I=A.getChildren();if(I.length>1)for(var E=0;E<w.length;E++)if(w[E].options.relationOrder>C.options.relationOrder){var O=I.indexOf(C);if(I.indexOf(w[E])<O){var M=A.removeChild(C);A.insertBefore(M,w[E]);break}}o.calculateParents(p,!1,!0),c(e[m][_],C,-1)}else console.error("Invalid CV id ["+m+"]")}}UWA.is(e.isPADHiddenBackEndOcc,"boolean")&&(i.options.hsStatusOn="occurence",i.options.isPADHidden=e.isPADHiddenBackEndOcc)},p=Object.getOwnPropertyNames(t.structure),u=s.createProbe("treat_expand");if(p.length>0)for(var h=0;h<p.length;h++){var g=p[h];if(t.did_to_resourceid.hasOwnProperty(g)){var f=a(t.did_to_resourceid[g]);void 0!==f?f.forEach(function(o){if(void 0!==o){var i=t.nodes[t.did_to_resourceid[g]];o.options.isPADHidden=void 0,UWA.is(i.isPADHiddenBackEnd,"boolean")&&(i.isPADHidden=i.isPADHiddenBackEnd,i.isPADHiddenBackEndReference=i.isPADHiddenBackEnd,i.hsStatusOn="reference"),x(o,i,{deleteTempOptions:!0}),o.childComputed=!0,d.updateNLS(o),!0===r&&"expanded"===o.getState()&&o.setState({state:"partiallyExpanded"});var n=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(n+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n,added_node:o}});var s=t.structure[g];c(s,o,-1)}}):console.error("Invalid root id: "+g)}}o.calculateParents(l,!0,!0),u.end()}),t.end()},validateMultiExpand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.selectPathLeaf;var t=e.forcePartiallyExpanded,o={nodes2relaunch:[]};e.treedocument.withTransactionUpdate(function(){var n;if(!1===e.forcePartiallyExpanded){n={};for(var s=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var o=t.getChildren(),i=0;o&&i<o.length;i++)s(e[t.getRelationID()][t.getID()],o[i])}},r=e.treedocument.getRoots(),a=0;a<r.length;a++){n[r[a].getID()]={};for(var l=r[a].getChildren(),d=0;l&&d<l.length;d++)s(n[r[a].getID()],l[d])}}for(var c=D.parse_expand(e.response.results,i.getAvailableColumns(),i.getTreeColumn(),e.response.full_path,n),p=(r=e.treedocument.getRoots(),0);p<r.length;p++){var u=r[p],h=u.getID();if(c.nodes[h]){var g=c.nodes[h];UWA.is(g.isPADHiddenBackEnd,"boolean")&&(g.isPADHidden=g.isPADHiddenBackEnd,g.isPADHiddenBackEnd=g.isPADHiddenBackEnd,g.isPADHiddenBackEndReference=g.isPADHiddenBackEnd,g.hsStatusOn="reference");var f={needRequestNls:!0};if(x(u,g,f),!0===t&&C(u),l=u.getChildren()){l=l.slice();for(var v=0;l&&v<l.length;v++){var m=c.structure[c.nodes[h].did],b=l[v].getRelationID(),S=m&&c.nodes[b]&&c.nodes[b].did?m[c.nodes[b].did]:void 0;y(l[v],u,c,e.treatedNodes,o.nodes2relaunch,t,S,f)}}}else for(var _=0;_<e.treatedNodes.length;_++)if(e.treatedNodes[_].root.getID()===u.getID()&&!e.isFilter){if(e.treatedNodes[_].node.getID()===u.getID()){e.treedocument.removeRoot(u);break}var N=e.treatedNodes[_].node.getParent();N&&(N.removeChild(e.treatedNodes[_].node),o.nodes2relaunch.push({node:N,root:u}))}}e.onComplete(o)})}},b}),define("DS/ENXNav/commands/ProductToPart",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/Controls/Button","DS/Controls/ComboBox","DS/PADServices/utils/PlatformURL","DS/PADServices/ws/WSAccess","DS/WebappsUtils/WebappsUtils","DS/ENXNav/models/_xNavCVParser","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/views/PADAlert","DS/PADUtils/PADContext"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h){"use strict";return{execute:function(e){this.targetDiv=document.querySelector(".pse-root");var t=this;if(t.elements={},t.parameters=e,t.selectedProductID=t.parameters.model.getSelectedNodes()[0].options.resourceid,t.displayTitle=e.model.getSelectedNodes()[0].options.display,1==e.model.getSelectedNodes().length&&null!=e.model.getSelectedNodes()[0].options.grid["ds6w:cadMaster"]){var o=e.model.getSelectedNodes()[0].options.grid["ds6w:cadMaster"];t._buildContent(o).then(function(o){t._chooseTemplate(o).then(function(o){o&&(e.model.isOccModel?e.model.productToPart(o):t._productToPart(o))})})}},_buildContent:function(t){var r=this;return r.selectedCAD=t,new Promise(function(t){(n.getTemplates?Promise.resolve():i.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){n.getTemplatesV2().then(function(i){if("success"===i.status&&i.result)var n=function(e,t){for(var o=new a({shouldBeSelected:function(e){return e.options.selectable}}),i=t[0].attributes.volatileAttributes[0].rangeGroup,n=i.filter(function(e,t,o){return o.indexOf(e)==t&&"3DEXPERIENCE"!==e}).sort(),r=t[0].attributes.volatileAttributes[0].range,d=t[0].attributes.volatileAttributes[0].rangeNLS,c=0;c<n.length;c++)if("3DEXPERIENCE"==e||e==n[c].split(" ").join("")){var p=new l({label:n[c],selectable:!1});o.addRoot(p);for(var u=0;u<i.length;u++)i[u]===n[c]&&o.addRoot(new l({label:"      "+d[u],template:r[u],icons:[{iconPath:s.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+i[u].toUpperCase().split(" ").join("")+".png")}],selectable:!0}))}return o.expandAll(),o}(r.selectedCAD,i.result);r.elements.container=document.createElement("div"),r.elements.container.classList.add("product-to-part-container"),r.elements.text=document.createElement("div"),r.elements.text.classList.add("prod-to-part-label"),r.elements.text.innerText=e.productToPartCmd.templateLabel,r.elements.container.appendChild(r.elements.text);var d=r.elements.comboBox=new o({enableSearchFlag:!1,elementsTree:n});d.getContent().classList.add("prod-to-part-combobox"),d.inject(r.elements.container),r.elements.text=document.createElement("div"),r.elements.text.classList.add("prod-to-part-description-text"),r.elements.text.innerText=e.productToPartCmd.descriptionText,r.elements.container.appendChild(r.elements.text),t(d)})})}.bind(this))},_chooseTemplate:function(t){var o=this;return o.combobox=t,new Promise(function(t){require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(i,n){o.modalStop=new i({target:o.targetDiv,title:e.productToPartCmd.title+"  -  "+o.displayTitle,resizableFlag:!1,height:"auto",width:"auto",touchMode:!0,position:{my:"center",at:"center"},content:o.elements.container,buttons:{Cancel:new n({label:e.productToPartCmd.cancel,touchMode:!0,onClick:function(){t(!1),o.modalStop.close()}}),Ok:new n({label:e.productToPartCmd.convert,touchMode:!0,onClick:function(){var e={template:o.combobox.elementsTree.getAllDescendants()[o.combobox.selectedIndex].options.template,pid:[o.selectedProductID]};t(e),o.modalStop.close()}})},closeCB:function(){}})})})},_productToPart:function(t){var o=this;o.data=t,(n.productToPart?Promise.resolve():i.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){n.productToPart({enopad_webapis:!0,data:{intent:"explore_2D",select_predicate:["ds6w:type"],select_file:["icon","thumbnail_2d"]},pids:o.data.pid,template:o.data.template,onComplete:function(t){o.parameters.model.invalidateViewPort();var n=UWA.is(t,"string")?JSON.parse(t):t;n.results&&1===n.results.length?1==n.results.length&&o.parameters.model.wrapInTransaction(function(){c.setAuthoringState(!0,p.PADSession_disabling_index_from_server),r.process.fetch({treedocument:o.parameters.model,response:n,onComplete:function(t){u.displayNotification({eventID:"info",msg:e.productToPartCmd.successNotif});var n=h.get(),s=t.toselect[0].getOccurencePath();t&&t.toselect&&t.toselect.length>0&&n.dispatchEvent("onAddPaths",{addedPaths:[s]});var r={tenant:i.getPlatformId(),pids:s};n._commandProxy.drop(r),o.parameters.model.unselectAll(),o.parameters.model.getNodeByOccurencePath(s).select()},onFailure:function(e){console.error(e)}})}):(u.displayNotification({msg:p.object_not_found_in_db,eventID:"error",key:"enxNav-productToPart-object-not-found-in-db"}),parameters.callback&&parameters.callback("error"))},onTimeout:function(){u.displayNotification({msg:p.timeout,eventID:"error",key:"enxNav-productToPart-timeout"}),o.parameters.callback&&o.parameters.callback("error")},onFailure:function(t,o){var i=e.productToPartCmd.err_generic_server;if((o=UWA.is(o,"string")?JSON.parse(o):o)&&o.attributeMap&&o.attributeMap.error_code)switch(o.attributeMap.error_code.value){case 3:i=e.productToPartCmd.err_product_under_change;break;case 4:i=e.productToPartCmd.err_product_with_conf}u.displayNotification({msg:i,eventID:"error",key:"enxNav-productToPart-err-product"}),t.callback&&t.callback("error")}})})}}}),define("DS/ENXNav/utils/CtxMenuUtils",["i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ApplicationFrame/CommandsManager","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWebInWinServices","DS/ENXNav/utils/OpenWithMenuBuilder","DS/etree/syncwidget"],function(e,t,o,i,n,s,r,a){"use strict";var l={};return l.buildMenu=function(e){var t;switch(e.view){case"datagridview":t=l.buildDGVCtx(e);break;case"treelistview":t=l.buildTreeLstCtx(e);break;case"graphview":t=l.buildGraphCtx(e);break;case"tilesthumbview":t=l.buildOtherViewCtx(e);break;default:t=Promise.resolve([])}return t},l.buildDGVCtx=function(t){return new Promise(function(o){var i=[],s=t.params.cellInfos,r=t.context,a=t.params;if(s){var d=t.params.collectionView.getColumnOrGroup(s.columnID);if(-1===s.rowID){var c={pin:!0,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1,view:"datagridview"};if("tree"===d.dataIndex&&(c.pin=!1),i=t.params.collectionView.buildDefaultContextualMenu(t.params,c),d.customisation&&d.customisation.layout&&!1===d.customisation.layout.removableFromView||i.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},title:e.PAD_CMDColumnHide,action:{context:{collectionView:t.params.collectionView,dataIndex:d.dataIndex},callback:function(e){e.context.collectionView.layout.setColumnVisibleFlag(e.context.dataIndex,!1,{isUserInteraction:!1})}}}),!0===n.getSetting("activateGroupByCtx")){var p=[],u=t.params.collectionView.layout.getVisibleOrderedColumnsIndexes();p.push({type:"PushItem",title:"None",action:{context:{dataIndex:"none",collectionView:t.params.collectionView},callback:function(e){e.context.collectionView.groupRows({dataIndexesToGroup:[]})}}});for(var h=0;h<u.length;h++){var g=t.params.collectionView.layout.getDataIndexFromColumnIndex(u[h]),f=t.params.collectionView.layout.getColumnOptionValue(g,"text");f&&p.push({type:"PushItem",title:f,action:{context:{dataIndex:g,collectionView:t.params.collectionView},callback:function(e){e.context.collectionView.groupRows({dataIndexesToGroup:[e.context.dataIndex]})}}})}i.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-group-add"},title:e.PAD_CMDColumnGroupby,submenu:p})}i.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-cog"},title:e.PAD_CMDColumnCusto,action:{context:t.context,callback:function(e){l.launchCommand({context:e.context,command:"ColumnVisibility"})}}}),l.addAdditionalColumnsCtx({context:r,menu:i,node:v,cellInfos:s,params:t.params,view:"datagridview"}).then(function(e){o(e.menu)})}else{var v=s.nodeModel;if(v)if(!1===v.isSelected()&&v.select(!0),!0===v.isRelationsObjectNode)!0===v.isRelationsObjectGroupingNode?o(null):l.addNONPSCtx({context:r,menu:i,node:v}).then(function(e){o(e.menu)});else{var m={available:!1};"positionMatrix-Instance"===d.dataIndex&&UWA.is(l.psePositionCtxCmd,"function")&&(m=l.psePositionCtxCmd(r,a)),!0===m.available?(i=m.menu,o(i)):l.addOpenWithMenu({context:r,menu:i,node:v,cellInfos:s,params:t.params,view:"datagridview"}).then(l.addTreeMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){o(e.menu)})}else o(i)}}else o(i)})},l.buildTreeLstCtx=function(t){return new Promise(function(o){var n=[],s=t.context,r=t.params,a=t.params.treeview;if(a.isHeader){var d=a.manager,c=a.dataIndex,p=a.manager._instance._parentObject.thumbnail_size,u={type:"PushItem",icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_FitToColumn.png")+")",title:e.PAD_CMDColumnToFit,action:{context:c,callback:function(e){"thumbnail"===e.context?function(e,t,o){for(var i=e.getColumnIDFromDataIndex(t),n=e.getContent().querySelectorAll('.wux-datagrid-cell[virtual-column-id="'+i+'"]'),s=0,r=0;r<n.length;r++){var a=n[r].clientWidth;a>s&&(s=a)}if(s>o){var l=function(){e.prepareUpdateView(),e.setColumnWidth(i,o),e.pushUpdateView()};e.onPostUpdateViewOnce(l),l()}}(d,e.context,p):d.sizeColumnToFit(e.context)}}};n.push(u),l.addAdditionalColumnsCtx({context:s,menu:n,params:t.params,view:"treelistview"}).then(function(e){o(e.menu)})}else{var h=a.cellView?a.cellView.getCellInfos():null,g=a.nodeModel?a.nodeModel:a.cellModel;if(g){!1===g.isSelected()&&g.select(!0);var f={available:!1};h&&"positionMatrix-Instance"===h.dataIndex&&UWA.is(l.psePositionCtxCmd,"function")&&(f=l.psePositionCtxCmd(s,r)),!0===f.available?(n=f.menu,o(n)):l.addOpenWithMenu({context:s,menu:n,node:g,cellInfos:h,params:t.params,view:"treelistview"}).then(l.addTreeMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){o(e.menu)})}else o(n)}})},l.buildGraphCtx=function(e){return new Promise(function(t){var o=[],i=e.context,n=e.params.graphview.node;n?(!1===n.isSelected()&&n.select(!0),!0===n.isRelationsObjectNode?!0===n.isRelationsObjectGroupingNode?t(null):l.addNONPSCtx({context:i,menu:o,node:n}).then(function(e){t(e.menu)}):l.addOpenWithMenu({context:i,menu:o,node:n,params:e.params}).then(l.addGraphMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){t(e.menu)})):t(o)})},l.buildOtherViewCtx=function(e){return new Promise(function(t){var o=[],i=e.context,n=e.params.cellInfos?e.params.cellInfos.nodeModel?e.params.cellInfos.nodeModel:e.params.cellInfos.cellModel:null;n?(!1===n.isSelected()&&n.select(!0),!0===n.isRelationsObjectNode?!0===n.isRelationsObjectGroupingNode?t(null):l.addNONPSCtx({context:i,menu:o,node:n}).then(function(e){t(e.menu)}):l.addOpenWithMenu({context:i,menu:o,node:n,params:e.params}).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){t(e.menu)})):t(o)})},l.addOpenWithMenu=function(t){return new Promise(function(o){var i=t.context.getPADTreeDocument().getSelectedNodes();i.length>0&&r.openWithApps(i,{iconOpenWith:{iconName:"open",fontIconFamily:1},nlsOpenWith:e.OpenWith}).then(function(e){t.menu=t.menu.concat(e),o(t)})})},l.addTreeMenu=function(e){return new Promise(function(t){UWA.is(l.pseTreeMenu,"function")&&l.pseTreeMenu(e.context,e.menu,e.node,e.cellInfos,e.view),t(e)})},l.addGraphMenu=function(t){return new Promise(function(o){var n=t.context,s=n.getPADTreeDocument().getSelectedNodes(),r=function(e,t){for(var o=t.length,i=0,n=0,s=0;s<o;s++){var r=t[s];e.getThumbnailState(r)===a.ThumbnailState.EXPANDED?i++:n++}return i>n}(n.options.views.graphview,s);t.menu.push({icon:r?"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_Collapse-thumbnail.png")+")":"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_Expand-thumbnail.png")+")",title:r?e.PAD_CMDCollapseThumb:e.PAD_CMDExpandThumb,type:"PushItem",action:{this:n,context:{nodes:s,expanded:r},callback:function(e){this.options.views.graphview.setGroupThumbnailState(e.context)}}}),o(t)})},l.addCommonMenu=function(r){return new Promise(function(a){var d=r.menu,c=r.context,p=r.node,u=o.getCommand("OpenInCADHdr",c.options.action_bar_opts&&c.options.action_bar_opts.context?c.options.action_bar_opts.context:null);u&&u.isAvailable()&&(d.push({title:t.PAD_CMDOpenInCAD,icon:"url("+i.getWebappsAssetUrl("PADUtils","icons/32/I_OpenInCAD.png")+")",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"OpenInCADHdr"})}}}),d.push({type:"SeparatorItem"}));var h=!!p.options.isPADHidden,g=!0,f=!0,v=c.options.model.getSelectedNodes();if(v.length>1)for(var m=v[0].options.isPADHidden,D=0;D<v.length;D++)m!==v[D].options.isPADHidden&&(g=!1),v[D].isRoot()||(f=!1);else p.isRoot()||(f=!1);if(!s.isWebInWinContext()){var b={type:"PushItem",icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_SsmCtxHideShow.png")+")",title:e.PAD_CMDShow,action:{callback:function(e){var t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(p.getOccurencePath()),c._commandProxy.show({paths:t})}}},S={type:"PushItem",icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_HideShow.png")+")",title:e.PAD_CMDHide,action:{callback:function(e){var t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(p.getOccurencePath()),c._commandProxy.hide({paths:t})}}};!0===g?h?d.push(b):d.push(S):(d.push(b),d.push(S)),!0===n.getSetting("FocusCtxCommandAvailable")&&d.push({type:"PushItem",title:e.PAD_CMDFocusOn,icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_FocusOn.png")+")",action:{callback:function(){var e=require("DS/PADUtils/PADUtilsServices"),t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(p.getOccurencePath()),c._commandProxy.focus({intent:"focus",paths:t,widget:"2D",sharedID:e.getSharedId(),appID:e.getAppId()})}}}),d.push({type:"SeparatorItem"})}if(1===v.length){var _=c.render(),x=r.params.infos?r.params.infos.position:r.params.info?r.params.info.position:{x:0,y:0};d.push({type:"PushItem",title:e.PAD_CMDFindInCtx,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search-filter",family:WUXManagedFontIcons.Font3DS},action:{context:{position:x,renderTo:_,node:p},callback:function(e){require(["DS/ENXNav/utils/FindInCtx"],function(t){t.launchFindWithDialog(e.context)})}}})}"noExpandState"!==p._expandState&&(d.push({title:e.PAD_CMDExpandAll,icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",state:!0===p._expandAllPending?"disabled":"enabled",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"ExpandAll"})}}}),d.push({title:e.PAD_CMDCollapseAll,icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"CollapseAll"})}}})),d.push({title:e.PAD_CMDProperties,icon:"url("+i.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",state:c.getEditMode?c.getEditMode()?"enabled":"disabled":"enabled",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"ActionBar_Attributes"})}}}),UWA.is(l.ccpMenu,"function")&&l.ccpMenu(c,d,p),f&&(d.push({type:"SeparatorItem"}),!0!==n.getSetting("removeDetachRoot")&&d.push({title:e.detachRoot,icon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/I_HideShow.png")+")",type:"PushItem",action:{callback:function(){for(var e=c.options.model.getSelectedNodes(),t=0;t<e.length;t++)c.toggleRoot(e[t])}}}),d.push({type:"PushItem",title:e.removeRoot,icon:{iconName:"open wux-ui-3ds-flip-vertical",fontIconFamily:1},action:{callback:function(e){for(var t=c.options.model.getSelectedNodes(),o=0;o<t.length;o++)c.options.model.removeRoot(t[o])}}})),a(r)})},l.addAdditionalColumnsCtx=function(e){return new Promise(function(t){var o=e.context;if(o.options.additionalColumnsModules&&o.options.additionalColumnsModules.length){for(var i=[],n=[],s=[],r=0;r<o.options.additionalColumnsModules.length;r++)if(o.options.additionalColumnsModules[r].getAdditionalCtxMenu){var a=new Promise(function(t){o.options.additionalColumnsModules[r].getAdditionalCtxMenu({treeDocument:o.getPADTreeDocument(),ctxParams:e.params,view:e.view,callback:function(e,o){e&&-1===s.indexOf(e)&&(s.push(e),UWA.is(o,"object")&&(n.push({type:"SeparatorItem"}),n.push(o))),t()}})});i.push(a)}Promise.all(i).then(function(){e.menu=e.menu.concat(n),t(e)})}else t(e)})},l.addNONPSCtx=function(t){return new Promise(function(o){var n=t.context;t.menu=[{title:e.PAD_CMDProperties,icon:"url("+i.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",state:n.getEditMode?n.getEditMode()?"enabled":"disabled":"enabled",action:{context:n,callback:function(e){l.launchCommand({context:e.context,command:"ActionBar_Attributes"})}}}],o(t)})},l.launchCommand=function(e){var t=o.getCommand(e.command,e.context.action_bar_opts&&e.context.action_bar_opts.context?e.context.action_bar_opts.context:null);t&&t.begin()},l}),define("DS/ENXNav/views/ViewLoader",["UWA/Class","UWA/Promise","DS/ENXNav/utils/CtxMenuUtils"],function(e,t,o){"use strict";var i={treelistview:"treelistview",graphview:"graphview",tileview:"tileview",thumbnailview:"thumbnailview",datagridview:"datagridview"};Object.freeze(i);var n=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],s=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],r=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],a=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],l=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDragStartRowHeader","onDragEndRowHeader","onDragEnterRowHeader","onDragLeaveRowHeader","onDragRowHeader","onDragOverRowHeader","onDropRowHeader","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return e.extend({init:function(e){this.options=e},loadView:function(e,t){var o=this;this.options.component.options.views[e]?t():this.buildOptions(e,t).then(function(i){o.requireView(e,i,t)})},requireView:function(e,t,o){var n=this,s=this.options.amd[e],r=function(){n.postLoad(e),e!==i.treelistview&&o&&o()};require([s],function(o){var s=n.options.component;s.options.views[e]=new o(t),e===i.datagridview?s.options.views[e].initialize().then(function(){r()}):r()})},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case i.graphview:var o=!1;t.options.views.graphview.isActiveView&&(o=!0,t.options.views.graphview.setModel(t.options.model)),t.setDnD_onGraph(),!0===t.options.layout.keyboard_inputs&&t.setKeyboardListenerOnGraph&&t.setKeyboardListenerOnGraph(),t.options.isReady.graphview=!0,o&&t.options.views.graphview.reframeAll();break;case i.treelistview:break;case i.thumbnailview:t.options.views.thumbnailview.isActiveView&&t.options.views.thumbnailview.setModel(t.options.model),t.options.isReady.thumbnailview=!0;break;case i.datagridview:t.options.views.datagridview.isActiveView&&(t.options.views.datagridview.setModel(t.options.model),t.options.views.datagridview.options.dgv.onDragStartRowHeader=function(e,o){t.onDragStartRowHeader(e,o)},t.options.views.datagridview.options.dgv.onDropRowHeader=function(e,o){t.onDropRowHeader(e,o)}),t.options.isReady.datagridview=!0;break;case i.tileview:t.options.views.tileview.isActiveView&&t.options.views.tileview.setModel(t.options.model),t.options.isReady.tileview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e,t){switch(e){case i.treelistview:return this._buildTreeListViewOptions(t);case i.graphview:return this._buildGraphViewOptions();case i.tileview:return this._buildTileViewOptions();case i.thumbnailview:return this._buildThumbnailViewOptions();case i.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(e,t){var o=t,i={};return e.forEach(function(e){UWA.is(o.options.views_cb[e],"function")?i[e]=o.options.views_cb[e]:UWA.is(o[e],"function")&&(i[e]=o[e].bind(o))}),i},_buildTreeListViewOptions:function(e){var s=this;return new t(function(t,r){var a=s.options.component,l={x3dAppId:s.options.x3dAppId,renderTo:s.options.renderTo};l.active_view=UWA.clone(a.options.active_view),l.isActiveView=l.active_view===i.treelistview,l.view_customization=a.options.layout.view_customization,l.specific_columns=a.options.layout.specific_columns;var d=s.mapCallbacks(n,a);l=UWA.extend(l,d,!0),UWA.is(a.getOnContextualEvent)?l.onContextualEvent=a.getOnContextualEvent():l.onContextualEvent={this:a,callback:function(e){return o.buildMenu({view:"treelistview",context:this,params:e})}},l.events={onComplete:function(){a.options.views.treelistview=this,"treelistview"===a.options.active_view&&a.options.views.treelistview.setModel(a.options.model),a.options.isReady.treelistview=!0,e&&e()},onCustoViewChange:function(e){a.dispatchEvent("onCustoViewChange",e)},onTenantChange:function(e){a.dispatchEvent("onTenantChange",e)},onSaveAsTemplate:function(e){a.dispatchEvent("onSaveAsTemplate",e)}},a.options.additionalColumnsModules&&(l.additionalColumnsModules=a.options.additionalColumnsModules),t(l)})},_buildGraphViewOptions:function(){var e=this;return new t(function(t,o){var i=e.options.component,n={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};n.active_view=UWA.clone(i.options.active_view),n.isActiveView="graphview"===n.active_view;var r=e.mapCallbacks(s,i);n=UWA.extend(n,r,!0),UWA.is(i.getOnContextualEvent)?n.onContextualEvent=i.getOnContextualEvent():n.onContextualEvent={this:i,callback:function(t){return e._onContextualMenuEvent({view:"graphview",context:this,params:t})}},t(n)})},_buildTileViewOptions:function(){var e=this;return new t(function(t,o){var i=e.options.component,n={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};n.active_view=UWA.clone(i.options.active_view),n.isActiveView="tileview"===n.active_view;var s=e.mapCallbacks(r,i);n=UWA.extend(n,s,!0),UWA.is(i.getOnContextualEvent)?n.onContextualEvent=i.getOnContextualEvent():n.onContextualEvent={this:i,callback:function(t){return e._onContextualMenuEvent({view:"tilesthumbview",context:this,params:t})}},t(n)})},_buildThumbnailViewOptions:function(){var e=this;return new t(function(t,o){var i=e.options.component,n={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};n.active_view=UWA.clone(i.options.active_view),n.isActiveView="thumbnailview"===n.active_view;var s=e.mapCallbacks(a,i);n=UWA.extend(n,s,!0),UWA.is(i.getOnContextualEvent)?n.onContextualEvent=i.getOnContextualEvent():n.onContextualEvent={this:i,callback:function(t){return e._onContextualMenuEvent({view:"tilesthumbview",context:this,params:t})}},t(n)})},_builddatagridViewOptions:function(){var e=this;return new t(function(t,o){var i=e.options.component,n={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,context:i};n.active_view=UWA.clone(i.options.active_view),n.isActiveView="datagridview"===n.active_view,n.view_customization=i.options.layout.view_customization,n.callbacks=e.mapCallbacks(l,i),i.options.additionalColumnsModules&&(n.additionalColumnsModules=i.options.additionalColumnsModules),n.onTenantChange=function(e){i.dispatchEvent("onTenantChange",e)},t(n)})},_onContextualMenuEvent:function(e){return new t(function(i){var n=o,s=t.resolve();e.context.isDynamicCtx()&&(s=new t(function(e){require(["DS/ENXNav/utils/CtxMenuUtilsV2"],function(t){n=t,e()})})),s.then(function(){n.buildMenu({view:e.view,context:e.context,params:e.params}).then(i)})})}})}),define("DS/ENXNav/models/_xNavGrouping",["i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","text!DS/PADServices/assets/init/DefaultColorStream.json","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/models/_xNavCVParser","DS/ENOXParser/modules/TwoDParser","UWA/Class","UWA/Utils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PADTrackerManager","DS/Utilities/UUID","DS/ENOXInterWdgCom/LinkManager"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f,v,m){"use strict";function D(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)"collapsed"===t.getState()&&t.setState({state:"partiallyExpanded"}),t=t.getParent()}function b(e,t){return e&&e.hasOwnProperty(t)?e[t]:e.grid[t]}function S(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)t.expand(),t=t.getParent()}function _(e){var t=e.getChildren();for(let e=0;e<t.length;e++)!0===t[e].isGroupingNode?_(t[e]):t[e].select()}function x(e){var t=[],o=e.getChildren();for(let e=0;e<o.length;e++)!0===o[e].isGroupingNode?t=t.concat(x(o[e])):t.push(o[e]);return t}function y(e){let t=null;for(;e.getParent()&&null===t;)(e=e.getParent()).isGroupingNode?t=e:y(e);return t}var C="true"!==g.getURLParameter("noFlatGrouping"),N=0;const P=JSON.parse(o),A=180*(3-Math.sqrt(5));var w=r.extend({});return w.prototype.getGroupLayout=function(){return C?"compact":"structured"},w.prototype.isGroupingApplied=function(){return this.options.isGroupingApplied},w.prototype.isGroupColorApplied=function(){return!!this.options.coloredGroups},w.prototype.getGroupingNode=function(e,t,o){var i,n=e.getID(),s=this.options.mapGrpNodes[n];if(s){var r=this.__getKeyFromNode(t);r||(r="other"),this.options.mergedMap[r]&&(r=this.options.mergedMap[r]),(i=s[r])||(i=s.other?s.other:this.__createOtherNode(s,e,"",[])),o&&D(i)}return i},w.prototype.getGroupingNodeV2=function(e,t,o){var i;let n=!1;var s=this.options.mapGrpNodes[e];if(s){var r=this.__getKeyFromNodeV2(t);r||(r="other"),this.options.mergedMap[r]&&(r=this.options.mergedMap[r]),(i=s[r])||("other"!==r&&(n=!0),s.other?(i=s.other,this.isEditor()&&i.isHidden()&&(i.show(),"collapsed"===i.getState()&&i.setState({state:"expanded"}))):i=this.__createOtherNode(s,this.getNodesById(e)[0],"",[])),o&&D(i)}let a={shouldBeNewGroup:!1,groupNode:i,actualGroupKey:r};return n&&(a.shouldBeNewGroup=!0),a},w.prototype.setGrpPartialExpandState=function(e){D(e)},w.prototype.cleanGrouping=function(){this.options.mapGrpNodes={},this.options.isGroupingApplied=!1,this.options.groupPredicates=[],this.options.selectedTags=[],this.options.realSelectedTags=[],this.options.mergedMap={},this.options.groupingFilterInProgress=!1;for(var e=this.getRoots(),t=0;t<e.length;t++)e[t].options.childComputed=!1},w.prototype.cleanGroupingForRoots=function(e){let t=e.rootIds?e.rootIds:[];for(let e=0;e<t.length;e++)delete this.options.mapGrpNodes[t[e]]},w.prototype.getGroupingForOpen=function(){let e=void 0;if(this.options.isGroupingApplied){e=[];for(let t=0;t<this.options.groups.length;t++){let o=[];for(let e=0;e<this.options.groups[t].object.length;e++)o.push(this.options.groups[t].object[e].object);e.push({predicate:this.options.groups[t].predicate,tags:o})}e.length>0&&f.addCommandHit("openWithGrouping",this.options.groups[0].predicate)}return e},w.prototype.clearCachedHiddenNodes=function(){delete this.options.hiddenNodes},w.prototype.__applyGrouping=function(e){var t=this;return this.isGroupColorApplied()&&this.__removeColorGroupCmd(),!0===this.options.groupingFilterInProgress?(console.debug("Grouping with filter in progress"),Promise.resolve()):new Promise(o=>{var i=e.fromGroupingEvent||e.fromApplyFilter||e.fromLayoutChange;if(i)if(e.roots){let o=[];for(let t=0;t<e.roots.length;t++)o.push(e.roots[t]);t.cleanGroupingForRoots({rootIds:o})}else t.cleanGrouping();this.options.groupingFilterInProgress=!0,this.options.hiddenNodes=new Map;let n=Array.isArray(e.roots)&&e.roots.length?e.roots:this.getRoots();for(let e=0;e<n.length;e++){let t=n[e],o=t.getAllDescendants().filter(e=>0===e.options.isHiddenState);o.length>0&&this.options.hiddenNodes.set(t,o)}t.__collapseAllRoots({roots:e.roots,noGroupUpdate:e.noGroupUpdate}).then(n=>{var s=[];if(e.groups.length){t.options.groups=e.groups;for(let e=0;e<t.options.groups.length;e++)for(let o=0;o<t.options.groups[e].object.length;o++)if(Array.isArray(t.options.groups[e].object[o].object)){var r="",a=t.options.groups[e].object[o].object;for(let e=0;e<a.length;e++)r+=a[e],-1===t.options.selectedTags.indexOf(r)&&t.options.selectedTags.push(r),r+="/";let i=t.options.groups[e].object[o].object.join("/");t.options.realSelectedTags.push(i)}else{let i=[t.options.groups[e].object[o].object];if(Array.isArray(t.options.groups[e].object[o].merged))for(let n=0;n<t.options.groups[e].object[o].merged.length;n++)i.push(t.options.groups[e].object[o].merged[n].object),t.options.mergedMap[t.options.groups[e].object[o].merged[n].object]=t.options.groups[e].object[o].object;t.options.selectedTags=t.options.selectedTags.concat(i),t.options.realSelectedTags=t.options.realSelectedTags.concat(i)}t.options.selectedTags=t.options.selectedTags.filter(function(e,o){return t.options.selectedTags.indexOf(e)===o}),t.options.realSelectedTags=t.options.realSelectedTags.filter(function(e,o){return t.options.realSelectedTags.indexOf(e)===o});var l=Promise.resolve();if(!0!==e.noGroupUpdate&&(l=t.__retrieveGrps(e)),n.length){var p=t.__fetchChildren({lstRemoveChildren:n,groupingPromise:l,noGroupUpdate:e.noGroupUpdate}).then(()=>{t.options.isGroupingApplied=!0});s.push(p)}else t.options.isGroupingApplied=!0;s.push(l)}else{for(let e=0;e<t.options.groupPredicates.length;e++)d.removeBIColumn(t.options.groupPredicates[e]);t.options.groupPredicates=[]}Promise.allSettled(s).then(()=>{c.publish({event:"ENXModel/Model/ApplyGrouping/Done",data:{fromEvent:i,status:!0}}),t.options.groupingFilterInProgress=!1,o()})})})},w.prototype.__groupsLayoutCmd=function(e){let t=!0;switch(e.mode){case"structured":t=!1;break;default:case"compact":t=!0}t!==C&&(C=t,this.__applyGrouping({groups:this.options.groups,fromLayoutChange:!0}))},w.prototype.__collapseAllRoots=function(e){var t=this;return new Promise(o=>{var i=Array.isArray(e.roots)&&e.roots.length?e.roots:t.getRoots();this.prepareUpdate();var n=[];for(let t=0;t<i.length;t++){var s=i[t];if(s){var r=s.getState(),a=[],l=0;let t=s.getChildren();for(;t.length-l;){var d=!0;if(!0===t[l].isRelationsObjectNode&&(d=!1,!0!==e.noGroupUpdate&&!0===t[l].isGroupingNode&&(d=!0)),d){var c=s.removeChild(t[l]);a.push({rootID:s.getID(),node:c})}else l++}!0!==e.noGroupUpdate&&(s.setState({state:"collapsed"}),s.options.padstate="collapsed",s.childComputed=!1),"expanded"!==r&&"partiallyExpanded"!==r||(n=n.concat(a))}}this.pushUpdate({updateType:WUXModelUpdateTypes.Removal}),o(n)})},w.prototype.__retrieveGrps=function(e){var t=this;return new Promise(o=>{var i=Array.isArray(e.roots)?e.roots:t.getRoots();i=Array.isArray(e.roots)?e.roots:t.getRoots();let n=[];for(let o=0;o<i.length;o++)n.push(t.__retrieveGrpsOnNode(i[o],e));Promise.allSettled(n).then(o)})},w.prototype.__retrieveGrpsOnNode=function(e,t){var o=this;return new Promise((i,n)=>{var s;console.log("Apply grouping on node "+e.getLabel()),s=p.getGroupingNodes?Promise.resolve():u.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});var r=o.options.groupPredicates=[];for(let e=0;e<t.groups.length;e++)r.push(t.groups[e].predicate),d.addBIColumn(t.groups[e].predicate,!0);s.then(()=>{var s={filterBI:o.options.filterBI?o.options.filterBI:o.options.FBIProxy._biFilter,data:{},pathIds:[e.getOccurencePath()],grouping:t,is2D:!0,filter_facets:r};p.getGroupingNodes(s).then(n=>{o.__buildGrpsOnNode(e,n,t.groups).then(i)}).catch(n)})})},w.prototype.__buildGrpsOnNode=function(e,t,o){var i=this;return new Promise(n=>{t="string"==typeof t?JSON.parse(t):t;var s={},r=i.options.mapGrpNodes[e.getID()]={},a=[],l=!1;for(let n=0;n<t.results.length;n++)if(t.results[n].synthesis){var d=t.results[n].synthesis&&t.results[n].synthesis.facets?t.results[n].synthesis.facets:[];let h=o[0].object.map(e=>e.object);if((d=d.slice().sort(function(e,t){return h.indexOf(e.object)-h.indexOf(t.object)})).length)for(let t=0;t<d.length;t++){var c=d[t];if(c.sixw){var p=c.sixw.split("/"),u=p[p.length-1];-1!==i.options.groupPredicates.indexOf(u)&&(!0===C?i.__buildFlatGrping(c,e,s,a,r,o):i.__buildStructuredGrping(c,e,s,a,r,o))}}else t.results[n].synthesis.name.contains("Other")&&t.results[n].synthesis.value>0&&(l=!0)}if(!0===l||i.isEditor()){let t=i.__createOtherNode(r,e,u,a);l||t.hide()}e.setState({state:"expanded"}),n()})},w.prototype.__createOtherNode=function(t,o,n,s){var r=new i({isGroupingNode:!0,resourceid:"xnav-groupingNode-other-"+v.v4(),label:e.groupingNode.other,grid:{groupValue:e.groupingNode.other},parentNode:o,isOther:!0,ds6w:n,grp:s,groupingIntent:this.options.groups});return r.onPreExpand(this._expandGrpNode.bind(this)),t.other=r,o.addChild(r),r},w.prototype.__buildStructuredGrping=function(e,t,o,n,s){var r=e.sixw.split("/"),l=r[r.length-1],d=a.splat(e.object),c=t,p="",u="";for(let e=0;e<d.length&&(p+=d[e],-1!==this.options.selectedTags.indexOf(p)||!0===c.isGroupingNode&&c.isGrpSelected());e++){if(this.options.mergedMap[p]&&(u=p,p=this.options.mergedMap[p]),o[p])c=o[p],this.options.mergedMap[u]&&(c.options.merged=!0,c.options.grp=c.options.grp.concat(d),n.push(d));else{var g=new i({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+d[e]+"-"+v.v4(),label:d[e],grid:{groupValue:d[e]},parentNode:c,ds6w:l,grp:d.slice(0,e+1),groupingIntent:this.options.groups});n.push(d.slice(0,e+1)),h.updateNLSGroupingNode(g),g.onPreExpand(this._expandGrpNode.bind(this)),c.addChild(g),(-1!==this.options.realSelectedTags.indexOf(p)||!0===c.isGroupingNode&&c.isGrpSelected())&&(-1!==this.options.realSelectedTags.indexOf(p)&&(g.options.grpSelected=!0,!0===c.isGroupingNode&&(c.options.contentRetrieved=!0,S(c))),s[p]=g),o[p]=g,c=g}p+="/"}},w.prototype.__buildFlatGrping=function(e,t,o,n,s,r){var l=e.sixw.split("/"),d=l[l.length-1],c=a.splat(e.object),p=t,u=c.join("/");this.options.mergedMap[u]&&(u=this.options.mergedMap[u]);var g,f=null;for(let e=0;r&&e<r.length;e++){let t=r[e];if(t.object)for(let e=0;e<t.object.length&&null===f;e++)t.object[e].object===u&&(f=t.object[e])}if(-1!==this.options.realSelectedTags.indexOf(u)||!0===p.isGroupingNode&&p.isGrpSelected())if(o[u])(g=o[u]).options.merged=!0,g.options.grp=g.options.grp.concat(c),n.push(c);else{var m=c[c.length-1];g=new i({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+m+"-"+v.v4(),label:f?f.dispText:m,dispText:f?f.dispText:void 0,grid:{groupValue:m},parentNode:p,ds6w:d,grp:c,groupingIntent:this.options.groups}),n.push(c),h.updateNLSGroupingNode(g),g.onPreExpand(this._expandGrpNode.bind(this)),p.addChild(g),g.options.grpSelected=!0,s[u]=g,o[u]=g}else if(function(e,t){for(var o=null,i=e.length-1;i>=0;i--){var n=e.slice(0,i);if(-1!==t.indexOf(n.join("/"))){o=n;break}}return o}(c,this.options.realSelectedTags)){var D=e.object.slice(0,e.object.length-1);if(!(p=s[D.join("/")])){var b=UWA.clone(e);b.object=D,p=this.__buildFlatGrping(b,t,o,n,s)}g=this.__buildFlatGrping(e,p,o,n,s)}return g},w.prototype.grpGetOtherNode=function(e){let t=this.options.mapGrpNodes[e.getID()].other;if(t)return t.isHidden()&&t.show(),t},w.prototype.grpCheckOtherNodeHide=function(e){let t=this.options.mapGrpNodes[e.getID()].other;t&&!t.hasChildren()&&t.hide()},w.prototype.grpIsOtherVisible=function(e){let t=this.options.mapGrpNodes[e.getID()].other;if(t)return!t.isHidden()},w.prototype.grpIsBsdGroupingApplied=function(){if(!this._isBsdGroupingCalculated){let e=this.options.groupPredicates,t=this._bsdPredicates=function(e){return e.filter(e=>e.startsWith("ds6w:browsingStructure"))}(e);this._isBsdGroupingApplied=t.length>0,this._isBsdGroupingCalculated=!0}return this._isBsdGroupingApplied},w.prototype.grpCreateGroupNode=function(e){let t=e.groupValue,o=e.bsdPredicate,i=e.parentNode,n=this.createNodeModel({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+t+"-"+v.v4(),label:t,grid:{groupValue:t},ds6w:o,grp:this.options.grps,groupingIntent:this.options.groups});return i.addChild(n),n.onPreExpand(this._expandGrpNode.bind(this)),n},w.prototype._expandGrpNode=function(e){var o=this;return new Promise(i=>{var n=e.data,r=n.nodeModel,a=!!n.expandAll&&n.expandAll,c=n.state?n.state:"expanded";if(r._uiOnlyExpand)return delete r._uiOnlyExpand,void i();var u=[];if(!0===r.options.contentRetrieved){if(r.setState({state:c}),e.target&&e.target.preExpandDone({preventExpandAll:!0}),a){let e=r.getChildren();for(let t=0;t<e.length;t++)!0===e[t].isGroupingNode&&u.push(o._expandGrpNode({data:{nodeModel:e[t],expandAll:!0,state:c}}))}Promise.all(u).then(i)}else{var h=parseInt("1"),f=d.createOutputsRequest(),v=l.getWebAPI_Options("navigate"),m=!1,D=[];D[0]={},D[0].predicate=r.options.groupingIntent[0].predicate,D[0].predLevel=r.options.groupingIntent[0].predLevel,D[0].other=r.options.isOther;var b,S,_=r.getGroups();if(r.options.isOther){var x=[];for(let e=0;e<_.length;e++)x.push({object:_[e]});0==x.length&&(m=!0),D[0].object=x}else r.options.merged?D[0].object=r.options.groupingIntent[0].object:D[0].object=[{object:_}];if(m?(b={pathIds:[r.getParent().getOccurencePath()],FBIProxy:o.options.FBIProxy,data:{expandLevel:h},select_relation:["ro.plminstance.v_treeorder"]},S=p.expandv2(b)):(b={filterBI:o.options.filterBI?o.options.filterBI:o.options.FBIProxy._biFilter,expandLevel:h,data:{select_bo:f.select_object,select_rel:f.select_relation,compute_select_bo:f.select_file},pathIds:[r.getOccurencePath()],iterativeFilter:v["q.iterative_filter_query_bo"],filterRel:v.no_type_filter_rel,groupingFilter:D},S=p.expandGroupingNodeV2(b)),o.prepareUpdate(),a){let e=r.getChildren();for(let t=0;t<e.length;t++)!0===e[t].isGroupingNode&&u.push(o._expandGrpNode({data:{nodeModel:e[t],expandAll:!0,state:c}}))}var y=new Promise(function(e,i){S.then(function(i){try{var n=UWA.is(i,"string")?JSON.parse(i):i;if(!0===n.timeoutOccurs)r.setState({state:"collapsed"}),g.displayNotif({message:t.find_in_context_timeout,level:"error",key:"expandGroup-timeout"});else{var a=r,d=l.getSetting("parse_timeout");d&&parseInt(d);s.parseExpandLoadModel({treeDoc:o,expandedNodes:[a],FBIProxy:o.options.FBIProxy._biFilter,wsResponse:n,nodeModelClass:o.options.nodeModelClass,expandLevel:h})}}catch(e){e.type&&"TimeoutError"===e.type?g.displayNotif({message:t.parseTimeout,level:"warning",key:"expandGroup-parse-timeout"}):g.displayNotif({message:t.generic_service_failure,level:"error",key:"expandGroup-generic-error"})}finally{if(!0!==n.timeoutOccurs&&(r.options.contentRetrieved=!0,r.setState({state:c}),!0===a.options.filtered)){var p=UWA.clone(a.options.icons[0]);p.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},a.updateOptions({icons:[p]})}e()}}).catch(function(e){r.setState({state:"collapsed"}),i()})});u.push(y),Promise.all(u).then(()=>{o.pushUpdate(),e.target&&e.target.preExpandDone({preventExpandAll:!0}),i()})}})},w.prototype.__getKeyFromNode=function(e){var t=null;if(this.options.groupPredicates.length>1)throw new Error("Too many grouping predicates");for(let n=0;n<this.options.groupPredicates.length;n++){var o=e.getReferenceValue(this.options.groupPredicates[n]+"-Instance"),i=e.getReferenceValue(this.options.groupPredicates[n]);o?"boolean"==typeof i?(!1!==o&&"FALSE"!==o||!0!==i||(o=!0),t=o.toString().toUpperCase()):t=o:t="boolean"==typeof i?i.toString().toUpperCase():i,t&&!0===Array.isArray(t)&&(1===t.length?t=t[0]:console.warn("Node ["+e.getLabel()+"] is defined in several group. Will be displayed in Other group"))}return t},w.prototype.__getKeyFromNodeV2=function(e){var t=null;if(this.options.groupPredicates.length>1)throw new Error("Too many grouping predicates");for(let n=0;n<this.options.groupPredicates.length;n++){var o=b(e,this.options.groupPredicates[n]+"-Instance"),i=b(e,this.options.groupPredicates[n]);o?"boolean"==typeof i?(!1!==o&&"FALSE"!==o||!0!==i||(o=!0),t=o.toString().toUpperCase()):t=o:t="boolean"==typeof i?i.toString().toUpperCase():i,t&&!0===Array.isArray(t)&&(1===t.length?t=t[0]:console.warn("Node ["+actualNode.getLabel()+"] is defined in several group. Will be displayed in Other group"))}return t},w.prototype.getGroupingNodesList=function(e){return this.options.mapGrpNodes&&this.options.mapGrpNodes[e]?Object.values(this.options.mapGrpNodes[e]):[]},w.prototype.__expandAllGroups=function(e){var t=this.options.mapGrpNodes[e.getID()];if(t){var o=Object.keys(t);this.withTransactionUpdate(()=>{for(let i=0;i<o.length;i++){(!0===e.isGroupingNode?e.options.parentNode.getID():e.getID())===t[o[i]].getGroupObjID()&&(t[o[i]].expandAll(),t[o[i]].options.contentRetrieved=!0,t[o[i]].setState({state:"expanded"}))}})}},w.prototype.__fetchChildren=function(e){var t=this;return new Promise(o=>{e.groupingPromise.then(()=>{var i=[],n={},s=[],r=[];for(let o=0;o<e.lstRemoveChildren.length;o++){let c=e.lstRemoveChildren[o].node;if(!0!==c.isGroupingNode&&!0!==c.isRelationsObjectNode){var a=!1;for(let e=0;!1===a&&e<t.options.groupPredicates.length;e++){var l=c.getReferenceValue(t.options.groupPredicates[e]);l?console.log("Predicate value ["+l+"] found on node "+c.getLabel()):(i.push(c.getID()),n[c.getID()]=c,a=!0);var d=c.getReferenceValue(t.options.groupPredicates[e]+"-Instance");d?console.log("Predicate value on instance ["+d+"] found on node "+c.getLabel()):(i.push(c.getRelationID()),a=!0,n[c.getRelationID()]=c)}a&&(s.push(c),r.push(e.lstRemoveChildren[o].rootID))}}var c=Promise.resolve();i.length?(console.log("Fetch the predicates values for the grouping on "+i.length+" objects"),c=new Promise(e=>{var o={pids:i,data:{select_predicate:t.options.groupPredicates.concat(["ds6w:globalType"]),select_file:[]}};p.fetch(o).then(t=>{t="string"==typeof t?JSON.parse(t):t;for(let e=0;e<t.results.length;e++){var o,i=t.results[e],s={},r=!1,a="ds6w:Part"!==s["ds6w:globalType"]&&"ds6w:Document"!==s["ds6w:globalType"];for(let e=0;e<i.attributes.length;e++)"resourceid"===i.attributes[e].name?o=n[i.attributes[e].value]:"ds6w:globalType"===i.attributes[e].name?a="ds6w:Part"!==i.attributes[e].value&&"ds6w:Document"!==i.attributes[e].value:(s[i.attributes[e].name]=i.attributes[e].value,r=!0);if(!0===r&&o){var l={grid:{}},d=Object.keys(s);for(let e=0;e<d.length;e++)a?l.grid[d[e]+"-Instance"]=s[d[e]]:l.grid[d[e]]=s[d[e]];o.updateOptions(l)}}e()})})):console.log("No Id to fetch"),c.then(()=>{for(let o=0;o<s.length;o++){var i=s[o],n=t.searchRootById(r[o]),a=t.getGroupingNode(n,i);a&&(i.show(),a.addChild(i),!0!==e.noGroupUpdate&&(a.options.contentRetrieved=!0))}o()})})})},w.prototype.__expandAllGroupsCmd=function(){var t=this;return new Promise(o=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.expandAllGroupsCmd,context:t});let i=t.getSelectedNodes();var n=[];t.withTransactionUpdate(()=>{for(let e=0;e<i.length;e++)!0===i[e].isGroupingNode&&n.push(t._expandGrpNode({data:{nodeModel:i[e],expandAll:!0,state:"expanded"}}))}),Promise.all(n).then(()=>{t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),o()})})},w.prototype.focusOnGroups=function(){return this.__focusOnGroupsCmd()},w.prototype.__focusOnGroupsCmd=function(){var t=this;return new Promise(o=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.focusOnGroupsCmd,context:t});let i=t.getSelectedNodes(),n=[];var s=[];t.withTransactionUpdate(()=>{for(let e=0;e<i.length;e++)if(!0===i[e].isGroupingNode){n.push(i[e]);let o="expanded"===i[e].getState()?"expanded":"collapsed";s.push(t._expandGrpNode({data:{nodeModel:i[e],expandAll:!0,state:o}}))}}),Promise.all(s).then(()=>{t.withBroadcastSelect(()=>{for(let e=0;e<n.length;e++)_(n[e]);t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),o()})})})},w.prototype.__colorizeGroupCmd=function(){var t=this;return new Promise(o=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.colorizeGroupCmd,context:t});let i=t.getSelectedNodes(),n=[];var s=[];t.withTransactionUpdate(()=>{for(let e=0;e<i.length;e++)if(!0===i[e].isGroupingNode){n.push(i[e]);let o="expanded"===i[e].getState()?"expanded":"collapsed";s.push(t._expandGrpNode({data:{nodeModel:i[e],expandAll:!0,state:o}}))}}),Promise.all(s).then(()=>{var e=[];for(let t=0;t<n.length;t++){var i=x(n[t]);e.push({groupNode:n[t],groupedPhysNode:i})}t.__buildEnrich3DColorize({colorizedGroups:e}).then(function(e){t._cmdProxy.enrich3D(e),t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),o()})})})},w.prototype.__buildEnrich3DColorize=function(e){var t=this;return new Promise(function(o,i){var n;if(e.colorizedGroups){t.options.coloredGroups||(t.options.coloredGroups={});for(let o=0;o<e.colorizedGroups.length;o++){var s=e.colorizedGroups[o];if(!t.options.coloredGroups[s.groupNode.getID()]){var r=Object.keys(t.options.coloredGroups),a=s.groupedPhysNode.map(e=>e.getOccurencePath());if(void 0!==typeof a&&a.length>0){let e=t.__getNextColor();s.groupNode.updateOptions({color:e});var l=s.groupNode.getLabel(),d=(r=Object.keys(t.options.coloredGroups))?r.length+1:1;t.options.coloredGroups[s.groupNode.getID()]={coloredGprNode:s.groupNode,groupLabel:l,paths:a,style:s.style?s.style:{color:e,opacity:1,forceInherit:!0,label:l,id:d}}}}}}else delete t.options.coloredGroups;if(t.options.coloredGroups){var c=t.options.coloredGroups,p=(r=Object.keys(c),c[r[0]].coloredGprNode.getPredicate());h.retrieveDS6WNLS([p]).then(function(e){var i=e&&e[p]?e[p].label:p;n={deleteOnUnlink:!0,cumulativeMode:!0,graphicProperties:{kinds:[{AMD:"DS/ENOPAD3DViewer/views/PADLayerGroupingView",kind:"grouping"}],layers:[]}};var s={label:i,kind:"grouping",type:"grouping",id:r[0],styles:[{color:"#FFFFFF",opacity:.5,forceInherit:!1,label:"no match",id:0}],colorMap:[{resourceid:c[r[0]].paths[0][0],style:0}]};for(let e=0;e<r.length;e++){let o=c[r[e]];s.styles.push(o.style);for(let e=0;e<o.paths.length;e++){let i=o.paths[e],n=y(t.getNodeByOccurencePath(i)),r=n.options.color;!n||n.getID()!==o.coloredGprNode.getID()&&r||s.colorMap.push({path:i,style:o.style.id})}}n.graphicProperties.layers.push(s),o(n)})}})},w.prototype.__getNextColor=function(){let e;if(this.options.usedColor||(this.options.usedColor=[]),this.options.usedColor.length+1<P.colorStream.length)e=P.colorStream[this.options.usedColor.length],this.options.usedColor.push(e);else{e=function(e,t,o){o/=100;const i=t*Math.min(o,1-o)/100,n=t=>{const n=(t+e/30)%12,s=o-i*Math.max(Math.min(n-3,9-n,1),-1);return Math.round(255*s).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}(N*A,100,75),N++}return e},w.prototype.__removeColorGroupCmd=function(){let e=Object.keys(this.options.coloredGroups);m.publish("DS/ENO/enrich3D",{deleteLayers:[e[0]]});for(let t=0;t<e.length;t++)this.options.coloredGroups[e[t]].coloredGprNode.updateOptions({color:null});N=0,delete this.options.coloredGroups,delete this.options.usedColor},w}),define("DS/ENXNav/models/xNavDocument",["UWA/Core","DS/Logger/Logger","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/TreeModel/TreeDocument","DS/ENXNav/models/_xNavGrouping","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/HideShowController","DS/ENXNav/models/AdditionalRelDummyInfo","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTransactionManager","DS/PADUtils/PADSession","DS/PADUtils/PADProbes","DS/PADUtils/views/PADPager","DS/PADUtils/Utility","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/models/mixins/TreeDocShared","DS/ApplicationFrame/CommandsManager","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Helpers","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f,v,m,D,b,S,_,x,y,C){"use strict";return console.warn("Deprecated use of DS/ENXNav/models/xNavDocument"),""}),define("DS/ENXNav/features/xNavPersistFilterSpec",["DS/PADUtils/PADUtilsServices","DS/ENXNav/utils/TwoDAppEvents"],function(e,t){function o(e){this.context=e.context,this.filterSpec=new Map,this.filterSpecDE=new Map,this.validFilterId=[],this.validFilterIdCopy=[],this.unresolvedSpec=[],this.readOnlyRootsFilterSpec=new Map,this.readOnlyRootsList=[]}return o.prototype={addEventForEachFilter:function(e){var t=this;for(let o=0;o<e.length;o++)setTimeout(function(){t.context._biFilter.removeEvent("getFilterSpec-"+e[o]),t.context._biFilter.addEvent("getFilterSpec-"+e[o],t.processPublicationFilterSpec.bind(t,e[o])),o===e.length-1&&t.retrieveFilterSpecFromBIFilter(e)},100)},retrieveFilterSpecFromBIFilter:function(t){var o=this;for(let i=0;i<t.length;i++)setTimeout(function(){let n={rootId:t[i],NGFUXId:o.context.getNGFUXID(!0),widgetId:e.getWidgetId(),eventName:"getFilterSpec-"+t[i]};o.context._biFilter.hasEvent("getFilterSpec-"+t[i])&&o.context._biFilter.getPublicFilterSpecification(n)},200)},processPublicationFilterSpec:function(e,t){1===t.status&&t.publicSpec?(this.context.xNavPersistFilterSpec.filterSpec.set(e,t.publicSpec),this.context.shouldAddSpecForDE&&(this.context.xNavPersistFilterSpec.filterSpecDE.set(e,t.publicSpec),this.context.shouldAddSpecForDE=!1)):0===t.status&&null!==t.error&&console.warn(t.error.title,t.error.message)},retainingFilterSpecForReadOnlyRoot:function(e){var t=[];t.push({physical_id_path:[e]});var o=this.context._biFilter.getFilterSpec(e,{V2:{prefixPathArray:t}});this.context.xNavPersistFilterSpec.readOnlyRootsFilterSpec.set(e,o)}},Object.defineProperties(o.prototype,{name:{get:function(){return"persistFilterSpec"}}}),o}),define("DS/ENXNav/models/mixins/TreeDocGrouping",["i18n!DS/ENXNav/assets/nls/ENXNav","text!DS/PADServices/assets/init/DefaultColorStream.json","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils","DS/PADServices/ws/WSAccess","DS/PADServices/settings/AppSettings","DS/ENOXParser/ParserCV","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PADTrackerManager","UWA/Utils","DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADUtilsServices","DS/PlatformAPI/PlatformAPI","DS/ENXNav/utils/TwoDAppEvents","DS/WebappsUtils/WebappsUtils","DS/ENXNav/mixins/_xNavBIFilter"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f,v,m,D,b){"use strict";const S="structured",_="compact",x=JSON.parse(t);var y=!0;function C(){}C.prototype.initGrpV2=function(){this.options.mappedNodes=new Map,this.options.coloredNodes=new Map,this.grpBSDActivated=d.getSetting("grpBSD"),!0===this.grpBSDActivated?v.subscribe("groupByBSSelection.Select",this.organizeWithBS.bind(this)):(i.subscribe({event:"ENXModel/Model/GroupsLayout"},this.__groupsLayoutCmd.bind(this)),i.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGroupingTagger.bind(this))),i.subscribe({event:"ENXModel/Model/ExpandAllGroups"},this.__expandAllGroupsCmd.bind(this)),i.subscribe({event:"ENXModel/Model/FocusOnGroups"},this.__focusOnGroupsCmd.bind(this)),i.subscribe({event:"ENXModel/Model/ColorizeGroup"},this.__colorizeGroupCmd.bind(this)),i.subscribe({event:"ENXModel/Model/RemoveGroupColor"},this.__removeColorGroupCmd.bind(this))},C.prototype.isGroupingApplied=function(){return this.options.mappedNodes.size>0||void 0!==this.options.activeGroupingTagger},C.prototype.isGroupColorApplied=function(){return!!this.options.coloredNodes.size},C.prototype.getGroupLayout=function(){return y?_:S},C.prototype.getActiveGrouping=function(e){let t=[];return void 0!==this.options.activeGroupingTagger&&(t=this.options.activeGroupingTagger.groups),t},C.prototype.getGroupForNode=function(e){let t,o=this.options.mappedNodes.get(e.node.getOccurencePath().join("/"));return o&&(o.grpParams?t=this.__getGroupForNode(e.state,o,e.child):o.predicate&&(t=this.__getBSForNode(e.state,o,e.child))),t},C.prototype.applyGroupingOnNode=function(e){return new Promise(async(t,o)=>{console.groupCollapsed("TreeDocGrouping:applyGroupingOnNode## "+e.node.getLabel());try{let i=e.node.getOccurencePath(),n=i.length,s=i.join("/");console.log("Node level ["+n+"] occPath="+s),console.debug("Group definition: "+JSON.stringify(e.grouping,null,2)),this.options.mappedNodes.set(s,{grpParams:e}),Array.isArray(e.grouping.groups)&&e.grouping.groups.length?u.addCommandHit("applyGroupingOnNode",e.grouping.groups[0].predicate):u.addCommandHit("removeGroupingOnNode",""),!0===this.options.groupingFilterInProgress?console.debug(" = Grouping with filter in progress"):(this.options.groupingFilterInProgress=!0,e.grouping.groups.length?(await this.__buildTagLst(s,e.grouping.groups),await this.__retrieveGrpOnNode(e)):(console.debug("== No groups applied"),this.removeGrouping({selectedNode:e.node})),this.options.groupingFilterInProgress=!1),t()}catch(e){console.error(e),o(e)}console.groupEnd()})},C.prototype.cleanGroupingForRoots=function(e){let t=e.rootIds?e.rootIds:[];for(let e=0;e<t.length;e++)delete this.options.mappedNodes.get(t[e]).mapGrpNodes},C.prototype.cleanGroupingForNodes=function(e){let t=e.node.getOccurencePath().join("/");this.options.mappedNodes.get(t)&&this.options.mappedNodes.delete(t)},C.prototype.__applyGrouping=function(e){i.publish({event:"ENXNav/FilterBIGroupingEvent",data:e})},C.prototype.removeGrouping=async function(e){var t=e.selectedNode;!0===t.getReferenceValue("groupApplied")?this.withTransactionUpdate(()=>{t.hasChildren()&&t.removeChildren(),t.updateOptions({grid:{groupApplied:void 0,bsApplied:void 0},children:[]}),t.setState({state:"collapsed"}),this.options.mappedNodes.delete(t.getOccurencePath().join("/"))}):this.options.mappedNodes.get(t.getOccurencePath().join("/"))&&(this.options.mappedNodes=new Map),this.options.usedColor&&this.__removeColorGroupCmd()},C.prototype.getGroupingForOpen=function(){let e,t={};if(this.options.mappedNodes.size){if(!0===this.grpBSDActivated){t.organize=[];let o=[];this.options.mappedNodes.forEach((i,n,s)=>{let r=n.split("/"),a=this.getNodeByOccurencePath(r);e=i.predicate.name,console.log("Node group by BS: "+a.getLabel());let l=o.indexOf(e);-1===l?t.organize.push({predicate:i.predicate.name,ids:[a.getID()]}):t.organize[l].ids.push(a.getID())})}else{t.grouping=[];let o=this.options.mappedNodes.entries().next().value[1].grpParams.grouping.groups;console.log("Tags Groups:\n"+JSON.stringify(o,null,2));for(let i=0;i<o.length;i++){let n=[];for(let e=0;e<o[i].object.length;e++)n.push(o[i].object[e].object);e=o[0].predicate,t.grouping.push({predicate:o[i].predicate,tags:n})}}Object.keys(t).length&&(console.debug("Grp open:\n "+JSON.stringify(t)),u.addCommandHit("openWithGrouping",e))}return t},C.prototype.organizeWithBS=async function(e){if(void 0!==e.widgetID&&e.widgetID!==a.getWidgetId())return;let t=this.getSelectedNodes()[0];if(void 0===t)return;let o={node:t,predicate:0===e.predicate.length?void 0:{name:e.predicate,label:e.label}};console.groupCollapsed("TreeDocGrouping:organizeWithBS## "+o.node.getLabel()),i.publish({event:"ENXViews/DatagridView/ClearViewGrouping"}),setTimeout(async()=>{let e,t=o.node.getOccurencePath(),n=t.length,s=t.join("/");if(console.log("Node level ["+n+"] occPath="+s),console.debug("BS to organize with: ["+JSON.stringify(o.predicate)+"]"),void 0===o.predicate){let t=this.options.mappedNodes.get(s);t&&(e=t.predicate)}this.options.mappedNodes.set(s,{predicate:o.predicate}),!0===this.options.groupingFilterInProgress?console.debug(" = Grouping with filter in progress"):(this.options.groupingFilterInProgress=!0,void 0!==o.predicate?(u.addCommandHit("organizeWithBS",o.predicate.name),await this.__retrieveBSOnNode(o)):(u.addCommandHit("removeOrganize",""),console.debug("== No BS applied"),this.removeGrouping({selectedNode:o.node}),m.bsdFail({node:o.node,predicateInfo:e})),this.options.groupingFilterInProgress=!1,i.publish({event:"ENXNav/UpdateCmdAvailability"}))},250),console.groupEnd()},C.prototype.__retrieveBSOnNode=async function(t){var o=t.node;console.log("== Retrieve BS on node "+o.getLabel()),o.hasChildren()&&o.removeChildren(),o.setState({state:"expanding"}),l.getBSDGroupOnInstances||await n.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});let i=o.getOccurencePath().join("/"),r=this.options.mappedNodes.get(i).predicate;s.addBIColumn(r.name,!0);var d={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,data:{},pathIds:[o.getOccurencePath()],predicate:r.name,is2D:!0};let c=await l.getBSDGroupOnInstances(d);(c="string"==typeof c?JSON.parse(c):c).errors&&!c.results&&m.bsdFail({node:o,predicateInfo:r}),c.errors&&a.displayNotif({message:e.organizeBS.errorRetrieveBS,level:"error",key:"xNavDoc-organizeBS"}),c.results&&await this.__buildBSOnNode(o,c,r)},C.prototype.__buildBSOnNode=async function(t,o,i){let n=t.getOccurencePath().join("/"),s=this.options.mappedNodes.get(n);var r={},l=[];s.mapBSNodes=r;let d=!1;for(let e=0;e<o.results.length;e++)if(o.results[e].synthesis){var p=o.results[e].synthesis&&o.results[e].synthesis.facets?o.results[e].synthesis.facets:[];if(p.length){d=!0;for(let e=0;e<p.length;e++){var u=p[e];u.sixw&&this.__buildBSStructure(u,t,r,s)}}}else l.push(o.results[e]);t.withTransactionUpdate(async()=>{if(!1===d?(a.displayNotif({title:e.replace(e.organizeBS.groupBy,{label:s.predicate.label}),message:e.replace(e.organizeBS.noBSGroup,{label:t.getLabel()})}),this.options.mappedNodes.delete(n),t.updateOptions({grid:{bsApplied:void 0}}),t.updateOptions({grid:{groupApplied:!1}}),t.setState({state:"collapsed"})):(t.updateOptions({grid:{bsApplied:s.predicate.name}}),t.updateOptions({grid:{groupApplied:!0}}),this.options.mappedNodes.set(n,s),t.setState({state:"expanded"})),l.length){let e=t.getRoot();await c.parseExpandOcc({treeDoc:this,expandedNodes:[t],FBIProxy:this.options.FBIProxy,wsResponse:o,nodeModelClass:this.options.nodeModelClass,expandLevel:1,expandLevelRequest:parseInt(1),filter:e.options.filtered})}d?m.bsdApply({node:t,predicateInfo:s.predicate}):m.bsdFail({node:t,predicateInfo:s.predicate})})},C.prototype.__buildBSStructure=function(e,t,i,n){var s=e.sixw.split("/"),a=s[s.length-1],l=h.splat(e.object),d=t,c="";for(let e=0;e<l.length;e++){if(i[c+=l[e]])d=i[c];else{var p=new o({isGroupingNode:!0,resourceid:"xnav-BSDNode-"+l[e]+"-"+d.getID(),label:l[e],grid:{groupValue:l[e]},parentNode:d,ds6w:a,grp:l.slice(0,e+1),bsIntent:n});r.updateNLSGroupingNode(p),d.addChild(p),i[c]=p,d=p}c+="/"}},C.prototype.__expandBSGrpNode=async function(e){var t=e.data,o=t.nodeModel,n=!!t.expandAll&&t.expandAll,r=t.state?t.state:"expanded",a=parseInt("1");let d=s.createOutputsRequest();if(!0!==o.getReferenceValue("groupExpanded")){let e={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,expandLevel:a,data:{select_bo:d.select_object,select_rel:d.select_relation,compute_select_bo:d.select_file},pathIds:[o.getOccurencePath()],bsGrp:{predicate:o.options.ds6w,nodePath:o.options.grp},withOccResponse:!0};try{let t=o.getRoot(),n=await l.expandBSNode(e);n="string"==typeof n?JSON.parse(n):n,await c.parseExpandOcc({treeDoc:this,expandedNodes:[o],FBIProxy:this.options.FBIProxy,wsResponse:n,nodeModelClass:this.options.nodeModelClass,expandLevel:1,expandLevelRequest:parseInt(1),filter:t.options.filtered}),o.updateOptions({grid:{groupExpanded:!0}}),i.publish({event:"ENXModel/parseEnded"})}catch(e){console.log("== Failed to expand BS node "+o.getLabel())}}if(n){let e=[],t=o.getChildren();for(let o=0;o<t.length;o++)!0===t[o].isGroupingNode&&e.push(this.__expandBSGrpNode({data:{nodeModel:t[o],expandAll:!0,state:r}}));await Promise.all(e)}o.setState({state:"expanded"})},C.prototype.__getBSForNode=function(e,t,o){let i,n=t.predicate,s=o.getReferenceValue(n.name+"-Instance");if(void 0!==s&&void 0!==t.mapBSNodes[s]&&(i=t.mapBSNodes[s]),i){i.setState({state:e||"partiallyExpanded"});let t=i.getParent();for(;t.isGroupingNode;)"collapsed"===t.getState()&&t.setState({state:e||"partiallyExpanded"}),t=t.getParent()}return i},C.prototype.__expandGrpNode=async function(e){return void 0!==e.data.nodeModel.options.bsIntent?this.__expandBSGrpNode(e):this.__expandTagGrpNode(e)},C.prototype.__expandAllGroupsCmd=async function(){return new Promise(t=>{this.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.expandAllGroupsCmd,context:this});let o=this.getSelectedNodes();var i=[];this.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)!0===o[e].isGroupingNode&&i.push(this.__expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:"expanded"}}))}),Promise.all(i).then(()=>{this.getModelEvents().publish({event:"endBlockingTransaction",context:this}),t()})})},C.prototype.__retrieveGrpOnNode=async function(e){var t=e.node;console.log("== Retrieve groups on node "+t.getLabel()),t.hasChildren()&&t.removeChildren(),t.setState({state:"expanding"}),l.getGroupingNodes||await n.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});let o=t.getOccurencePath().join("/"),i=this.options.mappedNodes.get(o).grpParams.grouping.groups;var r=[];for(let e=0;e<i.length;e++)r.push(i[e].predicate),s.addBIColumn(i[e].predicate,!0);var a={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,data:{},pathIds:[t.getOccurencePath()],grouping:{groups:i},is2D:!0,filter_facets:r};let d=await l.getGroupingNodes(a);d="string"==typeof d?JSON.parse(d):d,await this.__buildGrpsOnNode(t,d,i)},C.prototype.__expandTagGrpNode=async function(e){var t=e.data,o=t.nodeModel,i=!!t.expandAll&&t.expandAll,n=t.state?t.state:"expanded",r=parseInt("1");let a=s.createOutputsRequest(),d=p.getWebAPI_Options("navigate");var u=[];if(u[0]={},u[0].predicate=o.options.groupingIntent[0].predicate,u[0].predLevel=o.options.groupingIntent[0].predLevel,u[0].other=o.options.isOther,!0!==o.getReferenceValue("groupExpanded")){var h=o.getGroups();if(o.options.isOther){var g=[];for(let e=0;e<h.length;e++)g.push({object:h[e]});0==g.length&&(u[0].other=!0,g.push(o.options.groupingIntent[0].object[0].object)),u[0].object=g}else o.options.merged?u[0].object=o.options.groupingIntent[0].object:u[0].object=[{object:h}];let e={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,expandLevel:r,data:{select_bo:a.select_object,select_rel:a.select_relation,compute_select_bo:a.select_file},pathIds:[o.getOccurencePath()],iterativeFilter:d["q.iterative_filter_query_bo"],filterRel:d.no_type_filter_rel,groupingFilter:u,withOccResponse:!0};try{let t=o.getRoot(),i=await l.expandGroupingNodeV2(e);i="string"==typeof i?JSON.parse(i):i,await c.parseExpandOcc({treeDoc:this,expandedNodes:[o],FBIProxy:this.options.FBIProxy,wsResponse:i,nodeModelClass:this.options.nodeModelClass,expandLevel:1,expandLevelRequest:parseInt(1),filter:t.options.filtered}),o.updateOptions({grid:{groupExpanded:!0}})}catch(e){console.log("== Failed to expand grouping node "+o.getLabel())}}if(i){let e=[],t=o.getChildren();for(let o=0;o<t.length;o++)!0===t[o].isGroupingNode&&e.push(this.__expandTagGrpNode({data:{nodeModel:t[o],expandAll:!0,state:n}}));await Promise.all(e)}o.setState({state:"expanded"})},C.prototype.__getGroupForNode=function(e,t,o){let i,n=t.grpParams.grouping.groups[0].predicate,s=o.getReferenceValue(n);void 0===s&&(s=o.getReferenceValue(n+"-Instance")),void 0===s||s.indexOf(",")>0?(t.mapGrpNodes.other||this.__createOtherNode(t.mapGrpNodes,t.grpParams.node,n,[],t.grpParams.grouping.groups,t),i=t.mapGrpNodes.other):void 0===s||void 0===t.mapGrpNodes[s]?(t.mapGrpNodes.other||this.__createOtherNode(t.mapGrpNodes,t.grpParams.node,n,[],t.grpParams.grouping.groups,t),i=t.mapGrpNodes.other):i=t.mapGrpNodes[s],i.setState({state:e||"partiallyExpanded"});let r=i.getParent();for(;r.isGroupingNode;)"collapsed"===r.getState()&&r.setState({state:e||"partiallyExpanded"}),r=r.getParent();return i},C.prototype.__applyGroupingTagger=async function(e){let t=this.getRoots(),o=[];!0===e.fromGroupingEvent&&(e.groups.length>0?this.options.activeGroupingTagger=e:delete this.options.activeGroupingTagger);for(let i=0;i<t.length;i++){let n={node:t[i],grouping:JSON.parse(JSON.stringify(e))};o.push(await this.applyGroupingOnNode(n))}Promise.all(o).then(()=>{i.publish({event:"ENXModel/Model/ApplyGrouping/Done",data:{fromEvent:!0,status:!0}})})},C.prototype.__buildTagLst=async function(e,t){var o=[],i=[],n=[];for(let e=0;e<t.length;e++)for(let a=0;a<t[e].object.length;a++)if(Array.isArray(t[e].object[a].object)){var s="",r=t[e].object[a].object;for(let e=0;e<r.length;e++)s+=r[e],-1===o.indexOf(s)&&o.push(s),s+="/";let n=t[e].object[a].object.join("/");i.push(n)}else{let s=[t[e].object[a].object];if(Array.isArray(t[e].object[a].merged))for(let o=0;o<t[e].object[a].merged.length;o++)s.push(t[e].object[a].merged[o].object),n[t[e].object[a].merged[o].object]=t[e].object[a].object;o=o.concat(s),i=i.concat(s)}o=o.filter((e,t)=>o.indexOf(e)===t),i=i.filter((e,t)=>i.indexOf(e)===t);let a=this.options.mappedNodes.get(e);a.selectedTags=o,a.realSelectedTags=i,a.mergedMap=n,this.options.mappedNodes.set(e,a)},C.prototype.__buildGrpsOnNode=async function(e,t,o){let i=e.getOccurencePath().join("/"),n=this.options.mappedNodes.get(i);var s={},r=n.mapGrpNodes={},a=[],l=[];for(let i=0;i<t.results.length;i++)if(t.results[i].synthesis){var d=t.results[i].synthesis&&t.results[i].synthesis.facets?t.results[i].synthesis.facets:[];let l=o[0].object.map(e=>e.object);if((d=d.slice().sort(function(e,t){return l.indexOf(e.object)-l.indexOf(t.object)})).length)for(let t=0;t<d.length;t++){var c=d[t];if(c.sixw){var p=c.sixw.split("/"),u=p[p.length-1];!0===y?this.__buildFlatGrping(c,e,s,a,r,o,n):this.__buildStructuredGrping(c,e,s,a,r,o,n)}}else t.results[i].synthesis.name.contains("OtherSynthesis")&&t.results[i].synthesis.value>0&&this.__createOtherNode(r,e,u,a,o,n)}else l.push(t.results[i]);e.withTransactionUpdate(()=>{e.setState({state:"expanded"}),e.updateOptions({grid:{groupApplied:!0}}),this.options.mappedNodes.set(i,n)})},C.prototype.__buildStructuredGrping=function(e,t,i,n,s,a,l){var d=e.sixw.split("/"),c=d[d.length-1],p=h.splat(e.object),u=t,g="",f="";l.mergedMap[g]&&(g=l.mergedMap[g]);var v=l.realSelectedTags,m=l.selectedTags;for(let e=0;e<p.length&&(g+=p[e],-1!==m.indexOf(g)||!0===u.isGroupingNode&&u.isGrpSelected());e++){if(l.mergedMap[g]&&(f=g,g=l.mergedMap[g]),i[g])u=i[g],l.mergedMap[f]&&(u.options.merged=!0,u.options.grp=u.options.grp.concat(p),n.push(p));else{var D=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+p[e]+"-"+u.getID(),label:p[e],grid:{groupValue:p[e]},parentNode:u,ds6w:c,grp:p.slice(0,e+1),groupingIntent:a});n.push(p.slice(0,e+1)),r.updateNLSGroupingNode(D),u.addChild(D),(-1!==v.indexOf(g)||!0===u.isGroupingNode&&u.isGrpSelected())&&(-1!==v.indexOf(g)&&(D.options.grpSelected=!0,!0===u.isGroupingNode&&(u.options.contentRetrieved=!0,I(u))),s[g]=D),i[g]=D,u=D}g+="/"}},C.prototype.__buildFlatGrping=function(e,t,i,n,s,a,l){var d=e.sixw.split("/"),c=d[d.length-1],p=h.splat(e.object),u=t,g=p.join("/");l.mergedMap[g]&&(g=l.mergedMap[g]);var f,v=l.realSelectedTags,m=null;for(let e=0;a&&e<a.length;e++){let t=a[e];if(t.object)for(let e=0;e<t.object.length&&null===m;e++)t.object[e].object===g&&(m=t.object[e])}if(-1!==v.indexOf(g)||!0===u.isGroupingNode&&u.isGrpSelected())if(i[g])(f=i[g]).options.merged=!0,f.options.grp=f.options.grp.concat(p),n.push(p);else{var D=p[p.length-1];f=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+D+"-"+u.getID(),label:m?m.dispText:D,dispText:m?m.dispText:void 0,grid:{groupValue:D,count:e.count},parentNode:u,ds6w:c,grp:p,groupingIntent:a}),n.push(p),r.updateNLSGroupingNode(f),u.addChild(f),f.options.grpSelected=!0,s[g]=f,i[g]=f}else if(function(e,t){for(var o=null,i=e.length-1;i>=0;i--){var n=e.slice(0,i);if(-1!==t.indexOf(n.join("/"))){o=n;break}}return o}(p,v)){var b=e.object.slice(0,e.object.length-1);if(!(u=s[b.join("/")])){var S=UWA.clone(e);S.object=b,u=this.__buildFlatGrping(S,t,i,n,s,a,l)}f=this.__buildFlatGrping(e,u,i,n,s,a,l)}return f},C.prototype.__groupsLayoutCmd=async function(e){let t;switch(e.mode){case S:t=!1;break;default:case _:t=!0}if(t!==y&&(y=t,this.options.mappedNodes.size)){let e=[];for(let[t,o]of this.options.mappedNodes)if(-1===e.indexOf(t)){e.push(t);let i=o.grpParams.node,n=o.grpParams.grouping;await this.removeGrouping({selectedNode:i});let s={node:i,grouping:n};await this.applyGroupingOnNode(s)}}},C.prototype.__createOtherNode=function(t,i,n,s,r,a){var l=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-other-"+ +i.getID(),label:e.groupingNode.other,grid:{groupValue:e.groupingNode.other},parentNode:i,isOther:!0,ds6w:n,grp:s,groupingIntent:r});return t.other=l,i.addChild(l),l},C.prototype.__focusOnGroupsCmd=async function(){return new Promise(t=>{this.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.focusOnGroupsCmd,context:this});let o=this.getSelectedNodes(),i=[];var n=[];this.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)if(!0===o[e].isGroupingNode){i.push(o[e]);let t="expanded"===o[e].getState()?"expanded":"collapsed";n.push(this.__expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:t}}))}}),Promise.all(n).then(()=>{this.withBroadcastSelect(()=>{for(let e=0;e<i.length;e++)i[e].unselect(),P(i[e]);this.getModelEvents().publish({event:"endBlockingTransaction",context:this}),u.addCommandHit("focusOnGroupsCmd",i.length),t()})})})},C.prototype.__colorizeGroupCmd=async function(){return new Promise(t=>{this.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.colorizeGroupCmd,context:this});let o=this.getSelectedNodes(),i=[];var n=[];this.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)if(!0===o[e].isGroupingNode){i.push(o[e]);let t="expanded"===o[e].getState()?"expanded":"collapsed";n.push(this.__expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:t}}))}}),Promise.all(n).then(()=>{var e=[];for(let t=0;t<i.length;t++){var o=A(i[t]);e.push({groupNode:i[t],groupedPhysNode:o})}this.__buildEnrich3DColorize({colorizedGroups:e}).then(e=>{g.publish("DS/ENO/enrich3D",e),this.getModelEvents().publish({event:"endBlockingTransaction",context:this}),u.addCommandHit("focusOnGroupsCmd",i.length),t()})})})},C.prototype.__buildEnrich3DColorize=function(t){return new Promise((o,i)=>{var n;if(t.colorizedGroups){this.options.coloredGroups||(this.options.coloredGroups={});for(let e=0;e<t.colorizedGroups.length;e++){var s=t.colorizedGroups[e];if(!this.options.coloredNodes.get(s.groupNode.getID())){var a=Object.keys(this.options.coloredGroups),l=s.groupedPhysNode.map(e=>e.getOccurencePath());if(void 0!==typeof l&&l.length>0){let e=this.__getNextColor();s.groupNode.updateOptions({color:e});var d=s.groupNode.getLabel(),c=this.options.coloredNodes.size?this.options.coloredNodes.size+1:1;this.options.coloredNodes.set(s.groupNode.getID(),{coloredGprNode:s.groupNode,groupLabel:d,paths:l,style:s.style?s.style:{color:e,opacity:1,forceInherit:!0,label:d,id:c}})}}}}else this.options.coloredNodes.clear();if(this.options.coloredNodes.size){a=Array.from(this.options.coloredNodes.keys());var p=this.options.coloredNodes.get(a[0]).coloredGprNode.getPredicate();r.retrieveDS6WNLS([p]).then(t=>{var i=t&&t[p]?t[p].label:p;n={deleteOnUnlink:!0,cumulativeMode:!0,originWidgetId:f.getWidgetId(),graphicProperties:{kinds:[{AMD:"DS/ENOPAD3DViewer/views/PADLayerGroupingView",kind:"grouping"}],layers:[]}};var s={label:i,kind:"grouping",type:"grouping",id:a[0],styles:[{color:"#FFFFFF",opacity:.5,forceInherit:!1,label:e.groupingNode.nomatch,id:0}],colorMap:[{resourceid:this.options.coloredNodes.get(a[0]).paths[0][0],style:0}]};for(let e=0;e<a.length;e++){let t=this.options.coloredNodes.get(a[e]);s.styles.push(t.style);for(let e=0;e<t.paths.length;e++){let o=t.paths[e],i=w(this.getNodeByOccurencePath(o)),n=i.options.color;!i||i.getID()!==t.coloredGprNode.getID()&&n||s.colorMap.push({path:o,style:t.style.id})}}n.graphicProperties.layers.push(s),o(n)})}})};var N=0;function P(e){var t=e.getChildren();for(let e=0;e<t.length;e++)!0===t[e].isGroupingNode?P(t[e]):t[e].select()}function A(e){var t=[],o=e.getChildren();for(let e=0;e<o.length;e++)!0===o[e].isGroupingNode?t=t.concat(A(o[e])):t.push(o[e]);return t}function w(e){let t=null;for(;e.getParent()&&null===t;)(e=e.getParent()).isGroupingNode?t=e:w(e);return t}function I(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)t.expand(),t=t.getParent()}return C.prototype.__getNextColor=function(){let e;if(this.options.usedColor||(this.options.usedColor=[]),this.options.usedColor.length+1<x.colorStream.length)e=x.colorStream[this.options.usedColor.length],this.options.usedColor.push(e);else{e=function(e,t,o){o/=100;const i=t*Math.min(o,1-o)/100,n=t=>{const n=(t+e/30)%12,s=o-i*Math.max(Math.min(n-3,9-n,1),-1);return Math.round(255*s).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}(N*goldenAngle,100,75),N++}return e},C.prototype.__removeColorGroupCmd=function(){let e=Array.from(this.options.coloredNodes.keys());g.publish("DS/ENO/enrich3D",{deleteLayers:[e[0]]});for(let t=0;t<e.length;t++)this.options.coloredNodes.get(e[t]).coloredGprNode.updateOptions({color:null});N=0,this.options.coloredNodes.clear(),delete this.options.usedColor},C}),define("DS/ENXNav/models/xNavTreeDocOcc",["DS/TreeModel/TreeDocument","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/models/mixins/TreeDocSelect","DS/ENXNav/models/mixins/TreeDocProxy","DS/ENXNav/models/mixins/TreeDocAccess","DS/ENXNav/models/mixins/TreeDocShared","DS/ENXNav/models/mixins/TreeDocSupport","DS/ENXNav/models/mixins/TreeDocAdditionals","DS/ENXNav/models/mixins/TreeDocOccurenceIdx","DS/ENXNav/models/mixins/TreeDocGrouping","DS/PADUtils/PADTransactionManager","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,i,n,s,r,a,l,d,c,p){"use strict";function u(){}return u.prototype=Object.assign(u.prototype,i.prototype),u.prototype=Object.assign(u.prototype,o.prototype),u.prototype=Object.assign(u.prototype,n.prototype),u.prototype=Object.assign(u.prototype,s.prototype),u.prototype=Object.assign(u.prototype,r.prototype),u.prototype=Object.assign(u.prototype,a.prototype),u.prototype=Object.assign(u.prototype,d.prototype),u.prototype=Object.assign(u.prototype,l.prototype),u.prototype=Object.assign(u.prototype,{setFBIProxyOptions:function(e){this.options.FBIProxy=e.FBIProxy},applyActiveView:function(e){this.options.active_view=e},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},_shouldAcceptDrop:function(e){var t=e.dropPosition;return"top"!==t&&"bottom"!==t},_shouldAcceptDrag:function(e,t){let o=!0;return"function"==typeof e.getNodeSource&&1===e.getNodeSource()&&(o=!1),o},createNodeModel:function(e){return new this.options.nodeModelClass(e)}}),e.extend(c,u,{init:function(e){this.version="2.0";var o=e||{};o.shouldBeSelected=function(e){return!0!==e.isRelationsObjectGroupingNode},UWA.is(o.shouldAcceptDrop)||(o.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),UWA.is(o.shouldAcceptDrag)||(o.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),o.nodeModelClass=t,o.showModelChanges=!1,this._parent(o),this.options.viewport={},this.initProxy(),this.initSelectCB(),p.subscribe({event:"ENXViews/Model/FindInCtx"},this.findInCtx.bind(this)),this.onPreExpand(this.onPreExpandChecker.bind(this)),p.subscribe({event:"ENXViews/Model/SelectFromTagger"},this.selectFromTagger.bind(this)),this.getModelEvents().subscribe({event:"addChild"},function(e){var t=e.data.nodeModel,o=e.parent.getChildren();t.options.grid.actualIndex=o.indexOf(t)}),this.initGrpV2(),this.initModelMap(),p.subscribe({event:"ENXModel/Model/CopyLink"},this.__copyLink.bind(this)),this.onNodeModelUpdate(()=>{p.publish({event:"ENXModel/NodeModelUpdate"})})},isEditor:function(){return!1}})}),define("DS/ENXNav/utils/CtxMenuUtilsV2",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ApplicationFrame/CommandsManager","DS/ENXNav/utils/OpenWithMenuBuilder","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","UWA/Utils","DS/ENOXInterWdgCom/LinkManager","DS/PADServices/utils/GrantedRolesCache"],function(e,t,o,i,n,s,r,a,l,d){"use strict";const c=["ActionBar_Attributes","CopyLink"];function p(){return"object"==typeof p.instance?p.instance:(p.instance=this,this)}return p.prototype.initializeCmdMap=function(e){return new Promise(function(t){this.context=e.context,this.menuMap=e.commandMap,this.context.getDynamicCtxDef().then(function(e){this.toolbarDefinition=e,this._enrichCtxDefinition().then(t)}.bind(this))}.bind(this))},p.prototype.buildMenu=function(e){return new Promise(function(t){var o;switch(e.view){case"datagridview":o=this._buildDGVCtx(e);break;case"graphview":o=this._buildCtxCmdMenuInView(e);break;default:o=Promise.resolve([])}o.then(function(e){t(e)})}.bind(this))},p.prototype._buildDGVCtx=function(e){var t=this;return new Promise(function(o){var i=e.params.cellInfos;if(i)if(-1===i.rowID)t._buildHeaderMenu(e).then(o);else if("positionMatrix-Instance"===e.params.collectionView.getColumnOrGroup(i.columnID).dataIndex&&"function"==typeof t.psePositionCtxCmd){var n=t.psePositionCtxCmd(e.context,e.params);n.isRoot?t._buildCtxCmdMenuInView(e).then(function(t){e.menu=t,o(e.menu)}):o(n.menu)}else t._buildCtxCmdMenuInView(e).then(function(t){e.menu=t,o(e.menu)});else o([])})},p.prototype._buildHeaderMenu=function(t){var o=this;return new Promise(function(i){var a=t.params.cellInfos,l=t.params.collectionView.getColumnOrGroup(a.columnID);let d=t.params.collectionView.buildDefaultContextualMenu(t.params,{pin:!0,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1,view:"data-gridview"});if(l.customisation&&l.customisation.layout&&!1===l.customisation.layout.removableFromView||d.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},title:e.headerDGVCtxMenu.columnHide,action:{context:{collectionView:t.params.collectionView,dataIndex:l.dataIndex},callback:function(e){e.context.collectionView.layout.setColumnVisibleFlag(e.context.dataIndex,!1,{isUserInteraction:!1})}}}),n.getSetting("activateFUN104935")){t.params.collectionView;var c=t.context.options.views.datagridview;d.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-clear"},state:c.isClearSortEnabled()?"enabled":"disabled",title:e.headerDGVCtxMenu.clearSort,action:{context:{ourdgv:c},callback:function(e){e.context.ourdgv.clearSort()}}})}if(n.getSetting("readOnlyDashboard"))for(const t of d)(t.icon&&t.icon.iconName&&"pin"===t.icon.iconName||t.title===e.headerDGVCtxMenu.columnHide)&&(t.state="disabled");var p=t.params.data.listenerPosition?t.params.data.listenerPosition:{x:0,y:0};if(o.context.position=p,o._addCommandMenu({cmdId:"ColumnVisibility",menu:d}),!0===r.getSetting("grpBSD")&&!1!==l.groupableFlag&&!0!==l.isAdditionalColumn)if(t.params.collectionView.groupingApplied===l.dataIndex)d.unshift({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-group-delete"},title:e.headerDGVCtxMenu.columnUnGroup,action:{context:{collectionView:t.params.collectionView,dataIndex:l.dataIndex,model:t.context.getPADTreeDocument()},callback:function(e){delete e.context.collectionView.groupingApplied,e.context.model.getModelEvents().subscribeOnce({event:"groupNodes"},()=>{setTimeout(()=>{delete e.context.model.__groupingInProgress},250)}),e.context.model.__groupingInProgress=!0,e.context.collectionView.groupRows({dataIndexesToGroup:[]});var t=s.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});t?(t.setEventData({eventLabel:"Ungroup-Ctx"}),t.trackPageEvent()):console.warn("tracker not defined")}}});else{let o=e.replace(e.headerDGVCtxMenu.columnGroup,{columnName:l.text});"rel"===l.ds6wFrom&&(o=e.replace(e.headerDGVCtxMenu.columnGroupInst,{columnName:l.text})),d.unshift({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-group-add"},title:o,action:{context:{collectionView:t.params.collectionView,dataIndex:l.dataIndex,model:t.context.getPADTreeDocument()},callback:function(e){e.context.collectionView.groupingApplied=e.context.dataIndex,e.context.model.getModelEvents().subscribeOnce({event:"groupNodes"},()=>{setTimeout(()=>{delete e.context.model.__groupingInProgress},250)}),e.context.model.__groupingInProgress=!0,e.context.collectionView.groupRows({dataIndexesToGroup:[e.context.dataIndex]});var t=s.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});t?(t.setEventData({eventLabel:"Group-Ctx",pd2:e.context.dataIndex}),t.trackPageEvent()):console.warn("tracker not defined")}}})}o._addAdditionalColumnsCtxHdr({menu:d,cellInfos:a,params:t.params,view:"datagridview"}).then(function(e){i(e.menu)})})},p.prototype._setCMDState=function(e){return n.getSetting("redirectQueryToSGI")&&c.includes(e.id)?(e.deactivated=!0,"disabled"):!0===e.isEnabled?"enabled":"disabled"},p.prototype._addCommandMenu=function(e){var o,i=this.menuMap.get(e.cmdId),s=this;if(i&&("string"==typeof i.activationSetting&&!0!==r.getSetting(i.activationSetting)&&(i.deactivated=!0),!0!==i.deactivated)){let r=!0;if(void 0!==i.widgetLinkFeatures){let e=l.getLinkedWithMatchingFeatures(i.widgetLinkFeatures);void 0!==e&&0!==e.length||(r=!1)}if(r){var a=!0;if(!1===i.isEnabled&&(i.toggle||!0===i.enforceAvailability)&&(a=!1),i.availableInView&&this.context.options.active_view!==i.availableInView&&(a=!1),!0===a){var d=t.getCommand(i.id,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);if(d&&"function"==typeof d.isCommandAvailable&&!d.isCommandAvailable(e))return;let r=s._setCMDState(i);d&&"function"==typeof d.currentState&&(r=d.currentState()),!0===i.selected&&(r+="|selected");let a=!0;if(d){var p=d.getArguments();let t=p.length;if(t){var u,h;for(let e=0;e<t;e++){let t=p[e];switch(t.ID){case"ShowInViews":u=t.Value.split(",");break;case"ShowInColumns":h=t.Value.split(",")}}if(u&&(a=-1!==u.indexOf(e.view)),h&&e.params.collectionView){let t=e.params.collectionView.getColumnOrGroup(e.params.cellInfos.columnID).dataIndex;a=-1!==h.indexOf(t)}}}n.getSetting("redirectQueryToSGI")&&c.includes(i.id)&&(a=!1),a&&(o={type:e.type?e.type:i.type?i.type:"PushItem",id:i.id,title:i.label,HelpResourceFile:i.HelpResourceFile,icon:i.icon,state:r,accelerator:i.accelerator,action:{context:{cmdId:i.id,updateDefault:e.updateDefault,params:e.params},callback:function(e){e.context.updateDefault&&e.context.updateDefault.withDefaultCmd&&e.context.updateDefault.withDefaultCmd!==e.context.cmdId&&(e.context.updateDefault.withDefaultCmd=e.context.cmdId),s._launchCommand({command:e.context.cmdId,params:e.context.params})}}},e.menu.push(o))}}}return o},p.prototype._launchCommand=function(e){var o=t.getCommand(e.command,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);if(o){this.context.position&&(o.options.position=this.context.position,delete this.context.position),e.params&&"function"==typeof o.setViewParams&&o.setViewParams(e.params);var i=s.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});i?(i.setEventData({eventLabel:o.options.ID+"-Ctx"}),i.trackPageEvent()):console.warn("tracker not defined"),o.options.fromCtx=!0,o.begin()}},p.prototype._addNONPSCtx=function(e){var t=this;return new Promise(function(o){var i,n=[],s=e.params&&e.params.data&&e.params.data.listenerPosition?e.params.data.listenerPosition:{x:0,y:0};t.context.position=s;e.params&&("graphview"===e.view?i=e.params.graphview.node:e.params.cellInfos&&(i=e.params.cellInfos.nodeModel)),!0!==i.isRelationsObjectGroupingNode&&t._addOpenWithMenu(0).then(function(i){i.openWithMenu.length&&(n=n.concat(i.openWithMenu)),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ActionBar_Attributes",menu:n}),t.context.getPADTreeDocument().getSelectedNodes().filter(e=>{return"Document"!==(e.options.grid["ds6w:type-original"]?e.options.grid["ds6w:type-original"]:e.options.grid["ds6w:type"])}).length||t._addCommandMenu({view:e.view,params:e.params,cmdId:"Download",menu:n}),o(n)})})},p.prototype._addGroupingCtx=function(e){var t=this;return new Promise(function(o){var i=[],n=e.params&&e.params.data&&e.params.data.listenerPosition?e.params.data.listenerPosition:{x:0,y:0};t.context.getPADTreeDocument().getSelectedNodes();if(t.context.position=n,t._addCommandMenu({view:e.view,params:e.params,cmdId:"FocusOnGroups",menu:i}),i.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ColorizeGroup",menu:i}),t.context.getPADTreeDocument().isGroupColorApplied()&&t._addCommandMenu({view:e.view,params:e.params,cmdId:"RemoveGroupColor",menu:i}),i.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ExpandAllGroups",menu:i}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"CollapseAll",menu:i}),!0!==r.getSetting("grpBSD"))switch(t.context.getPADTreeDocument().getGroupLayout()){case"compact":i.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"GroupsLayoutPath",menu:i});break;case"structured":i.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"GroupsLayoutCompact",menu:i})}o(i)})},p.prototype._buildCtxCmdMenuInView=function(e){var t=this;return new Promise(function(o){var i;e.params&&("graphview"===e.view?i=e.params.graphview.node:e.params.cellInfos&&(i=e.params.cellInfos.nodeModel)),i?(!1===i.isSelected()&&i.select(!0),!0===i.isRelationsObjectNode?!0!==i.isGroupingNode?t._addNONPSCtx(e).then(o):t._addGroupingCtx(e).then(o):1!==i.getNodeSource()&&t._buildCtxCmdMenu(e).then(o)):o([])})},p.prototype._buildCtxCmdMenu=function(o){var i=this;return new Promise(function(n){var s=[],a=[],l={x:0,y:0};o.params&&(o.params.data&&o.params.data.listenerPosition?l=o.params.data.listenerPosition:o.params.info&&o.params.info.position&&(l=o.params.info.position)),i.context.position=l;var c=t.getCommand("OpenInCADHdr",i.context.options.action_bar_opts&&i.context.options.action_bar_opts.context?i.context.options.action_bar_opts.context:null);c&&c.isAvailable()&&(s.push({title:e.PAD_CMDOpenInCAD,icon:{iconName:"open",fontIconFamily:1},type:"PushItem",action:{context:i.context,callback:function(e){i._launchCommand({context:e.context,command:"OpenInCADHdr"})}}}),s.push({type:"SeparatorItem"}));var p=o.dynamicCtxMenu?o.dynamicCtxMenu:i.toolbarDefinition;setTimeout(()=>{for(var e=0;e<p.length;e++)if("string"==typeof p[e])"OpenWith"===p[e]?a.push(i._addOpenWithMenu(e).then(function(e){if(e.openWithMenu.length){var t=e.menuPosition;if(s.length!==p.length){for(var o=!1,i=0,n=0,r=0;r<p.length&&!1===o;r++)"OpenWith"===p[r]?o=!0:"object"==typeof p[r]?p[r].id!==s[n].id?i+=1:n+=1:p[r]!==s[n].id?i+=1:n+=1;t-=i}s.splice.apply(s,[t,0].concat(e.openWithMenu))}})):"SeparatorItem"===p[e]?s.push({type:"SeparatorItem"}):i._addCommandMenu({view:o.view,params:o.params,cmdId:p[e],menu:s});else if("object"==typeof p[e]){var t;if(o.params&&("graphview"===o.view?t=o.params.graphview.node:o.params.cellInfos&&(t=o.params.cellInfos.nodeModel)),"cmd"===p[e].type){if(!0===p[e].rootOnly&&!0!==t.isRoot())continue;i._addCommandMenu({view:o.view,params:o.params,cmdId:p[e].cmd,menu:s})}else{if(!0===p[e].childOnly&&!0===t.isRoot())continue;var l={type:"PushItem",id:p[e].id,title:p[e].title,icon:p[e].icon,HelpResourceFile:p[e].HelpResourceFile,submenu:[]};let n="enabled"!==r.getSetting("staticMappingServer");for(var c=0;c<p[e].cmds.length;c++){var u=null,h=!1;let t=p[e].cmds[c];!n||"UPSAuthInsertProductConfiguration"!==t&&"UPSAuthReplaceProductConfiguration"!==t||(h=!0);u=null;h||(u=i._addCommandMenu({view:o.view,params:o.params,cmdId:p[e].cmds[c],menu:l.submenu,updateDefault:p[e],type:"RadioItem"})),"UPSAuthInsertProductConfiguration"!==t&&"UPSAuthReplaceProductConfiguration"!==t||!1===d.isEnabled("CFG")&&l.submenu&&l.submenu[c]&&(l.submenu[c].state="disabled"),u&&u.id===p[e].withDefaultCmd&&(l.icon=u.icon,l.title=u.title,l.HelpResourceFile=u.HelpResourceFile,l.tooltip=u.title,l.state=u.state,l.action={context:{cmdId:u.id},callback:function(e){i._launchCommand({command:e.context.cmdId})}},u.state="selected")}if(l.submenu.length>=1){if(p[e].withDefaultCmd&&"disabled"===l.state){var g=null;for(c=0;c<l.submenu.length;c++)"enabled"===l.submenu[c].state&&(g=l.submenu[c]),l.submenu[c].id===p[e].withDefaultCmd&&(l.submenu[c].state="disabled");null!==g&&(l.icon=g.icon,l.title=g.title,l.HelpResourceFile=g.HelpResourceFile,l.tooltip=g.title,l.state=g.state,l.action={context:{cmdId:g.id},callback:function(e){i._launchCommand({command:e.context.cmdId})}},g.state="selected")}s.push(l)}}}Promise.all(a).then(function(){n(s)})},300)})},p.prototype._addOpenWithMenu=function(t){var i=this;return new Promise(function(n){var s=i.context.getPADTreeDocument().getSelectedNodes();let r=!0;for(let e=0;e<s.length&&r;e++)"function"==typeof s[e].isSupplemental&&!0===s[e].isSupplemental()&&(r=!1);s.length>0&&r?o.openWithApps(s,{iconOpenWith:{iconName:"open-menu-dot",fontIconFamily:1},nlsOpenWith:e.OpenWith}).then(function(e){n({openWithMenu:e,menuPosition:t})}):n({openWithMenu:[],menuPosition:t})})},p.prototype._enrichCtxDefinition=function(){var e=this;return new Promise(function(t){for(var o=function(t){return new Promise(function(o){t.icon&&t.icon.module&&t.icon.path&&(t.icon=i.getWebappsAssetUrl(t.icon.module,t.icon.path)),(t.HelpResourceFile&&!0!==t.deactivated?new Promise(function(o){e.retrieveHlpRsc(t.HelpResourceFile).then(function(e){this.label=e[this.id+".Title"],this.title=e[this.id+".Title"],o()}.bind(t))}):Promise.resolve()).then(o)})},n=e.toolbarDefinition,s=[],r=0;r<n.length;r++)n[r],s.push(o(n[r]));Promise.all(s).then(t)})},p.prototype._addAdditionalColumnsCtxHdr=function(e){var t=this;return new Promise(function(o){var i=t.context;if(i.options.additionalColumnsModules&&i.options.additionalColumnsModules.length){for(var n=[],s=[],r=[],l=0;l<i.options.additionalColumnsModules.length;l++)if("function"==typeof i.options.additionalColumnsModules[l].getAdditionalCtxMenu){var d=new Promise(function(t){i.options.additionalColumnsModules[l].getAdditionalCtxMenu({treeDocument:i.getPADTreeDocument(),ctxParams:e.params,view:e.view,callback:function(e,o){e&&-1===r.indexOf(e)&&(r.push(e),o&&(o=a.splat(o)).length>0&&(s.push({type:"SeparatorItem"}),s=s.concat(o))),t()}})});n.push(d)}Promise.all(n).then(function(){e.menu=e.menu.concat(s),o(e)})}else o(e)})},p.prototype.retrieveHlpRsc=function(e){return new Promise(function(t){var o=e.split("/"),i="i18n!"+o[0],n=o.splice(1,1);i+="/assets/help/"+n.join("/"),require([i],t,()=>{console.error("Cannot load "+i),t()})})},new p}),define("DS/ENXNav/views/customize_views/_xNavDGVParametrization",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/Utilities/Utils","DS/ENXNav/utils/xNavCustoStorageOptim","DS/ENXNav/utils/CtxMenuUtils","DS/PADUtils/Configuration","DS/PADUtils/Utility","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/settings/AppSettings","DS/UIKIT/Mask","DS/CollectionView/CollectionViewStatusBar","DS/WebappsUtils/WebappsUtils","DS/PADServices/ws/WSAccess","DS/Core/PointerEvents"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f,v,m,D){"use strict";var b;function S(e){for(var t={},o=0;o<e.length;o++){var i=e[o];t[i.dataIndex]=void 0!==i.visibleFlag&&!i.visibleFlag}return t}function _(e){this.exportFlags={};for(let t=0;t<e.length;t++){let o=e[t];o.customisation&&o.customisation.exportable&&(this.exportFlags[o.dataIndex]=o.customisation.exportable.value)}}function x(e){return-1===e.rowID?e.cellModel:s.convertDateTime(e.cellModel)}function y(e,t){let o,i=0,n=!1;for(i=0;i<e.length;i++)if((o=e[i]).dataIndex===t){n=!0;break}return n?{index:i,column:o}:null}function C(e){}_.prototype={reapply:function(e){for(let t=0;t<e.length;t++){let o=e[t];o.customisation&&o.customisation.exportable&&void 0!==this.exportFlags[o.dataIndex]&&(o.customisation.exportable.value=this.exportFlags[o.dataIndex])}}},C.prototype.buildDGVOpts=function(e){var t=this;return e=e||{},new Promise(function(i){var s,r=function(o){var s=UWA.clone(n.getConfig("dgvOptions")),r=s&&s.dgv?s.dgv:{};if(o=UWA.extend(r,o),t.options.additionalColumnsModules){let i=o.columns.reduce(function(e,t,o){return t.isAdditionalColumn&&e.push({column:t,dataIndex:t.dataIndex,currentIndex:o}),e},[]);var d=[],c=S(o.columns);let n=new _(o.columns);for(var p=0;p<t.options.additionalColumnsModules.length;p++)UWA.is(t.options.additionalColumnsModules[p].getAdditionalColumnsUXDGV,"function")&&(t.options.additionalColumnsModules[p].getAdditionalColumnsUXDGV(o.columns),d=d.concat(t.options.additionalColumnsModules[p].getManagedColumnNames())),UWA.is(t.options.additionalColumnsModules[p].setupCallback,"function")&&t.options.additionalColumnsModules[p].setupCallback({treeDocModelEvents:t.options.context.getPADTreeDocument().getModelEvents(),globalModelEvents:u.getModelEvents()}),o.columns=o.columns.filter(function(e){return void 0!==e});if(d.length){let t=i.filter(function(e){return-1===d.indexOf(e.dataIndex)});if(t.length)for(let e=t.length-1;e>=0;e--){let i=t[e];o.columns.splice(i.currentIndex,1)}!0===e.reset?c=S(o.columns):n.reapply(o.columns),function(e,t,o){for(var i=0;i<e.length;i++){var n=e[i];-1!==t.indexOf(n.dataIndex)&&(n.isAdditionalColumn=!0),void 0!==o[n.dataIndex]&&(n.visibleFlag=!o[n.dataIndex])}}(o.columns,d,c),n.reapply(o.columns),function(e){for(var t=0;t<e.length;t++){var o=e[t],i=o.customisation;i&&i.layout&&void 0!==i.layout.hidden&&o.visibleFlag!==!i.layout.hidden&&(i.layout.hidden=!o.visibleFlag)}}(o.columns)}}let h=o.columns.filter(function(e){return"dateTime"===e.kind});for(let e=0;e<h.length;e++){h[e].getCellValueForExport=x}if(o.onContextualEvent=t._onContextualEvent.bind(t),o.onDelayedModelDataRequest=t.options.context.updateAttributesDelayed.bind(t.options.context),o.getCellTooltip=t._getCellTooltip.bind(t),t.options.callbacks){var f=Object.keys(t.options.callbacks);for(p=0;p<f.length;p++)o[f[p]]=t.options.callbacks[f[p]]}u.getModelEvents().subscribe({event:"container-to-unmask"},function(e){b=e.container}),l.updateColumnsWithNLS(o.columns,function(e){"success"===e.status&&(o.columns=e.columns);var n=!1;for(let e=o.columns.length-1;e>=0;e--)if("actualIndex"===o.columns[e].dataIndex){n=!0;break}!1===n&&o.columns.push({dataIndex:"actualIndex",kind:"integer",neverVisible:!0,visibleFlag:!1}),a.updateAttributesList(o.columns).then(()=>{let e=Promise.resolve();!0===t.options.activateFilterView&&(e=t.__addFilterModel(o)),e.then(()=>{t.completeDGVOptions(o).then(i)})}),b&&g.unmask(b)})};t.options.typeRepresentations={},t.__initColumnViews().then(()=>{if(t.options.view_customization&&!0!==e.reset&&!0===t.options.view_customization.custoFromDGV){if(!0===t.options.view_customization.custoOptimized&&(t.options.view_customization=o.convertPreference2Custo(t.options.view_customization,"datagridview")),s=t.options.view_customization,t.options.context&&t.options.context.options.isDeEnabled){let e=s.columns.find(e=>"asset-type"==e.dataIndex);e&&e.visibleFlag&&!t.options.context.hasActiveDesignExp()&&(e.visibleFlag=!1)}t.__roleRelatedColumns(s).then(function(){t.buildColumnsFromStorage(s.columns).then(function(e){s.columns=e,r(s)})})}else s={},t.buildColumns("datagridview").then(function(e){t.__roleRelatedColumns(e).then(function(){s.columns=e.columns,r(s)})})})})},C.prototype.__buildRoleMap=function(){let e=new Map;return new Promise(function(t,o){require(["DS/PADUtils/PADUtilsServices"],function(o){o.getGrantedRoles(function(o){for(let t=0;t<o.length;t++){let i=o[t];e.set(i.id,i)}t(e)})})})},C.prototype.__roleRelatedColumns=function(e){let t=this;return new Promise(function(o,i){let s=n.getConfig("roleBased"),r=[],a=[];s?(c.iterateObj(s.attributes,function(e,t){e.enabled&&(e.dataIndex=t,r.push(e))}),r.length?t.__buildRoleMap().then(function(t){c.iterate(r,function(e){a.push(function(e,t,o){return new Promise(function(i,n){let s=!1;c.iterate(o.roles,function(t){!s&&e.has(t)&&(s=!0)}),i({dataIndex:t,enabled:s,data:o})})}(t,e.dataIndex,e))}),Promise.allSettled(a).then(function(t){let i=t.map(function(e){return e.value});c.iterate(i,function(t){if(t.enabled){if(!y(e.columns,t.dataIndex)){let o=t.data;o.dataIndex=t.dataIndex,o.ds6w=o.dataIndex,e.columns.push(o)}}else{let o=y(e.columns,t.dataIndex);o&&e.columns.splice(o.index,1)}}),o()})}):o()):o()})},C.prototype.__initColumnViews=function(){return new Promise(e=>{this.options.columnViews={};var t=n.getConfig("columnViews"),o=[];if(t)for(let e=0;e<t.length;e++)-1===o.indexOf(t[e].AMD)&&o.push(t[e].AMD);o.length?p.loadAMDs(o).then(o=>{let i=[];for(let e=0;e<t.length;e++)if(-1!==o.loadedAMDs.indexOf(t[e].AMD)){let o=require(t[e].AMD);-1===i.indexOf(t[e].AMD)&&"function"==typeof o.getTypeRepresentation&&(this.options.typeRepresentations=Object.assign(this.options.typeRepresentations,o.getTypeRepresentation()),i.push(t[e].AMD)),this.options.columnViews[t[e].dataIndex]={AMD:o}}e()}):e()})},C.prototype.completeDGVOptions=function(e){return Promise.resolve(e)},C.prototype.completeCB=function(){return Promise.resolve()},C.prototype.getColumnViewsForUpdate=function(){var e;let t=this.options.columnViews?Object.keys(this.options.columnViews):[];for(let o=0;o<t.length;o++)if("function"==typeof this.options.columnViews[t[o]].AMD[t[o]].updateAttributesDelayed){!0===this.options.dgv.layout.getColumnVisibleState(t[o])&&(e||(e={}),e[t[o]]=this.options.columnViews[t[o]].AMD[t[o]])}return e},C.prototype.addColumnCB=function(e){var t=this;this.options.dgv.prepareUpdateView();var o=[];e.forEach(function(e){o.push(new Promise(function(o){a.addAvailableColumn(e.dataIndex,e).then(function(e){var i=null;e.ds6w&&t.options.columnViews[e.ds6w]?i=t.options.columnViews[e.ds6w].AMD[e.ds6w].buildColumn(e):e.dataIndex&&t.options.columnViews[e.dataIndex]&&(i=t.options.columnViews[e.dataIndex].AMD[e.dataIndex].buildColumn(e)),null===i&&(i=t.buildColumnFromSetting(e)),i&&("real"!=i.kind&&"real"!=i.typeRepresentation||(i.kind="float",i.typeRepresentation="float"),"dateTime"===i.kind&&(i.getCellValueForExport=x),"asset-type"===i.dataIndex?t.options.dgv.addColumnOrGroup(i,i.columnIdx?i.columnIdx:0):t.options.dgv.addColumnOrGroup(i),t.options.dgvLayout.layoutDensity!==t.options.viewMode&&(t.options.dgvLayout.layoutDensity=t.options.viewMode)),o()})}))}),Promise.all(o).then(()=>{this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)})},C.prototype.removeColumnCB=function(e){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=UWA.is(e,"string")?JSON.parse(e):e,i=t.options.dgv.getColumnOrGroup(o.dataIndex);i&&void 0!==i.dataIndex&&(t.options.dgv.removeColumnOrGroup(o.dataIndex),a.removeAvailableColumn(o.dataIndex))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),t.options.dgvLayout.layoutDensity!==t.options.viewMode&&(t.options.dgvLayout.layoutDensity=t.options.viewMode)},C.prototype.removeColumns=function(e){this.options.dgv.prepareUpdateView(),e.forEach(e=>{var t=this.options.dgv.getColumnOrGroup(e);t&&void 0!==t.dataIndex&&(this.options.dgv.removeColumnOrGroup(e),a.removeAvailableColumn(e))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},C.prototype.changeTitleCB=function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(this.options.dgv.prepareUpdateView(),o.text=t,o.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},C.prototype.changeVisibilityCB=function(e,t){this.options.dgvLayout.getColumnIndex(e)>=0&&this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!1})},C.prototype.changePinCB=function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!1})},C.prototype.moveColumnCB=function(e){e.move2perform&&(e.move2perform.from&&(e.move2perform.fromID=this.options.dgvLayout.getColumnIndex(e.move2perform.from),e.move2perform.toID=this.options.dgvLayout.getColumnIndex(e.move2perform.to)),this.options.dgvLayout.moveColumn(e.move2perform.fromID,e.move2perform.toID,{isUserInteraction:!1}))},C.prototype.changeDgvLayout=function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},C.prototype.changeExportCB=function(e,t){this.options.dgv.prepareUpdateView();var o=this.options.dgv.getColumnOrGroup(e);o&&(o.customisation||(o.customisation={}),o.customisation.exportable||(o.customisation.exportable={}),!1===o.customisation.exportable.lock&&(o.customisation.exportable.value=t)),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},C.prototype.compactMode=function(e){this.options.dgvLayout.layoutDensity=e.viewMode,this.options.viewMode=e.viewMode},C.prototype.saveCustoView=function(e,t){var o=this;this._prepareOptsToStore({onComplete:function(i){var n=e?"onCustoViewChange":"onSaveAsTemplate";o.options.context.dispatchEvent(n,i),!0===t&&o.options.context.dispatchEvent("onSaveAsTemplate",i)}})},C.prototype.reset=function(e){var t=this;delete t.options.view_customization,this.buildDGVOpts({reset:!0}).then(function(o){var i=n.getConfig("dgvOptions")?n.getConfig("dgvOptions"):{};t.options.dgv.prepareUpdateView(),i.dgvLayout&&(i.dgvLayout.cellHeight&&(t.options.dgvLayout.cellHeight=i.dgvLayout.cellHeight),i.viewMode&&(t.options.dgvLayout.layoutDensity=i.viewMode)),t.options.dgvLayout.deleteDataGridViewPreferences(),t.options.dgvLayout.rowsHeader=i.rowsHeader,t.options.dgvLayout.columns=o.columns,t.options.dgv.columns=o.columns,t.options.viewMode=i.viewMode,t.options.context.options.isDeEnabled&&t.options.context.hasActiveDesignExp()&&t.changeVisibilityCB("asset-type",!0),t.options.dgvLayout.applyColumns(),t.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),t.saveCustoView(e)})},C.prototype.removeSort=function(e){this.options.dgv.prepareUpdateView(),this.options.dgv.sortModel=null,this.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)},C.prototype.clearSort=function(e){d.clearSort("begin"),this.options.dgv.prepareUpdateView(),this.options.dgv.sortModel=null,this.options.dgv.sortModel=[{dataIndex:"actualIndex",sort:"asc"}],this.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0),this.options.dgv.sortModel=null,d.clearSort("end")},C.prototype.isClearSortEnabled=function(e){if(!this.options.dgv)return!1;var t=this.options.dgv.sortModel;return null!==t&&(t.length>=1?"actualIndex"!==t[0].dataIndex:void 0)},C.prototype._onContextualEvent=function(e){var t=this;return new Promise(function(o){var n=i,s=Promise.resolve();t.options.context.isDynamicCtx()&&(s=new Promise(function(e){require(["DS/ENXNav/utils/CtxMenuUtilsV2"],function(t){n=t,e()})})),s.then(function(){require(["DS/PADUtils/PADUtilsServices"],function(e){(e.isTouchDevice()||e.isSurface())&&n.context&&n.context.dropInvitContainer&&n.context.dropInvitContainer.hide()}),n.buildMenu({view:"datagridview",context:t.options.context,params:e}).then(o)})})},C.prototype._getCellTooltip=function(t){if(-1===t.columnID)return this.options.dgv.getCellDefaultTooltip(t);var o=null,i=this.options.dgv.getColumnOrGroup(t.columnID),n=i.dataIndex;return t.dataIndex=n,this.options.columnViews[n]&&this.options.columnViews[n].AMD&&this.options.columnViews[n].AMD[n].getCellTooltip&&(o=this.options.columnViews[n].AMD[n].getCellTooltip(t,"asset-type"==n?this.options.context:this.options.dgv)),null===o&&(-1===t.rowID?o="rel"===i.ds6wFrom?{shortHelp:e.replace(e.instanceColHeader,{label:i.text}),updateModel:!1}:this.options.dgv.getCellDefaultTooltip(t):"ContextualMenuColumn"===n?o={shortHelp:e.columns.ContextualMenuColumn,updateModel:!1}:"thumbnail"===n?o={shortHelp:e.tooltip_thumbnail,updateModel:!1}:(o=null,this.options.additionalColumnsModules&&(o=null,o=function(e,t){let o=null;if(t.cellModel&&t.nodeModel.options){let i=e.filter(function(e){return!!e.provideDisplayTooltip}).filter(function(e){return-1!==e.getManagedColumnNames().indexOf(t.dataIndex)});return c.iterate(i,function(e){null!==(o=e.provideDisplayTooltip(t))&&"object"!=typeof o&&(o={shortHelp:o,updateModel:!1})}),o}return null}(this.options.additionalColumnsModules,t)),null===o&&t.nodeModel&&"function"==typeof t.nodeModel.getCellTooltip&&(o=this.options.dgv.getCellDefaultTooltip(t))),null===o&&(o=this.options.dgv.getCellDefaultTooltip(t))),o},C.prototype.selectSingleInstance=function(e){this.options.dgv.treeDocument.getSelectedNodes().length>=1&&this.options.dgv.treeDocument.unSelectAll(),e.nodeModel.select()},C.prototype.eventHandlerOnGridView=function(e){var t=this;return new Promise(function(o){e.addEventListener("change",function(e,t){t&&t.nodeModel&&-1!==t.columnID&&(t.nodeModel.isSelected()?t.nodeModel.unselect():t.nodeModel.select())}),e.addEventListener("columnOrderChange",function(e){t.saveCustoView(!0,!0)}),e.addEventListener("userPreferencesChange",function(e){t.saveCustoView(!0,!0)}),e.addEventListener("click",function(e,o){if(void 0!==o&&-1!==o.rowID){var i=e.dsModel.layout.getDataIndexFromColumnIndex(o.columnID);if(t.options.columnViews[i]&&t.options.columnViews[i].AMD&&t.options.columnViews[i].AMD[i].actionOnClick&&o.nodeModel&&!o.nodeModel.isGroupingNode)t.options.columnViews[i].AMD[i].actionOnClick(o,t.options.context);else if(t.options.clickEvent[i])t.options.clickEvent[i](o);else if(t.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(o.columnID,"isAdditionalColumn"))for(var n=0;n<t.options.additionalColumnsModules.length;n++){let e=t.options.additionalColumnsModules[n],r=e.getOnCellClickCB;if(r){var s=r.call(e,i);if(s){s(o);break}}}}}),t.completeCB(e).then(o)})},C.prototype._prepareOptsToStore=function(e){var i=this;t.debounce(function(e){i.options.dgvLayout.columns=i.options.dgv.columns;for(var t=i.options.dgvLayout.getOrderedColumnsIndexes(),n=[],s={},r=0;r<t.length;r++){var l=i.options.dgv.getColumnOrGroup(t[r]);l.columnIdx=r,n.push(l),l.customisation&&!0===l.customisation.titleModified&&(s[l.dataIndex]=!0)}i.options.dgv.columns=n;var d={viewMode:i.options.viewMode,rowsHeader:i.options.dgvLayout.rowsHeader,columns:n,selectedTypes:a.getSelectedTypes(),selectedExtensions:a.getSelectedExtensions()},c=o.convertCusto4Preference(d,s,"datagridview");e.onComplete(c)},500)(e)},C.prototype.__buildStatusBar=function(){let t=[{type:f.STATUS.CUSTOM,position:"near",id:"modelStatusId",dataElements:{typeRepresentation:"string",value:""}}];if(!0===h.getSetting("activateSGI")&&r.isCloud()){var o=h.getSetting("redirectQueryToSGI");let i={type:f.STATUS.CUSTOM,position:"far",id:"switchSGIId",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"warning-symbol-biohazard",fontIconFamily:1,className:"enx-sgi-status enx-status-bar-cmd "+(!0===o?"activated":"")},tooltip:{shortHelp:e.toggleSGI},value:async()=>{g.mask(this.options.dgv.getContent());try{o=!o;let e=require("DS/PADServices/ws/WSAccess");await e.setMePreferences({repositories:[{name:"ProductExplorerRepository",preferences:[{name:"ENOSCEN_SGI_REDIRECT",value:""+o}]}]})}catch(e){console.log("Cannot set the preference")}finally{g.unmask(this.options.dgv.getContent())}}}};t.unshift(i)}this.options.dgv.buildStatusBar(t),this.options.dgv.elements.statusBar.getContent().addClassName("enx-status-bar")};const N=[0,WUXModelUpdateTypes.Selection];return C.prototype.toggleStatusBarListener=function(o){var i=this.options.dgv.treeDocument;if(this.options.dgv.elements.statusBar&&i)if(!0===o)this.___nodeModified=this.___nodeModified?this.___nodeModified:t.debounce(t=>{if(!0===Array.isArray(t)||-1!==N.indexOf(t.options.updateType)){let t,o=i.getAllDescendants().length,n=i.getSelectedNodes().length;t=n>0?e.replace(e.statusModelSelected,{modelLength:o.toLocaleString(),selected:n.toLocaleString()}):1===o?e.replace(e.statusModel1,{modelLength:o}):o>1?e.replace(e.statusModelN,{modelLength:o.toLocaleString()}):"",this.options.dgv.elements.statusBar.getNodeModelByID("modelStatusId").updateOptions({grid:{data:t}})}},250),this.listenerStatusBar=[],this.listenerStatusBar.push(i.getXSO().onPostAdd(this.___nodeModified.bind(this))),this.listenerStatusBar.push(i.getXSO().onPostRemove(this.___nodeModified.bind(this))),this.listenerStatusBar.push(i.onUpdate(this.___nodeModified.bind(this)));else{this.options.dgv.elements.statusBar.getNodeModelByID("modelStatusId").updateOptions({grid:{data:""}});for(let e=0;e<this.listenerStatusBar.length;e++)i.unsubscribe(this.listenerStatusBar[e]);this.listenerStatusBar=[]}},C}),define("DS/ENXNav/features/xNavPersistPanel",["DS/ENXNav/utils/LocalStorageForAppState","DS/ENXNav/utils/TwoDAppEvents","DS/ApplicationFrame/CommandsManager"],function(e,t,o){function i(){t.onLandingPageClosed(this._restoreSidePanelsOriginalState.bind(this))}return i.prototype={setup:function(e){e&&(this.triptych=e,this._sidePanelState={left:{},right:{}},this.triptych._modelEvents.subscribe({event:"triptych-resized"},this._onPanelResized.bind(this)),this.triptych._modelEvents.subscribe({event:"triptych-panel-hidden"},this._onPanelHidden.bind(this)),this.triptych._modelEvents.subscribe({event:"triptych-panel-visible"},this._onPanelVisible.bind(this)))},_onPanelResized:function(t){this._sidePanelState[t.side].width=t.width,e.set("sidePanelState",this._sidePanelState)},_onPanelVisible:function(t){this._sidePanelState[t].isOpen=!0,e.set("sidePanelState",this._sidePanelState)},_onPanelHidden:function(t){this._sidePanelState[t].isOpen=!1,e.set("sidePanelState",this._sidePanelState)},_restoreSidePanelsOriginalState:function(){var t=o.getCommandCheckHeader("RootPanel"),i=o.getCommandCheckHeader("RightSidePanel"),n=e.get("sidePanelState");n&&(t&&n.left.isOpen&&!this.triptych._isLeftOpen&&(t.toggleState(),n.left.width&&this.triptych._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:n.left.width}})),i&&n.right.isOpen&&!this.triptych._isRightOpen&&(i.toggleState(),n.right.width&&this.triptych._modelEvents.publish({event:"triptych-set-size",data:{side:"right",size:n.right.width}})))}},Object.defineProperties(i.prototype,{name:{get:function(){return"persistPanels"}}}),i}),define("DS/ENXNav/XNavComponent",["css!DS/ENXNav/ENXNav","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/UIKIT/Mask","DS/Utilities/Utils","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","DS/PADUtils/views/PADFilterCancel","DS/ENXNav/mixins/_xNavDnD","DS/ENXNav/mixins/xNavLeftSidePanel","DS/ENXNav/mixins/_xNavBIFilter","DS/ENXNav/mixins/_xNavRefresh","DS/ENXNav/mixins/xNavChangeActionV2","DS/ENXNav/mixins/EventHooks","DS/ENXNav/mixins/xNavWidgetLink","DS/ENXNav/utils/FindInCtx","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/views/PADAlert","DS/PADUtils/PADPromise","DS/PADUtils/PADSession","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADPredicatesNls","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/ENXNav/features/xNavPersistPanel","DS/ENXNav/features/xNavPersistFilterSpec","DS/ENOXInterWdgCom/LinkManager","DS/ENOXTriptych/js/ENOXTriptych","DS/PADUtils/PADWSAccess","DS/PADServices/utils/PConfigUtils"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f,v,m,D,b,S,_,x,y,C,N,P,A,w,I,E,O,M,F,R,T,k){"use strict";function U(e,t){var o=this;require(["DS/ENXNav/views/ViewLoader"],function(i){var n={component:o,x3dAppId:o.options.x3dAppId,renderTo:e.renderTo,amd:{treelistview:o.options.amd_custo.TreeListView,graphview:o.options.amd_custo.TreeGraph,tileview:o.options.amd_custo.TileGridView,thumbnailview:o.options.amd_custo.ThumbnailGridView,datagridview:o.options.amd_custo.DataGridView}};o.loader=new i(n),o.loader.loadView(o.options.active_view,function(){"graphview"===o.options.active_view&&o.options.views.graphview.reframeOn(),t()})})}function B(e,t){e.push(t.map(function(e){return e.resourceid}))}function V(e){var t=this,o=require("DS/PADServices/ws/WSAccess"),i={data:{rootPhID:e.getID()},maxLeaves:N.getSetting("maxNumberOfLeaves"),is2D:!0,filterBI:t._biFilter};o.getRootStats(i).then(function(o){try{var i,n="string"==typeof o?JSON.parse(o):o,s={};if(n.results)for(var r=0;r<n.results.length;r++)if(n.results[r].resourceid)i=n.results[r].resourceid;else if(n.results[r].synthesis){var a=n.results[r].synthesis.name;switch(n.results[r].synthesis.name){case"ProgressiveExpand_FlatSynthesis":a="flatSynthesis";break;case"ProgressiveExpand_OccSynthesis":a="occSynthesis";break;case"ProgressiveExpand_LeafSynthesis":a="leafSynthesis"}s[a]=n.results[r].synthesis.value}var l=E.getPADTracker({eventCategory:"usage",eventAction:"synthesis"});if(l){let t=e.getLabel();l.addMultivaluedEventData("synthesis",{flatSynthesis:s.flatSynthesis,occSynthesis:s.occSynthesis,leafSynthesis:s.leafSynthesis,withFilter:!0===e.options.filtered||void 0},{labelKey:t,txKey:e.getID(),filtered:!0===e.options.filtered?"filtered":"noFilter"}),l.trackPageEvent()}else console.warn("tracker not defined");var d=t.options.model.getNodesById(i);1===d.length&&d[0].isRoot()&&d[0].setSynthesis(s)}catch(e){}}).catch(function(e){console.error(e)})}function G(e){if(N.getSetting("activateExcludeOccurrences")&&e&&!0!==e.getTreeDocument().isOccModel){const t={serviceId:"3DSpace",data:{select_bo:["physicalid"],select_rel:["physicalid"],root_path_physicalid:[[e.getID()]],rootPhID:e.getID()},FBIProxy:this._biFilter,intent:"explore_2D",onComplete:function(t){try{if(t&&!t.contains("error")){let o=JSON.parse(t),i=[];for(let e=0;e<o.results.length;++e)if(i.push(o.results[e].Path),o.results[e].matching_lengths)for(let t=0;t<o.results[e].matching_lengths.length;++t)i.push(o.results[e].Path.slice(0,o.results[e].matching_lengths[t]));e.setExcludedOccurrences(i),e.cleanUpPathes()}else console.error("Error while getting excluded occurrences")}catch(e){console.error(e)}},onCancel:void 0,onFailure:function(e){console.log("getExcludedOcc##Failure")},onTimeout:function(){console.log("getExcludedOcc##Timeout")}};T.getStaticMappingExcludedOccurrences(t)}}return n.extend(s,r,u,g,f,v,h,m,D,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,active_view:"datagridview",action_bar_opts:null,configuration:{toolbarActivated:!1,dynamicCtxActivated:!1},layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,statusInfo:!0,drop_invite:"dynamic",dndEvo:!1,keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},amdTreeView:"datagridview"},amd_custo:{TreeListView:"DS/ENXNav/views/xNavTreeListView",TreeGraph:"DS/ENXNav/views/xNavGraphView",TileGridView:"DS/ENXNav/views/xNavResponsiveTilesView",ThumbnailGridView:"DS/ENXNav/views/xNavResponsiveThumbnailsView",DataGridView:"DS/ENXNav/views/xNavDataGridView"},views:{treelistview:null,graphview:null,tileview:null,thumbnailview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1,tileview:!1,thumbnailview:!1}},_probes:{},_displayOnceReadOnlyNotif:!0,init:function(e){this._parent(e),this.options=i.extend(this.options,e,!0),this.options.layout.dndEvo="true"===A.getURLParameter("dndDivEvo"),document.body.setStyle("overflow","hidden"),this.elements.container=i.createElement("div",{class:"xnav_component"}),this.options.flags={},!0===N.getSetting("activateSynthesisOnRoot")&&N.setSetting("maxPathCount",void 0);var t=this;require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADProbes","DS/PADUtils/PADWebInWinServices"],function(e,n,s,r){t._probes.probe_init=s.createProbe("init_xnavcomponent"),t.options.loadGraphSection=N.getSetting("loadGraphSection"),r.initialize({widget:widget}),widget&&widget.lang&&N.setSetting("lang",widget.lang),e.app_initialization(function(r){r&&!0===r.success?function(){t._commandProxy=n.create({events:{onDrop:function(o,i){e.updatePlatformId(o.tenant);var n=!0!==o.already_added_in_PS;i.originWidgetId&&(n=!0!==o.already_added_in_PS||i.originWidgetId!==e.getWidgetId()&&!0===N.getSetting("activateFUN076708")),o.paths||o.pids||o.filters||(n=!1),n&&t.add({content:void 0===o.paths?"idslist":"pathslist",paths:void 0===o.paths?void 0:o.paths,pids:void 0===o.pids?void 0:o.pids,filters:o.filters,loadWithFilter:o.loadWithFilter,callback:null,broadcast:!1})},onDropFilter3D:function(e,o){t.addFilter({content:"3DXContent",filter_objects:e.droppedFilters,broadcast:void 0===e.broadcast||e.broadcast,callback:void 0,behavior:"fromDrop",fromProxy:!0})},onRemove:function(e){F.isWidgetSynchronizing()||t._onRemoveRoot(e)},onCleanAll:function(){t.empty(!1)},onFilterCancel:function(e){"3D"===e.widget&&t.confirmModal.cancelModal&&(t.confirmModal.cancelModal.fromProxy=!0,t.confirmModal.cancelModal.modals.current.destroy())},onRefreshModel:function(){i.is(t.refresh,"function")&&t.refresh(!1)},onApplyFilter:function(e){e.doNotBroacast=!0,t.applyFilter(e)},onSlaveBIToggle:function(e){t._biSlave3D=e.isSlave},onSearchInApp:t.onSearch.bind(t)}}),t.setupEventHooks(),!0===N.getSetting("activateWidgetLink")&&"undefined"!=typeof widget&&t.setupWidgetLink(),t._probes.probe_model=s.createProbe("init_xnav_model"),function(e){var t=this,o={},n=x.getPromises(),s=n.slice(),r=new Promise(function(n){Promise.all(s).then(function(){require([t.options.amd_custo.TreeDocument],function(s){if((o=function(e){var t=this,o={};return e.forEach(function(e){i.is(t.options.views_cb[e],"function")?o[e]=t.options.views_cb[e]:i.is(t[e],"function")&&(o[e]=t[e].bind(t))}),o}.call(t,["doDnDDragStart","shouldAcceptDnDDrop","doDnDDrop"])).authorize_setStructure=t.options.authorize_setStructure,o.insert_replace=t.options.insert_replace,o.renderTo=t.options.renderTo,o.insert_replace=t.options.insert_replace,t.options.additionalColumnsModules){o.additionalColumnsModules=t.options.additionalColumnsModules;for(var r=require("DS/PADServices/utils/AttributesMgtV2"),a=0;a<t.options.additionalColumnsModules.length;a++)r.addAsyncAttributes(t.options.additionalColumnsModules[a].getManagedColumnNames())}o.context=t,t.options.model=new s(o),t.options.model.getModelEvents().subscribe({event:"titleRecalc"},function(e){var o=t.getWidgetTitle();t.options.widget.setTitle(o)});var d=[];let c=!1;var p=l.debounce(function(){c||t._commandProxy.remove({pids:d});var e=t.options.model,o=e.getRoots().length;t.dropInvitContainer&&(o||t.dropInvitContainer.show("drop")),0===o&&t.options.views.datagridview&&t.options.views.datagridview.removeSort(),t._onRemoveRoot({pids:d,fromWLSync:c}),e&&e._pagerview&&(e._pagerview.hide(),e._pagerview=null),d=[];var i=t.getWidgetTitle();t.options.widget.setTitle(i)},250);t.options.model.getModelEvents().subscribe({event:"onRemoveRoot"},function(e){c=F.isWidgetSynchronizing(),t.dropInvitContainer&&(e.data.remainingRoots||t.dropInvitContainer.show()),d.push(e.data.pid),p()}),t.options.model.getModelEvents().subscribe({event:"onCenterGraph"},function(e){let o=t.options.model,i=!1;"2.0"===o.version&&(o._parseLoadModel=!0,i=!0),t.options.views.datagridview.options.dgv.ensureNodeModelVisible(e.data,!1,!0,.2),i&&(o._parseLoadModel=!1),t.options.views.graphview&&t.options.views.graphview.reframeOn()}),t.options.model.getModelEvents().subscribe({event:"onRootAdded"},function(e){t.dropInvitContainer&&(0!==e.data.nb_root?t.dropInvitContainer.hide():t.dropInvitContainer.show("drop"));var o=!1;if(0===e.data.nb_root&&(o=!0),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:o}),i.is(widget)&&!0===t.getOption("layout").title_update){var n=t.getWidgetTitle();if(t.options.widget.setTitle(n),n){var s={TitleInfo:n};F.isWidgetSynchronizing()||t._commandProxy.padRefresh(s)}}let r=e.data;if(r.isremove=!1,I.publish({event:"ENXModel/Root/manage",data:r}),t.getOption("layout").store_roots_in_pref&&t.dispatchEvent("onSaveRoots"),e.data.added_node&&!1===t.options.layout.withWelcomePanel){var a=e.data.added_node.getID();t.dispatchEvent("onAddPaths",{addedPaths:[[a]]})}var l=e.data.added_node,d=void 0;l&&(d=l.isRoot()?l:l.getRoot()),!0===N.getSetting("activateSynthesisOnRoot")&&0!==e.data.nb_root&&!1===y.isAuthoring()&&!0!==e.data.isremove&&d&&(!0===d.options.waiting4validation&&!0!==d.options.parseV2||!1!==d.hasSynthesis()||V.call(t,d)),!0!==t._wait4Filter&&G.call(t,d),I.publish({event:"ENXModel/NodeModelUpdate"})}),t.options.model.addEventListener("beginBlockingTransaction",function(e){t.beginBlockingTransaction(e.data)}),t.options.model.addEventListener("endBlockingTransaction",function(){t.endBlockingTransaction()}),t.initializeBI(),document.addEventListener("keyup",function(e){27===e.keyCode&&(t.options.model.originalSelection?(delete t.options.model.originalSelection,t.options.model._pagerview&&(t.options.model._pagerview.hide(),t.options.model._pagerview=null)):(t.options.model.unselectAll(),t.uncut&&t.uncut.call(t)))}),document.addEventListener("keypress",function(e){if(!0===t.options.layout.keyboard_inputs){var o=t.options.model;require(["UWA/Event"],function(t){var i=t.whichKey(e);"ctrl+a"===i&&o.withBroadcastSelect(function(){o.selectAll()})})}}),t.options.isReady.model=!0,t._probes.probe_model.end(),e&&e(),n()})})});r.name="build",n.push(r)}.call(t),t._probes.probe_view=s.createProbe("init_xnav_views"),function(){var e=this,t=new i.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});t.inject(this.options.widget.body);var o=require("DS/Windows/ImmersiveFrame"),n=require("DS/WebUAUtils/WebUAUtils"),s=new o;s.inject(t),this.options.widget.immersiveFrame=s,n.setPanelHelpMode({immersiveFrame:s}),this.options.widget.body.container=i.createElement("div",{}).inject(s.getFreeZone(),"top");var r=i.createElement("div",{class:"xnav_viewmain"}),a=(i.createElement("div",{class:"xnavToolbar"}).inject(r),i.createElement("div",{class:"xnavContent"}).inject(r));let l=Promise.resolve(),d=this.elements.container;var c=x.getPromises(),p=c.slice();p.push(l);var u=new Promise(function(t,o){Promise.all(p).then(function(o){var n=[],s=new Promise(function(t,o){if(e.options.action_bar_opts){var i=require("DS/PADUtils/PADProbes");e._probes.probe_actionbar=i.createProbe("init_xnav_actionbar"),require(["DS/ENXNav/commands/_xNavActionBar"],function(o){try{e.elements.actionbar=new o({xnav_app:e,action_bar:e.options.action_bar_opts,renderTo:d,callback:{onactionbarcb:function(o){e.options.isReady.actionbar=!0,!0===e.options.isReady.actionbar&&e._probes.probe_actionbar&&e._probes.probe_actionbar.end(),"onActionBarReady"===o&&("graphview"===e.options.active_view&&!0===e.options.loadGraphSection&&(e.elements.actionbar.mergeGraphSection(),e.options.graphABLoaded=!0),e.postActionBar()),!0===e.options.configuration.dynamicCtxActivated?require(["DS/ENXNav/utils/xNavCmdsMap"],function(o){e.options.cmdsMap=new o({context:e,toolbarActivated:!1,cmdsDefinition:e.options.configuration.commands}),e.options.cmdsMap.initialize({}).then(t).catch(function(e){console.error("xNavComponent: Cannot initialize command Map"),console.error(e)})}):t()}}})}catch(o){console.error("XNavComponent:: Cannot initialize ActionBar"),e.options.isReady.actionbar=!0,t()}})}else e.options.isReady.actionbar=!0,t()});s.name="action bar",n.push(s);var l=d;if(!0!==e.options.layout.dndEvo&&require(["DS/PADUtils/views/PADDnDInvite"],function(t){e.dropInvitContainer=new t({renderTo:d,mode:e.options.layout.drop_invite,dropOnInvite:i.is(e.dropOnInvite,"function")?e.dropOnInvite.bind(e):void 0})}),!0===e.options.layout.statusInfo){var c=new Promise(function(t){require(["DS/PADUtils/views/PADStatusInfos"],function(o){e.elements.padstatus=new o({withProgress:!0,events:{onShow:function(){var t=require("DS/PADUtils/PADUtilsServices");e.elements.padstatus.setStatus(o.buildStatus({Tenant:t.getPlatformId(),tree_content:{nbObjectsInTree:e.options.model.getAllDescendants().length,nbObjectsSelected:e.options.model.getSelectedNodes().length}}))}}}),t()})});c.name="status Infos",n.push(c)}var p=new Promise(function(t,o){if(!0===e.options.layout.padshell){var n,s=i.clone(e.options.layout.triptychOpts);s.container=d,n=i.createElement("div",{class:"xnav_viewright rightSidePanel"}),e.elements.padshell=new R,e.elements.padshell.init(s,e.createRootListSlidder2(),r,n),N.getSetting("persistSidePanel")&&(e._xNavPersistPanel=new O,e._xNavPersistPanel.setup(e.elements.padshell)),e.xNavPersistFilterSpec=new M({context:e}),e.elements.padshell.togglePanel=function(t){"left"===t?e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"})},e.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},function(e){I.publish({event:"ENXViews/Triptych/onOverlayClick",data:e})}),e.elements.padshell.openPanel=function(t){e.elements.padshell._modelEvents.publish({event:"triptych-show-panel",data:t})},I.publish({event:"on2DTriptychReady"}),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),U.call(e,{renderTo:a},t)}else U.call(e,{renderTo:d},t)});if(p.name="slidder",n.push(p),!0===e.options.authorizeChangeControl){var u=new Promise(function(t,o){Promise.all(n).then(function(o){require(["require","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy"],function(o,i,n){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(o){var s;s=e.elements.padshell?e.elements.padshell.getMainPanelContainer():e.elements.container.querySelector(".xnav_body"),o.initialize2(s,n.appId(),"hide",N.getSetting("changeControlPosition"),function(t){e.dispatchEvent("onAuthoringCtxAvailable",t)}),i.authoringCtxAvailable(),t()},function(e){t()})})})});u.name="promiseAuthorizeChnage",n.push(u)}var h=new Promise(function(o,i){Promise.all(n).then(function(i){!0===e.options.isReady[e.options.active_view]&&e._probes.probe_view.end(),e.elements.padstatus&&(!0===e.options.layout.padshell?e.elements.padstatus.inject(e.elements.padshell.getMainPanelContainer()):e.elements.padstatus.inject(l)),require(["DS/ApplicationFrame/CommandsManager"],function(t){var o="datagridview"===e.options.active_view||"treelistview"===e.options.active_view?"treeview":e.options.active_view,i=t.getCommand(o);i?i.begin():console.warn("Command ["+o+"] not found")}),t(),o()})});h.name="promiseResolve",n.push(h)})});u.name="buildSkeleton",c.push(u)}.call(t);var r=x.getPromises(),a=r.slice(),d=new Promise(function(e){Promise.all(a).then(function(){t.options.model.getVisibleAdditionalColumns=function(e){var o=[],n=t.options.views.datagridview;if(t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length)for(var s=0;s<t.options.additionalColumnsModules.length;s++){var r=[],a=t.options.additionalColumnsModules[s],l=a.getManagedColumnNames();if(n)for(var d=0;d<l.length;d++)!0===e?i.is(n.isColumnExportable,"function")&&n.isColumnExportable(l[d])&&r.push(l[d]):i.is(n.isColumnHidden,"function")&&!n.isColumnHidden(l[d])&&r.push(l[d]);(r.length||!0===a.alwaysUpdate)&&o.push({module:a,columns:r})}return o},I.subscribe({event:"ENXModel/SyncModel"},function(e){if("datagridview"!==t.options.active_view){for(var o=!0,i=0;i<t.options.additionalColumnsModules.length&&o;i++)"function"==typeof t.options.additionalColumnsModules[i].hasStructureModelUpdate&&(o=!1);if(!1===o){var n=t.options.model.getAllDescendants();N.getSetting("expandv2")?t.options.model.fillAttributesAsync(n,"SyncModelNodes"):t.options.model.fillAttributesAsync4VisibleNodes(n,void 0,"SyncModelNodes")}}else{var s=t.options.views.datagridview.options.dgv,r="OnSyncModel";if(!0===e.refresh&&(r="SyncModelRefresh",s.requestDelayedModelData&&s.requestDelayedModelData(r)),e.what)switch(e.what){case"applyFilter":s.requestDelayedModelData&&s.requestDelayedModelData(r)}}}),t._dispatchReady(),t.isDynamicCtx()&&require(["DS/ENXNav/commands/CmdUtils"],function(e){e.checkAvailability()}),I.subscribe({event:"ENXModel/Expand/expandStatus"},function(e){e.status&&!0===e.status.expandTooLarge&&("find_in_ctx"===e.mode?_.displayNotification({msg:o.replace(o.tooManyResultFound,{maxResult:N.getSetting("maxPathsForSearch")}),eventID:"warning"}):_.displayNotification({msg:o.expandTooLarge,eventID:"warning"}))}),I.subscribe({event:"ENXModel/Expand/parseDone"},t._checkGraphCmdAvailability.bind(t)),e()})});d.name="dispatchReady",r.push(d)}():t._initialize_failure(function(){t.dispatchEvent("onReady",{error:!0})})})}),I.subscribe({event:"DesignEnv/updatePSEModel"},function(e){e(t.options.model)}),I.subscribe({event:"DesignExp/ReopenDesignExpAssets"},function(e){let o=t.getActiveDesignExp(),i=t.getPADTreeDocument().getChildren();o&&o.getID()==e.deId&&t.getPseService().addItems(i.length?o.getContents().filter(e=>!i.find(t=>t.options.resourceid==e.getID()||t.options.resourceid==e.options.associatedRoot)):o.getContents())})},render:function(){return this.elements.container},onSearch:function(e){0===this.options.model.getRoots().length?this.displayNotification({msg:t.find_in_context_no_result,eventID:"info"}):this.options.model.isGroupingApplied()?this.displayNotification({title:t.noFindWithGroupingTitle,msg:t.noFindWithGrouping,eventID:"info"}):b.launchFind({nodes:this.options.model.getRoots(),searchFts:e.query,doNotBroacast:!0})},openStoredObjects:function(e){if(e.unserializedData&&e.unserializedData.data.items.length>0){var o=require("DS/PADUtils/PADUtilsServices").getPlatformId();return o&&e.unserializedData.data.items.forEach(function(e){e.envId=o}),this.openSearchedObjects(e)}var n=w.buildKey("ENXNav","pendingOpen",!0),s=this;return new Promise(function(o){var r=w.sess.get(n);if(r&&(delete r.fromProxy,delete r.expiresAt,i.equals(r,e)))return w.sess.del(n),void o();w.sess.setWithExpire(n,e,2e3);var a=x.getPromises(),l=[];if(e.designEnvs&&e.designEnvs.length){var d=new Promise(function(t){Promise.all(a).then(function(){s.add({content:"designEnv",designEnv:e.designEnvs,broadcast:!1,loadWithFilter:e.withFilter,callback:function(){t()}})})});d.name="AddDesignEnv",l.push(d)}if(e.products&&Object.getOwnPropertyNames(e.products).length){var c=new Promise(function(o){Promise.all(a).then(function(){s.add({content:"structure",structure:e.products,id_to_detach:e.id2detach,broadcast:!0===e.broadcast,loadWithFilter:e.withFilter,callback:function(){!0===e.withFilter&&(y.isAuthoring()?(_.displayNotification({msg:t.filterInAuthoring,eventID:"warning"}),s.disableFilterWaiting()):!0!==e.fromProxy?require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.begin(),s._filterPanelOpen=!0)}):!0===e.fromProxy&&(s._filterRootIds=Object.getOwnPropertyNames(e.products),s._filterPanelOpen=!0)),o()}})})});c.name="AddRoots",l.push(c)}if(e.filters){var p=require("DS/PADUtils/PADUtilsServices"),u=Object.getOwnPropertyNames(e.filters);u.length&&Promise.all(l).then(function(){var t=new Promise(function(t){Promise.all(a).then(function(o){for(var i=[],n=0;n<u.length;n++)i.push({envId:p.getPlatformId(),serviceId:"3DSpace",objectId:u[n],objectType:"ENOStrRefinementSpecification"});s.addFilter({filter_objects:i,multipleFilters:e.multipleFilters,broadcast:!1,callback:function(e){e.failure&&e.failure.length>0&&s.endBlockingTransaction(),t()}})})});t.name="AddFilters",l.push(t)})}Promise.all(l).then(function(){o()})})},openSearchedObjects:function(e){var o=this;return new Promise(function(n){function s(i){!0===e.withFilter&&(y.isAuthoring()?(_.displayNotification({msg:t.noFilterOnAuthoring,eventID:"warning"}),o.disableFilterWaiting()):!0!==e.fromProxy&&require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&t.begin()})),n(i)}var r=i.extend({notifPerObjects:!0,displayNotif:!1,callback:function(i){if(0===i.authorized_objects.length){var n={error:"noAuthObj"};!0===i.unsupportedDropNotified&&(_.displayNotification({msg:t.no_authorized_object,eventID:"error",key:"enxNav-openSearchedObjects-unsupported-drop"}),n.what="unsupportedDropNotified"),s(n)}else{var r=e.behavior?e.behavior:"WITH_CONTEXT";if(i.authorizedWithKind){if(i.authorizedWithKind.Product&&i.authorizedWithKind.Product.length>0){var a={content:"3DXContent",authorized_objects:i.authorizedWithKind.Product,callback:s,behavior:r,isDrop:!0,broadcast:!1};e.withFilter&&(a.loadWithFilter=!0),o.add(a)}i.authorizedWithKind.Filter&&i.authorizedWithKind.Filter.length>0&&o.addFilter({content:"3DXContent",filter_objects:i.authorizedWithKind.Filter,callback:s,behavior:void 0,broadcast:!1})}}},version:"2.0"},e);C.retrieveAuthorizedObjects(r)})},openDroppedObjects:function(e){var n=this;return new Promise(function(s){var r=require("DS/PADUtils/PADUtilsServices");function a(t){if(1!=e.isDesignExpCall){var o=I.getModelEvents();if(e.isOpenFromFiltersPage)o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"});else if(0===n.options.model.getRoots().length&&0===n.options.model.getDetachedRoots().length)if(e.unserializedData.data.items.length>0){for(var i=!1,r=0;r<e.unserializedData.data.items.length;r++)if("Change Action"===e.unserializedData.data.items[r].objectType){i=!0;break}i&&(o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),i=!1)}else o.publish({event:"ENXViews/WelcomePanel/activate"});else o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"});s(t)}else s(t)}if(N.getSetting("readOnlyDashboard")&&n._displayOnceReadOnlyNotif&&(_.displayNotification({msg:o.msg_readonly_dashboard,eventID:"warning"}),n._displayOnceReadOnlyNotif=!1),"FILTER"===e.behavior){if(n.options.isDeEnabled){let t=e.unserializedData.data.items;if(t.forEach((e,o)=>"Workspace"==e.objectType&&t.splice(o,1)&&(n.options.donNotOpenDE=!0)),n.options.donNotOpenDE&&(_.displayNotification({msg:o.design_exp_unable_to_filter,eventID:"error"}),n.options.donNotOpenDE=!1,!t.length))return!1}require(["DS/ApplicationFrame/CommandsManager"],function(t){var o=t.getCommand("FilterDropObjects");o?(e.fromWP=!0,o.execute(e.unserializedData,e)):console.error("XNavComponent## FilterDropObjects command is undefined"),s(o?void 0:{error:"noCommandAvailable"})})}else{var l=i.extend({notifPerObjects:!0,displayNotif:!1,callback:function(o){if(0===o.authorized_objects.length){var s={error:"noAuthObj"};!0===o.unsupportedDropNotified&&(_.displayNotification({msg:t.invalidDropOperation,eventID:"error",key:"enxNav-openDroppedObjects-unsupported-drop"}),s.what="unsupportedDropNotified"),a(s)}else{var l=e.behavior?e.behavior:"WITH_CONTEXT",d=n.options.model.getRoots(),c=!!i.is(e.broadcast,"boolean")&&e.broadcast;r.multiTenantMgt(o.authorized_objects,d,function(t){if(t.isMultiTenant)t.isMultiTenant&&t.invalidTenant&&a({error:"invaidTenant"});else{var i=[];o.authorizedWithKind?(o.authorizedWithKind.Product&&o.authorizedWithKind.Product.length>0&&i.push(new Promise(function(t){n.add({content:"3DXContent",authorized_objects:o.authorizedWithKind.Product,callback:t,behavior:l,isDrop:!0,broadcast:c,biProxyCtx:o.source_data.biProxyCtx,loadWithFilter:!0===e.withFilter||void 0})})),o.authorizedWithKind.Filter&&o.authorizedWithKind.Filter.length>0&&Promise.all(i).then(function(){i.push(new Promise(function(e){n.addFilter({content:"3DXContent",filter_objects:o.authorizedWithKind.Filter,callback:e,behavior:"fromDrop",broadcast:c})}))}),o.authorizedWithKind.Change&&o.authorizedWithKind.Change.length>0&&Promise.all(i).then(function(){i.push(new Promise(function(e){n.loadChangeV2?n.loadChangeV2({content:"3DXContent",objects:o.authorizedWithKind.Change,callback:e,behavior:l,broadcast:c}):e({})}))}),o.authorizedWithKind.DesignEnv&&o.authorizedWithKind.DesignEnv.length>0&&(Promise.all(i).then(function(){i.push(new Promise(function(e){I.publish({event:"ENXModel/DesignEnv/add",data:{designEnv:o.authorizedWithKind.DesignEnv,pseModel:n.options.model,resolve:e}})}))}),n.dispatchEvent("onAddDesignEnv",{designEnvIds:o.authorizedWithKind.DesignEnv.map(e=>e.objectId)}))):i.push(new Promise(function(e){n.add({content:"3DXContent",authorized_objects:o.authorized_objects,callback:e,behavior:l,broadcast:c,biProxyCtx:o.source_data.biProxyCtx})})),Promise.all(i).then(a)}})}},version:"2.0"},e);C.retrieveAuthorizedObjects(l)}})},add:async function(e){var o=e||{},n=[],s=[],r=[];switch(e.content){case"idslist":n=(o=e).pids;break;case"pathslist":for(var a=0;a<e.paths.length;a++){var l=e.paths[a][0];-1===n.indexOf(l)&&n.push(l)}break;case"3DXContent":(o=await async function(e){var t={pids:[],is3DContent:void 0!==e.initLoad&&e.initLoad},o=e.behavior?e.behavior:"WITH_CONTEXT";e.isDrop&&e.isDrop&&(t.skipDrop=!1);async function n(e){return new Promise(t=>{C.isTypesAuthorized([e],o=>{-1!==o.indexOf(e.type)?t(!0):t(!1)},!1)})}for(var s=[],r=[],a=[],l=0;l<e.authorized_objects.length;l++){var d=e.authorized_objects[l];if(s.push(d.objectId),"fromx3dContentId"===o&&Array.isArray(d.path)&&Array.isArray(d.path)){let e=await n(d.path[0]);B(r,e?d.path:[d.path[d.path.length-1]])}"WITH_CONTEXT"===o&&(i.is(d.path,"array")||(o="WITHOUT_CONTEXT")),"WITH_CONTEXT"===o&&r.push(d.path.map(function(e){return e.resourceid})),"FILTER"===o&&Array.isArray(d.path)&&B(r,d.path),d.folderId&&-1===a.indexOf(d.folderId)&&a.push(d.folderId)}"fromx3dContentId"===o&&(t.paths=r);if("WITH_CONTEXT"===o){t.paths=r;for(var c=0;c<t.paths.length;c++)t.pids.push(t.paths[c][0])}else t.pids=s;t.broadcast=!i.is(e.broadcast,"boolean")||e.broadcast,a.length&&(t.folderIds=a);return t}(e)).callback=e.callback,n=o.pids;break;case"designEnv":return I.publish({event:"ENXModel/DesignEnv/add",data:{designEnv:e.designEnv,pseModel:this.options.model}}),void this.dispatchEvent("onAddDesignEnv",{designEnvIds:e.designEnv.map(e=>e.objectId)});case"structure":(o=function(e){var t={pids:[],paths:[],id_to_detach:e.id_to_detach,broadcast:e.broadcast},o=e.structure,i=[],n=function(e,o){var s,r=Object.keys(e),a=r.length;for(s=0;s<a;s++){let a=r[s],g=e[a],f="string"==typeof g;var l,d=Object.keys(g),c=d.length;if(0===c||f){var p;(p=void 0===o?[]:o.slice()).push(r[s]);var u=p.join(",");-1===i.indexOf(u)&&(i.push(u),t.paths.push(p))}else for(l=0;l<c;l++){var h;(h=void 0===o?[]:o.slice()).push(r[s]),n(e[r[s]],h)}}};return n(o),t}(e)).callback=e.callback;for(var d=0;d<o.paths.length;d++){var c=o.paths[d][0];-1===n.indexOf(c)&&n.push(c)}if(0===o.paths.length&&0===o.pids.length)return void(o.callback&&o.callback());break;case"filters":var p=!1,u=-1;if(void 0===o.pids&&(o.pids=[]),e.rootsWithFilters&&e.rootsWithFilters.length>0){for(var h=0;h<e.rootsWithFilters.length;h++){var g=e.rootsWithFilters[h].rootId,f=e.rootsWithFilters[h].filterId,v=e.rootsWithFilters[h].filterName;if(-1!==n.indexOf(g)){p=!0,u=h;break}n.push(g),o.pids.push(g),f&&-1===s.indexOf(f)&&s.push(f),v&&-1===r.indexOf(v)&&r.push(v)}p&&-1!==u&&e.rootsWithFilters.splice(u)}!0===p&&_.displayNotification({msg:t.filterMultipleSameRoot,eventID:"warning"}),o.rootsWithFilters=e.rootsWithFilters,o.callback=e.callback;break;default:throw new Error("Not supported content")}!0===e.loadWithFilter&&!0!==this._wait4Filter&&(this.disableUX(),o.loadWithFilter=!0,this._wait4Filter=!0,this._filterRootIds=n,this._filterPanelOpen=!0);var m=this;o.rootIds=n,o.filterIds=s,o.filterNames=r,o.behavior=!0===e.dropOnFilter?"fromDropOnFilter":o.behavior;var D=x.getPromises(),b=D.slice(),S=new Promise(function(t,i){Promise.all(b).then(function(){var i=Promise.resolve({rootsWithFilter:void 0,objectsWithoutFilterDrop:o});e.biProxyCtx&&(i=m._checkIfFilterAvailable(o,e.biProxyCtx)),i.then(function(e){m.addInProgressFlag=!0;var o=[],i=!1;e.rootsWithFilter&&(o.push(m._addDroppedRootsWithFilter(e.rootsWithFilter)),i=!0),e.objectsWithoutFilterDrop&&(o.push(new Promise(function(t){m._internalAdd(e.objectsWithoutFilterDrop,t)})),i=!0),Promise.all(o).then(function(){!1===i&&!0===m._wait4Filter&&(m.enableUX(),m._wait4Filter=!1),m.addInProgressFlag=!1,I.publish({event:"ENXModel/Root/AllAdded"}),t()}),m.dropInvitContainer&&m.dropInvitContainer.hide(),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:!0})})})});S.name="add",D.push(S)},_internalAdd:function(e,t){var n=this;a.mask(this.elements.container);var s=e.callback,r=function(t,o){if(!1!==t.broadcast){var i={pids_hidden:t.id_to_detach},s=!0;if(!0===e.loadWithFilter&&!1===y.isAuthoring()&&o.alreadyLoadedRoots&&o.alreadyLoadedRoots.length&&(i.loadWithFilter=!0,t.rootIds.length===o.alreadyLoadedRoots.length)){for(var r=!0,a=0;a<t.rootIds.length&&r;a++)-1===o.alreadyLoadedRoots.indexOf(t.rootIds[a])&&(r=!1);!0===r&&(s=!1)}if(!0===s){t.rootsWithFilters&&!0!==i.loadWithFilter?i.rootsWithFilters=t.rootsWithFilters:t.paths?i.paths=t.paths:i.pids=t.pids;var l=require("DS/PADUtils/PADUtilsServices");if(i.tenant=l.getPlatformId(),t.is3DContent)return;t.loadWithFilter&&(i.loadWithFilter=!0),F.isWidgetSynchronizing()||n._commandProxy.drop(i)}}},l=function(t){n.options.model.prepareBroadcastSelect();var o=e.paths;if(!i.is(e.paths,"array")){o=[];for(var s=0;s<e.rootIds.length;s++)o.push([e.rootIds[s]])}n.options.model.pushBroadcastSelect()};function d(o){"graphview"===n.options.active_view&&n.options.views.graphview&&(n.options.views.graphview.reframeOn(),n.options.views.graphview.reframeAll()),n.dropInvitContainer&&(0===n.options.model.getRoots(void 0).length&&0===n.options.model.getDetachedRoots().length?n.dropInvitContainer.show("drop"):n.dropInvitContainer.hide());let a=!1;0===n.options.model.getRoots(void 0).length&&(a=!0),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:a}),i.is(s,"function")&&("error"==o?s(o):s.call(null,e.rootsWithFilters?e.rootsWithFilters:null,o)),r(e,o),l(e),t()}function c(e){"error"!==e&&(!0!==e.noNotif&&_.displayNotification({eventID:"success",msg:o.addRootSuccessNotif}),N.getSetting("readOnlyDashboard")&&n._displayOnceReadOnlyNotif&&(_.displayNotification({msg:o.msg_readonly_dashboard,eventID:"warning"}),n._displayOnceReadOnlyNotif=!1))}var p=!0,u=!!i.is(e.folderIds,"array");if(i.is(e.paths,"array")){if(u&&1===e.paths.length){for(var h=[],g=0;g<e.paths.length;g++)e.paths[g].length>1&&h.push(e.paths[g]);h.length||(p=!1)}if(p){var f=!0;for(g=0;g<e.paths.length&&f;g++)e.paths[g].length>1&&(f=!1)}}if(i.is(e.paths,"array")&&p&&!1===f&&e.paths.length){a.unmask(n.elements.container);var v=this.options.model.getRoots(),m=[];v&&v.length>0&&v.forEach(function(e){e.options.isRootAttached&&m.push(e.options.resourceid)}),this.options.model.addPaths({paths:e.paths,callback:function(t,o){if(t.success)i.is(e.id_to_detach,"array")&&e.id_to_detach.length>0&&e.id_to_detach.forEach(function(e){var t=n.options.model.searchRootById(e);i.is(t)&&n.toggleRoot({context:t})}),n.dispatchEvent("onAddPaths",{addedPaths:e.paths}),c(e);else if(i.is(t.idleRootIds,"array")){var s=[];if(t.idleRootIds.forEach(function(e){-1===m.indexOf(e)&&s.push(e)}),s.length>0){var r={};r.pids=s,n._onRemoveRoot(r),m.length>0&&m.filter(function(e){return this.indexOf(e)<0},s);var a=n.getWidgetTitle();n.options.widget.setTitle(a)}}d(o)}})}else this.options.model.add({pids:e.rootIds,rootsWithFilters:e.rootsWithFilters,callback:function(t){if("error"!=t)if(i.is(e.paths,"array")){var o=n.options.model;let i=e.paths;if(t.alreadyLoadedRoots&&t.alreadyLoadedRoots.length)for(let e=0;t.alreadyLoadedRoots&&e<t.alreadyLoadedRoots.length;e++){let o=i.indexOf(t.alreadyLoadedRoots[e]);-1!==o&&i.splice(o,1)}o.insertBranches(i,{onComplete:function(){if(o.prepareBroadcastSelect(),o.pushBroadcastSelect(),"graphview"===n.options.active_view&&n.options.views.graphview.reframeOn(),0===i.length){for(var s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);i=s}n.dispatchEvent("onAddPaths",{addedPaths:i}),"datagridview"===n.options.active_view&&n.options.views.datagridview.reapplySortModel(),c(t)}})}else{if(!0===n.options.layout.withWelcomePanel){if(t&&"error"!==t)if(e.filterIds.length>0)t&&t.alreadyLoadedRoots&&0===t.alreadyLoadedRoots.length&&n.dispatchEvent("onAddFilters",{filterIds:e.filterIds,rootIds:e.rootIds,filterNames:e.filterNames});else{for(var s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);n.dispatchEvent("onAddPaths",{addedPaths:s})}}else{for(s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);n.dispatchEvent("onAddPaths",{addedPaths:s})}t&&"error"!==t?c(t):I.publish({event:"ENXViews/WelcomePanel/activate"})}a.unmask(n.elements.container),d(t)}})},empty:function(e,t,o){var i=this,n=[],s=!1!==e;if(!0===t){i.options.model.getRoots().forEach(function(e){n.push(e.getID())}),I.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:{item2remove:n,noDispatch:o}})}else{var r=x.getPromises(),a=r.slice(),l=new Promise(function(e,t){Promise.all(a).then(function(t){var r=i.options.model;if(r&&r.unselectAll(),!0===s&&i._commandProxy.cleanAll(),r){if(r.getRoots(!0).forEach(function(e){n.push(e)}),r.getDetachedRoots().forEach(function(e){n.push(e)}),r._skipFilterProxy=!0,r.wrapInTransaction(function(){r.withTransactionUpdate(function(){n.forEach(function(e){I.publish({event:"ENXModel/Root/remove",data:{all:!0}})})})}),r._skipFilterProxy=!1,!o){let e=n.map(function(e){return e.getID()});r.getModelEvents().publish({event:"onRemoveRoots",data:{pids:e}})}r._pagerview&&(r._pagerview.hide(),r._pagerview=null),i.options.widget.getValue("saved_filter_ids")&&i.options.widget.setValue("saved_filter_ids","[]"),e()}})});l.name="empty",r.push(l)}},toggleView:function(e){var t=e;"treeview"===e&&(e=this.options.layout.amdTreeView);let o=require("DS/PADServices/settings/AppSettings").getSetting("activateStatusBar");if(e!==this.options.active_view){var i=this;this.loader.loadView(e,function(){if(i.options.views[i.options.active_view].unsetModel(),i.options.active_view=e,i.options.model.applyActiveView(i.options.active_view),i.options.views[i.options.active_view].setModel(i.options.model),"graphview"===i.options.active_view){if(!0===o&&i.elements.actionbar.options.xnav_ab.elements.container.removeClassName("xnav_actionbar_withstatusbar"),i.options.views.graphview.reframeOn(),!0===i.options.loadGraphSection){var n=i.elements.actionbar.options.xnav_ab.onActionBarReady(function(){i.elements.actionbar.options.xnav_ab._modelEvents.unsubscribe(n),i.elements.actionbar.options.xnav_ab.goToNthSection(i.elements.actionbar.options.xnav_ab.getSectionID("XSCViews")),require("DS/ApplicationFrame/CommandsManager").getCommand(t).begin()});i.elements.actionbar.options.xnav_ab.loadModel({merge:!0,file:"GraphViewAB.xml",module:"ENXNav"}),i.options.graphABLoaded=!0}}else if(!0===i.options.loadGraphSection&&!0===i.options.graphABLoaded){var s=i.elements.actionbar.options.xnav_ab.onActionBarReady(function(){i.elements.actionbar.options.xnav_ab._modelEvents.unsubscribe(s),i.elements.actionbar.options.xnav_ab.goToNthSection(i.elements.actionbar.options.xnav_ab.getSectionID("XSCViews")),require("DS/ApplicationFrame/CommandsManager").getCommand(t).begin()});!0===o&&i.elements.actionbar.options.xnav_ab.elements.container.addClassName("xnav_actionbar_withstatusbar"),i.elements.actionbar.options.xnav_ab.loadModel(i.options.action_bar_opts),i.options.graphABLoaded=!1}i.dispatchEvent("onToggleView",i.options.active_view),I.publish({event:"ENXModel/toggleView",data:{view:i.options.active_view}})})}},postActionBar:function(){},beginBlockingTransaction:function(e){a.mask(this.elements.container,e)},endBlockingTransaction:function(){a.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize(),this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},hasActiveDesignExp(){let e=this.leftsidepanel.elements.designenvpanel;return!(!e||!e.core.contextManager.getActiveDesignEnv())},getActiveDesignExp(){return this.leftsidepanel.elements.designenvpanel.core.contextManager.getActiveDesignEnv()},getPseService(){return this.leftsidepanel.elements.designenvpanel.core.pseCommonService},getRoots:function(){return this.options.model.getRoots()},getPADDGVView:function(){return this.options.views.datagridview},getPADTreeListView:function(){return console.warn("getPADTreeListView Deprecated: use getPADDGVView instead"),this.getPADDGVView()},getProxy:function(){return this._commandProxy},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getMainHTMLClass:function(){return".xnav_body"},applyFilter:function(e){this.options.model.options.removeChildrenInProgress=!0,"2.0"===this.options.model.version?this.applyFilterV2(e):this.applyFilterV1(e),this.options.model.options.removeChildrenInProgress=!1},applyFilterV1:function(e){this.enableUX();var t=this;!0===this._wait4Filter&&(this._wait4Filter=!1),this._filterPanelOpen=!1;var o=i.clone(e,!0),n=this.options.model.getRoots(),s=!1;t.options.ordering=t.options.ordering?t.options.ordering:[],null!==e&&!1===e.empty&&(s=!0,0===t.options.ordering.length&&n.forEach(function(e){var o=e.getID();-1===t.options.ordering.indexOf(o)&&t.options.ordering.push(o)}));var r,a=[];if(null===e)for(e={},r=0;r<n.length;r++)a.push(n[r].getID());else e.root_physicalid&&a.push(e.root_physicalid);!0===e.hideChildren?this.options.model._hideChildrenFilter=!0:delete this.options.model._hideChildrenFilter;var l=!1,d=N.getSetting("activateDGV");if(void 0!==e.filterRootIds){t=this;this.options.model.withTransactionUpdate(function(){for(r=0;r<e.filterRootIds.length;r++){var o=t.options.model.searchRootById(e.filterRootIds[r]);if(o)if(!0===e.empty){if(delete o.options.filtered,delete o.options.filterTitle,o.options.CVQuery=null,o.options.sequence_filter=null,o.options.config_filter=null,!0===d){if(o.options.icons&&o.options.icons.length)(c=i.clone(o.options.icons[0])).badges={bottomRight:null},o.updateOptions({icons:[c]})}else o.setBadges({bottomRight:""});var n=o.getState();o.setState({state:"partiallyExpanded"}),o.options.padstate="partiallyExpanded",o.childComputed=!1,"collapsed"===n?o.options.children=[]:(o.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded",null===this.options.children&&(this.options.children=[]),this.childComputed=!1,"collapsed"===e&&(this.options.children=[])}}}),null===o.options.children&&(o.options.children=[])),I.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter"}})}else{if(l=!0,o.options.filtered=!0,o.options.filterTitle=e.filterTitle,o.options.filterId=e.filterId?e.filterId:o.options.filterId,o.options.CVQuery=e.CVQuery,e.CVQuery&&e.CVQuery.union&&e.CVQuery.union.expand)for(var s=0;s<e.CVQuery.union.expand.length;s++){var a=e.CVQuery.union.expand[s].root_path_physicalid;1===a.length&&-1!==a[0].indexOf(o.getID())&&(o.options.sequence_filter=e.CVQuery.union.expand[s].sequence_filter,o.options.config_filter=e.CVQuery.union.expand[s].config_filter)}else o.options.sequence_filter=null,o.options.config_filter=null;if(o.collapseAll(),o.removeChildren(!1),o.options.children=[],o.setState({state:"collapsed"}),o.options.padstate="collapsed",o.childComputed=!1,!0===d){var c;if(o.options.icons&&o.options.icons.length)void 0===(c=i.clone(o.options.icons[0]))&&(c={}),c.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},o.updateOptions({icons:[c]})}else{o.setBadges({bottomRight:"filter"})}}}I.publish({event:"ENXModel/UpdateAdditionalColumns",data:{nodesToUpdate:{pids:e.filterRootIds},treedocument:t.options.model}})})}else console.warn("xNavComponent: No filterRootIds properties");l&&!0===N.getSetting("expandAllwithApplyFilter")&&(!0===N.getSetting("structureAppearCollapseAfterApplyFilter")&&(e.structCollapse=!0),e.tagFilterCase=s,this.options.model.applyFilter(e)),!0!==e.doNotBroacast&&this._commandProxy.applyFilter(o)},applyFilterV2:async function(e){var o=this,n=i.clone(e,!0);let s=async e=>new Promise(t=>{o.add({content:"idslist",pids:[e.rootId],callback:t})});var r;!0===this._wait4Filter&&(this._wait4Filter=!1),this.enableUX(),I.publish({event:"ENXModel/Root/AllAdded"}),this._filterPanelOpen=!1;!0===e.hideChildren?this.options.model._hideChildrenFilter=!0:delete this.options.model._hideChildrenFilter;var a=[];void 0!==e.filterRootIds?this.options.model.withTransactionUpdate(async function(){for(r=0;r<e.filterRootIds.length;r++){var i=o.options.model.searchRootById(e.filterRootIds[r]);if(void 0===i&&(await s({rootId:e.filterRootIds[r]}),i=o.options.model.searchRootById(e.filterRootIds[r])),i){if(y.determineAuthoredFlag()&&!0===N.getSetting("keepFilterAuthoring")){var n,l=o._biFilter.getFilterSpec(i.getID(),{V2:{}});(n=k.validateFIlters(l))&&n.isValid?(i.keepFilterBadge=!0,i.validFilter=!0,o.options.model.prodConfigSupportInAuth=!0):_.displayNotification({msg:t.invalidFilterInAuth,eventID:"warning"})}if(a.push(i),!0===e.empty){i.options.icons&&i.options.icons.length&&S.node.clearBadges(i);var d=i.getState();i.setState({state:"partiallyExpanded"}),delete i.options.filtered,delete i.options.filterTitle,i.options.childComputed=!1,"collapsed"===d?(i.removeChildren(),i.options.children=[],i.setState({state:"partiallyExpanded"})):(i.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();null!==this.options.children&&void 0!==this.options.children||(this.options.children=[]),this.options.childComputed=!1,"collapsed"===e&&(this.removeChildren(),this.options.children=[]),this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded"}}}),null===i.options.children&&(i.options.children=[])),o.hasActiveDesignExp()&&o.getPseService().handleFilterModifications(e,"removed"),!0===o.options.model.grpBSDActivated&&o.options.model.removeGrouping({selectedNode:i})}else{i.options.filtered=!0,(o.options.isDeEnabled||o.hasActiveDesignExp())&&(o.hasActiveDesignExp()&&(!o.hasActiveDesignExp()||i.options.filterId&&o.getPseService().isContext(i.options.resourceid)||o.getPseService().isFromActionClick)||(o.shouldAddSpecForDE=!0,o.xNavPersistFilterSpec.addEventForEachFilter([i.options.resourceid])),i.options.filterTitle=e.filterTitle,i.options.filterId=e.filterId?e.filterId:i.options.filterId,o.hasActiveDesignExp()&&(o.pseService=o.getPseService(),i.options.isReadOnly=!!o.pseService.isContext(i.options.resourceid),o.pseService.isLastFilterLoaded(i))),i.collapseAll(),i.removeChildren(!1),i.options.children=[];let t=o.options.model.getXSO(),n=t.get().filter(function(e){return!e.getTreeDocument()});t.remove(n),i.options.children=[],i.setState({state:"collapsed"}),i.options.padstate="collapsed",i.options.childComputed=!1,i.options.icons&&i.options.icons.length&&S.node.setFilterBadge(i),V.call(o,i),G.call(o,i),o.hasActiveDesignExp()&&o.getPseService().handleFilterModifications(e,"applied",i)}}}}):console.warn("xNavComponent: No filterRootIds properties"),a.length&&(e.tagFilterCase=!1,this.options.model.isGroupingApplied()&&(!0===this.options.model.grpBSDActivated?a.forEach(async e=>{await this.options.model.removeGrouping({selectedNode:e})}):(this.options.model.cleanGroupingForRoots({rootIds:e.filterRootIds}),this.options.model.__applyGrouping({roots:e.roots,groups:this.options.model.options.groups,fromApplyFilter:!0}))),this.options.model.expandZeroForFilterRoots({filteredRoots:a})),!0!==e.doNotBroacast&&this._commandProxy.applyFilter(n)},getSecurityContext:function(){return{SecurityContext:A.getSecurityContext()}},disableUX:function(){var e=this;e._disablingInProgress=!0,e.elements.container.blockUX||require(["DS/UIKIT/Modal"],function(t){!0===e._disablingInProgress&&(delete e._disablingInProgress,e.elements.container.blockUX=new t({className:"disableMainUX",closable:!1,body:"",visible:!0}),e.elements.container.blockUX.inject(document.body))})},enableUX:function(){this.elements.container.blockUX&&(this.elements.container.blockUX.destroy(),delete this.elements.container.blockUX),!0===this._disablingInProgress&&delete this._disablingInProgress},disableFilterWaiting:function(e){var t=this,o=e||{};this.enableUX(),e&&"left"===e.panel&&(!0===this._wait4Filter&&(this._wait4Filter=!1,I.publish({event:"ENXModel/Root/AllAdded"}),!0===this._filterPanelOpen&&(this._filterPanelOpen=!1,this.confirmModal=new p({callback:function(o){if(!1===t.confirmModal.cancelModal.fromProxy){!1===o&&t._onRemoveRoot({pids:t._filterRootIds});var i={widget:"2D",result:o};t._commandProxy.filterCancel(i)}if(!1!==o)for(let o=0;o<e.rootIds.length;o++){var n=t.options.model.searchRootById(e.rootIds[o]);G.call(t,n)}}}))),this._commandProxy.disableFilterWaiting(o))},togglePanel:function(e,t){(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},openPanel:function(e){this.elements.padshell.openPanel(e)},destroy:function(){var e=require("DS/PADUtils/PADUtilsServices");this._commandProxy.padDestroy({widgetId:e.getWidgetId()}),this._commandProxy.destroy(),this.options.model._commandProxy&&this.options.model._commandProxy.destroy(),this.options.model._cmdProxy&&this.options.model._cmdProxy.destroy()},_dispatchReady:function(e){if(!0===this.options.isReady.model&&!this._dragLeave){let e=this.getContent(),t=this;e.addEventListener("dragleave",function(e){t.dropInvitContainer&&t.dropInvitContainer.hide(),0===t.options.model.getRoots().length&&t.dropInvitContainer.show("drop")}),this._dragLeave=!0}this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady.actionbar&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady",{addInView:e}),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)},displayNotification:function(e){_.displayNotification(e)},_initialize_failure:function(e){var t=this;require(["DS/ENXNav/views/xNavInitError"],function(i){var n=o.initialization_error;t.elements.bigerror=new i({msg:n}),t._just_error_content(),t.displayNotification({title:o.initialization_errorTitle,msg:n,eventID:"error",key:"enxNav-initialisation-error"}),e()})},_just_error_content:function(){this.elements.bigerror&&this.elements.container.setContent(this.elements.bigerror)},getCurrentView:function(){return this.options.active_view},updateCurrentView:function(){this.options.views[this.options.active_view].updateView()},getPropertiesFacet:function(){return this.options.layout.propertiesFacet?this.options.layout.propertiesFacet:[]},isPartiallyExpanded:function(e,t){var o=!1;if("partiallyExpanded"===e.getState())o=!0;else{var i=e.getRoot();if(i.options._filterInfo&&JSON.stringify(i.options._filterInfo)!==JSON.stringify({}))o=!0;else if(void 0!==i.options.sequence_filter||void 0!==i.options.config_filter)o=!0;else if(i.options._childrenFilterInfo){var n=i.options._childrenFilterInfo.filteredOutChildren;n&&n.length>0&&(o=!0)}}t&&t(o)},updateAttributesDelayed:function(e){var t=this,o=l.debounce(function(e){var o=e.displayNodesArray;if(void 0===o&&e&&e.collectionView&&e.collectionView.model){var i=e.collectionView;o=void 0!==e.startNodeIndex&&void 0!==e.endNodeIndex?i.model.slice(e.startNodeIndex,e.endNodeIndex+1):i.model}if(o.length){for(var n=[],s=0;s<o.length;s++)o[s]._canBeGrouped()&&n.push(o[s]);t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length&&t.options.model.fillAttributesAsync4VisibleNodes(n,void 0,e.context),t.colorMap&&t.options.model.updateColorForNodes(n,t.colorMap,t.predicateKind);let i=t.getPADDGVView().getColumnViewsForUpdate();i&&S.node.updateSpecificColumnViews(n,i,e.context);for(var r=0,a=n.length;r<a;r++)!0!==n[r]._manageNLS&&!0!==n[r].options.ensureNLS||P.updateNLS(n[r])}},200);"OnResize"!==e.context&&!0!==this.options.model.__groupingInProgress&&o(e)},getWidgetTitle:function(){var e=require("DS/PADUtils/PADUtilsServices"),o=e.getPlatformId(),i=e.getTenantsPreference(),n=this.getRoots(),s="";if(0===n.length)s="";else if(1===n.length){s=n[0].getLabel(),i.length>1&&(s+=" - "+o)}else s=n.length+t.multi_root_tile,i.length>1&&(s+=" - "+o);return s},_checkGraphCmdAvailability:function(){var e=this.options.model.getAllDescendants().length,t=require("DS/ApplicationFrame/CommandsManager"),o=N.getSetting("maxNodesInGraph")?N.getSetting("maxNodesInGraph"):3e3,i=t.getCommand("graphview");if(i)if(e>o){if("graphview"===this.options.active_view)t.getCommand("treeview").begin();i.disable()}else i.enable()},_onRemoveRoot:function(e){var t=this,o=x.getPromises(),i=o.slice(),n=new Promise(function(o,n){Promise.all(i).then(function(i){e.pids.forEach(function(e){t.removeRootFromFilterProxy({rootId2remove:e})}),I.publish({event:"ENXModel/Root/remove",data:{pids:e.pids,noDispatch:!0}}),0===t.options.model.getRoots().length&&t.dispatchEvent("onEmptyView"),t.getOption("layout").store_roots_in_pref&&t.dispatchEvent("onDeleteRoots",{str_removeIds:JSON.stringify(e.pids),fromWLSync:e.fromWLSync}),t._checkGraphCmdAvailability(),o()})});return n.name="removeroot",o.push(n),!1},isToolbarActivated:function(){return!1},isDynamicCtx:function(){return this.options.configuration.dynamicCtxActivated},getDynamicCtxDef:function(){return new Promise(function(e){require(["text!"+this.options.configuration.ctxMenuOpts.definition],function(t){var o=JSON.parse(t);e(o.ctxMenu)})}.bind(this))},toggleVisibility:function(e,t,o,i){const n={isPADHidden:i};let s=e.getNodeFromPath(t);s||(s=e.getNodeByOccurencePath(t)),s&&(s.updateOptions(n),o=o.concat(s)),I.publish({event:"ENXModel/hideShowState",target:o,data:{toggle:i?"hide":"show"}}),I.publish({event:"ENXModel/HideShowTriggered",data:{name:i?"hide":"show"}})},onShow:function(e){const t=this;t._commandProxy.show(e);const o=t.options.model;let i=[];o.withTransactionUpdate(function(){for(let n of e.paths)t.toggleVisibility(o,n,i,!1)}.bind(o))},onHide:function(e){const t=this;t._commandProxy.hide(e);const o=t.options.model;let i=[];o._doNotBroadcastSelect=!0,o.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){o.withTransactionUpdate(function(){for(let n of e.paths)t.toggleVisibility(o,n,i,!0)})}}),o._doNotBroadcastSelect=!1},getNGFUXID:function(e){let t,o=require("DS/PADUtils/PADUtilsServices");return t=N.getSetting("activateWidgetLink")?F.getSourceWidgetId()&&e?F.getSourceWidgetId():o.getWidgetId():o.getSharedId()}})}),define("DS/ENXNav/utils/xNavCmdsMap",["DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADContext","DS/WebappsUtils/WebappsUtils","DS/ENXNav/utils/CtxMenuUtilsV2","DS/ApplicationFrame/CommandFactory","DS/ApplicationFrame/CommandsManager","DS/CoreEvents/Events","DS/PADServices/settings/AppSettings"],function(e,t,o,i,n,s,r,a){"use strict";function l(e){return this.options={context:null,toolbarActivated:!1,cmdsDefinition:null,commandMap:null,subscriptionWUX:[]},this.options=Object.assign(this.options,e),!0===this.options.toolbarActivated&&t.set(this.options.context),this}l.prototype.destroy=function(){this.options.subscriptionWUX.forEach(function(e){r.unsubscribe(e)})},l.prototype.initialize=function(e){var t=this;return new Promise(function(e,o){null!==t.options.cmdsDefinition&&t.options.cmdsDefinition.definition||o("Invalid input parameters"),require(["text!"+t.options.cmdsDefinition.definition],function(o){t.options.commandMap=new Map,t.options.cmdsJSON=JSON.parse(o),t.options.version=t.options.cmdsJSON.version,t._createCommands(t.options.cmdsJSON.commands).then(function(){t.options.subscriptionWUX.push(r.subscribe({event:d+"/ENABLE"},t._enableCommand.bind(t))),t.options.subscriptionWUX.push(r.subscribe({event:d+"/DISABLE"},t._disableCommand.bind(t))),e()})})})},l.prototype.getMap=function(){return this.options.commandMap},l.prototype._createCommands=function(e){var t=this;return new Promise(function(r){var d=[];Array.isArray(e)&&d.push(new Promise(function(i){for(var r=[],d=0;d<e.length;d++)r.push(new Promise(function(i){var r=this;"string"==typeof r.activationSetting&&!0!==a.getSetting(r.activationSetting)&&(r.deactivated=!0),(r.afr&&r.afr.AMD&&!0!==r.deactivated?new Promise(function(o){require([r.afr.AMD],function(e){if(e){var i=r.afr.args?r.afr.args:{};switch(r.afr.behavior){case"CATCommandHeader":var a=s.getCommand(r.id);a?r.isEnabled=a.isEnabled():n._createCommand(e,{context:null,ID:r.id,isEnabled:"boolean"!=typeof r.isEnabled||r.isEnabled,arguments:i});break;case"CATAfrHeaderCheck":var l=s.getCommandCheckHeader(r.id);l?r.isEnabled=l.isEnabled():l=n._createCommandCheckHeader(e,{context:null,ID:r.id,isEnabled:"boolean"!=typeof r.isEnabled||r.isEnabled,arguments:i}),l.onStateChange(function(){var e=t.options.commandMap.get(this._id);t._updateCheckHdr(this,e)})}}o()},function(e){console.warn("Cannot load ["+this.afr.behavior+"] of the command ["+this.id+"] with the AMD ["+this.afr.AMD+"]"),console.groupCollapsed("load failed with following error:"+e.message),console.log(e.stack),console.groupEnd(),o()}.bind(e[d]))}.bind(e[d])):Promise.resolve()).then(function(){r.icon&&r.icon.module&&r.icon.path&&(r.icon=o.getWebappsAssetUrl(r.icon.module,r.icon.path)),(r.HelpResourceFile&&!0!==r.deactivated?new Promise(function(e){r.HelpResourceFile.length?l.retrieveHlpRsc(r.HelpResourceFile).then(function(t){t&&(r.label=t[r.id+".Title"],r.unchecked&&r.unchecked.idNLS&&(r.labelUnchecked=t[r.unchecked.idNLS+".Title"]),r.checked&&r.unchecked.idNLS&&(r.labelChecked=t[r.checked.idNLS+".Title"]),r.tooltip={rscId:r.id,HelpResourceFile:r.HelpResourceFile}),e()}):e()}):Promise.resolve()).then(function(){if(!0!==r.noUXAvailable){var e=t.options.commandMap.get(r.id);e||(e={isEnabled:!0}),e=UWA.extend(e,r,!0),t.options.commandMap.set(r.id,e)}i()})}.bind(e[d]))}.bind(e[d])));Promise.all(r).then(i)})),d.push(i.initializeCmdMap({context:t.options.context,commandMap:t.options.commandMap})),Promise.all(d).then(r)})},l.prototype._updateCheckHdr=function(e){if(e.checked&&e.unchecked){var t=s.getCommandCheckHeader(e.id);t&&(!0===t.getState()?(e.checked.icon&&(e.icon=UWA.clone(e.checked.icon,!0)),e.state="selected",e.labelChecked&&(e.label=UWA.clone(e.labelChecked))):(e.unchecked.icon&&(e.icon=UWA.clone(e.unchecked.icon,!0)),e.state="",e.labelUnchecked&&(e.label=UWA.clone(e.labelUnchecked))))}},l.prototype._enableCommand=function(t){var o=t.getId(),i=this.options.commandMap.get(o);i&&!1===i.isEnabled&&(i.isEnabled=!0,this.options.commandMap.set(o,i),e.publish({event:"ENXCmds/Update",data:o}))},l.prototype._disableCommand=function(t){var o=t.getId(),i=this.options.commandMap.get(o);i&&!0===i.isEnabled&&(i.isEnabled=!1,this.options.commandMap.set(o,i),e.publish({event:"ENXCmds/Update",data:o}))};var d="/WUX/AFR/CMD/";return l.retrieveHlpRsc=function(e){return new Promise(function(t){var o=e.split("/"),i="i18n!"+o[0],n=o.splice(1,1);i+="/assets/help/"+n.join("/"),require([i],t,()=>{console.error("Cannot load "+i),t()})})},l}),define("DS/ENXNav/commands/HideIn3DCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/ENOXInterWdgCom/LinkManager","DS/ENXNav/utils/xNavCmdsMap"],function(e,t,o,i,n){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{atleastonevisible:!0});let o=function(){let e=i.getLinked(),t=!0;if(e.length>0)for(let o=0;o<e.length;o++){e[o].matchLinkability().matchingFeatures.includes("ENXContentSync2D")&&(t=!1)}t?this.disable():this.enable()}.bind(this);i.addEventListener("link",o),i.addEventListener("unlink",o)},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes(),t=[];e.length>=1&&e.forEach(function(e){t.push(e.getOccurencePath())}),o.get().onHide({paths:t})}})}),define("DS/ENXNav/models/NodeUtils",["DS/PADServices/utils/Iterator","DS/ENXNav/models/SmartNodeOptions","DS/PADServices/utils/HideShowController","DS/PADServices/utils/Generics","DS/ENOXParser/modules/common/Constants"],function(e,t,o,i,n){function s(e,t){t.doUpdate&&e.push(t)}function r(a,l,d,c){d.isHiddenStateFrom!==o.FROMS.PGP&&(d.isHiddenState=o.STATES.SHOWN,d.isPADHidden=!1);let p=!1;c||(p=!0,c=[]);let u=d;if(p&&u.grid){let e=Object.keys(u.grid).filter(e=>e.includes("-Instance"));if(e.length){u=i.clone(d);for(let t=0;t<e.length;t++)delete u.grid[e[t]]}}let h=new t(l),g=l.options;if(g.grid&&g.grid["positionMatrix-Instance"]&&u.grid&&!u.grid["positionMatrix-Instance"]&&(u.grid["positionMatrix-Instance"]=null),h.update(u),s(c,h),d.children){let o=[];d.children.length>1&&d.children.sort(function(e,t){return e.relationOrder>t.relationOrder?1:e.relationOrder<t.relationOrder?-1:0}),e.iterate(d.children,function(i){var d=l.getChildNodesByRelId(i.relationid);d.length?function(o,i,n,a,l,d,c){e.iterate(i,function(e){if(e){let i=new t(e);i.update(o),s(c,i),r(a,e,o,c),n.push(e)}})}(i,d,o,a,0,0,c):function(e,t,o,i,s,a){e.children||(e.children=[],e.expandState=n.NODE_STATES.COLLAPSED.state);let l=i.addChild(e);r(o,l,e,a),t.push(l)}(i,o,a,l,0,c)});var f=l.getChildren();let i=[];f&&(i=f.filter(function(e){return-1===o.indexOf(e)})),e.iterate(i,function(e){l.removeChild(e)})}else l.hasChildren()&&l.removeChildren(!1);p&&a.withTransactionUpdate(()=>{a.withTransactionUpdate(()=>{e.iterate(c,function(e){e.execute()})})}),l.getExcludedOccurrences().length>0&&l.cleanUpPathes()}return{calculateRefresh:function(e){let t=-1;return e.processDescendants({processNode:function(){let e=this.getDepth();e>t&&(t=e)}}),t},setStateAndPad:function(e,t){e.setState(t),e.options.padgrid.state=t.state},refreshForRoot:function(e,o){let i=new t(e);i.update(o),i.execute()},recursiveUpdateForRefresh:r}}),define("DS/ENXNav/models/mixins/TreeDocPopulate",["i18n!DS/PADServices/assets/nls/PADServices","i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PromiseHook","DS/PADServices/utils/PromiseCompletion","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/PADServices/utils/Generics","DS/PADServices/utils/Batches","DS/PADServices/utils/private/TreeDocUpdate","DS/ENOXParser/modules/common/Constants","DS/PADUtils/utilsWS/CVServletServices","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/Utility","DS/PADUtils/PADSettingsMgt","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSession","DS/Selection/HSOManager","DS/ENOXInterWdgCom/LinkManager","DS/PADServices/utils/PADTrackerManager","DS/PADServices/utils/PConfigUtils","DS/Utilities/UUID"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f,v,m,D,b,S,_,x,y,C,N,P,A){"use strict";const w="rgba(255, 255, 255, 0.3)",I=/ResponseCode with value \"(\d+)\"/g;function E(e,t){this._completion=new a({before:function(){e._parseLoadModel=!0},after:function(){e._parseLoadModel=!1},promise:t})}function O(e){if(e.options.childComputed){var t=e.getChildren();if(t&&1===t.length)return t[0].options.globaltype===v.GLOBALTYPE_DOC}}function M(e,t,i,s){let r=e&&e.message||"";if(r.includes("NetworkError:")){let e=I.exec(r);if(e){let r=parseInt(e[1]);if(r>=300&&r<=400){let e=t.map(function(e){return i.searchRootById(e)});!function(e,t,i){for(let e=0;e<t.length;e++)t[e].remove();let s={detach:{deleted:t.map(e=>e.getID())}};e._cmdProxy.padRefresh(s);let r=o.cannot_insert_branch;i&&(r=o.cannot_access_after_changeowner),n.displayNotif({message:r,level:"error",key:"xNavDoc-refresh-removeRoots"}),e.isEditor()&&e._triggerTitleUpdate()}(i,e,s)}}}}function F(e,t,o,i){e.isRoot()&&e.options.filtered;return function e(t,o,i,n){if(-1===o||i<o){if(t.options.childComputed||!0===t.isGroupingNode){if(t.hasChildren()){for(var s=t.getChildren(),r=!0,a=0;a<s.length&&!0===r;a++){var l=s[a];if(!(l.options.childComputed&&n&&O(l))&&(l.options.childComputed&&"noExpandState"!==l._expandState&&(l.getDepth()<o||-1===o)?l.getState()!==v.NODE_STATES.EXPANDED.state&&l.setState(v.NODE_STATES.EXPANDED):!0===l.isGroupingNode&&(l.setState(v.NODE_STATES.EXPANDED),-1!==o&&o++),l.options.childComputed&&"noChildren"===l.options.padstate&&!l.hasChildren()&&l.setState(v.NODE_STATES.NOCHILDREN),void 0===(r=e(l,o,i+1,n))))throw new Error("Undefined no_expand_needed flag")}return r}return!0}return!(!t.options.type||"Document"!==t.options.type)||!(-1===o||o>i)}return!0}(e,t,o,i)}function R(e,t){let o=e.indexOf(t);-1!==o&&e.splice(o,1)}function T(e,t,o,i,n,s){return new Promise(function(r,a){var l=[];let d=[],c=o.predicate+"-Instance",p=!0===S.getSetting("synthesisModeOnInstance"),u=!1===s.getConfig("readOnlyApp");e.withTransactionUpdate(function(){for(var n=0;n<t.length;n++){var s=t[n];if(!0!==s.isGroupingNode){var r;if(null!==(r=s.getPLMValue(o.predicate))){var a={color:h=b.getBIColor(i,o,r),isBeingCut:!1,grid:{bi_color:h}};s.ghostMode=!1,h===w&&(delete s.options.color,s.ghostMode=!0,a.isBeingCut=!0),s.updateOptions(a),e.options.shouldBeSelected(s),d.push(s)}else if(u)l.push(s.getID());else{a={color:w,grid:{bi_color:w}};s.updateOptions(a),e.options.shouldBeSelected(s)}if(p)if(!1===s.isRoot())if(null!==(r=s.getPLMValue(c))){var h;a={colorInstance:h=b.getBIColor(i,o,r)};s.updateOptions(a),R(l,s.getID())}else if(u)-1===d.indexOf(s)&&l.push(s.getID());else{a={colorInstance:w};s.updateOptions(a)}if(s.options.color===w&&s.options.colorInstance===w){a={isBeingCut:!0,grid:{bi_color:w}};delete s.options.color,delete s.options.colorInstance,s.ghostMode=!0,s.updateOptions(a)}}}}),0===l.length?(!0===e.fromTransactionEnd&&delete e.fromTransactionEnd,!0===n&&e._colorize3D(e),r()):e.updateNodesAttrValue(l,[o.predicate],function(t){e.withTransactionUpdate(function(){for(var t=0;t<l.length;t++){var n=e.getNodesById(l[t]);if(n.length>0){var s=n[0].getPLMValue(o.predicate);if(null!==s)for(var r=b.getBIColor(i,o,s),a={color:r,isBeingCut:!1,grid:{bi_color:r}},d=0;d<n.length;d++)n[d].ghostMode=!1,r===w&&(delete n[d].options.color,n[d].ghostMode=!0,a.isBeingCut=!0),n[d].updateOptions(a),e.options.shouldBeSelected(n[d]);else for(a={grid:{bi_color:w}},d=0;d<n.length;d++)delete n[d].options.color,a.isBeingCut=!0,n[d].ghostMode=!0,n[d].updateOptions(a),e.options.shouldBeSelected(n[d])}}}),!0===n&&e._colorize3D(e),r()})})}var k;function U(){if(k)return k;{let e=require("DS/PADUtils/PADContext");return k=e.get()}}function B(){let e=U();return!(!e||!e.colorMap)}function V(e){if(e.isRelationsObjectNode&&e.childComputed){if(e.options.childComputed=!0,e.hasChildren()){let t=e.getChildren();for(let e=0;e<t.length;e++){V(t[e])}}return!0}}function G(e,t){if(e.getDepth()<t){e.options.childComputed=!0;let o=e.getChildren();p.iterate(o,function(e){G(e,t)})}}function L(){}return L.prototype={processResponse:function(t,o,s,r,a,l,c){!0!==i.getSetting("authoringModeNotSupported")&&!1===x.isAuthoring()&&t.authoringMode&&!0===t.authoringMode&&x.setAuthoringState(!0,e.warnings.disablingIndexFromServer);const p="ENOSCEN_AP"===n.getAppId()?t.results:function(e,t){return e.length>1?e.map(e=>t.results.filter(t=>(function(e){let t;for(let o=0;o<e.length&&!t;o++){let i=e[o];"resourceid"===i.name&&(t=i.value)}return t})(t.attributes)===e)[0]):t.results}(s,t),u=d.parseFetch({results:p,treeDoc:o,nodeModelClass:o.options.nodeModelClass});o._pendingCompletion=new f(o,u),u.then(function(){if(!r&&a.callback&&a.callback.call(null,l),_.addRoot(),o.isGroupingApplied()){let e=[],t=[];for(let i=0;i<s.length;i++)if(-1===t.indexOf(s[i])){t.push(s[i]);let n=o.searchRootById(s[i]);n&&e.push(n)}o.__applyGrouping({roots:e,groups:o.options.groups})}c(l)})},add:function(t){let s=this;return new Promise(function(r,a){s._directSelection=!0;let l=[],d={alreadyLoadedRoots:[]};if(!0!==Array.isArray(t.pids)||0===t.pids.length){let t=e.replace(e.errors.wrongInputParameter,{functionCalled:"xNavTreeDoc.add",param:"pids"});throw n.displayNotif({level:"error",message:t,key:"xNavDoc-add-invalid-input"}),new Error(t)}t.pids.forEach(function(e){-1===l.indexOf(e)&&l.push(e)});let p=s.getRoots(),u=l.length;for(let e=0;e<p.length;e++){let t=l.indexOf(p[e].options.resourceid);-1!==t&&(l.splice(t,1),d.alreadyLoadedRoots.push(p[e].options.resourceid))}if(l.length===u||C.isWidgetSynchronizing()||n.displayNotif({message:e.infos.rootAlreadyLoaded}),l.length>0){let p=s._getAuthoringFlag();s._getFetchFunc(p)({data:{physicalid:l},autoAttSelection:!0}).then(async function(a){let u=c.data.jsonParse(a);s.invalidateViewPort();let h=!1;if(!u.results||u.results.length<l.length)if(u.results&&u.results.length>0&&!s.isEditor())s.processResponse(u,s,l,h,t,d,r);else if(!1===i.getSetting("enopad_webapis"))await n.getLastDataIndexTime().then(o=>{n.displayNotif({subtitle:e.errors.objectNotFoundInDB,message:e.replace(e.errors.lastIndexed,{lastIndexed:o}),level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&t.callback("error")});else if(p)await n.getLastDataIndexTime().then(o=>{n.displayNotif({subtitle:e.errors.objectNotFoundInDB,message:e.replace(e.errors.lastIndexed,{lastIndexed:o}),level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&(t.callback.call(null,d),r(d))});else if(u.infos&&u.infos.sources&&u.infos.sources.length>0&&u.infos.sources[0].error){let e=u.infos.sources[0],o=e.error.errorMessage||"An error has occurred in "+e.name;n.displayNotif({message:o,level:"error",key:"xNavDoc-add-error-in-response"}),!h&&t.callback&&t.callback.call(null,d)}else x.setAuthoringState(!0,o.PADSession_disabling_index_object_not_found),s.add(t),h=!0;else u.results.length>l.length?(n.displayNotif({message:e.errors.tooManyResults,level:"error",key:"xNavDoc-add-too-many-results"}),!h&&t.callback&&t.callback.call(null,d)):s.processResponse(u,s,l,h,t,d,r)}).catch(function(e){console.log(e),n.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-fetch-generic-error"}),t.callback&&t.callback("error"),a()})}else t.callback&&t.callback.call(null,d),r(d)})},addPaths:function(e){console.log("addPaths:"+JSON.stringify(e));let t=this,s={alreadyLoadedRoots:[]};var r,a;function l(i){for(var s=[],r=0;r<e.paths.length;r++){if(-1===s.indexOf(e.paths[r][0])){var a=t.searchRootById(e.paths[r][0]);UWA.is(a)&&!0===a.options.waiting4validation&&s.push(e.paths[r][0])}for(var l=0;l<e.paths[r].length;l+=2){var d=e.paths[r][l],c=t.getNodesById(d);UWA.is(c,"array")&&c.forEach(function(e){if(!0===e.options.waiting4validation){var t=e.getParent();if(e.remove(),t&&!t.hasChildren()&&"noChildren"!==t.getState()&&UWA.is(t.setState,"function"))try{t.setState({state:"collapsed"}),t.options.children=[]}catch(e){console.error(e)}}})}}if(i&&i.removedByFilter?n.displayNotif({message:o.cannot_insert_branch_filtered,eventID:"info",key:"xNavDoc-addPaths-cannot-add-branch-filtered"}):n.displayNotif({message:o.cannot_insert_branch,eventID:"error",key:"xNavDoc-addPaths-cannot-add-branch"}),e.callback){var p={};p.idleRootIds=s,p.success=!1,e.callback.call(t,p,"error")}}function p(){!0!==i.getSetting("authoringModeNotSupported")&&!1===t._getAuthoringFlag()?(x.setAuthoringState(!0,o.PADSession_disabling_index_object_not_found),t.addPaths(e)):l()}let u;this.isGroupingApplied()&&(r=!0,a=v.NODE_STATES.COLLAPSED),e.addedBranches&&(u=e.addedBranches),u||(u=d.buildTemporaryBranches({treeDoc:this,paths:e.paths,temporaryRoot:!0,nodeModelClass:this.options.nodeModelClass,forceCollapsed:r,state:a}),e.addedBranches=u),s.alreadyLoadedRoots=u.rootsAlreadyLoaded;let h=!1;if(s.alreadyLoadedRoots.length){let e=s.alreadyLoadedRoots.filter(function(e){return t.options.FBIProxy.HasFilter(e).hasFilter});h=e.length>0}let g={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy},m=t._getAuthoringFlag(),D=t._getExpandFunc(m)(g);t._pendingCompletion=new f(t,D),D.then(function(o){let i=c.data.jsonParse(o),n=i.results&&0===i.results.length;i.errors&&i.errors.length||n?n&&h?l({removedByFilter:!0}):p():d.addPathsUpdateTempNodes({treeDoc:t,FBIProxy:t.options.FBIProxy,wsResponse:i,nodeModelClass:t.options.nodeModelClass,idsToFetch:u.ids_to_fetch,expandLevel:0}).then(function(o){_.addRoot();for(let e=0;e<o.nodesId.length;e++){var i=t.getNodesById(o.nodesId[e])[0];i.isRoot()&&t.getModelEvents().publish({event:"onRootAdded",data:{nb_root:o.nodesId.length,added_node:i}})}if(e.callback){var n={success:!0};if(t.isGroupingApplied()){for(var r=[],a=[],l=e.paths,d=0;d<l.length;d++)if(-1===a.indexOf(l[d][0])){a.push(l[d][0]);var c=t.searchRootById(l[d][0]);c&&r.push(c)}t.__applyGrouping({roots:r,groups:t.options.groups,noGroupUpdate:!0}).then(()=>{e.callback(n,s)})}else e.callback(n,s)}})}).catch(function(e){p()})},onPreExpandChecker:function(e){if("true"===n.getURLParameter("deactivateFUN131056")){let t=!0;if(e.data.nodeModel.options.filtered)e.data.expandAll&&(e.data.numberOfLevelsToExpand="-1"),e.data.performingFilter=!0,e.data.expandAll=!0,t=!1;else if(!e.data.nodeModel.isRoot()&&function(e){return!e.isRelationsObjectNode}(e.data.nodeModel)){let t=e.data.nodeModel.getRoot();t&&t.options&&t.options.filtered&&(e.data.skpChildComputed=!0)}e.data.expandAll&&t&&(e.data.numberOfLevelsToExpand="-1")}else e.data.expandAll&&(e.data.numberOfLevelsToExpand="-1");var t=e.data,o=t.nodeModel,s=!!t.expandAll&&t.expandAll;if(this._parseLoadModel)e.target.preExpandDone({preventExpandAll:!1});else if(s&&!0===i.getSetting("activateSynthesisOnRoot")){var r=document.getElementsByClassName("enx-appMainBody");if(r&&1===r.length){r=r[0];var a=o.isRoot()?o:o.getRoot(),l=this;require(["DS/ENXNav/views/private/ExpandChecker"],function(t){t.check({targetDiv:r,roots:[a]}).then(function(t){!0===t.performExpandAll?l.onPreExpandCB(e):e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})})})}else this.onPreExpandCB(e)}else this.onPreExpandCB(e)},onPreExpandCB:function(t){let r=u.addOrGetSection("populate"),a=this,l=t.data,p=l.nodeModel,h=!!l.expandAll&&l.expandAll,g=l.performingFilter,m=!l.skpChildComputed&&!g||this.isGroupingApplied(),D=l.numberOfLevelsToExpand?l.numberOfLevelsToExpand.toString():i.getSetting("expand_iter");if(!0===p.isGroupingNode||void 0!==p.options.fakeNodesTable)return void t.target.preExpandDone();let b=p.options.filtered,S=!1;"partiallyExpanded"!==p.options.padstate||b||(S=!0),h&&(p._expandAllPending=!0,s.publish({event:"ENXNav/parser/expandAll/begin"}),this.isGroupingApplied()&&this.__expandAllGroups(p));let x=D;this.invalidateViewPort(),h&&(D="-1");var y=parseInt(D),C=-1===y||y>1;if(m&&(function(e){if(V(e),e.hasChildren()){let t=e.getChildren();for(let e=0;e<t.length;e++)V(t[e])}}(p),p.options.childComputed||p.isRoot()&&a.isGroupingApplied())){r.start("validateExistingTree",{stats:!0});var N=p.getDepth();if(p.isRoot()&&a.isGroupingApplied()||F(p,h?y:N+y,N,C))return t.target.preExpandDone({preventExpandAll:!0}),a._selectOccurence(),B()&&a._colorize3D(a),delete p._expandAllPending,h&&s.publish({event:"ENXNav/parser/expandAll/complete"}),void r.end("validateExistingTree");r.end("validateExistingTree")}let P=p,A=!1,w=0;p.isRoot()||(P=p.getRoot());let I=p.getOccurencePath();w=I.length-1;let O={pathIds:[I],data:{expandLevel:D},FBIProxy:this.options.FBIProxy,timeout:i.getSetting("webapi_timeout"),select_relation:["ro.plminstance.V_treeorder"]};A=i.getSetting("enopad_webapis"),a.prodConfigSupportInAuth&&(O.data.prodConfigSupportInAuth=a.prodConfigSupportInAuth);let M,R=a._getAuthoringFlag();R&&P.options.isReadOnly&&(R=!1),r.start("performExpand-"+y,{stats:!0}),r.start("progressiveExpand",{stats:!0});let T=a._getExpandFunc(R)(O);a._pendingCompletion=new f(a,T),T.then(function(i){r.end("progressiveExpand");var l=c.data.jsonParse(i);if(l.timeoutOccurs)throw l;if(l.results)if(0===l.results.length)b?n.displayNotif({message:o.find_in_context_no_result,eventID:"info"}):n.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-expand-generic-error"}),h&&s.publish({event:"ENXNav/parser/expandAll/complete"}),t.target.preExpandDone({preventExpandAll:!0,state:"collapsed"});else{a._parseLoadModel=!0,!0===S&&a._cmdProxy.padExpand({paths:[p.getOccurencePath()],expand_level:y});let e=d.parseExpandLoadModel({treeDoc:a,expandedNodes:[p],FBIProxy:a.options.FBIProxy,wsResponse:l,nodeModelClass:a.options.nodeModelClass,expandLevel:y,expandLevelRequest:parseInt(x),filter:P.options.filtered});new E(a,e);a._pendingCompletion=new f(a,e),e.then(function(e){!h&&y>1&&G(p,p.getDepth()+y),_.expand(),a._parseLoadModel=!1,p.options.childComputed=!0,t.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),s.publish({event:"ENXNav/parser/expandAll/complete"}),r.end("performExpand-"+y)}).catch(function(e){a._parseLoadModel=!1,M=e}).finally(function(){M&&M.parseTimeout&&(t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,s.publish({event:"ENXNav/parser/expandAll/complete"}),n.displayNotif({message:o.parseTimeout,eventID:"warning",key:"xNavDoc-expand-parse-timeout"})),a._selectOccurence()})}if(l.errors){let o=!1,i="",r="",a=[];for(let e=0;e<l.errors.length;e++)if("UNKNOWN_META"===l.errors[e].code)if(console.log("== UNKNOWN_META V2 Mgt"),o=!0,void 0!==l.errors[e].unknownmetas){a.concat(l.errors[e].unknownmetas);r=l.errors[e].unknownmetas}else{let t=l.errors[e].reason,o="com.exalead.expand.progressive.ProgressiveExpandException: [",n=t.indexOf(o)+o.length;i=t.substring(n,t.length-1),r=i,i=i.replace(/,\s+/g,","),a=a.concat(i.split(","))}!0===o?(s.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,p.setState({state:"collapsed"}),s.publish({event:"ENXNav/parser/expandAll/complete"});var o=require("DS/PADServices/utils/PlatformURL");n.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:r,envId:o.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),s.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:a}})):(t.target.preExpandDone({preventExpandAll:!1,state:v.NODE_STATES.COLLAPSED.state}),delete p._expandAllPending,p.setState(v.NODE_STATES.COLLAPSED),n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:p.getLabel(),expandLevel:"-1"===D?"all":D}),level:"error",key:"xNavDoc-expand-api-error"}))}}).catch(function(o){if(r.end("progressiveExpand"),o.timeoutOccurs)return t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,s.publish({event:"ENXNav/parser/expandAll/complete"}),void n.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-request-timeout"});t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,p.setState({state:"collapsed"}),s.publish({event:"ENXNav/parser/expandAll/complete"}),n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:p.getLabel(),expandLevel:"-1"===D?"all":D}),level:"error",key:"xNavDoc-expand-parse-error"}),r.end("performExpand-"+y)})},expandZeroForFilterRoots:function(e){let t=this,o=parseInt("0"),n=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest("expandV2");g.promStepper(e.filteredRoots,1,1,function(s,r){let a=s[0],p=a.getOccurencePath(),u=a.options.filtered,h={pathIds:[p],data:{expandLevel:"0",select_bo:n.select_object,select_rel:n.select_relation,compute_select_bo:n.select_file},FBIProxy:t.options.FBIProxy,timeout:i.getSetting("webapi_timeout")};var g=Promise.resolve();t.isGroupingApplied()&&(t.cleanGroupingForRoots({rootIds:e.filteredRoots.map(function(e){return e.getID()})}),g=t.__applyGrouping({roots:e.filteredRoots,groups:t.options.groups,fromApplyFilter:!0})),g.then(function(){l.expandv2(h).then(function(e){let i=c.data.jsonParse(e);if(i.results&&i.results.length){let e=d.parseExpandLoadModel({treeDoc:t,expandedNodes:[a],FBIProxy:t.options.FBIProxy,wsResponse:i,filter:u,expandLevel:o,expandLevelRequest:o});t._parseFlagMgr=new E(t,e),t._pendingCompletion=new f(that,e),e.then(function(e){a.options.childComputed=!1,t.options.groupingFilterInProgress=!1,r()}).catch(function(e){r()})}}).catch(function(e){r()})})},function(){s.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter",method:"expandZeroForFilterRoots"}})})()},updateSpecificColumnViews:function(e,t,o){c.node.updateSpecificColumnViews(e,t,o)},_selectFromTagger:function(e){var t=this,o=[];let n=v.NODE_STATES.EXPANDING;const a=function(e){e.setState({state:n})};e.doNotBroacast&&(t._doNotBroadcastSelect=!0,t._inBatchingForUpdate=!0),t.getXSO().empty(),y.empty();const c=function(e,t){s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestTimeout"}}),a(e),t()};g.promStepper(t.getRoots(),1,1,function(o,p){let u=o[0];n=u.getState(),u.setState(v.NODE_STATES.COLLAPSED);var h=D.createOutputsRequest();const g={rootPhID:u.getOccurencePath(),select_bo:h.select_object,select_rel:h.select_relation,compute_select_bo:h.select_file,max_count_path:i.getSetting("maxPathsForSearch"),boundingbox:!1,taggerSelect:e.eventData};l.selectFromTagger({data:g,FBIProxy:t.options.FBIProxy}).then(function(e,o,i){t.options.FBIProxy.setSelectStatus({status:!0});const n=UWA.is(i,"string")?JSON.parse(i):i;if(n.results&&n.results.length){t._parseLoadModel=!0;let i=d.parseExpandLoadModel({treeDoc:t,expandedNodes:[e],FBIProxy:t.options.FBIProxy,wsResponse:n,nodeModelClass:t.options.nodeModelClass,selectPaths:!0,selectFromTagger:!0,findInCtx:!1,isFindDialog:!1,mode:"noChildComputed"});t._pendingCompletion=new f(t,i),new r(i,t.boundClearFlag),i.then(function(){t._parseLoadModel=!1,e.setState({state:"partiallyExpanded"}),o()})}else n.timeoutOccurs?(t._parseLoadModel=!1,c(e,o)):(t._parseLoadModel=!1,a(e),o())}.bind(this,u,p),function(e,o){t.options.FBIProxy.setSelectStatus({status:!0}),s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestFailure"}}),a(e),o()}.bind(this,u,p))},function(){e.doNotBroacast&&(t._doNotBroadcastSelect=!1,t._inBatchingForUpdate=!1),(o=t.getXSO().get()).length>i.getSetting("maxPathsForSearch")?s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"tooManyResults"}}):0===o.length?s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"noResults"}}):s.publish({event:"ENXViews/Model/SelectFromTagger/Success",data:{nbSelected:o.length}})})()},_findInCtx:function(e){var n=this,a=function(){e.doNotBroacast&&(n._doNotBroadcastSelect=!0,n._inBatchingForUpdate=!0)},p=function(){e.doNotBroacast&&(n._doNotBroadcastSelect=!1,n._inBatchingForUpdate=!1)};let u=e.nodes.length>1,h=[],m=[];this.closePager(),require(["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Utility"],function(D,b,S){n._selection=[],n.searchProgress=!0,a(),n.prepareBroadcastSelect(),n.getXSO().empty(),p(),n._getAuthoringFlag()&&b.displayNotif({message:t.find_in_ctx_after_authoring,level:"warning",key:"xNavDoc-find-in-ctx-after-auth"});var _=D.createOutputsRequest();-1===_.select_object.indexOf("bo.plmentity.v_usage")&&_.select_object.push("bo.plmentity.v_usage"),g.promStepper(e.nodes,1,1,function(o,c){let g=o[0],D=g.getState(),S=function(){g.setState({state:D})};g.setState(v.NODE_STATES.EXPANDING);var x={FBIProxy:n.options.FBIProxy,data:{rootPhID:g.getOccurencePath(),select_bo:_.select_object,select_rel:_.select_relation,compute_select_bo:_.select_file,ftsString:e.searchFts,rscIdToSearch:e.rscId,max_count_path:i.getSetting("maxPathsForSearch")},iterativeFilter:e.iterativeFilter,filterRel:e.no_type_filter_rel};x.data.select_rel.push("ds6w:type"),l.findInCtxV2(x).then(function(e){var o="string"==typeof e?JSON.parse(e):e;if(o.results&&o.results.length){n._parseLoadModel=!0,a();let e=d.parseExpandLoadModel({treeDoc:n,expandedNodes:[g],FBIProxy:n.options.FBIProxy,wsResponse:o,nodeModelClass:n.options.nodeModelClass,selectPaths:!0,findInCtx:!0,isFindDialog:!0,mode:"noChildComputed"});n._pendingCompletion=new f(n,e);new r(e,n.boundClearFlag),new r(e,p);e.then(function(e){n._parseLoadModel=!1;var o=n.getXSO().get();o.length>i.getSetting("maxPathsForSearch")&&(o.pop(),b.displayNotif({message:t.replace(t.tooManyResultFound,{maxResult:i.getSetting("maxPathsForSearch")}),level:"warning",key:"FindInCtx-tooManyResult"}));let r=m.slice(),a=o.filter(function(e){return-1===r.indexOf(e)});m=m.concat(a),n._selection.length&&u&&(n._selection.length=0),a.forEach(function(e){n._selection.push(e.getOccurencePath())}),n.originalSelection=n._selection,h=h.concat(n._selection);g.setState({state:"partiallyExpanded"}),s.publish({event:"ENXModel/SyncModel",data:{what:"FindInCtx"}}),c()})}else n._parseLoadModel=!1,console.error("Find in Ctx failed - No Results"),S(),c()}).catch(function(e){n._parseLoadModel=!1,console.error("Find in Ctx failed"),S(),c()})},function(){e.doNotBroacast||n.pushBroadcastSelect();for(var t=[],i=0;i<h.length;i++){var r=n.getNodeByOccurencePath(h[i]);r&&t.push(r)}n._selection=h,0===n._selection.length?b.displayNotif({message:o.find_in_context_no_result,level:"info"}):(a(),n.unselectAll(),p()),c.node.clearChildComputed(n),!0!==e.noPager&&n._selection.length&&n.displayPager().then(function(){a(),n.reframeOn({idx:n._selectedIdx}),p()}),s.publish({event:"ENXViews/Model/FindInCtx/complete",data:{foundNodes:t}}),n.searchProgress=!1})()})},insertBranches:function(e,t){let o=this;var i={};let n={treeDoc:this,paths:e,temporaryRoot:!1,nodeModelClass:this.options.nodeModelClass};if(t.node_state&&(n.state=t.node_state),t.forceCollapsed&&(n.forceCollapsed=t.forceCollapsed),i=d.buildTemporaryBranches(n),!0===t.novalidation&&!0===t.forceCollapsed&&e.length>20&&!0!==S.getSetting("forcePathValidationOnSelect"))i.visibleNodesIds.length>0?this.refreshNodeById({modified:i.visibleNodesIds,relationids:i.visibleNodesRelIds,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:t.onComplete?t.onComplete:void 0}):i.ids_to_fetch.length?this.refreshNodeById({modified:i.ids_to_fetch,relationids:i.relationids,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:function(){let e=i.ids_to_fetch.map(function(){return o.getNodesById(rootId)}).concat(function(e,t){e=e.concat(t)},[]);p.iterate(e,function(e){e.getParent().setState(v.NODE_STATES.COLLAPSED)}),t.onComplete&&t.onComplete(!0)}}):t.onComplete&&t.onComplete.call(!0);else if(i.ids_to_fetch.length>0||i.relationids.length>0)if(i.ids_to_fetch.length>0||i.relationids.length>0){let o=this;this.addPaths({addedBranches:i,paths:e,callback:function(e,i){e.success&&(i&&i.alreadyLoadedRoots&&p.iterate(i.alreadyLoadedRoots,function(e){o.getNodesById(e)}),t.onComplete&&t.onComplete())}})}else t.onComplete&&t.onComplete.call(!0);else i.ids_to_fetch.length>0?this.refreshNodeById({modified:i.ids_to_fetch,relationids:i.relationids,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:t.onComplete?t.onComplete:void 0}):t.onComplete&&t.onComplete.call(!0)},updateColorForNodes:function(e,t,o){var i=require("DS/PADUtils/Configuration");let n=this;var s=e.length<1e3?100:200;T(n,e,t,o,!0,i).then(function(){setTimeout(function(){let s=n.getAllDescendants();(function(e,t){let o=e.length,i=t.length,n=!1;if(o===i){let o=!1;for(let n=0;n<i;n++){let i=t[n];if(-1===e.indexOf(i)){o=!0;break}}return o||(n=!0),n}return!1})(e,s)||T(n,n.getAllDescendants(),t,o,!0,i)},s)})},_colorChildren:function(e,t,o,i,n){var s=this;e.getChildren().forEach(function(e){if(t.push(e.options.resourceid),t.push(e.options.relationid),o.push({color:e.options.color?e.options.color:w,pid:e.options.resourceid,ghostMode:e.ghostMode,metaType:"reference"}),o.push({color:e.options.colorInstance?e.options.colorInstance:w,pid:e.options.relationid,ghostMode:e.ghostMode,metaType:"instance"}),"collapseState"==e._expandState||"partiallyExpandedState"==e._expandState)if(e.hasChildren())s._colorChildren(e,t,o,i,n);else{var r=e.getOccurencePath(e.options.resourceid);i.push(r.map(function(e){return t.indexOf(e)}))}else{var a=e.getOccurencePath(e.options.resourceid);i.push(a.map(function(e){return t.indexOf(e)}))}})},_checkColorize3D:function(){B()&&this._colorize3D(this)},_colorize3D:function(e){if(!0!==this._collapseRepDuringExpandAll){let t=this,o=[],i={},n=[],s=[];t.getRoots().forEach(function(i){if(i.options.color||(i.options.color=w),i.options.color)if(o.push(i.options.resourceid),s.push({color:i.options.color?i.options.color:w,pid:i.options.resourceid,ghostMode:i.ghostMode}),"collapseState"==i._expandState||"partiallyExpandedState"==i._expandState)if(null!==i.getChildren()&&i.getChildren().length>0)t._colorChildren(i,o,s,n,e);else{var r=i.getOccurencePath(i.options.resourceid);n.push(r.map(function(e){return o.indexOf(e)}))}else{var a=i.getOccurencePath(i.options.resourceid);n.push(a.map(function(e){return o.indexOf(e)}))}}),i={nodes:s,path:n},void 0!==t._cmdProxy&&0!==i.nodes.length&&t._cmdProxy.padFilterBI({filterBIColorize:i})}},refreshNodeById:function(e){var t=[],o=this,i=[],n=[],r=[],a=[];if(UWA.is(e.created)&&(t=t.concat(e.created)),UWA.is(e.modified)&&UWA.is(e.modified,"array")&&this.withTransactionUpdate(function(){let s=D.getAvailableColumns(),l=!(!s.includes("ds6w:reserved-Instance")&&!s.includes("ds6w:reservedBy-Instance"));e.modified.forEach(function(e){if(h.checks.object(e)){var d=e.physicalid;if(h.checks.array(e.attributes)){var c=o.getNodesById(d);0===c.length&&l&&(c=o.getNodesByRelId(d),e.attributes.forEach(function(e){"ds6w:reserved"===e.name&&(e.name="ds6w:reserved-Instance"),"ds6w:reservedBy"===e.name&&(e.name="ds6w:reservedBy-Instance")})),c.forEach(function(t){t.updateAttributes(e.attributes,s),t._manageNLS=!0,!0})}else{if(-1===t.indexOf(d))(p=o.getNodesById(d))&&p.length>0&&(t.push(d),i.push(d));"ownerChanged"===e.key&&n.push(d)}}else{var p,u;if(-1===t.indexOf(e))if((p=o.getNodesById(e))&&p.length>0)t.push(e),i.push(e);else(p=o.getNodesByRelId(e)).length>0&&p.forEach(function(e){a.push(e),(u=e.options.relationid)&&r.push(u)})}})}),t.length>0){S.getWebAPI_Options("fetch").include_param_Attributes=!1;let r=function(){return t.filter(function(e){let t=o.getNodesById(e);return!(1!==t.length||!t[0].isRoot())})},a=r();e.relationids&&e.relationids.length>0&&(t=t.concat(e.relationids));o._getFetchFunc(o._getAuthoringFlag())({data:{physicalid:t},autoAttSelection:!0}).then(function(n){let l=c.data.jsonParse(n);var p=[];for(var u of l.results)if(u.attributes.find(e=>"#DENIED!"===e.value)){let e=u.attributes.find(e=>"resourceid"===e.name).value;o.removeRoot(o.getNodesById(e)[0]),p.push(e)}p.length&&s.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:p}}),c.array.compare(t,i)?d.parseMultiFetch({results:l.results,treeDoc:o,FBIProxy:o.options.FBIProxy}):d.refreshNodes({wsResponse:l,treeDoc:o,refreshParameters:e,FBIProxy:o.options.FBIProxy}).then(function(){if(e.created&&e.created.length&&(a=r()),!e.skipDrop&&a.length){var t={pids:a,already_added_in_PS:!0};o._commandProxy.drop(t)}for(var i=[],n=0;n<a.length;n++){var s=o.getNodesById(a[n]);s.length&&i.push(s[0])}var l=i.map(function(e){return e.getOccurencePath()});e.onAddPaths&&e.onAddPaths(l)})}).catch(function(e){let i=n.length>0;M(e,t,o,i)})}else if(r.length>0){var p={lIds:r,attributes:"true"},u={},g={};l.read({data:p}).then(function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;t.results&&(t.results.forEach(function(e){var t=e.physicalID,o={instanceName:[],instanceDesc:[],modified:[]};e.data.forEach(function(e){e.path&&"PLMInstance.PLM_ExternalID"===e.path?o.instanceName=e.value:e.path&&"PLMInstance.V_description"===e.path?o.instanceDesc=e.value:e.path&&!e.path.includes("PLMInstance")&&(o["ds6wg:"+e.path+"-Instance"]=e.value,g["ds6wg:"+e.path+"-Instance"]=e.value)}),e.basicData.forEach(function(e){"modified"===e.name&&(o.modified=e.value)}),u[t]=o}),a&&a.length>0&&o.wrapInTransaction(function(){a.forEach(function(e){var t={grid:{}};for(var o in t.grid["ds6w:modified"]=u[e.options.relationid].modified[0],u[e.options.relationid].instanceName&&u[e.options.relationid].instanceName[0]?t.grid["ds6w:label-Instance"]=u[e.options.relationid].instanceName[0]:t.grid["ds6w:label-Instance"]="",Array.isArray(u[e.options.relationid].instanceDesc)?t.grid["ds6w:description-Instance"]=u[e.options.relationid].instanceDesc[0]:t.grid["ds6w:description-Instance"]="",g)u[e.options.relationid]&&(t.grid[o]=h.checks.array(u[e.options.relationid][o])?u[e.options.relationid][o][0]:u[e.options.relationid][o]);e.updateOptions(t)})}))}).catch(function(e){console.error("failure with error",e)})}},refresh:function(e){let o=A.v4();window.top.performance.mark("app_refresh_start-"+o),s.publish({event:"ENXModel/refresh/begin"});var r=function(){_.refresh(),window.top.performance.mark("app_refresh_end-"+this);var e=N.getPADTracker({eventCategory:"performance",eventAction:"refresh"});if(e){window.top.performance.measure("app_refresh_measure-"+this,"app_refresh_start-"+this,"app_refresh_end-"+this);var t=window.top.performance.getEntriesByName("app_refresh_measure-"+this),o=t.length>0?t[t.length-1].duration:void 0,i=t.length>0?t[t.length-1].startTime:void 0;e.addMultivaluedEventData("2d_app_refresh",{call_refresh_start:i,call_refresh_duration:o}),e.trackPageEvent()}s.publish({event:"ENXModel/refresh/complete"})}.bind(o);let a=e&&e.roots,l=this;if(a.forEach(function(e){l.prodConfigSupportInAuth&&!0===S.getSetting("keepFilterAuthoring")?l.prodConfigSupportInAuth&&e.validFilter&&!e.keepFilterBadge&&(e.keepFilterBadge=!0):e.validFilter&&e.keepFilterBadge&&(e.keepFilterBadge=!1)}),a||(a=this.getRoots()),0!==a.length){var p=a.map(function(e){return e.getOccurencePath()}),u=function(e){let t=-1;return e.processDescendants({processNode:function(){let e=this.getDepth();e>t&&(t=e)}}),t}(this);if(this.unselectAll(),0===u){let o=a.map(function(e){return e.getID()}),i=this._getAuthoringFlag();i&&e.hasOwnProperty("isReadOnlyRoot")&&e.isReadOnlyRoot&&(i=!1);let s=this._getFetchFunc(i),l=this;s({data:{physicalid:o},autoAttSelection:!0}).then(function(e){let o=c.data.jsonParse(e);d.refreshFetch({wsResponse:o,roots:a,treeDoc:l,FBIProxy:l.options.FBIProxy}).then(()=>{let e=l.options.context,o=l._getAuthoringFlag()&&void 0!==e&&void 0!==e.options&&e.options.isDeEnabled&&e.hasActiveDesignExp()?t.refresh_wip_only:t.refresh_ok;n.displayNotif({message:o}),r()})}).catch(function(e){n.displayNotif({message:t.refresh_failure,level:"error",key:"xNavDoc-refresh-error"}),r()})}else{let o={pathIds:p,data:{expandLevel:u},FBIProxy:this.options.FBIProxy,timeout:i.getSetting("webapi_timeout")},s=this._getAuthoringFlag();s&&e.hasOwnProperty("isReadOnlyRoot")&&e.isReadOnlyRoot&&(s=!1);let l=this._getExpandFunc(s);s&&(o.data.expandLevel=""+u);let h=this;h.prodConfigSupportInAuth&&(o.data.prodConfigSupportInAuth=h.prodConfigSupportInAuth),l(o).then(function(e){let o=c.data.jsonParse(e);o.results&&o.results.length?d.refresh({roots:a,treeDoc:h,FBIProxy:h.options.FBIProxy,wsResponse:o,expandLevel:-1}).then(function(){h.isGroupingApplied()&&h.__applyGrouping({roots:a,groups:h.options.groups});let e=h.options.context,o=h._getAuthoringFlag()&&void 0!==e&&void 0!==e.options&&e.options.isDeEnabled&&e.hasActiveDesignExp()?t.refresh_wip_only:t.refresh_ok;n.displayNotif({message:o}),r()}):r()}).catch(function(e){n.displayNotif({message:t.refresh_failure,eventID:"error",key:"xNavDoc-refresh-error"}),r()})}}else r()},updatePaths:function(e){let t=this;return new Promise(function(o,i){let n={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:t.options.FBIProxy},s=t._getAuthoringFlag();t._getExpandFunc(s)(n).then(function(n){let s=c.data.jsonParse(n),r=s.results&&0===s.results.length;if(s.errors&&s.errors.length||r)i();else{let i=new Set;for(let t=0;t<e.paths.length;t++){let o=e.paths[t].filter(function(e,t){return t%2==0});for(let e=0;e<o.length;e++)i.add(o[e])}e.idsToFetch=Array.from(i);let n=d.addPathsUpdateTempNodes({treeDoc:t,FBIProxy:t.options.FBIProxy,wsResponse:s,idsToFetch:e.idsToFetch,expandLevel:0}).then(function(i){if(t.isGroupingApplied()){for(var n=[],s=[],r=e.paths,a=0;a<r.length;a++)if(-1===s.indexOf(r[a][0])){s.push(r[a][0]);var l=t.searchRootById(r[a][0]);l&&n.push(l)}t.__applyGrouping({roots:n,groups:t.options.groups,noGroupUpdate:!0}).then(()=>{o()})}else o()});t._pendingCompletion=new f(t,n)}}).catch(function(e){i(e)})})},updateNodesAttrValue:function(e,t,o){let n=this;for(var s=require("DS/PADServices/utils/AttributesMgtV2"),r=0;r<t.length;r++)s.addBIColumn(t[r],i.getSetting("synthesisModeOnInstance"));var a=t.slice();-1===a.indexOf("ds6w:globaltype")&&a.push("ds6w:globaltype");var l={select_predicate:a,select_file:[],timeout:i.getSetting("webapi_timeout")},c=[];if(e.length>=1e3){var p=Math.trunc(e.length/1e3);e.length%1e3>0&&p++;for(var u=0;u<p;u++)c.push(e.splice(0,e.length>=1e3?1e3:e.length))}else c.push(e);var h;(h=c,h.reduce((e,t)=>e.then(()=>(function(e){return new Promise(function(t,o){l.physicalid=e,n._getFetchFunc(n._getAuthoringFlag())({data:l,enopad_webapis:!1,pids:e,noCompletion:!0}).then(function(o){var i=UWA.is(o,"string")?JSON.parse(o):o;i.results?d.parseMultiFetch({treeDoc:n,results:i.results,refresh_parameters:{modified:e}}).then(function(){t()}):t()}).catch(function(e){console.error(e),o()})})})(t)),Promise.resolve())).then(()=>{o&&o({allNodesProcessed:!0})})},isAuthoredNode:function(e){return 0==e.getRoot().options.isReadOnly},isIndexedNode:function(e){return 1==e.getRoot().options.isReadOnly},expandMultiSelect_og:function(t){var a=!!t.expandAll&&t.expandAll,l=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():i.getSetting("expand_iter"),u=(i.getSetting("enopad_webapis"),!0===i.getSetting("alwaysExpandPath")||isNGFilter||i.getSetting("pgpFromServer"));a&&(l="-1");for(var h=parseInt(l),g=-1===h||h>1,m=[],D=0;D<t.nodes2Expand.length;D++){var b=t.nodes2Expand[D];if(b.isRoot()){let e=!0;for(var S=1;S<t.nodes2Expand.length;S++)t.nodes2Expand[S].isGroupingNode||(e=!1);e&&(b.options.childComputed=!0)}if(b.options.childComputed){var _=b.getDepth();F(b,a?parseInt(l):_+parseInt(l),_,g)?b.setState(v.NODE_STATES.EXPANDED):m.push(b)}else m.push(b)}var x=this;if(0===m.length)x.prepareUpdate(),B()&&x._colorize3D(x),x.forceSyncModel4TreeListView(),x.pushUpdate(),t.callback&&t.callback();else{var y=0,C=[],N=[],P=[],A=[],w=[];this.withTransactionUpdate(function(){p.iterate(m,function(e){e.setState(v.NODE_STATES.EXPANDING);var t=e;if(t.isRoot()||(t=t.getRoot()),u){var o=e.getOccurencePath();t&&-1===P.indexOf(t.getID())&&(P.push(t.getID()),N.push(t)),y=Math.max(o.length-1,y),C.push(o)}else C.push([e.getID()]),-1===P.indexOf(e.getID())&&(P.push(e.getID()),N.push(e));x.isAuthoredNode(e)?A.push(o):x.isIndexedNode(e)&&w.push(o)})});let i=x._getAuthoringFlag();new Map;let a=[];A.length>0&&a.push({path:A,isReadOnly:!0}),w.length>0&&a.push({path:w,isReadOnly:!1});for(let t=0;t<a.length;t++){let s=a[t];x._getAuthoringFlag()&&(C=s.path,i=s.isReadOnly);let u=x._getExpandFunc(i);var I=[];I.push(new Promise(function(t,i){let s={pathIds:C,data:{expandLevel:l},FBIProxy:x.options.FBIProxy,timeout:3e4};x.prodConfigSupportInAuth&&(s.data.prodConfigSupportInAuth=x.prodConfigSupportInAuth),u(s).then(function(e){var s=c.data.jsonParse(e);if(s.timeoutOccurs)throw s;if(0===s.results.length)n.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-expand-multi-select-generic-error"}),p.iterate(m,function(e){e.setState(v.NODE_STATES.NOCHILDREN)}),i();else{x._parseLoadModel=!0;let e=d.parseExpandLoadModel({treeDoc:x,expandedNodes:m,FBIProxy:x.options.FBIProxy,wsResponse:s,nodeModelClass:x.options.nodeModelClass,expandLevel:h});new f(x,e),new r(e,x.boundClearFlag);e.then(function(e){p.iterate(m,function(e){e.options.childComputed=!0,e.setState(v.NODE_STATES.EXPANDED)}),t()})}}).catch(function(o){o.timeoutOccurs&&n.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-multi-select-request-timeout"}),x.withTransactionUpdate(function(){p.iterate(m,function(t){n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t.getLabel(),expandLevel:"-1"===l?"all":l}),level:"error",key:"xNavDoc-expand-multi-select-parse-error"}),t.setState(v.NODE_STATES.COLLAPSED)})}),t()})}))}var E=Promise.allSettled(I);t.callback&&E.then(t.callback);new f(x,E);E.then(function(){s.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}})})}},expandMultiSelect:function(t){var a=!!t.expandAll&&t.expandAll,l=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():i.getSetting("expand_iter"),u=(i.getSetting("enopad_webapis"),!0===i.getSetting("alwaysExpandPath")||isNGFilter||i.getSetting("pgpFromServer"));a&&(l="-1");for(var h=parseInt(l),g=-1===h||h>1,m=[],D=0;D<t.nodes2Expand.length;D++){var b=t.nodes2Expand[D];if(b.isRoot()){let e=!0;for(var S=1;S<t.nodes2Expand.length;S++)t.nodes2Expand[S].isGroupingNode||(e=!1);e&&(b.options.childComputed=!0)}if(b.options.childComputed){var _=b.getDepth();F(b,a?parseInt(l):_+parseInt(l),_,g)?b.setState(v.NODE_STATES.EXPANDED):m.push(b)}else m.push(b)}var x=this;if(0===m.length)x.prepareUpdate(),B()&&x._colorize3D(x),x.forceSyncModel4TreeListView(),x.pushUpdate(),t.callback&&t.callback();else{var y=0,C=[],N=[],A=[],w=[],I=[],E=[];x=this;const i=P.isMultiRootSupported();this.withTransactionUpdate(function(){p.iterate(m,function(e){e.setState(v.NODE_STATES.EXPANDING);var t=e;t.isRoot()||(t=t.getRoot());var o=e.validFilter;if(u){var n=e.getOccurencePath();t&&-1===A.indexOf(t.getID())&&(A.push(t.getID()),N.push(t)),y=Math.max(n.length-1,y),C.push(n)}else C.push([e.getID()]),-1===A.indexOf(e.getID())&&(A.push(e.getID()),N.push(e));o?i&&E.push(n):x.isAuthoredNode(e)?w.push(n):x.isIndexedNode(e)&&I.push(n)})});let a=x._getAuthoringFlag();new Map;let g=[];if(w.length>0&&g.push({path:w,isReadOnly:!0}),I.length>0&&g.push({path:I,isReadOnly:!1}),E.length)for(let e=0;e<E.length;e++)g.push({path:[E[e]],isReadOnly:!0});for(let t=0;t<g.length;t++){let i=g[t];x._getAuthoringFlag()&&(C=i.path,a=i.isReadOnly);let s=x._getExpandFunc(a);var O=[];O.push(new Promise(function(t,i){let a={pathIds:C,data:{expandLevel:l},FBIProxy:x.options.FBIProxy,timeout:3e4};x.prodConfigSupportInAuth&&(a.data.prodConfigSupportInAuth=x.prodConfigSupportInAuth),s(a).then(function(e){var s=c.data.jsonParse(e);if(s.timeoutOccurs)throw s;if(0===s.results.length)n.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-expand-multi-select-generic-error"}),p.iterate(m,function(e){e.setState(v.NODE_STATES.NOCHILDREN)}),i();else{x._parseLoadModel=!0;let e=d.parseExpandLoadModel({treeDoc:x,expandedNodes:m,FBIProxy:x.options.FBIProxy,wsResponse:s,nodeModelClass:x.options.nodeModelClass,expandLevel:h});new f(x,e),new r(e,x.boundClearFlag);e.then(function(e){p.iterate(m,function(e){e.options.childComputed=!0,e.setState(v.NODE_STATES.EXPANDED)}),t()})}}).catch(function(o){o.timeoutOccurs&&n.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-multi-select-request-timeout"}),x.withTransactionUpdate(function(){p.iterate(m,function(t){n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t.getLabel(),expandLevel:"-1"===l?"all":l}),level:"error",key:"xNavDoc-expand-multi-select-parse-error"}),t.setState(v.NODE_STATES.COLLAPSED)})}),t()})}))}var M=Promise.allSettled(O);t.callback&&M.then(t.callback);new f(x,M);M.then(function(){s.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}})})}},clearLoadModelFlag:function(){this._parseLoadModel=!1},_getAuthoringFlag:function(){return!1},_getExpandFunc:function(e){let t=void 0!==window.jasmine;return(!this._boundExpandIndex&&!this._boundExpandDB||t)&&(this._boundExpandDB=l.expandv2DBprogressive.bind(l),this._boundExpandIndex=l.expandv2.bind(l)),e?this._boundExpandDB:this._boundExpandIndex},_getFetchFunc:function(e){let t=void 0!==window.jasmine;return(!this._boundFetchIndex&&!this._boundFetchDB||t)&&(this._boundFetchDB=l.fetchDB.bind(l),this._boundFetchIndex=l.fetch.bind(l)),e?this._boundFetchDB:this._boundFetchIndex},callForODT_applyChildComputedFlag:function(e,t){G(e,t)}},L}),define("DS/ENXNav/models/xNavTreeDoc",["DS/TreeModel/TreeDocument","DS/ENXNav/models/xNavNodeModel","DS/ENOXParser/modules/TwoDParser","DS/ENXNav/models/NodeUtils","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENXNav/models/mixins/TreeDocSelect","DS/ENXNav/models/mixins/TreeDocProxy","DS/ENXNav/models/mixins/TreeDocPopulate","DS/ENXNav/models/mixins/TreeDocAccess","DS/ENXNav/models/mixins/TreeDocShared","DS/ENXNav/models/mixins/TreeDocSupport","DS/ENXNav/models/mixins/TreeDocAdditionals","DS/ENXNav/models/_xNavGrouping","DS/PADUtils/PADTransactionManager","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g,f){"use strict";function v(){}return v.prototype=Object.assign(v.prototype,r.prototype),v.prototype=Object.assign(v.prototype,s.prototype),v.prototype=Object.assign(v.prototype,a.prototype),v.prototype=Object.assign(v.prototype,l.prototype),v.prototype=Object.assign(v.prototype,d.prototype),v.prototype=Object.assign(v.prototype,c.prototype),v.prototype=Object.assign(v.prototype,p.prototype),v.prototype=Object.assign(v.prototype,u.prototype),v.prototype=Object.assign(v.prototype,{setFBIProxyOptions:function(e){this.options.FBIProxy=e.FBIProxy},applyActiveView:function(e){this.options.active_view=e},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},_shouldAcceptDrop:function(e){var t=e.dropPosition;return"top"!==t&&"bottom"!==t},_shouldAcceptDrag:function(e,t){return!0},createNodeModel:function(e){return new this.options.nodeModelClass(e)}}),e.extend(h,v,{init:function(e){this.version="2.0";var s=e||{};s.shouldBeSelected=function(e){return!0!==e.isRelationsObjectGroupingNode},UWA.is(s.shouldAcceptDrop)||(s.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),UWA.is(s.shouldAcceptDrag)||(s.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),s.nodeModelClass=t,s.showModelChanges=!1,this._parent(s),o.setup({nls:{loadingText:n.loadingText},modules:{NodeUtils:i,_xNavGrouping:u}}).then(function(){console.log("parser is setup")}),this.options.viewport={},this.boundClearFlag=this.clearLoadModelFlag.bind(this),this.initProxy(),this.initSelectCB(),g.subscribe({event:"ENXViews/Model/FindInCtx"},this._findInCtx.bind(this)),this.onPreExpand(this.onPreExpandChecker.bind(this)),g.subscribe({event:"ENXViews/Model/SelectFromTagger"},this._selectFromTagger.bind(this)),this.getModelEvents().subscribe({event:"addChild"},function(e){var t=e.data.nodeModel,o=e.parent.getChildren();t.options.grid.actualIndex=o.indexOf(t)}),g.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGrouping.bind(this)),g.subscribe({event:"ENXModel/Model/ExpandAllGroups"},this.__expandAllGroupsCmd.bind(this)),g.subscribe({event:"ENXModel/Model/FocusOnGroups"},this.__focusOnGroupsCmd.bind(this)),g.subscribe({event:"ENXModel/Model/ColorizeGroup"},this.__colorizeGroupCmd.bind(this)),g.subscribe({event:"ENXModel/Model/RemoveGroupColor"},this.__removeColorGroupCmd.bind(this)),g.subscribe({event:"ENXModel/Model/GroupsLayout"},this.__groupsLayoutCmd.bind(this)),g.subscribe({event:"ENXModel/Model/CopyLink"},this.__copyLink.bind(this))},isEditor:function(){return!1}})}),define("DS/ENXNav/features/xNavSaveSort",["DS/ENXNav/utils/LocalStorageForAppState","DS/ENXNav/utils/TwoDAppEvents"],function(e,t){function o(e){this.options=e,this._boundPersist=this.persist.bind(this),this._boundReapply=this._reapplySortModel.bind(this),t.onExpand(this._boundReapply),t.onAddRoot(this._boundReapply),t.onAddChild(this._boundReapply),t.onRemoveRoot(this._boundReapply),t.onClearSort(this._onClearSort.bind(this)),t.onRefresh(this._boundReapply)}return o.prototype={initialize:function(){return new Promise(function(e,t){e()})},setup:function(e){this.setupOptions=e,this.setupOptions.dgv&&(this.options.dgv=this.setupOptions.dgv,this.options.actual=this.setupOptions.dgv.options.dgv,this.options.dgv.options.shouldClearSort=!0,this.options.actual.addEventListener("sortModelChange",this._boundPersist),widget.hasPreference("sortColumns")&&!0===widget.getValue("sortColumns")&&this.restore())},restore:function(){let t=e.get("sortModel");t&&(this._cachedSortModel=t,this.options.actual.sortModel=t)},_onClearSort:function(t){"begin"===t?(this._clearSortOccurring=!0,delete this._cachedSortModel,e.del("sortModel")):this._clearSortOccurring=!1},_reapplySortModel:function(e){this.options.actual&&(!this.options.actual.sortModel&&this._cachedSortModel?this.options.actual.sortModel=this._cachedSortModel:(!1===widget.getValue("sortColumns")&&this.options.dgv.options.shouldClearSort&&(this.options.dgv.options.shouldClearSort=!1),this.options.actual.reapplySortModel()))},persist:function(){if(!this._clearSortOccurring)if(this.options.dgv.isClearSortEnabled()){let t=this.options.actual.sortModel;t&&e.set("sortModel",t)}else delete this._cachedSortModel,e.del("sortModel")}},Object.defineProperties(o.prototype,{name:{get:function(){return"saveSorts"}}}),o}),define("DS/ENXNav/views/xNavDataGridView",["css!DS/ENXNav/ENXNav","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Core","DS/DataGridView/DataGridView","DS/PADUtils/PADCommandProxy","DS/ENXNav/views/customize_views/_xNavDGVParametrization","DS/ENXNav/views/customize_views/_xNavDGVUtils","DS/ENXNav/features/xNavSaveSort","DS/PADUtils/Configuration","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Dimensions","DS/PADServices/settings/AppSettings","DS/PADServices/utils/DictionaryAccess"],function(e,t,o,i,n,s,r,a,l,d,c,p,u,h,g){"use strict";function f(){return d.getSetting("saveSorts")||"true"===c.getURLParameter("saveSorts")}function v(e){this.name="xnav-dgv",this._version=.1,this._additionalColumnsAMD=e.additionalColumnsAMD,this._cbDefinition=e.callbacksDefinition||{},this.options={renderTo:null,context:null,viewMode:"",view_customization:null,modelEvents:null,subscribeTokens:[],dgv:null,dgvLayout:null,isActiveView:!1,clickEvent:{},doubleClickEvent:{}},this.options=Object.assign(this.options,e)}return v.prototype=Object.assign(v.prototype,s.prototype),v.prototype=Object.assign(v.prototype,r.prototype),v.prototype.initialize=function(){var e=this;return new Promise(function(s){var r=o.clone(l.getConfig("dgvOptions"));e.options.viewMode=r.viewMode,e.options.useAsyncPreExpand=r.useAsyncPreExpand,e.options.activateFilterView=r.activateFilterView||"true"===c.getURLParameter("activateFilterView"),e.options.columnsDefaultfilterDefinition=r.columnsDefaultfilterDefinition,e.options.activateStatusBar=r.activateStatusBar,f()&&(e._saveSortsHandler=new a({})),e.buildDGVOpts().then(function(a){var l=o.extend({identifier:"DataGridView-"+e.name+"-"+c.uid()},a);if("undefined"!==r.dgvLayout){var u=o.clone(r.dgvLayout);void 0!==a.defaultCellHeight&&(u.cellHeight=a.defaultCellHeight,delete a.defaultCellHeight),void 0!==a.rowsHeader&&(u.rowsHeader=a.rowsHeader,delete a.rowsHeader),l.layoutOptions=u}else l.layoutOptions={};e.options.viewMode=a.viewMode?a.viewMode:"comfortable",l.layoutOptions.layoutDensity=e.options.viewMode,"undefined"!==r.useAsyncPreExpand&&(l.useAsyncPreExpand=r.useAsyncPreExpand),l.showContextualMenuColumnFlag=!0,!0===h.getSetting("grpBSD")&&(l.rowGroupingOptions={depth:e=>e>0,hideGroupedColumns:!1,getNodeGroupingKey:(o,i)=>{let n=e.options.dgvLayout.getColumnOptionValue(i,"text"),s="rel"===e.options.dgvLayout.getColumnOptionValue(i,"ds6wFrom");"string"!=typeof n?n="":n+=!0===s?t.groupingNode.fromInstance:":  ";let r=o.getAttributeValue(i);return void 0===r&&(r="tree"===i?o.getLabel():t.groupingNode.notValuated),n+r},getGroupingNodeLabel:e=>{const o=e.getOriginalChildrenInformation().notHiddenNotFilteredChildrenCount;let i=e.getIdentifier();return void 0===i&&(i=t.groupingNode.notValuated),i+" ("+o+")"},getGroupingNodeIcons:()=>[{iconName:"group"}],canNodeBeGrouped:e=>{return!e.isRelationsObjectNode},mapGroupingKeys:e=>{let t,o=[],i=new Map;for(let n in e){const s={};s[n]=[];for(let o=0;o<e[n].length;o++){let r=e[n][o].split(":");if(1===r.length&&-1!==c.getLang().indexOf("zh")&&(r=e[n][o].split(String.fromCharCode(65306))),r.length>1){t||(t=r[0]);const a=r[1].trim();i.set(e[n][o],r[1].trim()),s[n].push(a)}}o.push(g.retrieveNLS({nlsData:s}))}return Promise.all(o).then(function(e){let o={};for(let[n,s]of i)for(let i=0;i<e.length;i++){const r=e[i],a=Object.values(r),l=Object.keys(r)[0];o[l]||(o[l]={});for(let e=0;e<a.length;e++)if(a[e][s]){o[l]={...o[l],[n]:t+": "+a[e][s]};break}}return o})}},p.subscribe({event:"ENXModel/parseEnded"},()=>{e.options.dgv.groupingApplied&&(e.options.dgv.treeDocument.getModelEvents().subscribeOnce({event:"groupNodes"},()=>{setTimeout(()=>{delete e.options.dgv.treeDocument.__groupingInProgress},250)}),e.options.dgv.treeDocument.__groupingInProgress=!0,e.options.dgv.groupRows({dataIndexesToGroup:[e.options.dgv.groupingApplied]}))}));var v=e.options.dgv=new i(l);f()&&e._saveSortsHandler.setup({dgv:e}),!0===h.getSetting("activateStatusBar")&&e.__buildStatusBar(),e.options.dgvLayout=v.layout;var m=v.getColumnOrGroup("ContextualMenuColumn");if(m){if(e.options.dgv.prepareUpdateView(),void 0!==a.ctxMenuColumn){v.onReady(function(){void 0!==a.ctxMenuColumn.pinned&&e.changePinCB("ContextualMenuColumn",a.ctxMenuColumn.pinned);var t=e.options.dgvLayout.getColumnIndex("ContextualMenuColumn");t!==a.ctxMenuColumn.columnIdx&&e.moveColumnCB({move2perform:{fromID:t,toID:a.ctxMenuColumn.columnIdx}}),void 0!==a.ctxMenuColumn.visibleFlag&&!1===a.ctxMenuColumn.visibleFlag&&e.hideColumn("ContextualMenuColumn")})}m.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}},e.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0)}var D=v._keymapManager,b=function(){var e=require("DS/ApplicationFrame/CommandsManager").getCommand("ActionBar_Attributes");e&&e.isEnabled()&&e.begin()};["alt+return","alt+enter"].forEach(function(e){D.unregisterKeymap(e),D._commandsRegistry.registerCommand("enxdgv:"+e,b),D.registerKeymap(e,void 0,"enxdgv:"+e)});var S=["ctrl+shift+f"];if(D.unregisterKeymap(S),D._commandsRegistry.registerCommand("enxdgv:"+S,function(){var e=require("DS/ApplicationFrame/CommandsManager").getCommand("FindCmd");e&&e.isEnabled()&&e.begin()}),D.registerKeymap(S,void 0,"enxdgv:"+S),e.options.additionalColumnsModules)for(var _=0;_<e.options.additionalColumnsModules.length;_++){if(e.options.additionalColumnsModules[_].getTypeRepresentations){var x=e.options.additionalColumnsModules[_].getTypeRepresentations();v.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(x))}e.options.additionalColumnsModules[_].setupDGVManipulation&&e.options.additionalColumnsModules[_].setupDGVManipulation({onAddColumn:function(t){e.addColumnCB(o.clone(t.addedColumns))},onRemoveColumn:function(t){e.removeColumnCB(o.clone(t.removedColumns))}})}v.getTypeRepresentationFactory().registerTypeRepresentations(e.getTypeRepresentations()),e._commandProxy=n.create(),e.eventHandlerOnGridView(v).then(function(){v.getContent().addClassName(e.name),e.options.renderTo&&!0===e.options.isActiveView&&v.inject(e.options.renderTo),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/DatagridView/ExportAs"},e._exportAsCmd.bind(e))),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/ActionBar/statusChanged"},t=>{t&&"true"===t.dataOpen?navigator.userAgent.match(/Android|iPhone|iPod|BlackBerry|Opera Mini|IEMobile/i)?e.options.dgvLayout.scrollPaddingBottom=110:RegExp(/Macintosh/i).test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2?e.options.dgvLayout.scrollPaddingBottom=110:e.options.dgvLayout.scrollPaddingBottom=75:e.options.dgvLayout.scrollPaddingBottom=0})),p.publish({event:"ENXViews/ActionBar/status"}),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/Model/FindInCtx"},e.removeFilterView.bind(e))),e.options.subscribeTokens.push(p.subscribe({event:"ENXModel/Root/remove"},t=>{e.removeFilterView()})),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/DatagridView/CheckColumns"},t=>{e.removeColumns(t.colsToRemove),e.saveCustoView(!0,!1),p.publish({event:"ENXViews/DatagridView/CheckColumns/Done"})})),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/DatagridView/ClearViewGrouping"},()=>{e.options.dgv.groupingApplied&&(e.options.dgv.treeDocument.getModelEvents().subscribeOnce({event:"groupNodes"},()=>{setTimeout(()=>{delete e.options.dgv.treeDocument.__groupingInProgress},250)}),e.options.dgv.treeDocument.__groupingInProgress=!0,e.options.dgv.groupRows({dataIndexesToGroup:[]}),delete e.options.dgv.groupingApplied)})),s()}),require(["DS/PADUtils/PADUtilsServices"],function(t){e.options.currentTenant=t.getPlatformId(),d.addEvent("onX3dPlatformId",function(t){e.options.currentTenant!==t&&(e.options.currentTenant=t,"function"==typeof e.options.onTenantChange&&e.options.onTenantChange({updateTreeView:function(t){o.is(t)&&""!==t?console.warn("Modification of columns during Tenant modification must be done"):e.reset()}}))})})})})},v.prototype.destroy=function(){for(var e=0;e<this.options.subscribeTokens.length;e++)p.unsubscribe(this.options.subscribeTokens[e])},v.prototype.setModel=function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this.options.dgv.treeDocument=e,!0===this.options.activateFilterView&&this.options.dgv.treeDocument.setFilterModel(this.options.filterModel),this.toggleStatusBarListener(!0)},v.prototype.completeDGVOptions=function(e){return new Promise(function(t){for(var o=0;o<e.columns.length;o++){let t=e.columns[o];!0===h.getSetting("activateUnits")&&"tree"!==t.dataIndex&&void 0===t.getCellValue&&(t.typeRepresentation="string",t.getCellValue=function(e){let o=this.getColumnOrGroup(e.columnID);if(!e.isHeader&&o){let o;if(e.nodeModel){let i=e.nodeModel.getReferenceValue(t.dataIndex);o="object"==typeof i&&i.inputValue?i.inputValue+" "+u.getNLSForUnit(i.inputUnit):i}return o}},t.getCellValueForSort=function(e,o){let i,n=e.getReferenceValue(t.dataIndex);return i="object"==typeof n&&n.inputValue?n.value:n},t.getCellValueForExport=function(e){let o=this.getColumnOrGroup(e.columnID);if(!e.isHeader&&o){let o;if(e.nodeModel){let i=e.nodeModel.getReferenceValue(t.dataIndex);o="object"==typeof i&&i.inputValue?i.inputValue+" "+u.getNLSForUnit(i.inputUnit):i}return o}}),void 0===t.getCellClassName&&(t.getCellClassName=function(e){var t=[];return e.nodeModel&&!0===e.nodeModel.options.isBeingCut&&t.push("dgv-cutNode"),t.join(" ")})}t(e)})},v.prototype.unsetModel=function(){this.options.isActiveView&&(this.options.renderTo.removeChild(this.options.dgv.getContent()),this.toggleStatusBarListener(!1),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},v.prototype.isColumnHidden=function(e){var t=!0;return this.options.dgv&&this.options.dgv.getColumnOrGroup(e)&&"boolean"==typeof this.options.dgv.getColumnOrGroup(e).visibleFlag&&(t=!this.options.dgv.getColumnOrGroup(e).visibleFlag),t},v.prototype.isColumnExportable=function(e){var t=!0;if(this.options.dgv&&this.options.dgv.getColumnOrGroup(e)){var o=this.options.dgv.getColumnOrGroup(e);o.customisation&&o.customisation.exportable&&(t="boolean"!=typeof o.customisation.exportable.value||o.customisation.exportable.value)}return t},v.prototype.showColumn=function(e){this.changeVisibilityCB(e,!0)},v.prototype.hideColumn=function(e){this.changeVisibilityCB(e,!1)},v.prototype.updateView=function(){this.options.dgv.updateView(!0)},v.prototype.changeColumnTitle=function(e,t){this.changeTitleCB(e,t)},v.prototype.setUseClipboardFlag=function(e){this.options.dgv.setUseClipboardFlag(e)},v.prototype.getColumnsForExport=function(){for(var e=[],t=this.options.dgvLayout.getOrderedColumnsIndexes(),o=0;o<t.length;o++){var i=this.options.dgvLayout.getColumnOptionValue(t[o],"customisation");i&&i.exportable&&!0===i.exportable.value&&e.push(this.options.dgvLayout.getDataIndexFromColumnIndex(t[o]))}return e},v.prototype.removeFilterView=function(){if(this.options.dgv){const e=this.options.dgv.getFilterViewManager(),t=e.getFilterViews();(!e.isEmpty()||this.options.dgv.treeDocument&&0===this.options.dgv.treeDocument.getRoots().length)&&(console.debug("DGV: Reset View Filter"),Object.keys(t).forEach(e=>{t[e].filter.filterModel=void 0}))}},v.prototype.reapplySortModel=function(){this.options.dgv&&this.options.dgv.reapplySortModel()},v.prototype.refreshStatusBar=function(){if(this.options.dgv.elements.statusBar){let e=this.options.dgv.elements.statusBar.getNodeModelByID("switchSGIId");if(e){let t=h.getSetting("redirectQueryToSGI");e.updateOptions({icon:{iconName:"warning-symbol-biohazard",fontIconFamily:1,className:"enx-sgi-status enx-status-bar "+(!0===t?"activated":"")}})}}},v});