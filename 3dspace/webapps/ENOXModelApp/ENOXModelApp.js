define("DS/ENOXModelApp/RuleDefinition/RuleExpressionPresenter",["UWA/Core","DS/CfgLanguageInformationComponent/Model/CfgLanguageInformationModelXModel","DS/CfgRuleExpressionComponent/Presenter/CfgRuleExpressionPresenter","DS/CoreEvents/ModelEvents","DS/xPflRouter5/xPflRouter","DS/CfgDictionary/CfgDictionaryV3Utils","DS/UIKIT/Mask","DS/ResizeSensor/js/ResizeSensor","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/UIKIT/SuperModal","DS/ENOXModelApp/Utils/xModelCommonUtils","i18n!DS/ENOXModelApp/assets/nls/RuleDefinition/RuleExpressionPresenter","css!DS/ENOXModelApp/RuleDefinition/RuleExpressionPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u){"use strict";var h=function(e,a,s){this._privateChannel=s.privateChannel||new n,this._applicationChannel=a,this._updateChannel=s.updateChannel||new n,this._ruleId=e.ruleId,this._model=e,this._mapDico=e.mapDico,this._model.languageInformation=t,this._ruleName=s.ruleName?s.ruleName:u._Rule,this._ruleTitle=s.ruleTitle?s.ruleTitle:u._Rule,this._model.fullDictionary=o.getSubDictionary(this._model.dictionaryJSON,o.WITH_REFERENCES_ONLY),this._editable=!1!==s.editable,this._workaroundCheckAndWakeUpResizeSensor=s.resizeSensorEnablerFun?s.resizeSensorEnablerFun:function(){},this._privateChannelForRules=s.privateChannelForRules,this._cfgRuleExpressionPresenter=new i(this._model,{localModelEvents:this._privateChannel,ruleName:this._ruleName,ruleTitle:this._ruleTitle,editable:this._editable,applicationChannel:this._applicationChannel,updateChannel:this._updateChannel,privateChannelForRules:s.privateChannelForRules}),this._initPlusAction(),this._initDom(),this._subscribeToEvents(),this._toggleSelectionOfPlus(!1)};return h.prototype._subscribeToEvents=function(){var t=this;this._listSubscription=[],this._ruleChannelSubTokens=[],this._privateChannelSubTokens=[],this._ruleChannelSubTokens.push(this._privateChannelForRules.subscribe({event:"solver-call-error"},function(){var e={message:u.SERVICE_OUT,category:"solverError"};l.removeNotificationFromCategory("solverError","warning"),l.showWarning(e)})),this._privateChannelSubTokens.push(this._privateChannel.subscribe({event:"onSave"},function(i){s.mask(t._container);var n={type:"expression",definition:i.expression};e.log("saving the rule"),function(a){if(!0===a){var o=p.buildRuleDefinitionInPublicAPIsFormat(n,t._mapDico);o.id=t._ruleId,o.modelId=t._model.modelId,d.updateRuleConfiguration(o).then(function(){e.log("Rule saved.."),t._privateChannel.publish({event:"onDone",data:!0}),i.model&&t._privateChannel.publish({event:"navigate-to-rule",data:i.model}),s.unmask(t._container)},function(){e.log("Rule save failed.."),t._privateChannel.publish({event:"onFailSave",data:!1}),s.unmask(t._container),l.showError(u._error_expression_rule_save+" "+t._ruleTitle)})}else t._privateChannel.publish({event:"onFailSave",data:!1}),s.unmask(t._container)}(!0)})),this._privateChannelSubTokens.push(this._privateChannel.subscribe({event:"triptych-hide-panel-if-opened-from-rule"},function(){t._isRightPanelOpenFromPlus&&t._toggleSelectionOfPlus(!1)})),this._listSubscription.push(this._applicationChannel.subscribe({event:"triptych-panel-hidden"},function(e){"right"===e&&t._toggleSelectionOfPlus(!1)})),this._listSubscription.push(this._applicationChannel.subscribe({event:"information-panel-open"},function(){t._toggleSelectionOfPlus(!1)})),this._listSubscription.push(this._applicationChannel.subscribe({event:"warning-dialog-dontsave-button-clicked"},function(i){e.log("Don't Save .."),i&&(t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),t._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),i.linkID?t._applicationChannel.publish({event:"breadcrumb-link-clicked",data:i}):i.isBackClicked?window.history.back():t._privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:i}))})),this._listSubscription.push(this._applicationChannel.subscribe({event:"warning-dialog-save-button-clicked"},function(i){e.log("Save ..");var n=t._cfgRuleExpressionPresenter.getExpression();void 0!==n&&t._privateChannel.publish({event:"onSave",data:{expression:n,model:i}})})),this._privateChannelSubTokens.push(this._privateChannel.subscribe({event:"navigate-to-rule"},function(e){e&&(t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),t._privateChannelForRules.publish({event:"update-ready-to-navigation-flag",data:!0}),e.linkID?t._applicationChannel.publish({event:"breadcrumb-link-clicked",data:e}):e.isBackClicked?window.history.back():t._privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:e}))}))},h.prototype.destroy=function(){var e=0,t=this._listSubscription.length;for(e=0;e<t;e++)this._applicationChannel.unsubscribe(this._listSubscription[e]);for(var i=0;i<this._privateChannelSubTokens.length;i++)this._privateChannel.unsubscribe(this._privateChannelSubTokens[i]);for(var n=0;n<this._ruleChannelSubTokens.length;n++)this._privateChannelForRules.unsubscribe(this._ruleChannelSubTokens[n]);this._cfgRuleExpressionPresenter.destroy()},h.prototype._initPlusAction=function(){var e=this,t={icon:"fonticon fonticon-book-open custom-plus",selected:!1,disabled:!e._editable,handler:function(){e._isRightPanelOpenFromPlus?(e._toggleSelectionOfPlus(!1),e._applicationChannel.publish({event:"triptych-hide-panel",data:null}),e._applicationChannel.publish({event:"variability-panel-hidden"})):(e._toggleSelectionOfPlus(!0),e._updateChannel.publish({event:"display-criteria-panel",data:"expression-rule"}),e._applicationChannel.publish({event:"information-panel-hidden",data:"right"}),e._applicationChannel.publish({event:"variability-panel-visible"}))}};this._cfgRuleExpressionPresenter.addToolBarAction(t)},h.prototype._initDom=function(){this._container=document.createElement("div"),this._container.classList.add("xmodel-rule-expression-container"),this._cfgRuleExpressionPresenter.inject(this._container),this._plusActionInDom=this._container.querySelector(".custom-plus")},h.prototype.inject=function(e){e.appendChild(this._container)},h.prototype._triggerResize=function(){this._cfgRuleExpressionPresenter._triggerResizeInit()},h.prototype._toggleSelectionOfPlus=function(e){!0===e?(this._isRightPanelOpenFromPlus=!0,this._plusActionInDom.classList.add("selected"),this._plusActionInDom.setAttribute("title",u._close_variability)):(this._isRightPanelOpenFromPlus=!1,this._plusActionInDom.classList.remove("selected"),this._plusActionInDom.setAttribute("title",u._open_variability))},h.prototype.attachResizeSensor=function(){e.log("attaching ResizeSensor");var t,i,n,a,o=(t=this._triggerResize.bind(this),i=250,function(){var e=this,o=arguments,s=n&&!a;clearTimeout(a),a=setTimeout(function(){a=null,n||t.apply(e,o)},i),s&&t.apply(e,o)});this.resizeSensor=new r(this._container,function(){o()})},h.prototype.getCfgRuleExpressionPresenter=function(){return this._cfgRuleExpressionPresenter},h}),define("DS/ENOXModelApp/Utils/xModelApp3DSearch",["UWA/Core","UWA/Utils/InterCom"],function(e,t){"use strict";var i=function(i){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.listener=this.objectsSelected.bind(this);var n=this;this.socket.addListener("onCloseTransient",function(){n.deactivateSearch()}),this.socket.subscribeServer("SearchComServer"),this.defaultOptions=i,this.defaultOptions={multiSel:!1,source:["3dspace"]},e.extend(this.defaultOptions,i||{})};i.prototype.options=function(t){var i={};e.merge(i,t),i.title=i.title||"",i.mode="furtive",i.app_socket_id=this.socketName,i.widget_id=window.widget.id,i.default_with_precond=!0,i.multiSel=i.multiSel||!1,i.source=this.defaultOptions.source||[],i.show_precond=!1;var n=window.widget.getValue("x3dPlatformId"),a=n&&""!==n?n:"OnPremise";i.tenant=a,i.role=i.role||"";var o=i.allowedTypes;Array.isArray(o)&&(i.precond="",o.forEach(function(e,t){i.precond+=0===t?"[ds6w:"+e.tag+"]:"+e.value:" AND [ds6w:"+e.tag+"]:"+e.value})),i.precond&&""!==i.precond&&(i.precond="("+i.precond+")"),i.precondition&&(i.precond?i.precond="("+i.precond+" AND "+i.precondition+")":i.precond="("+i.precondition+")");var s=t.criteria;return s&&""!==s.trim()?i.default_search_criteria=s:i.default_search_criteria="",i},i.prototype.deactivateSearch=function(){this.socket.dispatchEvent("UnregisterContext",{widget_id:window.widget.id}),this.socket.removeListener("Selected_Objects_search",this.listener)},i.prototype.destroy=function(){this.socket.removeListener("Selected_Objects_search",this.listener)},i.prototype.activate=function(t,i){var n=this.options(t);e.is(i,"function")||(n.mode="default"),this.callback=i,this.socket.addListener("Selected_Objects_search",this.listener),this.socket.dispatchEvent("RegisterContext",n),this.socket.dispatchEvent("InContextSearch",n)},i.prototype.isAvailable=function(){return e.is(this.socket)},i.prototype.launchASearch=function(t){var i={};e.merge(i,t),this.isAvailable()&&(void 0!==t.multiSel&&null!==t.multiSel||(i.multiSel=this.defaultOptions.multiSel||!0),i.title=t.title?t.title:"",i.role=t.role||"",this.activate(i,function(e){t.in_apps_callback(e)}))},i.prototype.objectsSelected=function(e){this.callback&&this.callback(e)};var n=new i;return i=function(){return n}}),define("DS/ENOXModelApp/Viewer3D/CleanAllCommand",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,i,n){"use strict";return t.extend(i,{execute:function(){var t=n.get();t&&e.is(t.empty,"function")&&(t.empty(),t.publish({event:"pc-3d-viewer-on-empty"}))}})}),define("DS/ENOXModelApp/Utils/xModelPreferencesConstant",[],function(){"use strict";var e={_KEY:"xmodel-app",_SMALL:"small",_MEDIUM:"medium",_LARGE:"large",_VIEWS_PREFERENCES:"xmodel-views-preferences",_MY_MODEL_VERSIONS:"xmodel-my-model-versions",_MY_UNITS:"xmodel-my-units",_RECENTLY_OPENED:"xmodel-recently-opened",_MODEL_VERSIONS:"xmodel-model-versions",_MODEL_VERSIONS_DETAILS:"xmodel-model-versions-details",_RULES:"rules",_REQUIREMENTS:"requirements",_PRODUCT_CONFIGURATIONS:"product-configurations",_BASE_CONFIGURATIONS:"base-configuration",_MANUFACTURINGPLANS:"manufacturingPlans",_ENTREPRISE_VARIANTS_OPTIONS:"xmodel-entreprise-variants-options",_PARAMETERS:"parameters",_VARIANTS:"variants",_OPTIONS:"options",_GROUP_OPTIONS:"group-options",_VARIANTS_DETAILS:"variants-details",_OPTION_GROUP_DETAILS:"optiongroup-details",_RULES_DETAILS:"rules-details",_EXPRESSION_RULE:"expression-rule",_PRODUCT_CONFIGURATIONS_DETAILS:"product-configurations-details",_BASE_CONFIGURATIONS_DETAILS:"base-configurations-details",_LIST_VIEW:"xmodel-list-view",_VIEW:"view",_CONTEXTID:"contextId",_SORT:"sort",_GROUP:"group",_TAB:"tab",_SEARCH:"search",_ID_CARD:"id-card",_COLLAPSE:"collapse",_LAST_ROUTE:"last-route",_OPTION_GROUP:"Option Group",_VARIANT:"Variant",_FILTERS:"filters",_COLUMNS:"columns",_SELECTIONS:"selections",_VARIABILITY:"variability",_SPECIFICATIONS:"specifications",_SPLITVIEW:"split-view",_SPLITOPEN:"split-open",_SPLITWIDTH:"split-width",_INFOPANEL:"info-panel",_INFOOPEN:"info-open",_INFOCONTEXT:"info-context",_INFOPANELWIDTH:"info-width",_TAGFILTER:"tagFilter",_DATE_FORMAT:"%m/%d/%Y , %I:%M:%S %p",_PHY_PRODUCT_ID:"physical-product-id",_ORG_TITLE:"organizationTitle",_COLLABSPACE_TITLE:"collabSpaceTitle",_DICTIONARY_TAB_VALUES:"Values",_DICTIONARY_TAB_OPTIONS:"Options",_WITH_CUSTOM_ATTRIBUTES:"customAttributes",_VISIBLE_COLUMNS:"visibleColumns",_XMODEL_MV_SUBTYPE_ORDER:"xmodel-mv-subtype-order",_ROUTES_PREFERENCES:"routes",_COPY_FROM:"copyFrom"};return e}),define("DS/ENOXModelApp/components/DialogDeletion/DialogDeletion",["UWA/Core","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Expander","DS/CoreEvents/ModelEvents","i18n!DS/ENOXModelApp/assets/nls/components/DialogDeletion/DialogDeletion"],function(e,t,i,n,a,o,s){"use strict";return{showDialog:function(e){e&&(this._options=e,this._listItems=this._options.listItems,this._type=this._options.type?this._options.type.toLowerCase():s.TXT_DELETE,this._single=this._options.single?this._options.single:s.item,this._multiple=this._options.multiple?this._options.multiple:s.items,this._listItems&&(this._listId=this._listItems.map(function(e){return e.id})),this._immersiveFrame=this._options.immersiveFrame,this._modelEvent=this._options.modelEvent),this._init()},_init:function(){this._mapValue(this._listItems,this._type,this._single,this._multiple)},_mapValue:function(t,i,n,a){if(Array.isArray(t)){switch(i){case"delete":this._type=s.TXT_DELETE;break;case"destroy":this._type=s.destroy;break;case"remove":this._type=s.remove;break;default:this._type=s.TXT_DELETE}var o,r,l;switch(t.length){case 0:o=this._type+" "+n,this._createEmptyDialog(o,this._single.toLowerCase());break;case 1:o=this._type+" "+n,r=t[0].title,this._createDialog(o,this._type.toLowerCase(),r,this._modelEvent);break;default:o=this._type+" "+a,r=t.length+" "+a,l=new e.Element("div",{class:"wux-control-inline-container"});for(var d=0;d<t.length;d++){new e.Element("div",{style:{"vertical-align":"top"},html:"<p>"+t[d].title+"</p>"}).inject(l)}this._createDialog(o,this._type.toLowerCase(),r,this._modelEvent,l)}}else e.log("Error option input DialogDeletion")},_createDialog:function(t,o,r,l,d){var c=this,p=new e.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"},html:"<p>"+e.String.format(s.delete_Message,o,r)+"</p>"});d&&new a({header:s.More_information,body:d,allowUnsafeHTMLHeader:!1}).inject(p);var u=new i({immersiveFrame:this._immersiveFrame,title:t,content:p,activeFlag:!1,modalFlag:!0,buttons:{Ok:new n({domId:"delete-dialog-warning-ok-button",touchMode:!1,allowUnsafeHTMLLabel:!1,onClick:function(){e.log("enox-dialog-delete"),e.log(c._listId),Array.isArray(c._modelEvent)?c._modelEvent.forEach(function(e){e.publish({event:"enox-dialog-delete",data:c._listId,context:this})}):c._modelEvent.publish({event:"enox-dialog-delete",data:c._listId,context:this}),u.close()}}),Cancel:new n({domId:"delete-dialog-warning-cancel-button",touchMode:!1,allowUnsafeHTMLLabel:!1,onClick:function(){u.close()}})}})},_createEmptyDialog:function(t,a){var o=new e.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"},html:"<p>"+s.no+" "+a+" "+s.selected+"</p>"}),r=new i({immersiveFrame:this._immersiveFrame,title:t,content:o,activeFlag:!1,modalFlag:!0,height:"500px",width:"500px",buttons:{Ok:new n({domId:"delete-dialog-warning-ok-button",touchMode:!1,allowUnsafeHTMLLabel:!1,onClick:function(){r.close()}})}})}}}),define("DS/ENOXModelApp/Viewer3D/3DViewer",["UWA/Core","UWA/Controls/Abstract","DS/ENOPAD3DViewer/PAD3DViewer","text!DS/ENOXModelApp/assets/PC3DViewer.json","i18n!DS/ENOXModelApp/assets/nls/Viewer3D/3DViewer"],function(e,t,i,n,a){"use strict";var o,s=!1;return t.extend({init:function(e){if(this._modelId=e.modelId,this._modelName=e.modelName,this._modelLabel=e.modelName,this.widget=e.widget,o)o.empty();else{var t=JSON.parse(n);t.context="Default",o=new i({widget:e.widget,allowAuthoring:!1,windowOptions:t,model:{},visuProgressiveTileModel:!0,dynamicRepLoading:!0})}this._rootID=void 0,this._subscribedTokens=[],this.viewerPADContext=o},getViewer:function(){return o},emptyViewer:function(){o&&s&&(o.empty(),o.publish({event:"pc-3d-viewer-on-empty"}))},setViewerReady:function(e){s=e},onReady:function(e){var t=this;s?(e(),this.initializeFilterProxy()):o&&this._subscribedTokens.push(o.subscribe({event:"onReady"},function(){t.setViewerReady(!0),o.render(),e(),t.initializeFilterProxy()}))},initializeFilterProxy:function(){o&&(this._filterProxy=o.getBIController().getBIProxy(),this._filterProxy.addEvent("ApplyNGFilter",this.refreshViewer.bind(this)))},onLoadingComplete:function(e){o&&s&&this._subscribedTokens.push(o.subscribe({event:"onLoadingComplete"},function(){e()}))},onRemoveAllRoots:function(e){var t=this;o&&s&&this._subscribedTokens.push(o.subscribe({event:"pc-3d-viewer-on-empty"},function(){e(),t._rootID=void 0}))},loadRootInViewer:function(e){s=!0,this._rootID=e.rootID,this._rootAlias=e.rootAlias,o&&s&&(o.addRoots({objects:[{path:[this._rootID]}]}),this._filterProxy.cleanProxy(),this.applyFiltering(e))},applyFiltering:function(e){var t=e.filterXML;this._filterProxy&&this._rootID&&(e.rootAlias&&e.rootAlias!==this._rootAlias&&(this._rootAlias=e.rootAlias),this.applyViewFilter(t))},applyViewFilter:function(e){this._filterProxy.setFilterSpecification({rootID:this._rootID,rootAlias:this._rootAlias,specification:{type:this._filterProxy.CONFIG_FILTER,data:{filterXML:e,context:{model:{valueItem:this._modelId,labelItem:[this._modelLabel],name:[this._modelName]}}}},applyFilter:1,displayFilter:0,forceUpdate:1})},refreshViewer:function(){o.refresh()},_unsubscribeEvents:function(){o&&this._subscribedTokens&&this._subscribedTokens.length>0&&this._subscribedTokens.forEach(e=>{o.unsubscribe(e)}),this._subscribedTokens=[]},destroy:function(){this.emptyViewer(),this._unsubscribeEvents()}})}),define("DS/ENOXModelApp/Utils/xModelErrorManagementMap",["i18n!DS/ENOXModelApp/assets/nls/xModelErrorManagement"],function(e){"use strict";return{XMDLERROR000000:{message:e.err_admin_check},XMDLERROR000003:{subtitle:e.err_rev_dev_exists_subtitle,message:e.err_rev_dev_exists_delete_desc},XMDLERROR000004:{subtitle:e.err_unique_constraint_subtitle,message:e.err_unique_constraint_desc},XMDLERROR000009:{subtitle:e.err_value_allocated_subtitle,message:e.err_value_allocated_delete_desc},XMDLERROR000012:{subtitle:e.err_effectivity_expr_subtitle,message:e.err_effectivity_expr_delete_desc},XMDLERROR000012_Products:{subtitle:e.err_effectivity_expr_subtitle,message:e.err_effectivity_expr_delete_mv_desc},XMDLERROR000033:{subtitle:e.err_rev_dev_exists_subtitle,message:e.err_rev_dev_exists_delete_desc},XMDLERROR000034:{subtitle:e.err_MP_frozen_state_subtitle,message:e.err_MP_frozen_state_desc},XMDLERROR000043:{subtitle:e.err_PC_frozen_state_subtitle,message:e.err_PC_frozen_state_desc},XMDLERROR000044:{subtitle:e.err_MV_frozen_state_subtitle,message:e.err_MV_frozen_state_desc},XMDLERROR000045:{subtitle:e.err_obsolete_variability_subtitle,message:e.err_obsolete_variability_delete_desc},XMDLERROR000046:{subtitle:e.err_MP_present_subtitle,message:e.err_MP_present_desc},XMDLERROR000047:{subtitle:e.err_BC_frozen_state_subtitle,message:e.err_BC_frozen_state_desc},XMDLERROR000102:{subtitle:e.err_no_access_subtitle,message:e.err_no_access_delete_desc},XMDLERROR000103:{subtitle:e.err_no_access_subtitle,message:e.err_no_modify_access_desc},XMDLERROR000104:{subtitle:e.err_no_access_subtitle,message:e.err_no_connect_access_desc},XMDLERROR000105:{subtitle:e.err_no_access_subtitle,message:e.err_no_disconnect_access_desc},XMDLERROR000106:{title:e.err_composition_param_title,subtitle:e.err_composition_param_subtitle,message:e.err_composition_param_desc},default_err_message:{message:e.err_default_message}}}),define("DS/ENOXModelApp/components/DialogCreation/WarningDialog",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/Controls/Button","i18n!DS/ENOXModelApp/assets/nls/components/DialogCreation/DialogCreationSaveRule"],function(e,t,i,n,a,o){"use strict";return{dialogCreation:function(e,t){var n=this;e&&(this._options=e,this._context=e.context?e.context:void 0,this._title=this._options.title,this._content=this._options.content,this._modelEvent=this._options.modelEvent,this._data=t);var a=new i({renderTo:document.body,events:{onShow:function(){n._modelEvent.publish({event:"warning-dialog-on-show"})},onHide:function(){n._modelEvent.publish({event:"warning-dialog-on-hide"})}}}),s=[{className:"primary",touchMode:!1,allowUnsafeHTMLLabel:!1,value:o._save,action:function(e){Array.isArray(n._modelEvent)?n._modelEvent.forEach(function(e){e.publish({event:"warning-dialog-save-button-clicked",data:n._data})}):n._modelEvent.publish({event:"warning-dialog-save-button-clicked",data:n._data}),e.hide()}},{className:"default",touchMode:!1,allowUnsafeHTMLLabel:!1,value:o._dont_save,action:function(e){n._modelEvent.publish({event:"warning-dialog-dontsave-button-clicked",data:n._data}),e.hide()}},{className:"default",touchMode:!1,allowUnsafeHTMLLabel:!1,value:o._cancel,action:function(e){n._modelEvent.publish({event:"warning-dialog-cancel-button-clicked"}),e.hide()}}];a.dialog({body:this._content,title:this._title,buttons:s})}}}),define("DS/ENOXModelApp/InformationPanels/CommonInfoPresenter",["UWA/Core","UWA/Class/View","DS/ENOXTabs/js/ENOXTabs","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","i18n!DS/ENOXModelApp/assets/nls/InformationPanels/InformationPanelManager","css!DS/ENOXModelApp/InformationPanels/CommonInfoPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c){"use strict";return t.extend({className:"model-info-presenter",init:function(t){this._localChannel=t&&t.modelEvents?t.modelEvents:new s;var i={multiselection:!0,readOnly:!1,editMode:!0,context:{getSecurityContext:function(){return{SecurityContext:d.getSecurityContext()}}},displayType:a.STANDARD,typeOfDisplay:a.ALL,selectionType:a.RESTRICTED_SELECTION,extraNotif:!1,facets:[a.FACET_PROPERTIES,{require:"DS/ENORIPE_Relations/views/RelationsTab",facet:{name:"relations",position:2,text:c.relationFacet,icon:"object-related-cog"},options:{defaultProfile:"ModelDefinitionRelations"}}]};this.objectIds=[],this.facets={},this.panelOptions=t.panelOptions||{},e.merge(this.panelOptions,i),this._parent()},render:function(){if(!this.editPropertyPanel){if(this.facets)for(var e in this.facets)this.facets.hasOwnProperty(e)&&this.panelOptions.facets.push(this.facets[e]);this.editPropertyPanel=new n(this.panelOptions)}this.container.setContent(this.editPropertyPanel.getContent());var t=this;setTimeout(function(){t.editPropertyPanel.onInnerResize()},1e3)},setModels:function(t,i){var n=this,a=[],s=[];t.forEach(function(e){s.push(e.id)}),!i&&e.equals(n.objectIds,s)||(n.objectIds=[],a=[],t.forEach(function(e){var t=new o({metatype:"businessobject",objectId:e.id,label:e.label,source:"3DSpace"});a.push(t),n.objectIds.push(e.id)}),this.models=t,this.editPropertyPanel.initDatas(a))},reload:function(){this.editPropertyPanel&&this.setModels(this.models,!0)},addFacet:function(e){e.facet&&e.facet.content&&delete e.facet.content,this.editPropertyPanel&&this.editPropertyPanel.addFacets([e.facet]),this.facets[e.name]=e.facet},updateFacets:function(e){var t=[];if(this.facets){for(var i in this.facets)this.facets.hasOwnProperty(i)&&(e.hasOwnProperty(i)?this.facets[i].options!=e[i].options&&t.push(i):t.push(i));if(t)for(var n=0;n<t.length;n++){var a=t[n];this.removeFacet(a)}for(var o in e)e.hasOwnProperty(o)&&(this.facets.hasOwnProperty(o)||this.addFacet({name:o,facet:e[o]}))}},removeFacet:function(t){if(this.editPropertyPanel){if(this.selectFacet(a.FACET_PROPERTIES),this.editPropertyPanel.controller){var i=this.editPropertyPanel.controller.getUI();if(i&&e.is(i.getFacetContent,"function")){var n=i.getFacetContent(t);n&&e.is(n.destroyComponent,"function")&&n.destroyComponent()}}this.editPropertyPanel.removeFacets([t])}delete this.facets[t]},selectFacet:function(t){e.is(this.editPropertyPanel)&&(t?this.editPropertyPanel.selectFacet(t):this.editPropertyPanel.selectFacet(a.FACET_PROPERTIES))},unLoadContent:function(){this.updateFacets({}),this.setModels([])}})}),define("DS/ENOXModelApp/components/ProgressPanel/ProcessPanel",["UWA/Element","DS/ControlsEx/LoadingPanel","DS/xModelEventManager/xModelEventManager","i18n!DS/ENOXModelApp/assets/nls/components/ProgressPanel/ProgressPanel","css!DS/ENOXModelApp/components/ProgressPanel/ProgressPanel.css"],function(e,t,i,n){"use strict";return class{constructor(e){this._modelEvents=e.modelEvents,this._myEventManager=new i(this._modelEvents),this._itemTitle=e.itemTitle,this._process=[],this._process.push(e.process),this._initDivs(),this.initProgressProcess(),this._inject()}_initDivs(){let i=new e("div",{class:"progress-container"}),a=new e("div",{class:"progress-process-title"}),o=new e("div",{class:"progress-process-bar"});a.inject(i),o.inject(i);let s=n.PROGRESS;if(Array.isArray(this._process[0])&&this._process[0].length>0){let e="";this._process[0].forEach((t,i)=>{s=0==i?t.processTitle:s+", "+t.processTitle,e=this._itemTitle}),s=s+" - "+e}else s=this._process[0].processTitle?this._process[0].processTitle:s;a.innerText=s,this._processContainer=i,this.loadingPanel=new t({shape:"linear",showButtonsFlag:!1,visibleFlag:!0}),this.loadingPanel.inject(o)}_inject(){this._processContainer.inject(document.querySelector(".progress-panel-body"))}_processComplete(t){let i=this,n="In Progress";i.loadingPanel.value=100,t?n="Completed":(n="Failed",i.loadingPanel.emphasize="high-attention"),setTimeout(function(){i._processContainer.querySelector(".progress-process-bar").firstChild.remove();let a=new e("span",{class:"status-container"});a.innerText=n,a.inject(i._processContainer),setTimeout(function(){t&&(i.remove(),i._modelEvents.publish({event:"progress-panel-process-executed"}))},5e3)},100)}initProgressProcess(){let e=this;e._process.forEach(t=>{if(Array.isArray(t)&&t.length>0){let i=[];t.forEach(e=>{i.push(e.promise)}),function t(i,n){0!==i.length?i.shift().then(e=>{console.log(e),t(i,!!n)},function(){t(i,!1)}):e._processComplete(n)}(i,!0)}else t.promise?t.promise.then(function(){e._processComplete(!0)},function(){e._processComplete(!1)}):t.then(function(){e._processComplete(!0)},function(){e._processComplete(!1)})})}remove(){this._process=[],this._processContainer.remove()}}}),define("DS/ENOXModelApp/Utils/xModelAppGlobalConfig",[],function(){"use strict";var e={LEFT_PANEL_SIZE_EXPANDED:300,LEFT_PANEL_SIZE_COLLAPSED:40,MOBILE_BREAKPOINT:550,SOLVER_DEBUG_MODE:!1,SOLVER_DEBUG_PATH:"/home/data/solverlogs",SOLVER_DEBUG_LEVEL:"messagesAndSolver",PATH_HOME:"/home",PATH_LANDING_PAGE:"LandingPage",PATH_DICTIONARY:"EnterpriseDictionary",PATH_DICTIONARY_VARIANTS_OPTIONS:"VariantsNOptions",PATH_DICTIONARY_VARIANT_DETAILS:"VariantDetails",PATH_DICTIONARY_VARIANTVALUE_DETAILS:"VariantValueDetails",PATH_DICTIONARY_OPTION_GROUP_DETAILS:"OptionGroupDetails",PATH_MODEL_DEFINITION:"ModelDefinition",PATH_MODELS:"Models",PATH_MODEL_INFO:"ModelInfo",PATH_MODEL_DETAILS:"ModelDetails",PATH_MODEL_PC_DETAILS:"PCDetails",PATH_MODEL_BC_DETAILS:"BCDetails",PATH_MODEL_RULE_DETAILS:"RuleDetails",PATH_MODEL_DOC_DETAILS:"DOCDetails",PATH_NEW_MODEL_VERSION:"NewModelVersion",PATH_OPEN_MODEL_VERSION:"OpenModelVersion",PATH_RECENTY_OPENED:"RecentlyOpened",PATH_MY_MODELS:"MyModelVersions",PATH_ENTERPRISE_DICO_PAGE:"EnterpriseDictionary",PATH_MY_UNITS:"MyUnits",ROUTE_HOME:"home",ROUTE_LANDING_PAGE:"home.LandingPage",ROUTE_DICTIONARY:"home.EnterpriseDictionary",ROUTE_DICTIONARY_VARIANTS_OPTIONS:"home.EnterpriseDictionary.VariantsNOptions",ROUTE_DICTIONARY_VARIANT_DETAILS:"home.EnterpriseDictionary.VariantDetails",ROUTE_DICTIONARY_VARIANTVALUE_DETAILS:"home.EnterpriseDictionary.VariantDetails.VariantValueDetails",ROUTE_DICTIONARY_OPTION_GROUP_DETAILS:"home.EnterpriseDictionary.OptionGroupDetails",ROUTE_MODEL_DEFINITION:"home.ModelDefinition",ROUTE_MODELS:"home.ModelDefinition.Models",ROUTE_MODEL_INFO:"home.ModelDefinition.ModelInfo",ROUTE_MODEL_DETAILS:"home.ModelDefinition.ModelInfo.ModelDetails",ROUTE_MODEL_PC_DETAILS:"home.ModelDefinition.ModelInfo.PCDetails",ROUTE_MODEL_RULE_DETAILS:"home.ModelDefinition.ModelInfo.RuleDetails",ROUTE_MODEL_DOC_DETAILS:"home.ModelDefinition.ModelInfo.DOCDetails",ROUTE_MODEL_BC_DETAILS:"home.ModelDefinition.ModelInfo.BCDetails",ROUTE_RECENTY_OPENED:"home.RecentlyOpened",ROUTE_MY_MODELS:"home.MyModelVersions",ROUTE_ENTERPRISE_DICO_PAGE:"home.EnterpriseDictionary",ROUTE_MY_UNITS:"home.MyUnits",TYPE_MODELVERSION:"Products",TYPE_VARIANT:"Variant",TYPE_OPTIONGROUP:"Variability Group",TYPE_PRODUCTCONFIGURATION:"Product Configuration",TYPE_MANUFACTURINGPLAN:"Manufacturing Plan",TYPE_CONFIGURATIONRULE:"Configuration Rule",TYPE_BASECONFIGURATION:"Base Configuration",WITH_OPTIM:!1,WITH_GRAPH:!1,WITH_3D:!1,PC_COMPLETEMODE_ENABLED:!0,PCSAVEDREFINE_ENABLED:null,MV_COMPOSITION_ENABLED:!1,BC_ENFORCEMENT_ENABLED:!1,ENTERPRISE_DICTIONARY:"Enterprise Variability"};return e}),define("DS/ENOXModelApp/ModelDefinition/js/ContextDropDown",["UWA/Core","DS/UIKIT/DropdownMenu","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/UIHelper","DS/EditPropWidget/EditPropComponent","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants"],function(e,t,i,n,a,o,s){"use strict";return i.extend({_uwaClassName:"E6WObjectCardView",launchProperties:function(e,t){var i=t&&t.model,n=i&&i.serviceHosting,r=(i&&i.sourceName,[]);return this.caEditComp=new a({typeOfDisplay:s.ALL,selectionType:s.ALL_SELECTION,displayType:s.POPUP,setCloseButton:!1,readOnly:!0,extraNotif:!1,editMode:!1}),this.selection=new o({tenant:window.widget&&window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",objectId:i&&i.physicalId||e,source:n,metatype:"businessobject"}),r.push(this.selection),this.caEditComp.show(r),!0},getDropDownMenuItems:function(t,i){var n=e.clone(i||{},!1);return[this.getPropertiesButton(n),this.getRemoveItemButton(n)]}})}),define("DS/ENOXModelApp/Utils/xModelAccessUtilityConstants",[],function(){"use strict";var e={CREATE:"create",DELETE:"delete",REMOVE:"remove",ADDEXISTING:"addExisting",UPLOAD:"upload",MODIFY:"modify",INFORMATION:"information",SAVE:"save",MOVE:"move",SHARE:"share",COPYFROM:"copyFrom",DERIVE:"derive",REVISE:"revise",EDITDETAILS:"editDetails",DUPLICATE:"duplicate",TYPE_REQUIREMENT:"Requirement",TYPE_MATRIX_RULE:"Matrix Rule",TYPE_EXPRESSION_RULE:"Expression Rule",RULE:"Rule",TYPE_MV:"Products",TYPE_PLAN:"Plan",TYPE_PC:"Product Configuration",TYPE_VARIANT:"Variant",TYPE_OptionGroup:"Option Group",TYPE_PARAMETER:"Parameter",TYPE_VALUE:"Value",TYPE_OPTION:"Option",TYPE_PRODUCT_SPEC:"Product Specification",TYPE_UNIT:"Builds",TYPE_BASECONFIG:"Base Configuration",VARIABILITY_TAB:"Variability",RULES_TAB:"Rules",PC_TAB:"ProductConfigurations",DOC_TAB:"Documents",REQUIREMENTS_TAB:"Requirements",MANF_PLAN_TAB:"ManufacturingPlans",SPECIFICATIONS_TAB:"Specifications",OG_TAB:"OptionGroup",VARIANT_TAB:"Variant",PARAMAETER_TAB:"Parameters"};return e}),define("DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter",["UWA/Core","UWA/Class","DS/UIKIT/Dropdown","DS/CoreEvents/ModelEvents","DS/ApplicationFrame/ActionBar","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","css!DS/ENOXModelApp/ModelDefinition/css/VersionExplorerPresenter.css"],function(e,t,i,n,a,o,s,r,l,d){"use strict";new a({context:{displayNotification:function(e){e&&e.eventID&&""!==e.msg&&("success"===e.eventID?d.showSuccess(e.msg):"error"===e.eventID?d.showError(e.msg):"info"===e.eventID?d.showInfo(e.msg):d.showMessage(e.msg))}},file:"ENOXMOD.xml",module:"ENOXModelApp"});return t.extend({init:function(e){this.target=e.target,this.renderTo=e.renderTo||document.body,this.id=e.id,this.name=e.name,this.selectionMode=e.selectionMode?e.selectionMode:s.SELECTION_MODES.SINGLE_SELECT_ONLY|s.SELECTION_MODES.WITH_COMMANDS,this.dataModelType=e.dataModelType||s.DATA_MODEL_TYPES.MODEL_P,this.modelEvents=e.modelEvents||new n,this.applicationChannel=e.applicationChannel||new n,this.initVersionExplorer()},initVersionExplorer:function(){var t=this;this._versionExplorerContainer=e.createElement("div",{styles:{height:"100%",width:"100%"}}),this.versionExplorer=new o({versionGraphContainer:this._versionExplorerContainer,selectionMode:this.selectionMode,autoUpdate:!0,displayMode:s.DISPLAY_MODES.SUBWAY_VIEW,widget:window.widget}),this.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerCompareToSelected",function(e){var i=t.versionExplorer.getSelectedNodes();return!!(i&&i.length>0&&i[0]!==e)},!1),this.versionExplorer.subscribeEvent("ENOXVersionExplorerOpenVersion",function(e){var i=e.data||e;t.applicationChannel.publish({event:"enox-navigateTo",data:{id:i.getAttribute("id"),type:i.getAttribute("type"),reload:!0}}),t.versionExplorer.hideDialog()}),this.versionExplorer.subscribeEvent("ENOXVersionExplorerLoadCompleted",function(){t.versionExplorer.publishEvent("ENOXVersionExplorerSetActiveVersion",{id:t.id})}),this.modelEvents.subscribe({event:"refresh-version-explorer-on-create-revision"},function(){t.versionExplorer.publishEvent("ENOXVersionExplorerRefresh"),e.log("Version Explorer Refreshed!!!!")}),this.versionExplorer.subscribeEvent("ENOXVersionExplorerNewVersionCreated",function(){})},showVersionExplorerForRoadmap:function(e){var t=this;t.roadMapOptions=e.options,r.loadUserSettingsPromise(e).then(function(){t.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:t.roadMapOptions.id,title:t.roadMapOptions.title,target:t.roadMapOptions.target,tenantId:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",type:t.roadMapOptions.type,securityContext:l._securityContext,selectionMode:t.roadMapOptions.selectionMode,modelEvents:t.roadMapOptions.modelEvents,setActiveVersion:t.roadMapOptions.setActiveVersion,versionData:t.roadMapOptions.versionData,renderTo:t.roadMapOptions.renderTo,onComplete:e&&e.onComplete?e.onComplete:function(){}})}),this.versionExplorer.showDialog({clientX:0,clientY:0},window.widget.body,!0)},showVersionExplorer:function(e){var t=this;e||(e=this.id);var i={};i.displayMode=s.DISPLAY_MODES.SUBWAY_VIEW,r.loadUserSettingsPromise(i).then(function(){t.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:e,tenantId:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",type:"Products",securityContext:l._securityContext,dataModelType:s.DATA_MODEL_TYPES.MODEL_ER})}),this.versionExplorer.showDialog({clientX:0,clientY:0},window.widget.body,!0)}})}),define("DS/ENOXModelApp/ModelDocument/js/DocumentManagementCustom",["UWA/Core","DS/WAFData/WAFData","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e,t,i){"use strict";var n={SERVICE_ROOT_URL:"/resources/v1/modeler/documents/",reserveDocument:function(e,t){return this._initiateService(this.SERVICE_ROOT_URL+e+"/reserve",t)},unreserveDocument:function(e,t){return this._initiateService(this.SERVICE_ROOT_URL+e+"/unreserve",t)},_initiateService:function(t,i){var a=this,o=e.clone(i||{},!1);o.requestType="put";var s=this._prepareService(this._initiateService.bind(this,t,i),o);if(s)return s;n.ajaxRequest({url:t,type:"put",dataType:"json",data:JSON.stringify({csrf:this.getCsrf(o.tenantUrl)}),callback:function(t){t&&t.csrf&&a.setCsrf(t.csrf,o.tenantUrl),t&&t.success&&e.is(i.onComplete,"function")?i.onComplete(t,i):e.is(i.onFailure,"function")&&i.onFailure(t)},headers:{"content-type":"application/json"}})},_prepareService:function(e,t){window.isIFWE=!0;var i=t||{};if(i.tenant&&(window.enoviaServer.tenant=i.tenant),i.securityContext){var n=i.securityContext;0!==n.indexOf("ctx::")&&(n="ctx::"+n),window.enoviaServer.space=n}if(i.tenantUrl&&(window.enoviaServer.storageUrl=i.tenantUrl),!this.getCsrf(i.tenantUrl)||i.csrf){if(!i.csrf)return this._getCsrf(e,t);"notNeeded"!==i.csrf&&this.setCsrf(i.csrf,i.tenantUrl)}},_getCsrf:function(e,t){var i=this,a={url:"/resources/v1/application/E6WFoundation/CSRF",type:"get",dataType:"json",callback:function(n){n&&n.csrf&&(i.setCsrf(n.csrf,t&&t.tenantUrl),e())},headers:{"content-type":"application/json"}};return n.ajaxRequest(a)},getCsrf:function(e){var t=e||window.enoviaServer.storageUrl;return this.csrf&&this.csrf[t]},setCsrf:function(e,t){var i=t||window.enoviaServer.storageUrl;return this.csrf=this.csrf||{},this.csrf[i]=e,this.csrf[i]},calculateFinalUrl:function(t,i){var n=t;if(e.Utils.parseUrl(t).protocol)return n;n=window.enoviaServer.computeUrl(n),n+=-1===n.indexOf("?")?"?":"&";var a=window.enoviaServer.getParams();return a&&a.length>0&&!i?n+=a:n+="tenant="+window.enoviaServer.tenant,n},ajaxRequest:function(i,a){var o=n.calculateFinalUrl(i.url,a),s=e.clone(i.headers||{},!1);if(!s["Accept-Language"]&&window.widget&&window.widget.lang&&(s["Accept-Language"]=window.widget.lang),window.isIFWE){var r=i.onFailure||function(e,t){var n=t||{};!1===n.success&&n.error||(n={error:"Network Error: Unable to load widget due to network or authentication error."}),i.callback.call(this,n)},l=i.onTimeout||function(){i.callback.call(this,{error:"Network Error: Unable to load widget due to timeout error."})},d=i.onCancel||function(){i.callback.call(this,{error:"Application Error: Request canceled."})},c=t.authenticatedRequest(o,{method:i.type,type:i.dataType,proxy:"passport",timeout:5e5,cache:3600,data:i.data,onComplete:i.callback,onFailure:r,onCancel:d,onTimeout:l,headers:s});return c=c||{cancel:jQuery.noop}}},addCfgAuthoringContextToHeader:function(){var e={};if(i)try{var t=i.get();t.change.id.length>0&&(e["DS-Change-Authoring-Context"]="pid:"+t.change.id)}catch(e){}return e}};return n}),define("DS/ENOXModelApp/PCDefinition/PCStatusRulesOriginator",["UWA/Core","UWA/Class","DS/UIKIT/Mask","DS/Controls/Button","DS/Utilities/Dom","DS/WebappsUtils/WebappsUtils","DS/CollectionView/ResponsiveTilesCollectionView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/CfgSolver/CfgSolverServices","i18n!DS/ENOXModelApp/assets/nls/PCDefinition/PCDefinition"],function(e,t,i,n,a,o,s,r,l,d,c,p){"use strict";return t.singleton({init:function(){this._container=e.createElement("div",{class:"conflict-panel",styles:{height:"100%",width:"100%"}}),this._header=e.createElement("div",{class:"conflict-panel-header",styles:{display:"flex",padding:"7px"}}),this._header.inject(this._container),e.createElement("div",{html:p._pc_causing_rules,styles:{fontFamily:"Arial",fontSize:"16px",color:" #77797c",fontWeight:"bold","flex-grow":1},class:"title-conflict-panel"}).inject(this._header),this._closeAction=new n({showLabelFlag:!1,icon:{iconName:"wrong",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite"}),this._closeAction.inject(this._header);var t=this;a.addEventOnElement(this,this._closeAction,"buttonclick",function(e){e.stopPropagation(),t._privateModelEventsForSplitView.publish({event:"splitview-hide-panel",data:"right"})}),this._listSection=e.createElement("div",{class:"list-Section",styles:{height:"90%",width:"100%",position:"relative"}}),this._listSection.inject(this._container),i.mask(this._listSection),this._ResponsiveTilesCollectionView=(new s).inject(this._listSection)},render:function(e,t,n,a){this._privateModelEventsForSplitView=n;var o=new r;return this._ResponsiveTilesCollectionView.loadApplicativeModel(o),this.loadData(e,t,a).then(void 0,()=>{i.unmask(this._listSection)}),this._container},loadData:function(t,n,a){var s=this;return new Promise((p,u)=>{function h(e){d.getRuleDetailsFromIds(e.causingRules,function(e){var t=o.getWebappsAssetUrl("ENOXModelApp","icon/rules.png"),n=new r;e.member.forEach(e=>{var a=e.description;a&&" "===a&&(a="");var o=new l({label:e.title,icons:[t],thumbnail:e.image,subLabel:e.type+" | "+e.owner,description:a,multipleTitleLineNumber:!1});n.addRoot(o),i.unmask(s._listSection)}),s._ResponsiveTilesCollectionView.loadApplicativeModel(n)},function(){console.error("getRuleDetails: Service Call Failed !"),u(new Error("getRuleDetails failed"))})}a?c.getConflictingAssumptionsCausingRules(t,s.modelEvents).then(function(t){var i=JSON.parse(t)._data;e.is(i.causingRules)&&i.causingRules.length>0?h(i):(console.error("getConflictingAssumptionsCausingRules: causing rules empty !"),u(new Error("getConflictingAssumptionsCausingRules Empty")))}):c.getResultingStatusOriginators(n,t,s.modelEvents,!0).then(function(t){var i=JSON.parse(t)._data;e.is(i.causingRules)&&i.causingRules.length>0?h(i):(console.error("getResultingStatusOriginators: causing rules empty !"),u(new Error("getResultingStatusOriginators Empty")))})})}})}),define("DS/ENOXModelApp/Utils/xModelLinkManager",["UWA/Core"],function(e){"use strict";function t(){this.widgetLink=null,this.widgetToLink=null,this.linkViews=new Map,this._shouldOverrideProxy=!1,this.appName=""}let i;return t.prototype.initializeWidgetLink=function(t,i,n){return new Promise(a=>{e.is(window.top.require,"function")&&window.top.require(["DS/WidgetLink/WidgetLink","DS/Dashboard/WidgetLinkManager"],(o,s)=>{try{this.widgetLinkMgr=s,t&&(this.widgetToLink=t,this.appName=n,this.widgetLink=o.get(t),this.widgetLink.setLinkability(i),this.widgetLink.addEventListener("link",this._onLink.bind(this)),this.widgetLink.addEventListener("unlink",this._onUnLink.bind(this)))}catch(t){e.log("LinkMgr::Cannot initialize link-"+t)}a()},()=>{a()})})},t.prototype.subscribe=function(e,t){if(this.widgetLink)return this.widgetLink.subscribe(e,t)},t.prototype.unsubscribe=function(e){this.widgetLink&&this.widgetLink.unsubscribe(e)},t.prototype.publish=function(e,t){this.widgetLink&&this.widgetLink.publish(e,t)},t.prototype.getLinked=function(){if(this.widgetLink)return this.widgetLink.getLinked()},t.prototype.setLinked=function(e,t){this.widgetLink&&this.widgetLinkMgr&&this.widgetLinkMgr.setLinked(e,t)},t.prototype.getLinkedMatchedLinkability=function(){if(this.widgetLink){let e=[];return this.widgetLink.getLinked().forEach(t=>{e.push(t.matchLinkability())}),e}},t.prototype.isLinkCategoryAvailable=function(e){let t=!0,i=this.getLinkedMatchedLinkability();if(i&&i.length>0)for(let n=0;n<i.length;n++)t=-1===i[n].matchingImplements.indexOf(e);return!t},t.prototype.shouldOverrideProxy=function(){return this._shouldOverrideProxy},t.prototype._onLink=function(t){e.log("Link: "+t.link.id+" AppId: "+t.link.appId)},t.prototype._onUnLink=function(t){e.log("Unlink: "+t.link.id+" AppId: "+t.link.appId)},i||(i=new t),i}),define("DS/ENOXModelApp/Utils/xModelAppGlobalVariable",["UWA/Core","UWA/Class","DS/Windows/ImmersiveFrame","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n){"use strict";var a;return t.singleton({getImmersiveFrame:function(){return a},createImmersiveFrame:function(){a&&(e.log("[xModelAppGlobalVariable:createImmersiveFrame] Info: Destroying old Immersive Frame and creating a new one!!!"),e.is(a.destroy,"function")&&(a.destroy(),a=void 0)),a=new i({})},getCreateModelForm:function(){return{fields:[{type:"text",label:n.TITLE,placeholder:n.TITLE,name:"title"}]}}})}),define("DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd",["UWA/Core","UWA/Utils/InterCom","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i){"use strict";var n="xMdlRelatedObjects_"+(new Date).getTime();e.log("Info: COM SocketId for Related Objects Command:  "+n);var a=new t.Socket(n);a.subscribeServer("com.ds.compass",window.parent),a.addListener("launchApp",function(){});var o=function(){};return o.prototype.getCommandObject=function(){var e=this;return{id:"relatedObjects",title:i.get("RELATED_OBJECTS"),text:i.get("RELATED_OBJECTS"),fonticon:"object-related",category:"navigation",multiselect:!0,showOnSelection:!0,handler:function(t,i){let n=[];n=Array.isArray(t)?t:i,e.execute(n)}}},o.prototype.execute=function(t){if(t&&t.id||t.length){let e=[];t&&t.id?e.push(t):e=t;let o=[];e.forEach(e=>{o.push({envId:window.widget&&void 0!==window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",serviceId:"3DSpace",contextId:"",objectId:e.id,objectType:e.type?e.type:"",displayName:e.title?e.title:e.name?e.name:""})});var i={protocol:"3DXContent",version:"1.0",source:"ENXMODL_AP",appId:"ENORIPE_AP",data:{items:o}};a.dispatchEvent("onSetX3DContent",i,n),a.dispatchEvent("onLaunchApp",i,n)}else e.log("[RelatedObjectCmdHandler] Error: Either undefined or invalid input!!!")},o}),define("DS/ENOXModelApp/Utils/xCollabServices",["DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"],function(e,t){"use strict";return{updateAttribute:function(i,n,a,o){let s=null;if(UWA.is(o,"number")||UWA.is(o,"boolean"))s=[String(o)];else if(UWA.is(o,"date")){var r=o.getUTCFullYear(),l=o.getUTCMonth()+1,d=o.getUTCDate(),c=o.getUTCHours(),p=o.getUTCMinutes(),u=o.getUTCSeconds();l<10&&(l="0"+l),d<10&&(d="0"+d),c<10&&(c="0"+c),p<10&&(p="0"+p),u<10&&(u="0"+u),s=r+"/"+l+"/"+d+"@"+c+":"+p+":"+u+":GMT"}else s=o;let h="";let m={requests:[{path:"model/bus/"+i,method:"PATCH",body:[{op:"replace",path:h=/^XP_.*_Ext$/.test(n)?n+"."+a:a,value:s}],queryParams:{select:["attribute["+h+"]"]}}]};return new Promise((i,n)=>{var a={onCompleteWS:function(e){!e||e.error||0==e.success?n(e):i(e)},onComplete:n,withChange:!1,withSC:!0,securityContext:e.getSecurityContext()};t.createRequest(a,"PUT","/resources/v1/collabServices/attributes/op/update",m)})}}}),define("DS/ENOXModelApp/components/DialogAddAll/AddExistingItems",["UWA/Core","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/ENOXModelApp/assets/nls/components/DialogAddAll/AddExistingItems"],function(e,t,i,n,a,o){"use strict";return{addPrefAction:function(t,i,n){var a={addPref:t,prefValue:i};this.myDialog&&this.myDialog.close(),e.is(n.in_apps_callback,"function")&&n.in_apps_callback(a)},showDialog:function(t){var s=this,r=new e.Element("div",{class:"xmodel-add-existing-content",style:{"vertical-align":"top"},html:"<p>"+o.addExistingContent+"</p>"}),l=new e.Element("div",{class:"xmodel-add-existing-msg"}),d=new a({type:"checkbox",label:o.checkboxLabel});d.inject(l),l.inject(r);var c={Ok:new n({label:o.yesLable,touchMode:!1,allowUnsafeHTMLLabel:!1,onClick:function(){s.addPrefAction(d.checkFlag,!0,t)}}),Cancel:new n({label:o.noLable,touchMode:!1,allowUnsafeHTMLLabel:!1,onClick:function(){s.addPrefAction(d.checkFlag,!1,t)}})};s.myDialog=new i({immersiveFrame:t.immersiveFrame,title:o.addExistingLabel,content:r,activeFlag:!1,modalFlag:!0,buttons:c})}}}),define("DS/ENOXModelApp/BaseConfigDefinition/Model/BaseConfigurationModel",["UWA/Core","DS/CfgBulkTablePresenter/BulkEdition/Model/BulkTableModel"],function(e,t){"use strict";const i={Chosen:"S",Selected:"S",Available:"A",Incompatible:"N","Not Available":"N",Default:"D"},n={S:"Selected",A:"Available",N:"Not Available",D:"Default"},a={P:"Partial",C:"Complete"};return class extends t{constructor(e){super(),this.baseConfigurationCriteria=[],this.childMatrixIdMap=new Map,this._jsonModel={columnHeaders:[],rowHeaders:this.createRowHeaders(e),columnsValidity:[],matrix:[]}}createRowHeaders(t){let i=this,n=[];if(i.rowChildNo=0,i.rowParentNo=0,i._matrixId=0,e.is(t.portfolioClasses.member[0].portfolioComponents.member[0])){let a=t.portfolioClasses.member[0].portfolioComponents.member[0];if(e.is(a.variants.member)&&a.variants.member.forEach(function(e){"instance"===e.kind&&(n.push(i._formatVariantOptionGroup(e,"values")),i.rowParentNo++)}),e.is(a.variabilityGroups.member)){let e=!0;a.variabilityGroups.member.forEach(function(t){n.push(i._formatVariantOptionGroup(t,"options",e)),i.rowParentNo++})}}return n}_formatVariantOptionGroup(t,i,n){let a=this;return{id:t.id,title:t.attributes._title,type:t.attributes._type,sequenceNumber:t.attributes._sequenceNumber,mandatory:t.attributes._mandatory,image:t.attributes._image,children:function(i){let o=[];return e.is(n)?e.is(i.member)&&i.member.forEach(function(e){if("reference"===e.kind){let i=a._matrixId++;o.push({id:e.id,parentId:t.id,title:e.attributes._title,parentTitle:t.attributes._title,type:e.attributes._type,sequenceNumber:e.attributes._sequenceNumber,image:e.attributes._image,showContent:!0,matrixId:i,parentRowHeaderID:a.rowParentNo}),a.childMatrixIdMap.set(e.id,i),a.rowChildNo++}}):e.is(i.member)&&i.member.forEach(function(e){let i=a._matrixId++;o.push({id:e.idref,parentId:t.id,title:e.attributes._title,parentTitle:t.attributes._title,type:e.attributes._type,sequenceNumber:e.attributes._sequenceNumber,image:e.attributes._image,showContent:!0,matrixId:i,parentRowHeaderID:a.rowParentNo}),a.childMatrixIdMap.set(e.idref,i),a.rowChildNo++}),o}(t[i])}}convertStatusToState(e){return i[e]}updateJsonModel(t,i,n){if("solverRule"===n)for(var a=0;a<t.statesValidity.length;a++)if("C"===t.statesValidity[a]&&"N"===t.states[a]){var o=this.getVariantValues(t.constrainedValues[a].parent);this._checkConflict(o,t.statesValidity,t.states)?this._jsonModel.matrix[i][a].stateValidity=t.statesValidity[a]:a+=o.length-1}else this._jsonModel.matrix[i][a].stateValidity=t.statesValidity[a];else{var s=this.childMatrixIdMap.get(t.id),r=this.convertStatusToState(t.status);if(this._jsonModel.matrix[i][s].state=r,e.is(t.parentRowId)&&("D"===r||"S"===r)){var l=this._jsonModel.rowHeaders[t.parentRowId];if(e.is(l)&&l.children&&"Variability Group"!==l.type)for(a=0;a<l.children.length;a++){var d=l.children[a];d.id!==t.id&&"A"!==this._jsonModel.matrix[i][d.matrixId].state&&(this._jsonModel.matrix[i][d.matrixId].state="N")}}}}setDirtyColumnHeader(e){this._jsonModel.columnHeaders[e]&&!this._jsonModel.columnHeaders[e].isDirty&&(this._jsonModel.columnHeaders[e].isDirty=!0)}getSelectedCriteriaForPersistance(){for(var e=[],t=0,i=0;i<this._jsonModel.columnHeaders.length;i++)if(this._jsonModel.columnHeaders[i].isDirty){for(var[a,o]of(e.push({selectedCriteria:[]}),this.childMatrixIdMap))"N"!=this._jsonModel.matrix[i][o].state&&e[t].selectedCriteria.push({id:a,status:n[this._jsonModel.matrix[i][o].state]});t++}return e}getCompletenessStatus(){for(var e=[],t="",i=0;i<this._jsonModel.columnHeaders.length;i++)t=this._isColumnComplete(i)?a.C:a.P,e.push({completenessStatus:t});return e}_isColumnComplete(e){for(var t=[],i=0,n=0;n<this._jsonModel.rowHeaders.length;n++)if(this._jsonModel.rowHeaders[n].mandatory){i++;for(var a=0;a<this._jsonModel.rowHeaders[n].children.length;a++){var o=this._jsonModel.rowHeaders[n].children[a].id,s=this.childMatrixIdMap.get(o);if("S"===this._jsonModel.matrix[e][s].state||"D"===this._jsonModel.matrix[e][s].state){t.push(!0);break}}}return i===t.length}getJsonModelSolverFormat(t,i){let n={constrainedCriteria:[],constrainedValues:[],states:""};return t&&e.is(t.statesCauses)&&(n.statesCauses=t.statesCauses),this._jsonModel.rowHeaders.forEach(function(e){let t=e.id;n.constrainedCriteria.push({id:t}),e.children.forEach(function(e){n.constrainedValues.push({id:e.id,parent:t})})}),this._jsonModel.matrix[i].forEach(function(e){n.states=n.states.concat(e.state)}),n}getCellState(e,t){return this._jsonModel.matrix[e][t].state}getVariantValues(e){for(var t=[],i=0;i<this._jsonModel.rowHeaders.length;i++)this._jsonModel.rowHeaders[i].id===e&&(t=this._jsonModel.rowHeaders[i].children);return t}_checkConflict(e,t,i){var n=!0;if(e.length>0&&this.getRowHeaderData(e[0].parentRowHeaderID).mandatory){for(var a=0,o=0;o<e.length;o++){var s=e[o].matrixId;if("N"!==i[s]||"C"!==t[s])break;a++}n=!(e.length===a)}return n}}}),define("DS/ENOXModelApp/Utils/xModelIDCardAttributeEditor",["UWA/Core","DS/LifecycleCmd/MaturityCmd","DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd","DS/ImageManager/ImageManager","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,a){"use strict";var o=function(){};return o.prototype.init=function(e){this._idCardModelEvents=e,this._maturityInEdit=!1,this._initModelContextForLifeCycleCollabObj(),this._subscribeToEvents()},o.prototype._initModelContextForLifeCycleCollabObj=function(){this._modelContextForLifeCycleCollabCmds={_selectedItems:[],_isMultiSelectMode:!1,name:"pad_component",initialize:function(){},init:function(e){this._parent(e)},getContext:function(){return this},author:function(){return!0},getSelectedNodes:function(){return this._selectedItems},resetSelection:function(){this._selectedItems=[]},addSelection:function(t){this._selectedItems=[];var i=this;e.is(t,"array")?t.forEach(function(e){i._selectedItems.push(e)}):i._selectedItems.push(t)},getReference:function(e){return e.getID()},getParent:function(e){return e.getParent()},getType:function(e){return e.getType()},getName:function(e){return e.getLabel()}}},o.prototype.setModelAndInitCollabObj=function(e){this._modelForIdCard=e,this._setModelInLifeCycleAndCollabObject()},o.prototype._setModelInLifeCycleAndCollabObject=function(){var t=e.extend(this._modelForIdCard,{getID:function(){return this.get("id")},getLabel:function(){return this.get("name")},getOwner:function(){return this.get("owner")},getType:function(){return this.get("type")},getDisplayName:function(){return this.get("name")},object:{revision:this._modelForIdCard.get("version")}});this._modelContextForLifeCycleCollabCmds.addSelection(t)},o.prototype._subscribeToEvents=function(){var o=this;a.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){var i=o._modelForIdCard.get("id");(t&&t.data&&t.data.authored&&t.data.authored.modified?t.data.authored.modified:[]).forEach(function(t){t&&i&&i===t?(o._idCardModelEvents.publish({event:"idcard-model-refresh",data:t}),e.log("OBJECT MODIFIED !!! ")):e.log("Model Id for ID card instance is different, so refresh is not for ID Card!!!")})}),this._idCardModelEvents.subscribe({event:"idcard-thumbnail-clicked"},function(){new n({modelId:o._modelForIdCard._attributes.id,tenantId:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",events:{onPrimaryChange:function(e){o._idCardModelEvents.publish({event:"idcard-change-thumbnail",data:e.url})}}}).execute()}),this._idCardModelEvents.subscribe({event:"idcard-attributes-clicked"},function(n){if(e.log("attribute clicked.."),e.is(n.index,"number")){var a=o._modelForIdCard.get("attributes"),s=a[n.index].command,r=void 0!==a[n.index].editable&&a[n.index].editable;"MATURITY"===s&&r?(e.log("attribute clicked..maturity"),o.maturityCmd||(o.maturityCmd=new t({context:o._modelContextForLifeCycleCollabCmds,ID:"MaturityHdr"}),o.maturityCmd.executeAsync({physicalid:o._modelForIdCard.id}).then(function(){o.maturityCmd=void 0,e.log("Maturity Updated!!!")},function(){o.maturityCmd=void 0,e.log("Maturity Update failed!!!")}))):"OWNER"===s&&r&&(e.log("attribute clicked..owner"),o.changeOwnerCmd=new i({context:o._modelContextForLifeCycleCollabCmds,ID:"ActionBar_ChangeOwner"}),o.changeOwnerCmd.begin())}})},o}),define("DS/ENOXModelApp/Utils/xModelSubTypeManager",["UWA/Core","DS/UIKIT/DropdownMenu","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager"],function(e,t,i,n){"use strict";return e.Class.extend({init:function(e){this._updateChannel=e.channel,this._getSubTypesAPI=e.getSubTypesAPI,this._stdTypeDetails=e.stdTypeDetails?e.stdTypeDetails:void 0,this._subTypesExists=!1,this._mvSubTypesOrdered={},this._mvSubTypes={},this._myEventManager=new n(this._updateChannel),this._subTypesForSelection=void 0,this.parentType=e.parentType},getSubTypeFetchPromise:function(t){var i=this;return void 0===this._subTypeFetchPromise||t&&t.force?(this._subTypesForSelection=void 0,this._subTypeFetchPromise=this._getSubTypesAPI({type:i.parentType}).then(function(t){if(t&&t.types&&t.types.length>0){var n=t.types,a=t.nlsValues?t.nlsValues:{};return i._mvSubTypes={},i._mvSubTypesArr=[],n.forEach(function(e){e&&(i._mvSubTypes[e]=a[e]?a[e]:e,i._mvSubTypesArr.push(e))}),i._mvSubTypesOrdered=e.clone(i._mvSubTypes),i._subTypesExists=!0,e.Promise.resolve()}},function(){return e.log("Unable to fetch the Model Version subtypes!"),e.Promise.reject()}),this._subTypeFetchPromise):this._subTypeFetchPromise},getSubTypesForSelection:function(){var e=this;return void 0===this._subTypesForSelection&&(this._subTypesForSelection=[],Object.keys(e._mvSubTypesOrdered).forEach(function(t){e._subTypesForSelection.push({id:t,label:e._mvSubTypesOrdered[t],value:t})}),e._stdTypeDetails&&e._subTypesForSelection.unshift({id:e._stdTypeDetails.name,label:e._stdTypeDetails.nlsName,value:e._stdTypeDetails.name,select:!0,attributes:{style:"font-weight: 600;"}})),this._subTypesForSelection},getEventChannel:function(){return this._updateChannel},doesSubTypeExists:function(){return this._subTypesExists},getSubTypeLabel:function(e){return e&&this._mvSubTypes[e]?this._mvSubTypes[e]:""},getSubTypes:function(){return this._mvSubTypesArr},getSubTypesLabelMap:function(){return e.clone(this._mvSubTypes)}})}),define("DS/ENOXModelApp/InformationPanels/AttachmentsTab/js/AttachmentTabPresenter",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXAttachmentsUX/AttachmentsPane","DS/ENORIPE_Relations/views/RelationsTab","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra"],function(e,t,i,n,a,o,s){"use strict";return t.extend(i,n,{name:"attachment-tab-container",init:function(t){this._parent(t),this.elements.container=e.createElement("div",{class:"relatedDocuments"}),this._initContainer(t)},_initContainer:function(e){var t;widget&&(t=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise");var i={parentObject:{parentId:e.id},connectorOptions:{fetchSecurityContext:function(){return s.getSecurityContext()},platformUrls:{"3DSpace":s.get_3DSpaceURL(),platformId:t}},searchOptions:{types:["Document"]}};this.attachmentPanel=new a(i),this.attachmentPanel.inject(this.elements.container)}})}),define("DS/ENOXModelApp/components/DialogCreation/AutoCompleteFieldManager",["DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/PlatformAPI/PlatformAPI"],function(e,t){"use strict";var i=function(e,t){this.privateChannel=e};return i.prototype.parseData=function(e){var t=[],i={},n=[];if(e){var a=e.results;if(a&&a.length>0)for(var o=0,s=a.length;o<s;o++)if(a[o]&&a[o].attributes){for(var r=a[o].attributes,l={nlsValues:{}},d=0,c=r.length;d<c;d++)switch(r[d].name){case"physicalid":l.id=r[d].value;break;case"ds6w:label":l.title=r[d].dispValue?r[d].dispValue:r[d].value;break;case"ds6wg:revision":l.revision=r[d].value;break;case"ds6w:status":case"ds6w:what/ds6w:status":r[d].value&&r[d].value.indexOf("Build.")>-1&&(r[d].value=r[d].value.slice(r[d].value.indexOf(".")+1)),l.state=r[d].value;break;case"ds6w:responsible":case"ds6w:who/ds6w:responsible":l.owner=r[d].value;break;case"preview_url":l.image=r[d].value}n.push(l),i={},i={value:l.title+" "+l.revision,subLabel:l.responsible,picture:l.image,pid:l.id},t.push(i)}}return{items:t}},i.prototype.addAutocompleteEvent=function(e,t,i){var n=this;e.onKeyDown=function(t){var a=this.elements.input.value,o=e.options.name;a.length>=2&&n.fetchDataSet(a,o,i).then(function(t){var i={items:n.parseData(JSON.parse(t)).items,configuration:{templateEngine:function(e,t,i){e.addClassName("item-label-sublabel default-template"),e.setHTML('<img class="thumbnail" src=""/> <span class="item-label">'+i.value+"</span>"),e.getChildren()[0].src=i.picture}}};e.datasets=[],e.addDataset(i)})}},i.prototype.fetchDataSet=function(i,n,a){var o='(flattenedtaxonomies:"types/Model Type"AND(based_95_on_95_model_95_version_95_pid:('+a+"))([ds6w:label]:("+i+"*)))",s={with_indexing_date:!0,with_synthesis:!0,with_nls:!1,label:"x_mdl_app_baseConfig"+t.getUser().login+"autocomplete"+Date.now(),locale:window.widget&&window.widget.lang?window.widget.lang:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:project","ds6w:dataSource","ds6w:community"],select_file:["icon","thumbnail_2d"],query:o,refine:{},order_by:"desc",order_field:"relevance",select_snippets:["ds6w:snippet","ds6w:label:snippet","ds6w:responsible:snippet","ds6w:community:snippet","swym:message_text:snippet"],source:["3dspace"],nresults:100,start:"0",tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise"};return new UWA.Promise(function(t,i){try{var n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};n.data=JSON.stringify(s),n.onComplete=function(e){t(e)},n.onFailure=function(e){i(e)},n.onTimeout=function(e){i(e)},e.federatedSearchRequest(n)}catch(e){UWA.log("Exception occured while fetching data"+e.message),i(e.message?e.message:"Exception Occured during fetch!!")}})},i.prototype.init=function(e){},i}),define("DS/ENOXModelApp/Utils/xModelDictionaryUtility",["UWA/Core","DS/FedDictionaryAccess/FedDictionaryAccessAPI","UWA/Class","text!DS/ENOXModelApp/assets/nls/xModelDico.json"],function(e,t,i,n){"use strict";var a=i.singleton({init:function(){var e=this;this.NLS=void 0,this._i18={},this._fetchPromise={},this.xModelDictionaryUtility=JSON.parse(n),this.ListKeys=this.xModelDictionaryUtility["ds6w:status"],this.propValsElems=[],Object.keys(this.ListKeys).forEach(function(t){e.propValsElems.push({value:t,source:["3DSpace"]})})},initializeNLS:function(){var i=window.widget,n=this;t.getNlsOfPropertiesValuesBySource({"ds6w:status":this.propValsElems},{tenantId:i?i.getValue("x3dPlatformId"):"OnPremise",lang:i?i.lang:"en",onComplete:function(e){Object.keys(n.xModelDictionaryUtility["ds6w:status"]).length===Object.keys(e["ds6w:status"]).length?n.NLS=e:n.NLS=n.xModelDictionaryUtility},onFailure:function(t){e.log("Loading of NLS Dictionary has failed with :"+t)}})},getStateValue:function(){return this.NLS?this.NLS:this.xModelDictionaryUtility},fetchOrganzationNLS:async function(e){return await this._fetchNLS("ds6w:organizationResponsible",e)},allSettled:function(){return e.Promise.allSettled(Object.values(this._fetchPromise))},getOrganzationNLS:function(e){return this._i18[e]},_fetchNLS:function(i,n){var a=this;return this._i18.hasOwnProperty(n)?e.Promise.resolve():(this._fetchPromise.hasOwnProperty(n)||(this._fetchPromise[n]=new e.Promise(function(o,s){var r={};r[i]=[n],t.getNlsOfPropertiesValues(r,{tenantId:widget?widget.getValue("x3dPlatformId"):"OnPremise",lang:widget?widget.lang:"en",onComplete:function(e){a._i18[n]=e[i][n],delete a._fetchPromise[n],o(e[i][n])},onFailure:function(t){e.log(t),a._i18[n]=n,delete a._fetchPromise[n],s(n)}})})),this._fetchPromise[n])}});return a.init(),a}),define("DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromConstants",["UWA/Core","UWA/Class","text!DS/ENOXModelApp/assets/ModelCopyFromConstants.json"],function(e,t,i){"use strict";var n=window.localStorage.XMODEL_BROWSER_LOG_DEBUG,a=JSON.parse(i),o=t.extend({init:function(){e.extend(this,a),e.log("ModelVersion Copy From Constants init!!")},consoleLogger:function(t,i){!0!==n&&"true"!==n&&!0!==i||(t=t||"",e.log(t))}}).singleton({});return o.init(),o}),define("DS/ENOXModelApp/InformationPanels/ModelsTab/js/ModelTabPresenter",["UWA/Core","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/facets/Common/PropertiesDerived","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropModel","DS/i3DXCompassPlatformServices/OpenWith","DS/LifecycleCmd/MaturityCmd","DS/Menu/Menu"],function(e,t,i,n,a,o,s,r){"use strict";return i.extend({metatype:"businessobject",init:function(e){this.objectId=e.id,this.objectTitle=e.title,this.eventChannel=e.eventChannel,this.modelVersionData=e.modelVersionData,this._parent.apply(this,arguments)},setOccurrence:function(e){let t={targets:[{id:this.objectId}]};e&&e.setOptions(this.getTabId(),t),this._parent(e)},onSave:function(){if(this._parent.apply(this,arguments),this.eventChannel&&this.modelVersionData){var e=this.editPropertiesUI.validateModel(),t=this.getModel();if(e){var i=t.changedValues;for(var n in i)"Marketing Name"===n&&(this.modelVersionData.modelTitle=i[n].value,this.eventChannel.publish({event:"xmodel-list-data-item-update-action",data:this.modelVersionData}))}}},onAction:function(e){switch(e){case"Maturity":this._handleMaurityCommand();break;case"OpenWith":this._handleOpenWithCommand(event.target.getOffsets());break;default:this._parent.apply(this,arguments)}},_handleMaurityCommand:function(){var t=this;let i=[];i.push({physicalid:t.objectId,displayName:t.objectTitle}),t._maturityCmd||(t._maturityCmd=new s({context:i,ID:"MaturityHdr"}),t._maturityCmd.executeAsync(i).then(function(){t._maturityCmd=void 0,e.log("Maturity Updated!!!")},function(){t._maturityCmd=void 0,e.log("Maturity Update failed!!!")}))},_handleOpenWithCommand:function(e){var t=[];(new o).set3DXContent(this._getDragInfo([{objectId:this.objectId,objectType:"Model",displayName:this.objectTitle}])).retrieveCompatibleApps(function(i){i.length>0&&i.forEach(function(e){let i={name:e.text,type:"PushItem",title:e.text,icon:e.icon,action:{callback:function(t){e.handler.call(t)}}};e.fonticon?i.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:i.icon=e.icon,t.push(i)}),r.show(t,{position:{x:e.x,y:e.y},touchMode:!1,submenu:"outside"})},function(){})},_getDragInfo:function(e){return e=e.map(function(e){return{envId:window.widget&&void 0!==window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",serviceId:"3DSpace",contextId:"",objectId:e.objectId,objectType:e.objectType,displayType:e.displayType,displayName:e.displayName}}),{protocol:"3DXContent",version:"1.1",source:"ENXMODL_AP",widget_id:window.widget.id,data:{items:e}}}})}),define("DS/ENOXModelApp/RoadMap/EnoxRoadmapControllerConstants",["UWA/Core","i18n!DS/ENOXModelApp/assets/nls/RoadMap/EnoxModelRoadMap"],function(e,t){"use strict";return{TYPE:"Products",REQTYPE:"Requirement",DSPFLMODEL:"dspfl:Model",DSPFLMODELVERSION:"dspfl:ModelVersion",RICESCORINGMODEL:"ScoringModel_RICE",VALUEEFFORTMODEL:"ScoringModel_ValueEffort",SCORINGMODELATTRBMAP:{ScoringModel_RICE:"riceScore",ScoringModel_ValueEffort:"valueeffortScore"},VIEWID:{COMPACTVIEW:0,FULLVIEW:1},SCORINGMODELMAPPING:[{ScoringModel_RICE:{attributes:["riceReach","riceImpact","riceConfidence","riceEffort","riceScore"],editableAttributes:["riceReach","riceImpact","riceConfidence","riceEffort"],columnDefinition:{columns:[{text:t.reach,dataIndex:"riceReach",typeRepresentation:"number",editionPolicy:"EditionInPlace",step:1,min:1,readOnly:!1,visibleFlag:!1,helperText:t.constraints+" : "+t.minValue+" - 1",errorText:t.noValueError+" "+t.reach},{text:t.impact,dataIndex:"riceImpact",typeRepresentation:"impactDropdown",editionPolicy:"EditionInPlace",readOnly:!1,visibleFlag:!1,helperText:t.selectAValue,errorText:t.noValueError+" "+t.impact,possibleValues:[{value:"0.25",label:"0.25"},{value:"0.5",label:"0.5"},{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"}]},{text:t.confidence,dataIndex:"riceConfidence",typeRepresentation:"boundedNumber",editionPolicy:"EditionInPlace",step:1,min:1,max:100,readOnly:!1,visibleFlag:!1,helperText:t.constraints+" : "+t.minValue+" - 1, "+t.maxValue+" - 100.",errorText:t.noValueError+" "+t.confidence},{text:t.effort,dataIndex:"riceEffort",typeRepresentation:"effortDropdown",editionPolicy:"EditionInPlace",readOnly:!1,visibleFlag:!1,possibleValues:[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"}],helperText:t.selectAValue,errorText:t.noValueError+" "+t.effort},{text:t.score,dataIndex:"riceScore",typeRepresentation:"number",editableFlag:!1,readOnly:!0,visibleFlag:!1}],typeRepresentation:{}},calculateScore:function(i){if(e.is(i.bItemScores.scoringValues)){let e=i.bItemScores.scoringValues,o=parseFloat(e.riceReach),s=parseFloat(e.riceImpact),r=parseFloat(e.riceConfidence),l=parseFloat(e.riceEffort);if(l>0&&s>=0&&o>=0&&r>=0){let t=o*s*r/(100*l);e.riceScore=parseFloat((n=t,a=new RegExp("^-?\\d+(?:.\\d{0,"+(2||-1)+"})?"),n.toString().match(a)[0]))}else window.notifs.addNotif({level:"error",title:t.errorScoringAttrbValueZero});return e}var n,a;return{}}}},{ScoringModel_ValueEffort:{attributes:["valueeffortValue","valueeffortEffort","valueeffortScore"],editableAttributes:["valueeffortValue","valueeffortEffort"],columnDefinition:{columns:[{text:t.value,dataIndex:"valueeffortValue",typeRepresentation:"number",editionPolicy:"EditionInPlace",step:1,readOnly:!1,min:1,max:100,visibleFlag:!1,helperText:t.constraints+" : "+t.minValue+" - 1, "+t.maxValue+" - 100.",errorText:t.noValueError+" "+t.value},{text:t.effort,dataIndex:"valueeffortEffort",typeRepresentation:"effortDropdown",editionPolicy:"EditionInPlace",step:1,readOnly:!1,min:1,max:5,visibleFlag:!1,possibleValues:[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"}],helperText:t.selectAValue,errorText:t.noValueError+" "+t.effort},{text:t.score,dataIndex:"valueeffortScore",typeRepresentation:"number",editableFlag:!1,readOnly:!0,visibleFlag:!1}],typeRepresentation:{}},calculateScore:function(i){if(e.is(i.bItemScores.scoringValues)){let e=i.bItemScores.scoringValues,o=parseFloat(e.valueeffortValue),s=parseFloat(e.valueeffortEffort);if(o>0&&s>0){let t=o/s;e.valueeffortScore=parseFloat((n=t,a=new RegExp("^-?\\d+(?:.\\d{0,"+(2||-1)+"})?"),n.toString().match(a)[0]))}else window.notifs.addNotif({level:"error",title:t.errorScoringAttrbValueZero});return e}var n,a;return{}}}}],DEFAULTATTRIBUTESFORSORTING:[{id:"title",text:t.TITLE,type:"string"},{id:"created",text:t.creationDate,type:"date"},{id:"modified",text:t.modificationDate,type:"date"}],RICEATTRIBUTESFORSORTING:[{id:"riceReach",text:t.reach,type:"integer"},{id:"riceImpact",text:t.impact,type:"integer"},{id:"riceConfidence",text:t.confidence,type:"integer"},{id:"riceEffort",text:t.effort,type:"integer"},{id:"riceScore",text:t.score,type:"integer"}],VEATTRIBUTESFORSORTING:[{id:"valueeffortValue",text:t.value,type:"integer"},{id:"valueeffortEffort",text:t.effort,type:"integer"},{id:"valueeffortScore",text:t.score,type:"integer"}],AVAILABLESCORINGMODELS:[{value:"ScoringModel_ValueEffort",label:t.veScoringModel},{value:"ScoringModel_RICE",label:t.riceScoringModel}],TYPEREPRESENTATION:{impactDropdown:{stdTemplate:"comboSelector",semantics:{possibleValues:["0.25","0.5","1","2","3"]}},effortDropdown:{stdTemplate:"comboSelector",semantics:{possibleValues:["1","2","3","4","5"]}}},CLASSIFICATIONFIELDS:[{label:t.FUNCTIONAL,value:"Functional",selected:!0},{label:t.NON_FUNCTIONAL,value:"Non-Functional"}],allowedTypes:[]}}),define("DS/ENOXModelApp/xModelApp/xParameter",["UWA/Core","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xDimensionManager/xUnitConverter"],function(e,t,i){"use strict";return{_dimensions:{},initialize:function(){var n=this,a={name:"PARAMETER_UNIT",units:{}};t.getAllDimension().then(function(t){for(var o in t)t.hasOwnProperty(o)&&(n._dimensions[o]={},t[o].forEach(function(t){var i=t.multiplier;e.is(i,"string")&&(i=parseFloat(i)),n._dimensions[o][t.name]=i,a.units[t.name]=i}));i.initialize(a)},function(){e.log("unable to load dimensions..")})},getDimensions:function(){return this._dimensions}}}),define("DS/ENOXModelApp/InformationPanels/ProjectsTab/js/ProjectsTabPresenter",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/comm/EventManager"],function(e,t,i,n,a){"use strict";return t.extend(i,n,{name:"projects-tab-container",init:function(t){if(this._parent(t),!e.is(this.options.RelatedProjectsManager))throw Error("Dependency not fulfilled !");this._eventManagerOptions=[],this._isEditable=!1!==t.isEditable,this._initContainer(),this._isLoaded=!1,this.flag=[],this._ProjectsTabContainer=t.ProjectsTabContainer},_initContainer:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this._isEditable||this.elements.container.addClassName("disable-actions")},_subscribeEvents:function(){this._eventManagerOptions.forEach(function(e){a.subscribe(e.eventName,e.callback)})},_unsubscribeEvents:function(){this._eventManagerOptions.forEach(function(e){a.remove(e.eventName,e.callback)}),this._eventManagerOptions=[],this._eventManager&&this._eventManager.cleanup()},updateFacet:function(){this._subscribeEvents(),this._isLoaded=!1,this._isLoading=!1,this.setModel(this.getModel())},hide:function(){this._parent.apply(this,arguments),this._unsubscribeEvents()},show:function(){this._parent.apply(this,arguments),this._unsubscribeEvents(),this._subscribeEvents(),this.elements.container.empty(),this.options.RelatedProjectsManager.getMainContainer().inject(this.elements.container),a.publish("projects-"+this.getTabId()+"-on-show")},setModel:function(e){this._id=e.get("objectId");var t="Products";"string"==typeof e.get("type")?t=e.get("type"):"object"==typeof e.get("type")&&(t=e.get("type").valueDB),this.options.RelatedProjectsManager.set({id:e.get("objectId"),title:e.get("Marketing Name")?e.get("Marketing Name").value+" "+e.get("revision").value:e.get("label"),image:e.get("previewUrl"),type:t,serviceId:"3DSpace"})},destroyComponent:function(){this.elements.container="",this._unsubscribeEvents(),this._eventManager&&this._eventManager.cleanup()}})}),define("DS/ENOXModelApp/Utils/xModelAccessUtility",["UWA/Core","UWA/Class","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","i18n!DS/ENOXModelApp/assets/nls/xModelAccess","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n,a,o){"use strict";var s=t.singleton({init:function(){this._init()},_init:function(){this.userRole="",this.parentType="",this.parentState="",this.childType="",this.childState="",this.currentTab="",this.NLS_TYPE_MAP={"Product Configuration":o.TYPE_PRODUCTCONFIURATION,Products:o.TYPE_MODELVERSION,Parameter:o.TYPE_PARAMETER,Variant:o.TYPE_VARIANT,"Option Group":o.TYPE_OPTION_GROUP,Value:o.TYPE_VARIANT_VALUE,Option:o.TYPE_OPTION,"Matrix Rule":o.TYPE_MATRIX_RULE,"Expression Rule":o.TYPE_EXPRESSION_RULE,Rule:o._RULE,"Configuration Rule":o._RULE,Variability:o._VARIABILITY,Requirement:o.TYPE_REQUIREMENT,Plan:o.TYPE_PLAN,"Product Specification":o.TYPE_PRODUCT_SPEC},this.NLS_STATE_MAP={Obsolete:a.state_obsolete,Release:a.state_release,Review:""},this.readAccess={create:!1,derive:!1,revise:!1,delete:!1,remove:!1,addExisting:!1,upload:!1,modify:!1,information:!1,save:!1,move:!1,share:!1,copyFrom:!1,editDetails:!1,duplicate:!1},this.writeAccess={create:!0,derive:!0,revise:!0,delete:!0,remove:!0,addExisting:!0,upload:!0,modify:!0,information:!0,save:!0,move:!0,share:!0,copyFrom:!0,editDetails:!0,duplicate:!0}},setParent:function(e){this.parentType=e.type,this.parentState=e.state},setUserRole:function(e){this.userRole=e},setcurrentTab:function(e){this.currentTab=e},_checkActionAccessBasedOnUserRole:function(e){return this._definedUserRoleAccess(this.userRole,e)[e]},_getErrorMessagesBasedOnUserRole:function(e,t,n){var o,s;switch(e){case"create":o=a.creation_error_title,s=a.error_credentials_description_creation;break;case"delete":o=a.deletion_error_title,s=a.error_credentials_description_deletion;break;case"remove":o=a.remove_error_title,s=a.error_credentials_description_remove;break;case"addExisting":o=a.addExisting_error_title,s=a.error_credentials_description_addExisting;break;case"upload":o=a.upload_error_title,s=a.error_credentials_description_upload;break;case"copyFrom":o=a.copyFrom_error_title,s=a.error_credentials_description_copyFrom;break;case"save":o=a.save_error_title,s=a.error_credentials_description_save;break;case"move":o=a.move_error_title,s=a.error_credentials_description_move;break;case"share":o=a.share_error_title,s=a.error_credentials_description_share;break;case"derive":o=a.derive_error_title,s=a.error_credentials_description_share;break;case"revise":o=a.revise_error_title,s=a.error_credentials_description_share;break;case"editDetails":s=a.error_credentials_description_editDetails;break;default:o=a.default_err_message,s=a.error_credentials_description}n&&n.showWarning?i.showWarning(s):i.showError({title:o+(this.childType?" : "+this.NLS_TYPE_MAP[this.childType]:""),subtitle:a.error_subtitle_credentials,message:s})},getErrorMessage:function(e){var t,n,o;t=a.creation_error_title+" : "+this.NLS_TYPE_MAP[e],"Variant"===this.childType?(n=a.error_subtitle_frozenVariant,o=a.error_description_frozenVariant):"Variability Group"===this.childType||"Option Group"===this.childType?(n=a.error_subtitle_frozenOG,o=a.error_description_frozenOG):(n=a.error_child_obsolete,o=a.error_child_desc),i.showError({title:t,subtitle:n,message:o})},_getErrorMessageBasedOnParentMaturity:function(e,t,o){var s,r,l="",d="",c="";switch(e){case"create":l=a.creation_error_title;break;case"delete":l=a.deletion_error_title;break;case"remove":l=a.remove_error_title;break;case"derive":l=a.derive_error_title;break;case"revise":l=a.revise_error_title;break;case"editDetails":r=a.edit_details_warning_parent;break;case"duplicate":l=a.duplicate_error_title;break;default:l=a.default_err_message}if(o&&o.showWarning)i.showWarning(r);else{var p="";"Products"===this.parentType?(this.parentState&&this.NLS_STATE_MAP[this.parentState]&&(p="("+this.NLS_STATE_MAP[this.parentState]+")"),l+=this.childType?" : "+this.NLS_TYPE_MAP[this.childType]:"",c=a.error_subtitle_frozenMV,d=a.error_description_frozenMV+p+"."):"Variant"===this.parentType?(this.parentState&&this.NLS_STATE_MAP[this.parentState]&&(p="("+this.NLS_STATE_MAP[this.parentState]+")"),l=l+" : "+this.NLS_TYPE_MAP[n.TYPE_VALUE],c=a.error_subtitle_frozenVariant,d=a.error_description_frozenVariant+p+"."):"Variability Group"===this.parentType&&(this.parentState&&this.NLS_STATE_MAP[this.parentState]&&(p="("+this.NLS_STATE_MAP[this.parentState]+")"),l=l+" : "+this.NLS_TYPE_MAP[n.TYPE_OPTION],c=a.error_subtitle_frozenOG,d=a.error_description_frozenOG+p+"."),s={title:l,subtitle:c,message:d},i.showError(s)}},_getErrorMessageBasedOnChild:function(t,n,o,s){var r,l="";switch(l=n?"("+n+").":".",t){case"delete":r=a.deletion_error_title;break;case"editDetails":r=e.String.format(a.edit_details_warning_child,n);break;default:r=a.default_err_message}if(s&&s.showWarning)i.showWarning(r);else{var d={title:r+(this.childType?" : "+this.NLS_TYPE_MAP[this.childType]:""),subtitle:a.error_child_obsolete,message:a.error_child_desc+l};i.showError(d)}},_checkActionAccessBasedOnParent:function(e){return this._definedTabAccess()[e]},_checkActionAccessBasedOnChild:function(){if(this.childType&&this.childState)switch(this.childState){case"Obsolete":case"Inactive":case"Archived":case"Release":case"Review":return!1;case"Active":return this.childType!==n.TYPE_PC;default:return!0}},getUserAccessAuthor:function(t){var i;switch(t){case"create":i=this.childType===n.TYPE_MV||this.childType===n.TYPE_PC||this.childType===n.TYPE_PLAN}return e.merge({create:i,editDetails:!1,copyFrom:!1},this.writeAccess)},_definedUserRoleAccess:function(t,i){switch(t){case"VPLMLeader":return this.writeAccess;case"VPLMViewer":return this.readAccess;case"VPLMExperimenter":return e.merge({modify:!0,upload:!0,move:!0,share:!0},this.readAccess);case"VPLMCreator":return this.getUserAccessAuthor(i);default:return this.writeAccess}},_disableActionsForFrozenStates:function(){switch(this.parentState){case"Review":case"Release":case"Obsolete":return this.readAccess;default:return this.writeAccess}},_disableActions_Pc:function(){switch(this.parentState){case"Review":case"Release":return e.merge({create:!0,editDetails:!0},this.readAccess);case"Obsolete":return this.readAccess;default:return this.writeAccess}},_disableActions_MFPlan:function(){switch(this.parentState){case"Review":case"Release":return e.merge({create:!0,delete:"true",derive:!0,revise:!0},this.readAccess);case"Obsolete":return this.readAccess;default:return this.writeAccess}},_definedTabAccess:function(){switch(this.currentTab){case"ManufacturingPlans":return this._disableActions_MFPlan();case"ProductConfigurations":return this._disableActions_Pc();default:return this._disableActionsForFrozenStates()}},checkActionAccess:function(e){var t=e.action;this.childType=e.type,this.childState=e.state;var i=e.notify,n=e.warning,a=e.nlsState;return this._checkActionAccessBasedOnUserRole(t)?"modify"===t?this._checkActionAccessBasedOnChild():this._checkActionAccessBasedOnParent(t)?!this.childState||"delete"!==t&&"editDetails"!==t||(!!this._checkActionAccessBasedOnChild()||(i?this._getErrorMessageBasedOnChild(t,a):n&&this._getErrorMessageBasedOnChild(t,a,this.childType,{showWarning:!0}),!1)):(i?this._getErrorMessageBasedOnParentMaturity(t,this.childType):n&&this._getErrorMessageBasedOnParentMaturity(t,this.childType,{showWarning:!0}),!1):(i?this._getErrorMessagesBasedOnUserRole(t,this.childType):n&&this._getErrorMessagesBasedOnUserRole(t,this.childType,{showWarning:!0}),!1)},destroy:function(){this.parentType="",this.parentState="",this.childType="",this.childState="",this.currentTab=""}});return s.init(),s}),define("DS/ENOXModelApp/InformationPanels/ContentTab/js/ContentTabPresenter",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/comm/EventManager","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/CKEditor/CKEditor","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","i18n!DS/ENOXModelApp/assets/nls/InformationPanels/contentTabPresenter","css!DS/ENOXModelApp/InformationPanels/ContentTab/css/ContentTabPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p){"use strict";return t.extend(i,n,{name:"content-tab-presenter",init:function(e){this._parent(e),this._ckEditor,this._isEditorReady=!1,this._isVisible=!1,this._contentData={},this._eventManagerOptions=[],this._initContainer(),this._isLoaded=!1},_initContainer:function(){var t=this;this.elements.container=e.createElement("div");var i=e.createElement("div",{class:"content-tab-container"});this._textContainer=e.createElement("div",{class:"rich-object-content"}),this._saveButton=new r({value:p._save,className:"primary"}),this._cancelButton=new r({value:p._cancel}),this._actionDiv=e.createElement("div",{class:"content-actions-container",html:[this._saveButton,this._cancelButton]}),this._textEditor=new s({multiline:!0,rows:4,className:"ckeEditor-textarea"});var n=o.getWebappsBaseUrl()+"VENREQPlugins/External/ckeditor";for(var a in this._customConfig=n+"/config.js",this._toolbar="Rich",this._plugins={sharedspace:n+"/plugins/sharedspace/",colorbutton:n+"/plugins/colorbutton/",panelbutton:n+"/plugins/panelbutton/",quicktable:n+"/plugins/quicktable/",base64image:n+"/plugins/base64image/",selectall:n+"/plugins/selectall/"},this._extraPlugins="",this._plugins)this._extraPlugins+=a+",";this._extraPlugins=this._extraPlugins.slice(0,-1),this.defaultEditorOptions={skin:"office2013,"+n+"/skins/office2013/",customConfig:t._customConfig,extraPlugins:t._extraPlugins,toolbar:t._toolbar,language:window.widget?window.widget.lang:"en",height:"100%",startupFocus:!0,resize_enabled:!1,on:{instanceReady:function(){t._isEditorReady=!0,t.loadStart()}}},this._textEditor.inject(i),this._textContainer.inject(i),this._actionDiv.inject(i),i.inject(this.elements.container)},onError:function(t){e.log(t)},saveAction:function(){if(d.checkActionAccess({action:c.SAVE,type:c.TYPE_REQUIREMENT,notify:!0})){e.log("on Save");var t=this._ckEditor;if(t){var i=t.getData().trim(),n={contentData:i.trim().replace(/\n/g,""),contentText:(o=i.trim(),(s=document.createElement("div")).innerHTML=o,s.textContent||s.innerText),contentType:"html"};a.publish("requirement-"+this.getTabId()+"-save-action",{id:this._id,attributes:n})}}else a.publish("requirement-"+this.getTabId()+"-cancel-action",{id:this._id});var o,s},cancelAction:function(){e.log("On Cancel"),a.publish("requirement-"+this.getTabId()+"-cancel-action",{id:this._id})},_subscribeEvents:function(){var e=this,t="requirement-"+this.getTabId();e._eventManagerOptions.push({eventName:t+"-load-action",callback:function(t){e.loadData(t),e._isLoading=!1}}),e._eventManagerOptions.push({eventName:t+"-cancel-action",callback:function(){}}),this._eventManagerOptions.forEach(function(e){a.subscribe(e.eventName,e.callback)}),this._saveButton&&this._cancelButton&&this._textEditor&&(this._saveButton.addEvent("onClick",function(){e.saveAction()}),this._cancelButton.addEvent("onClick",function(){e.cancelAction()}),this._textEditor.addEvent("onInjected",function(){e._ckEditor&&(e._textContainer.setContent(""),e._ckEditor=null,e._isLoaded=!1),e._ckEditor=l.appendTo(e._textContainer,e.defaultEditorOptions)}))},_unsubscribeEvents:function(){this._eventManagerOptions.forEach(function(e){a.remove(e.eventName,e.callback)}),this._eventManagerOptions=[],this._saveButton&&this._cancelButton&&this._textEditor&&(this._saveButton.removeEvent("onClick"),this._cancelButton.removeEvent("onClick"),this._textEditor.removeEvent("onInjected"))},loadStart:function(){this._isLoaded||this._isLoading||!this._isVisible||this._ckEditor&&this._isEditorReady&&this._id&&(this._isLoading=!0,this.showLoader(),a.publish("requirement-"+this.getTabId()+"-load-data-start",this._id))},loadData:function(e){this._isLoaded=!0;var t=this._ckEditor,i=e&&e.contentData||"";t?t.setData(i):this._contentData[this._id]=i,this.hideLoader()},updateFacet:function(){this._id=null,this._ckEditor=null,this._subscribeEvents(),this._isLoaded=!1,this._isLoading=!1,this.setModel(this.getModel())},hide:function(){this._parent.apply(this,arguments),this._isVisible=!1,this._unsubscribeEvents()},show:function(){this._parent.apply(this,arguments),this._isVisible=!0,this._unsubscribeEvents(),this._subscribeEvents(),this.loadStart()},setModel:function(e){this._id=e.get("objectId")},destroyComponent:function(){this._unsubscribeEvents(),this._id=null,this._contentData={},this._ckEditor=null,this._isEditorReady=!1,this._isVisible=!1,this._isLoaded=!1,this._eventManagerOptions=[],this.getUI().remove()}})}),define("DS/ENOXModelApp/Utils/xModelCommand",["UWA/Core","DS/PADUtils/PADContext","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/LifecycleCmd/MaturityCmd","DS/LifecycleCmd/ReviseCmd","DS/LifecycleCmd/NewBranchCmd","DS/EditPropWidget/EditPropComponent","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd","DS/ENOCollabSharingCmds/commands/AccessRightCmd/ActionBar_AccessRightCmd","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOCollabSharingCmds/commands/ReserveCmd/ActionBar_ReserveCmd","DS/ENOCollabSharingCmds/commands/UnreserveCmd/ActionBar_UnreserveCmd"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b){"use strict";var E=function(e,t,i){if(!e)throw new Error("xModelCommand did not received Model Event Object!!");this._applicationChannel=i,this._modelEvent=e,this._maturityCmd=void 0,this._reviseCmd=void 0,this._newBranchCmd=void 0,this._ownerCmd=void 0,this._shareAccessCmd=void 0,this._editPropCmd=void 0,this.caEditComp=void 0,this._reserveCmd=void 0,this._unreserveCmd=void 0,this._myEventManager=new n(this._modelEvent),t&&(this._container=t),this._subscribeToEvents()};return E.prototype._subscribeToEvents=function(){var t=this;this._modelEvent&&this._myEventManager.subscribe(this._modelEvent,{event:"xmodel-execute-command"},function(i){if(i){var n=i.model,a=i.linkId?i.linkId:void 0;let o=[];switch(a){case"state":case"maturity":t._handleMaurityCommand(n);break;case"owner":t._handleChangeOwnerCommand(n);break;case"revision":t._handelRevisionCommand(n);break;case"shareAccess":t._handleShareAccessCommand(n);break;case"newRevision":t._handleNewRevisionCommand(n);break;case"newBranch":t._handleNewBranchCommand(n);break;case"compare":t._handleCompareCommand(n);break;case"ProductConfiguration":t._handleProductConfigurationCommand(n);break;case"ManufacturingPlan":t._handleManufacturingPlanCommand(n);break;case"modelVersion":t._handleMVPropertiesCommand(n);break;case"productConfiguration":t._handlePCPropertiesCommand(n);break;case"manufacturingPlan":t._handleMPPropertiesCommand(n);break;case"changeImpacts":t._handleChangeImpactsCommand(n);break;case"modelName":t._handleModelPropertiesCommand(n);break;case"subscribe":o.push(n),t._handleSubscriptionCommands(o,"Subscribe");break;case"unsubscribe":o.push(n),t._handleSubscriptionCommands(o,"UnSubscribe");break;case"editSubscriptions":o.push(n),t._handleSubscriptionCommands(o,"EditSubscribe");break;case"mySubscriptions":o.push(n),t._handleSubscriptionCommands(o,"MySubscriptions");break;default:e.log("Wrong Command: "+a)}}})},E.prototype._handleMaurityCommand=function(t){var i=this;if(t){let n=[];if(t&&!t.length&&(n.push(t),t=n),!i._maturityCmd){i._maturityCmd=new s({context:t,ID:"MaturityHdr"});t.forEach(e=>{e.physicalid=e["@id"]?e["@id"]:e.id,e.displayName=e.title?e.title:e.name}),i._maturityCmd.executeAsync(t).then(function(){i._maturityCmd=void 0,e.log("Maturity Updated!!!")},function(){i._maturityCmd=void 0,e.log("Maturity Update failed!!!")})}}else e.log("_handleMaurityCommand : Invalid model...")},E.prototype._handleMVPropertiesCommand=function(e){e.modelVersion&&e.modelVersion.identifier?this._handlePropertiesCommand(e.modelVersion.identifier):console.log("Model Version ID missing")},E.prototype._handleModelPropertiesCommand=function(e){e.id?this._applicationChannel.publish({event:"information-panel-open",data:{facetName:"modelFacet",readOnly:!1}}):console.log("Model ID missing")},E.prototype._handlePCPropertiesCommand=function(e){e.productConfiguration&&e.productConfiguration.identifier?this._handlePropertiesCommand(e.productConfiguration.identifier):console.log("Product Configuration ID missing")},E.prototype._handleMPPropertiesCommand=function(e){e.manufacturingPlan&&e.manufacturingPlan.identifier?this._handlePropertiesCommand(e.manufacturingPlan.identifier):console.log("Manufacturing Plan ID missing")},E.prototype._handlePropertiesCommand=function(e){var t=[];this.caEditComp=new d({typeOfDisplay:c.ALL,selectionType:c.ALL_SELECTION,displayType:c.POPUP,setCloseButton:!1,readOnly:!0,extraNotif:!1,editMode:!1}),this.selection=new p({tenant:window.widget&&window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",objectId:e,source:"3DSpace",metatype:"businessobject"}),t.push(this.selection),this.caEditComp.show(t)},E.prototype._handleProductConfigurationCommand=function(e){a.navigate(o.ROUTE_MODEL_PC_DETAILS,{id:e.id,name:e.title,modelVersionId:that._modelVersionId,modelVersionName:that._modelVersionName,modelVersion:that._modelVersion,modelName:that._modelName})},E.prototype._handleModelVersionCommand=function(e){e.sourceName="3DSpace"},E.prototype._handleManufacturingPlanCommand=function(e){a.navigate(o.ROUTE_MODEL_PC_DETAILS,{id:e.id,name:e.title,modelVersionId:that._modelVersionId,modelVersionName:that._modelVersionName,modelVersion:that._modelVersion,modelName:that._modelName})},E.prototype._handleNewRevisionCommand=function(t){let i=[],n=[];t&&!t.length&&(n.push(t),t=n),(i=this._extendModelForCommands(t))?(this._reviseCmd=new r({context:{getSelectedNodes:function(){return i}},ID:"RevisionHdr"}),this._reviseCmd.execute()):e.log("_handleNewRevisionCommand : Invalid model...")},E.prototype._handleNewBranchCommand=function(t){let i=[],n=[];t&&!t.length&&(n.push(t),t=n),t.forEach(e=>{var t={physicalid:e["@id"]||e.id,id:e["@id"]||e.id,displayName:e.title,revision:e.revision,type:e.type,selectedNodes:e,name:e.name,displayNotification:function(e){"error"===e.eventID?f.showError(e.msg):"success"===e.eventID&&f.showSuccess(e.msg)}};i.push(t)}),i?(this._newBranchCmd=new l({context:i,ID:"NewBranchHdr"}),this._newBranchCmd.execute(i)):e.log("_handleNewBranchCommand : Invalid model...")},E.prototype._handleChangeOwnerCommand=function(i){t.reset();let n=[];i&&!i.length&&(n.push(i),i=n);var a=this._extendModelForCommands(i);a?(this._ownerCmd=new u({context:{getSelectedNodes:()=>a},ID:"ActionBar_ChangeOwner"}),this._ownerCmd.begin()):e.log("Error!! handelChangeOwner : Invalid model...")},E.prototype._handleShareAccessCommand=function(t){let i=[];t&&!t.length&&(i.push(t),t=i);var n=this._extendModelForCommands(t);n?(this._shareAccessCmd=new h({context:{getSelectedNodes:()=>n}}),this._shareAccessCmd.begin()):e.log("Error!! handleShareAccessCommand : Invalid model...")},E.prototype._handleCompareCommand=function(t){var i=[],n=window.widget&&window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise";if(e.is(t,"array"))for(var a in t){var o=t[a],s={envId:n,serviceId:"3DSpace",contextId:v.getSecurityContext(),objectId:o.id,objectType:o.type,objectName:o.modelName,displayType:o.type,displayName:o.name};"Model Version"==o.type&&(s.objectType="Products"),i.push(s)}else{s={envId:n,serviceId:"3DSpace",contextId:v.getSecurityContext(),objectId:t.id,objectType:t.type,objectName:t.modelName,displayType:t.type,displayName:t.name};"Model Version"==t.type&&(s.objectType="Products"),i.push(s)}if(i.length>0){var r={envId:n,version:"1.1",source:"ENXMODL_AP",widgetId:window.widget&&window.widget.id?window.widget.id:"",data:{items:i}};require(["UWA/Utils/InterCom"],function(e){var t=new e.Socket("compassPageSocket");t.subscribeServer("com.ds.compass",window.parent),t.dispatchEvent("onSetX3DContent",r,"compassPageSocket"),t.dispatchEvent("onLaunchApp",{appId:"ENOCOMP_AP"},"compassPageSocket")})}},E.prototype._handelRevisionCommand=function(t,i){t?(this.versionExplorer=new _({id:t["@id"]||t.id,renderTo:this._container,modelEvents:this._modelEvent,applicationChannel:this._applicationChannel,name:t.name,selectionMode:i&&i.selectionMode?i.selectionMode:void 0}),this.versionExplorer.showVersionExplorer()):e.log("xModelCommand Version Explorer : Invalid model...")},E.prototype._destroy=function(){this._myEventManager&&(this._myEventManager.cleanup("xModelCommand"),this._myEventManager=null)},E.prototype._handleChangeImpactsCommand=function(t){require(["DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/ENOChgActionCMDs/scripts/Commands/ChgChangeImpacts"],function(i,n){var a=window.widget&&window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",o=v.getSecurityContext(),s="",r=(s=e.is(t,"array")?t[0].grid:t).id,l=s.title?s.title:s.name,d=s.revision?s.revision:s.version,c=s.type;e.log("UWA tenantID: "+a+", securityContext: "+o+", contextId: "+r),console.log("UWA tenantID: "+a+", securityContext: "+o+", contextId: "+r),i.setTenant(a),i.setSecurityContext(o),i.clearObjects(),i.addObjectForImpact(r),i.setChangeImpactsLabel(l),i.setChangeImpactsRevision(d),i.setChangeImpactsObjectType&&i.setChangeImpactsServiceID&&(i.setChangeImpactsObjectType(c),i.setChangeImpactsServiceID("3DSpace")),n.prototype.execute()})},E.prototype._handleSubscriptionCommands=function(t,i){require(["DS/ENOSubscriptionMgmt/Commands/"+i],function(n){var a=t.map(function(e){return{physicalid:e.id,type:e.type,getID:function(){return e.id},getType:function(){return e.type}}}),o={getSelectedNodes:()=>a},s="";switch(i){case"Subscribe":s="SubscribeCmdHdr";break;case"Unsubscribe":s="UnSubscribeCmdHdr";break;case"EditSubscribe":s="EditSubscriptionCmdHdr";break;case"MySubscriptions":s="MySubscriptionsCmdHdr";break;default:e.log("Wrong Subscription Command: "+i)}new n({ID:s,context:o,objIDType:"modelID"}).execute(t),e.log("Command : "+i)})},E.prototype._extendModelForCommands=function(t){let i=[];if(t&&t.length>0)return t.forEach(t=>{var n=e.clone(t,!1);(n=e.extend(n,{getID:function(){return n.id&&(n["@id"]=n.id),n["@id"]},getLabel:function(){return n.displayName?n.displayName:n.name},getOwner:function(){return n.owner},getType:function(){return n.type},getDisplayName:function(){return n.name},getSelectedNodes:function(){return[this]},object:{revision:n.version,version:n.version,type:n.type},displayName:n.title,revision:n.revision,displayNotification:function(e){"error"===e.eventID?f.showError(e.msg):f.showSuccess(e.msg)},options:{grid:{"ds6w:status":n&&n.nlsValues&&n.nlsValues.nlsState?n.nlsValues.nlsState:"","ds6w:type":n&&n.nlsValues&&n.nlsValues.nlsType?n.nlsValues.nlsType:"","ds6w:revision":n&&n.revision?n.revision:""}}})).grid||(n.grid=""),i.push(n)}),i},E.prototype._handleReserveCommand=function(e){var t=[];if(e){let i=[];e&&!e.length&&(i.push(e),e=i),t=this._extendModelForCommands(e)}e.forEach(e=>{e.physicalid=e["@id"]?e["@id"]:e.id,e.displayName=e.title?e.title:e.name}),this._reserveCmd=new g({context:{getSelectedNodes:function(){return t},elements:{container:window.widget.body},getSecurityContext:function(){return{SecurityContext:v.getSecurityContext()}},displayNotification:function(e){e&&e.eventID&&""!==e.msg&&("success"===e.eventID?f.showSuccess(e.msg):"error"===e.eventID?f.showError(e.msg):"info"===e.eventID?f.showInfo(e.msg):f.showMessage(e.msg))}},ID:"ReserveHdr"}),this._reserveCmd.begin()},E.prototype._handleUnreserveCommand=function(e){var t=[];if(e){let i=[];e&&!e.length&&(i.push(e),e=i),t=this._extendModelForCommands(e)}e.forEach(e=>{e.physicalid=e["@id"]?e["@id"]:e.id,e.displayName=e.title?e.title:e.name}),this._unreserveCmd=new b({context:{getSelectedNodes:function(){return t},elements:{container:window.widget.body},getSecurityContext:function(){return{SecurityContext:v.getSecurityContext()}},displayNotification:function(e){e&&e.eventID&&""!==e.msg&&("success"===e.eventID?f.showSuccess(e.msg):"error"===e.eventID?f.showError(e.msg):"info"===e.eventID?f.showInfo(e.msg):f.showMessage(e.msg))}},ID:"UnreserveHdr"}),this._unreserveCmd.begin()},E}),define("DS/ENOXModelApp/Utils/xModelErrorManagement",["UWA/Core","UWA/Class","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelErrorManagementMap","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","i18n!DS/ENOXModelApp/assets/nls/xModelAccess","i18n!DS/ENOXModelApp/assets/nls/xModelErrorManagement","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n,a,o,s,r){"use strict";var l=t.singleton({init:function(){this._DEFAULT_ERR_MESSAGE="default_err_message",this.NLS_TYPE_MAP={"Product Configuration":r.TYPE_PRODUCTCONFIURATION,"Base Configuration":r.TYPE_BASECONFIGURATION,Products:r.TYPE_MODELVERSION,Parameter:r.TYPE_PARAMETER,Variant:r.TYPE_VARIANT,"Option Group":r.TYPE_OPTION_GROUP,"Variability Group":r.TYPE_OPTION_GROUP,Value:r.TYPE_VARIANT_VALUE,Option:r.TYPE_OPTION,"Matrix Rule":r.TYPE_MATRIX_RULE,"Expression Rule":r.TYPE_EXPRESSION_RULE,Rule:r._RULE,Variability:r._VARIABILITY,Requirement:r.TYPE_REQUIREMENT,Plan:r.TYPE_PLAN,"Product Specification":r.TYPE_PRODUCT_SPEC}},_getErrorTitle:function(e,t){var i="";if(e&&t){switch(e){case a.CREATE:i=s.err_create_title;break;case a.ADDEXISTING:i=s.err_addExisting_title;break;case a.DELETE:i=s.err_delete_title;break;case a.REMOVE:i=s.err_remove_title;break;case a.MODIFY:i=s.err_modify_title;break;case a.REVISE:i=s.err_revise_title;break;case a.DERIVE:i=s.err_derive_title;break;case a.UPLOAD:i=s.err_upload_title}i+=this.NLS_TYPE_MAP[t]}return i},_getErrorDesc:function(e,t){return e&&t&&n[e+"_"+t]?n[e+"_"+t]:e&&n[e]?n[e]:void 0},_getErrorCode:function(e){var t=e.split(":"),i=t.length;return i>0?t[i-1].trim():""},showError:function(t){var a,o=t.action,s=t.type;if(t.message&&void 0!==t.message){var r=this._getErrorCode(t.message);if(r&&n[r]){a=this._getErrorTitle(o,s);var l=this._getErrorDesc(r,s);return(l=e.extend({title:a},l)).title&&l.subtitle&&l.message?(i.showError(l),!0):!!l.message&&(i.showError(l.message),!0)}if(t.hasOwnProperty("mandatoryErrCodeCheck")&&!t.mandatoryErrCodeCheck){a=this._getErrorTitle(o,s);var d=t.message;return!(!a||!d)&&(i.showError({title:a,message:d}),!0)}return!1}return!1}});return l.init(),l}),define("DS/ENOXModelApp/components/ContextSelector/AutocompleteManager",["DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/PlatformAPI/PlatformAPI","css!DS/ENOXModelApp/components/ContextSelector/AutocompleteManager.css"],function(e,t,i){"use strict";var n=function(){this._x3DSearch=new t};return n.prototype.configureAutocomplete=function(e){var t=e.searchOption,n=e.target,a=this,o={items:[],configuration:{templateEngine:function(e,t,i){e.addClassName("item-label-sublabel default-template"),e.setHTML('<img class="thumbnail" src=""/> <span class="item-label">'+i.label+"</span>"),e.getChildren()[0].src=i.image}},remoteSearchEngine:function(e,i){if(!i||i.length<2)return{matchingItems:[],dataset:e};var n={query:`(flattenedtaxonomies:("types/Products")) AND ([ds6w:label]:("${i}*"))`};return t&&(n=UWA.is(t,"function")?t(i):t),a.fetchDataSet(n).then(t=>{let i={matchingItems:[]};return t&&(i.matchingItems=t,e.items=t),i.dataset=e,i},()=>({matchingItems:[],dataset:e}))}};n.datasets=[],n.addDataset(o),n.isValid=function(){return!!this.options.allowFreeInput||(this.options.multiSelect?!(""!==this.elements.input.value&&0===this.selectedItems.length):!this.selectedItems[0]||this.selectedItems[0]&&this.selectedItems[0].value&&this.getItemByLabel(this.elements.input.value)&&this.getItemByLabel(this.elements.input.value).value===this.selectedItems[0].value)};var s=n.getContent();s.addClassName("xmodel-autocomplete-manager");var r=s.querySelector(".autocomplete-searchbox"),l=UWA.createElement("span");l.addClassName("fonticon fonticon-search"),r.appendChild(l),l.addEvent("click",function(e){UWA.Event.stop(e);var o={};t&&(o=UWA.is(t,"function")?t():t),a._x3DSearch.launchASearch({title:o.label||"x_mdl_app_"+i.getUser().login+"autocomplete"+Date.now(),precondition:o.query,multiSel:!1,in_apps_callback:function(e){let t=e.map(e=>({value:e.id,subLabel:e["ds6w:responsible"],image:e.preview_url,id:e.id,label:e["ds6w:label"]+(e["ds6wg:revision"]?" "+e["ds6wg:revision"]:""),sourceId:"3dspace",revision:e["ds6wg:revision"]||"",selected:!0}));n.cleanDataset(0),n.addItems(t,n.getDataset(0)),n.elements.input.oninput()}})})},n.prototype.parseData=function(e){var t=[],i={},n=[];if(e){var a=e.results;if(a&&a.length>0)for(var o=0,s=a.length;o<s;o++)if(a[o]&&a[o].attributes){for(var r=a[o].attributes,l={nlsValues:{}},d=0,c=r.length;d<c;d++)switch(r[d].name){case"physicalid":l.id=r[d].value;break;case"ds6w:label":l.title=r[d].dispValue?r[d].dispValue:r[d].value;break;case"ds6wg:revision":l.revision=r[d].value;break;case"ds6w:status":case"ds6w:what/ds6w:status":r[d].value.replace(/ /g,"_");r[d].value&&r[d].value.indexOf("Build.")>-1&&(r[d].value=r[d].value.slice(r[d].value.indexOf(".")+1)),l.state=r[d].value;break;case"ds6w:responsible":case"ds6w:who/ds6w:responsible":l.owner=r[d].value;break;case"preview_url":l.image=r[d].value}n.push(l),i={},i={value:l.id,subLabel:l.responsible,image:l.image,id:l.id,label:l.title+(l.revision?" "+l.revision:""),sourceId:"3dspace",revision:l.revision},t.push(i)}}return{items:t}},n.prototype.fetchDataSet=function(e){return this._searchCall(e).then(e=>{return this.parseData(JSON.parse(e)).items})},n.prototype._searchCall=function(t){var n={label:"x_mdl_app_"+i.getUser().login+"autocomplete"+Date.now(),with_indexing_date:!0,with_synthesis:!1,with_nls:!1,locale:window.widget&&window.widget.lang?window.widget.lang:"en",select_predicate:["physicalid","owner","ds6w:label","ds6w:type","ds6w:responsible","ds6w:state","ds6wg:revision"],refine:{},order_by:"desc",order_field:"relevance",source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",login:{"3dspace":{SecurityContext:e.getSecurityContext()}}};return UWA.extend(n,t),n.query?new UWA.Promise(function(t,i){try{var a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};a.data=JSON.stringify(n),a.onComplete=function(e){t(e)},a.onFailure=function(e){i(e)},a.onTimeout=function(e){i(e)},e.federatedSearchRequest(a)}catch(e){UWA.log("Exception occured while fetching data"+e.message),i(e.message?e.message:"Exception Occured during fetch!!")}}):UWA.Promise.reject()},n.prototype.init=function(e){},n}),define("DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoPresenterSettingsProvider",["UWA/Core","UWA/Class","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/EnterpriseVariabilityDictionaryStatePresenter","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/ParametersPresenter"],function(e,t,i,n,a,o,s){"use strict";var r=function(e){return{src:a.getWebappsAssetUrl("ENOXModelApp","icon/"+e.src+".png"),icon:e.icon?e.icon:"product",message:o.EMPTY_CONTENT_MESSAGE}},l=function(){return{openItemCmdTitle:o._open,openItemCmdText:o._open,infoCmdTitle:o._information,infoCmdText:o._information,deleteCmdTitle:o._delete,deleteCmdText:o._delete,deleteItemTitle:o._delete}},d=t.singleton({getParametersPresenterSettings:function(){return{settingsFor:"ParametersPresenter",appPreferencePath:[i._KEY,i._VIEWS_PREFERENCES,i._ENTREPRISE_VARIANTS_OPTIONS,i._PARAMETERS],infoContext:"Parameters",tagProxyName:"ParameterClassesTagProxy",useAsyncExpand:!1,listViewId:"parameters",views:["ThumbnailView","TileView","DataGridView"],NLS:e.extend(l(),{createItemTitle:s._create,itemName:s._parameterSingle,itemsName:s._parameterMultiple,createItemError:s._ERROR_CREATE_PARAMETER,getItemDetailsError:s._ERROR_GET_PARAMETER_DETAILS,getItemsError:s._ERROR_GET_PARAMETERS,deleteItemError:s._ERROR_DELETE_PARAMETER,patchItemError:s._ERROR_PATCH_PARAMETER}),routes:{DetailsPageRoute:"home.EnterpriseDictionary.ParameterDetails"},emptyContent:r({src:"parameter"}),types:{item:"Variant Parameter"},serviceHandlers:{createItem:"createParameter",getItemDetails:"getParameterDetails",getItems:"getParameters",patchItem:"patchParameter",deleteItems:"deleteParameters",getItemsImage:"getParametersIdImageMap"},searchExpand:{parentType:"Variant Parameter",subType:"Variant Parameter",parentTypeStatePrefix:"Perpetual Resource"}}},getVariantsPresenterSettings:function(){return{settingsFor:"VariantsPresenter",appPreferencePath:[i._KEY,i._VIEWS_PREFERENCES,i._ENTREPRISE_VARIANTS_OPTIONS,i._VARIANTS],infoContext:"Variant",tagProxyName:"VariantClassesTagProxy",childKeys:["values"],useAsyncExpand:!1,listViewId:"variant",views:["ThumbnailView","TileView","DataGridView"],NLS:e.extend(l(),{createItemTitle:o._createVariant,createItemText:o._createVariant,createChildItemTitle:o._createValue,createChildItemText:o._createValue,itemName:o._variantSingle,itemsName:o._variantMultiple,createItemError:o.ERROR_CREATE_VARIANT,getItemDetailsError:o.ERROR_GET_VARIANT_DETAILS,getSubItemDetailsError:o.ERROR_GET_VARIANT_DETAILS,getItemsError:o.ERROR_GET_VARIANTS,deleteItemError:o.ERROR_DELETE_VARIANT,createSubItemError:o.ERROR_CREATE_VARIANT,getSubItemsError:o.ERROR_GET_VARIANT_VALUES,deleteSubItemError:o.ERROR_DELETE_VARIANT,patchSubItemError:o.ERROR_PATCH_VARIANT_VALUE,patchItemError:o.ERROR_PATCH_VARIANT}),routes:{DetailsPageRoute:n.ROUTE_DICTIONARY_VARIANT_DETAILS},emptyContent:r({src:"variant"}),types:{item:"Variant",subItem:"Variant Value"},serviceHandlers:{createItem:"createVariantClass",getItemDetails:"getVariantClassDetails",getSubItemDetails:"getDicoValueDetails",createSubItem:"createDicoValue",getItems:"getVariantsWithvalues",getSubItems:"getVariantValues",patchItem:"patchVariant",patchSubItem:"patchVariantValue",deleteItems:"deleteVariantClasses",deleteSubItems:"deleteVariants",getItemsImage:"getVariantValuesIdImageMap"},searchExpand:{parentType:"Variant",subType:"Variant Value",parentTypeStatePrefix:"Perpetual Resource",subTypeStatePrefix:"Configuration Option",childKey:"values"},expandLabel:o.expand_values,collapseLabel:o.collapse_values}},getOptionGroupsPresenterSettings:function(){return{settingsFor:"OptionGroupPresenter",appPreferencePath:[i._KEY,i._VIEWS_PREFERENCES,i._ENTREPRISE_VARIANTS_OPTIONS,i._GROUP_OPTIONS],infoContext:"OptionGroup",tagProxyName:"OptionGroupPresenterTagProxy",listViewId:"optionGroup",views:["ThumbnailView","TileView","DataGridView"],childKeys:["options"],useAsyncExpand:!1,NLS:e.extend(l(),{createItemTitle:o._createOptionGroup,createItemText:o._createOptionGroup,createChildItemTitle:o._createOption,createChildItemText:o._createOption,itemName:o._optionGroupSingle,itemsName:o._optionGroupMultiple,subItemName:o._optionSingle,subItemsName:o._optionMultiple,createItemError:o.ERROR_CREATE_OPTION_GROUP,getItemDetailsError:o.ERROR_GET_OPTION_GROUP_DETAILS,getSubItemDetailsError:o.ERROR_GET_OPTION_DETAILS,getItemsError:o.ERROR_GET_OPTION_GROUPS,deleteItemError:o.ERROR_DELETE_OPTION_GROUPS,createSubItemError:o.ERROR_CREATE_OPTION,getSubItemsError:o.ERROR_GET_OPTIONS,deleteSubItemError:o.ERROR_DELETE_OPTIONS,patchSubItemError:o.ERROR_PATCH_VARIANT_VALUE,patchItemError:o.ERROR_PATCH_GROUP}),routes:{DetailsPageRoute:n.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS},emptyContentType:"Option Group",emptyContent:r({src:"optionGroup"}),types:{item:"Variability Group",subItem:"Variability Option"},serviceHandlers:{createItem:"createVariabilityGroup",getItemDetails:"getVariabilityGroupDetails",getSubItemDetails:"getOptionDetails",createSubItem:"createDicoOption",getItems:"getVariabilityGroupsWithOptions",getSubItems:"getVariabilityGroupOptions",patchItem:"patchVariabilityGroup",patchSubItem:"patchOption",deleteItems:"deleteVariabilityGroups",deleteSubItems:"deleteOptions",getItemsImage:"getOptionGroupOptionsIdImageMap"},searchExpand:{parentType:"Variability Group",subType:"Variability Option",parentTypeStatePrefix:"Perpetual Resource",subTypeStatePrefix:"Configuration Option",childKey:"options"},expandLabel:o.expand_options,collapseLabel:o.collapse_options}},getVariantDetailsPresenterSettings:function(){return{settingsFor:"VariantDetails",appPreferencePath:[i._KEY,i._VIEWS_PREFERENCES,i._VARIANTS_DETAILS],NLS:e.extend(l(),{getItemDetailsError:o.ERROR_GET_VARIANT_DETAILS,deleteItemError:o.ERROR_DELETE_VARIANT}),serviceHandlers:{getItemDetails:"getVariantClassDetails",deleteItems:"deleteVariantClasses"}}},getOptionGroupDetailsPresenterSettings:function(){return{settingsFor:"OptionGroupDetails",appPreferencePath:[i._KEY,i._VIEWS_PREFERENCES,i._OPTION_GROUP_DETAILS],NLS:e.extend(l(),{getItemDetailsError:o.ERROR_GET_VAR_GROUP_DETAILS,deleteItemError:o.ERROR_DELETE_OPTION_GROUPS}),serviceHandlers:{getItemDetails:"getVariabilityGroupDetails",deleteItems:"deleteVariabilityGroups"}}},getVariantValuesPresenterSettings:function(){return{settingsFor:"VariantValues",parentType:"Variant",appPreferencePath:[i._KEY,i._VIEWS_PREFERENCES,i._VARIANTS_DETAILS],infoContext:"Values",tagProxyName:"VariantsTagProxy",listViewId:"variantValue",views:["ThumbnailView","TileView","DataGridView"],tabId:"VariantValue",NLS:e.extend(l(),{createItemTitle:o._createValue,createItemText:o._createValue,itemName:o._valueSingle,itemsName:o._valueMultiple,tabTitle:o._valueMultiple,getSubItemDetailsError:o.ERROR_GET_VAR_GROUP_DETAILS,getSubItemsError:o.ERROR_GET_VARIANT_VALUES,createSubItemError:o.ERROR_CREATE_VARIANT,patchSubItemError:o.ERROR_PATCH_VARIANT_VALUE,deleteSubItemError:o.ERROR_DELETE_VARIANT}),emptyContentType:"Variant Value",emptyContent:r({src:"variantValue"}),serviceHandlers:{createSubItem:"createDicoValue",getSubItemDetails:"getDicoValueDetails",getSubItems:"getVariantValues",patchSubItem:"patchVariantValue",deleteSubItems:"deleteVariants"}}},getOptionsPresenterSettings:function(){return{settingsFor:"Options",parentType:"Variability Group",appPreferencePath:[i._KEY,i._VIEWS_PREFERENCES,i._OPTION_GROUP_DETAILS],infoContext:"Options",tagProxyName:"OptionsTagProxy",listViewId:"options",views:["ThumbnailView","TileView","DataGridView"],tabId:"Options",NLS:e.extend(l(),{createItemTitle:o._createOption,createItemText:o._createOption,itemName:o._optionSingle,itemsName:o._optionMultiple,tabTitle:o._optionMultiple,getSubItemDetailsError:o.ERROR_GET_VAR_GROUP_DETAILS,getSubItemsError:o.ERROR_GET_OPTIONS,createSubItemError:o.ERROR_CREATE_OPTION,patchSubItemError:o.ERROR_PATCH_OPTION,deleteSubItemError:o.ERROR_DELETE_OPTIONS}),emptyContentType:"Options",emptyContent:r({src:"option"}),serviceHandlers:{createSubItem:"createDicoOption",getSubItemDetails:"getDicoOptionDetails",getSubItems:"getVariabilityGroupOptions",patchSubItem:"patchOption",deleteSubItems:"deleteOptions"}}},getModelCopyFromListSettings:function(){return{settingsFor:"modelCopyFromListPresenter",tagProxyName:"modelCopyFromListTaggerProxy",childKeys:["values","options"],useAsyncExpand:!1,listViewId:"modelCopyFromList",views:["DataGridView"],emptyContent:r({src:"variant"}),NLS:e.extend(l(),{itemName:o.itemSingle,itemsName:o.itemMultiple,singleRule:o.rulesSingle,multipleRules:o.rulesMultiple,singleConfiguration:o.configurationSingle,multipleConfigurations:o.configurationMultiple})}},getVariabilityListSettings:function(){return{settingsFor:"mvVariabilityListPresenter",tagProxyName:"mvVariabilityListTaggerProxy",childKeys:["values","options"],useAsyncExpand:!0,listViewId:"mvVariabilityList",views:["ThumbnailView","TileView","DataGridView"],emptyContent:r({src:"variant"}),NLS:e.extend(l(),{itemName:o.itemSingle,itemsName:o.itemMultiple})}}});return d.init(),d}),define("DS/ENOXModelApp/components/ProgressPanel/ProgressPanel",["UWA/Element","UWA/Core","DS/ENOXModelApp/components/ProgressPanel/ProcessPanel","DS/Controls/Button","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","i18n!DS/ENOXModelApp/assets/nls/components/ProgressPanel/ProgressPanel","css!DS/ENOXModelApp/components/ProgressPanel/ProgressPanel.css"],function(e,t,i,n,a,o,s,r){"use strict";class l{constructor(){return l.instance||(this._prioritySequence=[],this._processPanels=[],this._executedProcess=0,l.instance=this),l.instance}init(e){this._modelEvents=new a,this._myEventManager=new o(this._modelEvents),this._initDivs(),this.inject(),this._subscribeToEvents(),this.initProcessPanels(e),this.updateHeading(e)}_initDivs(){let t=this;if(this._mainContainer)this.show();else{this._mainContainer=new e("div",{class:"progress-panel-main-body"});let i=new e("div",{class:"progress-panel-topbar"}),a=new e("div",{class:"progress-panel-title"}),o=new n({displayStyle:"lite",label:s.COLLAPSE,icon:{iconName:"expand-up",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});o.addEventListener("buttonclick",function(e){t.togglePanel(e),t.togglePanelBody()});let r=new n({displayStyle:"lite",label:s.CLOSE,icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});r.addEventListener("buttonclick",function(){t.hide()}),a.inject(i),o.inject(i),r.inject(i),this._progressBody=new e("div",{class:"progress-panel-body"}),i.inject(this._mainContainer),this._progressBody.inject(this._mainContainer)}}initProcessPanels(e){let t=this,n=e.processes,a=[],o=[],s=[];if(!Array.isArray(n)){let e=[];e.push(n),n=e}n.forEach(e=>{e.priority?o.push(e):s.push(e)}),o.forEach(e=>{a.push(e)}),s.forEach(e=>{a.push(e)}),0==this._prioritySequence.length?(this._processPanels=[],this._prioritySequence.push(a)):1==this._prioritySequence.length&&(this._removePreviousPanels(),this._prioritySequence.push(a));let r={modelEvents:t._modelEvents,itemTitle:e.itemTitle};this._prioritySequence.forEach(e=>{1==t._prioritySequence.length?e.forEach(e=>{r.process=e,t._processPanels.push(new i(r))}):(r.process=e,t._processPanels.push(new i(r)))})}_removePreviousPanels(){this._processPanels.forEach(e=>{e.remove()}),this._prioritySequence=[],this._processPanels=[]}inject(){document.querySelector(".progress-panel-main-body")||this._mainContainer.inject(widget.body)}show(){this._mainContainer.style.display=""}hide(){this._mainContainer.style.display="none",this._mainContainer.remove(),this._removePreviousPanels(),this._myEventManager.cleanup()}togglePanelBody(){"none"==this._progressBody.style.display?this._progressBody.style.display="":this._progressBody.style.display="none"}togglePanel(e){let t=e.dsModel.getContent().querySelector(".wux-button-icon-fi");e.dsModel.label=e.dsModel.label==s.EXPAND?s.COLLAPSE:s.EXPAND;let i="expand-up"==e.dsModel.icon.iconName?"expand-up":"expand-down",n="expand-up"==i?"expand-down":"expand-up";e.dsModel.icon.iconName=n,t.classList.replace("wux-ui-3ds-"+i,"wux-ui-3ds-"+n)}updateHeading(e){let t=e.progressHeading?e.progressHeading:s.PROGRESS;t=this._prioritySequence.length>1?t+" - "+this._processPanels.length+" "+s.OBJECTS:t+" - "+e.itemTitle,this._mainContainer.querySelector(".progress-panel-title").innerText=t}_subscribeToEvents(){let e=this;this._myEventManager.subscribe(this._modelEvents,{event:"progress-panel-process-executed"},function(t){0==e._progressBody.children.length&&e.hide()})}}return l}),define("DS/ENOXModelApp/Utils/SpecificationCommonUtil",["UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/PlatformAPI/PlatformAPI","DS/xPflRouter5/xPflRouter","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/ModelDocument/js/DocumentManagementCustom","DS/DocumentManagement/DocumentManagement","DS/ENOXModelApp/Utils/xModelAppGlobalConfig"],function(e,t,i,n,a,o,s,r){"use strict";return{getErrorMessage:function(e){var t=e,i=t.lastIndexOf(":");return t.slice(i+1)},getLoggedInUser:function(){return i.getUser().login},navigateToModelDetails:function(e,t,i){n.navigate(r.ROUTE_MODEL_DETAILS,e,{replace:!0}),t.publish({event:"breadcrumb-remove-link",data:r.ROUTE_MODEL_DOC_DETAILS}),t.publish({event:"enox-model-app-item-removed",data:i})},removeSpecifications:function(e,t,i,n,r,l){if(void 0!==t){var d={securityContext:a.getSecurityContext(),additionalHeaders:o.addCfgAuthoringContextToHeader(),relInfo:{parentId:e,parentRelName:i,parentDirection:"from"},onComplete:function(){r(n,t)},onFailure:function(e){l(e,n)}};s.disconnectDocumentFromParent(t,d)}}}}),define("DS/ENOXModelApp/components/WelcomePanel/WelcomePanelWrapper",["DS/Core/PointerEvents","DS/Utilities/TouchUtils","DS/ENOXWelcomePanel/js/ENOXWelcomePanel","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/xPflRouter5/xPflRouter","i18n!DS/ENOXModelApp/assets/nls/components/WelcomePanel/WelcomePanel"],function(e,t,i,n,a,o){"use strict";var s=function(){};return s.prototype.init=function(e,t,a){this._applicationChannel=e;var s=[{id:"quick_access",title:o.access_your_work,actions:[{id:n.PATH_MY_MODELS,text:o.my_model_versions,fonticon:"component",className:"action-new"},{id:n.PATH_RECENTY_OPENED,text:o.recently_opened,fonticon:"clock",className:"action-new"},{id:n.PATH_DICTIONARY,text:o.enterprise_variability,fonticon:"book-open",className:"action-new"},{id:n.PATH_MY_UNITS,text:o.my_units,fonticon:"fonticon fonticon-3d-object-barcode",className:"action-new"}]},{id:"start_activities",title:o.start_new_activity,actions:[{id:n.PATH_NEW_MODEL_VERSION,text:o.new_model_version,fonticon:"plus",className:"action-new",isNotHighlightable:!0},{id:n.PATH_OPEN_MODEL_VERSION,text:o.open_model_version,fonticon:"open",className:"action-new",isNotHighlightable:!0}]}];new i({collapsed:!1,title:"xModel",notifications:[],activities:s,parentContainer:a,modelEvents:e}).render(),this._subscribeToEvents()},s.prototype._subscribeToEvents=function(){var i=this;this._applicationChannel.subscribe({event:"welcome-panel-action-selected"},function(i){if(i&&"home"===i.id?a.navigate(n.ROUTE_LANDING_PAGE):i&&i.id===n.PATH_DICTIONARY?a.navigate(n.ROUTE_DICTIONARY_VARIANTS_OPTIONS):i&&i.id===n.PATH_MY_MODELS?a.navigate(n.ROUTE_MY_MODELS,{data:"from welcomepanel"}):i&&i.id===n.PATH_RECENTY_OPENED?a.navigate(n.ROUTE_RECENTY_OPENED,{data:"from welcomepanel"}):i&&i.id===n.PATH_MY_UNITS&&a.navigate(n.ROUTE_MY_UNITS,{data:"from welcomepanel"}),t.getTouchMode()){var o=new MouseEvent(e.POINTERDOWN,{bubbles:!1});document.dispatchEvent(o)}}),this._applicationChannel.subscribe({event:"welcome-panel-select-action"},function(e){e&&e.id===n.PATH_DICTIONARY?i._applicationChannel.publish({event:"topbar-show-title",data:{id:n.ROUTE_DICTIONARY,label:o.enterprise_variability}}):e&&e.id===n.PATH_MY_MODELS?i._applicationChannel.publish({event:"topbar-show-title",data:{id:n.ROUTE_MY_MODELS,label:o.my_model_versions}}):e&&e.id===n.PATH_RECENTY_OPENED?i._applicationChannel.publish({event:"topbar-show-title",data:{id:n.ROUTE_RECENTY_OPENED,label:o.recently_opened}}):e&&e.id===n.PATH_MY_UNITS&&i._applicationChannel.publish({event:"topbar-show-title",data:{id:n.ROUTE_MY_UNITS,label:o.my_units}})})},s}),define("DS/ENOXModelApp/components/DialogCreation/UnitDialogCreation",["UWA/Core","UWA/Class/View","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/ENOXModelApp/components/ContextSelector/AutocompleteManager","i18n!DS/ENOXModelApp/assets/nls/components/DialogCreation/DialogCreation","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/UnitsStatePresenter","css!DS/ENOXModelApp/components/DialogCreation/UnitDialogCreation.css"],function(e,t,i,n,a,o,s,r){"use strict";return{createView:t.extend({className:"unit-creation",render:function(){var t=e.createElement("div"),n=e.createElement("label");n.style.color="#3d3d3d",n.setContent(s.image),this.formContent=new i({className:"vertical",fields:[{type:"number",label:r.Number_of_Units_to_create,name:"units",errorText:"",min:1,max:100,value:1,required:!0},{type:"autocomplete",id:"inputmv",label:r.MODEL_VERSION,placeholder:"",value:"",name:"modelversion",errorText:"",required:!0,disabled:!1,minLengthBeforeSearch:1},{type:"text",label:r.description,name:"description",errorText:""},{type:"date",name:"PlannedBuildDate",label:r.PLANNED_BUILD_DATE,errorText:"",showClearIcon:!0},{type:"date",name:"DateShipped",label:r.DATE_SHIPPED,placeHolder:"",errorText:"",showClearIcon:!0},{type:"autocomplete",id:"inputpc",name:"productconfiguration",label:r.PRODUCT_CONFIGURATION,disabled:!0,placeholder:"",value:"",errorText:""},{type:"autocomplete",id:"inputmfg",name:"manufacturingplan",label:r.MANUFACTURING_PLAN,placeholder:"",errorText:"",value:"",disabled:!0}]});t=e.createElement("div");return this.formContent.inject(t),this.container.setContent(t),this}}),_clearPcAndMv:function(){var e=this.view.formContent.getField("productconfiguration"),t=this.view.formContent.getField("manufacturingplan");e&&(e.value="",this.pcId=void 0),t&&(t.value="",this.mpId=void 0)},_addCalendarSpan:function(){var t=this,i=t.view.formContent.getField("PlannedBuildDate"),n=t.view.formContent.getField("DateShipped");if(i&&"PlannedBuildDate"===i.getAttribute("name")){var a=i.getParent(),o=e.createElement("span");o.addClassName("calenderIconSpan"),o.addClassName("wux-ui-3ds wux-ui-3ds-calendar"),a.appendChild(o),o.addEvent("click",function(e){var i=t.view.formContent.getField("PlannedBuildDate");i&&i.click()})}if(n&&"DateShipped"===n.getAttribute("name")){var s=n.getParent(),r=e.createElement("span");r.addClassName("calenderIconSpan"),r.addClassName("wux-ui-3ds wux-ui-3ds-calendar"),s.appendChild(r),r.addEvent("click",function(e){var i=t.view.formContent.getField("DateShipped");i&&i.click()})}},_addSearchSpanAndEvent:function(){this.mvId,this.pcId,this.mpId,this.mvInput=this.view.formContent.getField("modelversion"),this.pcInput=this.view.formContent.getField("productconfiguration"),this.mfgInput=this.view.formContent.getField("manufacturingplan")},_addAutocomplete:function(){var e=this;e.autocompleteManager=new o,e.autocompleteManager.configureAutocomplete({target:e.mvAutocomplete,searchOption:function(t){let i='(flattenedtaxonomies:("types/Products"))';return e._context&&e._context.id&&(i+=`AND (based_95_on_95_model_95_physicalid:("${e._context.id}*"))`),t&&(i+=`AND ([ds6w:label]:("${t}*"))`),{query:i,label:r.Select_Model_Version}}}),e.autocompleteManager.configureAutocomplete({target:e.pcAutocomplete,searchOption:function(t){let i=`(flattenedtaxonomies:("types/Product Configuration")) AND (based_95_on_95_model_95_version_95_pid:("${e.mvAutocomplete.selectedItems[0].value}"))`;return t&&(i+=`AND ([ds6w:label]:("${t}*"))`),{query:i,label:r.Select_Product_Configuration}}}),e.autocompleteManager.configureAutocomplete({target:e.mpAutocomplete,searchOption:function(t){let i=`(flattenedtaxonomies:("types/Manufacturing Plan")) AND (mp_95_based_95_on_95_model_95_version_95_pid:("${e.mvAutocomplete.selectedItems[0].value}"))`;return t&&(i+=`AND ([ds6w:label]:("${t}*"))`),{query:i,label:r.Select_Manufacturing_Plan}}}),e.mvAutocomplete.elements.suggestsContainer.addEventListener("click",function(t,i){e.pcAutocomplete.enable(),e.mpAutocomplete.enable(),e.validate()&&e.modelEvent.publish({event:"enox-dialog-creation-done",data:!0})}),e.mvAutocomplete.elements.input.oninput=function(t){var i,n=e.mvAutocomplete.elements.input.value;""==n?e.mvAutocomplete.elements.clear.hide():e.mvAutocomplete.elements.clear.show(),(i=e.mvAutocomplete.getItemByLabel(n))||(e.pcAutocomplete.elements.clear.click(),e.mpAutocomplete.elements.clear.click(),e.pcAutocomplete.elements.input.value="",e.pcAutocomplete.disable(),e.mpAutocomplete.elements.input.value="",e.mpAutocomplete.disable(),e.disableCreateActions(!0)),i&&(e.pcAutocomplete.enable(),e.mpAutocomplete.enable(),e.mvId=e.mvAutocomplete.selectedItems[0].value,e.validate()&&e.modelEvent.publish({event:"enox-dialog-creation-done",data:!0})),e.pcAutocomplete.resetCache(),e.mpAutocomplete.resetCache()},this.pcAutocomplete.elements.input.oninput=function(t){""==e.pcAutocomplete.elements.input.value?e.pcAutocomplete.elements.clear.hide():e.pcAutocomplete.elements.clear.show()},this.mpAutocomplete.elements.input.oninput=function(t){""==e.mpAutocomplete.elements.input.value?e.mpAutocomplete.elements.clear.hide():e.mpAutocomplete.elements.clear.show()},e.pcAutocomplete.elements.clear.onclick=function(){e.pcAutocomplete.elements.clear.hide()},e.mpAutocomplete.elements.clear.onclick=function(){e.mpAutocomplete.elements.clear.hide()}},validate:function(){let e=!1;return this.mvAutocomplete.selectedItems.length>0&&this.mvAutocomplete.selectedItems[0].value&&""!=this.view.formContent.getValue("units")&&(e=!0),e},formatContentPatch:function(e){return e.getValues()},disableCreateActions:function(e){var t=document.querySelector(".modal-content .modal-footer #createAnother_button"),i=document.querySelector(" .modal-content .modal-footer #create_button");t&&(e||t.setText(s.createAnother),t.addClassName("disabled")),i&&i.addClassName("disabled")},show:function(e){var t=this;this.modelEvent=e.modelEvent,this._context=e.context,this.privateChannel=new a;var i=new n({renderTo:document.body,events:{onShow:function(){t.modelEvent.publish({event:"enox-dialog-on-show"})},onHide:function(){t.modelEvent.publish({event:"enox-dialog-on-hide"})}}});this.view=new this.createView(e);var o=[{className:"primary",id:"create_button",value:s.create,action:function(e){t.validate()&&(t.modelEvent.publish({event:"enox-dialog-creation",data:{content:t.formatContentPatch(t.view.formContent),plannedBuildDate:t.view.formContent.getDateInput("PlannedBuildDate").getDate(),dateShipped:t.view.formContent.getDateInput("DateShipped").getDate(),mvId:t.mvAutocomplete.selectedItems[0].value,pcId:t.pcAutocomplete.selectedItems.length>0?t.pcAutocomplete.selectedItems[0].value:"",mpId:t.mpAutocomplete.selectedItems.length>0?t.mpAutocomplete.selectedItems[0].value:""}}),e.hide())}},{className:"default",id:"createAnother_button",value:s.createAnother,action:function(e){t.view.formContent.validate()&&(t.modelEvent.publish({event:"enox-dialog-creation",data:{content:t.formatContentPatch(t.view.formContent),mvId:t.mvAutocomplete.selectedItems[0].value,pcId:t.pcAutocomplete.selectedItems.length>0?t.pcAutocomplete.selectedItems[0].value:"",mpId:t.mpAutocomplete.selectedItems.length>0?t.mpAutocomplete.selectedItems[0].value:""}}),t.disableCreateActions())}},{className:"default",id:"cancel_button",value:s.cancel,action:function(e){e.hide()}}];this.view.render(),i.dialog({body:this.view.getContent(),title:"New Units",buttons:o}),t.mvAutocomplete=t.view.formContent.autocompletes[0],t.pcAutocomplete=t.view.formContent.autocompletes[1],t.mpAutocomplete=t.view.formContent.autocompletes[2],t.mvAutocomplete.elements.clear.onclick=function(){t.mvAutocomplete.elements.input.value="",t.disableCreateActions(!0),t.pcAutocomplete.elements.input.value="",t.mpAutocomplete.elements.input.value="",t.pcAutocomplete.elements.clear.click(),t.mpAutocomplete.elements.clear.click(),t.pcAutocomplete.disable(),t.mpAutocomplete.disable()},t.disableCreateActions(!0),t._addSearchSpanAndEvent(),t._addCalendarSpan(),t._addAutocomplete(),t.view.formContent.getFields().forEach(function(e){e.required&&e.addEvent("input",function(){t.validate()?t.modelEvent.publish({event:"enox-dialog-creation-done",data:!0}):t.disableCreateActions(!0),e.focus()})}),t.modelEvent.subscribe({event:"enox-dialog-creation-done"},function(e){var i=document.querySelector(".modal-content .modal-footer #createAnother_button"),n=document.querySelector(".modal-content .modal-footer #create_button");i&&(e||i.setText(s.createAnother),i.removeClassName("disabled")),n&&n.removeClassName("disabled");var a=t.view.formContent.getFields()[0];a&&a.focus()})}}}),define("DS/ENOXModelApp/Utils/xModelLocalStorage",["DS/ENOXModelApp/Utils/xModelPreferencesConstant","UWA/Core"],function(e,t){"use strict";var i={init:function(){if(window.localStorage.getItem(i._LOCALSTORAGE_KEY)){var e=JSON.parse(window.localStorage.getItem(i._LOCALSTORAGE_KEY));e[i._LOCALSTORAGE_KEY]||(e[i._LOCALSTORAGE_KEY]=n,window.localStorage.setItem(i._LOCALSTORAGE_KEY,JSON.stringify(e)))}else{var t={};t[i._LOCALSTORAGE_KEY]={},t[i._LOCALSTORAGE_KEY]=n,window.localStorage.setItem(i._LOCALSTORAGE_KEY,JSON.stringify(t))}},destroy:function(){window.localStorage.removeItem(i._LOCALSTORAGE_KEY)},isPath:function(e,n){try{if(window.localStorage.getItem(i._LOCALSTORAGE_KEY)){if(Array.isArray(e)){for(var a=JSON.parse(window.localStorage.getItem(i._LOCALSTORAGE_KEY)),o=0;o<e.length;o++){if(!a[e[o]]&&""!==a[e[o]]){if(t.log("XmodelAppLocalStorage getItem() path doesn't exist"),n)return;return!1}a=a[e[o]]}return!n||a}if(t.log("XmodelAppLocalStorage getItem() argument is not a Array"),n)return;return!1}if(t.log("XmodelAppLocalStorage getItem() LocalStorage not initialize"),n)return;return!1}catch(e){if(t.log(e),n)return;return!1}},getValue:function(e){return this.isPath(e,!0)},setValue:function(e,t){if(this.isPath(e,!1)){var n=JSON.parse(window.localStorage.getItem(i._LOCALSTORAGE_KEY)),a=JSON.parse(JSON.stringify(e));window.localStorage.setItem(i._LOCALSTORAGE_KEY,JSON.stringify(this.recursiveSearch(n,a,t,!0)))}},recursiveSearch:function(e,t,i,n){return 2===t.length?e[t[1]]=i:n?this.recursiveSearch(e[t[0]],t,i,!1):(t.shift(),this.recursiveSearch(e[t[0]],t,i,!1)),e}};i._LOCALSTORAGE_KEY=e._KEY,i._LOCALSTORAGE_SMALL=e._SMALL,i._LOCALSTORAGE_MEDIUM=e._MEDIUM,i._LOCALSTORAGE_LARGE=e._LARGE,i._LOCALSTORAGE_VIEWS_PREFERENCES=e._VIEWS_PREFERENCES,i._LOCALSTORAGE_MY_MODEL_VERSIONS=e._MY_MODEL_VERSIONS,i._LOCALSTORAGE_MODEL_VERSIONS=e._MODEL_VERSIONS,i._LOCALSTORAGE_MODEL_VERSIONS_DETAILS=e._MODEL_VERSIONS_DETAILS,i._LOCALSTORAGE_RULES=e._RULES,i._LOCALSTORAGE_PRODUCT_CONFIGURATIONS=e._PRODUCT_CONFIGURATIONS,i._LOCALSTORAGE_ENTREPRISE_VARIANTS_OPTIONS=e._ENTREPRISE_VARIANTS_OPTIONS,i._LOCALSTORAGE_VARIANTS=e._VARIANTS,i._LOCALSTORAGE_OPTIONS=e._OPTIONS,i._LOCALSTORAGE_PARAMETERS=e._PARAMETERS,i._LOCALSTORAGE_GROUP_OPTIONS=e._GROUP_OPTIONS,i._LOCALSTORAGE_VARIANTS_DETAILS=e._VARIANTS_DETAILS,i._LOCALSTORAGE_RULES_DETAILS=e._RULES_DETAILS,i._LOCALSTORAGE_PRODUCT_CONFIGURATIONS_DETAILS=e._PRODUCT_CONFIGURATIONS_DETAILS,i._LOCALSTORAGE_LIST_VIEW=e._LIST_VIEW,i._LOCALSTORAGE_VIEW=e._VIEW,i._LOCALSTORAGE_SORT=e._SORT,i._LOCALSTORAGE_GROUP=e._GROUP,i._LOCALSTORAGE_SEARCH=e._SEARCH,i._LOCALSTORAGE_ID_CARD=e._ID_CARD,i._LOCALSTORAGE_COLLAPSE=e._COLLAPSE,i._REQUIREMENTS=e._REQUIREMENTS,i._DICTIONARY_TAB_VALUES=e._DICTIONARY_TAB_VALUES,i._DICTIONARY_TAB_OPTIONS=e._DICTIONARY_TAB_OPTIONS,i._LOCALSTORAGE_BASE_CONFIGURATIONS=e._BASE_CONFIGURATIONS;var n={"xmodel-views-preferences":{"info-panel":{"info-open":"","info-context":"","info-width":""},"xmodel-recently-opened":{"xmodel-list-view":{selections:[],tagFilter:{}}},"xmodel-my-model-versions":{"xmodel-list-view":{view:"",sort:{},search:"",selections:[],filters:{},tagFilter:{}}},"xmodel-my-units":{"xmodel-list-view":{view:"",sort:{},search:"",selections:[],filters:{},tagFilter:{},group:""}},"xmodel-model-versions":{"xmodel-list-view":{view:"",sort:{},group:"",search:"",selections:[],filters:{},tagFilter:{}}},"xmodel-model-versions-details":{tab:"",variability:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}},rules:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""},visibleColumns:[]}},"product-configurations":{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""},customAttributes:"",visibleColumns:[]}},"base-configuration":{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""}}},requirements:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""}}},specifications:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""}}},manufacturingPlans:{"xmodel-list-view":{view:"",sort:{},group:"",selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""}}},"id-card":{collapse:""}},"xmodel-entreprise-variants-options":{tab:"",variants:{"xmodel-list-view":{view:"",sort:{},group:"",selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}},"group-options":{"xmodel-list-view":{view:"",sort:{},group:"",selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}},options:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}},parameters:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}}},"variants-details":{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]},"id-card":{collapse:""}},"rules-details":{"id-card":{collapse:""}},"product-configurations-details":{"id-card":{collapse:""},"xmodel-list-view":{"split-view":{"split-width":"","xmodel-list-view":{view:"",sort:{}}}},"physical-product-id":""},"base-configurations-details":{"id-card":{collapse:""},"xmodel-list-view":{"split-view":{"split-width":"","xmodel-list-view":{view:"",sort:{}}}},"physical-product-id":""},Values:{"xmodel-list-view":{selections:[]}},Options:{"xmodel-list-view":{selections:[]}}}};return i}),define("DS/ENOXModelApp/Utils/xModelWidgetPreferencesManager",["DS/ENOXModelApp/Utils/xModelPreferencesConstant","UWA/Core","DS/ENOXModelApp/Utils/xModelAppGlobalConfig"],function(e,t,i){"use strict";var n=function(){};return n._KEY=e._KEY,n._LAST_ROUTE=e._LAST_ROUTE,n._SMALL=e._SMALL,n._MEDIUM=e._MEDIUM,n._LARGE=e._LARGE,n._VIEWS_PREFERENCES=e._VIEWS_PREFERENCES,n._MY_MODEL_VERSIONS=e._MY_MODEL_VERSIONS,n._MODEL_VERSIONS=e._MODEL_VERSIONS,n._MODEL_VERSIONS_DETAILS=e._MODEL_VERSIONS_DETAILS,n._RULES=e._RULES,n._REQUIREMENTS=e._REQUIREMENTS,n._MANUFACTURINGPLANS=e._MANUFACTURINGPLANS,n._PRODUCT_CONFIGURATIONS=e._PRODUCT_CONFIGURATIONS,n._ENTREPRISE_VARIANTS_OPTIONS=e._ENTREPRISE_VARIANTS_OPTIONS,n._VARIANTS=e._VARIANTS,n._OPTIONS=e._OPTIONS,n._PARAMETERS=e._PARAMETERS,n._GROUP_OPTIONS=e._GROUP_OPTIONS,n._VARIANTS_DETAILS=e._VARIANTS_DETAILS,n._RULES_DETAILS=e._RULES_DETAILS,n._PRODUCT_CONFIGURATIONS_DETAILS=e._PRODUCT_CONFIGURATIONS_DETAILS,n._LIST_VIEW=e._LIST_VIEW,n._VIEW=e._VIEW,n._SORT=e._SORT,n._GROUP=e._GROUP,n._SEARCH=e._SEARCH,n._ID_CARD=e._ID_CARD,n._COLLAPSE=e._COLLAPSE,n._DICTIONARY_TAB_VALUES=e._DICTIONARY_TAB_VALUES,n._DICTIONARY_TAB_OPTIONS=e._DICTIONARY_TAB_OPTIONS,n.prototype.initWidgetViewPreferences=function(){const e={"xmodel-app":{"last-route":{},"xmodel-views-preferences":{"info-panel":{"info-open":"","info-context":"","info-width":""},"xmodel-recently-opened":{"xmodel-list-view":{selections:[],tagFilter:{}}},"xmodel-my-model-versions":{"xmodel-list-view":{view:"",sort:{},search:"",selections:[],filters:{},tagFilter:{}}},"xmodel-my-units":{"xmodel-list-view":{view:"",sort:{},search:"",selections:[],filters:{},tagFilter:{},contextId:{},group:""}},"xmodel-model-versions":{"xmodel-list-view":{view:"",sort:{},group:"",search:"",selections:[],filters:{},tagFilter:{}}},"xmodel-model-versions-details":{tab:"",variability:{"xmodel-list-view":{view:"",sort:{},group:"",selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}},rules:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""},visibleColumns:[]}},requirements:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""}}},specifications:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""}}},"product-configurations":{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},"split-view":{"split-open":"","split-width":""},customAttributes:"",visibleColumns:[]}},manufacturingPlans:{"xmodel-list-view":{view:"",sort:{},selections:[],group:"",tagFilter:{},"split-view":{"split-open":"","split-width":""}}},"id-card":{collapse:""}},"xmodel-entreprise-variants-options":{tab:"",variants:{"xmodel-list-view":{view:"",sort:{},group:"",selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}},"group-options":{"xmodel-list-view":{view:"",sort:{},group:"",selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}},options:{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{}}},parameters:{"xmodel-list-view":{view:"",sort:{},group:"",selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]}}},"variants-details":{"xmodel-list-view":{view:"",sort:{},selections:[],tagFilter:{},customAttributes:"",visibleColumns:[]},"id-card":{collapse:""}},"optiongroup-details":{"xmodel-list-view":{view:"",sort:{},selections:[],customAttributes:"",visibleColumns:[]},"id-card":{collapse:""}},"rules-details":{"expression-rule":{"xmodel-list-view":{group:""}},"id-card":{collapse:""},filters:{}},"product-configurations-details":{"id-card":{collapse:""},"xmodel-list-view":{"split-view":{"split-width":"","xmodel-list-view":{view:"",sort:{}}}},"physical-product-id":""},"base-configurations-details":{"id-card":{collapse:""},"xmodel-list-view":{"split-view":{"split-width":"","xmodel-list-view":{view:"",sort:{}}}},"physical-product-id":""},Values:{"xmodel-list-view":{selections:[]}},Options:{"xmodel-list-view":{selections:[]}},copyFrom:{"xmodel-list-view":{contextId:""},tab:""}}}};var i=window.widget.getValue(n._KEY);i?(i=JSON.parse(i),t.equals(e,i)||(t.extend(e,i,!0),window.widget.setValue(n._KEY,JSON.stringify(e)))):window.widget.setValue(n._KEY,JSON.stringify(e))},n.prototype.updateWidgetViewPreferences=function(e,t){if(this.isPath(e,!1)){var i=JSON.parse(window.widget.getValue(n._KEY)),a=JSON.parse(JSON.stringify(e));window.widget.setValue(n._KEY,JSON.stringify(this.recursiveSearch(i,a,t,!0)))}},n.prototype.recursiveSearch=function(e,t,i,n){return n&&2===t.length?e[t[0]][t[1]]=i:2===t.length?e[t[1]]=i:n?this.recursiveSearch(e[t[0]],t,i,!1):(t.shift(),this.recursiveSearch(e[t[0]],t,i,!1)),e},n.prototype.isPath=function(e,i){try{var a=window.widget.getValue(n._KEY);if(a){if(Array.isArray(e)){for(var o=JSON.parse(a),s=0;s<e.length;s++){if(void 0===o[e[s]]&&""!==o[e[s]]){if(t.log("xModelWidgetPreferencesManager isPath() path doesn't exist >> "+e),i)return;return!1}o=o[e[s]]}return!i||o}if(t.log("xModelWidgetPreferencesManager isPath() parameter 1 is not a Array"),i)return;return!1}if(t.log("xModelWidgetPreferencesManager isPath() widgetPreferences not initialize"),i)return;return!1}catch(e){if(t.log(e),i)return;return!1}},n.prototype.getValue=function(e){return this.isPath(e,!0)},n}),define("DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager",["UWA/Core","UWA/Class","DS/ENOXModelApp/Utils/xModelLocalStorage","DS/ENOXModelApp/Utils/xModelWidgetPreferencesManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant"],function(e,t,i,n,a){"use strict";return t.singleton({initialize:function(e,t,a){this._withLocalStorage=e,this._withWidgetPreferences=t,this._withUserPreferences=a,e&&i.init(this.userID),t&&n.prototype.initWidgetViewPreferences()},setUserId:function(e){this.userID=e},isWidgetPreferencePath:function(e){return!!this._withWidgetPreferences&&n.prototype.isPath(e,!1)},updatePreference:function(t,a){if(this._withWidgetPreferences&&n.prototype.updateWidgetViewPreferences(t,a),this._withLocalStorage){var o=e.clone(t);o.splice(1,0,this.userID),i.setValue(o,a)}},updateView:function(e,t){this.updatePreference(e.concat([a._LIST_VIEW,a._VIEW]),t)},updateContext:function(e,t){this.updatePreference(e.concat([a._LIST_VIEW,a._CONTEXTID]),t)},updateCustomAttributeStatus:function(e,t){return this.updatePreference(e.concat([a._LIST_VIEW,a._WITH_CUSTOM_ATTRIBUTES]),t)},updateGroup:function(e,t){this.updatePreference(e.concat([a._LIST_VIEW,a._GROUP]),t)},updateSort:function(e,t){this.updatePreference(e.concat([a._LIST_VIEW,a._SORT]),t)},updateSelectedItems:function(e,t){return this.updatePreference(e.concat([a._LIST_VIEW,a._SELECTIONS]),t)},updateSplitViewStatus:function(e,t){return this.updatePreference(e.concat([a._LIST_VIEW,a._SPLITVIEW,a._SPLITOPEN]),t)},updateSplitViewWidth:function(e,t){return this.updatePreference(e.concat([a._LIST_VIEW,a._SPLITVIEW,a._SPLITWIDTH]),t)},updateInfoPanelStatus:function(e,t){return this.updatePreference(e.concat([a._INFOPANEL,a._INFOOPEN]),t)},updateInfoPanelContext:function(e,t){return this.updatePreference(e.concat([a._INFOPANEL,a._INFOCONTEXT]),t)},updateInfoPanelWidth:function(e,t){return this.updatePreference(e.concat([a._INFOPANEL,a._INFOPANELWIDTH]),t)},setTagFilter:function(e,t){return this.updatePreference(e.concat([a._LIST_VIEW,a._TAGFILTER]),t)},updateFilter:function(e,t){this.updatePreference(e.concat([a._LIST_VIEW,a._FILTERS]),t)},updateFilterRule:function(t,i,n){var o=e.clone(t);if(o=o.concat([a._FILTERS,i,a._COLUMNS]),this.isWidgetPreferencePath(o))this.updatePreference(o,n),e.log("Update filter rule in widgetPreference");else{var s=this.getWidgetPreferenceValue(t.concat([a._FILTERS]));if(void 0===s){e.log("updateFilterRule : update widgetPreference create a path filter for ruleDetail");var r=this.getWidgetPreferenceValue(t);r[a._FILTERS]={},this.updatePreference(t,r),s=this.getWidgetPreferenceValue(t.concat([a._FILTERS]))}s[i]={[a._COLUMNS]:n},this.updatePreference(t.concat([a._FILTERS]),s),e.log("Create a new filter rule in widgetPreference")}},updateTab:function(e,t){this.updatePreference(e.concat([a._TAB]),t)},updateCollapse:function(e,t){this.updatePreference(e.concat([a._ID_CARD,a._COLLAPSE]),t)},updateVisibleColumns:function(e,t){this.updatePreference(e.concat([a._LIST_VIEW,a._VISIBLE_COLUMNS]),t)},getVisibleColumns:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._VISIBLE_COLUMNS]))},getCurrentProductId:function(e,t){var i,n=this.getPreference(e.concat([a._PHY_PRODUCT_ID]));return n&&(i=n[t]),i},setCurrentProductId:function(t,i,n){var o=this.getPreference(t.concat([a._PHY_PRODUCT_ID]));e.is(o,"object")||(o={}),n?o[i]=n:delete o[i],this.updatePreference(t.concat([a._PHY_PRODUCT_ID]),o)},getPreference:function(t){return e.log("XmodelApplicationPreferencesLanager -getPreference : "+t),this._withWidgetPreferences&&void 0!==this.getWidgetPreferenceValue(t)?this.getWidgetPreferenceValue(t):this._withLocalStorage?(t.splice(1,0,this.userID),this.getLocalStorageValue(t)):void 0},getView:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._VIEW]))},getContext:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._CONTEXTID]))},getSort:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._SORT]))},getSelectedItems:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._SELECTIONS]))},getCustomAttributeStatus:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._WITH_CUSTOM_ATTRIBUTES]))},getSplitViewStatus:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._SPLITVIEW,a._SPLITOPEN]))},getSplitViewWidth:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._SPLITVIEW,a._SPLITWIDTH]))},getInfoPanelStatus:function(e){return this.getPreference(e.concat([a._INFOPANEL,a._INFOOPEN]))},getInfoPanelContext:function(e){return this.getPreference(e.concat([a._INFOPANEL,a._INFOCONTEXT]))},getInfoPanelWidth:function(e){return this.getPreference(e.concat([a._INFOPANEL,a._INFOPANELWIDTH]))},getTagFilter:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._TAGFILTER]))},getFilter:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._FILTERS]))},getGroup:function(e){return this.getPreference(e.concat([a._LIST_VIEW,a._GROUP]))},getTab:function(e){return this.getPreference(e.concat([a._TAB]))},getCollapse:function(e){return this.getPreference(e.concat([a._ID_CARD,a._COLLAPSE]))},setRouteInfo:function(t){if(this._withWidgetPreferences){var i=[a._KEY,a._LAST_ROUTE],o={name:t&&t.name?t.name:void 0,params:t&&t.params?t.params:void 0};n.prototype.updateWidgetViewPreferences(i,o),e.log(JSON.parse(window.widget.getValue("xmodel-app"))),e.log("")}},getRouteInfo:function(){if(this._withWidgetPreferences){var e=[a._KEY,a._LAST_ROUTE];return this.getWidgetPreferenceValue(e)}return{name:void 0,params:{}}},getLocalStorageValue:function(e){return i.getValue(e)},getWidgetPreferenceValue:function(e){return n.prototype.getValue(e)}})}),define("DS/ENOXModelApp/InformationPanels/DictionaryTab/js/DictionaryTabPresenter",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/comm/EventManager","DS/CoreEvents/ModelEvents","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xModelEventManager/xModelEventManager","i18n!DS/ENOXModelApp/assets/nls/InformationPanels/DictionaryTabPresenter","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","css!DS/ENOXModelApp/InformationPanels/DictionaryTab/css/DictionaryTabPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f){"use strict";return t.extend(i,n,{name:"dico-tab-container",init:function(e){this._parent(e),this._eventManagerOptions=[],this._isEditable=!1!==e.isEditable,this._isVariabilityFrozen=e.isVariabilityFrozen,this._tagsActivated=!1,this._initContainer(),this._isLoaded=!1,this.flag=[]},_initContainer:function(){var t=this;this.elements.container=e.createElement("div",{class:this.getClassNames()}),this._isEditable||this.elements.container.addClassName("disable-actions"),this.getType=function(){var e;switch(t.getTabId()){case"Values":e=f.TYPE_VALUE;break;case"Options":e=f.TYPE_OPTION}return e},this._treeDocument=new s,this._updateChannel=new o;var i={id:"variability-"+this.getTabId(),model:this._treeDocument,useDragAndDrop:!0,modelEvents:this._updateChannel,viewOptions:{identifier:"variability-"+this.getTabId(),currentView:"DataGridView",views:["DataGridView"],grid:{columns:[{text:h.TITLE,dataIndex:"tree"},{text:h.NAME,dataIndex:"name"}]},contextualActions:[{id:"add",title:u._tabAddActionLabel,text:u._tabAddActionLabel,fonticon:"list-row-insert",handler:function(e){v.checkActionAccess({action:f.ADDEXISTING,type:t.getType(),notify:!0})&&e.id&&a.publish("variability-"+t.getTabId()+"-add-action",{parentId:t._id,ids:[e.id]})}}]},emptyContentOptions:{sentences:[{type:"icon",fonticon:"product",sizeicon:"40px",text:h.EMPTY_CONTENT_MESSAGE}]},toolbarOptions:{itemsName:u.get("_tab-"+this.getTabId()+"-multipleLabel"),itemName:u.get("_tab-"+this.getTabId()+"-singleLabel"),withStableActions:!0,useGeneratedToolbar:!0,touchMode:!1,showTaggerFilter:!0,filterActions:[{id:"mv-filter",text:u._filter,fonticon:"list-filter",selected:!1,multiSelect:!0,actions:[{id:"filter_by_6w",text:u._6WTags,selectable:!0,selected:!1,handler:function(){a.publish("variability-"+t.getTabId()+"-filter-by-tags",this.selected),t._openTagger(this.selected)}}]}],actions:[{id:"create",text:h.CREATE,fonticon:"plus",visibility:!this._isEditable,handler:function(){t._isVariabilityFrozen?v.checkActionAccess({action:f.CREATE,type:t.getType(),notify:!0})&&a.publish("variability-"+t.getTabId()+"-create-new-action",t._id):v.getErrorMessage(t.getType())}},{className:"divider"},{id:"add-to-list-multiple",text:u._tabAddToList,fonticon:"list-row-insert",visibility:!0,handler:function(){v.checkActionAccess({action:f.ADDEXISTING,type:t.getType(),notify:!0})&&(t.multipleAdd(this.getXSO().get()),t._updateChannel.publish({event:"xmodel-list-unselect-all"}))}}]},extensions:[d,c]};this._listView=new l(i),this._listView.inject(this.elements.container)},_tagsFilterSelected:function(){this._filterPreferences&&this._showTagsActivated(!0)},_subscribeEvents:function(){var e=this,t="variability-"+this.getTabId();e._eventManagerOptions.push({eventName:t+"-load-action",callback:function(t){e.loadData(t),e._isLoading=!1}}),e._eventManagerOptions.push({eventName:t+"-add-item-action",callback:function(t){e.addItem(t)}}),e._eventManagerOptions.push({eventName:t+"-added-list-action",callback:function(t){setTimeout(function(){e.disableActions(t)},1e3)}}),e._eventManagerOptions.push({eventName:t+"-set-editable",callback:function(t){e.setEditable(t)}}),e._eventManagerOptions.push({eventName:t+"-filter-by-tags",callback:function(t){e._showTagsActivated(t)}}),e._eventManagerOptions.push({eventName:"information-panel-open",callback:function(){e._tagsActivated&&e._showTagsActivated(e._tagsActivated)}}),e._updateChannel.publish({event:"xmodel-list-enable-contextual-menu",data:e._isEditable}),this._eventManagerOptions.forEach(function(e){a.subscribe(e.eventName,e.callback)}),e._isEditable&&this.subscribeListViewEvents()},_showTagsActivated:function(e){let t={showFocusedState:!0,deactivateOthers:!0,tagsActivated:e};this._updateChannel.publish({event:"xmodel-list-view-set-tagger-context",data:t}),a.publish("set-variability-tagger-context",!e),this._tagsActivated=e},subscribeListViewEvents:function(){var e=this;this._eventManager=new p(this._updateChannel),this._eventManager.subscribe(this._updateChannel,{event:"xmodel-list-item-on-add-selection"},function(t){e.flag=[];for(var i=[],n=0;n<t.items.length;n++)t.items[n].options&&i.push(t.items[n].options.id),t.items[n].options&&t.items[n].options.disableMenu||e.flag.push(n);e.flag.length!=t.items.length?e._updateChannel.publish({event:"xmodel-list-toolbar-hide-action",data:"add-to-list-multiple"}):e._updateChannel.publish({event:"xmodel-list-toolbar-show-action",data:"add-to-list-multiple"}),m.updateSelectedItems(e.getPanelPath(),i)}),this._eventManager.subscribe(this._updateChannel,{event:"xmodel-list-tagger-on-filter-change"},function(t){let i=!1;Object.keys(t).length>0&&(i=!0),e._updateChannel.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"taggerFilter",flag:i}})}),this._eventManager.subscribe(this._updateChannel,{event:"xmodel-list-tagger-on-setup"},function(){e._showTagsActivated(e._tagsActivated)}),this._eventManager.subscribe(this._updateChannel,{event:"xmodel-list-item-on-empty-selection"},function(){e.flag=[],e._updateChannel.publish({event:"xmodel-list-toolbar-hide-action",data:"add-to-list-multiple"}),m.updateSelectedItems(e.getPanelPath(),[])}),this._eventManager.subscribe(this._updateChannel,{event:"xmodel-list-collection-toolbar-filter-changed"},function(t){let i=t.selected;m.updateFilter(e.getPanelPath(),i)}),this._eventManager.subscribe(this._updateChannel,{event:"xmodel-list-item-on-remove-selection"},function(t){e.flag=[];for(var i=[],n=0;n<t.items.length;n++)t.items[n].options&&i.push(t.items[n].options.id),t.items[n].options&&t.items[n].options.disableMenu||e.flag.push(n);e.flag.length!=t.items.length?e._updateChannel.publish({event:"xmodel-list-toolbar-hide-action",data:"add-to-list-multiple"}):e._updateChannel.publish({event:"xmodel-list-toolbar-show-action",data:"add-to-list-multiple"}),m.updateSelectedItems(e.getPanelPath(),i)})},setEditable:function(e){this._isEditable!==e&&(this._isEditable=e,this._updateChannel.publish({event:"xmodel-list-unselect-all"}),this._eventManager&&this._eventManager.cleanup(),this._isEditable?(this.elements.container.removeClassName("disable-actions"),this._updateChannel.publish({event:"xmodel-list-toolbar-show-action",data:"create"}),this.flag.length>0?this._updateChannel.publish({event:"xmodel-list-toolbar-show-action",data:"add-to-list-multiple"}):this._updateChannel.publish({event:"xmodel-list-toolbar-hide-action",data:"add-to-list-multiple"}),this.subscribeListViewEvents()):(this.elements.container.addClassName("disable-actions"),this._updateChannel.publish({event:"xmodel-list-toolbar-hide-action",data:"create"}),this._updateChannel.publish({event:"xmodel-list-toolbar-hide-action",data:"add-to-list-multiple"})),this._updateChannel.publish({event:"xmodel-list-enable-contextual-menu",data:this._isEditable}))},_unsubscribeEvents:function(){this._eventManagerOptions.forEach(function(e){a.remove(e.eventName,e.callback)}),this._eventManagerOptions=[],this._eventManager&&this._eventManager.cleanup()},disableActions:function(e){this._updateChannel.publish({event:"xmodel-list-view-disble-menu",data:e})},loadData:function(e){this._updateChannel.publish({event:"xmodel-list-data-on-load-start"}),this._updateChannel.publish({event:"xmodel-list-data-load-action",data:e}),this._updateChannel.publish({event:"xmodel-list-data-on-load-complete"});a.publish("variability-"+this.getTabId()+"-added-list-start",this._id);var t=m.getSelectedItems(this.getPanelPath());t&&t.length>0&&this._updateChannel.publish({event:"xmodel-list-selection-action",data:t}),this._isLoaded=!0,this.hideLoader()},addItem:function(e){this._updateChannel.publish({event:"xmodel-list-data-on-load-start"}),this._updateChannel.publish({event:"xmodel-list-data-item-add-action",data:e}),this._updateChannel.publish({event:"xmodel-list-data-on-load-complete"});var t=this;setTimeout(function(){t.disableActions([e.id])},1e3)},updateFacet:function(){this._subscribeEvents(),this._isLoaded=!1,this._isLoading=!1,this.setModel(this.getModel())},hide:function(){this._parent.apply(this,arguments),a.publish("set-variability-tagger-context",!0)},show:function(){this._parent.apply(this,arguments),this._unsubscribeEvents(),this._subscribeEvents(),a.publish("variability-"+this.getTabId()+"-on-show"),this._isLoaded||this._isLoading||this._id&&(a.publish("variability-"+this.getTabId()+"-load-data-start",this._id),this._isLoading=!0,this.showLoader()),this._tagsActivated&&this._showTagsActivated(this._tagsActivated)},setModel:function(e){this._id=e.get("objectId")},_removeTaggerFilter:function(){this._updateChannel.publish({event:"xmodel-list-tagger-set-filter-action",data:{}})},_setTaggerFilter:function(){let e=m.getTagFilter(this.getPanelPath());this._updateChannel.publish({event:"xmodel-list-tagger-set-filter-action",data:e})},destroyComponent:function(){this.elements.container="",this._showTagsActivated(!1),this._unsubscribeEvents(),this._eventManager&&this._eventManager.cleanup(),this._listView.destroy()},multipleAdd:function(e){if(e.length>0){for(var t=[],i=0;i<e.length;i++)e[i].options.id&&!e[i].options.disableMenu&&t.push(e[i].options.id);t.length>0&&a.publish("variability-"+this.getTabId()+"-add-action",{parentId:this._id,ids:t})}},getPanelPath:function(){return[_._KEY,_._VIEWS_PREFERENCES].concat(this.getTabId())},_openTagger:function(e){let t=parent.document.querySelector("#btn_tag_nav");t&&!t.classList.contains("tagger-icon-active")&&e&&t.click()}})}),define("DS/ENOXModelApp/Utils/xModelCommonUtils",["UWA/Core","UWA/Class","UWA/Class/Model","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/CfgDictionary/CfgDictionaryTypeEnum","DS/CfgDictionary/CfgDictionaryOperatorEnum","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n,a,o,s,r){"use strict";var l,d=("function"==typeof Event?l=new Event("scroll"):(l=document.createEvent("Event")).initEvent("scroll",!0,!0),l),c=t.singleton({debouncer:function(t,i,n){var a;return function(){e.is(this._debounceTimeouts)||(this._debounceTimeouts=[]);var o=this,s=arguments,r=n&&!a;clearTimeout(a);var l=this._debounceTimeouts.indexOf(a);-1!==l&&this._debounceTimeouts.splice(l,1),a=setTimeout(function(){a=null,n||t.apply(o,s)},i),this._debounceTimeouts.push(a),r&&t.apply(o,s)}},prepareTooltipObjectView:function(e){var t,i=e.options.grid;return i?(i.title&&(t=r.TITLE+" : "+i.title+"\n"),i.ruleType?t+=r.TYPE+" : "+i.ruleType+"\n":i.nlsValues&&i.nlsValues.nlsType?t+=r.TYPE+" : "+i.nlsValues.nlsType+"\n":i.type&&(t+=r.TYPE+" : "+i.type+"\n"),i.revision&&(t+=r.REVISION+" : "+i.revision+"\n"),i.basePrice&&(t+=r.BASEPRICE+" : "+(i.basePrice?parseFloat(i.basePrice):i.basePrice)+"\n"),i.nlsValues&&i.nlsValues.nlsState||i.maturity?t+=r.MATURITY_STATE+" : "+(i.nlsValues.nlsState?i.nlsValues.nlsState:i.maturity)+"\n":(i.state||i.maturity)&&(t+=r.MATURITY_STATE+" : "+(i.state?i.state:i.maturity)+"\n"),(i.owner||i.responsible)&&(t+=r.RESPONSIBLE+" : "+(i.owner?i.owner:i.responsible)+"\n"),i.modified&&(t+=r.MODIFICATION_DATE+" : "+this.formatDateAttribute(i.modified)+"\n"),i.organization&&(t+=r.ORGANIZATION+" : "+(i[n._ORG_TITLE]?i[n._ORG_TITLE]:i.organization)+"\n"),i.collabspace&&(t+=r.COLLABSPACE+" : "+(i[n._COLLABSPACE_TITLE]?i[n._COLLABSPACE_TITLE]:i.collabspace)+"\n"),i.name&&(t+=r.NAME+" : "+i.name)):t="",t},_getDropDownMenu:function(t,i){if(i&&i.length>0)return{items:i,events:{onClick:function(i,n){e.log("Publish idcard-dropdown-menu-action : "+n.id),t._modelEvent.publish({event:"idcard-dropdown-menu-action",data:n.id})}}}},_getAttributesForIdCard:function(e,t,i,n){return[{name:r._OWNER,value:e.owner?e.owner:"",type:"type-hyperlink",displayWhenMinified:!0,editable:!0,command:"OWNER"},{name:r.MATURITY_STATE,value:t,type:"type-hyperlink",displayWhenMinified:!0,editable:!0,command:"MATURITY"},{name:r.CREATION_DATE,value:i},{name:r.MODIFICATION_DATE,value:n,displayWhenMinified:!0}]},_getModelForIdCard:function(t,i,n,a,o,s){let l=[0!==i.description.length?e.String.escapeHTML(i.description):r.NO_DESCRIPTION];s&&e.is(s.freeZones)&&s.freeZones.length>0&&(l=l.concat(s.freeZones));let d="";return e.is(i.typeNLS)?d=i.typeNLS:e.is(i.nlsValues)&&e.is(i.nlsValues.nlsType)&&(d=i.nlsValues.nlsType),{id:t,withToggleMinifiedButton:!0,withActionsButton:a,name:i.title,nlsType:d,version:i.revision?i.revision:"",thumbnail:i.image?i.image:"",modelEvents:n,showBackButton:!1,dropdown:a,freezones:l,attributes:o,dragwithimage:{img:e.is(s)&&e.is(s.ResponsiveTile)?s.ResponsiveTile:null,item:{envId:window.window.widget&&void 0!==window.window.widget.getValue("x3dPlatformId")?window.window.widget.getValue("x3dPlatformId"):"OnPremise",serviceId:"3DSpace",contextId:window.widget.getValue("xPref_CREDENTIAL")?window.widget.getValue("xPref_CREDENTIAL"):"",objectId:t,objectType:i.type,objectName:i.name,displayType:i.type,displayName:i.title}}}},prepareIdCardData:function(t,n,a){this._modelEvent=n;var o="";if(null!=t&&void 0!==t.member[0]){var s=t.member[0],l=s["@id"]?s["@id"]:s.id?s.id:"",d=s.created?this.formatDateAttribute(s.created):"",c=s.modified?this.formatDateAttribute(s.modified):"";s.originated&&(d=this.formatDateAttribute(s.originated)),s.nlsValues&&s.nlsValues.nlsState?o=s.nlsValues.nlsState:s.state&&(o=s.state);var p=this._getAttributesForIdCard(s,o,d,c);s.basePrice&&p.push({name:r.BASEPRICE,value:parseFloat(s.basePrice),displayWhenMinified:!0}),e.is(s.reservedby)&&p.push({name:r.LOCKEDBY,value:s.reservedbyFullName?s.reservedbyFullName:s.reservedby?s.reservedby:"",displayWhenMinified:!0}),e.is(a)&&a.projectsattribute&&p.push({name:r.PROJECTS,value:'<div id="IdCardProjectValueContainer"/>',displayWhenMinified:!1,editable:!0,container:!0}),e.is(s.baseConfigurationTitle)&&p.push({name:r.BASE_CONFIGURATION,value:s.baseConfigurationTitle,displayWhenMinified:!1,editable:!1});var u=[];a&&a.commands&&void 0!==a.commands.copyFrom&&(u.push({id:"copyFrom",text:r.ADD_EXISTING_FROM,fonticon:"fonticon fonticon-plus",disabled:!a.commands.copyFrom}),u.push({className:"divider"})),s.revision&&u.push({id:"revision",text:r.REVISION_EXPLORER,fonticon:"flow-branch-list"});var h=!1;a&&a.commands&&!0===a.commands.compare&&(u.push({id:"compare",text:r.COMPARE,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-part-compare"}),h=!0),s.state&&(u.push({id:"state",text:r.MATURITY,fonticon:"collaborative-lifecycle-management"}),h=!0),h&&u.push({className:"divider"}),s.owner&&(u.push({id:"owner",text:r.CHANGE_OWNERSHIP,fonticon:"move-to"}),u.push({className:"divider"})),a&&a.commands&&!0===a.commands.relatedObjects&&u.push({id:"relatedObjects",text:r.RELATED_OBJECTS,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related"}),a&&a.commands&&!0===a.commands.changeImpacts&&u.push({id:"changeImpacts",text:r.CHANGE_IMPACTS,fonticon:"change"}),a&&a.commands&&!0===a.commands.subscriptions&&u.push({id:"subscriptions",text:r.SUBSCRIPTIONS,fonticon:"bell-list",items:[{id:"subscribe",text:r.SUBSCRIBE,fonticon:"bell-add"},{id:"unsubscribe",text:r.UNSUBSCRIBE,fonticon:"bell-delete"},{id:"editSubscriptions",text:r.EDIT_SUBSCRIPTIONS,fonticon:"bell-pencil"},{id:"mySubscriptions",text:r.MY_SUBSCRIPTIONS,fonticon:"bell"}]}),u.push({id:"information",text:r.INFORMATION,fonticon:"fonticon fonticon-info"}),u.push({className:"divider"}),a&&a.commands&&!0===a.commands.remove?u.push({id:"delete",text:r.Remove_label,fonticon:"fonticon fonticon-remove "}):u.push({id:"delete",text:r.DELETE,fonticon:"fonticon fonticon-trash "});var m=this._getDropDownMenu(this,u),_=this._getModelForIdCard(l,s,n,m,p,a);return new i(_)}e.log("[xModelCommonUtils:prepareIdCardData] Error!!! Incorrect/null data!!!")},setModelEventForIdCard:function(e){this._modelEvent=e},workaroundCheckAndWakeUpResizeSensor:function(){},old_workaroundCheckAndWakeUpResizeSensor:function(t){if(t){var i,n,a=t.getElementsByClassName("resize-sensor");if(a&&a.length>0)for(i=0,n=a.length;i<n;i++){var o=a[i];o&&o.children&&o.children[0]&&o.children[0].dispatchEvent(d)}var s=t.getElementsByClassName("enox-collection-toolbar-v2-container");if(s&&s.length>0)for(i=0,n=s.length;i<n;i++){var r=s[i];r&&r.resizedAttached&&e.is(r.resizedAttached.call,"function")&&r.resizedAttached.call()}}},formatDicoForXmodelListView:function(t){var i=this,n=e.clone(t),a=[],o=e.Json.path(n,"$..portfolioComponents.member");return(o=o&&o[0]?o[0]:[]).forEach(function(e){if(e)for(var t in e){var n,o,s;if(e.hasOwnProperty(t))if(e[t].member&&e[t].member.length>0){switch(t){case"variants":n="variant",o="value",s="values";break;case"variabilityGroups":n="variabilityGroup",o="option",s="options";break;case"parameters":n="parameter",o="",s="NO_CHILD";break;default:continue}i._filterInstanceItems(e[t].member,n,o,s),"variants"!==t&&"variabilityGroups"!==t&&"parameters"!==t||(a=a.concat(e[t].member))}}}),a},_formatAttributesDico:function(e){if(e&&e.attributes)for(var t in e.attributes)if(e.attributes.hasOwnProperty(t)){var i=t.indexOf("_");0===i&&(e[t.slice(i+1)]=e.attributes[t])}},_filterInstanceItems:function(e,t,i,n){for(var a={},o={},s=0;s<e.length;s++){var r=e[s];if(r.kind&&"instance"===r.kind&&"parameter"!==t)o[r.idref]=r.attributes?r.attributes._sequenceNumber:"",e.splice(s,1),s--;else{r.instanceId="variabilityGroup"===t?r.rel_id:r.id,r.sequenceNumber=o[r.id]?o[r.id]:"";var l=r.lid?r.lid:r.id?r.id:"";r.id=l,r.attributes._isA=t,this._formatAttributesDico(r);var d=[];if(r.hasOwnProperty(n))for(var c=r[n]&&r[n].member?r[n].member:[],p=0;p<c.length;p++){var u=c[p];if(u.kind&&"instance"===u.kind)c.splice(p,1),p--;else{u.parentId=l,u.instanceId=u.id;var h=u.rel_lid?u.rel_lid:u.id?u.id:"";u.id=h,d.push(h),u.attributes._isA=i,this._formatAttributesDico(u)}}a[l]=d}}},getAllVariabilityIdsToRemoveInXmodelListView:function(t,i){for(var n=[],a={},o={},s=0;s<t.length;s++)if(i[t[s]])switch(i[t[s]].type){case"value":case"option":o.hasOwnProperty(i[t[s]].parent)?o[i[t[s]].parent]+=1:o[i[t[s]].parent]=1,n.push(t[s]);break;case"variant":case"variability_group":a.hasOwnProperty(t[s])||(a[t[s]]=i[t[s]]);break;default:e.log('Issue getAllVariabilityIdsToRemoveInXmodelListView "TYPE" not recognize : '+i[t[s]].type,"error")}else e.log('Issue map getAllVariabilityIdsToRemoveInXmodelListView "ID" : '+t[s],"error");for(const[e,t]of Object.entries(o))if(a[e])switch(a[e].type){case"variability_group":a[e].content.length===t&&n.push(e);break;case"variant":a[e].values.length===t&&n.push(e)}return n},removeTypesFromXmodelFormat:function(t,i){for(var n=e.clone(t),a=0;a<n.length;a++)-1!==i.indexOf(n[a].type)&&(n.splice(a,1),a--);return n},removeListIdToListAllCriteria:function(e,t){if(e.length>0)for(var i,n=t.length-1;n>-1;n--)if(-1!==e.indexOf(t[n].id))t.splice(n,1);else{if(t[n].values&&t[n].values.member.length>0)for(i=t[n].values.member.length-1;i>-1;i--)-1!==e.indexOf(t[n].values.member[i].id)&&(t[n].values.member.splice(i,1),0===t[n].values.member.length&&delete t[n].values);if(t[n].options&&t[n].options.member.length>0)for(i=t[n].options.member.length-1;i>-1;i--)-1!==e.indexOf(t[n].options.member[i].id)&&(t[n].options.member.splice(i,1),0===t[n].options.member.length&&delete t[n].options)}return t},formatDateAttribute:function(t){var i,n={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},a="";window.widget&&window.widget.lang?i=window.widget.lang:navigator&&navigator.language&&(i=navigator.language);var o=Intl.DateTimeFormat(i,n);if(t)if(e.is(t,"date"))a=o.format(t);else{var s=new Date(t);a=o.format(s)}return a},_buildExpressionRuleDefinitionInPublicAPIsFormat:function(e,t){var i,n={ruleDefinition:{},ruleCriteria:{},userAgent:"xmodel"},s="";n.ruleCriteria.criteria=[];for(var r,l,d={},c=[],p=0;p<e.definition.length;p++)if("dummy"!==e.definition[p].type)switch(e.definition[p].type){case a.VARIANT:(p===e.definition.length-1||p<e.definition.length-1&&e.definition[p+1].type!==a.VALUE)&&(s+=e.definition[p].id+" ");break;case a.VARIABILITY_GROUP:(p===e.definition.length-1||p<e.definition.length-1&&e.definition[p+1].type!==a.OPTION)&&(s+=e.definition[p].id+" ");break;case a.VALUE:case a.OPTION:s+=e.definition[p].id+" ";var u=t[e.definition[p].id],h=t[u.parent];if(void 0===d[u.parent])i={},h.type===a.VARIANT?((i=this._generateObjectForPublicApi(u.parent,"dspfl:Variant",void 0,h.title)).values=[],r=this._generateObjectForPublicApi(e.definition[p].id,"dspfl:VariantValue",void 0,u.title),i.values.push(r),c.push(e.definition[p].id)):((i=this._generateObjectForPublicApi(u.parent,"dspfl:VariabilityGroup",void 0,h.title)).options=[],l=this._generateObjectForPublicApi(e.definition[p].id,"dspfl:Option",void 0,u.title),i.options.push(l),c.push(e.definition[p].id)),d[u.parent]=n.ruleCriteria.criteria.length,n.ruleCriteria.criteria.push(i);else if(!c.includes(e.definition[p].id)){var m=d[u.parent],_=n.ruleCriteria.criteria[m];u.type===a.VALUE?(r=this._generateObjectForPublicApi(e.definition[p].id,"dspfl:VariantValue",void 0,u.title),_.values.push(r)):(l=this._generateObjectForPublicApi(e.definition[p].id,"dspfl:Option",void 0,u.title),_.options.push(l)),c.push(e.definition[p].id)}break;case a.PARAMETER:s+=(u=t[e.definition[p].id]).id+" ",c.includes(u.id)||(i=this._generateObjectForPublicApi(u.id,"dspfl:Parameter",void 0,u.title),n.ruleCriteria.criteria.push(i),c.push(u.id));break;case a.NUMBER:case a.FRACTION:0===p||e.definition[p-1].type===o.arithmetic_operator?s+=e.definition[p].value+" ":s+="+"+e.definition[p].value+" ";break;case o.arithmetic_operator:p<e.definition.length-1&&(e.definition[p+1].type===a.NUMBER||e.definition[p+1].type===a.FRACTION?s+=e.definition[p].value:e.definition[p+1].type===a.PARAMETER&&(s+=e.definition[p].value+"1 "));break;case o.eval_function:case o.binary_operator:case o.unary_operator:case o.opening_separator:case o.closing_separator:case o.comparison_operator:s+=e.definition[p].value+" "}return n.ruleDefinition={expression:s},n},_buildMatrixRuleDefinitionInPublicAPIsFormat:function(e,t){var i={ruleDefinition:{},ruleCriteria:{},userAgent:"xmodel"};i.title=e.title,i.description=e.description,i.ruleCriteria.drivingCriteria=[],i.ruleCriteria.constrainedCriteria=[];var n=e.definition;i.ruleCriteria.drivingCriteria=this._buildRuleCriteriaFormatForPublicAPI(n.drivingCriteria,t),i.ruleCriteria.constrainedCriteria=this._buildRuleCriteriaFormatForPublicAPI(n.constrainedCriteria,t),i.ruleDefinition.conditions=[];for(var a=0;a<n.states.length;a++){for(var o=n.states[a],s=[],r=!1,l=[],d=0;d<o.length;d++){var c="";"S"===o[d]?c="Selected":"D"===o[d]?c="Default":"N"===o[d]&&(c="Not Available"),""!==c&&(r=!0,l.push({identifier:n.constrainedValues[d].id,status:c}))}if(r){for(var p=n.drivingCombinationValues[a],u=Object.keys(p),h=0;h<u.length;h++)s.push(p[u[h]].variantValue);i.ruleDefinition.conditions.push({driving:s,constrained:l})}}return i},buildRuleDefinitionInPublicAPIsFormat:function(e,t){if(e){if("table"===e.type)return this._buildMatrixRuleDefinitionInPublicAPIsFormat(e,t);if("expression"===e.type)return this._buildExpressionRuleDefinitionInPublicAPIsFormat(e,t)}return{}},_buildFormatPublicAPIForVariant:function(e,t){for(var i=this._generateObjectForPublicApi(e.id,"dspfl:Variant",e.name,e.title),n=[],a=0;a<e.values.length;a++){var o=this._generateObjectForPublicApi(e.values[a].id,"dspfl:VariantValue",t[e.values[a].id].name,t[e.values[a].id].title);n.push(o)}return i.values=n,i},_buildFormatPublicAPIForVariabilityGroup:function(e,t){for(var i=this._generateObjectForPublicApi(e.id,"dspfl:VariabilityGroup",e.name,e.title),n=[],a=0;a<e.options.length;a++){var o=this._generateObjectForPublicApi(e.options[a].id,"dspfl:Option",t[e.options[a].id].name,t[e.options[a].id].title);n.push(o)}return i.options=n,i},_generateObjectForPublicApi:function(e,t,i,n){var a={};return a.identifier=e,a.type=t,i&&(a.name=i),a.title=n,a},_buildRuleCriteriaFormatForPublicAPI:function(e,t){for(var i=[],n={},a=0;a<e.length;a++){var o=t[e[a].id],s={};if(o)if("variant"===o.type.toLowerCase())o.id=e[a].id,o.values=e[a].selectedValues,s=this._buildFormatPublicAPIForVariant(o,t);else if("variability_group"===o.type.toLowerCase())o.id=e[a].id,o.options=e[a].selectedValues,s=this._buildFormatPublicAPIForVariabilityGroup(o,t);else{var r=o.parent,l=o;if(l.id=e[a].id,void 0===n[r])(o=t[o.parent]).id=r,o.options=[],o.options.push(l),n[r]=i.length,s=this._buildFormatPublicAPIForVariabilityGroup(o,t);else{var d=i[n[r]],c=this._generateObjectForPublicApi(l.id,"dspfl:Option",t[l.id].name,t[l.id].title);d.options.push(c)}}0!==Object.keys(s).length&&i.push(s)}return i},isSelectedRowsLock:function(e){let t,i=s.userID;return e.items.forEach(n=>{let a=e.items.every(e=>"TRUE"===e.options.grid.reserved&&e.options.grid.reservedby==i),o=e.items.every(e=>"FALSE"===e.options.grid.reserved);a?t=!0:o&&(t=!1)}),t},showToolbarLockUnlockIcons:function(e,t){let i=this.isSelectedRowsLock(t);i?(e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"lock",flag:!1}}),e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unlock",flag:!0}})):0==i?(e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"lock",flag:!0}}),e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unlock",flag:!1}})):(e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"lock",flag:!1}}),e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unlock",flag:!1}}))},showContextualActions:function(e,t,i,n){let a,o=this;if(event){let l,d=e,c=s.userID,p=d.every(e=>"TRUE"===e.options.grid.reserved&&e.options.grid.reservedby==c),u=d.every(e=>"FALSE"===e.options.grid.reserved);p?a=!0:u&&(a=!1),0==a?l={id:"lock",title:r.LOCK,fonticon:"lock",state:i?"disabled":"enabled",handler:function(e,t){o.handleReservedCmd(n._privateChannel,n._listPresenter._getSelectedItem(),n._command)}}:a&&(l={id:"unlock",title:r.UNLOCK,fonticon:"lock-open",state:i?"disabled":"enabled",handler:function(e,t){o.handleUnReservedCmd(n._privateChannel,n._listPresenter._getSelectedItem(),n._command)}}),l&&t.splice(1,0,l)}return t},handleReservedCmd:function(e,t,i){i._handleReserveCommand(t),e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"lock",flag:!1}}),e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unlock",flag:!0}})},handleUnReservedCmd:function(e,t,i){let n=s.userID;t.every(e=>e.reservedby===n)&&(i._handleUnreserveCommand(t),e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"lock",flag:!0}}),e.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unlock",flag:!1}}))},onLockColumnCellClick:function(e,t,i,n){if(e.event.dsModel.getCellInfosFromHtmlElement(e.event.target).columnID===t){let a=e.event.dsModel.layout.getColumnIdentifiers(t).dataIndex,o=e.model.reserved,r=e.model.reservedby,l=s.userID;"Lock status"===a&&("TRUE"===o&&r==l?(i._handleUnreserveCommand(e.model),n.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"lock",flag:!0}}),n.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unlock",flag:!1}})):r!==l&&""!==r||(i._handleReserveCommand(e.model),n.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"lock",flag:!1}}),n.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unlock",flag:!0}})))}},getIconOfLockStatus:function(e){var t="fonticon fonticon-lock-open reservations-lock-open";const i=e.nodeModel.options.grid.reservedby,n=e.nodeModel.options.grid.reserved,a=s.userID;return a==i&&"TRUE"===n?{icon:"fonticon fonticon-key reservations-key coloured-boolean",label:"",func:async function(){}}:a==i&&"FALSE"===n?{icon:t,label:"",func:async function(){}}:a!=i&&"TRUE"===n?{icon:"fonticon fonticon-lock reservations-lock coloured-red-boolean",label:"",func:async function(){}}:a!=i&&"FALSE"===n?{icon:t,label:"",func:async function(){}}:void 0},getTooltipOfLockedStatus:function(t){if(t.nodeModel){let i=s.userID,n=t.nodeModel.options.grid.reserved,a=t.nodeModel.options.grid.reservedby;if("TRUE"===n&&i===a){let i=t.nodeModel.options.grid.reservedbyFullName;return{shortHelp:e.String.format(r.Tooltip_Alert,i)}}if("TRUE"===n&&i!=a){let i=t.nodeModel.options.grid.reservedbyFullName;return{shortHelp:e.String.format(r.Tooltip_Alert_For_RedLock,i)}}}}});return c.init(),c}),define("DS/ENOXModelApp/InformationPanels/UnitsPlanningTab/PlanningTab",["UWA/Core","UWA/Class","UWA/Class/View","DS/UIKIT/Form","DS/UIKIT/Scroller","UWA/Controls/Abstract","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/components/ContextSelector/AutocompleteManager","DS/EditPropWidget/facets/Common/FacetsBase","DS/CoreEvents/ModelEvents","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/UnitsStatePresenter","css!DS/ENOXModelApp/InformationPanels/UnitsPlanningTab/PlanningTab.css","css!DS/ENOXModelApp/components/DialogCreation/UnitDialogCreation.css","css!DS/ENOXModelApp/InformationPanels/UnitsPlanningTab/PlanningTabForm.css"],function(e,t,n,a,o,s,r,l,d,c,p){"use strict";return t.extend(s,d,{name:"unit-tab-container",init:function(t){this._parent(t),this.autocompleteManager=new l,this.modelEvent=t.privateChannel,this.multiselection=t.multiselection,this.items=e.is(t.model,"array")?t.model[0].options.grid:t.model,this.model=t.model,this.className="vertical",this.layout="vertical",this._initContainer(),this.editState=!1,this.renderView()},_initContainer:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.grand=e.createElement("div",{class:"wux-controls-button wux-controls-abstract wux-ui-state-secondary wux-ui-style-lite",tabindex:"0"}),this.parent=e.createElement("div",{class:"wux-button-icon-placeholder"}),this.child=e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-pencil wux-ui-3ds-lg"}),this.parent.appendChild(this.child),this.grand.appendChild(this.parent),this.initializeHorizontalView=!0,this.addScroller=!0},createView:n.extend({className:"unit-plan-form",render:function(){return this.formContent=new a({className:this.className,fields:[{type:"date",name:"plannedbuilddate",label:p.PLANNED_BUILD_DATE,errorText:"",showClearIcon:!0},{type:"date",name:"dateshipped",label:p.DATE_SHIPPED,errorText:"",showClearIcon:!0},{type:"autocomplete",id:"inputmv",label:p.MODEL_VERSION,name:"modelversion",value:"",errorText:"",placeholder:"",required:!0},{type:"autocomplete",id:"inputpc",value:"",name:"productconfiguration",label:p.PRODUCT_CONFIGURATION,disabled:!0,errorText:"",placeholder:""},{type:"autocomplete",id:"inputmfg",value:"",name:"manufacturingplan",label:p.MANUFACTURING_PLAN,errorText:"",disabled:!0,placeholder:""}],buttons:[{type:"submit",value:p.SAVE,right:30},{type:"reset",value:p.CANCEL}]}),this.container.setContent(this.formContent),this}}),updateFacet:function(){this.setModel(this.getModel())},setModel:function(e){this._id=e.get("objectId")},hide:function(){this._parent.apply(this,arguments),this.elements.container.hide()},show:function(){if(this._parent.apply(this,arguments),this.elements.container.show(),this.onResize(),this.multiselection){let e=document.querySelector(".EditProp_MasterContain .wux-ui-3ds-pencil").hide();e&&e.hide()}if(document.querySelectorAll(".form-group")[1].addClassName("setmargin"),document.querySelectorAll(".form-group")[2].addClassName("setmargin"),this.addScroller){this.addScroller=!1;var e=document.querySelector(".non-editable-vertical"),t=document.querySelector(".unit-plan-form");t.setStyle("height","100%"),new o({element:t}).inject(e)}},renderView:function(){this.privateChannel=new c,this.view=new this.createView,this.view.render(),this.view.inject(this.elements.container),this.view.hide(),this.mvAutocomplete=this.view.formContent.autocompletes[0],this.pcAutocomplete=this.view.formContent.autocompletes[1],this.mpAutocomplete=this.view.formContent.autocompletes[2],this.disableFirstEditMode(),this.model.length>1&&(this.editState=!1,this.onAction()),this.view.show()},addIcons:function(){var t=this,i=e.createElement("span",{class:"plandate-icon-span wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-calendar"}),n=e.createElement("span",{class:"shipdate-icon-span wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-calendar"});this.view.formContent.getField("plannedbuilddate").getParent().appendChild(i),this.view.formContent.getField("dateshipped").getParent().appendChild(n),i.addEvent("click",function(e){var i=t.view.formContent.getField("plannedbuilddate");i&&i.click()}),n.addEvent("click",function(e){var i=t.view.formContent.getField("dateshipped");i&&i.click()})},addAutocompleteEvents:function(){var e=this;e.mvAutocomplete.elements.suggestsContainer.addEventListener("click",function(t,i){e.pcAutocomplete.enable(),e.mpAutocomplete.enable()}),this.mvAutocomplete.elements.input.oninput=function(t){var i,n=e.mvAutocomplete.elements.input.value;""==n?e.mvAutocomplete.elements.clear.setStyle("display","none"):e.mvAutocomplete.elements.clear.setStyle("display","block"),(i=e.mvAutocomplete.getItemByLabel(n))||(e.pcAutocomplete.elements.clear.click(),e.pcAutocomplete.elements.input.value="",e.pcAutocomplete.disable(),e.mpAutocomplete.elements.clear.click(),e.mpAutocomplete.elements.input.value="",e.mpAutocomplete.disable()),i&&(e.pcAutocomplete.enable(),e.mpAutocomplete.enable()),e.pcAutocomplete.resetCache(),e.mpAutocomplete.resetCache()},this.pcAutocomplete.elements.input.oninput=function(t){""==e.pcAutocomplete.elements.input.value?e.pcAutocomplete.elements.clear.setStyle("display","none"):e.pcAutocomplete.elements.clear.setStyle("display","block")},this.mpAutocomplete.elements.input.oninput=function(t){""==e.mpAutocomplete.elements.input.value?e.mpAutocomplete.elements.clear.setStyle("display","none"):e.mpAutocomplete.elements.clear.setStyle("display","block")},e.pcAutocomplete.elements.clear.onclick=function(){e.pcAutocomplete.elements.clear.setStyle("display","none")},e.mpAutocomplete.elements.clear.onclick=function(){e.mpAutocomplete.elements.clear.setStyle("display","none")},e.mvAutocomplete.elements.clear.onclick=function(){e.mvAutocomplete.elements.clear.setStyle("display","none"),e.mvAutocomplete.elements.input.value="",e.pcAutocomplete.elements.input.value="",e.pcAutocomplete.disable(),e.mpAutocomplete.elements.input.value="",e.mpAutocomplete.disable()},e.view.formContent.buttons[0].elements.input.onclick=function(){e.multiselection?(e.multiSelectMoveOrUpdate(),e.updateMultipleUnitDates()):(e.singleSelectMoveOrUpdate(),e.updateSingleUnitDates())}},updateMultipleUnitDates:function(){var t=this.view.formContent.getValues();if(t.dateshipped||t.plannedbuilddate){var i,n=[],a={dateShipped:e.is(this.view.formContent.getDateInput("dateshipped").getDate(),"date")?this.view.formContent.getDateInput("dateshipped").getDate().toLocaleDateString("en-US"):"",plannedDate:e.is(this.view.formContent.getDateInput("plannedbuilddate").getDate(),"date")?this.view.formContent.getDateInput("plannedbuilddate").getDate().toLocaleDateString("en-US"):""};for(i=0;i<this.model.length;i++){let e=this.model[i].options.grid;n.push(e.id)}this.modelEvent.publish({event:"update-dates",data:{units:n,updatedDates:a}})}},updateSingleUnitDates:function(){var t=this.view.formContent.getValues();if(t.dateshipped||t.plannedbuilddate){var i=[this.items.id],n={dateShipped:e.is(this.view.formContent.getDateInput("dateshipped").getDate(),"date")?this.view.formContent.getDateInput("dateshipped").getDate().toLocaleDateString("en-US"):"",plannedDate:e.is(this.view.formContent.getDateInput("plannedbuilddate").getDate(),"date")?this.view.formContent.getDateInput("plannedbuilddate").getDate().toLocaleDateString("en-US"):""};this.modelEvent.publish({event:"update-dates",data:{units:i,updatedDates:n}})}},multiSelectMoveOrUpdate:function(){let e,t,i;if(this.mvAutocomplete.selectedItems&&0!=this.mvAutocomplete.selectedItems.length){var n=[],a=[],o=this.mvAutocomplete.selectedItems[0].value;for(e=0;e<this.model.length;e++){let t=this.model[e].options.grid;o==t.modelVersion.identifier?a.push(t.id):n.push(t.id)}0!=this.pcAutocomplete.selectedItems.length&&(t=this.pcAutocomplete.selectedItems[0].value),0!=this.mpAutocomplete.selectedItems.length&&(i=this.mpAutocomplete.selectedItems[0].value);let s={mvId:o,pcId:t||"",mfgId:i||""},r={mvId:o,pcId:t||"",mfgId:i||""};1==a.length&&(r.unitId=a[0],this.modelEvent.publish({event:"update-allocation-singleselect",data:r})),a.length>1&&this.modelEvent.publish({event:"update-allocation-multiSelect",data:{data:r,Units:a}}),1==n.length&&(s.unitId=n[0],this.modelEvent.publish({event:"move-Units-singleselect",data:s})),n.length>1&&this.modelEvent.publish({event:"move-Units-multiSelect",data:{data:s,Units:n}})}},singleSelectMoveOrUpdate:function(){if(this.mvAutocomplete.selectedItems&&0!=this.mvAutocomplete.selectedItems.length){if(this.mvAutocomplete.selectedItems[0].value==this.items.modelVersion.identifier){let e,t;0!=this.pcAutocomplete.selectedItems.length&&(e=this.pcAutocomplete.selectedItems[0].value),0!=this.mpAutocomplete.selectedItems.length&&(t=this.mpAutocomplete.selectedItems[0].value);let i={unitId:this.items.id,mvId:this.mvAutocomplete.selectedItems[0].value,pcId:e||"",mfgId:t||""};this.modelEvent.publish({event:"update-allocation-singleselect",data:i})}if(this.mvAutocomplete.selectedItems[0].value!=this.items.modelVersion.identifier){let e,t;0!=this.pcAutocomplete.selectedItems.length&&(e=this.pcAutocomplete.selectedItems[0].value),0!=this.mpAutocomplete.selectedItems.length&&(t=this.mpAutocomplete.selectedItems[0].value);let i={unitId:this.items.id,mvId:this.mvAutocomplete.selectedItems[0].value,pcId:e||"",mfgId:t||""};this.modelEvent.publish({event:"move-Units-singleselect",data:i})}}},disableFirstEditMode:function(){var t=this,n=[e.createElement("span",{class:"input-value",text:this.items.plannedDate?r.formatDateAttribute(this.items.plannedDate):""}),e.createElement("span",{class:"input-value",text:this.items.dateShipped?r.formatDateAttribute(this.items.dateShipped):""}),e.createElement("span",{class:"input-value",text:this.items.modelVersion&&this.items.modelVersion.title&&this.items.modelVersion.revision?this.items.modelVersion.title+"   "+this.items.modelVersion.revision:""}),e.createElement("span",{class:"input-value",text:this.items.productConfiguration&&this.items.productConfiguration.title?this.items.productConfiguration.title:""}),e.createElement("span",{class:"input-value",text:this.items.manufacturingPlan&&this.items.manufacturingPlan.title&&this.items.manufacturingPlan.revision?this.items.manufacturingPlan.title+"  "+this.items.manufacturingPlan.revision:""})];for(i=0;i<2;i++)this.view.formContent.elements.container[i].getParent().appendChild(n[i]),this.view.formContent.autocompletes[i].elements.container.addClassName("flex-item");for(this.mpAutocomplete.elements.container.addClassName("flex-item"),i=2;i<5;i++)this.view.formContent.elements.container[i].getParent().getParent().getParent().appendChild(n[i]),this.view.formContent.getContent().getChildren()[i].getChildren()[0].addClassName("flex-item");this.addIcons(),this.autocompleteManager.configureAutocomplete({target:t.mvAutocomplete,searchOption:function(e){let t='(flattenedtaxonomies:("types/Products"))';return e&&(t+=`AND ([ds6w:label]:("${e}*"))`),{query:t,label:p.Select_Model_Version}}}),t.autocompleteManager.configureAutocomplete({target:t.pcAutocomplete,searchOption:function(e){let i=`(flattenedtaxonomies:("types/Product Configuration")) AND (based_95_on_95_model_95_version_95_pid:("${t.mvAutocomplete.selectedItems[0].value}"))`;return e&&(i+=`AND ([ds6w:label]:("${e}*"))`),{query:i,label:p.Select_Product_Configuration}}}),t.autocompleteManager.configureAutocomplete({target:t.mpAutocomplete,searchOption:function(e){let i=`(flattenedtaxonomies:("types/Manufacturing Plan")) AND (mp_95_based_95_on_95_model_95_version_95_pid:("${t.mvAutocomplete.selectedItems[0].value}"))`;return e&&(i+=`AND ([ds6w:label]:("${e}*"))`),{query:i,label:p.Select_Manufacturing_Plan}}}),this.addAutocompleteEvents(),this.view.getContent().addClassName("non-editable-vertical"),this.view.getContent().removeClassName("editable-form-vertical").removeClassName("editable-form-horizontal").removeClassName("non-editable-horizontal"),this.view.getContent().querySelector(".form-footer").hide()},addscroller:function(){document.querySelector(".unit-plan-form")},disableEditMode:function(e){"vertical"==this.layout?(this.view.getContent().removeClassName("editable-form-vertical").removeClassName("editable-form-horizontal").removeClassName("non-editable-horizontal"),this.view.getContent().addClassName("non-editable-vertical")):(this.view.getContent().removeClassName("editable-form-vertical").removeClassName("editable-form-horizontal").removeClassName("non-editable-vertical"),this.view.getContent().addClassName("non-editable-horizontal")),this.view.getContent().querySelector(".form-footer").hide(),this.onResize()},enableEditMode:function(){"vertical"==this.layout?(this.view.getContent().removeClassName("editable-form-horizontal").removeClassName("non-editable-vertical").removeClassName("non-editable-horizontal"),this.view.getContent().addClassName("editable-form-vertical")):(this.view.getContent().removeClassName("editable-form-vertical").removeClassName("non-editable-horizontal").removeClassName("non-editable-vertical"),this.view.getContent().addClassName("editable-form-horizontal")),this.multiselection||(this.singleSelectShowDefaultValues("modelVersion","mvAutocomplete"),this.singleSelectShowDefaultValues("productConfiguration","pcAutocomplete"),this.singleSelectShowDefaultValues("manufacturingPlan","mpAutocomplete")),this.view.getContent().querySelector(".form-footer").show()},singleSelectShowDefaultValues:function(e,t){let i=[],n=this.items[e]?this.items[e].title:"",a=this.items[e]&&this.items[e].revision?this.items[e].revision:"",o=this.items[e]?this.items[e].identifier:"",s={value:o,id:o,label:n+(a?" "+a:""),sourceId:"3dspace",revision:a,selected:!0};""!=n&&(i.push(s),this[t].cleanDataset(0),this[t].addItems(i,this[t].getDataset(0)),this[t].elements.input.oninput())},onAction:function(e){this.editState?this.editState=!1:this.editState=!0;this.editState?this.enableEditMode():this.disableEditMode()},destroyComponent:function(){this.elements.container.destroy()},onResize:function(e){this.elements.container.clientWidth>=381&&(this.layout="horizontal",this.editState?(this.view.getContent().addClassName("editable-form-horizontal"),this.view.getContent().removeClassName("editable-form-vertical").removeClassName("non-editable-horizontal").removeClassName("non-editable-vertical")):(this.view.getContent().addClassName("non-editable-horizontal"),this.view.getContent().removeClassName("editable-form-vertical").removeClassName("editable-form-horizontal").removeClassName("non-editable-vertical"))),this.elements.container.clientWidth<381&&(this.layout="vertical",this.editState?(this.view.getContent().addClassName("editable-form-vertical"),this.view.getContent().removeClassName("editable-form-horizontal").removeClassName("non-editable-vertical").removeClassName("non-editable-horizontal")):(this.view.getContent().addClassName("non-editable-vertical"),this.view.getContent().removeClassName("editable-form-vertical").removeClassName("editable-form-horizontal").removeClassName("non-editable-horizontal")))}})}),define("DS/ENOXModelApp/InformationPanels/InformationPanelManager",["UWA/Core","DS/ENOXModelApp/InformationPanels/CommonInfoPresenter","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","UWA/Class","DS/ENOXModelApp/Utils/xModelCommonUtils","text!DS/ENOXModelApp/assets/FacetsConfig.json","i18n!DS/ENOXModelApp/assets/nls/InformationPanels/InformationPanelManager"],function(e,t,i,n,a,o,s,r,l,d){"use strict";var c=s.singleton({init:function(){this._init()},_init:function(){this.editMode=!1,this._currInfoId="",this._currReadOnlyStatus={},this._currentSelectedId="",this._selectedObjectIds=[],this.selection={},this.readOnly={},this.facets={},this._readOnly=!1,this._attachmentTab={Requirements:!1,Documents:!1,File:!1,"home.ModelDefinition.ModelInfo.DOCDetails":!1,Specifications:!1,"home.MyUnits":!1},this._attachmentTabNoSelection={"home.ModelDefinition.ModelInfo.DOCDetails":!1,Variability:!0},this._attachmentFacetAdded=!1,this.applicationChannelTokens=[],this._pathPref=[i._KEY,i._VIEWS_PREFERENCES];var e=this;this._informationPanelPresenterForEdit||(this._informationPanelPresenterForEdit=new t({panelOptions:{editMode:!1,readOnly:!1,events:{onPrimaryChange:function(t){e._applicationChannel.publish({event:"xmodel-list-data-item-need-refresh",data:t.id})}}}})),this._infoPresenter||(this._infoPresenter=new t({panelOptions:{editMode:this.editMode,readOnly:!0}})),this.moreFacetsDef=JSON.parse(l).Facets},reInitialize:function(){this._informationPanelPresenterForEdit=null,this._infoPresenter=null,this._init()},initialize:function(t){this._applicationChannel!==t.applicationChannel&&(e.log("InfoManager: Different app channel!!"),this.unSubscribeEvents(),this._applicationChannel=null),this._applicationChannel||(this._applicationChannel=t.applicationChannel?t.applicationChannel:void 0,this.subscribeToEvents()),e.is(t.id)&&(this._currInfoId=t.id),e.is(t.label)&&(this._currInfoLabel=t.label),this.editMode=t.editMode||!1,this._selectedObjectIds=t.selectedIds||[],this.context=t.context||"default",this.selection[this.context]=t.selectedIds||[],t.currentEditableState&&(this._currReadOnlyStatus[this.context]=t.currentEditableState),void 0!==t.readOnly&&(this.readOnly[this.context]=t.readOnly),t.silent&&!0!==t.silent&&(n.updateInfoPanelContext(this._pathPref,this.context),this.updateInfoPanel(t.readOnly))},showPropertyPanel:function(e,t){t=t||this.context;var i=this.selection[t]||[],n=this.readOnly[t]||e,a=this.facets[t]||{},o=void 0===this._attachmentTab[t]||this._attachmentTab[t];if(i.length>0){var s=i;n?(this._infoPresenter.render(),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:this._infoPresenter.getContent()}}),this._infoPresenter.updateFacets(a),this._infoPresenter.setModels(s.map(function(e){return{id:e}}))):(this._informationPanelPresenterForEdit.render(),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:this._informationPanelPresenterForEdit.getContent()}}),this._informationPanelPresenterForEdit.updateFacets(a),this._informationPanelPresenterForEdit.setModels(s.map(function(e){return{id:e}}))),this.removeAttachmentFacet(t),o&&1===i.length&&this.addAttachmentFacet(i[0],t,n),this.addMoreFacets(i,n,t)}else if(this._currInfoId){a=this.facets.IDCard||{},(n=this._currReadOnlyStatus[this.context])?(this._infoPresenter.render(),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:this._infoPresenter.getContent()}}),this._infoPresenter.updateFacets(a),this._infoPresenter.setModels([{id:this._currInfoId,label:this._currInfoLabel}])):(this._informationPanelPresenterForEdit.updateFacets(a),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:this._informationPanelPresenterForEdit.getContent()}}),this._informationPanelPresenterForEdit.render(),this._informationPanelPresenterForEdit.setModels([{id:this._currInfoId,label:this._currInfoLabel}])),this.removeAttachmentFacet(t);var r=void 0===this._attachmentTabNoSelection[t]||this._attachmentTabNoSelection[t];this._currInfoId&&(r&&this.addAttachmentFacet(this._currInfoId,t,n),this.addMoreFacets([this._currInfoId],n))}else this.showNoInformationPanel(),n&&this._infoPresenter?this._infoPresenter.unLoadContent():this._informationPanelPresenterForEdit&&this._informationPanelPresenterForEdit.unLoadContent()},subscribeToEvents:function(){var e=this;this.applicationChannelTokens.push(this._applicationChannel.subscribe({event:"information-panel-open"},function(t){if(!t||!0!==t.silent){var i=n.getInfoPanelContext(e._pathPref);e.showPropertyPanel(void 0,i)}t&&t.facetName&&e.selectFacet(t.facetName,t.readOnly)})),this.applicationChannelTokens.push(this._applicationChannel.subscribe({event:"breadcrumb-reset"},function(){e.resetPropertyPanel()}))},unSubscribeEvents:function(){var e=this;this._applicationChannel&&(this.applicationChannelTokens.forEach(function(t){e._applicationChannel.unsubscribe(t)}),this.applicationChannelTokens=[])},refresh:function(e){(e&&this.readOnly[e]||!1)&&this._infoPresenter?this._infoPresenter.reload():this._informationPanelPresenterForEdit&&this._informationPanelPresenterForEdit.reload()},resetPropertyPanel:function(){this._currInfoId="",this._currReadOnlyStatus={},this._currentSelectedId="",this._selectedObjectIds=[],this.selection[this.context]&&(this.selection[this.context]=[]),this.showNoInformationPanel()},addAttachmentFacet:function(e,t,i){if(e&&t){var n={require:"DS/ENOXModelApp/InformationPanels/AttachmentsTab/js/AttachmentTabPresenter",facet:{name:"Attachments",icon:"attach",text:d.attachmentFacet},options:{id:e},alwaysVisible:!0};this.addFacet({name:"Attachments",facet:n},t,!0,i)}},removeAttachmentFacet:function(e){this.removeFacet("Attachments",e)},addMoreFacets:function(t,i,n="ModelInfo"){for(let a of Object.values(this.moreFacetsDef)){this.removeFacet(a.name,n);let o=a.context;if(Array.isArray(t)&&1===t.length&&Array.isArray(o)&&o.includes(n)){let o={id:t[0]};a.options&&e.merge(o,a.options);let s={require:a.module,facet:{name:a.name,icon:a.icon,text:d[a.nlskey]||a.name},options:o,alwaysVisible:!a.alwaysVisible||a.alwaysVisible};this.addFacet({name:a.name,facet:s},n,!0,i)}}},setCurrReadOnlyStatus:function(e,t){var i=this;e.forEach(function(e){i._currReadOnlyStatus[e]=t}),i.updateInfoPanel(this.readOnly[this.context])},showNoInformationPanel:function(){this.noInfoPanel||(this.noInfoPanel=e.createElement("div",{styles:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"}})),this.noInfoPanel.setContent(""),o.mask(this.noInfoPanel),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:this.noInfoPanel}});var t=this;setTimeout(function(){o.unmask(t.noInfoPanel),t.noInfoPanel.setContent(d.NoInfoAvailable)},500)},showInformation:function(t,i,n){var a=this;e.is(t)&&(this.selection[this.context]=[t]),this._applicationChannel.publish({event:"information-panel-open",data:{silent:!0}}),this._applicationChannel.publish({event:"triptych-fetch-panel-visibility-status",data:function(e){e&&!0===e.right&&(i?(a.showPropertyPanel(!0),a.selectFacet(n,i)):(a.showPropertyPanel(!1),a.selectFacet(n,i)))}})},addSelection:function(t,i,n){if(!t)return void e.log("Item id should be present!");if(!e.is(i))throw Error("context manatory");let a=[];Array.isArray(t)?a=t:a.push(t),this.context=i;var o=this.selection[i]||[];1===o.length&&1==a.length&&a[0]===o[0]||(a.forEach(e=>{var t=o.indexOf(e);-1!==t&&o.splice(t,1),o.push(e)}),this.selection[i]=o,void 0!==n&&(this.readOnly[i]=n),this.updateInfoPanel(this.readOnly[this.context]))},addAllSelection:function(t,i,n){if(!Array.isArray(t)&&t.length<1)return void e.log("Muliselect items !");if(!e.is(i))throw Error("context manatory");this.selection[i]=t;this.selection[i];void 0!==n&&(this.readOnly[i]=n),this.updateInfoPanel(this.readOnly[this.context])},removeSelection:function(e,t,i){var n=this.selection[t]||[];let a=[];Array.isArray(e)?a=e:a.push(e);let o=this;a.forEach(e=>{var a=n.indexOf(e);-1!==a&&(n.splice(a,1),o.selection[t]=n,void 0!==i&&(o.readOnly[t]=i))}),this.updateInfoPanel(this.readOnly[this.context])},removeAllSelection:function(e){e&&(this.selection[e]=[]),this.updateInfoPanel()},setContext:function(t,i){this.selection[t]||(this.selection[t]=[]),t&&n.updateInfoPanelContext(this._pathPref,t),i&&(i.id&&(this._currInfoId=i.id),i.selectedIds&&e.is(i.selectedIds,"array")&&(this.selection[t]=i.selectedIds)),this.context=t,this.updateInfoPanel(this.readOnly[this.context])},updateInfoPanel:function(e){var t=this;this._applicationChannel.publish({event:"triptych-fetch-panel-visibility-status",data:function(i){i&&!0===i.right&&(e=e||!1,t.context&&(e=!0===t.readOnly[t.context]),t.showPropertyPanel(e))}})},addFacet:function(e,t,i,n){var a=!1;t&&(a=!0===this.readOnly[t],this.facets[t]||(this.facets[t]={}),this.facets[t][e.name]=e.facet),i&&(n?this._infoPresenter&&this._infoPresenter.editPropertyPanel&&this._infoPresenter.addFacet(e):this._informationPanelPresenterForEdit&&this._informationPanelPresenterForEdit.addFacet(e)),t===this.context&&(a?this._infoPresenter&&this._infoPresenter.addFacet(e):this._informationPanelPresenterForEdit&&this._informationPanelPresenterForEdit.addFacet(e))},removeFacet:function(e,t){var i=!1;t&&(i=!0===this.readOnly[t],this.facets[t]&&this.facets[t][e]&&delete this.facets[t][e]),t===this.context&&(i?this._infoPresenter&&this._infoPresenter.removeFacet(e):!1===i&&this._informationPanelPresenterForEdit&&this._informationPanelPresenterForEdit.removeFacet(e))},selectFacet:function(e,t){t?this._infoPresenter&&this._infoPresenter.selectFacet(e):!1===t&&this._informationPanelPresenterForEdit&&this._informationPanelPresenterForEdit.selectFacet(e)}});return c.init(),c}),define("DS/ENOXModelApp/Utils/CustomAttributesManager",["UWA/Core","UWA/Class","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/CoreEvents/ModelEvents","DS/Utilities/StringUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xCollabServices","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n,a,o,s,r,l,d,c,p){"use strict";var u={},h=[],m=[],_=[],v=t.singleton({init:function(){this._inputTypes={classes:["Configuration Rule","Product Configuration","Variant Parameter","Variant","Variant Value","Variability Group","Variability Option"]},this.type_extension_map=[],this.type_attributes_map=[],this.ca_index_type={},this._modelEvents=new n,this.fetchOptionPromise,this.fetchVariantPromise},initialize:function(){var e=this._loadCustomerAttributePromise();return this.fetchPredicateVariant(),this.fetchPredicateOptionGroup(),this.fetchPredicateVariantParameter(),e},_getExtensions:function(t){var n=this;return new e.Promise(function(e,a){i.getExtensionsForTypes(t).then(function(i){if(i&&i.results)return i.results.forEach(function(e){n.type_extension_map[e.name]=[],e&&e.interfaces&&e.interfaces.length>0&&e.interfaces.forEach(function(t){n.type_extension_map[e.name].push(t.name)})}),n._getCustomAttributesFromExtension(t,n.type_extension_map).then(function(t){e(t)},function(){a(i)})},function(e){console.log("Err")})})},_getCustomAttributesFromExtension:function(t,n){var a=this;return new e.Promise(function(o,s){var r=[];t.classes.forEach(function(t){n[t].forEach(function(n){a.type_attributes_map[t]=[],r.push(i.getCustomAttributesFromExtension(n).then(function(i){if(i&&i.Attributes){var n=i.Name?i.Name:"",o=i.NLSName?i.NLSName:"";widget&&"OnPremise"!==widget.getValue("x3dPlatformId")&&(o=o.split("__")[0]),i.Attributes.forEach(function(i){if(i&&i.Name&&i.NLS){a.type_attributes_map[t].push(e.merge(i,{extName:n}));var o=n+":"+i.Name;a.ca_index_type[o]=i.Type}})}},function(e){console.log("Err")}))})}),e.Promise.all(r).then(function(){o(a.type_attributes_map)},function(){s()})})},_loadCustomerAttributePromise:function(t){var i=this;return new e.Promise(function(e,t){i._getExtensions(i._inputTypes).then(function(t){i.type_attribute_map_t=t,i._modelEvents.publish({event:"custom-attributes-promise-done",data:i.type_attribute_map_t}),e(t)},function(e){t(e)})})},getCustomAttribute:function(t){var i=this,n=function(n){var a=[];t.forEach(t=>{e.is(i.type_attribute_map_t[t],"array")&&i.type_attribute_map_t[t].forEach(t=>{let i=a.find(e=>e.Name===t.Name);e.is(i)?a.Type!==i.Type&&(i._not_matching_attr=!0):a.push(t)})}),n(a)};return new e.Promise(function(e,a){i.type_attribute_map_t?Array.isArray(t)?n(e):e(i.type_attribute_map_t[t]):i._modelEvents.subscribeOnce({event:"custom-attributes-promise-done"},function(){Array.isArray(t)?n(e):e(i.type_attribute_map_t[t])})})},getColumnsToAdd:function(t,i,n){var a=this;i||(i=[]);var o=[];return t.forEach(function(t){var u=t.Name;"OnPremise"!==widget.getValue("x3dPlatformId")&&u.split("__").length&&(u=u.split("__")[0]);var h=!1;i.length>0&&i.includes(u)&&(h=!0),"Date"===t.Type&&t.Type;var m={text:t.NLS,dataIndex:u,typeRepresentation:"Date"===t.Type?"datetime":t.Type.toLowerCase(),editableFlag:!(e.is(n,"object")&&!1===n.inlineEdition)&&"ReadWrite"===t.UIAccess,editionPolicy:"EditionOnOver",visibleFlag:h,semantics:{possibleValues:e.is(t.AuthorizedValues,"array")?t.AuthorizedValues.map(e=>e.NLS):null,allowResetToUndefinedByUIFlag:"No"===t.HasDefault,allowMultipleValuesFlag:"Yes"===t.MultiValuated},getCellEditableState:function(i){if(i&&i.nodeModel&&i.nodeModel.options){var n=i.nodeModel.options.grid,o=null,l=a.type_attribute_map_t[n.type];return e.is(l,"array")&&(o=l.find(e=>e.Name===t.Name)),!!e.is(o,"object")&&s.checkActionAccess({action:r.MODIFY,type:n.type,state:n.state,notify:!1})}return!1},getCellValue:function(i){if(i&&i.nodeModel&&i.nodeModel.options&&e.is(i.nodeModel.options.grid,"object")&&e.is(i.nodeModel.options.grid[t.Name]))return i.nodeModel.options.grid[t.Name];if(i&&i.nodeModel&&i.nodeModel.options&&e.is(i.nodeModel.options.grid,"object")&&e.is(i.nodeModel.options.grid.customerAttributes,"object")){var n=i.nodeModel.options.grid.customerAttributes;for(const e in n)if(Object.hasOwn(n,e)){var a=n[e];for(const e in a)if(Object.hasOwn(a,e))return i.nodeModel.options.grid[t.Name]=a[e],i.nodeModel.options.grid[t.Name]}}},setCellValue:function(i,o){if(i&&i.nodeModel&&i.nodeModel.options&&i.nodeModel.options.grid){var s=i.nodeModel.options.grid;s[t.Name]=o;var r=a.type_attribute_map_t[s.type].find(e=>e.Name===t.Name);e.is(t.AuthorizedValues,"array")&&e.is(o,"string")?o=t.AuthorizedValues.find(e=>e.NLS===o).Name:e.is(t.AuthorizedValues,"array")&&e.is(o,"array")&&(o=o.map(e=>t.AuthorizedValues.find(t=>t.NLS===e).Name)),l.updateAttribute(s.id,r.extName,t.Name,o).then(()=>{c.showSuccess(p.custom_attributed_saved_success),e.is(n)&&e.is(n.infoContext)&&d.refresh(n.infoContext)}).catch(()=>{c.showError(p.custom_attributed_saved_error)})}}};o.push(m)}),o},getTypeBasedOnDataIndex:function(e){var t="String";return this.ca_index_type.hasOwnProperty(e)&&(t=this.ca_index_type[e]),t},getPredicatesVariant:async function(){await this.fetchVariantPromise;return new e.Promise(function(e,t){if(h.length>0&&"{}"!=JSON.stringify(u)){var i=[];i.push(h),i.push(u),e(i)}else e()})},getPredicatesOptionGroup:async function(){await this.fetchOptionPromise;return new e.Promise(function(e,t){if(m.length>0&&"{}"!=JSON.stringify(u)){var i=[];i.push(m),i.push(u),e(i)}else e()})},getPredicatesVariantParameter:async function(){await this.fetchParameterPromise;return new e.Promise(function(e,t){if(_.length>0&&"{}"!=JSON.stringify(u)){var i=[];i.push(_),i.push(u),e(i)}else e()})},fetchPredicateVariant:function(){var e=[],t=this;t.fetchVariantPromise=i.getExtensionsForTypes({classes:["Variant","Variant Value"]}).then(function(i){i&&i.results&&i.results.forEach(function(t){t&&t.interfaces&&t.interfaces.length>0&&t.interfaces.forEach(function(t){e.push(t.name)})});return t.getPredicatesforExtension(e).then(function(e){var t=e;t&&t.classPredicates.length>=1&&t.classPredicates.forEach(function(e){(e.vocabularyPredicateInfo?e.vocabularyPredicateInfo:[]).forEach(function(e){e&&(h.includes(e.uri)||(h.push(e.uri),u[e.uri]=e.name))})}),console.log("responded")})})},fetchPredicateOptionGroup:function(){var e=this,t=[];e.fetchOptionPromise=i.getExtensionsForTypes({classes:["Variability Group","Variability Option"]}).then(function(i){i&&i.results&&i.results.forEach(function(e){e&&e.interfaces&&e.interfaces.length>0&&e.interfaces.forEach(function(e){t.push(e.name)})});return e.getPredicatesforExtension(t).then(function(e){var t=e;t&&t.classPredicates.length>=1&&t.classPredicates.forEach(function(e){(e.vocabularyPredicateInfo?e.vocabularyPredicateInfo:[]).forEach(function(e){e&&(m.includes(e.uri)||(m.push(e.uri),u[e.uri]=e.name))})}),console.log("responded")})})},fetchPredicateVariantParameter:function(){var e=this,t=[];e.fetchParameterPromise=i.getExtensionsForTypes({classes:["Variant Parameter"]}).then(function(i){i&&i.results&&i.results.forEach(function(e){e&&e.interfaces&&e.interfaces.length>0&&e.interfaces.forEach(function(e){t.push(e.name)})});return e.getPredicatesforExtension(t).then(function(e){var t=e;t&&t.classPredicates.length>=1&&t.classPredicates.forEach(function(e){(e.vocabularyPredicateInfo?e.vocabularyPredicateInfo:[]).forEach(function(e){e&&(_.includes(e.uri)||(_.push(e.uri),u[e.uri]=e.name))})}),console.log("responded")})})},getPredicatesforExtension:function(t){var i=this;return new e.Promise(function(n,a){try{console.log("type to extension mapping:"+i.type_extension_map);var s={},r=window.widget&&window.widget.lang?window.widget.lang:"en";s.onComplete=function(e){console.log("OnComplte Response: "+e),n(e)},s.onFailure=function(e){console.log("OnFailure Response: "+e),a(e)},s.onTimeout=function(e){console.log("onTimeout Response: "+e),a(e)},s.apiVersion="R2018x",s.lang=r,s.tenantId=window.widget.getValue("x3dPlatformId"),t&&o.getPropertiesForClass(t,s)}catch(t){e.log("Exception occured while predicates  request"+t.message),a(t.message?t.message:"Exception Occured during expand!!")}})}});return v.init(),v}),define("DS/ENOXModelApp/components/ContextSelector/AutocompleteContextSelector",["DS/ENOXModelApp/ModelDefinition/js/ContextDropDown","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/Views/DetailsDisplayView","UWA/Class/Model","UWA/Core","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager"],function(e,t,i,n,a,o){"use strict";let s=function(e){this._updateChannel=e.modelEvents,this.loadOnRefresh=!!e.loadOnRefresh,this._path=e.path,this.loadAutocompleteContex=!0,this.type=e.type,this.directAncestor=e.directAncestor?e.directAncestor:"",this.ctxClassName=e.className?e.className:"ctxAutocomplete",this.autocompleteManager=e.autocompleteManager,this.subscribeToEvents()};return s.prototype.subscribeToEvents=function(){let e=this;e._updateChannel.subscribe({event:"enox-collection-toolbar-node-updated"},function(){e._checkCtxSelInjected()||e._injectCtxSelector()}),e._updateChannel.subscribe({event:"enox-collection-toolbar-injected"},function(){e._checkCtxSelInjected()||e._injectCtxSelector()}),e._updateChannel.subscribe({event:"enox-model-app-inject-context-selector"},function(t){let i=!0;t?i=e._checkCtxSelInjected():e.modelContext.remove("context",0,{}),i||e._injectCtxSelector()})},s.prototype._checkCtxSelInjected=function(){let e=document.querySelector(`.${this.ctxClassName}`);if(!e)return!1;if(document.querySelector(".ds-dialog.ds-detail-display.ddv-view"))return!0;let t=e.closest(".wux-button-icon-placeholder");return t?(t.classList.remove("wux-button-icon-placeholder"),t.removeChild(t.firstChild),t.classList.add("wux-tweakers"),t.classList.add("wux-tweakers-string"),t.classList.add(this.ctxClassName)):e.removeChild(e.firstChild),!1},s.prototype._injectCtxSelector=function(){var e=document.querySelector(`.${this.ctxClassName}`);null==e&&null==e||(this.detailDisplay.render().inject(e),this._updateChannel.publish({event:"enox-model-app-ctx-selector-injected-success"}))},s.prototype.getModelContext=function(e){var t=this,i=`(flattenedtaxonomies:("types/${this.type}"))`;return e&&e.query&&(i=e.query),t.modelContext=new n({canEdit:!0,context:[]}),t.modelContext.add=function(e,i,s){let r={};r.detailedObject=s.detailedObjects?s.detailedObjects[0]:s.dropObj,s.dropObj&&(r.detailedObject["ds6w:label"]=r.detailedObject.displayName,r.detailedObject["ds6w:type"]=r.detailedObject.objectType);let l=r.detailedObject["ds6w:label"]?r.detailedObject["ds6w:label"]:r.detailedObject.label,d=r.detailedObject["ds6wg:revision"]?r.detailedObject["ds6wg:revision"]:r.detailedObject.revision?r.detailedObject.revision:"";var c=new n({id:r.detailedObject.id?r.detailedObject.id:r.detailedObject.objectId,physicalId:r.detailedObject.id?r.detailedObject.id:r.detailedObject.objectId,type:r.detailedObject["ds6w:type"],name:l,image:r.detailedObject.preview_url?r.detailedObject.preview_url:r.detailedObject.image,serviceId:"3DSpace",tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise","ds6w:identifier":r.detailedObject["ds6w:identifier"],"ds6w:status_value":r.detailedObject["ds6w:status_value"],"ds6w:label":r.detailedObject["ds6w:label"],"ds6wg:revision":d});c.dataForRendering=function(){return this.toJSON()};var p=new a.Class.Collection(c);this.set(e,p),i&&(o.updateContext(t._path,c._attributes),t.loadOnRefresh&&t.loadData(!0))},t.modelContext.remove=function(e,i,n){let s=a.clone(n||{},!1);var r=new a.Class.Collection;this.set(e,r,s),o.updateContext(t._path,""),t.loadData(!0)},t.modelContext.dataForRendering=function(){let e=this.toJSON();return this.convertToJSON(e)},t.modelContext.convertToJSON=function(e){let t=Object.keys(e),i=t.length;for(let n=0;n<i;n++){let i=t[n],o=e[i];if(o instanceof a.Class.Collection){let t=[],n=o.length;if(n)for(let e=0;e<n;e++)t.push(o.at(e).dataForRendering());e[i]=t}}return e.name=e.path||e.name||e.title,e.physicalId=e.id,e.canEdit=this.get("canEdit"),e},t.modelContext.typeAheadCallback=function(e,n,a,o){let s={key:n,path:t._path,type:t.type};t.exclude&&(s.exclude=t.exclude),s={query:`${i} AND ([ds6w:label]:("${n}*"))`},t.autocompleteManager.fetchDataSet(s).then(function(e){a(e,o)})},t.modelContext},s.prototype.setContextSetting=function(i){return this.contextsetting=[{attributeToDisplay:"name",imageAttribute:"image",name:"context",placeHolder:i.NLS,readWrite:"true",disableRemove:"false",singleObjectOnly:!0,type:"object",searchSource:["3dspace"],customView:t,searchSourceTypes:{"3dspace":[i.type]},additionalQuery:i.additionalQuery,minLengthBeforeAutocomplete:1,resourceid_not_in:i.resourceid_not_in,typeAheadCallback:this.modelContext.typeAheadCallback,linkCallback:e.prototype.launchProperties,getDropDownMenuItems:e.prototype.getDropDownMenuItems,validateSameTenant:!0}],this.contextsetting},s.prototype.setDetailDisplay=function(e){return this.detailDisplay||(this.detailDisplay=new i({model:e.modelContext,homeView:e.view,displayMessage:e.NLS})),this.detailDisplay.setConfig(this.contextsetting),this.detailDisplay},s.prototype.loadData=function(e,t){var i=o.getContext(this._path);if(this.loadAutocompleteContex){if(this.loadAutocompleteContex=!1,i&&i.id){i.label=i.name,i["ds6w:type"]=i.type;let e={},t=[i];e.detailedObjects=t,this.modelContext.add("context",i.id,e)}this.loadOnRefresh=!0}!0===e||void 0===t?(this._updateChannel.publish({event:"xmodel-list-data-on-load-start"}),this._updateChannel.publish({event:"xmodel-list-show-progress-bar"}),this._updateChannel.publish({event:"xmodel-list-fetch-connected-objects",data:{input:t,model:i}})):this._updateChannel.publish({event:"xmodel-list-fetch-connected-objects",data:{input:t,model:i}})},s}),define("DS/ENOXModelApp/RuleDefinition/RulePresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/CfgDictionary/CfgDictionaryMapperUtils","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/CfgSolver/CfgSolverServices","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter","DS/CfgRuleMatrixComponent/Runtime/ConflictPanelPresenter","DS/CfgRuleMatrixComponent/Buildtime/CriteriaPresenter","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/RuleDefinition/RuleExpressionPresenter","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/CfgAutoCompleteComponent/Presenter/CfgAutoCompleteUtils","DS/CfgDictionary/CfgDictionaryTypeEnum","i18n!DS/ENOXModelApp/assets/nls/RuleDefinition/RulePresenter","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","css!DS/ENOXModelApp/RuleDefinition/RulePresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S){"use strict";var D=function(){},M=function(){};return M.prototype.init=function(t,n,s,r,l){this._options=l||{},this._pathRules=[u._KEY,u._VIEWS_PREFERENCES,u._RULES_DETAILS],this._expressionRulePath=this._pathRules.concat([u._EXPRESSION_RULE]),this._concatModelIdRuleId=t.modelId+"-"+t.ruleId,this._ruleId=r,this._solverKey=l.solverKey?l.solverKey:null,this._context=t,this._contextDictionary=l.contextDictionary?l.contextDictionary:null,this._variabilityDictionary=l.dictionary,this._variabilityDictionaryFormatForXmodel=this._variabilityDictionary?o.formatDicoForXmodelListView(this._variabilityDictionary):null,this._mapDico=a.dicoMinifiedV3ToMap(this._contextDictionary),this._privateChannel=n,this._applicationChannel=s,this._previewMode=l.previewMode,this._isEditable=l.editable?"":_.showWarning(e.String.format(S.LOCKED_INFO_ALERT,l.reservedbyFullName)),this._ruleName=null,this._options.solverModelEvent||(this._options.solverModelEvent=new i),this._privateChannelForExpRule=new i;var d={criteriaMainTitle:y.MODEL_VERSION_VARIABILITY};this._criteriaPanel=new p(d),this._criteriaPanel.init(d),this._myEventManager=new v(this._applicationChannel,this._privateChannel,this._privateChannelForExpRule,this._options.solverModelEvent,this._criteriaPanel.getCriteriaModel()),this._subscribeToEvents(),this._initDivs(),this._beforeLoadData()},M.prototype.clear=function(){this._container&&(this._container.innerHTML=""),this._myEventManager&&(this._myEventManager.cleanup("RulePresenter"),this._myEventManager=null),this._mGlobalPresenter&&(this._mGlobalPresenter.destroy(),this._mGlobalPresenter=null),this._RuleExpressionPresenter&&(this._RuleExpressionPresenter.destroy(),this._RuleExpressionPresenter=null)},M.prototype._beforeLoadData=function(){var i=this;t.mask(this._container),this._fetchAndLoadContextData();s.getRuleDefinition({id:this._ruleId,contextId:this._context.modelId}).then(function(e){i._rule=e.configurationRule,i._ruleName=i._rule.name,i._ruleType=i._rule.attributes.ExpressionType,i._layoutData=i._rule.attributes["Layout Data"]?i._rule.attributes["Layout Data"]:"",i._previewMode?i._isEditable=!1:i._isEditable="FALSE"!==e.configurationRule.isModifiable;var t=e.configurationRule.state;if(!i._options.previewMode){var n=g.checkActionAccess({action:b.EDITDETAILS,type:b.RULE,state:t,warning:!0});i._isEditable=i._isEditable&&n}i.loadData()},function(t){e.log(t)}),t.unmask(this._container)},M.prototype._fetchAndLoadContextData=function(){if(this._contextDictionary)return 0;this._contextDictionary={_version:"3.0",portfolioClasses:{totalItems:1,member:[{id:"a random ID for now, representing the enterprise or the future PLE",attributes:{_type:{name:"Models",value:"Models"}},portfolioComponents:{totalItems:1,member:[{id:"model1_id",pid:"model1_pid",lid:"model1_lid",attributes:{_name:"My Super Model"},variabilityGroups:{totalItems:1,member:[{id:"VG pid",lid:"VG lid",isInherited:!1,attributes:{_sequenceNumber:1,_name:"VG1 Name",_description:"a cool description for a var group"},options:{totalItems:2,member:[{kind:"reference",id:"pid O1",rel_id:"pid VG1/O1",rel_lid:"lid VG1/O1",isInherited:!1,attributes:{_name:"Option1 Name"}},{kind:"instance",id:"<pidMV1|pid VG1/O",idref:"pid O1",isInherited:!1,attributes:{_name:"Option1 Name [rewritten on Instance]"}}]}}]},variants:{totalItems:2,member:[{kind:"instance",isInherited:!1,idref:"pid V1",id:"pid MV1/V1",attributes:{_name:"V1 name [inst]",_type:"Variant",_image:"",_description:"",_mandatory:!0,_sequenceNumber:13},values:{totalItems:2,member:[{isInherited:!1,constraint:"available",id:"<pid MV1|pid V1/Vv11>",idref:"pid Vv11",attributes:{_name:"Vv11 name",_type:"value",_image:"",_description:""}},{isInherited:!1,constraint:"available",id:"<pid MV1|pid V1/Vv12>",idref:"pid Vv12",attributes:{_name:"Vv12 name",_type:"value",_image:"",_description:""}}]}},{kind:"reference",isInherited:!1,id:"pid V1",lid:"lid V1",attributes:{_name:"V1 name",_type:"Variant",_image:"",_description:""},values:{totalItems:2,member:[{isInherited:!1,constraint:"available",id:"pid Vv11",lid:"lid Vv11",rel_id:"pid V1/Vv11",rel_lid:"lid V1/Vv11",attributes:{_name:"Vv11 name",_type:"value",_image:"",_description:"",_default:!1,_sequenceNumber:3}},{isInherited:!1,constraint:"available",id:"pid Vv12",lid:"lid Vv12",rel_id:"pid V1/Vv12",rel_lid:"lid V1/Vv12",idref:"id_usb_value1_ref",attributes:{_name:"Vv12 name",_type:"value",_image:"",_description:"",_default:!1,_sequenceNumber:71}}]}}]},rules:{totalItems:1,member:[{id:"rule_id",compiledExpression:"value of the compiled expression",attributes:{_name:"A Super Cool Rule Name",_type:"Matrix Rule",_description:"Reduce product complexity by defining target product baselines for the target markets",_originator:"VPLMAdminUser"}}]}}]}}]}}},M.prototype.loadData=function(){var i=this;t.mask(this._container),"EXPRESSION"===this._ruleType.toUpperCase()||"BOOLEAN"===this._ruleType.toUpperCase()||"EXPRESSION RULE"===this._ruleType.toUpperCase()?(this._contextDictionary=null,this._fetchAndLoadContextData(),void 0===this._variabilityDictionary?this.reloadVariability(this._context.modelId,!0).then(function(){i._loadExpressionRule()}):this._loadExpressionRule()):"MATRIX"===this._ruleType.toUpperCase()||"MATRIX RULE"===this._ruleType.toUpperCase()?void 0===this._variabilityDictionaryFormatForXmodel||null===this._variabilityDictionaryFormatForXmodel?this.reloadVariability(this._context.modelId).then(function(){i._loadMatrixRule()}):this._loadMatrixRule():e.log("error loading rule "+i._ruleId),t.unmask(this._container)},M.prototype._loadExpressionRule=function(){var t=this,i=""!==this._layoutData?JSON.parse(this._layoutData):null,n={dictionaryJSON:this._variabilityDictionary,mapDico:this._mapDico,autoCompleteRuleModel:i,ruleId:this._ruleId,modelId:this._context.modelId,solverKey:this._solverKey},a={ruleName:this._ruleName,ruleTitle:this._rule.attributes.Title,editable:this._isEditable,privateChannel:this._privateChannelForExpRule,updateChannel:this._privateChannel,privateChannelForRules:this._options.privateChannelForRules,resizeSensorEnablerFun:D};r.setRuleActivation(this._ruleId,"false",this._options.solverKey).then(function(){t._RuleExpressionPresenter=new m(n,t._applicationChannel,a),t._RuleExpressionPresenter.inject(t._container),t._RuleExpressionPresenter._triggerResize(),t._RuleExpressionPresenter.attachResizeSensor(),""!==t._RuleExpressionPresenter._cfgRuleExpressionPresenter.error_msg&&t._RuleExpressionPresenter._cfgRuleExpressionPresenter._localModelEvents.publish({event:"set-notification-message",data:{className:"error",message:t._RuleExpressionPresenter._cfgRuleExpressionPresenter.error_msg}})},function(){e.log("fail to de-activate current expression rule"),t._RuleExpressionPresenter=new m(n,t._applicationChannel,a),t._RuleExpressionPresenter.inject(t._container),t._RuleExpressionPresenter._triggerResize(),t._RuleExpressionPresenter.attachResizeSensor()})},M.prototype._loadMatrixRule=function(){t.mask(this._container);var i=""!==this._layoutData?JSON.parse(this._layoutData):null;this._mGlobalPresenter=new d;var n={solverKey:this._options.solverKey,solverModelEvent:this._options.solverModelEvent,privateChannelForRules:this._options.privateChannelForRules,contextDico:this._contextDictionary,editable:this._isEditable,resizeSensorEnablerFun:D,immersiveFrame:f.getImmersiveFrame(),filter:h.getWidgetPreferenceValue(this._pathRules.concat([u._FILTERS,this._concatModelIdRuleId,u._COLUMNS])),variabilityDictionaryFormatForXmodel:this._variabilityDictionaryFormatForXmodel,reservedbyFullName:this._options.reservedbyFullName},a=this;r.setRuleActivation(this._ruleId,"false",this._options.solverKey).then(function(){a._mGlobalPresenter.init(a._context,a._variabilityDictionary,i,a._applicationChannel,a._privateChannel,n),a._mGlobalPresenter.inject(a._container),a.updateToolBar(n.filter),a._mGlobalPresenter.attachResizeSensor(),""!==a._mGlobalPresenter._msgError&&a._mGlobalPresenter._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:a._mGlobalPresenter._msgError}}),t.unmask(a._container)},function(){e.log("Error!!! Failed to de-activate current Matrix rule","error")})},M.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("xmodel-rule-details")},M.prototype.inject=function(e){e.appendChild(this._container)},M.prototype._subscribeToEvents=function(){var i=this;this._myEventManager.subscribe(this._privateChannel,{event:"widget-preference-update-filter"},function(t){e.log("event : widget-preference-update RulePresenter"),h.updateFilterRule(i._pathRules,i._concatModelIdRuleId,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"notification-conflict-matrix"},function(){_.removeNotificationFromCategory("test"),_.showMessage({message:y.CONFLICT_HIDDEN,category:"test",sticky:!0})}),this._myEventManager.subscribe(this._privateChannel,{event:"widget-preference-filter-upgrade-notification"},function(){_.showInfo(y.UPGRADE_FILTER)}),this._myEventManager.subscribe(this._options.solverModelEvent,{event:"solver-call-error"},function(e){i._notificationErrorSolverManagement(e)}),this._myEventManager.subscribe(this._privateChannel,{event:"mr-onsave"},function(n){if(t.mask(i._container),e.log("saving MR from RulePresenter"),n.jsonModel){var a={type:"table",definition:n.jsonModel,title:i._rule.attributes.Title,description:i._rule.description},r=o.buildRuleDefinitionInPublicAPIsFormat(a,i._mapDico);r.id=i._ruleId,r.modelId=i._context.modelId,s.updateRuleConfiguration(r).then(function(){t.unmask(i._container),e.log("Rule saved.."),_.showSuccess(y.UPDATE_RULE_SUCCESSFUL),i._privateChannel.publish({event:"update-json-model-on-mr-save",data:n})},function(){t.unmask(i._container),e.log("Rule save failed.."),_.showError(y.UPDATE_RULE_FAILED)})}i._privateChannel.publish({event:"mr-onsavedone",data:{id:i._ruleId}})}),this._myEventManager.subscribe(this._privateChannelForExpRule,{event:"onDone"},function(){i._privateChannel.publish({event:"expr-rule-onsavedone",data:{id:i._ruleId}})}),this._myEventManager.subscribe(this._privateChannel,{event:"triptych-hide-panel-if-opened-from-rule"},function(){var e=i._ruleType?i._ruleType.toUpperCase():"";"EXPRESSION"!==e&&"BOOLEAN"!==e&&"EXPRESSION RULE"!==e||i._privateChannelForExpRule.publish({event:"triptych-hide-panel-if-opened-from-rule",data:{}})}),this._myEventManager.subscribe(this._privateChannel,{event:"get-rule-details"},function(t){var n=t;n.conflictingRules.fromRules=!0,n.BC_ENFORCEMENT_ENABLED=l.BC_ENFORCEMENT_ENABLED,s.getRuleDetailsFromIds(n.conflictingRules,function(t){e.log("getRuleDetails: Service Call Successful !!!"),i._isDestroyed&&e.log("rule details destroyed before being loaded");var a=[];t.member&&(a=t.member),n.reasons.causingRulesList=a;for(let e=0;e<n.reasons.causingRulesList.length;e++)"Model Type"==n.reasons.causingRulesList[e].type&&(n.reasons.causingRulesList[e].title=n.reasons.causingRulesList[e].BCTitle,n.reasons.causingRulesList[e].ruleType="Base Configuration");i._showConflictingRulePanel(n)},function(){e.log("getRuleDetails: Service Call Failed !!!"),_.showError(y.GET_RULE_DETAILS_ERROR)})}),this._myEventManager.subscribe(this._privateChannel,{event:"get-rule-details-for-tooltip"},function(t){var n=t;s.getRuleDetailsFromIds(n.conflictingRules,function(t){var a;e.log("getRuleDetails: Service Call Successful !!!"),i._isDestroyed&&e.log("rule details destroyed before being loaded"),a=t.member?t.member:"";var o={reasons:n.reasons,clientData:n.clientData,member:a};i._mGlobalPresenter.updateMRTooltip(o)},function(){e.log("getRuleDetails: Service Call Failed !!!"),_.showError(y.GET_RULE_DETAILS_ERROR)})}),this._myEventManager.subscribe(this._privateChannel,{event:"show-loading-right-panel"},function(e){i._showLoadingRightPanel(e)}),this._myEventManager.subscribe(this._privateChannel,{event:"display-criteria-panel"},function(e){i._initializeCriteriaPanel(e)}),this._myEventManager.subscribe(this._privateChannel,{event:"refresh-criteria-panel"},function(e){i._initializeDataCriteriaPanel(e)}),this._myEventManager.subscribe(this._privateChannel,{event:"add-update-to-criteria-panel"},function(e){i._addUpdateDataToCriteriaPanel(e)}),this._myEventManager.subscribe(this._criteriaPanel.getCriteriaModel(),{event:"xmodel-list-view-group-by-action"},function(e){h.updateGroup(i._expressionRulePath,e)})},M.prototype._showConflictingRulePanel=function(e){this._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),this._privateChannel.publish({event:"model-conflict-panel-opened",data:"right"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:c.render(e)}})},M.prototype._initializeCriteriaPanel=function(t){var i=this,n={toolbarOptions:{withStableActions:!0,useGeneratedToolbar:!0,touchMode:!1,actions:[{id:"attach-multiple-criteria",text:y.ADD_CRITERIA,fonticon:"list-row-insert",showOnSelection:!0,handler:function(e,t){for(var n=[],a=0;a<t.length;a++){var o=i._formatTreeNodeForModelListView(t[a]);n.push(o)}i._addListCriteriaTo(n,i._previousState)}}]},contextualActions:[{id:"attach-criteria",fonticon:"list-row-insert",title:y.ADD_CRITERIA,text:y.ADD_CRITERIA,handler:function(){var e=i._formatTreeNodeForModelListView(this);i._addListCriteriaTo([e],i._previousState)}}]},a={toolbarOptions:{actions:[]},layoutOptions:{rowsHeader:!1},contextualActions:function(){var t,n=[],a=i._RuleExpressionPresenter.getCfgRuleExpressionPresenter().getCfgAutocompletePresenter(),o=a.getAutocomplete(),s={id:"add-variability-expression",fonticon:"list-row-insert",title:y.ADD_CRITERIA,text:y.ADD_CRITERIA,state:"enabled",handler:function(e){i._privateChannelForExpRule.publish({event:"onPlus",data:{clickedId:e.id}})}};switch(this.options.grid.isA){case"variabilityGroup":this.options.grid.isA=C.VARIABILITY_GROUP,t=this.options.grid.id;break;case C.VARIANT:case C.VARIABILITY_GROUP:t=this.options.grid.id;break;case C.VALUE:case C.OPTION:t=this.options.grid.parentId;break;case C.PARAMETER:t=this.options.grid.isA}return t&&E.isBadgeAllowedInContext(this.options.grid,t,e.is(a._lastPosition)?a._lastPosition:o.currentPosition,o.selectedItems,()=>{s.state="disabled"},i._mapDico)||(s.state="disabled"),n.push(s),n}};this._showLoadingRightPanel();var o=this._criteriaPanel.getXModelListView();switch(t){case"driving-criteria":case"constrained-criteria":null==o&&(this._criteriaPanel.initializeListView(n),this._initializeDataCriteriaPanel(t));break;case"expression-rule":if(null==o){this._criteriaPanel.initializeListView(a,!0),this._criteriaPanel.loadData({member:i._variabilityDictionaryFormatForXmodel});var s=this._criteriaPanel.getCriteriaModel(),r=h.getGroup(this._expressionRulePath);s.publish({event:"xmodel-list-view-group-by-action",data:r})}break;default:return void e.log("Error into 'data' _initializeCriteriaPanel","error")}this._showCriteriaPanel()},M.prototype._addUpdateDataToCriteriaPanel=function(e){for(var t=0;t<e.length;t++){var i=this._formatTreeNodeForModelListView(e[t]);this._criteriaPanel._addData(i)}},M.prototype._initializeDataCriteriaPanel=function(e){var t,i,n,a;switch(this._previousState=e,e){case"driving-criteria":n=this._mGlobalPresenter.getListDrivingCriteriaAndRefresh(),a=this._mGlobalPresenter.getListConstrainedCriteriaAndRefresh(),t=o.removeTypesFromXmodelFormat(this._variabilityDictionaryFormatForXmodel,["Variant Parameter"]),i=(i=o.getAllVariabilityIdsToRemoveInXmodelListView(n.allIds,this._mapDico)).concat(a.allIds),t=o.removeListIdToListAllCriteria(i,t),this._criteriaPanel.loadData({member:t});break;case"constrained-criteria":n=this._mGlobalPresenter.getListDrivingCriteriaAndRefresh(),a=this._mGlobalPresenter.getListConstrainedCriteriaAndRefresh(),t=o.removeTypesFromXmodelFormat(this._variabilityDictionaryFormatForXmodel,["Variant Parameter"]),i=(i=o.getAllVariabilityIdsToRemoveInXmodelListView(a.allIds,this._mapDico)).concat(n.allIds),t=o.removeListIdToListAllCriteria(i,t),this._criteriaPanel.loadData({member:t});break;case"expression-rule":var s=this._criteriaPanel.getXModelListView();s&&s.refresh()}},M.prototype._addListCriteriaTo=function(e,t){for(var i=[],n=0;n<e.length;n++)i.push(e[n].item.id);this._criteriaPanel.removeData(i),this._mGlobalPresenter.addListCriteriaTo(e,t)},M.prototype._showCriteriaPanel=function(){var e=this;this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:null}}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:e._criteriaPanel.getContainer()}}),this._applicationChannel.publish({event:"triptych-fetch-panel-visibility-status",data:function(t){t&&!1===t.right&&e._applicationChannel.publish({event:"triptych-show-panel",data:"right"})}})},M.prototype._showLoadingRightPanel=function(){var i=e.createElement("div",{class:"loading-right-panel",styles:{height:"inherit",width:"inherit"}});t.mask(i),this._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:i}})},M.prototype.updateToolBar=function(t){t&&(t.invalidFilter&&t.headerFilter?(t.invalidFilter.length>0||t.headerFilter.length>0)&&this._privateChannel.publish({event:"activate-filter-icon"}):t.length>0&&(e.log("MatruiTable Event publish : widget-preference-filter-upgrade-notification"),this._privateChannel.publish({event:"widget-preference-filter-upgrade-notification"})))},M.prototype.reloadVariability=function(t,i=!1){var a=this,s={componentId:t,content:{attributes:1,rules:!1,parameters:i}};return n.getVariabilityDefinition(s).then(function(t){return a._variabilityDictionaryFormatForXmodel=o.formatDicoForXmodelListView(t),a._variabilityDictionary=t,e.Promise.resolve()},function(){return e.Promise.reject()})},M.prototype._notificationErrorSolverManagement=function(){var e={message:y.SERVICE_OUT,category:"solverError"};_.removeNotificationFromCategory("solverError","warning"),_.showWarning(e)},M.prototype._formatTreeNodeForModelListView=function(e){var t={};if(e.isRoot())t.parent=null;else{var i=e.getParent();t.parent=i.options.grid}return t.item=e.options.grid,e.options.children&&(t.item.values&&delete t.item.values,t.item.options={member:[]},e.options.children.forEach(e=>{t.item.options.member.push(e.options.grid)})),t},M.prototype.getCriteriaPanel=function(){return this._criteriaPanel},M}),define("DS/ENOXModelApp/Utils/xModelVariability",["UWA/Core","DS/CoreEvents/ModelEvents","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/CfgSolver/CfgSolverServices","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/Usage/TrackerAPI"],function(e,t,i,n,a,o,s,r,l){"use strict";return e.Class.extend({init:function(e){this._modelVersionId=e.id,this._clearSolver=!1,this._solverLoaded=!1,this._debugMode=!1,this._initDicoDone=!1,this._initRuleDone=!1,this._lazyRuleLoading=!1,this._modelEvents=new t},getInfo:function(){return{dictionary:this._dictionaryData,rules:this._ruleData,solverKey:this._solverId}},getDictionaryData:function(){var t=this;if(t._dictionaryData)return t._modelEvents.publish({event:"xmodel-variability-dictionary-loaded",data:t._dictionaryData}),t._lazyRuleLoading||t._modelEvents.publish({event:"xmodel-variability-rule-loaded",data:t._dictionaryData}),e.Promise.resolve(t._dictionaryData);if(!t._loadDicoPromise){var i=[a._KEY,a._VIEWS_PREFERENCES,a._MODEL_VERSIONS_DETAILS,a._VARIABILITY];n.getCustomAttributeStatus(i);var s={componentId:t._modelVersionId};t._loadDicoPromise=o.getSolverDico(s).then(function(i){return t._dictionaryData=i,t._modelEvents.publish({event:"xmodel-variability-dictionary-loaded",data:t._dictionaryData}),t._lazyRuleLoading||t._modelEvents.publish({event:"xmodel-variability-rule-loaded",data:t._dictionaryData}),e.Promise.resolve(t._dictionaryData)},function(){return e.Promise.reject()})}return this._loadDicoPromise},getRuleData:function(){var t=this;if(t._ruleData)return t._modelEvents.publish({event:"xmodel-variability-rule-loaded",data:t._ruleData}),e.Promise.resolve(t._ruleData);if(!this._loadRulePromise){var i={componentId:this._modelVersionId,content:{features:!1,rules:!0,attributes:3,parameters:!1}};return o.getVariabilityDefinition(i).then(function(i){return t._ruleData=i,t._modelEvents.publish({event:"xmodel-variability-rule-loaded",data:t._ruleData}),e.Promise.resolve(t._ruleData)},function(){return e.Promise.reject()})}return this._loadRulePromise},initSolver:function(t){t=t||{},e.merge(t,{onLoadDictionary:function(){},onLoadRule:function(){},onInitSolver:function(){}}),t.reloadDictionary&&this._resetDicoFlag(),t.reloadRules&&(this._lazyRuleLoading?this._resetRuleFlag():this._resetDicoFlag());this._modelEvents.subscribeOnce({event:"xmodel-variability-dictionary-loaded"},t.onLoadDictionary),this._modelEvents.subscribeOnce({event:"xmodel-variability-rule-loaded"},t.onLoadRule),this._modelEvents.subscribeOnce({event:"xmodel-variability-solver-loaded"},t.onInitSolver);var n=this;return this._solverLoaded?(n._modelEvents.publish({event:"xmodel-variability-solver-loaded",data:n._solverId}),e.Promise.resolve(this._solverId)):this._initSolverDictionary().then(function(){var t=function(){return n._solverLoaded=!0,n._modelEvents.publish({event:"xmodel-variability-solver-loaded",data:n._solverId}),i.BC_ENFORCEMENT_ENABLED&&s.computeAnswer({_from:"configurator",_to:"solver",_request:"enforceBaseConfigurations",_data:"true"},n._solverId),e.Promise.resolve(n._solverId)};return n._lazyRuleLoading?n._initSolverRules().then(t,function(){return e.Promise.reject()}):t()},function(){return e.Promise.reject()})},_resetDicoFlag:function(){this._dictionaryData=null,this._loadDicoPromise=null,this._solverId&&(this._clearSolver=!0),this._solverLoaded=!1,this._initDicoDone=!1,this._initRuleDone=!1,this._createSolverPromise=null},_resetRuleFlag:function(){this._ruleData=null,this._loadRulePromise=null,this._solverId&&(this._clearSolver=!0),this._solverLoaded=!1,this._initDicoDone=!1,this._initRuleDone=!1,this._createSolverPromise=null},_createSolver:function(){if(this._solverId&&!this._clearSolver)return e.Promise.resolve(this._solverId);var t=this;if(!this._createSolverPromise){var n=function(){if(i.SOLVER_DEBUG_MODE){var e={_from:"ruleEditor",_to:"solver",_request:"tracesActivation",_data:{activation:"yes",path:i.SOLVER_DEBUG_PATH,level:i.SOLVER_DEBUG_LEVEL}};s.computeAnswer(e,t._solverId).then(function(){t._debugMode=!0},function(){t._debugMode=!1})}};this._createSolverPromise=new e.Promise(function(i,a){var o=function(a){(function(i){return new e.Promise(function(a){if(i.solverKey)t._solverId=i.solverKey,t._clearSolver=!1,n(),a();else if(i.nodeId)t._solverId=i.nodeId,t._clearSolver=!1,n(),a();else{var o={modelVersionId:t._modelVersionId,securityContext:r.getSecurityContext()};s.create(o).then(function(e){e.solverKey?(t._solverId=e.solverKey,t._clearSolver=!1,a()):e.nodeId&&(t._solverId=e.nodeId,t._clearSolver=!1,a())},function(){return e.Promise.reject()})}})})(a).then(function(){i(t._solverId),n()},function(){return e.Promise.reject()})};if(t._solverId&&t._clearSolver)s.clearSolver(t._solverId).then(o,a);else{var l={modelVersionId:t._modelVersionId,securityContext:r.getSecurityContext()};s.create(l).then(o,a)}})}return this._createSolverPromise},_initSolverData:function(t){t=e.clone(t,!1);var i={solverKey:this._solverId,jsonData:t};return this._isDestroyed?e.Promise.reject():(this._trackEvent(i),s.initialize(i))},_trackEvent:function(t){try{var i,n=t.solverKey,a=t.jsonData,o=0,s=0;if(this._lazyRuleLoading){if(!this._initDicoDone||!this._initRuleDone)return;o=e.Json.path(this._dictionaryData,"$..values.member[?(@.idref)]"),o=e.is(o,"array")?o:[],s=e.Json.path(this._dictionaryData,"$..options.member[?(@.idref)]"),s=e.is(s,"array")?s:[],i=e.Json.path(this._ruleData,"$..rules.member[?(@.id)]"),i=e.is(i,"array")?i:[]}else o=e.Json.path(a,"$..values.member[?(@.idref)]"),o=e.is(o,"array")?o:[],s=e.Json.path(a,"$..options.member[?(@.idref)]"),s=e.is(s,"array")?s:[],i=e.Json.path(a,"$..rules.member[?(@.id)]"),i=e.is(i,"array")?i:[];l.trackPageEvent({eventCategory:"Solver",eventAction:"inilialization",eventLabel:"Solver initialization",eventValue:2,appID:"ENXMODL_AP",tenant:window.widget.getValue("x3dPlatformId")||"OnPremise",persDim:{pd1:"Variability and Rules definition",pd2:n,pd3:"ENXMODL_AP"},persVal:{pv1:o.length,pv2:s.length,pv3:i.length},scope:"Dashboard"})}catch(t){e.log("Log: Issue in Usage Tracker")}},_initSolverDictionary:function(){var t=this;return this._initDicoDone?e.Promise.resolve():e.Promise.all([this.getDictionaryData(),this._createSolver()]).then(function(){return t._initDicoDone=!0,t._initSolverData(t._dictionaryData)},function(){return e.Promise.reject()})},_initSolverRules:function(){var t=this;return this._initRuleDone?e.Promise.resolve():e.Promise.all([this.getRuleData(),this._createSolver()]).then(function(){return t._initRuleDone=!0,t._initSolverData(t._ruleData)},function(){return e.Promise.reject()})},destroy:function(){s.release(this._solverId),this._isDestroyed=!0,this._modelVersionId=null,this._dictionaryData=null,this._ruleData=null,this._solverId=null,this._clearSolver=!1,this._solverLoaded=!1,this._debugMode=!1,this._initDicoDone=!1,this._initRuleDone=!1,this._loadDicoPromise=null,this._loadRulePromise=null,this._createSolverPromise=null}})}),define("DS/ENOXModelApp/ModelDefinition/js/MVFilterDataManager",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelDictionaryUtility","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/Utils/xModelCommonUtils","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelsStatePresenter"],function(e,t,i,n,a,o,s,r,l,d,c){"use strict";var p=["physicalid","owner","organization","project","ds6w:identifier","ds6w:label","ds6w:description","ds6w:status","ds6w:type","ds6w:responsible","ds6w:state","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:organizationResponsible","BASE_PRICE","BASED_ON_MODEL_PHYSICALID","BASED_ON_MODEL_MARKETING_NAME"],u={state_preliminary:"Preliminary",state_product:"Product Management",state_design:"Design Engineering",state_review:"Review",state_release:"Release",state_obsolete:"Obsolete"},h={integer:"integer",real:"float",timestamp:"date",date:"date",string:"string",boolean:""},m=200;return t.extend({init:function(t){e.log("MVFilterDataManager: init!"),this._parent(t),e.merge(this,t),this.updateChannel&&(this._myEventManager=new s(this.updateChannel)),this._currUserId=n.getUser().login,this._currentFilter=e.clone(this.defaultFilter),this._prevFilterCriteria=e.clone(this.defaultFilter),this._platformServices=null,this._searchServiceURL=null,this.subscribeToEvents(),this._prepareSubQueryForOrganizations(),this._prepareSubQueryForMaturityStates(),this._currLang=window.widget&&window.widget.lang?window.widget.lang:"en"},_getBasicRequestObj:function(){return void 0===this._basicReqObj&&(this._basicReqObj={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}),e.clone(this._basicReqObj)},_fetchCustomExtensionPredicates:function(){var t=this;return new e.Promise(function(i,n){try{var o={onComplete:function(e){i(e)},onFailure:function(e){n(e)},onTimeout:function(e){n(e)},apiVersion:"R2018x"};o.lang=t._currLang,o.tenantId=window.widget.getValue("x3dPlatformId"),a.getPropertiesForClass("XP_ModelVersion_Ext",o)}catch(t){e.log("Exception occured while predicates  request"+t.message),n(t.message?t.message:"Exception Occured during expand!!")}})},getPredicates:function(t){var i=this;return t&&t.force||void 0===this._promiseInProgress?(this._promiseInProgress=this._fetchCustomExtensionPredicates().then(function(t){i._extPredicates={};var n=t;return n&&1===n.classPredicates.length?((n.classPredicates[0].vocabularyPredicateInfo?n.classPredicates[0].vocabularyPredicateInfo:[]).forEach(function(t){if(t)if(void 0===i._extPredicates[t.uri]){var n=t.range&&t.range.dataTypes[0];n=-1!==n.indexOf("#")?n.slice(n.indexOf("#")+1):"string",n=h[n]?h[n]:n;var a={name:t.name,nlsName:t.name,uri:t.uri,type:n,unit:t.manipulationUnit?t.manipulationUnit:""};i._extPredicates[t.uri]=a}else e.log("Warning: Attribute with same Predicate exists, not processing the current one!!!")}),e.Promise.resolve(i._extPredicates)):(e.log("There are no predicates defined."),e.Promise.resolve(i._extPredicates))},function(){return e.log("Rejected: _fetchCustomExtensionPredicates promise"),e.Promise.resolve(i._extPredicates)}),this._promiseInProgress):this._promiseInProgress&&void 0===this._extPredicates?this._promiseInProgress:e.Promise.resolve(this._extPredicates)},_prepareSubQueryForOrganizations:function(){var t="";this.currUserOrgs&&this.currUserOrgs.length>0&&(this.currUserOrgs.forEach(function(e){e&&e.trim()&&(t+=""!==t?' OR organization:"'+e+'"':'organization:"'+e+'"')}),t?(this._orgsSubQuery="("+t+")",e.log("Organizations SubQuery : "+this._orgsSubQuery)):(this._orgsSubQuery="",e.log("Warning!!! Organization Subquery empty/creation failed!")))},_prepareSubQueryForMaturityStates:function(){if(this._currentFilter&&this._currentFilter.maturity_state){var t="",i=this._currentFilter.maturity_state;for(var n in i)n&&!0===i[n]&&(t+=""!==t?' OR current:"'+u[n]+'"':'current:"'+u[n]+'"');t?(this._maturityStateSubQuery="("+t+")",e.log("Maturity State SubQuery : "+this._maturityStateSubQuery)):(this._maturityStateSubQuery="",e.log("Warning!!! Maturity State Subquery empty/creation failed!"))}},subscribeToEvents:function(){var t=this;this._myEventManager.subscribe(this.updateChannel,{event:"mv-filter-criteria-update"},function(i){e.log("MV version filter criteria updated!!!"),t._currentFilter&&i&&i.filterCriteria&&(e.equals(t._currentFilter,i.filterCriteria)?e.log("No Change in filter criteria!!"):(e.log("Filter criteria updated!"),e.extend(t._currentFilter,i.filterCriteria)))})},_getSearchQueryFromFilters:function(){var t="",i="";(this._currUserId&&this._currentFilter.owned_by_me&&this._currentFilter.owned_by_my_organizations||this._currentFilter.owned_by_me&&!1===this._currentFilter.owned_by_my_organizations)&&(t='owner:"'+this._currUserId+'"'),(!1===this._currentFilter.owned_by_me&&!1===this._currentFilter.owned_by_my_organizations||!1===this._currentFilter.owned_by_me&&this._currentFilter.owned_by_my_organizations)&&(i=this._orgsSubQuery);var n='(flattenedtaxonomies:"types/Products"'+(t&&""!==t?" AND "+t:"")+(i&&""!==i?" AND "+i:"")+(this._maturityStateSubQuery&&""!==this._maturityStateSubQuery?" AND "+this._maturityStateSubQuery:"")+")";return e.log("Query formed: "+n),n},_prepareQueryInfo:function(){return this._prepareSubQueryForOrganizations(),this._prepareSubQueryForMaturityStates(),this._getSearchQueryFromFilters()},_prepareRequestData:function(t){var i=e.merge(e.clone({}),{label:"x_mdl_app_"+n.getUser().login+"_mv_filter_"+Date.now(),with_indexing_date:!0,with_synthesis:!1,with_nls:!1,locale:this._currLang,select_predicate:this._extPredicates&&e.is(this._extPredicates,"object")?p.concat(Object.keys(this._extPredicates)):p,refine:{},order_by:"desc",nresults:m,order_field:"relevance",source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",login:{"3dspace":{SecurityContext:o.getSecurityContext()}}});return e.extend(i,t),i},_fetchData:function(t){var i=this;return new e.Promise(function(n,a){try{var s,r,l=0;t&&t.nextRequestData?(s=t.nextRequestData,l=t.currentCount,r=s.query):(r=i._prepareQueryInfo(),s=i._prepareRequestData({query:r,start:0}));var d=i._getBasicRequestObj();d.data=JSON.stringify(s),d.onComplete=function(t){var o=JSON.parse(t),s=i._parseResponse_v2(o);if(s.length>0)if(o.infos.nhits&&o.infos.nhits>s.length+l){var d=i._prepareRequestData({query:r,next_start:o.infos.next_start});n({items:s,nextRequestData:d,numberOfHits:o.infos.nhits,currentCount:s.length+l})}else n({items:s,nextRequestData:void 0,numberOfHits:o.infos.nhits,currentCount:s.length+l});else e.log("Search Response is Empty!!!"),a(t)},d.onFailure=function(e){a(e)},d.onTimeout=function(e){a(e)},o.federatedSearchRequest(d)}catch(t){e.log("Exception occured while fetching data"+t.message),a(t.message?t.message:"Exception Occured during fetch!!")}})},_parseResponse_v2:function(e){var t=[];if(this._nlsState=r.getStateValue(),e){var i=e.results;if(i&&i.length>0)for(var n=0,a=i.length;n<a;n++)if(i[n]&&i[n].attributes){for(var o=i[n].attributes,s={nlsValues:{}},p=0,u=o.length;p<u;p++)switch(o[p].name){case"ds6w:identifier":s.modelName=o[p].value,s.name=o[p].value;break;case"BASED_ON_MODEL_PHYSICALID":s.modelID=o[p].value;break;case"BASED_ON_MODEL_MARKETING_NAME":s.modelTitle=o[p].value;break;case"ds6w:label":s.title=o[p].dispValue?o[p].dispValue:o[p].value;break;case"ds6w:description":s.description=o[p].value;break;case"physicalid":s.id=o[p].value;break;case"ds6w:type":case"ds6w:what/ds6w:type":var h=o[p].value;s.type=h,s.nlsValues.nlsType=h===l.TYPE_MODELVERSION?c.modelVersionSingle:h;break;case"ds6w:created":case"ds6w:modified":case"ds6w:when/ds6w:modified":case"ds6w:when/ds6w:created":try{if(o[p].value){var m=new Date(o[p].value);"ds6w:when/ds6w:modified"===o[p].name||"ds6w:modified"===o[p].name?s.modified=m:"ds6w:when/ds6w:created"!==o[p].name&&"ds6w:created"!==o[p].name||(s.created=m)}}catch(e){"ds6w:when/ds6w:modified"===o[p].name||"ds6w:modified"===o[p].name?s.modified=o[p].value?o[p].value:"":"ds6w:when/ds6w:created"!==o[p].name&&"ds6w:created"!==o[p].name||(s.created=o[p].value?o[p].value:"")}break;case"ds6wg:revision":s.revision=o[p].value;break;case"ds6w:status":case"ds6w:what/ds6w:status":var _=o[p].value.replace(/ /g,"_");s.nlsValues.nlsState=this._nlsState["ds6w:status"][_]?this._nlsState["ds6w:status"][_]:_,_&&_.indexOf("Product.")>-1&&(_=_.slice(_.indexOf(".")+1)),s.state=_;break;case"ds6w:responsible":case"ds6w:who/ds6w:responsible":s.owner=o[p].value;break;case"ds6w:organizationResponsible":case"ds6w:who/ds6w:responsible/ds6w:organizationResponsible":r.fetchOrganzationNLS(o[p].value),s.organization=o[p].value;break;case"ds6w:project":case"project":case"ds6w:where/ds6w:context/ds6w:project":s.collabspace=o[p].value;break;case"BASE_PRICE":s.basePrice=o[p].value;break;case"preview_url":s.image=o[p].value;break;default:if(this._extPredicates){var v=o[p].name,f=!1;if(void 0!==this._extPredicates[v])f=!0;else{var g=v.lastIndexOf("/"),b=g>-1?v.substr(g+1):void 0;b&&void 0!==this._extPredicates[b]&&(f=!0,v=b)}if(f){var E=this._extPredicates[v];!o[p].value||"timestamp"!==E.type&&"date"!==E.type?(s.hasOwnProperty(E.name)&&o[p].value&&(o[p].value=s[E.name]+","+o[p].value),this._updateDataItem(s,E.name,o[p].value)):((""!=o[p].value||o[p].value)&&(o[p].value=d.formatDateAttribute(o[p].value)),s.hasOwnProperty(E.name)&&o[p].value&&(o[p].value=s[E.name]+","+o[p].value),this._updateDataItem(s,E.name,o[p].value?o[p].value:""))}}}void 0===s.description&&(s.description=""),t.push(s)}}return t},_updateDataItem:function(e,t,i){e&&t&&i&&(e.hasOwnProperty(t),e[t]=i)},performFetch:function(t){return new e.Promise(function(i,n){try{var a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};a.data=JSON.stringify(t),a.onComplete=function(e){i(e)},a.onFailure=function(e){n(e)},a.onTimeout=function(e){n(e)},o.federatedSearchRequest(a)}catch(t){e.log("Exception occured while fetching data"+t.message),n(t.message?t.message:"Exception Occured during fetch!!")}})},_setMaxItemsToFetchFromSearchRequest:function(e){void 0!==e&&e>0&&(m=e)},destroy:function(){e.log("MVFilterDataManager: Cleanup!"),this._myEventManager&&(this._myEventManager.cleanup("MVFilterDataManager"),this._myEventManager=null)}})}),define("DS/ENOXModelApp/LandingPage/LandingPageStatePresenter",["UWA/Core","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/ENOXDataDragAndDrop/js/ENOXDataDragAndDrop","DS/ENOXModelApp/InformationPanels/CommonInfoPresenter","DS/Controls/Accordeon","DS/Controls/Expander","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","UWA/Element","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/WebappsUtils/WebappsUtils","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/ENOXRelatedProject/RelatedProjectsManager","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelsStatePresenter","i18n!DS/ENOXModelApp/assets/nls/LandingPage/LandingPageStatePresenter","css!DS/ENOXModelApp/LandingPage/LandingPage.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x,R,V,N,L,F){"use strict";var U=function(e,t){this.init(e,t)};return U.prototype.init=function(i,n){this._pathMyModel=[D._KEY,D._VIEWS_PREFERENCES,D._MY_MODEL_VERSIONS],this._pathRecent=[D._KEY,D._VIEWS_PREFERENCES,D._RECENTLY_OPENED],this._namePage=b.ROUTE_RECENTY_OPENED,this._tagActivated=!0,this._mvSubTypes=n&&n.mvSubTypes?n.mvSubTypes:[],this._applicationChannel=i,this._privateChannel=new t,this._updateChannelLocal=new t,this._updateChannelLocal_recent=new t,this._dataDragAndDropModelevent=new t,this._relatedObjectsCmd=new w,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._initView(this._applicationChannel),this._subscribeToEvents(),e.is(O)?this._RelatedProjectsManager=new O:this._RelatedProjectsManager=null,this.activateProjectsFacet()},U.prototype._initView=function(e){var t={applicationChannel:e,context:this._namePage};E.initialize(t),this.itemSelected=void 0,this._initDivs(),this._initCommand(),this._initExpander(),this._initRecentListView(),this._initDragDropSupport()},U.prototype._setDNDMap=function(){var t=this;this.dndTypeMap={},e.merge([b.TYPE_MODELVERSION,"Hardware Product","Service Product","Software Product"],this._mvSubTypes.length).forEach(function(e){e&&""!==e&&(t.dndTypeMap[e]=b.TYPE_MODELVERSION)})},U.prototype._initDragDropSupport=function(){this._setDNDMap(),this._dragdropInstance=new n({droppableAreas:[this._container],modelEvents:this._dataDragAndDropModelevent})},U.prototype._subscribeToEvents=function(){var t=this;this._pltfrmApiToken=i.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(e){var i=e&&e.data&&e.data.authored&&e.data.authored.modified?e.data.authored.modified:[];i.forEach(function(e){if(e){var i=function(e,t){var i=[];return e.search({shouldStop:function(e){return e.options.id===t&&(i.push(e),!0)}}),i}(t._model_recentmvs,e);i&&1===i.length&&t._refreshListView(t._updateChannelLocal_recent,e,i[0],!0)}})}),this._dataDragAndDropModelevent.subscribe({event:"onDrop"},function(e){var i=e.data;if(i&&i.data&&i.data.items)if(i.data.items.length>1)_.showError(F._multi_object_not_supported);else{var n=i.data.items[0];if(n){var a=n.objectType?t.dndTypeMap[n.objectType]?t.dndTypeMap[n.objectType]:n.objectType:"";t._applicationChannel.publish({event:"enox-navigateTo",data:{id:n.objectId,type:a}})}else _.showError(F._no_drag_data)}else _.showError(F._type_not_supported)}),this._updateChannelLocal_recent.subscribe({event:"xmodel-list-item-on-dblclick"},function(e){var t=e.model;g.navigate(b.ROUTE_MODEL_DETAILS,{id:t.id,modelVersionId:t.id,name:t.title,version:t.version?t.version:t.revision?t.revision:"",state:t.state,modelName:t.name,type:t.type?t.type:b.TYPE_MODELVERSION,modelID:t.modelID?t.modelID:null})}),this._applicationChannel.subscribe({event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._updateChannelLocal_recent,e,!0)}),this._updateChannelLocal_recent.subscribe({event:"xmodel-list-item-on-add-selection"},function(i){e.log("----- Add Item InformationPanel from Channels -----");var n=i.model,a=!1,o=[];if(i&&i.items)for(var s=0;s<i.items.length;s++){var r=i.items[s].options.grid.state;"Review"!==r&&"Release"!==r&&"Obsolete"!==r||(a=!0),o.push(i.items[s].options.id)}if(o.length>1)t.deactivateModelFacet(),t.deactivateProjectsFacet(),t.deactivateRoadMapFacet(),t.deactivateEffectivityFacet(),t.deactivateCompositionFacet();else if(1===o.length){var l={id:(n=i.items[0].options.grid).id,title:n.title,revision:n.revision,parentId:n.modelID,parentTitle:n.modelName,state:n.state,image:n.image};t.activateModelFacet(n.modelID,n.modelTitle),t.activateProjectsFacet(),t.activateRoadMapFacet(l),t.activateEffectivityFacet(),t.activateCompositionFacet(n.modelID)}let d=[];1==i.multiSelect?n.forEach(e=>{let t=e.options.grid.id;d.push(t)}):d.push(n.id),E.addSelection(d,t._namePage,a),M.updateSelectedItems(t._pathRecent,o)}),this._updateChannelLocal_recent.subscribe({event:"model-version-action-open"},function(e){t.navigateToModel(e.id)}),this._updateChannelLocal_recent.subscribe({event:"enox-dialog-delete"},function(i){e.log("----- Delete Model from Channels -----");var n=[t._updateChannelLocal_recent];t._listDeleteModels(i,n)}),this._updateChannelLocal_recent.subscribe({event:"xmodel-list-item-on-remove-selection"},function(i){e.log("----- Remove Item InformationPanel from Channels -----");var n=i.model,a=!1,o=[];if(i&&i.items)for(var s=0;s<i.items.length;s++){var r=i.items[s].options.grid.state;"Review"!==r&&"Release"!==r&&"Obsolete"!==r||(a=!0),o.push(i.items[s].options.id)}let l=[];if(!0===i.multiSelect?n.forEach(e=>{let t=e.options.grid.id;l.push(t)}):l.push(n.id),E.removeSelection(l,t._namePage,a),1===o.length){let e=i.items[0].options.grid;var d={id:e.id,title:e.title,revision:e.revision,parentId:e.modelID,parentTitle:e.modelName,state:e.state,image:e.image};t.activateModelFacet(e.modelID,e.modelTitle),t.activateProjectsFacet(),t.activateRoadMapFacet(d),t.activateEffectivityFacet(),t.activateCompositionFacet()}M.updateSelectedItems(t._pathRecent,o)}),this._updateChannelLocal_recent.subscribe({event:"xmodel-list-item-on-empty-selection"},function(){E.removeAllSelection(t._namePage),M.updateSelectedItems(t._pathRecent,[])}),this._updateChannelLocal_recent.subscribe({event:"xmodel-list-tagger-on-filter-change"},function(e){e&&M.setTagFilter(t._pathRecent,e)}),this._updateChannelLocal_recent.subscribe({event:"xmodel-list-tagger-on-setup"},function(){t._tagActivated?t.activateTags():t.deactivateTags();var e=M.getTagFilter(t._pathRecent);e&&t._updateChannelLocal_recent.publish({event:"xmodel-list-tagger-set-filter-action",data:e})})},U.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("xmodel-landingpage")},U.prototype._initCommand=function(){this._command=new P(this._updateChannelLocal_recent,this._container,this._applicationChannel)},U.prototype._initExpander=function(){this._recentMVsContainer=e.createElement("div"),this._recentMVsContainer.classList.add("recent-mvs"),this._container.appendChild(this._recentMVsContainer),this._containerEmptyContent=e.createElement("div",{styles:{}}),this._createNewButton=new l({value:F._start_with_new_model_version,className:"primary"}),this._createNewButton.addEvent("onClick",function(){var e=g.getDependency("xModelApp");e&&e._createModelVersionAction()}),this._containerEmptyContent.setContent(this._createNewButton),this._myMVsContainer=e.createElement("div"),this._myMVsContainer.classList.add("my-mvs")},U.prototype.inject=function(e){e.appendChild(this._container)},U.prototype.navigateToModel=function(t){if(t){var i=this;r.mask(this._container),v.getModelDetails({id:t}).then(function(n){e.log("getModelDetails: Service Call Successful");var a=n.member[0].name,o=n.member[0].revision,s=n.member[0].type;r.unmask(i._container);var l=n.member[0].modelID;g.navigate(b.ROUTE_MODEL_DETAILS,{id:t,modelVersionId:t,name:a,version:o,modelName:a,type:s||b.TYPE_MODELVERSION,modelID:l},{reload:!0})},function(){r.unmask(i._container),e.log("getModelDetails: Service Call Failed !!!"),_.showError(L.GET_MODEL_DETAILS_ERROR)})}},U.prototype.loadData=function(){var t=this;t._updateChannelLocal_recent.publish({event:"xmodel-list-data-on-load-start"});y.recentItemsIds(function(i){var n=decodeURIComponent(i);e.log("--- list of recent ids ---"),e.log(n),e.log("--------------------------"),e.log(n.length);for(var a=0,o=(n=n?JSON.parse(n):[]).length;a<o;a++)null===n[a]&&n.splice(a,1);n.length>0?y.getModelVersionsFromIds(n,function(e){e&&e.member&&t._updateChannelLocal_recent.publish({event:"xmodel-list-data-load-action",data:e}),t._updateChannelLocal_recent.publish({event:"xmodel-list-data-on-load-complete"});var i=M.getSelectedItems(t._pathRecent);i&&i.length>0&&t._updateChannelLocal_recent.publish({event:"xmodel-list-selection-action",data:i})},function(){t._updateChannelLocal_recent.publish({event:"xmodel-list-data-on-load-complete"})}):t._updateChannelLocal_recent.publish({event:"xmodel-list-data-on-load-complete"})},function(){e.log("meeh")})},U.prototype.clearTags=function(){this._updateChannelLocal_recent.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},U.prototype.activateTags=function(){this._updateChannelLocal_recent.publish({event:"xmodel-list-tagger-activate-action"}),this._tagActivated=!0},U.prototype.deactivateTags=function(){this._updateChannelLocal_recent.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},U.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:L.MODEL,multiple:L.MODELS,modelEvent:t,immersiveFrame:I.getImmersiveFrame()};C.showDialog(i)},U.prototype.destroy=function(){this._container&&this._container.parentElement&&this._container.parentElement.removeChild(this._container),this._tilesView.destroy(),this.deactivateModelFacet(),this.deactivateProjectsFacet(),this.deactivateRoadMapFacet(),this.deactivateEffectivityFacet(),this.deactivateCompositionFacet(),e.is(this._RelatedProjectsManager)&&(this._RelatedProjectsManager.destroy(),this._RelatedProjectsManager=null),this._tagActivated=!1,this._pltfrmApiToken&&i.unsubscribe(this._pltfrmApiToken)},U.prototype._initRecentListView=function(){this._model_recentmvs=new d({});var e={id:"recentModelVersions",model:this._model_recentmvs,useDragAndDrop:!0,modelEvents:this._updateChannelLocal_recent,viewOptions:{views:["ThumbnailView"],currentView:"ThumbnailView",itemViewMapping:{label:function(e){return e.options.grid.title+" "+e.options.grid.revision},subLabel:function(e){var t="";if(e.options.grid){var i=e.options.grid;return t=i.nlsValues&&i.nlsValues.nlsState?i.nlsValues.nlsState:i.state,N.BASEPRICE+": "+(i.basePrice?parseFloat(i.basePrice):i.basePrice)+" | "+t+" | "+(i.owner?i.owner:i.responsible)}return t},description:"description",customTooltip:function(e){return A.prepareTooltipObjectView(e)}},contextualActions:this._getContexualMenuForModels(this._updateChannelLocal_recent)},emptyContentOptions:{sentences:[{type:"dom",DOMelement:this._containerEmptyContent}]},withToolBar:!1,extensions:[h,m]};this._tilesView=new u(e),this._tilesView.inject(this._recentMVsContainer)},U.prototype._listDeleteModels=function(t,i){var n=t;e.log("---------- Call Method listDeleteModels ---------------"),n&&v.deleteModelVersions({ids:n}).then(function(){for(var t=0,a=i.length;t<a;t++)i[t].publish({event:"xmodel-list-data-item-remove-action",data:n});e.log("---------- End Method listDeleteModels Success ---------------")},function(t){R.showError({action:x.DELETE,type:x.TYPE_MV,message:t})||_.showError(L.DELETE_MODELS_ERROR),e.log("---------- End Method listDeleteModels Fail ---------------")})},U.prototype._refreshListView=function(t,i,n,a){if(void 0!==i){var o=this;v.getModelDetails({id:i}).then(function(e){var i=e.member[0]?e.member[0]:{};i.context=n;var s=n.options.grid.title?n.options.grid.title:void 0,r=i.title?i.title:"";i.maturity=i.state,Array.isArray(t)?t.forEach(function(e){e.publish({event:"xmodel-list-data-item-update-action",data:i})}):t.publish({event:"xmodel-list-data-item-update-action",data:i}),a&&void 0!==s&&s!==r&&i.isRoot&&o._editionModelRoot(i,"title",r.trim(),a),E.removeSelection(i.id,o._namePage),E.addSelection(i.id,o._namePage)},function(){e.log("getModelDetails: Service Call Failed !!!")})}},U.prototype._editionModelRoot=function(t,i,n,a){if(t&&i){if((void 0===a||!1===a)&&("title"===i&&n.length<1||t[i]===n))return void this._updateChannelLocal_recent.publish({event:"xmodel-list-data-item-update-action",data:t});var o={};o[i]=n,(t.modelID?e.Promise.resolve({member:[{modelID:t.modelID}]}):v.getModelDetails({id:t.id})).then(function(t){var i=t.member[0].modelID;v.patchModel(i,o).then(function(){e.log("LandingPage _editionModelRoot : Service Call Success !!!")},function(){e.log("LandingPage _editionModelRoot : Service Call Failed !!!"),_.showError(L.PATCH_MODEL_ERROR)})},function(){e.log("getModelDetails _editionModelRoot : Service Call Failed !!!"),_.showError(L.GET_MODEL_DETAILS_ERROR)})}},U.prototype._editionModel=function(t,i,n){var a=this;if(t&&i){if("title"===i&&n.length<1||t[i]===n)return void a._updateChannelLocal_recent.publish({event:"xmodel-list-data-item-update-action",data:t});var o={};o[i]=n,v.patchModelVersion(t.id,o).then(function(t){e.log("LandingPage editionModel : Service Call Success !!!"),a._updateChannelLocal_recent.publish({event:"xmodel-list-data-item-update-action",data:t.member[0]});var i=t.member[0].id;a._tilesView._getSelectedItem()[0]&&(i=a._tilesView._getSelectedItem()[0].id),E.removeSelection(t.member[0].id),E.addSelection(i,a._namePage)},function(){e.log("LandingPage editionTitle : Service Call Failed !!!"),a._updateChannelLocal_recent.publish({event:"xmodel-list-data-item-update-action",data:t}),_.showError(L.PATCH_MODEL_ERROR)})}},U.prototype.clearTags=function(){this._updateChannelLocal_recent.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},U.prototype.activateProjectsFacet=function(){if(this._RelatedProjectsManager){this.deactivateProjectsFacet();var e={require:"DS/ENOXModelApp/InformationPanels/ProjectsTab/js/ProjectsTabPresenter",facet:{name:"Projects",text:N.PROJECTS,eventThread:"projects",icon:"project-plans"},options:{isEditable:!0,RelatedProjectsManager:this._RelatedProjectsManager},alwaysVisible:!0};E.addFacet({name:"Projects",facet:e},this._namePage)}},U.prototype.activateRoadMapFacet=function(e){this.deactivateRoadMapFacet();var t={require:"DS/ENOXModelApp/InformationPanels/RoadMapTab/js/RoadMapTabPresenter",position:3,facet:{name:"RoadMap",text:N.Drivers,eventThread:"RoadMap",icon:"compass wux-ui-3ds"},options:{id:e.id,title:e.title,revision:e.revision,parentId:e.parentId,parentTitle:e.parentTitle,state:e.state,image:e.image},alwaysVisible:!0};E.addFacet({name:"RoadMap",facet:t},this._namePage)},U.prototype.activateModelFacet=function(e,t){this.deactivateModelFacet();var i={require:"DS/ENOXModelApp/InformationPanels/ModelsTab/js/ModelTabPresenter",position:3,actions:[V.ACTION_SWITCH,V.ACTION_RESET,{name:"Maturity",text:N.MATURITY,icon:"collaborative-lifecycle-management"},{name:"OpenWith",text:N.OPENWITH,icon:"open-menu-dot"}],facet:{name:"modelFacet",icon:"parcel",text:L.MODEL},options:{id:e,title:t},alwaysVisible:!0};E.addFacet({name:"modelFacet",facet:i},this._namePage)},U.prototype.activateEffectivityFacet=function(){this.deactivateEffectivityFacet();var e={require:"DS/EffectivityContent/js/EffectivityTabFacet",facet:{name:"effectivityFacet",icon:"survey-list",text:N.EFFECTIVITY_TAB_TITLE},options:{},alwaysVisible:!0};E.addFacet({name:"effectivityFacet",facet:e},this._namePage)},U.prototype.activateCompositionFacet=function(e){if(b.MV_COMPOSITION_ENABLED){this.deactivateCompositionFacet();var t={require:"DS/ENOXModelApp/InformationPanels/CompositionTab/js/MVCompositionFacet",facet:{name:"compositionFacet",icon:"tree-view-flattened",text:N.COMPOSITION_FACET},options:{modelID:e},alwaysVisible:!0};E.addFacet({name:"compositionFacet",facet:t},this._namePage)}},U.prototype.deactivateCompositionFacet=function(){b.MV_COMPOSITION_ENABLED&&E.removeFacet("compositionFacet",this._namePage)},U.prototype.deactivateEffectivityFacet=function(){E.removeFacet("effectivityFacet",this._namePage)},U.prototype.deactivateModelFacet=function(){E.removeFacet("modelFacet",this._namePage)},U.prototype.deactivateProjectsFacet=function(){E.removeFacet("Projects",this._namePage)},U.prototype.deactivateRoadMapFacet=function(){E.removeFacet("RoadMap",this._namePage)},U.prototype._getContexualMenuForModels=function(t){var i=this,n=[{id:"Subscribe",text:L.get("subscribe"),fonticon:"bell-add",handler:function(e){let t=[];t.push(e),i._command._handleSubscriptionCommands(t,"Subscribe")}},{id:"unsubscribe",text:L.get("unsubscribe"),fonticon:"bell-delete",handler:function(e){let t=[];t.push(e),i._command._handleSubscriptionCommands(t,"UnSubscribe")}},{id:"editSubscriptions",text:L.get("editSubscriptions"),fonticon:"bell-pencil",handler:function(e){let t=[];t.push(e),i._command._handleSubscriptionCommands(t,"EditSubscribe")}},{id:"mySubscriptions",text:L.get("mySubscriptions"),fonticon:"bell",handler:function(e){let t=[];t.push(e),i._command._handleSubscriptionCommands(t,"MySubscriptions")}}];return[{id:"open",title:F._open,text:F._open,fonticon:"open",handler:function(t){e.log("item clicked"),g.navigate(b.ROUTE_MODEL_DETAILS,{modelVersionId:t.id,modelID:t.modelID,id:t.id,name:t.title,modelName:t.name,version:t.version?t.version:t.revision?t.revision:"",state:t.maturity?t.maturity:t.state?t.state:"",type:t.type?t.type:b.TYPE_MODELVERSION})}},{type:"SeparatorItem"},{id:"revisionExplorer",title:L.get("revisionExplorer"),text:L.get("revisionExplorer"),fonticon:"flow-branch-list",handler:function(e){i._command._handelRevisionCommand(e)}},{id:"maturityState",title:N.get("MATURITY"),text:N.get("MATURITY"),fonticon:"collaborative-lifecycle-management",handler:function(e){i._command._handleMaurityCommand(e)}},{type:"SeparatorItem"},{id:"changeOwnership",title:N.get("CHANGE_OWNERSHIP"),text:N.get("CHANGE_OWNERSHIP"),fonticon:"move-to",handler:function(e){T.checkActionAccess({action:x.MOVE,notify:!0})&&i._command._handleChangeOwnerCommand(e)}},{type:"SeparatorItem"},i._relatedObjectsCmdObj,{id:"subscriptions",title:L.get("subscriptions"),fonticon:"bell",multiSelect:!1,callSubMenuHandler:!0,content:n,handler:function(t){e.log("MV contextual : subscription action")}},{id:"information",title:F._information,text:F._information,fonticon:"info",handler:function(e){E.showInformation(e.id)}},{type:"SeparatorItem"},{id:"delete",title:F._delete,text:F._delete,fonticon:"trash",handler:function(e){if(T.checkActionAccess({action:x.DELETE,type:x.TYPE_MV,notify:!0})&&e){var n=[{id:e.id,title:e.title}];i.createDeleteModelDialog(n,t)}}}]},U}),define("DS/ENOXModelApp/ModelDefinition/js/LocalRequirementsPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/WebappsUtils/WebappsUtils","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/xPortfolioUXCommons/DialogCreation/RequirementDialogCreation","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/EditPropWidget/comm/EventManager","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/LocalRequirementsPresenter","css!DS/ENOXModelApp/ModelDefinition/css/LocalRequirements.css","DS/ENOXModelApp/Utils/xModelApp3DSearch"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M){"use strict";var I=function(){};return I.prototype.init=function(e,t,n){this.threeDSearch=new M,this._pathReq=[u._KEY,u._VIEWS_PREFERENCES,u._MODEL_VERSIONS_DETAILS,u._REQUIREMENTS],this._isDestroyed=!1,this._privateChannel=e||new i,this._applicationChannel=t,this._updateChannelLocal=new i,this._myEventManager=new p(this._updateChannelLocal,this._applicationChannel,this._privateChannel),this._id=n.id,this._modelName=n.modelName,this._editable=n.editable,this._disable=!n.editable,this._tagActivated=!1,this._eventManagerOptions=[],this._namePage="Requirements",this._infoContext="Requirements",l.initialize({applicationChannel:this._applicationChannel,silent:!0,context:this._infoContext,readOnly:!1}),this._currentFacet=null,this._listPresenter=null,this._initializeListView(),this._initDivs(),this._subscribeToEvents()},I.prototype._initializeListView=function(){var t,i=this,s=h.getSort(this._pathReq);s&&s.sortAttribute&&s.sortOrder&&(t={id:s.sortAttribute,order:s.sortOrder});const r={"Pre-assigned":S.priority_preAssigned,Low:S.priority_low,Medium:S.priority_medium,High:S.priority_high,Urgent:S.priority_urgent},l={"Pre-assigned":5,Low:4,Medium:3,High:2,Urgent:1};var p={id:"localRequirements",modelEvents:this._privateChannel,useDragAndDrop:!0,viewOptions:{identifier:"local_requirement",views:["TileView","DataGridView"],currentView:"TileView",currentSort:t,grid:{columns:[{text:S._priority,dataIndex:"priority",compareFunction:function(e,t){if(e&&t){var i=l[e],n=l[t];if(i===n)return 0;if(i>n)return-1;if(i<n)return 1}}}]},editable:!1,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){return e.options.grid.nlsValues?e.options.grid.nlsValues.nlsType?e.options.grid.nlsValues.nlsType+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible):void 0:e.options.grid.type+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible)},description:function(e){if(e&&e.options&&e.options.grid&&e.options.grid.priority){var t=e.options.grid.priority;return r[t]?r[t]:t}},customTooltip:function(e){return c.prepareTooltipObjectView(e)},icon:function(){return d.getWebappsAssetUrl("ENOXModelApp","icon/requirement.png")}},contextualActions:[{id:"information",title:S._information,text:S._information,fonticon:"info",handler:function(e){i.showInformation(e.id)}},{type:"SeparatorItem"},{id:"remove",title:S._delete,text:S._delete,fonticon:"remove",state:this._disable?"disabled":"enabled",handler:function(e){if(b.checkActionAccess({action:E.REMOVE,type:E.TYPE_REQUIREMENT,notify:!0})&&e){var t=[{id:e.id,title:e.title}];i.createDeleteModelDialog(t,i._privateChannel)}}}]},emptyContentOptions:{sentences:[{type:"img",src:d.getWebappsAssetUrl("ENOXModelApp","icon/requirement.png"),text:y.EMPTY_CONTENT_MESSAGE}]},toolbarOptions:{itemsName:S._requirements,itemName:S._requirement,withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,touchMode:!1,showSwitchViewAction:!1,actions:[{id:"create",text:S._create,fonticon:"plus",visibility:this._disable,content:[{id:"Requirement",text:S._new_requirement,selectable:!1,handler:function(){b.checkActionAccess({type:E.TYPE_REQUIREMENT,action:E.CREATE,notify:!0})&&i.createCreationModelDialog(i._privateChannel)}},{id:"NewRequirement",text:S._add_existing,selectable:!1,handler:function(){if(b.checkActionAccess({action:E.ADDEXISTING,type:E.TYPE_REQUIREMENT,notify:!0})){for(var e=[],t=i._listPresenter._contentViews.TileView.model,n=0;n<t.length;n++)e.push(t[n].getAttributeValue("id"));i.call3DSearchForExistingRequirement(i._modelName,e)}}}],handler:function(){}},{id:"remove",text:S._delete,fonticon:"remove",visibility:this._disable,category:"destructive",showOnSelection:!this._disable,handler:function(t){if(e.log("delete action.."),b.checkActionAccess({action:E.REMOVE,type:E.TYPE_REQUIREMENT,notify:!0})){var n=t.map(function(e){return{id:e.id,title:e.label}});i.createDeleteModelDialog(n,i._privateChannel)}}}]},extensions:[a,o]};this._listPresenter=new n(p)},I.prototype._subscribeToEvents=function(){var t=this;this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-delete"},function(e){t.deleteRequirements(e)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-creation"},function(e){t.createRequirement(e.content)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-dblclick"},function(e){var i=e.model;t._currentFacet="Content",t.activateFacet(t._currentFacet),l.showInformation(i.id,!1,t._currentFacet)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-add-selection"},function(e){var i=e.model,n=[];e.items&&e.items.forEach(function(e){e.options&&n.push(e.options.id)});var a=!1;1===n.length?a=!0:t.deactivateFacet();let o=[];1==e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;o.push(t)}):o.push(i.id),l.addSelection(o,t._namePage),a&&(t._currentFacet="Content",t.activateFacet(t._currentFacet)),h.updateSelectedItems(t._pathReq,n)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-remove-selection"},function(e){var i=e.model;let n=[];1==e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;n.push(t)}):n.push(i.id),l.removeSelection(n,t._namePage);var a=[];e.items&&e.items.forEach(function(e){e.options&&a.push(e.options.id)}),1===a.length?(t._currentFacet="Content",t.activateFacet(t._currentFacet)):t.deactivateFacet(),h.updateSelectedItems(t._pathReq,a)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-empty-selection"},function(){l.removeAllSelection(t._namePage),h.updateSelectedItems(t._pathReq,[])}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._privateChannel,e,this)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-sort-activated"},function(e){h.updateSort(t._pathReq,e)}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-filter-change"},function(e){e&&h.setTagFilter(t._pathReq,e)}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-setup"},function(){t._tagActivated?t.publishTags():t.clearTags();var e=h.getTagFilter(t._pathReq);e&&t._privateChannel.publish({event:"xmodel-list-tagger-set-filter-action",data:e})}),this._privateChannel.subscribe({event:"set-requirement-editable"},function(e){var i=!0===e?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";t._privateChannel.publish({event:i,data:"create"}),t._privateChannel.publish({event:i,data:"remove"}),t._editable=e,t._disable=!t._editable}),t._eventManagerOptions.push({eventName:"requirement-Content-load-data-start",callback:function(t){s.getRequirementContent('["'+t+'"]').then(function(e){if(e&&e.member&&e.member.length>0){var t=e.member[0];g.publish("requirement-Content-load-action",t)}},function(){e.log("LocalRequirementPresenter : getRequirementDetails service failed"),f.showError(S._error_req_content_load)})}},{eventName:"requirement-Content-save-action",callback:function(i){var n={parentID:t._id,items:[{physicalid:i.id,attributes:i.attributes}]};s.modifyRequirements(n).then(function(){e.log("modifyRequirements : done"),f.showSuccess(S._req_update_succ)},function(){e.log("LocalRequirementsPresenter modifyRequirements : Service Call Failed !!!"),f.showError()}),e.log(i)}},{eventName:"requirement-Content-cancel-action",callback:function(t){e.log(t),g.publish("requirement-Content-load-data-start",t.id)}}),this._eventManagerOptions.forEach(function(e){g.subscribe(e.eventName,e.callback)})},I.prototype.call3DSearchForExistingRequirement=function(t,i){var n=this;i=i||[],this.threeDSearch.launchASearch({allowedTypes:[],role:"",criteria:"",precondition:'flattenedtaxonomies:"types/Requirement"',resourceid_not_in:i,in_apps_callback:function(t){var i=[],a=0;for(a=0;a<t.length;a++)i.push(t[a].id);var o={fromID:n._id,toIDs:i};s.addExistingRequirement(o).then(function(e){for(a=0;a<e.member.length;a++)n._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){n._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select()}),n._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:e.member[a]}),n._privateChannel.publish({event:"xmodel-list-data-on-load-complete"});var t=o.toIDs;t&&t.length>0&&n._privateChannel.publish({event:"xmodel-list-selection-action",data:t}),n._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:h.getSort(n._pathReq)})},function(t){e.log("LocalRequirementsPresenter addExistingRuleFromModelVersion : Service Call Failed !!!"),n._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),C.showError({action:E.ADDEXISTING,type:E.TYPE_REQUIREMENT,message:t})||f.showError(S._error_add_existing)})}})},I.prototype._refreshListView=function(t,i,n){if(void 0!==i){var a,o=this;n&&(a=n.options.grid),s.getRequirementDetail('["'+i+'"]').then(function(i){var s;i&&i.member[0]&&(s=i.member[0],a&&e.merge(s,a),s.context=n,t.publish({event:"xmodel-list-data-item-update-action",data:s})),l.removeSelection(s.id,o._namePage),l.addSelection(s.id,o._namePage)},function(){e.log("modifyRequirements: Service Call Failed !!!"),f.showError(S._error_req_content_load)})}},I.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("requirements-presenter"),this._listPresenter.inject(this._container),this._updateChannelLocal.publish({event:"enox-collection-toolbar-disable-action",data:"remove"})},I.prototype.createRequirement=function(i){var n=this;n._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),s.createRequirement({parentID:this._id,items:[{attributes:i}]}).then(function(i){t.unmask(n._container);var a=[];if(i&&i.member.length>0){if(i&&i.member.length>0)var o=i.member[0].id;a.push(o)}var r={fromID:n._id,toIDs:a};s.addExistingRequirement(r).then(function(e){n._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){n._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),n._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select()}),n._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:e.member[0]}),n._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:h.getSort(n._pathReq)}),n._privateChannel.publish({event:"enox-dialog-creation-done"}),f.showSuccess(y._creation_successful)},function(){e.log("LocalRequirementPresenter addExistingRequirement: Service Call Failed !!!"),n._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),f.showError(S._error_create_req)})},function(){e.log("Requirement creation failed"),n._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),n._privateChannel.publish({event:"enox-dialog-creation-done"}),f.showError(S._error_create_req)})},I.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"remove",single:S._requirement,multiple:S._requirements,modelEvent:t,immersiveFrame:v.getImmersiveFrame()};m.showDialog(i)},I.prototype.showInformation=function(e){e&&(this._currentFacet="Content",this._currentFacet&&(this.deactivateFacet(),this._currentFacet="Content",this.activateFacet(this._currentFacet)),l.showInformation(e,!1))},I.prototype.activateFacet=function(e){if(e){var t={require:"DS/ENOXModelApp/InformationPanels/ContentTab/js/ContentTabPresenter",position:1,facet:{name:e,text:S._contentFacet,eventThread:"Requirement",icon:"eye"},alwaysVisible:!0};l.addFacet({name:e,facet:t},this._infoContext)}},I.prototype.deactivateFacet=function(){l.removeFacet("Content",this._infoContext),this._currentFacet=null},I.prototype.createCreationModelDialog=function(e){_.show({id:"requirement",modelEvent:e,title:S._new_requirement,withCreateAndClose:!0})},I.prototype.deleteRequirements=function(t){var i=this;s.removeRequirements({toIDs:t,fromID:i._id}).then(function(){e.log("Requirement removed"),i._privateChannel.publish({event:"xmodel-list-data-item-remove-action",data:t})},function(t){e.log("requirement removal failed"),C.showError({mandatoryErrCodeCheck:!1,action:E.REMOVE,type:E.TYPE_REQUIREMENT,message:t})||f.showError(S._error_remove_req)})},I.prototype.inject=function(e){e.appendChild(this._container)},I.prototype.publishTags=function(){this._tagActivated=!0,this._privateChannel.publish({event:"xmodel-list-tagger-activate-action"})},I.prototype.loadData=function(){var e=this;e._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),s.getRequirements({id:e._id}).then(function(i){t.unmask(e._container);var n=i;e._privateChannel.publish({event:"xmodel-list-data-load-action",data:n}),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"});var a=h.getSelectedItems(e._pathReq);a&&a.length>0&&e._privateChannel.publish({event:"xmodel-list-selection-action",data:a}),e._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:h.getSort(e._pathReq)})},function(){t.unmask(e._container),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),f.showError(S._error_get_req)})},I.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this.clearTags(),this._myEventManager&&(this._myEventManager.cleanup("LocalRequirementsPresenter"),this._myEventManager=null),this._eventManagerOptions.forEach(function(e){g.remove(e.eventName,e.callback)}),this._eventManagerOptions=[],this.deactivateFacet()},I.prototype.clearTags=function(){this._tagActivated=!1,this._privateChannel.publish({event:"xmodel-list-tagger-deactivate-action"})},I}),define("DS/ENOXModelApp/ModelDefinition/js/LocalSpecificationPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/WebappsUtils/WebappsUtils","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/EditPropWidget/comm/EventManager","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/ENOXModelApp/ModelDocument/js/DocumentManagementCustom","DS/DocumentManagement/DocumentManagement","DS/ENOXDataDragAndDrop/js/ENOXDataDragAndDrop","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/LocalSpecificationPresenter","css!DS/ENOXModelApp/ModelDefinition/css/LocalSpecifications.css","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/TreeModel/TreeDocument","DS/ENOXModelApp/Utils/SpecificationCommonUtil","DS/ENOXModelApp/Utils/xModelAppGlobalConfig"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T){"use strict";var x=function(){},R="Product Specification",V=R;M.TYPE_PRODUCT_SPEC;return x.prototype.init=function(e,t,n){this._options=n,this.threeDSearch=new P,this._pathSpec=[h._KEY,h._VIEWS_PREFERENCES,h._MODEL_VERSIONS_DETAILS,h._SPECIFICATIONS],this._isDestroyed=!1,this._privateChannel=e||new i,this._applicationChannel=t,this._updateChannelLocal=new i,this._myEventManager=new u(this._updateChannelLocal,this._applicationChannel,this._privateChannel),this._id=n.id,this._editable=n.editable,this._disable=!n.editable,this._tagActivated=!1,this._eventManagerOptions=[],this._infoContext="Specifications",l.initialize({applicationChannel:this._applicationChannel,silent:!0,context:this._infoContext,readOnly:!1}),this._currentFacet=null,this._listPresenter=null,this._initializeListView(),this._initDivs(),this._subscribeToEvents()},x.prototype._initializeListView=function(){var t,i=this,s=m.getSort(this._pathSpec);s&&s.sortAttribute&&s.sortOrder&&(t={id:s.sortAttribute,order:s.sortOrder});var r={id:"localRequirements",model:new w({}),modelEvents:this._privateChannel,useDragAndDrop:!0,withmultisel:!0,showItemCount:!0,viewOptions:{identifier:"local_requirement",views:["ThumbnailView","TileView","DataGridView"],currentView:m.getView(this._pathSpec),currentSort:t,grid:{columns:[{text:M.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker"},{text:M.NAME,dataIndex:"name"},{text:M.TYPE,dataIndex:"typeNLS",visibleFlag:!1},{text:M.REVISION,dataIndex:"revision"},{text:M.IS_LATEST_REVISION,dataIndex:"isLatestRevision",typeRepresentation:"boolean"},{text:M.LOCK_STATUS,dataIndex:"lock",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel.options.grid.reservedby){return{icon:"fonticon fonticon-key reservations-key coloured-boolean",label:e.nodeModel.options.grid.reservedby,url:""}}}},{text:M._OWNER,dataIndex:"owner"},{text:M.MATURITY_STATE,dataIndex:"stateNLS"},{text:M.COLLABSPACE,dataIndex:"collabSpaceTitle"},{text:M.MODIFICATION_DATE,dataIndex:"modified",getCellValue:function(e){if(e.nodeModel.options.grid.modified)return p.formatDateAttribute(e.nodeModel.options.grid.modified)}}]},editable:!1,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){return e.options.grid.owner+" | "+e.options.grid.stateNLS},description:function(e){return M.MODIFICATION_DATE+" : "+p.formatDateAttribute(e.options.grid.modified)},customTooltip:function(e){return p.prepareTooltipObjectView(e)}},contextualActions:[{id:"open",text:I._Open,fonticon:"open",multiSelect:!1,handler:function(t){e.merge(t,{modelVersionId:i._options.modelVersionId,modelVersionName:i._options.modelVersionName,modelVersion:i._options.modelVersion}),c.navigate(T.ROUTE_MODEL_DOC_DETAILS,t)}},{type:"SeparatorItem"},{id:"upload",text:I._Upload,fonticon:"upload",handler:function(e){if(void 0===e.reservedby||""!==e.reservedby&&e.reservedby!==O.getLoggedInUser())f.showError(I.DOC_UNLOCK_MESSAGE_USER+e.reservedby);else{var t=document.createElement("input");t.type="file",t.addEventListener("change",function(){i.uploadFileForSpec(e,t)},!1),t.click()}}},{type:"SeparatorItem"},{id:"lock",text:I._Lock,fonticon:"lock",handler:function(e){i._lockItems()}},{id:"unlock",text:I._Unlock,fonticon:"lock-open",handler:function(e){i._unlockItems()}},{type:"SeparatorItem"},{id:"download",text:I._Download,fonticon:"download",handler:function(e){i._downloadItems()}},{id:"information",title:M.INFORMATION,text:M.INFORMATION,fonticon:"info",handler:function(e){l.setContext("Specifications"),i._applicationChannel.publish({event:"information-panel-open"})}},{type:"SeparatorItem"},{id:"remove",title:M.Remove_label,text:"Remove",fonticon:"remove",handler:function(e,t){if(b.checkActionAccess({action:E.REMOVE,type:E.TYPE_PRODUCT_SPEC,notify:!0})){i._selectedItems=[{grid:t}];var n=t.map(function(e){return{id:e.id,title:e.title}});i.createDeleteModelDialog(n,i._privateChannel)}}}]},emptyContentOptions:{sentences:[{type:"icon",fonticon:"drag-drop",sizeicon:"40px",text:I.DOC_Landing_Page}]},toolbarOptions:{withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,touchMode:!1,actions:[{id:"addExisting",visibility:this._disable,text:I._Add_Existing,fonticon:"plus",handler:function(){if(b.checkActionAccess({action:E.ADDEXISTING,type:E.TYPE_PRODUCT_SPEC,notify:!0})){for(var e=[],t=i._listPresenter._contentViews.TileView.model,n=0;n<t.length;n++)e.push(t[n].getAttributeValue("id"));i.call3DSearchForExistingSpecification(e)}}},{id:"upload",visibility:this._disable,text:I._Upload_Specification,fonticon:"upload",handler:function(){if(b.checkActionAccess({action:E.UPLOAD,type:E.TYPE_PRODUCT_SPEC,notify:!0})){var e=document.createElement("input");e.type="file",e.multiple=!0,e.addEventListener("change",function(){i.uploadFile(e)},!1),e.click()}}},{className:"divider"},{id:"lock_status",text:I._Lock_selected,fonticon:"lock",showOnSelection:!0,handler:function(){i._lockItems()}},{id:"unlock",fonticon:"lock-open",showOnSelection:!0,text:I._Unlock_selected,handler:function(){i._unlockItems()}},{className:"divider"},{id:"download",fonticon:"download",showOnSelection:!0,text:I._Download_Selected,handler:function(e){i._downloadItems()}},{className:"divider"},{id:"remove",text:M.Remove_label,fonticon:"remove",visibility:this._disable,showOnSelection:!this._disable,handler:function(t){if(e.log("delete action.."),b.checkActionAccess({action:E.REMOVE,type:E.TYPE_PRODUCT_SPEC,notify:!0})){i._selectedItems=t;var n=t.map(function(e){return{id:e.id,title:e.label}});i.createDeleteModelDialog(n,i._privateChannel)}}}]},extensions:[a,o]};this._listPresenter=new n(r)},x.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"remove",single:I._Single_Product_Spec,multiple:I._Multiple_Product_Spec,modelEvent:t,immersiveFrame:v.getImmersiveFrame()};_.showDialog(i)},x.prototype.uploadFileForSpec=function(e,i){var n=this,a=e.id,o=i.files[0],s={onComplete:function(e){if(0===e.data[0].relateddata.files.length)S.addFileToDocument({id:a,fileInfo:{file:o}},{securityContext:r.getSecurityContext(),onComplete:function(){t.unmask(n._container),f.showSuccess(I.DOC_Files_Upload_Success)},onFailure:function(){t.unmask(n._container),f.showError(I.DOC_Files_Upload_Error)}});else if(e.data[0].relateddata.files.length>=1){var i={id:a,fileInfo:{file:o},newFile:!1},s={onComplete:function(){t.unmask(n._container),f.showSuccess(I.DOC_Files_Upload_Success)},onFailure:function(){t.unmask(n._container),f.showError(I.DOC_Files_Upload_Error)}};S.modifyDocument(i,s)}else f.showError(I.DOC_Files_Upload_Error),t.unmask(n._container)},onFailure:function(){f.showError(I.DOC_Files_Upload_Error),t.unmask(n._container)}};S.getDocuments([a],s)},x.prototype._lockItems=function(i){var n=this,a=function(i,a){y.reserveDocument(i,{securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),onComplete:function(i){var o={id:i.data[0].id},s=e.merge(i.data[0].dataelements,o);n._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:s}),a&&(f.showSuccess(I.DOC_Select_Lock_Success),t.unmask(n._container))},onFailure:function(e){f.showError(I.DOC_Select_Lock_Error+e.error),t.unmask(n._container)}})};if(i&&i.id)i.reservedby?(f.showError(I.DOC_SELECT),t.unmask(n._container)):(t.mask(n._container),a(i.id,!0));else{var o=m.getSelectedItems(n._pathSpec);if(o.length>0){for(var s,l=0;l<o.length;l++)s=0===l?o[l]:s+","+o[l];var d={relInfo:{parentId:s,parentRelName:R},onComplete:function(e){for(var i=!1,s=0;s<e.data.length;s++){if(""!==e.data[s].dataelements.reservedby){i=!0;break}}if(i)f.showError(I.DOC_SELECT),t.unmask(n._container);else for(t.mask(n._container),s=0;s<o.length;s++)a(o[s],s===o.length-1)},onFailure:function(e){f.showError(I.DOC_Select_Unlock_Error+e.error),t.unmask(n._container)}},c=Array.isArray(s)?s:[s];S.getDocuments(c,d)}}},x.prototype._unlockItems=function(i){var n=this,a=function(i,a){y.unreserveDocument(i,{securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),onComplete:function(i){var o={id:i.data[0].id},s=e.merge(i.data[0].dataelements,o);n._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:s}),a&&(f.showSuccess(I.DOC_Select_Unlock_Success),t.unmask(n._container))},onFailure:function(e){f.showError(I.DOC_Select_Lock_Error+e.error),t.unmask(n._container)}})};if(i&&i.id)i.reservedby?(t.mask(n._container),a(i.id,!0)):f.showError(I.DOC_Select_Lock);else{var o=m.getSelectedItems(n._pathSpec);if(o.length>0){var s;t.mask(n._container);for(var l=0;l<o.length;l++)s=0===l?o[l]:s+","+o[l];var d={relInfo:{parentId:s,parentRelName:R},onComplete:function(e){for(var i=!1,s=!1,r=0;r<e.data.length;r++){var l=e.data[r].dataelements.reservedby;if(""===l){i=!0;break}if(l!==O.getLoggedInUser()){i=!0,s=!0;break}}if(i)s?(f.showError(I.DOC_REMOVE_FROM_ACTION_MENU),t.unmask(n._container)):(f.showError(I.DOC_Select_Lock),t.unmask(n._container));else for(t.mask(n._container),r=0;r<o.length;r++)a(o[r],r===o.length-1)},onFailure:function(e){f.showError(I.DOC_Select_Unlock_Error+e.error),t.unmask(n._container)}},c=Array.isArray(s)?s:[s];S.getDocuments(c,d)}}},x.prototype._downloadItems=function(t){var i=this;if(t&&t.id)S.downloadDocuments([t.id],{onComplete:function(t){e.is(t,"array")&&t.forEach(function(e){e.downloadUrl&&i.download(e.downloadUrl,e.fileName)})},onFailure:function(){f.showError(I.DOC_Files_DownloadSelection_Error)}});else{var n=m.getSelectedItems(i._pathSpec);n.length>0&&S.downloadDocuments(n,{asZip:!0,onComplete:function(t){e.is(t,"array")&&t.forEach(function(e){e.downloadUrl&&i.download(e.downloadUrl,e.fileName)})},onFailure:function(){f.showError(I.DOC_Files_DownloadSelection_Error)}})}},x.prototype.download=function(e,t){var i=this,n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){200===this.status?(i._saveBlob(this.response,t,i),f.showSuccess(I.DOC_Files_download_success)):f.showError(I.DOC_Files_Download_Error+t)},n.onerror=function(){f.showError(I.DOC_Files_Download_Error+t)},n.send()},x.prototype._saveBlob=function(e,t){navigator.msSaveBlob?navigator.msSaveBlob(e,t):this._html5Saver(e,t)},x.prototype._html5Saver=function(e,t){var i=document.createElement("a");document.body.appendChild(i),i.style="display: none";var n=window.URL.createObjectURL(e);i.href=n,i.download=t,i.click(),document.body.removeChild(i)},x.prototype.call3DSearchForExistingSpecification=function(e){var i=this;this.threeDSearch.launchASearch({allowedTypes:[],role:"",title:"Add Existing Specifications",precondition:'(flattenedtaxonomies:"types/Product Specification")',resourceid_not_in:e,in_apps_callback:function(e){var n=!1;i._id;t.mask(i._container);for(var a=0;a<e.length;a++){a===e.length-1&&(n=!0);var o={securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),relInfo:{parentId:i._id,parentRelName:"Product Specification"},onComplete:function(t){var a;e.forEach(function(e){e.id===t.data[0].id&&(a=e)}),i._connectDocumentToParentOnComplete(t,n,a)},onFailure:function(e){i._connectDocumentToParentOnFailure(e,n)}};S.connectDocumentToParent(e[a].id,o)}}})},x.prototype._connectDocumentToParentOnComplete=function(i,n,a){var o=this,s=a.id,l={securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),relInfo:{parentId:s,parentRelName:R},onComplete:function(i){if(i&&i.data){var a,s=i.data;if(e.is(s,"array")&&(s=s[0]),s.relateddata.ownerInfo[0].dataelements){var r=s.relateddata.ownerInfo[0].dataelements;a=r.firstname+" "+r.lastname}var l={id:s.id,owner:a},d=e.merge(l,s.dataelements);o._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){o._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select()}),o._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:d}),o._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),o._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:m.getSort(o._pathSpec)}),t.unmask(o._container),n&&f.showSuccess(I.DOC_ADD_SUCCESS)}},onFailure:function(e){f.showError(O.getErrorMessage(e.internalError))}};S.getDocuments([s],l)},x.prototype._connectDocumentToParentOnFailure=function(e,i){var n;if(i)if(t.unmask(this._container),-1!==e.internalError.lastIndexOf("Message:A"))f.showError(I.DOC_ERROR_ALREADY_CONNECTED);else if(e.error&&e.error.split("\n").length>2){var a=e.error,o=(n=a.split("\n"))[0],s=n[1],r=a.replace(o+"\n","");r=r.replace(s+"\n",""),f.showError({title:o,subtitle:s,message:r})}else f.showError(O.getErrorMessage(e.internalError))},x.prototype._setupDroppableRegion=function(){new D({droppableAreas:[this._container],modelEvents:this._privateChannel})},x.prototype.uploadFile=function(e){var i=this._id;t.mask(this._container);var n=!1,a=e.files.length;if(0!==a)for(var o=0;o<a;o++){var s=e.files[o].name,r={title:s=s.substr(0,s.lastIndexOf(".")),type:"Product Specification",policy:"Specification",relInfo:{parentId:i,parentRelName:"Product Specification"},fileInfo:{file:e.files[o],title:e.files[o].name}};o===a-1&&(n=!0),this.createDocument(r,i,n)}},x.prototype.createDocument=function(e,t,i){var n=this;""!==r.getSecurityContext()&&S.createDocument(e,{securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),onComplete:function(e){n.createDocumentPostProcess(e,t,i)},onFailure:function(e){n.createDocumentOnFailure(e)}})},x.prototype.createDocumentPostProcess=function(i,n,a){var o=this;if(i&&i.data){var s,r=i.data;if(e.is(r,"array")&&(r=r[0]),r.relateddata.ownerInfo[0].dataelements){var l=r.relateddata.ownerInfo[0].dataelements;s=l.firstname+" "+l.lastname}var d={id:r.id,owner:s},c=e.merge(d,r.dataelements);o._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){o._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select()}),o._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:c}),o._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),o._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:m.getSort(o._pathSpec)}),o._privateChannel.publish({event:"enox-dialog-creation-done"}),t.unmask(o._container),a&&f.showSuccess(I.DOC_CREATE_SUCCESS)}},x.prototype.createDocumentOnFailure=function(e){var i;if(t.unmask(this._container),e.error&&e.error.split("\n").length>2){var n=e.error,a=(i=n.split("\n"))[0],o=i[1],s=n.replace(a+"\n","");s=s.replace(o+"\n",""),f.showError({title:a,subtitle:o,message:s})}else f.showError(O.getErrorMessage(e.error))},x.prototype._removeMultiSelIcon=function(){},x.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("specifications-presenter"),this._listPresenter.inject(this._container),this._setupDroppableRegion()},x.prototype.loadData=function(){var e=this;e._privateChannel.publish({event:"xmodel-list-data-on-load-start"});var t={relInfo:{parentId:e._id,parentRelName:V},getVersions:!0,securityContext:r.getSecurityContext(),tenantUrl:r._serviceUrl,tenant:"OnPremise",onComplete:function(t){e.loadSpecifications(t)},onFailure:function(){}};S.getDocumentsFromParent(t)},x.prototype._checkForLockedSpecification=function(e){var i=!1;if(this._selectedItems&&this._selectedItems.length===e.length)for(var n=0;n<this._selectedItems.length;n++){var a=this._selectedItems[n].grid.reservedby;if(a&&this._selectedItems[n].grid.id===e[n]&&""!==a&&a!==O.getLoggedInUser()){i=!0;break}}i?i?(f.showError(I.DOC_REMOVE_FROM_ACTION_MENU),t.unmask(this._container)):(f.showError(I.DOC_SELECT),t.unmask(this._container)):this._removeSpecificationsPreDataFormatting(e)},x.prototype._removeSpecificationsPreDataFormatting=function(e){t.mask(this._container);let i=function(e,i){this._privateChannel.publish({event:"xmodel-list-data-item-remove-action",data:i}),c.getDependency("applicationChannel").publish({event:"enox-model-app-item-removed",data:i}),e&&(f.showSuccess(I.DOC_Remove_success),t.unmask(this._container))}.bind(this);var n=!1;if(e)for(var a=e.length,o=0;o<a;o++){var s=e[o];o===a-1&&(n=!0),O.removeSpecifications(this._id,s,"Product Specification",n,i,this._removeSpecOnFailure)}t.unmask(this._container)},x.prototype._removeSpecOnFailure=function(e,t){t&&f.showError(O.getErrorMessage(e.internalError))},x.prototype.loadSpecifications=function(t){var i=t.data,n={member:[]};i.forEach(function(t){var i;if(t.relateddata.ownerInfo[0].dataelements){var a=t.relateddata.ownerInfo[0].dataelements;i=a.firstname+" "+a.lastname}var o=e.merge({id:t.id,owner:i},t.dataelements);n.member.push(o)}),this._privateChannel.publish({event:"xmodel-list-data-load-action",data:n}),this._privateChannel.publish({event:"xmodel-list-data-on-load-complete"});var a=m.getSelectedItems(this._pathSpec);a&&a.length>0&&(this._privateChannel.publish({event:"xmodel-list-selection-action",data:a}),this._disable||this._privateChannel.publish({event:"xmodel-list-toolbar-show-action",data:"remove"}))},x.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-spec-status-update"},function(t){e._refreshListView(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-link-click"},function(t){e._privateChannel.publish({event:"xmodel-execute-command",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-delete"},function(t){e._checkForLockedSpecification(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-add-selection"},function(t){var i=t.model,n=[];t.items&&t.items.forEach(function(e){e.options&&n.push(e.options.id)});let a=[];1==t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;a.push(t)}):a.push(i.id),l.addSelection(a,e._infoContext),m.updateSelectedItems(e._pathSpec,n)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-remove-selection"},function(t){var i=t.model;let n=[];!0===t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;n.push(t)}):n.push(i.id),l.removeSelection(n,e._infoContext);var a=[];t.items&&t.items.forEach(function(e){e.options&&a.push(e.options.id)}),m.updateSelectedItems(e._pathSpec,a)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-empty-selection"},function(){l.removeAllSelection(e._infoContext),m.updateSelectedItems(e._pathSpec,[])}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-list-data-item-need-refresh"},function(t){e._refreshListView(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-data-item-need-refresh"},function(t){e._refreshListView(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-switch-view-activated"},function(t){m.updateView(e._pathSpec,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-sort-activated"},function(t){m.updateSort(e._pathSpec,t)}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-filter-change"},function(t){t&&m.setTagFilter(e._pathSpec,t)}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-setup"},function(){e._tagActivated?e.publishTags():e.clearTags();var t=m.getTagFilter(e._pathSpec);t&&e._privateChannel.publish({event:"xmodel-list-tagger-set-filter-action",data:t})}),this._privateChannel.subscribe({event:"onDrop"},function(t){e.dropSpec(t)}),this._privateChannel.subscribe({event:"set-specifications-editable"},function(t){var i=!0===t?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";e._privateChannel.publish({event:i,data:"addExisting"}),e._privateChannel.publish({event:i,data:"upload"}),e._privateChannel.publish({event:i,data:"remove"}),e._editable=t,e._disable=!e._editable})},x.prototype._refreshListView=function(t){var i=this,n={securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),relInfo:{parentId:t,parentRelName:R},onComplete:function(t){var n={id:t.data[0].id},a=e.merge(t.data[0].dataelements,n);i._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:a})},onFailure:function(e){f.showError(O.getErrorMessage(e.internalError))}};S.getDocuments([t],n)},x.prototype.dropSpec=function(i){var n=this,a=n._id,o=!1;if(i.data&&i.data.data&&i.data.data.length>0){t.mask(n._container);for(var s=i.data.data,l=s.length,d=0;d<l;d++){var c=s[d].name,p={title:c=c.substr(0,c.lastIndexOf(".")),type:"Product Specification",policy:"Specification",relInfo:{parentId:a,parentRelName:"Product Specification"},fileInfo:{file:s[d],title:s[d].name}};d===l-1&&(o=!0),n.createDocument(p,a,o)}}else if(i.data&&i.data.data&&i.data.data.items&&i.data.data.items.length>0){i.data.data.items.forEach(function(i){var a=!1,s=i.objectId;if(n._listPresenter._model.search({shouldStop:function(e){s===e.options.id&&(a=!0)}}),!a){t.mask(n._container);var l={securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),relInfo:{parentId:n._id,parentRelName:"Product Specification"},onComplete:function(i){var a=i.data[0].id,o={securityContext:r.getSecurityContext(),additionalHeaders:y.addCfgAuthoringContextToHeader(),relInfo:{parentId:a,parentRelName:R},onComplete:function(i){var a={id:i.data[0].id},o=e.merge(i.data[0].dataelements,a);n._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:o}),t.unmask(n._container)},onFailure:function(e){f.showError(O.getErrorMessage(e.internalError)),t.unmask(n._container)}};S.getDocuments([a],o)},onFailure:function(e){n._connectDocumentToParentOnFailure(e,o),t.unmask(n._container)}};S.connectDocumentToParent(s,l)}})}},x.prototype.inject=function(e){e.appendChild(this._container)},x.prototype.publishTags=function(){this._tagActivated=!0,this._privateChannel.publish({event:"xmodel-list-tagger-activate-action"})},x.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this.clearTags(),this._myEventManager&&(this._myEventManager.cleanup("LocalSpecificationsPresenter"),this._myEventManager=null)},x.prototype.clearTags=function(){this._tagActivated=!1,this._privateChannel.publish({event:"xmodel-list-tagger-deactivate-action"})},x}),define("DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/SearchAndExpandManager",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/Utils/CustomAttributesManager","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelDictionaryUtility","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n,a,o,s,r,l,d){"use strict";var c=["physicalid","owner","organization","project","ds6w:identifier","ds6w:label","ds6w:description","ds6w:status","ds6w:type","ds6w:responsible","ds6w:state","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:organizationResponsible"],p={"Variant Value":d.TYPE_VARIANT_VALUE,Variant:d.TYPE_VARIANT,"Variability Group":d.TYPE_OPTION_GROUP,"Variability Option":d.TYPE_OPTION},u={};return t.extend({init:function(t){e.log("SearchAndExpandManager: init!"),this._parent(t),e.merge(this,t),this.updateChannel&&(this._myEventManager=new r(this.updateChannel)),this._currUserId=n.getUser().login,this._platformServices=null,this._searchServiceURL=null,this._noOfItemsToRetrieve=200,this._currLang=window.widget&&window.widget.lang?window.widget.lang:"en"},_prepareQueryInfo:function(){return'(flattenedtaxonomies:"types/'+this.parentType+'")'},_prepareRequestData:function(t){var i=e.merge(e.clone({}),{label:"x_mdl_app_"+n.getUser().login+"_expand_"+Date.now(),with_indexing_date:!0,with_synthesis:!1,with_nls:!1,locale:this._currLang,select_predicate:this.searchPredicates?this.searchPredicates:c,refine:{},order_by:"desc",nresults:this._noOfItemsToRetrieve,order_field:"relevance",source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",login:{"3dspace":{SecurityContext:a.getSecurityContext()}}});return e.extend(i,t),i},performSearch:function(t){var i=this;return new e.Promise(function(n,o){try{var s,r,l=0;t&&t.nextRequestData?(s=t.nextRequestData,l=t.currentCount,r=s.query):(r=i._prepareQueryInfo(),s=i._prepareRequestData({query:r,start:0}));var d=i._getBasicRequestObj();d.data=JSON.stringify(s),d.onComplete=function(t){var a=JSON.parse(t),s=i._parseResponse_toGetIds(a);if(s.length>0)if(a.infos.nhits&&a.infos.nhits>a.results.length+l){var d=i._prepareRequestData({query:r,next_start:a.infos.next_start});n({idList:s,nextRequestData:d,numberOfHits:a.infos.nhits,currentCount:a.results.length+l})}else n({idList:s,nextRequestData:void 0,numberOfHits:a.infos.nhits,currentCount:a.results.length+l});else e.log("Search Response is Empty!!!"),o(t)},d.onFailure=function(e){o(e)},d.onTimeout=function(e){o(e)},a.federatedSearchRequest(d)}catch(t){e.log("Exception occured while fetching data"+t.message),o(t.message?t.message:"Exception Occured during fetch!!")}})},performExpand:function(t){var i=this;return new e.Promise(function(n,o){i._fetchCustomExtensionPredicates(t).then(function(s){try{var r=[];t.forEach(e=>{let t=new Promise((t,n)=>{var o=i._getExpandRequestDataObj(e);s&&(o.outputs.select_object=o.outputs.select_object.concat(s));var r=i._getBasicRequestObj();r.data=JSON.stringify(o),r.onComplete=function(e){t(e)},r.onFailure=function(e){n(e)},r.onTimeout=function(e){n(e)},a.federatedExpandRequest(r)});r.push(t)}),Promise.all(r).then(e=>{n(e)}).catch(e=>{o(e)})}catch(t){e.log("Exception occured while expand data request"+t.message),o(t.message?t.message:"Exception Occured during expand!!")}})})},_fetchCustomExtensionPredicates:function(){return"Variant"===this.parentType?new e.Promise(function(e){o.getPredicatesVariant().then(function(t){t?(u=t[1],e(t[0])):e()})}):"Variability Group"===this.parentType?new e.Promise(function(e){o.getPredicatesOptionGroup().then(function(t){t?(u=t[1],e(t[0])):e()})}):"Variant Parameter"===this.parentType?new e.Promise(function(e){o.getPredicatesVariantParameter().then(function(t){var i=["ds6wg:VP_POWER.MinValue","ds6wg:VP_POWER.Value","ds6wg:VP_POWER.MaxValue","ds6wg:VP_ANGLE.MinValue","ds6wg:VP_ANGLE.Value","ds6wg:VP_ANGLE.MaxValue","ds6wg:VP_VOLTAGE.MinValue","ds6wg:VP_VOLTAGE.Value","ds6wg:VP_VOLTAGE.MaxValue","ds6wg:VP_MASS.MinValue","ds6wg:VP_MASS.Value","ds6wg:VP_MASS.MaxValue","ds6wg:VP_FREQUENCY.MinValue","ds6wg:VP_FREQUENCY.Value","ds6wg:VP_FREQUENCY.MaxValue","ds6wg:VP_AREA.MinValue","ds6wg:VP_AREA.Value","ds6wg:VP_AREA.MaxValue","ds6wg:VP_LENGTH.MinValue","ds6wg:VP_LENGTH.Value","ds6wg:VP_LENGTH.MaxValue","ds6wg:VP_MOMENT.MinValue","ds6wg:VP_MOMENT.Value","ds6wg:VP_MOMENT.MaxValue","ds6wg:VP_SPEED.MinValue","ds6wg:VP_SPEED.Value","ds6wg:VP_SPEED.MaxValue","ds6wg:VP_PRESSURE.MinValue","ds6wg:VP_PRESSURE.Value","ds6wg:VP_PRESSURE.MaxValue","ds6wg:VP_TIME.MinValue","ds6wg:VP_TIME.Value","ds6wg:VP_TIME.MaxValue","ds6wg:VP_FORCE.MinValue","ds6wg:VP_FORCE.Value","ds6wg:VP_FORCE.MaxValue","ds6wg:VP_Integer.MinValue","ds6wg:VP_Integer.Value","ds6wg:VP_Integer.MaxValue","ds6wg:VP_VOLUME.MinValue","ds6wg:VP_VOLUME.Value","ds6wg:VP_VOLUME.MaxValue","ds6wg:VP_ENERGY.MinValue","ds6wg:VP_ENERGY.Value","ds6wg:VP_ENERGY.MaxValue","ds6wg:VP_COURANT.MinValue","ds6wg:VP_COURANT.Value","ds6wg:VP_COURANT.MaxValue","ds6wg:VP_Real.MinValue","ds6wg:VP_Real.Value","ds6wg:VP_Real.MaxValue"];t?(u=t[1],e(t[0].filter(e=>-1===i.indexOf(e)))):e()})}):void 0},_parseResponse_toGetIds:function(e){var t=[];if(e){var i=e.results,n=[],a=e=>{let i=n.findIndex(t=>t===e);return i>=0?i:(n.push(e),t.push([]),n.length-1)};if(i&&i.length>0)for(var o=0,s=i.length;o<s;o++)if(i[o]&&i[o].attributes){for(var r=i[o].attributes,l="",d="",c=0,p=r.length;c<p;c++)if("physicalid"===r[c].name)d=r[c].value;else if("ds6w:where/ds6w:context/ds6w:project"===r[c].name)l=r[c].value;else if(""!==l&&""!==d)break;let e=a(l);t[e].push(d)}}return t},_getUpdatedDataItemDefaultCase:function(e,t){if(u.hasOwnProperty(e.name)&&window.widget)if("OnPremise"!==window.widget.getValue("x3dPlatformId")){var i=u[e.name].split("__")[0];t.hasOwnProperty(i)?t[i]=t[i].concat(","+e.value):t[i]=e.value}else t.hasOwnProperty(u[e.name])?t[u[e.name]]=t[u[e.name]].concat(","+e.value):t[u[e.name]]=e.value;return t},_getUpdatedDataItemCreatedCase:function(e,t){try{if(e.value){var i=new Date(e.value);"ds6w:modified"===e.name||"ds6w:when/ds6w:modified"===e.name?t.modified=i:"ds6w:created"!==e.name&&"ds6w:when/ds6w:created"!==e.name||(t.created=i)}}catch(i){"ds6w:modified"===e.name||"ds6w:when/ds6w:modified"===e.name?t.modified=e.value?e.value:"":"ds6w:created"!==e.name&&"ds6w:when/ds6w:created"!==e.name||(t.created=e.value?e.value:"")}return t},_getUpdatedDidValueAndDataItem:function(e,t,i){var n=l.getStateValue();switch(e.name){case"did":t=e.value;break;case"ds6w:identifier":i.name=e.value;break;case"ds6w:label":i.title=e.dispValue?e.dispValue:e.value;break;case"ds6w:description":i.description=e.value;break;case"physicalid":case"resourceid":i.id=e.value,t||(t=e.value);break;case"ds6w:type":case"ds6w:what/ds6w:type":var a=i.type=e.value;i.nlsValues.nlsType=p[a]?p[a]:a;break;case"ds6w:when/ds6w:modified":case"ds6w:when/ds6w:created":case"ds6w:modified":case"ds6w:created":i=this._getUpdatedDataItemCreatedCase(e,i);break;case"ds6wg:revision":i.revision=e.value;break;case"ds6w:what/ds6w:status":case"ds6w:status":var o=e.value.replace(/ /g,"_");i.nlsValues.nlsState=n["ds6w:status"][o]?n["ds6w:status"][o]:o,i.state=o.slice(o.indexOf(".")+1);break;case"ds6w:who/ds6w:responsible":case"ds6w:responsible":i.owner=e.value;break;case"ds6w:who/ds6w:responsible/ds6w:organizationResponsible":case"organization":l.fetchOrganzationNLS(e.value),i.organization=e.value;break;case"ds6w:where/ds6w:context/ds6w:project":case"project":i.collabspace=e.value;break;case"BASE_PRICE":i.basePrice=e.value;break;case"preview_url":i.image=e.value;break;case"MinValue":i.minValue=e.value;break;case"MaxValue":i.maxValue=e.value;break;case"Dimension":i.dimension=e.value.substring(3);break;default:i=this._getUpdatedDataItemDefaultCase(e,i)}return{dataItem:i,didValue:t}},_parseExpandResponse:function(t){var i=[],n=this,a={},o={};if(t){var s=[];if(t.forEach(t=>{let i=JSON.parse(t);if(e.is(i.errors,"array")){let e=new Error("Expand Failed",i.errors);throw e.errors=i.errors,e}s=s.concat(i.results)}),s&&s.length>0){for(var r=0,l=s.length;r<l;r++)if(s[r]&&s[r].Path){var d=s[r].Path;if(d.length>0){var c=d[0];if(c&&void 0===o[c]&&(o[c]=[]),d[2]){var p=d[2];o[c].push(p)}}}else if(s[r]){var u=[];for(var h in s[r])s[r].hasOwnProperty(h)&&u.push({name:h,value:s[r][h]});for(var m=void 0,_={nlsValues:{}},v=0,f=u.length;v<f;v++){var g=this._getUpdatedDidValueAndDataItem(u[v],m,_);m=g.didValue,void 0===(_=g.dataItem).description&&(_.description="")}m&&(a[m]=_)}for(var b in o)if(b&&a[b]){var E=a[b];E[n.childKey]={member:[]};var C=o[b];C&&C.length>0&&C.forEach(function(e){e&&a[e]&&E[n.childKey].member.push(a[e])}),i.push(E)}}}return i},_getBasicRequestObj:function(){return void 0===this._basicReqObj&&(this._basicReqObj={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}),e.clone(this._basicReqObj)},_getExpandRequestDataObj:function(e){var t={outputs:{select_object:this.expandPredicates,format:"entity_relation_occurrence"}},i=e.map(e=>({label:"expandFor"+e,root:{physical_id:e},graph:{descending_condition_object:{uql:"(taxonomies:Variability Option) OR (taxonomies:*Variant Value*)"}},filter:{all:1}}));return t.batch={expands:i},t},_setItemsToGetInARequest:function(e){e>0&&(this._noOfItemsToRetrieve=e)},destroy:function(){e.log("SearchAndExpandManager: Cleanup!"),this._myEventManager&&(this._myEventManager.cleanup("SearchAndExpandManager"),this._myEventManager=null)}})}),define("DS/ENOXModelApp/RuleDefinition/RuleDetailsStatePresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","DS/xPflRouter5/xPflRouter","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/ENOXIDCardContainer/js/ENOXIDCardContainer","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/CfgSolver/CfgSolverServices","DS/ENOXModelApp/RuleDefinition/RulePresenter","DS/ENOXModelApp/Utils/xModelIDCardAttributeEditor","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/xModelEventManager/xModelEventManager","DS/Utilities/Dom","DS/CfgSolver/CfgSolverDebug","DS/ENOXModelApp/components/DialogCreation/WarningDialog","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","i18n!DS/ENOXModelApp/assets/nls/RuleDefinition/RulePresenter","i18n!DS/ENOXModelApp/assets/nls/components/DialogCreation/DialogCreationSaveRule","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/LocalRulesPresenter","css!DS/ENOXModelApp/RuleDefinition/RuleDetailsStatePresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A){"use strict";var P=function(){};return P.prototype.init=function(e,t,n,a){this._options=a||{},this._ruleId=e.ruleId,this._solverKey=a.solverKey?a.solverKey:null,this._context=e,this._contextDictionary=a.contextDictionary?a.contextDictionary:null,this._variabilityDictionary=a.dictionary,this._privateChannel=t,this._applicationChannel=n,this._subscribedEventTokens=[],this._isEditable=!e||!e.editable||"boolean"!=typeof e.editable||e.editable,this._ruleName=null,this._modelId=e.modelId,this._pathRulesDetail=[_._KEY,_._VIEWS_PREFERENCES,_._RULES_DETAILS],this._privateRuleEvents=new i,this._myEventManager=new f(this._applicationChannel,this._privateChannel,this._privateRuleEvents),this._warningDialogOnShow=!1,this._enoxIDCardContainer=new s,this._idCardAttrbEditorUtil=new c,this._idCardAttrbEditorUtil.init(this._privateRuleEvents),this._rulePresenter=new d,this._subscribeToEvents(),this._initDivs(),this._initCommand(),window.sessionStorage["solver-activate-traces"]&&(this._CfgSolverDebug=new b,this._CfgSolverDebug.init2("rule-details",this._solverKey),this._CfgSolverDebug.injectIn(this._container))},P.prototype._initCommand=function(){this._command=new u(this._privateRuleEvents,this._container,this._applicationChannel)},P.prototype.clear=function(){if(this._container&&(this._container.innerHTML=""),this._privateChannel)for(var t=e.clone(this._subscribedEventTokens),i=0;i<t.length;i++)this._privateChannel.unsubscribe(t[i])},P.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"remove",single:A._ruleSingle,multiple:A._ruleMultiple,modelEvent:t,immersiveFrame:y.getImmersiveFrame()};C.showDialog(i)},P.prototype.deleteRule=function(t,i){var n=this;o.deleteRuleVersions({ids:i,modelId:t}).then(function(){if(e.log("Product Rule/s deleted successfully."),n._options.modelVersionId){var t={modelVersionId:n._options.modelVersionId,id:n._options.modelVersionId,name:n._options.modelVersionName,version:n._options.modelVersionVersion,refreshPCList:!0};a.navigate(h.ROUTE_MODEL_DETAILS,t,{replace:!0}),n._applicationChannel.publish({event:"breadcrumb-remove-link",data:h.ROUTE_MODEL_RULE_DETAILS}),n._applicationChannel.publish({event:"enox-model-app-item-removed",data:i})}},function(){e.log("rule deletion failed"),m.showError(M.ERROR_DELETE_RULE)})},P.prototype.fetchData=function(){var i=this;t.mask(this._container),o.getRuleDetails({id:i._ruleId}).then(function(n){if(e.is(n,"string")&&(n=o.parseStringData(n)),e.log("getRuleDetails: Service Call Successful !!!"),i._isDestroyed)return e.log("rule details destroyed before being loaded"),void t.unmask(i._container);i._loadData(n),t.unmask(i._container)},function(){e.log("getRuleDetails: Service Call Failed !!!"),t.unmask(i._container),m.showError(M.GET_RULE_DETAILS_ERROR)}),t.unmask(this._container)},P.prototype._loadData=function(e){t.mask(this._container),this._modelForIdCard=p.prepareIdCardData(e,this._privateRuleEvents,{commands:{remove:!0}}),this._makeOwnerAttributeReadonly(),this._idCardAttrbEditorUtil.setModelAndInitCollabObj(this._modelForIdCard),this._enoxIDCardContainer.init({modelEvents:this._privateRuleEvents},this._modelForIdCard),this._enoxIDCardContainer.inject(this._container),this._enoxIDCardContainer.getMainContent().appendChild(this._ruleContent),v.getCollapse(this._pathRulesDetail)&&this._privateRuleEvents.publish({event:"idcard-toggle-minified-view"}),t.mask(this._ruleContent);let i=v.userID;var n={solverKey:this._solverKey,contextDictionary:this._variabilityDictionary,dictionary:this._variabilityDictionary,privateChannelForRules:this._privateChannel,editable:this._isEditable&&("FALSE"===e.member[0].reserved||"TRUE"===e.member[0].reserved&&i===e.member[0].reservedby),previewMode:!(this._isEditable&&("FALSE"===e.member[0].reserved||"TRUE"===e.member[0].reserved&&i===e.member[0].reservedby)),reservedbyFullName:e.member[0].reservedbyFullName},a={ruleId:this._ruleId,modelId:this._modelId,ruleName:this._ruleName};this._rulePresenter.init(a,this._privateRuleEvents,this._applicationChannel,this._ruleId,n),this._rulePresenter.inject(this._ruleContent),t.unmask(this._container),t.unmask(this._ruleContent)},P.prototype.updateView=function(){var i=this;i._container&&(t.mask(e.extendElement(i._container)),l.setRuleActivation(this._ruleId,"false",this._solverKey).then(function(){i._privateRuleEvents.publish({event:"mr-reload-table"}),t.unmask(i._container)}))},P.prototype.unmaskRuleContent=function(){this._ruleContent&&t.unmask(this._ruleContent)},P.prototype.maskRuleContent=function(e){if(!t.isMasked(this._ruleContent)&&(t.mask(this._ruleContent),e)){var i=this._ruleContent.querySelector(".mask");i.innerText=e,i.style.textAlign="center",i.style.lineHeight=this._ruleContent.offsetHeight+"px",i.style.verticalAlign="middle"}},P.prototype._initDivs=function(){this._container=e.createElement("div"),this._container=e.createElement("div"),this._container.classList.add("rule-idcard-content"),this._ruleContent=e.createElement("div"),this._ruleContent.classList.add("rule-definition-content")},P.prototype.inject=function(e){e.appendChild(this._container);var t=this;g.addResizeListener(this._container,function(){t._resize()})},P.prototype._resize=function(){this._container.offsetWidth&&(0!==this._container.offsetWidth&&this._container.offsetWidth<h.MOBILE_BREAKPOINT?(this._enoxIDCardContainer._idCardContainer.classList.add("rule-idCard-hide"),this._enoxIDCardContainer._contentContainer.classList.add("rule-idCard-height-hide")):window.widget.body.offsetWidth<h.MOBILE_BREAKPOINT?(this._enoxIDCardContainer._idCardContainer.classList.add("rule-idCard-hide"),this._enoxIDCardContainer._contentContainer.classList.add("rule-idCard-height-hide")):(this._enoxIDCardContainer._idCardContainer&&this._enoxIDCardContainer._idCardContainer.classList.remove("rule-idCard-hide"),this._enoxIDCardContainer._contentContainer&&this._enoxIDCardContainer._contentContainer.classList.remove("rule-idCard-height-hide")))},P.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._privateRuleEvents,{event:"mr-onsavedone"},function(t){e._privateChannel.publish({event:"mr-onsavedone",data:t})}),this._myEventManager.subscribe(this._privateRuleEvents,{event:"expr-rule-onsavedone"},function(t){e._privateChannel.publish({event:"mr-onsavedone",data:t})}),this._myEventManager.subscribe(this._privateRuleEvents,{event:"local-rule-deleted"},function(t){e._privateChannel.publish({event:"local-rule-deleted",data:t})}),this._myEventManager.subscribe(this._privateRuleEvents,{event:"idcard-model-refresh"},function(t){e._privateChannel.publish({event:"mr-onsavedone",data:t}),e._refreshIdCardModel()}),this._myEventManager.subscribe(this._privateRuleEvents,{event:"idcard-dropdown-menu-action"},function(t){e.actionDropDownMenuIdCard(t)}),this._myEventManager.subscribe(this._privateRuleEvents,{event:"idcard-container-minified"},function(){v.updateCollapse(e._pathRulesDetail,!0)}),this._myEventManager.subscribe(this._privateRuleEvents,{event:"idcard-container-maximized"},function(){v.updateCollapse(e._pathRulesDetail,!1)}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-create"},function(t){e.createWarningDialog(t)}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-on-show"},function(){e._warningDialogOnShow=!0}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-on-hide"},function(){e._warningDialogOnShow=!1}),this._myEventManager.subscribe(this._applicationChannel,{event:"browser-back-button-clicked"},function(t){"function"==typeof a.canNavigate&&(a.canNavigate()||e._warningDialogOnShow||(t.state.isBackClicked=!0,e._applicationChannel.publish({event:"warning-dialog-create",data:t.state})))}),this._myEventManager.subscribe(this._privateRuleEvents,{event:"enox-dialog-delete"},function(t){Array.isArray(t)&&e.deleteRule(e._modelId,t)})},P.prototype.createWarningDialog=function(e){var t={title:I._modal_title,type:"new",modelEvent:this._applicationChannel,content:I._modal_message};E.dialogCreation(t,e)},P.prototype.actionDropDownMenuIdCard=function(e){switch(e){case"information":r.removeAllSelection(),r.showInformation(this._id);break;case"delete":var t;switch(this._rulePresenter._ruleType){case"Matrix":t=D.TYPE_MATRIX_RULE;break;case"Boolean":t=D.TYPE_EXPRESSION_RULE}if(S.checkActionAccess({action:D.REMOVE,type:t,notify:!0})){var i=[{id:this._ruleId,title:this._options.name}];this.createDeleteModelDialog(i,this._privateRuleEvents)}break;case"state":this._privateRuleEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"state"}});break;case"revision":this._privateRuleEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"revision"}})}},P.prototype._refreshIdCardModel=function(){var t=this;o.getRuleDetails({id:t._ruleId}).then(function(i){e.is(i,"string")&&(i=o.parseStringData(i));var n=p.prepareIdCardData(i,t._privateRuleEvents,{commands:{remove:!0}});t._makeOwnerAttributeReadonly(n),t._modelForIdCard.set("attributes",n.get("attributes")),t._modelForIdCard.set("name",n.get("name")),t._modelForIdCard.set("freezones",n.get("freezones"))},function(){e.log("getRuleDetails: Service Call Failed !!!"),m.showError(M.GET_RULE_DETAILS_ERROR)})},P.prototype.destroy=function(){this._rulePresenter&&this._rulePresenter.clear(),this._container=null,this._myEventManager&&(this._myEventManager.cleanup("RuleDetailsStatePresenter"),this._myEventManager=null)},P.prototype._makeOwnerAttributeReadonly=function(e){for(var t=void 0!==e?e.get("attributes"):this._modelForIdCard.get("attributes"),i=0;i<t.length;i++){var n=t[i];if(n&&"OWNER"===n.command){delete n.type,n.editable=!1,this._modelForIdCard.set("attributes",t);break}}var a=void 0!==e?e.get("dropdown"):this._modelForIdCard.get("dropdown"),o=a&&a.items?a.items:void 0;if(o){for(var s,r=0;r<o.length;r++){var l=o[r];if(l&&l.id&&"owner"===l.id.toLowerCase()){s=r;break}}void 0!==s&&a.items.splice(s,2)}},P}),define("DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromDataManager",["UWA/Core","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/PlatformAPI/PlatformAPI","DS/WebappsUtils/WebappsUtils","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/components/ProgressPanel/ProgressPanel","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromConstants","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelCopyFrom","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/PCListPresenter"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m){"use strict";var _=function(e,t){u.consoleLogger("ModelCopyFromDataMgr : "+e,t)},v=function(){},f=100,g=3,b=5,E=4,C={variant:"createVariantClassVariabilityInstances",value:"createVariantVariabilityInstances",optionGroup:"createOptionGroupVariabilityInstances",option:"createOptionVariabilityInstances",parameter:"createParameterVariabilityInstances"};return v.prototype.init=function(n){e.extend(this,n),this.updateChannel=n.modelEvent?n.modelEvent:new t,this._applicationChannel=n.applicationChannel,this._myEventManager=new i(this.updateChannel),this._subscribeEvents(),this._launchedFrom=n.launchedFrom},v.prototype._defineChunkAndRequestSizes=function(e){f=e.variability_chunk,b=e.rule_chunk,g=e.pc_chunk,E=e.request_poolsize},v.prototype._modelVersionSelected=function(t){let i=this;if(e.is(t,"array")&&t.length>0){var n=t[0];n.getChildren&&(n=n.options.grid);var a=void 0!==n["ds6w:status_value"]?n["ds6w:status_value"]:"",o=a.indexOf(".");i._sourceMv={id:n.id,title:n["ds6w:label"],name:n["ds6w:identifier"],state:a&&o>-1?a.slice(o+1):"",revision:n["ds6wg:revision"],samefamily:i.modelName===n["ds6w:identifier"]},i.updateChannel.publish({event:u.EVT_SOURCE_MV_AVAILABLE,data:i._sourceMv}),i._mvPresent||(i._mvPresent=!0,i._fetchSourceMvVariability(),i._handleConfigurationsLoading())}else i.updateChannel.publish({event:u.EVT_NO_SOURCE_MV_AVAILABLE}),i._mvPresent=!1},v.prototype._subscribeEvents=function(){var t=this;this._myEventManager.subscribe(this.updateChannel,{event:"xmodel-list-fetch-connected-objects"},function(e){e&&e.model?e=[e.model]:e&&""==e.model&&(e=[]),t.updateChannel.publish({event:"model-copy-from-model-version-selected",data:e})}),this._myEventManager.subscribe(this.updateChannel,{event:u.EVT_SOURCE_MV_AVAILABLE},function(e){t.samefamily=e.samefamily}),this._myEventManager.subscribe(this.updateChannel,{event:u.EVT_FETCH_ANCESTOR},function(e){t._fetchAncestor(e).then(function(e){let i=JSON.parse(e),n=[];i.results&&Array.isArray(i.results)&&i.results.forEach(e=>{let t={};e.attributes.forEach(e=>{let i=e.name.split("/"),n=i[i.length-1];t[n]=e.value}),n.push(t)}),t.updateChannel.publish({event:u.EVT_UPDATE_ANCESTOR,data:n})},function(){console.log("Previous Revision not indexed yet")})}),this._myEventManager.subscribe(this.updateChannel,{event:"model-copy-from-model-version-selected"},function(e){t._modelVersionSelected(e)}),this._myEventManager.subscribe(this.updateChannel,{event:u.EVT_TARGET_MV_DICO_LOADED},function(i){_("TargetMV dictionary available!!!"),t._targetMvDico=e.clone(i.dictionaryForRule),t._targetMVRules=e.clone(i.rulesList),t._formatDictionaryData(),t._formatRuleData()}),this._myEventManager.subscribe(this.updateChannel,{event:u.EVT_PERFORM_DATA_ACTION},function(e){let i=t._sourceMv.title,n=t._processVariabilityAllocation_v1(e),a={promise:n,mvTitle:i,processTitle:h.VARIABILITY},o={promise:t._processRulesAllocation_v1(e),mvTitle:i,processTitle:h.RULES},s={promise:t._processConfigurationsCloning_v1(n,e),mvTitle:i,processTitle:h.CONFIGURATIONS},r=[];switch(t._launchedFrom){case"variability":r.push(a);break;case"rules":r.push(o);break;case"configurations":r.push(s);break;default:e.items.variability.length>0&&r.push(a),e.items.rules.length>0&&r.push(o),e.items.configurations.length>0&&r.push(s)}let l=new d,c={progressHeading:h.MV_COPY_FROM_DIALOG_TITLE_ADD_EXISTING,itemTitle:i,processes:r};l.init(c),t._processes=r,t._allProcessResolved()})},v.prototype._fetchAncestor=function(t){let i=`physicalid:("${t}")`;var n={label:"x_mdl_app_"+s.getUser().login+"autocomplete"+Date.now(),with_indexing_date:!0,with_synthesis:!1,with_nls:!1,locale:window.widget&&window.widget.lang?window.widget.lang:"en",select_predicate:["physicalid","id","owner","ds6w:identifier","ds6w:label","ds6w:type","ds6w:responsible","ds6w:state","ds6wg:revision"],source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",query:i,login:{"3dspace":{SecurityContext:l.getSecurityContext()}}};return new e.Promise(function(t,i){try{var a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};a.data=JSON.stringify(n),a.onComplete=function(e){t(e)},a.onFailure=function(e){i(e)},a.onTimeout=function(e){i(e)},l.federatedSearchRequest(a)}catch(t){e.log("Exception occured while fetching data"+t.message),i(t.message?t.message:"Exception Occured during fetch!!")}})},v.prototype._fetchSourceMvVariability=function(){var t=this;"idcard"!=t._launchedFrom&&"configurations"==t._launchedFrom||(this.updateChannel.publish({event:u.EVT_MASK_CONTAINER,data:{message:h.MSG_LOADING_SOURCE_VARIABILITY,tab:"variability"}}),this.updateChannel.publish({event:u.EVT_MASK_CONTAINER,data:{message:h.MSG_LOADING_SOURCE_VARIABILITY,tab:"rules"}}),a.getVariabilityDefinition({componentId:t._sourceMv.id,content:{attributes:1,rules:!0,parameters:!0,attributeList:["_image"]}}).then(function(i){_("Successful in loading Source MV Dictionary"),t.updateChannel.publish({event:u.EVT_UNMASK_CONTAINER,data:{tab:"variability"}}),t.updateChannel.publish({event:u.EVT_UNMASK_CONTAINER,data:{tab:"rules"}}),t._sourceDico=e.clone(i),t._filterSourceDico(t._sourceDico),t.updateChannel.publish({event:u.EVT_SOURCE_MV_DICO_LOADED,data:"variability"})},function(){_("Error in loading Source MV Dictionary",!0),t.updateChannel.publish({event:u.EVT_UNMASK_CONTAINER,data:{tab:"variability"}}),t.updateChannel.publish({event:u.EVT_UNMASK_CONTAINER,data:{tab:"rules"}}),t.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"error",message:h.MSG_ERR_LOADING_SOURCE_DICO,closeDialog:!0}})}))},v.prototype._formatDictionaryData=function(){try{this._targetIdRefInstanceMap={},this._targetIdRefChildRefMap={};var e=this.getDictionaryItems("$..variants.member");this._createMapsFromItemsList(e);var t=this.getDictionaryItems("$..variabilityGroups.member");this._createMapsFromItemsList(t);var i=this.getDictionaryItems("$..parameters.member");this._createMapsFromItemsList(i)}catch(e){_("Exception occured while formating data",!0)}},v.prototype._formatRuleData=function(){try{var e=this.getRulesItems("$..member");this._createMapsFromItemsList(e)}catch(e){_("Exception occured while formating rules data",!0)}},v.prototype._filterSourceDico=function(){try{var t=this,i=function(e,i,n,a){for(var o=0;o<e.length;o++){var s=e[o];if(s.kind&&"reference"===s.kind)e.splice(o,1),o--;else if(s.attributes&&s.attributes._maturity&&"Obsolete"===s.attributes._maturity&&(e.splice(o,1),o--),s.hasOwnProperty(a)){for(var r=s[a]&&s[a].member?s[a].member:[],l=0;l<r.length;l++){var d=r[l],c=d.idref?d.idref:d.id?d.id:"",p=d.kind&&"reference"===d.kind,u=c&&t._targetIdRefChildRefMap.hasOwnProperty(c);p||u?(r.splice(l,1),l--):(d.attributes._isA=n,t._formatAttributes(d))}if(r.length<=0)e.splice(o,1),o--;else{var h=s.idref?s.idref:s.id?s.id:"",m=h&&t._targetIdRefChildRefMap.hasOwnProperty(h);s.attributes._isInSource=m,s.attributes._isA=i,t._formatAttributes(s)}}else{var _=s.idref?s.idref:s.id?s.id:"";_&&t._targetIdRefChildRefMap.hasOwnProperty(_)?(e.splice(o,1),o--):(s.attributes._isA=i,t._formatAttributes(s))}}},n=[],a=[];this._filteredSourceDico=e.clone(this._sourceDico);var o=e.Json.path(this._filteredSourceDico,"$..portfolioComponents.member");(o=o&&o[0]?o[0]:[]).forEach(function(e){if(e)for(var t in e){var o,s,r;if(e.hasOwnProperty(t))if(e[t].member&&e[t].member.length>0){switch(t){case"variants":o="variant",s="value",r="values";break;case"variabilityGroups":o="optionsGroup",s="option",r="options";break;case"parameters":o="parameter",s="",r="NO_CHILD";break;case"rules":o="rule",s="",r="NO_CHILD"}switch(i(e[t].member,o,s,r),t){case"variants":case"variabilityGroups":case"parameters":n=n.concat(e[t].member);break;case"rules":a=a.concat(e[t].member)}}}});let s=r.getWebappsAssetUrl("ENOXModelApp","icon/rules.png");a.forEach(e=>{e.image=s,e.attributes._image=e.image}),this._combinedRules=a,this._combinedVariability=n,this._loadDataIntoListView("variability"),this._loadDataIntoListView("rules")}catch(e){_("Exception occured while filtering source dictionary."+e,!0)}},v.prototype._filterSourceProductConfigurations=function(){var e=this;return new Promise(function(t,i){n.getConfigurationVersions({parentID:this.mvId}).then(function(){t()},function(){o.showError(m.ERROR_GET_PCs),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),i(new Error("getConfigurationVersions fail"))})})},v.prototype._loadDataIntoListView=function(e){var t=!1;if(e){var i;switch(e){case"variability":h.MSG_NO_VARIABILITY_OR_ALL_ALLOCATED,i=this._combinedVariability,this.updateChannel.publish({event:u.EVT_HIDE_REVISIONS_COLUMN});break;case"rules":h.MSG_NO_RULES_OR_ALL_ALLOCATED,i=this._combinedRules,this.updateChannel.publish({event:u.EVT_HIDE_REVISIONS_COLUMN})}i&&i.length>0?(this.updateChannel.publish({event:u.EVT_LOAD_SOURCE_MV_DATA,data:{member:i,typeOfData:e}}),t=!0):this.updateChannel.publish({event:u.EVT_NO_DATA_TO_LOAD,data:e})}return t},v.prototype._formatAttributes=function(e){if(e&&e.attributes)for(var t in e.attributes)if(e.attributes.hasOwnProperty(t)){var i=t.indexOf("_");0===i&&(e[t.slice(i+1)]=e.attributes[t])}},v.prototype._createMapsFromItemsList=function(e){var t=this;e.forEach(function(e){if(e){var i=void 0!==e.idref?e.idref:e.id?e.id:void 0;if(i&&"reference"!==e.kind){t._targetIdRefChildRefMap[i]=[],t._targetIdRefInstanceMap[i]=e.id;var n=e.values&&e.values.member?e.values.member:e.options&&e.options.member?e.options.member:[];n.length>0&&n.forEach(function(e){("instance"===e.kind&&e.idref||void 0!==e.idref)&&(t._targetIdRefChildRefMap[e.idref]="",t._targetIdRefChildRefMap[i].push(e.idref))})}}})},v.prototype.getDictionaryItems=function(t){var i=e.Json.path(this._targetMvDico,t);return i?i[0]:[]},v.prototype.getRulesItems=function(t){var i=e.Json.path(this._targetMVRules,t);return i?i[0]:[]},v.prototype._handleConfigurationsLoading=function(){var e=this;("idcard"==e._launchedFrom||"rules"!=e._launchedFrom&&"variability"!=e._launchedFrom)&&(e.updateChannel.publish({event:u.EVT_MASK_CONTAINER,data:{message:h.MSG_LOADING_SOURCE_CONFIGURATIONS,tab:"configurations"}}),this._loadConfigurations().then(function(t){if(t.sourcePCs&&t.sourcePCs.length>0&&t.targetPCs&&t.targetPCs.length>0&&(t.sourcePCs=t.sourcePCs.filter(e=>!t.targetPCs.find(function(t){return t.name===e.name}))),t.sourceBCs&&t.sourceBCs.length>0&&t.targetBCs&&t.targetBCs.length>0&&(t.sourceBCs=t.sourceBCs.filter(e=>!t.targetBCs.find(function(t){return t.name===e.name}))),t.configs=[],t.sourcePCs.forEach(e=>{t.configs.push(e)}),t.sourceBCs.forEach(e=>{t.configs.push(e)}),t.configs&&t.configs.length>0&&e._mvPresent){let i=e._filterSourceConfigurationsForView(t.configs);e.updateChannel.publish({event:u.EVT_LOAD_SOURCE_MV_DATA,data:{member:i,typeOfData:"configurations"}}),e.updateChannel.publish({event:u.EVT_UNMASK_CONTAINER,data:{tab:"configurations"}})}else e.updateChannel.publish({event:u.EVT_NO_DATA_TO_LOAD,data:"configurations"}),e.updateChannel.publish({event:u.EVT_UNMASK_CONTAINER,data:{tab:"configurations"}})},function(){_("Error while loading Product configurations",!0),e.updateChannel.publish({event:u.EVT_UNMASK_CONTAINER,data:{tab:"configurations"}}),e.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"error",message:h.MSG_LOADING_CONFIGURATIONS_FAILED,closeDialog:!1}})}))},v.prototype._loadConfigurations=function(){var e=this;return new Promise(function(t,i){var a=n.getConfigurationVersions({parentID:e.mvId}),o=n.getConfigurationVersions({parentID:e._sourceMv.id}),s=n.getAllBaseConfiguration({parentID:e.mvId}),r=n.getAllBaseConfiguration({parentID:e._sourceMv.id});Promise.all([o,a,r,s]).then(function(i){var n=i[0],a=i[1],o=i[2],s=i[3];e._targetBCList=e._getMembersFromtype(s,"baseConfigurations"),e._sourceBCList=e._getMembersFromtype(o,"baseConfigurations"),n=e._getMembersFromtype(n,"productConfigurations"),a=e._getMembersFromtype(a,"productConfigurations"),t({sourcePCs:n,targetPCs:a,sourceBCs:e._sourceBCList,targetBCs:e._targetBCList})}).catch(()=>{_("Error! While fetching product configurations!",!0),i(h.MSG_LOADING_CONFIGURATIONS_FAILED)})})},v.prototype._getMembersFromtype=function(e,t){return e=e.member&&e.member[0].hasOwnProperty(t)&&e.member[0][t].member.length>0?e.member[0][t].member:[]},v.prototype._filterSourceConfigurationsForView=function(e){let t=this;t.baseConfigurations={},t.productConfigurations={},t.configNodes=[],e.forEach(e=>{"Product Configuration"==e.type?(Object.keys(t.productConfigurations).includes(e.name)||(t.productConfigurations[e.name]=[]),t.productConfigurations[e.name].push(e)):"Model Type"==e.type&&(Object.keys(t.baseConfigurations).includes(e.name)||(t.baseConfigurations[e.name]=[]),t.baseConfigurations[e.name].push(e))});let i=[],n=t._getRevisedNodes(t.baseConfigurations);return t._getRevisedNodes(t.productConfigurations).forEach(e=>{if(!!e.hasOwnProperty("baseConfigurationId")){let t=!1;n.forEach(i=>{i.totalRevisions.forEach(n=>{n.id==e.baseConfigurationId&&(i.prodCs.member.push(e),t=!0)})}),t||i.push(e)}else i.push(e)}),t.samefamily&&n.forEach(e=>{i.push(e)}),i.reverse(),i},v.prototype._getRevisedNodes=function(t){let i=[];return Object.keys(t).forEach(n=>{let a=0,o=[],s=[],r=0,l=[];t[n].forEach((t,i)=>{let n=new Date(t.created).getTime();s.push(t.revision),l.push(e.clone(t,!0)),n>a&&(a=n,(o=[]).push(t),r=i)}),o[0].possibleRevisions=s,o[0].totalRevisions=l,o[0].prodCs={},o[0].prodCs.member=[],i.push(o[0])}),i},v.prototype._requestManagerNew=function(t,i,n,a,o){var s=this,r=o||"request-scheduler-start-next-lot_"+(new Date).getTime();return new e.Promise(function(e){try{var o,l=[],d=0;_("Input : Promises List length : "+t.length),_("Input: PoolSize: "+i);var c=-1,p=function(i){if(_("Current index: "+c),t.length<=c+1)_("Request Scheduler has either received empty list or it has finished with provided promises.");else{for(var p=[],u=0;u<i;u++){if(c++,t.length<=c){_("Breaking : Current index: "+c);break}_("Current index: "+c+" pushing promise in working array.");var h=s._getPromiseFromCall(n,t[c]);l.push(h),p.push(h)}_(">>>>>>>> inwork length: "+p.length),p.forEach(function(i){i?i.then(function(i){if(_(">>>> Resolved :  >>> "+new Date),d++,s._checkCurrentMV(a)){let e="variability";switch(n){case"createVariantAndValueInstances":case"createOptionGroupAndOptionInstances":case"allocateValues":case"allocateOptions":case"createVariantClassVariabilityInstances":case"createVariantVariabilityInstances":case"createOptionGroupVariabilityInstances":case"createOptionVariabilityInstances":case"createParameterVariabilityInstances":e="variability";break;case"addExistingRuleFromModelVersion":e="rules";break;case"cloneProductConfigurations":case"cloneBaseConfiguration":e="configurations"}s._applicationChannel.publish({event:"xmodel-app-update-list-view",data:{tab:e,response:i}})}if(d===t.length)return _("Returning resolve after finishing with promise list!!!"),s.updateChannel.unsubscribe(o),e(l);s.updateChannel.publish({event:r,data:{lotSize:1}})},function(){if(_(">>>> Rejected :  >>> "+new Date),++d===t.length)return _("Returning resolve after finishing with promise list!!!"),s.updateChannel.unsubscribe(o),e(l);s.updateChannel.publish({event:r,data:{lotSize:1}})}):_("Promise now is undefined???")})}};o=s.updateChannel.subscribe({event:r},function(e){e&&e.lotSize>0&&p(e.lotSize)}),p(i)}catch(e){_("Exception occured : "+e.message+" excp obj: "+e)}})},v.prototype._processVariabilityAllocation_v1=function(t){var i,n=this;_("_processVariabilityAllocation"),t&&t.items&&t.items.variability.length>0&&(i=this._prepareSelectedItemsForVariability(t.items.variability));var o=[],s=[];let r=p.getRouteInfo();return new e.Promise(function(l,d){let m=!1;var v=n.updateChannel.subscribe({event:"evt-verify-copy-variability-op"},function(){_("To Promises Count: "+s.length),e.Promise.allSettled(s).then(function(i){if(_("Parent Promises: All settled!!!"+i),_("Unsubscribing tokens: "+o.length),o.forEach(function(e){n.updateChannel.unsubscribe(e)}),i&&i.length>0){var s=n._countResolvedPromises(i);let o=n._checkCurrentMV(r);if(m&&o){let t=[c._KEY,c._VIEWS_PREFERENCES,c._MODEL_VERSIONS_DETAILS,c._VARIABILITY];var v=p.getCustomAttributeStatus(t);a.getVariabilityDefinition({componentId:r.params.modelVersionId,content:{customerAttributes:v,attributeList:["_image"],parameters:!0,attributes:1,features:!0,rules:!1,variantClasses:!1,options:!1}}).then(function(t){let i=e.Json.path(t,"$...portfolioComponents.member[0]");Array.isArray(i)&&i.length>0&&i[0].parameters&&i[0].parameters.member.length>0&&n._applicationChannel.publish({event:"xmodel-app-update-list-view",data:{tab:"variability",response:i[0]}})})}s&&s.noOfOK===s.total?(_("Variabilty Copy is successful!"),n.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"success",message:h.MSG_VARIABLITY_COPY_SUCCESS,closeDialog:t.closeOnDone}}),l()):(_("Variabilty Copy failed!",!0),n.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"error",message:h.MSG_VARIABLITY_COPY_FAILED,closeDialog:!0}}),d())}else l()})});o.push(v);var g=n.updateChannel.subscribe({event:"evt-process-parameter-allocation"},function(){if(i&&i.parameters&&i.parameters.length>0){m=!0;var e=n._createParameterInstances(i.parameters,"parameter");s=s.concat(e),n.updateChannel.publish({event:"evt-verify-copy-variability-op",data:{}})}else n.updateChannel.publish({event:"evt-verify-copy-variability-op",data:{}})});o.push(g);var b=n.updateChannel.subscribe({event:"evt-process-option-group-allocation"},function(){if(i&&i.optionGroups.length>0){var t;t=n._preparePromisesListFromItems(i.optionGroups,"optionGroup",f),n._requestManagerNew(t,E,"allocateOptions",r).then(function(t){s=s.concat(t),e.Promise.allSettled(t).then(function(e){_("Option group and option instances creation allSettled"),n._countResolvedPromises(e),n.updateChannel.publish({event:"evt-process-parameter-allocation",data:{}})})},function(){_("Option group & options instances promises rejected!!"),d()})}else n.updateChannel.publish({event:"evt-process-parameter-allocation",data:{}})});if(o.push(b),i&&i.variants.length>0){var C;C=n._preparePromisesListFromItems(i.variants,"variant",f),n._requestManagerNew(C,E,"allocateValues",r).then(function(t){s=s.concat(t),e.Promise.allSettled(t).then(function(e){_("Variant and value instances creation allSettled"),n._countResolvedPromises(e),n.updateChannel.publish({event:"evt-process-option-group-allocation",data:{}})})},function(){_("Variant & Value instances promises rejected!!"),d()})}else n.updateChannel.publish({event:"evt-process-option-group-allocation",data:{}})})},v.prototype._checkCurrentMV=function(e){return p.getRouteInfo().params.modelVersionId==e.params.modelVersionId},v.prototype._createParameterInstances=function(t,i){var n=C[i];if(t.length>0&&i&&n){var o={items:[]};return t.forEach(e=>{o.items.push({parameter:{id:e.id}})}),a[n](o,this.mvId)}return e.Promise.resolve("Parameter list is empty!!")},v.prototype._processRulesAllocation_v1=function(t){var i=this,n=b,a=E;let o=p.getRouteInfo();return new e.Promise(function(s,r){if(t&&t.items&&t.items.rules.length>0){var l=t.items.rules,d=i._getSelectedItemsIds(l),c=i._getListDividedInChunks(d,n);i._requestManagerNew(c,a,"addExistingRuleFromModelVersion",o).then(function(n){_("Rules Request Manager: resolved"),e.Promise.allSettled(n).then(function(e){_("All Rules Request Promises: allSettled");for(var n=0,a="",o=0;o<e.length;o++){var d=e[o];if(d&&"fullfilled"===d.state)0;else if(d&&"rejected"===d.state){n++;var c=h.RULE+": "+l[o].options.label+" "+h.REASON+": ",p=d.reason&&d.reason.indexOf(":")>-1?d.reason:void 0;c+=p?p.slice(p.indexOf(":")+1):h.MSG_UNSPECIFIED_ERROR,_(c,!0),a+=l[o].options.label+" "}}if(n>0){var m=a.length>0?h.MSG_RULES_COPY_FAILED+":  "+a:h.MSG_RULES_COPY_FAILED;i.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"error",message:m,closeDialog:!0}}),r()}else i.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"success",message:h.MSG_RULES_COPY_SUCCESS,closeDialog:t.closeOnDone}}),s()})},function(){_("Error!!! Rule copy request manager promise is rejected"),r()})}})},v.prototype._processConfigurationsCloning_v1=function(t,i){var n=this;_("_processConfigurationsCloning");var a=g,o=E;let s=p.getRouteInfo();return new e.Promise(function(r,l){e.Promise.allSettled(t).then(function(){if(i&&i.items&&i.items.configurations.length>0){var e=n._getSelectedItemsIds(i.items.configurations,"Model Type"),t=n._getSelectedItemsIds(i.items.configurations,"Product Configuration"),d=n._getListDividedInChunks(e,a),c=n._getListDividedInChunks(t,a);let p=n._buildBaseToPCMapping(i.items.configurations);0==d.length&&c.length>0?n._cloneProductConfigs(c,o,s,r,l,!1,p):n._cloneBaseConfigs(d,c,o,s,r,l,p)}})})},v.prototype._buildBaseToPCMapping=function(e){let t=this,i={},n={};i.emptyBase=[];let a={};return e.forEach(e=>{if("Model Type"!=e.options.grid.type||Object.keys(i).includes(e.options.id)){if("Product Configuration"==e.options.grid.type)if(e.isRoot())if(e.options.grid.hasOwnProperty("baseConfigurationId")){let n=t._getBCIDfromTarget(e.options.grid);a[e.options.id]=n,i[n]?i[e.options.grid.baseConfigurationId].push(e.options.id):(i[e.options.grid.baseConfigurationId]=[],i[e.options.grid.baseConfigurationId].push(e.options.id))}else a[e.options.id]="",i.emptyBase.push(e.options.id);else a[e.options.id]=e.getParent().options.id,Array.isArray(i[e.getParent().options.id])||(i[e.getParent().options.id]=[]),i[e.getParent().options.id].push(e.options.id),n[e.getParent().options.grid.name]=e.getParent().options.id}else i[e.options.id]=[],n[e.options.grid.name]=e.options.id}),{baseConfigMapping:i,prodConfigMapping:a,bcNameMapping:n}},v.prototype._getBCIDfromTarget=function(e){let t;this._sourceBCList.forEach(i=>{i.id==e.baseConfigurationId&&(t=i)});let i,n=Date.now();return this._targetBCList.forEach(e=>{if(e.name==t.name){let t=new Date(e.created).getTime();t<n&&(i=e,n=t)}}),i.id},v.prototype._allProcessResolved=function(){let t=this,i=[];t._processes.forEach(e=>{i.push(e.promise)}),e.Promise.allSettled(i).then(function(){t._applicationChannel.publish({event:"xmodel-app-reinit-solver"})})},v.prototype._cloneBaseConfigs=function(t,i,n,a,o,s,r){let l=this;l._requestManagerNew(t,n,"cloneBaseConfiguration",a).then(function(t){e.Promise.allSettled(t).then(function(e){var t;e&&e.length>0&&(t=l._countResolvedPromises(e)),t&&t.noOfOK===t.total?i.length>0?l._cloneProductConfigs(i,n,a,o,s,e,r):(_("BC Clone is successful!"),l.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"success",message:h.MSG_BASECONFIG_CLONE_SUCCESS}}),o()):(_("Base Configuration Cloning failed!",!0),l.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"error",message:h.MSG_BASECONFIG_CLONE_FAILED,action:action}}),s())})},function(){_("Error!!! Configurations Clone request manager promise is rejected"),s()})},v.prototype._cloneProductConfigs=function(t,i,n,a,o,s,r){let l=this;try{l._updateChunkedPCList(t,s,r),l._requestManagerNew(t,i,"cloneProductConfigurations",n).then(function(t){_("PC Clone Request Manager: resolved"),e.Promise.allSettled(t).then(function(e){var t;_("All PC Clone Promises: allSettled"),e&&e.length>0&&(t=l._countResolvedPromises(e)),t&&t.noOfOK===t.total?(_("PC Clone is successful!"),l.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"success",message:h.MSG_CONFIGURATION_CLONE_SUCCESS}}),a()):(_("PC Clone is failed!",!0),l.updateChannel.publish({event:u.EVT_STATUS_NOTIFICATION,data:{type:"error",message:h.MSG_CONFIGURATION_CLONE_FAILED}}),o())},function(){o()})},function(){_("Error!!! PC Clone request manager promise is rejected"),o()})}catch(e){o()}},v.prototype._updateChunkedPCList=function(e,t,i){let n=i.prodConfigMapping,a=i.baseConfigMapping,o=i.bcNameMapping;t&&t.forEach(e=>{e.value.member.forEach(e=>{let t=o[e.name];if(t){a[t].forEach(t=>{n[t]=e.id})}})});e.forEach((t,i)=>{let a=[],o={emptyBase:0};a.push({pcIDs:[]});let s=t.length;for(let e=0;e<s;e++){let i=t[e],s=""!=n[i]&&n[i],r={pcIDs:[]};s&&o[s]&&o[s]>-1?a[o[s]].pcIDs.push(i):s?(r.bcID=s,r.pcIDs.push(i),a.push(r),o[s]=a.indexOf(r)):a[0].pcIDs.push(i)}e[i]=a})},v.prototype._preparePromisesListFromItems=function(t,i,n){var a,o,s=[],r={},l=function(t,i){var n=e.clone(r);return n[a].id=i,t.forEach(function(e){var t=e&&e.idref?e.idref:e&&e.id?e.id:"";t&&n[o].push({id:t})}),n};if(t&&i){var d="May";if("variant"===i?(a="variant",o="value",d="Must"):"optionGroup"===i&&(a="optionGroup",o="option"),a&&o){var c=[],p=0,u=t.length;t.forEach(function(e,t){var i=e&&e.idref?e.idref:e&&e.id?e.id:"";if(i){(r={constraint:void 0!==e.mandatory?!0===e.mandatory?"Must":"May":d,sequenceNumber:e.sequenceNumber?e.sequenceNumber.toString():"1"})[a]={},r[o]=[];var h=e.subItems;if(h.length>0)if(h.length>=n){var m=l(h,i);s.push([m])}else{var v=l(h,i);p+=h.length,c.push(v),(p>=n||t===u-1)&&(s.push(c),c=[],p=0)}else _("There are no subitems with current item.")}else _("Some of the items has invalid item ID, ignoring it.")})}}return s},v.prototype._getPromiseFromCall=function(e,t){var i;if(e&&t.length>0)switch(e){case"createVariantAndValueInstances":case"createOptionGroupAndOptionInstances":i=a[e](this.mvId,{items:t});break;case"allocateValues":case"allocateOptions":i=a[e]({parentID:this.mvId,items:t});break;case"createVariantClassVariabilityInstances":case"createVariantVariabilityInstances":case"createOptionGroupVariabilityInstances":case"createOptionVariabilityInstances":i=a[e]({parentID:this.mvId,instances:t});break;case"createParameterVariabilityInstances":i=a[e]({items:t},this.mvId);break;case"addExistingRuleFromModelVersion":i=n.addExistingRuleFromModelVersion({productID:this.mvId,ruleIDs:t});break;case"cloneProductConfigurations":i=n.cloneProductConfigurations({parentID:this.mvId,pCs:t});break;case"cloneBaseConfiguration":i=n.cloneBaseConfiguration({parentID:this.mvId,bcIDs:t})}return i},v.prototype._prepareInstancesFromItems=function(e,t){var i=[];return e&&e.length>0&&t&&e.forEach(function(e){var n=e.idref?e.idref:e.id?e.id:void 0,a=!!e.isInSource&&e.isInSource;if(n&&!1===a){var o={referencedID:n,attributes:{name:"",description:"",constraint:"variant"===t&&e.mandatory?"Must":"May"}};i.push(o)}}),i},v.prototype._getListDividedInChunks=function(e,t){for(var i=[];e.length>0;){var n=e.length;if(n<t){var a=e.splice(0,n);i.push(a)}else{var o=e.splice(0,t);i.push(o)}}return i},v.prototype._countResolvedPromises=function(e){for(var t=0,i=0,n=0;n<e.length;n++){var a=e[n];a&&"fullfilled"===a.state?t++:a&&"rejected"===a.state&&i++}return _(">> Promise Stats: OK: "+t+" KO: "+i+" Total: "+e.length),{noOfOK:t,noOfKO:i,total:e.length}},v.prototype._getSelectedItemsIds=function(e,t){var i=[];return e&&e.forEach(function(e){t?e.options.grid.type==t&&e.options&&void 0!==e.options.id&&i.push(e.options.id):e.options&&void 0!==e.options.id&&i.push(e.options.id)}),i},v.prototype._prepareSelectedItemsForVariability=function(t){var i={variants:[],optionGroups:[],parameters:[]},n=function(t){var n={},a=t.getChildren()||[],o=[];if(t.options.isProcessed=!0,n=e.clone(t.options.grid),a.length>0){var s=[];a.forEach(function(t){t.options.isProcessed=!0,t.isSelected()?o.push(e.clone(t.options.grid)):s.push(e.clone(t.options.grid))}),s.length===a.length&&(o=s)}switch(n.subItems=o,n.isA){case"variant":i.variants.push(n);break;case"optionsGroup":i.optionGroups.push(n);break;case"parameter":i.parameters.push(n)}};return t&&t.length>0&&t.forEach(function(e){if(e&&0===e.getNodeDepth())e.options&&void 0===e.options.isProcessed&&n(e);else if(e.options&&void 0===e.options.isProcessed){var t=e.getParent();n(t)}}),i},v.prototype.destroy=function(){_("Performing cleanup-CopyFromManager!",!0),this._mvPresent=!1,this._myEventManager&&(this._myEventManager.cleanup(),this._myEventManager=null)},v}),define("DS/ENOXModelApp/ModelDefinition/js/UnitsFilterAndDataManager",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelDictionaryUtility","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/Utils/xModelCommonUtils","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelsStatePresenter"],function(e,t,i,n,a,o,s,r,l,d,c){"use strict";var p=["physicalid","ds6w:label","organization","ds6w:type","ds6w:description","ds6w:state","ds6wg:revision","ds6w:identifier","PLC_BUILD_SERIAL_NUMBER","PLC_BUILD_UNIT_NUMBER","PLC_PLANNED_DATE","PLC_SHIPPED_DATE","PLC_PRODUCT_CONFIGURATION_PID","PLC_PRODUCT_CONFIGURATION","PLC_ACTUAL_BUILD_DATE","PLC_MFG_PLAN_PID","PLC_PRODUCT_PID","PLC_MFG_PLAN_NAME","PLC_PRODUCT","PLC_PRODUCT_TITLE","PLC_PRODUCT_CONFIGURATION_TITLE","PLC_MFG_PLAN_TITLE","PLC_PRODUCT_REVISION","PLC_MFG_PLAN_REVISION"],u={state_plan:"Plan",state_build:"Build",state_internalTest:"Internal Test",state_externalTest:"External Test",state_complete:"Complete",state_release:"Release",state_obsolete:"Obselete"};return t.extend({init:function(t){this._parent(t),e.merge(this,t),this.updateChannel&&(this._myEventManager=new s(this.updateChannel)),this._currentFilter=e.clone(this.defaultFilter),this._prevFilterCriteria=e.clone(this.defaultFilter),this._subscribeToEvents(),this._currUserId=n.getUser().login,this._platformServices=null,this._searchServiceURL=null,this._currLang=window.widget&&window.widget.lang?window.widget.lang:"en"},_subscribeToEvents:function(){var t=this;this._myEventManager.subscribe(this.updateChannel,{event:"unit-filter-criteria-update"},function(i){e.log("Unit version filter criteria updated!!!"),t._currentFilter&&i&&i.filterCriteria&&(e.equals(t._currentFilter,i.filterCriteria)?e.log("No Change in filter criteria!!"):(e.log("Filter criteria updated!"),e.extend(t._currentFilter,i.filterCriteria)))})},_getBasicRequestObj:function(){return void 0===this._basicReqObj&&(this._basicReqObj={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}),e.clone(this._basicReqObj)},_prepareRequestData:function(t){var i=e.merge(e.clone({}),{label:"x_mdl_app_"+n.getUser().login+"_unit_filter_"+Date.now(),with_indexing_date:!0,with_synthesis:!1,with_nls:!1,locale:this._currLang,select_predicate:p,refine:{},order_by:"desc",nresults:200,order_field:"relevance",source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",login:{"3dspace":{SecurityContext:o.getSecurityContext()}}});return e.extend(i,t),i},_prepareQueryInfo:function(e){return e.id?'flattenedtaxonomies:"types/Builds" AND plc_95_model_95_pid:'+e.id:'flattenedtaxonomies:"types/Builds"'},_prepareAdditionalQuery:function(){var e,t,i,n;if(this._currentFilter&&this._currentFilter.maturity_state){var a=this._currentFilter.maturity_state;for(var o in a)o&&!0===a[o]&&(t?t+=' OR current:"'+u[o]+'"':t='current:"'+u[o]+'"')}return(this._currUserId&&this._currentFilter.owned_by_me&&this._currentFilter.owned_by_my_organizations||this._currentFilter.owned_by_me&&!1===this._currentFilter.owned_by_my_organizations)&&(i='owner:"'+this._currUserId+'"'),(!1===this._currentFilter.owned_by_me&&!1===this._currentFilter.owned_by_my_organizations||!1===this._currentFilter.owned_by_me&&this._currentFilter.owned_by_my_organizations)&&this.currUserOrgs&&this.currUserOrgs.length>0&&this.currUserOrgs.forEach(function(e){e&&e.trim()&&(n=n?' OR organization:"'+e+'"':'organization:"'+e+'"')}),t&&(e="AND("+t+")"),i&&(e?e+="AND("+i+")":e="AND("+i+")"),n&&(e?e+="AND("+n+")":e="AND("+n+")"),e},_fetchData:function(t,i){var n=this;return new e.Promise(function(a,s){try{var r,l,d,c=0;t&&t.nextRequestData?(r=t.nextRequestData,c=t.currentCount,l=r.query):(l=n._prepareQueryInfo(i),d=n._prepareAdditionalQuery(),r=n._prepareRequestData({query:l,start:0,specific_source_parameter:{"3dspace":{additional_query:d}}}));var p=n._getBasicRequestObj();p.data=JSON.stringify(r),p.onComplete=function(t){var i=JSON.parse(t),o=n._parseResponse(i);if(o.length>0)if(i.infos.nhits&&i.infos.nhits>o.length+c){var r=n._prepareAdditionalQuery(),d=n._prepareRequestData({query:l,next_start:i.infos.next_start,specific_source_parameter:{"3dspace":{additional_query:r}}});a({items:o,nextRequestData:d,numberOfHits:i.infos.nhits,currentCount:o.length+c})}else a({items:o,nextRequestData:void 0,numberOfHits:i.infos.nhits,currentCount:o.length+c});else e.log("Search Response is Empty!!!"),s(t)},p.onFailure=function(e){s(e)},p.onTimeout=function(e){s(e)},o.federatedSearchRequest(p)}catch(t){e.log("Exception occured while fetching data"+t.message),s(t.message?t.message:"Exception Occured during fetch!!")}})},_parseResponse:function(e){var t=[];if(this._nlsState=r.getStateValue(),e){var i=e.results;if(i&&i.length>0)for(var n=0,a=i.length;n<a;n++)if(i[n]&&i[n].attributes){for(var o=i[n].attributes,s={nlsValues:{}},l=0,d=o.length;l<d;l++)switch(o[l].name){case"physicalid":s.id=o[l].value;break;case"ds6w:identifier":s.name=o[l].value;break;case"ds6w:what/ds6w:assigned":s.Assigned=o[l].value;break;case"ds6w:label":s.serialNumber=o[l].dispValue?o[l].dispValue:o[l].value,s.name=o[l].dispValue?o[l].dispValue:o[l].value;break;case"ds6w:description":s.description=o[l].value;break;case"ds6w:type":case"ds6w:what/ds6w:type":s.type=o[l].value;break;case"ds6w:created":case"ds6w:modified":case"ds6w:when/ds6w:modified":case"ds6w:when/ds6w:created":try{if(o[l].value){var c=new Date(o[l].value);"ds6w:when/ds6w:modified"===o[l].name||"ds6w:modified"===o[l].name?s.modified=c:"ds6w:when/ds6w:created"!==o[l].name&&"ds6w:created"!==o[l].name||(s.created=c)}}catch(e){"ds6w:when/ds6w:modified"===o[l].name||"ds6w:modified"===o[l].name?s.modified=o[l].value?o[l].value:"":"ds6w:when/ds6w:created"!==o[l].name&&"ds6w:created"!==o[l].name||(s.created=o[l].value?o[l].value:"")}break;case"ds6wg:revision":s.revision=o[l].value;break;case"ds6w:status":case"ds6w:what/ds6w:status":var p=o[l].value.replace(/ /g,"_");s.nlsValues.nlsState=this._nlsState["ds6w:status"][p]?this._nlsState["ds6w:status"][p]:p,o[l].value&&o[l].value.indexOf("Build.")>-1&&(o[l].value=o[l].value.slice(o[l].value.indexOf(".")+1)),s.state=o[l].value;break;case"ds6w:responsible":case"ds6w:who/ds6w:responsible":s.owner=o[l].value;break;case"ds6w:organizationResponsible":case"ds6w:who/ds6w:responsible/ds6w:organizationResponsible":r.fetchOrganzationNLS(o[l].value),s.organization=o[l].value;break;case"ds6w:where/ds6w:context/ds6w:project":s.collabspace=o[l].value;break;case"PLC_BUILD_UNIT_NUMBER":s.unitNumber=o[l].value;break;case"PLC_BUILD_SERIAL_NUMBER":s.serialNumber=o[l].value;break;case"PLC_PRODUCT_CONFIGURATION_TITLE":s.productConfiguration=o[l].value;break;case"PLC_PRODUCT_TITLE":s.modelVersion=o[l].value;break;case"PLC_PRODUCT_REVISION":s.modelVersionRevision=o[l].value;break;case"PLC_MFG_PLAN_TITLE":s.manufacturingPlan=o[l].value;break;case"PLC_MFG_PLAN_REVISION":s.manufacturingPlanRevision=o[l].value;break;case"PLC_PLANNED_DATE":s.plannedDate=o[l].value;break;case"PLC_SHIPPED_DATE":s.dateShipped=o[l].value;break;case"PLC_ACTUAL_BUILD_DATE":s.actualDate=o[l].value;break;case"PLC_PRODUCT_CONFIGURATION_PID":s.productConfigurationId=o[l].value;break;case"PLC_MFG_PLAN_PID":s.manufacturingPlanId=o[l].value;break;case"PLC_PRODUCT_PID":s.modelVersionId=o[l].value;break;case"preview_url":s.image=o[l].value}void 0===s.description&&(s.description=""),s.modelVersion&&s.modelVersionRevision&&s.modelVersionId&&(s.modelVersion={identifier:s.modelVersionId,title:s.modelVersion,revision:s.modelVersionRevision}),s.productConfiguration&&s.productConfigurationId&&(s.productConfiguration={identifier:s.productConfigurationId,title:s.productConfiguration}),s.manufacturingPlan&&s.manufacturingPlanRevision&&s.manufacturingPlanId&&(s.manufacturingPlan={identifier:s.manufacturingPlanId,title:s.manufacturingPlan,revision:s.manufacturingPlanRevision}),t.push(s)}}return t}})}),define("DS/ENOXModelApp/SpecificationDetails/SpecificationFilesPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","UWA/Class/Model","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXIDCardContainer/js/ENOXIDCardContainer","DS/ENOXSplitView/js/ENOXSplitView","DS/ENOXTabs/js/ENOXTabs","DS/DocumentManagement/DocumentManagement","DS/ENOXModelApp/Utils/xModelIDCardAttributeEditor","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/ModelDocument/js/DocumentManagementCustom","DS/ENOXDataDragAndDrop/js/ENOXDataDragAndDrop","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","i18n!DS/ENOXModelApp/assets/nls/SpecificationDetails/SpecificationFilesPresenter","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/SpecificationCommonUtil","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/LocalSpecificationPresenter","css!DS/ENOXModelApp/SpecificationDetails/SpecificationDetails.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A){"use strict";var P=function(){this.EVENTOUT_MANAGE_VERSION="enoxdoc-open-version-explorer"};return P.prototype.registerToOpenVersionManager=function(e){let t=this._applicationChannel.subscribe({event:this.EVENTOUT_MANAGE_VERSION},e);this._applicationChanneltoken.push(t)},P.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"remove",single:I._Single_Product_Spec,multiple:I._Multiple_Product_Spec,modelEvent:t,immersiveFrame:D.getImmersiveFrame()};S.showDialog(i)},P.prototype.init=function(e,t){this._isDestroyed=!1,this._applicationChannel=e,this._options=t,this._id=t.id,this._reservedby=t.reservedby,this._applicationChanneltoken=[],this._modelForIdCard={},this.options=t,this._idCardData={},this._enoxIDCardContainer=new r,this._privateModelEvents=new i,this._initDivs(),this._idCardAttrbEditorUtil=new p,this._command=new u(this._privateModelEvents,this._container,this._applicationChannel),this._idCardAttrbEditorUtil.init(this._privateModelEvents),this._initListView(),this._subscribeToEvents(),this._infoContext="home.ModelDefinition.ModelInfo.DOCDetails",y.initialize({applicationChannel:this._applicationChannel,silent:!0,context:this._infoContext,readOnly:!1})},P.prototype._initListView=function(){var e=this,t=!1;e._reservedby&&(t=!0);var i={id:"SpecDetails",modelEvents:this._privateModelEvents,useDragAndDrop:!0,withmultisel:!0,showItemCount:!0,viewOptions:{identifier:"spec_details",views:["DataGridView"],grid:{columns:[{text:v.DOC_Tab_File,dataIndex:"title"},{text:v.DOC_Column_Status,dataIndex:"Lock status",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel.options.grid.reservedby){e.nodeModel.options.grid.reservedby;return{icon:"fonticon fonticon-key reservations-key coloured-boolean",label:"",url:""}}return""}},{text:v.DOC_Column_Version,dataIndex:"revision"}]},editable:!1,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){return e.options.grid.owner+" | "+e.options.grid.stateNLS},description:function(e){return C.formatDateAttribute(e.options.grid.modified)},customTooltip:function(e){return e.options.grid.title}},contextualActions:[{id:"download",text:"Download",fonticon:"download",handler:function(t){e.downloadFile(t)}}]},emptyContentOptions:{sentences:[{type:"icon",fonticon:"drag-drop",sizeicon:"40px",text:v.DOC_Uploading_Page}]},toolbarOptions:{withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,touchMode:!1,actions:[{id:"upload",text:v.DOC_Upload_File,fonticon:"upload",handler:function(t){var i=document.createElement("input");i.type="file",i.addEventListener("change",function(){e.uploadFileForSpec(i)},!1),i.click()}},{className:"divider"},{id:"lock-status",text:v.DOC_Command_Lock,fonticon:"lock",showOnSelection:!0,handler:function(){e.lock_unlock_spec(!0)}},{id:"unlock",showOnSelection:!0,text:v.DOC_Command_Unlock,fonticon:"lock-open",handler:function(){e.lock_unlock_spec(!1)}},{className:"divider"},{id:"download",showOnSelection:!0,text:v.DOC_Command_Download,fonticon:"download",handler:function(){e.downloadLatestFile()}},{className:"divider"},{id:"remove",text:v.DOC_Remove,showOnSelection:!0,fonticon:"remove",content:[{id:"deleteAll",text:v.DOC_Remove_All_Version,handler:function(){e._removeVersions(!0)}},{id:"deleteAllButLast",text:v.DOC_Delete_All_Versions_But_Last,handler:function(){e._removeVersions(!1)}}]}]},extensions:[g,b]};this._listPresenter=new f(i),this._listPresenter.inject(this._filesContainer),t?this._privateModelEvents.publish({event:"xmodel-list-toolbar-hide-action",data:"lock-status"}):this._privateModelEvents.publish({event:"xmodel-list-toolbar-hide-action",data:"unlock"}),this._setupDroppableRegion()},P.prototype._setupDroppableRegion=function(){new m({droppableAreas:[this._filesContainer],modelEvents:this._privateModelEvents})},P.prototype.lock_unlock_spec=function(i){var n=this,a=n._id,o=function(t){var i={member:[]};if(t.relateddata&&t.relateddata.files&&t.relateddata.files.length>0){var a,o=t.relateddata.files;n._reservedby=t.dataelements.reservedby,o[0].dataelements&&o[0].id&&(a={id:o[0].id,reservedby:n._reservedby},a=e.merge(a,o[0].dataelements),i.member.push(a));for(var s=t.relateddata.files[0].relateddata.versions,r=s.length,l=0;l<r;l++)s[l].dataelements&&s[l].id&&(a={id:s[l].id,reservedby:n._reservedby},a=e.merge(a,s[l].dataelements),i.member.push(a));n._privateModelEvents.publish({event:"xmodel-list-data-load-action",data:i}),n._privateModelEvents.publish({event:"xmodel-list-data-on-load-complete"})}else 0===t.relateddata.files.length&&n._privateModelEvents.publish({event:"xmodel-list-data-load-action",data:i})};i?(t.mask(n._filesContainer),h.reserveDocument(a,{securityContext:E.getSecurityContext(),onComplete:function(){_.showSuccess(v.DOC_Select_Lock_Success);var i={getVersions:!0,onComplete:function(i){var s=i.data;s&&e.is(s,"array")&&(s=s[0]),n._reservedby=s.dataelements.reservedby,n._privateModelEvents.publish({event:"xmodel-list-toolbar-hide-action",data:"lock-status"}),n._privateModelEvents.publish({event:"xmodel-list-toolbar-show-action",data:"unlock"}),n._applicationChannel.publish({event:"xmodel-spec-status-update",data:a}),o(s),t.unmask(n._filesContainer)},onFailure:function(){}};c.getDocuments([a],i)},onFailure:function(i){e.log(i),_.showError(v.DOC_Select_Lock_Error+i.error),t.unmask(n._filesContainer)}})):(t.mask(n._filesContainer),h.unreserveDocument(a,{securityContext:E.getSecurityContext(),onComplete:function(){_.showSuccess(v.DOC_Select_Unlock_Success),t.unmask(n._filesContainer);var i={getVersions:!0,onComplete:function(i){var s=i.data;s&&e.is(s,"array")&&(s=s[0]),n._reservedby=s.dataelements.reservedby,n._privateModelEvents.publish({event:"xmodel-list-toolbar-hide-action",data:"unlock"}),n._privateModelEvents.publish({event:"xmodel-list-toolbar-show-action",data:"lock-status"}),n._applicationChannel.publish({event:"xmodel-spec-status-update",data:a}),o(s),t.unmask(n._filesContainer)},onFailure:function(){}};c.getDocuments([a],i)},onFailure:function(i){e.log(i),_.showError(v.DOC_Select_Lock_Error+i.error),t.unmask(n._filesContainer)}}))},P.prototype.downloadFile=function(t){e.log("Downloading the files");var i=t.id,n=t.title,a={onComplete:function(t){if(e.log("download complete .."+t),t){e.log("Result"+t);var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(i.response,n);else{var e=document.createElement("a");e.href=window.URL.createObjectURL(i.response),n&&(e.download=n),e.style.display="none",document.body.appendChild(e),e.click(),e=void 0}},i.send(),_.showSuccess(v.DOC_Files_download_success)}},onFailure:function(t){e.log("failed"+t),_.showError(v.DOC_Files_download_failure)}};c.downloadDocument(i,void 0,!1,a)},P.prototype._removeVersions=function(i){var n=this,a=n._id;t.mask(n._filesContainer);var o={getVersions:!0,onComplete:function(e){var o,s,r=!1,l=e.data[0];if(l.relateddata.files.length>0)if(o=l.relateddata.files[0].id,s=l.relateddata.files[0].relateddata.versions,l.relateddata.files.length>1&&(r=!0),r)_.showError(v.DOC_Multi_Files),t.unmask(n._filesContainer);else if(i)if(void 0===o||""===o)_.showError(v.DOC_DELETE_No_Files),t.unmask(n._filesContainer);else{var d={onComplete:function(){n._privateModelEvents.publish({event:"xmodel-list-data-item-remove-action",data:o}),s.forEach(function(e){n._privateModelEvents.publish({event:"xmodel-list-data-item-remove-action",data:e.id})}),t.unmask(n._filesContainer),_.showSuccess(v.DOC_Files_delete_success)},onFailure:function(){_.showError(v.DOC_Files_delete_failure),t.unmask(n._filesContainer)}};c.deleteFile(a,o,d)}else s.length>0?n._removeFiles(a,o,s,s.length):(_.showError(v.DOC_DELETE_No_Versions),t.unmask(n._filesContainer));else _.showError(v.DOC_DELETE_No_Files),t.unmask(n._filesContainer)},onFailure:function(){e.log("getDocuments: Service Call fail !!!"),t.unmask(n._filesContainer)}};c.getDocuments([a],o)},P.prototype._removeFiles=function(i,n,a,o){var s=this,r=a[o-1].id,l={onComplete:function(){if(a[o-1]&&a[o-1].id&&s._privateModelEvents.publish({event:"xmodel-list-data-item-remove-action",data:[a[o-1].id]}),(o-=1)>0)s._removeFiles(i,n,a,o);else{_.showSuccess(v.DOC_Files_delete_success),t.unmask(s._filesContainer);var r={getVersions:!0,onComplete:function(t){var i=t.data;i&&e.is(i,"array")&&(i=i[0])},onFailure:function(){}};c.getDocuments([i],r)}},onFailure:function(){_.showError(v.DOC_Files_delete_failure),t.unmask(s._filesContainer)}};c.deleteVersion(i,n,r,l)},P.prototype.downloadLatestFile=function(){var t=this._id,i={onComplete:function(t){e.is(t,"array")&&t.forEach(function(t){t.downloadUrl&&E.getBlobObject(t.downloadUrl,function(){var i=this.response;if(window.navigator.msSaveOrOpenBlob){var n=this.getResponseHeader("content-type");window.navigator.msSaveOrOpenBlob(new Blob([i],{type:n}),t.fileName)}else{e.createElement("a",{href:window.URL.createObjectURL(i),download:t.fileName,type:"application/octet-stream"}).click()}})})},onFailure:function(t){e.log("failed"+t),_.showError(v.DOC_Files_download_failure)}};c.downloadDocuments([t],i)},P.prototype.uploadFileForSpec=function(i){var n=this,a=n._id,o=i.files[0],s={onComplete:function(s){if(n._reservedby=s.data[0].dataelements.reservedby,0===s.data[0].relateddata.files.length)c.addFileToDocument({id:a,fileInfo:{file:o,title:o.name}},{securityContext:E.getSecurityContext(),onComplete:function(a){var o={id:a.data[0].relateddata.files[0].id,reservedby:n._reservedby};i=e.merge(a.data[0].relateddata.files[0].dataelements,o),n._privateModelEvents.publish({event:"xmodel-list-data-item-add-action",data:i}),t.unmask(n._filesContainer),_.showSuccess(v.DOC_Files_Upload_Success)},onFailure:function(){t.unmask(n._filesContainer),_.showError(v.DOC_Files_Upload_Error)}});else if(s.data[0].relateddata.files.length>=1){var r={id:a,fileInfo:{file:o,title:o.name},newFile:!1},l={onComplete:function(a){var o=a.data[0].relateddata.files[0],s={id:o.id,reservedby:n._reservedby};i=e.merge(o.dataelements,s),n._privateModelEvents.publish({event:"xmodel-list-data-item-add-action",data:i}),t.unmask(n._filesContainer),_.showSuccess(v.DOC_Files_Upload_Success)},onFailure:function(){t.unmask(n._filesContainer),_.showError(v.DOC_Files_Upload_Error)}};c.modifyDocument(r,l)}else _.showError(v.DOC_Files_Upload_Error),t.unmask(n._filesContainer)},onFailure:function(){_.showError(v.DOC_Files_Upload_Error),t.unmask(n._filesContainer)}};c.getDocuments([a],s)},P.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("model-details"),this._filesContainer=e.createElement("div"),this._filesContainer.classList.add("model-baselines-container")},P.prototype.inject=function(e){e.appendChild(this._container)},P.prototype._subscribeToEvents=function(){var t=this;this._privateModelEvents.subscribe({event:"idcard-open-version-explorer"},function(){var e=t._enoxIDCardContainer.getIDCard();if(e){var i=e.getElement(".version");if(i){var n={id:t._id,versionLabel:i,container:t._container};t._applicationChannel.publish({event:t.EVENTOUT_MANAGE_VERSION,data:n})}}}),this._privateModelEvents.subscribe({event:"idcard-model-refresh"},function(){e.log("ID Card Model refresh Event handler!!! dce6_1"),t._refreshIdCardModel()}),this._privateModelEvents.subscribe({event:"idcard-dropdown-menu-action"},function(e){t._actionDropDownMenuIdCard(e)}),this._privateModelEvents.subscribe({event:"onDrop"},function(e){t.dropFile(e)}),this._privateModelEvents.subscribe({event:"enox-dialog-delete"},function(e){t.isSpecLocked()?_.showError(I.DOC_LOCKED):t.deleteSpecification(e[0])})},P.prototype.isSpecLocked=function(e){let t=!1;return""!=this._options.reservedby&&(t=!0),t},P.prototype.deleteSpecification=function(e){let i=this;t.mask(i._container);let n=function(){if(_.showSuccess(I.DOC_Remove_success),i._options.modelVersionId){var t={modelVersionId:i._options.modelVersionId,id:i._options.modelVersionId,name:i._options.modelVersionName,version:i._options.modelVersion};o.navigate(s.ROUTE_MODEL_DETAILS,t,{replace:!0}),i._applicationChannel.publish({event:"breadcrumb-remove-link",data:s.ROUTE_MODEL_RULE_DETAILS}),i._applicationChannel.publish({event:"enox-model-app-item-removed",data:[e]})}},a=function(){_.showError(I.DOC_Remove_Failure),t.unmask(i._container)};""!=e?M.removeSpecifications(i._options.modelVersionId,e,"Product Specification",!1,n,a):t.unmask(this._container)},P.prototype._actionDropDownMenuIdCard=function(e){switch(e){case"information":y.removeAllSelection(),y.showInformation(this._id);break;case"delete":this.createDeleteModelDialog([{id:this._id,title:this._options.name}],this._privateModelEvents);break;case"owner":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"owner"}});break;case"state":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"state"}});break;case"revision":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"revision"}})}},P.prototype.dropFile=function(i){var n,a=this,o=a._id,s=i.data.data;s&&1===s.length?n=s[0]:s.items&&(s=s.items,n=s[0]);var r={onComplete:function(i){if(a._reservedby=i.data[0].dataelements.reservedby,0===i.data[0].relateddata.files.length)c.addFileToDocument({id:o,fileInfo:{file:n,title:n.name}},{securityContext:E.getSecurityContext(),onComplete:function(i){var n={id:i.data[0].relateddata.files[0].id,reservedby:a._reservedby},o=e.merge(i.data[0].relateddata.files[0].dataelements,n);a._privateModelEvents.publish({event:"xmodel-list-data-item-add-action",data:o}),t.unmask(a._filesContainer),_.showSuccess(v.DOC_Files_Upload_Success)},onFailure:function(){t.unmask(a._filesContainer),_.showError(v.DOC_Files_Upload_Error)}});else if(i.data[0].relateddata.files.length>=1&&e.is(n,"file")){var s={id:o,fileInfo:{file:n,title:n.name},newFile:!1},r={onComplete:function(i){var n=i.data[0].relateddata.files[0],o={id:n.id,reservedby:a._reservedby},s=e.merge(n.dataelements,o);a._privateModelEvents.publish({event:"xmodel-list-data-item-add-action",data:s}),t.unmask(a._filesContainer),_.showSuccess(v.DOC_Files_Upload_Success)},onFailure:function(){t.unmask(a._filesContainer),_.showError(v.DOC_Files_Upload_Error)}};c.modifyDocument(s,r)}},onFailure:function(){_.showError(v.DOC_Files_Upload_Error),t.unmask(a._filesContainer)}};c.getDocuments([o],r)},P.prototype.modifyDataForIdCard=function(t){let i,n={member:[]};if(t.dataelements){let a={},o="";if(t.relateddata&&(a=t.relateddata),i=a.files[0].dataelements.fileSize?a.files[0].dataelements.fileSize:"",a.ownerInfo.length>0&&a.ownerInfo[0].dataelements){let e=a.ownerInfo[0].dataelements.firstname+" "+a.ownerInfo[0].dataelements.lastname;o=e||""}e.merge(t.dataelements,{id:t.id,physicalId:t.id,owner:o}),n.member[0]=t.dataelements}return{idcardData:n,fileSize:i}},P.prototype._loadData=function(t){if(e.is(this._options.reservedby)||e.merge(this._options,{reservedby:t.dataelements.reservedby}),null==t)return;let i=this.modifyDataForIdCard(t);this._modelForIdCard=C.prepareIdCardData(i.idcardData,this._privateModelEvents,{freeZones:[v.DOC_Latest_file_Size+" "+i.fileSize+" "+v.BYTES],commands:{remove:!0}}),this._idCardAttrbEditorUtil.setModelAndInitCollabObj(this._modelForIdCard),this._enoxIDCardContainer.init({modelEvents:this._privateModelEvents},this._modelForIdCard),this._enoxIDCardContainer.inject(this._container);var n=this._enoxIDCardContainer.getMainContent();this._filesContainer.inject(n);var a=this._enoxIDCardContainer.getIDCard();if(a){var o=a.getElement(".version");if(o){var s={id:this._id,versionLabel:o,container:this._container};this._options.installVersionExplorer&&this._options.installVersionExplorer(s)}}},P.prototype._loadFilesData=function(t){var i={member:[]};if(t.relateddata&&t.relateddata.files&&t.relateddata.files.length>0){var n,a=t.relateddata.files;this._reservedby=t.dataelements.reservedby,a[0].dataelements&&a[0].id&&(n={id:a[0].id,reservedby:this._reservedby},n=e.merge(n,a[0].dataelements),i.member.push(n));for(var o=t.relateddata.files[0].relateddata.versions,s=o.length,r=0;r<s;r++)o[r].dataelements&&o[r].id&&(n={id:o[r].id,reservedby:this._reservedby},n=e.merge(n,o[r].dataelements),i.member.push(n));this._privateModelEvents.publish({event:"xmodel-list-data-load-action",data:i}),this._privateModelEvents.publish({event:"xmodel-list-data-on-load-complete"})}else 0===t.relateddata.files.length&&this._privateModelEvents.publish({event:"xmodel-list-data-load-action",data:i})},P.prototype.fetchData=function(){var i=this;t.mask(this._container);var n={getVersions:!0,onComplete:function(n){if(i._isDestroyed)e.log("model details destroyed before being loaded");else{var a=n.data;a&&e.is(a,"array")&&(a=a[0]),i._loadData(a),i._loadFilesData(a),t.unmask(i._container)}},onFailure:function(){e.log("getDocuments: Service Call fail !!!")}};c.getDocuments([this._id],n)},P.prototype.destroy=function(){let e=this;this._container=null,this._isDestroyed=!0,this._applicationChanneltoken.forEach(function(t){e._applicationChannel.unsubscribe(t)})},P.prototype._refreshIdCardModel=function(){var t=this,i={getVersions:!0,onComplete:function(i){if(t._isDestroyed)return;var n=i.data;n&&e.is(n,"array")&&(n=n[0]);let a=t.modifyDataForIdCard(n);var o=C.prepareIdCardData(a.idcardData,t._privateModelEvents,{freeZones:[v.DOC_Latest_file_Size+" "+a.fileSize+" "+v.BYTES]});e.log("getDocuments: Service Call pass !!!"),t._modelForIdCard.set("attributes",o.get("attributes"))},onFailure:function(){e.log("getDocuments: Service Call fail !!!")}};c.getDocuments([this._id],i)},P}),define("DS/ENOXModelApp/PCBulkEdition/PCsBulkTablePresenter",["UWA/Core","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/UIKIT/Mask","DS/PCsBulkViewPresenter/js/PCsBulkViewPresenter","DS/PCsBulkViewPresenter/js/Utils/PCsBulkViewPresenterUtils","DS/CfgBulkTablePresenter/BulkEdition/Presenter/CfgAutocomplete","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/CfgSolver/CfgSolverServices","DS/CfgRuleMatrixComponent/Runtime/ConflictPanelPresenter","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","i18n!DS/ENOXModelApp/assets/nls/PCsBulkTablePresenter","i18n!DS/CfgBulkTablePresenter/assets/nls/BulkTablePresenter","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","css!DS/ENOXModelApp/PCBulkEdition/PCsBulkTablePresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m){"use strict";return a.extend({init:function(e){e||(e={}),e.securityContext=widget.getValue("xPref_CREDENTIAL"),e.tenant=widget.getValue("x3dPlatformId"),this._parent(e)},setModelVersion:function(e){this._parent(e)},setModelMaturity:function(e){this._parent(e)},loadVariabilityInfo:function(e){e&&e.portfolioClasses&&(this._parent(e),this.registerCellContent())},_createBulkTableDGV:function(e){e&&this._parent(e)},_subscribeToEvents:function(){this._parent();var t=this;this._eventManager.subscribe(this._privateChannelForRules,{event:"solver-init-completed"},function(e){e&&(t._solverKey=e)}),this._eventManager.subscribe(this._privateChannel,{event:"pcsbulk-on-save-done"},function(){n.unmask(t._container),c.showSuccess(u.PCSaveSuccessMessage)}),this._eventManager.subscribe(this._privateChannel,{event:"pcsbulk-on-save-failed"},function(e){n.unmask(t._container),e&&e.length>0&&c.showError(u.PCSaveFailureMessage)}),this._eventManager.subscribe(this._privateChannel,{event:"pcsbulk-on-save-update"},function(e){e&&t.onTableUpdate(e)}),this._eventManager.subscribe(this._privateChannel,{event:"OnDataGridCellClick"},function(i){if(i){let s=i.event.target.children[0];if(i.event.target.classList.contains("wux-ui-3ds-alert")||s&&s.classList.contains("wux-ui-3ds-alert")){var n=t.getCellData(i.cellInfos);n.id&&t.configCriteriaMap&&l.getConflictingAssumptionsCausingRules(t._solverKey,null,!0).then(i=>{var a=JSON.parse(i);e.is(a,"object")&&e.is(a._data.causingRules,"array")&&a._data.causingRules.length>0&&t._getRuleDetails(a._data.causingRules,n.title)})}else if(i.event.target.classList.contains("wux-ui-3ds-wrong")||s&&s.classList.contains("wux-ui-3ds-wrong"))t._dataGridView.setModelAt(i.cellInfos.cellID,"");else if(i.event.target.classList.contains("wux-ui-3ds-check")||s&&s.classList.contains("wux-ui-3ds-check")){var a=i.cellInfos.cellView.getReusableContent();if(a.value){var o=a.value;t._dataGridView.setModelAt(i.cellInfos.cellID,o)}}}}),this._eventManager.subscribe(this._privateChannel,{event:"bulk-edit-on-dropdown-show"},function(e){e.autocomplete&&(e.autocomplete.showLoader(),t._pauseCheckConflictCall=!0,t._bulkTableModel.isColumnEmpty(e.cellInfos.columnID-3)||t.callSolverOnSelectedIDsMethodOnSolver(e.cellInfos.columnID-3,e.cellInfos.rowID).then(function(){var i=t.getCellData({rowID:e.cellInfos.rowID,columnID:e.cellInfos.columnID});t._privateChannel.publish({event:"bulkedit-autocomplete/"+e.cellInfos.rowID+"/"+e.cellInfos.columnID,data:i.dropDownData}),e.autocomplete.hideLoader("Loading..")},function(){e.autocomplete.hideLoader("Loading..")}),e.autocomplete.hideLoader("Loading.."))})},setColumnAsReference:function(t){var i;this._parent(t),e.is(t)&&(this._bulkTableModel.setColumnAsReferenceInModel(t-3),this._dataGridView.layout.setColumnPinned(t,"left"),i=this._dataGridView.layout.getColumnEditableFlag(t)),i&&this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:!1})},unSetColumnAsReference:function(e){this._parent(e);var t=this._bulkTableModel.getColumnAsReference();if(t&&t.id){var i=this._bulkTableModel.getColumnID(t.id);this._bulkTableModel.unSetColumnAsReferenceInModel(i),this._dataGridView.layout.setColumnPinned(i+3,"unpinned"),this._editionflag&&this._dataGridView.layout.setColumnOrGroupProperties(t.id,{editableFlag:!0})}},onTableUpdateStart:function(){this._parent();var e=this._bulkTableModel.getColumnAsReference();for(var t in this._loadedPCs)if(console.log("loaded Pc :",t),e)t!==e.id&&this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:!0});else{var i=this._bulkTableModel.getColumnAttributes(t);let e=p.userID;const n="TRUE"===i.reserved&&e!=i.reservedby;console.log(i.title,"is editable ?",!n),this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:!n})}this.setSelectionModeOnSolver();var n=!1;this._selectedPCs.forEach(function(e){"CompleteConfiguration"!==e.evalMode&&(n=!0)}),n&&c.showInfo(u.CompleteModeNotification)},onTableUpdateEnd:function(){this._parent();var e=this._bulkTableModel.getColumnAsReference();for(var t in this._loadedPCs)e?t!==e.id&&this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:this._editionflag}):this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:this._editionflag})},onTableUpdate:function(e){var t=this,i=this._bulkTableModel.getVariabilityValuesMap();e.forEach(function(e){if(e.member){for(var n=t._bulkTableModel.getColumnID(e.member[0].id),a=t._createPersistancyInstance(e.member[0].id,!0),s=[],r=0;r<a.length;r++){var l=o.buildJsonModelFormatForLoadedData(a[r],i);s.push(l)}t._bulkTableModel.updateJsonModel(s,n),t._updateDGVColumn(n+3)}})},fetchData:function(t){let i=p.userID;return t.forEach(t=>{"TRUE"===t.reserved&&i!=t.reservedby&&c.showWarning(e.String.format(m.LOCKED_OBJ_INFO_ALERT,t.title,t.reservedbyFullName))}),this._parent(t)},checkConflictOfAllPCs:function(){var t=this;return this._withSolver?new Promise((i,n)=>{this.abortSolverCall().then(async function(){for(var n=0;n<t._arrayColumnIDsToCheck.length;n++)if(e.is(t._arrayColumnIDsToCheck[n])){var a=t._bulkTableModel.getColumnHeader(t._arrayColumnIDsToCheck[n]).attributes;if((!t._editionflag||e.is(a)&&e.is(a.baseConfigurationId))&&!t._pauseCheckConflictCall){var o=t._arrayColumnIDsToCheck[n],s=await t.checkConflictOfPC(o);t._arrayColumnIDsChecked.includes(o)||t._arrayColumnIDsChecked.push(o),t._arrayColumnIDsToCheck.splice(n,1),t._updateConflictLoadingState(n+1),n--,t.applySolverAnswer(s,o),t._updateDGVColumn(o+3)}}i()}).catch(function(e){n(e)})}):e.Promise.resolve()},checkConflictOfPC:async function(t){var i=this;if(t>=0){var n=i._bulkTableModel.getColumnData(t),a=null;e.is(i._bulkTableModel.getColumnHeader(t).attributes.baseConfigurationId)&&(a=i._bulkTableModel.getColumnHeader(t).attributes.baseConfigurationId);var s=o.buildSolverInputFormat(n,!1,a||null);if(s.configurationCriteria.length>0){if(await new Promise((t,n)=>{e.is(a,"string")&&!l.isBaseConfigurationAdded(a,i._solverKey)?r.getConfigurationDetailsBC({id:a,parentID:i._modelId}).then(e=>{if(e.member&&e.member[0]){for(var o=e.member[0].selectedCriteria.member,s=[],r=0;r<o.length;r++)s.push({Id:o[r].id,State:i._bulkTableModel.convertBCStatusToPCStatus(o[r].status)});i._mapBCsSelectedCriteria[a]=s}l.addBaseConfigurations(e,i._solverKey,!0).then(()=>{t()}).catch(()=>{n(new Error("addBaseConfigurations failed"))})}).catch(()=>{n(new Error("getConfigurationDetailsBC failed"))}):t()}),this._bulkTableModel.checkConflictInBC(i._mapBCsSelectedCriteria[a])){c.showError({title:u.BC_conflict_title,message:u.BC_conflict_message});var d=this._bulkTableModel.getVariabilityValuesMap(),p=this._bulkTableModel.getParametersMap();return this._bulkTableModel.updateJsonModel(o.convertSolverConfigurationJson(this._bcSelectedCriteria,void 0,d,p,{}),t),e.Promise.resolve()}return l.CallSolveWithoutDignoseMethodOnSolver(s,i._solverKey)}return e.Promise.resolve()}},checkStatusOfPC:function(t){if(t>=0){var i=this._bulkTableModel.getColumnData(t),n=null;e.is(this._bulkTableModel.getColumnHeader(t).attributes.baseConfigurationId)&&(n=this._bulkTableModel.getColumnHeader(t).attributes.baseConfigurationId);var a=o.buildSolverInputFormat(i,!0,n||null);return l.CallSolveMethodOnSolver(a,this._solverKey)}return e.Promise.resolve()},applySolverAnswer:function(t,i){if(t){var n=JSON.parse(t),a=n._rc;if("OK"===a){var s=n._data.configurationCriteria,r=n._data.conflicts;if(e.is(r,"array")&&this.retrieveCriteriaInConflict(r,{},s,i),this._editionflag||!this._editionflag&&e.is(r,"array")||"solveAndDiagnoseAll"===n._answer){var l=this._bulkTableModel.getVariabilityValuesMap(),d=this._bulkTableModel.getParametersMap();this._bulkTableModel.updateJsonModel(o.convertSolverConfigurationJson(s,void 0,l,d,this.configCriteriaMap),i)}}else"ERROR"===a&&console.error("ERROR solve notification")}},abortSolverCall:function(){return l.abortSolverCall(this._solverKey)},removeBaseConfigurations:function(e){return l.removeBaseConfigurations([e],this._solverKey)},setSelectionModeOnSolver:function(){var e=this;this.abortSolverCall().then(function(){l.setSelectionModeOnSolver("Select_ProposedSelection",e._solverKey).then(function(t){t&&("OK"===JSON.parse(t)._rc&&(0===e._arrayColumnIDsToCheck.length&&(e._arrayColumnIDsToCheck=e._arrayColumnIDsToCheck.concat(e._arrayColumnIDsChecked)),e._pauseCheckConflictCall=!1,e.checkConflictOfAllPCs()))},function(){console.error("Error set selection complete mode in solver")})},function(){console.error("Error abort solver PCs Bulk Edit on set selection change mode")})},callSolverOnSelectedIDsMethodOnSolver:function(t,i){var n=this;if(t>=0&&i>=0)return this.abortSolverCall().then(function(){var a=n._bulkTableModel.getColumnData(t),s=n._bulkTableModel.getColumnHeader(t).attributes.baseConfigurationId,r=o.buildSolverInputFormat(a,!1,s||null),d=n._bulkTableModel.getMatrixCellData(t,i),p=n.getIDsToDiagnose(d);if(r=e.merge({idsToDiagnose:p},r),n._bulkTableModel.checkConflictInBC(n._mapBCsSelectedCriteria[s])){c.showError({title:u.BC_conflict_title,message:u.BC_conflict_message});var h=n._bulkTableModel.getVariabilityValuesMap(),m=n._bulkTableModel.getParametersMap();return n._bulkTableModel.updateDropDownData(o.convertSolverConfigurationJson(answerConfigurationCriteria,p,h,m,{}),t),e.Promise.resolve()}return l.CallSolverOnSelectedIDsMethodOnSolver(r,n._solverKey).then(function(i){if(i){var a=JSON.parse(i);if("OK"===a._rc){var s=a._data.configurationCriteria;n._pauseCheckConflictCall=!1;var r=n._bulkTableModel.getVariabilityValuesMap(),l=n._bulkTableModel.getParametersMap();return n._bulkTableModel.updateDropDownData(o.convertSolverConfigurationJson(s,p,r,l,n.configCriteriaMap),t),e.Promise.resolve()}}},function(){console.error("Error on solve And Diagnose")})},function(){console.error("Error abort solver PCs Bulk Edit on solve And Diagnose")})},_updateDGVColumn:function(e){this._dataGridView.updateRenderedColumn(e,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})},retrieveCriteriaInConflict:function(e,t,i,n){if(this.configCriteriaMap={},e&&e.length>0)for(var a=0;a<e.length;a++){var o=e[a];void 0===this.configCriteriaMap[o]&&(this.configCriteriaMap[o]={conflictingRules:t[0]})}this.countConflictInColumn(n)},getIDsToDiagnose:function(e){var t=[];if(e&&e.dropDownData&&e.dropDownData.length>0)for(var i=0;i<e.dropDownData.length;i++)t.push(e.dropDownData[i].id);return t},_updateConflictLoadingState:function(e){var t=this._arrayColumnIDsToCheck.length,i=Math.floor(100*e/t);i>100&&(console.error("Caution there is an issue where the % of conflict compute is over than 100"),i=100);var n={id:"statusComputing",text:h.Status_Computing+" : "+i+"%",icon:100===i?"check":"clock"};this._updateStatusBar(n)},_showConflictingPanel:function(e){this._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:d.render(e)}})},_getRuleDetails:function(e,t){var i=this;r.getRuleDetailsFromIds(e,function(e){var n={},a=i._getConflictDetails(e.member,t);n.reasons=a,n.wsData=e,i._showConflictingPanel(n)},function(){console.error("getRuleDetails: Service Call Failed !!!"),c.showError(u.GetRuleDetailsError)})},_getConflictDetails:function(t,i){var n={};n.privateChannelForRules=this._privateChannelForRules;for(var a=[],o=0;o<t.length;o++)a.push(t[o]);if(n.causingRulesList=a,n.type="ConfigConflict",n.drivingCombinationValuesText=u.Option+" "+i+" "+u.isConflictingWith+" : ",this.configCriteriaMap){var s=this._bulkTableModel.getVariabilityValuesMap();for(var r in this.configCriteriaMap)if(r&&e.is(r,"string")&&e.is(s[r])){var l=s[r].variabilityValue,d=s[r].rowID;if(l&&l.title!==i){var c=this._bulkTableModel.getRowHeaderData(d);n.drivingCombinationValuesText+=c.title,n.drivingCombinationValuesText+="["+l.title+"]"}}}return n},removeLoadedPC:function(e){this._parent(e)},removeAllLoadedPCs:function(){this._parent()},getNbLoadedPCs:function(){return this._parent()},getCellData:function(e){var t=e.columnID-3,i=e.rowID;return this._bulkTableModel.getMatrixCellData(t,i)},getReferenceCellData:function(e){var t,i=e.rowID,n=this._bulkTableModel.getColumnAsReferenceData();return n&&(t=n[i]),t},registerCellContent:function(){this._parent();var n=this,a={C:"",A:"",S:"lightbulb",R:"lock",D:"favorite-on",I:"block",M:"user-delete",Conflict:"alert"};this._dataGridView.registerReusableCellContent({id:"_autoComplete",buildContent:function(){var o=new s({elementsTree:new i,allowFreeInputFlag:!1,allowResetToUndefinedByUIFlag:!1}),r=e.createElement("div",{styles:{width:"100%"}});r.classList.add("autocomplete-content");var l={setTemplateOptions:function(i){var o=i.items,s=[];this.id=i.id,this.referenceId=i.referenceId,this.icon=i.image,this.cellInfos=i.cellInfos,this.stateValidity=i.stateValidity,this.state=i.state,t.removeAllEventsOnElement(this),this.autocomplete.multiSearchMode=i.multiSelect;var l={};if(void 0!==this.referenceId&&this.referenceId!==this.id){var d=this.autocomplete.getContent().querySelector(".wux-ui-state-undefined");d&&(d.classList.add("highlight-autoComplete-singleValue"),r.classList.add("highlight-background"))}r.addContent(this.autocomplete.getContent()),this.stateValidity&&"C"===this.stateValidity?(this.wrongBtn.setContent(t.generateIcon({iconName:"wrong"})),this.conflictBtn.setContent(t.generateIcon(a.Conflict)),this.checkBtn.setStyle("visibility","hidden"),this.wrongBtn.setStyle("visibility","visible"),this.wrongBtn.classList.add("pc-bulk-wrong"),this.conflictBtn.classList.add("pc-bulk-conflict"),r.addContent(this.conflictBtn),r.addContent(this.autocomplete.getContent()),this.conflictBtn.setStyle("padding-left","25px"),r.addContent(this.wrongBtn),s=[this.icon,a[this.state]]):this.state&&("S"===this.state?(this.checkBtn.setContent(t.generateIcon({iconName:"check"})),this.checkBtn.setStyle("visibility","visible"),this.wrongBtn.setContent(t.generateIcon({iconName:"wrong"})),this.wrongBtn.setStyle("visibility","visible"),this.checkBtn.classList.add("pc-bulk-check"),r.setStyle("width","calc( 100% - 18px)"),r.addContent(this.checkBtn),this.wrongBtn.classList.add("pc-bulk-wrong"),r.addContent(this.wrongBtn),s=[this.icon,a[this.state]]):"D"===this.state?(this.checkBtn.setContent(t.generateIcon({iconName:"check"})),this.checkBtn.setStyle("visibility","visible"),this.wrongBtn.setContent(t.generateIcon({iconName:"wrong"})),this.wrongBtn.setStyle("visibility","visible"),this.checkBtn.classList.add("pc-bulk-check"),r.setStyle("width","calc( 100% - 18px)"),r.addContent(this.checkBtn),this.wrongBtn.classList.add("pc-bulk-wrong"),r.addContent(this.wrongBtn),s=[this.icon,a[this.state]]):"U"===this.state||"M"===this.state?(this.icon="",s=[this.icon]):"C"===this.state?(this.wrongBtn.setContent(t.generateIcon({iconName:"wrong"})),this.wrongBtn.setStyle("visibility","visible"),this.wrongBtn.classList.add("pc-bulk-wrong"),r.addContent(this.wrongBtn),s=[this.icon,a[this.state]]):(this.checkBtn.setStyle("visibility","hidden"),this.wrongBtn.setStyle("visibility","hidden"),s=[this.icon,a[this.state]])),this.autocomplete.updateIcons(s);var c=o.map(i=>(l[i.id]=i.state,i.state&&"S"===i.state&&(this.checkBtn.setContent(t.generateIcon({iconName:"check"})),this.checkBtn.setStyle("visibility","visible")),e.merge({value:i.id,label:i.title,icons:[i.image,a[i.state]],stateIcon:a[i.state],grid:i},i)));if(this.autocomplete.elementsTree.removeRoots(),this.autocomplete.elementsTree.loadModel(c),this.id&&"M"!==this.state)this.autocomplete.value=this.id,r.value=this.id;else{var p="";for(var u in l)l.hasOwnProperty(u)&&("R"!==l[u]&&"D"!==l[u]&&"S"!==l[u]||(p=u));this.autocomplete.value=p,r.value=p}t.addEventOnElement(this,this.autocomplete,"change",this.onChange),t.addEventOnElement(this,this.autocomplete,"show",this.onShow),this.updateToken&&n._privateChannel.unsubscribe(this.updateToken),this.updateToken=n._privateChannel.subscribe({event:"bulkedit-autocomplete/"+this.cellInfos.rowID+"/"+this.cellInfos.columnID},this.update.bind(this)),this.autocomplete._cellContent=this},autocomplete:o,checkBtn:e.createElement("span",{styles:{display:"inline-block"}}),conflictBtn:e.createElement("span",{styles:{display:"inline-block"}}),wrongBtn:e.createElement("span",{styles:{display:"inline-block"}}),getTemplateContent:function(){return r},onChange:function(e){var t=e.dsModel;l.value=t.value,r.value=t.value},onShow:function(){n._privateChannel.publish({event:"bulk-edit-on-dropdown-show",data:{cellInfos:this._cellContent.cellInfos,autocomplete:this}})},update:function(t){if(t){var i=this.autocomplete.elementsTree.getAllDescendants();if(t.length===i.length)for(var n=0;n<t.length;n++)if(i[n].options.id===t[n].id){var o=[t[n].image,a[t[n].state]];if(this.autocomplete.elements.popup){var s=this.autocomplete.elements.popup.elements.container.querySelector(".wux-layouts-gridengine-poolcontainer-rel").getChildren()[n+1];"I"===t[n].state?s.classList.add("drop-down-item-disabled"):s.classList.contains("drop-down-item-disabled")&&s.classList.remove("drop-down-item-disabled")}i[n].updateOptions({icons:o,stateIcon:a[this.state],grid:t[n]}),this.autocomplete.value===i[n].options.id&&this.autocomplete.updateIcons(o)}}e.log("update autocomplete..")}};return l}}),this._dataGridView.registerReusableCellContent({id:"_autoCompleteMultiple",buildContent:function(){var o=new s({elementsTree:new i,allowFreeInputFlag:!1,allowResetToUndefinedByUIFlag:!1}),r=e.createElement("div",{styles:{width:"100%"}});r.classList.add("autocomplete-multiple-content");var d={setTemplateOptions:function(i){var o=i.items;this.referenceValues=i.referenceValues,this.selectedValues=i.values,this.cellInfos=i.cellInfos,t.removeAllEventsOnElement(this);var s={},d=o.map(t=>(s[t.id]=t.state,e.merge({value:t.id,label:t.title,icons:[t.image,a[t.state]],stateIcon:a[t.state],grid:t},t)));this.autocomplete.elementsTree.removeRoots(),this.autocomplete.elementsTree.loadModel(d);var c,p=this.autocomplete._selectionChips._items;if(this.selectedValues){for(var u=[],h=0;h<this.selectedValues.length;h++)"M"!==this.selectedValues[h].state&&u.push(this.selectedValues[h].id);this.autocomplete.value=u,r.value=u}else{var m="";for(var _ in s)s.hasOwnProperty(_)&&("R"!==s[_]&&"D"!==s[_]&&"S"!==s[_]||(m=_));this.autocomplete.value=m,r.value=m}for(h=0;h<this.selectedValues.length;h++){var v=-1;if(this.autocomplete.value&&(v=e.is(this.autocomplete.value,"array")?this.autocomplete.value.indexOf(this.selectedValues[h].id):0),-1!=v){var f=e.createElement("span",{styles:{display:"inline-block",width:"10px"}}),g=e.createElement("span",{styles:{display:"inline-block"}}),b=e.createElement("span",{styles:{display:"inline-block"}});if("V"===this.selectedValues[h].stateValidity){if(("S"===this.selectedValues[h].state||"D"===this.selectedValues[h].state||"R"===this.selectedValues[h].state)&&(g.setContent(t.generateIcon({iconName:"check"})),g.setStyle("visibility","visible"),p.length&&p[v])){var E=p[v].associatedChipCellView.querySelector(".wux-ui-3ds-close");g.classList.add("pc-bulk-check-option");var C=this.selectedValues[h],y=this.cellInfos;g.onclick=function(e,t){var i={id:e.id,state:"C"};n._dataGridView.setModelAt(this.cellID,[i])}.bind(y,C),p[v].associatedChipCellView.addContent(g,E),"R"===this.selectedValues[h].state&&E.classList.add("displaynone")}}else if(b.setContent(t.generateIcon({iconName:"alert"})),b.setStyle("visibility","visible"),p.length&&p[h]){var S=p[v].associatedChipCellView.querySelector(".wux-ui-3ds-close");b.classList.add("pc-bulk-conflict-option-edit");C=this.selectedValues[h],y=this.cellInfos;var D=this.autocomplete;b.onclick=function(e,t,i){this.fire("hide"),t.id&&n.configCriteriaMap&&l.getConflictingAssumptionsCausingRules(n._solverKey,!0).then(e=>{e&&e.length>0&&n._getRuleDetails(e,t.title)})}.bind(D,y,C),p[v].associatedChipCellView.insertBefore(b,S)}if(f.setContent(t.generateIcon({iconName:a[this.selectedValues[h].state]})),f.setStyle("visibility","visible"),p.length&&p[v]&&p[v].associatedChipCellView.insertBefore(f,p[v].associatedChipCellView.children[0]),this.referenceValues)this.referenceValues.some(e=>e.id===this.selectedValues[h].id)||p[v].associatedChipCellView.classList.add("highlight-autoComplete-multiValue")}}if(this.selectedValues.length>=0&&this.referenceValues&&(this.referenceValues.length>0&&(this.selectedValues.length===this.referenceValues.length&&(c=this.referenceValues.filter(e=>!this.selectedValues.some(t=>e.id===t.id))),c&&c.length>0||this.referenceValues.length>this.selectedValues.length||this.referenceValues.length<this.selectedValues.length))){var M=this.autocomplete.getContent().querySelector(".wux-ui-state-undefined");if(M){M.classList.add("highlight-autoComplete-singleValue");var I=this.autocomplete.getContent().querySelector(".wux-controls-autoComplete-selectionChips");I&&(I.classList.add("highlight-autoComplete-multiValue"),r.classList.add("highlight-background"))}}r.addContent(this.autocomplete.getContent()),t.addEventOnElement(this,this.autocomplete,"change",this.onChange),t.addEventOnElement(this,this.autocomplete,"show",this.onShow),this.updateToken&&n._privateChannel.unsubscribe(this.updateToken),this.updateToken=n._privateChannel.subscribe({event:"bulkedit-autocomplete/"+this.cellInfos.rowID+"/"+this.cellInfos.columnID},this.update.bind(this)),this.autocomplete._cellContent=this},autocomplete:o,getTemplateContent:function(){return r},onChange:function(e){var t=e.dsModel;d.value=t.value,r.value=t.value,n._dataGridView.layout.resetRowHeight(t._cellContent.cellInfos.rowID)},onShow:function(){n._privateChannel.publish({event:"bulk-edit-on-dropdown-show",data:{cellInfos:this._cellContent.cellInfos,autocomplete:this}})},update:function(t){if(t){var i=this.autocomplete.elementsTree.getAllDescendants();if(t.length===i.length)for(var n=0;n<t.length;n++)if(i[n].options.id===t[n].id){var o=[t[n].image,a[t[n].state]];if(this.autocomplete.elements.popup){var s=this.autocomplete.elements.popup.elements.container.querySelector(".wux-layouts-gridengine-poolcontainer-rel").getChildren()[n+1];"I"===t[n].state?s.classList.add("drop-down-item-disabled"):s.classList.contains("drop-down-item-disabled")&&s.classList.remove("drop-down-item-disabled")}i[n].updateOptions({icons:o,stateIcon:a[t[n].state],grid:t[n]}),this.autocomplete.value===i[n].options.id&&this.autocomplete.updateIcons(o)}}e.log("update autocomplete..")}};return d}})},destroy:function(){this._parent()},refresh:function(){this._dataGridView&&this._parent()},inject:function(e){this._parent(e)},getContent:function(){return this._parent()},saveElement:function(e){var t=this._createPersistancyInstance(e.id,!1);if(t)return r.updateProductConfiguration({instances:t,objectID:e.id,parentID:e.parentId,attributes:{rulesMode:"RulesMode_SelectCompleteConfiguration",selectionMode:"selectionMode_Build",rulesActivation:"true",rulesCompliancyStatus:"Valid",completenessStatus:"Complete"}})},_createPersistancyInstance:function(e,t){var i=this._bulkTableModel.getColumnData(this._bulkTableModel.getColumnID(e));return o.buildPersistencyInputFormat(i,t)}})}),define("DS/ENOXModelApp/ModelDefinition/js/UnitsStatePresenter",["UWA/Core","DS/CoreEvents/ModelEvents","DS/Utilities/StringUtils","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/components/ContextSelector/AutocompleteManager","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/components/DialogCreation/UnitDialogCreation","DS/EditPropWidget/constants/EditPropConstants","DS/xModelEventManager/xModelEventManager","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/ENOXModelApp/components/ContextSelector/AutocompleteContextSelector","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/WebappsUtils/WebappsUtils","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/ModelDefinition/js/UnitsFilterAndDataManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelDictionaryUtility","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/UnitsStatePresenter","css!DS/ENOXModelApp/ModelDefinition/css/UnitStatePresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T){"use strict";var x=function(){};return x.prototype.init=function(e,i){this._pathUnits=[D._KEY,D._VIEWS_PREFERENCES,D._MY_UNITS],this._xModelListView=null,this._applicationChannel=e,this._updateChannelLocal=new t,this._privateChannel=new t,this._defaultFilter={owned_by_me:!0,owned_by_my_organizations:!1,maturity_state:{state_plan:!0,state_build:!0,state_internalTest:!0,state_externalTest:!1,state_complete:!1,state_release:!1,state_obsolete:!1}},this.getOrganizationsForCurrentUser(),this._myEventManager=new l(this._applicationChannel,this._updateChannelLocal,this._privateChannel),this._unitsFilterAndDataManager=new S({defaultFilter:this._defaultFilter,updateChannel:this._updateChannelLocal,currUserOrgs:this._currUserOrgsList}),this.autocompleteManager=new a,this._x3DSearch=new u,this._infoContext=y.ROUTE_MY_UNITS,this.getUnitFilterPreferences(),o.initialize({applicationChannel:this._applicationChannel,context:this._infoContext,silent:!0,editMode:!0}),this._modelLoaded=!1,this.loadContextModel(),this._subscribeEvent(),this._relatedObjectsCmd=new A,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._initializeListView(),this._initDOM(),this._initCommand()},x.prototype.inject=function(e){e.appendChild(this._container)},x.prototype._initDOM=function(){this._container=e.createElement("div"),this._container.classList.add("xmodel-units"),this._xModelListView.inject(this._container)},x.prototype.getOrganizationsForCurrentUser=function(){try{var t=window.widget?window.widget:void 0;if(t){var i={},n=t.getPreference("xPref_CREDENTIAL");n&&n.options&&n.options.length>0&&n.options.forEach(function(e){var t=e.value?e.value:void 0;if(void 0!==t){var n=(t=t.trim()).substring(t.indexOf(".")+1,t.lastIndexOf("."));n&&n.trim()&&(n=n.trim(),i[n]=!0)}}),Object.keys(i).length>0&&(this._currUserOrgsList=Object.keys(i))}}catch(t){e.log("Error! While obtaining organizations for current user."+t.message)}},x.prototype.getUnitFilterPreferences=function(){var t=I.getFilter(this._pathUnits);void 0===t||void 0===Object.keys(t)||0===Object.keys(t).length?this._currFilterPreferences=this._defaultFilter:this._currFilterPreferences=e.clone(t)},x.prototype.deactivateTags=function(){},x.prototype._initCommand=function(){this._command=new v(this._updateChannelLocal,this._container,this._applicationChannel)},x.prototype.showInformation=function(e,t,i,n){var a=e.id?e.id:void 0;if(a){this.activateFacet("Planning",n,e),o.showInformation(a,t,i)}},x.prototype.deactivateFacet=function(){o.removeFacet("Planning",this._infoContext),this._currentFacet=null},x.prototype.createDeleteUnitDialog=function(e,t){var i={listItems:e,type:"delete",single:T.singleUnit,multiple:T.multipleUnits,modelEvent:t,immersiveFrame:w.getImmersiveFrame()};n.showDialog(i)},x.prototype.activateFacet=function(e,t,i){if(e){var n=T.get("plan"),a=i.length>1,s=a?[]:[r.ACTION_SWITCH],l={require:"DS/ENOXModelApp/InformationPanels/UnitsPlanningTab/PlanningTab",position:4,facet:{name:e,text:n,eventThread:"units",icon:"fonticon fonticon-list-ok"},options:{isEditable:!0,isUnitFrozen:!0,privateChannel:this._privateChannel,model:i,multiselection:a},alwaysVisible:!0,actions:s};o.addFacet({name:e,facet:l},this._infoContext)}},x.prototype._deleteUnits=function(e){console.log("delete data");var t=this;if(e){var i,n,a=[],o={};if(e.length>1)for(n=0;n<e.length;n++)o={identifier:e[n]},a.push(o);1==e.length&&(o={identifier:e[0]},a.push(o)),i={items:a},t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),C.deleteUnits(i).then(function(i){t._updateChannelLocal.publish({event:"xmodel-list-data-item-remove-action",data:e}),t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showSuccess(T.DELETION_SUCCESSFUL)},function(e){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showError(T.DELETION_FAILED)})}},x.prototype._createUnit=function(e){var t=this;if(e&&e.mvId&&e.content){var i=e.content,n={},a=e&&e.plannedBuildDate&&null!=e.plannedBuildDate?e.plannedBuildDate:"",o=e&&e.dateShipped&&null!=e.dateShipped?e.dateShipped:"",s=[],r={description:i&&i.description?i.description:"",noOfUnits:i&&i.units?Number(i.units):1,modelVersion:{identifier:e.mvId},productConfiguration:{identifier:e.pcId?e.pcId:""},manufacturingPlan:{identifier:e.mpId?e.mpId:""},attributes:{plannedDate:""!=a?a.toLocaleDateString("en-US"):"",dateShipped:""!=o?o.toLocaleDateString("en-US"):""}};s.push(r),n.items=s,t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),C.createUnit(n).then(function(e){var i;if(e&&e.member&&(1==e.member.length&&((i=e.member[0]).id=i.identifier,t._updateChannelLocal.publish({event:"xmodel-list-data-item-add-action",data:i}),t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"})),e.member.length>1)){let i;for(i=0;i<e.member.length;i++)e.member[i].id=e.member[i].identifier;t._updateChannelLocal.publish({event:"xmodel-list-data-item-append-action",data:{member:e.member}}),t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"})}t._privateChannel.publish({event:"enox-dialog-creation-done",data:!0}),P.showSuccess(T.CREATION_SUCCESSFUL)},function(e){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"enox-dialog-creation-done",data:!0}),P.showError(T.ERR_CREATION_FAILED)})}else t._privateChannel.publish({event:"enox-dialog-creation-done",data:!0}),P.showError(T.ERR_CREATION_FAILED)},x.prototype.activateTags=function(){console.log("Activate tags units page")},x.prototype.loadContextModel=function(){if(this._modelLoaded)this.ctxSelector.loadData(!0);else{let e={modelEvents:this._updateChannelLocal,className:"unit_context",loadOnRefresh:!1,path:this._pathUnits,type:"Model",autocompleteManager:this.autocompleteManager};this.ctxSelector=new _(e),this.modelContext=this.ctxSelector.getModelContext();let t={type:"Model",NLS:T.Search_For_Model};this.contextSetting=this.ctxSelector.setContextSetting(t);let i={modelContext:this.modelContext,view:this,NLS:T.Error_Setting_Context};this.detailDisplay=this.ctxSelector.setDetailDisplay(i),this._modelLoaded=!0}},x.prototype.injectContextSelector=function(){var e=document.querySelector(".unit_context");null==e&&null==e||this.detailDisplay.render().inject(e)},x.prototype._checkIfFilterButtonNeedChange=function(){var e=this._checkIfAnyObjPropertyIsTrue(this._currFilterPreferences);this._updateChannelLocal.publish({event:"xmodel-list-collection-toolbar-update-filter-menu-status",data:{selected:e||!1,id:"mv-filter"}})},x.prototype._checkIfAnyObjPropertyIsTrue=function(t){var i=!1;for(var n in t){if(!0===t[n]){i=!0;break}e.is(t[n],"object")&&(i=this._checkIfAnyObjPropertyIsTrue(t[n]))}return i},x.prototype._refreshListView=function(e,t){var i=this;if(t){var n,a=[],s={identifier:t};a.push(s),n={items:a},i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),C.getUnitDetails(n).then(function(e){let t=e.member[0];t.id=t.identifier,i._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:t}),o.removeAllSelection(i._infoContext),o.addSelection(t.id,i._infoContext,!1),i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showSuccess(T.UNIT_UPDATED)},function(e){i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showError(T.UNIT_UPDATION_FAILED)})}},x.prototype._fetchDataHandler=function(t,i){var n=this;n._unitsFilterAndDataManager._fetchData(t,i).then(function(e){var i=void 0!==t;if(e){var a=e.currentCount===e.numberOfHits,o=e.currentCount/e.numberOfHits*100;M.allSettled().then(function(){n._updateChannelLocal.publish({event:"evt-populate-xmodel-list",data:{items:e.items,append:i,loadComplete:a}})}),n._updateChannelLocal.publish({event:"evt-update-xmodel-list-progress-bar",data:{progress:o}}),e.nextRequestData&&n._updateChannelLocal.publish({event:"evt-perform-search-for-next-lot",data:{nextRequestData:e.nextRequestData,currentCount:e.currentCount}})}},function(){e.log("Warning!! perfrom search rejected"),n._updateChannelLocal.publish({event:"xmodel-list-data-load-action",data:{}}),n._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),n._updateChannelLocal.publish({event:"xmodel-list-hide-progress-bar"})})},x.prototype._checkContextFilterInjected=function(){let e=document.querySelector(".unit_context");if(!e)return!1;if(document.querySelector(".ds-dialog.ds-detail-display.ddv-view"))return!0;let t=e.closest(".wux-button-icon-placeholder");return t?(t.classList.remove("wux-button-icon-placeholder"),t.removeChild(t.firstChild),t.classList.add("wux-tweakers"),t.classList.add("wux-tweakers-string"),t.classList.add("unit_context")):e.removeChild(e.firstChild),!1},x.prototype._subscribeEvent=function(){var t=this;this._myEventManager.subscribe(this._updateChannelLocal,"evt-populate-xmodel-list",function(i){if(i&&i.items&&i.items.length>0&&(e.log(">> evtData.items:  "+i.items.length),t._updateChannelLocal.publish({event:i.append?"xmodel-list-data-item-append-action":"xmodel-list-data-load-action",data:{member:i.items}}),i.loadComplete)){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"});var n=I.getSelectedItems(t._pathUnits);n&&n.length>0&&t._updateChannelLocal.publish({event:"xmodel-list-selection-action",data:n});var a=I.getGroup(t._pathUnits);t._updateChannelLocal.publish({event:"xmodel-list-view-group-by-action",data:a}),t._updateChannelLocal.publish({event:"enox-collection-toolbar-sort-activated",data:I.getSort(t._pathUnits)})}}),this._myEventManager.subscribe(this._updateChannelLocal,"xmodel-units-context-selector-filter",function(e){t._updateChannelLocal.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"unit_context",flag:e}}),t._updateChannelLocal.publish({event:"enox-model-app-inject-context-selector",data:e})}),this._myEventManager.subscribe(this._updateChannelLocal,"xmodel-list-fetch-connected-objects",function(e){t._fetchDataHandler(e.input,e.model)}),this._myEventManager.subscribe(this._updateChannelLocal,"evt-update-xmodel-list-progress-bar",function(i){i&&i.progress&&(e.log(">> evtData.progress:  "+i.progress),t._updateChannelLocal.publish({event:"xmodel-list-update-progress-bar",data:i.progress}))}),this._myEventManager.subscribe(this._updateChannelLocal,"evt-perform-search-for-next-lot",function(e){e&&e.nextRequestData&&t.ctxSelector.loadData(!1,e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-link-click"},function(e){t._updateChannelLocal.publish({event:"xmodel-execute-command",data:e})}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._updateChannelLocal,e,this)}),this._myEventManager.subscribe(this._privateChannel,{event:"update-allocation-singleselect"},function(e){if(e){var i={},n=[],a={identifier:e.unitId,modelVersion:{identifier:e.mvId},productConfiguration:{identifier:e.pcId},manufacturingPlan:{identifier:e.mfgId}};n.push(a),i.items=n,t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),C.updateAllocations(i).then(function(e){var i;e&&e.member&&(1==e.member.length&&((i=e.member[0]).id=i.identifier,t._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:i}),t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showSuccess(T.Unit_Updated)))},function(e){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showError(T.Unit_Update_Failed)})}}),this._myEventManager.subscribe(this._privateChannel,{event:"update-allocation-multiSelect"},function(e){if(e){var i,n=0,a={},o=[],s=e.Units;for(n=0;n<s.length;n++)i={identifier:s[n],modelVersion:{identifier:e.data.mvId},productConfiguration:{identifier:e.data.pcId},manufacturingPlan:{identifier:e.data.mfgId}},o.push(i);a.items=o,t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),C.updateAllocations(a).then(function(e){if(e&&e.member){var i,n;for(n=0;n<e.member.length;n++)(i=e.member[n]).id=i.identifier,t._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:i});t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showSuccess(T.Units_Updated)}},function(e){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showError(T.Units_Update_Failed)})}}),this._myEventManager.subscribe(this._privateChannel,{event:"move-Units-singleselect"},function(e){if(e){var i={},n=[],a={identifier:e.unitId,modelVersion:{identifier:e.mvId},productConfiguration:{identifier:e.pcId},manufacturingPlan:{identifier:e.mfgId}};n.push(a),i.items=n,t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),C.moveUnits(i).then(function(e){var i;e&&e.member&&(1==e.member.length&&((i=e.member[0]).id=i.identifier,t._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:i}),t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showSuccess(T.Unit_Updated)))},function(e){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showError(T.Unit_Update_Failed)})}}),this._myEventManager.subscribe(this._privateChannel,{event:"move-Units-multiSelect"},function(e){if(e){var i,n=0,a={},o=[],s=e.Units;for(n=0;n<s.length;n++)i={identifier:s[n],modelVersion:{identifier:e.data.mvId},productConfiguration:{identifier:e.data.pcId},manufacturingPlan:{identifier:e.data.mfgId}},o.push(i);a.items=o,t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),C.moveUnits(a).then(function(e){if(e&&e.member){var i,n;for(n=0;n<e.member.length;n++)(i=e.member[n]).id=i.identifier,t._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:i});t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showSuccess(T.Units_Updated)}},function(e){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showError(T.Units_Update_Failed)})}}),this._myEventManager.subscribe(this._privateChannel,{event:"update-dates"},function(e){if(e){var i,n=0,a={},o=[],s=e.units,r=e.updatedDates;for(n=0;n<s.length;n++)i={identifier:s[n],attributes:{plannedDate:r.plannedDate?r.plannedDate.replace(",",""):"",dateShipped:r.dateShipped?r.dateShipped.replace(",",""):""}},o.push(i);t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),a.items=o,C.updateUnits(a).then(function(e){if(e&&e.member){var i,n;for(n=0;n<e.member.length;n++)(i=e.member[n]).id=i.identifier,t._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:i});t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showSuccess(T.Date_Updation_Successful)}},function(e){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),P.showError(T.Date_Updation_Failed)})}}),this._privateChannel.subscribe({event:"enox-dialog-update-on-select"},function(e){t.autocompleteContent.elements.container.firstChild.firstChild.value=e.title;let i=new m({value:e.title,label:e.title});i.options.grid.id=e.id,t.autocompleteContent.selectedItems=i}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-creation"},function(e){t._createUnit(e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-add-selection"},function(e){var i=e.model,n=[],a=[];if(e&&e.items)for(var s=0;s<e.items.length;s++){e.items[s].options.grid.state;n.push(e.items[s].options.id),a.push(e.items[s])}e.items.length>1&&(t.deactivateFacet(),t.activateFacet("Planning",!0,a)),1==e.items.length&&(t.deactivateFacet(),t.activateFacet("Planning",!0,e.items));let r=[];!0===e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;r.push(t)}):r.push(i.id),o.addSelection(r,t._infoContext,!1),I.updateSelectedItems(t._pathUnits,n)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-remove-selection"},function(e){var i=e.model,n=[],a=[];if(e&&e.items)for(var s=0;s<e.items.length;s++){e.items[s].options.grid.state;a.push(e.items[s].options.id),n.push(e.items[s])}e.items.length>1?(t.deactivateFacet(),t.activateFacet("Planning",!0,n)):(t.deactivateFacet(),t.activateFacet("Planning",!0,i));let r=[];1==e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;r.push(t)}):r.push(i.id),o.removeSelection(r,t._infoContext,!1),I.updateSelectedItems(t._pathUnits,a)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"enox-dialog-delete"},function(e){t._deleteUnits(e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-view-group-by-action"},function(e){I.updateGroup(t._pathUnits,e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-collection-toolbar-filter-changed"},function(e){if(e){var i=!1;if(e.parentId){var n=t._currFilterPreferences.hasOwnProperty(e.parentId);n&&(n=!1,(n=t._currFilterPreferences[e.parentId].hasOwnProperty(e.id))&&(t._currFilterPreferences[e.parentId][e.id]=e.selected,i=!0))}else if(e.id&&"maturity_state"!==e.id){t._currFilterPreferences.hasOwnProperty(e.id)&&(t._currFilterPreferences[e.id]=e.selected,i=!0)}i&&(t._updateChannelLocal.publish({event:"unit-filter-criteria-update",data:{filterCriteria:t._currFilterPreferences}}),t._checkIfFilterButtonNeedChange(),I.updateFilter(t._pathUnits,t._currFilterPreferences),t.ctxSelector.loadData(!0))}}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"list-view-update-inline-action"},function(e){if(e&&e.model&&e.name&&void 0!==e.value){var i,n,a=[];n={identifier:e.model[0].id,serialNumber:e.value},a.push(n),i={items:a},C.updateSerialNumber(i).then(function(e){var i;e&&e.member&&((i=e.member[0]).id=i.identifier,t._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:i}))},function(e){P.showError()})}})},x.prototype._initializeListView=function(){var t=this,n=new h({});this._nlsState=M.getStateValue();var a={id:"units",model:n,useDragAndDrop:!0,modelEvents:this._updateChannelLocal,withProgressBar:!0,viewOptions:{identifier:"my_units",views:["DataGridView"],currentView:I.getView(this._pathUnits),grid:{typeRepresentations:{customFloat:{stdTemplate:"spinEdit",semantics:{stepValue:1,decimal:2}}},columns:[{text:T.SERIAL_NUMBER,dataIndex:"tree",editableFlag:!0,typeRepresentation:"titleTweaker",getCellValue:function(e){return t._xModelListView.isGrouped()&&e.nodeModel.options.label?e.nodeModel.options.label:""!=e.nodeModel.options.grid.serialNumber?e.nodeModel.options.grid.serialNumber:""!=e.nodeModel.options.grid.name?e.nodeModel.options.grid.name:void 0},setCellValue:function(e,i){var n=[e.nodeModel.options.grid];t._updateChannelLocal.publish({event:"list-view-update-inline-action",data:{model:n,name:"serialNumber",value:i,cell:e}})},getCellSemantics:function(e){var t={};return e&&e.nodeModel&&e.nodeModel.options&&(t.linkDisplay=!1),t},compareFunction:function(e,t,n,a){var o="",s="";return n.options.grid.hasOwnProperty("serialNumber")?o=n.options.grid.serialNumber:n.options.grid.hasOwnProperty("name")&&(o=n.options.grid.name),a.options.grid.hasOwnProperty("serialNumber")?s=a.options.grid.serialNumber:a.options.grid.hasOwnProperty("name")&&(s=a.options.grid.name),i.compare(o,s)}},{text:O.TITLE,dataIndex:"name",visibleFlag:!1},{text:O.MATURITY_STATE,dataIndex:"state",typeRepresentation:"url",hyperlinkTarget:"_self",groupableFlag:!0,getCellValue:function(e){if(e.nodeModel.options.grid){var t=e.nodeModel.options.grid;return{label:(t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state)||t.maturity,url:"#Maturity"}}return""},getCellGroupingKey:function(e){if(e.nodeModel.options.grid){var t=e.nodeModel.options.grid;return t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state}}},{text:T.MODEL_VERSION,dataIndex:"modelVersion",groupableFlag:!0,typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){let t="",i=e.nodeModel.options.grid;return i.modelVersion&&i.modelVersion.title&&i.modelVersion.revision&&(t=i.modelVersion.title+"   "+i.modelVersion.revision),{label:t,url:"#popup_properties"}},getCellGroupingKey:function(e){let t=e.nodeModel.options.grid;if(t.modelVersion&&t.modelVersion.title&&t.modelVersion.revision)return t.modelVersion.title+"   "+t.modelVersion.revision},compareFunction:function(e,t,n,a){var o="",s="";return n.options.grid.modelVersion&&n.options.grid.modelVersion.title&&n.options.grid.modelVersion.revision&&(o=n.options.grid.modelVersion.title+"   "+n.options.grid.modelVersion.revision),a.options.grid.modelVersion&&a.options.grid.modelVersion.title&&a.options.grid.modelVersion.revision&&(s=a.options.grid.modelVersion.title+"   "+a.options.grid.modelVersion.revision),i.compare(o,s)}},{text:O.SEQUENCE_NUMBER,dataIndex:"unitNumber"},{text:T.PRODUCT_CONFIGURATION,dataIndex:"productConfiguration",typeRepresentation:"url",hyperlinkTarget:"_self",groupableFlag:!0,getCellValue:function(e){let t="",i=e.nodeModel.options.grid;return i.productConfiguration&&i.productConfiguration.title&&(t=i.productConfiguration.title),{label:t,url:"#popup_properties"}},getCellGroupingKey:function(e){let t=e.nodeModel.options.grid;if(t.productConfiguration&&t.productConfiguration.title)return t.productConfiguration.title}},{text:T.MANUFACTURING_PLAN,dataIndex:"manufacturingPlan",groupableFlag:!0,typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){let t="",i=e.nodeModel.options.grid;return i.manufacturingPlan&&i.manufacturingPlan.title&&i.manufacturingPlan.revision&&(t=i.manufacturingPlan.title+"  "+i.manufacturingPlan.revision),{label:t,url:"#popup_properties"}},getCellGroupingKey:function(e){let t=e.nodeModel.options.grid;if(t.manufacturingPlan&&t.manufacturingPlan.title&&t.manufacturingPlan.revision)return t.manufacturingPlan.title+"  "+t.manufacturingPlan.revision}},{text:T.PLANNED_BUILD_DATE,dataIndex:"plannedDate",getCellValue:function(e){if(e.nodeModel.options.grid.plannedDate)return f.formatDateAttribute(e.nodeModel.options.grid.plannedDate)}},{text:T.ACTUAL_BUILD_DATE,dataIndex:"actualDate",getCellValue:function(e){if(e.nodeModel.options.grid.actualDate)return f.formatDateAttribute(e.nodeModel.options.grid.actualDate)}},{text:T.DATE_SHIPPED,dataIndex:"dateShipped",getCellValue:function(e){if(e.nodeModel.options.grid.dateShipped)return f.formatDateAttribute(e.nodeModel.options.grid.dateShipped)}},{text:O.RESPONSIBLE,dataIndex:"owner",groupableFlag:!0},{text:O.ORGANIZATION,dataIndex:"organization",groupableFlag:!0,getCellValue:function(e){if(e.nodeModel.options.grid.organization)return M.getOrganzationNLS(e.nodeModel.options.grid.organization)||e.nodeModel.options.grid.organization}},{text:O.COLLABSPACE,dataIndex:"collabspace",groupableFlag:!0}]},contextualActions:[{id:"maturityState",title:O.get("MATURITY"),fonticon:"collaborative-lifecycle-management",handler:function(e,i){t._command._handleMaurityCommand(i)}},{type:"SeparatorItem"},{id:"changeOwnership",title:O.get("CHANGE_OWNERSHIP"),fonticon:"move-to",handler:function(e,i){t._command._handleChangeOwnerCommand(i)}},{type:"SeparatorItem"},t._relatedObjectsCmdObj,{id:"information",title:T.get("information"),fonticon:"info",handler:function(e){g.checkActionAccess({action:b.MODIFY,type:b.TYPE_UNIT,state:e.maturity?e.maturity:e.state});e&&t._applicationChannel.publish({event:"information-panel-open"})}},{type:"SeparatorItem"},{id:"Planning",title:T.get("plan"),fonticon:"fonticon fonticon-list-ok ",multiselect:!1,handler:function(e){e&&t.showInformation(e,!1,"Planning")}},{type:"SeparatorItem"},{id:"delete",title:T.get("delete"),fonticon:"trash",handler:function(e,i){if(e){var n=i.map(function(e){return{id:e.id,title:e.serialNumber}});t.createDeleteUnitDialog(n,t._updateChannelLocal)}}}]},emptyContentOptions:{sentences:[{type:"img",src:E.getWebappsAssetUrl("ENOXModelApp","icon/Build.png"),text:O.EMPTY_CONTENT_MESSAGE}]},filterAttributes:["id","title","description","responsible","owner","creator","maturity","serialNumber","unitNumber",{internal:"modelVersion",getAttribute:function(e){if(e.options.grid.hasOwnProperty("modelVersion"))return e.options.grid.modelVersion.title}},{internal:"productConfiguration",getAttribute:function(e){if(e.options.grid.hasOwnProperty("productConfiguration"))return e.options.grid.productConfiguration.title}},{internal:"manufacturingPlan",getAttribute:function(e){if(e.options.grid.hasOwnProperty("manufacturingPlan"))return e.options.grid.manufacturingPlan.title}},{internal:"state",nlsValue:"nlsState"},{internal:"type",nlsValue:"nlsType"}],withmultisel:!0,toolbarOptions:{useGeneratedToolbar:!0,touchMode:!0,showTaggerFilter:!0,filterActions:[{id:"mv-filter",text:T.filter,fonticon:"list-filter",multiSelect:!1,disabled:!0,selected:"",actions:[{id:"owned_by_me",text:T.OWNED_BY_ME,selectable:!0,multiSelect:!1,selected:this._currFilterPreferences.owned_by_me,handler:function(){e.log("OwnedByMeHandler")}},{id:"owned_by_my_organizations",text:T.OWNED_BY_MY_ORGANIZATIONS,selectable:!0,selected:this._currFilterPreferences.owned_by_my_organizations,selected:"",handler:function(){e.log("OwnedByMyOrgHandler")}},{id:"maturity_state",text:T.MATURITY_STATE,selectable:!1,multiSelect:!0,isSelected:!1,items:[{id:"state_plan",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Build.Plan"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_plan},{id:"state_build",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Build.Build"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_build},{id:"state_internalTest",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Build.Internal_Test"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_internalTest},{id:"state_externalTest",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Build.External_Test"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_externalTest},{id:"state_complete",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Build.Complete"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_complete},{id:"state_release",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Build.Release"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_release},{id:"state_obsolete",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Build.Obsolete"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_obsolete}],handler:function(){e.log("MaturityStateFilterHandler")}},{id:"contextSelector",text:T.CONTEXT_SELECTOR,selected:!0,selectable:!0,handler:function(e){t._updateChannelLocal.publish({event:"xmodel-units-context-selector-filter",data:e})}}]}],itemsName:T.get("multipleUnits"),itemName:T.get("singleUnit"),groupByActionIndex:1,withStableActions:!0,hideOnMultiSelection:["Planning"],actions:[{id:"create",text:O.CREATE,fonticon:"plus",handler:function(){let e=I.getContext(t._pathUnits);s.show({modelEvent:t._privateChannel,context:e})}},{id:"maturityState",text:O.get("MATURITY"),category:"lifecycle",showOnSelection:!0,fonticon:"collaborative-lifecycle-management",handler:function(){let e=t._xModelListView._getSelectedItem();t._command._handleMaurityCommand(e)}},{id:"changeOwnership",text:O.get("CHANGE_OWNERSHIP"),fonticon:"move-to",showOnSelection:!0,category:"collaboration",handler:function(){let e=t._xModelListView._getSelectedItem();t._command._handleChangeOwnerCommand(e)}},t._relatedObjectsCmdObj,{id:"Planning",text:T.get("plan"),fonticon:"fonticon fonticon-list-ok ",showOnSelection:!0,category:"navigation",handler:function(){let e=t._xModelListView._getSelectedItem();e[0]&&t.showInformation(e[0],!1,"Planning")}},{id:"delete",text:O.DELETE,fonticon:"trash",category:"destructive",showOnSelection:!0,handler:function(e){if(e){var i=e.map(function(e){return{id:e.grid.id,title:e.grid.serialNumber}});t.createDeleteUnitDialog(i,t._updateChannelLocal)}}}],stableActions:[{icon:{className:"unit_context"},text:T.Search_For_Model,fonticon:"search",id:"unit_context",typeRepresentation:"functionIcon",value:"",visibleFlag:!0,allowResetToUndefinedByUIFlag:!0,placeholder:T.Search_For_Model}],customTypeRepresentation:{arrayOfObj:{stdTemplate:"comboSelector",semantics:{possibleValues:[{value:"thumbnails",icon:{iconName:"view-small-tile",fontIconFamily:1}},{value:"tile",icon:{iconName:"view-big-tile",fontIconFamily:1}}]}}}},extensions:[c,p]};this._xModelListView=new d(a)},x.demoCtxSelector=function(){console.log("dummhdfdasnksfd")},x}),define("DS/ENOXModelApp/ModelDocument/js/ModelDocumentDetailsPresenter",["UWA/Core","DS/ENOXModelApp/SpecificationDetails/SpecificationFilesPresenter","DS/CoreEvents/ModelEvents","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd","DS/LifecycleCmd/MaturityCmd","DS/ENOXModelApp/InformationPanels/InformationPanelManager"],function(e,t,i,n,a,o,s,r){"use strict";var l=function(){this._genericComponentPresenter=new t};return l.prototype.init=function(t,n){this._id=n.id,n=e.merge({installVersionExplorer:this._initVersionGraphComponent.bind(this)},n),this._applicationChannel=t,this._privateChannel=new i,this._versionExplorerEvents=new i,this._initPropertyPanel(),this._genericComponentPresenter.init(t,n),this.maturityCmd=void 0,this.changeOwnerCmd=void 0},l.prototype.destroy=function(){this._genericComponentPresenter&&this._genericComponentPresenter.destroy(),r.removeAllSelection("File")},l.prototype.inject=function(e){this._genericComponentPresenter.inject(e)},l.prototype.fetchData=function(){this._genericComponentPresenter.fetchData()},l.prototype._initPropertyPanel=function(){r.initialize({applicationChannel:this._applicationChannel,context:"File",id:this._id})},l.prototype._initVersionGraphComponent=function(e){this._versionExplorer=new n({id:this._id,dataModelType:a.DATA_MODEL_TYPES.MODEL_ER,renderTo:e.container,modelEvents:this.versionExplorerEvents,applicationChannel:this._applicationChannel})},l}),define("DS/ENOXModelApp/xModelRouter/xModelRouterConfig",["UWA/Core","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/PlatformAPI/PlatformAPI","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager"],function(e,t,i,n,a,o){"use strict";return{initialize:function(){t.initialize(i.ROUTE_HOME,i.PATH_HOME),[{name:i.ROUTE_RECENTY_OPENED,path:"/"+i.PATH_RECENTY_OPENED},{name:i.ROUTE_MY_MODELS,path:"/"+i.PATH_MY_MODELS},{name:i.ROUTE_MY_UNITS,path:"/"+i.PATH_MY_UNITS},{name:i.ROUTE_DICTIONARY,path:"/"+i.PATH_DICTIONARY},{name:i.ROUTE_DICTIONARY_VARIANTS_OPTIONS,path:"/"+i.PATH_DICTIONARY_VARIANTS_OPTIONS},{name:i.ROUTE_DICTIONARY_VARIANT_DETAILS,path:"/"+i.PATH_DICTIONARY_VARIANT_DETAILS},{name:i.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS,path:"/"+i.PATH_DICTIONARY_OPTION_GROUP_DETAILS},{name:i.ROUTE_MODEL_DEFINITION,path:"/"+i.PATH_MODEL_DEFINITION},{name:i.ROUTE_MODELS,path:"/"+i.PATH_MODELS},{name:i.ROUTE_MODEL_INFO,path:"/"+i.PATH_MODEL_INFO+"/:modelVersionId"},{name:i.ROUTE_MODEL_DETAILS,path:"/"+i.PATH_MODEL_DETAILS},{name:i.ROUTE_MODEL_RULE_DETAILS,path:"/"+i.PATH_MODEL_RULE_DETAILS+"/:id"},{name:i.ROUTE_MODEL_PC_DETAILS,path:"/"+i.PATH_MODEL_PC_DETAILS+"/:id",canDeactivate:!1,canActivate:!1},{name:i.ROUTE_MODEL_BC_DETAILS,path:"/"+i.PATH_MODEL_BC_DETAILS+"/:id",canDeactivate:!1,canActivate:!1},{name:i.ROUTE_MODEL_DOC_DETAILS,path:"/"+i.PATH_MODEL_DOC_DETAILS,canDeactivate:!1,canActivate:!1}].forEach(function(e){t.addRoute(e)});var s={};s[i.ROUTE_HOME]={activate:function(){var e=t.getDependency("xModelApp");e.clearContent(),e._initContent()}},s[i.ROUTE_RECENTY_OPENED]={activate:function(e){if(!(e.params?e.params:{}).isRefresh){let e={name:i.ROUTE_RECENTY_OPENED,params:{}};o.setRouteInfo(e)}var n=t.getDependency("xModelApp");t.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:i.PATH_RECENTY_OPENED}}),n.clearContent(),n._initContent();var a=t.getDependency("InformationPanelManager");a.resetPropertyPanel(),a.setContext(i.ROUTE_RECENTY_OPENED);var s=t.getDependency("landingPage");s&&(s.loadData(),s.activateTags())},deactivate:function(e){var i=t.getDependency("xModelApp"),n=t.getDependency("landingPage");n&&(n.clearTags(),n.destroy(),t.setDependency("landingPage",void 0)),i.clearContent(),e.params.isRefresh||o.setRouteInfo({name:null})}},s[i.ROUTE_MY_MODELS]={activate:function(e){if(!(e.params?e.params:{}).isRefresh){let e={name:i.ROUTE_MY_MODELS,params:{}};o.setRouteInfo(e)}var n=t.getDependency("xModelApp");t.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:i.PATH_MY_MODELS}}),n.clearContent();var a=t.getDependency("InformationPanelManager");a.resetPropertyPanel(),a.setContext(i.ROUTE_MY_MODELS),n._initModels();var s=t.getDependency("modelsStatePresenter");s.loadData(!0),s.activateTags()},deactivate:function(){var e=t.getDependency("modelsStatePresenter");e&&e.deactivateTags()}},s[i.ROUTE_MY_UNITS]={activate:function(e){if(!(e.params?e.params:{}).isRefresh){let e={name:i.ROUTE_MY_UNITS,params:{}};o.setRouteInfo(e)}var n=t.getDependency("xModelApp");t.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:i.PATH_MY_UNITS}}),n.clearContent(),n._initUnits();var a=t.getDependency("unitsStatePresenter");a.loadContextModel(),a.activateTags();var s=t.getDependency("InformationPanelManager");s.resetPropertyPanel(),s.setContext(i.ROUTE_MY_UNITS)},deactivate:function(e){var i=t.getDependency("xModelApp"),n=t.getDependency("unitsStatePresenter");n&&n.deactivateTags(),i.clearContent(),e.params.isRefresh||o.setRouteInfo({name:null})}},s[i.ROUTE_DICTIONARY]={activate:function(e){var n=t.getDependency("xModelApp");t.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:i.PATH_DICTIONARY}}),n.clearContent(),n._initEnterpriseDico(e);var a=t.getDependency("enterpriseDictionaryPresenter");a&&a.activateTags();var s=t.getDependency("InformationPanelManager");s.resetPropertyPanel(),s.setContext(i.ROUTE_DICTIONARY);let r={name:i.ROUTE_DICTIONARY,params:{}};o.setRouteInfo(r)},deactivate:function(e){var i=t.getDependency("xModelApp"),n=t.getDependency("applicationChannel"),a=t.getDependency("enterpriseDictionaryPresenter");a&&a.deactivateTags(),i.reactivateWP(),i.clearContent(),n.publish({event:"breadcrumb-reset",data:null}),e.params.isRefresh||o.setRouteInfo({name:null})}},s[i.ROUTE_DICTIONARY_VARIANTS_OPTIONS]={activate:function(e){var n=e.params?e.params:{};if(!n.isRefresh){let e={name:i.ROUTE_DICTIONARY_VARIANTS_OPTIONS,params:{}};o.setRouteInfo(e)}var a=t.getDependency("enterpriseDictionaryPresenter");!0!==n.reload&&void 0!==n.reload||a.loadData(!0)},deactivate:function(){var e=t.getDependency("xModelApp");e.clearContent(),e._initEnterpriseDico();var n=t.getDependency("InformationPanelManager");n.resetPropertyPanel(),n.setContext(i.ROUTE_DICTIONARY)}},s[i.ROUTE_DICTIONARY_VARIANT_DETAILS]={activate:function(n){e.log("activating VC Details");var a=n.params?n.params:{};if(a.isRefresh){let t=o.getRouteInfo();t&&t.params.variantId&&e.merge(a,{id:t.params.variantId,name:t.params.variantName,version:null})}else if(a.id){let e={name:i.ROUTE_DICTIONARY_VARIANT_DETAILS,params:{variantId:a.id,variantName:a.name}};o.setRouteInfo(e)}t.getDependency("xModelApp").deactivateWP(a.isRefresh);var s=t.getDependency("applicationChannel"),r=t.getDependency("enterpriseDictionaryPresenter"),l=a.name;r._initAndLoadDataVariantClassDetails(a);var d={linkID:i.ROUTE_DICTIONARY_VARIANT_DETAILS,linkText:a.name,additionalData:a.id};s.publish({event:"breadcrumb-reset",data:null}),s.publish({event:"breadcrumb-add-link",data:d}),window.widget.setTitle(i.ENTERPRISE_DICTIONARY+" - "+l),t.getDependency("InformationPanelManager").setContext("Values",{id:a.id})},deactivate:function(e){var n=t.getDependency("xModelApp"),a=t.getDependency("variantDetailsStatePresenter");if(a&&(t.setDependency("variantDetailsStatePresenter",null),a.destroy()),n.reactivateWP(),n.clearContent(),t.getDependency("InformationPanelManager").resetPropertyPanel(),n._initEnterpriseDico(),t.getDependency("enterpriseDictionaryPresenter").loadData(),!e.params.isRefresh){let e={name:i.ROUTE_DICTIONARY_VARIANTS_OPTIONS,params:{}};o.setRouteInfo(e)}}},s[i.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS]={activate:function(n){e.log("activating OG Details");var a=n.params?n.params:{};if(a.isRefresh){let t=o.getRouteInfo();t&&t.params.id&&e.merge(a,{id:t.params.id,name:t.params.name,version:null})}else if(a.id){let e={name:i.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS,params:{id:a.id,name:a.name}};o.setRouteInfo(e)}var s=t.getDependency("xModelApp"),r=t.getDependency("applicationChannel"),l=t.getDependency("enterpriseDictionaryPresenter");s.deactivateWP(a.isRefresh);var d=a.name;l._initAndLoadDataOptionGroupDetails(a);var c={linkID:i.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS,linkText:a.name,additionalData:a.id};r.publish({event:"breadcrumb-reset",data:null}),r.publish({event:"breadcrumb-add-link",data:c}),window.widget.setTitle(i.ENTERPRISE_DICTIONARY+" - "+d),t.getDependency("InformationPanelManager").setContext("Options",{id:a.id})},deactivate:function(e){var n=t.getDependency("xModelApp"),a=t.getDependency("optionGroupDetailsStatePresenter");if(a&&(t.setDependency("optionGroupDetailsStatePresenter",null),a.destroy()),n.reactivateWP(),n.clearContent(),t.getDependency("InformationPanelManager").resetPropertyPanel(),n._initEnterpriseDico(),t.getDependency("enterpriseDictionaryPresenter").loadData(),!e.params.isRefresh){let e={name:i.ROUTE_DICTIONARY_VARIANTS_OPTIONS,params:{}};o.setRouteInfo(e)}}};var r=function(t){e.log("Events from PlatformAPI"),(t&&t.data&&t.data.authored&&t.data.authored.modified?t.data.authored.modified:[]).forEach(function(t){t&&a.getModelDetails({id:t}).then(function(t){var i=t.member[0];if("Model Version"===i.type&&("True"===i.isRoot||i.isRoot||"true"===i.isRoot)){var n=i.modelID;a.patchModel(n,{title:i.title,description:i.description}).then(function(){e.log("model updated")},function(){e.log("failed")})}},function(){e.log("fail to retrieve mv "+t)})})};for(var l in s[i.ROUTE_MODEL_DEFINITION]={subscriptionToken:"",activate:function(e){var i=t.getDependency("xModelApp");i.clearContent(),i._initModels(e),window.subscriptionToken=n.subscribe("DS/PADUtils/PADCommandProxy/refresh",r)},deactivate:function(e){void 0!==window.subscriptionToken&&n.unsubscribe(window.subscriptionToken),t.getDependency("applicationChannel").publish({event:"breadcrumb-reset",data:null}),t.setDependency("modelsStatePresenter",null),e.params.isRefresh||o.setRouteInfo({name:null})}},s[i.ROUTE_MODELS]={activate:function(e){if(!(e.params?e.params:{}).isRefresh){let e={name:i.ROUTE_MODELS,params:{}};o.setRouteInfo(e)}var n=t.getDependency("xModelApp");n.clearContent(),n._initModels(),t.getDependency("modelsStatePresenter").loadData(!0)}},s[i.ROUTE_MODEL_INFO]={activate:function(n,a){e.log("activating ModelInfo");var s={},r=n.params?n.params:{};if(r.isRefresh){let e=o.getRouteInfo();e&&e.params.modelVersionId&&(s={modelVersionId:e.params.modelVersionId,id:e.params.modelVersionId,name:e.params.modelVersionName?e.params.modelVersionName:e.params.name,version:e.params.modelVersion?e.params.modelVersion:e.params.version,modelName:e.params.modelName,modelID:e.params.modelID,type:e.params.modelType?e.params.modelType:"Products"})}else{let e={name:i.ROUTE_MODEL_INFO};r.modelVersionId?s={modelVersionId:r.modelVersionId,id:r.modelVersionId,name:r.modelVersionName?r.modelVersionName:r.name,version:r.modelVersion?r.modelVersion:r.version,modelName:r.modelName,modelID:r.modelID,type:r.modelType?r.modelType:"Products",fromRoadmapContext:r.fromRoadmapContext}:r.id&&(s={modelVersionId:r.modelVersionId,id:r.id,name:r.name,version:r.version,modelName:r.modelName,modelID:r.modelID,type:r.type?r.type:"Products"}),e.params={modelVersionId:s.id,modelVersionName:s.name,modelVersion:s.version,modelName:s.modelName,modelID:s.modelID,modelType:s.type?s.type:"Products",name:s.name,version:s.version,fromRoadmapContext:s.fromRoadmapContext},o.setRouteInfo(e)}var l=t.getDependency("xModelApp");l.deactivateWP(r.isRefresh);var d=t.getDependency("applicationChannel");l.clearContent();var c=s.name+" "+s.version,p={linkID:i.ROUTE_MODEL_DETAILS,linkText:c,additionalData:s};d.publish({event:"breadcrumb-reset"}),d.publish({event:"breadcrumb-add-link",data:p}),window.widget.setTitle(c);var u=t.getDependency("modelDetailsStatePresenter");try{u&&(u.getID()===r.id&&a.name!==i.ROUTE_RECENTY_OPENED&&a.name!==i.ROUTE_MY_MODELS||u.destroy())}catch(t){e.log("Failed : Removing ModelDetails")}l._initModelDetails(s,!1);var h=t.getDependency("modelDetailsStatePresenter");try{u&&h.isDetailsInitialized()&&!r.isRefresh||n.name!==i.ROUTE_MODEL_INFO||h._fetchData()}catch(t){e.log("Failed : Removing Previous ModelDetails")}},deactivate:function(e){var n=t.getDependency("xModelApp"),a=t.getDependency("InformationPanelManager"),o=t.getDependency("applicationChannel");n.reactivateWP(),n.clearContent();var s=t.getDependency("modelDetailsStatePresenter");o.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_INFO}),e.name!==i.ROUTE_DICTIONARY_VARIANT_DETAILS&&e.name!==i.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS?(t.setDependency("modelDetailsStatePresenter",void 0),s.destroy()):s.deactivateRoadMapFacet(),n._initModels(),window.widget.setTitle(""),o.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_DETAILS}),a.resetPropertyPanel(),a.setContext(i.ROUTE_MODELS)}},s[i.ROUTE_MODEL_DETAILS]={activate:function(n){e.log("activating ModelDetails");var a=t.getDependency("xModelApp"),s={},r=n.params?n.params:{};if(r.isRefresh){let e=o.getRouteInfo();e&&e.params.modelVersionId&&(s={modelVersionId:e.params.modelVersionId,id:e.params.modelVersionId,name:e.params.modelVersionName?e.params.modelVersionName:e.params.name,version:e.params.modelVersion?e.params.modelVersion:e.params.version,modelName:e.params.modelName,modelID:e.params.modelID,type:e.params.modelType?e.params.modelType:"Products"})}else{let e={name:i.ROUTE_MODEL_DETAILS};r.modelVersionId?s={modelVersionId:r.modelVersionId,id:r.modelVersionId,name:r.modelVersionName?r.modelVersionName:r.name,version:r.modelVersion?r.modelVersion:r.version,modelName:r.modelName,modelID:r.modelID,type:r.modelType?r.modelType:"Products"}:r&&r.id&&(s={modelVersionId:r.id,id:r.id,name:r.name,version:r.version,modelName:r.modelName,modelID:r.modelID,type:r.type?r.type:"Products"}),e.params={modelVersionId:s.id,modelVersionName:s.name,modelVersion:s.version,modelName:s.modelName,modelID:s.modelID,modelType:s.type?s.type:"Products",name:s.name,version:s.version},o.setRouteInfo(e)}var l=t.getDependency("applicationChannel"),d=t.getDependency("modelDetailsStatePresenter");d||(a.clearContent(),a._initModelDetails(r,!1),d=t.getDependency("modelDetailsStatePresenter"));try{d.isDetailsInitialized()&&!r.isRefresh||n.name!==i.ROUTE_MODEL_DETAILS||d._fetchData()}catch(t){e.log("Failed : Removing Previous ModelDetails")}var c=s.name+" "+s.version,p={linkID:i.ROUTE_MODEL_INFO,linkText:c,additionalData:s};window.widget.setTitle(c),d.activateModelFacet(),d.activateProjectsFacet(),d.activateEffectivityFacet(),d.activateCompositionFacet(),l.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_RULE_DETAILS}),l.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_DETAILS}),l.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_INFO}),l.publish({event:"breadcrumb-add-link",data:p})},deactivate:function(){var i=t.getDependency("modelDetailsStatePresenter");e.is(i)&&(i.deactivateModelFacet(),i.deactivateProjectsFacet(),i.deactivateRoadMapFacet(),i.deactivateEffectivityFacet(),i.deactivateCompositionFacet())}},s[i.ROUTE_MODEL_RULE_DETAILS]={activate:function(n){e.log("activating RuleDetails");var a=n.params?n.params:{};if(a.isRefresh){let t=o.getRouteInfo();t&&t.params.ruleId&&e.extend(a,{id:t.params.ruleId,name:t.params.ruleName,version:t.params.modelVersion})}else if(a.id){let e=o.getRouteInfo();e.name=i.ROUTE_MODEL_RULE_DETAILS,e.params.id=a.id,e.params.ruleId=a.id,e.params.ruleName=a.name,o.setRouteInfo(e)}var s=t.getDependency("applicationChannel"),r=t.getDependency("modelDetailsStatePresenter"),l=t.getDependency("InformationPanelManager");a.parentID=r._id,window.widget.setTitle(a.name);var d={linkID:i.ROUTE_MODEL_RULE_DETAILS,linkText:a.name,additionalData:{id:a.id,name:a.name,parentID:r._id}};s.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_RULE_DETAILS}),s.publish({event:"breadcrumb-add-link",data:d}),e.is(r)&&(r.deactivateModelFacet(),r.deactivateProjectsFacet(),r.deactivateRoadMapFacet(),r.deactivateEffectivityFacet(),r.deactivateCompositionFacet()),l.setContext(i.ROUTE_MODEL_RULE_DETAILS,{id:a.id}),r._initRuleDetails(a).then(function(){t.getDependency("RuleDetailsStatePresenter").fetchData()},function(){e.log("[xModelRouterConfig:ROUTE_MODEL_RULE_DETAILS] Activation failed!!!")}),r._localRulesPresenter&&r._localRulesPresenter._previewModeIsSelected&&(r._privateChannelForRules.publish({event:"on-preview",data:{activated:!1}}),r._privateChannelForRules.publish({event:"enox-collection-toolbar-unselect-eye-item",data:{id:0}}),r.previouslySelectedRule!==a.id&&r._privateChannelForRules.publish({event:"previous-rule-activation",data:r.previouslySelectedRule}),r._localRulesPresenter._previewModeIsSelected=!1)},deactivate:function(n){e.log("de-activating RuleDetails");var a=t.getDependency("xModelApp");a.clearContent(),a._initModelDetails({},n.name===i.ROUTE_MODEL_INFO);var s=t.getDependency("InformationPanelManager"),r=t.getDependency("modelDetailsStatePresenter");if(e.is(r)&&(r.activateModelFacet(),r.activateProjectsFacet(),r.activateEffectivityFacet(),r.activateCompositionFacet()),s.setContext(n.name,{id:n.params.id}),n.params.name){if(n.params.isRefresh){let t=o.getRouteInfo();t&&t.params.modelVersionId&&e.extend(n.params,{id:t.params.modelVersionId,name:t.params.modelVersionName,version:t.params.modelVersion,modelName:t.params.modelName}),n.params.isRefresh=!1}else{let e={name:i.ROUTE_MODEL_DETAILS,params:{modelVersionId:n.params.id,modelVersionName:n.params.name,modelVersion:n.params.version,modelName:n.params.modelName,modelType:n.params.type?n.params.type:"Products"}};o.setRouteInfo(e)}window.widget.setTitle(n.params.name)}var l=t.getDependency("RuleDetailsStatePresenter");a._modelDetailsStatePresenter._ruleDetailsStatePresenter&&a._modelDetailsStatePresenter._ruleDetailsStatePresenter._ruleId!==n.params.id&&a._modelDetailsStatePresenter._privateChannelForRules.publish({event:"previous-rule-activation",data:a._modelDetailsStatePresenter._ruleDetailsStatePresenter._ruleId}),l&&(l.destroy(),t.setDependency("RuleDetailsPresenter",null)),t.getDependency("applicationChannel").publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_RULE_DETAILS}),e.is(r)&&(n.params.refreshPCList?r._localRulesPresenter.loadData():r._localRulesPresenter.publishTags())}},s[i.ROUTE_MODEL_BC_DETAILS]={activate:function(n){e.log("activating Basic Config Details");var a=n.params?n.params:{};if(a.isRefresh){let t=o.getRouteInfo();t&&t.params.bcId&&e.extend(a,{id:t.params.bcId,name:t.params.bcName,version:t.params.bcRevision})}else if(a.id){var s=o.getRouteInfo();s.name=i.ROUTE_MODEL_BC_DETAILS,s.params.bcId=a.id,s.params.bcName=a.name,s.params.bcRevision=a.version,s.params.id=a.id,s.params.name=a.name,o.setRouteInfo(s)}var r=t.getDependency("applicationChannel"),l=t.getDependency("modelDetailsStatePresenter"),d=t.getDependency("InformationPanelManager");a.parentID=l._id,l._initBCDetails(a).then(function(i){var n=t.getDependency("BCDetails");n.fetchData([i]).then(function(){n.loadIDCard(i.id)},function(){e.log("Load Base Config ID card failed!!!")})},function(){e.log("[xModelRouterConfig:ROUTE_MODEL_BC_DETAILS] Activation failed!!!")});var c={linkID:i.ROUTE_MODEL_BC_DETAILS,linkText:a.name+" "+a.version,additionalData:{id:a.id,name:a.name,parentID:l._id}};r.publish({event:"breadcrumb-add-link",data:c}),window.widget.setTitle(a.name+" "+a.version),e.is(l)&&(l.deactivateProjectsFacet(),l.deactivateRoadMapFacet()),d.setContext(i.ROUTE_MODEL_BC_DETAILS,{id:a.id})},deactivate:function(n){var a=t.getDependency("xModelApp"),s=t.getDependency("applicationChannel");s.publish({event:"triptych-hide-panel",data:"left"}),a.clearContent(),a._initModelDetails({},n.name===i.ROUTE_MODEL_INFO);var r=t.getDependency("InformationPanelManager"),l=t.getDependency("modelDetailsStatePresenter");if(e.is(l)&&l.activateProjectsFacet(),r.setContext(n.name,{id:n.params.id}),n.params.name){if(n.params.isRefresh){let t=o.getRouteInfo();t&&t.params.modelVersionId&&e.extend(n.params,{id:t.params.modelVersionId,name:t.params.modelVersionName,version:t.params.modelVersion,modelName:t.params.modelName}),n.params.isRefresh=!1}else{let e={name:i.ROUTE_MODEL_DETAILS,params:{modelVersionId:n.params.modelVersionId||n.params.id,modelVersionName:n.params.modelVersionName||n.params.name,modelVersion:n.params.modelVersion||n.params.version,modelName:n.params.modelName,modelType:n.params.type?n.params.type:"Products"}};o.setRouteInfo(e)}window.widget.setTitle(n.params.name+" "+n.params.version)}s.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_BC_DETAILS}),e.is(l)&&(n.params.refreshPCList?l._PCListPresenter.loadData():l._PCListPresenter.publishTags())}},s[i.ROUTE_MODEL_PC_DETAILS]={activate:function(n){e.log("activating PCDetails");var a=n.params?n.params:{};if(a.isRefresh){let t=o.getRouteInfo();t&&t.params.pcId&&e.extend(a,{id:t.params.pcId,name:t.params.pcName,version:t.params.pcRevision})}else if(a.id){var s=o.getRouteInfo();s.name=i.ROUTE_MODEL_PC_DETAILS,s.params.pcId=a.id,s.params.pcName=a.name,s.params.pcRevision=a.version,s.params.id=a.id,s.params.name=a.name,o.setRouteInfo(s)}var r=t.getDependency("applicationChannel"),l=t.getDependency("modelDetailsStatePresenter"),d=t.getDependency("InformationPanelManager");a.parentID=l._id,l._initPCDetails(a).then(function(){t.getDependency("PCDetailsStatePresenter").fetchData()},function(){e.log("[xModelRouterConfig:ROUTE_MODEL_PC_DETAILS] Activation failed!!!")});var c={linkID:i.ROUTE_MODEL_PC_DETAILS,linkText:a.name+" "+a.version,additionalData:{id:a.id,name:a.name,parentID:l._id}};r.publish({event:"breadcrumb-add-link",data:c}),window.widget.setTitle(a.name+" "+a.version),e.is(l)&&(l.deactivateModelFacet(),l.deactivateProjectsFacet(),l.deactivateRoadMapFacet(),l.deactivateEffectivityFacet(),l.deactivateCompositionFacet()),d.setContext(i.ROUTE_MODEL_PC_DETAILS,{id:a.id})},deactivate:function(n){e.log("de-activating PCDetails");var a=t.getDependency("xModelApp"),s=t.getDependency("applicationChannel");s.publish({event:"triptych-hide-panel",data:"left"}),a.clearContent(),a._initModelDetails({},n.name===i.ROUTE_MODEL_INFO);var r=t.getDependency("InformationPanelManager"),l=t.getDependency("modelDetailsStatePresenter");if(e.is(l)&&(l.activateModelFacet(),l.activateProjectsFacet(),l.activateEffectivityFacet(),l.activateCompositionFacet()),r.setContext(n.name,{id:n.params.id}),n.params.name){if(n.params.isRefresh){let t=o.getRouteInfo();t&&t.params.modelVersionId&&e.extend(n.params,{id:t.params.modelVersionId,name:t.params.modelVersionName,version:t.params.modelVersion,modelName:t.params.modelName}),n.params.isRefresh=!1}else{let e={name:i.ROUTE_MODEL_DETAILS,params:{modelVersionId:n.params.modelVersionId||n.params.id,modelVersionName:n.params.modelVersionName||n.params.name,modelVersion:n.params.modelVersion||n.params.version,modelName:n.params.modelName,modelType:n.params.type?n.params.type:"Products"}};o.setRouteInfo(e)}window.widget.setTitle(n.params.name+" "+n.params.version)}s.publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_PC_DETAILS});var d=t.getDependency("PCDetailsStatePresenter");try{d.destroy()}catch(t){e.log("Failed : Removing PCDetails")}t.setDependency("PCDetailsStatePresenter",null),e.is(l)&&(n.params.refreshPCList?l._PCListPresenter.loadData():l._PCListPresenter.publishTags())}},s[i.ROUTE_MODEL_DOC_DETAILS]={activate:function(n){e.log("activating docDetails");var a=n.params?n.params:{};if(a.isRefresh){let t=o.getRouteInfo();t&&t.params.docId&&e.extend(a,{id:t.params.docId,name:t.params.docName,version:t.params.docVersion,title:t.params.docTitle})}else if(a.id){let e=o.getRouteInfo();e.name=i.ROUTE_MODEL_DOC_DETAILS,e.params.docId=a.id,e.params.docName=a.name,e.params.docVersion=n.params.revision,e.params.docTitle=n.params.title,o.setRouteInfo(e)}var s=t.getDependency("applicationChannel"),r=t.getDependency("modelDetailsStatePresenter"),l=t.getDependency("InformationPanelManager");a.parentID=r._id,window.widget.setTitle(a.title),r._initDocDetails(a),t.getDependency("DocDetailsPresenter").fetchData();var d={linkID:i.ROUTE_MODEL_DOC_DETAILS,linkText:a.title,additionalData:{id:r._id}};s.publish({event:"breadcrumb-add-link",data:d}),e.is(r)&&(r.deactivateModelFacet(),r.deactivateProjectsFacet(),r.deactivateRoadMapFacet(),r.deactivateEffectivityFacet(),r.deactivateCompositionFacet()),l.setContext(i.ROUTE_MODEL_DOC_DETAILS,{id:a.id})},deactivate:function(n){e.log("de-activating DOCDetails");var a=t.getDependency("xModelApp");a.clearContent(),a._initModelDetails({},n.name===i.ROUTE_MODEL_INFO);var s=t.getDependency("InformationPanelManager"),r=t.getDependency("modelDetailsStatePresenter");if(e.is(r)&&(r.activateModelFacet(),r.activateProjectsFacet(),r.activateEffectivityFacet(),r.activateCompositionFacet()),s.setContext(n.name,{id:n.params.id}),n.params.name){if(n.params.isRefresh){let t=o.getRouteInfo();t&&t.params.modelVersionId&&e.extend(n.params,{id:t.params.modelVersionId,name:t.params.modelVersionName,version:t.params.modelVersion,modelName:t.params.modelName}),n.params.isRefresh=!1}else{let e={name:i.ROUTE_MODEL_DETAILS,params:{modelVersionId:n.params.id,modelVersionName:n.params.name,modelVersion:n.params.version,modelName:n.params.modelName,modelType:n.params.type?n.params.type:"Products"}};o.setRouteInfo(e)}window.widget.setTitle(n.params.name)}t.getDependency("applicationChannel").publish({event:"breadcrumb-remove-link",data:i.ROUTE_MODEL_DOC_DETAILS}),t.getDependency("DocDetailsPresenter").destroy(),t.setDependency("docDetailsPresenter",null);var l=t.getDependency("DocPresenter");l&&(l.publishTags(),r._localSpecificationPresenter&&r._localSpecificationPresenter.loadData())}},s)s.hasOwnProperty(l)&&t.addRouteMethods(l,s[l])}}}),define("DS/ENOXModelApp/components/ApplicationTopBar/ApplicationTopBarWrapper",["UWA/Core","DS/ENOXPageToolBar/js/PageToolBar","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXBreadcrumb/js/Breadcrumb","DS/Controls/TooltipModel","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","i18n!DS/ENOXModelApp/assets/nls/components/ApplicationTopBar/ApplicationTopBar","css!DS/ENOXModelApp/components/ApplicationTopBar/ApplicationTopBarWrapper.css"],function(e,t,i,n,a,o,s,r){"use strict";var l=function(){};return l.prototype.init=function(a,s,r){this.xModelRouter=s,this._applicationChannel=a,this._isReadyToNavigate=!0,this._breadcrumbLink=[];var l={withInformationButton:!0,withWelcomePanelButton:!0,enableNavigation:!0,withWebUXTooltip:!0,modelEvents:this._applicationChannel,parentContainer:r};this._myPageToolBar=new t(l),this._myPageToolBar.render().inject(r);var d=this._myPageToolBar.getBodyContent();this._tileContent=e.createElement("div",{styles:{display:"none",padding:"3px 0",fontSize:"20px",color:"#77797c"},html:"Recently Opened"}),this._tileContent.inject(d),this._title={id:i.ROUTE_HOME,label:"Home"},this._breadcrumb=new n({rootID:i.ROUTE_HOME,rootIcon:i.ROUTE_HOME,modelEvents:this._applicationChannel}),this._breadcrumb.render().inject(d),this._pathModel=[o._KEY,o._VIEWS_PREFERENCES],this._routes={lastRoutes:[],pos:-1},this._direction=0,this._subscribeToEvents();var c=this;this.xModelRouter.useMiddleware(function(){return function(e,t){let i=0,n=c._routes;return n.lastRoutes.length,n.pos,null==t||!!e.params.isRefresh||(i=c._direction?c._direction:0,c._direction=0,c.pushNewRouterState(t,e,i),c.popPreviousState(i),c.updateNavigateTooltip(i),!0)}})},l.prototype.updateNavigateTooltip=function(t){let n=this,a=n._routes,o=r.home;if(a.lastRoutes[a.pos])switch(a.lastRoutes[a.pos].name){case i.ROUTE_HOME:o=e.String.format(r.goTo,r.home);break;case i.ROUTE_MY_MODELS:o=e.String.format(r.goTo,r.myModelVersions);break;case i.ROUTE_RECENTY_OPENED:o=e.String.format(r.goTo,r.recentlyOpened);break;case i.ROUTE_DICTIONARY:o=e.String.format(r.goTo,r.enterpriseDictionary);break;case i.ROUTE_MY_UNITS:o=e.String.format(r.goTo,r.myUnits);break;case i.ROUTE_DICTIONARY_VARIANTS_OPTIONS:o=e.String.format(r.goTo,r.enterpriseDictionary);break;default:o=e.String.format(r.goTo,(a.lastRoutes[a.pos].params.name?a.lastRoutes[a.pos].params.name:"")+" "+(a.lastRoutes[a.pos].params.version?a.lastRoutes[a.pos].params.version:""))}void 0===a.lastRoutes[a.pos]?(n._myPageToolBar.updateTooltip("fonticon-chevron-left",""),n._myPageToolBar.disableAction("fonticon-chevron-left")):(n._myPageToolBar.enableAction("fonticon-chevron-left"),n._myPageToolBar.updateTooltip("fonticon-chevron-left",o)),void 0===a.lastRoutes[a.pos+2]?(n._myPageToolBar.updateTooltip("fonticon-chevron-right",""),n._myPageToolBar.disableAction("fonticon-chevron-right")):(n._myPageToolBar.enableAction("fonticon-chevron-right"),o=e.String.format(r.goTo,a.lastRoutes[a.pos+2].params.name+(a.lastRoutes[a.pos+2].params.version?a.lastRoutes[a.pos+2].params.version:"")),n._myPageToolBar.updateTooltip("fonticon-chevron-right",o))},l.prototype.pushNewRouterState=function(e,t,i){let n,a,o=this._routes,s=o.pos;o.lastRoutes.length>0&&(n=o.lastRoutes[o.lastRoutes.length-1]),a=1==i?e:o.lastRoutes.length>0&&o.lastRoutes[o.pos+2]?o.lastRoutes[o.pos+2]:o.lastRoutes[o.pos+1],0==i&&void 0!==a&&(o.lastRoutes=o.lastRoutes.slice(0,s+1)),2!=i&&(i&&o.lastRoutes[o.pos+1]||o.lastRoutes.push(e))},l.prototype.popPreviousState=function(e){let t=this._routes;1==e?t.pos--:t.pos++},l.prototype._subscribeToEvents=function(){var t=this;this._applicationChannel.subscribe({event:"navigate-backward"},function(e){let n=t._routes,a=n.pos;t._direction=1;let o={...n.lastRoutes[a]},s={linkID:o.name};t._isReadyToNavigate?Object.keys(o).length>0?(o.name==i.ROUTE_HOME&&(o.name=i.ROUTE_RECENTY_OPENED),o.name==i.ROUTE_MODEL_DETAILS&&(o.name=i.ROUTE_MODEL_INFO),o.params.isRefresh=!1,t.xModelRouter.navigate(o.name,o.params,{replace:!0,reload:!1})):t.xModelRouter.navigate(i.ROUTE_RECENTY_OPENED,o.params,{replace:!0,reload:!1}):(t._removeLastLink(),t._notReadyToNavigate(s))}),this._applicationChannel.subscribe({event:"navigate-forward"},function(e){let i,n=t._routes,a=n.pos,o={linkID:(i={...n.lastRoutes[a+2]}).name};t._isReadyToNavigate?(i&&i.params&&i.params.isRefresh&&(i.params.isRefresh=!1),t._direction=2,i&&t.xModelRouter.navigate(i.name,i.params,{replace:!0,reload:!1})):(t._removeLastLink(),t._notReadyToNavigate(o))}),this._applicationChannel.subscribe({event:"enox-model-app-item-removed"},function(e){let i=!1,n=[],a=t._routes.lastRoutes;if(a.length>0){if("string"==typeof e){let t=e;(e=[]).push(t)}a.forEach((t,a)=>{e.forEach((e,o)=>{t.params.id==e&&(i=!0,n.push(a))})})}if(i){for(let e=n.length-1;e>=0;e--)n[e]==a.length-1?(t.popPreviousState(1),t.popPreviousState(1)):n[e]<=t._routes.pos&&t.popPreviousState(1),a=a.splice(n[e],1),t.updateNavigateTooltip(1)}}),this._applicationChannel.subscribe({event:"welcome-panel-collapse"},function(){t._applicationChannel.publish({event:"triptych-set-size",data:{size:i.LEFT_PANEL_SIZE_COLLAPSED,side:"left"}}),t._applicationChannel.publish({event:"triptych-show-panel",data:"left"}),t._myPageToolBar.updateTooltip("fonticon-expand-right",r.EXPAND)}),this._applicationChannel.subscribe({event:"welcome-panel-expand"},function(){t._applicationChannel.publish({event:"triptych-set-size",data:{size:i.LEFT_PANEL_SIZE_EXPANDED,side:"left"}}),t._applicationChannel.publish({event:"triptych-show-panel",data:"left"}),t._myPageToolBar.updateTooltip("fonticon-expand-left",r.COLLAPSE)}),this._applicationChannel.subscribe({event:"information-panel-close"},function(){t._applicationChannel.publish({event:"triptych-hide-panel",data:"right"})}),this._applicationChannel.subscribe({event:"triptych-hide-panel"},function(e){"right"===e&&s.updateInfoPanelStatus(t._pathModel,"false")}),this._applicationChannel.subscribe({event:"information-panel-open"},function(){t._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),t._applicationChannel.publish({event:"information-panel-visible",data:null}),s.updateInfoPanelStatus(t._pathModel,"true")}),this._applicationChannel.subscribe({event:"triptych-panel-hidden"},function(e){"right"===e&&t._applicationChannel.publish({event:"information-panel-hidden",data:null})}),this._applicationChannel.subscribe({event:"topbar-show-title"},function(e){e&&(t._title.id=e.id,t._title.label=e.label,t._tileContent.setContent(e.label)),t._breadcrumb.hide(),t._tileContent.show(),t._myPageToolBar.hideNavigationPanel(),t._myPageToolBar.container.style["border-bottom"]=""}),this._applicationChannel.subscribe({event:"topbar-hide-title"},function(){t._tileContent.hide(),t._breadcrumb.show(),t._myPageToolBar.showNavigationPanel(),t._myPageToolBar.container.style["border-bottom"]="1px solid #d1d4d4"}),this._applicationChannel.subscribe({event:"update-ready-to-navigation-flag"},function(e){t._isReadyToNavigate=e}),this._applicationChannel.subscribe({event:"breadcrumb-link-added"},function(n){var a=t._breadcrumb.collection.findWhere({linkID:n.linkID});if(a._attributes.linkID!==i.ROUTE_MODEL_DETAILS){var o=t._breadcrumbLink.filter(function(e){return e.linkID===a._attributes.linkID}).length>0;a&&!o&&(t._breadcrumbLink.push(a._attributes),e.log("Last link added in Breadcrumb List"))}}),this._applicationChannel.subscribe({event:"breadcrumb-reseted"},function(){if(!t._isReadyToNavigate){var e=0;for(e=0;e<t._breadcrumbLink.length;e++)t._applicationChannel.publish({event:"breadcrumb-add-link",data:t._breadcrumbLink[e]})}}),this._applicationChannel.subscribe({event:"breadcrumb-link-clicked"},function(e){var n;if(t._isReadyToNavigate)if((n=e.linkID.replace(/-/g,"."))===i.ROUTE_HOME){var a=t._title.id||i.ROUTE_HOME;t._breadcrumbLink=[],t.xModelRouter.navigate(a,{})}else if(n===i.ROUTE_MODELS)t.xModelRouter.navigate(i.ROUTE_MODELS,{data:"from breadcrumb"});else if(n===i.ROUTE_DICTIONARY)t.xModelRouter.navigate(i.ROUTE_DICTIONARY);else{var o=null,s=0;for(s=0;s<t._breadcrumb.collection.length;s+=1)if(t._breadcrumb.collection.at(s).id===e.linkID){o=t._breadcrumb.collection.at(s).get("additionalData");break}!1,t._breadcrumbLink.pop(),o?t.xModelRouter.navigate(n,o):t.xModelRouter.navigate(n)}else t._notReadyToNavigate(e)})},l.prototype._removeLastLink=function(){var e=this._breadcrumbLink[this._breadcrumbLink.length-1];this._applicationChannel.publish({event:"breadcrumb-remove-link",data:e.linkID})},l.prototype._notReadyToNavigate=function(e){let t=this;if(e.linkID.replace(/-/g,".")!==i.ROUTE_HOME){var n=t._breadcrumbLink[t._breadcrumbLink.length-1];n.linkID!==e.linkID&&t._applicationChannel.publish({event:"breadcrumb-add-link",data:n})}t._applicationChannel.publish({event:"warning-dialog-create",data:e})},l}),define("DS/ENOXModelApp/RoadMap/EnoxRoadmapControllerHelper",["UWA/Core","UWA/Class","DS/ENOXModelApp/Utils/xModelSubTypeManager","DS/CoreEvents/ModelEvents","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/ENOXModelApp/assets/nls/RoadMap/EnoxModelRoadMap"],function(e,t,i,n,a,o,s){"use strict";var r=t.singleton({init:function(){this._init()},_init:function(){this.isPredicateAvailable=!1,this.predicates=[],this.allowedTypes=[],this.customAttrbColumns=[]},setMVSubTypeManager:function(e){this.mvSubTypesManager=e},getMVSubType:function(){return this.mvSubTypesManager.getSubTypes()},getSubTypes:async function(){var t=this;this.subTypesManager=new i({channel:new n,getSubTypesAPI:a.getMVSubTypes,stdTypeDetails:{name:"Requirement",nlsName:s.REQUIREMENT},parentType:"Requirement"});try{return await this.subTypesManager.getSubTypeFetchPromise().then(function(){t._getPredicates()},function(){e.log("Unable to fetch the Requirement subtypes!")}).catch(function(){e.log("Unable to fetch the Requirement subtypes!")})}catch(t){e.log("Unable to fetch the Requirement subtypes!")}},_fetchPredicatesPromise:function(t){var i=this;return new e.Promise(function(n,a){try{var s={onComplete:function(e){n(e)},onFailure:function(e){a(e)},onTimeout:function(e){a(e)},apiVersion:"R2019x"};s.lang=i._currLang,s.tenantId=window.widget.getValue("x3dPlatformId"),o.getPropertiesForClass(t,s)}catch(t){e.log("Exception occured while predicates  request"+t.message),a(t.message?t.message:"Exception Occured during expand!!")}})},_getPredicates:function(){var t=this;if(t.subTypesManager.doesSubTypeExists()){let i=t.subTypesManager.getSubTypes();i.forEach(function(e){t.allowedTypes.push(e)}),t._fetchPredicatesPromise(i.toString()+",Requirement").then(function(e){e.forEach(function(e){e&&e.properties&&e.properties.forEach(function(e){e.userAccess&&t.predicates.indexOf(e.curi)<0&&(t.predicates.push(e.curi),t.customAttrbColumns.push({text:e.label,dataIndex:e.curi,visibleFlag:!0,sortableFlag:!1}))})})},function(t){e.log("reject"+t)})}},getSubTypesForSelection:function(){return this.subTypesManager.getSubTypesForSelection()}});return r.init(),r}),define("DS/ENOXModelApp/BaseConfigDefinition/Presenter/BaseConfigurationTablePresenter",["DS/UIKIT/Mask","DS/CfgBulkTablePresenter/BulkEdition/Presenter/AbstractBulkTablePresenter","DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent","DS/Controls/Popup","DS/CfgRuleMatrixComponent/Runtime/ConflictPanelPresenter","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","i18n!DS/ENOXModelApp/assets/nls/BaseConfigDefinition/BaseConfigDetails","i18n!DS/CfgBulkTablePresenter/assets/nls/BulkTablePresenter","i18n!DS/CfgBulkTablePresenter/assets/nls/AbstractBulkTablePresenter"],function(e,t,i,n,a,o,s,r,l){"use strict";var d={};const c="check",p="block",u="favorite-on",h={S:s.SELECTED,A:s.AVAILABLE,N:s.NA,D:s.DEFAULT,U:s.UNDEFINED};return t.extend({init:function(e){this.options=e||{},UWA.is(e.showCompareAction,"boolean")||(e.showCompareAction=!0),UWA.is(e.showEditAction,"boolean")||(e.showEditAction=!0),e.columnOptions=this._initColumnOptionsForDGV(),e.showOutlineFlag=!0,e.COLUMN_ID_INDEX=2,this._loadedBCs={},this._bulkTableModel=e.bulkTableModel,this._applicationChannel=e.applicationChannel,this._privateChannel=e.privateChannel,this._parent(e)},_initColumnOptionsForDGV:function(){var e=this;return[{text:s.VARIABILITY,dataIndex:"tree",pinned:"left",editableFlag:!1,onCellRequest:function(t){t.nodeModel&&e._dataGridView.getTypeRepresentationFactory().generateView(t.cellModel,{typePath:"string",readOnly:!0,touchMode:!1,escapeHTML:!0,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:!0},onViewCreated:function(e){if(t.nodeModel.options.grid.mandatory){if(e.elements.internalView){var i=UWA.createElement("span",{class:"label-field-required"});e.elements.internalView.appendChild(i),e.elements.internalView.getChildren()[0].textContent=" *",t.cellView.setReusableContent(e)}}else t.cellView.setReusableContent(e)}})}},{text:r.SequenceNumber,dataIndex:"sequenceNumber",pinned:"left",editableFlag:!1,visibleFlag:!1,typeRepresentation:"integer"}]},inject:function(e){this._parent(e)},getContainer:function(){return this._container},onTableUpdateStart:function(){this._parent();var e=this._bulkTableModel.getColumnAsReference();for(var t in this._loadedBCs)e?t!==e.id&&this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:!0}):this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:!0})},onTableUpdateEnd:function(){this._parent();var e=this._bulkTableModel.getColumnAsReference();for(var t in this._loadedBCs)e?t!==e.id&&this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:this._editionflag}):this._dataGridView.layout.setColumnOrGroupProperties(t,{editableFlag:this._editionflag})},getLoadedBCs:function(){return this._loadedBCs},setColumnAsReference:function(e){var t;this._parent(e),UWA.is(e)&&(this._bulkTableModel.setColumnAsReferenceInModel(e-2),this._dataGridView.layout.setColumnPinned(e,"left"),t=this._dataGridView.layout.getColumnEditableFlag(e)),t&&this._dataGridView.layout.setColumnOrGroupProperties(e,{editableFlag:!1})},unSetColumnAsReference:function(e){this._parent(e);var t=this._bulkTableModel.getColumnAsReference();if(t&&t.id){var i=this._bulkTableModel.getColumnID(t.id);this._bulkTableModel.unSetColumnAsReferenceInModel(i),this._dataGridView.layout.setColumnPinned(i+2,"unpinned"),this._editionflag&&this._dataGridView.layout.setColumnOrGroupProperties(t.id,{editableFlag:!0})}},removeColumnFromDGV:function(e){this._dataGridView.prepareUpdateView(),delete this._loadedBCs[e.id],this._dataGridView.removeColumnOrGroup(e.id);var t={id:"totalColumn",text:l.TotalBaseConfigurations+" : "+Object.keys(this._loadedBCs).length};Object.keys(this._loadedBCs).length<2&&this._compareFlag&&this.unSetColumnAsReference(!1),this._updateStatusBar(t),this._dataGridView.pushUpdateView()},createColumn:function(e){var t=this;if(e){this._loadedBCs[e.id]||(this._loadedBCs[e.id]=e),t.reserved=""!=e.attributes.reservedby&&e.attributes.reservedby!=o.userID;var i={dataIndex:e.id,text:e.title,icon:e.attributes.image,sortableFlag:!1,editableFlag:t._editionflag&&!t.reserved,typeRepresentation:"dropdownSelection",setCellValue:function(e,i){var n=e.nodeModel.getAttributeValue("type");if("Variant"!=n&&"Variability Group"!=n&&i){var a;switch(i){case h.S:a="Selected";break;case h.D:a="Default";break;case h.N:a="Not Available";break;case h.A:a="Available"}t._privateChannel.publish({event:"bulkEdit-on-change"}),t._privateChannel.publish({event:"xmodel-baseConfig-on-modify",data:{cellInfos:e,value:a}})}},onCellRequest:function(i){var n=i.columnID;if(i.reserved=""!=e.attributes.reservedby&&e.attributes.reservedby!=o.userID,i.cellView.getContent().getElement(".triangle")&&i.cellView.getContent().getElement(".triangle").remove(),i.cellView.getContent().getElement(".mr-span-conflict")&&i.cellView.getContent().getElement(".mr-span-conflict").remove(),n>0&&i.nodeModel.options.grid.showContent){t._dataGridView.prepareUpdateView();var a=i.nodeModel.options.grid.matrixId;if(a<=t._bulkTableModel._jsonModel.matrix[n-2].length){var s=t._bulkTableModel._jsonModel.matrix[n-2][a].state,r=t._bulkTableModel._jsonModel.matrix[n-2][a].stateValidity;if(i.cellModel={},i.cellModel.state=s,i.cellModel.stateValidity=r,i.cellModel.isDifferent=!1,t._compareFlag&&!t._bulkTableModel._jsonModel.columnHeaders[n-2].isAsReference){var l=t._bulkTableModel.getReferenceCellData(a);l&&l.state!==s&&(i.cellModel.isDifferent=!0)}t.createDGVCell(i),t._dataGridView.pushUpdateView()}}else t._dataGridView.getTypeRepresentationFactory().generateView(" ",{typePath:"string",readOnly:!0,touchMode:!0,escapeHTML:!0,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:!0},onViewCreated:function(e){i.cellView.setReusableContent(e)}})},getCellValueForCopy:e=>{var t=e.nodeModel.getAttributeValue("type");if("Variant"!=t&&"Variability Group"!=t){var i=e.columnID,n=this._dataGridView.columns[i].dataIndex,a=this._bulkTableModel.getColumnID(n),o=e.nodeModel.getAttributeValue("matrixId"),s=this._bulkTableModel._jsonModel.matrix[a][o];return h[s.state]}},processCellValueFromPaste:(t,i)=>{return""!=e.attributes.reservedby&&e.attributes.reservedby!=o.userID?void 0:i}};this._dataGridView.addColumnOrGroup(i),this._dataGridView.addEventListener("click",function(e,i){t._painterEnabled&&i&&i.columnID>0&&i.rowID>=0&&i.nodeModel&&"content"===i.nodeModel.options.grid.cellType&&t._dataGridView.setModelAt(i.cellID,t._painterState)});var n={dropdownSelection:{stdTemplate:"comboSelector",semantics:{possibleValues:[{value:h.S,icon:{iconName:c,fontIconFamily:1}},{value:h.D,icon:{iconName:u,fontIconFamily:1}},{value:h.N,icon:{iconName:p,fontIconFamily:1}},{value:h.A,icon:{iconName:" ",fontIconFamily:1}}]}},dropdownNoSelection:{stdTemplate:"comboSelector",semantics:{possibleValues:[]}}};this._dataGridView.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(n)),this._dataGridView.onReady(function(){t._treeDocument.prepareUpdate(),t._treeDocument.expandAll(),t._treeDocument.pushUpdate()});var a={id:"totalColumn",text:l.TotalBaseConfigurations+" : "+Object.keys(this._loadedBCs).length};this._updateStatusBar(a)}},createDGVCell:function(e){var t,i,n=this;switch(e.cellModel.state){case"S":t=h.S;break;case"D":t=h.D;break;case"N":t=h.N;break;case"A":t=h.A}this._dataGridView.getTypeRepresentationFactory().generateView(t,{typePath:n._painterEnabled?"functionIcon":e.reserved?"dropdownNoSelection":"dropdownSelection",touchMode:!0,escapeHTML:!0,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:!0},onViewCreated:function(t){if(i=n._createCellView(e),n._editionflag&&!n._painterEnabled){if(t.elements.internalView&&t.elements.internalView.elements){if(t.elements.internalView.elements.expander.style.display="none",t.elements.internalView.elements.mainElement.style.paddingLeft="0px",i){var a=i.querySelector(".mr-span-conflict")||i.querySelector(".triangle");e.cellView.elements.container.addContent(a)}e.cellView.elements.container.children.length>2&&e.cellView.elements.container.firstChild.remove(),e.cellModel.isDifferent&&(i.classList.add("highlight-background"),"A"===e.cellModel.state&&(i.style.height="24px")),t.elements.internalView.elements.mainElement.setContent(i),e.cellView.setReusableContent(t)}}else t.elements.container&&(t.elements.container.setContent(i),e.cellModel.isDifferent?i.classList.add("highlight-background"):t.elements.container.style.backgroundColor="transparent"),e.cellView.setReusableContent(i);var o=e.cellView.elements.container.querySelector(".mr-combi-details");o&&n._initTooltip(o,e)}})},_createCellView:function(e){var t,n,a;if(e.cellModel&&(t=e.cellModel.state,n=e.cellModel.stateValidity),"A"===t)switch(n){case"U":case"R":case"E":a=i.generateMRAvailableRequired();break;case"A":case"T":case"I":a=i.generateMRAvailableIncompatible();break;case"C":a=i.generateMRAvailableConflict();break;default:a=i.generateMRAvailable()}else if("N"===t)switch(n){case"C":case"U":case"R":case"E":a=i.generateMRNotAvailableConflict();break;case"A":case"T":case"I":a=i.generateMRNotAvailableIncompatible();break;default:a=i.generateMRNotAvailable()}else if("S"===t)switch(n){case"C":case"T":case"I":a=i.generateMRStandardConflict();break;case"U":case"R":case"E":a=i.generateMRStandardRequired();break;case"A":a=i.generateMRStandardIncompatible();break;default:a=i.generateMRStandard()}else if("D"===t)switch(n){case"U":case"R":case"E":a=i.generateMRDefaultRequired();break;case"C":case"A":case"T":case"I":a=i.generateMRDefaultIncompatible();break;default:a=i.generateMRDefault()}else a=i.generateMRAvailable();return a},_initTooltip:function(e,t){var i=this,a="c"+(t.columnID-2)+"r"+t.rowID;d[a]&&d[a].elements&&(d[a]={}),d[a]=new n({target:e,trigger:"click",constraint:this._container,position:"bottom",alignment:"near"}),e.onclick=function(e){if(this.columnID>=0&&this.rowID>=0){var n=document.querySelectorAll(".wux-controls-popup");d[a].setBody(r.Loading),n&&n[0]&&n[0].setContent(r.Loading),e.target.classList.contains("mr-span-conflict")&&i._privateChannel.publish({event:"compute-conflict-baseConf",data:t}),e.target.getParent().classList.contains("triangle")&&i._privateChannel.publish({event:"compute-suggestion-baseConf",data:t})}}.bind(t)},updateTooltip:function(t,i,n){var a="";if(UWA.is(n,"array"))for(var o=0;o<n.length;o++)n.length-1>o?a+=n[o].title+",":a+=n[o].title;var r=s.ReasonString;switch(t.cellModel.state+t.cellModel.stateValidity){case"SA":case"ST":case"SI":case"DI":case"DT":case"DA":case"NE":case"NR":case"NU":r+=s.StateValidity_C_Rule;break;case"AC":case"SC":case"DC":case"NC":r+=s.StateValidity_C;break;case"DU":case"SU":case"AU":r+=s.StateValidity_U;break;case"DR":case"DE":case"AR":case"AE":case"SR":case"SE":r+=s.StateValidity_RE;break;case"NA":case"NT":case"NI":case"AA":case"AT":case"AI":r+=s.StateValidity_ATI}(n.length>0||i.causingValuesList.length>0)&&(r+=s.Due_to),i.causingValuesList.length>0&&0===n.length&&(r=(r+=s.Current_Selection)+" "+a),n.length>0&&(r=(r+=s.ImpliedRulesString)+" "+a);var l="c"+(t.columnId-2)+"r"+t.rowId;d[l]&&(d[l].setBody(r),d[l].getContent().addClassName("mr-custom-popup"),d[l].show()),e.unmask(UWA.extendElement(this._container))},actionToolBar:function(e){UWA.is(e)&&UWA.is(e,"string")&&("painter-not-available"===e?(this._painterState=h.N,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",fonticon:"brush-block"}})):"painter-available"===e?(this._painterState=h.A,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",fonticon:"brush"}})):"painter-default"===e?(this._painterState=h.D,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",fonticon:"brush-favorite"}})):"painter-selected"===e?(this._painterState=h.S,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",fonticon:"brush-ok"}})):"painter-none"===e?(this._painterState=h.A,this._painterEnabled&&(this._painterEnabled=!1)):this._painterState=h.A,this._painterEnabled||"painter-none"===e||(this._painterEnabled=!0,this._editionflag||this.onChangeEditionFlag()))},showConflictingPanel:function(e){this._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:a.render(e)}})},updateDGV:function(e){this._dataGridView.updateRenderedColumn(e,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})},updateDGVLayout:function(){this._dataGridView.invalidateLayout({updateCellContent:!0})},clickSave:function(){var e=this;return new Promise(t=>{e._privateChannel.publish({event:"xmodel-baseConfig-on-save"})})},updateLoadingState:function(e,t,i){var n=t.length,a=Math.floor(100*e/n);a>100&&(console.error("Caution there is an issue where the % of conflict compute is over than 100"),a=100);var o={id:i,text:("statusComputing"===i?r.Status_Computing:r.Suggestions_Computing)+" : "+a+"%",icon:100===a?"check":"clock"};this._updateStatusBar(o)},onChangeEditionFlag:function(){var e=this,t=function(t){e.handleKeyEvent(t)};this.beforeClosing().then(function(){if(e._editionflag){if(e._editionflag=!1,e._dataGridView.cellSelection="none",e._painterEnabled){e._privateChannel.publish({event:"enox-collection-toolbar-change-icon-action",data:{id:"painter",text:"None",fonticon:"brush",changeIconSelection:!0,parent:"painter"}}),e._privateChannel.publish({event:"enox-collection-toolbar-action-activated",data:"painter-none"})}e.onTableUpdateEnd(),e._dataGridView.removeEventListener("keydown",t),e._dataGridView.removeEventListener("keyup",t)}else e._editionflag=!0,e._dataGridView.cellSelection="multiple",e.onTableUpdateStart(),e._dataGridView.addEventListener("keydown",t),e._dataGridView.addEventListener("keyup",t)}).catch(function(e){console.error(e)})},handleKeyEvent:function(e){"keydown"===e.type?e.ctrlKey&&this._container.addClassName("selection-mode"):"keyup"===e.type&&"Control"===e.key&&this._container.removeClassName("selection-mode")}})}),define("DS/ENOXModelApp/RoadMap/ENOXModelRoadmapController",["UWA/Core","DS/CoreEvents/ModelEvents","DS/ENOXRoadmapPresenter/ENOXRoadmapPresenter","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/xPortfolioUXCommons/DialogCreation/RequirementDialogCreation","DS/UIKIT/Input/Button","DS/WebappsUtils/WebappsUtils","DS/CKEditor/CKEditor","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/ENOXModelApp/Utils/CustomAttributesManager","DS/ENOXModelApp/RoadMap/EnoxRoadmapControllerConstants","DS/ENOXModelApp/RoadMap/EnoxRoadmapControllerHelper","DS/ENOXModelApp/Utils/xModelCommonUtils","i18n!DS/ENOXModelApp/assets/nls/RoadMap/EnoxModelRoadMap","i18n!DS/ENOXModelApp/assets/nls/RoadMap/EnoxModelRoadMapDrivers","i18n!DS/ENOXModelApp/assets/nls/xModelApp"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g){"use strict";var b=function(){};return b.prototype.init=function(i){if(this.options={},e.is(i)&&e.is(i.id)&&e.is(i.parentId)&&e.is(i.type)&&e.is(i.modelEvents)){if(this.keyState=new Map,this.id=i.id,this.parentId=i.parentId,this.parentTitle=i.parentTitle,this.parentRevision=i.parentRevision,this.state=i.state,this.keyState.set(i.id,i.state),this.type=i.type,this.objectMaturityState=i.objectMaturityState,e.is(i.allowedTypes,"array")&&e.is(m.allowedTypes,"array")&&m.allowedTypes.length>0&&(i.allowedTypes=i.allowedTypes.concat(m.allowedTypes)),this.allowedTypes=i.allowedTypes&&i.allowedTypes.length?i.allowedTypes:[],this.channel=i.modelEvents?i.modelEvents:new t,this._versionExplorerEvents=i.versionExpChannel?i.versionExpChannel:new t,this._channelTokensMap=new Map,this._channelTokensMap.set(this.channel,[]),i.predicates?this.predicates=i.predicates:(this.predicates=m.predicates?m.predicates:i.predicates?i.predicates:[],i.predicates=this.predicates),i.customAttrbColumns?this.customAttrbColumns=i.customAttrbColumns:(this.customAttrbColumns=m.customAttrbColumns?m.customAttrbColumns:i.customAttrbColumns?i.customAttrbColumns:[],i.customAttrbColumns=this.customAttrbColumns),i.reqSubTypesOptions?this.reqSubTypesOptions=i.reqSubTypesOptions:(this.reqSubTypesOptions=m.getSubTypesForSelection(),i.reqSubTypesOptions=this.reqSubTypesOptions),e.is(m.getMvSubTypes,"function")){let e=m.getMvSubTypes();e&&e.length>0&&(i.supportedTypes=i.supportedTypes.concat(e))}this.supportedTypes=i.supportedTypes,i.defaultFullViewTitle=g.ROADMAP_VIEW,i.withProxyManagement=!1,i.withContentTab=!0,i.maxColumnsCount=5,i.withUniqueBacklog=!0,i.withReordering=!0,i.withLaneExpander=!0,i.withSingleTaggerManagement=!0,i.withFullViewWidgetTitle=!0,i.withFullViewColumnSubHeader=!0,i.withChangeContextSupport=!0,i.withStatusBar=!0,i.withCustomListView=!0,i.withClassificationColumnVisible=!0,i.launchFullViewAsWidget=!e.is(i.launchFullViewAsWidget)||i.launchFullViewAsWidget,i.withNavigatioButtons=!i.launchFullViewAsWidget,i.nls_override=f,i.errorMessage={TITLE_OPERATION_CANNOT_BE_PERFORMED:v.error,OPERATION_CANNOT_BE_PERFORMED:v.errorFrozen},i.launchFullViewAsWidget&&(i.parentAppId="ENXMODL_AP",i.controllerModule="DS/ENOXModelApp/RoadMap/ENOXModelRoadmapController",i.serviceId="3dspace"),this.orderingAttribute=i.orderingAttribute="rank",this.subscribeToEvents(),this.defineHandlers(i),e.extend(this.options,i),this.initializeRoadmapPresenter(i)}else e.log("RoadmapController received invalid inputs!! Can't proceed!!")},b.prototype.initializeRoadmapPresenter=function(t){let a=this;try{a._isRoadmapInitializing||(a._isRoadmapInitializing=!0,p.mask(widget.body,v.ROADMAP_VIEW_IS_REFRESHING)),e.is(this.rdmpPresenter)&&(e.log("Previous instance of roadmap presenter found, cleaning it"),this.rdmpPresenter.destroy(),this.rdmpPresenter=void 0),t=t||this.options,this.rdmpPresenter=new i,new e.Promise((e,t)=>{n.getScoringModel({identifier:this.parentId}).then(function(t){var i=t.member[0].name;i&&"none"===i?e():e(i)},function(e){t({notifDetails:{level:"error",title:v.error,subtitle:v.errorGetScoringModel}})})}).then(i=>{a.selectedScoringModelId=i,a.rdmpPresenter.init(t),p.isMasked(widget.body)&&p.unmask(widget.body),!t.compactView&&t.withFullViewWidgetTitle&&e.is(t.handlers.getFullViewWidgetTitle,"function")&&a.rdmpPresenter.setFullViewWidgetTitle(t.handlers.getFullViewWidgetTitle()),t.compactView||a.getEvolutionsInLine()}).catch(i=>{a.selectedScoringModelId=void 0,a.rdmpPresenter.init(t),!t.compactView&&t.withFullViewWidgetTitle&&e.is(t.handlers.getFullViewWidgetTitle,"function")&&a.rdmpPresenter.setFullViewWidgetTitle(t.handlers.getFullViewWidgetTitle())})}catch(t){e.log("Exception occured during roadmap presenter init: "+t.message),a._isRoadmapInitializing&&(a._isRoadmapInitializing=!1,p.isMasked(widget.body)&&p.unmask(widget.body))}},b.prototype.updateDataItemOptions=function(t){e.is(t)&&(e.extend(this.options,t),e.extend(this,t))},b.prototype.isSameDataLoadedAlready=function(t){let i=this;if(e.is(t)){if(t.parentId===this.options.parentId){return e.log("Same Portfolio Information is already loaded for Roadmapping..."),(this.rdmpPresenter?this.rdmpPresenter.getItemIdsOfLoadedColumns():[]).find(e=>e===t.id)?(e.log("Need to manage lane selection for column which is already loaded"),this.rdmpPresenter.toggleColumnSelection({id:t.id,select:!0})):(i.channel.publish("roadmap-reset-visiblecolumns-preference"),i.channel.publish({event:"roadmap-load-selected-revisions",data:{selectionsMap:{[t.id]:{isVersion:!0,id:t.id,displayName:t.title,revision:t.revision,name:t.title,maturityState:t.objectMaturityState,maturity:t.objectMaturityStateNLS,responsibilities:t.objectResponsibilities,type:t.type,typeNLS:t.typeNLS}}}}),i.channel.publish({event:"roadmap-update-context-display",data:{id:t.id,displayName:t.title,revision:t.revision,typeNLS:t.typeNLS,type:t.type,image:""}})),!0}return i.channel.publish({event:"roadmap-reset-visiblecolumns-preference"}),!1}},b.prototype._getToolbarOptions=function(e){var t=this,i=[];if(h.VIEWID.COMPACTVIEW===e){let e=[];t.isMvFrozen(this.state)||(e.push({id:"addToBacklog",text:v.addToBacklog,selectable:!1,items:[{id:"addToBacklog-NewRequirement",text:v.createRequirement,selectable:!1,handler:function(){t._compactViewId=t.parentId,t._createRequirementDialog(t.parentId)}},{id:"addToBacklog-addExistingrequirement",text:v.addExistingRequirement,selectable:!1,handler:function(){t.channel.publish({event:"roadmap-list-add-existing-item",data:{viewId:t.parentId}})}}]}),e.push({id:"addToPlanned",text:v.addToCommitted,selectable:!1,items:[{id:"addToPlanned-NewRequirement",text:v.createRequirement,selectable:!1,handler:function(){t._compactViewId=t.id,t._createRequirementDialog(t.id)}},{id:"addToPlanned-addExistingrequirement",text:v.addExistingRequirement,selectable:!1,handler:function(){t.channel.publish({event:"roadmap-list-add-existing-item",data:{viewId:t.id}})}}]})),i.push({id:"createForCompactView",text:v.NEW,category:"new",disabled:!1,fonticon:"plus",content:e}),i.push({id:"removeRequirements",text:v.REMOVE,category:"destructive",fonticon:"remove",disabled:!1,handler:function(){t.channel.publish({event:"roadmap-list-remove-selected"})}})}else h.VIEWID.FULLVIEW===e&&(i.push({id:"createFullView",text:v.NEW,category:"new",disabled:!1,fonticon:"plus",content:[{id:"createFullView-NewRequirement",text:v.createRequirement,selectable:!1,handler:function(){t._compactViewId="";let e=t.rdmpPresenter.getActiveViewId(),i=e||t.parentId;t._createRequirementDialog(i)}},{id:"createFullView-addExistingrequirement",text:v.addExistingRequirement,selectable:!1,handler:function(){t.channel.publish({event:"roadmap-list-add-existing-item"})}}]}),i.push({id:"removeRequirements",text:v.REMOVE,fonticon:"remove",disabled:!1,category:"destructive",handler:function(){t.channel.publish({event:"roadmap-list-remove-selected"})}}));return{withSelectRevisionAction:!0,withBacklogPaneToggleAction:!0,actions:i}},b.prototype._createRequirementDialog=function(e){let t=[],i=this.reqSubTypesOptions;i&&i.length>1&&t.push({type:"select",label:v.TYPE,name:"type",options:i,position:2}),t.push({type:"select",label:v.REQUIREMENT_CLASSIFICATION,name:"classification",options:h.CLASSIFICATIONFIELDS,position:4}),s.show({id:"requirement",modelEvent:this.channel,title:v.newRequirement,withCreateAndClose:!0,parentId:e,fields:t})},b.prototype._createRequirement=function(e){var t=this;t.channel.unsubscribe(t.evtToken);let i,a=1;t._compactViewId?(a=this.rdmpPresenter.getNextRank(t._compactViewId),i=this.rdmpPresenter.getListView(t._compactViewId)):(a=this.rdmpPresenter.getNextRank(),i=this.rdmpPresenter.getListView()),i&&p.mask(i,v.LOADING);let o=e.content;o.rank=a.toString();let s={scoringModel:t.rdmpPresenter.selectedScoringModelId?t.rdmpPresenter.selectedScoringModelId:"",items:[{attributes:o}]};e.parentId===t.parentId?(s.identifier=e.parentId,n.createAndAttachBacklog(s).then(function(e){e.member.forEach(function(e){e.lable=e.title,e.proxyId=e.id,e.sourceid="3dspace"});var n={items:e.member,notifDetails:{level:"success",title:v.creationSuccessful,subtitle:v.creationDescSuccsessful}};t._compactViewId&&(n.viewId=t._compactViewId),t.channel.publish({event:"roadmap-list-add-new-item",data:n}),i&&p.unmask(i)},function(){i&&p.unmask(i),t.channel.publish({event:"roadmap-list-add-new-item",data:{notifDetails:{level:"error",title:v.creationFailed,subtitle:v.creationDesFailed}}})})):(s.identifier=e.parentId,n.createAndAttachCommitment(s).then(function(e){e.member.forEach(function(e){e.lable=e.title,e.proxyId=e.id,e.sourceid="3dspace"});var n={items:e.member,notifDetails:{level:"success",title:v.creationSuccessful,subtitle:v.creationDescSuccsessful}};t._compactViewId&&(n.viewId=t._compactViewId),t.channel.publish({event:"roadmap-list-add-new-item",data:n}),i&&p.unmask(i)},function(){i&&p.unmask(i),t.channel.publish({event:"roadmap-list-add-new-item",data:{notifDetails:{level:"error",title:v.creationFailed,subtitle:v.creationDesFailed}}})}))},b.prototype.defineHandlers=function(t){var i=this;t.handlers={getCreateActionMenu:function(){return[{text:v.createRequirement,handler:function(){let e=i.rdmpPresenter.getActiveViewId(),t=e||i.parentId;i._createRequirementDialog(t)}},{text:v.addExistingRequirement,handler:function(){i.channel.publish({event:"roadmap-list-add-existing-item"})}}]},getStatusbarContent:function(){return{statusBarIcon:function(e){var t=[];let n=i.rdmpPresenter.selectedScoringModelId,a=h.SCORINGMODELATTRBMAP[n]?h.SCORINGMODELATTRBMAP[n]:"";if(a){let i=e.options.grid[a];(i=i?i.toString():"")&&t.push({label:i,icon:"trophy",emphasize:"primary"})}return t},statusbarIconsTooltips:function(e){let t=[],n=i.rdmpPresenter.selectedScoringModelId,a=h.SCORINGMODELATTRBMAP[n]?h.SCORINGMODELATTRBMAP[n]:"";if(a){e.options.grid[a]&&t.push(v.score)}return t},statusbarLabelsWidthRatios:function(){return[.2]}}},loadBacklogItems:function(t){return new e.Promise(function(e,t){n.loadBacklogItems({identifier:i.parentId,type:h.DSPFLMODEL}).then(function(t){t.member.forEach(function(e){e.rank=parseFloat(e.rank);let t=e.scoringValues;for(let e in t)t[e]=parseFloat(t[e])}),e({bItems:t.member})},function(){t({notifDetails:{level:"error",title:v.error,subtitle:v.errorGetBacklogItems}})})})},loadPlannedItems:function(t){return new e.Promise(function(e,i){n.loadBacklogItems({identifier:t.id,type:h.DSPFLMODELVERSION}).then(function(t){t.member.length>0&&t.member.forEach(function(e){e.rank=parseFloat(e.rank);let t=e.scoringValues;for(let e in t)t[e]=parseFloat(t[e])}),e({bItems:t.member})},function(){i({notifDetails:{level:"error",title:v.error,subtitle:v.errorGetPlannedItems}})})})},getEmptyViewButton:function(){return{text:v.CREATE_NEW_REQUIREMENT,handler:function(){let e=i.rdmpPresenter.getActiveViewId(),t=e||i.parentId;i._createRequirementDialog(t)}}},removeBacklogItems:function(t){for(var i=[],a=t.itemIds,o=0;o<a.length;o++)a[o]&&(i[o]={identifier:a[o]});return new e.Promise(function(e,a){n.removeBacklogItems({items:[{identifier:t.id,type:h.DSPFLMODEL,backlog:i}]}).then(function(t){var i=t.member,n=[];i.forEach(function(e){n.push(e.identifier)}),e({bItems:n})},function(){a({notifDetails:{level:"error",title:v.error,subtitle:v.errorRemoveBacklog}})})})},moveToPlanned:function(t){var a=i.keyState.get(t.id);if(i.isMvFrozen(a))return new e.Promise(function(e,t){t({notifDetails:{level:"error",title:v.errorMoveToCommitted,subtitle:v.errorFrozen}})});for(var o=t.items,s=0;s<o.length;s++)o[s].id&&e.merge(o[s],{identifier:o[s].id});return new e.Promise(function(e,a){n.moveToCommitted({items:[{identifier:t.id,type:h.DSPFLMODEL,backlog:o,scoringModel:i.rdmpPresenter.selectedScoringModelId?i.rdmpPresenter.selectedScoringModelId:""}]}).then(function(t){t.member.forEach(function(e){e.rank=parseFloat(e.rank)}),e({bItems:t.member,notifDetails:{level:"success",title:v.moveToPlannedSuccessful}})},function(){a({notifDetails:{level:"error",title:v.error,subtitle:v.errorMoveToCommitted}})})})},moveToBacklog:function(t){var a=i.keyState.get(t.id);if(i.isMvFrozen(a))return new e.Promise(function(e,t){t({notifDetails:{level:"error",title:v.errorMoveToBacklog,subtitle:v.errorFrozen}})});for(var o=t.items,s=0;s<o.length;s++)o[s].id&&e.merge(o[s],{identifier:o[s].id});return new e.Promise(function(e,i){n.removeFromCommitted({items:[{identifier:t.id,type:h.DSPFLMODEL,backlog:o}]}).then(function(t){t.member.forEach(function(e){e.rank=parseFloat(e.rank)}),e({bItems:t.member,notifDetails:{level:"success",title:v.moveToBacklogSuccessful}})},function(){i({notifDetails:{level:"error",title:v.error,subtitle:v.errorMoveToBacklog}})})})},changePlannedFor:function(t){var a=i.keyState.get(t.id);if(i.isMvFrozen(a))return new e.Promise(function(e,t){t({notifDetails:{level:"error",title:v.errorMoveCommitted,subtitle:v.errorFrozen}})});for(var o=t.items,s=0;s<o.length;s++)o[s].id&&e.merge(o[s],{identifier:o[s].id});var r={items:[{modelVersion:{source:{identifier:t.id},target:{identifier:t.toId}},backlog:o}]};return new e.Promise(function(e,t){n.changePlannedFor(r).then(function(t){e({bItems:t.member,notifDetails:{level:"success",title:v.commitSuccessful,subtitle:v.commitDescSuccessful}})},function(){t({notifDetails:{level:"error",title:v.error,subtitle:v.errorMoveCommitted}})})})},addBacklogItems:function(t){var a=i.rdmpPresenter.selectedScoringModelId?i.rdmpPresenter.selectedScoringModelId:"";"None"==a&&(a="none");for(var o=t.items,s=0;s<o.length;s++)o[s].id&&(e.merge(o[s],{identifier:o[s].id}),o[s].rank=o[s].rank.toString());return new e.Promise(function(e,t){n.addBacklogItems({items:[{identifier:i.parentId,type:h.DSPFLMODEL,backlog:o,scoringModel:a}]}).then(function(t){t.member.forEach(function(e){e.rank=parseFloat(e.rank)}),e({bItems:t.member,notifDetails:{level:"success",title:v.additionSuccsessful,subtitle:v.additionDescSuccsessful}})},function(){t({notifDetails:{level:"error",title:v.error,subtitle:v.errorAddBacklog}})})})},addPlannedItems:function(t){var a=i.rdmpPresenter.selectedScoringModelId?i.rdmpPresenter.selectedScoringModelId:"";"None"==a&&(a="none");for(var o=t.items,s=0;s<o.length;s++)o[s].id&&(e.merge(o[s],{identifier:o[s].id}),o[s].rank=o[s].rank.toString());return new e.Promise(function(e,i){n.addPlannedItems({items:[{identifier:t.id,type:h.DSPFLMODELVERSION,backlog:o,scoringModel:a}]}).then(function(t){t.member.forEach(function(e){e.rank=parseFloat(e.rank)}),e({bItems:t.member,notifDetails:{level:"success",title:v.additionSuccsessful,subtitle:v.additionDescSuccessfulCommitted}})},function(){i({notifDetails:{level:"error",title:v.error,subtitle:v.errorAddPlanned}})})})},reorderRoadmapItems:function(t){for(var a=[],o=t.items,s=0;s<o.length;s++)if(o[s].id){var r={identifier:o[s].id,attributes:{rank:o[s].rank.toString()}};a.push(r)}var l={items:[{identifier:i.parentId,type:h.DSPFLMODEL,backlog:a}]};return new e.Promise(function(e,t){n.reorderRoadmapItems(l).then(function(t){for(let e in t)t[e]=parseFloat(t[e]);e({bItems:t})},function(){t({notifDetails:{level:"error",title:v.error,subtitle:v.errorReorderRoadmap}})})})},getAvailableScoringModels:function(){return new e.Promise(function(e,t){e({availableScoringModels:h.AVAILABLESCORINGMODELS,availableScoringModelDetails:h.SCORINGMODELMAPPING,typeRepresentation:h.TYPEREPRESENTATION})})},setScoringModel:function(t){var a={items:[{identifier:i.parentId,scoringModel:t.scoringModelId}]};return new e.Promise(function(e,i){n.setScoringModel(a).then(function(i){e({scoringModelId:t.scoringModelId,notifDetails:{level:"success",title:v.sucssScoringModelSet}})},function(){i({notifDetails:{level:"error",title:v.error,subtitle:v.errorScoringModelSet}})})})},getScoringModel:function(t){return new e.Promise(function(e,t){e({selectedScoringModelId:i.selectedScoringModelId})})},removeScoringModel:function(t){var a={items:[{identifier:i.parentId,scoringModel:"none"}]};return new e.Promise(function(e,t){n.setScoringModel(a).then(function(t){e({notifDetails:{level:"success",title:v.sucssScoringModelSet}})},function(){t({notifDetails:{level:"error",title:v.error,subtitle:v.errorRemoveScoringModel}})})})},getScoringValues:function(t){var a=[];t.forEach(function(e){var t={identifier:e};a.push(t)});var o={items:[{identifier:i.parentId,scoringModel:i.rdmpPresenter.selectedScoringModelId?i.rdmpPresenter.selectedScoringModelId:"",backlog:a}]};return new e.Promise(function(t,i){n.getScoringValues(o).then(function(i){for(let t in i)if(i[t]&&e.is(i[t],"object")){var n=i[t];for(let e in n)n[e]=parseFloat(n[e]);e.merge(i[t],{proxyId:t})}t({scoringValues:i})},function(){i({notifDetails:{level:"error",title:v.error,subtitle:v.errorGetScoringVal}})})})},setScoringValues:function(t){function a(e,t){var i=new RegExp("^-?\\d+(?:.\\d{0,"+(t||-1)+"})?");return e.toString().match(i)[0]}var o=i.keyState.get(t.versionId);if(i.isMvFrozen(o))return new e.Promise(function(e,t){t({notifDetails:{level:"error",title:v.errorSetScoringValues,subtitle:v.errorFrozen}})});var s=i.rdmpPresenter.selectedScoringModelId,r=[],l=[];for(let e in t.bItemsScores)t.bItemsScores[e]&&r.push(e);r.forEach(function(e){var i=t.bItemsScores[e];if(s===h.VALUEEFFORTMODEL){var n=parseFloat(i.valueeffortValue)/parseFloat(i.valueeffortEffort);i.valueeffortValue=i.valueeffortValue.toString(),i.valueeffortEffort=i.valueeffortEffort.toString(),i.valueeffortScore=a(n,2)}else if(s===h.RICESCORINGMODEL){n=parseFloat(i.riceReach)*parseFloat(i.riceImpact)*parseFloat(i.riceConfidence)/(100*parseFloat(i.riceEffort));i.riceScore=a(n,2),i.riceReach=i.riceReach.toString(),i.riceImpact=i.riceImpact.toString(),i.riceConfidence=i.riceConfidence.toString(),i.riceEffort=i.riceEffort.toString()}var o={identifier:e,attributes:i};l.push(o)});var d={items:[{identifier:i.parentId,scoringModel:i.rdmpPresenter.selectedScoringModelId?i.rdmpPresenter.selectedScoringModelId:"",backlog:l}]};return new e.Promise(function(t,i){n.setScoringValues(d).then(function(i){for(let t in i)if(i[t]&&e.is(i[t],"object")){var n=i[t];for(let e in n)n[e]=parseFloat(n[e]);e.merge(i[t],{proxyId:t})}t({scoringValues:i,notifDetails:{level:"success",title:v.saveSuccessful,subtitle:v.scoringValuesSaveSuccess}})},function(){i({notifDetails:{level:"error",title:v.error,subtitle:v.errorSetScoringValues}})})})},isLaneModifiable:function(e){if(e===i.parentId)return!0;var t=i.keyState.get(e);return!i.isMvFrozen(t)},getTypeRepresentationMapping:function(){return{impactDropdown:"select",boundedNumber:"number",effortDropdown:"select"}},getSortModelInfo:function(t){if(!e.is(t))return h.DEFAULTATTRIBUTESFORSORTING;switch(t){case"ScoringModel_RICE":return h.DEFAULTATTRIBUTESFORSORTING.concat(h.RICEATTRIBUTESFORSORTING).concat();case"ScoringModel_ValueEffort":return h.DEFAULTATTRIBUTESFORSORTING.concat(h.VEATTRIBUTESFORSORTING).concat();case"None":default:return h.DEFAULTATTRIBUTESFORSORTING}},getBacklogIdsToExclude:function(t){var i={identifier:t.id};return new e.Promise(function(e,t){n.getAllPlannedItems(i).then(function(t){let i=t.member,n=[];for(let e=0;e<i.length;e++)n.push(i[e].identifier);e(n)},function(){t(excludedIds)})})},updateToolbarOptions:function(e){return i._getToolbarOptions(e.viewId)},getContentTabHandlers:function(){return{getTypesToShowContentTab:function(){return i.allowedTypes},setRequirementContent:function(t){return new e.Promise(function(e,i){n.modifyRequirements(t).then(function(){e()},function(){i()})})},getRequirementContent:function(t){return new e.Promise(function(e,i){n.getRequirementContent('["'+t+'"]').then(function(t){e(t)},function(){i()})})}}},getFullViewWidgetTitle:function(){return i.rdmpPresenter.options.objectTitle+" "+i.rdmpPresenter.options.objectRevision},getFullViewColumnSubHeader:function(e){return e.maturityStateNLS?e.maturityStateNLS:e.maturityState?e.maturityState:""},commandsToRefreshInFullView:function(){return["createFullView","removeRequirements"]},commandsToRefreshWithNoData:function(){return["removeRequirements"]},filterColumnTextAndIcon:function(){return{}},onChangeContext:function(t){return new e.Promise(function(e,i){n.getModelId({id:t.objectId}).then(function(t){if(t.member&&t.member.length>0){let i={id:t.member[0].modelID};e(i)}},function(){console.log("Issue in retriving Model's id")})})},loadRoadmapOnChangeContext:function(t){i.channel.publish({event:"roadmap-reset-visiblecolumns-preference"}),i.updateDataItemOptions(t),i.initializeRoadmapPresenter(i.options),i.updateWidgetX3DContentIdData(),_.debouncer(function(){require(["DS/ENOXModelApp/Utils/xModelLinkManager"],i=>{e.log("Publishing Item Opened for Roadmapping event on Link Manager"),i.publish("DS/ENOXMDLDEF/ITEM/OPENED/FROM/ROADMAP",t)})},1e3).call(i)}}},b.prototype.isMvFrozen=function(e){return"Review"===e||"Release"===e||"Obsolete"===e},b.prototype.saveAction=function(t){var i,a,o=this,s=this._ckEditor;if(s){var r=s.getData().trim(),l={items:[{physicalid:t,attributes:{contentData:r.trim().replace(/\n/g,""),contentText:(i=r.trim(),(a=document.createElement("div")).innerHTML=i,a.textContent||a.innerText),contentType:"html"}}]};n.modifyRequirements(l).then(function(){e.log("modifyRequirements : done"),o.channel.publish({event:"roadmap-show-notification",data:{notifDetails:{level:"success",title:v.editReqContent,subtitle:v.editReqContentDesc}}})},function(){e.log("LocalRequirementsPresenter modifyRequirements : Service Call Failed !!!"),o.channel.publish({event:"roadmap-show-notification",data:{notifDetails:{level:"error",title:v.error,subtitle:v.errEditReqContentDesc}}})})}},b.prototype.cancelAction=function(e){this.loadRequirementContent(e)},b.prototype.loadRequirementContent=function(t){var i=this;n.getRequirementContent('["'+t+'"]').then(function(e){if(e&&e.member&&e.member.length>0){var t=e.member[0],n=i._ckEditor,a=t&&t.contentData||"";n&&n.setData(a)}},function(){e.log("LocalRequirementPresenter : getRequirementDetails service failed"),i.channel.publish({event:"roadmap-show-notification",data:{notifDetails:{level:"error",title:v.error,subtitle:v.errContentLoad}}})})},b.prototype.subscribeToEvents=function(){let t=this,i=this._channelTokensMap.get(this.channel),n=this.channel.subscribe({event:"enox-dialog-creation"},function(e){t._createRequirement(e)});i.push(n),i.push(this.channel.subscribe({event:"roadmap-launch-revision-explorer"},function(i){console.log("Launch Revision Explorer for revision selections!!");let n=i&&i.loadedIdList?i.loadedIdList:[];t.verExplInstance||(t.verExplInstance=new a({id:t.id,type:h.TYPE,target:"Select Items to load for Planning",renderTo:void 0,selectionMode:o.SELECTION_MODES.MULTI_SELECT_ONLY,modelEvents:t._versionExplorerEvents,versionData:[],setActiveVersion:!1}),t.verExplInstance.versionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",function(i){if(console.log("Version explorer modal dialog OK clicked"),i&&e.is(i,"array")){let n={};i.forEach(i=>{if(i&&i.getAttributeValue("id")){let a=i._options.data;if(i.options.grid){let n={maturityState:i.options.grid.maturity,maturityStateNLS:i.options.grid.maturity_nls};t.keyState.set(i.options.grid.id,i.options.grid.maturity),e.merge(a,n)}n[i.getAttributeValue("id")]=a}}),t.channel.publish({event:"roadmap-load-selected-revisions",data:{selectionsMap:n}})}}),t.verExplInstance.versionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",function(){e.log("Version explorer modal dialog Cancel clicked")}));var s={id:t.id,title:v.selectItems,type:h.TYPE,target:v.selectItems,renderTo:void 0,selectionMode:o.SELECTION_MODES.MULTI_SELECT_ONLY,modelEvents:t._versionExplorerEvents,versionData:[],setActiveVersion:!1};t.verExplInstance.showVersionExplorerForRoadmap({options:s,onComplete:function(){e.log("Version explorer load is complete"),n.forEach(e=>{t.verExplInstance.versionExplorer.select(e,!1)})}})})),i.push(this.channel.subscribe({event:"roadmap-requesting-to-load-revisions"},function(){t.getEvolutionsInLine()})),i.push(this.channel.subscribe({event:"roadmap-container-rendered"},function(){setTimeout(()=>{t._isRoadmapInitializing&&(t._isRoadmapInitializing=!1,p.isMasked(widget.body)&&p.unmask(widget.body))},300)}))},b.prototype.getEvolutionsInLine=function(t){var i=this;n.getVersionsAssociatedWithModel({data:[{id:i.id,identifier:i.id,type:h.TYPE}]}).then(function(t){i.id;var a=t.results[0].versions,o=[];let s=[],r=[];for(var l,d=0;d<a.length;d++){var c=a[d];c.ancestors?"Revision"===c.ancestors[0].edgeType?(s.push(c.id),r.push(c.ancestors[0].id)):c.id===i.id&&(l=c.id,o.push(c.id)):l||(o.push(c.id),l=c.id)}for(let e=0;e<r.length;e++){let e=r.indexOf(l);e>=0&&(o.push(s[e]),l=s[e])}o=o.slice(o.indexOf(i.id)),n.getMVItems(JSON.stringify(o)).then(function(t){for(var n=[],a=t.member,o=0;o<a.length;o++){var s=a[o],r={isVersion:!0,id:s.identifier,displayName:s.title,revision:s.revision,name:s.name,maturityState:s.nlsValues.nlsState?s.nlsValues.nlsState:s.state};i.keyState.set(s.identifier,s.state),n.push(r)}n&&n.length>0?i.channel.publish({event:"roadmap-load-revisions",data:n}):e.log("RoadmapController: Version list empty!! something is fisshy!")},function(){e.log("RoadmapController: Version list empty!! something is fisshy!")})},function(){e.log("RoadmapController: Version list empty!! something is fisshy!")})},b.prototype.updateWidgetX3DContentIdData=function(t){let i=t||this.options,n=widget.getValue("X3DContentId"),a=(n=e.is(n)&&""!==n?JSON.parse(n):void 0)&&n.data&&n.data.controllerOptions?n.data.controllerOptions:void 0;a&&a.parentId&&a.parentId!==i.parentId&&(a.id=i.id,a.parentId=i.parentId,a.parentTitle="",a.parentRevision="",a.objectTitle=i.objectTitle,a.objectRevision=i.revision,a.objectMaturityState=i.objectMaturityState,a.objectMaturityStateNLS=i.objectMaturityStateNLS,a.objectResponsibilities=i.objectResponsibilities,e.log("After update of x3dContentId data"),widget.setValue("X3DContentId",JSON.stringify(n)))},b.prototype.destroy=function(){this._channelTokensMap&&this._channelTokensMap.forEach((e,t)=>{t&&e&&e.length>0&&e.forEach(e=>{t.unsubscribe(e)})}),this.rdmpPresenter&&(this.rdmpPresenter.destroy(),this.rdmpPresenter=void 0),this.verExplInstance&&(this.verExplInstance=void 0)},b}),define("DS/ENOXModelApp/InformationPanels/RoadMapTab/js/RoadMapTabPresenter",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/comm/EventManager","DS/ENOXModelApp/RoadMap/ENOXModelRoadmapController","DS/CoreEvents/ModelEvents","i18n!DS/ENOXModelApp/assets/nls/xModelApp","i18n!DS/ENOXModelApp/assets/nls/RoadMap/EnoxModelRoadMapDrivers","css!DS/ENOXModelApp/InformationPanels/RoadMapTab/css/RoadMapTabPresenter.css"],function(e,t,i,n,a,o,s,r,l,d){"use strict";const c=["Requirement"];return t.extend(i,n,{name:"roadmap-tab-container",init:function(e){this._parent(e),this._roadmapController=null,this._initContainer()},_initContainer:function(){var t=this.options;this.elements.container=e.createElement("div",{class:"roadmap-tab-container"}),this._roadmapController=new o,this._roadmapController.init({id:t.id,title:t.title,revision:t.revision,parentId:t.parentId,parentTitle:t.parentTitle,state:t.state,objectTypeImage:t.image?t.image:"",typeNLS:r.TYPE_MODELVERSION,parentRevision:"-",containerForCompactView:this.elements.container,containerForFullView:function(){},type:"Products",allowedTypes:c,supportedTypes:["Products"],modelEvents:new s,compactView:!0,withSingleTaggerManagement:!0,withNavigatioButtons:!0,nls_override:l,withInformationPanel:!0,withProxyManagement:!1,isUserAllowedToModifyRodmap:!1,launchFullViewAsWidget:!0,maxColumnsCount:5,withUniqueBacklog:!0,withReordering:!0,withLaneExpander:!0,roadmapSettings:{withScoringModel:!0},withSingleTaggerManagement:!0,withVersionExpander:!0,withContentTab:!0})}})}),define("DS/ENOXModelApp/BaseConfigDefinition/BaseConfigDetails",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","UWA/Class/Model","DS/ENOXIDCardContainer/js/ENOXIDCardContainer","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/CfgSolver/CfgSolverServices","DS/ENOXModelApp/Utils/xModelIDCardAttributeEditor","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/BaseConfigDefinition/Presenter/BaseConfigurationTablePresenter","DS/ENOXModelApp/BaseConfigDefinition/Model/BaseConfigurationModel","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/PCListPresenter","i18n!DS/ENOXModelApp/assets/nls/BaseConfigDefinition/BaseConfigDetails","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/CfgBulkTablePresenter/assets/nls/BulkTablePresenter","css!DS/ENOXModelApp/BaseConfigDefinition/BaseConfigDetails.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w){"use strict";window.localStorage.XMODEL_BROWSER_LOG_DEBUG;var O=function(){};return O.prototype.init=function(e,t,n){this.options=n||{},this._modelVersionId=n.modelVersionId,this._pathBCDetail=[h._KEY,h._VIEWS_PREFERENCES,h._BASE_CONFIGURATIONS_DETAILS],this._applicationChannel=e,this._privateChannelForRules=n.privateChannelForRules||new i,this.options._solverModelEventsBC=t,this._privateChannelForConfigs=n.privateChannelForConfigs,this._privateModelEvents=new i,this._myEventManager=new u(this._applicationChannel,this._privateModelEvents,this._privateChannelForRules),this._solverKey="",this.id="",this._selectedBCs=[],this._arrayColumnIDsToCheck=[],this._arrayColumnIDsChecked=[],this._bufferFetchIds=[],this._bufferFetchPromises=[],this._subscribeToEvents(),this._initCommand(),this._enoxIDCardContainer=new o,this._idCardAttrbEditorUtil=new l,this._idCardAttrbEditorUtil.init(this._privateModelEvents),this._initPropertyPanel()},O.prototype.loadVariabilityInfo=function(e){if(this._variabilityDictionary=e,this._bulkTableModel=new D(e),this._bulkTableModel.getJsonModel()){var t=this._bulkTableModel.getJsonModel();this.options.jsonModel=t,this.options.bulkTableModel=this._bulkTableModel;var i=this._bulkTableModel.getNbRows();this.options.jsonModel.nbRows=i,this.options.privateChannel=this._privateModelEvents,this.options.applicationChannel=this._applicationChannel}this._baseConfigurationTablePresenter=new S(this.options)},O.prototype.fetchData=function(i){var n=this;return new Promise((a,o)=>{e.is(i,"array")&&i.length?e.is(n._batchLoadingPromise)?(n._bufferFetchIds=n._bufferFetchIds.concat(i),n._bufferFetchPromises.push({resolve:a,reject:o})):(n._baseConfigurationTablePresenter._container&&t.mask(n._baseConfigurationTablePresenter._container),n._batchLoadingPromise=n.batchLoading(i).then(function(){n._batchLoadingPromise=null,t.unmask(n._baseConfigurationTablePresenter._container),setTimeout(function(){n._bufferFetchIds.length&&(n.fetchData(n._bufferFetchIds).then(function(){n._bufferFetchPromises.forEach(function(e){e.resolve()})}),n._bufferFetchIds=[])}),a()},function(e){n._batchLoadingPromise=null,t.unmask(n._baseConfigurationTablePresenter._container),o(e)})):o(new Error("Empty List"))})},O.prototype.loadElement=function(e){return s.getConfigurationDetailsBC({id:e.id,parentID:this._modelVersionId})},O.prototype.batchLoading=function(e){var t=this;return new Promise((i,n)=>{var a=[];e.length&&a.push(t.loadElement(e.shift())),e.length&&a.push(t.loadElement(e.shift())),e.length&&a.push(t.loadElement(e.shift())),e.length&&a.push(t.loadElement(e.shift())),a.length?Promise.all(a).then(a=>{setTimeout(function(){a.forEach(function(e){e.member[0].modelID=t._modelVersionId,t._bulkTableModel.createColumn(e.member[0])}),t._createColumnsForLoadedData(a),t.batchLoading(e).then(function(){i()},function(e){n(e)})})}):(i(),t.checkConflicts().then(function(){t.checkValidity()}))})},O.prototype.checkConflicts=function(){var e=this;return new Promise((t,i)=>{this.callSolverToAbort().then(async function(){for(var i=0;i<e._arrayColumnIDsToCheck.length;i++){var n=e._arrayColumnIDsToCheck[i],a=await e.callSolverToCheckConflict(null,n,"no");e._baseConfigurationTablePresenter.updateLoadingState(i+1,e._arrayColumnIDsToCheck,"statusComputing"),e.applySolverAnswer(a,n),e._baseConfigurationTablePresenter.updateDGV(n+e._baseConfigurationTablePresenter.COLUMN_ID_INDEX)}t()}).catch(function(e){i(e)})})},O.prototype.checkValidity=function(){var e=this;return new Promise((t,i)=>{this.callSolverToAbort().then(async function(){for(var i=0;i<e._arrayColumnIDsToCheck.length;i++){var n=e._arrayColumnIDsToCheck[i],a=await e.callSolverToCheckValidity(n,"no");e._baseConfigurationTablePresenter.updateLoadingState(i+1,e._arrayColumnIDsToCheck,"statusSuggestion"),e._arrayColumnIDsToCheck.splice(i,1),i--,e.applySolverAnswer(a,n),e._baseConfigurationTablePresenter.updateDGV(n+e._baseConfigurationTablePresenter.COLUMN_ID_INDEX)}t()}).catch(function(e){i(e)})})},O.prototype.applySolverAnswer=function(e,t){if(e){var i=JSON.parse(e),n=i._rc;"OK"===n?this._bulkTableModel.updateJsonModel(i._data,t,i._from):"ERROR"===n&&console.error("ERROR solve notification")}},O.prototype.getConflictingRulesDetails=function(t,i,n){var a=this;if(t.causingRulesList.length>0)s.getRuleDetailsFromIds(t.causingRulesList,function(e){var o={},s=a._getBCConflictReason(e.member,i);o.reasons=s,o.wsData=e,a._baseConfigurationTablePresenter.updateTooltip(i,t,e.member),"statesConflicts"===n&&a._baseConfigurationTablePresenter.showConflictingPanel(o)},function(){e.log("getRuleDetails: Service Call Failed !!!"),M.showError(A.GetRuleDetailsError)});else if(t.causingValuesList.length>0){var o=this._bulkTableModel.getRowHeaderData(i.grid.parentRowHeaderID);if(o.mandatory){for(var r=o.children,l=0,d=0;d<r.length;d++){var c=this._bulkTableModel.getCellState(i.columnId-2,i.rowId-1);t.causingValuesList.includes(r[d].id)&&"N"===c&&l++}if(l===r.length){var p={},u={constrained:i.grid.title,drivingCombinationValuesText:i.grid.parentTitle,constrainedCriteria:o,type:"conflictMandatory"};p.reasons=u,a._baseConfigurationTablePresenter.showConflictingPanel(p),a._baseConfigurationTablePresenter.updateTooltip(i,t,t.causingRulesList)}}}},O.prototype._getBCConflictReason=function(e,t){var i={};i.privateChannelForRules=this._privateChannelForRules;for(var n=[],a=0;a<e.length;a++)n.push(e[a]);return i.causingRulesList=n,i.type="ConfigConflict",i.drivingCombinationValuesText=t.grid.parentTitle+"["+t.grid.title+"] "+A.CONFLICT,i},O.prototype.callSolverToCheckConflict=function(t,i,n){if(i>=0){let a=e.is(t)?t:this.jsonModel,o=this._bulkTableModel.getJsonModelSolverFormat(a,i);return o?(o.runtimeCauseComputation=n,r.callSolveForBCCheckConflict(o,this._solverKey)):e.Promise.resolve()}},O.prototype.callSolverToAbort=function(){return r.abortSolverCall(this._solverKey,this._solverModelEventsBC)},O.prototype.callSolverToCheckValidity=function(t,i){let n=this._bulkTableModel.getJsonModelSolverFormat(null,t);return n?(n.runtimeCauseComputation=i,r.callSolveForBCCheckValidity(n,this._solverKey)):e.Promise.resolve()},O.prototype._createColumnsForLoadedData=function(t){var i=m.userID;if(t){for(var n=0;n<t.length;n++)if(t[n].member&&e.is(t[n].member,"array")){for(var a=t[n].member[0].id,o=this._bulkTableModel.getColumnID(a),s=t[n].member[0].selectedCriteria.member,r=0;r<s.length;r++){var l={id:s[r].id,status:s[r].status};this._bulkTableModel.updateJsonModel(l,o)}if(this._arrayColumnIDsToCheck.push(o),void 0!==o){var d=this._bulkTableModel.getColumnHeader(o);d.selectedValues=this._bulkTableModel.getColumnData(o),this._baseConfigurationTablePresenter.createColumn(d)}""!=t[n].member[0].reservedby&&t[n].member[0].reservedby!=i&&M.showWarning(e.String.format(P.LOCKED_OBJ_INFO_ALERT,t[n].member[0].title,t[n].member[0].reservedbyFullName))}1==t.length&&"TRUE"==t[0].member[0].reserved&&t[0].member[0].reservedby!=i?(this._privateModelEvents.publish({event:"enox-collection-toolbar-disable-action",data:"painter"}),this._privateModelEvents.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{id:"painter",text:e.String.format(w.Lock_Action_Tooltip,t[0].member[0].reservedbyFullName)}}),this._privateModelEvents.publish({event:"enox-collection-toolbar-disable-action",data:"edit-pencil"}),this._privateModelEvents.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{id:"edit-pencil",text:e.String.format(w.Lock_Action_Tooltip,t[0].member[0].reservedbyFullName)}})):(this._privateModelEvents.publish({event:"enox-collection-toolbar-enable-action",data:"painter"}),this._privateModelEvents.publish({event:"enox-collection-toolbar-enable-action",data:"edit-pencil"}),this._privateModelEvents.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{id:"painter",text:e.String.format(w.Painter)}}),this._privateModelEvents.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{id:"edit-pencil",text:e.String.format(w.Enable_Edit)}}))}},O.prototype.removeAllLoadedBCs=function(){var e=this;if(this._baseConfigurationTablePresenter){var t=this._baseConfigurationTablePresenter.getLoadedBCs();t&&Object.keys(t).length>0&&Object.values(t).forEach(function(t){e.removeLoadedBC(t)})}},O.prototype.removeLoadedBC=function(t){if(t){var i=t;e.is(t,"array")||(i=[t]);for(var n=0;n<i.length;n++){var a=this._bulkTableModel.getColumnHeader(this._bulkTableModel.getColumnID(i[n].id));a&&a.isAsReference&&this._privateModelEvents.publish({event:"enox-collection-toolbar-change-icon-action",data:{id:"compare-pc",fonticon:"variants-and-options-compare",text:A.HighlightDifferences}}),this._bulkTableModel.removeColumn(i[n]),this._baseConfigurationTablePresenter.removeColumnFromDGV(i[n])}}},O.prototype.getNbLoadedBCs=function(){return this._bulkTableModel.getAllColumnIDs().length},O.prototype._initCommand=function(){this._command=new c(this._privateModelEvents,this._container,this._applicationChannel)},O.prototype._initPropertyPanel=function(){v.initialize({applicationChannel:this._applicationChannel,context:"BaseConfiguration",id:this.id})},O.prototype.inject=function(e){this._baseConfigurationTablePresenter.inject(e)},O.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:I._single_configuration,multiple:I._multiple_configuration,modelEvent:t,immersiveFrame:E.getImmersiveFrame(),showTypeInfo:!0};_.showDialog(i)},O.prototype.actionDropDownMenuIdCard=function(e){var t=this._bulkTableModel.getColumnHeader(0),i=this._bulkTableModel.getColumnAttributes(t.id);switch(e){case"information":v.removeAllSelection(),v.showInformation(i.id);break;case"delete":if(g.checkActionAccess({action:b.DELETE,type:b.TYPE_BASECONFIG,notify:!0})){var n=[{id:i.id,title:i.title,type:i.type}];this.createDeleteModelDialog(n,this._privateModelEvents)}break;case"owner":g.checkActionAccess({action:b.MOVE,type:b.TYPE_BASECONFIG,notify:!0})&&this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:{id:i.id,title:i.title},linkId:"owner"}});break;case"state":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:{id:i.id,name:i.name},linkId:e}});break;case"revision":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:i,linkId:"revision"}})}},O.prototype._subscribeToEvents=function(){let e=this;this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-dropdown-menu-action"},function(t){e.actionDropDownMenuIdCard(t)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-model-refresh"},function(t){e._refreshIdCardModel(t)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"enox-dialog-delete"},function(t){e.deleteBaseConfig(t)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-minified"},function(){m.updateCollapse(e._pathBCDetail,!0)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-maximized"},function(){m.updateCollapse(e._pathBCDetail,!1)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-open-version-explorer"},function(){e.versionExplorer&&e.versionExplorer.showVersionExplorer()}),this._myEventManager.subscribe(this._privateModelEvents,{event:"xmodel-baseConfig-on-modify"},function(t){if(t){var i=t.value,n=t.cellInfos,a={id:n.nodeModel.options.id,status:i,parentRowId:n.nodeModel.options.grid.parentRowHeaderID};e._bulkTableModel.setDirtyColumnHeader(n.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX),e._bulkTableModel.updateJsonModel(a,n.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX);e.callSolverToCheckConflict(null,n.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX,"no").then(function(t){e.applySolverAnswer(t,n.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX),e.callSolverToCheckValidity(n.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX,"no").then(function(t){e.applySolverAnswer(t,n.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX),e._baseConfigurationTablePresenter.updateDGV(n.columnID)})})}}),this._myEventManager.subscribe(this._privateModelEvents,{event:"xmodel-baseConfig-on-save"},function(){t.mask(e._baseConfigurationTablePresenter._container);var i=e._bulkTableModel.getDirtyColumnIDs();if(i.length>0){var n=e._bulkTableModel.getSelectedCriteriaForPersistance();s.modifyBC({parentID:e._modelVersionId,attributes:e._bulkTableModel.getCompletenessStatus(),ids:i,member:n}).then(function(n){e._baseConfigurationTablePresenter._editionflag&&e._baseConfigurationTablePresenter.onTableUpdateEnd(),r.removeBaseConfigurations(i,e._solverKey),t.unmask(e._baseConfigurationTablePresenter._container),M.showSuccess(A.BC_SUCCESS_SAVE),p.BC_ENFORCEMENT_ENABLED&&(r.addBaseConfigurations(n,e._solverKey,!0),e._privateChannelForConfigs.publish({event:"xmodel-dictionary-data"}))},function(){e._baseConfigurationTablePresenter.onTableUpdateEnd(),t.unmask(e._baseConfigurationTablePresenter._container),M.showError(A.BC_FAILURE_SAVE)}),console.log("test")}else t.unmask(e._baseConfigurationTablePresenter._container),M.showSuccess(A.BC_SUCCESS_SAVE)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"compute-conflict-baseConf"},function(t){if(t&&t.columnID){e._valueInConflict=t.nodeModel.options,e._valueInConflict.columnId=t.columnID,e._valueInConflict.rowId=t.rowID,e._valueInConflict.cellModel=t.cellModel,e.callSolverToCheckConflict(null,t.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX,"yes").then(t=>{t&&e.applyCheckConflictAnswer(t)})}}),this._myEventManager.subscribe(this._privateModelEvents,{event:"compute-suggestion-baseConf"},function(t){if(t&&t.columnID){e._valueInConflict=t.nodeModel.options,e._valueInConflict.columnId=t.columnID,e._valueInConflict.rowId=t.rowID,e._valueInConflict.cellModel=t.cellModel,e.callSolverToCheckValidity(t.columnID-e._baseConfigurationTablePresenter.COLUMN_ID_INDEX,"yes").then(function(t){t&&e.applyCheckConflictAnswer(t)})}}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"solver-init-completed"},function(t){t&&(e._solverKey=t)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"enox-collection-toolbar-action-activated"},function(t){if("edit-pencil"!==t&&"compare-pc"!==t&&(e._baseConfigurationTablePresenter.actionToolBar(t),e._baseConfigurationTablePresenter.getPainterPreviousState()!==e._baseConfigurationTablePresenter.getPainterState())){e._baseConfigurationTablePresenter.updateDGVLayout();var i=e._baseConfigurationTablePresenter.getPainterState();e._baseConfigurationTablePresenter.setPainterPreviousState(i)}})},O.prototype.applyCheckConflictAnswer=function(e){var t=JSON.parse(e);if(t._data){var i={causingRulesList:this.removeDuplicate(t._data.statesCausingRules),causingValuesList:this.removeDuplicate(t._data.statesCausingValues)};this.getConflictingRulesDetails(i,this._valueInConflict,t._data.runtimeCheckLevel)}},O.prototype.removeDuplicate=function(e){var t=e.flat();return[...new Set(t)]},O.prototype.deleteBaseConfig=function(e){let t=this,i={items:[]};e.forEach(function(e){i.items.push({identifier:e})}),s.deleteBaseConfiguration(i,this.options.modelVersionId).then(function(){if(t.options.modelVersionId){var i={modelVersionId:t.options.modelVersionId,id:t.options.modelVersionId,name:t.options.modelVersionName,version:t.options.modelVersionVersion,refreshPCList:!0};y.navigate(p.ROUTE_MODEL_DETAILS,i,{replace:!0}),t._applicationChannel.publish({event:"breadcrumb-remove-link",data:p.ROUTE_MODEL_BC_DETAILS}),t._applicationChannel.publish({event:"enox-model-app-item-removed",data:e}),t._privateChannelForConfigs.publish({event:"xmodel-on-delete-baseConfig",data:e})}},function(){C.showError({action:b.DELETE,type:b.TYPE_BASECONFIG,message:i})||M.showError(I.ERROR_DELETE_BC)})},O.prototype._refreshIdCardModel=function(t){var i=this;s.getConfigurationDetailsBC({id:t,parentID:i._modelVersionId}).then(function(e){var t=d.prepareIdCardData(e,i._privateModelEvents);i._modelForIdCard.set("attributes",t.get("attributes")),i._modelForIdCard.set("name",t.get("name")),i._modelForIdCard.set("version",t.get("version")),i._modelForIdCard.set("freezones",t.get("freezones"))},function(){e.log("getConfigurationDetails: Service Call Failed !!!")})},O.prototype.loadIDCard=function(e){var t={member:[]},i=this._bulkTableModel.getColumnAttributes(e);t.member.push(i),this._modelForIdCard=d.prepareIdCardData(t,this._privateModelEvents),this._idCardAttrbEditorUtil.setModelAndInitCollabObj(this._modelForIdCard),this._enoxIDCardContainer.init({},this._modelForIdCard);var n=this._baseConfigurationTablePresenter.getContainer(),a=n.parentElement;a.removeChild(n),this._enoxIDCardContainer.inject(a);var o=this._enoxIDCardContainer.getMainContent();this._baseConfigurationTablePresenter.inject(o),m.getCollapse(this._pathBCDetail)&&this._privateModelEvents.publish({event:"idcard-toggle-minified-view"});var s=this._enoxIDCardContainer.getIDCard();if(s){var r=s.getElement(".version");r&&(this.versionExplorer=new f({id:i.id,name:i.name,title:i.title,target:r,renderTo:o,modelEvents:this._privateModelEvents,applicationChannel:this._applicationChannel}))}},O}),define("DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromListPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","DS/Controls/Tab","DS/WebappsUtils/WebappsUtils","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/TreeModel/TreeDocument","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromConstants","DS/ENOXModelApp/Utils/xModelDictionaryUtility","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelCopyFrom","i18n!DS/xDimensionManager/assets/nls/xDimentions","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/NumericalDialogFields","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/VariabilityPresenter"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y){"use strict";var S=function(){},D={Variant:g.TYPE_VARIANT,"Variability Group":g.TYPE_OPTION_GROUP,"Variant Value":g.TYPE_VARIANT_VALUE,"Variability Option":g.TYPE_OPTION,"Variant Parameter":g.TYPE_PARAMETER};return S.prototype.init=function(t,n,a){this.mySettings=e.clone(a.settings),this._launchedFrom=a.launchedFrom,this._applicationChannel=n,this._localChannelForListView=t||new i,this._updateChannelLocal=new i,this._varModelEvent=new i,this._rulesModelEvent=new i,this._configurationsModelEvent=new i,this._myEventManager=new u(this._applicationChannel,this._localChannelForListView,this._updateChannelLocal,this._varModelEvent,this._rulesModelEvent,this._configurationsModelEvent),this._tagActivated=!1,this._enableFetchOnEveryExpand=!0,this._xModelListView=null,this._subscribeToEvents(),this._copyFromPath=[h._KEY,h._VIEWS_PREFERENCES,h._COPY_FROM],this._initListView(),this.tagFriends=this.mySettings.tagFriends||void 0,this.tagProxyName=void 0===this.mySettings.tagProxyName?"ItemsTagProxy":this.mySettings.tagProxyName,this._initDOM(),this._initContainers(),this._initCommand(),this._updateChannelLocal.publish({event:"enox-collection-toolbar-disable-action",data:"delete"})},S.prototype._initCommand=function(){this._command=new c(this._localChannelForListView,this._container,this._applicationChannel)},S.prototype.initVariability=function(){this.varModelTreeDoc=new d({});let t=this;var i=e=>{var t="";switch(e.options.grid.isA){case"variant":t=y.VariantType;break;case"value":t=y.ValueType;break;case"variabilityGroup":case"optionsGroup":t=y.VariabilityGroupType;break;case"option":t=y.OptionType;break;case"parameter":t=y.ParameterType}return t};let n={id:"variabilityListView",model:this.varModelTreeDoc,modelEvents:this._varModelEvent,useAsyncExpand:this.mySettings.useAsyncExpand,defaultNodeDepth:2,useDragAndDrop:!1,childKeys:this.mySettings.childKeys,viewOptions:{currentView:"DataGridView",views:this.mySettings.views,grid:{columns:[{text:g.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",width:"40%",minWidth:150,getCellSemantics:function(e){var t={linkDisplay:!1};return t},getCellEditableState:function(){return!1}},{text:g.NAME,dataIndex:"name",visibleFlag:!1},{text:g.TYPE,dataIndex:"type",groupableFlag:!0,typeRepresentation:"string",getCellValue:function(e){return i(e.nodeModel)},getCellEditableState:function(){return!1},compareFunction:function(e,t,n,a){return(e=i(n))>(t=i(a))?1:e<t?-1:0}},{text:g.MANDATORY,dataIndex:"mandatory",typeRepresentation:"mandatory",editableFlag:!0,width:100,editionPolicy:"EditionInPlace",onCellRequest:function(e){e.rowID>=0&&(void 0!==e.nodeModel.options.grid.mandatory?t.variabilityPresenter.getTypeRepresentationFactory().generateView(e.cellModel,{typePath:"mandatory",readOnly:!0,touchMode:!1,escapeHTML:!1,context:"stdTemplate",visibleFlag:!0,onViewCreated:function(t){t.value=e.nodeModel.options.grid.mandatory,e.cellView._setReusableContent(t)}}):e.cellView._setReusableContent(null))},getCellValue:function(e){return e.nodeModel.options.grid.mandatory}},{text:g.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",width:100,typeRepresentation:"integer",editableFlag:!0,editionPolicy:"EditionInPlace",getCellValue:function(e){return e.nodeModel.options.grid.sequenceNumber},onCellRequest:function(i){i.rowID<0||void 0===i.nodeModel.options||void 0===i.nodeModel.options.grid||(i.nodeModel.options.grid.isA&&"parameter"!==i.nodeModel.options.grid.isA?t.variabilityPresenter.getTypeRepresentationFactory().generateView(i.cellModel,{typePath:"sequenceNumber",readOnly:!0,touchMode:!1,escapeHTML:!1,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:!0},visibleFlag:!0,onViewCreated:function(t){var n=i.nodeModel.options.grid.sequenceNumber;try{n=parseInt(n)}catch(e){n=1}e.is(n,"number")||(n=1),t.value=n,i.cellView._setReusableContent(t)}}):i.cellView._setReusableContent(null))}},{text:g.RANGE,sortableFlag:!1,dataIndex:"range",valueAttribute:["minValue","maxValue"],width:100,kind:["instance"],getCellValue:function(e){var t="";if(e.nodeModel.options.grid.hasOwnProperty("minValue")&&e.nodeModel.options.grid.hasOwnProperty("maxValue")){var i=e.nodeModel.options.grid.minValue.split(" ")[0],n=e.nodeModel.options.grid.maxValue.split(" ")[0];i&&n&&(t=i+y.RangeValueDelimiter+n)}return t}},{text:g.UNIT,groupableFlag:!0,dataIndex:"unit",valueAttribute:["unit"]},{text:g.DIMENSION,groupableFlag:!0,dataIndex:"dimension",valueAttribute:["dimension"],width:100,kind:["instance"],getCellValue:function(e){var t=" ";return e.nodeModel.options.grid.hasOwnProperty("dimension")?(t=e.nodeModel.options.grid.dimension,"Integer"===(t=E.get(t))||"Real"===t?C._noDimensionLabel:t):t}},{text:g.MATURITY_STATE,dataIndex:"maturity",groupableFlag:!0,width:100,getCellValue:function(e){var t=e.nodeModel.options.grid;return t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.maturity?t.maturity:t.state?t.state:""},getCellGroupingKey:function(e){var t=e.nodeModel.options.grid;return t.maturity?t.maturity:t.state?t.state:""}},{text:g.OWNER,dataIndex:"owner",visibleFlag:!1,groupableFlag:!0},{text:g.DESCRIPTION,dataIndex:"description"},{text:g.COLLABSPACE,dataIndex:h._COLLABSPACE_TITLE,groupableFlag:!0},{text:g.ORGANIZATION,dataIndex:h._ORG_TITLE,groupableFlag:!0}],typeRepresentations:{sequenceNumber:{stdTemplate:"spinEdit",semantics:{valueType:"integer",minValue:1,stepValue:1,allowUnsafeHTMLContent:!1}},mandatory:{stdTemplate:"switch"}}},itemViewMapping:this._commonListViewOptions.viewOptions.itemViewMapping},withmultisel:!0,showItemCount:!0,toolbarOptions:{withStableActions:!0,showTaggerFilter:!0,useGeneratedToolbar:!0,keepSelectionOnHide:!0,itemsName:this.mySettings.NLS.itemsName,itemName:this.mySettings.NLS.itemName,actions:[]},emptyContentOptions:this._vbEmptyContentOption.emptyContentOptions,extensions:this._commonListViewOptions.extensions};this.variabilityPresenter=new s(n),this._variabilityContainer=e.createElement("div"),this._variabilityContainer.classList.add("copyfrom-variability-container"),this.variabilityPresenter.inject(this._variabilityContainer)},S.prototype.initRules=function(){this.rulesModelTreeDoc=new d({});let t=this._commonListViewOptions.viewOptions.grid.columns.filter(e=>{if("revision"!=e.dataIndex)return!0}),i={id:"rulesListView",viewOptions:{currentView:"DataGridView",views:this.mySettings.views,grid:{columns:t},itemViewMapping:this._commonListViewOptions.viewOptions.itemViewMapping},useDragAndDrop:!1,modelEvents:this._rulesModelEvent,model:this.rulesModelTreeDoc,withmultisel:!0,showItemCount:!0,toolbarOptions:{showTaggerFilter:!0,useGeneratedToolbar:!0,keepSelectionOnHide:!0,itemsName:this.mySettings.NLS.multipleRules,itemName:this.mySettings.NLS.singleRule,actions:[]},emptyContentOptions:this._rulesEmptyContentOption.emptyContentOptions,extensions:this._commonListViewOptions.extensions};this.rulesPresenter=new s(i),this._rulesContainer=e.createElement("div"),this._rulesContainer.classList.add("copyfrom-rules-container"),this.rulesPresenter.inject(this._rulesContainer)},S.prototype.initConfigurations=function(){this.configurationsModelTreeDoc=new d({});let t={id:"configurationsListView",modelEvents:this._configurationsModelEvent,model:this.configurationsModelTreeDoc,withmultisel:!0,childKeys:["prodCs"],defaultNodeDepth:2,useDragAndDrop:!1,viewOptions:this._commonListViewOptions.viewOptions,showItemCount:!0,toolbarOptions:{showTaggerFilter:!0,useGeneratedToolbar:!0,keepSelectionOnHide:!0,itemsName:this.mySettings.NLS.multipleConfigurations,itemName:this.mySettings.NLS.singleConfiguration,actions:[]},extensions:this._commonListViewOptions.extensions,emptyContentOptions:this._configEmptyContentOption.emptyContentOptions};this.configurationsPresenter=new s(t),this._configurationsContainer=e.createElement("div"),this._configurationsContainer.classList.add("copyfrom-configurations-container"),this.configurationsPresenter.inject(this._configurationsContainer)},S.prototype._initPresenters=function(){this.initConfigurations(),this.initVariability(),this.initRules()},S.prototype._initContainers=function(){switch(this._currentTab=this._launchedFrom,this._launchedFrom){case"variability":this.initVariability(),this._variabilityContainer.inject(this._container);break;case"rules":this.initRules(),this._rulesContainer.inject(this._container);break;case"configurations":this.initConfigurations(),this._configurationsContainer.inject(this._container);break;default:this._initPresenters(),this._initTabs()}},S.prototype._initTabs=function(){let e=this,t=new a({displayStyle:"strip",multiSelFlag:!0});e._currentTab="variability",m.getTab(e._copyFromPath)&&(e._currentTab=m.getTab(e._copyFromPath)),"idcard"!=this._launchedFrom&&this._launchedFrom!=e._currentTab&&(e._currentTab=this._launchedFrom);let i=[];var n={id:"variability",label:g._VARIABILITY,index:0,value:"_0",allowUnsafeHTMLOnTabButton:!1,content:this._variabilityContainer};i.push(n);var o={id:"rules",label:g._RULES,index:1,value:"_1",allowUnsafeHTMLOnTabButton:!1,content:this._rulesContainer};i.push(o);var s={id:"configurations",label:g._CONFIGURATIONS,index:2,value:"_2",allowUnsafeHTMLOnTabButton:!1,content:this._configurationsContainer};i.push(s),i.forEach(i=>{"idcard"==e._launchedFrom?i.isSelected=e._currentTab==i.id:i.isSelected=e._launchedFrom==i.id,t.add(i)}),t.inject(this._container),t.addEventListener("change",function(t){if(void 0===t.dsModel||void 0===t.dsModel.tabBar||t.dsModel&&!t.dsModel.value)return;switch(t.dsModel.value[0]){case"_0":e._currentTab="variability";break;case"_1":e._currentTab="rules";break;case"_2":e._currentTab="configurations"}m.updateTab(e._copyFromPath,e._currentTab),e._localChannelForListView.publish({event:"xmodel-copy-from-tabs-updated",data:e._currentTab})}),m.updateTab(e._copyFromPath,e._currentTab),e._localChannelForListView.publish({event:"xmodel-copy-from-tabs-updated",data:e._currentTab})},S.prototype._initListView=function(){var e=this;this._modelTreeDoc=new d({}),this._stateNLS=f.getStateValue();var t={id:this.mySettings.listViewId,model:this._modelTreeDoc,modelEvents:this._localChannelForListView,useAsyncExpand:this.mySettings.useAsyncExpand,defaultNodeDepth:2,useDragAndDrop:!1,childKeys:this.mySettings.childKeys,restrictSortFlag:!0,viewOptions:{currentView:"DataGridView",views:this.mySettings.views,grid:{columns:[{text:g.TITLE,dataIndex:"tree",typeRepresentation:"string",getCellSemantics:function(e){var t={linkDisplay:!1};return t}},{text:g.REVISION,dataIndex:"revision",groupableFlag:!0,typeRepresentation:"comboSelector",possibleValues:["A","B"],onCellRequest:function(t){t.rowID>=0&&(void 0!==t.nodeModel.options.grid.revision?(e._updateNodeID(t.nodeModel.options.grid.revision,t.nodeModel),t.nodeModel.options.possibleValues=t.nodeModel.options.grid.possibleRevisions,t.nodeModel.value=t.nodeModel.options.grid.revision,e.configurationsPresenter.getTypeRepresentationFactory().generateView(t.cellModel,{typePath:"revisions",readOnly:!1,touchMode:!1,escapeHTML:!1,context:"stdTemplate",visibleFlag:!0,onViewCreated:function(i){e._updateNodeID(t.nodeModel.options.grid.revision,t.nodeModel),i.possibleValues=t.nodeModel.options.grid.possibleRevisions,i.value=t.nodeModel.options.grid.revision,t.cellView._setReusableContent(i)}})):t.cellView._setReusableContent(null))}},{text:g.NAME,dataIndex:"name",groupableFlag:!0},{text:g.TYPE,dataIndex:"type",groupableFlag:!0,getCellValue:function(e){var t=e.nodeModel.options.grid,i=t.nlsValues&&t.nlsValues.nlsType?t.nlsValues.nlsType:t&&t.expressionType?"matrix"===t.expressionType?b.MATRIX_RULE:"expression"===t.expressionType?b.EXPRESSION_RULE:"":t&&t.type?t.type:"";return D[i]?D[i]:i}},{text:g.MATURITY_STATE,dataIndex:"maturity",groupableFlag:!0,getCellValue:function(t){var i=t.nodeModel.options.grid,n=i.nlsValues&&i.nlsValues.nlsState?i.nlsValues.nlsState:i.maturity?i.maturity:i.state?i.state:"";return e._stateNLS["ds6w:status"][n]?e._stateNLS["ds6w:status"][n]:n},getCellGroupingKey:function(t){var i=t.nodeModel.options.grid,n=i.nlsValues&&i.nlsValues.nlsState?i.nlsValues.nlsState:i.maturity?i.maturity:i.state?i.state:"";return e._stateNLS["ds6w:status"][n]?e._stateNLS["ds6w:status"][n]:n}},{text:g.DESCRIPTION,dataIndex:"description"}],typeRepresentations:{revisions:{stdTemplate:"comboSelector",semantics:{possibleValues:["A A","B B","C C"]}}}},itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){return e.options.grid.state+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible)},description:"description",customTooltip:function(e){return p.prepareTooltipObjectView(e)},icon:function(e){switch(e.options.grid.type){case"Variant":return o.getWebappsAssetUrl("ENOXModelApp","icon/variant.png");case"Variant Value ":return o.getWebappsAssetUrl("ENOXModelApp","icon/variantValue.png");case"Option Group":return o.getWebappsAssetUrl("ENOXModelApp","icon/optionGroup.png");case"Option":return o.getWebappsAssetUrl("ENOXModelApp","icon/option.png");case"Product Configuration":return o.getWebappsAssetUrl("ENOXModelApp","icon/ProductConfiguration.png");default:return""}}}},emptyContentOptions:{sentences:[{type:"img",src:this.mySettings.emptyContent.src,sizeicon:"40px",text:b.MSG_EMPTY_LIST_CONTENT}]},toolbarOptions:{keepSelectionOnHide:!0,itemsName:this.mySettings.NLS.itemsName,itemName:this.mySettings.NLS.itemName,actions:[]},extensions:[r,l]};this._commonListViewOptions=t,this._vbEmptyContentOption={emptyContentOptions:{sentences:[{type:"img",src:o.getWebappsAssetUrl("ENOXModelApp","icon/variantValue.png"),sizeicon:"40px",text:b.MSG_EMPTY_LIST_CONTENT}]}},this._rulesEmptyContentOption={emptyContentOptions:{sentences:[{type:"img",src:o.getWebappsAssetUrl("ENOXModelApp","icon/rules.png"),sizeicon:"40px",text:b.MSG_EMPTY_LIST_CONTENT}]}},this._configEmptyContentOption={emptyContentOptions:{sentences:[{type:"img",src:o.getWebappsAssetUrl("ENOXModelApp","icon/ProductConfiguration.png"),sizeicon:"40px",text:b.MSG_EMPTY_LIST_CONTENT}]}}},S.prototype._initDOM=function(){this._container=e.createElement("div"),this._container.addClassName("mvcopy-list-presenter"),this._container.style.width=this._container.style.height="100%"},S.prototype.loadData=function(e){if(void 0!==e){let t;switch(e.typeOfData){case"variability":t=this._varModelEvent;break;case"rules":t=this._rulesModelEvent;break;case"configurations":t=this._configurationsModelEvent}t.publish({event:"xmodel-list-data-on-load-start"}),t.publish({event:"xmodel-list-data-load-action",data:e}),t.publish({event:"xmodel-list-data-on-load-complete"}),t.publish({event:"xmodel-list-select-all",data:{}}),"configurations"==e.typeOfData&&t.publish({event:"xmodel-list-view-expand-all-action",data:{}})}},S.prototype.getContent=function(){return this._container},S.prototype._emptySelections=function(){this.varModelTreeDoc&&(this.varModelTreeDoc.unselectAll(),this.varModelTreeDoc.removeRoots()),this.rulesModelTreeDoc&&(this.rulesModelTreeDoc.unselectAll(),this.rulesModelTreeDoc.removeRoots()),this.configurationsModelTreeDoc&&(this.configurationsModelTreeDoc.unselectAll(),this.configurationsModelTreeDoc.removeRoots()),this._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),this._varModelEvent&&this._varModelEvent.publish({event:"xmodel-list-data-on-load-complete"}),this._rulesModelEvent&&this._rulesModelEvent.publish({event:"xmodel-list-data-on-load-complete"}),this._configurationsModelEvent&&this._configurationsModelEvent.publish({event:"xmodel-list-data-on-load-complete"});let e=this._vbEmptyContentOption,t=this._rulesEmptyContentOption,i=this._configEmptyContentOption;this._varModelEvent&&this._varModelEvent.publish({event:"xmodel-list-update-empty-content",data:e}),this._rulesModelEvent&&this._rulesModelEvent.publish({event:"xmodel-list-update-empty-content",data:t}),this._configurationsModelEvent&&this._configurationsModelEvent.publish({event:"xmodel-list-update-empty-content",data:i})},S.prototype._handleSelection=function(){let e=this,t=e._getSelectedNodes(e.varModelTreeDoc),i=e._getSelectedNodes(e.rulesModelTreeDoc),n=e._getSelectedNodes(e.configurationsModelTreeDoc),a=t.length+i.length+n.length,o=0,s=0,r=0,l=0,d=0,c=0,p=0,u=0,h=0;t.forEach(e=>{switch(e.options.grid.type){case"Variant":o++;break;case"Variant Value":s++;break;case"Variability Group":l++;break;case"Variability Option":r++;break;case"Variant Parameter":d++}}),i.forEach(e=>{switch(e.options.grid.expressionType){case"expression":c++;break;case"matrix":p++}}),n.forEach(e=>{switch(e.options.grid.type){case"Product Configuration":h++;break;case"Model Type":u++}});let m={variants:o,values:s,optionGroups:l,options:r,parameters:d,expRules:c,matRules:p,baseConfigs:u,prodConfigs:h};a>0?e._localChannelForListView.publish({event:v.EVT_SOME_SELECTIONS_AVAILABLE,data:m}):e._localChannelForListView.publish({event:v.EVT_NO_SELECTIONS_AVAILABLE})},S.prototype._getSelectedNodes=function(e){return e?e.getXSO().get():[]},S.prototype._updateNodeID=function(e,t){if(null!=e&&t.options.grid.totalRevisions.length>0){t.options.grid.totalRevisions.forEach(i=>{i.revision==e&&t.options.id!=i.id&&t.updateOptions({id:i.id,label:i.title})})}},S.prototype._activateTagger=function(){let e=this._configurationsModelEvent;"variability"==this._currentTab?e=this._varModelEvent:"rules"==this._currentTab&&(e=this._rulesModelEvent),e.publish({event:"xmodel-list-tagger-activate-action"})},S.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_LOAD_SOURCE_MV_DATA},function(t){e.loadData(t)}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_PERFORM_ACTION},function(){let t={variability:e.varModelTreeDoc?e.varModelTreeDoc.getXSO().get():[],rules:e.rulesModelTreeDoc?e.rulesModelTreeDoc.getXSO().get():[],configurations:e.configurationsModelTreeDoc?e.configurationsModelTreeDoc.getXSO().get():[]};e._localChannelForListView.publish({event:v.EVT_PERFORM_DATA_ACTION,data:{items:t}})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-copy-from-tabs-updated"},function(t){setTimeout(function(){e._handleSelection(),e._activateTagger()},50)}),this._myEventManager.subscribe(this._configurationsModelEvent,{event:"xmodel-list-item-on-empty-selection"},function(){e._handleSelection()}),this._myEventManager.subscribe(this._rulesModelEvent,{event:"xmodel-list-item-on-empty-selection"},function(){e._handleSelection()}),this._myEventManager.subscribe(this._varModelEvent,{event:"xmodel-list-item-on-empty-selection"},function(){e._handleSelection()}),this._myEventManager.subscribe(this._varModelEvent,{event:"xmodel-list-item-on-add-selection"},function(){e._handleSelection()}),this._myEventManager.subscribe(this._rulesModelEvent,{event:"xmodel-list-item-on-add-selection"},function(){e._handleSelection()}),this._myEventManager.subscribe(this._configurationsModelEvent,{event:"xmodel-list-item-on-add-selection"},function(t){e._handleConfigSelection(t,!0),e._handleSelection()}),this._myEventManager.subscribe(this._configurationsModelEvent,{event:"xmodel-list-item-on-remove-selection"},function(t){e._handleConfigSelection(t,!1)}),this._myEventManager.subscribe(this._varModelEvent,{event:"xmodel-list-tagger-on-setup"},function(){e._activateTagger()}),this._myEventManager.subscribe(this._rulesModelEvent,{event:"xmodel-list-tagger-on-setup"},function(){e._activateTagger()}),this._myEventManager.subscribe(this._configurationsModelEvent,{event:"xmodel-list-tagger-on-setup"},function(){e._activateTagger()}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_NO_DATA_TO_LOAD},function(t){let i=e._varModelEvent,n=b.MSG_NO_VARIABILITY_OR_ALL_ALLOCATED,a=e._vbEmptyContentOption.emptyContentOptions.sentences[0].src;"rules"==t?(i=e._rulesModelEvent,n=b.MSG_NO_RULES_OR_ALL_ALLOCATED,a=e._rulesEmptyContentOption.emptyContentOptions.sentences[0].src):"configurations"==t&&(i=e._configurationsModelEvent,n=b.MSG_NO_CONFIGURATIONS_OR_NO_SELECTIONS,a=e._configEmptyContentOption.emptyContentOptions.sentences[0].src);let o={emptyContentOptions:{sentences:[{type:"img",src:a,sizeicon:"40px",text:n}]}};i.publish({event:"xmodel-list-update-empty-content",data:o})}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_SOURCE_MV_DICO_LOADED},function(t){e._handleSelection()}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_NO_SOURCE_MV_AVAILABLE},function(t){e._emptySelections()}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-view-data-on-load-start"},function(){e._varModelEvent.publish({event:"xmodel-list-view-data-on-load-start"}),e._rulesModelEvent.publish({event:"xmodel-list-view-data-on-load-start"}),e._configurationsModelEvent.publish({event:"xmodel-list-view-data-on-load-start"})}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_SHOW_REVISIONS},function(){e._localChannelForListView.publish({event:"xmodel-list-set-column-visibility-action",data:{dataIndex:"revision",visibility:!0}})}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_HIDE_REVISIONS_COLUMN},function(){e._localChannelForListView.publish({event:"xmodel-list-set-column-visibility-action",data:{dataIndex:"revision",visibility:!1}})}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_UNMASK_CONTAINER},function(t){e.unMaskContainer(t.tab)}),this._myEventManager.subscribe(this._localChannelForListView,{event:v.EVT_MASK_CONTAINER},function(t){t&&t.message&&e.maskContainer(t.message,t.tab)})},S.prototype._handleConfigSelection=function(e,t){let i=this,n=[],a=i.configurationsModelTreeDoc.getChildren();t&&e.model.hasOwnProperty("baseConfigurationId")?(a.forEach(t=>{let i=[];t.options.grid.totalRevisions.forEach(e=>{i.push(e.id)}),i.includes(e.model.baseConfigurationId)&&!t.isSelected()&&n.push(t)}),i.configurationsModelTreeDoc.getXSO().add(n)):t||"Model Type"!=e.model.type||(a.forEach(t=>{t.options.id==e.model.id&&(n=t.getChildren())}),i.configurationsModelTreeDoc.getXSO().remove(n))},S.prototype.maskContainer=function(e,i){if(e&&i){let n;switch(i){case"variability":n=this._variabilityContainer;break;case"rules":n=this._rulesContainer;break;case"configurations":n=this._configurationsContainer}n&&t.mask(n,e)}},S.prototype.unMaskContainer=function(e){let i;switch(e){case"variability":i=this._variabilityContainer;break;case"rules":i=this._rulesContainer;break;case"configurations":i=this._configurationsContainer}i&&t.isMasked(i)&&t.unmask(i)},S.prototype.inject=function(e){e.appendChild(this._container)},S.prototype.destroy=function(){this._container&&(this._container=null),this._xModelListView&&(this._xModelListView=null),this.rulesPresenter&&(this.rulesPresenter=null),this.configurationsPresenter&&(this.configurationsPresenter=null),this.variabilityPresenter&&(this.variabilityPresenter=null),this._myEventManager&&(this._myEventManager.cleanup("ModelCopyFromListPresenter For"+this.mySettings.settingsFor),this._myEventManager=null)},S.prototype.publishTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-activate-action"}),this._tagActivated=!0},S.prototype.clearTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},S.prototype.getSelectedItems=function(){var e=[];return this._modelTreeDoc&&(e=this._modelTreeDoc.getXSO().get()),e},S}),define("DS/ENOXModelApp/ModelDefinition/js/VariabilityListPresenter",["UWA/Core","DS/CoreEvents/ModelEvents","UWA/Element","DS/WebappsUtils/WebappsUtils","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/ENOXModelApp/Utils/CustomAttributesManager","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/TreeModel/TreeDocument","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/xModelEventManager/xModelEventManager","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/EditPropWidget/comm/EventManager","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","text!DS/ENOXModelApp/assets/ModelVariabilityConstants.json","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/xDimensionManager/assets/nls/xUnitLabelLong","i18n!DS/xDimensionManager/assets/nls/xDimentions","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/NumericalDialogFields","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/VariabilityPresenter"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A){"use strict";y=JSON.parse(y);var P=function(){};return P.prototype.init=function(i,n,a){this.mySettings=e.clone(a.settings),this.hideOnMultiSelectionList=["AttachValues","open"],this.showOnOneSelectionTypeList=[y.TYPE_VARIANT,y.TYPE_VARIABILITYGROUP],this._isDestroyed=!1,this.mvId=a.mvId?a.mvId:void 0,this._applicationChannel=n,this._localChannelForListView=i||new t,this._updateChannelLocal=new t,this._myEventManager=new _(this._applicationChannel,this._localChannelForListView,this._updateChannelLocal),this._pathVariability=[h._KEY,h._VIEWS_PREFERENCES,h._MODEL_VERSIONS_DETAILS,h._VARIABILITY],this._tagActivated=!1,this._enableFetchOnEveryExpand=!0,this._xModelListView=null,this._isModelVariabilityEditable=!a||void 0===a.editable||"boolean"!=typeof a.editable||a.editable,this._infoContext="Variability",m.initialize({applicationChannel:this._applicationChannel,id:this.mvId,silent:!0,context:this._infoContext,readOnly:!0}),this._currentFacet=null,this.customAttributeMap={},this.loadCustomAttributes(),this._initListView(),this.tagFriends=this.mySettings.tagFriends||void 0,this.tagProxyName=void 0===this.mySettings.tagProxyName?"ItemsTagProxy":this.mySettings.tagProxyName,this._initDOM(),this._initCommand(),this._subscribeToEvents(),this._subscribeToFacetEvent()},P.prototype._getUnit=function(e){var t;return e.options.grid.hasOwnProperty("minValue")&&(t=e.options.grid.minValue.split(" ")[1]),t?D.get(t):" "},P.prototype.loadCustomAttributes=function(){var e=this;o.getCustomAttribute(["Variant","Variability Group","Variability Option","Variant Value","Variant Parameter"]).then(function(t){if(t&&t.length>0){var i=u.getVisibleColumns(e._pathVariability),n=o.getColumnsToAdd(t,i,{inlineEdition:!1});e._localChannelForListView.publish({event:"variability-custom-attributes-loading-done",data:n})}},function(){})},P.prototype._initCommand=function(){this._command=new c(this._localChannelForListView,this._container,this._applicationChannel)},P.prototype._initListView=function(t){var i,o=this,d=u.getSort(this._pathVariability);d&&d.sortAttribute&&d.sortOrder&&(i={id:d.sortAttribute,order:d.sortOrder}),this._modelTreeDoc=t||new l({});var c=[{id:"new-variant",text:A.newVariant,handler:function(){E.checkActionAccess({action:C.CREATE,type:C.TYPE_VARIANT,notify:!0})&&(o._selectCreatedNode=!0,o._localChannelForListView.publish({event:y.EVT_CREATE_N_ADD_NEW_ITEM,data:{type:"variant"}}))}},{id:"new-optiongroup",text:A.newOptionGroup,handler:function(){E.checkActionAccess({action:C.CREATE,type:C.TYPE_OptionGroup,notify:!0})&&(o._selectCreatedNode=!0,o._localChannelForListView.publish({event:y.EVT_CREATE_N_ADD_NEW_ITEM,data:{type:"variabilityGroup"}}))}}];c.push({id:"new-parameter",text:A.newParameter,handler:function(){E.checkActionAccess({action:C.CREATE,type:C.TYPE_PARAMETER,notify:!0})&&(o._selectCreatedNode=!0,o._localChannelForListView.publish({event:y.EVT_CREATE_N_ADD_NEW_ITEM,data:{type:"parameter"}}))}}),c.push({id:"add-existing",text:A.addExisting,selectable:!1,showOnSelection:!0,handler:function(){e.log("Add Existing"),E.checkActionAccess({action:C.ADDEXISTING,type:C.VARIABILITY_TAB,notify:!0})&&(o._selectCreatedNode=!1,o._localChannelForListView.publish({event:y.EVT_ADD_EXISTING_VARIABILITY,data:{}}))}}),c.push({id:"carry-over",text:A.addExistingFrom,selectable:!1,handler:function(){o._applicationChannel.publish({event:"mvcopy-launch-copy-from-dialog",data:"variability"})}});var p=e=>{var t="";switch(e.options.grid.isA){case"variant":t=A.VariantType;break;case"value":t=A.ValueType;break;case"variabilityGroup":t=A.VariabilityGroupType;break;case"option":t=A.OptionType;break;case"parameter":t=A.ParameterType}return t},m={id:this.mySettings.listViewId,model:this._modelTreeDoc,modelEvents:this._localChannelForListView,useAsyncExpand:this.mySettings.useAsyncExpand,defaultNodeDepth:2,useDragAndDrop:!0,childKeys:this.mySettings.childKeys,viewOptions:{currentView:"DataGridView",currentSort:i,views:this.mySettings.views,onDelayedModelDataRequest:function(t){var i,n;if(t&&t.startNodeIndex>-1&&t.endNodeIndex>-1)for(n=t.startNodeIndex;n<=t.endNodeIndex;n++){var a=t.collectionView.model[n];if(a&&a.options.id&&o.customAttributeMap&&a.options.id in o.customAttributeMap){i=o.customAttributeMap[a.options.id];for(const t in i)if(i.hasOwnProperty(t)){var s=i[t];""!==s&&"string"==typeof s&&s.startsWith("[")&&(s=(s=s.replaceAll("[","")).replaceAll("]",""),(void 0)[void 0][t]=s,e.log(s)),a.options.grid[t]=s}}}},grid:{columns:[{text:S.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",width:"40%",minWidth:150,getCellSemantics:function(e){var t={};return e&&e.nodeModel&&e.nodeModel.getNodeDepth()!==(o._xModelListView.isGrouped()?1:0)&&(t.linkDisplay=!1),t},getCellEditableState:function(){return!1}},{text:S.NAME,dataIndex:"name",visibleFlag:!1},{text:S.TYPE,dataIndex:"type",groupableFlag:!0,typeRepresentation:"string",width:120,getCellValue:function(e){return p(e.nodeModel)},compareFunction:function(e,t,i,n){return(e=p(i))>(t=p(n))?1:e<t?-1:0}},{text:S.MANDATORY,dataIndex:"mandatory",typeRepresentation:"mandatory",editableFlag:!0,width:100,editionPolicy:"EditionInPlace",onCellRequest:function(e){e.rowID>=0&&(void 0!==e.nodeModel.options.grid.mandatory?o._xModelListView.getTypeRepresentationFactory().generateView(e.cellModel,{typePath:"mandatory",readOnly:!1,touchMode:!1,escapeHTML:!1,context:"stdTemplate",visibleFlag:!0,onViewCreated:function(t){t.value=e.nodeModel.options.grid.mandatory,e.cellView._setReusableContent(t)}}):e.cellView._setReusableContent(null))},setCellValue:function(t,i){o._updateAttributeHandler(t,i,"mandatory"),e.log("setCellValue : 'Mandatory' setCell value Handler!!!")},getCellValue:function(e){return e.nodeModel.options.grid.mandatory}},{text:S.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",width:100,typeRepresentation:"integer",editableFlag:!0,editionPolicy:"EditionInPlace",setCellValue:function(e,t){o._updateAttributeHandler(e,t,"sequenceNumber")},onCellRequest:function(t){if(!(t.rowID<0||void 0===t.nodeModel.options||void 0===t.nodeModel.options.grid))if(t.nodeModel.options.grid.isA&&"parameter"!==t.nodeModel.options.grid.isA){var i="variant"===t.nodeModel.options.grid.isA||"variabilityGroup"===t.nodeModel.options.grid.isA;o._xModelListView.getTypeRepresentationFactory().generateView(t.cellModel,{typePath:"sequenceNumber",readOnly:!i,touchMode:!1,escapeHTML:!1,context:"stdTemplate",semantics:{allowUnsafeHTMLContent:!0},visibleFlag:!0,onViewCreated:function(i){var n=t.nodeModel.options.grid.sequenceNumber;try{n=parseInt(n)}catch(e){n=1}e.is(n,"number")||(n=1),i.value=n,t.cellView._setReusableContent(i)}})}else t.cellView._setReusableContent(null)}},{text:S.RANGE,sortableFlag:!1,dataIndex:"range",valueAttribute:["minValue","maxValue"],width:100,kind:["instance"],getCellValue:function(e){var t="";if(e.nodeModel.options.grid.hasOwnProperty("minValue")&&e.nodeModel.options.grid.hasOwnProperty("maxValue")){var i=e.nodeModel.options.grid.minValue.split(" ")[0],n=e.nodeModel.options.grid.maxValue.split(" ")[0];i&&n&&(t=i+A.RangeValueDelimiter+n)}return t}},{text:S.UNIT,groupableFlag:!0,dataIndex:"unit",valueAttribute:["unit"],getCellValue:function(e){return o._getUnit(e.nodeModel)},getCellValueForSort:function(e){return o._getUnit(e)}},{text:S.DIMENSION,groupableFlag:!0,dataIndex:"dimension",valueAttribute:["dimension"],width:100,kind:["instance"],getCellValue:function(e){var t=" ";return e.nodeModel.options.grid.hasOwnProperty("dimension")?(t=e.nodeModel.options.grid.dimension,"Integer"===(t=M.get(t))||"Real"===t?I._noDimensionLabel:t):t}},{text:S.MATURITY_STATE,dataIndex:"maturity",groupableFlag:!0,width:100,getCellValue:function(e){var t=e.nodeModel.options.grid;return t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.maturity?t.maturity:t.state?t.state:""},getCellGroupingKey:function(e){var t=e.nodeModel.options.grid;return t.maturity?t.maturity:t.state?t.state:""}},{text:S.OWNER,dataIndex:"owner",visibleFlag:!1,groupableFlag:!0},{text:S.DESCRIPTION,dataIndex:"description"},{text:S.COLLABSPACE,dataIndex:h._COLLABSPACE_TITLE,groupableFlag:!0},{text:S.ORGANIZATION,dataIndex:h._ORG_TITLE,groupableFlag:!0}],typeRepresentations:{sequenceNumber:{stdTemplate:"spinEdit",semantics:{valueType:"integer",minValue:1,stepValue:1,allowUnsafeHTMLContent:!1}},mandatory:{stdTemplate:"switch"}}},contextualActions:function(){var t=[];if(this.options&&this.options.grid&&(this.options.grid.isA===y.TYPE_VARIANT||this.options.grid.isA===y.TYPE_VARIABILITYGROUP)&&t.push({title:A.open,id:"open",fonticon:"open",multiselect:!1,handler:function(e){o._routeVariability(e.type,e.id,e.title)}}),o._isModelVariabilityEditable){if(this.options&&this.options.grid){var i=this.options.grid.isA?this.options.grid.isA:"";i===y.TYPE_VARIANT?t.push({id:"AttachValues",title:A.attachValues,fonticon:"list-row-insert",multiselect:!1,handler:function(t,i){var n=E.checkActionAccess({action:C.MODIFY,type:C.TYPE_VARIANT,state:t.maturity?t.maturity:t.state});e.log("on attach values"),i&&o.showInformation(i[0],!0,"Values",n)}}):i===y.TYPE_VARIABILITYGROUP&&t.push({id:"AttachOptions",title:A.attachOptions,multiselect:!1,fonticon:"list-row-insert",handler:function(t,i){var n=E.checkActionAccess({action:C.MODIFY,type:C.TYPE_OptionGroup,state:t.maturity?t.maturity:t.state});e.log("on attach options"),i&&o.showInformation(i[0],!0,"Options",n)}})}t.push({type:"SeparatorItem"})}return t.push({id:"information",title:A.information,fonticon:"info",handler:function(t,i){e.log("Info Action"),i&&i.length>0&&o._applicationChannel.publish({event:"information-panel-open"})}}),o._isModelVariabilityEditable&&(t.push({type:"SeparatorItem"}),t.push({id:"remove",title:A.remove,disabled:!this._isModelVariabilityEditable,fonticon:"remove",handler:function(e,t){var i;switch(e.isA){case"variant":i=C.TYPE_VARIANT;break;case"value":i=C.TYPE_VALUE;break;case"variabilityGroup":i=C.TYPE_OptionGroup;break;case"option":i=C.TYPE_OPTION;break;case"parameter":i=C.TYPE_PARAMETER}if(E.checkActionAccess({action:C.REMOVE,type:i,notify:!0})){var n=t.map(function(e){return{id:e.id,title:e.title}});o.createDeleteModelDialog(n,o._localChannelForListView)}}})),t}},emptyContentOptions:{sentences:[{type:"img",src:n.getWebappsAssetUrl("ENOXModelApp","icon/variantValue.png"),sizeicon:"40px",text:A.EMPTY_CONTENT_MESSAGE}]},withmultisel:!0,toolbarOptions:{itemsName:this.mySettings.NLS.itemsName,itemName:this.mySettings.NLS.itemName,withStableActions:!0,useGeneratedToolbar:!0,touchMode:!1,hideView:!0,showTaggerFilter:!0,hideOnMultiSelection:this.hideOnMultiSelectionList,showOnOneSelection:this.showOnOneSelectionTypeList,actions:[{id:"add-variability",text:A.add,fonticon:"plus",visibility:!this._isModelVariabilityEditable,category:"new",callSubMenuHandler:!0,content:c,handler:function(){e.log("add variability")}},{id:"open",fonticon:"open",category:"open",text:A.open,showOnSelection:!0,handler:function(e){e=e[0].grid,o._routeVariability(e.type,e.id,e.title)}},{id:"AttachValues",title:A.attachValues,text:A.attachValues,category:"navigation",fonticon:"list-row-insert",showOnSelection:!0,handler:function(t){let i=o._xModelListView._getSelectedItem();if(i.length>1)return;t=i[0];let n=i[0].type===C.TYPE_VARIANT?C.TYPE_VARIANT:C.TYPE_OptionGroup;var a=E.checkActionAccess({action:C.MODIFY,type:n,state:t.maturity?t.maturity:t.state});e.log("on attach values"),t&&o.showInformation(t,!0,"Values",a)}},{id:"remove-variability",text:A.remove,fonticon:"remove",category:"destructive",visibility:!this._isModelVariabilityEditable,showOnSelection:!0,handler:function(e){if(E.checkActionAccess({action:C.REMOVE,type:C.VARIABILITY_TAB,notify:!0})){var t=e.map(function(e){return{id:e.id,title:e.label}});o.createDeleteModelDialog(t,o._localChannelForListView)}}}]},extensions:[s,r]};this._xModelListView=new a(m),this._isModelVariabilityEditable||this._localChannelForListView.publish({event:"xmodel-list-toolbar-hide-action",data:"remove-variability"})},P.prototype._routeVariability=function(e,t,i){let n=p.ROUTE_DICTIONARY_VARIANT_DETAILS;"Variability Group"===e&&(n=p.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS),"Variant Parameter"!==e&&"Variant Value"!==e&&"Variability Option"!==e&&d.navigate(n,{id:t,name:i})},P.prototype._updateAttributeHandler=function(e,t,i){e.nodeModel.options.grid[i]=t;var n={id:e.nodeModel.getAttributeValue("instanceId"),name:i,value:t,type:e.nodeModel.options.grid.isA,rel_id:e.nodeModel.options.grid.rel_id?e.nodeModel.options.grid.rel_id:void 0};this._localChannelForListView.publish({event:y.EVT_VARIABILITY_ATRB_UPDATE,data:{changedObject:n,cellInfos:e}})},P.prototype.showInformation=function(e,t,i,n){var a,o=e.idref?e.idref:e.id?e.id:void 0;o&&("variabilityGroup"===e.isA?a="Options":"variant"===e.isA&&(a="Values"),a&&this._currentFacet!==a&&(this.deactivateFacet(),this._currentFacet=a,this.activateFacet(this._currentFacet,n)),m.showInformation(o,t,i))},P.prototype.activateFacet=function(e,t){if(e){var i;switch(e){case"Options":i=A.facet_Text_options;break;case"Values":i=A.facet_Text_values}var n={require:"DS/ENOXModelApp/InformationPanels/DictionaryTab/js/DictionaryTabPresenter",position:1,facet:{name:e,text:i,eventThread:"variability",icon:"product"},options:{isEditable:this._isModelVariabilityEditable,isVariabilityFrozen:t},alwaysVisible:!0};m.addFacet({name:e,facet:n},this._infoContext),m.selectFacet(e,!0)}},P.prototype.deactivateFacet=function(e){e?m.removeFacet(e,this._infoContext):this._currentFacet&&(m.removeFacet(this._currentFacet,this._infoContext),this._currentFacet=null)},P.prototype._handleOneSelection=function(e){let t=this.showOnOneSelectionTypeList.includes(e.items[0]._options.grid.isA)?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";this.hideOnMultiSelectionList.forEach(e=>{this._localChannelForListView.publish({event:t,data:e})})},P.prototype._handleAddItemToSelection=function(e){if(e&&e.model){var t=[],i=[];e.items&&e.items.forEach(function(e){if(e.options){t.push(e.options.id);var n=e.options.grid.maturity?e.options.grid.maturity:e.options.grid.state;i.push(n)}}),u.updateSelectedItems(this._pathVariability,t);let a,o=this,s=e.model,r=[];!0===e.multiSelect?s.forEach(e=>{let t=e.options.grid.id;r.push(t)}):(r.push(s.id),a=s.idref?s.idref:s.id?s.id:void 0,o._handleOneSelection(e)),m.addSelection(r,o._infoContext);let l,d=!1;var n;if(1===t.length&&a)s=e.items[0].options.grid,d=!0,"variabilityGroup"===s.isA?(this._currentFacet="Options",n=C.TYPE_OptionGroup):"variant"===s.isA?(this._currentFacet="Values",n=C.TYPE_VARIANT):(this.deactivateFacet(),d=!1),l=E.checkActionAccess({action:C.MODIFY,type:n,state:i[0]});else this.deactivateFacet();d&&this._currentFacet&&this.activateFacet(this._currentFacet,l)}},P.prototype._handleRemoveItemFromSelection=function(e){let t=this;if(e&&e.model){let n=e.model,a=[];!0===e.multiSelect?n.forEach(e=>{let t=e.options.grid.id;a.push(t)}):(a.push(n.id),1===e.items.length&&t._handleOneSelection(e)),m.removeSelection(a,t._infoContext);let o=[],s=[];if(e.items&&e.items.forEach(function(e){if(e.options){o.push(e.options.id);let t=e.options.grid.maturity?e.options.grid.maturity:e.options.grid.state;s.push(t)}}),1===o.length){var i;(n=e.items[0].options.grid)&&"variabilityGroup"===n.isA?(this._currentFacet="Options",i=C.TYPE_OptionGroup):n&&"variant"===n.isA?(this._currentFacet="Values",i=C.TYPE_VARIANT):this.deactivateFacet();let t=E.checkActionAccess({action:C.MODIFY,type:i,state:s[0]});this._currentFacet&&this.activateFacet(this._currentFacet,t)}u.updateSelectedItems(this._pathVariability,o)}},P.prototype._handleEmptySelection=function(){m.removeAllSelection(this._infoContext);u.updateSelectedItems(this._pathVariability,[]),this.deactivateFacet(this._currentFacet)},P.prototype._initDOM=function(){this._container=e.createElement("div"),this._container.addClassName("mvcopy-list-presenter"),this._container.style.width=this._container.style.height="100%",this._xModelListView.inject(this._container)},P.prototype.loadData=function(e){if(void 0!==e){this._localChannelForListView.publish({event:"xmodel-list-data-on-load-start"}),this.isDictionaryLoaded?this._localChannelForListView.publish({event:"xmodel-list-data-update-action",data:e}):(this.isDictionaryLoaded=!0,this._localChannelForListView.publish({event:"xmodel-list-data-load-action",data:e})),this._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"});var t=u.getSelectedItems(this._pathVariability);t&&t.length>0&&this._localChannelForListView.publish({event:"xmodel-list-selection-action",data:t});var i=u.getGroup(this._pathVariability);this._localChannelForListView.publish({event:"xmodel-list-view-group-by-action",data:i}),this._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:u.getSort(this._pathVariability)})}},P.prototype.updateAndExtractCustomAttributes=function(){var t=this;if("{}"===JSON.stringify(t.customAttributeMap)){var i={componentId:this.mvId,content:{rules:!1,attributes:1,customerAttributes:!0,parameters:!0}};v.getVariabilityDefinition(i).then(function(i){e.log(i),t.extractCustomAttributes(i)})}},P.prototype.extractCustomAttributes=function(t){var i,n,a={variants:"Variant",variabilityGroups:"Variability Group",parameters:"Variant Parameter",values:"Variant Value",options:"Variability Group"};for(n in t=t.portfolioClasses.member[0].portfolioComponents.member[0])if(t.hasOwnProperty(n)){var o,s,r,l,d,c;for(o in t[n].member)if(t[n].member.hasOwnProperty(o)&&((s=t[n].member[o]).hasOwnProperty("kind")&&"reference"===s.kind||"variabilityGroups"===n||"values"===n||"parameters"===n)){if(s.attributes.hasOwnProperty("customerAttributes")){for(c in i=a[n],l=s.attributes.customerAttributes,d={},r=t.customerAttributes[i])l.hasOwnProperty(c)&&(d=e.merge(d,l[c]));this.customAttributeMap[s.id]=d}var p,u,h,m;if(s.hasOwnProperty("values"))for(u in i="values",s.values.member)if(s.values.member.hasOwnProperty(u)&&(p=s.values.member[u]).hasOwnProperty("attributes")&&p.attributes.hasOwnProperty("customerAttributes")){for(c in l=p.attributes.customerAttributes,d={},r=t.customerAttributes["Variant Value"])r.hasOwnProperty(c)&&(d=e.merge(d,l[c]));this.customAttributeMap[p.id]=d}if(s.hasOwnProperty("options"))for(m in s.options.member)if(s.options.member.hasOwnProperty(m)&&(h=s.options.member[m]).hasOwnProperty("attributes")&&h.attributes.hasOwnProperty("customerAttributes")&&"reference"===h.kind){for(c in l=h.attributes.customerAttributes,d={},r=t.customerAttributes["Variability Option"])r.hasOwnProperty(c)&&(d=e.merge(d,l[c]));this.customAttributeMap[h.id]=d}}}},P.prototype.getAndExtractCustomAttribute=function(t){var i,n=this,a={variant:"getDicoVariantDetails",variabilityGroup:"getDicoOptionGroupDetails",value:"getDicoValueDetails",option:"getDicoOptionDetails",parameter:"getDicoParameterDetails"};"variant"!==t.type&&"variabilityGroup"!==t.type||(i={id:t.id,customAttributeFlag:t.flag},v[a[t.type]](i).then(function(t){if(t=t.replaceAll(String.fromCharCode(7),","),(t=JSON.parse(t)).member[0].hasOwnProperty("customerAttributes")){var i,a={};for(i in t.member[0].customerAttributes)t.member[0].customerAttributes.hasOwnProperty(i)&&(a=e.merge(a,t.member[0].customerAttributes[i]));n.customAttributeMap[t.member[0].id]=a}})),"value"!==t.type&&"option"!==t.type||(i={id:t.id,parentID:t.parentID,customAttributeFlag:t.flag},v[a[t.type]](i).then(function(t){if(t=t.replaceAll(String.fromCharCode(7),","),(t=JSON.parse(t)).member[0].hasOwnProperty("customerAttributes")){var i,a={};for(i in t.member[0].customerAttributes)t.member[0].customerAttributes.hasOwnProperty(i)&&(a=e.merge(a,t.member[0].customerAttributes[i]));n.customAttributeMap[t.member[0].id]=a}})),"parameter"===t.type&&(i={id:t.id,flag:t.flag},v[a[t.type]](i).then(function(t){if(t=t.replaceAll(String.fromCharCode(7),","),(t=JSON.parse(t)).member[0].hasOwnProperty("customerAttributes")){var i,a={};for(i in t.member[0].customerAttributes)t.member[0].customerAttributes.hasOwnProperty(i)&&(a=e.merge(a,t.member[0].customerAttributes[i]));n.customAttributeMap[t.member[0].id]=a}}))},P.prototype.getContent=function(){return this._container},P.prototype.getTreeDoc=function(){return this._modelTreeDoc},P.prototype._subscribeToEvents=function(){var t=this;this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-on-save-custom-view"},function(e){u.updateVisibleColumns(t._pathVariability,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-on-custom-view-save"},function(i){t._visibleCustomAttrbutesList?i&&(e.equals(t._visibleCustomAttrbutesList,i)&&(t._withCustomAttributes=!1),t._withCustomAttributes=!0):(t._visibleCustomAttrbutesList=i,t._withCustomAttributes=!0),u.updateCustomAttributeStatus(t._pathVariability,t._withCustomAttributes),t._withCustomAttributes&&t.updateAndExtractCustomAttributes(t._withCustomAttributes)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-dialog-delete"},function(){var e=t.getSelectedInstance();t._localChannelForListView.publish({event:y.EVT_REMOVE_VARIABILITY,data:{instanceData:e}})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-title-link-click"},function(e){let t="";switch(e.model.type){case"Variant":t=p.ROUTE_DICTIONARY_VARIANT_DETAILS;break;case"Variability Group":t=p.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS;break;default:return}d.navigate(t,{id:e.model.id,name:e.model.title})}),this._myEventManager.subscribe(this._localChannelForListView,{event:y.EVT_LOAD_MV_DICO},function(e){t.loadData(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"extract-variability-custom-attributes"},function(e){t.extractCustomAttributes(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"update-customMap-after-creation"},function(e){t.getAndExtractCustomAttribute(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"variability-custom-attributes-loading-done"},function(e){t._localChannelForListView.publish({event:"xmodel-list-add-columns",data:e})}),this._myEventManager.subscribe(this._localChannelForListView,{event:y.EVT_ADD_NODE_FOR_INSTANCE},function(e){e&&e.length>0&&(t._localChannelForListView.publish({event:"xmodel-list-unselect-all"}),e.forEach(function(i,n){i&&i.item&&(t._localChannelForListView.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(a){i.subItem?(t._localChannelForListView.publish({event:"xmodel-list-data-load-action",data:i.subItem,context:a}),n===e.length-1&&(t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),t._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:u.getSort(t._pathVariability)}),t._localChannelForListView.publish({event:"xmodel-list-scroll-to-node",data:a}))):n===e.length-1&&(t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),t._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:u.getSort(t._pathVariability)}),t._localChannelForListView.publish({event:"xmodel-list-scroll-to-node",data:a})),t._selectCreatedNode&&a.select()}),t._localChannelForListView.publish({event:"xmodel-list-data-item-add-action",data:i.item}))}))}),this._myEventManager.subscribe(this._localChannelForListView,{event:y.EVT_ADD_NODE_FOR_VALUE_INSTANCE},function(e){e&&e.length>0&&e.forEach(function(e){if(e&&e.item){var i,n=e.item.id;if(n&&e.subItem&&e.subItem.member)t.getSelectedItems().forEach(function(e){e.options.id===n&&(i=e)}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-start"}),i.isExpanded()||i.expand(),e.subItem.member.forEach(function(e){t._localChannelForListView.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){i.isExpanded()||i.expand(),t._localChannelForListView.publish({event:"xmodel-list-scroll-to-node",data:e})}),t._localChannelForListView.publish({event:"xmodel-list-data-item-add-action",data:e,context:i})}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"})}})}),this._myEventManager.subscribe(this._localChannelForListView,{event:y.EVT_REMOVE_NODE_FOR_INSTANCE},function(e){var i=e.map(function(e){return e.id});t._localChannelForListView.publish({event:"xmodel-list-data-item-remove-action",data:i}),t._localChannelForListView.publish({event:"xmodel-list-data-update-subjects",data:i})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-setup"},function(){t._tagActivated||t._localChannelForListView.publish({event:"xmodel-list-tagger-deactivate-action"})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-empty-selection"},function(){t._handleEmptySelection()}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-add-selection"},function(e){t._handleAddItemToSelection(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-remove-selection"},function(e){t._handleRemoveItemFromSelection(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-collection-toolbar-sort-activated"},function(e){u.updateSort(t._pathVariability,e)}),this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},function(e){"right"===e&&f.publish("set-variability-tagger-context",!0)}),this._myEventManager.subscribe(this._applicationChannel,{event:"information-panel-open"},function(){f.publish("information-panel-open")}),this._myEventManager.subscribe(this._localChannelForListView,{event:"set-variability-editable"},function(e){t._isModelVariabilityEditable=e;var i=!0===e?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";t._localChannelForListView.publish({event:i,data:"add-variability"}),t._localChannelForListView.publish({event:i,data:"remove-variability"}),t._xModelListView.refresh(),t._currentFacet&&f.publish("variability-"+t._currentFacet+"-set-editable",e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"variability-load-full-dictionary-done"},function(){var e=t._modelTreeDoc.getChildren();e&&(e.forEach(e=>{t._localChannelForListView.publish({event:"variability-get-children-data",data:{id:e.options.id,callback:function(i){t._localChannelForListView.publish({event:"xmodel-list-data-load-action",data:i,context:e})}}})}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}))}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-view-group-by-action"},function(e){u.updateGroup(t._pathVariability,e)})},P.prototype._subscribeToFacetEvent=function(){let e=this;e._eventManagerOptions=[],e._eventManagerOptions.push({eventName:"set-variability-tagger-context",callback:function(t){t?e.publishTags():e.clearTags()}}),e._eventManagerOptions.forEach(e=>{f.subscribe(e.eventName,e.callback)})},P.prototype.inject=function(e){e.appendChild(this._container)},P.prototype.createDeleteModelDialog=function(e){var t={listItems:e,type:"remove",single:A._item,multiple:A._items,modelEvent:this._localChannelForListView,immersiveFrame:g.getImmersiveFrame()};b.showDialog(t)},P.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this._xModelListView.destroy(),this._unsubscribeFacetEvents(),this._myEventManager&&(this._myEventManager.cleanup("VariabilityListPresenter For"+this.mySettings.settingsFor),this._myEventManager=null),m.removeAllSelection(this._infoContext),m.removeFacet("Values",this._infoContext),m.removeFacet("Options",this._infoContext)},P.prototype._unsubscribeFacetEvents=function(){this._eventManagerOptions.forEach(e=>{f.remove(e.eventName,e.callback)})},P.prototype.publishTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-activate-action"}),this._tagActivated=!0},P.prototype.clearTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},P.prototype.getSelectedItems=function(){var e=[];return this._modelTreeDoc&&(e=this._modelTreeDoc.getXSO().get()),e},P.prototype.getSelectedInstance=function(){var e={},t={},i=this.getSelectedItems(),n=function(i){var n=i.getAttributeValue("id"),a=i.getAttributeValue("instanceId"),o=i.getAttributeValue("isA");e[n]=a,t.hasOwnProperty(o)?t[o].push(i.options.grid):t[o]=[i.options.grid]};return i.forEach(function(t){if(t.areAllChildrenSelected()||t.areAllChildrenUnselected()){if(t.getNodeDepth()>0){var i=t.getParent(),a=i.getAttributeValue("id");if(e.hasOwnProperty(a))return;if(i.areAllChildrenSelected())return void n(i)}n(t)}}),t},P}),define("DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromDialog",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/CoreEvents/ModelEvents","DS/Controls/Button","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/UIKIT/Autocomplete","DS/ENOXCollectionToolBar/js/ENOXGeneratedToolBar","DS/ENOXModelApp/ModelDefinition/js/ContextDropDown","DS/ENOXModelApp/components/ContextSelector/AutocompleteContextSelector","DS/ENOXModelApp/components/ContextSelector/AutocompleteManager","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromListPresenter","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoPresenterSettingsProvider","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromConstants","DS/xPortfolioQueryServices/js/xPortfolioModel","i18n!DS/ENOXModelApp/assets/nls/components/DialogCreation/DialogCreation","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelCopyFrom","css!DS/ENOXModelApp/ModelDefinition/css/ModelCopyFromDialog.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P){"use strict";return{className:"dialog-creation",createAutoCompleteForMVInput:function(){this.ctxClassName="carryOverCtxAutocomplete",this.autocompleteManager=new _,this._modelLoaded=!1,this._inputLabel=e.createElement("label",{html:P.MODEL_VERSION}),this._labelMandatorySpan=e.createElement("span",{html:"*"}),this._labelMandatorySpan.addClassName("mv-required"),this._copyFromPath=[y._KEY,y._VIEWS_PREFERENCES,y._COPY_FROM],this.setContextModel(),this.initToolbar(),this.setAncestor()},initToolbar:function(){let e=this,t={modelEvents:this.modelEvent,touchMode:!0,actions:[{id:"ctxAutocomplete",text:P.SEARCH_FOR_MODELVERSION,className:this.ctxClassName,fonticon:"search",typeRepresentation:"functionIcon",handler:function(){}},{id:"revisionExplorer",fonticon:"flow-branch-list",text:P.REVISIONS,handler:function(){e.showVersionExplorer()}}]};this.genToolBar=new u(t),this.genToolBar.inject(this.container)},_initInfoIcon:function(){e.createElement("div",{class:"info-status-icon"});let t=this;this._padIcon=new l({displayStyle:"lite",icon:{iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltipInfos:this._padIconTooltip,showLabelFlag:!1,onClick:function(){t._padIconTooltip.show()}}),this._padIcon.inject(this._contentListContainer),this._padIconTooltip=new o({target:this._padIcon.getContent(),body:P.NO_VARIABILITY+"<br>"+P.NO_RULES+"<br>"+P.NO_CONFIGURATIONS})},setContextModel:function(){if(this.checkSameMV(),this._modelLoaded)this.ctxSelector.loadData(!0);else{let t={modelEvents:this.modelEvent,loadOnRefresh:!0,path:this._copyFromPath,autocompleteManager:this.autocompleteManager,type:"modelversion",className:this.ctxClassName};this.ctxSelector=new m(t);var e=`flattenedtaxonomies:("types/Products") AND NOT physicalid:("${this.currentMVId}")  AND NOT current:("Obsolete")`;let i={query:e};this.mvContext=this.ctxSelector.getModelContext(i);let n={type:"Products",NLS:P.SEARCH_FOR_MODELVERSION,additionalQuery:e,multiSel:!1};this.contextSetting=this.ctxSelector.setContextSetting(n);let a={modelContext:this.mvContext,view:this,NLS:P.ERROR_SETTING_CONTEXT};this.detailDisplay=this.ctxSelector.setDetailDisplay(a),this.detailDisplay.setConfig(this.contextSetting),this._modelLoaded=!0}},setAncestor:function(){let t=this;S.getContext(this._copyFromPath)||(this.maskContainer(P.FETCHING_DIRECT_ANCESTOR,"mvcopyfrom"),I.getPreviousModelVersion(this.currentMVId).then(function(i){if(console.log(i),i.isRoot||i.state&&"Obsolete"==i.state)t.unMaskContainer("mvcopyfrom");else{if(!i.identifier)return t.unMaskContainer("mvcopyfrom"),e.Promise.reject();t.modelEvent.publish({event:M.EVT_FETCH_ANCESTOR,data:i.identifier})}},function(){console.log("error getting direct ancestor"),t.unMaskContainer("mvcopyfrom")}))},contentListComponent:function(){this._contentListContainer=e.createElement("div"),this._contentListContainer.addClassName("mvcopy-listcontainer"),this._contentListContainer.inject(this.container)},render:function(){return this.container=e.createElement("div"),this.container.addClassName("mvCopyFromDialog"),this.createAutoCompleteForMVInput(),this.contentListComponent(),this._initializeItemsList(),this._initInfoIcon(),this.container},destroy:function(){this.genToolBar&&(this.genToolBar=void 0),this._itemsListPresenter&&this._itemsListPresenter.destroy()},checkSameMV:function(){let e=S.getContext(this._copyFromPath);e&&this.currentMVId==e.id&&S.updateContext(this._copyFromPath,"")},updateContextModelQuery:function(e){var t=`flattenedtaxonomies:("types/Products") AND NOT physicalid:("${this.currentMVId}")  AND NOT current:("Obsolete")`;let i={query:t};this.mvContext=this.ctxSelector.getModelContext(i);let n={type:"Products",NLS:P.SEARCH_FOR_MODELVERSION,additionalQuery:t,multiSel:!1};this.contextSetting=this.ctxSelector.setContextSetting(n)},_alignCtxCSS:function(){let e=this.ctxSelector.detailDisplay.container;for(;!e.hasClassName("wux-controls-toolbar-farContainer");)e.style.width="100%",e=e.parentElement;e.style.width="100%"},_subscribeEvents:function(){var e=this;this._myEventManager.subscribe(this.modelEvent,{event:M.EVT_UPDATE_ANCESTOR},function(t){t.length>0&&e.addCtx(t[0]),e.unMaskContainer("mvcopyfrom")}),this._myEventManager.subscribe(this.modelEvent,{event:"xmodel-copy-from-tabs-updated"},function(t){e._currPage=t}),this._myEventManager.subscribe(this.modelEvent,{event:"enox-model-app-ctx-selector-injected-success"},function(){e._modelLoaded&&e.ctxSelector.loadData(!0),e._alignCtxCSS()}),this._myEventManager.subscribe(this.modelEvent,{event:M.EVT_STATUS_NOTIFICATION},function(e){if(e&&e.type){"error"!==e.type||""!==e.message&&void 0!==e.message||(e.message=P.UNKNOWN_ERROR_MSG);let t={level:e.type,message:e.message,sticky:"error"===e.type};e.action&&(t.action=e.action),D.showMessage(t)}if(e.closeDialog){var t=document.getElementById("mvCopyFrmCancelBtn");t&&t.dispatchEvent(new Event("click"))}}),this._myEventManager.subscribe(this.modelEvent,{event:M.EVT_UNMASK_CONTAINER},function(t){e.unMaskContainer(t.tab)}),this._myEventManager.subscribe(this.modelEvent,{event:M.EVT_MASK_CONTAINER},function(t){t&&t.message&&e.maskContainer(t.message,t.tab)}),this._myEventManager.subscribe(this.modelEvent,{event:M.EVT_NO_SELECTIONS_AVAILABLE},function(){e._updateButtonStatus(!1),e._updateTooltipInfos()}),this._myEventManager.subscribe(this.modelEvent,{event:M.EVT_SOME_SELECTIONS_AVAILABLE},function(t){e._updateButtonStatus(!0),e._updateTooltipInfos(t)})},_updateTooltipInfos:function(e){let t,i="<br>"+P.NO_VARIABILITY+"<br>"+P.NO_RULES+"<br>"+P.NO_CONFIGURATIONS;e&&(i=t="<b>"+P.VARIABILITY+"</b> : "+e.variants+" "+P.VARIANTS+", "+e.values+" "+P.VALUES+", "+e.optionGroups+" "+P.OPTION_GROUPS+", "+e.options+" "+P.OPTIONS+", "+e.parameters+" "+P.PARAMETERS+"<br><b>"+P.RULES+"</b> : "+e.matRules+" "+P.MATRIX_RULES+", "+e.expRules+" "+P.EXPRESSION_RULES+"<br><b>"+P.CONFIGURATIONS+"</b> : "+e.baseConfigs+" "+P.BASE_CONFIGS+", "+e.prodConfigs+" "+P.PROD_CONFIGS),this._padIconTooltip.setBody(i),this._actionButtonTooltip.setBody(i)},_updateButtonStatus:function(e){let t=this,i=e?"enable":"disable",n=[];(n=[{id:"copyMvAddnCloseBtn"}]).forEach(e=>{e.state=i}),n&&n.length>0&&n.forEach(function(e){var i=document.getElementById(e.id);i&&("enable"!==e.state||"idcard"!=t._launchedFrom&&t._launchedFrom!=t._currPage?(i.addClassName("disabled"),i.disabled=!0):(i.removeClassName("disabled"),i.disabled=!1))})},_createSuperModal:function(){var e=this;this._superModal,this._superModal=new a({renderTo:window.widget.body,className:"mvcopycontainer-modal",events:{onShow:function(){e.modelEvent.publish({event:"enox-dialog-on-show"})},onHide:function(){e.modelEvent.publish({event:"mvcopy-enox-dialog-on-hide"})}}})},_performInitializations:function(e){this.options=e,this._id=e.id,this._path=this._copyFromPath,this._context=e.context,this._withCreateAndClose=e.withCreateAndClose,this.modelEvent=e.modelEvent,this._currPage=this._launchedFrom,this._prevPage="",this._inPostProcess=!1,void 0!==this._myEventManager&&(this._myEventManager.cleanup("ModelCopyFromDialog:Previous instance"),this._myEventManager=void 0),this._myEventManager=new g(this.modelEvent),this._autocompleteTreeDoc=new d,this._subscribeEvents()},_prepareDialogButtons:function(){var e=this;this._dialogButtons=[{className:"primary",value:P.ADD_EXISTING_FROM,id:"copyMvAddnCloseBtn",action:function(t){e.modelEvent.publish({event:M.EVT_PERFORM_ACTION}),t.hide()}},{className:"default",value:P.CANCEL,id:"mvCopyFrmCancelBtn",action:function(e){e.hide(!0)}}]},show:function(e){e.selectionMode=2,this._launchedFrom=e.launchedFrom,this._modelLoaded&&(this.ctxSelector.loadAutocompleteContex=!0,this.updateContextModelQuery(e)),this.initVersionExplorer(e),this._performInitializations(e),this._createSuperModal(),this._prepareDialogButtons(),this._superModal.dialog({id:"mvCopyFromModal",body:this.render(),title:e.title,buttons:this._dialogButtons}),this._actionButtonTooltip=new o({target:document.querySelector("#copyMvAddnCloseBtn"),body:"<b>"+P.ADD_EXISTING_TOOLTIP_HEADING+"<b><br>"+P.NO_VARIABILITY+"<br>"+P.NO_RULES+"<br>"+P.NO_CONFIGURATIONS}),this._updateButtonStatus(!1)},_initializeItemsList:function(){this._itemsListPresenter=new E,this._itemsListPresenter.init(this.modelEvent,new r,{someOptions:"Options for Combined Variability",tagFriends:"VariabilityTagProxy",settings:C.getModelCopyFromListSettings(),launchedFrom:this._launchedFrom}),this._itemsListPresenter.inject(this._contentListContainer)},maskContainer:function(e,t){void 0!==e&&""!==e&&"mvcopyfrom"==t&&i.mask(this.container,e)},unMaskContainer:function(e){"mvcopyfrom"==e&&i.isMasked(this.container)&&i.unmask(this.container)},initVersionExplorer:function(e){this.currentMVId=e.mvId,this.versionExplorerPresenter||(this.versionExplorerPresenter=new v({id:e.mvId,name:e.modelName,target:e.versionLabel,renderTo:this.container,modelEvents:e.privateChannel,applicationChannel:e.applicationChannel,selectionMode:e.selectionMode}),this.versionExplorerPresenter.versionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this.mvSelected.bind(this)))},showVersionExplorer:function(){this.versionExplorerPresenter.showVersionExplorer(this.currentMVId)},mvSelected:function(e){let t=this;if(Array.isArray(e)&&1==e.length)if(t.currentMVId==e[0].options.grid.id)t.modelEvent.publish({event:M.EVT_STATUS_NOTIFICATION,data:{message:P.NOT_SAME_MV_ALLOWED,type:"error"}});else if("Obsolete"==e[0].options.grid.maturity)t.modelEvent.publish({event:M.EVT_STATUS_NOTIFICATION,data:{message:P.NOT_OBSOLETE_ALLOWED,type:"error"}});else{let i=e[0].options.grid;t.modelEvent.publish({event:M.EVT_MASK_CONTAINER,data:{message:P.SETTING_CONTEXT,tab:"mvcopyfrom"}}),I.getObjectImage(i).then(function(e){i.preview_url=e.member[0].image,t.addCtx(i),t.modelEvent.publish({event:M.EVT_UNMASK_CONTAINER,data:{tab:"mvcopyfrom"}})},function(){t.addCtx(i),t.modelEvent.publish({event:M.EVT_UNMASK_CONTAINER,data:{tab:"mvcopyfrom"}})})}},addCtx:function(e){this.ctxSelector.modelContext.remove();let t={},i=[{id:e.physicalid?e.physicalid:e.id,"ds6w:type":e["ds6w:type"]?e["ds6w:type"]:e.type,"ds6w:label":(e["ds6w:label"]?e["ds6w:label"]:e.title)+" "+(e["ds6wg:revision"]?e["ds6wg:revision"]:e.revision),"ds6wg:revision":e["ds6wg:revision"]?e["ds6wg:revision"]:e.revision,"ds6w:identifier":e["ds6w:identifier"]?e["ds6w:identifier"]:e.name,preview_url:e.preview_url}];t.detailedObjects=i,this.ctxSelector.modelContext.add("context",e.id,t)}}}),define("DS/ENOXModelApp/ModelDefinition/js/EngineeringListPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/WebappsUtils/WebappsUtils","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/EngineeringListPresenter"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m){"use strict";var _=function(){};return _.prototype.init=function(e,t){this._pathEngineeringList=[l._KEY,l._VIEWS_PREFERENCES,l._PRODUCT_CONFIGURATIONS_DETAILS,l._LIST_VIEW,l._SPLITVIEW],this._applicationChannel=e,this._privateChannel=t||new i,this._myEventManager=new n(this._applicationChannel,this._privateChannel),this._listViewPresenter=null,this._initListViewContent(),this._subscribeToEvents()},_.prototype._initListViewContent=function(){const t=d.getSort(this._pathEngineeringList);var i=void 0;t&&t.sortAttribute&&t.sortOrder&&(i={id:t.sortAttribute,order:t.sortOrder}),this._listViewContent={id:"engineeringList",modelEvents:this._privateChannel,useDragAndDrop:!0,viewOptions:{identifier:"engineering_list",views:["TileView","DataGridView"],currentView:d.getView(this._pathEngineeringList)||"TileView",currentSort:i,grid:{columns:[{text:h.TITLE,dataIndex:"tree"},{text:h.NAME,dataIndex:"name"}]},editable:!1,itemViewMapping:{label:function(e){return e.options.grid.title+(e.options.grid.revision?"-"+e.options.grid.revision:"")},subLabel:function(e){return e.options.grid.nlsValues&&e.options.grid.nlsValues.nlsType?e.options.grid.nlsValues.nlsType+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible):(e.options.grid.state?e.options.grid.state+" | ":"")+(e.options.grid["ds6w:owner"]?e.options.grid["ds6w:owner"]:e.options.grid["ds6w:responsible"])},customTooltip:function(e){return s.prepareTooltipObjectView(e)},icon:function(){return r.getWebappsAssetUrl("ENOXModelApp","icon/physicalProduct.png")}}},emptyContentOptions:{sentences:[{type:"img",src:r.getWebappsAssetUrl("ENOXModelApp","icon/physicalProduct.png"),text:m._emptyPanelMessage}]},toolbarOptions:{itemsName:m._items,itemName:m._item,actions:[]},extensions:[p]},this._listViewPresenter=new c(this._listViewContent),this._container=e.createElement("div",{styles:{height:"100%",width:"100%"}}),this._listViewPresenter.inject(this._container)},_.prototype.inject=function(e){this._container.inject(e)},_.prototype._subscribeToEvents=function(){var t=this;this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-dblclick"},function(){e.log("xmodel-list-item-on-dblclick")}),this._myEventManager.subscribe(this._privateChannel,{event:"load-engineering-items-list"},function(i){if(i){var n={relations:["engineeringDefinition_to"],countmanagement:!1,ids:[i],trueREST:!0};t._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),o.getModelPhysicalItems(n,function(n){e.log("success");var a=[];a.member=n.New.Objects,e.log(a),a.member=a.member.filter(function(e){if(e.id==i)return!1;e.name=e["ds6w:identifier"],e.type=m._physicalProduct,e.title=e["ds6w:label"],e.thumbnail||(e.thumbnail=r.getWebappsAssetUrl("ENOXModelApp","icon/physicalProduct.png"));var t=e["ds6w:status"];switch(t){case"VPLM_SMB_Definition.IN_WORK":t=m._inWork,e.state=t;break;case"VPLM_SMB_Definition.PRIVATE":t=m._private,e.state=t;break;case"VPLM_SMB_Definition.FROZEN":t=m._frozen,e.state=t;break;case"VPLM_SMB_Definition.RELEASED":t=m._released,e.state=t;break;case"VPLM_SMB_Definition.OBSOLETE":t=m._obsolete,e.state=t}return!0}),e.log(a),t._privateChannel.publish({event:"xmodel-list-data-load-action",data:a}),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:d.getSort(t._pathEngineeringList)})},function(){e.log("failed"),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"})})}}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-switch-view-activated"},function(i){e.log(i),d.updateView(t._pathEngineeringList,i)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-sort-activated"},function(e){d.updateSort(t._pathEngineeringList,e)})},_.prototype.showContentRightPanel=function(e){this._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:e}})},_.prototype.showLoadingRightPanel=function(){var i=e.createElement("div",{class:"loading-right-panel",styles:{height:"inherit",width:"inherit"}});t.mask(i),this._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:i}})},_.prototype.destroy=function(){this._myEventManager&&(this._myEventManager.cleanup("EngineeringListPresenter"),this._myEventManager=null)},_}),define("DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromDialog","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromDataManager","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromConstants","DS/ENOXModelApp/Utils/xModelPreferencesConstant","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelCopyFrom"],function(e,t,i,n,a,o,s,r,l){"use strict";var d=function(){};return d.prototype.init=function(t,a){this._pathCopyFrom=[r._KEY,r._VIEWS_PREFERENCES,r._COPY_FROM],this._updateChannel=t,e.extend(this,a),this._localChannel=new i,this._myEventManager=new n(this._updateChannel,this._localChannel,this._applicationChannel),this._copyFromDataManager=new o,this._subscribeEvents()},d.prototype._subscribeEvents=function(){var e=this;this._myEventManager.subscribe(this._updateChannel,{event:s.EVT_SET_TARGET_MV},function(t){e.modelName=t.modelName,e.modelId=t.modelId,e.mvId=t.mvId,e.mvTitle=t.mvTitle,e.versionLabel=t.versionLabel,e._copyFromDataManager.init({modelEvent:e._localChannel,modelName:e.modelName,modelId:e.modelId,mvId:e.mvId,mvTitle:e.mvTitle,launchedFrom:t.launchedFrom,applicationChannel:e._applicationChannel})}),this._myEventManager.subscribe(this._updateChannel,{event:s.EVT_LAUNCH_COPY_FROM_DIALOG},function(t){e._launchCopyFrom(t)}),this._myEventManager.subscribe(this._updateChannel,{event:s.EVT_TARGET_MV_DICO_LOADED},function(t){e._localChannel.publish({event:s.EVT_TARGET_MV_DICO_LOADED,data:t})}),this._myEventManager.subscribe(this._localChannel,{event:s.EVT_MV_COPY_FROM_DIALOG_CLOSED},function(t){e._updateChannel.publish({event:s.EVT_MV_COPY_FROM_DIALOG_CLOSED,data:t})}),this._myEventManager.subscribe(this._localChannel,{event:s.EVT_MV_COPY_FROM_DIALOG_CLOSED},function(){a.destroy(),e._copyFromDataManager&&e._copyFromDataManager.destroy()})},d.prototype._launchCopyFrom=function(e){let t=l.MV_COPY_FROM_DIALOG_TITLE_ADD_EXISTING,i={id:"DUMMY",modelEvent:this._localChannel,title:t,withCreateAndClose:!0,modelName:this.modelName,modelId:this.modelId,mvId:this.mvId,applicationChannel:this._applicationChannel,privateChannel:this._localChannel,versionLabel:this.versionLabel,path:this._pathCopyFrom,launchedFrom:e};a.show(i)},d.prototype.destroy=function(){e.log("Performing cleanup-CopyFromPresenter!"),this._myEventManager&&(this._myEventManager.cleanup(),this._myEventManager=null,this._localChannel=null),this._copyFromDataManager&&(this._copyFromDataManager.destroy(),this._copyFromDataManager=void 0)},d}),define("DS/ENOXModelApp/PCDefinition/PC3DPresenter",["UWA/Core","DS/UIKIT/Mask","UWA/Class/Timed","DS/Controls/Button","DS/Controls/Loader","DS/ENOXModelApp/Viewer3D/3DViewer","DS/ENOXModelApp/ModelDefinition/js/EngineeringListPresenter","DS/CoreEvents/ModelEvents","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/xModelEventManager/xModelEventManager","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","i18n!DS/ENOXModelApp/assets/nls/PCDefinition/PCDefinition","css!DS/ENOXModelApp/PCDefinition/PC3DPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u){"use strict";var h=function(){};return h.prototype.init=function(e){this._updateChannel=e.updateChannel||new r,this._applicationChannel=e.applicationChannel||new r,this._modelId=e.modelId,this._modelName=e.modelName,this._timed=new i,this._TIMEOUT=5e3,this._ALERT_COUNTER="ALERT_COUNTER",this._APPLY_FILTER="APPLY_FILTER",this._myEventManager=new c(this._updateChannel),e.productId&&(this._currentProductId=e.productId),this._isActive=!1,this._subscribeToEvents(),this._initDivs(),this.fetchData()},h.prototype._initDivs=function(){var t=this;this._container=e.createElement("div",{class:"pc-3d-presenter"}),this._listContent=e.createElement("div",{class:"pc-pp-list-content"}),this._3dContent=e.createElement("div",{class:"pc-3d-content"}),this._closeAction=new n({icon:{iconName:"close",fontIconFamily:window.WUXManagedFontIcons.Font3DS},displayStyle:"lite"}),this._closeAction.getContent().addClassName("pc-3d-close-button"),t._closeAction.hide(),this._closeAction.getContent().addEventListener("buttonclick",function(){t.hide()}),this._loader=new a({fadeDuration:0,showButtonFlag:!1,text:e.String.format(u.FillterAlertLabel,this._TIMEOUT/1e3)}),this._applyFilterButton=new n({label:u.ApplyFilterLabel,emphasize:"primary"}),this._applyFilterButton.addEventListener("buttonclick",function(e){t.manageApplyFilterCall(!0)}),this._applyFilterButton.inject(this._loader.getContent()),this._filterAlertContent=e.createElement("div",{class:"pc-3d-alert-container",html:[{tag:"div",class:"pc-3d-alert-content",html:this._loader.getContent()}]}),this._container.setContent([this._listContent,this._3dContent,this._closeAction.getContent(),this._filterAlertContent])},h.prototype.inject=function(e){e.appendChild(this._container)},h.prototype.show=function(){this._isActive=!0,this._currentProductId?this.show3DContent():this.showListView()},h.prototype.hide=function(){this._isActive=!1,this._updateChannel.publish({event:"pc-3d-on-hide-action"})},h.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._updateChannel,{event:"xmodel-list-item-on-dblclick"},function(t){var i=t.model;e._currentProductId=i.id,e._currentProductName=i.name,e._updateChannel.publish({event:"pc-3d-prodct-on-select",data:e._currentProductId}),e.show3DContent()}),this._myEventManager.subscribe(this._updateChannel,{event:"xmodel-list-data-load-action"},function(t){if(e._currentProductId&&t.member){for(var i=0;i<t.member.length;i++)if(e._currentProductId===t.member[i].id)return void(e._currentProductName=t.member[i].name);e._viewer&&(e._currentProductId=null,e._currentProductName=null,e.showListView())}}),this._myEventManager.subscribe(this._updateChannel,{event:"pc-3d-filter"},function(t){e.setFilterXML(t.filterXML),e._currentProductId&&e.manageApplyFilterCall()})},h.prototype.setFilterXML=function(t){this._filterXML=e.Utils.xmlToString(e.Utils.loadXml(t).getRootNode())},h.prototype.manageApplyFilterCall=function(t){if(t)return this.applyFilter(),this._timed.clearAllTimed(),this._loader.off(),void this._filterAlertContent.hide();this._timed.hasPeriodical(this._ALERT_COUNTER)&&(this._timed.clearPeriodical(this._ALERT_COUNTER),this._loader.off(),this._filterAlertContent.hide()),this._filterAlertContent.show(),this._loader.on();var i=this._TIMEOUT/1e3;this._timed.setPeriodical(this._ALERT_COUNTER,function(){0!==i?this._loader.text=e.String.format(u.FillterAlertLabel,i):(this._timed.clearPeriodical(this._ALERT_COUNTER),this._loader.off(),this._filterAlertContent.hide()),i--},1e3,!0,this),this._timed.clearDelayed(this._APPLY_FILTER),this._timed.setDelayed(this._APPLY_FILTER,this.applyFilter,this._TIMEOUT,!1,this)},h.prototype.applyFilter=function(){this._viewer.applyFiltering({filterXML:this._filterXML,rootID:this._currentProductId,rootAlias:this._currentProductName})},h.prototype.fetchData=function(){var t=this;this._listViewPresenter=new s,this._listViewPresenter.init(this._applicationChannel,this._updateChannel);var i=e.createElement("div",{class:"pc-pp-list-title",html:u.physical_product_select_title});e.createElement("div",{class:"pc-pp-list-toolbar",html:i}).inject(this._listContent);var n=e.createElement("div",{class:"pc-pp-list-container"});n.inject(this._listContent),this._listViewPresenter.inject(n),this._modelId&&this._updateChannel.publish({event:"load-engineering-items-list",data:this._modelId}),this._viewer=new o({widget:window.widget,modelId:this._modelId,modelName:this._modelName}),this.viewerContext=this._viewer.viewerPADContext,this._viewer.onReady(function(){t._viewer.onLoadingComplete(function(){e.log("loaded"),t._updateChannel.publish({event:"pc-3d-on-load"})}),t._viewer.onRemoveAllRoots(function(){e.log("remove all roots action"),t._updateChannel.publish({event:"pc-3d-on-remove-all"}),t._currentProductId=null,t._currentProductName=null,t.showListView()})})},h.prototype.show3DContent=function(){var e=this;t.mask(e._container),e._3dContent.show(),e._listContent.hide(),e._closeAction.show(),setTimeout(function(){e._3dContent.setContent(e._viewer.getViewer()),e._viewer.loadRootInViewer({rootID:e._currentProductId,rootAlias:e._currentProductName,filterXML:e._filterXML}),t.unmask(e._container)},800)},h.prototype.showListView=function(){this._listContent.show(),this._3dContent.hide(),this._closeAction.hide(),this._filterAlertContent.hide()},h.prototype.destroy=function(){this._viewer.destroy()},h}),define("DS/ENOXModelApp/ModelDefinition/js/VariabilityDataManager",["UWA/Core","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/components/DialogAddAll/AddExistingItems","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromConstants","DS/EditPropWidget/comm/EventManager","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","text!DS/ENOXModelApp/assets/ModelVariabilityConstants.json","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/VariabilityPresenter","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f){"use strict";var g=function(e,t){d.consoleLogger("ModelCopyFromDataMgr : "+e,t)};_=JSON.parse(_);var b=function(){};return b.prototype.init=function(a){e.extend(this,a),this._variabilityIdMap={},this._variabilityDataMap={},this.updateChannel=a.modelEvent?a.modelEvent:new t,this._createChannel=a.createModelEvent?a.createModelEvent:new t,this._myEventManager=new i(this.updateChannel),this._eventManagerOptions=[],this._subscribeEvents(),this._x3DSearch=new n,this.path=[u._KEY,u._VIEWS_PREFERENCES,u._MODEL_VERSIONS_DETAILS,u._VARIABILITY],this.variantCustomStatus=!1,this.optionGroupCustomStatus=!1,this.valueCustomStatus=!1,this.optionCustomStatus=!1,this.parameterCustomStatus=!1},b.prototype._subscribeEvents=function(){var t=this;this._myEventManager.subscribe(this.updateChannel,{event:_.EVT_MODEL_VER_VARIABILITY_AVAILABLE},function(i){g("TargetMV dictionary available!!!"),t._mvDico=e.clone(i),t._loadDictionary()}),this._myEventManager.subscribe(this.updateChannel,{event:"variability-load-full-dictionary"},function(i){g("TargetMV dictionary available!!!"),t._mvDico=e.clone(i),t._prepareDictionaryData(),t.updateChannel.publish({event:"variability-load-full-dictionary-done"})}),this._myEventManager.subscribe(this.updateChannel,{event:_.EVT_VARIABILITY_ATRB_UPDATE},function(e){g("Variability Attribute updated!!!"),t._attributeUpdateHandler(e)}),this._myEventManager.subscribe(this.updateChannel,{event:_.EVT_CREATE_DICO_ITEM_N_ALLOCATE},function(e){g("Create Dictionary item and allocate"),t._createAndAllocateDicoItem(e)}),this._myEventManager.subscribe(this.updateChannel,{event:_.EVT_ADD_EXISTING_VARIABILITY},function(e){g("AddExisting Handler..."),t._handleAddExistingVariability(e)}),this._myEventManager.subscribe(this.updateChannel,{event:_.EVT_GET_CRITERIA_VALUES},function(e){var i=[];e.id&&t._variabilityIdMap.hasOwnProperty(e.id)&&(i=t._variabilityIdMap[e.id]),e.callback(i)}),this._myEventManager.subscribe(this.updateChannel,{event:"variability-get-children-data"},function(e){var i={member:[]};if(e.id&&t._variabilityIdMap.hasOwnProperty(e.id)){var n=t._variabilityIdMap[e.id];i.member=n.map(e=>t._variabilityDataMap[e])}e.callback(i)}),this._myEventManager.subscribe(this.updateChannel,{event:_.EVT_REMOVE_VARIABILITY},function(e){e.instanceData&&t._handleRemoveVariability(e.instanceData)}),this._myEventManager.subscribe(this.updateChannel,{event:_.EVT_ADD_CRITERIA_VALUES},function(e){t._handleAddCriteriaValues(e)})},b.prototype._loadDictionary=function(){this._combinedVariability=this._prepareDictionaryData(),this.updateChannel.publish({event:_.EVT_LOAD_MV_DICO,data:{member:this._combinedVariability}})},b.prototype._prepareDictionaryData=function(){var t=this;if(p.getCustomAttributeStatus(t.path)){this.updateChannel.publish({event:"extract-variability-custom-attributes",data:t._mvDico});var i=this._mvDico.portfolioClasses.member[0].portfolioComponents.member[0];i.hasOwnProperty("customerAttributes")&&(i.customerAttributes.hasOwnProperty("Variant")&&(t.variantCustomStatus=!0),i.customerAttributes.hasOwnProperty("Variability Group")&&(t.optionGroupCustomStatus=!0),i.customerAttributes.hasOwnProperty("Variability Option")&&(t.optionCustomStatus=!0),i.customerAttributes.hasOwnProperty("Variant Value")&&(t.valueCustomStatus=!0),i.customerAttributes.hasOwnProperty("Variant Parameter")&&(t.parameterCustomStatus=!0))}var n=[],a=e.Json.path(this._mvDico,"$..portfolioComponents.member");return(a=a&&a[0]?a[0]:[]).forEach(function(e){if(e)for(var i in e){var a,o,s;if(e.hasOwnProperty(i))if(e[i].member&&e[i].member.length>0){switch(i){case"variants":a="variant",o="value",s="values";break;case"variabilityGroups":a="variabilityGroup",o="option",s="options";break;case"parameters":a="parameter",o="",s="NO_CHILD";break;default:continue}switch(t.filterReferenceItems(e[i].member,a,o,s),i){case"variants":case"variabilityGroups":case"parameters":n=n.concat(e[i].member)}}}}),n},b.prototype.filterReferenceItems=function(e,t,i,n){let a=this;for(var o=0;o<e.length;o++){var s=e[o];if(s.kind&&"reference"===s.kind)e.splice(o,1),o--;else{s.instanceId="variabilityGroup"===t?s.rel_id:s.id;var r=s.idref?s.idref:s.id?s.id:"";s.id=r,s.attributes._isA=t,a._formatAttributes(s),a._variabilityDataMap[r]=s;var l=[];if(s.hasOwnProperty(n))for(var d=s[n]&&s[n].member?s[n].member:[],c=0;c<d.length;c++){var p=d[c];if(p.kind&&"reference"===p.kind)d.splice(c,1),c--;else{p.parentId=r,p.instanceId=p.id;var u=p.idref?p.idref:p.id?p.id:"";p.id=u,l.push(u),p.attributes._isA=i,a._formatAttributes(p),a._variabilityDataMap[u]=p}}else s[n]={member:[]};a._variabilityIdMap[r]=l}}},b.prototype._handleAddExistingVariability=function(){var t=this;this.openSearchAction().then(function(i){e.log("attach criteria");var n=i.variant,o=i.optionGroup,s=i.parameter,r=function(){if(s.length>0){t.updateChannel.publish({event:_.EVT_VARIABILITY_SHOW_LOADING});var i=[];s.forEach(function(e){i.push(a.getDicoParameterDetails({id:e.id}))}),e.Promise.allSettled(i).then(function(i){e.log("details "+i);var n=[];i.forEach(function(e){e.value&&e.value.member&&e.value.member.length>0&&(n=n.concat(e.value.member))}),n.length>0&&t.createParameterInstances(n),t.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING})},function(){e.log("error in getting parameter details"),l.showError(v.ERROR_GET_PARAMETER_DETAILS),t.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING})})}},d=function(e){return e.id};n.length>0||o.length>0?t.checkAllocateAll().then(function(e){if(e){if(n.length>0){var i=n.map(d);t._addExistingWithAllValue(i,"variant")}if(o.length>0){var a=o.map(d);t._addExistingWithAllValue(a,"variabilityGroup")}}else{if(n.length>0){var s=t._prepareDataForServiceCall(n,"variant");t.createInstancePublicService(s,"variant",m.ADDEXISTING)}if(o.length>0){var l=t._prepareDataForServiceCall(o,"variabilityGroup");t.createInstancePublicService(l,"variabilityGroup",m.ADDEXISTING)}}r()}):r()},function(){e.log("Error")})},b.prototype.checkAllocateAll=function(){return new e.Promise(function(e){var t={immersiveFrame:r.getImmersiveFrame(),in_apps_callback:function(t){t.addPref&&(window.widget.setValue("addExistingPref",t.prefValue),window.widget.addPreference({name:"addExistingPref",type:"boolean",label:v.addExistingPref,defaultValue:!!t.prefValue&&t.prefValue})),e(t.prefValue)}};if(window.widget.hasPreference("addExistingPref")){var i=window.widget.getValue("addExistingPref");e(i)}else s.showDialog(t)})},b.prototype._addExistingWithAllValue=function(t,i){var n=this;n.updateChannel.publish({event:_.EVT_VARIABILITY_SHOW_LOADING});var o={variant:"variant",variabilityGroup:"optionGroup"},s={variant:"value",variabilityGroup:"option"},r={variant:"Must",variabilityGroup:"May"};if(t)return a[{variant:"getValueItems",variabilityGroup:"getOptionItems"}[i]](JSON.stringify(t)).then(function(t){var a=[];return t&&t.member&&t.member.forEach(function(t){var n={constraint:r[i]};n[o[i]]={id:t.id},n[s[i]]=[],t.child&&(e.is(t.child,"array")?n[s[i]]=t.child.map(function(e){return{id:e}}):n[s[i]]=[{id:t.child}]),a.push(n)}),e.log("items : "+JSON.stringify(a)),n.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),n.createInstancePublicService(a,i,m.ADDEXISTING)},function(){switch(e.log("Error.."),n.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),i){case"variant":l.showError(v.ERROR_GET_VALUES);break;case"variabilityGroup":l.showError(v.ERROR_GET_OPTIONS)}return e.Promise.reject()});n.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING})},b.prototype._handleRemoveVariability=function(t){var i=this;i.updateChannel.publish({event:_.EVT_VARIABILITY_SHOW_LOADING});var n={variant:"deleteVariantClassVariabilityInstances",value:"deleteVariantVariabilityInstances",variabilityGroup:"deleteOptionGroupVariabilityInstances",option:"deleteOptionVariabilityInstances",parameter:"deleteParameterInstances"},o=function(t,o){var s,r=t.map(function(e){return e.instanceId});return s="parameter"===o?{parentID:i.mvId,instances:r}:{parentId:i.mvId,instanceIds:r},a[n[o]](s).then(function(){return n=t,i.updateChannel.publish({event:_.EVT_MODEL_VER_VARIABILITY_UPDATED,data:{}}),i.updateChannel.publish({event:_.EVT_REMOVE_NODE_FOR_INSTANCE,data:n}),e.is(n,"array")&&n.forEach(function(e){var t=e.parentId,n=e.id;if(i._variabilityIdMap.hasOwnProperty(n))delete i._variabilityIdMap[n];else if(t&&i._variabilityIdMap.hasOwnProperty(t)){var a=i._variabilityIdMap[t].indexOf(n);a>-1&&i._variabilityIdMap[t].splice(a,1)}}),e.Promise.resolve();var n},function(t){return function(t){return e.Promise.reject(t)}(t)})};if(t){var s=[];for(var r in t)if(t.hasOwnProperty(r)){var d=t[r];if(d.length>0){var c=o(d,r);s.push(c)}}e.Promise.all(s).then(function(){i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING})},function(e){h.showError({mandatoryErrCodeCheck:!1,action:m.REMOVE,type:m.VARIABILITY_TAB,message:e})||l.showError(v.ERROR_VARIABILITY_DEALLOCATION),i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING})})}},b.prototype._handleAddCriteriaValues=function(t){var i=this;i.updateChannel.publish({event:_.EVT_VARIABILITY_SHOW_LOADING});var n={value:"variant",option:"optionGroup"};if(t){var o=t.type,s={constraint:{value:"Must",option:"May"}[o]};s[n[o]]={id:t.parentId},t.ids&&(s[o]=t.ids.map(function(e){return{id:e}}));var r={parentID:i.mvId,items:[s]};a[{value:"allocateValues",option:"allocateOptions"}[o]](r).then(function(a){if(e.is(a.member,"array")){var s=a.member,r=[];if(e.is(s,"array")&&s.length>0){e.log("success"),i.updateChannel.publish({event:_.EVT_MODEL_VER_VARIABILITY_UPDATED,data:{}});var l,d=i._prepareNodeFromInstances(s,n[o]);if(i.updateChannel.publish({event:_.EVT_ADD_NODE_FOR_VALUE_INSTANCE,data:d}),l="value"===t.type?i.valueCustomStatus:i.optionCustomStatus,p.getCustomAttributeStatus(i.path)&&l){var u={id:a.member[0][o].member[0].id,parentID:t.parentId,type:t.type,flag:l};i.updateChannel.publish({event:"update-customMap-after-creation",data:u})}i._updateVariabilityData(d);for(var h=d[0].subItem.member,m=0;m<h.length;m++)r.push(h[m].id)}i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),"value"===o?c.publish("variability-Values-added-list-action",r):"option"===o&&c.publish("variability-Options-added-list-action",r)}},function(){e.log("Error"),l.showError(v.ERROR_VARIABILITY_ALLOCATION),i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING})})}},b.prototype.openSearchAction=function(){var t=this;return new e.Promise(function(e){var i=Object.keys(t._variabilityIdMap),n={title:v.addExistingSearchTitle,allowedTypes:[],role:"",precondition:'((flattenedtaxonomies:"types/Variant" OR flattenedtaxonomies:"types/Variability Group") AND (NOT policycurrent:"Perpetual Resource.Obsolete")) OR ((flattenedtaxonomies:"types/Variant Parameter") AND (NOT policycurrent:"Perpetual Resource.Obsolete"))',criteria:"",resourceid_not_in:i,in_apps_callback:function(t){var i={variant:[],optionGroup:[],parameter:[]};t.forEach(function(e){"Variant"===e["ds6w:type_value"]?i.variant.push(e):"Variability Group"===e["ds6w:type_value"]?i.optionGroup.push(e):"Variant Parameter"===e["ds6w:type_value"]&&i.parameter.push(e)}),e(i)}};t._x3DSearch.launchASearch(n)})},b.prototype._attributeUpdateHandler=function(t){try{var i,n=this;e.log("Attribute Update Handler!!!");var o=t.changedObject;"variant"===o.type?i=o.id:"variabilityGroup"===o.type&&(i=o.id);var s={id:i,parentId:this.mvId,attributes:{}};s.attributes["_"+o.name]=o.value,e.log(s),a.updateVariabilityInstanceDetails(s).then(function(){e.log("attribute updated"),n.updateChannel.publish({event:_.EVT_MODEL_VER_VARIABILITY_UPDATED,data:{}}),t.cellInfos&&t.cellInfos.nodeModel&&(t.cellInfos.nodeModel.options.grid[o.name]=o.value)},function(){e.log("attribute updatation failed"),t.cellInfos&&t.cellInfos.nodeModel&&(t.cellInfos.nodeModel.options.grid[o.name]=o.value),l.showError(v.ERROR_UPDATE_VAR_INSTANCE_ATTRIBUTES)})}catch(t){e.log("[VariabilityDataManager:attributeUpdateHandler] Exception occured: "+t.stack),l.showError(v.ERROR_UPDATE_VAR_INSTANCE_ATTRIBUTES)}},b.prototype._createAndAllocateDicoItem=function(t){var i=this;if(i.updateChannel.publish({event:_.EVT_VARIABILITY_SHOW_LOADING}),t&&t.type&&t.items){var n;switch(t.type){case"variant":n="createDicoVariant";break;case"variabilityGroup":n="createDicoOptionGroup";break;case"parameter":n="createDicoParameter";break;default:return void e.log("Wrong input to crete and item handler!!")}a[n]({items:t.items}).then(function(n){e.log("Successful creation of dictionary item.");var a=n.member[0];if(t.image)o.uploadImage(a.id,t.image).then(function(e){e&&(a.image=e);var n,o=i._prepareDataForServiceCall([a],t.type);"parameter"===t.type&&(n=[a]),i.createInstancePublicService(o,t.type,m.CREATE,n),i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),i._createChannel.publish({event:"enox-dialog-creation-done"}),l.showSuccess(f._creation_successful)},function(){var e=i._prepareDataForServiceCall([a],t.type);i.createInstancePublicService(e,t.type,m.CREATE),i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),i._createChannel.publish({event:"enox-dialog-creation-done"}),l.showSuccess(f._creation_successful)});else{if(i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),"parameter"!==t.type){var s=i._prepareDataForServiceCall([a],t.type);i.createInstancePublicService(s,t.type,m.CREATE)}else i.createParameterInstances([a]);i._createChannel.publish({event:"enox-dialog-creation-done"}),l.showSuccess(f._creation_successful)}},function(){switch(e.log("Failed creation of dictionary item."),t.type){case"variant":l.showError(v.ERROR_CREATE_VARIANT);break;case"variabilityGroup":l.showError(v.ERROR_CREATE_OPTION_GROUP);break;case"parameter":l.showError(v.ERROR_CREATE_PARAMETER)}i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),i._createChannel.publish({event:"enox-dialog-creation-done"})})}},b.prototype.createInstancePublicService=function(t,i,n,o){var s,r,d=this;switch(d.updateChannel.publish({event:_.EVT_VARIABILITY_SHOW_LOADING}),i){case"variant":r="allocateValues";break;case"variabilityGroup":r="allocateOptions";break;case"parameter":r="createParameterVariabilityInstances"}var c={parentID:d.mvId,items:t};a[r](c).then(function(t){if(o&&(t={member:o}),e.is(t.member,"array")){var n=t.member;if(e.is(n,"array")&&n.length>0){d.updateChannel.publish({event:_.EVT_MODEL_VER_VARIABILITY_UPDATED,data:{}});var a=d._prepareNodeFromInstances(n,i);switch(d.updateChannel.publish({event:_.EVT_ADD_NODE_FOR_INSTANCE,data:a}),i){case"variant":s=d.variantCustomStatus;break;case"variabilityGroup":s=d.optionGroupCustomStatus}if(p.getCustomAttributeStatus(d.path)&&s){var r={id:a[0].item.id,type:i,flag:s};d.updateChannel.publish({event:"update-customMap-after-creation",data:r})}d.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),d._updateVariabilityData(a)}}},function(t){var a;switch(e.log("Error while creating instances!!"),i){case"variant":a=m.TYPE_VARIANT;break;case"variabilityGroup":a=m.TYPE_OptionGroup;break;case"parameter":a=m.TYPE_PARAMETER}h.showError({action:n,type:a,message:t})||l.showError(v.ERROR_VARIABILITY_ALLOCATION),d.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING})})},b.prototype._prepareNodeFromInstances=function(t,i){var n,a,o=[],s=this;return t&&t.length>0&&t.forEach(function(r){if(r.variant&&r.variant.member&&r.variant.member.length>0)(n=e.clone(r.variant.member[0])).idref=n.id,n.instanceId=r.id,n.isA=i,a={item:n},r.value&&r.value.member&&r.value.member.length>0&&(a.subItem={member:[]},r.value.member.forEach(function(t){var i=e.clone(t);i.parentId=n.id,i.idref=i.id,i.instanceId=s.mvId+"@"+i.rel_id,i.isA="value",a.subItem.member.push(i)})),o.push(a);else if(r.optionGroup&&r.optionGroup.member&&r.optionGroup.member.length>0){var l=e.clone(r.optionGroup.member[0]);l.idref=l.id,l.instanceId=r.id,l.rel_id=r.id,l.sequenceNumber=r.sequenceNumber,l.isA=i;var d={item:l};r.option&&r.option.member&&r.option.member.length>0&&(d.subItem={member:[]},r.option.member.forEach(function(t){var i=e.clone(t);i.parentId=l.id,i.idref=i.id,i.instanceId=s.mvId+"@"+i.rel_id,i.sequenceNumber=t.sequenceNumber,i.isA="option",d.subItem.member.push(i)})),o.push(d)}else"parameter"===i&&(r=t[0],(n=e.clone(r)).idref=n.id,n.instanceId=r.id,n.isA=i,a={item:n},o.push(a))}),o},b.prototype._updateVariabilityData=function(e){var t=this;e.forEach(function(e){if(e&&e.item){var i=e.item.id;i&&(t._variabilityIdMap.hasOwnProperty(i)||(t._variabilityIdMap[i]=[]),e.subItem&&e.subItem.member&&e.subItem.member.forEach(function(e){var n=e.id;n&&t._variabilityIdMap[i].indexOf(n)<0&&t._variabilityIdMap[i].push(n)}))}})},b.prototype._prepareDataForServiceCall=function(t,i){var n=[];if(i&&t){switch(i){case"variant":case"variabilityGroup":case"parameter":break;default:return e.log("Type not supported yet!!!"),n}return t.forEach(function(e){"variant"===i?n.push({constraint:"Must",variant:{id:e.id},value:[]}):"parameter"===i?n.push({parameter:{id:e.id}}):"variabilityGroup"===i&&n.push({constraint:"May",optionGroup:{id:e.id},option:[]})}),n}},b.prototype.createParameterInstances=function(t){var i=this;i.updateChannel.publish({event:_.EVT_VARIABILITY_SHOW_LOADING});var n=[],o=[];t.forEach(function(e){e.id&&(o.push(e.id),n.push({parameter:{id:e.id}}))});var s={items:n};return a.createParameterVariabilityInstances(s,this.mvId).then(function(n){if(e.is(n.member,"string")){var a=o;if(e.is(a,"array")&&a.length>0){i.updateChannel.publish({event:_.EVT_MODEL_VER_VARIABILITY_UPDATED,data:{}});for(var s,r=[],l=0;l<t.length;l++)(s=e.clone(t[l])).idref=s.id,s.instanceId=a[l],s.isA="parameter",r.push({item:s});i.updateChannel.publish({event:_.EVT_ADD_NODE_FOR_INSTANCE,data:r});var d=i.parameterCustomStatus;if(p.getCustomAttributeStatus(i.path)&&d){var c={id:s.id,type:"parameter",flag:d};i.updateChannel.publish({event:"update-customMap-after-creation",data:c})}return i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),i._updateVariabilityData(r),e.Promise.resolve(a)}}e.log("Parameter instance creation successful!")},function(t){return e.log("Parameter instance creation failed."),h.showError({action:m.ADDEXISTING,type:m.TYPE_PARAMETER,message:t})||l.showError(v.ERROR_VARIABILITY_ALLOCATION),i.updateChannel.publish({event:_.EVT_VARIABILITY_HIDE_LOADING}),e.Promise.reject()})},b.prototype._formatAttributes=function(e){if(e&&e.attributes)for(var t in e.attributes)if(e.attributes.hasOwnProperty(t)){var i=t.indexOf("_");0===i&&(e[t.slice(i+1)]=e.attributes[t])}},b.prototype.destroy=function(){g("Performing cleanup-CopyFromManager!",!0),this._myEventManager&&(this._myEventManager.cleanup(),this._myEventManager=null),this._x3DSearch&&(this._x3DSearch.destroy(),this._x3DSearch=void 0)},b}),define("DS/ENOXModelApp/PCDefinition/PCDetailsStatePresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","UWA/Class/Model","DS/PADUtils/PADContext","DS/ENOXIDCardContainer/js/ENOXIDCardContainer","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/ENOXSplitView/js/ENOXSplitView","DS/ConfiguratorPanel/scripts/Utilities","DS/ConfiguratorPanel/scripts/Presenters/PCPanel","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelIDCardAttributeEditor","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/TaggerOnIndexComponent/TaggerOnIndexComponent","DS/WildcardSearchComponent/WildcardSearchComponent","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/UIKIT/Input/Button","DS/Controls/Toggle","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/PCDefinition/PC3DPresenter","DS/ENOXModelApp/components/DialogCreation/WarningDialog","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/ENOXModelApp/PCDefinition/PCStatusRulesOriginator","DS/CfgSolver/CfgSolverServices","i18n!DS/ENOXModelApp/assets/nls/components/DialogCreation/DialogCreationSaveRule","i18n!DS/ENOXModelApp/assets/nls/PCDefinition/PCDefinition","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/PCListPresenter","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","css!DS/ENOXModelApp/PCDefinition/PCDetails.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x,R,V,N,L,F,U,k){"use strict";var X=window.localStorage.XMODEL_BROWSER_LOG_DEBUG,B=function(){},j=[];return B.prototype.init=function(t,n,a){var o=a||{};this.tagProxyName=void 0===o.tagProxyName?"PCDetailsStatePresenter":o.tagProxyName,this._pathPCDetail=[f._KEY,f._VIEWS_PREFERENCES,f._PRODUCT_CONFIGURATIONS_DETAILS],this._isDestroyed=!1,this.options=e.merge(this,o),this._applicationChannel=t,this._updateChannel=n,this._privateModelEvents=new i,this._privateModelEventsForSplitView=new i,this._modelEventsForConfigPanel=new i,this._saveWarningVisible=!1,this._myEventManager=new v(this._applicationChannel,this._updateChannel,this._privateModelEvents,this._privateModelEventsForSplitView,this._modelEventsForConfigPanel),this._subscribeToEvents(),this._initDivs(),this._initCommand(),this._TaggerOnIndexComponent=b,this.WildcardSearch=new E,this._enoxIDCardContainer=new s,this._idCardAttrbEditorUtil=new u,this._idCardAttrbEditorUtil.init(this._privateModelEvents),this._initPropertyPanel()},B.prototype._initCommand=function(){this._command=new m(this._privateModelEvents,this._container,this._applicationChannel)},B.prototype._initPropertyPanel=function(){C.initialize({applicationChannel:this._applicationChannel,context:"ProductConfiguration",id:this.id})},B.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("PC-details"),this._contentBottom=e.createElement("div"),this._contentBottom.classList.add("configPanel-content"),this._parentConfPanel=e.createElement("div"),this._parentConfPanel.classList.add("parentConfPanel"),this._confPanelContainer=e.createElement("div"),this._confPanelContainer.classList.add("confPanelContainer"),this._parentConfPanel.appendChild(this._confPanelContainer),this._persistencyContainer=e.createElement("div"),this._persistencyContainer.classList.add("config-editor-persistency-container"),this._filterActionContainer=e.createElement("div"),this._filterActionContainer.classList.add("config-editor-filiter-action"),this._persistencyContainer.appendChild(this._filterActionContainer),this._savePCContainer=e.createElement("div"),this._savePCContainer.classList.add("config-editor-save-configuration"),this._persistencyContainer.appendChild(this._savePCContainer),this._cancelPCContainer=e.createElement("div"),this._cancelPCContainer.classList.add("config-editor-cancel-configuration"),this._persistencyContainer.appendChild(this._cancelPCContainer),this._parent3DContent=e.createElement("div"),this._parent3DContent.classList.add("parent3DContent")},B.prototype.inject=function(e){e.appendChild(this._container)},B.prototype._subscribeToEvents=function(){var i=this;this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-model-refresh"},function(){i._refreshIdCardModel()}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"Request3DFromConfigPanel"},function(e){"show"===e.value?(i._privateModelEventsForSplitView.publish({event:"splitview-show-panel",data:"right"}),i._privateModelEventsForSplitView.publish({event:"splitview-set-content-panel",data:{side:"right",content:i._parent3DContent}}),o.set(i._3dViewerContext),i._pc3dPresenter.show()):(o.reset(),i._pc3dPresenter.hide())}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"RequestPCCausingRules"},function(e){i._privateModelEventsForSplitView.publish({event:"splitview-show-panel",data:"right"}),i._privateModelEventsForSplitView.publish({event:"splitview-set-content-panel",data:{side:"right",content:V.render(i.solverKey,e.objectId,i._privateModelEventsForSplitView,e.isConflicting)}})}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"pc-loaded"},function(){var e,n;i.PCPanel1.inject(i._confPanelContainer),i.options.PCContent&&(e=i.options.PCContent.state,n=i.options.PCContent.nlsState),i._parentConfPanel.appendChild(i._persistencyContainer),b.deactivateAll(),i.publishTags(),t.unmask(i._parentConfPanel);var a=i.PCPanel1.getConfigmodel();if(O.checkActionAccess({action:T.EDITDETAILS,type:T.TYPE_PC,state:e,nlsState:n,notify:!1,warning:!0})&&a.getDictionary().features&&0!==a.getDictionary().features.length?!i.isPCLocked(i)&&i.isPCUpdated()&&(y.showWarning({title:F._pc_selection_update_msg_title,message:F._pc_selection_update_msg_message}),i._saveBtn.enable(),i._cancelBtn.enable()):(i._saveBtn.setDisabled(),i._cancelBtn.setDisabled()),a.setModelVersionInfo({modelVersionName:i.modelName,modelVersionRevision:i.modelVersionVersion,modelName:i.modelName}),i._3DEnabled){i._pc3dPresenter=new P;var o={modelId:i._modelId,modelName:i.modelName,updateChannel:i._modelEventsForConfigPanel},s=g.getCurrentProductId(i._pathPCDetail,i.parentID);s&&(o.productId=s),i._pc3dPresenter.init(o),i._pc3dPresenter.inject(i._parent3DContent),i._3dViewerContext=i._pc3dPresenter.viewerContext}}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"pc-changed"},function(){var e=i.PCPanel1.getXMLProductConfigurationDefinition({includeDisplayName:!1}).replace(/\bSelectedBy="User"|\bSelectedBy="Rule"|\bSelectedBy="Default"/g,"");i._modelEventsForConfigPanel.publish({event:"pc-3d-filter",data:{filterXML:e,modelID:i._modelId}});var t=i.isPCUpdated(),n=i.isPCLocked(i);i._readyToNavigate(!t),!n&&t&&(i._saveBtn.enable(),i._cancelBtn.enable())}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"pc-3d-prodct-on-select"},function(e){g.setCurrentProductId(i._pathPCDetail,i.parentID,e)}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"solver-call-error"},function(e){i._notificationErrorSolverManagement(e)}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"pc-3d-on-remove-all"},function(){g.setCurrentProductId(i._pathPCDetail,i.parentID,"")}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"pc-3d-on-hide-action"},function(){i._privateModelEventsForSplitView.publish({event:"splitview-hide-panel",data:"right"}),i._modelEventsForConfigPanel.publish({event:"deactivate-3dbutton"})}),this._myEventManager.subscribe(this._privateModelEventsForSplitView,{event:"splitview-size-changed"},function(e){e&&g.updateSplitViewWidth(i._pathPCDetail,e)}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"OnSearchResult"},function(e){var t=i.convertToSearch(i.PCPanel1.getConfigmodel().getDictionary().features);i.WildcardSearch.search(e.searchValue[0],t,function(e){i._modelEventsForConfigPanel.publish({event:"applyVariantListFilters",data:{filterType:"CSearchFilter",filterValues:i.getFilterData(e)}})},["id"])}),this._myEventManager.subscribe(this._modelEventsForConfigPanel,{event:"pc-open-action"},function(t){e.log(i);var n={id:t.id,name:t.name,version:t.version,modelVersionId:i.options.parentID,modelVersionName:i.options.modelVersionName,modelVersion:i.options.modelVersionVersion,modelName:i.modelName};!i.isPCLocked(i)&&i.isPCUpdated()?i.showSaveWarning({title:F._pc_save_warning_popup_title,content:F._pc_save_warning_popup_content}).then(e=>{if(e){var t=i.PCPanel1.getConfigmodel();i.saveConfigurations(t)}p.navigate(_.ROUTE_MODEL_PC_DETAILS,n,{reload:!0})},()=>{}):p.navigate(_.ROUTE_MODEL_PC_DETAILS,n,{reload:!0})}),this._myEventManager.subscribe(this._applicationChannel,{event:"search-in-current-dashboard"},function(e){var t=i.convertToSearch(i.PCPanel1.getConfigmodel().getDictionary().features);i.WildcardSearch.search(e,t,function(e){i._modelEventsForConfigPanel.publish({event:"applyVariantListFilters",data:{filterType:"GSearchFilter",filterValues:i.getFilterData(e)}})},["id"])}),this._myEventManager.subscribe(this._applicationChannel,{event:"browser-back-button-clicked"},function(e){"function"==typeof p.canNavigate&&(p.canNavigate()||i._saveWarningVisible||(e.state.isBackClicked=!0,i._applicationChannel.publish({event:"warning-dialog-create",data:e.state})))}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-create"},function(e){!i.isPCLocked(i)&&i.isPCUpdated()?(i._navigationData=e,i.showSaveWarning().then(e=>{if(e){var t=i.PCPanel1.getConfigmodel();i.saveConfigurations(t)}else i._readyToNavigate(!0)},()=>{i._navigationData=null})):(i._navigationData=null,i._readyToNavigate(!0))}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-on-show"},function(){i._saveWarningVisible=!0}),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-on-hide"},function(){i._saveWarningVisible=!1}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-dropdown-menu-action"},function(e){i.actionDropDownMenuIdCard(e)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-minified"},function(){g.updateCollapse(i._pathPCDetail,!0)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-maximized"},function(){g.updateCollapse(i._pathPCDetail,!1)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"enox-dialog-delete"},function(e){Array.isArray(e)&&i.deletePC(i.options.parentID,e)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-open-version-explorer"},function(){i.versionExplorer&&i.versionExplorer.showVersionExplorer()})},B.prototype.isPCUpdated=function(){var t=this.PCPanel1.getConfigmodel();if(t.getSelectionMode()!==this.PCContent.selectionMode)return!0;var i=t.getSelectedOptionsJSONModel(!0),n=this.PCContent.configurationCriteria;if(n.length!==i.length||this.PCContent.rulesActivation!==t.getRulesActivation()||"true"===this.PCContent.rulesActivation&&this.PCContent.rulesMode!==t.getRulesMode())return!0;for(var a=0;a<n.length;a++)if(!e.Json.path(i,'$[*][?(@.Id =="'+n[a].Id+'" &&  ((@.State && @.State =="'+n[a].State+'") || (@.Value && Number(@.Value.split(" ")[0]) =="'+n[a].NumericalValue+'")) )]'))return!0;return!1},B.prototype.isPCLocked=function(e){let t=g.userID;return 1==e.PCContent.member.length&&"TRUE"===e.PCContent.member[0].reserved&&t!=e.PCContent.member[0].reservedby},B.prototype.showSaveWarning=function(t){var n=this._applicationChannel||new i;return new e.Promise(function(i,a){n.subscribeOnce({event:"warning-dialog-save-button-clicked"},function(){i(!0)}),n.subscribeOnce({event:"warning-dialog-dontsave-button-clicked"},function(){i(!1)}),n.subscribeOnce({event:"warning-dialog-cancel-button-clicked"},function(){a()}),n.subscribeOnce({event:"warning-dialog-on-hide"},function(){a()}),t=t||{},e.merge(t,{modelEvent:n,title:L._modal_title,content:L._modal_message}),w.dialogCreation(t)})},B.prototype._readyToNavigate=function(e){this._updateChannel.publish({event:"update-ready-to-navigation-flag",data:e}),this._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:e}),e&&this._navigationData&&(this._navigationData.linkID?this._applicationChannel.publish({event:"breadcrumb-link-clicked",data:this._navigationData}):this._navigationData.isBackClicked&&window.history.back(),this._navigationData=null)},B.prototype.actionDropDownMenuIdCard=function(e){switch(e){case"information":C.removeAllSelection(),C.showInformation(this._id);break;case"delete":if(O.checkActionAccess({action:T.DELETE,type:T.TYPE_PC,notify:!0})){var t=[{id:this.options.id,title:this.options.name}];this.createDeleteModelDialog(t,this._privateModelEvents)}break;case"owner":O.checkActionAccess({action:T.MOVE,type:T.TYPE_PC,notify:!0})&&this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:{id:this.options.id,name:this.options.name},linkId:"owner"}});break;case"state":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:{id:this.options.id,name:this.options.name},linkId:e}});break;case"revision":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this.options,linkId:"revision"}})}},B.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:U._configurationSingle,multiple:U._configurationMultiple,modelEvent:t,immersiveFrame:A.getImmersiveFrame()};I.showDialog(i)},B.prototype.deletePC=function(t,i){var n=this;r.deleteConfigurationVersions({parentId:t,ids:i}).then(function(){e.log("Product Configuration/s deleted successfully."),p.navigate(_.ROUTE_MODEL_DETAILS,{modelVersionId:n.options.parentID,id:n.options.parentID,name:n.options.modelVersionName,version:n.options.modelVersionVersion,refreshPCList:!0},{replace:!0}),n._applicationChannel.publish({event:"breadcrumb-remove-link",data:_.ROUTE_MODEL_PC_DETAILS}),n._applicationChannel.publish({event:"enox-model-app-item-removed",data:i})},function(t){e.log("Error! Product Configuration deletion failed!!"),x.showError({action:T.REMOVE,type:T.TYPE_PC,message:t})||y.showError(F.ERROR_DELETE_PC)})},B.prototype._loadData=function(t){if(null==t)return;let i=g.userID,n="TRUE"===t.member[0].reserved&&i!=t.member[0].reservedby,a=t.member[0].reservedbyFullName;n&&y.showWarning(e.String.format(k.LOCKED_INFO_ALERT,a)),this._loadIDCard(t),this._3DEnabled=!0,this._loadConfigurator(t),this._loadSplitView(t)},B.prototype._loadIDCard=function(e){this._modelForIdCard=h.prepareIdCardData(e,this._privateModelEvents),this._idCardAttrbEditorUtil.setModelAndInitCollabObj(this._modelForIdCard),this._enoxIDCardContainer.init({},this._modelForIdCard),this._enoxIDCardContainer.inject(this._container),this._enoxIDCardContainer.getMainContent().appendChild(this._contentBottom),g.getCollapse(this._pathPCDetail)&&this._privateModelEvents.publish({event:"idcard-toggle-minified-view"});var t=this._enoxIDCardContainer.getIDCard();if(t){var i=t.getElement(".version");i&&(this.versionExplorer=new R({id:this.id,name:this.name,target:i,renderTo:this._container,modelEvents:this._privateModelEvents,applicationChannel:this._applicationChannel}))}},B.prototype._refreshIdCardModel=function(){var t=this;r.getConfigurationDetails({id:t.id,parentID:this.parentID}).then(function(i){if(t._isDestroyed)X&&e.log("Configuration Details destroyed before being loaded");else{var n=h.prepareIdCardData(i,t._privateModelEvents);t._modelForIdCard.set("attributes",n.get("attributes")),t._modelForIdCard.set("name",n.get("name")),t._modelForIdCard.set("version",n.get("revision")),t._modelForIdCard.set("freezones",n.get("freezones"))}},function(){e.log("getConfigurationDetails: Service Call Failed !!!")})},B.prototype._loadSplitView=function(){var e=g.getSplitViewWidth(this._pathPCDetail);e||(e=27);var t={modelEvents:this._privateModelEventsForSplitView,withtransition:!0,withoverflowhidden:!1,rightMaximizer:!1,leftMaximizer:!1,params:{leftWidth:e,leftVisible:!0,rightVisible:!1}},i=new l;i.init(t),this._contentBottom.appendChild(i.getContent()),this._privateModelEventsForSplitView.publish({event:"splitview-set-content-panel",data:{side:"left",content:this._parentConfPanel}})},B.prototype._loadConfigurator=function(){t.mask(this._parentConfPanel);var i=this;i.options.PCContent&&i.options.PCContent.state,this.configuratorVersion=_.PC_COMPLETEMODE_ENABLED?"V5":"V4",this._saveBtn=new S({value:F.SaveButtonLabel,className:"primary",disabled:!0}).inject(this._savePCContainer),this._cancelBtn=new S({value:F.ResetButtonLabel,disabled:!0}).inject(this._cancelPCContainer),this._filterActionCheck=new D({type:"checkbox",label:F.filter150Label,checkFlag:"selectionMode_Refine"===i.options.PCContent.selectionMode,tooltipInfos:{title:F.filter150TooltipTitle,shortHelp:F.filter150TooltipHelp}}).inject(this._filterActionContainer),this._saveBtn.addEvent("onClick",function(){this.setFocus(!1);var e=i.PCPanel1.getConfigmodel();"RulesMode_SelectCompleteConfiguration"===e.getAppRulesParam().rulesMode?d.displayNotification({eventID:"warning",msg:F._pc_complete_mode_warning_message,action:{label:F._ok,callback:function(t){i.saveConfigurations(e),t&&d.removeNotification(t)}}}):i.saveConfigurations(e)}),this._cancelBtn.addEvent("onClick",function(){t.mask(i._parentConfPanel),i.fetchData({reset:!0}),this.setFocus(!1),y.showSuccess(F._pc_restore_success_message),t.unmask(i._parentConfPanel)}),this._filterActionCheck.addEventListener("change",function(){var e=!0===this.dsModel.checkFlag?"selectionMode_Refine":"selectionMode_Build";i.PCPanel1.getConfigmodel().setSelectionMode(e)}),(e.is(_.PCSAVEDREFINE_ENABLED)?Promise.resolve({status:_.PCSAVEDREFINE_ENABLED}):M.isPCSavedRefineEnabled()).then(function(e){_.PCSAVEDREFINE_ENABLED=e.status,i._initConfigurator()})},B.prototype.fetchData=function(i){var n=this;t.mask(this._container);var a=new Promise((t,i)=>{r.getConfigurationDetails({id:this.id,parentID:this.parentID}).then(function(i){n.PCContent?n.PCContent=e.merge(n.PCContent,i):n.PCContent=i,n.PCContent.name=i.member[0].name,n.PCContent.revision=i.member[0].revision,n.PCContent.image=i.member[0].image,n.PCContent.state=i.member[0].state,n.PCContent.nlsState="",i.member[0].nlsValues&&i.member[0].nlsValues.nlsState&&(n.PCContent.nlsState=i.member[0].nlsValues.nlsState),n._isPCInactive="Inactive"===i.member[0].state,n._modelId=i.member[0].modelID,n.PCContent.completenessStatus=i.member[0].completenessStatus,n.PCContent.rulesActivation="TRUE"===i.member[0].evalRules?"true":"false";var a=i.member[0].evalMode;n.PCContent.rulesMode="CompleteConfiguration"===a?"RulesMode_SelectCompleteConfiguration":"Dependencies"===a?"RulesMode_EnforceRequiredOptions":"RulesMode_DisableIncompatibleOptions",n.PCContent.selectionMode="Build"===i.member[0].selectMode?"selectionMode_Build":"selectionMode_Refine",i.member[0].hasOwnProperty("baseConfigurationId")?(n._bcId=i.member[0].baseConfigurationId,n._bcTitle=i.member[0].baseConfigurationTitle,N.isBaseConfigurationAdded(n._bcId,n.solverKey)||r.getConfigurationDetailsBC({id:n._bcId,parentID:n.modelVersionId}).then(e=>{if(e.member&&e.member[0]){for(var i=e.member[0].selectedCriteria.member,a=[],o=0;o<i.length;o++)a.push({Id:i[o].id,State:n.convertBCStatusToPCStatus(i[o].status)}),0===n.PCContent.configurationCriteria.length&&("Selected"!==i[o].status&&"Default"!==i[o].status||n.PCContent.configurationCriteria.push({Id:i[o].id,State:n.convertBCStatusToPCStatus(i[o].status)}));n.PCContent.bcSelectedCriteria=a}N.addBaseConfigurations(e,n.solverKey,!0).then(()=>{t()})})):t()},function(t){e.log("Failed to retrieve PC Details : "+t),i(new Error("Failed to retrieve PC Details"))})}),o=new Promise((t,i)=>{r.getCriteriaConfigurationInstances({id:n.id,filterRejected:!1}).then(function(i){var a=[];if(i.member&&e.is(i.member,"array")){var o=i.member;i.member=j;for(var s=0;s<o.length;s++){var r={Id:o[s].id,State:o[s].status};o[s].value&&(r.NumericalValue=Number(o[s].value.split(" ")[0])),a.push(r)}}n.PCContent?n.PCContent.configurationCriteria=a:n.PCContent={configurationCriteria:a},t()},function(t){e.log("Failed to retrieve PC selections : "+t),i(new Error("Failed to retrieve PC selections"))})});Promise.all([a,o]).then(()=>{i&&i.reset?n.PCPanel1.resetProductConfiguration(n.PCContent):n._loadData(n.PCContent)}).finally(()=>{t.unmask(n._container)})},B.prototype._initConfigurator=function(){this.variabilityDictionary&&this.variabilityDictionary.portfolioClasses&&(this.variabilityDictionary.portfolioClasses.member[0].attributes._mandatory=!0,this.variabilityDictionary.portfolioClasses.member[0].portfolioComponents.member[0].attributes._mandatory=!0),_.PCSAVEDREFINE_ENABLED||this._filterActionContainer.hide();var e=_.PC_COMPLETEMODE_ENABLED,t={version:this.configuratorVersion,mvId:this.options.parentID,pCId:this.id,bcId:this._bcId,bcSelectedCriteria:this.PCContent.bcSelectedCriteria?this.PCContent.bcSelectedCriteria:[],add3DButton:this._isPCInactive||!this._3DEnabled?"no":"yes",enableExcludeSelection:_.PCSAVEDREFINE_ENABLED,initalOptions:{initialRuleLevel:this.PCContent.rulesMode,initialMode:this.PCContent.selectionMode,completenessStatus:this.PCContent.completenessStatus},rulesActivation:this.PCContent.rulesActivation,ruleLevels:{RulesMode_ProposeOptimizedConfiguration:!1,RulesMode_SelectCompleteConfiguration:e,RulesMode_EnforceRequiredOptions:!0,RulesMode_DisableIncompatibleOptions:!0},enableValidation:!0,tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",securityContext:window.widget.getValue("xPref_CREDENTIAL")?window.widget.getValue("xPref_CREDENTIAL"):"",enableTableView:!0,useDefaultSearch:!1,appID:"ENXMODL_AP",displayErrorSolverNotification:!1,solverKey:this.solverKey};e&&(t.manageDefaultVersion="V2"),this.PCPanel1=new c(this.PCContent.configurationCriteria,this.variabilityDictionary,this._modelEventsForConfigPanel,t)},B.prototype.saveConfigurations=function(i){var n=this;n._parentConfPanel.style.opacity="0.5",t.mask(n._contentBottom);var a=i.getAppRulesParam();"No rule applied"===a.rulesMode&&(a.rulesMode="RulesMode_EnforceRequiredOptions");var o={name:this.name,description:this.PCContent.member[0].description,purpose:"Evaluation",listPrice:i._totalPrice};e.merge(o,a);var s={parentID:n.options.parentID,objectID:n.id,instances:i.getSelectedOptionsJSONModel(),attributes:o};r.updateProductConfiguration(s).then(function(){y.showSuccess(F._pc_save_success_message),n._parentConfPanel.style.opacity="1",t.unmask(n._contentBottom),n.PCContent.configurationCriteria=i.getSelectedOptionsJSONModel(!0),n._readyToNavigate(!0)},function(e){x.showError({action:T.SAVE,type:T.TYPE_PC,message:e})||y.showError(F._pc_save_failure_message),n._parentConfPanel.style.opacity="1",t.unmask(n._contentBottom)})},B.prototype.convertBCStatusToPCStatus=function(e){var t="";switch(e){case"Selected":t="Required";break;case"Default":t="Default";break;case"Not Available":t="Incompatible";break;default:t="Unselected"}return t},B.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this._TaggerOnIndexComponent.killTagProxy(this.tagProxyName),this._myEventManager&&(this._myEventManager.cleanup("ProductConfiguration"),this._myEventManager=null),this._bcId&&this.solverKey&&N.removeBaseConfigurations([this._bcId],this.solverKey),this.PCPanel1&&this.PCPanel1.destroy(),this._pc3dPresenter&&this._pc3dPresenter.destroy(),C.removeAllSelection("ProductConfiguration")},B.prototype.convertToSearch=function(e){var t=[],i=this;return e.forEach(function(e){var n={};if(n.id=e.ruleId,"V4"===i.configuratorVersion||"V5"===i.configuratorVersion?n["Display Name"]=e.displayName:n["Display Name"]=e.attributes["Display Name"],t.push(n),e.options&&e.options.length>0)for(var a=0;a<e.options.length;a++){var o={};o.id=e.options[a].ruleId,o["Display Name"]=e.options[a].displayName,t.push(o)}}),t},B.prototype.getFilterData=function(e){for(var t=[],i=0;i<e.length;i++)e[i].id&&t.push(e[i].id);return t},B.prototype._initTagger=function(e){var t=this,i={onTagFilterChange:function(e){t.applyTagsFilter(e.content)},MyFriends:this.tagFriends};this._TaggerOnIndexComponent.setTagProxy(this.tagProxyName,i,e)},B.prototype.publishTags=function(){var e=[];this.PCPanel1.getConfigmodel().getDictionary().features.forEach(function(t){e.push(t.ruleId)}),this._initTagger(e)},B.prototype.applyTagsFilter=function(e){let t=[];this.PCPanel1.getConfigmodel().getDictionary().features.forEach(function(e){t.push(e.ruleId)});let i=e.ids;e.xIDs.length>0&&0==i.length&&(i=t,e.xIDs.forEach(e=>{let n=t.indexOf(e);i.splice(n,1)}));var n={filterType:"TaggerFilter",filterValues:i};this._modelEventsForConfigPanel.publish({event:"applyVariantListFilters",data:n});let a=Object.keys(b.getTagProxy(this.tagProxyName).getCurrentFilter().allfilters).length>0;this.PCPanel1.myConfigEditor.configuratorToolbar._toolbarModelEvent&&this.PCPanel1.myConfigEditor.configuratorToolbar._toolbarModelEvent.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"taggerFilter",flag:a}})},B.prototype._notificationErrorSolverManagement=function(){var e={message:F.SERVICE_OUT,category:"solverError"};y.removeNotificationFromCategory("solverError","error"),y.showError(e)},B}),define("DS/ENOXModelApp/components/Triptych/TriptychWrapper",["DS/ENOXTriptych/js/ENOXTriptych","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","css!DS/ENOXModelApp/components/Triptych/TriptychWrapper.css"],function(e,t){"use strict";var i=function(){};return i.prototype.init=function(i,n){this._left=document.createElement("div"),this._left.classList.add("xmodel-triptych-wrapper"),this._main=document.createElement("div"),this._main.classList.add("xmodel-triptych-wrapper"),this._right=document.createElement("div"),this._right.classList.add("xmodel-triptych-wrapper"),this._applicationChannel=i,this._triptych=new e;var a=window.widget.body.offsetWidth<t.MOBILE_BREAKPOINT?"close":"open",o={left:{resizable:!1,originalSize:t.LEFT_PANEL_SIZE_EXPANDED,originalState:a,overMobile:!0,withClose:!1},right:{resizable:!0,minWidth:250,originalSize:400,originalState:"close",overMobile:!0},borderLeft:!0,container:n,withtransition:!0,modelEvents:this._applicationChannel};this._triptych.init(o,this._left,this._main,this._right)},i.prototype.inject=function(e){this._triptych.inject(e)},i.prototype._getTriptych=function(){return this._triptych},i.prototype.getLeftPanelContainer=function(){return this._left},i.prototype.getLeftPanelContainerTriptych=function(){return this._triptych._leftPanelContent},i.prototype.getRightPanelContainer=function(){return this._right},i.prototype.getMainPanelContainer=function(){return this._main},i}),define("DS/ENOXModelApp/components/DialogCreation/NumericalDialogFields",["UWA/Core","DS/Controls/ComboBox","DS/Controls/SpinBox","DS/ENOXModelApp/xModelApp/xParameter","text!DS/CfgAutoCompleteComponent/assets/NumericalParameterConstants.json","i18n!DS/xDimensionManager/assets/nls/xUnitLabelLong","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/NumericalDialogFields","i18n!DS/xDimensionManager/assets/nls/xDimentions","css!DS/ENOXModelApp/components/DialogCreation/DialogCreationV2.css","css!DS/ENOXModelApp/components/DialogCreation/NumericalDialogFields.css"],function(e,t,i,n,a,o,s,r){"use strict";const l=JSON.parse(a);var d,c,p,u,h={};return h._getFieldHtml=function(t,i=!0){return[e.createElement("label",{class:"form-label",html:t.label+(i?'<span class="label-field-required"> *</span>':"")}),e.createElement("div",{class:"form-input numerical-dialog-field",html:t.content})]},h.getFields=function(){var a=[{valueItem:"",labelItem:s._noDimensionLabel}],h=n.getDimensions();for(var m in h)h.hasOwnProperty(m)&&a.push({valueItem:m,labelItem:r.get(m)});d=new t({elementsList:a,enableSearchFlag:!1});c=new t({placeholder:"",elementsList:[{valueItem:"",labelItem:""}],enableSearchFlag:!1,className:"unit-input-select"}),p=new i({value:0,minValue:0,maxValue:l.numberMaxValue-1,decimals:0,stepValue:1,typingFilter:!0,highExponentProperty:20}),u=new i({value:l.numberMaxValue,minValue:1,maxValue:l.numberMaxValue,decimals:0,stepValue:1,typingFilter:!0,highExponentProperty:20});var _,v,f={dimension:{label:s._dimensionLabel,content:d},unit:{label:s._unitLabel,content:c},minAndMaxValues:[{label:s._minValueLabel,content:p},{label:s._maxValueLabel,content:u}]},g=[];for(var b in f)if(f.hasOwnProperty(b)){if(Array.isArray(f[b])){for(var E,C=[],y=0;y<f[b].length;y++)E=y===f[b].length-1,C.push(e.createElement("div",{class:E?"lastchild":"child",html:[this._getFieldHtml(f[b][y])]}));_=e.createElement("div",{class:"form-group parent",html:C})}else _=e.createElement("div",{class:"form-group",html:[this._getFieldHtml(f[b])]}),f[b].label===s._unitLabel&&(v=_).hide();g.push(_)}return d.addEventListener("change",function(e){var t=e.dsModel;if(f.dimension=t.value,t.value&&""!==t.value){v.show();var i=[];if(h.hasOwnProperty(t.value)){var n=h[t.value];if(n)for(var a in n)n.hasOwnProperty(a)&&i.push({valueItem:a,labelItem:o.get(a)})}c.elementsList=i}else c.value="",c.elementsList=[],v.hide()}),p.addEventListener("endEdit",function(){u.minValue=p.value+1}),g},h.getInputValues=function(){return{dimension:d.value,unit:c.value,minValue:p.value.toString(),maxValue:u.value.toString()}},h}),define("DS/ENOXModelApp/components/DialogCreation/DialogCreationV2",["UWA/Core","UWA/Class/View","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/ENOXDataDragAndDrop/js/ENOXDataDragAndDrop","DS/Controls/Button","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/components/DialogCreation/NumericalDialogFields","DS/WUXAutoComplete/AutoComplete","DS/ENOXModelApp/components/ContextSelector/AutocompleteManager","i18n!DS/ENOXModelApp/assets/nls/components/DialogCreation/DialogCreation","css!DS/ENOXModelApp/components/DialogCreation/DialogCreationV2.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u){"use strict";return{createViewPatch:t.extend({className:"dialog-creation",render:function(){var t=e.createElement("div"),n=e.createElement("label");n.style.color="#3d3d3d",n.setContent(u.image);var l=this;this.imageFileInput=void 0;var c=[{type:"text",label:u.title,name:"title",placeholder:u.emptyField,errorText:u.titleMandatory,required:!0}];if(this.options.typeSelection&&c.push({type:"select",label:u.TYPE,required:!0,name:"type",options:this.options.availableTypes}),this.options.edit_revision){var p=void 0!==this.options.revisionStartsAt?this.options.revisionStartsAt:"A";c.push({type:"text",label:u.revision,placeholder:p||u.emptyField,value:p,name:"revision",errorText:u.revisionMandatory,required:!0})}if(this.options.deriveFromFieldOptions){var h=this.options.deriveFromFieldOptions;c.push({type:"autocomplete",id:"inputDerivedFrom",label:h.label,disabled:!1,placeholder:h.placeHolder,name:"deriveFrom",errorText:this.options.deriveFromFieldOptions.errorText,required:!0}),c[0].value=h.initialValue?h.initialValue.title:""}c.push({type:"text",label:u.description,name:"description",rows:4,placeholder:u.emptyDescription,multiline:!0});let m=l.options.fields;if(m&&Array.isArray(m)&&m.length>0&&m.forEach(function(t){let i=t.position;i&&e.is(i,"number")&&i>0&&i<=c.length?c.splice(i-1,0,t):c.push(t)}),this.options.fieldOrder&&e.is(this.options.fieldOrder,"array")){var _=c.length-1;c.sort((e,t)=>{return(this.options.fieldOrder.indexOf(e.name)>-1?this.options.fieldOrder.indexOf(e.name):_)-(this.options.fieldOrder.indexOf(t.name)>-1?this.options.fieldOrder.indexOf(t.name):_)})}if(this.formContent=new i({className:"vertical",fields:c}),this.options.isNewNumerical){var v=d.getFields(this.dimensionsForNumericalParameter),f=this.formContent.getField("description").getParent();this.formContent.elements.container.removeChild(f);for(var g=0;g<v.length;g++)this.formContent.elements.container.append(v[g]);this.formContent.elements.container.append(f)}this._fileInputDiv=e.createElement("div",{class:"file-input-container"}),this._dataDragAndDropModelevent=new a,this._dragdropInstance=new o({droppableAreas:[this._fileInputDiv],modelEvents:this._dataDragAndDropModelevent}),this._dndToken=this._dataDragAndDropModelevent.subscribe({event:"onDrop"},function(e){var t=e.data;if(t&&t.data&&1===t.data.length){var i=t.data[0];i.type.contains("image")&&l.setImageFile(i)}});var b=new s({label:u._uploadButtonLabel});this._previewDiv=e.createElement("div",{class:"file-preview-container hidden"}),this.previewImage=e.createElement("div",{class:"file-preview-image",height:"150px"}),this._imageRemoveButton=new s({label:u._uploadButtonLabel,showLabelFlag:!1,displayStyle:"lite",icon:{iconName:"clear",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}),this._imageRemoveButton.getContent().addEventListener("buttonclick",function(){l.uploadFileField.value="",l.imageFileInput=void 0,l._previewDiv.addClassName("hidden"),l._fileInputDiv.getElement(".empty-content").removeClassName("hidden")}),this._imageRemoveButton.getContent().addClassName("file-remove-button"),this._imageRemoveButton.inject(this.previewImage),this.previewImage.inject(this._previewDiv),this.uploadFileField=e.createElement("input",{name:"image",type:"file",events:{change:function(){if(l.uploadFileField.files[0]){var e=l.uploadFileField.files[0];l.setImageFile(e)}}}}),b.getContent().addEventListener("buttonclick",function(){l.uploadFileField.click()});var E={sentences:[{type:"icon",fonticon:"drag-drop",sizeicon:"30px",text:u._dropMessage},{type:"dom",DOMelement:b.getContent()}]};return this._ENOXEmptyContent=new r(E),this._ENOXEmptyContent.inject(this._fileInputDiv),this._previewDiv.inject(this._fileInputDiv),this.formContent.inject(t),n.inject(t),this._fileInputDiv.inject(t),this.container.setContent(t),this},setImageFile:function(e){var t=this;this.imageFileInput=e;const i=new FileReader;i.addEventListener("load",function(){t.previewImage.setStyle("backgroundImage",'url("'+i.result+'")'),t._previewDiv.removeClassName("hidden"),t._fileInputDiv.getElement(".empty-content").addClassName("hidden")},!1),e&&i.readAsDataURL(e)},destroy:function(){this._dataDragAndDropModelevent.destroy(),this._parent.apply(this,arguments)}}),createRevisionView:t.extend({className:"dialog-creation",render:function(){var t=e.createElement("div"),n=[{type:"text",label:u.revision,placeholder:this.options.revisionFieldOptions.placeHolder,name:"revision",errorText:this.options.revisionFieldOptions.revisionFieldMandatory,required:!0,value:""}];return this.formContent=new i({className:"vertical",fields:n}),this.formContent.inject(t),this.container.setContent(t),this},destroy:function(){this._parent.apply(this,arguments)}}),_onRequiredFieldChange:function(e){this.validate()?this.modelEvent.publish({event:"enox-dialog-creation-done",data:!0}):this.disableCreateActions(!0),e.focus()},_addAutocomplete:function(e){var t=this.view.formContent.getField(e.name),i=new c({elementsTree:e.model,multiSearchMode:!1});i.id=e.name,this.view.formContent.wuxautocompletes.push(i),t.replaceWith(i.getContent())},show:function(t){var i=this;this.fields=t.fields&&t.fields.length>0?t.fields:void 0,this.privateChannel=new a;var n=this._initAndGetSuperModal(t);this.view=new this.createViewPatch(t);var o=this._getDialogButtonsArr();if(this.view.render(),"webuxAutoComplete"===t.componentType?(this.view.formContent.autocompletes=[],this.view.formContent.wuxautocompletes=[]):this.view.formContent.wuxautocompletes=[],this.options.deriveFromFieldOptions,n.dialog({body:this.view.getContent(),title:t.title,buttons:o}),this.options.deriveFromFieldOptions){var s=this.view.formContent.getAutocompleteInput("deriveFrom");if(s){if(this.options.deriveFromFieldOptions.searchOption)(new p).configureAutocomplete({target:s,searchOption:this.options.deriveFromFieldOptions.searchOption}),s.elements.input.oninput=function(){var e=s.elements.input.value,t=s.getItemByLabel(e);t||i.disableCreateActions(!0),t&&i.modelEvent.publish({event:"enox-dialog-creation-done",data:!0})},s.elements.suggestsContainer.addEventListener("click",function(){i.validate()&&i.modelEvent.publish({event:"enox-dialog-creation-done",data:!0})});if(this.options.deriveFromFieldOptions.initialValue&&this.options.deriveFromFieldOptions.initialValue.id){s.cleanDataset(0);var r=[this.options.deriveFromFieldOptions.initialValue].map(e=>({value:e.id,subLabel:e.owner,image:e.preview_url,id:e.id,label:e.title+(e.revision?" "+e.revision:""),sourceId:"3dspace",revision:e.revision||"",selected:!0}));s.addItems(r,s.getDataset(0)),s.elements.input.oninput()}}}if(i.disableCreateActions(!0),e.is(i.options.fields,"array")){var l=i.options.fields.find(e=>"autocomplete"===e.type);l&&i._addAutocomplete(l)}i.view.formContent.getFields().forEach(function(e){e.required&&e.addEvent("input",function(){i._onRequiredFieldChange(e)})});var d=i.view.formContent.getFields()[0];d&&d.focus(),document.querySelector(".modal-content").addEventListener("keyup",function(e){"Enter"===e.key&&"description"!==e.target.name&&"createAnother_button"!==e.target.id&&(i.validate()&&document.querySelector(".modal-content .modal-footer .btn-primary").click())})},validate:function(){var e=!0;return this.view.formContent.getFields().forEach(function(t){t.required&&""===t.value&&(e=e&&!1)}),e},disableCreateActions:function(e){var t=document.querySelector(".modal-content .modal-footer #createAnother_button"),i=document.querySelector(" .modal-content .modal-footer #create_button");t&&(e||t.setText(u.creating),t.addClassName("disabled")),i&&i.addClassName("disabled")},showRevisionDialog:function(e){var t=this._initAndGetSuperModal(e);this.view=new this.createRevisionView(e);var i=this._getDialogButtonsArr();this.view.render(),t.dialog({body:this.view.getContent(),title:e.title,buttons:i})},_initAndGetSuperModal:function(e){var t=this;return this.options=e,this._id=e.id,this._context=e.context,this._withCreateAndClose=e.withCreateAndClose,this.modelEvent=e.modelEvent,new n({renderTo:document.body,events:{onShow:function(){t.modelEvent.publish({event:"enox-dialog-on-show"})},onHide:function(){t.modelEvent.publish({event:"enox-dialog-on-hide"}),[t._dervFrmToken,t._dndToken,t.creation_notify_token].forEach(function(e){e&&t.modelEvent.unsubscribe(e)})}}})},_getDialogButtonsArr:function(){var t=this,i=this.options.createBtnLabel?this.options.createBtnLabel:u.createAnother,n=[{className:t._withCreateAndClose?"default":"primary",id:"createAnother_button",value:i,action:function(i){if(void 0!==t.options.revisionFieldOptions){var n=t.view.formContent.getValue("revision");t.view.formContent.setValue("revision",n.trim())}else{var a=t.view.formContent.getValue("title");if(t.view.formContent.setValue("title",a.trim()),void 0!==t.options.deriveFromFieldOptions){var o=t.view.formContent.getValue("deriveFrom");if(void 0===o||""===o)return void l.showWarning(t.options.deriveFromFieldOptions.errorText)}}t.view.formContent.validate()&&(e.log("event publish : enox-dialog-creation id : "+t._id),t.modelEvent.publish({event:"enox-dialog-creation",data:{content:t.formatContentPatch(t.view.formContent,t.options.isNewNumerical),context:t._context,id:t._id},context:this}),t.disableCreateActions(),t._withCreateAndClose||(t.view.destroy(),i.hide()))}},{className:"default",id:"cancel_button",value:u.cancel,action:function(e){e.hide()}}];return this._withCreateAndClose&&n.push({className:"primary",id:"create_button",value:u.create,action:function(i){var n=t.view.formContent.getValue("title");t.view.formContent.setValue("title",n.trim()),t.view.formContent.validate()&&(e.log("event publish : enox-dialog-creation id : "+t._id),t.modelEvent.publish({event:"enox-dialog-creation",data:{content:t.formatContentPatch(t.view.formContent,t.options.isNewNumerical),context:t._context,id:t._id},context:this}),i.hide())}}),t.creation_notify_token=t.modelEvent.subscribe({event:"enox-dialog-creation-done"},function(e){var i=document.querySelector(".modal-content .modal-footer #createAnother_button"),n=document.querySelector(".modal-content .modal-footer #create_button");i&&(e||i.setText(u.createAnother),i.removeClassName("disabled")),n&&n.removeClassName("disabled");var a=t.view.formContent.getFields()[0];a&&a.focus()}),n},formatContent:function(e){var t=e.getValues();return e.getField("image")&&(t.image=e.getField("image").files[0]),t},formatContentPatch:function(t,i=!1){var n=t.getValues();if(e.is(t.wuxautocompletes,"array")&&t.wuxautocompletes.forEach(e=>{e.value&&(n[e.id]=e.value)}),i){var a=d.getInputValues();""!==a.dimension&&(n.dimension=a.dimension),n.minValue=a.unit?a.minValue+" "+a.unit:a.minValue,n.maxValue=a.unit?a.maxValue+" "+a.unit:a.maxValue}return this.view.imageFileInput&&(n.image=this.view.imageFileInput),n}}}),define("DS/ENOXModelApp/components/zApplicationFrame/zApplicationFrame",["DS/CoreEvents/ModelEvents","DS/Core/Core","DS/ENOXModelApp/components/Triptych/TriptychWrapper","DS/ENOXModelApp/components/ApplicationTopBar/ApplicationTopBarWrapper","DS/ENOXModelApp/components/WelcomePanel/WelcomePanelWrapper","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","css!DS/UIKIT/UIKIT.css","css!DS/ENOXModelApp/components/zApplicationFrame/zApplicationFrame.css"],function(e,t,i,n,a,o,s){"use strict";var r=function(){};return r.prototype._init=function(e,t,i,n){this._applicationChannel=e,this._router=t,this._leftContent=i,this._middleContent=n,this._pathModel=[o._KEY,o._VIEWS_PREFERENCES],this._initDom()},r.prototype._initDom=function(){this._content=document.createElement("div"),this._content.classList.add("z-panel"),this._topbar=document.createElement("div"),this._topbar.classList.add("z-topbar"),this._mainContainer=document.createElement("div"),this._mainContainer.classList.add("z-content"),this._content.appendChild(this._mainContainer),this._pageToolBarComponent=new n,this._pageToolBarComponent.init(this._applicationChannel,this._router,this._topbar),this._triptychWrapper=new i,this._triptychWrapper.init(this._applicationChannel,this._mainContainer),this._middleContainer=document.createElement("div"),this._middleContainer.classList.add("z-content-wrapper"),this._middleContainer.appendChild(this._topbar),this._applicationContent=document.createElement("div"),this._applicationContent.classList.add("xmodel-content-wrapper"),this._middleContainer.appendChild(this._applicationContent),this._middleContent&&this._middleContent._container&&this._applicationContent.appendChild(this._middleContent._container),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"middle",content:this._middleContainer}}),this._subscribeEvents();var e=s.getInfoPanelStatus(this._pathModel),t=s.getInfoPanelWidth(this._pathModel);if("true"===e){var a=this;setTimeout(function(){t&&a._applicationChannel.publish({event:"triptych-set-size",data:{side:"right",size:t}}),a._applicationChannel.publish({event:"information-panel-open"})},1e3)}this.__mobileBreakpoint=this._triptychWrapper._triptych.__mobileBreakpoint},r.prototype._subscribeEvents=function(){this._listSubscription=[];var e=this;e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-show-panel"},function(){e._content.clientWidth<e.__mobileBreakpoint&&(e._topbar.classList.add("hide"),e._mainContainer.classList.add("full-height"))})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-panel-hide-started"},function(){e._content.clientWidth<e.__mobileBreakpoint&&(e._topbar.classList.remove("hide"),e._mainContainer.classList.remove("full-height")),e._applicationChannel.publish({event:"model-conflict-panel-closed"})})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-entering-mobile"},function(){e._topbar.classList.remove("hide"),e._mainContainer.classList.remove("full-height"),e._applicationChannel.publish({event:"triptych-hide-panel",data:"left"})})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-resized"},function(t){if("right"===t.side){var i=t.width;s.updateInfoPanelWidth(e._pathModel,""+i)}})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-leaving-mobile"},function(){e._topbar.classList.remove("hide"),e._mainContainer.classList.remove("full-height")})),e._listSubscription.push(e._applicationChannel.subscribe({event:"welcome-panel-action-selected"},function(){e._content.clientWidth<e.__mobileBreakpoint&&e._applicationChannel.publish({event:"triptych-hide-panel",data:"left"})}))},r.prototype.inject=function(e){e.appendChild(this._content)},r.prototype.destroy=function(){this._content=null},r}),define("DS/ENOXModelApp/ModelDefinition/js/PCListPresenter",["DS/ENOXSplitView/js/ENOXSplitView","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Core","UWA/Element","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/xModelCommand","DS/WebappsUtils/WebappsUtils","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/ENOXModelApp/Utils/CustomAttributesManager","DS/TreeModel/TreeDocument","DS/LifecycleCmd/MessageMediator","DS/Windows/Dialog","DS/TreeModel/TreeNodeModel","DS/Controls/Button","DS/WUXAutoComplete/AutoComplete","DS/ENOXModelApp/components/ProgressPanel/ProgressPanel","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/PCListPresenter","css!DS/ENOXModelApp/ModelDefinition/css/PCList.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x,R,V,N,L){"use strict";const F="Base Configuration";var U=function(){};return U.prototype.init=function(t,n,a){this._isDestroyed=!1,this._pathPC=[f._KEY,f._VIEWS_PREFERENCES,f._MODEL_VERSIONS_DETAILS,f._PRODUCT_CONFIGURATIONS],this._privateChannel=t||new i,this._applicationChannel=n,this._updateChannelLocal=new i,this._myEventManager=new v(this._applicationChannel,this._updateChannelLocal,this._privateChannel),this._id=a.id,this._disable=!a.editable,this._tagActivated=!1,this._modelName=a.modelName,this._modelVersionName=a.modelVersionName,this._modelVersionId=a.modelVersionId,this._modelVersion=a.modelVersion,this._getAllBaseConfigurationPromise=null,this._model=new P({}),this._namePage="ProductConfigurations",c.initialize({applicationChannel:this._applicationChannel,id:this._id,silent:!0}),this._relatedObjectsCmd=new M,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._idBcAvailable=!1,this._listPresenter=null,this._initializeListView();var o={modelEvents:this._privateChannel,withtransition:!0,withoverflowhidden:!1,params:{leftWidth:40,leftVisible:!0,rightVisible:!1,rightMaximizer:!0,leftMaximizer:!0}};this._splitView=new e,this._splitView.init(o),this._initDivs(),this._initCommand(),this._subscribeToEvents();var s=this;A.getCustomAttribute("Product Configuration").then(function(e){if(e&&e.length>0){var t=g.getVisibleColumns(s._pathPC),i=A.getColumnsToAdd(e,t);s._privateChannel.publish({event:"custom-attributes-loading-done",data:i})}},function(){})},U.prototype._initCommand=function(){this._command=new p(this._privateChannel,this._container,this._applicationChannel)},U.prototype._initializeListView=function(){var e,t=this,i=g.getSort(this._pathPC);i&&i.sortAttribute&&i.sortOrder&&(e={id:i.sortAttribute,order:i.sortOrder});var a={id:"productConfigurations",modelEvents:this._privateChannel,useDragAndDrop:!0,model:this._model,childKeys:["prodCs"],defaultNodeDepth:2,asyncContextualMenu:!0,viewOptions:{identifier:"productConfigurations",views:["ThumbnailView","TileView","DataGridView"],currentView:g.getView(this._pathPC),currentSort:e,grid:{columns:[{text:N.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",editableFlag:!0,getCellEditableState:function(e){if(void 0===e.nodeModel)return!1;var t=e.nodeModel.options.grid;return S.checkActionAccess({action:D.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:N.NAME,dataIndex:"name"},{text:N.TYPE,dataIndex:"type",getCellValue:function(e){let t=e.nodeModel.options.grid.nlsValues;return n.is(t.nlsType)?t.nlsType:e.nodeModel.options.grid.type}},{text:N.REVISION,dataIndex:"revision",typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){return{label:e.nodeModel.options.grid.revision,url:"#Revision"}}},{text:N.DESCRIPTION,dataIndex:"description",editableFlag:!0,getCellEditableState:function(e){var t=e.nodeModel.options.grid;return S.checkActionAccess({action:D.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:N.MATURITY_STATE,dataIndex:"state",typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(e.nodeModel.options.grid){var t=e.nodeModel.options.grid;return{label:t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state,url:"#Maturity"}}}},{text:N.LOCK_STATUS,dataIndex:"Lock status",typeRepresentation:"url",hyperlinkTarget:"_self",getCellTooltip:function(e){return _.getTooltipOfLockedStatus(e)},getCellValue:function(e){return _.getIconOfLockStatus(e)}},{text:N.OWNER,dataIndex:"owner",visibleFlag:!0,getCellValue:function(e){return{label:e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:e.nodeModel.options.grid.responsible,url:"#Owner"}},typeRepresentation:"url",hyperlinkTarget:"_self"},{text:N.CREATION_DATE,dataIndex:"created",getCellValue:function(e){if(e.nodeModel.options.grid.created)return _.formatDateAttribute(e.nodeModel.options.grid.created)}},{text:N.MODIFICATION_DATE,dataIndex:"modified",getCellValue:function(e){if(e.nodeModel.options.grid.modified)return _.formatDateAttribute(e.nodeModel.options.grid.modified)}},{text:N.COLLABSPACE,dataIndex:f._COLLABSPACE_TITLE},{text:N.ORGANIZATION,dataIndex:f._ORG_TITLE}]},editable:!0,itemViewMapping:{label:function(e){return e.options.grid.title+" "+e.options.grid.revision},subLabel:function(e){if(e.options.grid){var t=e.options.grid;return(t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state)+" | "+(t.owner?t.owner:t.responsible)}return""},description:"description",customTooltip:function(e){return _.prepareTooltipObjectView(e)},icon:function(e){var t;return t=e.options.grid.type===F?"icon/BaseConfiguration.png":"icon/ProductConfiguration.png",u.getWebappsAssetUrl("ENOXModelApp",t)}},contextualActions:async function(e){let i=[];if(i.push({id:"open",title:L._open,text:L._open,fonticon:"open",multiselect:!1,handler:function(e){e.type===F?h.navigate(m.ROUTE_MODEL_BC_DETAILS,{id:e.id,name:e.title,version:e.revision,modelVersionId:t._modelVersionId,modelVersionName:t._modelVersionName,modelVersion:t._modelVersion,modelName:t._modelName}):h.navigate(m.ROUTE_MODEL_PC_DETAILS,{id:e.id,name:e.title,version:e.revision,modelVersionId:t._modelVersionId,modelVersionName:t._modelVersionName,modelVersion:t._modelVersion,modelName:t._modelName})}}),i.push({type:"SeparatorItem"}),i.push({id:"revise",title:N.REVISE,text:N.REVISE,fonticon:"flow-line-add",handler:function(e,i){t._command._handleNewRevisionCommand(i)}}),i.push({id:"revisionExplorer",title:N.get("REVISION_EXPLORER"),fonticon:"flow-branch-list",multiselect:!1,handler:function(e){t._command._handelRevisionCommand(e)}}),i.push({type:"SeparatorItem"}),i.push({id:"maturityState",title:N.get("MATURITY"),text:N.get("MATURITY"),fonticon:"collaborative-lifecycle-management",handler:function(e,i){t._command._handleMaurityCommand(i)}}),"Product Configuration"===this.options.grid.type&&(i.push({type:"SeparatorItem"}),i.push({id:"changeOwnership",title:N.get("CHANGE_OWNERSHIP"),text:N.get("CHANGE_OWNERSHIP"),fonticon:"move-to",handler:function(e,i){S.checkActionAccess({action:D.MOVE,notify:!0})&&t._command._handleChangeOwnerCommand(i)}})),i.push({type:"SeparatorItem"}),i.push(t._relatedObjectsCmdObj),i.push({id:"information",title:L._information,text:L._information,fonticon:"info",handler:function(){t._applicationChannel.publish({event:"information-panel-open"})}}),i.push({type:"SeparatorItem"}),i.push({id:"delete",title:L._delete,text:L._delete,fonticon:"trash",handler:function(e,i){if(S.checkActionAccess({action:D.DELETE,type:D.TYPE_PC,notify:!0})&&e){var n=i.map(function(e){return{id:e.id,title:e.title,type:e.type}});t.createDeleteModelDialog(n,t._privateChannel)}}}),e){if(!await t._updateChangeBaseConfigAction(i)){let e={id:"changeBaseConfig",title:L.CHANGE_BASE_CONFIG,text:L.CHANGE_BASE_CONFIG,fonticon:"tree-reparent",supportedTypes:["Product Configuration"],handler:function(e){t._handleChangeBaseConfigurationRevision(e)}};i.splice(2,0,e)}}let n=this._disable;return _.showContextualActions(t._model.getSelectedNodes(),i,n,t)}},emptyContentOptions:{sentences:[{type:"img",src:u.getWebappsAssetUrl("ENOXModelApp","icon/ProductConfiguration.png"),text:N.EMPTY_CONTENT_MESSAGE}]},withmultisel:!0,toolbarOptions:{itemsName:L._multiple_configuration,itemName:L._single_configuration,withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,hideOnMultiSelection:["open","revisionExplorer"],actions:[{id:"create",text:L._create,fonticon:"plus",visibility:this._disable,content:l},{id:"open",title:L._open,text:L._open,fonticon:"open",showOnSelection:!0,category:"open",handler:function(){let e=t._listPresenter._getSelectedItem();if(e.length>1)return;let i=e[0];n.log("item clicked"),i.type===F?h.navigate(m.ROUTE_MODEL_BC_DETAILS,{id:i.id,name:i.title,version:i.revision,modelVersionId:t._modelVersionId,modelVersionName:t._modelVersionName,modelVersion:t._modelVersion,modelName:t._modelName}):h.navigate(m.ROUTE_MODEL_PC_DETAILS,{id:i.id,name:i.title,version:i.revision,modelVersionId:t._modelVersionId,modelVersionName:t._modelVersionName,modelVersion:t._modelVersion,modelName:t._modelName})}},{id:"preview",text:L._preview,fonticon:"eye",allowSelectRetain:!1,selected:!1,showOnSelection:!0,category:"view",handler:function(e,i,n){let a=n.selected;t._privateChannel.publish({event:"on-preview",data:{activated:a}}),a?t._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{text:L._hidePreview,id:"preview"}}):t._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{text:L._preview,id:"preview"}})}},{id:"changeBaseConfiguration",text:L.CHANGE_BASE_CONFIG,fonticon:"tree-reparent",visibleFlag:!1,category:"edit",handler:function(){t._handleChangeBaseConfigurationRevision()}},{id:"lock",text:N.LOCK,fonticon:"lock",visibleFlag:!1,category:"lifecycle",handler:function(e){_.handleReservedCmd(t._privateChannel,t._listPresenter._getSelectedItem(),t._command)}},{id:"unlock",text:N.UNLOCK,fonticon:"lock-open",visibleFlag:!1,category:"lifecycle",handler:function(e){_.handleUnReservedCmd(t._privateChannel,t._listPresenter._getSelectedItem(),t._command)}},{id:"revise",title:N.get("REVISE"),text:N.get("REVISE"),fonticon:"flow-line-add",category:"lifecycle",showOnSelection:!0,handler:function(){let e=t._listPresenter._getSelectedItem();t._command._handleNewRevisionCommand(e[0])}},{id:"revisionExplorer",title:N.get("REVISION_EXPLORER"),text:N.get("REVISION_EXPLORER"),fonticon:"flow-branch-list",category:"lifecycle",showOnSelection:!0,handler:function(){let e=t._listPresenter._getSelectedItem();t._command._handelRevisionCommand(e[0])}},{id:"maturityState",title:N.get("MATURITY"),text:N.get("MATURITY"),fonticon:"collaborative-lifecycle-management",showOnSelection:!0,category:"lifecycle",handler:function(){let e=t._listPresenter._getSelectedItem();t._command._handleMaurityCommand(e)}},{id:"changeOwnership",title:N.get("CHANGE_OWNERSHIP"),text:N.get("CHANGE_OWNERSHIP"),showOnSelection:!0,fonticon:"move-to",category:"collaboration",handler:function(){let e=t._listPresenter._getSelectedItem();S.checkActionAccess({action:D.MOVE,notify:!0})&&t._command._handleChangeOwnerCommand(e)}},t._relatedObjectsCmdObj,{id:"delete",text:L._delete,fonticon:"trash",category:"destructive",visibility:this._disable,showOnSelection:!this._disable,handler:function(e){if(n.log("delete action.."),S.checkActionAccess({action:D.DELETE,type:D.TYPE_PC,notify:!0})){var i=e.map(function(e){return{id:e.id,title:e.label}});t.createDeleteModelDialog(i,t._privateChannel)}}}]},extensions:[s,r]},l=[];l.push({id:"create_baseConfig",text:L._base_configuration,selectable:!1,handler:function(){n.log("Create Action handler."),S.checkActionAccess({action:D.CREATE,type:D.TYPE_BASECONFIG,notify:!0})&&t.createCreationModelDialog(t._privateChannel,D.TYPE_BASECONFIG,L._newBaseConfig)}},{id:"create_pc",text:L._productConfigurationSingle,selectable:!1,handler:function(){n.log("Create Action handler."),S.checkActionAccess({action:D.CREATE,type:D.TYPE_PC,notify:!0})&&t.createCreationModelDialog(t._privateChannel,D.TYPE_PC,L.newProductConfig)}},{id:"carryOver",text:L._addExistingFrom,selectable:!1,handler:function(){t._applicationChannel.publish({event:"mvcopy-launch-copy-from-dialog",data:"configurations"})}}),a.toolbarOptions.actions[0]={id:"create",text:L._create,fonticon:"plus",visibility:this._disable,content:l},this._listPresenter=new o(a)},U.prototype._handleChangeBaseConfigurationRevision=async function(){var e=this;let t=e._listPresenter._getSelectedItem();if(t){let n=1==t.length?t[0].title+" "+t[0].revision:t.length+" objects",a=L.CHANGE_BASE_CONFIG+" - "+n,o=await e._createChangeBaseConfigContent(t);var i=new O({title:a,content:o,activeFlag:!1,modalFlag:!0,buttons:{No:new x({label:N.CANCEL,onClick:function(e){i.close()}}),Yes:new x({label:N.CHANGE,onClick:function(t){let a=e._chgBaseConfigAutoCmplt.getValueToCommit();e._privateChannel.publish({event:"enox-dialog-change-base-config",data:{processTitle:a,progressHeading:L.CHANGE_BASE_CONFIG,itemTitle:n}}),i.close()}})}})}else n.log("_handleChangeBaseConfigurationRevision : Invalid model...")},U.prototype._createChangeBaseConfigContent=async function(e){this._chgBaseConfigContainer=n.createElement("div",{class:"change-base-config"});let t=new n.createElement("div",{class:"base-config-heading"}),i=new n.createElement("div",{class:"base-config-auto-complete"});t.innerText=L._base_configuration,t.inject(this._chgBaseConfigContainer),i.inject(this._chgBaseConfigContainer);let a=await this._getAllBaseConfigurationPromise,o=[],s=[];e.forEach(e=>{s.includes(e.baseConfigurationId)||s.push(e.baseConfigurationId)}),a&&a.member[0].hasOwnProperty("baseConfigurations")&&a.member[0].baseConfigurations.member.forEach(e=>{o.push(e.id)});let r=new P;return r.prepareUpdate(),this._BCRevisions.graphs[0].versions.forEach(e=>{if(o.includes(e.id)&&(s.length>1||1==s.length&&s[0]!=e.id)){var t=new T({label:e["Marketing Name"]+" "+e.revision,value:e.id});r.addRoot(t)}}),r.pushUpdate(),this._chgBaseConfigAutoCmplt=new R({elementsTree:r,multiSearchMode:!1}).inject(i),this._chgBaseConfigContainer},U.prototype._updateChangeBaseConfigAction=async function(){let e,t=this,i=t._listPresenter._getSelectedItem(),n=!1,a=!0;if(i.forEach(t=>{t.baseConfigurationId?e||n||(e=t.baseConfigurationId):n=!0}),!n&&i.length>0&&e)try{let i=!1;t._BCRevisions=void 0;let n=[],o=!1;await new Promise(async function(n){setTimeout(function(){null==t._BCRevisions&&(i=!0,n())},3e3),t._BCRevisions=await l.getVersionGraph({graphRequests:[{id:e,attributes:["Marketing Name"]}]}),o=!0,n()}),(i?[]:t._BCRevisions.graphs[0].versions).forEach(e=>{n.push(e.id)}),a=!await t._checkBCFromSameMVRev(n)}catch(e){a=!0}return a?t._privateChannel.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"changeBaseConfiguration",flag:!1}}):t._privateChannel.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"changeBaseConfiguration",flag:!0}}),a},U.prototype._checkBCFromSameMVRev=async function(e){if(Array.isArray(e)&&e.length<2)return!1;let t=this._listPresenter._getSelectedItem(),i=[],n=await this._getAllBaseConfigurationPromise,a=[];n.member[0].hasOwnProperty("baseConfigurations")&&n.member[0].baseConfigurations.member.forEach(e=>{a.push(e.id)});let o=!0;if(t.forEach(e=>{let t=e.baseConfigurationId;a.includes(t)||(o=!1),i.includes(t)||i.push(t)}),o&&i.forEach(function(t){e.includes(t)||(o=!1)}),o){let t=0;e.forEach(e=>{a.includes(e)&&t++}),o=1!=t}return o},U.prototype._reBaseConfigurations=function(e){let t=this,i=t._listPresenter._getSelectedItem(),a=[];i.forEach(e=>{a.push(e.id)}),this._privateChannel.publish({event:"xmodel-list-data-on-load-start"});let o=t._chgBaseConfigAutoCmplt.value,s=[],r={promise:new n.Promise(function(i,s){l.reBaseConfigs({parentID:t._modelVersionId,bcID:o,pcIDs:a}).then(function(a){n.is(e,"string")&&(a=l.parseStringData(e)),t._updateModel(a),y.showSuccess(L.SUCCESS_REBASE_CONFIG),i()},function(){t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),y.showError(L.ERROR_REBASE_CONFIG),s()})}),processTitle:e.processTitle};s.push(r);let d=new V,c={progressHeading:e.progressHeading,itemTitle:e.itemTitle,processes:s};d.init(c)},U.prototype._updateModel=function(e){this._removeNodeModels(e),this.createPostProcessSucess(e);let t=[],i=[];e.member.forEach(e=>{t.push(e.id)}),this._model.search({match:function(e){t.includes(e.nodeModel.options.id)&&i.push(e.nodeModel)}}),this._model.prepareUpdate(),this._model.getXSO().add(i),this._model.pushUpdate()},U.prototype._removeNodeModels=function(e){let t=[];e.member.forEach(e=>t.push(e.id)),this._model.getAllDescendants().forEach(e=>{t.includes(e.options.id)&&e.remove()})},U.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-change-base-config"},function(t){e._reBaseConfigurations(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-link-click"},function(t){e._privateChannel.publish({event:"xmodel-execute-command",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-click"},function(t){_.onLockColumnCellClick(t,7,e._command,e._privateChannel)}),this._myEventManager.subscribe(this._privateChannel,{event:"custom-attributes-loading-done"},function(t){e._privateChannel.publish({event:"xmodel-list-add-columns",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"config-filter-carried-over-response"},function(t){if(!Array.isArray(t.response.member))return;let i=[];t.response.member.forEach(t=>{let n;if(t.maturity=t.state,"Model Type"==t.type)t.prodCs=[],t.type=F;else if(t.baseConfigurationId){n=e._getBaseConfigNode(t).options}let a={item:t,parent:n};i.push(a)}),e._privateChannel.publish({event:"xmodel-list-content-show-loader"}),i.forEach(t=>{e._privateChannel.publish({event:"xmodel-list-data-item-add-update-action",data:t})}),e._privateChannel.publish({event:"xmodel-list-content-hide-loader"}),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"})}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-delete"},function(t){let i=e._listPresenter._getSelectedItem(),n=[],a=[];i.forEach(function(e){e.type===F?a.push(e.id):n.push(e.id)}),n.length>0&&e.deletePC(n),a.length>0&&e.deleteBaseConfig(a)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-creation"},function(t){t.id===D.TYPE_BASECONFIG?e.createBaseConfig(t.content):e.createPC(t.content)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-add-selection"},async function(t){var i=t.model,n=[];t.items&&t.items.forEach(function(e){e.options&&n.push(e.options.id)});let a=[];!0===t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;a.push(t)}):a.push(i.id),c.addSelection(a,e._namePage),g.updateSelectedItems(e._pathPC,n),_.showToolbarLockUnlockIcons(e._privateChannel,t),await e._updateChangeBaseConfigAction()}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-remove-selection"},async function(t){var i=t.model;let n=[];1==t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;n.push(t)}):n.push(i.id),c.removeSelection(n,e._namePage);var a=[];t.items&&t.items.forEach(function(e){e.options&&a.push(e.options.id)}),g.updateSelectedItems(e._pathPC,a),_.showToolbarLockUnlockIcons(e._privateChannel,t),await e._updateChangeBaseConfigAction()}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-empty-selection"},function(){c.removeAllSelection(e._namePage),g.updateSelectedItems(e._pathPC,[])}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-data-item-need-refresh"},function(t){e._refreshListView(e._privateChannel,t,this)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-on-custom-view-save"},function(t){e._visibleCustomAttrbutesList?t&&(n.equals(e._visibleCustomAttrbutesList,t)&&(e._withCustomAttributes=!1),e._withCustomAttributes=!0):(e._visibleCustomAttrbutesList=t,e._withCustomAttributes=!0),e._withCustomAttributes&&(g.updateCustomAttributeStatus(e._pathPC,e._withCustomAttributes),e.loadData(e._withCustomAttributes))}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-on-save-custom-view"},function(t){g.updateVisibleColumns(e._pathPC,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-switch-view-activated"},function(t){g.updateView(e._pathPC,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-sort-activated"},function(t){g.updateSort(e._pathPC,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"list-view-update-inline-action"},function(t){if(t&&t.model&&t.name&&void 0!==t.value){var i=t.model[0],n=t.cell.nodeModel,a={icons:[u.getWebappsAssetUrl("ENOXModelApp","icon/loading-animation.gif")]};n.updateOptions(a),n.options.grid.type===F?e._editionBCs(i,t.name,t.value.trim()):e._editionPCs(i,t.name,t.value.trim())}}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-tagger-on-filter-change"},function(t){t&&g.setTagFilter(e._pathPC,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-tagger-on-setup"},function(){e._tagActivated?e.publishTags():e.clearTags();var t=g.getTagFilter(e._pathPC);t&&e._privateChannel.publish({event:"xmodel-list-tagger-set-filter-action",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"update-pc-actions"},function(t){var i=!0===t.delete?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";e._privateChannel.publish({event:i,data:"delete"}),e._disable=!t.allowOtherActions;var n=!0===t.create?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";e._privateChannel.publish({event:n,data:"create"})}),w.addEvent("onModification",function(t){if(t&&n.is(t.created,"array")&&t.created.length>0){var i=t.context.getSelectedNodes(),a=t.created[0].physicalid,o=null;if(i&&n.is(i,"array")&&i.length>0){if(i[0].type===F)o=l.getConfigurationDetailsBC({id:a,parentID:e._id});else{var s=g.getCustomAttributeStatus(e._pathPC);o=l.getConfigurationDetails({id:a,parentID:e._id},s)}o.then(function(t){n.is(t,"string")&&(t=l.parseStringData(t));var i=t.member[0];if("Model Type"===i.type&&(i.type=F),i.relativePath.indexOf(e._id)>0){let t=e._getBaseConfigNode(i);e._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(t){e._privateChannel.publish({event:"xmodel-list-unselect-all"}),t.select()}),Array.isArray(t)&&1==t.length?e._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:i,context:t}):e._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:i}),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),e._privateChannel.publish({event:"xmodel-list-view-expand-all-action"}),e._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:g.getSort(e._pathPC)})}},function(){})}}})},U.prototype._editionBCs=function(e,t,i){let n=this;if(e&&t){var a={};a[t]=i;var o=this._id;l.patchBaseConfiguration(e.id,a,o).then(function(e){var t;e.member[0]&&"Model Type"==e.member[0].type&&(e.member[0].type=F),n._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:e.member[0]}),n._listPresenter._getSelectedItem()[0]&&(t=n._listPresenter._getSelectedItem()[0].id),c.removeSelection(e.member[0].id,n._namePage),c.addSelection(t,n._namePage)},function(t){n._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:e}),I.showError({mandatoryErrCodeCheck:!1,action:D.MODIFY,type:D.TYPE_BASECONFIG,message:t})||y.showError(L.ERROR_PATCH_PC_DETAILS)})}},U.prototype._editionPCs=function(e,t,i){var a=this;if(e&&t){var o={};o[t]=i;var s=this._id;l.patchProductConfiguration(e.id,o,s).then(function(e){var t;n.log("PCListPresenter _editionPCs : Service Call Success !!!"),a._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:e.member[0]}),a._listPresenter._getSelectedItem()[0]&&(t=a._listPresenter._getSelectedItem()[0].id),c.removeSelection(e.member[0].id,a._namePage),c.addSelection(t,a._namePage)},function(t){n.log("PCListPresenter _editionPCs : Service Call Failed !!!"),a._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:e}),I.showError({mandatoryErrCodeCheck:!1,action:D.MODIFY,type:D.TYPE_PC,message:t})||y.showError(L.ERROR_PATCH_PC_DETAILS)})}},U.prototype._refreshListView=function(e,t,i){var a=this,o=g.getCustomAttributeStatus(a._pathPC),s=null;void 0!==t&&(n.is(i)&&n.is(i.options)&&n.is(i.options.grid)&&(s=i.options.grid.type===F?l.getConfigurationDetailsBC({id:t,parentID:this._id}):l.getConfigurationDetails({id:t,parentID:this._id},o)),s.then(function(t){if(n.is(t,"string")&&(t=l.parseStringData(t)),n.log("getConfigurationDetails: Service Call Successful !!!"),t&&t.member[0]){var o=t.member[0];"Model Type"===o.type&&(o.type=F),o.context=i,e.publish({event:"xmodel-list-data-item-update-action",data:o}),c.removeSelection(o.id,a._namePage),c.addSelection(o.id,a._namePage)}},function(){n.log("getConfigurationDetails: Service Call Failed !!!"),y.showError(L.ERROR_GET_PC_DETAILS)}))},U.prototype._initDivs=function(){this._container=n.createElement("div"),this._container.classList.add("PCList-presenter"),this._splitView.inject(this._container),this._leftPanel=this._splitView.getLeft(),this._rightPanel=this._splitView.getRight(),n.extendElement(this._leftPanel),n.extendElement(this._rightPanel),this._listPresenter.inject(this._leftPanel)},U.prototype.inject=function(e){e.appendChild(this._container)},U.prototype.loadData=function(e){var t=this,i=g.getCustomAttributeStatus(t._pathPC);t._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),this._getAllProductConfigurationPromise=e||i?l.getConfigurationVersionsWithCA({parentID:this._id}):l.getConfigurationVersions({parentID:this._id}),this._getAllBaseConfigurationPromise||(this._getAllBaseConfigurationPromise=l.getAllBaseConfiguration({parentID:t._id})),Promise.all([this._getAllProductConfigurationPromise,this._getAllBaseConfigurationPromise]).then(e=>{var i=[],a=[];e[0].member[0].hasOwnProperty("productConfigurations")&&(i=e[0].member[0].productConfigurations.member),e[1].member[0].hasOwnProperty("baseConfigurations")&&(a=e[1].member[0].baseConfigurations.member);let o={},s={member:[],totalItems:0};n.is(a)&&a.length>0&&a.forEach((e,t)=>{e.type=F,s.member.push(e),s.totalItems++,o[e.id]=t,e.prodCs={member:[]}}),n.is(i)&&i.length>0&&i.forEach(e=>{e.hasOwnProperty("baseConfigurationId")&&null!=o[e.baseConfigurationId]?a[o[e.baseConfigurationId]].prodCs.member.push(e):(s.member.push(e),s.totalItems++)}),t._privateChannel.publish({event:"xmodel-list-data-load-action",data:s}),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"xmodel-list-view-expand-all-action"});var r=g.getSelectedItems(t._pathPC);r&&r.length>0&&t._privateChannel.publish({event:"xmodel-list-selection-action",data:r}),t._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:g.getSort(t._pathPC)}),0===t._model.getXSO().get().length&&t._privateChannel.publish({event:"xmodel-list-item-on-empty-selection"})}).catch(()=>{t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"xmodel-list-view-expand-all-action"})}),this._getAllProductConfigurationPromise.catch(()=>{y.showError(L.ERROR_GET_PCs)}),this._getAllBaseConfigurationPromise.catch(()=>{y.showError(L.ERROR_GET_BCs)})},U.prototype.createBaseConfig=function(e){let t=this;t._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),t._patchForUploadingImage=e.image?e.image:void 0,e.image=void 0,l.createBaseConfiguration({items:[{attributes:e}]},this._id).then(function(e){var i=e.member[0].identifier;t._patchIdObject=e.member[0].identifier,t._patchForUploadingImage?d.uploadImage(i,t._patchForUploadingImage).then(function(){t.createPostProcessBC(t._patchIdObject)},function(){n.log("uploadImage: Service Call Failed !!!"),t.createPostProcessBC(t._patchIdObject)}):t.createPostProcessBC(i)},function(){n.log("Base Configuration creation failed"),y.showError(L.ERROR_CREATE_BC),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"xmodel-list-view-expand-all-action"})})},U.prototype.createPostProcessBC=function(e){var t=this;l.getConfigurationDetailsBC({id:e,parentID:this._id}).then(function(e){var i=e.member[0];i.type=F,t._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){t._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select()}),t._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:i}),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"xmodel-list-view-expand-all-action"}),t._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:g.getSort(t._pathPC)}),t._privateChannel.publish({event:"enox-dialog-creation-done"}),y.showSuccess(N._creation_successful)},function(){n.log("getConfigurationDetails: Service Call Failed !!!"),y.showError(L.ERROR_GET_BC_DETAILS),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"xmodel-list-view-expand-all-action"}),t._privateChannel.publish({event:"enox-dialog-creation-done"})})},U.prototype._getBaseConfigNode=function(e){let t,i=this,n=!1;if(e&&e.hasOwnProperty("baseConfigurationId")){i._model.getChildren().forEach(i=>{n||i.options.id!=e.baseConfigurationId||(n=!0,t=i)})}return t},U.prototype.createPostProcessSucess=function(e,t){var i=this;n.is(e,"string")&&(e=l.parseStringData(e));var a=[];e.member.forEach(e=>{a.push(e)}),i._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){i._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select();let t=e.getParent();t&&t.options&&t.options.grid&&t.options.grid.type&&t.options.grid.type==F&&t.expand()});let o=i._getBaseConfigNode(a[0]);a.forEach(e=>{i._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:e,context:o})}),i._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),i._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:g.getSort(i._pathPC)}),t&&(i._privateChannel.publish({event:"enox-dialog-creation-done"}),y.showSuccess(N._creation_successful))},U.prototype.createPC=function(e){var t=this;t._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),n.merge(e,{name:"",purpose:"Evaluation"}),t._patchForUploadingImage=e.image?e.image:void 0,t._patchIdObject=void 0,e.image=void 0;let i=e.baseConfiguration;delete e.baseConfiguration,l.createConfiguration({items:[{type:"",versionName:"",attributes:e,baseConfiguration:{identifier:i}}]},this._id).then(function(e){var i=e.member[0].id;n.log("Created PC Id is: "+i),t._patchForUploadingImage?d.uploadImage(i,t._patchForUploadingImage).then(function(i){e.member[0].image=i,t.createPostProcessSucess(e,!0)},function(){n.log("uploadImage: Service Call Failed !!!"),y.showError(L.ERROR_GET_PC_DETAILS),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"enox-dialog-creation-done"})}):t.createPostProcessSucess(e,!0)},function(){n.log("Product Configuration creation failed"),y.showError(L.ERROR_CREATE_PC),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"})})},U.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:L._single_configuration,multiple:L._multiple_configuration,modelEvent:t,immersiveFrame:C.getImmersiveFrame(),showTypeInfo:!0};b.showDialog(i)},U.prototype.createCreationModelDialog=function(e,t,i){var a=this;t===D.TYPE_PC?l.getAllBaseConfiguration({parentID:this._id}).then(o=>{E.show({id:t,modelEvent:e,title:i,mvId:a._modelVersionId,withCreateAndClose:!0,componentType:"webuxAutoComplete",fields:[{type:"autocomplete",label:L._base_configuration,name:"baseConfiguration",id:"inputBaseConfiguration",position:2,placeholder:"",value:"",errorText:"",required:!1,model:function(){var e=[];return n.is(o)&&n.is(o.member,"array")&&o.member[0].hasOwnProperty("baseConfigurations")&&o.member[0].baseConfigurations.member.forEach(t=>{var i={label:t.title+" "+t.revision,value:t.id,icon:t.image};e.push(i)}),e}()}]})}):t===D.TYPE_BASECONFIG&&E.show({id:t,modelEvent:e,title:i,withCreateAndClose:!0})},U.prototype.deleteBaseConfig=function(e){let t=this,i={items:[]};e.forEach(function(e){i.items.push({identifier:e})}),l.deleteBaseConfiguration(i,this._id).then(function(){t._privateChannel.publish({event:"xmodel-list-data-item-remove-action",data:e}),t._applicationChannel.publish({event:"enox-model-app-item-removed",data:e}),t._privateChannel.publish({event:"xmodel-on-delete-baseConfig",data:e})},function(e){I.showError({action:D.DELETE,type:D.TYPE_BASECONFIG,message:e})||y.showError(L.ERROR_DELETE_BC)})},U.prototype.deletePC=function(e){var t=this;l.deleteConfigurationVersions({parentId:this._id,ids:e}).then(function(){n.log("Product Configuration/s deleted successfully."),t._privateChannel.publish({event:"xmodel-list-data-item-remove-action",data:e}),t._applicationChannel.publish({event:"enox-model-app-item-removed",data:e})},function(e){n.log("Error! Product Configuration deletion failed!!"),I.showError({action:D.DELETE,type:D.TYPE_PC,message:e})||y.showError(L.ERROR_DELETE_PC)})},U.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this.clearTags(),this._myEventManager&&(this._myEventManager.cleanup("PCListPresenter"),this._myEventManager=null),w.removeEvent("onModification")},U.prototype.publishTags=function(){this._tagActivated=!0,this._privateChannel.publish({event:"xmodel-list-tagger-activate-action"})},U.prototype.clearTags=function(){this._tagActivated=!1,this._privateChannel.publish({event:"xmodel-list-tagger-deactivate-action"})},U}),define("DS/ENOXModelApp/ModelDefinition/js/ModelManufacturingPlansPresenter",["UWA/Core","DS/UIKIT/Mask","DS/Menu/Menu","DS/CoreEvents/ModelEvents","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/xModelCommand","DS/WebappsUtils/WebappsUtils","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/ENOXModelApp/Utils/xModelErrorManagement","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelManufacturingPlansPresenter","css!DS/ENOXModelApp/ModelDefinition/css/ManufacturingPlansPresenter.css","DS/ENOXModelApp/Utils/xModelApp3DSearch"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P){"use strict";var w=function(){},O="createManufacturingPlan",T="deriveManufacturingPlan",x="reviseManufacturingPlan";return w.prototype.init=function(e,t,i){this._appPrefPathPlans=[m._KEY,m._VIEWS_PREFERENCES,m._MODEL_VERSIONS_DETAILS,m._MANUFACTURINGPLANS],this._isDestroyed=!1,this._privateChannel=e||new n,this._applicationChannel=t,this._updateChannelLocal=new n,this._myEventManager=new h(this._updateChannelLocal,this._applicationChannel,this._privateChannel),this._mvId=i.id,this._modelName=i.modelName,this._modelId=i.modelId,this._editable=i.editable,this._disable=!i.editable,this._tagActivated=!1,this._namePage="ManufacturingPlans",this._infoContext="ManufacturingPlans",d.initialize({applicationChannel:this._applicationChannel,silent:!0,context:this._infoContext,readOnly:!1}),this._relatedObjectsCmd=new S,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._listPresenter=null,this._initializeListView(),this._initDivs(),this._initCommand(),this._subscribeToEvents()},w.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.addClassName("manufacturing-plans-presenter"),this._listPresenter.inject(this._container)},w.prototype._initCommand=function(){this._command=new c(this._privateChannel,this._container,this._applicationChannel)},w.prototype._initializeListView=function(){var t,n=this,l=_.getSort(this._appPrefPathPlans);l&&l.sortAttribute&&l.sortOrder&&(t={id:l.sortAttribute,order:l.sortOrder});var c={id:"manufacturingPlans",modelEvents:this._privateChannel,useDragAndDrop:!1,viewOptions:{identifier:"manufacturingPlans",views:["DataGridView"],currentView:"DataGridView",currentSort:t,grid:{columns:[{text:M.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",pinned:"left",editableFlag:!0,getCellSemantics:function(){return{linkDisplay:!1}},getCellEditableState:function(e){var t=e.nodeModel.options.grid;return C.checkActionAccess({action:y.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:M.NAME,dataIndex:"name",visibleFlag:!0},{text:M.REVISION,dataIndex:"revision",typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){return{label:e.nodeModel.options.grid.revision,url:"#Revision"}}},{text:I.DERIVATION_TYPE,dataIndex:"deriveType",visibleFlag:!0,groupableFlag:!0,getCellValue:function(e){var t=e.nodeModel.options.grid?e.nodeModel.options.grid.deriveType:"";return"Root"===t?I.ROOT:"Revision"===t?I.REVISION:"Branch"===t?I.BRANCH:""},compareFunction:function(e,t){return(e="Root"===e?I.ROOT:"Revision"===e?I.REVISION:"Branch"===e?I.BRANCH:"")===(t="Root"===t?I.ROOT:"Revision"===t?I.REVISION:"Branch"===t?I.BRANCH:"")?0:e>t?1:e<t?-1:void 0}},{text:M.DESCRIPTION,dataIndex:"description",editableFlag:!0,getCellEditableState:function(e){var t=e.nodeModel.options.grid;return C.checkActionAccess({action:y.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:M.MATURITY_STATE,dataIndex:"maturity",groupableFlag:!0,typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(e.nodeModel.options.grid){var t=e.nodeModel.options.grid;return{label:(t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state)||t.maturity,url:"#Maturity"}}return""},getCellGroupingKey:function(e){var t=e.nodeModel.options.grid,i="";return void 0!==t&&(i=t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state?t.state:t.maturity?t.maturity:""),i}},{text:M.OWNER,dataIndex:"owner",visibleFlag:!0,groupableFlag:!0,getCellValue:function(e){return{label:e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:e.nodeModel.options.grid.responsible,url:"#Owner"}},getCellGroupingKey:function(e){return e.nodeModel.options.grid.owner},typeRepresentation:"url",hyperlinkTarget:"_self"},{text:M.CREATION_DATE,dataIndex:"created",getCellValue:function(e){if(e.nodeModel.options.grid.created)return u.formatDateAttribute(e.nodeModel.options.grid.created)}},{text:M.MODIFICATION_DATE,dataIndex:"modified",getCellValue:function(e){if(e.nodeModel.options.grid.modified)return u.formatDateAttribute(e.nodeModel.options.grid.modified)}},{text:M.ORGANIZATION,dataIndex:"organizationTitle"},{text:M.COLLABSPACE,dataIndex:"collabSpaceTitle"}]},editable:!0,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){return e.options.grid.nlsValues?e.options.grid.nlsValues.nlsType?e.options.grid.nlsValues.nlsType+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible):void 0:e.options.grid.type+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible)},customTooltip:function(e){return u.prepareTooltipObjectView(e)},icon:function(){return p.getWebappsAssetUrl("ENOXModelApp","icon/iconManufacturingPlan.png")}},contextualActions:[{id:"revise",title:M.REVISE,text:M.REVISE,fonticon:"flow-line-add",multiselect:!1,handler:function(e,t){C.checkActionAccess({action:y.REVISE,type:y.TYPE_PLAN,notify:!0})&&n._handleRevisionCreation(t)}},{id:"derive",title:M.DERIVE,text:M.DERIVE,fonticon:"flow-branch-add",multiselect:!1,handler:function(e,t){e=n._listPresenter._getSelectedItem(),C.checkActionAccess({action:y.DERIVE,type:y.TYPE_PLAN,notify:!0})&&n.manageCreateOrDerivePlanAction(e[0])}},{id:"revisionExplorer",title:M.REVISION_EXPLORER,text:M.REVISION_EXPLORER,fonticon:"flow-branch-list",multiselect:!1,handler:function(e){n._command._handelRevisionCommand(e,{selectionMode:E.SELECTION_MODES.SINGLE_SELECT_ONLY})}},{id:"maturityState",title:M.MATURITY,text:M.MATURITY,fonticon:"collaborative-lifecycle-management",handler:function(e,t){n._command._handleMaurityCommand(t)}},{type:"SeparatorItem"},{id:"changeOwnership",title:M.CHANGE_OWNERSHIP,text:M.CHANGE_OWNERSHIP,fonticon:"move-to",handler:function(e,t){C.checkActionAccess({action:y.MOVE,notify:!0})&&n._command._handleChangeOwnerCommand(t)}},{type:"SeparatorItem"},n._relatedObjectsCmdObj,{id:"changeImpacts",title:M.CHANGE_IMPACTS,fonticon:"change",category:"navigation",multiselect:!1,handler:function(e){n._command._handleChangeImpactsCommand(e)}},{id:"information",title:M.INFORMATION,text:M.INFORMATION,fonticon:"info",handler:function(e){d.showInformation(e.id),n._applicationChannel.publish({event:"information-panel-open"})}},{type:"SeparatorItem"},{id:"delete",title:M.DELETE,text:M.DELETE,fonticon:"trash",handler:function(e,t){if(C.checkActionAccess({action:y.DELETE,type:y.TYPE_PLAN,notify:!0})&&e){if(!0===n._disable)return void b.showError(I.ERROR_CANT_DELETE_MF_PLANS_IS_MV_OBSOLETE);var i=t.map(function(e){return{id:e.id,title:e.title}});n.createDeleteModelDialog(i,n._privateChannel)}}}]},emptyContentOptions:{sentences:[{type:"img",src:p.getWebappsAssetUrl("ENOXModelApp","icon/iconManufacturingPlan.png"),text:I.EMPTY_CONTENT_MESSAGE}]},withmultisel:!0,toolbarOptions:{itemName:I.MANUFACTURING_PLAN,itemsName:I.MANUFACTURING_PLANS,groupByActionIndex:1,withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,touchMode:!1,hideOnMultiSelection:["revise","revisionExplorer","derive","changeImpacts"],actions:[{id:"createOrDerive",text:M.CREATE,fonticon:"plus",visibility:this._disable,handler:function(){if(C.checkActionAccess({action:y.CREATE,type:y.TYPE_PLAN,notify:!0})){var t=event.target.getBoundingClientRect();r.hasManufacturingPlanMaster({id:n._mvId}).then(function(a){a?!1===a.exist?f.show({id:O,modelEvent:n._privateChannel,title:I.CREATE_MF_PLAN,withCreateAndClose:!1,edit_revision:!0,revisionStartsAt:"1",createBtnLabel:I.CREATE}):r.hasRootPlanInBackwardMVChain({id:n._mvId}).then(function(a){if(a&&!0===a.exist){var o=[{name:"newRevisionFrom",type:"PushItem",title:I.NEW_REVISION_FROM,action:{callback:function(){e.log("Create Action handler."),C.checkActionAccess({action:y.CREATE,type:y.TYPE_PLAN,notify:!0})&&n._launchReviseFromDialog()}}},{name:"newBranchFrom",type:"PushItem",title:I.NEW_BRANCH_FROM,action:{callback:function(){e.log("Create Action handler."),C.checkActionAccess({action:y.CREATE,type:y.TYPE_PLAN,notify:!0})&&n._launchBranchFromDialog()}}}];i.show(o,{position:{x:t.left,y:t.top+t.height},submemu:"outside"})}else b.showError(I.MSG_MF_PLAN_DERIVATION_MV_POSITION_ERROR)},function(){b.showError(I.MSG_MF_PLAN_MV_POSITION_ERROR)}):b.showError(I.MSG_MF_PLAN_MASTER_ERROR)},function(){b.showError(I.MSG_MF_PLAN_MASTER_ERROR)})}}},{id:"revise",title:M.REVISE,text:M.REVISE,showOnSelection:!0,category:"lifecycle",fonticon:"flow-line-add",handler:function(){let e=n._listPresenter._getSelectedItem();C.checkActionAccess({action:y.REVISE,type:y.TYPE_PLAN,notify:!0})&&n._handleRevisionCreation(e)}},{id:"derive",title:M.DERIVE,text:M.DERIVE,category:"lifecycle",fonticon:"flow-branch-add",showOnSelection:!0,handler:function(){let e=n._listPresenter._getSelectedItem();C.checkActionAccess({action:y.DERIVE,type:y.TYPE_PLAN,notify:!0})&&n.manageCreateOrDerivePlanAction(e[0])}},{id:"revisionExplorer",title:M.REVISION_EXPLORER,text:M.REVISION_EXPLORER,showOnSelection:!0,category:"lifecycle",fonticon:"flow-branch-list",handler:function(){let e=n._listPresenter._getSelectedItem();n._command._handelRevisionCommand(e[0],{selectionMode:E.SELECTION_MODES.SINGLE_SELECT_ONLY})}},{id:"maturityState",title:M.MATURITY,text:M.MATURITY,category:"lifecycle",fonticon:"collaborative-lifecycle-management",showOnSelection:!0,handler:function(){let e=n._listPresenter._getSelectedItem();n._command._handleMaurityCommand(e)}},{id:"changeOwnership",title:M.CHANGE_OWNERSHIP,text:M.CHANGE_OWNERSHIP,category:"collaboration",fonticon:"move-to",showOnSelection:!0,handler:function(){let e=n._listPresenter._getSelectedItem();C.checkActionAccess({action:y.MOVE,notify:!0})&&n._command._handleChangeOwnerCommand(e)}},n._relatedObjectsCmdObj,{id:"changeImpacts",text:M.CHANGE_IMPACTS,fonticon:"change",category:"navigation",multiSelect:!1,showOnSelection:!0,handler:function(e){n._command._handleChangeImpactsCommand(e)}},{id:"delete",text:M.DELETE,fonticon:"trash",category:"destructive",visibility:this._disable,showOnSelection:!this._disable,handler:function(e){if(C.checkActionAccess({action:y.DELETE,type:y.TYPE_PLAN,notify:!0})){if(!0===n._disable)return void b.showError(I.ERROR_CANT_DELETE_MF_PLANS_IS_MV_OBSOLETE);var t=e.map(function(e){return{id:e.id,title:e.label}});n.createDeleteModelDialog(t,n._privateChannel)}}}]},extensions:[o,s]};this._listPresenter=new a(c)},w.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._privateChannel,{event:"set-mf-plans-editable"},function(t){var i=!0===t?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";e._privateChannel.publish({event:i,data:"createOrDerive"}),e._privateChannel.publish({event:i,data:"delete"}),e._editable=t,e._disable=!e._editable}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-view-group-by-action"},function(t){_.updateGroup(e._appPrefPathPlans,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-link-click"},function(t){t&&"revision"===t.linkId&&t.model?e._command._handelRevisionCommand(t.model,{selectionMode:E.SELECTION_MODES.SINGLE_SELECT_ONLY}):e._privateChannel.publish({event:"xmodel-execute-command",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-delete"},function(t){e.deleteMFPlans(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"list-view-update-inline-action"},function(t){if(t&&t.model&&t.name&&void 0!==t.value){var i=t.model[0],n=t.cell.nodeModel,a={icons:[p.getWebappsAssetUrl("ENOXModelApp","icon/loading-animation.gif")]};n.updateOptions(a),e.planUpdateHandler(i,t.name,t.value.trim())}}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-creation"},function(t){e.createOrDeriveOrReviseMFPlan(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-add-selection"},function(t){var i=t.model,n=[];t&&t.items&&t.items.forEach(function(e){e.options&&n.push(e.options.id)});let a=[];!0===t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;a.push(t)}):a.push(i.id),d.addSelection(a,e._infoContext,!1),_.updateSelectedItems(e._appPrefPathPlans,n)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-remove-selection"},function(t){var i=t.model;let n=[];1==t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;n.push(t)}):n.push(i.id),d.removeSelection(n,e._namePage);var a=[];t.items&&t.items.forEach(function(e){e.options&&a.push(e.options.id)}),_.updateSelectedItems(e._appPrefPathPlans,a)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-empty-selection"},function(){d.removeAllSelection(e._namePage),_.updateSelectedItems(e._appPrefPathPlans,[])}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-data-item-need-refresh"},function(t){e._refreshListView(t,this)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-sort-activated"},function(t){_.updateSort(e._appPrefPathPlans,t)}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-filter-change"},function(t){t&&_.setTagFilter(e._appPrefPathPlans,t)}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-setup"},function(){e._tagActivated?e.publishTags():e.clearTags();var t=_.getTagFilter(e._appPrefPathPlans);t&&e._privateChannel.publish({event:"xmodel-list-tagger-set-filter-action",data:t})})},w.prototype._refreshListView=function(t,i){if(void 0!==t){var n,a=this;i&&(n=i.options.grid),r.getManufacturingPlanDetails({mvId:this._mvId,id:t}).then(function(t){if(t&&t.member[0]){var o=t.member[0];n&&e.merge(o,n),o.context=i,a._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:o}),d.removeSelection(o.id,a._namePage),d.addSelection(o.id,a._namePage)}},function(){b.showError(I.ERROR_GET_MF_PLAN_DETAILS)})}},w.prototype.createOrDeriveOrReviseMFPlan=function(e){var t=this;if(e&&e.id&&(e.id===O||e.id===T||e.id===x)){var i=e.content.image?e.content.image:void 0,n={parentId:t._mvId,items:[{versionName:e.content.revision?e.content.revision:1,type:"",attributes:{name:"",title:e.content.title?e.content.title:"",description:e.content.description?e.content.description:""}}]};switch(e.id){case O:break;case T:if(e.content.deriveFrom)n.items[0].deriveFrom={id:e.content.deriveFrom};else{if(!e.context||!e.context.id)return void b.showError(I.ERROR_INVALID_DERIVE_FROM_MF_PLAN);n.items[0].deriveFrom={id:e.context.id}}break;case x:if(e.content.deriveFrom)n.items[0].reviseFrom={id:e.content.deriveFrom};else{if(!e.context||!e.context.id)return void b.showError(I.ERROR_INVALID_REVISE_FROM_MF_PLAN);n.items[0].reviseFrom={id:e.context.id}}}t._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),r.createManufacturingPlan(n).then(function(e){var n=e.member&&1===e.member.length?e.member[0]:void 0;n&&(i?l.uploadImage(n.id,i).then(function(){t._getMFPlanDetailsAndAddItem(n.id)},function(){b.showWarning(I.ERROR_IMAGE_UPLOAD),t._createPlanItemAndApplyViewPreferences(n)}):t._createPlanItemAndApplyViewPreferences(n))},function(i){t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"});var n="",a="";switch(e.id){case O:a=y.CREATE,n=I.ERROR_MF_PLAN_CREATE;break;case T:a=y.DERIVE,n=I.ERROR_MF_PLAN_DERIVE;break;case x:a=y.REVISE,n=I.ERROR_MF_PLAN_REVISE}i&&""!==i&&(n=n+" "+i),D.showError({action:a,type:y.TYPE_PLAN,message:n})||b.showError(n)})}},w.prototype._createPlanItemAndApplyViewPreferences=function(e){var t=this,i=_.getGroup(t._appPrefPathPlans);t._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){t._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select()}),t._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:e}),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),t._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:_.getSort(t._appPrefPathPlans)}),i&&t._privateChannel.publish({event:"xmodel-list-view-group-by-action",data:i}),t._privateChannel.publish({event:"enox-dialog-creation-done"}),b.showSuccess(M._creation_successful)},w.prototype._getMFPlanDetailsAndAddItem=function(e){var t=this;r.getManufacturingPlanDetails({mvId:this._mvId,id:e}).then(function(e){var i=e.member&&1===e.member.length?e.member[0]:void 0;i&&t._createPlanItemAndApplyViewPreferences(i)},function(){t._privateChannel.publish({event:"enox-dialog-creation-done"}),b.showError(I.ERROR_GET_MF_PLAN_DETAILS)})},w.prototype._handleRevisionCreation=function(e){var t=this;e&&r.hasLatestRevisionInBackwardMVChain({id:this._mvId}).then(function(i){if(i&&i.exist){e=e[0];var n=I.REVISE_MF_PLAN+" - "+e.title+" - "+e.revision;f.showRevisionDialog({id:x,context:e,modelEvent:t._privateChannel,title:n,withCreateAndClose:!1,revisionFieldOptions:{placeHolder:I.ENTER_A_REVISION,errorText:I.MSG_REVISION_FIELD_MANDATORY},createBtnLabel:I.REVISE})}else i&&!i.exist&&b.showError(I.MSG_MF_PLAN_REVISION_MV_POSITION_ERROR)},function(){b.showError(I.MSG_MF_PLAN_REVISION_MV_POSITION_ERROR)})},w.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:I.MANUFACTURING_PLAN,multiple:I.MANUFACTURING_PLANS,modelEvent:t,immersiveFrame:g.getImmersiveFrame()};v.showDialog(i)},w.prototype.planUpdateHandler=function(t,i,n){var a=this;if(t&&i){var o={};o[i]=n,r.patchManufacturingPlan({mvId:this._mvId,id:t.id,data:o}).then(function(e){a._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:e.member[0]});var t=a._listPresenter._getSelectedItem()[0];t&&t.id&&t.id===e.member[0].id&&(d.removeSelection(t.id,a._namePage),d.addSelection(t.id,a._namePage))},function(i){e.log("Manufacturing Plan update service call Failed !!!"),a._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:t}),D.showError({mandatoryErrCodeCheck:!1,action:y.MODIFY,type:y.TYPE_PLAN,message:i})||b.showError(I.ERROR_MF_PLAN_UPDATE)})}},w.prototype.manageCreateOrDerivePlanAction=function(t){var i=this;r.hasManufacturingPlanMaster({id:this._mvId}).then(function(n){n?!1===n.exist?f.show({id:O,modelEvent:i._privateChannel,title:I.CREATE_MF_PLAN,withCreateAndClose:!1,edit_revision:!0,revisionStartsAt:"1",createBtnLabel:I.CREATE}):!0===n.exist&&r.hasRootPlanInBackwardMVChain({id:i._mvId}).then(function(n){n&&!0===n.exist?(i._promiseGetPlansCanBeDerivedFrom=void 0,i._getMFPlansCapableOfDerivation(),f.show({id:T,modelEvent:i._privateChannel,title:I.DERIVE_MF_PLAN,withCreateAndClose:!1,edit_revision:!0,revisionStartsAt:"",fieldOrder:["title","deriveFrom","revision","description"],deriveFromFieldOptions:{label:I.DERIVE_FROM,placeHolder:I.SEARCH_A_PLAN_TO_DERIVE_FROM,errorText:I.MSG_DERIVE_FROM_MANDATORY,searchOption:function(e){let t='(flattenedtaxonomies:("types/Manufacturing Plan"))';return e&&(t+=`AND ([ds6w:label]:("${e}*"))`),{query:t,label:"select a Manufacturing Plan"}},initialValue:t&&t.id?t:void 0},createBtnLabel:I.DERIVE,context:t&&t.id?t:void 0})):(b.showError(I.MSG_MF_PLAN_DERIVATION_MV_POSITION_ERROR),e.log("Error! MF Plan exists in forward derivation of the current model version. Can't derive plan!!!"))},function(){b.showError(I.MSG_MF_PLAN_MV_POSITION_ERROR),e.log("Rejected! Unable to know if MF Plan exists in forward derivation of the current model version. Can't derive plan!!!")}):(e.log("Error! Unable to get proper response from hasManufacturingPlanMaster service."),b.showError(I.MSG_MF_PLAN_MASTER_ERROR))},function(){e.log("Error! Unable to know if model has hasManufacturingPlanMaster"),b.showError(I.MSG_MF_PLAN_MASTER_ERROR)})},w.prototype._launchReviseFromDialog=async function(e){var i=this;t.mask(this._container);var n=await r.getVersionsAssociatedWithModel({data:[{id:i._mvId,identifier:i._mvId,type:"Products"}]}).then(function(e){var t=i._mvId,n=e.results[0].versions;console.log("versions "+n);var a={},o={},s=(e,t)=>{var i=o[e];return i&&i.forEach(e=>(t.push(a[e]),s(e,t))),t};return n.forEach(function(e){a[e.id]=e.revision,e.ancestors&&e.ancestors[0]&&(o[e.ancestors[0].id]=o[e.ancestors[0].id]||[],o[e.ancestors[0].id].push(e.id))}),s(t,[])},function(){return[]});t.unmask(this._container),f.show({id:x,modelEvent:i._privateChannel,title:I.REVISE_MF_PLAN,withCreateAndClose:!1,edit_revision:!0,revisionStartsAt:"",fieldOrder:["title","deriveFrom","revision","description"],deriveFromFieldOptions:{label:I.REVISE_FROM,placeHolder:I.SEARCH_A_PLAN_TO_REVISE_FROM,errorText:I.MSG_REVISE_FROM_MANDATORY,searchOption:function(e){let t='(flattenedtaxonomies:("types/Manufacturing Plan")) AND (ds6w_58_islastrevision:true)';return i._modelId&&(t+=` AND (mp_95_based_95_on_95_model_95_pid:("${i._modelId}"))`),n&&n.length>0&&(t+=" AND ( NOT (mp_95_based_95_on_95_model_95_version_95_revision: ",n.forEach((e,i)=>{0!==i&&(t+="OR "),t+=`"${e}"`}),t+="))"),e&&(t+=` AND ([ds6w:label]:("${e}*"))`),{query:t,label:I.SELECT_PLAN_LABEL}},initialValue:e&&e.id?e:void 0},createBtnLabel:I.REVISE,context:e&&e.id?e:void 0})},w.prototype._launchBranchFromDialog=function(e){var t=this;f.show({id:T,modelEvent:t._privateChannel,title:I.DERIVE_MF_PLAN,withCreateAndClose:!1,edit_revision:!0,revisionStartsAt:"",fieldOrder:["title","deriveFrom","revision","description"],deriveFromFieldOptions:{label:I.DERIVE_FROM,placeHolder:I.SEARCH_A_PLAN_TO_DERIVE_FROM,errorText:I.MSG_DERIVE_FROM_MANDATORY,searchOption:function(e){let i='(flattenedtaxonomies:("types/Manufacturing Plan"))';return t._modelId&&(i+=` AND (mp_95_based_95_on_95_model_95_pid:("${t._modelId}"))`),e&&(i+=` AND ([ds6w:label]:("${e}*"))`),{query:i,label:I.SELECT_PLAN_LABEL}},initialValue:e&&e.id?e:void 0},createBtnLabel:I.DERIVE,context:e&&e.id?e:void 0})},w.prototype._getMFPlansCapableOfDerivation=function(){return void 0===this._promiseGetPlansCanBeDerivedFrom&&(this._promiseGetPlansCanBeDerivedFrom=r.getMFPlansTobeDerivedFrom({id:this._mvId})),this._promiseGetPlansCanBeDerivedFrom},w.prototype.deleteMFPlans=function(e){var t=this;r.deleteManufacturingPlans({data:{ids:e},mvId:t._mvId}).then(function(){t._privateChannel.publish({event:"xmodel-list-data-item-remove-action",data:e})},function(e){D.showError({action:y.DELETE,type:y.TYPE_PLAN,message:e})||b.showError(I.ERROR_DELETE_MF_PLANS)})},w.prototype.inject=function(e){e.appendChild(this._container)},w.prototype.publishTags=function(){this._tagActivated=!0,this._privateChannel.publish({event:"xmodel-list-tagger-activate-action"})},w.prototype.clearTags=function(){this._tagActivated=!1,this._privateChannel.publish({event:"xmodel-list-tagger-deactivate-action"})},w.prototype.loadData=function(){var e=this;e._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),r.getManufacturingPlans({mvId:e._mvId}).then(function(i){t.unmask(e._container);var n=i;e._privateChannel.publish({event:"xmodel-list-data-load-action",data:n}),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"});var a=_.getSelectedItems(e._appPrefPathPlans);a&&a.length>0&&e._privateChannel.publish({event:"xmodel-list-selection-action",data:a}),e._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:_.getSort(e._appPrefPathPlans)});var o=_.getGroup(e._appPrefPathPlans);o&&e._privateChannel.publish({event:"xmodel-list-view-group-by-action",data:o})},function(){t.unmask(e._container),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),b.showError(I.ERROR_GET_MF_PLANS)})},w.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this.clearTags(),this._myEventManager&&(this._myEventManager.cleanup("ModelManufacturingPlansPresenter"),this._myEventManager=null),this._listPresenter.destroy()},w}),define("DS/ENOXModelApp/ModelDefinition/js/NewVariabilityPresenter_v2",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","DS/ENOXModelApp/ModelDefinition/js/VariabilityListPresenter","DS/ENOXModelApp/ModelDefinition/js/VariabilityDataManager","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoPresenterSettingsProvider","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/xModelEventManager/xModelEventManager","DS/TaggerOnIndexComponent/TaggerOnIndexComponent","DS/WildcardSearchComponent/WildcardSearchComponent","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/EditPropWidget/comm/EventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","text!DS/ENOXModelApp/assets/ModelVariabilityConstants.json","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","css!DS/ENOXModelApp/ModelDefinition/css/VariabilityPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y){"use strict";return C=JSON.parse(C),t.extend({_TaggerOnIndexComponent:p,className:"variability-presenter",init:function(t){this.tagFriends=t.tagFriends,this.WildcardSearch=new u,this.dictionaryJSON=t.dictionaryJSON,this.isDictionaryLoaded=e.is(this.dictionaryJSON),this._applicationChannel=t.applicationChannel?t.applicationChannel:new n,this._localChannel=t.localChannel?t.localChannel:new n,this._isModelVariabilityEditable=!t||void 0===t.editable||"boolean"!=typeof t.editable||t.editable,this.modelId=t.modelId,this._mEvtForListAndDataManager=new n,this._mEvtForTablePresententer=new n,this._mEvtForCriteriaPresententer=new n,this._existingCriteria=[],this._3DSearch=new _,this._eventManagerOptions=[],this._createModelEvent=new n,this._pathVariability=[f._KEY,f._VIEWS_PREFERENCES,f._MODEL_VERSIONS_DETAILS,f._VARIABILITY],this._myEventManager=new c(this._mEvtForListAndDataManager,this._localChannel),this.subscribeEvents(),this._infoContext="Variability",d.initialize({applicationChannel:this._applicationChannel,id:this.modelId,silent:!0,context:this._infoContext,readOnly:!0}),this._currentFacet=null,this._loadingConunter=0,this.initVariabilityDataManager(),this._parent(t)},getListAndDataEvt:function(){return this._mEvtForListAndDataManager},initVariabilityDataManager:function(){this._variabilityDataManager=new o,this._variabilityDataManager.init({modelEvent:this._mEvtForListAndDataManager,modelName:"",modelId:"",mvId:this.modelId,createModelEvent:this._createModelEvent})},subscribeEvents:function(){var t=this;window.widget&&window.widget.addEvent("endEdit",function(){t.destroy()}),this._myEventManager.subscribe(this._mEvtForListAndDataManager,{event:C.EVT_CREATE_N_ADD_NEW_ITEM},function(e){t.createAndAddItemHandler(e)}),this._myEventManager.subscribe(this._mEvtForListAndDataManager,{event:C.EVT_VARIABILITY_SHOW_LOADING},function(){t._loadingConunter++,i.mask(t.container)}),this._myEventManager.subscribe(this._mEvtForListAndDataManager,{event:C.EVT_VARIABILITY_HIDE_LOADING},function(){t._loadingConunter--,t._loadingConunter<1&&(i.unmask(t.container),t._loadingConunter=0)}),this._myEventManager.subscribe(this._mEvtForListAndDataManager,{event:C.EVT_MODEL_VER_VARIABILITY_UPDATED},function(){t._localChannel.publish({event:C.EVT_MODEL_VER_VARIABILITY_UPDATED,data:{}})}),this._myEventManager.subscribe(this._mEvtForListAndDataManager,{event:"variability-filter-carried-over-response"},function(i){let n=["collabSpaceTitle","description","image","isA","isInSource","mandatory","maturity","name","organizationTitle","owner","sequenceNumber","title","type"],a=[];if(i.response.parameters){let e=t._itemsListPresenter.getTreeDoc(),n=[],o=[];e.search({match:function(e){"Variant Parameter"==e.nodeModel.options.grid.type&&(o.push(e.nodeModel.options),n.push(e.nodeModel.options.id))}});let s=[];i.response.parameters.member.forEach(e=>{if(!n.includes(e.id)){t._variabilityDataManager.filterReferenceItems([e],"parameter","","NO_CHILD"),s.push(e);let i={item:e};a.push(i)}})}else{if(!Array.isArray(i.response.member))return;i.response.member.forEach(i=>{let o,s;i.variant?(o=e.clone(i.variant.member[0])).sequenceNumber=i.sequenceNumber:i.optionGroup&&(o=e.clone(i.optionGroup.member[0])),o.instanceId=i.id,o.maturity=o.state,t._addAttributes(n,o),i.variant?s=i.value:i.option&&(s=i.option),s.member.forEach(e=>{e.maturity=e.state,e.instanceId=t._id+"@"+e.rel_id,t._addAttributes(n,e)}),o.values=s;let r={item:o};a.push(r)})}t._mEvtForListAndDataManager.publish({event:"xmodel-list-content-show-loader"}),a.forEach(e=>{t._mEvtForListAndDataManager.publish({event:"xmodel-list-data-item-add-update-action",data:e})}),t._mEvtForListAndDataManager.publish({event:"xmodel-list-content-hide-loader"}),t._mEvtForListAndDataManager.publish({event:"xmodel-list-data-on-load-complete"})}),this._myEventManager.subscribe(this._localChannel,{event:"set-variability-editable"},function(e){t._isModelVariabilityEditable=e,t._mEvtForListAndDataManager.publish({event:"set-variability-editable",data:e})}),this._myEventManager.subscribe(this._mEvtForListAndDataManager,{event:"xmodel-list-view-on-expand"},function(e){if(console.log("onPreExpand"),e.nodeInfo.nodeModel.hasChildren())this.preExpandDone();else{e.model.idref?e.model.idref:e.model.id&&e.model.id;t.isDictionaryLoaded?this.preExpandDone():t._mEvtForListAndDataManager.subscribeOnce({event:"variability-load-full-dictionary-done"},()=>{this.preExpandDone()})}})},publishTags:function(){this._itemsListPresenter.publishTags()},clearTags:function(){this._itemsListPresenter.clearTags()},_addAttributes:function(e,t){let i;switch(t.attributes||(t.attributes={}),t.type){case"Variant":i="variant";break;case"Variant Value":i="value";break;case"Variability Group":i="variabilityGroup";break;case"Variability Option":i="option";break;case"Parameter":i="parameter"}t.isA=i,e.forEach(e=>{t.attributes["_"+e]=t[e]})},destroy:function(){this.clearTags(),this._eventManagerOptions.forEach(function(e){v.remove(e.eventName,e.callback)}),this._eventManagerOptions=[],this._variabilityDataManager.destroy(),this._itemsListPresenter.destroy()},setup:function(){this._parent.apply(this,arguments);var e=this;e._eventManagerOptions.push({eventName:"variability-Values-load-data-start",callback:function(e){l.getVariantValues({id:e}).then(function(e){var t={member:[]};e.member&&e.member.length>0&&e.member[0].hasOwnProperty("values")&&(t=e.member[0].values),v.publish("variability-Values-load-action",t)},function(){})}},{eventName:"variability-Values-create-new-action",callback:function(t){e.createValueAction(t,function(t,i){if(i.length>0){var n=[];i.forEach(function(e){n.push(e.id),v.publish("variability-Values-add-item-action",e)}),e._mEvtForListAndDataManager.publish({event:C.EVT_ADD_CRITERIA_VALUES,data:{parentId:t,ids:n,type:"value"}}),e._createModelEvent.publish({event:"enox-dialog-creation-done"}),h.showSuccess(y._creation_successful)}})}},{eventName:"variability-Options-create-new-action",callback:function(t){e.createOptionAction(t,function(t,i){if(i.length>0){var n=[];i.forEach(function(e){n.push(e.id),v.publish("variability-Options-add-item-action",e)}),e._mEvtForListAndDataManager.publish({event:C.EVT_ADD_CRITERIA_VALUES,data:{parentId:t,ids:n,type:"option"}}),e._createModelEvent.publish({event:"enox-dialog-creation-done"}),h.showSuccess(y._creation_successful)}})}},{eventName:"variability-Options-load-data-start",callback:function(e){l.getVariabilityGroupOptions({id:e}).then(function(e){var t={member:[]};e.member&&e.member.length>0&&e.member[0].hasOwnProperty("options")&&(t=e.member[0].options),v.publish("variability-Options-load-action",t)},function(){})}},{eventName:"variability-Values-add-action",callback:function(t){e._mEvtForListAndDataManager.publish({event:C.EVT_ADD_CRITERIA_VALUES,data:{parentId:t.parentId,ids:t.ids,type:"value"}})}},{eventName:"variability-Options-add-action",callback:function(t){e._mEvtForListAndDataManager.publish({event:C.EVT_ADD_CRITERIA_VALUES,data:{parentId:t.parentId,ids:t.ids,type:"option"}})}},{eventName:"variability-Values-added-list-start",callback:function(t){e._mEvtForListAndDataManager.publish({event:C.EVT_GET_CRITERIA_VALUES,data:{id:t,type:"Value",callback:function(e){v.publish("variability-Values-added-list-action",e)}}})}},{eventName:"variability-Options-added-list-start",callback:function(t){e._mEvtForListAndDataManager.publish({event:C.EVT_GET_CRITERIA_VALUES,data:{id:t,type:"Option",callback:function(e){v.publish("variability-Options-added-list-action",e)}}})}},{eventName:"variability-Values-on-show",callback:function(){v.publish("variability-Values-set-editable",e._isModelVariabilityEditable)}},{eventName:"variability-Options-on-show",callback:function(){v.publish("variability-Options-set-editable",e._isModelVariabilityEditable)}}),this._eventManagerOptions.forEach(function(e){v.subscribe(e.eventName,e.callback)})},render:function(){this._initializeItemsList();var t=e.createElement("div",{styles:{width:"100%",height:"100%",position:"relative"}});return this._itemsListPresenter.inject(t),this.container.setContent(t),this.container.setStyle("height","100%"),this._parent(),this},loadData:function(e){this.dictionaryJSON=e||{},this.isDictionaryLoaded=!0,this._mEvtForListAndDataManager.publish({event:"variability-load-full-dictionary",data:this.dictionaryJSON}),this._itemsListPresenter.isDictionaryLoaded||this._mEvtForListAndDataManager.publish({event:C.EVT_MODEL_VER_VARIABILITY_AVAILABLE,data:this.dictionaryJSON}),this._mEvtForListAndDataManager.publish({event:"xmodel-list-data-remove-wait-for-search"})},loadFirstLevelData:function(){if(this.isDictionaryLoaded)this._mEvtForListAndDataManager.publish({event:C.EVT_MODEL_VER_VARIABILITY_AVAILABLE,data:this.dictionaryJSON});else{var e=g.getCustomAttributeStatus(this._pathVariability);l.getVariabilityDefinition({componentId:this.modelId,expandLevel:1,content:{attributes:1,customerAttributes:e,parameters:!0,attributeList:["_image"]}}).then(e=>{this.isDictionaryLoaded||(this.dictionaryJSON=e,this._itemsListPresenter.isDictionaryLoaded=!1,this._mEvtForListAndDataManager.publish({event:C.EVT_MODEL_VER_VARIABILITY_AVAILABLE,data:this.dictionaryJSON}),this._mEvtForListAndDataManager.publish({event:"xmodel-list-data-add-wait-for-search"}))},()=>{})}},_initializeItemsList:function(){this._itemsListPresenter=new a;var e={mvId:this.modelId,someOptions:"Options for Variability List Presenter",tagFriends:"MVVariabilityTagProxy",settings:s.getVariabilityListSettings(),editable:this._isModelVariabilityEditable};this._itemsListPresenter.init(this._mEvtForListAndDataManager,this._applicationChannel,e)},createAndAddItemHandler:function(t){e.log("Create And Add Item handler");var i,n,a=this,o=!1;switch(t.type){case"variant":i=t.type,n=y.newVariant;break;case"variabilityGroup":i=t.type,n=y.newOptionGroup;break;case"parameter":i=t.type,n=y.newNumerical,o=!0;break;default:return void e.log("Wrong input to crete and item handler!!")}var s=a._createModelEvent.subscribe({event:"enox-dialog-creation"},function(t){var i;e.log(t),e.log("Create Handler: "+t.content.title),e.is(t.content.minValue,"string")?(i={type:"",versionName:"1.0",attributes:{title:t.content.title,description:t.content.description,minValue:t.content.minValue,maxValue:t.content.maxValue}},t.content.dimension&&(i.dimension=t.content.dimension)):i={type:"",versionName:"",attributes:{title:t.content.title,description:t.content.description}},a._mEvtForListAndDataManager.publish({event:C.EVT_CREATE_DICO_ITEM_N_ALLOCATE,data:{type:t.id?t.id:"",image:t.content.image?t.content.image:"",items:[i]}})});this._createModelEvent.subscribeOnce({event:"enox-dialog-on-show"},function(){}),this._createModelEvent.subscribeOnce({event:"enox-dialog-on-hide"},function(){a._createModelEvent.unsubscribe(s)}),m.show({id:i,context:{model:a.modelId},modelEvent:a._createModelEvent,title:n,withCreateAndClose:!0,isNewNumerical:o,dimensions:this.dimensionsForNumericalParameter})},createValueAction:function(t,i){var n=this,a=n._createModelEvent.subscribe({event:"enox-dialog-creation"},function(a){e.log(a);var o={title:a.content.title,description:a.content.description};l.createDicoValue({items:[{type:"",versionName:"",attributes:o}]},t).then(function(e){var n=e.member[0];a.content.image?r.uploadImage(n.id,a.content.image).then(function(e){e&&(n.image=e),i(t,[n],"Value")},function(){i(t,[n],"Value")}):i(t,[n],"Value")},function(e){E.showError({action:b.CREATE,type:b.TYPE_VALUE,message:e}),n._createModelEvent.publish({event:"enox-dialog-creation-done"})})});n._createModelEvent.subscribeOnce({event:"enox-dialog-on-hide"},function(){n._createModelEvent.unsubscribe(a)}),m.show({id:"value",context:{model:n.modelId},modelEvent:n._createModelEvent,title:y.newValue,withCreateAndClose:!0})},createOptionAction:function(t,i){var n=this,a=n._createModelEvent.subscribe({event:"enox-dialog-creation"},function(a){e.log(a);var o={title:a.content.title,description:a.content.description};l.createDicoOption({items:[{type:"",versionName:"",attributes:o}]},t).then(function(e){var n=e.member[0];a.content.image?r.uploadImage(n.id,a.content.image).then(function(e){e&&(n.image=e),i(t,[n],"Option")},function(){i(t,[n],"Option")}):i(t,[n],"Option")},function(e){E.showError({action:b.CREATE,type:b.TYPE_OPTION,message:e}),n._createModelEvent.publish({event:"enox-dialog-creation-done"})})});n._createModelEvent.subscribeOnce({event:"enox-dialog-on-hide"},function(){n._createModelEvent.unsubscribe(a)}),m.show({id:"option",context:{model:n.modelId},modelEvent:n._createModelEvent,title:y.newOption,withCreateAndClose:!0})},initializeVariabilityView:function(){return i.unmask(this.container),this}})}),define("DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoItemsPresenter",["UWA/Core","DS/CoreEvents/ModelEvents","UWA/Element","DS/WebappsUtils/WebappsUtils","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/TreeModel/TreeDocument","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/CustomAttributesManager","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/SearchAndExpandManager","DS/ENOXModelApp/Utils/xModelDictionaryUtility","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/xDimensionManager/assets/nls/xUnitLabelLong","i18n!DS/xDimensionManager/assets/nls/xDimentions","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/NumericalDialogFields","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/VariabilityPresenter"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x){"use strict";var R=function(){};return R.prototype.init=function(i,n,a){this.isNumericalParameter=a.isNumericalParameter,this.mySettings=e.clone(a.settings),this.mySettings.appPreferencePath=this.mySettings.appPreferencePath||"",this._isDestroyed=!1,this._infoContext=this.mySettings.infoContext,this._applicationChannel=n,this._localChannelForListView=i||new t,this._updateChannelLocal=new t,this._vcInfoPresenterModelEvents=new t,this._myEventManager=new _(this._applicationChannel,this._localChannelForListView,this._updateChannelLocal,this._vcInfoPresenterModelEvents),this._relatedObjectsCmd=new S,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._tagActivated=!1,this._enableFetchOnEveryExpand=!0,this._withCustomAttributes=!1,this._customAttributeColumns=null;var o={updateChannel:this._updateChannelLocal};e.merge(o,this.mySettings.searchExpand),e.merge(o,{searchPredicates:["physicalid"],expandPredicates:["physicalid","owner","organization","project","ds6w:identifier","ds6w:label","ds6w:description","ds6w:status","ds6w:type","ds6w:responsible","ds6w:state","ds6w:modified","ds6w:created","ds6w:organizationResponsible"]}),this._searchExpandMgr=new f(o),this.loadCustomColumns();var s={applicationChannel:this._applicationChannel,context:this._infoContext,silent:!0};c.initialize(s),this._xModelListView=null,this._initListView(),this.tagFriends=this.mySettings.tagFriends||void 0,this.tagProxyName=void 0===this.mySettings.tagProxyName?"ItemsTagProxy":this.mySettings.tagProxyName,this._initDOM(),this._initCommand(),this._subscribeToEvents(),this.loadWithCustom=!1,this._updateChannelLocal.publish({event:"enox-collection-toolbar-disable-action",data:"delete"}),this.logMessageAtConsole=function(t){e.log(t)}},R.prototype.loadCustomColumns=function(){var t,i,n=this;"Variant"===n.mySettings.infoContext?(t="Variant",i="Variant Value"):"OptionGroup"===n.mySettings.infoContext?(t="Variability Group",i="Variability Option"):(t="Variant Parameter",i=""),p.getCustomAttribute([t,i]).then(function(t){if(t&&t.length>0){var i=y.getVisibleColumns(n.mySettings.appPreferencePath);n._customAttributeColumns=p.getColumnsToAdd(t,i,{infoContext:n._infoContext});let a=t.filter(t=>t._not_matching_attr&&e.is(i,"array")&&i.includes(t.Name));e.is(a,"array")&&a.length>0&&D.showWarning(e.String.format(P.custom_attributes_not_matching,a[0].NLS)),n._localChannelForListView.publish({event:"custom-attributes-loading-done",data:n._customAttributeColumns})}},function(){})},R.prototype._initCommand=function(){this._command=new h(this._localChannelForListView,this._container,this._applicationChannel)},R.prototype.compareCreationDateFunction=function(e,t){if(e&&t){var i=new Date(e),n=new Date(t),a=-2;return i.getTime()===n.getTime()?a=0:i.getTime()>n.getTime()?a=1:i.getTime()<n.getTime()?a=-1:void 0===i&&void 0!==n&&(a=2),a}},R.prototype._getListViewActions=function(){var e=this,t={id:"create",text:this.mySettings.NLS.createItemTitle,fonticon:"plus",handler:function(){var t;switch(e.mySettings.infoContext){case"Variant":t=I.TYPE_VARIANT;break;case"OptionGroup":t=I.TYPE_OptionGroup;break;case"Parameter":t=I.TYPE_PARAMETER}M.checkActionAccess({action:I.CREATE,type:t,notify:!0})&&e.createCreationDialog(e._localChannelForListView,e.mySettings.settingsFor)}},i={id:"open",title:e.mySettings.NLS.openItemCmdTitle,text:e.mySettings.NLS.openItemCmdText,showOnSelection:!0,unSupportedTypes:["Variant Value","Variability Option"],fonticon:"open",category:"open",handler:function(){let t=e._xModelListView._getSelectedItem()[0];u.navigate(e.mySettings.routes.DetailsPageRoute,{id:t.id,name:t.title,version:t.version})}},n={id:"expand",category:"view",fonticon:"flow-tree-expand-down",text:P.get("EXPAND_CONTENT"),unSupportedTypes:["Variant Value","Variability Option"],showOnSelection:!0,title:e._expandLabel?e._expandLabel:P.get("EXPAND_CONTENT"),handler:function(t,i){i[0].expand(),e._checkExpansionAndHideAction(i)}},a={id:"collapse",category:"view",fonticon:"flow-tree-expand-up",text:P.get("COLLAPSE_CONTENT"),unSupportedTypes:["Variant Value","Variability Option"],showOnSelection:!0,title:e._collapseLabel?e._collapseLabel:P.get("COLLAPSE_CONTENT"),handler:function(t,i){i[0].collapse(),e._checkExpansionAndHideAction(i)}},o={id:"maturityState",title:P.get("MATURITY"),text:P.get("MATURITY"),showOnSelection:!0,category:"lifecycle",fonticon:"collaborative-lifecycle-management",handler:function(t){e._command._handleMaurityCommand(t)}},s={id:"changeOwnership",title:P.get("CHANGE_OWNERSHIP"),text:P.get("CHANGE_OWNERSHIP"),fonticon:"move-to",category:"collaboration",showOnSelection:!0,handler:function(){let t=e._xModelListView._getSelectedItem();M.checkActionAccess({action:I.MOVE,notify:!0})&&e._command._handleChangeOwnerCommand(t)}},r={id:"delete",text:this.mySettings.NLS.deleteItemTitle,fonticon:"trash",category:"destructive",showOnSelection:!0,handler:function(t){if(M.checkActionAccess({action:I.DELETE,notify:!0})){var i=t.map(function(e){return{id:e.id,title:e.label}});e.createDeleteModelDialog(i,e._localChannelForListView)}}};return this.isNumericalParameter?[t,o,s,r]:[t,i,n,a,o,s,e._relatedObjectsCmdObj,r]},R.prototype._getListViewGridColumns=function(){var e=this,t={text:P.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",getCellEditableState:function(e){if(e&&e.nodeModel&&e.nodeModel.options){var t=e.nodeModel.options.grid;if(M.checkActionAccess({action:I.MODIFY,type:t.type,state:t.state,notify:!1})&&e.rowID>=0&&e.nodeModel&&e.nodeModel.options.grid.id)return!0}return!1},getCellSemantics:function(t){var i={};if(t&&t.nodeModel&&t.nodeModel.options){var n=t.nodeModel.options.grid;n&&n.type&&e.mySettings.types.item===n.type?i.linkDisplay=!0:i.linkDisplay=!1}return i}},i={text:P.NAME,dataIndex:"name"},n={text:P.DESCRIPTION,dataIndex:"description",editableFlag:!0,getCellEditableState:function(e){if(e&&e.nodeModel&&e.nodeModel.options){var t=e.nodeModel.options.grid;return M.checkActionAccess({action:I.MODIFY,type:t.type,state:t.state,notify:!1})}return!1}},a={text:P.MATURITY_STATE,dataIndex:"state",getCellTypeRepresentation:function(t){var i="url";return t&&t.nodeModel&&t.nodeModel.getNodeDepth()!==(e._xModelListView.isGrouped()?1:0)&&(i="string"),i},groupableFlag:!0,hyperlinkTarget:"_self",getCellValue:function(t){if(t&&t.nodeModel){var i=t.nodeModel.options.grid,n="";return n=i.nlsValues&&i.nlsValues.nlsState?i.nlsValues.nlsState:i.state,t.nodeModel.getNodeDepth()!==(e._xModelListView.isGrouped()?1:0)?n:{label:n,url:"#Maturity"}}},getCellGroupingKey:function(e){var t=e.nodeModel.options.grid,i="";return void 0!==t&&(i=t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state?t.state:t.maturity?t.maturity:""),i}},o={text:P.OWNER,dataIndex:"owner",visibleFlag:!0,typeRepresentation:"url",groupableFlag:!0,hyperlinkTarget:"_self",getCellValue:function(e){return{label:e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:e.nodeModel.options.grid.responsible,url:"#Owner"}},getCellGroupingKey:function(e){return e.nodeModel.options.grid.owner}},s={text:P.CREATION_DATE,compareFunction:e.compareCreationDateFunction,dataIndex:"created",getCellValue:function(e){if(e.nodeModel.options.grid.created)return m.formatDateAttribute(e.nodeModel.options.grid.created)}},r={text:P.MODIFICATION_DATE,compareFunction:e.compareCreationDateFunction,dataIndex:"modified",getCellValue:function(e){if(e.nodeModel.options.grid.modified)return m.formatDateAttribute(e.nodeModel.options.grid.modified)}},l={text:P.COLLABSPACE,dataIndex:"collabspace",groupableFlag:!0},d={text:P.ORGANIZATION,dataIndex:"organization",groupableFlag:!0,getCellValue:function(e){if(e.nodeModel.options.grid.organization)return g.getOrganzationNLS(e.nodeModel.options.grid.organization)||e.nodeModel.options.grid.organization}},c={text:P.UNIT,groupableFlag:!0,dataIndex:"unit",valueAttribute:["minValue"],getCellValue:function(e){if(e.nodeModel.options.grid.hasOwnProperty("minValue")){var t=e.nodeModel.options.grid.minValue.split(" ");if(t.length>1)return w.get(t[1])}return" "}},p={text:P.RANGE,sortableFlag:!1,dataIndex:"range",valueAttribute:["minValue","maxValue"],width:100,kind:["instance"],getCellValue:function(e){var t="";if(e.nodeModel.options.grid.hasOwnProperty("minValue")&&e.nodeModel.options.grid.hasOwnProperty("maxValue")){var i=e.nodeModel.options.grid.minValue.split(" ")[0],n=e.nodeModel.options.grid.maxValue.split(" ")[0];i&&n&&(t=i+x.RangeValueDelimiter+n)}return t}},u={text:P.DIMENSION,groupableFlag:!0,dataIndex:"dimension",valueAttribute:["dimension"],width:100,kind:["instance"],getCellValue:function(e){var t=" ";return e.nodeModel.options.grid.hasOwnProperty("dimension")?(t=e.nodeModel.options.grid.dimension,"Integer"===(t=O.get(t))||"Real"===t?T._noDimensionLabel:t):t}};return e.isNumericalParameter?[t,i,p,c,u,n,a,o,s,r,l,d]:[t,i,n,a,o,s,r,l,d]},R.prototype._initListView=function(){var e,t=this,i=new d({}),a=y.getSort(this.mySettings.appPreferencePath);a&&a.sortAttribute&&a.sortOrder&&(e={id:a.sortAttribute,order:a.sortOrder});let o={id:this.mySettings.listViewId,model:i,modelEvents:this._localChannelForListView,useAsyncExpand:this.mySettings.useAsyncExpand,defaultNodeDepth:2,useDragAndDrop:!0,childKeys:this.mySettings.childKeys,withProgressBar:!0,viewOptions:{expandLabel:this.mySettings.expandLabel,collapseLabel:this.mySettings.collapseLabel,views:this.mySettings.views,currentView:y.getView(this.mySettings.appPreferencePath),currentSort:e,onDelayedModelDataRequest:function(e){e&&e.startNodeIndex>-1&&e.endNodeIndex>-1&&t._imageLoadHandler(e).then(function(e){if(e&&e.member&&e.idNodeMap){var t=e.idNodeMap;e.member.forEach(function(e){if(e&&e.id&&t[e.id]){var i=e.image;t[e.id].updateOptions({icons:[i],thumbnail:i,grid:{image:i},imageLoaded:!0})}})}},function(){t.logMessageAtConsole("Warning!!! Image loading handler is rejected.")})},grid:{columns:t._getListViewGridColumns()},editable:!0,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){var t="";if(e.options.grid){var i=e.options.grid;t=i.nlsValues&&i.nlsValues.nlsState?i.nlsValues.nlsState+" | "+(i.owner?i.owner:i.responsible):i.state+" | "+(i.owner?i.owner:i.responsible)}return t},description:"description",customTooltip:function(e){return m.prepareTooltipObjectView(e)},icon:function(e){var t;switch(e.options.grid.type){case"Variant":t=n.getWebappsAssetUrl("ENOXModelApp","icon/variant.png");break;case"Variant Value":t=n.getWebappsAssetUrl("ENOXModelApp","icon/variantValue.png");break;case"Variability Group":t=n.getWebappsAssetUrl("ENOXModelApp","icon/optionGroup.png");break;case"Variability Option":t=n.getWebappsAssetUrl("ENOXModelApp","icon/option.png");break;default:t=""}return t}},contextualActions:function(){var e=[],i=this.getNodeDepth()===(t._xModelListView.isGrouped()?1:0);i&&(t.isNumericalParameter||(e.push({id:"open",title:t.mySettings.NLS.openItemCmdTitle,text:t.mySettings.NLS.openItemCmdText,fonticon:"open",multiselect:!1,handler:function(e){u.navigate(t.mySettings.routes.DetailsPageRoute,{id:e.id,name:e.title,version:e.version})}}),e.push({type:"SeparatorItem"}),e.push({id:"createValue",title:t.mySettings.NLS.createChildItemTitle,text:t.mySettings.NLS.createChildItemText,fonticon:"plus",handler:function(e){M.setParent({state:e.state,type:e.type});var i=this;switch(t.mySettings.settingsFor){case"VariantsPresenter":M.checkActionAccess({action:I.CREATE,type:I.TYPE_VALUE,notify:!0})&&b.show({id:"variant-value",context:{nodeModel:i,model:e},modelEvent:t._localChannelForListView,title:P.newValue,withCreateAndClose:!0});break;case"OptionGroupPresenter":M.checkActionAccess({action:I.CREATE,type:I.TYPE_OPTION,notify:!0})&&b.show({id:"option",context:{nodeModel:i,model:e},modelEvent:t._localChannelForListView,title:P.newOption,withCreateAndClose:!0});break;default:t._createSubItem({id:e.id}).then(function(e){e&&(i.isExpanded()?(t._localChannelForListView.publish({event:"xmodel-list-data-item-add-action",data:e,context:i}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"})):i.expand())})}M.destroy()}}),e.push({type:"SeparatorItem"})));var n={id:"delete",title:t.mySettings.NLS.deleteCmdTitle,text:t.mySettings.NLS.deleteCmdText,fonticon:"trash",handler:function(e,i){var n;switch(this.options.grid.type){case"Variability Group":n=I.TYPE_OptionGroup;break;case"Variant":n=I.TYPE_VARIANT;break;case"Variability Option":n=I.TYPE_OPTION;break;case"Variant Value":n=I.TYPE_VALUE}if(M.checkActionAccess({action:I.DELETE,type:n,state:e.state,nlsState:e.nlsValues.nlsState?e.nlsValues.nlsState:"",notify:!0})&&e){var a=i.map(function(e){return{id:e.id,title:e.title}});t.createDeleteModelDialog(a,t._localChannelForListView)}M.destroy()}};return i&&e.push({id:"maturityState",title:P.get("MATURITY"),text:P.get("MATURITY"),fonticon:"collaborative-lifecycle-management",handler:function(e,i){t._command._handleMaurityCommand(i)}},{type:"SeparatorItem"}),e.push({id:"changeOwnership",title:P.get("CHANGE_OWNERSHIP"),text:P.get("CHANGE_OWNERSHIP"),fonticon:"move-to",handler:function(e,i){M.checkActionAccess({action:I.MOVE,notify:!0})&&t._command._handleChangeOwnerCommand(i)}}),e.push({type:"SeparatorItem"}),t.isNumericalParameter||e.push(t._relatedObjectsCmdObj),e.push({id:"information",title:t.mySettings.NLS.infoCmdTitle,text:t.mySettings.NLS.infoCmdText,fonticon:"info",handler:function(){t._applicationChannel.publish({event:"information-panel-open"})}}),e.push({type:"SeparatorItem"}),e.push(n),e}},emptyContentOptions:{sentences:[{type:"img",src:this.mySettings.emptyContent.src,sizeicon:"40px",text:this.mySettings.emptyContent.message}]},withmultisel:!0,toolbarOptions:{itemsName:this.mySettings.NLS.itemsName,itemName:this.mySettings.NLS.itemName,withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,touchMode:!1,hideOnMultiSelection:this.isNumericalParameter?void 0:["open","collapse","expand"],groupByActionIndex:1,actions:this._getListViewActions()},extensions:[r,l]};t.isNumericalParameter&&(o.viewOptions.customGrouping={label:P.DIMENSION+", "+P.UNIT,groupedData:["dimension","unit"]}),this._listViewOptions=o,this._xModelListView=new s(o)},R.prototype.createCreationDialog=function(e,t){switch(t){case"VariantsPresenter":b.show({id:"variant",modelEvent:e,title:P.newVariant,withCreateAndClose:!0});break;case"OptionGroupPresenter":b.show({id:"option-group",modelEvent:e,title:P.newOptionGroup,withCreateAndClose:!0});break;case"ParametersPresenter":b.show({id:"parameter",modelEvent:this._localChannelForListView,title:P.newNumerical,withCreateAndClose:!0,isNewNumerical:!0});break;default:this._createItem()}},R.prototype._createItem=function(t){var i,n=this;n._localChannelForListView.publish({event:"xmodel-list-data-on-load-start"}),e.is(t,"object")||(t={}),e.merge(t,{name:""}),n._patchForUploadingImage=t.image?t.image:void 0,n._patchIdObject=void 0,t.image=void 0;var s={items:[{type:"",versionName:"",attributes:t}]};this.isNumericalParameter&&(s.items[0].dimension=t.dimension,delete t.dimension),a[this.mySettings.serviceHandlers.createItem](s).then(function(e){n.logMessageAtConsole("Create Item : On Complete: "+e),i=e.member[0].id,n._patchIdObject=e.member[0].id,n._patchForUploadingImage?o.uploadImage(i,n._patchForUploadingImage).then(function(){n.createPostProcess(n._patchIdObject)},function(){n.logMessageAtConsole("uploadImage: Service Call Failed !!!"),n.createPostProcess(n._patchIdObject)}):n.createPostProcess(i)},function(){n._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),n.logMessageAtConsole("Create Item : Service Call Failed !!!"),D.showError(n.mySettings.NLS.createItemError)})},R.prototype.createPostProcess=function(e){var t=this,i=y.getCustomAttributeStatus(t.mySettings.appPreferencePath);a[t.mySettings.serviceHandlers.getItemDetails]({id:e,customAttributeFlag:i}).then(function(e){var i=y.getGroup(t.mySettings.appPreferencePath);t.logMessageAtConsole("getItemDetails: Service Call Successful !!!"),"string"==typeof e&&(e=e.replaceAll(String.fromCharCode(7),","),e=JSON.parse(e));var n={};for(var a in t._updateNodeModel(e),e.member[0]){var o,s;if("customerAttributes"===a)for(o in e.member[0].customerAttributes)for(s in e.member[0].customerAttributes[o]){if(window.widget)if("OnPremise"!==window.widget.getValue("x3dPlatformId"))n[s.split("__")[0]]=e.member[0].customerAttributes[o][s];else n[s]=e.member[0].customerAttributes[o][s]}e.member[0].hasOwnProperty(a)&&"customerAttributes"!==a&&(n[a]=e.member[0][a])}var r=n;t._localChannelForListView.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){t._localChannelForListView.publish({event:"xmodel-list-unselect-all"}),e.select()}),t._localChannelForListView.publish({event:"xmodel-list-data-item-add-action",data:r}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),t._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:y.getSort(t.mySettings.appPreferencePath)}),i&&t._localChannelForListView.publish({event:"xmodel-list-view-group-by-action",data:i}),t._localChannelForListView.publish({event:"enox-dialog-creation-done"}),D.showSuccess(P._creation_successful)},function(){t.logMessageAtConsole("getItemDetails: Service Call Failed !!!"),D.showError(t.mySettings.NLS.getItemDetailsError),t._localChannelForListView.publish({event:"enox-dialog-creation-done"}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"})})},R.prototype._createSubItem=function(t,i){var n=e.merge(i,{name:""}),s=this;return s._patchForUploadingImage=n.image?n.image:void 0,s._patchIdObject=void 0,n.image=void 0,a[this.mySettings.serviceHandlers.createSubItem]({items:[{type:"",versionName:"",attributes:n}]},t).then(function(e){var i=e.member[0].id;return s._patchIdObject=e.member[0].id,s._patchForUploadingImage?o.uploadImage(i,s._patchForUploadingImage).then(function(){return s.createChildPostProcess(s._patchIdObject,t)},function(){return s.logMessageAtConsole("uploadImage: Service Call Failed !!!"),s.createChildPostProcess(s._patchIdObject,t)}):s.createChildPostProcess(i,t)},function(){D.showError(s.mySettings.NLS.createSubItemError)})},R.prototype.createChildPostProcess=function(e,t){var i=this;return a[i.mySettings.serviceHandlers.getSubItemDetails]({id:e,parentID:t}).then(function(e){i._updateNodeModel(e);var t={};for(var n in e.member[0])e.member[0].hasOwnProperty(n)&&(t[n]=e.member[0][n]);var a=t;return i._localChannelForListView.publish({event:"enox-dialog-creation-done"}),D.showSuccess(P._creation_successful),a},function(){D.showError(i.mySettings.NLS.getSubItemDetailsError),i._localChannelForListView.publish({event:"enox-dialog-creation-done"})})},R.prototype._updateNodeModel=function(e){var t=e.member[0];t.hasOwnProperty(v._ORG_TITLE)&&(t[v._ORG_TITLE]=""),t.hasOwnProperty(v._COLLABSPACE_TITLE)&&(t[v._COLLABSPACE_TITLE]="")},R.prototype._checkExpansionAndHideAction=function(e){if(!this.isNumericalParameter){let t=this,i=!1;1!==e.length||["Variability Option","Variant Value"].includes(e[0].options.grid.type)?(t._localChannelForListView.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"expand",flag:!1}}),t._localChannelForListView.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"collapse",flag:!1}})):(i=e[0].isExpanded(),t._localChannelForListView.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"expand",flag:!i}}),t._localChannelForListView.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"collapse",flag:i}}))}},R.prototype._checkUnSupportedType=function(e){let t=this;1==e.length&&t._listViewOptions.toolbarOptions.actions.forEach(i=>{i.unSupportedTypes&&i.unSupportedTypes.includes(e[0].options.grid.type)&&t._localChannelForListView.publish({event:"enox-collection-toolbar-visibility-action",data:{id:i.id,flag:!1}})})},R.prototype._initDOM=function(){this._container=e.createElement("div"),this._container.style.width=this._container.style.height="100%",this._xModelListView.inject(this._container)},R.prototype.loadData=function(t){var i=this;window.localStorage&&"true"===window.localStorage.ENOXModelApp_ENTERPRISE_DICO_LOAD_USE_V0?(i._localChannelForListView.publish({event:"xmodel-list-data-on-load-start"}),a[this.mySettings.serviceHandlers.getItems]().then(function(e){i._localChannelForListView.publish({event:"xmodel-list-data-load-action",data:e}),i._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"});var t=y.getSelectedItems(i.mySettings.appPreferencePath);t&&t.length>0&&i._localChannelForListView.publish({event:"xmodel-list-selection-action",data:t});var n=y.getGroup(i.mySettings.appPreferencePath);i._localChannelForListView.publish({event:"xmodel-list-view-group-by-action",data:n}),i._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:y.getSort(i.mySettings.appPreferencePath)})},function(e){i.logMessageAtConsole(" : On Failure: "+e),D.showError(i.mySettings.NLS.getItemsError),i._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"})})):(this._localChannelForListView.publish({event:"xmodel-list-data-on-load-start"}),this._localChannelForListView.publish({event:"xmodel-list-show-progress-bar"}),this._searchExpandMgr.performSearch(t).then(function(n){var a=void 0!==t;n&&i._searchExpandMgr.performExpand(n.idList).then(function(t){var o=n.currentCount===n.numberOfHits,s=n.currentCount/n.numberOfHits*100;try{var r=i._searchExpandMgr._parseExpandResponse(t)}catch(t){t.errors.forEach(t=>D.showError(e.String.format(P.index_loading_error,t.code,t.reason)))}g.allSettled().then(function(){i._updateChannelLocal.publish({event:"evt-populate-xmodel-list",data:{items:r,append:a,loadComplete:o}})}),i._updateChannelLocal.publish({event:"evt-update-xmodel-list-progress-bar",data:{progress:s}}),n.nextRequestData&&i._updateChannelLocal.publish({event:"evt-perform-search-for-next-lot",data:{nextRequestData:n.nextRequestData,currentCount:n.currentCount}})},function(){i.logMessageAtConsole("Warning!!! Expand failed"),i._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),i._localChannelForListView.publish({event:"xmodel-list-hide-progress-bar"})})},function(){i.logMessageAtConsole("Warning!! perfrom search rejected"),i._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),i._localChannelForListView.publish({event:"xmodel-list-hide-progress-bar"})}))},R.prototype.getContent=function(){return this._container},R.prototype._subscribeToEvents=function(){var t=this;this._myEventManager.subscribe(this._updateChannelLocal,"evt-populate-xmodel-list",function(e){if(e&&e.items&&e.items.length>0&&(t.logMessageAtConsole(">> evtData.items:  "+e.items.length),t._localChannelForListView.publish({event:e.append?"xmodel-list-data-item-append-action":"xmodel-list-data-load-action",data:{member:e.items}}),e.loadComplete)){t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"});var i=y.getSelectedItems(t.mySettings.appPreferencePath);i&&i.length>0&&t._localChannelForListView.publish({event:"xmodel-list-selection-action",data:i});var n=y.getGroup(t.mySettings.appPreferencePath);n&&0!==n.length||!t.isNumericalParameter||(n=["dimension","unit"]),t._localChannelForListView.publish({event:"xmodel-list-view-group-by-action",data:n}),t._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:y.getSort(t.mySettings.appPreferencePath)})}}),this._myEventManager.subscribe(this._localChannelForListView,{event:"custom-attributes-loading-done"},function(e){t._localChannelForListView.publish({event:"xmodel-list-add-columns",data:e})}),this._myEventManager.subscribe(this._updateChannelLocal,"evt-update-xmodel-list-progress-bar",function(e){e&&e.progress&&(t.logMessageAtConsole(">> evtData.progress:  "+e.progress),t._localChannelForListView.publish({event:"xmodel-list-update-progress-bar",data:e.progress}))}),this._myEventManager.subscribe(this._updateChannelLocal,"evt-perform-search-for-next-lot",function(e){e&&e.nextRequestData&&t.loadData(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-dialog-creation"},function(e){if(e.context)switch(t.mySettings.listViewId){case"Option Group":case"optionGroup":case"Variant":case"variant":t._createSubItem(e.context.model.id,e.content).then(function(i){i&&(t._localChannelForListView.publish({event:"xmodel-list-data-item-add-action",data:i,context:e.context.nodeModel}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),e.context.nodeModel.isExpanded()||e.context.nodeModel.expand())});break;default:t._createItem(e.content)}else t._createItem(e.content)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-dialog-delete"},function(e){t._deleteItems(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-link-click"},function(e){t._localChannelForListView.publish({event:"xmodel-execute-command",data:e})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"list-view-update-inline-action"},function(i){if(i&&i.model&&i.name&&void 0!==i.value){if(e.is(t._customAttributeColumns,"array")&&t._customAttributeColumns.find(e=>e.dataIndex===i.name))return;var a=i.model[0],o=i.cell.nodeModel,s={icons:[n.getWebappsAssetUrl("ENOXModelApp","icon/loading-animation.gif")]};o.updateOptions(s),t._editionHandler(a,i.name,i.value.trim(),a.type)}}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-add-selection"},function(e){if(e.items){var i=e.model,n=e.items.map(function(e){return e.options.id});let a=[];!0===e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;a.push(t)}):a.push(i.id),c.addSelection(a,t._infoContext),setTimeout(function(){t._checkExpansionAndHideAction(e.items),t._checkUnSupportedType(e.items)},50),y.updateSelectedItems(t.mySettings.appPreferencePath,n)}}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-remove-selection"},function(e){var i=e.model;let n=[];if(!0===e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;n.push(t)}):n.push(i.id),c.removeSelection(n,t._infoContext),e.items){var a=e.items.map(function(e){return e.options.id});y.updateSelectedItems(t.mySettings.appPreferencePath,a)}setTimeout(function(){t._checkExpansionAndHideAction(e.items),t._checkUnSupportedType(e.items)},50)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-node-expanded"},function(e){let i=e.item;t._checkExpansionAndHideAction(i)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-empty-selection"},function(){c.removeAllSelection(t._infoContext),y.updateSelectedItems(t.mySettings.appPreferencePath,[])}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-dblclick"},function(e){var i=e.model;M.setParent({type:i.type,state:i.state}),this.getNodeDepth()===(t._xModelListView.isGrouped()?1:0)&&(t._needRefresh=!0,u.navigate(t.mySettings.routes.DetailsPageRoute,{id:i.id,name:i.title}))}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-title-link-click"},function(e){var i=e.model;this.getNodeDepth()===(t._xModelListView.isGrouped()?1:0)&&(t._needRefresh=!0,u.navigate(t.mySettings.routes.DetailsPageRoute,{id:i.id,name:i.title}))}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-on-save-custom-view"},function(e){y.updateVisibleColumns(t.mySettings.appPreferencePath,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-on-custom-view-save"},function(i){t.loadWithCustom=t._withCustomAttributes,t._visibleCustomAttrbutesList?i&&(e.equals(t._visibleCustomAttrbutesList,i)&&(t._withCustomAttributes=!1),t._withCustomAttributes=!0):(t._visibleCustomAttrbutesList=i,t._withCustomAttributes=!0),y.updateCustomAttributeStatus(t.mySettings.appPreferencePath,t._withCustomAttributes),t.loadWithCustom||t.loadData()}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-setup"},function(){t._tagActivated||t._localChannelForListView.publish({event:"xmodel-list-tagger-deactivate-action"})}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._localChannelForListView,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._localChannelForListView,e,this)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-collection-toolbar-switch-view-activated"},function(e){y.updateView(t.mySettings.appPreferencePath,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-collection-toolbar-sort-activated"},function(e){y.updateSort(t.mySettings.appPreferencePath,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-view-group-by-action"},function(e){y.updateGroup(t.mySettings.appPreferencePath,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-filter-change"},function(e){e&&y.setTagFilter(t.mySettings.appPreferencePath,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-setup"},function(){var e=y.getTagFilter(t.mySettings.appPreferencePath);e&&t._localChannelForListView.publish({event:"xmodel-list-tagger-set-filter-action",data:e})})},R.prototype._editionHandler=function(e,t,i,n){var o=this;if(n&&e){if("title"===t&&null==i||e[t]===i)return void o._localChannelForListView.publish({event:"xmodel-list-data-item-update-action",data:e});var s={};s[t]=i;var r=n.trim(),l=r===this.mySettings.types.item?this.mySettings.serviceHandlers.patchItem:r===this.mySettings.types.subItem?this.mySettings.serviceHandlers.patchSubItem:void 0,d=r===this.mySettings.types.item?this.mySettings.NLS.patchItemError:r===this.mySettings.types.subItem?this.mySettings.NLS.patchSubItemError:"Patch Service Handler failed...";void 0!==l&&a[l](e.id,s).then(function(e){o.logMessageAtConsole("Patch: Service Call Success !!!"),o._localChannelForListView.publish({event:"xmodel-list-data-item-update-action",data:e.member[0]}),c.refresh(o._infoContext)},function(t){o.logMessageAtConsole("Patch: Service Call Failed !!!"),o._localChannelForListView.publish({event:"xmodel-list-data-item-update-action",data:e}),A.showError({mandatoryErrCodeCheck:!1,action:I.MODIFY,type:e.type,message:t})||D.showError(d)})}},R.prototype._refreshListView=function(e,t,i){var n,o=this;n=y.getCustomAttributeStatus(o.mySettings.appPreferencePath),void 0!==t&&(i&&i.getParent().options.id?a[this.mySettings.serviceHandlers.getSubItemDetails]({id:t,parentID:i.getParent().options.id,customAttributeFlag:n}).then(function(t){if(o.logMessageAtConsole("getItemDetails: Service Call Successful !!!"),"string"==typeof t&&(t=t.replaceAll(String.fromCharCode(7),","),t=JSON.parse(t)),t&&t.member&&t.member[0]){var n,a,s=t.member[0];if(s.hasOwnProperty("customerAttributes"))for(n in s.customerAttributes)for(a in s.customerAttributes[n])if(window.widget)if("OnPremise"!==window.widget.getValue("x3dPlatformId")){var r=a.split("__")[0];t.member[0][r]=s.customerAttributes[n][a]}else t.member[0][a]=s.customerAttributes[n][a]}o._updateNodeModel(t);var l=t.member[0];l.context=i,e.publish({event:"xmodel-list-data-item-update-action",data:l})},function(){o.logMessageAtConsole("Error!!! getSubItemDetails Call failed while handling the refresh event from the properties panel.")}):a[this.mySettings.serviceHandlers.getItemDetails]({id:t,customAttributeFlag:n}).then(function(t){if("string"==typeof t&&(t=t.replaceAll(String.fromCharCode(7),","),t=JSON.parse(t)),t&&t.member&&t.member[0]){var n,a,s=t.member[0];if(s.hasOwnProperty("customerAttributes"))for(n in s.customerAttributes)for(a in s.customerAttributes[n])if(window.widget)if("OnPremise"!==window.widget.getValue("x3dPlatformId")){var r=a.split("__")[0];t.member[0][r]=s.customerAttributes[n][a]}else t.member[0][a]=s.customerAttributes[n][a]}o.logMessageAtConsole("getItemDetails: Service Call Successful !!!"),o._updateNodeModel(t);var l=t.member[0];l.context=i,e.publish({event:"xmodel-list-data-item-update-action",data:l})},function(){o.logMessageAtConsole("Error!!! getItemDetails Call failed while handling the refresh event from the properties panel.")}))},R.prototype.getSubItems=function(e){if(void 0!==e){var t=this;return a[this.mySettings.serviceHandlers.getSubItems]({id:e}).then(function(e){return e},function(){return D.showError(t.mySettings.NLS.getSubItemsError),[]})}},R.prototype.inject=function(e){e.appendChild(this._container)},R.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this._xModelListView.destroy(),this._searchExpandMgr&&(this._searchExpandMgr.destroy(),this._searchExpandMgr=void 0),this._myEventManager&&(this._myEventManager.cleanup("EntDicoItemsPresenter For"+this.mySettings.settingsFor),this._myEventManager=null)},R.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:this.mySettings.NLS.itemName,multiple:this.mySettings.NLS.itemsName,modelEvent:t,immersiveFrame:C.getImmersiveFrame()};E.showDialog(i)},R.prototype._deleteItems=function(e){var t=this,i=e;a[this.mySettings.serviceHandlers.deleteItems]({ids:i}).then(function(){t._localChannelForListView.publish({event:"xmodel-list-data-item-remove-action",data:i}),t.logMessageAtConsole("Delete Items Successful!!!")},function(e){t.logMessageAtConsole("Failure while deleting items!!!"),A.showError({action:I.REMOVE,type:I.VARIABILITY_TAB,message:e})||D.showError(t.mySettings.NLS.deleteItemError)})},R.prototype._imageLoadHandler=function(t){var i=this;return new e.Promise(function(e,n){if(t&&t.startNodeIndex>-1&&t.endNodeIndex>-1){for(var o=t.collectionView,s=[],r={},l=t.startNodeIndex;l<=t.endNodeIndex;l++){var d=o.model[l];d&&(void 0===d.options.imageLoaded||!1===d.options.imageLoaded)&&d.options.grid&&void 0===d.options.grid.image&&void 0!==d.options.id&&(s.push(d.options.id),r[d.options.id]=d)}s.length>0&&a[i.mySettings.serviceHandlers.getItemsImage](s).then(function(t){t&&t.member&&e({member:t.member,idNodeMap:r})},function(){i.logMessageAtConsole("Warning! Could not fetch item image."),n()})}else e()})},R.prototype.publishTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-activate-action"}),this._tagActivated=!0},R.prototype.clearTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},R}),define("DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoSubItemsPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","DS/WebappsUtils/WebappsUtils","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/ENOXTabs/js/ENOXTabs","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/CustomAttributesManager","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/EnterpriseVariabilityDictionaryStatePresenter","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A){"use strict";var P=function(){};return P.prototype.init=function(t,n,a){this.mySettings=e.clone(a.settings),this._pathItemsDetail=this.mySettings.appPreferencePath,this._isDestroyed=!1,this._options=a,this._currVariantClassId="",this._privateChannel=t||new i,this._applicationChannel=n,this._localChannelForListView=new i,this._myEventManager=new m(this._applicationChannel,this._privateChannel,this._localChannelForListView);var o={applicationChannel:this._applicationChannel,context:this.mySettings.infoContext};this.loadCustomColumns(),p.initialize(o),this._relatedObjectsCmd=new C,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._listPresenter=null,this._initListView(),this._withCustomAttributes=!1,this._updateChannelLocal=new i,this.tagFriends=this._options.tagFriends,this.tagProxyName=this.mySettings.tagProxyName,this._subscribeToEvents(),this._initDOM(),this._initCommand(),this._privateChannel.publish({event:"enox-collection-toolbar-disable-action",data:"delete"}),this.loadWithCustom=!1,this._customAttributeColumns=null},P.prototype.loadCustomColumns=function(){var e,t=this;e="Values"===t.mySettings.infoContext?"Variant Value":"Variability Option",u.getCustomAttribute(e).then(function(e){if(e&&e.length>0){var i=f.getVisibleColumns(t._pathItemsDetail);t._customAttributeColumns=u.getColumnsToAdd(e,i),t._localChannelForListView.publish({event:"custom-attributes-loading-done",data:t._customAttributeColumns})}},function(){})},P.prototype._initCommand=function(){this._command=new _(this._localChannelForListView,this._container,this._applicationChannel)},P.prototype._initListView=function(){var e,t=this,i=f.getSort(this._pathItemsDetail);i&&i.sortAttribute&&i.sortOrder&&(e={id:i.sortAttribute,order:i.sortOrder});var n=[{text:A.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",getCellSemantics:function(){return{linkDisplay:!1}},editableFlag:!0,getCellEditableState:function(e){if(e&&e.nodeModel&&e.nodeModel.options){var t=e.nodeModel.options.grid;return D.checkActionAccess({action:M.MODIFY,type:t.type,state:t.state,notify:!1})}return!1}},{text:A.NAME,dataIndex:"name"},{text:A.DESCRIPTION,dataIndex:"description",editableFlag:!0,getCellEditableState:function(e){if(e&&e.nodeModel&&e.nodeModel.options){var t=e.nodeModel.options.grid;return D.checkActionAccess({action:M.MODIFY,type:t.type,state:t.state,notify:!1})}return!1}},{text:A.MATURITY_STATE,dataIndex:"state",getCellValue:function(e){var t="";if(e.nodeModel.options.grid){var i=e.nodeModel.options.grid;t=i.nlsValues&&i.nlsValues.nlsState?i.nlsValues.nlsState:i.state}return t}},{text:A.OWNER,dataIndex:"owner",visibleFlag:!0,getCellValue:function(e){return{label:e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:e.nodeModel.options.grid.responsible,url:"#Owner"}},typeRepresentation:"url",hyperlinkTarget:"_self"},{text:A.CREATION_DATE,dataIndex:"created",getCellValue:function(e){if(e.nodeModel.options.grid.created)return h.formatDateAttribute(e.nodeModel.options.grid.created)}},{text:A.MODIFICATION_DATE,dataIndex:"modified",getCellValue:function(e){if(e.nodeModel.options.grid.modified)return h.formatDateAttribute(e.nodeModel.options.grid.modified)}},{text:A.COLLABSPACE,dataIndex:v._COLLABSPACE_TITLE},{text:A.ORGANIZATION,dataIndex:v._ORG_TITLE}];n.splice(3,0,{text:I._sequenceNumber,dataIndex:"sequenceNumber",typeRepresentation:"integer",editableFlag:!0,editionPolicy:"EditionInPlace",setCellValue:function(e,i){t._updateSequenceNoAttribute(e,i)},getCellEditableState:function(e){if(e&&e.nodeModel&&e.nodeModel.options){var t=e.nodeModel.options.grid;return D.checkActionAccess({action:M.MODIFY,type:t.type,state:t.state,notify:!1})}return!1}}),n.splice(4,0,{text:I._default,dataIndex:"default",typeRepresentation:"_default",editableFlag:!0,editionPolicy:"EditionInPlace",setCellValue:function(e,i){t._updateDefaultAttribute(e,i)},getCellEditableState:function(e){if(e&&e.nodeModel&&e.nodeModel.options){var t=e.nodeModel.options.grid;return D.checkActionAccess({action:M.MODIFY,type:t.type,state:t.state,notify:!1})}return!1}});var o={id:this.mySettings.listViewId||"dicoSubItemPrsntr",modelEvents:this._localChannelForListView,useDragAndDrop:!0,viewOptions:{views:this.mySettings.views,currentView:f.getView(this._pathItemsDetail),currentSort:e||void 0,grid:{typeRepresentations:{_sequenceNumber:{stdTemplate:"spinEdit",semantics:{stepValue:1,minValue:1}},_default:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:"favorite-on"},{value:"false",icon:"favorite-off"},{value:"undefined",icon:""}]}}},columns:n},editable:!0,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){var t="";if(e.options.grid){var i=e.options.grid;return(t=i.nlsValues&&i.nlsValues.nlsState?i.nlsValues.nlsState:i.state)+" | "+(i.owner?i.owner:i.responsible)}return t},description:"description",customTooltip:function(e){return h.prepareTooltipObjectView(e)},icon:function(e){switch(e.options.grid.type){case"Variant Value":return a.getWebappsAssetUrl("ENOXModelApp","icon/variantValue.png");case"Option":return a.getWebappsAssetUrl("ENOXModelApp","icon/option.png");default:return""}}},contextualActions:[{id:"changeOwnership",title:A.get("CHANGE_OWNERSHIP"),text:A.get("CHANGE_OWNERSHIP"),fonticon:"move-to",multiselect:!0,handler:function(e,i){i&&i.length>1&&(e=i),t._command._handleChangeOwnerCommand(e)}},{type:"SeparatorItem"},t._relatedObjectsCmdObj,{id:"information",title:this.mySettings.NLS.infoCmdTitle,text:this.mySettings.NLS.infoCmdText,fonticon:"info",multiselect:!0,handler:function(){t._applicationChannel.publish({event:"information-panel-open"})}},{type:"SeparatorItem"},{id:"delete",title:this.mySettings.NLS.deleteCmdTitle,text:this.mySettings.NLS.deleteCmdText,fonticon:"trash",multiselect:!0,handler:function(e,i){var n;switch(e.type){case"Variability Option":n=M.TYPE_OPTION;break;case"Variant Value":n=M.TYPE_VALUE}if(D.checkActionAccess({action:M.DELETE,type:n,notify:!0})&&e){var a=i.map(function(e){return{id:e.id,title:e.label}});t.createDeleteModelDialog(a,t._localChannelForListView)}}}]},emptyContentOptions:{sentences:[{type:"img",src:this.mySettings.emptyContent.src,sizeicon:"40px",text:this.mySettings.emptyContent.message}]},withmultisel:!0,toolbarOptions:{itemsName:this.mySettings.NLS.itemsName,itemName:this.mySettings.NLS.itemName,withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,touchMode:!1,actions:[{id:"create",text:this.mySettings.NLS.createItemText,fonticon:"plus",handler:function(){var e;switch(t.mySettings.settingsFor){case"VariantValues":e=M.TYPE_VALUE;break;case"Options":e=M.TYPE_OPTION}D.checkActionAccess({action:M.CREATE,type:e,notify:!0})&&t.createCreationDialog(t._localChannelForListView,t.mySettings.settingsFor)}},{id:"changeOwnership",title:A.get("CHANGE_OWNERSHIP"),text:A.get("CHANGE_OWNERSHIP"),showOnSelection:!0,category:"collaboration",fonticon:"move-to",handler:function(){let e=t._listPresenter._getSelectedItem();t._command._handleChangeOwnerCommand(e)}},t._relatedObjectsCmdObj,{id:"delete",text:this.mySettings.NLS.deleteCmdText,fonticon:"trash",showOnSelection:!0,category:"destructive",handler:function(e){var i;switch(t.mySettings.settingsFor){case"VariantValues":i=M.TYPE_VALUE;break;case"Options":i=M.TYPE_OPTION}if(D.checkActionAccess({action:M.DELETE,type:i,notify:!0})){var n=e.map(function(e){return{id:e.id,title:e.label}});t.createDeleteModelDialog(n,t._localChannelForListView)}}}]},extensions:[l,d]};this._listPresenter=new r(o)},P.prototype._initDOM=function(){this._container=e.createElement("div"),this._container.style.width="100%",this._container.style.height="100%",this._titleContainer=e.createElement("div"),this._titleSpan=e.createElement("span"),this._titleSpan.innerHTML=this.mySettings.NLS.tabTitle,this._titleContainer.appendChild(this._titleSpan);var t=this,i={withCloseButton:!1,tabs:[{id:"variants",text:this.mySettings.NLS.tabTitle,fonticon:"fonticon fonticon-attributes",allowUnsafeHTMLOnTabButton:!1,content:function(e){t._listPresenter.inject(e)}},{text:"",fonticon:"",content:function(){}}],modelEvents:this._updateChannelLocal,lazyRendering:!0,initialSelectedIndex:0};new c(i).render().inject(this._container)},P.prototype.loadData=function(t,i){if(t&&""!==t&&this._currVariantClassId!==t){this._currVariantClassName=i||"";var n=this;n.classId=t,n._localChannelForListView.publish({event:"xmodel-list-data-on-load-start"});var a=f.getCustomAttributeStatus(n.mySettings.appPreferencePath);return o[this.mySettings.serviceHandlers.getSubItems]({id:t,customAttributeFlag:a}).then(function(i){var a=[];"string"==typeof i&&(i=i.replaceAll(String.fromCharCode(7),","),i=JSON.parse(i)),i.member[0].hasOwnProperty("values")?(i.member[0].values.member.forEach(e=>{if(e.hasOwnProperty("customerAttributes")){for(const t in e.customerAttributes)if(Object.hasOwn(e.customerAttributes,t))for(const i in e.customerAttributes[t])window.widget&&("OnPremise"!==window.widget.getValue("x3dPlatformId")?e[i.split("__")[0]]=e.customerAttributes[t][i]:e[i]=e.customerAttributes[t][i])}else if(e.hasOwnProperty("dspfl:VariantValueEnterpriseAttributes")){let t=e["dspfl:VariantValueEnterpriseAttributes"];for(const i in t)window.widget&&("OnPremise"!==window.widget.getValue("x3dPlatformId")?e[i.split("__")[0]]=t[i]:e[i]=t[i])}}),a=i.member[0].values):i.member[0].hasOwnProperty("options")&&(i.member[0].options.member.forEach(e=>{if(e.hasOwnProperty("customerAttributes")){for(const t in e.customerAttributes)if(Object.hasOwn(e.customerAttributes,t))for(const i in e.customerAttributes[t])window.widget&&("OnPremise"!==window.widget.getValue("x3dPlatformId")?e[i.split("__")[0]]=e.customerAttributes[t][i]:e[i]=e.customerAttributes[t][i])}else if(e.hasOwnProperty("dspfl:OptionEnterpriseAttributes")){let t=e["dspfl:OptionEnterpriseAttributes"];for(const i in t)window.widget&&("OnPremise"!==window.widget.getValue("x3dPlatformId")?e[i.split("__")[0]]=t[i]:e[i]=t[i])}a=i.member[0].options}),a=i.member[0].options),e.is(a.member,"array")&&a.member.forEach(function(e){e.sequenceNumber=parseInt(e.sequenceNumber)}),n._localChannelForListView.publish({event:"xmodel-list-data-load-action",data:a}),n._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"});var o=f.getSelectedItems(n._pathItemsDetail);o&&o.length>0&&n._localChannelForListView.publish({event:"xmodel-list-selection-action",data:o}),n._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:f.getSort(n._pathItemsDetail)}),n._currVariantClassId=t,n.publishTags()},function(){n._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),n._currVariantClassId="",S.showError(this.mySettings.NLS.getSubItemsError),n.clearTags()})}},P.prototype.inject=function(e){e.appendChild(this._container)},P.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this.clearTags(),D.destroy(),this._myEventManager&&(this._myEventManager.cleanup("EntDicoSubItemsPresenter_"+this.mySettings.settingsFor),this._myEventManager=null)},P.prototype.createCreationDialog=function(e,t){switch(t){case"Options":g.show({id:"option",modelEvent:e,title:A.newOption,withCreateAndClose:!0});break;case"VariantValues":g.show({id:"variant-value",modelEvent:e,title:A.newValue,withCreateAndClose:!0});break;default:this._createSubItem()}},P.prototype._createSubItem=function(t){var i,n=this;n._localChannelForListView.publish({event:"xmodel-list-data-on-load-start"}),e.merge(t,{name:""}),n._patchForUploadingImage=t.image?t.image:void 0,n._patchIdObject=void 0,t.image=void 0,o[this.mySettings.serviceHandlers.createSubItem]({items:[{type:"",versionName:"",attributes:t}]},n._currVariantClassId).then(function(t){i=t.member[0].id,n._patchIdObject=t.member[0].id,n._patchForUploadingImage?s.uploadImage(i,n._patchForUploadingImage).then(function(){n.createPostProcess(n._patchIdObject)},function(){e.log("uploadImage: Service Call Failed !!!"),n.createPostProcess(n._patchIdObject)}):n.createPostProcess(i)},function(){n._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),S.showError(n.mySettings.NLS.createSubItemError)})},P.prototype.createPostProcess=function(e){var t=this,i=f.getCustomAttributeStatus(t.mySettings.appPreferencePath);o[t.mySettings.serviceHandlers.getSubItemDetails]({id:e,parentID:t._currVariantClassId,customAttributeFlag:i}).then(function(e){"string"==typeof e&&(e=e.replaceAll(String.fromCharCode(7),","),e=JSON.parse(e));var i,n,a=e.member[0];if(e.member[0].hasOwnProperty("customerAttributes"))for(i in e.member[0].customerAttributes)for(n in e.member[0].customerAttributes[i]){if(window.widget)if("OnPremise"!==window.widget.getValue("x3dPlatformId"))a[n.split("__")[0]]=e.member[0].customerAttributes[i][n];else a[n]=e.member[0].customerAttributes[i][n]}t._localChannelForListView.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){t._localChannelForListView.publish({event:"xmodel-list-unselect-all"}),e.select()}),t._localChannelForListView.publish({event:"xmodel-list-data-item-add-action",data:a}),t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),t._localChannelForListView.publish({event:"enox-collection-toolbar-sort-activated",data:f.getSort(t._pathItemsDetail)}),t._localChannelForListView.publish({event:"enox-dialog-creation-done"}),S.showSuccess(A._creation_successful)},function(){t._localChannelForListView.publish({event:"xmodel-list-data-on-load-complete"}),t._localChannelForListView.publish({event:"enox-dialog-creation-done"}),S.showError(t.mySettings.NLS.getSubItemDetailsError)})},P.prototype._subscribeToEvents=function(){var t=this;this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-dialog-creation"},function(e){t._createSubItem(e.content)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-dialog-delete"},function(e){t._deleteSubItem(e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"list-view-update-inline-action"},function(i){if(i&&i.model&&i.name&&void 0!==i.value){if("sequenceNumber"===i.name||"default"===i.name)return;if(e.is(t._customAttributeColumns,"array")&&t._customAttributeColumns.find(e=>e.dataIndex===i.name))return;var n=i.model[0],o=i.cell.nodeModel,s={icons:[a.getWebappsAssetUrl("ENOXModelApp","icon/loading-animation.gif")]};o.updateOptions(s),t._editionHandler(n,i.name,i.value.trim())}}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-link-click"},function(e){t._localChannelForListView.publish({event:"xmodel-execute-command",data:e})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-add-selection"},function(e){if(e.items){var i=e.model,n=e.items.map(function(e){return e.options.id});let a=[];!0===e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;a.push(t)}):a.push(i.id),p.addSelection(a,t.mySettings.infoContext),f.updateSelectedItems(t._pathItemsDetail,n)}}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-remove-selection"},function(e){var i=e.model;let n=[];if(!0===e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;n.push(t)}):n.push(i.id),p.removeSelection(n,t.mySettings.infoContext),e.items){var a=e.items.map(function(e){return e.options.id});f.updateSelectedItems(t._pathItemsDetail,a)}}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-item-on-empty-selection"},function(){p.removeAllSelection(t.mySettings.infoContext),f.updateSelectedItems(t._pathItemsDetail,[])}),this._myEventManager.subscribe(this._localChannelForListView,{event:"custom-attributes-loading-done"},function(e){t._localChannelForListView.publish({event:"xmodel-list-add-columns",data:e})}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._localChannelForListView,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._localChannelForListView,e,this)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-collection-toolbar-switch-view-activated"},function(e){f.updateView(t._pathItemsDetail,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"enox-collection-toolbar-sort-activated"},function(e){f.updateSort(t._pathItemsDetail,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-filter-change"},function(e){e&&f.setTagFilter(t._pathItemsDetail,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-setup"},function(){var e=f.getTagFilter(t._pathItemsDetail);e&&t._localChannelForListView.publish({event:"xmodel-list-tagger-set-filter-action",data:e})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-filter-change"},function(e){e&&f.setTagFilter(t._pathItemsDetail,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-tagger-on-setup"},function(){var e=f.getTagFilter(t._pathItemsDetail);e&&t._localChannelForListView.publish({event:"xmodel-list-tagger-set-filter-action",data:e})}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-on-save-custom-view"},function(e){f.updateVisibleColumns(t.mySettings.appPreferencePath,e)}),this._myEventManager.subscribe(this._localChannelForListView,{event:"xmodel-list-on-custom-view-save"},function(i){t.loadWithCustom=t._withCustomAttributes,t._visibleCustomAttrbutesList?i&&(e.equals(t._visibleCustomAttrbutesList,i)&&(t._withCustomAttributes=!1),t._withCustomAttributes=!0):(t._visibleCustomAttrbutesList=i,t._withCustomAttributes=!0),f.updateCustomAttributeStatus(t.mySettings.appPreferencePath,t._withCustomAttributes),t.loadWithCustom||t.loadData(t.classId)})},P.prototype._editionHandler=function(e,t,i){var n=this;if(e&&t){if("title"===t&&null==i||e[t]===i)return void n._localChannelForListView.publish({event:"xmodel-list-data-item-update-action",data:e});var a={};a[t]=i,o[this.mySettings.serviceHandlers.patchSubItem](e.id,a).then(function(e){n._localChannelForListView.publish({event:"xmodel-list-data-item-update-action",data:e.member[0]});var t=e.member[0].id;p.removeSelection(t,n.mySettings.infoContext),p.addSelection(t,n.mySettings.infoContext)},function(t){n._localChannelForListView.publish({event:"xmodel-list-data-item-update-action",data:e}),S.showError(t)})}},P.prototype._updateAttributes=function(t,i){var n=this;return new e.Promise(function(e,a){var o=t.id,s=t.name,r=t.value;if("sequenceNumber"===s||"default"===s){var l={id:o,parentId:"DUMMY_MV_ID",attributes:{}};l.attributes["_"+s]=JSON.parse(r),i=i||{},y.updateVariabilityInstanceDetails(l,i).then(function(){e(r)},function(){a(),S.showError(n.mySettings.NLS.patchSubItemError)})}})},P.prototype._updateDefaultAttribute=function(t,i){var n=this;if(e.is(i,"boolean")){var a={id:t.nodeModel.getAttributeValue("rel_id"),name:"default",value:i},o=[];if("VariantValues"===n.mySettings.settingsFor&&!0===i){var s=t.nodeModel.getBrothers();e.is(s,"array")&&s.forEach(function(e){!0===e.getAttributeValue("default")&&o.push(e)})}if(o.length>0){n._updateAttributes(a,{async:!1}).then(function(e){t.nodeModel.updateOptions({grid:{default:e}})},function(){t.nodeModel.updateOptions({grid:{default:t.nodeModel.getReferenceValue("default")}})});var r=[];o.forEach(function(e){var t=e.getAttributeValue("rel_id");e.updateOptions({grid:{default:!1}}),r.push(n._updateAttributes({id:t,name:"default",value:!1},{async:!1}))})}else n._updateAttributes(a,{async:!1}).then(function(e){t.nodeModel.updateOptions({grid:{default:e}})},function(){t.nodeModel.updateOptions({grid:{default:t.nodeModel.getReferenceValue("default")}})})}else{var l=t.nodeModel.getReferenceValue("default");t.nodeModel.updateOptions({grid:{default:l}})}},P.prototype._updateSequenceNoAttribute=function(e,t){if(isNaN(t)||t<1){var i=e.nodeModel.getReferenceValue("sequenceNumber");e.nodeModel.updateOptions({grid:{sequenceNumber:i}})}else{var n={id:e.nodeModel.getAttributeValue("rel_id"),name:"sequenceNumber",value:t};this._updateAttributes(n).then(function(t){e.nodeModel.updateOptions({grid:{sequenceNumber:t}})},function(){e.nodeModel.updateOptions({grid:{sequenceNumber:e.nodeModel.getReferenceValue("sequenceNumber")}})})}},P.prototype._refreshListView=function(e,t,i){var n=this,a=f.getCustomAttributeStatus(n.mySettings.appPreferencePath);void 0!==t&&o[this.mySettings.serviceHandlers.getSubItemDetails]({id:t,parentID:this._currVariantClassId,customAttributeFlag:a}).then(function(t){if("string"==typeof t&&(t=t.replaceAll(String.fromCharCode(7),","),t=JSON.parse(t)),t&&t.member&&t.member[0]){var n,a,o=t.member[0];if(o.hasOwnProperty("customerAttributes"))for(n in o.customerAttributes)for(a in o.customerAttributes[n])if(window.widget)if("OnPremise"!==window.widget.getValue("x3dPlatformId")){var s=a.split("__")[0];t.member[0][s]=o.customerAttributes[n][a]}else t.member[0][a]=o.customerAttributes[n][a]}var r=t.member[0];r.context=i,e.publish({event:"xmodel-list-data-item-update-action",data:r})},function(){S.showError(n.mySettings.NLS.getSubItemDetailsError)})},P.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:this.mySettings.NLS.itemName,multiple:this.mySettings.NLS.itemsName,modelEvent:t,immersiveFrame:E.getImmersiveFrame()};b.showDialog(i)},P.prototype._deleteSubItem=function(e){var i=this,n=e;t.mask(i._container),o[this.mySettings.serviceHandlers.deleteSubItems]({ids:n,variantId:i._currVariantClassId}).then(function(){i._localChannelForListView.publish({event:"xmodel-list-data-item-remove-action",data:n}),t.unmask(i._container)},function(){S.showError(i.mySettings.NLS.deleteSubItemError),t.unmask(i._container)})},P.prototype.publishTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-activate-action"})},P.prototype.clearTags=function(){this._localChannelForListView.publish({event:"xmodel-list-tagger-deactivate-action"})},P}),define("DS/ENOXModelApp/ModelDefinition/js/LocalRulesPresenter",["UWA/Core","DS/ENOXSplitView/js/ENOXSplitView","DS/UIKIT/Mask","DS/UIKIT/DropdownMenu","DS/CoreEvents/ModelEvents","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/xPflRouter5/xPflRouter","DS/WebappsUtils/WebappsUtils","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/ENOXModelApp/Utils/CustomAttributesManager","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/LocalRulesPresenter","css!DS/ENOXModelApp/ModelDefinition/css/LocalRules.css","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/TreeModel/TreeDocument","DS/xPortfolioUXCommons/DialogDuplicate/DialogDuplicate","i18n!DS/ENOXModelApp/assets/nls/xModelErrorManagement"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x,R,V){"use strict";var N=function(){};return N.prototype.init=function(e,i,n,o){this.threeDSearch=new T,this._pathRules=[f._KEY,f._VIEWS_PREFERENCES,f._MODEL_VERSIONS_DETAILS,f._RULES],this._isDestroyed=!1,this._privateChannel=e||new a,this._applicationChannel=i,this._splitViewChannel=n,this._updateChannelLocal=new a,this._myEventManager=new v(this._updateChannelLocal,this._splitViewChannel,this._applicationChannel,this._privateChannel),this._id=o.id,this._modelName=o.modelName,this._modelId=o.modelID,this._modelVersionName=o.modelVersionName,this._modelVersionId=o.modelVersionId,this._modelVersion=o.modelVersion,this._editable=o.editable,this._disable=!o.editable,this._tagActivated=!1,this._previewModeIsSelected=!1,this._model=new x({}),this._namePage="Rules",c.initialize({applicationChannel:this._applicationChannel,silent:!0,context:this._namePage}),this._relatedObjectsCmd=new I,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._listPresenter=null,this._initializeListView();var s={modelEvents:this._privateChannel,withtransition:!0,noPublishOnCreate:!0,withoverflowhidden:!1,params:{leftWidth:40,leftVisible:!0,rightVisible:!1,rightMaximizer:!0,leftMaximizer:!0}};this._splitView=new t,this._splitView.init(s),this._initDivs(),this._initCommand(),this._subscribeToEvents();var r=this;A.getCustomAttribute("Configuration Rule").then(function(e){if(e&&e.length>0){var t=g.getVisibleColumns(r._pathRules),i=A.getColumnsToAdd(e,t);r._privateChannel.publish({event:"custom-attributes-loading-done",data:i})}},function(){})},N.prototype._initCommand=function(){this._command=new p(this._privateChannel,this._container,this._applicationChannel)},N.prototype._initializeListView=function(){var t,i=this,n=g.getSort(this._pathRules);n&&n.sortAttribute&&n.sortOrder&&(t={id:n.sortAttribute,order:n.sortOrder});var a={id:"localRules",modelEvents:this._privateChannel,useDragAndDrop:!0,model:i._model,asyncContextualMenu:!0,viewOptions:{identifier:"local_rules",views:["ThumbnailView","TileView","DataGridView"],currentView:g.getView(this._pathRules),currentSort:t,grid:{columns:[{text:P.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",editableFlag:!0,getCellEditableState:function(e){if(void 0===e.nodeModel)return!1;var t=e.nodeModel.options.grid;return S.checkActionAccess({action:D.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:P.NAME,dataIndex:"name"},{text:P.DESCRIPTION,dataIndex:"description",editableFlag:!0,getCellEditableState:function(e){var t=e.nodeModel.options.grid;return S.checkActionAccess({action:D.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:P.TYPE,dataIndex:"ruleType"},{text:P.MATURITY_STATE,dataIndex:"state",typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(e.nodeModel.options.grid){var t=e.nodeModel.options.grid;return{label:t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state,url:"#Maturity"}}return""}},{text:P.LOCK_STATUS,dataIndex:"Lock status",typeRepresentation:"url",hyperlinkTarget:"_self",getCellTooltip:function(e){return _.getTooltipOfLockedStatus(e)},getCellValue:function(e){return _.getIconOfLockStatus(e)}},{text:P.OWNER,dataIndex:"owner"},{text:P.CREATION_DATE,dataIndex:"created",getCellValue:function(e){if(e.nodeModel.options.grid.created)return _.formatDateAttribute(e.nodeModel.options.grid.created)}},{text:P.MODIFICATION_DATE,dataIndex:"modified",getCellValue:function(e){if(e.nodeModel.options.grid.modified)return _.formatDateAttribute(e.nodeModel.options.grid.modified)}},{text:P.COLLABSPACE,dataIndex:f._COLLABSPACE_TITLE},{text:P.ORGANIZATION,dataIndex:f._ORG_TITLE}]},editable:!0,itemViewMapping:{label:function(e){return e.options.grid.title},subLabel:function(e){return e.options.grid.ruleType+" | "+(e.options.grid.owner?e.options.grid.owner:e.options.grid.responsible)},description:"description",customTooltip:function(e){return _.prepareTooltipObjectView(e)},icon:function(){return m.getWebappsAssetUrl("ENOXModelApp","icon/rules.png")}},contextualActions:async function(){var t=[{id:"open",title:w._open,fonticon:"open",multiselect:!1,handler:function(t){e.log("item clicked"),h.navigate(u.ROUTE_MODEL_RULE_DETAILS,{id:t.id,name:t.title,image:t.image,version:null,modelVersionId:i._modelVersionId,modelVersionName:i._modelVersionName,modelVersion:i._modelVersion,modelName:i._modelName})}},{type:"SeparatorItem"},{id:"duplicate",title:w._duplicate,fonticon:"duplicate",state:this._disable?"disabled":"enabled",handler:function(e,t){if(S.checkActionAccess({action:D.DUPLICATE,type:e.type,notify:!0})){let e=[];t.forEach(t=>{var i={id:t.id,title:t.title,revision:t.revision,maturity:t.nlsValues.nlsState,type:t.type};e.push(i)}),i.showDuplicateDialog(e)}}},{id:"maturityState",title:P.get("MATURITY"),fonticon:"collaborative-lifecycle-management",handler:function(e,t){i._command._handleMaurityCommand(t)}},{id:"compare",title:P.get("COMPARE"),text:P.get("COMPARE"),fonticon:"part-compare",handler:function(e){let t=i._listPresenter._getSelectedItem();i._command._handleCompareCommand(t)}},{type:"SeparatorItem"},{type:"SeparatorItem"},i._relatedObjectsCmdObj,{id:"information",title:w._information,fonticon:"info",handler:function(e){c.showInformation(e.id),i._applicationChannel.publish({event:"information-panel-open"})}},{type:"SeparatorItem"},{id:"delete",title:w._delete,fonticon:"remove",state:this._disable?"disabled":"enabled",handler:function(e,t){if(e&&S.checkActionAccess({action:D.REMOVE,type:e.type,notify:!0})){var n=t.map(function(e){return{id:e.id,title:e.title}});i.createDeleteModelDialog(n,i._privateChannel)}}}];let n=this._disable;return _.showContextualActions(i._model.getSelectedNodes(),t,n,i)}},emptyContentOptions:{sentences:[{type:"img",src:m.getWebappsAssetUrl("ENOXModelApp","icon/rules.png"),text:P.EMPTY_CONTENT_MESSAGE}]},withmultisel:!0,toolbarOptions:{itemsName:w._ruleMultiple,itemName:w._ruleSingle,withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,hideOnMultiSelection:["open","preview"],touchMode:!1,actions:[{id:"create",text:w._create,fonticon:"plus",visibility:this._disable,content:[{id:"MatrixRule",text:w._matrix_rule,selectable:!1,handler:function(){S.checkActionAccess({action:D.CREATE,type:D.TYPE_MATRIX_RULE,notify:!0})&&(i.typeRuleCreation="table",i.createCreationModelDialog(i._privateChannel,"table"))}},{id:"ExpressionRule",text:w._expression_rule,selectable:!1,handler:function(){S.checkActionAccess({action:D.CREATE,type:D.TYPE_EXPRESSION_RULE,notify:!0})&&(i.typeRuleCreation="expression",i.createCreationModelDialog(i._privateChannel,"expression"))}},{id:"RuleFromExisting",text:w._addExistingRule,selectable:!1,handler:function(){if(S.checkActionAccess({action:D.ADDEXISTING,type:D.RULE,notify:!0})){for(var e=[],t=i._listPresenter._contentViews.TileView.model,n=0;n<t.length;n++)e.push(t[n].getAttributeValue("id"));i.call3DSearchForExistingRule(i._modelId,e)}}},{id:"carryOver",text:w._addExistingFrom,handler:function(){i._applicationChannel.publish({event:"mvcopy-launch-copy-from-dialog",data:"rules"})}}],handler:function(){e.log("clicked on plus")}},{id:"open",title:w._open,category:"open",text:w._open,showOnSelection:!0,fonticon:"open",handler:function(t){let n=i._listPresenter._getSelectedItem();n.length>1||(t=n[0],e.log("item clicked"),h.navigate(u.ROUTE_MODEL_RULE_DETAILS,{id:t.id,name:t.title,image:t.image,version:null,modelVersionId:i._modelVersionId,modelVersionName:i._modelVersionName,modelVersion:i._modelVersion,modelName:i._modelName}))}},{id:"preview",text:w._preview,fonticon:"eye",allowSelectRetain:!1,selected:!1,category:"view",showOnSelection:!0,handler:function(e,t,n){e.length>1||(i._previewModeIsSelected=n.selected,i._privateChannel.publish({event:"on-preview",data:{activated:n.selected}}),n.selected?i._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{text:w._hidePreview,id:"preview"}}):i._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:{text:w._preview,id:"preview"}}))}},{id:"lock",text:P.LOCK,fonticon:"lock",visibleFlag:!1,category:"lifecycle",handler:function(e){_.handleReservedCmd(i._privateChannel,i._listPresenter._getSelectedItem(),i._command)}},{id:"unlock",text:P.UNLOCK,fonticon:"lock-open",visibleFlag:!1,category:"lifecycle",handler:function(e){_.handleUnReservedCmd(i._privateChannel,i._listPresenter._getSelectedItem(),i._command)}},{id:"duplicate",text:w._duplicate,fonticon:"duplicate",visibility:this._disable,category:"lifecycle",showOnSelection:!this._disable,handler:function(){let e=i._listPresenter._getSelectedItem();if(S.checkActionAccess({action:D.DUPLICATE,type:"Configuration Rule",notify:!0})){var t=[];e.forEach(e=>{t.push({id:e.id,title:e.title,revision:e.revision,maturity:e.nlsValues.nlsState,type:e.type})}),i.showDuplicateDialog(t)}}},{id:"maturityState",title:P.get("MATURITY"),text:P.get("MATURITY"),category:"lifecycle",showOnSelection:!0,fonticon:"collaborative-lifecycle-management",handler:function(e){i._listPresenter._getSelectedItem();i._command._handleMaurityCommand(e)}},{id:"compare",title:P.get("COMPARE"),text:P.get("COMPARE"),category:"lifecycle",showOnSelection:!0,fonticon:"part-compare",handler:function(e){let t=i._listPresenter._getSelectedItem();i._command._handleCompareCommand(t)}},i._relatedObjectsCmdObj,{id:"delete",text:w._delete,fonticon:"remove",category:"destructive",visibility:this._disable,showOnSelection:!this._disable,handler:function(t){if(S.checkActionAccess({action:D.REMOVE,type:D.RULE,notify:!0})){e.log("delete action..");var n=t.map(function(e){return{id:e.id,title:e.label}});i.createDeleteModelDialog(n,i._privateChannel)}}}]},extensions:[s,r]};this._listPresenter=new o(a)},N.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-link-click"},function(t){e._privateChannel.publish({event:"xmodel-execute-command",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-click"},function(t){_.onLockColumnCellClick(t,6,e._command,e._privateChannel)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-delete"},function(t){e.deleteRules(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"custom-attributes-loading-done"},function(t){e._privateChannel.publish({event:"xmodel-list-add-columns",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-on-custom-view-save"},function(t){e.loadData()}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-on-save-custom-view"},function(t){g.updateVisibleColumns(e._pathRules,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-creation"},function(t){e.createRule(t.content,e.typeRuleCreation)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-dialog-duplication"},function(t){e.copyRule(t)}),this._myEventManager.subscribe(this._privateChannel,{event:"rules-filter-carried-over-response"},function(t){let i=[];Array.isArray(t.response.member)&&(t.response.member.forEach(e=>{e.maturity=e.state;let t={item:e};i.push(t)}),e._applicationChannel.publish({event:"xmodel-app-add-rulelist",data:i}),e._privateChannel.publish({event:"xmodel-list-content-show-loader"}),i.forEach(t=>{e._privateChannel.publish({event:"xmodel-list-data-item-add-update-action",data:t})}),e._privateChannel.publish({event:"xmodel-list-content-hide-loader"}),e._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}))}),this._myEventManager.subscribe(this._privateChannel,{event:"set-rule-editable"},function(t){var i=!0===t?"xmodel-list-toolbar-show-action":"xmodel-list-toolbar-hide-action";e._privateChannel.publish({event:i,data:"create"}),e._privateChannel.publish({event:i,data:"delete"}),e._privateChannel.publish({event:i,data:"duplicate"}),e._editable=t,e._disable=!e._editable}),this._myEventManager.subscribe(this._privateChannel,{event:"update-rule-list"},function(){e.loadData()}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-unselect-eye-item"},function(t){e._listPresenter._collectionToolBar._collectionToolBar._modelEvents.publish({event:"enox-collection-toolbar-item-unselect",data:t})}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-add-selection"},function(t){var i=t.model,n=[];t.items&&t.items.forEach(function(e){e.options&&n.push(e.options.id)});let a=[];1==t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;a.push(t)}):a.push(i.id),c.addSelection(a,e._namePage),g.updateSelectedItems(e._pathRules,n),_.showToolbarLockUnlockIcons(e._privateChannel,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-remove-selection"},function(t){var i=t.model;let n=[];1==t.multiSelect?i.forEach(e=>{let t=e.options.grid.id;n.push(t)}):n.push(i.id),c.removeSelection(n,e._namePage);var a=[];t.items&&t.items.forEach(function(e){e.options&&a.push(e.options.id)}),g.updateSelectedItems(e._pathRules,a),_.showToolbarLockUnlockIcons(e._privateChannel,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-item-on-empty-selection"},function(){c.removeAllSelection(e._namePage),g.updateSelectedItems(e._pathRules,[])}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-list-data-item-need-refresh"},function(t){e._tagActivated&&e._refreshListView(e._privateChannel,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-list-data-item-need-refresh"},function(t){e._refreshListView(e._privateChannel,t,this)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-switch-view-activated"},function(t){g.updateView(e._pathRules,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-sort-activated"},function(t){g.updateSort(e._pathRules,t)}),this._myEventManager.subscribe(this._privateChannel,{event:"list-view-update-inline-action"},function(t){if(t&&t.model&&t.name&&void 0!==t.value){var i=t.model[0],n=t.cell.nodeModel,a={icons:[m.getWebappsAssetUrl("ENOXModelApp","icon/loading-animation.gif")]};n.updateOptions(a),e._editionRule(i,t.name,t.value.trim())}}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-filter-change"},function(t){t&&g.setTagFilter(e._pathRules,t)}),this._privateChannel.subscribe({event:"xmodel-list-tagger-on-setup"},function(){e._tagActivated?e.publishTags():e.clearTags();var t=g.getTagFilter(e._pathRules);t&&e._privateChannel.publish({event:"xmodel-list-tagger-set-filter-action",data:t})})},N.prototype.showDuplicateDialog=function(t){var i=d.getPreferences(),n=i.options,a=i.value;e.is(t,"array")&&R.show({selections:t,channel:this._privateChannel,credentials:n,value:a})},N.prototype.call3DSearchForExistingRule=function(t,i){var n=this;this.threeDSearch.launchASearch({allowedTypes:[{tag:"status",value:'"Configuration Rule.Preliminary" OR "Configuration Rule.Release"'}],role:"",title:w._addExistingRule,precondition:"[CR_MODEL_CONTEXT_PID]:"+t,resourceid_not_in:i,in_apps_callback:function(t){for(var i=[],a=0;a<t.length;a++)i.push(t[a].id);var o={productID:n._id,ruleIDs:i};l.addExistingRuleFromModelVersion(o).then(function(e){for(var t=0;t<e.member.length;t++)n._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){e.select()}),n._privateChannel.publish({event:"xmodel-list-add-many-items",data:e.member[t]}),n._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),n._privateChannel.publish({event:"existing-rule-added"}),n._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:g.getSort(n._pathRules)})},function(t){e.log("LocalRulesPresenter addExistingRuleFromModelVersion : Service Call Failed !!!"),y.showError(t)})}})},N.prototype._editionRule=function(t,i,n){var a=this;if(t&&i){var o={};o[i]=n,l.patchRule(t.id,o).then(function(t){var i;e.is(t,"string")&&(t=l.parseStringData(t)),e.log("LocalRulesPresenter editionRule : Service Call Success !!!"),a._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:t.member[0]}),a._listPresenter._getSelectedItem()[0]&&(i=a._listPresenter._getSelectedItem()[0].id);var n=t.member[0].id;c.removeSelection(n,a._namePage),c.addSelection(i,a._namePage)},function(i){var n;switch(e.log("LocalRulesPresenter editionRule : Service Call Failed !!!"),t.ruleType){case"Matrix Rule":n=D.TYPE_MATRIX_RULE;break;case"Expression":n=D.TYPE_EXPRESSION_RULE;break;default:n=D.RULE}a._privateChannel.publish({event:"xmodel-list-data-item-update-action",data:t}),M.showError({mandatoryErrCodeCheck:!1,action:D.MODIFY,type:n,message:i})||y.showError(w.ERROR_PATCH_RULES)})}},N.prototype._refreshListView=function(t,i,n){if(void 0!==i){var a=this;l.getRuleDetails({id:i}).then(function(i){e.log("getRuleDetails: Service Call Successful !!!"),e.is(i,"string")&&(i=l.parseStringData(i));var o=void 0;i&&i.member[0]&&((o=i.member[0]).context=n,t.publish({event:"xmodel-list-data-item-update-action",data:o})),c.removeSelection(o.id,a._namePage),c.addSelection(o.id,a._namePage)},function(){e.log("getRuleDetails: Service Call Failed !!!"),y.showError(w.ERROR_GET_RULE_DETAILS)})}},N.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("rules-presenter"),this._splitView.inject(this._container),this._leftPanel=this._splitView.getLeft(),this._rightPanel=this._splitView.getRight(),e.extendElement(this._leftPanel),e.extendElement(this._rightPanel),this._listPresenter.inject(this._leftPanel),this._updateChannelLocal.publish({event:"enox-collection-toolbar-disable-action",data:"delete"})},N.prototype.createRule=function(t,i){i=i||"table";var n=this;n._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),e.merge(t,{name:"",ruleType:i}),n._patchForUploadingImage=t.image?t.image:void 0,n._patchIdObject=void 0,t.image=void 0,l.createLocalRule({parentID:this._id,items:[{type:"",versionName:"",attributes:t}]}).then(function(t){var i=t.value;i||t.member&&t.member.length>0&&(i=t.member[0].id),e.log("rule created "+i),n._patchForUploadingImage?d.uploadImage(i,n._patchForUploadingImage).then(function(e){t.member[0].image=e,n.createPostProcessSucess(t)},function(){e.log("uploadImage: Service Call Failed !!!"),n.createPostProcessFail()}):n.createPostProcessSucess(t)},function(){e.log("rule creation failed"),n._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),y.showError(w.ERROR_CREATE_RULE)})},N.prototype.copyRule=function(e){var t=this,i=!1;if(e&&e.titleIdMap&&e.titleIdMap.length>0){e.prefix;for(var n=e.securityContext,a=e.titleIdMap,o=0,s=0;s<a.length;s++){var r={createFrom:{identifier:a[s].id},items:[{attributes:{title:e.titleIdMap[s].title}}]};l.copyRule(r,t._id,n).then(function(e){var n=e.member[0];(o+=1)===a.length&&(i=!0);var s={showDup:i};t.createPostProcess(n.identifier,s)},function(e){t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),y.showError({title:V.err_duplicate_title+w.type_rule,message:V.err_duplicate_message})})}}},N.prototype.createPostProcessSucess=function(t,i){e.is(t,"string")&&(t=l.parseStringData(t));var n=t.member[0],a=this;a._privateChannel.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){a._privateChannel.publish({event:"xmodel-list-unselect-all"}),e.select()}),a._privateChannel.publish({event:"xmodel-list-data-item-add-action",data:n}),a._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),a._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:g.getSort(a._pathRules)}),a._privateChannel.publish({event:"enox-dialog-creation-done"}),i?i.showDup&&y.showSuccess(P._dup_successful):y.showSuccess(P._creation_successful)},N.prototype.createPostProcessFail=function(){this._privateChannel.publish({event:"enox-dialog-creation-done"}),this._privateChannel.publish({event:"xmodel-list-data-on-load-complete"})},N.prototype.createPostProcess=function(t,i){var n=this;l.getRuleDetails({id:t}).then(function(t){e.log("getRuleDetails: Service Call Successful !!!"),n.createPostProcessSucess(t,i)},function(){e.log("getRuleDetails: Service Call Failed !!!"),n.createPostProcessFail()})},N.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"remove",single:w._ruleSingle,multiple:w._ruleMultiple,modelEvent:t,immersiveFrame:C.getImmersiveFrame()};b.showDialog(i)},N.prototype.createCreationModelDialog=function(e,t){switch(t){case"table":E.show({id:"rule",modelEvent:e,title:w._newMatrixRule,withCreateAndClose:!0});break;case"expression":E.show({id:"rule",modelEvent:e,title:w._newExpressionRule,withCreateAndClose:!0});break;default:E.show({id:"rule",modelEvent:e,title:w._newMatrixRule,withCreateAndClose:!0})}},N.prototype.deleteRules=function(t){var i=this;l.deleteRuleVersions({ids:t,modelId:i._id}).then(function(){e.log("rule deleted"),i._privateChannel.publish({event:"xmodel-list-data-item-remove-action",data:t}),i._applicationChannel.publish({event:"xmodel-app-rules-list-remove",data:t}),h.getDependency("applicationChannel").publish({event:"enox-model-app-item-removed",data:t})},function(t){e.log("rule deletion failed"),M.showError({action:D.REMOVE,type:D.TYPE_REQUIREMENT,message:t})||y.showError(w.ERROR_DELETE_RULE)})},N.prototype.inject=function(e){e.appendChild(this._container)},N.prototype.publishTags=function(){this._tagActivated=!0,this._privateChannel.publish({event:"xmodel-list-tagger-activate-action"})},N.prototype.loadData=function(){var t=this;t._privateChannel.publish({event:"xmodel-list-data-on-load-start"}),l.getLocalRuleVersions({id:t._id}).then(function(n){e.is(n,"string")&&(n=l.parseStringData(n)),i.unmask(t._container);var a=[];e.is(n,"array")?a=n:n.member[0].hasOwnProperty("rules")&&(a=n.member[0].rules),t._applicationChannel.publish({event:"xmodel-app-rulelist",data:a}),t._privateChannel.publish({event:"xmodel-list-data-load-action",data:a}),t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"});var o=g.getSelectedItems(t._pathRules);o&&o.length>0&&t._privateChannel.publish({event:"xmodel-list-selection-action",data:o}),t._privateChannel.publish({event:"enox-collection-toolbar-sort-activated",data:g.getSort(t._pathRules)}),0===t._model.getXSO().get().length&&t._privateChannel.publish({event:"xmodel-list-item-on-empty-selection"})},function(){t._privateChannel.publish({event:"xmodel-list-data-on-load-complete"}),y.showError(w.ERROR_GET_RULES)})},N.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this.clearTags(),this._myEventManager&&(this._myEventManager.cleanup("LocalRulesPresenter"),this._myEventManager=null)},N.prototype.clearTags=function(){this._tagActivated=!1,this._privateChannel.publish({event:"xmodel-list-tagger-deactivate-action"})},N}),define("DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoItemDetailsPresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","UWA/Class/Model","DS/ENOXIDCardContainer/js/ENOXIDCardContainer","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoSubItemsPresenter","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/ENOXModelApp/Utils/xModelIDCardAttributeEditor","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/EnterpriseVariabilityDictionaryStatePresenter","css!DS/ENOXModelApp/EnterpriseVariabilityDictionary/css/EntDicoItemDetailsPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D){"use strict";var M=window.localStorage.XMODEL_BROWSER_LOG_DEBUG,I=function(){};return I.prototype.init=function(t,n,a){this._isDestroyed=!1,this.mySettings=e.clone(a.settings),this._pathItemsDetail=this.mySettings.appPreferencePath,this._applicationChannel=t,this._updateChannel=n,this._options=a,this._id=a.id,this._variantClassName=a.name?a.name:"",this._modelForIdCard={},this._updateChannelLocal=new i,this._privateModelEvents=new i,this._myEventManager=new h(this._applicationChannel,this._updateChannel,this._updateChannelLocal,this._privateModelEvents),this._relatedObjectsCmd=new v,this._idCardAttrbEditorUtil=new d,this._idCardAttrbEditorUtil.init(this._privateModelEvents),this._subItemsPresenter=new r,this._subItemsPresenter.init(this._privateModelEvents,t,{someOtherOptions:"cool option for Variants",settings:a.settingsForSubItems}),this._initDivs(),this._initCommand(),this._subscribeToEvents(),this._fetchData()},I.prototype._initCommand=function(){this._command=new c(this._privateModelEvents,this._container)},I.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("item-details"),this._enoxIDCardContainer=new o,this._contentBottom=e.createElement("div"),this._contentBottom.classList.add("bot-content")},I.prototype.inject=function(e){e.appendChild(this._container)},I.prototype._loadDataInIDCard=function(e){e.member[0].revision="";var t=e.member[0];C.setParent({state:t.state,type:t.type}),this._modelForIdCard=p.prepareIdCardData(e,this._privateModelEvents,{commands:{relatedObjects:!0}}),this._idCardAttrbEditorUtil.setModelAndInitCollabObj(this._modelForIdCard),this._enoxIDCardContainer.init({},this._modelForIdCard),this._enoxIDCardContainer.inject(this._container),this._enoxIDCardContainer.getMainContent().appendChild(this._contentBottom),_.getCollapse(this._pathItemsDetail)?this._privateModelEvents.publish({event:"idcard-container-minimize-idcard"}):this._privateModelEvents.publish({event:"idcard-container-maximize-idcard"})},I.prototype._fetchData=function(){var i=this;t.mask(this._container),e.extendElement(this._contentBottom),l[this.mySettings.serviceHandlers.getItemDetails]({id:i._id}).then(function(n){i._isDestroyed?M&&e.log("GetItemDetails: destroyed before being loaded"):(i._loadDataInIDCard(n),t.unmask(i._container))},function(){t.unmask(i._container),e.log("getItemDetails: Service Call Failed !!!"),g.showError(i.mySettings.NLS.getItemDetailsError)}),this._contentBottom.innerHTML="",this._subItemsPresenter.inject(this._contentBottom),this._subItemsPresenter.loadData(this._id,"").then(function(){},function(){})},I.prototype.destroy=function(){this._container=null,this._isDestroyed=!0,this._subItemsPresenter&&this._subItemsPresenter.destroy(),this._myEventManager&&(this._myEventManager.cleanup("EntDicoItemDetailsPresenter_"+this.mySettings.settingsFor),this._myEventManager=null)},I.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-model-refresh"},function(){e._refreshIdCardModel(),s.getDependency("modelDetailsStatePresenter")&&e._applicationChannel.publish({event:"enox-model-app-variability-updated",data:e._id})}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-minified"},function(){_.updateCollapse(e._pathItemsDetail,!0)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-maximized"},function(){_.updateCollapse(e._pathItemsDetail,!1)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-dropdown-menu-action"},function(t){e.actionDropDownMenuIdCard(t)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-thumbnail-changed"},function(){e._updateChannel.publish({event:"xmodel-list-data-item-need-refresh",data:e._id})}),this._myEventManager.subscribe(this._privateModelEvents,{event:"enox-dialog-delete"},function(t){e._deleteItems(t)})},I.prototype._refreshIdCardModel=function(){var t=this;l[this.mySettings.serviceHandlers.getItemDetails]({id:t._id}).then(function(i){if(t._isDestroyed)M&&e.log("Variant Details Presenter destroyed before being loaded");else{var n=p.prepareIdCardData(i,t._privateModelEvents,{commands:{relatedObjects:!0}});if(t._modelForIdCard.set("attributes",n.get("attributes")),t._modelForIdCard.set("name",n.get("name")),t._modelForIdCard.set("freezones",n.get("freezones")),i&&i.member&&1===i.member.length){var a=i.member[0];C.setParent({state:a.state,type:a.type})}}},function(){e.log("getItemDetails: Service Call Failed !!!"),g.showError(t.mySettings.NLS.getItemDetailsError)})},I.prototype._deleteItems=function(t){var i=this,n=t;l[this.mySettings.serviceHandlers.deleteItems]({ids:n}).then(function(){i._applicationChannel.publish({event:"navigate-backward",data:{reload:!1,replace:!0}}),i._updateChannel.publish({event:"xmodel-list-data-item-remove-action",data:n}),i._applicationChannel.publish({event:"enox-model-app-item-removed",data:n})},function(t){e.log("Failure while deleting item!!!"+t),S.showError({action:y.DELETE,type:y.VARIABILITY_TAB,message:t})||g.showError(i.mySettings.NLS.deleteItemError)})},I.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:"VariantDetails"===this.mySettings.settingsFor?D._variantSingle:D._optionGroupSingle,multiple:"VariantDetails"===this.mySettings.settingsFor?D._variantMultiple:D._optionGroupMultiple,modelEvent:t,immersiveFrame:E.getImmersiveFrame()};b.showDialog(i)},I.prototype.actionDropDownMenuIdCard=function(e){var t;switch(e){case"information":f.removeAllSelection(),f.showInformation(this._id);break;case"delete":var i=[{id:this._id,title:this._options.name}];this.createDeleteModelDialog(i,this._privateModelEvents);break;case"owner":switch(this._options.settingsForSubItems.parentType){case"Variability Group":t=y.TYPE_OptionGroup;break;case"Variant":t=y.TYPE_VARIANT}C.checkActionAccess({action:y.MOVE,type:t,notify:!0})&&this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"owner"}});break;case"state":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"state"}});break;case"revision":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"revision"}});break;case"relatedObjects":this._relatedObjectsCmd.execute({id:this._id,type:"",title:this._variantClassName})}},I}),define("DS/ENOXModelApp/ModelDefinition/js/ModelDetailsStatePresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","UWA/Class/Model","DS/Controls/Tab","DS/ENOXIDCardContainer/js/ENOXIDCardContainer","DS/ENOXModelApp/ModelDefinition/js/NewVariabilityPresenter_v2","DS/ENOXModelApp/ModelDefinition/js/LocalRulesPresenter","DS/ENOXModelApp/ModelDocument/js/ModelDocumentDetailsPresenter","DS/ENOXModelApp/ModelDefinition/js/LocalRequirementsPresenter","DS/ENOXModelApp/ModelDefinition/js/ModelManufacturingPlansPresenter","DS/ENOXModelApp/ModelDefinition/js/PCListPresenter","DS/ENOXModelApp/ModelDefinition/js/ModelCopyFromPresenter","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/PCDefinition/PCDetailsStatePresenter","DS/ENOXModelApp/BaseConfigDefinition/BaseConfigDetails","DS/ENOXModelApp/RuleDefinition/RuleDetailsStatePresenter","DS/ENOXSplitView/js/ENOXSplitView","DS/ENOXModelApp/RuleDefinition/RulePresenter","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/xModelIDCardAttributeEditor","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/CfgSolver/CfgSolverServices","DS/ConfiguratorPanel/scripts/ConfiguratorSolverFunctionsV2","DS/TaggerOnIndexComponent/TaggerOnIndexComponent","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/Utils/xModelCommand","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelVariability","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXRelatedProject/RelatedProjectsManager","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/ENOXModelApp/PCBulkEdition/PCsBulkTablePresenter","DS/ENOXModelApp/ModelDefinition/js/LocalSpecificationPresenter","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelDetailsStatePresenter","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelsStatePresenter","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","css!DS/ENOXModelApp/ModelDefinition/css/ModelDetails.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x,R,V,N,L,F,U,k,X,B,j,G,W,Y,H,q,z,K){"use strict";const J="Base Configuration",Q="Product Configuration";var $=window.localStorage.XMODEL_BROWSER_LOG_DEBUG,Z=function(){};return Z.prototype.init=function(t,n){var a=this;this._isDestroyed=!1,this.fromRoadmapContext=n.fromRoadmapContext,this._isReadyToNavigate=!0,this._pathModelDetail=[V._KEY,V._VIEWS_PREFERENCES,V._MODEL_VERSIONS_DETAILS],this._pathRule=[V._KEY,V._VIEWS_PREFERENCES,V._MODEL_VERSIONS_DETAILS,V._RULES],this._pathPC=[V._KEY,V._VIEWS_PREFERENCES,V._MODEL_VERSIONS_DETAILS,V._PRODUCT_CONFIGURATIONS],this._pathRequirements=[V._KEY,V._VIEWS_PREFERENCES,V._MODEL_VERSIONS_DETAILS,V._REQUIREMENTS],this._pathDevelopments=[V._KEY,V._VIEWS_PREFERENCES,V._MODEL_VERSIONS_DETAILS,V._MANUFACTURINGPLANS],a._pathBC=[V._KEY,V._VIEWS_PREFERENCES,V._MODEL_VERSIONS_DETAILS,V._BASE_CONFIGURATIONS],this._options=n,this._id=n.id,this._modelId=n.modelID,this._applicationChannel=t,this._privateChannelForRules=new i,this._privateChanelForSpecifications=new i,this._privateChannelForPCs=new i,this._privateChannelForRequirements=new i,this._updateChannelLocal=new i,this._privateChannelForSplitView=new i,this._bridgeModelEvent=new i,this._privateModelEvents=new i,this._solverModelEvent=new i,this._solverModelEventsBC=new i,this._modelCopyFromEvent=new i,this._modelEventForVariability=new i,this._privateChannelForMFPlans=new i,this._myEventManager=new R(this._applicationChannel,this._privateChannelForRules,this._privateChannelForPCs,this._privateChannelForRequirements,this._updateChannelLocal,this._solverModelEventsBC,this._privateChannelForSplitView,this._bridgeModelEvent,this._privateModelEvents,this._modelCopyFromEvent,this._modelEventForVariability,this._privateChannelForMFPlans,this._privateChanelForSpecifications),this._idCardData={},this._modelName=n.modelName?n.modelName:"",this._modelPhysId="",this._modelTitle=n.modelTitle?n.modelTitle:"",this._modelVersionName=n.name?n.name:"",this._modelVersionVersion=n.version?n.version:"",this._modelMaturity="",this._modelType=n.type?n.type:"Products",this._infoContext=I.ROUTE_MODEL_INFO,D.initialize({applicationChannel:this._applicationChannel,silent:!0,context:this._infoContext,readOnly:!1,id:this._id,label:this._modelName,type:this._modelType}),this._modelVersionVariabilityUpdated=!0,this._modelVersionRuleUpdated=!1,this._solverUpdated=!1,this.modelDetailsTabContext=["Configurations","Rules","Documents","Variability","Requirements","ManufacturingPlans"],!n||"Review"!==n.state&&"Release"!==n.state&&"Obsolete"!==n.state?this._allowEdit=!0:this._allowEdit=!1,this._localReqsPresenter=new c,this._mfPlanPresenter=new p,this._enoxIDCardContainer=new s,this._localRulesPresenter=new l,this._localSpecificationPresenter=new Y,this._RelatedProjectsManager=X?new X:null,this._variabilityPresenter=new r({editable:this._allowEdit,modelId:this._id,model:n,applicationChannel:this._applicationChannel,localChannel:this._modelEventForVariability});var o={id:this._id,editable:this._allowEdit,modelName:this._modelName,modelVersionId:this._id,modelVersionName:this._modelVersionName,modelID:n.modelID,modelVersion:this._modelVersionVersion},d={id:this._id,editable:this._allowEdit,modelName:this._modelName,mvState:n&&n.state?n.state:""};this._rulePresenter=new b;var h={modelId:this._id,applicationChannel:this._applicationChannel,privateChannelForRules:this._privateChannelForRules};this._pcsBulkTablePresenter=new W(h);var m={modelName:this._modelName,modelVersionId:this._id,modelVersionName:this._modelVersionName,modelVersionVersion:this._modelVersionVersion,privateChannelForRules:this._privateChannelForRules,privateChannelForConfigs:this._privateChannelForPCs},_={id:this._id,editable:!0,modelName:this._modelName,modelVersionId:this._id,modelVersionName:this._modelVersionName,modelVersion:this._modelVersionVersion},f={id:this._id,editable:this._allowEdit,modelVersionId:this._id,modelVersionName:this._modelVersionName,modelVersion:this._modelVersionVersion},E={id:this._id,editable:this._allowEdit,modelName:this._modelName,modelId:a._modelId};this._solverKeyForRules=null,this._localRulesPresenter.init(this._privateChannelForRules,this._applicationChannel,this._privateChannelForSplitView,o),this._localReqsPresenter.init(this._privateChannelForRequirements,this._privateChannelForSplitView,d),this._mfPlanPresenter.init(this._privateChannelForMFPlans,this._applicationChannel,E),this._localSpecificationPresenter.init(this._privateChanelForSpecifications,this._applicationChannel,f),this._bcDetails=new v,this._bcDetails.init(this._applicationChannel,this._solverModelEventsBC,m),N.updateSelectedItems(this._pathModelDetail,this._id);var C,y=N.getSplitViewStatus(this._pathRule),S=N.getSplitViewStatus(this._pathPC),A=(N.getSplitViewStatus(this._pathBC),40),P=!1;"true"===y&&(this.RulesPreviewActivated=!0,P=!0,(C=N.getSplitViewWidth(this._pathRule))&&(A=C)),"true"===S&&(this.PCPreviewActivated=!0,P=!0,(C=N.getSplitViewWidth(this._pathPC))&&(A=C));var w={modelEvents:this._privateChannelForSplitView,withtransition:!0,withoverflowhidden:!1,params:{leftWidth:A,leftVisible:!0,rightVisible:P,rightMaximizer:!0,leftMaximizer:!1}};this._splitView=new g,this._splitView.init(w),this._PCListPresenter=new u,this._PCListPresenter.init(this._privateChannelForPCs,this._applicationChannel,_),this._relatedObjectsCmd=new x,this._idCardAttrbEditorUtil=new M,this._idCardAttrbEditorUtil.init(this._privateModelEvents),this._xModelVariability=new L({id:this._id}),this._initCommand(),this._subscribeToEvents(),this._initDivs(),this._initWebUXTabs(),e.is(a.fromRoadmapContext)||O.debouncer(function(){require(["DS/ENOXModelApp/Utils/xModelLinkManager"],t=>{e.log("Publishing Item Details page opened event on Link Manager"),t.publish("DS/ENOXMDLDEF/ITEM/OPENED",{id:a._id,title:a._modelVersionName,revision:a._modelVersionVersion,parentId:a._modelId,parentTitle:a._modelName,type:"Products",parentRevision:"-",objectMaturityState:a._modelMaturity})})},2e3).call(this),this.activateModelFacet(),this.activateProjectsFacet(),this.activateEffectivityFacet(),this.activateCompositionFacet()},Z.prototype._subscribeToEvents=function(){var i=this;this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-minified"},function(){N.updateCollapse(i._pathModelDetail,!0)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-container-maximized"},function(){N.updateCollapse(i._pathModelDetail,!1)}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-dropdown-menu-action"},function(e){i.actionDropDownMenuIdCard(e)}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"splitview-restore-panel"},function(){i._bridgeModelEvent.publish({event:"right-side-show-header"})}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"splitview-maximize-panel"},function(){i._bridgeModelEvent.publish({event:"right-side-hide-header"})}),i._rulesSolver=!1,this._myEventManager.subscribe(this._privateChannelForRules,{event:"rule_init_complete"},function(){i._rulesSolver=!0}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"on-preview"},function(e){i.selectedRule=i.selectedRule?i.selectedRule:{},i.RulesPreviewActivated=e.activated,i.onRulesPreview(i.selectedRule,e.activated)}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"mr-onsavedone"},function(e){i._privateModelEvents.publish({event:"model-version-rule-updated",data:e})}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"expr-rule-onsavedone"},function(e){i._privateModelEvents.publish({event:"model-version-rule-updated",data:e})}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"local-rule-deleted"},function(e){i._privateModelEvents.publish({event:"model-version-rule-updated",data:e})}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"existing-rule-added"},function(){i._modelVersionRuleUpdated=!0,i._solverUpdated=!1}),this._myEventManager.subscribe(this._privateModelEvents,{event:"model-version-rule-updated"},function(){i._modelVersionRuleUpdated=!0,i._solverUpdated=!1}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"xmodel-list-item-on-add-selection"},function(e){1===e.items.length?i.selectedRule=e.model:i.selectedRule=null,i.onRulesPreview(i.selectedRule,i.RulesPreviewActivated)}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"xmodel-list-item-on-remove-selection"},function(e){1===e.items.length?i.selectedRule=e.items[0].options.grid:i.selectedRule=null,i.onRulesPreview(i.selectedRule,i.RulesPreviewActivated)}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"update-ready-to-navigation-flag"},function(t){i._isReadyToNavigate=t,m.changeNavigationState(t),window.onpopstate=function(t){i._applicationChannel.publish({event:"browser-back-button-clicked",data:t}),e.log("browser back button clicked")}}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"update-ready-to-navigation-flag"},function(t){i._isReadyToNavigate=t,m.changeNavigationState(t),window.onpopstate=function(t){i._applicationChannel.publish({event:"browser-back-button-clicked",data:t}),e.log("browser back button clicked")}}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"xmodel-open-conflict-rule"},function(e){var t=e.model;i._isReadyToNavigate?t.id&&("Base Configuration"==e.type?m.navigate(I.ROUTE_MODEL_BC_DETAILS,{id:t.id,name:t.name,image:t.image,version:e.version,modelVersionId:i._id,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion,modelName:i._modelName}):m.navigate(I.ROUTE_MODEL_RULE_DETAILS,{id:t.id,name:t.name,image:t.image,version:null,modelVersionId:i._id,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion,modelName:i._modelName})):i._applicationChannel.publish({event:"warning-dialog-create",data:e})}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"previous-rule-activation"},function(e){A.setRuleActivation(e,"true",i._solverKeyForRules)}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"xmodel-list-item-on-dblclick"},function(e){var t=e.model;i.navigateToRule(t)}),this._myEventManager.subscribe(this._privateChannelForRules,{event:"xmodel-list-title-link-click"},function(e){var t=e.model;i.navigateToRule(t)}),this._myEventManager.subscribe(this._privateChanelForSpecifications,{event:"xmodel-list-item-on-dblclick"},function(t){var n=e.merge(t.model,{modelId:i._modelId,modelVersionId:t.model.parentId,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion});m.navigate(I.ROUTE_MODEL_DOC_DETAILS,n)}),this._myEventManager.subscribe(this._privateChanelForSpecifications,{event:"xmodel-list-title-link-click"},function(t){var n=e.merge(t.model,{modelId:i._modelId,modelVersionId:t.model.parentId,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion});m.navigate(I.ROUTE_MODEL_DOC_DETAILS,n)}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"on-preview"},function(e){(e="object"==typeof e?e:{}).activated=!!e.activated&&e.activated,i._privateChannelForPCs.publish({event:"xmodel-list-item-get-selection",data:function(t){let n=[],a=[];var o="";t.forEach(function(e){e.type===J?a.push(e):n.push(e)}),i.PCPreviewActivated=e.activated,a.length>0&&n.length>0?(o="Configuration",i.onConfigPreview([],e.activated,"added",o)):a.length>0?(o=J,i.onConfigPreview(a,e.activated,"added",o)):(o=Q,i.onConfigPreview(n,e.activated,"added",o))}})}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"xmodel-list-item-on-dblclick"},function(e){var t=e.model;t.type===J?m.navigate(I.ROUTE_MODEL_BC_DETAILS,{id:t.id,name:t.title,image:t.image,version:t.revision,modelVersionId:i._id,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion,modelName:i._modelName}):m.navigate(I.ROUTE_MODEL_PC_DETAILS,{id:t.id,name:t.title,image:t.image,version:t.revision,modelVersionId:i._id,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion,modelName:i._modelName})}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"xmodel-list-title-link-click"},function(e){var t=e.model;t.type===J?m.navigate(I.ROUTE_MODEL_BC_DETAILS,{id:t.id,name:t.title,image:t.image,version:t.revision,modelVersionId:i._id,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion,modelName:i._modelName}):m.navigate(I.ROUTE_MODEL_PC_DETAILS,{id:t.id,name:t.title,image:t.image,version:t.revision,modelVersionId:i._id,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion,modelName:i._modelName})}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"xmodel-list-item-on-add-selection"},function(e){let t=[],n=[],a=e.model;i.isTypeSelectionUniform(e.items)?(!0===e.multiSelect?a.forEach(function(e){e.options.grid.type===J?n.push(e.options.grid):t.push(e.options.grid)}):a.type===J?n.push(a):t.push(a),n.length>0&&i.onConfigPreview(n,i.PCPreviewActivated,"added",J),t.length>0&&i.onConfigPreview(t,i.PCPreviewActivated,"added",Q)):i.onConfigPreview([],i.PCPreviewActivated,"added","Configuration")}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"xmodel-list-item-on-remove-selection"},function(e){let t=[],n=[],a=e.model;var o=i.isTypeSelectionUniform(e.items),s=[];o?(e.items.length>0&&e.items.forEach(e=>{s.push(e.options.grid)}),!0===e.multiSelect?a.forEach(function(e){e.options.grid.type===J?n.push(e.options.grid):t.push(e.options.grid)}):a.type===J?n.push(a):t.push(a),t.length>0?(i.onConfigPreview(t,i.PCPreviewActivated,"removed",Q),s.length>0&&s[0].type===J&&i.onConfigPreview(s,i.PCPreviewActivated,"added",J)):(i.onConfigPreview(n,i.PCPreviewActivated,"removed",J),s.length>0&&s[0].type===Q&&i.onConfigPreview(s,i.PCPreviewActivated,"added",Q))):i.onConfigPreview([],i.PCPreviewActivated,"remove","Configuration")}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"xmodel-list-item-on-empty-selection"},function(){i._pcsBulkTablePresenter.removeAllLoadedPCs(),i._bcDetails.removeAllLoadedBCs()}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"xmodel-on-delete-baseConfig"},function(e){A.callSolveForBCRemoveData(e,i._solverKeyForRules),i._reloadVariabilityAndSolverKeys()}),this._myEventManager.subscribe(this._privateChannelForPCs,{event:"xmodel-dictionary-data"},function(){i._reloadVariabilityAndSolverKeys()}),this._myEventManager.subscribe(this._bridgeModelEvent,{event:"right-side-bar-tab-changed"},function(e){switch(i._privateChannelForSplitView.publish({event:"splitview-hide-panel",data:"right"}),e.idx){case"_0":i._variabilityPresenter&&i._variabilityPresenter.publishTags(),D.setContext("Variability"),i._infoContext="Variability",B.setcurrentTab(j.VARIABILITY_TAB);break;case"_1":i._localRulesPresenter&&i._localRulesPresenter.publishTags(),D.setContext("Rules"),i._infoContext="Rules",B.setcurrentTab(j.RULES_TAB),i.onRulesPreview(i.selectedRule,i.RulesPreviewActivated);break;case"_2":i._PCListPresenter&&i._PCListPresenter.publishTags(),D.setContext("ProductConfigurations"),i._infoContext="Rules",B.setcurrentTab(j.PC_TAB),i._privateChannelForPCs.publish({event:"xmodel-list-item-get-selection",data:function(e){i.onConfigPreview(e,i.PCPreviewActivated,"added")}});break;case"_4":i._localReqsPresenter&&i._localReqsPresenter.publishTags(),D.setContext("Requirements"),i._infoContext="Requirements",B.setcurrentTab(j.REQUIREMENTS_TAB);break;case"_5":i._mfPlanPresenter&&i._mfPlanPresenter.publishTags(),D.setContext("ManufacturingPlans"),i._infoContext="ManufacturingPlans",B.setcurrentTab(j.MANF_PLAN_TAB);break;case"_3":i._localSpecificationPresenter&&i._localSpecificationPresenter.publishTags(),D.setContext("Specifications"),i._infoContext="Specifications",B.setcurrentTab(j.SPECIFICATIONS_TAB)}}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-open-version-explorer"},function(){i.versionExplorer&&i.versionExplorer.showVersionExplorer()}),this._myEventManager.subscribe(this._privateModelEvents,{event:"idcard-model-refresh"},function(){i._refreshIdCardModel()}),this._myEventManager.subscribe(this._applicationChannel,{event:"enox-model-app-variability-updated"},function(){i._solverUpdated=!1,i._modelVersionVariabilityUpdated=!0,t.mask(i._variabilityContainer),i._checkForVariabilityUpdates().then(()=>{i._isDestroyed?$&&e.log("model details destroyed before being loaded"):(i._loadVariabilityData(i._variabilityDictionary),t.unmask(i._variabilityContainer))},()=>{t.unmask(i._variabilityContainer)})}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-app-update-list-view"},function(e){let t,n,a=e.tab;if(e.response){switch(a){case"variability":t="variability-filter-carried-over-response",n=i._variabilityPresenter.getListAndDataEvt();break;case"rules":t="rules-filter-carried-over-response",n=i._privateChannelForRules;break;case"configurations":t="config-filter-carried-over-response",n=i._privateChannelForPCs}n.publish({event:t,data:e})}}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-app-reinit-solver"},async function(){i._solverUpdated=!1,i._modelVersionVariabilityUpdated=!0}),this._myEventManager.subscribe(this._applicationChannel,{event:"mvcopy-launch-copy-from-dialog"},function(e){B.checkActionAccess({action:j.COPYFROM,notify:!0})&&i._launchCopyFromCommand(e)}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-app-rulelist"},function(e){i._rulesList=e}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-app-add-rulelist"},function(e){e.forEach(e=>{i._rulesList.member||(i._rulesList.member=[]),i._rulesList.member.push(e.item)}),i._rulesList.totalItems=i._rulesList.member.length}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-app-rules-list-remove"},function(e){let t=i._rulesList.member;for(let i=t.length;i>0;i--)if(e.includes(t[i-1].id)){let e=t.indexOf(t[i-1]);t.splice(e,1)}i._rulesList.totalItems=t.length}),this._myEventManager.subscribe(this._privateModelEvents,{event:"model-version-action-open"},function(e){i.navigateToModel(e.id)}),this._myEventManager.subscribe(this._modelEventForVariability,{event:"model-version-variability-updated"},function(){i._modelVersionVariabilityUpdated=!0,i._solverUpdated=!1,i._previousTabIndex&&"_0"!==i._previousTabIndex||setTimeout(function(){i._variabilityPresenter&&i._variabilityPresenter.publishTags()},1e3)}),this._myEventManager.subscribe(this._privateChannelForSplitView,{event:"splitview-size-changed"},function(e){e&&(i.PCPreviewActivated?N.updateSplitViewWidth(i._pathPC,e):i.RulesPreviewActivated&&N.updateSplitViewWidth(i._pathRule,e))}),this._myEventManager.subscribe(this._privateChannelForSplitView,{event:"splitview-show-panel"},function(e){"right"===e&&(i.PCPreviewActivated?N.updateSplitViewStatus(i._pathPC,"true"):i.RulesPreviewActivated&&N.updateSplitViewStatus(i._pathRule,"true"))}),this._myEventManager.subscribe(this._privateChannelForSplitView,{event:"splitview-hide-panel"},function(e){"right"===e&&(i.PCPreviewActivated?i.RulesPreviewActivated||N.updateSplitViewStatus(i._pathRule,"false"):N.updateSplitViewStatus(i._pathPC,"false"))}),this._myEventManager.subscribe(this._modelCopyFromEvent,{event:"mvcopy-enox-dialog-destroy"},function(e){i._modelCopyPresenter&&(i._modelCopyPresenter.destroy(),i._modelCopyPresenter=void 0)}),this._myEventManager.subscribe(this._applicationChannel,{event:"enox-model-app-refresh"},function(e){e&&e.reload&&window.widget.dispatchEvent("onRefresh")}),this._myEventManager.subscribe(this._privateModelEvents,{event:"enox-dialog-delete"},function(e){i._deleteModels(e)}),e.is(this._RelatedProjectsManager)&&this._RelatedProjectsManager.getEventChannel().subscribe({event:"enox-relprj-info-clicked"},function(){i._privateChannelForRules.publish({event:"xmodel-list-unselect-all"}),i._privateChannelForPCs.publish({event:"xmodel-list-unselect-all"}),i._privateChanelForSpecifications.publish({event:"xmodel-list-unselect-all"}),i._privateChannelForRequirements.publish({event:"xmodel-list-unselect-all"}),i._modelEventForVariability.publish({event:"xmodel-list-unselect-all"}),D.setContext("IDCard"),i._infoContext="IDCard",D.showInformation(i._id,!i._allowEdit)})},Z.prototype.isTypeSelectionUniform=function(t){if(e.is(t)&&e.is(t,"array")&&t.length>0)for(var i=t[0].options.grid.type,n=1;n<t.length;n++){if(i!==t[n].options.grid.type)return!1}return!0},Z.prototype._deleteModels=function(e){var t=this,i=e;E.deleteModelVersions({ids:i}).then(function(){m.navigate(I.ROUTE_MODELS,{reload:!1},{replace:!0}),t._applicationChannel.publish({event:"breadcrumb-remove-link",data:I.ROUTE_MODEL_INFO})},function(e){G.showError({action:j.DELETE,type:j.TYPE_MV,message:e})||F.showError(q.DELETE_MODELS_ERROR)})},Z.prototype.activateRoadMapFacet=function(t){this.deactivateRoadMapFacet(),t=t||{};var i={id:this._id,title:this._modelVersionName,revision:this._modelVersionVersion,parentId:this._modelPhysId,parentTitle:this._modelName,state:this._modelMaturity,image:this._modelVersionIcon};e.merge(t,i);var n={require:"DS/ENOXModelApp/InformationPanels/RoadMapTab/js/RoadMapTabPresenter",facet:{name:"RoadMap",text:K.Drivers,eventThread:"RoadMap",icon:"compass wux-ui-3ds"},options:{id:t.id,title:t.title,revision:t.revision,parentId:t.parentId,parentTitle:t.parentTitle,state:t.state,image:t.image},alwaysVisible:!0};D.addFacet({name:"RoadMap",facet:n},"IDCard")},Z.prototype.activateProjectsFacet=function(){if(this._RelatedProjectsManager){this.deactivateProjectsFacet();var e={require:"DS/ENOXModelApp/InformationPanels/ProjectsTab/js/ProjectsTabPresenter",facet:{name:"Projects",text:K.PROJECTS,eventThread:"projects",icon:"project-plans"},options:{isEditable:!0,RelatedProjectsManager:this._RelatedProjectsManager},alwaysVisible:!0};D.addFacet({name:"Projects",facet:e},"IDCard")}},Z.prototype.activateModelFacet=function(){this.deactivateModelFacet();var e={require:"DS/ENOXModelApp/InformationPanels/ModelsTab/js/ModelTabPresenter",position:3,actions:[H.ACTION_SWITCH,H.ACTION_RESET,{name:"Maturity",text:K.MATURITY,icon:"collaborative-lifecycle-management"},{name:"OpenWith",text:K.OPENWITH,icon:"open-menu-dot"}],facet:{name:"modelFacet",icon:"parcel",text:z.MODEL},options:{id:this._modelId,title:this._modelTitle},alwaysVisible:!0};D.addFacet({name:"modelFacet",facet:e},"IDCard")},Z.prototype.activateEffectivityFacet=function(){this.deactivateEffectivityFacet();var e={require:"DS/EffectivityContent/js/EffectivityTabFacet",facet:{name:"effectivityFacet",icon:"survey-list",text:K.EFFECTIVITY_TAB_TITLE},options:{},alwaysVisible:!0};D.addFacet({name:"effectivityFacet",facet:e},"IDCard")},Z.prototype.activateCompositionFacet=function(){if(I.MV_COMPOSITION_ENABLED){this.deactivateCompositionFacet();var e={require:"DS/ENOXModelApp/InformationPanels/CompositionTab/js/MVCompositionFacet",facet:{name:"compositionFacet",icon:"tree-view-flattened",text:K.COMPOSITION_FACET},options:{modelID:this._modelId},alwaysVisible:!0};D.addFacet({name:"compositionFacet",facet:e},"IDCard")}},Z.prototype.deactivateCompositionFacet=function(){I.MV_COMPOSITION_ENABLED&&D.removeFacet("compositionFacet","IDCard")},Z.prototype.deactivateEffectivityFacet=function(){D.removeFacet("effectivityFacet","IDCard"),this._currentFacet=null},Z.prototype.deactivateModelFacet=function(){D.removeFacet("modelFacet","IDCard"),this._currentFacet=null},Z.prototype.deactivateRoadMapFacet=function(){D.removeFacet("RoadMap","IDCard"),this._currentFacet=null},Z.prototype.deactivateProjectsFacet=function(){D.removeFacet("Projects","IDCard"),this._currentFacet=null},Z.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:z.modelVersionSingle,multiple:z.modelVersionMultiple,modelEvent:t,immersiveFrame:k.getImmersiveFrame()};U.showDialog(i)},Z.prototype.actionDropDownMenuIdCard=function(t){switch(t){case"information":D.removeAllSelection(),D.setContext("IDCard"),this._infoContext="IDCard",D.showInformation(this._id,!this._allowEdit);break;case"delete":if(B.checkActionAccess({action:j.DELETE,type:j.TYPE_MV,notify:!0})){var i=[{id:this._id,title:this._options.name}];this.createDeleteModelDialog(i,this._privateModelEvents)}break;case"owner":B.checkActionAccess({action:j.MOVE,notify:!0})&&this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"owner"}});break;case"state":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"state"}});break;case"revision":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"revision"}});break;case"relatedObjects":this._relatedObjectsCmd.execute({id:this._modelPhysId,type:"Model Version",title:this._modelName});break;case"copyFrom":B.checkActionAccess({action:j.COPYFROM,notify:!0})&&this._launchCopyFromCommand("idcard");break;case"compare":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:e.merge({type:this._modelForIdCard._attributes.nlsType},this._options),linkId:"compare"}});break;case"changeImpacts":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:e.merge({type:this._modelForIdCard._attributes.nlsType},this._options),linkId:"changeImpacts"}});break;case"subscribe":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"subscribe"}});break;case"unsubscribe":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"unsubscribe"}});break;case"editSubscriptions":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"editSubscriptions"}});break;case"mySubscriptions":this._privateModelEvents.publish({event:"xmodel-execute-command",data:{model:this._options,linkId:"mySubscriptions"}})}},Z.prototype._initCommand=function(){this._command=new T(this._privateModelEvents,this._container,this._applicationChannel)},Z.prototype.navigateToModel=function(e){e&&(this.destroy(),E.getModelDetails({id:e}).then(function(t){var i=t.member[0].modelName,n=t.member[0].title,a=t.member[0].revision,o=t.member[0].type,s=t.member[0].modelID;m.navigate(I.ROUTE_MODEL_DETAILS,{id:e,name:n,version:a,modelName:i,type:o||"Products",modelID:s},{reload:!0})},function(){F.showError(q.GET_MODEL_DETAILS_ERROR)}))},Z.prototype.navigateToRule=function(e){var i=this;t.mask(i._container),this._rulePresenter.clear(),this._solverModelEvent.publish({event:"mr-stop-recursive-call"}),i._checkForSolverUpdates().then(function(){function n(){i.previouslySelectedRule=e.id,m.navigate(I.ROUTE_MODEL_RULE_DETAILS,{id:e.id,name:e.title,image:e.image,version:null,modelVersionId:i._id,modelVersionName:i._modelVersionName,modelVersion:i._modelVersionVersion,modelName:i._modelName}),t.unmask(i._container),i._ruleDetailsStatePresenter&&i._ruleDetailsStatePresenter.unmaskRuleContent()}e.id&&(i.previouslySelectedRule&&e.id!==i.previouslySelectedRule?A.setRuleActivation(i.previouslySelectedRule,"true",i._solverKeyForRules).then(function(){n()},function(){t.unmask(i._container)}):n()),function e(){var t;i._rulesSolver?(i._rulesSolverInit=!0,t&&clearTimeout(t),i._ruleDetailsStatePresenter&&(i._ruleDetailsStatePresenter.updateView(),i._ruleDetailsStatePresenter.unmaskRuleContent())):(i._ruleDetailsStatePresenter&&i._ruleDetailsStatePresenter.maskRuleContent(),t=setTimeout(function(){e()},1e3))}()}).catch(function(){})},Z.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("model-details"),this._contentBottom=e.createElement("div"),this._contentBottom.classList.add("bot-content"),this._splitView.inject(this._contentBottom),this._leftPanelBottom=this._splitView.getLeft(),this._rightPanelBottom=e.extendElement(this._splitView.getRight()),this._variabilityContainer=e.createElement("div"),this._variabilityContainer.classList.add("model-variability-container"),this._variabilityPresenter.render().inject(this._variabilityContainer),this._rulesContainer=e.createElement("div"),this._rulesContainer.classList.add("model-rules-container"),this._localRulesPresenter.inject(this._rulesContainer),this._productConfigurationContainer=e.createElement("div"),this._productConfigurationContainer.classList.add("model-PC-container"),this._PCListPresenter.inject(this._productConfigurationContainer),this._reqsContainer=document.createElement("div"),this._reqsContainer.classList.add("model-requirements-container"),this._localReqsPresenter.inject(this._reqsContainer),this._specificationsContainer=document.createElement("div"),this._specificationsContainer.classList.add("model-specifications-container"),this._localSpecificationPresenter.inject(this._specificationsContainer),this._developmentContainer=document.createElement("div"),this._developmentContainer.classList.add("model-development-container"),this._mfPlanPresenter.inject(this._developmentContainer)},Z.prototype._initWebUXTabs=function(){var e=N.getTab(this._pathModelDetail)||"_0";"_4"===e&&!1===I.REQUIREMENTS_ENABLED&&(e="_0",N.updateTab(this._pathModelDetail,e));var t={label:q._variability,isSelected:"_0"===e,index:0,value:"_0",allowUnsafeHTMLOnTabButton:!1,content:this._variabilityContainer},i={label:q._rules,isSelected:"_1"===e,index:1,value:"_1",allowUnsafeHTMLOnTabButton:!1,content:this._rulesContainer},n={label:q._configurations,isSelected:"_2"===e,content:this._productConfigurationContainer,allowUnsafeHTMLOnTabButton:!1,index:2,value:"_2"},a={label:q._backlog,isSelected:"_4"===e,content:this._reqsContainer,index:4,value:"_4",allowUnsafeHTMLOnTabButton:!1},s={label:q._manufacturingPlans,isSelected:"_5"===e,content:this._developmentContainer,index:5,value:"_5",allowUnsafeHTMLOnTabButton:!1},r={label:q._specifications,isSelected:"_3"===e,content:this._specificationsContainer,index:3,value:"_3",allowUnsafeHTMLOnTabButton:!1};this._webUXTabs=new o({showComboBoxFlag:!0,touchMode:!0,allowUnsafeHTMLOnTabButton:!1,displayStyle:["strip"]}),this._webUXTabs.tabBar.centeredFlag=!1,this._webUXTabs.add(t),this._webUXTabs.add(i),this._webUXTabs.add(n),this._webUXTabs.add(r),I.REQUIREMENTS_ENABLED&&this._webUXTabs.add(a),this._webUXTabs.add(s),this._webUXTabs.getContent().classList.add("height100"),this._webUXTabs.tabPanelContainer.classList.add("tab-content"),this._webUXTabs.tabPanelContainer.classList.add("tab-in-mobile"),this._webUXTabs.inject(this._leftPanelBottom);var l=this;e&&(l._previousTabIndex=e),this._webUXTabs.addEventListener("change",function(e){if(void 0!==e.dsModel&&void 0!==e.dsModel.tabBar&&(!e.dsModel||e.dsModel.value)){N.updateTab(l._pathModelDetail,e.dsModel.value[0]);var t=e.dsModel&&e.dsModel.value?e.dsModel.value[0]:void 0;switch(l._previousTabIndex||(l._previousTabIndex="_0"),l._previousTabIndex){case"_0":l._variabilityPresenter&&l._variabilityPresenter.clearTags();break;case"_1":l._localRulesPresenter&&l._localRulesPresenter.clearTags();break;case"_2":l._PCListPresenter&&l._PCListPresenter.clearTags();break;case"_4":l._localReqsPresenter&&l._localReqsPresenter.clearTags();break;case"_5":l._mfPlanPresenter&&l._mfPlanPresenter.clearTags();break;case"_3":l._localSpecificationPresenter&&l._localSpecificationPresenter.clearTags()}l._previousTabIndex=t,l._bridgeModelEvent.publish({event:"right-side-bar-tab-changed",data:{idx:t}})}})},Z.prototype.inject=function(e){e.appendChild(this._container),this._privateModelEvents&&O.setModelEventForIdCard(this._privateModelEvents),this.activateRoadMapFacet(),D.setContext(this._infoContext,{id:this._id})},Z.prototype._loadData=function(t){if(null!=t){this._modelForIdCard=O.prepareIdCardData(t,this._privateModelEvents,{commands:{relatedObjects:!0,copyFrom:this._allowEdit,compare:!0,changeImpacts:!0,subscriptions:!0},projectsattribute:e.is(X)}),this._idCardAttrbEditorUtil.setModelAndInitCollabObj(this._modelForIdCard),this._enoxIDCardContainer.init({modelEvents:this._privateModelEvents},this._modelForIdCard),this._container.empty(),this._enoxIDCardContainer.inject(this._container),this._enoxIDCardContainer.getMainContent().appendChild(this._contentBottom),this._bridgeModelEvent.publish({event:"right-side-bar-tab-changed",data:{idx:this._previousTabIndex}}),N.getCollapse(this._pathModelDetail)&&this._privateModelEvents.publish({event:"idcard-toggle-minified-view"});var i=this._enoxIDCardContainer.getIDCard();if(i){var n=i.getElement(".version");n&&(this.versionExplorer=new S({id:this._id,name:this._modelName,target:n,renderTo:this._container,modelEvents:this._privateModelEvents,applicationChannel:this._applicationChannel}));var a=i.getElement("#IdCardProjectValueContainer");if(e.is(this._RelatedProjectsManager)&&e.is(a)){var o=null;e.is(this._modelForIdCard)&&e.is(this._modelForIdCard._attributes)&&e.is(this._modelForIdCard._attributes.thumbnail)&&(o=this._modelForIdCard._attributes.thumbnail),this._RelatedProjectsManager.set({id:this._id,title:this._modelName,image:o,type:this._modelType,serviceId:"3DSpace"}),this._RelatedProjectsManager.getInfoSection().inject(a)}}}},Z.prototype.getID=function(){return this._id},Z.prototype.isDetailsInitialized=function(){return this._container&&this._container.firstChild},Z.prototype._loadVariabilityData=function(t){try{var i=e.clone(t);i&&!i._version&&(i._version="2.0"),this._variabilityPresenter.loadData(i),"_0"===(N.getTab(this._pathModelDetail)||"_0")&&this._variabilityPresenter.publishTags()}catch(t){e.log("[ModelDetailsStatePresenter:_loadVariabilityData] Exception occured!!!"+t.stack)}},Z.prototype._fetchData=function(){var i=this;i.modelDetailsTabContext.forEach(function(e){D.removeAllSelection(e)}),t.mask(this._container),E.getModelDetails({id:i._id}).then(function(n){i._modelName=n.member[0].modelName,i._modelPhysId=n.member[0].modelID,i._modelTitle=n.member[0].modelTitle,i._modelVersionName=n.member[0].title,i._modelVersionVersion=n.member[0].revision,i._modelVersionIcon=n.member[0].image;var a=n.member[0].state;if(B.setParent({state:a,type:I.TYPE_MODELVERSION}),i._modelMaturity=a,i._pcsBulkTablePresenter.setModelMaturity(i._modelMaturity),i._allowEdit=!a||"Review"!==a&&"Release"!==a&&"Obsolete"!==a,D.setCurrReadOnlyStatus(i.modelDetailsTabContext,!i._allowEdit),i._isDestroyed)return $&&e.log("model details destroyed before being loaded"),void t.unmask(i._container);i._modelEventForVariability.publish({event:"set-variability-editable",data:i._allowEdit}),i._privateChannelForRules.publish({event:"set-rule-editable",data:i._allowEdit}),i._privateChannelForPCs.publish({event:"update-pc-actions",data:{create:a&&"Obsolete"!==a,delete:i._allowEdit}}),i._privateChanelForSpecifications.publish({event:"set-specifications-editable",data:i._allowEdit}),i._privateChannelForRequirements.publish({event:"set-requirement-editable",data:i._allowEdit}),i._privateChannelForMFPlans.publish({event:"set-mf-plans-editable",data:a&&"Obsolete"!==a});var o={id:i._id,title:i._modelVersionName,revision:i._modelVersionVersion,parentId:i._modelPhysId,parentTitle:i._modelName,state:i._modelMaturity,image:i._modelVersionIcon};i.activateRoadMapFacet(o),i._loadData(n),C.addRecentItemsIds(function(){},function(){},i._id),t.unmask(i._container)},function(){t.unmask(i._container),F.showError(q.GET_MODEL_DETAILS_ERROR)}),this._variabilityPresenter.loadFirstLevelData(),this._fetchVariability().then(()=>{this._isDestroyed?$&&e.log("model details destroyed before being loaded"):(this._loadVariabilityData(this._variabilityDictionary),this.PCPreviewActivated&&this._privateChannelForPCs.publish({event:"xmodel-list-item-get-selection",data:function(e){i.onConfigPreview(e,i.PCPreviewActivated,"added")}}))},()=>{F.showError(q.GET_MODEL_VARIABILITY_ERROR)}),this._solverUpdated=!0,this._getSolverPromise=this._xModelVariability.initSolver().then(e=>{this._solverKeyForRules=e,this._privateChannelForRules.publish({event:"rule_init_complete"}),this._privateChannelForRules.publish({event:"solver-init-completed",data:e})},()=>{this._solverUpdated=!1}),i._localRulesPresenter.loadData();var n=N.getCustomAttributeStatus(i._pathPC);i._PCListPresenter.loadData(n),i._localReqsPresenter.loadData(),i._mfPlanPresenter.loadData(),i._localSpecificationPresenter.loadData()},Z.prototype.getVariabilityDefinitionPromise=function(){},Z.prototype.destroy=function(){var e=this;this._pathModelDetail&&N.updateSelectedItems(this._pathModelDetail,""),this._container=null,B.destroy(),this._isDestroyed=!0,this.deactivateRoadMapFacet(),this.deactivateProjectsFacet(),this.deactivateModelFacet(),this.deactivateEffectivityFacet(),this.deactivateCompositionFacet(),this._RelatedProjectsManager&&this._RelatedProjectsManager.destroy(),P.releaseSolver(),m.setDependency("modelDetailsStatePresenter",null),this._myEventManager&&(this._solverModelEvent.publish({event:"mr-stop-recursive-call"}),this._myEventManager.cleanup("ModelDetailsStatePresenter"),this._myEventManager=null);["_variabilityPresenter","_localRulesPresenter","_PCListPresenter","_localReqsPresenter","_mfPlanPresenter","_xModelVariability","_localSpecificationPresenter"].forEach(function(t){e[t]&&(e[t].destroy(),e[t]=null)})},Z.prototype._initPCDetails=function(i){this._PCDetailsStatePresenter=new _,i.modelName=this._modelName,i.modelPhysId=this._modelPhysId,i.modelVersionName=this._modelVersionName,i.modelVersionVersion=this._modelVersionVersion;var n=this;return t.mask(this._container),this._checkForSolverUpdates(i).then(function(){i.variabilityDictionary=n._variabilityDictionary,i.solverKey=n._solverKeyForRules,n._PCDetailsStatePresenter.init(n._applicationChannel,n._updateChannelLocal,i),m.setDependency("PCDetailsStatePresenter",n._PCDetailsStatePresenter);var a=n._container.parentElement;return n._container.parentElement.removeChild(n._container),n._PCDetailsStatePresenter.inject(a),n._pcsBulkTablePresenter.loadVariabilityInfo(n._variabilityDictionary),t.unmask(n._container),e.Promise.resolve()},function(){return t.unmask(n._container),e.Promise.reject()})},Z.prototype._initBCDetails=function(i){var n=this;return t.mask(this._container),this._checkForSolverUpdates(i).then(function(){i.variabilityDictionary=n._variabilityDictionary,i.solverKey=n._solverKeyForRules,m.setDependency("BCDetails",n._bcDetails);var a=n._container.parentElement;return n._container.parentElement.removeChild(n._container),n._bcDetails.inject(a),t.unmask(n._container),e.Promise.resolve(i)},function(){return t.unmask(n._container),e.Promise.reject()})},Z.prototype._initRuleDetails=function(i){var n=this;return t.mask(n._container),this._checkForSolverUpdates(i).then(function(){n._ruleDetailsStatePresenter=new f,i.solverKey=n._solverKeyForRules,i.dictionary=n._dictionaryForRule,i.modelVersionName=n._modelVersionName,i.modelVersionVersion=n._modelVersionVersion;var a={ruleId:i.id,modelId:n._id,ruleName:i.name,editable:n._allowEdit};n._ruleDetailsStatePresenter.init(a,n._privateChannelForRules,n._applicationChannel,i),m.setDependency("RuleDetailsStatePresenter",n._ruleDetailsStatePresenter);var o=n._container.parentElement;return n._container.parentElement.removeChild(n._container),n._ruleDetailsStatePresenter.inject(o),n._localRulesPresenter&&n._localRulesPresenter.clearTags(),t.unmask(n._container),e.Promise.resolve()},function(){return t.unmask(n._container),e.Promise.reject()})},Z.prototype._initDocDetails=function(e){this._DocDetailsPresenter=new d,this._DocDetailsPresenter.init(this._applicationChannel,e),m.setDependency("DocDetailsPresenter",this._DocDetailsPresenter);var t=this._container.parentElement;this._container.parentElement.removeChild(this._container),this._DocDetailsPresenter.inject(t),w.deactivateAll(),this._localSpecificationPresenter&&this._localSpecificationPresenter.clearTags(),m.setDependency("DocPresenter",this._localSpecificationPresenter)},Z.prototype.onRuleSelect=function(e){var t={ruleId:e.id,modelId:this._id,ruleName:e.title},i={};i.solverKey=this._solverKeyForRules,i.solverModelEvent=this._solverModelEvent,i.previewMode=!0,i.editable=this._allowEdit,i.privateChannelForRules=this._privateChannelForRules,this._solverKeyForRules&&this._dictionaryForRule&&(i.contextDictionary=this._dictionaryForRule,i.dictionary=this._dictionaryForRule,this._privateChannelForSplitView.publish({event:"splitview-show-panel",data:"right"}),this._rulePresenter.clear(),this._rightPanelBottom.innerHTML="",this._rulePresenter.init(t,this._privateChannelForRules,this._applicationChannel,e.id,i),this._rulePresenter.inject(this._rightPanelBottom))},Z.prototype.onRulesPreview=function(e,i){if(i){this._rightPanelBottom.innerHTML="";var n=N.getSplitViewWidth(this._pathRule);if(n&&this._privateChannelForSplitView.publish({event:"splitview-set-size-panel",data:n}),this._privateChannelForSplitView.publish({event:"splitview-show-panel",data:"right"}),N.updateSplitViewStatus(this._pathRule,"true"),e){t.mask(this._rightPanelBottom);var a=this;a._checkForSolverUpdates().then(function(){a.selectedRule?a.previouslySelectedRule?A.setRuleActivation(a.previouslySelectedRule,"true",a._solverKeyForRules).then(function(){a.onRuleSelect(a.selectedRule),a.previouslySelectedRule=a.selectedRule.id,t.unmask(a._rightPanelBottom)},function(){t.unmask(a._rightPanelBottom)}):(t.unmask(a._rightPanelBottom),a.onRuleSelect(a.selectedRule),a.previouslySelectedRule=a.selectedRule.id):(t.unmask(a._rightPanelBottom),a.setRightPanelMessage())},function(){t.unmask(a._rightPanelBottom),F.showError("Error while reloading Variability and/or initializing solver!!")})}else this.setRightPanelMessage()}else this._rightPanelBottom.innerHTML="",this._privateChannelForSplitView.publish({event:"splitview-hide-panel",data:"right"}),N.updateSplitViewStatus(this._pathRule,"false"),this._privateChannelForRules.publish({event:"triptych-hide-panel-if-opened-from-rule",data:{}})},Z.prototype.onConfigPreview=function(i,n,a,o){var s=this;this._configPreviewObj={data:i,activated:n,action:a,type:o},!0===n?this._checkForSolverUpdates().then(function(o){if(o&&(s._pcsBulkTablePresenter.loadVariabilityInfo(s._variabilityDictionary),s._bcDetails.loadVariabilityInfo(s._variabilityDictionary)),!0===s._configPreviewObj.activated){var r=N.getSplitViewWidth(s._pathPC);if(r&&s._privateChannelForSplitView.publish({event:"splitview-set-size-panel",data:r}),s._privateChannelForSplitView.publish({event:"splitview-show-panel",data:"right"}),N.updateSplitViewStatus(s._pathPC,"true"),void 0===s._configPreviewObj.data||Array.isArray(s._configPreviewObj.data)&&s._configPreviewObj.data.length<=0)"Configuration"===s._configPreviewObj.type?s.setRightPanelMessage(q._MultiSelectionOfTypes+"\n"+q._configurationPreviewMessage):s.setRightPanelMessage(q._configurationPreviewMessage);else{var l;if(s._rightPanelBottom.getElementsByClassName("bulk-edit-container").length<=0&&s.resetRightPanelMessage(),t.mask(s._rightPanelBottom),"added"===a)l=e.is(i,"array")?i:[i],s._configPreviewObj.type===J?(s._bcDetails.inject(s._rightPanelBottom),s._bcDetails.fetchData(l)):s._configPreviewObj.type===Q&&(s._pcsBulkTablePresenter.inject(s._rightPanelBottom),s._pcsBulkTablePresenter.fetchData(l));else"removed"===a&&(s._configPreviewObj.type===J?(s._bcDetails.removeLoadedBC(i),s._bcDetails.getNbLoadedBCs()<=0&&s.setRightPanelMessage(q._configurationPreviewMessage)):s._configPreviewObj.type===Q&&(s._pcsBulkTablePresenter.removeLoadedPC(i),s._pcsBulkTablePresenter.getNbLoadedPCs()<=0&&s.setRightPanelMessage(q._configurationPreviewMessage)));t.unmask(s._rightPanelBottom)}}else!1===n&&(s._rightPanelBottom.innerHTML="",s._privateChannelForSplitView.publish({event:"splitview-hide-panel",data:"right"}),N.updateSplitViewStatus(s._pathPC,"false"))}).catch(function(){}):!1===n&&(this._rightPanelBottom.innerHTML="",this._privateChannelForSplitView.publish({event:"splitview-hide-panel",data:"right"}))},Z.prototype.setRightPanelMessage=function(e){this._rightPanelBottom.innerHTML=e||q._no_data_in_preview,this._rightPanelBottom.classList.add("noContentTitle")},Z.prototype.resetRightPanelMessage=function(){this._rightPanelBottom.innerHTML="",this._rightPanelBottom.classList.remove("noContentTitle")},Z.prototype._refreshIdCardModel=function(){var t=this;E.getModelDetails({id:t._id}).then(function(i){var n=i.member[0];t._modelName=n.modelName,t._modelPhysId=n.modelID,t._modelTitle=n.modelTitle,t._modelVersionName=n.title,t._modelVersionVersion=n.revision;var a={id:n.id,title:n.title,revision:n.revision,parentId:n.modelID,parentTitle:n.modelName,state:n.state,image:n.image};t.activateRoadMapFacet(a);var o=n.state;if(B.setParent({state:o,type:I.TYPE_MODELVERSION}),t._modelMaturity!==o&&"Release"===o&&t._privateChannelForRules.publish({event:"update-rule-list"}),t._modelMaturity=o,t._pcsBulkTablePresenter&&(t._pcsBulkTablePresenter.setModelMaturity(t._modelMaturity),t._pcsBulkTablePresenter.updateEditAction()),t._allowEdit=!o||"Review"!==o&&"Release"!==o&&"Obsolete"!==o,t._modelEventForVariability.publish({event:"set-variability-editable",data:t._allowEdit}),t._privateChannelForRules.publish({event:"set-rule-editable",data:t._allowEdit}),t._privateChannelForPCs.publish({event:"update-pc-actions",data:{create:o&&"Obsolete"!==o,delete:t._allowEdit}}),D.setCurrReadOnlyStatus(t.modelDetailsTabContext,!t._allowEdit),t._privateChanelForSpecifications.publish({event:"set-specifications-editable",data:t._allowEdit}),t._privateChannelForRequirements.publish({event:"set-requirement-editable",data:t._allowEdit}),t._privateChannelForMFPlans.publish({event:"set-mf-plans-editable",data:o&&"Obsolete"!==o}),t._isDestroyed)$&&e.log("model details destroyed before being loaded");else{var s=O.prepareIdCardData(i,t._privateModelEvents,{commands:{relatedObjects:!0,copyFrom:t._allowEdit},projectsattribute:e.is(X)});t._modelForIdCard.set("attributes",s.get("attributes")),t._modelForIdCard.set("name",s.get("name")),t._modelForIdCard.set("freezones",s.get("freezones")),t._modelForIdCard.set("dropdown",s.get("dropdown"));var r=t._enoxIDCardContainer.getIDCard();if(r){var l=r.getElement("#IdCardProjectValueContainer");e.is(t._RelatedProjectsManager)&&e.is(l)&&(t._RelatedProjectsManager.set({id:t._id,title:t._modelName,image:null,type:t._modelType,serviceId:"3DSpace"}),t._RelatedProjectsManager.getInfoSection().inject(l))}}},function(){F.showError(q.GET_MODEL_DETAILS_ERROR)})},Z.prototype.createModelRevision=function(t){return t?E.createModelVersion({sourceObjectID:t.id,intent:"Evolution",attributes:{name:t.name,revision:"",description:"",title:t.title}}).then(function(){},function(){F.showError("Create Model Revision Service call failed")}):e.Promise.reject()},Z.prototype._filterDictionary=function(t,i){var n;if(i){var a=e.Json.path(i,"$...rules");a&&a.length>0&&(n=a[0])}if(n){var o=e.Json.path(t,"$...portfolioComponents.member[0]");o&&o.length>0&&(o[0].rules=n)}return t},Z.prototype._reloadVariabilityAndSolverKeys=function(){var t=this;return this._solverUpdated=!0,this._getSolverPromise=this._xModelVariability.initSolver({reloadDictionary:!0,reloadRules:!1}).then(function(i){return t._solverKeyForRules=i,t._privateChannelForRules.publish({event:"rule_init_complete"}),t._privateChannelForRules.publish({event:"solver-init-completed",data:i}),e.Promise.resolve()},function(){return t._solverUpdated=!1,F.showError(q.GET_MODEL_VARIABILITY_ERROR),e.Promise.reject()}),this._getSolverPromise},Z.prototype._checkForSolverUpdates=async function(t){return t&&(t.isRefresh||t.isOpenWith)||!this._solverUpdated?e.Promise.all([this._checkForVariabilityUpdates(),this._reloadVariabilityAndSolverKeys()]):(await this._getVariabilityPromise,await this._getSolverPromise,e.Promise.resolve(!1))},Z.prototype._checkForVariabilityUpdates=function(){return this._modelVersionVariabilityUpdated?this._fetchVariability():e.Promise.resolve(!1)},Z.prototype._fetchVariability=function(){var t=[V._KEY,V._VIEWS_PREFERENCES,V._MODEL_VERSIONS_DETAILS,V._VARIABILITY],i=N.getCustomAttributeStatus(t),n={componentId:this._id,content:{attributes:1,customerAttributes:i,parameters:!0,attributeList:["_image"]}};return this._modelVersionVariabilityUpdated=!1,this._getVariabilityPromise=y.getVariabilityDefinition(n).then(t=>{this._variabilityDictionary=t,this._dictionaryForRule=this._filterDictionary(e.clone(this._variabilityDictionary)),this._pcsBulkTablePresenter.loadVariabilityInfo(this._variabilityDictionary),this._bcDetails.loadVariabilityInfo(this._variabilityDictionary)},()=>{this._modelVersionVariabilityUpdated=!0}),this._getVariabilityPromise},Z.prototype._launchCopyFromCommand=function(i){e.log("Copy from command handler.");let n=this,a=n._options.version;if(void 0===this._modelCopyPresenter&&(this._modelCopyPresenter=new h,this._modelCopyPresenter.init(this._modelCopyFromEvent,{_applicationChannel:this._applicationChannel})),this._modelCopyFromEvent.publish({event:"mvcopy-set-target-mv-info",data:{modelName:this._modelName,modelId:this._modelPhysId,mvId:this._id,versionLabel:a,launchedFrom:i}}),this._modelVersionVariabilityUpdated)t.mask(this._container,q.MSG_LOADING_UPDATED_VARIABILITY),this._checkForVariabilityUpdates().then(function(){t.unmask(n._container);let a=e.clone(n._rulesList),o=e.clone(n._dictionaryForRule);n._modelCopyFromEvent.publish({event:"mvcopy-target-mv-dictionary-loaded",data:{dictionaryForRule:o,rulesList:a}}),n._modelCopyFromEvent.publish({event:"mvcopy-launch-copy-from-dialog",data:i})},function(){t.unmask(n._container),F.showError(q.GET_MODEL_VARIABILITY_ERROR),e.log("Error while loading updated varability!")});else if(this._dictionaryForRule){let t=e.clone(n._rulesList),a=e.clone(n._dictionaryForRule);this._modelCopyFromEvent.publish({event:"mvcopy-target-mv-dictionary-loaded",data:{dictionaryForRule:a,rulesList:t}}),this._modelCopyFromEvent.publish({event:"mvcopy-launch-copy-from-dialog",data:i})}else F.showError(q.GET_MODEL_VARIABILITY_ERROR),e.log("Error while loading varability!")},Z}),define("DS/ENOXModelApp/ModelDefinition/js/ModelsStatePresenter",["UWA/Core","DS/UIKIT/Mask","DS/CoreEvents/ModelEvents","UWA/Element","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/xModelCommand","DS/xPortfolioUXCommons/XModelListView/js/XModelListView","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension","DS/TreeModel/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/ENOXModelApp/Utils/xModelCommonUtils","DS/ENOXModelApp/components/DialogDeletion/DialogDeletion","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/xModelEventManager/xModelEventManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/ENOXModelApp/Utils/xModelAppRelatedObjectsCmd","DS/ENOXModelApp/ModelDefinition/js/MVFilterDataManager","DS/ENOXRelatedProject/RelatedProjectsManager","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/xModelDictionaryUtility","DS/LifecycleCmd/MessageMediator","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","i18n!DS/ENOXModelApp/assets/nls/ModelDefinition/ModelsStatePresenter","css!DS/ENOXModelApp/ModelDefinition/css/ModelsStatePresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x,R){"use strict";var V=function(){};return V.prototype.init=function(t,n){this._pathModel=[b._KEY,b._VIEWS_PREFERENCES,b._MODEL_VERSIONS],this._isDestroyed=!1,this._needRefresh=!0,this._options={},this._applicationChannel=t,this._addRouterPath(),this._uniqueId=new Date,this._modelInfoPresenter=null,this._modelInfoPresenterModelEvents=new i,this._currentSelectionDetails={},this._currInfoId="",this._defaultFilter={owned_by_me:!0,owned_by_my_organizations:!1,maturity_state:{state_preliminary:!0,state_product:!0,state_design:!0,state_review:!0,state_release:!1,state_obsolete:!1}},this._infoContext=m.ROUTE_MY_MODELS,a.initialize({applicationChannel:t,context:this._infoContext,silent:!0}),h.setDependency("InformationPanelManager",a),this._updateChannelLocal=new i,this._privateChannel=new i,this._mvSubTypesManager=n&&n.subTypeManager?n.subTypeManager:void 0,this._subTypesLabelMap=this._mvSubTypesManager?this._mvSubTypesManager.getSubTypesLabelMap():{},this._subTypeChannel=new i,this._myEventManager=new g(this._applicationChannel,this._modelInfoPresenterModelEvents,this._updateChannelLocal,this._privateChannel,this._subTypeChannel),this._subscribeEvent();let o=this;this._relatedObjectsCmd=new S,this._relatedObjectsCmdObj=this._relatedObjectsCmd.getCommandObject(),this._relatedObjectsCmdObj.category="navigation";let s=this._relatedObjectsCmdObj.handler;this._relatedObjectsCmdObj.handler=function(){let e=o._xModelListView._getSelectedItem();s(e)},this._tagActivated=!1,this._xModelListView=null,this.getOrganizationsForCurrentUser(),this.getMVFilterPreferences(),this._mvFilterDataMgr=new D({defaultFilter:this._currFilterPreferences,updateChannel:this._updateChannelLocal,currUserOrgs:this._currUserOrgsList}),this.summaryData=[],this._initDivs(),this._initializeListView(),this._initXModelListDiv(),this._loadCustomAttributePredicates(),this._initCommand(),e.is(M)?this._RelatedProjectsManager=new M:this._RelatedProjectsManager=null,this.activateProjectsFacet()},V.prototype._loadCustomAttributePredicates=function(){var i=this;t.mask(this._container,R.LOADING_PREDICATES),this._mvFilterDataMgr.getPredicates().then(function(n){if(t.unmask(i._container),i._predicatesList=n,void 0!==i._predicatesList){var a=[];for(var o in i._predicatesList)if(i._predicatesList.hasOwnProperty(o)){var s=i._predicatesList[o];a.push({text:s.unit?s.nlsName+" ("+s.unit+")":s.nlsName,dataIndex:s.name,typeRepresentation:"string",visibleFlag:!1})}a.length>0&&(e.log("Adding custom columns to Data grid view..."),i._updateChannelLocal.publish({event:"xmodel-list-add-columns",data:a}))}},function(){e.log("Unable to fetch predicates"),t.unmask(i._container)})},V.prototype.getMVFilterPreferences=function(){var t=E.getFilter(this._pathModel);void 0===t||void 0===Object.keys(t)||0===Object.keys(t).length?this._currFilterPreferences=this._defaultFilter:this._currFilterPreferences=e.clone(t)},V.prototype.activateProjectsFacet=function(){if(e.is(this._RelatedProjectsManager)){this.deactivateProjectsFacet();var t={require:"DS/ENOXModelApp/InformationPanels/ProjectsTab/js/ProjectsTabPresenter",facet:{name:"Projects",text:x.PROJECTS,eventThread:"projects",icon:"project-plans"},options:{isEditable:!0,RelatedProjectsManager:this._RelatedProjectsManager},alwaysVisible:!0};a.addFacet({name:"Projects",facet:t},this._infoContext)}},V.prototype.activateRoadMapFacet=function(e){this.deactivateRoadMapFacet();var t={require:"DS/ENOXModelApp/InformationPanels/RoadMapTab/js/RoadMapTabPresenter",facet:{name:"RoadMap",text:x.Drivers,eventThread:"RoadMap",icon:"compass wux-ui-3ds"},options:{id:e.id,title:e.title,revision:e.revision,parentId:e.parentId,parentTitle:e.parentTitle,state:e.state,image:e.image},alwaysVisible:!0};a.addFacet({name:"RoadMap",facet:t},this._infoContext)},V.prototype.activateModelFacet=function(e,t,i){this.deactivateModelFacet();var n={require:"DS/ENOXModelApp/InformationPanels/ModelsTab/js/ModelTabPresenter",position:3,actions:[T.ACTION_SWITCH,T.ACTION_RESET,{name:"Maturity",text:x.MATURITY,icon:"collaborative-lifecycle-management"},{name:"OpenWith",text:x.OPENWITH,icon:"open-menu-dot"}],facet:{name:"modelFacet",icon:"parcel",text:R.MODEL},options:{id:e,title:t,modelVersionData:i,eventChannel:this._updateChannelLocal},alwaysVisible:!0};a.addFacet({name:"modelFacet",facet:n},this._infoContext)},V.prototype.activateEffectivityFacet=function(){this.deactivateEffectivityFacet();var e={require:"DS/EffectivityContent/js/EffectivityTabFacet",facet:{name:"effectivityFacet",icon:"survey-list",text:x.EFFECTIVITY_TAB_TITLE},options:{},alwaysVisible:!0};a.addFacet({name:"effectivityFacet",facet:e},this._infoContext)},V.prototype.activateCompositionFacet=function(e){if(m.MV_COMPOSITION_ENABLED){this.deactivateCompositionFacet();var t={require:"DS/ENOXModelApp/InformationPanels/CompositionTab/js/MVCompositionFacet",facet:{name:"compositionFacet",icon:"tree-view-flattened",text:x.COMPOSITION_FACET},options:{modelID:e},alwaysVisible:!0};a.addFacet({name:"compositionFacet",facet:t},this._infoContext)}},V.prototype.deactivateCompositionFacet=function(){m.MV_COMPOSITION_ENABLED&&a.removeFacet("compositionFacet",this._infoContext)},V.prototype.deactivateEffectivityFacet=function(){a.removeFacet("effectivityFacet",this._infoContext),this._currentFacet=null},V.prototype.deactivateModelFacet=function(){a.removeFacet("modelFacet",this._infoContext),this._currentFacet=null},V.prototype.deactivateProjectsFacet=function(){a.removeFacet("Projects",this._infoContext),this._currentFacet=null},V.prototype.deactivateRoadMapFacet=function(){a.removeFacet("RoadMap",this._infoContext)},V.prototype.getOrganizationsForCurrentUser=function(){try{var t=window.widget?window.widget:void 0;if(t){var i={},n=t.getPreference("xPref_CREDENTIAL");n&&n.options&&n.options.length>0&&n.options.forEach(function(e){var t=e.value?e.value:void 0;if(void 0!==t){var n=(t=t.trim()).substring(t.indexOf(".")+1,t.lastIndexOf("."));n&&n.trim()&&(n=n.trim(),i[n]=!0)}}),Object.keys(i).length>0&&(this._currUserOrgsList=Object.keys(i))}}catch(t){e.log("Error! While obtaining organizations for current user."+t.message)}},V.prototype._initCommand=function(){this._command=new o(this._updateChannelLocal,this._container,this._applicationChannel),this._myEventManager.subscribe(this._updateChannelLocal,{event:"model-version-action-open"},function(t){var i=t.id;i&&u.getModelDetails({id:i}).then(function(e){var t=e.member[0];h.navigate(m.ROUTE_MODEL_DETAILS,{modelVersionId:t.id,modelID:t.modelID,id:t.id,name:t.title,version:t.revision,state:t.state,modelName:t.modelName,type:t.type?t.type:"Products"},{reload:!0})},function(){e.log("getModelDetails: Service Call Failed !!!"),C.showError(R.GET_MODEL_DETAILS_ERROR)})})},V.prototype._initializeListView=function(){var t=this,i=this._checkIfAnyObjPropertyIsTrue(this._currFilterPreferences);i=i||!1;var n=new d({}),a=E.getSort(this._pathModel),o=void 0;a&&a.sortAttribute&&a.sortOrder&&(o={id:a.sortAttribute,order:a.sortOrder}),this._nlsState=P.getStateValue();var p=[{id:"Subscribe",text:R.get("subscribe"),fonticon:"bell-add",handler:function(e){let i=t._xModelListView._getSelectedItem();t._command._handleSubscriptionCommands(i,"Subscribe")}},{id:"unsubscribe",text:R.get("unsubscribe"),fonticon:"bell-delete",handler:function(e){let i=t._xModelListView._getSelectedItem();t._command._handleSubscriptionCommands(i,"UnSubscribe")}},{id:"editSubscriptions",text:R.get("editSubscriptions"),fonticon:"bell-pencil",handler:function(e){let i=t._xModelListView._getSelectedItem();t._command._handleSubscriptionCommands(i,"EditSubscribe")}},{id:"mySubscriptions",text:R.get("mySubscriptions"),fonticon:"bell",handler:function(e){let i=t._xModelListView._getSelectedItem();t._command._handleSubscriptionCommands(i,"MySubscriptions")}}],u={id:"modelVersions",model:n,useDragAndDrop:!0,modelEvents:this._updateChannelLocal,withProgressBar:!0,viewOptions:{identifier:"model_versions",views:["ThumbnailView","TileView","DataGridView"],currentView:E.getView(this._pathModel),currentSort:o,grid:{typeRepresentations:{customFloat:{stdTemplate:"spinEdit",semantics:{stepValue:1,decimal:2}}},columns:[{text:x.TITLE,dataIndex:"tree",typeRepresentation:"titleTweaker",getCellEditableState:function(e){var t=!1,i=e.nodeModel.options.grid;return I.checkActionAccess({action:A.MODIFY,type:i.type,state:i.state,notify:!1})&&e.rowID>=0&&e.nodeModel.options.grid.id&&(t=!0),t},getCellSemantics:function(e){var i={};return e&&e.nodeModel&&e.nodeModel.options&&e.nodeModel.getNodeDepth()!==(t._xModelListView.isGrouped()?1:0)&&(i.linkDisplay=!1),i}},{text:x.NAME,dataIndex:"name"},{text:x.TYPE,dataIndex:"type",groupableFlag:!0,getCellValue:function(e){var i="";if(e.nodeModel.options.grid){var n=e.nodeModel.options.grid;i=t._subTypesLabelMap[n.type]?t._subTypesLabelMap[n.type]:n.nlsValues&&n.nlsValues.nlsType?n.nlsValues.nlsType:n.type}return i}},{text:x.REVISION,dataIndex:"revision",typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){return{label:e.nodeModel.options.grid.revision,url:"#Revision"}}},{text:R.MODEL,dataIndex:"modelName",typeRepresentation:"url",hyperlinkTarget:"_self",groupableFlag:!0,getCellValue:function(e){return{label:e.nodeModel.options.grid.modelTitle,url:"#Model"}},getCellGroupingKey:function(e){return e.nodeModel.options.grid.modelTitle}},{text:x.DESCRIPTION,dataIndex:"description",getCellEditableState:function(e){var t=e.nodeModel.options.grid;return I.checkActionAccess({action:A.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:x.MATURITY_STATE,dataIndex:"maturity",groupableFlag:!0,typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(e.nodeModel.options.grid){var t=e.nodeModel.options.grid;return{label:(t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state)||t.maturity,url:"#Maturity"}}return""},getCellGroupingKey:function(e){var t=e.nodeModel.options.grid,i="";return void 0!==t&&(i=t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state?t.state:t.maturity?t.maturity:""),i}},{text:x.BASEPRICE,dataIndex:"basePrice",touchMode:!1,typeRepresentation:"customFloat",getCellValue:function(e){return e.nodeModel.options.grid.basePrice},setCellValue:function(e,i){if(isNaN(i)||i<0)e.nodeModel.updateOptions({grid:{basePrice:e.nodeModel._referenceValues.basePrice}}),C.showError(R.SET_BASE_PRICE_ERROR);else{var n=[e.nodeModel.options.grid];t._updateChannelLocal.publish({event:"list-view-update-inline-action",data:{model:n,name:"basePrice",value:i.toString(),cell:e}})}},getCellEditableState:function(e){var t=e.nodeModel.options.grid;return I.checkActionAccess({action:A.MODIFY,type:t.type,state:t.state,notify:!1})}},{text:x.OWNER,dataIndex:"owner",visibleFlag:!0,groupableFlag:!0,getCellValue:function(e){return{label:e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:e.nodeModel.options.grid.responsible,url:"#Owner"}},getCellGroupingKey:function(e){return e.nodeModel.options.grid.owner},typeRepresentation:"url",hyperlinkTarget:"_self"},{text:x.CREATION_DATE,dataIndex:"created",getCellValue:function(e){if(e.nodeModel.options.grid.created)return _.formatDateAttribute(e.nodeModel.options.grid.created)}},{text:x.MODIFICATION_DATE,dataIndex:"modified",getCellValue:function(e){if(e.nodeModel.options.grid.modified)return _.formatDateAttribute(e.nodeModel.options.grid.modified)}},{text:x.COLLABSPACE,dataIndex:"collabspace"},{text:x.ORGANIZATION,dataIndex:"organization",getCellValue:function(e){if(e.nodeModel.options.grid.organization)return P.getOrganzationNLS(e.nodeModel.options.grid.organization)||e.nodeModel.options.grid.organization}}]},editable:!0,itemViewMapping:{label:function(e){return e.options.grid.title+" "+e.options.grid.revision},subLabel:function(e){var t=e.options.grid;if(t){var i=t.nlsValues&&t.nlsValues.nlsState?t.nlsValues.nlsState:t.state?t.state:t.maturity?t.maturity:"";return x.BASEPRICE+": "+t.basePrice+" | "+i+" | "+(t.owner?t.owner:t.responsible)}return""},description:"description",customTooltip:function(e){return _.prepareTooltipObjectView(e)},icon:function(){return c.getWebappsAssetUrl("ENOXModelApp","icon/model_Version.png")}},contextualActions:[{id:"open",title:R.get("open"),fonticon:"open",multiselect:!1,handler:function(t){e.log("item clicked"),h.navigate(m.ROUTE_MODEL_DETAILS,{modelVersionId:t.id,modelID:t.modelID,id:t.id,name:t.title,version:t.revision,state:t.state,modelName:t.name,type:t.type?t.type:"Products"})}},{type:"SeparatorItem"},{id:"revise",title:x.REVISE,text:x.REVISE,fonticon:"flow-line-add",handler:function(e,i){t._command._handleNewRevisionCommand(i)}},{id:"derive",title:x.DERIVE,text:x.DERIVE,fonticon:"flow-branch-add",handler:function(e,i){t._command._handleNewBranchCommand(i)}},{id:"revisionExplorer",title:R.get("revisionExplorer"),fonticon:"flow-branch-list",multiselect:!1,handler:function(e){t._command._handelRevisionCommand(e)}},{id:"maturityState",title:x.get("MATURITY"),fonticon:"collaborative-lifecycle-management",handler:function(e,i){t._command._handleMaurityCommand(i)}},{type:"SeparatorItem"},{id:"changeOwnership",title:x.get("CHANGE_OWNERSHIP"),fonticon:"move-to",handler:function(e,i){I.checkActionAccess({action:A.MOVE,notify:!0})&&t._command._handleChangeOwnerCommand(i)}},{type:"SeparatorItem"},t._relatedObjectsCmdObj,{id:"changeImpacts",title:R.get("changeImpacts"),fonticon:"change",multiSelect:!1,handler:function(e){t._command._handleChangeImpactsCommand(e)}},{id:"subscriptions",title:R.get("subscriptions"),fonticon:"bell",multiSelect:!1,callSubMenuHandler:!0,content:p,handler:function(t){e.log("MV contextual : subscription action")}},{id:"information",title:R.get("information"),fonticon:"info",handler:function(){t._applicationChannel.publish({event:"information-panel-open"})}},{type:"SeparatorItem"},{id:"delete",title:R.get("delete"),fonticon:"trash",handler:function(e,i){if(I.checkActionAccess({action:A.DELETE,type:A.TYPE_MV,notify:!0})&&e){var n=i.map(function(e){return{id:e.id,title:e.title}});t.createDeleteModelDialog(n,t._updateChannelLocal)}}}]},emptyContentOptions:{sentences:[{type:"img",src:c.getWebappsAssetUrl("ENOXModelApp","icon/model_Version.png"),text:x.EMPTY_CONTENT_MESSAGE}]},filterAttributes:["id","name","title","description","revision","responsible","owner","creator","maturity","modelTitle",{internal:"state",nlsValue:"nlsState"},{internal:"type",nlsValue:"nlsType"}],withmultisel:!0,toolbarOptions:{filterActions:[{id:"mv-filter",text:R.filter,fonticon:"list-filter",multiSelect:!0,selected:i,actions:[{id:"owned_by_me",text:R.OWNED_BY_ME,selectable:!0,selected:this._currFilterPreferences.owned_by_me,handler:function(){e.log("OwnedByMeHandler")}},{id:"owned_by_my_organizations",text:R.OWNED_BY_MY_ORGANIZATIONS,selectable:!0,selected:this._currFilterPreferences.owned_by_my_organizations,handler:function(){e.log("OwnedByMyOrgHandler")}},{id:"maturity_state",text:R.MATURITY_STATE,selectable:!1,multiSelect:!0,isSelected:!1,items:[{id:"state_preliminary",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Product.Preliminary"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_preliminary},{id:"state_product",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Product.Product_Management"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_product},{id:"state_design",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Product.Design_Engineering"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_design},{id:"state_review",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Product.Review"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_review},{id:"state_release",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Product.Release"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_release},{id:"state_obsolete",parentId:"maturity_state",text:t._nlsState["ds6w:status"]["Product.Obsolete"],fonticon:"",selectable:!0,selected:this._currFilterPreferences.maturity_state.state_obsolete}],handler:function(){e.log("MaturityStateFilterHandler")}}]}],itemsName:R.get("modelVersionMultiple"),itemName:R.get("modelVersionSingle"),groupByActionIndex:1,withStableActions:!0,useGeneratedToolbar:!0,showTaggerFilter:!0,touchMode:!1,hideOnMultiSelection:["open","revisionExplorer","changeImpacts"],actions:[{id:"create",text:x.CREATE,title:x.CREATE,category:"new",fonticon:"plus",handler:function(){I.checkActionAccess({action:A.CREATE,type:A.TYPE_MV,notify:!0})&&t.createCreationModelDialog(t._updateChannelLocal)}},{id:"open",title:R.get("open"),text:R.get("open"),category:"open",fonticon:"open",showOnSelection:!0,handler:function(){e.log("item clicked");let i=t._xModelListView._getSelectedItem();if(i.length>1)return;let n=i[0];h.navigate(m.ROUTE_MODEL_DETAILS,{modelVersionId:n.id,modelID:n.modelID,id:n.id,name:n.title,version:n.revision,state:n.state,modelName:n.name,type:n.type?n.type:"Products"})}},{id:"revise",title:x.REVISE,text:x.REVISE,fonticon:"flow-line-add",category:"lifecycle",showOnSelection:!0,handler:function(){let e=t._xModelListView._getSelectedItem();t._command._handleNewRevisionCommand(e)}},{id:"derive",title:x.DERIVE,text:x.DERIVE,fonticon:"flow-branch-add",category:"lifecycle",showOnSelection:!0,handler:function(){let e=t._xModelListView._getSelectedItem();t._command._handleNewBranchCommand(e)}},{id:"revisionExplorer",title:R.get("revisionExplorer"),text:R.get("revisionExplorer"),fonticon:"flow-branch-list",category:"lifecycle",showOnSelection:!0,handler:function(){let e=t._xModelListView._getSelectedItem();t._command._handelRevisionCommand(e[0])}},{id:"maturityState",title:x.get("MATURITY"),text:x.get("MATURITY"),fonticon:"collaborative-lifecycle-management",category:"lifecycle",showOnSelection:!0,handler:function(){let e=t._xModelListView._getSelectedItem();t._command._handleMaurityCommand(e)}},{id:"changeOwnership",title:x.get("CHANGE_OWNERSHIP"),text:x.get("CHANGE_OWNERSHIP"),fonticon:"move-to",category:"collaboration",showOnSelection:!0,handler:function(){let e=t._xModelListView._getSelectedItem();I.checkActionAccess({action:A.MOVE,notify:!0})&&t._command._handleChangeOwnerCommand(e)}},t._relatedObjectsCmdObj,{id:"changeImpacts",text:R.get("changeImpacts"),fonticon:"change",multiSelect:!1,category:"navigation",showOnSelection:!0,handler:function(e){t._command._handleChangeImpactsCommand(e)}},{id:"delete",text:x.DELETE,title:x.DELETE,fonticon:"trash",category:"destructive",showOnSelection:!0,handler:function(i){if(e.log("delete action.."),I.checkActionAccess({action:A.DELETE,type:A.TYPE_MV,notify:!0})){var n=i.map(function(e){return{id:e.id,title:e.label}});t.createDeleteModelDialog(n,t._updateChannelLocal)}}},{id:"subscriptions",text:R.get("subscriptions"),title:R.get("subscriptions"),fonticon:"bell-list",category:"navigation",showOnSelection:!0,callSubMenuHandler:!0,content:p,handler:function(){e.log("subscriptions")}}]},extensions:[r,l]};this._xModelListView=new s(u)},V.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("xmodel-models")},V.prototype._initXModelListDiv=function(){this._xModelListView.inject(this._container),this._checkIfFilterButtonNeedChange(),this._privateChannel.publish({event:"enox-collection-toolbar-disable-action",data:"delete"})},V.prototype._createModel=function(t){var i,n,a,o=this;o._patchForUploadingImage=void 0,o._patchIdObject=void 0,t&&(n=t.title?t.title:"",a=t.description?t.description:"",o._patchForUploadingImage=t.image?t.image:void 0);var s={items:[{type:t&&t.type&&"Model Version"!==t.type?t.type:"",versionName:t.revision?t.revision:"",attributes:{name:"",description:a,title:n}}]};o._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),u.createModel(s).then(function(t){(i=t.value)||t.member&&t.member.length>0&&(i=t.member[0].id),o._patchIdObject=i,o._patchForUploadingImage?p.uploadImage(i,o._patchForUploadingImage).then(function(){o._getModelDetailsAndAddItem(o._patchIdObject)},function(e){C.showError(e),o._getModelDetailsAndAddItem(o._patchIdObject)}):(e.log("Created model Id is: "+i),o._getModelDetailsAndAddItem(i))},function(){e.log("createModel: Service Call Failed !!!");var i=o._mvSubTypesManager?o._mvSubTypesManager.getSubTypeLabel(t.type):"";C.showError(x.ERR_CREATION_FAILED+(i||x.TYPE_MODELVERSION)),o._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"})})},V.prototype._getModelDetailsAndAddItem=function(t){var i=this;u.getModelDetailsCustomUIMask({id:t}).then(function(t){e.log("getModelDetails: Service Call Successful !!!");var n=E.getGroup(i._pathModel);i._updateNodeModel(t);var a=i._getDataItemFromResponse(t.member[0]);i._updateChannelLocal.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){i._updateChannelLocal.publish({event:"xmodel-list-unselect-all"}),e.select()}),i._updateChannelLocal.publish({event:"xmodel-list-data-item-add-action",data:a}),i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),i._updateChannelLocal.publish({event:"enox-collection-toolbar-sort-activated",data:E.getSort(i._pathModel)}),n&&i._updateChannelLocal.publish({event:"xmodel-list-view-group-by-action",data:n}),i._updateChannelLocal.publish({event:"enox-dialog-creation-done"}),C.showSuccess(x._creation_successful)},function(){e.log("getModelDetails: Service Call Failed !!!"),C.showError(R.GET_MODEL_DETAILS_ERROR),i._updateChannelLocal.publish({event:"enox-dialog-creation-done"}),i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"})})},V.prototype._updateNodeModel=function(e){var t=e.member[0];t.hasOwnProperty(b._ORG_TITLE)&&(t[b._ORG_TITLE]=""),t.hasOwnProperty(b._COLLABSPACE_TITLE)&&(t[b._COLLABSPACE_TITLE]="")},V.prototype._getDataItemFromResponse=function(t){var i;if(t){if((i=t)&&void 0===i.maturity&&void 0!==i.state&&(i.maturity=i.state),i&&i.hasOwnProperty("dspfl:ModelVersionEnterpriseAttributes")){var n=i["dspfl:ModelVersionEnterpriseAttributes"];for(var a in n)if(a&&e.is(n[a],"array")){var o=n[a],s=o.length;if(s<=0)i[a]="";else if(s>=1){for(var r=o[0],l=1;l<=s-1;l++)r+=",",r+=o[l];i[a]=r}else i[a]=o[s-1]}else i[a]=n[a]}i&&i.hasOwnProperty("model")&&i.model&&i.model.member&&i.model.member[0]&&(i.modelTitle=i.model.member[0].title)}return i},V.prototype.loadData=function(e,t){var i=this;!0===e||void 0===t?(this._updateChannelLocal.publish({event:"xmodel-list-data-on-load-start"}),this._updateChannelLocal.publish({event:"xmodel-list-show-progress-bar"}),this._mvFilterDataMgr.getPredicates().then(function(){i._fetchDataHandler(t)},function(){i._fetchDataHandler(t)})):i._fetchDataHandler(t)},V.prototype._fetchDataHandler=function(t){var i=this;i._mvFilterDataMgr._fetchData(t).then(function(e){var n=void 0!==t;if(e){var a=e.currentCount===e.numberOfHits,o=e.currentCount/e.numberOfHits*100;P.allSettled().then(function(){i._updateChannelLocal.publish({event:"evt-populate-xmodel-list",data:{items:e.items,append:n,loadComplete:a}})}),i._updateChannelLocal.publish({event:"evt-update-xmodel-list-progress-bar",data:{progress:o}}),e.nextRequestData&&i._updateChannelLocal.publish({event:"evt-perform-search-for-next-lot",data:{nextRequestData:e.nextRequestData,currentCount:e.currentCount}})}},function(){e.log("Warning!! perfrom search rejected"),i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"}),i._updateChannelLocal.publish({event:"xmodel-list-hide-progress-bar"})})},V.prototype.inject=function(e){e.appendChild(this._container)},V.prototype.destroy=function(){this._isDestroyed=!0,this.clearTags(),this.deactivateModelFacet(),this.deactivateProjectsFacet(),this.deactivateRoadMapFacet(),this.deactivateEffectivityFacet(),this.deactivateCompositionFacet(),e.is(this._RelatedProjectsManager)&&this._RelatedProjectsManager.destroy(),this._xModelListView.destroy(),this._myEventManager&&(this._myEventManager.cleanup("ModelsStatePresenter"),this._myEventManager=null),this._modelPreference&&this._modelPreference.destroy(),w.removeEvent("onModification")},V.prototype.clearTags=function(){this._updateChannelLocal.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},V.prototype.activateTags=function(){this._updateChannelLocal.publish({event:"xmodel-list-tagger-activate-action"}),this._tagActivated=!0},V.prototype.deactivateTags=function(){this._updateChannelLocal.publish({event:"xmodel-list-tagger-deactivate-action"}),this._tagActivated=!1},V.prototype._subscribeEvent=function(){var t=this;this._myEventManager.subscribe(this._updateChannelLocal,"evt-populate-xmodel-list",function(i){if(i&&i.items&&i.items.length>0&&(e.log(">> evtData.items:  "+i.items.length),t._updateChannelLocal.publish({event:i.append?"xmodel-list-data-item-append-action":"xmodel-list-data-load-action",data:{member:i.items}}),i.loadComplete)){t._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"});var n=E.getSelectedItems(t._pathModel);n&&n.length>0&&t._updateChannelLocal.publish({event:"xmodel-list-selection-action",data:n});var a=E.getGroup(t._pathModel);t._updateChannelLocal.publish({event:"xmodel-list-view-group-by-action",data:a}),t._updateChannelLocal.publish({event:"enox-collection-toolbar-sort-activated",data:E.getSort(t._pathModel)})}}),this._myEventManager.subscribe(this._updateChannelLocal,"evt-perform-search-for-next-lot",function(e){e&&e.nextRequestData&&t.loadData(!1,e)}),this._myEventManager.subscribe(this._updateChannelLocal,"evt-update-xmodel-list-progress-bar",function(i){i&&i.progress&&(e.log(">> evtData.progress:  "+i.progress),t._updateChannelLocal.publish({event:"xmodel-list-update-progress-bar",data:i.progress}))}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-link-click"},function(e){t._updateChannelLocal.publish({event:"xmodel-execute-command",data:e})}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"enox-dialog-creation"},function(e){t._createModel(e.content)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"version-or-branch-creation"},function(e){var i=e.id;t._addNewVersionOrBranch(i)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"version-explorer-new-version-created"},function(e){var i=e.id;t._addNewVersionOrBranch(i)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"enox-dialog-delete"},function(e){t._deleteModels(e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"list-view-update-inline-action"},function(e){if(e&&e.model&&e.name&&void 0!==e.value){var i=e.model[0],n=e.cell.nodeModel,a={icons:[c.getWebappsAssetUrl("ENOXModelApp","icon/loading-animation.gif")]};"basePrice"!==e.name&&n.updateOptions(a),null==e.value&&(e.value=""),t._editionModel(i,e.name,e.value.trim()),void 0!==i.isRoot&&!0!==i.isRoot||t._editionModelRoot(i,e.name,e.value.trim())}}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-add-selection"},function(e){var i=e.model,n=!1,o=[];if(e&&e.items)for(var s=0;s<e.items.length;s++){var r=e.items[s].options.grid.state;"Review"!==r&&"Release"!==r&&"Obsolete"!==r||(n=!0),o.push(e.items[s].options.id)}if(o.length>1)t.deactivateModelFacet(),t.deactivateProjectsFacet(),t.deactivateRoadMapFacet(),t.deactivateEffectivityFacet(),t.deactivateCompositionFacet();else if(1===o.length&&!1===e.multiSelect&&i){var l={id:i.id,title:i.title,revision:i.revision,parentId:i.modelID,parentTitle:i.modelName,state:i.state,image:i.image};t.activateModelFacet(i.modelID,i.modelTitle,i),t.activateProjectsFacet(),t.activateRoadMapFacet(l),t.activateEffectivityFacet(),t.activateCompositionFacet(i.modelID)}let d=[];!0===e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;d.push(t)}):d.push(i.id),a.addSelection(d,t._infoContext,n),E.updateSelectedItems(t._pathModel,o)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-remove-selection"},function(e){var i=e.model,n=!1,o=[];if(e&&e.items)for(var s=0;s<e.items.length;s++){var r=e.items[s].options.grid.state;"Review"!==r&&"Release"!==r&&"Obsolete"!==r||(n=!0),o.push(e.items[s].options.id)}if(1===o.length){let i=e.items[0].options.grid;var l={id:i.id,title:i.title,revision:i.revision,parentId:i.modelID,parentTitle:i.modelName,state:i.state,image:i.image};t.activateModelFacet(i.modelID,i.modelTitle,i),t.activateProjectsFacet(),t.activateRoadMapFacet(l),t.activateEffectivityFacet(),t.activateCompositionFacet()}let d=[];!0===e.multiSelect?i.forEach(e=>{let t=e.options.grid.id;d.push(t)}):d.push(i.id),a.removeSelection(d,t._infoContext,n),E.updateSelectedItems(t._pathModel,o)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-empty-selection"},function(){a.removeAllSelection(t._infoContext),E.updateSelectedItems(t._pathModel,[])}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-item-on-dblclick"},function(i){var n=i.model;e.log("Double click event item id: "+n),t._needRefresh=!0,h.navigate(m.ROUTE_MODEL_DETAILS,{modelVersionId:n.id,id:n.id,modelID:n.modelID,name:n.title,version:n.revision,state:n.state,modelName:n.name,type:n.type?n.type:"Products"})}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-title-link-click"},function(e){var i=e.model;t._needRefresh=!0,h.navigate(m.ROUTE_MODEL_DETAILS,{modelVersionId:i.id,id:i.id,name:i.title,modelID:i.modelID,version:i.revision,state:i.state,modelName:i.name,type:i.type?i.type:"Products"})}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._updateChannelLocal,e,this)}),this._myEventManager.subscribe(this._applicationChannel,{event:"xmodel-list-data-item-need-refresh"},function(e){t._refreshListView(t._updateChannelLocal,e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"enox-collection-toolbar-switch-view-activated"},function(e){E.updateView(t._pathModel,e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"enox-collection-toolbar-sort-activated"},function(e){E.updateSort(t._pathModel,e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-view-group-by-action"},function(e){E.updateGroup(t._pathModel,e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-collection-toolbar-filter-changed"},function(e){if(e){var i=!1;if(e.parentId){var n=t._currFilterPreferences.hasOwnProperty(e.parentId);n&&(n=!1,(n=t._currFilterPreferences[e.parentId].hasOwnProperty(e.id))&&(t._currFilterPreferences[e.parentId][e.id]=e.selected,i=!0))}else if(e.id&&"maturity_state"!==e.id){t._currFilterPreferences.hasOwnProperty(e.id)&&(t._currFilterPreferences[e.id]=e.selected,i=!0)}i&&(t._updateChannelLocal.publish({event:"mv-filter-criteria-update",data:{filterCriteria:t._currFilterPreferences}}),t._checkIfFilterButtonNeedChange(),E.updateFilter(t._pathModel,t._currFilterPreferences),t.loadData(!0))}}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-tagger-on-filter-change"},function(e){e&&E.setTagFilter(t._pathModel,e)}),this._myEventManager.subscribe(this._updateChannelLocal,{event:"xmodel-list-tagger-on-setup"},function(){t._tagActivated?t.activateTags():t.deactivateTags();var e=E.getTagFilter(t._pathModel);e&&t._updateChannelLocal.publish({event:"xmodel-list-tagger-set-filter-action",data:e})}),w.addEvent("onModification",function(i){if(i&&e.is(i.created,"array")&&i.created.length>0){var n=i.created[0].physicalid;t._updateChannelLocal.publish({event:"version-or-branch-creation",data:{id:n}})}})},V.prototype._checkIfAnyObjPropertyIsTrue=function(t){var i=!1;for(var n in t){if(!0===t[n]){i=!0;break}e.is(t[n],"object")&&(i=this._checkIfAnyObjPropertyIsTrue(t[n]))}return i},V.prototype._checkIfFilterButtonNeedChange=function(){var e=this._checkIfAnyObjPropertyIsTrue(this._currFilterPreferences);this._updateChannelLocal.publish({event:"xmodel-list-collection-toolbar-update-filter-menu-status",data:{selected:e||!1,id:"mv-filter"}})},V.prototype._addRouterPath=function(){},V.prototype._resetPropertyPanel=function(){this._currInfoId="",this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:null}})},V.prototype.createDeleteModelDialog=function(e,t){var i={listItems:e,type:"delete",single:R.MODEL,multiple:R.MODELS,modelEvent:t,immersiveFrame:y.getImmersiveFrame()};v.showDialog(i)},V.prototype.createCreationModelDialog=function(e){var t=!1,i=[];this._mvSubTypesManager&&this._mvSubTypesManager.doesSubTypeExists()&&(t=!0,i=this._mvSubTypesManager.getSubTypesForSelection()),f.show({id:"model_version",modelEvent:e,title:R.newModelVersion,withCreateAndClose:!0,edit_revision:!0,typeSelection:t,availableTypes:i})},V.prototype._deleteModels=function(t){var i=this,n=t;u.deleteModelVersions({ids:n}).then(function(){i._updateChannelLocal.publish({event:"xmodel-list-data-item-remove-action",data:n})},function(t){e.log("Failure while deleting model versions!!!"),O.showError({action:A.DELETE,type:A.TYPE_MV,message:t})||C.showError(R.DELETE_MODELS_ERROR)})},V.prototype._refreshListView=function(e,t,i){var n=this;void 0!==t&&u.getModelDetailsCustomUIMask({id:t}).then(function(t){n._updateNodeModel(t);var o=n._getDataItemFromResponse(t.member[0]);(o=void 0!==o?o:{}).context=i;var s={id:o.id,title:o.title,revision:o.revision,parentId:o.modelID,parentTitle:o.modelName,state:o.state,image:o.image};n.activateRoadMapFacet(s),e.publish({event:"xmodel-list-data-item-update-action",data:o});var r=!1;"Review"!==o.state&&"Release"!==o.state&&"Obsolete"!==o.state||(r=!0),a.removeAllSelection(n._infoContext),a.addSelection(o.id,n._infoContext,r)},function(){})},V.prototype._editionModelRoot=function(t,i,n){if(t&&i&&"basePrice"!==i){if("title"===i&&null==n||t[i]===n)return void this._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:t});var a={};a[i]=n,u.getModelDetails({id:t.id}).then(function(t){var i=t.member[0].modelID;t.member[0].isRoot&&u.patchModel(i,a).then(function(){e.log("ModelsStatePresenter _editionModelRoot : Service Call Success !!!")},function(){e.log("ModelsStatePresenter _editionModelRoot : Service Call Failed !!!"),C.showError(R.PATCH_MODEL_ERROR)})},function(){e.log("ModelsStatePresenter _editionModelRoot : Service Call Failed !!!"),C.showError(R.GET_MODEL_DETAILS_ERROR)})}},V.prototype._editionModel=function(t,i,n){var o=this;if(t&&i){if("title"===i&&null==n||t[i]===n)return void o._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:t});var s={};s[i]=n,u.patchModelVersion(t.id,s).then(function(t){e.log("ModelsStatePresenter editionTitle : Service Call Success !!!"),o._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:t.member[0]}),a.refresh()},function(i){e.log("ModelVersion editionTitle : Service Call Failed !!!"),o._updateChannelLocal.publish({event:"xmodel-list-data-item-update-action",data:t}),O.showError({mandatoryErrCodeCheck:!1,action:A.MODIFY,type:A.TYPE_MV,message:i})||C.showError(R.PATCH_MODEL_ERROR)})}},V.prototype._addNewVersionOrBranch=function(t){var i=this;u.getModelDetailsCustomUIMask({id:t}).then(function(t){e.log("getModelDetails: Service Call Successful !!!"),i._updateNodeModel(t);var n=i._getDataItemFromResponse(t.member[0]);i._updateChannelLocal.subscribeOnce({event:"xmodel-list-data-item-on-add-complete"},function(e){i._updateChannelLocal.publish({event:"xmodel-list-unselect-all"}),e.select()}),i._updateChannelLocal.publish({event:"xmodel-list-data-item-add-action",data:n}),i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"})},function(){i._updateChannelLocal.publish({event:"xmodel-list-data-on-load-complete"})})},V}),define("DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EnterpriseVariabilityDictionaryStatePresenter",["UWA/Core","DS/Controls/Tab","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoItemDetailsPresenter","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoItemsPresenter","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EntDicoPresenterSettingsProvider","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","i18n!DS/ENOXModelApp/assets/nls/EnterpriseVariabilityDictionary/EnterpriseVariabilityDictionaryStatePresenter","css!DS/ENOXModelApp/EnterpriseVariabilityDictionary/css/EnterpriseVariabilityDictionary.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h){"use strict";var m=function(){};return m.prototype.init=function(e,t,a){this._pathEntrepriseVariability=[r._KEY,r._VIEWS_PREFERENCES,r._ENTREPRISE_VARIANTS_OPTIONS],this._needRefresh=!1,this._isDestroyed=!1,this._options=a||{},this._currentTab=l.getTab(this._pathEntrepriseVariability)||"_0",this._applicationChannel=e,this._updateChannel=t,this._privateChannelForTabs=new i,this._updateChannelLocal=new i,this._privateChannelForVariants=new i,this._privateChannelForParameters=new i,this._privateChannelForVg=new i,this._privateChannelForOptions=new i,this._myEventManager=new n(this._applicationChannel,this._privateChannelForTabs,this._updateChannelLocal,this._privateChannelForVariants,this._privateChannelForVg,this._privateChannelForOptions),this._variantsPresenter=new s,this._variantsPresenter.init(this._privateChannelForVariants,e,{tagFriends:"VariantsTagProxy",settings:c.getVariantsPresenterSettings()}),this._VariabilityGroupPresenter=new s,this._VariabilityGroupPresenter.init(this._privateChannelForVg,e,{tagFriends:"VGOptionsPresenter",noPublishOnCreate:!0,settings:c.getOptionGroupsPresenterSettings()}),this._parametersPresenter=new s,this._parametersPresenter.init(this._privateChannelForParameters,e,{settings:c.getParametersPresenterSettings(),isNumericalParameter:!0}),this._loaded={},this._loaded.variantClasses=!1,this._loaded.options=!1,this._loaded.parameters=!1,this._initDiv(),this._variantsPreviewActivated=!1,d.setContext("EnterpriseDico")},m.prototype._initDiv=function(){this._container=document.createElement("div"),this._container.classList.add("enterprise-variability-dictionary"),this._variantsContainer=document.createElement("div"),this._variantsContainer.classList.add("variants-container"),this._optionsContainer=document.createElement("div"),this._optionsContainer.classList.add("options-container"),this._parametersContainer=document.createElement("div"),this._parametersContainer.classList.add("parameters-container"),[this._variantsContainer,this._optionsContainer,this._parametersContainer].forEach(function(e){e.classList.add("width100"),e.classList.add("height100")}),this._variantsPresenter.inject(this._variantsContainer),this._VariabilityGroupPresenter.inject(this._optionsContainer),this._parametersPresenter.inject(this._parametersContainer),this._initWebUXTabs()},m.prototype._initWebUXTabs=function(){this._webUXTabs=new t({showComboBoxFlag:!0,touchMode:!0,displayStyle:["strip"],allowUnsafeHTMLOnTabButton:!1}),this._webUXTabs.tabBar.centeredFlag=!1,this._webUXTabs.add({label:h.VARIANTS,isSelected:"_0"===this._currentTab,index:0,value:"_0",content:this._variantsContainer,allowUnsafeHTMLOnTabButton:!1}),this._webUXTabs.add({label:h.OPTIONS,isSelected:"_1"===this._currentTab,index:1,value:"_1",content:this._optionsContainer,allowUnsafeHTMLOnTabButton:!1}),this._webUXTabs.add({label:h.PARAMETERS,isSelected:"_2"===this._currentTab,index:2,value:"_2",content:this._parametersContainer,allowUnsafeHTMLOnTabButton:!1}),this._webUXTabs.getContent().classList.add("height100"),this._webUXTabs.tabPanelContainer.classList.add("tab-content"),this._webUXTabs.tabPanelContainer.classList.add("tab-in-mobile"),this._webUXTabs.inject(this._container);var i=this;this._webUXTabs.addEventListener("change",function(t){void 0===t.dsModel||void 0===t.dsModel.tabBar||t.dsModel&&!t.dsModel.value||(l.updateTab(i._pathEntrepriseVariability,t.dsModel.value[0]),e.log("changing tab to - "+t.dsModel.value[0]),i._currentTab=t.dsModel.value[0],"_0"===i._currentTab?(i._privateChannelForVg.publish({event:"onTabChange",data:{}}),d.setContext("Variant"),p.destroy(),p.setcurrentTab(u.VARIANT_TAB),i._VariabilityGroupPresenter.clearTags(),i._parametersPresenter&&i._parametersPresenter.clearTags(),i._variantsPresenter.publishTags()):"_1"===i._currentTab?(d.setContext("OptionGroup"),p.destroy(),p.setcurrentTab(u.OG_TAB),i._privateChannelForVg.publish({event:"onTabChange",data:{}}),i._variantsPresenter.clearTags(),i._parametersPresenter&&i._parametersPresenter.clearTags(),i._VariabilityGroupPresenter.publishTags()):"_2"===i._currentTab&&(d.setContext("Parameters"),p.destroy(),p.setcurrentTab(u.PARAMAETER_TAB),i._variantsPresenter.clearTags(),i._VariabilityGroupPresenter.clearTags(),i._parametersPresenter&&i._parametersPresenter.publishTags()))})},m.prototype.inject=function(e){e.appendChild(this._container)},m.prototype.destroy=function(){this._container&&this._container.parentElement&&this._container.parentElement.removeChild(this._container),this._variantsPresenter&&this._variantsPresenter.destroy(),this._VariabilityGroupPresenter&&this._VariabilityGroupPresenter.destroy(),this._myEventManager&&(this._myEventManager.cleanup("EnterpriseVariabilityDictionaryStatePresenter"),this._myEventManager=null)},m.prototype.loadData=function(e){(e||!1===this._loaded.variantClasses)&&(this._variantsPresenter.loadData(),this._loaded.variantClasses=!0),(e||!1===this._loaded.options)&&(this._VariabilityGroupPresenter.loadData(),this._loaded.options=!0),(e||!1===this._loaded.parameters)&&(this._parametersPresenter.loadData(),this._loaded.parameters=!0),"_0"===this._currentTab&&this._variantsPresenter.publishTags(),this.setTabContext(this._currentTab)},m.prototype._initAndLoadDataVariantClassDetails=function(e){this._variantDetailsStatePresenter=new o,a.setDependency("variantDetailsStatePresenter",this._variantDetailsStatePresenter),e.settings=c.getVariantDetailsPresenterSettings(),e.settingsForSubItems=c.getVariantValuesPresenterSettings(),this._variantDetailsStatePresenter.init(this._applicationChannel,this._privateChannelForVariants,e);var t=this._container.parentElement;this._container.parentElement.removeChild(this._container),this._variantDetailsStatePresenter.inject(t)},m.prototype._initAndLoadDataOptionGroupDetails=function(e){this._optionGroupDetailsStatePresenter=new o,a.setDependency("optionGroupDetailsStatePresenter",this._optionGroupDetailsStatePresenter),e.settings=c.getOptionGroupDetailsPresenterSettings(),e.settingsForSubItems=c.getOptionsPresenterSettings(),this._optionGroupDetailsStatePresenter.init(this._applicationChannel,this._privateChannelForVg,e);var t=this._container.parentElement;this._container.parentElement.removeChild(this._container),this._optionGroupDetailsStatePresenter.inject(t)},m.prototype.setTabContext=function(e){var t=void 0;"_0"===e?(t={selectedIds:l.getSelectedItems(c.getVariantsPresenterSettings().appPreferencePath)},d.setContext("Variant",t),p.setcurrentTab(u.VARIANT_TAB)):"_1"===e?(t={selectedIds:l.getSelectedItems(c.getOptionGroupsPresenterSettings().appPreferencePath)},d.setContext("OptionGroup",t),p.setcurrentTab(u.OG_TAB)):"_2"===e&&this._parametersPresenter&&(d.setContext("Parameters"),p.setcurrentTab(u.PARAMAETER_TAB))},m.prototype.activateTags=function(){"_0"===this._currentTab?this._variantsPresenter.publishTags():"_1"===this._currentTab?this._VariabilityGroupPresenter.publishTags():"_2"===this._currentTab&&this._parametersPresenter&&this._parametersPresenter.publishTags()},m.prototype.deactivateTags=function(){"_0"===this._currentTab?this._variantsPresenter.clearTags():"_1"===this._currentTab?this._VariabilityGroupPresenter.clearTags():"_2"===this._currentTab&&this._parametersPresenter&&this._parametersPresenter.clearTags()},m}),define("DS/ENOXModelApp/InformationPanels/CompositionTab/js/MVCompositionPresenter",["UWA/Core","UWA/Class","DS/TreeModel/TreeDocument","DS/CoreEvents/ModelEvents","DS/WAFData/WAFData","DS/UIKIT/Mask","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/ENOXModelApp/ModelDefinition/js/VersionExplorerPresenter","DS/ENOXModelApp/Utils/xModelCommand","DS/WidgetServices/WidgetServices","DS/Utilities/Array","DS/ENOXModelApp/Utils/xModelErrorManagement","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelListView/ModelListView/js/ModelListView","DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/ENOXModelApp/assets/nls/InformationPanels/MVCompositionPresenter","css!DS/ENOXModelApp/InformationPanels/CompositionTab/css/MVCompositionPresenter.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f){"use strict";return t.extend({init:function(e){this._modelVersion,this._variabilityLoaded=!1,this._3dSearch=new s,this._modelEvents=new n,this._command=new l(this._modelEvents),this._initContainer(),this._parent(e)},_initContainer:function(){v.setNotificationManager(_),this._container=e.createElement("div",{class:"mv-composition-presenter",styles:{height:"100%"}}),this._tableContent=e.createElement("div",{class:"composition-table-content",styles:{position:"relative",height:"100%"}}),this._tableContent.inject(this._container)},inject:function(e){this._container.inject(e)},updateOptions:function(e){this._modelVersion=e.modelVersion,this._modelID=e.modelID,this._tenant=e.tenant||"OnPremise",this._securityContext=e.securityContext||"VPLMProjectLeader.MyCompany.3DS Collab Space",this._initTableView(),this.loadData()},_initTableView:function(){this._treeDocument=new i;var e=this,t={id:"_compositionTabPresenter",model:this._treeDocument,modelEvents:this._modelEvents,restrictSortFlag:!1,viewOptions:{identifier:"_compositionTabPresenter",views:["DataGridView"],grid:{columns:[{dataIndex:"tree",text:f.title_label},{text:f.revision_label,dataIndex:"revision"},{text:f.isLastRevision_label,typeRepresentation:"boolean",dataIndex:"isLeaf"},{text:f.modelName_label,dataIndex:"modelName"},{dataIndex:"owner",text:f.owner_label,getCellValue:function(e){return e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:e.nodeModel.options.grid.responsible}}]},contextualActions:[{id:"replace",title:f.replace_action_label,text:f.replace_action_label,fonticon:"replace-by-revision",multiselect:!1,handler:function(t){e.callRevisionExploreForRelace(t)}},{id:"remove",title:f.remove_action_label,text:f.remove_action_label,fonticon:"remove",multiselect:!1,handler:function(t){e.removeComposition([t])}},{id:"information",title:f.information_action_label,text:f.information_action_label,fonticon:"info-open-in-a-new-window",multiselect:!1,handler:function(t){e.launchInformation(t)}}]},toolbarOptions:{withStableActions:!0,useGeneratedToolbar:!0,hideSort:!0,touchMode:!1,hideOnMultiSelection:["replace","information"],actions:[{id:"add",text:f.add_action_label,fonticon:"plus",handler:function(){e.call3DSearchForAddComposition()}},{id:"replace",text:f.replace_action_label,fonticon:"replace-by-revision",showOnSelection:!0,handler:function(t){e.callRevisionExploreForRelace(t[0])}},{id:"remove",text:f.remove_action_label,fonticon:"remove",showOnSelection:!0,handler:function(t){e.removeComposition(t)}},{id:"information",text:f.information_action_label,fonticon:"info-open-in-a-new-window",showOnSelection:!0,handler:function(t){e.launchInformation(t[0])}}]},extensions:[m]};this._tablePresenter=new h(t)},_fetchData:function(){var t=this;return this._get3DSpaceURL().then(function(){return t._modelVersion&&t._3DSpaceURL?new e.Promise(function(e,i){var n={parent:t._modelVersion},o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:t._securityContext},tenantId:t._tenant,data:JSON.stringify(n),onComplete:function(i){t._data=JSON.parse(i),e()},onFailure:function(e,n){i(e),t.handleError("GET",n)}};a.authenticatedRequest(t._3DSpaceURL+"/resources/v1/modeler/dspfl/invoke/dspfl:getModelVersionComposition?$mask=dsmvpfl:ModelVersionCompositionMask",o)}):e.Promise.resolve()}).catch(function(){})},_get3DSpaceURL:function(){if(this._3DSpaceURL)return e.Promise.resolve();var t=this;return new e.Promise(function(e,i){d.get3DSpaceUrlAsync({platformId:t._tenant,onComplete:function(i){console.log(i),t._3DSpaceURL=i,e()},onFailure:function(){i()}})})},loadData:async function(){o.mask(this._container),await this._fetchData(),this._data&&this._modelEvents.publish({event:"xmodel-list-data-load-action",data:this._data}),this.updateUI(),o.unmask(this._container)},updateUI:function(){this._tableContent.setContent(),this._tablePresenter.inject(this._tableContent)},handleError:function(e,t){var i=t&&JSON.parse(t)&&JSON.parse(t).message||"",n=f.ERROR_DATA_DEFAULT_TITLE,a="error";if(!p.showError({action:u.ADD,type:u.TYPE_MV,message:i})){switch(e){case"GET":n=f.ERROR_DATA_LOAD_TITLE;break;case"ADD":n=f.ERROR_DATA_ADD_TITLE;break;case"REMOVE":n=f.ERROR_DATA_REMOVE_TITLE;break;case"REPLACE":n=f.ERROR_DATA_REPLACE_TITLE;break;default:a="warning"}this.displayNotification({title:n,message:i,level:a})}},displayNotification:function(t){_.addNotif(e.merge(t,{level:"info",sticky:!1}))},call3DSearchForAddComposition:function(){var t=this,i=[];this._modelID&&i.push(this._modelID),this._treeDocument.getAllDescendants().forEach(e=>{e.getAttributeValue("modelID")&&c.pushUnique(i,e.getAttributeValue("modelID"))});var n='flattenedtaxonomies:"types/Products" NOT ('+i.map(e=>'based_95_on_95_model_95_physicalid:"'+e+'"').join(" OR ")+') NOT (current: "Obsolete")';this._3dSearch.launchASearch({allowedTypes:[],role:"",title:f.searchLabel,precondition:n,multiSel:!1,in_apps_callback:async function(i){if(e.is(i,"array")&&i.length>0){var n=i[0].id;o.mask(t._container);var a=await t._addComposition(n);a&&t._modelEvents.publish({event:"xmodel-list-data-item-add-action",data:a}),o.unmask(t._container)}}})},_addComposition:function(t){var i=this;return this._get3DSpaceURL().then(function(){return i._modelVersion&&i._3DSpaceURL?new e.Promise(function(e,n){var o={parent:i._modelVersion,modelVersions:[t]},s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:i._securityContext},tenantId:i._tenant,data:JSON.stringify(o),onComplete:function(t){var i=JSON.parse(t).member[0];e(i)},onFailure:function(e,t){n(e),i.handleError("ADD",t)}};a.authenticatedRequest(i._3DSpaceURL+"/resources/v1/modeler/dspfl/invoke/dspfl:attachModelVersionComposition?$mask=dsmvpfl:ModelVersionCompositionMask",s)}):e.Promise.resolve()}).catch(function(){})},_replaceComposition:function(t,i){var n=this;return this._get3DSpaceURL().then(function(){return n._modelVersion&&n._3DSpaceURL?new e.Promise(function(e,o){var s={parent:n._modelVersion,currentModelVersion:t,replaceWithModelVersion:i},r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:n._securityContext},tenantId:n._tenant,data:JSON.stringify(s),onComplete:function(t){var i=JSON.parse(t).member[0];e(i)},onFailure:function(e,t){o(e),n.handleError("REPLACE",t)}};a.authenticatedRequest(n._3DSpaceURL+"/resources/v1/modeler/dspfl/invoke/dspfl:replaceModelVersionComposition?$mask=dsmvpfl:ModelVersionCompositionMask",r)}):e.Promise.resolve()}).catch(function(){})},_detachComposition:function(t){var i=this;return this._get3DSpaceURL().then(function(){return i._modelVersion&&i._3DSpaceURL?new e.Promise(function(n,o){var s={parent:i._modelVersion,modelVersions:t},r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:i._securityContext},tenantId:i._tenant,data:JSON.stringify(s),onComplete:function(t){var a=JSON.parse(t);if(a.result&&a.result.ids?n(a.result.ids):n(),a.error&&e.is(a.error,"array")){var o=a.error.map(e=>e.id),s=[];i._treeDocument.search({match:function(e){-1!==o.indexOf(e.nodeModel.options.id)&&s.push(e.nodeModel.label)}}),i.displayNotification({title:f.ERROR_DATA_REMOVE_TITLE,message:s.join(","),level:"warning"})}},onFailure:function(e,t){o(e),i.handleError("REMOVE",t)}};a.authenticatedRequest(i._3DSpaceURL+"/resources/v1/modeler/dspfl/invoke/dspfl:detachModelVersionComposition",r)}):e.Promise.resolve()}).catch(function(){})},callRevisionExploreForRelace:function(e){var t=this,i=new r({id:e.id,name:e.name,title:e.title,target:e.revision,modelEvents:this._modelEvents,selectionMode:2});i.versionExplorer.subscribeEvent("ENOXVersionExplorerLoadCompleted",function(){i.versionExplorer.publishEvent("ENOXVersionExplorerSetActiveVersion",{id:t._modelVersion})}),i.versionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",async function(i){if(Array.isArray(i)&&1==i.length){var n=i[0].options.grid.id;o.mask(t._container),e.id===n&&(t.displayNotification({title:f.ERROR_SAME_REVISION_TITLE,message:f.ERROR_SAME_REVISION_MSG,level:"warning"}),o.unmask(t._container));var a=await t._replaceComposition(e.id,n);a&&t._modelEvents.publish({event:"xmodel-list-data-item-replace-action",data:{source:{id:e.id},target:a}}),o.unmask(t._container)}}),i.showVersionExplorer()},removeComposition:function(e){var t=this;o.mask(t._container);var i=e.map(e=>e.id);t._detachComposition(i).then(function(e){e=e||i,t._modelEvents.publish({event:"xmodel-list-data-item-remove-action",data:e}),o.unmask(t._container)},function(){o.unmask(t._container)})},launchInformation:function(e){this._command._handlePropertiesCommand(e.id)},destroy:function(){this._container.empty()}})}),define("DS/ENOXModelApp/InformationPanels/CompositionTab/js/MVCompositionFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXModelApp/InformationPanels/CompositionTab/js/MVCompositionPresenter","DS/WidgetServices/securityContextServices/SecurityContextServices","css!DS/ENOXModelApp/InformationPanels/CompositionTab/css/MVCompositionFacet.css"],function(e,t,i,n,a,o){"use strict";return t.extend(i,n,{name:"mv-composition-container",init:function(e){this._parent(e),this._initTableView(),this._initContainer()},_initTableView:function(){this._compositionPresenter=new a},_initContainer:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this._compositionPresenter.inject(this.elements.container)},updateFacet:function(){this.modelIds=[];var e=this.getModel();e&&(this.tenant=e.getTenant(),e.isMergedModel()?this.modelIds=e.getMergedModelIds():this.modelIds.push(e.get("objectId")));var t=this;o.getInstance({tenant:this.tanent}).getSecurityContext({context:this.getContext(),onSuccess:function(e){t.securityContext=e.SecurityContext,t.loadData()}})},loadData:function(){this._compositionPresenter.updateOptions({tenant:this.tenant,modelVersion:this.modelIds[0],modelID:this.options.modelID,securityContext:this.securityContext})},show:function(){this._parent(),this.elements.container&&this.elements.container.addClassName("isVisible")},hide:function(){this._parent(),this.elements.container&&this.elements.container.removeClassName("isVisible")},destroyComponent:function(){this._compositionPresenter.destroy()},onRefresh:function(){this.updateFacet()}})}),define("DS/ENOXModelApp/xModelApp/xModelApp",["UWA/Core","UWA/Element","DS/UIKIT/Mask","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/CoreEvents/ModelEvents","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/ENOXModelApp/components/WelcomePanel/WelcomePanelWrapper","DS/ENOXModelApp/LandingPage/LandingPageStatePresenter","DS/ENOXModelApp/EnterpriseVariabilityDictionary/js/EnterpriseVariabilityDictionaryStatePresenter","DS/ENOXModelApp/ModelDefinition/js/ModelsStatePresenter","DS/ENOXModelApp/ModelDefinition/js/ModelDetailsStatePresenter","DS/ENOXModelApp/ModelDefinition/js/UnitsStatePresenter","DS/xPflRouter5/xPflRouter","DS/ENOXModelApp/xModelRouter/xModelRouterConfig","DS/ENOXModelApp/components/zApplicationFrame/zApplicationFrame","DS/ENOXModelApp/components/DialogCreation/DialogCreationV2","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferencesConstants","DS/ENOXModelApp/xModelApp/xParameter","DS/ENOXModelApp/InformationPanels/InformationPanelManager","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/ENOXModelApp/Utils/xModelAppGlobalVariable","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioQueryServices/js/xEnterpriseDictionary","DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil","DS/CfgSolver/CfgSolverServices","DS/ENOXModelApp/Utils/xModelApp3DSearch","DS/ENOXModelApp/Utils/xModelSubTypeManager","DS/ENOXModelApp/Utils/xModelAccessUtility","DS/ENOXModelApp/Utils/xModelAccessUtilityConstants","DS/ENOXModelApp/Utils/CustomAttributesManager","DS/ENOXModelApp/Utils/xModelDictionaryUtility","i18n!DS/ENOXModelApp/assets/nls/xModelApp","i18n!DS/ENOXModelApp/assets/nls/xModelApp_Common","css!DS/ENOXModelApp/xModelApp/xModelApp.css"],function(e,t,i,n,a,o,s,r,l,d,c,p,u,h,m,_,v,f,g,b,E,C,y,S,D,M,I,A,P,w,O,T,x,R,V){"use strict";var N=window.localStorage.XMODEL_BROWSER_LOG_DEBUG,L=function(){};return L.prototype.init=function(){var t=this;h.initialize(),f.initialize(),this._applicationChannel=new a,this._subTypeMgrChannel=new a,this._updateChannel=new a,this._subscribeToEvents(),this._initDivs(),g.reInitialize(),u.setDependency("applicationChannel",this._applicationChannel),u.setDependency("xModelApp",this),u.setDependency("InformationPanelManager",g),this._x3DSearch=new A,this._prevStates=[],this._nextStates=[],this._mvSubTypesManager=new P({channel:this._subTypeMgrChannel,getSubTypesAPI:y.getMVSubTypes,stdTypeDetails:{name:"Model Version",nlsName:R.STD_MODEL_VERSION,typeClass:".xmodel-application.stdTypeHeader"},parentType:"Products"}),T.initialize().catch(()=>{M.showWarning(R.CUSTOMER_ATTRIBUTE_LOADING_WARNING)}),x.initializeNLS(),this.getReqSubTypes(),e.Promise.all([this.getMVSubTypes(),this.getFeatureStatus()]).then(function(){var i,a=window.widget.getValue("X3DContentId");if(e.is(a,"string")&&(a=JSON.parse(a)),a&&a.data.items&&1===a.data.items.length){var o=a.data.items[0],s=o.objectId,r=o.objectTaxonomies&&o.objectTaxonomies[0]?o.objectTaxonomies[0]:void 0,l=r&&r===n.TYPE_MODELVERSION?n.TYPE_MODELVERSION:o.objectType;l!==n.TYPE_MODELVERSION&&l!==n.TYPE_OPTIONGROUP&&l!==n.TYPE_VARIANT&&l!==n.TYPE_PRODUCTCONFIGURATION&&l!==n.TYPE_MANUFACTURINGPLAN&&l!==n.TYPE_CONFIGURATIONRULE||(i={id:s,type:l})}if(t._setLoading(!0),u.start("/home"),i)t._navigateTo(i).then(function(){t._setLoading(!1)},function(){t._setLoading(!1)});else{var d=b.getRouteInfo();if(d&&d.name)switch(d.name){case n.ROUTE_MODEL_RULE_DETAILS:u.navigate(d.name,{id:d.params.modelVersionId,modelVersionId:d.params.modelVersionId,isRefresh:!0},{reload:!0},function(){t._setLoading(!1)});break;default:var c=d.params||{};u.navigate(d.name,e.merge({isRefresh:!0},c),{reload:!0},function(){t._setLoading(!1)})}else u.navigate(n.ROUTE_RECENTY_OPENED,void 0,void 0,function(){t._setLoading(!1)})}});var i=!(!window.widget||!window.widget.hasPreference(v.xWDGT_PREF_SHOW_WORK_UNDER))&&window.widget.getBool(v.xWDGT_PREF_SHOW_WORK_UNDER);"boolean"==typeof i&&!0===i&&t._initWorkUnder();if(void 0!==window.widget.getValue("addExistingPref")&&(window.widget.hasPreference("addExistingPref")||window.widget.addPreference({name:"addExistingPref",type:"boolean",label:R.addExistingPrefLabel})),window.widget.hasPreference("xPref_CREDENTIAL")&&window.widget.getValue("xPref_CREDENTIAL")){var o=window.widget.getValue("xPref_CREDENTIAL").split(".")[0];o&&w.setUserRole(o)}},L.prototype.popPreviousState=function(e){let t,i=JSON.parse(localStorage["xmodel-app"])["xmodel-app"],n=i["xmodel-views-preferences"].routes;return t=e?n.lastRoutes.pop():n.nextRoutes.pop(),localStorage["xmodel-app"]=JSON.stringify({"xmodel-app":i}),t},L.prototype.pushNewRouterState=function(e,t){let i=JSON.parse(localStorage["xmodel-app"])["xmodel-app"],n=i["xmodel-views-preferences"].routes;n.lastRoutes.length;t?n.nextRoutes.push(e):n.lastRoutes.push(e),localStorage["xmodel-app"]=JSON.stringify({"xmodel-app":i})},L.prototype.getRequirementEnabledStatus=function(){return y.isRequirementEnabled().then(function(e){e&&!0===e.status?n.REQUIREMENTS_ENABLED=!0:n.REQUIREMENTS_ENABLED=!1},function(){n.REQUIREMENTS_ENABLED=!1})},L.prototype.getFeatureStatus=function(){var t={REQEnabled:"REQUIREMENTS_ENABLED",ModelCompositionEnabled:"MV_COMPOSITION_ENABLED",enforceBaseConfiguration:"BC_ENFORCEMENT_ENABLED"};return y.getFeatureStatus({features:["REQEnabled","ModelCompositionEnabled","enforceBaseConfiguration"]}).then(function(e){if(e&&e.features)for(const i in e.features)if(Object.hasOwnProperty.call(t,i)){n[t[i]]=e.features[i]}},function(){e.log("Warning! Using default supported features")})},L.prototype.reactivateWP=function(e){if(e||!0!==this._isWPActivated){window.widget.body.offsetWidth>n.MOBILE_BREAKPOINT&&this._applicationChannel.publish({event:"triptych-show-panel",data:"left"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:null}}),this._applicationChannel.publish({event:"show-welcomepanel-icon"}),this._applicationChannel.publish({event:"topbar-show-title"});var t=this;this._tokenSub=this._applicationChannel.subscribe({event:"resizing-triptych-container"},function(e){e<n.MOBILE_BREAKPOINT?t._applicationChannel.publish({event:"triptych-hide-panel",data:"left"}):t._applicationChannel.publish({event:"triptych-show-panel",data:"left"})}),this._isWPActivated=!0}},L.prototype.deactivateWP=function(e){e||!1!==this._isWPActivated?(this._applicationChannel.publish({event:"triptych-hide-panel",data:"left"}),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:null}}),this._applicationChannel.publish({event:"hide-welcomepanel-icon"}),this._applicationChannel.publish({event:"topbar-hide-title"}),this._tokenSub&&this._applicationChannel.unsubscribe(this._tokenSub),this._LandingPage&&this._LandingPage.clearTags(),this._isWPActivated=!1):this._applicationChannel.publish({event:"topbar-hide-title"})},L.prototype.clearContent=function(){var e=this._mainPanelApplicationContent.firstChild;e&&this._mainPanelApplicationContent.removeChild(e)},L.prototype._initEnterpriseDico=function(e){if(!u.getDependency("enterpriseDictionaryPresenter")){this._enterpriseDico=new l;var t;t=e&&e.params&&e.params.data?e.params.data:null,this._enterpriseDico.init(this._applicationChannel,null,t),u.setDependency("enterpriseDictionaryPresenter",this._enterpriseDico)}this._enterpriseDico.inject(this._mainPanelApplicationContent),this._modelsStatePresenter&&this._modelsStatePresenter.deactivateTags()},L.prototype._initModels=function(e){if(!u.getDependency("modelsStatePresenter")){this._modelsStatePresenter=new d;var t=e&&e.params&&e.params.data?e.params.data:{};t.subTypeManager=this._mvSubTypesManager,this._modelsStatePresenter.init(this._applicationChannel,t),u.setDependency("modelsStatePresenter",this._modelsStatePresenter)}this._modelsStatePresenter.inject(this._mainPanelApplicationContent)},L.prototype._initUnits=function(e){if(!u.getDependency("unitsStatePresenter")){this._unitsStatePresenter=new p;var t=e&&e.params&&e.params.data?e.params.data:{};this._unitsStatePresenter.init(this._applicationChannel,t),u.setDependency("unitsStatePresenter",this._unitsStatePresenter)}this._unitsStatePresenter.inject(this._mainPanelApplicationContent)},L.prototype._initModelDetails=function(e,t){u.getDependency("modelDetailsStatePresenter")||(this._modelDetailsStatePresenter=new c,this._modelDetailsStatePresenter.init(this._applicationChannel,e),u.setDependency("modelDetailsStatePresenter",this._modelDetailsStatePresenter)),this._modelDetailsStatePresenter.inject(this._mainPanelApplicationContent),t&&!this._modelDetailsStatePresenter.isDetailsInitialized()&&this._modelDetailsStatePresenter._fetchData()},L.prototype._initWelcomePanel=function(){this._welcomePanelComponent.init(this._applicationChannel,u,this._zApplicationFrame._triptychWrapper.getLeftPanelContainer())},L.prototype._initWelcomePanelDeactivate=function(){this._welcomePanelComponent.init(this._applicationChannel,u,this._zApplicationFrame._triptychWrapper.getLeftPanelContainerTriptych())},L.prototype._initDivs=function(){this._applicationContainer=document.createElement("div"),e.extendElement(this._applicationContainer),this._applicationContainer.classList.add("xmodel-application"),this._applicationContainer.classList.add("content-loading"),window.widget.body.setContent(this._applicationContainer),C.createImmersiveFrame(),C.getImmersiveFrame().inject(this._applicationContainer),this._welcomePanelComponent=new s,this._zApplicationFrame=new m,this._zApplicationFrame._init(this._applicationChannel,u,this._welcomePanelComponent),C.getImmersiveFrame().setContentInBackgroundLayer(this._zApplicationFrame),this._applicationChannel.publish({event:"triptych-set-size",data:{side:"left",size:n.LEFT_PANEL_SIZE_EXPANDED}}),this._mainPanelApplicationContent=this._applicationContainer.querySelector(".xmodel-content-wrapper"),this._initWelcomePanel();var t=document.getElementsByClassName("wux-windows-docking-element-free-zone");t&&t.length>0&&t[0].remove()},L.prototype._initContent=function(){if(this._applicationChannel.publish({event:"welcome-panel-select-action",data:{id:n.PATH_RECENTY_OPENED}}),void 0===u.getDependency("landingPage")){var e=this._mvSubTypesManager.getSubTypesLabelMap(),t=e?Object.keys(e):[];this._LandingPage=new r(this._applicationChannel,{mvSubTypes:t}),u.setDependency("landingPage",this._LandingPage)}this._LandingPage.inject(this._mainPanelApplicationContent)},L.prototype._subscribeToEvents=function(){var t=this;this._applicationChannel.subscribe({event:"welcome-panel-action-selected"},function(i){i&&i.id===n.PATH_NEW_MODEL_VERSION?t._createModelVersionAction():i&&i.id===n.PATH_OPEN_MODEL_VERSION&&t._x3DSearch.launchASearch({title:R.open_mv_search_title,allowedTypes:[],precondition:'flattenedtaxonomies:"types/Products"',multiSel:!1,criteria:"",in_apps_callback:function(i){if(e.is(i,"array")&&i.length>0){var a=i[0].id;t._navigateTo({id:a,type:n.TYPE_MODELVERSION})}}})}),this._applicationChannel.subscribe({event:"triptych-leaving-mobile"},function(){!1!==t._isWPActivated&&t._applicationChannel.publish({event:"triptych-show-panel",data:"left"})}),this._applicationChannel.subscribe({event:"enox-navigateTo"},function(e){t._navigateTo(e)}),this._applicationChannel.subscribe({event:"enox-model-app-reroute-target-mv"},function(e){t._routeModelVersion(e)}),this._updateChannel.subscribe({event:"enox-dialog-creation"},function(e){t._createModelVersionHelper(e.content)})},L.prototype._routeModelVersion=function(e){u.navigate(e.name,e.params,{replace:!0,reload:!1})},L.prototype._setLoading=function(e){if(e)this._applicationContainer.classList.add("content-loading"),i.mask(this._applicationContainer);else{var t=this;setTimeout(function(){t._applicationContainer.classList.remove("content-loading"),i.unmask(t._applicationContainer)},800)}},L.prototype._getObjectDetails=function(t,i,a,o){let s,r;this._pathMP=[E._KEY,E._VIEWS_PREFERENCES,E._MODEL_VERSIONS_DETAILS,E._MANUFACTURINGPLANS],this._pathPC=[E._KEY,E._VIEWS_PREFERENCES,E._MODEL_VERSIONS_DETAILS,E._PRODUCT_CONFIGURATIONS],this._pathRules=[E._KEY,E._VIEWS_PREFERENCES,E._MODEL_VERSIONS_DETAILS,E._RULES],this._pathModelDetails=[E._KEY,E._VIEWS_PREFERENCES,E._MODEL_VERSIONS_DETAILS];let l=this;return new e.Promise(function(e){return i===n.TYPE_PRODUCTCONFIGURATION||i===n.TYPE_MANUFACTURINGPLAN||i===n.TYPE_CONFIGURATIONRULE?e(i):e()}).then(function(i){return void 0!==i?y.getAssociatedModelVersion(t):e.Promise.resolve()}).then(function(o){return void 0!==(s=void 0!==o&&e.is(o,"string")?JSON.parse(o):o)&&(r=s.identifier),i===n.TYPE_MANUFACTURINGPLAN&&void 0!==o?(b.updateTab(l._pathModelDetails,"_5"),b.updateSelectedItems(l._pathMP,t),t=r):i===n.TYPE_PRODUCTCONFIGURATION?(b.updateTab(l._pathModelDetails,"_2"),b.updateSelectedItems(l._pathPC,t)):i===n.TYPE_CONFIGURATIONRULE&&(b.updateTab(l._pathModelDetails,"_1"),b.updateSelectedItems(l._pathRules,t)),a({id:t,parentID:r})},function(){return M.showError(R.NO_MODELVERSION_ATTACHED_ERROR+o),e.Promise.reject()}).then(function(t){return e.is(t,"string")&&(t=JSON.parse(t)),void 0!==s&&(t.member[0].modelVersionName=s.title,t.member[0].modelVersion=s.revision,t.member[0].modelVersionId=s.identifier,t.member[0].modelName=s.name),e.Promise.resolve(t)})},L.prototype._navigateTo=function(t){var i,a=t.id,o=t.type,s=null;if(o===n.TYPE_MODELVERSION?(i={service:y.getModelDetails,route:n.ROUTE_MODEL_DETAILS},s=R.TYPE_MODELVERSION):o===n.TYPE_VARIANT?(i={service:D.getVariantClassDetails,route:n.ROUTE_DICTIONARY_VARIANT_DETAILS},s=R.TYPE_VARIANT):o===n.TYPE_OPTIONGROUP?(i={service:D.getVariabilityGroupDetails,route:n.ROUTE_DICTIONARY_OPTION_GROUP_DETAILS},s=R.TYPE_OPTIONGROUP):o===n.TYPE_CONFIGURATIONRULE?(i={service:y.getRuleDetails,route:n.ROUTE_MODEL_RULE_DETAILS},s=R.TYPE_CONFIGURATIONRULE):o===n.TYPE_PRODUCTCONFIGURATION?(i={service:y.getConfigurationDetails,route:n.ROUTE_MODEL_PC_DETAILS},s=R.TYPE_PRODUCTCONFIGURATION):o===n.TYPE_MANUFACTURINGPLAN?(i={service:y.getModelDetails,route:n.ROUTE_MODEL_DETAILS},s=R.TYPE_MANUFACTURINGPLAN):o===n.TYPE_BASECONFIGURATION&&(i={service:y.getConfigurationDetailsBC,route:n.ROUTE_MODEL_BC_DETAILS},s=R.TYPE_BASECONFIGURATION),i){var r=i.service,l=i.route;return this._getObjectDetails(a,o,r,s).then(function(i){e.is(i,"string")&&(i=JSON.parse(i));var o=i.member[0].title,s=i.member[0].revision,r=i.member[0].modelName,d=i.member[0].image;a=i.member[0].id;var c=i.member[0].modelID,p=i.member[0].modelVersionId?i.member[0].modelVersionId:i.member[0].id,h=i.member[0].modelVersion,m=i.member[0].modelVersionName,_={id:a,name:o};return s&&(_.version=s),r&&(_.modelName=r),p&&(_.modelVersionId=p),h&&(_.modelVersion=h),m&&(_.modelVersionName=m),c&&(_.modelID=c),d&&(_.image=d),l===n.ROUTE_MODEL_RULE_DETAILS&&(_.isOpenWith=!0),new e.Promise(function(e){u.navigate(l,_,{reload:t.reload},function(){e()})})},function(){return e.log("getModelDetails: Service Call Failed !!!"),e.Promise.reject("Get Model Details Error")})}},L.prototype._createModelVersionHelper=function(t){var i,a,o,s=this;s._patchForUploadingImage=void 0,s._patchIdObject=void 0,t&&(a=t.title?t.title:"",o=t.description?t.description:"",s._patchForUploadingImage=t.image?t.image:void 0);var r={items:[{type:t&&t.type&&"Model Version"!==t.type?t.type:"",versionName:t.revision?t.revision:"",attributes:{name:"",description:o,title:a}}]};y.createModel(r).then(function(t){if(!(i=t.value)&&t.member&&t.member.length>0)if(i=t.member[0].id,s._patchIdObject={valueId:t.member[0].id,name:t.member[0].title,version:t.member[0].revision,modelName:t.member[0].modelName,modelID:t.member[0].modelID},s._patchForUploadingImage)S.uploadImage(i,s._patchForUploadingImage).then(function(){u.navigate(n.ROUTE_MODEL_DETAILS,{id:s._patchIdObject.valueId,name:s._patchIdObject.name,modelID:s._patchIdObject.modelID,modelVersionId:s._patchIdObject.valueId,version:s._patchIdObject.version,modelName:s._patchIdObject.modelName,type:s._patchIdObject.type?s._patchIdObject.type:"Products"})},function(){e.log("uploadImage: Service Call Failed !!!"),u.navigate(n.ROUTE_MODEL_DETAILS,{id:s._patchIdObject.valueId,modelVersionId:s._patchIdObject.valueId,name:s._patchIdObject.name,version:s._patchIdObject.version,modelName:s._patchIdObject.modelName,modelID:s._patchIdObject.modelID,type:s._patchIdObject.type?s._patchIdObject.type:"Products"})});else{var a=t.member[0].title,o=t.member[0].revision,r=t.member[0].modelName,l=t.member[0].type,d=t.member[0].modelID;u.navigate(n.ROUTE_MODEL_DETAILS,{id:i,name:a,version:o,modelName:r,modelVersionId:i,modelID:d,type:l||"Products"})}e.log("Created model Id is: "+i)},function(){var i=s._mvSubTypesManager?s._mvSubTypesManager.getSubTypeLabel(t.type):"";M.showError(V.ERR_CREATION_FAILED+(i||V.TYPE_MODELVERSION)),e.log("createModel: Service Call Failed !!!")})},L.prototype._createModelVersionAction=function(){if(w.checkActionAccess({action:O.CREATE,type:O.TYPE_MV,notify:!0})){var e=!1,t=[];this._mvSubTypesManager&&this._mvSubTypesManager.doesSubTypeExists()&&(e=!0,t=this._mvSubTypesManager.getSubTypesForSelection()),_.show({id:"model_version",modelEvent:this._updateChannel,title:R.newModelVersion,edit_revision:!0,typeSelection:e,availableTypes:t,createBtnLabel:V.Create_Label})}},L.prototype._initWorkUnder=function(){o.initialize2(this._applicationContainer,window.widget.id,"show","bottom-right",function(t){o.work_under.Message_SUCCESS!==t&&N&&e.log("Failed to initialized work under!")},{isEditable:!0,isEvolution:!1,isChange:!0,isMovable:!0,resetDefault:!0})},L.prototype.onSearch=function(e){var t="";e&&e.length>0&&(t=e),this._applicationChannel.publish({event:"search-in-current-dashboard",data:t})},L.prototype._onRefresh=function(){this.getReqSubTypes(),I.resetService();var e=b.getRouteInfo();e&&e.name?(u.navigate(n.ROUTE_HOME,{isRefresh:!0},{reload:!0}),u.navigate(e.name,{id:e.params.modelVersionId,modelVersionId:e.params.modelVersionId,isRefresh:!0},{reload:!0})):u.navigate(n.ROUTE_RECENTY_OPENED,{},{reload:!0})},L.prototype.onRefresh=function(){var t=this;y.removeCache().then(function(){e.log("Server side Cache refreshed successfully"),t._onRefresh()},function(){e.log("Failure at refreshing cache"),t._onRefresh()})},L.prototype.getReqSubTypes=function(){let e=this._mvSubTypesManager;require(["DS/ENOXModelApp/RoadMap/EnoxRoadmapControllerHelper"],function(t){t.getSubTypes(),t.setMVSubTypeManager(e)})},L.prototype.getMVSubTypes=function(){return this._mvSubTypesManager.getSubTypeFetchPromise().then(function(){e.log("Subtypefetch promise resolved")},function(){e.log("Unable to fetch the Model Version subtypes!")})},L}),define("DS/ENOXModelApp/xModelApp/xModelAppWidgetManager",["UWA/Core","DS/ENOXModelApp/xModelApp/xModelApp","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Mask","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/ENOXModelApp/Utils/xModelApplicationPreferencesManager","DS/ENOXModelApp/Utils/xModelPreferencesConstant","DS/xPortfolioQueryServices/js/infra/xPortfolioInfra","DS/xPortfolioQueryServices/js/xPortfolioModel","DS/ENOXModelApp/Utils/xModelAppGlobalConfig","DS/CoreEvents/ModelEvents","i18n!DS/ENOXModelApp/assets/nls/xModelApp"],function(e,t,i,n,a,o,s,r,l,d,c,p){"use strict";var u=function(){};return u.prototype.initPreference=function(){var e=this;this.initializeLinkManager(),r.getUserId().then(function(t){o.setUserId(t),o.initialize(!0,!0,!1),e.initAndSetupWidget()},function(){o.initialize(!1,!0,!1),e.initAndSetupWidget()})},u.prototype.initAndSetupWidget=function(){var o=this;if(void 0===window.widget||null===window.widget)throw new Error("Error!!! Widget is undefined or null, it may not be instantiated yet!!!");var s=a.getCredentialPreferenceKey(),d=a.getShowWorkUnderPreferenceKey();window.widget.setIcon(i.getWebappsAssetUrl("ENOXModelApp","icon/iconENOVIA.png")),window.widget.setAutoRefresh(10080);var u=!1;n.mask(window.widget.body,p.GETTING_THINGS_READY),a.addCredentialPreferenceToWidget().then(function(){let i=localStorage.getItem("launchRoadmapAsWidget"),h=widget.getValue("X3DContentId");if((h=(h=e.is(h)&&""!==h?JSON.parse(h):void 0)&&h.data?h.data:void 0)&&("true"===i||"true"===widget.getValue("launchedForRoadmap"))&&h.controllerOptions&&h.controllerModule)localStorage.setItem("launchRoadmapAsWidget","false"),widget.setValue("launchedForRoadmap","true"),widget.hasPreferences()&&(widget.preferences=[]),console.time("Timer-LoadingRoadmapViewInParentWidget"),n.mask(widget.body,p.PREPARING_FOR_ROADMAP_VIEW),require([h.controllerModule],function(t){try{o.rdmpControllerInstance=new t,widget.body.empty(),h.controllerOptions.containerForFullView=widget.body,h.controllerOptions.modelEvents=new c,o.rdmpControllerInstance.init(h.controllerOptions),window.widget.setValue(s,localStorage.getItem("securityContext")),r.setServiceUrlAndSecurityContext(a.getServiceUrl(),window.widget.getValue(s)),window.widget.addEvents({onRefresh:function(){try{if(o.roadmapIsRefreshing)window.notifs.addNotif({level:"info",title:p.ROADMAP_VIEW,subtitle:"",message:p.ROADMAP_VIEW_IS_REFRESHING});else{if(widget.body.empty(),o.roadmapIsRefreshing=!0,e.is(o.rdmpControllerInstance)){let t=widget.getValue("X3DContentId");e.is(t)&&(delete(t=(t=JSON.parse(t)).data?t.data:void 0).controllerOptions.modelEvents,o.rdmpControllerInstance.updateDataItemOptions(t.controllerOptions),o.rdmpControllerInstance.initializeRoadmapPresenter()),setTimeout(()=>{o.roadmapIsRefreshing=!1},3e3)}n.unmask(widget.body)}}catch(t){n.isMasked(widget.body)&&n.unmask(widget.body),e.log("Error while refreshing Roadmap View..."),widget.setValue("roadmapIsRefreshing",!1)}}})}catch(t){e.log("Exception occured!")}finally{n.unmask(widget.body)}});else{var m=window.widget.getValue(s);if(localStorage.setItem("securityContext",m),void 0!==m&&""!==m){var _=window.widget.getPreference(s);if(_&&_.options){for(var v=!1,f=_.options,g=0;g<f.length;g++)if(f[g]&&f[g].value&&f[g].value===m){v=!0;break}!1===v&&window.widget.setValue(s,void 0)}}!1===window.widget.hasPreference(d)&&a.addShowWorkUnderPreferenceToWidget({prefDefValue:!1}),e.log("Processing loading of Model Definition!!!"),o.xModelAppInst=new t,window.widget.addEvents({onLoad:function(){var t=function(){var e=window.widget.hasPreference(s),t=window.widget.getValue(s);!e||void 0!==t&&""!==t?(r.setServiceUrlAndSecurityContext(a.getServiceUrl(),window.widget.getValue(s)),o.xModelAppInst.init(),u=!0):window.widget.toggleEdit()};l.removeCache().then(function(){e.log("Server side Cache refreshed successfully"),t()},function(){e.log("Failure at refreshing cache"),t()})},onRefresh:function(){if(n.mask(widget.body),a.hasCredentialsChanged()||a.hasPlatformIdChanged()){var e=window.widget.hasPreference(s),t=window.widget.getValue(s);!e||void 0!==t&&""!==t?(r.setServiceUrlAndSecurityContext(a.getServiceUrl(),window.widget.getValue(s)),o.xModelAppInst.init()):window.widget.toggleEdit()}else o.xModelAppInst.onRefresh();n.unmask(widget.body)},onEdit:function(){e.log("onEdit"),this._securityCntxtPrefValueBeforeEdit=window.widget.getValue(s)},endEdit:function(){e.log("endEdit: widget.isEdit:  "+window.widget.isEdit),e.log("arguments[0].submitted : "+arguments);var t=window.widget.getValue(s);if(localStorage.setItem("securityContext",t),e.log("endEdit : securityCntxtPrefValue: "+t),e.log("xModelApp: onPrefEdit: args len "+arguments.length),arguments.length>=1&&arguments&&!1===arguments[0].submitted){var i=window.widget.getValue(s);void 0===i||""===i?window.widget.toggleEdit():void 0!==this._securityCntxtPrefValueBeforeEdit&&""!==this._securityCntxtPrefValueBeforeEdit||void 0===m||""===m?void 0!==m&&""!==m&&void 0!==this._securityCntxtPrefValueBeforeEdit&&""!==this._securityCntxtPrefValueBeforeEdit&&i!==this._securityCntxtPrefValueBeforeEdit?(window.widget.setValue(s,this._securityCntxtPrefValueBeforeEdit),!1===u&&window.widget.launch()):void 0!==i&&""!==i&&void 0!==this._securityCntxtPrefValueBeforeEdit&&""!==this._securityCntxtPrefValueBeforeEdit&&i===this._securityCntxtPrefValueBeforeEdit&&!1===u&&window.widget.launch():(window.widget.setValue(s,void 0),window.widget.toggleEdit())}else arguments.length>=1&&arguments&&!0===arguments[0].submitted&&window.widget.launch()},onSearch:function(e){o.xModelAppInst.onSearch(e)},onResetSearch:function(){o.xModelAppInst.onSearch()}})}n.unmask(window.widget.body)},function(){n.unmask(window.widget.body),e.log("Error!!! Unable to get the assigned security contexts for the user.")})},u.prototype.initializeLinkManager=function(){let t=this;require(["DS/ENOXModelApp/Utils/xModelLinkManager"],i=>{t.linkMgr=i;i.initializeWidgetLink(widget,{appIds:["ENXMODL_AP"],open:!1,uses:[],implements:[]},"ENXMODL_AP").then(()=>{t.linkMgr.subscribe("DS/ENOXMDLDEF/ITEM/OPENED",function(i){try{i&&"Products"===i.type?e.is(t.rdmpControllerInstance)&&(t.rdmpControllerInstance.isSameDataLoadedAlready(i)?e.log("Same set of data is already opened"):(t.rdmpControllerInstance.updateDataItemOptions(i),t.rdmpControllerInstance.initializeRoadmapPresenter(t.rdmpControllerInstance.options),t.rdmpControllerInstance.updateWidgetX3DContentIdData())):e.is(t.rdmpControllerInstance)&&window.notifs.addNotif({level:"info",title:p.ROADMAP_VIEW,subtitle:"",message:p.OBJECT_NOT_SUPPORTED_FOR_ROADMAP})}catch(t){let i="Item page details launched: exception occured";e.log(t.message?i+": "+t.message:i)}}),t.linkMgr.subscribe("DS/ENOXMDLDEF/ITEM/OPENED/FROM/ROADMAP",function(t){try{if(e.is(t)&&e.is(t.id)&&e.is(t.parentId)){n.mask(widget.body,p.LOADING_ITEM_OPENED_FOR_ROADMAPPING);let e=[s._KEY,s._VIEWS_PREFERENCES,s._MODEL_VERSIONS_DETAILS];o.getSelectedItems(e)===t.id?window.notifs.addNotif({level:"info",title:p.ROADMAP_VIEW,subtitle:"",message:p.OBJECT_OPENED_FOR_ROADMAPPING_ALREADY_LOADED}):require(["DS/xPflRouter5/xPflRouter"],function(e){e.navigate(d.ROUTE_MODEL_DETAILS,{modelVersionId:t.id,id:t.id,name:t.title,version:t.revision,state:t.maturity,fromRoadmapContext:!0,modelName:t.parentTitle,type:t.type?t.type:"Products"})})}else e.log("Error! Invalid item information received from linked Roadmap View"),window.notifs.addNotif({level:"warn",title:p.ROADMAP_VIEW,subtitle:"",message:p.ERROR_INVALID_INFO_OF_ITEM_OPENED_FOR_ROADMAPPING})}catch(t){let i="Item page details launched: exception occured";e.log(t.message?i+": "+t.message:i)}finally{n.isMasked(widget.body)&&setTimeout(()=>{n.unmask(widget.body)},1e3)}})})})},u.destroy=function(){},u});