define(["require","exports","./Utils"],function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.convertHtmlToListOfWords=void 0;e.convertHtmlToListOfWords=function(r,e){for(var n,i={mode:"character",currentWord:[],words:[]},c=s(r,e),a=!!c.size,d=!1,u=-1,h=0;h<r.length;h++){var l=r[h];if(a&&(u===h&&(u=-1,d=!1),c.has(h)&&(d=!0,u=null!==(n=c.get(h))&&void 0!==n?n:0),d))i.currentWord.push(l),i.mode="character";else switch(i.mode){case"character":t.isStartOfTag(l)?o(i,"<","tag"):t.isStartOfEntity(l)?o(i,l,"entity"):t.isWhiteSpace(l)?o(i,l,"whitespace"):t.isWord(l)&&(0===i.currentWord.length||t.isWord(i.currentWord[i.currentWord.length-1]))?i.currentWord.push(l):o(i,l,"character");break;case"tag":t.isEndOfTag(l)?(i.currentWord.push(l),i.words.push(i.currentWord.join("")),i.currentWord=[],i.mode=t.isWhiteSpace(l)?"whitespace":"character"):i.currentWord.push(l);break;case"whitespace":t.isStartOfTag(l)?o(i,l,"tag"):t.isStartOfEntity(l)?o(i,l,"entity"):t.isWhiteSpace(l)?i.currentWord.push(l):o(i,l,"character");break;case"entity":if(t.isStartOfTag(l))o(i,l,"tag");else if(t.isWhiteSpace(l))o(i,l,"whitespace");else if(t.isEndOfEntity(l)){var W=!0;if(0!==i.currentWord.length&&(i.currentWord.push(l),i.words.push(i.currentWord.join("")),i.words.length>2&&t.isWhiteSpace(i.words[i.words.length-2])&&t.isWhiteSpace(i.words[i.words.length-1]))){var p=i.words[i.words.length-2],w=i.words[i.words.length-1];i.words.splice(i.words.length-2,2),i.currentWord=[p,w],i.mode="whitespace",W=!1}W&&(i.currentWord=[],i.mode="character")}else t.isWord(l)?i.currentWord.push(l):o(i,l,"character")}}return 0!==i.currentWord.length&&i.words.push(i.currentWord.join("")),i.words};var o=function(r,e,t){0!==r.currentWord.length&&r.words.push(r.currentWord.join("")),r.currentWord=[e],r.mode=t},s=function(r,e){var t=new Map;if(null===e)return t;for(var o=0,s=e;o<s.length;o++)for(var n=s[o],i=void 0;null!==(i=n.exec(r));){if(t.has(i.index))throw new Error("One or more block expressions result in a text sequence that overlaps. Current expression: "+n.toString());t.set(i.index,i.index+i[0].length)}return t}});