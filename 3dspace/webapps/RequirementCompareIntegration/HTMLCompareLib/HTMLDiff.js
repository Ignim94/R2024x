var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var a in e=arguments[t])Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(n,e,t){if(t||2===arguments.length)for(var r,a=0,i=e.length;a<i;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return n.concat(r||Array.prototype.slice.call(e))};define("DS/RequirementCompareIntegration/HTMLCompareLib/HTMLDiff",["require","exports","./Match","./MatchFinder","./Utils","./WordSplitter"],function(n,e,t,r,a,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=new Map([["</strong>",0],["</em>",0],["</b>",0],["</i>",0],["</big>",0],["</small>",0],["</u>",0],["</sub>",0],["</strike>",0],["</s>",0],["</dfn>",0]]),s=/<((strong)|(b)|(i)|(dfn)|(em)|(big)|(small)|(u)|(sub)|(sup)|(strike)|(s))[>\s]+/gi,u=function(n,e,t){return{oldWords:i.convertHtmlToListOfWords(n,t),newWords:i.convertHtmlToListOfWords(e,t)}},o=function(n,e,t,r){switch(n.action){case"equal":return h(n,t);case"delete":return f(n,"diffdel",e,r);case"insert":return c(n,"diffins",t,r);case"replace":return d(n,e,t,r);case"none":default:return""}},d=function(n,e,t,r){var a=f(n,"diffmod",e,r),i=c(n,"diffmod",t,r);return"".concat(a).concat(i)},c=function(n,e,t,r){var a=t.filter(function(e,t){return t>=n.startInNew&&t<n.endInNew});return I("ins",e,a,r)},f=function(n,e,t,r){var a=t.filter(function(e,t){return t>=n.startInOld&&t<n.endInOld});return I("del",e,a,r)},h=function(n,e){return e.filter(function(e,t){return t>=n.startInNew&&t<n.endInNew}).join("")},I=function(n,e,t,r){for(var i=[];t.length;){var u=p(t,function(n){return!a.isTag(n)}),o="",d=!1;if(0!==u.length){var c=a.wrapText(u.join(""),n,e);i.push(c)}else{if(s.test(t[0])){var f=t[0].match(s);if(null!==f){var h="<"+f[0].replace(/(<|>| )/g,"")+">";r.push(h)}if(o='<ins class="mod">',"del"===n)for(t.shift();t.length>0&&s.test(t[0]);)t.shift()}else if(l.has(t[0])){var I=0===r.length?null:r.pop();if(null!==I&&I===t[t.length-1].replace(/\//g,"")&&(o="</ins>",d=!0),"del"===n)for(t.shift();t.length>0&&l.has(t[0]);)t.shift()}if(0===t.length&&0===o.length)break;d?i.push(o+p(t,a.isTag).join("")):i.push(p(t,a.isTag).join("")+o)}}return i.join("")},p=function(n,e){for(var t=0,r=!1,a=0;a<n.length;a++){var i=n[a];if(0===a&&" "===i&&(n[a]="&nbsp;"),!e(i)){t=a,r=!0;break}}if(r){var l=n.filter(function(n,e){return e>=0&&e<t});return t>0&&n.splice(0,t),l}l=n.filter(function(e,t){return t>=0&&t<n.length});return n.splice(0,n.length),l},v=function(n,e,t,r,a,i,l){var s=0,u=0,o=[],d=n.length,c=e.length,f=N(n,e,a,i,l);f.push({startInOld:d,startInNew:c,endInOld:d,endInNew:c,size:0});for(var h=0,I=w(f,n,e,r);h<I.length;h++){var p=I[h];if(null!==p){var v=s===p.startInOld,O=u===p.startInNew,_=void 0;"none"!==(_=v||O?v&&!O?"insert":v?"none":"delete":"replace")&&o.push({action:_,startInOld:s,endInOld:p.startInOld,startInNew:u,endInNew:p.startInNew}),0!==p.size&&o.push({action:"equal",startInOld:p.startInOld,endInOld:p.endInOld,startInNew:p.startInNew,endInNew:p.endInNew}),s=p.endInOld,u=p.endInNew}}return t?g(o,n,e):o},g=function(n,e,t){for(var r=[],i=function(n){return a.isWhiteSpace(e.filter(function(e,t){return t>=n.startInOld&&t<n.endInOld}).join(""))&&a.isWhiteSpace(t.filter(function(e,t){return t>=n.startInNew&&t<n.endInNew}).join(""))},l=n[n.length-1],s=0;s<n.length;s++){var u=n[s];if("replace"===u.action){for(var o=!1,d=s+1;d<n.length;d++){var c=n[d];if("replace"!==c.action&&"equal"===c.action&&!i(c)){r.push({action:"replace",startInOld:u.startInOld,endInOld:c.startInOld,startInNew:u.startInNew,endInNew:c.startInNew}),s=d-1,o=!0;break}}if(!o){r.push({action:"replace",startInOld:u.startInOld,endInOld:l.endInOld,startInNew:u.startInNew,endInNew:l.endInNew});break}}else r.push(u)}return r},w=function(n,e,r,a){for(var i=[],l=__assign({},t.NoMatch),s=null,u=0,o=n;u<o.length;u++){var d=o[u];if(null!==s)if(l.endInOld===s.startInOld&&l.endInNew===s.startInNew||s.endInOld===d.startInOld&&s.endInNew===d.startInNew)i.push(s),l=s,s=d;else{var c=function(n,e){return n+e.length},f=e.slice(l.endInOld,d.startInOld).reduce(c,0),h=r.slice(l.endInNew,d.startInNew).reduce(c,0);r.slice(s.startInNew,s.endInNew).reduce(c,0)>Math.max(f,h)*a&&i.push(s),l=s,s=d}else l=__assign({},t.NoMatch),s=d}return null!==s&&i.push(s),i},N=function(n,e,t,r,a){return O(0,n.length,0,e.length,n,e,t,r,a)},O=function(n,e,t,r,a,i,l,s,u){if(n>=e||t>=r)return[];var o=_(n,e,t,r,a,i,l,s,u);if(null===o)return[];var d=O(n,o.startInOld,t,o.startInNew,a,i,l,s,u),c=O(o.endInOld,e,o.endInNew,r,a,i,l,s,u);return __spreadArray(__spreadArray(__spreadArray([],d,!0),[o],!1),c,!0)},_=function(n,e,t,a,i,l,s,u,o){for(var d=s;d>0;d--){var c={blockSize:d,repeatingWordsAccuracy:u,ignoreWhiteSpaceDifferences:o},f=(0,r.findMatch)(i,l,n,e,t,a,c);if(null!==f)return f}return null};e.default=function(n,e,t){return function(n,e,t){var r,a,i,l,s;if(n===e)return e;var d=u(n,e,[]),c=d.oldWords,f=d.newWords,h=Math.min(null!==(r=null==t?void 0:t.matchGranularity)&&void 0!==r?r:4,c.length,f.length),I=v(c,f,null!==(a=null==t?void 0:t.combineWords)&&void 0!==a&&a,null!==(i=null==t?void 0:t.orphanMatchThreshold)&&void 0!==i?i:0,h,null!==(l=null==t?void 0:t.repeatingWordsAccuracy)&&void 0!==l?l:1,null!==(s=null==t?void 0:t.ignoreWhiteSpaceDifferences)&&void 0!==s&&s),p=[];return I.map(function(n){return o(n,c,f,p)}).join("")}(n,e,t)}});