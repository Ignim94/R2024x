define("DS/RequirementCompareIntegration/plugins/CONTENT_COMPARE_PLUGIN",["DS/CompareWidget2/plugins/displayPlugin","DS/RequirementCompareIntegration/plugins/TRM_CONTENT_PANEL","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","DS/RequirementCompareIntegration/HTMLCompareLib/HTMLDiff","DS/UIKIT/Mask","i18n!DS/RequirementCompareIntegration/assets/nls/ReqCompareWidgetNLS.json"],function(e,t,n,i,r,a,o,l,s){"use strict";let u={visibility:!1,rightLegend:"",leftLegend:""};function c(e){let t=this,i=t._outputPanel.elements,c={visible:!1,text:""},f=function(e){let t=[];return e.forEach(e=>{t.push(function(e,t){return new Promise(function(i,o){n.getInfo({pid:e,securityContext:t,authored:!0,selectables:"attribute[Title],revision,attribute[Content Data],physicalid,type.kindof",onComplete:function(e){e=UWA.is(e,"string")?JSON.parse(e):e,i(e)},onFailure:function(e){var t=a.getParseErrorMessage(e);r.errorAlert(t),o(e)},onTimeout:function(e){var t=a.getParseErrorMessage(e);r.errorAlert(t),o(e)}})})}(e.getPhysID(),e.getSecurityContext()))}),new Promise(function(e,n){Promise.all(t).then(function(t){let n=[];t.forEach(e=>{n.push(e.results[0])}),e(n)}).catch(function(e){console.log(e),n([])})})}(e);u.visibility=!1,l.isMasked(i.container)||l.mask(i.container),f.then(function(n){let r=function(e,t,n){let i=[],r=s.noContentToCompare;const a={notRequired:1,required:2};switch(n.forEach(t=>{let n=e.find(e=>e.physicalid===t.getPhysID());(function(e){let t="Requirement"===e["type.kindof"],n="Comment"===e["type.kindof"];return t||n})(n)&&i.push(n)}),i.length){case a.notRequired:let l=d(i[0]);r=l||s.noContentData,t.visible=!!l,t.text=p(i[0]);break;case a.required:let c=function(e,t){let n="";!e&&t&&(e="<p></p>");!t&&e&&(t="<p></p>");return(n=o.default(e,t,{ignoreWhiteSpaceDifferences:!0,matchGranularity:100,combineWords:!1}))||""}(d(i[0]),d(i[1]));r=c||s.noContentData,u.leftLegend=s.onlyIn+p(i[0]),u.rightLegend=s.onlyIn+p(i[1]),u.visibility=!!c}return r}.call(this,n,c,e);h.call(t,r,c),l.isMasked(i.container)&&l.unmask(i.container)}).catch(function(e){console.log(e),h.call(t,"","")})}function d(e){return e["attribute[Content Data]"]?e["attribute[Content Data]"]:""}function p(e){return(e["attribute[Title]"]?e["attribute[Title]"]:"")+" "+(e.revision?e.revision:"")}function h(e,t){let n=this._outputPanel.elements;(function(){let e=this._outputPanel.elements;u.visibility?(e.standardToolbar.toolbarOtherItems.prepareUpdateView(),e.standardToolbar.toolbarOtherItems.updateNodeModel("leftText",{grid:{data:u.leftLegend},tooltip:u.leftLegend}),e.standardToolbar.toolbarOtherItems.updateNodeModel("rightText",{grid:{data:u.rightLegend},tooltip:u.rightLegend}),e.standardToolbar.toolbarOtherItems.pushUpdateView(),e.standardToolbar.toolbarContainer.show()):e.standardToolbar.toolbarContainer.hide()}).call(this),function(e){let t=this._outputPanel.elements;e&&e.visible?(t.compareTitle.show(),t.compareTitle.setHTML(e.text)):t.compareTitle.hide()}.call(this,t),n&&e?n.contentPanel.setHTML(e):n.contentPanel.setHTML(s.noContentToCompare)}return e.extend({createViewPanelObject:function(e){if(e)return new t(e);this.reportKO()},execute:function(e,t){let n=this;n._parent(e,t),new Promise(function(e,t){try{i.app_initialization(function(t){e(t)})}catch(e){t(e)}}).then(function(){c.call(n,e),n.reportOK()}).catch(function(e){h.call(n,"",""),n.reportKO(e)})},onEnabled:function(){let e=this;return e._lastViewDisplayMode="none",e._lastWasRootsOnly=!1,e._isEnabled||e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",function(e){let t=[];u.visibility=!1,e.data.selectedData&&e.data.selectedData.forEach(e=>{Array.isArray(e)&&e.length&&t.push(e[0].ObjIDSpec)}),t.length?c.call(this,t):h.call(this,"","")}.bind(this)),e._parent()}})});