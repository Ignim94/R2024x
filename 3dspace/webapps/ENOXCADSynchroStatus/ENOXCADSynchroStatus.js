define("DS/ENOXCADSynchroStatus/utils/XCADNotification",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(t,e){"use strict";return{_notif_manager:null,init:function(n){null===this._notif_manager&&(this._notif_manager=t,e.setNotificationManager(this._notif_manager),e.setStackingPolicy(5),e.setRemoveStackOnFirstTimeoutFlag(!0),e.setFadeOutPolicy(2))},sucessMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"success",message:t,sticky:!1})},infoMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"info",message:t,sticky:!1})},warningMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"warning",message:t,sticky:!1})},errorMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"error",message:t,sticky:!1})},clearNotifications:function(){e.removeNotifications("","")}}}),define("DS/ENOXCADSynchroStatus/utils/Constants",["UWA/Core","UWA/Controls/Abstract"],function(t,e){"use strict";return{EMPTY_JSON_OBJECT:{},PLATFORM_SERVICES:"platformServices",PLATFORM_ID:"platformid",SEC_CTX:"xPref_CREDENTIAL",URL_3DSPACE:"url3dspace",CADORIGIN_CATIAV5:"CATIAV5",CADORIGIN_3DEXP:"3DEXPERIENCE",STATUS_JOBFAIL:"JobFail",STATUS_UNSYNC:"Unsync",STATUS_NA:"NA",PSE_CONTEXT_REFRESH:"SyncModelRefresh",OBJECT_SELECTS:["identifier","physicalid","type","ds6w:cadMaster","ds6w:label"],REL_SELECTS:["identifier","physicalid","type"],CADORIGIN_3DSHAPE:"3DShape",STATUS_SYNC:"Sync",STATUS_JOBRUNNING:"JobRunning"}}),define("DS/ENOXCADSynchroStatus/utils/SettingsManagement",["UWA/Class","DS/ENOXCADSynchroStatus/utils/Constants"],function(t,e){"use strict";return t.singleton({init:function(){this.isPlatformInitialized=!0},addSetting:function(t,e){if(!this.isPlatformInitialized)throw new Error("Platformservices not initialized");widget[t]&&console.log("Setting is already in use"),widget[t]=e},getSetting:function(t){return widget[t]||""},getPlatformURLs:function(){return this.getSetting(e.PLATFORM_SERVICES)},getPlatformId:function(){return this.getSetting(e.PLATFORM_ID)},getSecCtx:function(){return"ctx::"+widget.getValue(e.SEC_CTX)},get3DSpaceURL:function(){return this.getSetting(e.URL_3DSPACE)},getLang:function(){return"undefined"!=typeof widget?widget.lang:"en"},getWidgetId:function(){return"undefined"!=typeof widget?widget.id:-1}})}),define("DS/ENOXCADSynchroStatus/XCADWSProxy",["UWA/Core","DS/WAFData/WAFData","DS/ENOXCADSynchroStatus/utils/SettingsManagement"],function(t,e,n){let o=function(t,n,o){return new Promise(function(i,s){n.onComplete=function(t){let e=function(t){return"string"==typeof t?JSON.parse(t):t}(t),n=e;o&&(n=o(e)),i(n)},n.onFailure=function(t){s(t)},n.data&&(n.data=JSON.stringify(n.data)),function(t,n,o){let i=null;i=e.authenticatedRequest(t,n)}(t,n)})};return{getXCADSynchroStatus:function(t){console.log("---XCADSync calling getSyncStatus WS.......");let e=n.get3DSpaceURL(),i=n.getSecCtx(),s={};e=e+"/resources/xcadcomp/services/getsynchrostatus?tenant="+n.getPlatformId(),s.type="json",s.proxy="passport",s.method="POST",s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:i};let a=n.getWidgetId();return s.data={widgetId:a,ids:t.ids,enableXCADSyncJob:t.enableXCADSyncJob},o(e,s)},requestXCADSync:function(t){console.log("---XCADSync--calling requestXCADSync WS.......");let e=n.get3DSpaceURL(),i=n.getSecCtx(),s={};e=e+"/resources/xcadcomp/services/requestxcadsync?tenant="+n.getPlatformId(),s.type="json",s.proxy="passport",s.method="POST",s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:i};let a=n.getWidgetId();return s.data={widgetId:a,data:t},o(e,s)},isXCADSyncAuthorized:function(t){console.log("---XCADSync..calling isXCADSyncAuthorized.......");let e=n.get3DSpaceURL(),i=n.getSecCtx(),s={};e=e+"/resources/xcadcomp/services/getxcadsyncauth?tenant="+n.getPlatformId(),s.type="json",s.proxy="passport",s.method="POST",s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:i};let a=n.getWidgetId();return s.data={widgetId:a},o(e,s)},expandRequest:function(t){let e=n.get3DSpaceURL(),i=n.getSecCtx(),s={};return e+="/cvservlet/progressiveexpand/v2?output_format=cvjson&xrequestedwith=xmlhttprequest",s.type="json",s.proxy="passport",s.method="POST",s.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":"en","X-Requested-With":"XMLHttpRequest",SecurityContext:i},s.data=t,o(e,s)}}}),define("DS/ENOXCADSynchroStatus/cmd/RequestSyncCmd",["DS/ApplicationFrame/Command","DS/ENOXCADSynchroStatus/XCADWSProxy","DS/ENOXCADSynchroStatus/utils/XCADNotification","i18n!DS/ENOXCADSynchroStatus/assets/nls/ENOXCADSynchroStatus.json","DS/ENOXCADSynchroStatus/utils/Constants","DS/PADUtils/PADContext"],function(t,e,n,o,i,s){"use strict";var a,c;return t.extend({init:function(t){this._parent(t);var e=s.get(),n=e.options.model?e.options.model:e.getPADTreeDocument();n.getXSO().onPostAdd(this._check_select.bind(this)),n.getXSO().onPostRemove(this._check_select.bind(this)),n.getXSO().onEmpty(this._check_select.bind(this)),console.log("AFR Command XCADSync-init done->")},_check_select:function(){console.log("AFR Command XCADSync check-selection 1->"),!0===s.get().getPADTreeDocument().getXSO().get().length>0?this.enable():this.disable()},execute:function(){var t=this,e=s.get().getPADTreeDocument().getSelectedNodes();t.validateIsObjIndexed(e).then(function(i){i.errors?(n.errorMsg(o.indexing_failed_message),setTimeout(function(){n.clearNotifications()},2e3)):t.executeSyncStatus(e)}).catch(t=>{console.log(t)})},validateIsObjIndexed:function(t){var n=this;return new UWA.Promise(function(o,s){let a=t.filter(t=>t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_CATIAV5).map(t=>t.getID()),c=t.filter(t=>t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_3DEXP),r=[];c.forEach(t=>{r.push(t.getID());let e=t.getAllDescendants().filter(t=>t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_CATIAV5).map(t=>t.getID());r=[...e,...r]});let l=[...new Set([...a,...r])],u=n._buildExpandRequest(l);e.expandRequest(u).then(function(t){o(t)}).catch(()=>{s("Indexing Validation failed")})})},executeSyncStatus:function(t){var s=this;function r(t){let e=t.options.grid.hasSync;null!=e&&e!==i.STATUS_UNSYNC&&e!==i.STATUS_JOBFAIL&&e!==i.STATUS_NA||(s._buildDataInput(t,!1),p.push(t.options.resourceid)),S.push(t.options.resourceid)}a=[],c=[];let l=[],u=[],d=[],S=[],f=[],g=[],p=[],h=[],A=0,D=new Map,C=t.filter(t=>t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_3DEXP),m=t.filter(t=>!t.getParents().some(t=>C.includes(t))&&(t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_CATIAV5||t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_3DEXP)),y=[...new Map(m.map(t=>[t.options.resourceid+t.options.relationid,t])).values()],_=y.flatMap(t=>t.options.resourceid);for(let t in y)if(y[t].options.grid["ds6w:cadMaster"]===i.CADORIGIN_3DEXP)l.push(y[t].getID()),y[t].getAllDescendants().length>0&&u.push(...y[t].getAllDescendants().filter(t=>t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_CATIAV5));else if(y[t].isRoot())r(y[t]),y[t].options.grid.hasSync===i.STATUS_SYNC&&y[t].hasChildren()&&(l.push(y[t].getID()),y[t].getAllDescendants().length>0&&(u.push(y[t]),u.push(...y[t].getAllDescendants().filter(t=>t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_CATIAV5))));else if(y[t].options.grid.hasSync===i.STATUS_SYNC&&y[t].hasChildren())l.push(y[t].getID()),y[t].getAllDescendants().length>0&&(u.push(y[t]),u.push(...y[t].getAllDescendants().filter(t=>t.options.grid["ds6w:cadMaster"]===i.CADORIGIN_CATIAV5)));else{let e=y[t].getParents().filter(t=>_.includes(t.options.resourceid));if(e.length>0){let n=e.map(t=>t.options.resourceid);e.some(t=>null==t.options.grid.hasSync||t.options.grid.hasSync===i.STATUS_UNSYNC||t.options.grid.hasSync===i.STATUS_JOBFAIL||t.options.grid.hasSync===i.STATUS_NA)||f.includes(y[t].options.resourceid)?a.some(e=>e.id===y[t].options.resourceid)&&a.some(t=>n.includes(t.id))&&(a=a.filter(e=>!(e.id===y[t].options.resourceid))):r(y[t])}else S.includes(y[t].options.resourceid)||f.includes(y[t].options.resourceid)||r(y[t]);f.push(y[t].options.resourceid)}new Promise((t,n)=>{if(l.length>0){let n=s._buildExpandRequest(l);e.expandRequest(n).then(function(e){A=1;let n=e.results,o=n.filter(t=>t["ds6w:cadMaster"]===i.CADORIGIN_CATIAV5&&t.type!=i.CADORIGIN_3DSHAPE),c=n.filter(t=>t.type===i.CADORIGIN_3DSHAPE).flatMap(t=>t.resourceid);h=n.filter(t=>!c.includes(t.to)&&t.to);let r=[...h];for(let t=0;t<r.length;t++){let e=r[t].to,n=r[t].from,o=r.filter(t=>t.to===e).map(t=>t.from);null!=D.get(n)?null!=D.get(e)?D.set(e,[...new Set([...D.get(e),...D.get(n)])]):D.set(e,[...new Set([...o,...D.get(n)])]):D.set(e,o),r.splice(t,1),t--}D.forEach(function(t,e){let n=[];t.forEach(t=>{n.push(t),null!=D.get(t)&&(n=[...D.get(t),...n])}),n=[...new Set([...n])],D.set(e,n)}),g=[...new Set(h.map(t=>t.to))];const l=[...o];for(let t in l){let e;null!==(e=void 0!==h.find(e=>e.to===l[t].resourceid)?h.find(e=>e.to===l[t].resourceid).from:null)?d.includes(e)||d.includes(l[t].resourceid)||s._check3dExpNodeStatus(u,l[t],d):d.includes(l[t].resourceid)||s._check3dExpNodeStatus(u,l[t],d);let n=h.filter(e=>e.from===l[t].resourceid).map(t=>t.to);if(n.length>0)for(let e in n){let i=o.find(t=>t.resourceid===n[e]),c=l[t].resourceid,r=a.map(t=>t.id);d.includes(c)||d.includes(i.resourceid)?r.includes(c)&&r.includes(i.resourceid)?a=a.filter(t=>!(t.id===i.resourceid)):d.push(i.resourceid):s._check3dExpNodeStatus(u,i,d),l.splice(l.findIndex(t=>t.resourceid===n[e]),1)}}t()}).catch(()=>{throw"Expand request call failed"})}else t()}).then(()=>{if(console.log("AFR Command: XCADSync---Input to RequestSync WS: "+a),a.length>0){a.map(t=>t.id);for(let t in p)g.includes(p[t])&&!c.includes(p[t])&&(a=a.filter(e=>!(e.id===p[t])));let t=[...new Map(a.map(t=>[t.id,t])).values()];if(A){let e=t.map(t=>t.id);for(let t=0;t<e.length;t++){let n=e[t];null!=D.get(n)&&D.get(n).filter(t=>e.includes(t)).length>0&&(e.splice(t,1),t--)}e.length>0&&(t=t.filter(t=>e.includes(t.id)))}e.requestXCADSync(t).then(function(t){console.log("XCADSync-ReqJob--\x3e"+t);let e=t.status;if("success"===e){let e=t.message;n.sucessMsg(o[e])}else"failure"===e&&n.errorMsg(o.ReqJob_Failure)}).catch(function(t){console.error(t)})}else console.log("No job Creation required")}).catch(t=>{console.log(t)})},_buildDataInput:function(t,e){let n=null,o=null,i=null,s=null;e?(n=t.resourceid,o=t["ds6w:cadMaster"],i="",s=t["ds6w:label"]):(n=t.options.resourceid,o=t.options.grid["ds6w:cadMaster"],i=t.options.grid.hasSync,s=t.options.label),a.push({id:n,cadorigin:o,hasSync:i,title:s})},_check3dExpNodeStatus:function(t,e,n){if(t.length>0){let o=t.find(t=>t.options.resourceid===e.resourceid);if(null!=o){let t=o.options.grid.hasSync;null!=t&&t!==i.STATUS_UNSYNC&&t!==i.STATUS_JOBFAIL&&t!==i.STATUS_NA&&""!==t||(this._buildDataInput(o,!1),n.push(e.resourceid))}else this._buildDataInput(e,!0),n.push(e.resourceid)}else this._buildDataInput(e,!0),n.push(e.resourceid);c.push(e.resourceid)},_buildExpandRequest:function(t){let e={expands:[]};for(var n=0;n<t.length;n++){let o=s.get().GetFilterSpec(t[n],{V2:{prefixPathArray:[{physical_id_path:[t[n]]}]}});e.expands.push({label:"sync-command"+(new Date).getTime(),root:{physical_id:t[n]},filter:o.filter})}return{batch:e,outputs:{select_object:i.OBJECT_SELECTS,select_relation:i.REL_SELECTS,format:"entity_relation_occurrence"}}}})}),define("DS/ENOXCADSynchroStatus/utils/PlatformServices",["UWA/Class","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENOXCADSynchroStatus/utils/SettingsManagement","DS/ENOXCADSynchroStatus/utils/Constants","DS/WAFData/WAFData"],function(t,e,n,o,i){"use strict";return t.extend({initializePlatform:function(t){var i=this;e.getPlatformServices({onComplete:function(e){if(null===e){e.options=t,(0,t.onFailure)("cannot retrieve platform data")}else{for(var s=o.EMPTY_JSON_OBJECT,a=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",c=0;c<e.length;c++)e[c].platformId===a&&(i.platformurls=s.platformurls=e[c]);n.addSetting(o.PLATFORM_SERVICES,i),n.addSetting(o.PLATFORM_ID,a);let r=s.platformurls["3DSpace"];n.addSetting(o.URL_3DSPACE,r),s.options,(0,t.onComplete)(s)}},onFailure:function(e){(0,t.onFailure)(e)}})},get3DSpaceURL:function(){return this.getURL("3DSpace")},getURL:function(t){return this.platformurls[t]||""}})}),define("DS/ENOXCADSynchroStatus/AdditionalColumns",["i18n!DS/ENOXCADSynchroStatus/assets/nls/ENOXCADSynchroStatus.json","UWA/Core","UWA/Class","DS/ENOXCADSynchroStatus/utils/PlatformServices","DS/ENOXCADSynchroStatus/XCADWSProxy","DS/WebappsUtils/WebappsUtils","text!DS/ENOXCADSynchroStatus/assets/ENOXCADUXSettings.json","DS/ENOXCADSynchroStatus/utils/Constants","css!DS/ENOXCADSynchroStatus/ENOXCADSynchroStatus"],function(t,e,n,o,i,s,a,c){"use strict";return n.singleton({_columnDataIndex:["hasSync"],_columnDefDGV:{hasSync:{dataIndex:"hasSync",alignmentValue:"center",editableFlag:!1,sortableFlag:!1,width:50,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,getCellTypeRepresentation:function(t){if(t.nodeModel){let e=t.nodeModel.options.grid.hasSync;if(t.nodeModel.options.grid["ds6w:cadMaster"]===c.CADORIGIN_3DEXP)return"";if(void 0===e||""===e)return"status_Loading";return"status_"+e}},getCellSemantics:function(t){if(t.nodeModel)return{disabled:!0}},getCellValueForExport:function(e){let n="";if(-1===e.rowID)n=t.hasSync;else if(e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid.hasSync){let o=e.nodeModel.options.grid.hasSync;n=""+t["status_"+o]}return n},customisation:{dataIndex:"hasSync",exportable:{lock:!1,value:!0},layout:{removable:!1}}}},init:function(t){this._parent(t)},isAdditionalColumnsAvailable:function(t){if(console.log("XCADSync--isAdditionalColumnAvailable Enter--\x3e"),"function"!=typeof t)throw new Error("A callback function should be defined");const e=new o;new Promise(function(t,n){var o={onComplete:t,onFailure:n};e.initializePlatform(o)}).then(function(e){i.isXCADSyncAuthorized().then(function(e){console.log("XCADSync-Result of isXCADSyncAuthorized--\x3e"+e),"success"===e.status?t(!0):t(!1)}).catch(function(e){console.error(e),t(!1)})}),console.log("XCADSync-isAdditionalColumnAvailable Exit->")},getName:function(){return"ENOXCADSyncStatus_Col"},_getColumnName:function(){return t.hasSync},getManagedColumnNames:function(){return this._columnDataIndex},getAutoReloadNames:function(){let t=[];return t.push("ds6w:cadMaster"),t},toBeUpdated:function(t,e){let n=!1,o=t.hasSync;return t["ds6w:cadMaster"]!==c.CADORIGIN_3DEXP&&(e!==c.PSE_CONTEXT_REFRESH&&void 0!==o&&""!==o||(n=!0)),n},updateAttributes:function(t,e){if(console.log("XCADSync-updateAttrs Entry--\x3e"),"object"!=typeof t)throw new Error("The object ids to modify must be specify");if("function"!=typeof e)throw new Error("A callback function should be defined");var n={pids:{},relids:{}};t.pids.forEach(function(t){n.pids[t]={hasSync:void 0}});let o=JSON.parse(a).activateXCADSyncJobInfo.value;console.log("XCADSync-enableXCADSyncJob flag->"+o),i.getXCADSynchroStatus({ids:t.pids,enableXCADSyncJob:o}).then(function(o){console.log("XCADSync-updateAttrs WS Results->"+o);let i=new Map;o.forEach(function(t){let e=t.id,n=t.status;i.set(e,n)}),t.pids.forEach(function(t){let e="";i.has(t)&&(e=i.get(t)),n.pids[t]={hasSync:e}}),e(n)}).catch(function(o){console.error(o),t.pids.forEach(function(t){n.pids[t]={hasSync:"error"}}),e(n)})},getAdditionalColumnsUXDGV:function(t){let n=[];for(let e=0;e<t.length;e++)n.push(t[e].dataIndex);for(let o=0;o<this._columnDataIndex.length;o++){let i=this._columnDataIndex[o],s=e.clone(this._columnDefDGV[i]),a=n.indexOf(i);-1===a?(s.text=this._getColumnName(),t.push(s)):(t[a]=e.extend(t[a],s,!0),t[a].text=this._getColumnName())}},provideDisplayTooltip:function(e){let n=null;if(e.nodeModel&&"hasSync"===e.dataIndex){let o=e.nodeModel.options.grid.hasSync;if(""!=o&&"NA"!=o){n=t["status_"+o]}}return n},getTypeRepresentations:function(){return{status_Sync:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ok dgv-hasSync-status-ok",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_Unsync:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ko dgv-hasSync-status-ko",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JobRunning:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"hourglass dgv-hasSync-hourglass",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JobFail:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"attention dgv-hasSync-attention",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_NA:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_Loading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin dgv-hasSync-reload",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},getOnCellClickCB:function(t){}})});