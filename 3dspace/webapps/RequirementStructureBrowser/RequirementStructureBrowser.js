function RequirementStructureBrowser(e){var t={v1:{ap_custo:"ap_custo",ap_root_pids:"ap_root_pids",ap__root_pids_detached:"ap__root_pids_detached"}},n={widget:null,pad_app:null,home_app:null,paddebug:!1,lastStatus:{timer:null},setting_names:t.v1,enoreq_opts:{x3dAppId:null,widget:null,active_view:null,action_bar_opts:null,ReqTypesPrefOptions:null,layout:{title_update:!0,view_customization:null,store_roots_in_pref:!0,slidder:!1,root_panel:!0,drop_invite:"dynamic",padshell:!1},settings:null,authorize_setStructure:!0},closeActionbarOnStartup:!1,init:function(e){this.pcsPrefix=widget.id+"_"+widget.title,window.top.performance.mark(this.pcsPrefix+"_init"),this.widget=e.widget,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this))},onRefresh:function(){"StructureEditor"===this.active_view?this.req_component._onWidgetRefresh():this.trmModelEvents.publish({event:"welcome-panel-action-selected",data:{id:this.active_view}})},onLoad:function(){var e=this;localStorage.removeItem("PADTreeListDefinition.ENORERE_AP"),window.top.performance.mark(this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload"),require(["DS/PADUtils/Configuration","text!DS/RequirementStructureBrowser/assets/ENOREQComponentConf.json"],function(n,i){var r=JSON.parse(i);n.mergeConfig(r),require(["text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","UWA/Core","DS/PADUtils/PADSession","text!DS/RequirementStructureBrowser/assets/enoreq_settings.json","DS/HomePage/HomePage","text!DS/RequirementStructureBrowser/assets/ENOREQ.2D.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOTRMApp.json","DS/PADUtils/views/PADAlert"],function(n,i,r,o,s,a,l,u,c,d,p){window.top.performance.mark(e.pcsPrefix+"_require_infra_padutils"),window.top.performance.measure(e.pcsPrefix+"_require_infra",e.pcsPrefix+"_onload",e.pcsPrefix+"_require_infra_padutils");var f=JSON.parse(l),h=JSON.parse(n);JSON.parse(c);r.setApp(f.padsettings,"enoreq",!0),r.with_security_context=!0,e.widget.mergePreferences(r.getWidgetPreferences()),e.widget.addEvent("endEdit",e.onPreferencePanelClose.bind(e)),r.updateWidgetPreferences(),r.setSetting("add_objects_when_select",!1),r.setSetting("open_in_v5_v2",!1),r.setSetting("newCtxMenu",!0),r.setSetting("EditModeActivated",!0),r.setSetting("expandAllwithApplyFilter",!0),r.setSetting("local_preferences_file",{module:"ENOREQComponent",file:"ENOREQ.2D.json"}),r.setSetting("authorized_find_in_ctx_types",["Requirement Specification","Requirement","Chapter","Comment"]),r.setSetting("FedDictionnaryAccess",!1);r.setSetting("changeControlActivation",!0),r.setSetting("changeControlPosition","bottom-right");e.ReqTypesPrefOptions={types:h.Customized_types},e.widget.getValue("x3dSharedId")||e.widget.getValue("x3dAppId")||e.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"REQ_appId"}),e.widget.addPreference({name:"AddObjectOnReviseDuplicate",defaultValue:!0,type:"boolean",label:d.AddRevised_DuplicatedRootObject});var g=e._initializeENOREQComponent.bind(e);if(e.setting_names=t.v1,void 0===e.req_app){var m=e.enoreq_opts;m.x3dAppId=e.widget.getValue("x3dAppId"),m.widget=e.widget,m.lang=e.widget.lang,m.active_view=e.widget.getValue("default_view")?e.widget.getValue("default_view"):"treelistview",m.settings=f,m.layout.padshell=!0,g(m)}})})},onDestroy:function(){this.pad_app.destroy()},onPreferencePanelClose:function(){var e=require("DS/PADUtils/PADSettingsMgt");e.updateWidgetPreferences.bind(e);var t=self.widget.getPreferences();if(widget.hasOwnProperty("data")&&widget.data.hasOwnProperty("trm_security_ctx")){var n=require("DS/TraceableRequirementsUtils/Utils"),i=widget.getValue("trm_security_ctx");n.setXPrefCredentials(widget,i)}t.forEach(function(e){"useIndexAccleration"===e.name&&require("DS/PADUtils/PADSession").setUseIndexPreference(e.value)}),this.req_component.reqCommandProxy.preferenceModification({preferences:t,appId:widget.getValue("appId"),widgetId:widget.id})},onResize:function(e){var t=this;setTimeout(function(){var e=!1;null!==t.lastStatus.timer?e=Date.now()-t.lastStatus.timer>1e3:e=!0;if(e){t.lastStatus.timer=Date.now();var n=window.getComputedStyle(t.widget.body,null).getPropertyValue("width");n=parseInt(n.replace("px","")),t.pad_app&&t.pad_app.elements&&t.pad_app.elements.padslidder&&t.pad_app.elements.padslidder._updateMaxSizes(n)}},500)},_buildDOM:function(){var e=this;if(!e.elements){e.elements={};require(["DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable"],function(t){e.immersiveFrame=t.getImmersiveFrame();var n=e.elements.mainBody=document.createElement("div");e.elements.mainBody.classList.add("trm-root"),e.elements.mainBody.classList.add("trm-appMainBody"),e.elements.mainBody.style.position="absolute",e.elements.mainBody.style.height="100%",e.elements.mainBody.style.width="100%",e.immersiveFrame.setContentInBackgroundLayer(n),e.widget.setBody(e.immersiveFrame.getContent())})}},_initializeENOREQComponent:function(e){var t=this;e.closeActionbarOnStartup=t.closeActionbarOnStartup,window.top.performance.mark(t.pcsPrefix+"_require_padcomponent_before"),require(["DS/RequirementStructureBrowser/RequirementAppContext","UWA/Core","DS/TraceableRequirementsUtils/Services/RequirementUserPrefrences","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementSecurityCtxMgt","DS/TraceableRequirementsUtils/Services/RequirementTypeMgt","DS/PADUtils/PADUtilsServices","DS/HomePage/HomePage","DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable","DS/RequirementStructureBrowser/utils/TRMModelEvent"],function(n,i,r,o,s,a,l,u,c,d){var p=t.trmModelEvents=d.getModelEvents(),f=require("DS/RequirementStructureBrowser/utils/RequirementsConstant");t.active_view=widget.getValue(f.ACTIVE_VIEW);var h={modelEvents:p};o.app_initialization(function(){t._buildDOM(),widget.mergePreferences([{name:"trm_tv_addednodes",type:"hidden",defaultValue:""}]);widget.addPreference({name:"trm_tv_addednodes",type:"hidden",defaultValue:{},options:[]}),widget.setValue("trm_tv_addednodes",{}),s.addSecurityCtx2Preferences().then(function(){var i;i=new r,widget.displayNameSettings=i.getDisplayNamePref(),a.defineDefaultTypes(t.ReqTypesPrefOptions),a.initCsrfToken(),t.welcome=new u(h),t.welcome.initialize().then(function(){t.active_view&&""!==t.active_view||(t.active_view=f.PATH_RECENTS,t._setActiveView(t.activeBody,t.welcome))}),window.top.performance.mark(t.pcsPrefix+"_require_padcomponent_done"),window.top.performance.measure(t.pcsPrefix+"_require_padcomponent",t.pcsPrefix+"_require_padcomponent_before",t.pcsPrefix+"_require_padcomponent_done");var o=t._retrieveinitializationOpts(),s=UWA.extend(e,o);t.req_component=new n(s)})})})},_retrieveinitializationOpts:function(){var e=this;widget.addEvents({onSearch:function(t){e.req_component.search(t)},onResetSearch:function(){e.req_component.search()},onReady:function(){window.top.performance.mark(e.pcsPrefix+"_padcomponent_onready"),window.top.performance.measure(e.pcsPrefix+"_padcomponent_ready",e.pcsPrefix+"_require_padcomponent_done",e.pcsPrefix+"_padcomponent_onready"),e.req_app=this;var t=e.widget.getValue("useIndexAccleration");require("DS/PADUtils/PADSession").setUseIndexPreference(t);var n=require("DS/RequirementStructureBrowser/utils/TRMModelEvent").getModelEvents();function i(){var t=e.widget.getPreference("dnd"),n=t?t.value:"MOVE";e.req_component.setDnDBehavior(n)}i();var r=require("DS/RequirementStructureBrowser/utils/RequirementsConstant");e.req_component.addEvent("onToggleView",function(t){e.widget.setValue("default_view",t)}),e.widget.addEvent("endEdit",i),e.req_component._initWorkUnderChange(e.elements.mainBody),n.subscribe({event:"welcome-panel-active-view"},function(t){e.active_view!==r.VIEW_STRUCTURE_BROWSER&&(e.req_component.previous_view=e.active_view),e.req_component.active_view=e.active_view=t.id,widget.setValue(r.ACTIVE_VIEW,t.id)}),n.subscribe({event:r.CREATE_ROOT_OBJECT},function(t){e.req_component.createRootobjects(t)}),n.subscribe({event:"TRMViews-WelcomePanel-updateStoredObjects"},function(t){var i=UWA.clone(t.item2remove),r=[],o=e.req_component.PersistencyManager.getUserWorkingNodeIDs();"null"===o&&(o=null);var s=!1;let a=o.length;if(Array.isArray(o))for(var l=0;l<a;l++){var u=o.indexOf(i[l]);o&&-1!==u&&(r.push(i[l]),o.splice(u,1),s=!0)}s&&e.req_component.PersistencyManager.saveUserWorkingRootNodes(o);var c=e.req_component.PersistencyManager.getRecentItems();if(UWA.is(c,"string")){var d=c.trim().split(",");let e=d.length;for(l=0;l<e;l++)if(d&&-1!==d.indexOf(i[l])){u=d.indexOf(i[l]);d.splice(u,1)}c=d.toString()}e.widget.setValue("UserRecentItem",c),r.length&&n.publish({event:"TRMViews-WelcomePanel-removeFromView",data:{item2remove:r}})}),n.subscribe({event:"TRMViews-WelcomePanel-OpenStructure"},function(t){e.req_component.launchStructureBrowser(t),n.publish({event:"welcome-panel-active-view",data:{id:r.VIEW_STRUCTURE_BROWSER}})}),n.subscribe({event:"TRMViews-WelcomePanel-removeFromView"},function(t){var n=t.item2remove,i=n?n.length:0,r=e.req_component.getPADTreeDocument();r.withTransactionUpdate(function(){for(var e=0;e<i;e++){var t=r.searchRootById(n[e]);t&&r.removeRoot(t)}})}),n.subscribe({event:"TRMViews-WelcomePanel-activate"},function(t){e._setActiveView("welcomePanel",e.welcome),e.req_component.previous_view&&""!==e.req_component.previous_view||(e.req_component.previous_view=r.PATH_RECENTS,e.active_view!==r.VIEW_STRUCTURE_BROWSER&&(e.req_component.previous_view=e.active_view)),n.publish({event:"welcome-panel-action-selected",data:{id:e.req_component.previous_view}})}),n.subscribe({event:"TRMViews-WelcomePanel-closeLandingPage"},function(){e._setActiveView("container",e.req_component.elements.container),n.publish({event:"welcome-panel-active-view",data:{id:r.VIEW_STRUCTURE_BROWSER}})}),n.publish({event:"TRMViews-WelcomePanel-loadData"});var o=e.widget.getValue("X3DContentId");if(UWA.is(o)){var s=UWA.is(o,"string")?JSON.parse(o):o;e.req_component.addNodesFromContent(s,{callback:function(){e.widget.deleteValue("X3DContentId")}})}window.top.performance.mark(e.pcsPrefix+"_app_load_complete")},onSaveRoots:function(){var t=[],n=[],i=e.req_app.getPADTreeDocument();i.getRoots().forEach(function(e){t.push(e.getID())}),i.hasOwnProperty("detachedRoots")&&i.detachedRoots.forEach(function(e){n.push(e.getID()),-1===t.indexOf(e.getID())&&t.push(e.getID())}),widget.setValue(e.setting_names.ap_root_pids,JSON.stringify(t)),widget.setValue(e.setting_names.ap__root_pids_detached,JSON.stringify(n))},onRootsVisibility:function(){var t=[],n=e.req_app.getPADTreeDocument();n.hasOwnProperty("detachedRoots")&&n.detachedRoots.forEach(function(e){t.push(e.getID())}),widget.setValue(e.setting_names.ap__root_pids_detached,JSON.stringify(t))},onCustoViewChange:function(t){widget.setValue(e.setting_names.ap_custo,encodeURIComponent(JSON.stringify(t)))},onSaveAsTemplate:function(t){widget.setValue(e.setting_names.ap_custo,encodeURIComponent(JSON.stringify(t))),require(["DS/PADUtils/PADWSAccess"],function(e){e.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId"),value:encodeURIComponent(JSON.stringify(t)),onComplete:function(e){console.log("Saved as template")},onFailure:function(e){console.warn("Cannot save customization template")}})})},onAuthoringCtxAvailable:function(t){if(!0===t.isLicenseValid){var n=require("DS/PADUtils/PADSettingsMgt"),i=n.getSetting("changeControlActivation"),r=n.getSetting("changeControlPosition");e.widget.addPreference({name:"changeControlActivation",defaultValue:i,type:"hidden",label:"changeControlActivation_label"}),e.widget.addPreference({name:"changeControlPosition",defaultValue:r,type:"hidden",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]}),require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e){!0===n.getSetting("changeControlActivation")?e.show():e.hide()}),n.addEvent("onChangeControlActivation",function(t){var n=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");e.debouncePrefSynchro?e.debouncePrefSynchro=!1:e._proxy.preferenceModification({name:"changeControlActivation",value:t}),!0===t?n.show():n.hide()}),n.addEvent("onChangeControlPosition",function(e){require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").setPosition(e)})}}})},_setActiveView:function(e,t){var n;(this.initDiv||(this.initDiv={}),void 0===e&&(e="default-"+Date.now()),this.previousBody=this.activeBody,this.activeBody=e,!0!==this.initDiv[e])&&(this.elements[e]||(this.elements[e]=document.createElement("div"),this.elements[e].classList.add("trm-"+e),this.elements[e].classList.add("trm-div"),this.elements.mainBody.appendChild(this.elements[e])),"function"==typeof t.render?(n=t.render(),this.initDiv[e]=!0):n=t,this.elements[e].appendChild(n));this._showActiveView(e)},_showActiveView:function(e){for(var t=Object.keys(this.elements),n=0;n<t.length;n++)e===t[n]?this.elements[t[n]].classList.remove("trm-hidden"):"mainBody"!==t[n]&&this.elements[t[n]].classList.add("trm-hidden")}};return n.init(e),n}define("DS/RequirementStructureBrowser/utils/REQExporter",["i18n!DS/PADUtils/assets/nls/PADUtils","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst","UWA/Class","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADUtilsServices","DS/PADUtils/Utility"],function(e,t,n,i,r,o,s,a){"use strict";var l='<table style="border:1px solid black; border-collapse:collapse;">',u="</table><br/>",c='<th style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:.8em; padding-top:5px; paddingbottom:4px;word-break:break-word;display:table-cell;">',d="</th>",p="<tr>",f="</tr>",h="<td>",g="</td>";!function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},t=/[&<>"'\/]/g,n=/[<>\/]/g;function i(t){return e[t]}}();function m(e,t,n){for(var i=e.length,r=0;r<i;r++){n(t,e[r],r)}}function v(e){return""+e}function _(e){return'"'+e+'"'}function S(e,t){var n=e.options.grid[t];return a.convertDateTime(n)}function b(e,t){return"tree"===e?t.options.label:UWA.is(w.customizedColumnRenderers[e],"function")?w.customizedColumnRenderers[e](t):UWA.is(t.options.grid[e],"string")?t.options.grid[e]:UWA.is(t.options.grid[e],"number")?v(t.options.grid[e]):""}function C(e,t,n){var i=[];i.push(v(n.getDepth())),i.push(b("tree",n)),m(t,null,function(e,t){var r=t.customisation?t.customisation:t.xnav_options,o=UWA.is(r)?r.kind:void 0;if(o)switch(o){case"date":i.push(S(n,t.dataIndex));break;default:i.push(b(t.dataIndex,n))}else i.push(b(t.dataIndex,n))}),e.rows.push(i)}function y(t,n){var i={columns:[],tables:[]},r=(t.columnManager.getAvailableColumns(),t.columnManager.getVisibleColumns());m(r,null,function(e,t){var i=t.customisation?t.customisation:t.xnav_options,r=!(!i||!i.exportable)&&i.exportable.value;if(void 0!==r&&!r){var o=t.dataIndex;-1===n.indexOf(o)&&n.push(o)}});var o={kept:[],tree:null};return m(r,o,function(e,t){"tree"===t.dataIndex?e.tree=t:e.kept.push(t)}),i.columns.push(e.export_level),i.columns.push(o.tree.text),m(o.kept,i,function(t,n){t.columns.push(function(t){var n=t.text;if(""===n||null==n){var i="treelistview_customization_"+t.dataIndex;n=UWA.is(e[i])?e[i]:t.dataIndex}return n}(n))}),m(t.options.model.getRoots(),i,function(e,t){var n=null;t.isVisible()&&(n={rows:[]},e.tables.push(n),C(n,o.kept,t),t.processDescendants({processNode:function(){this.isVisible()&&C(n,o.kept,this)}}))}),i}function R(){this._str=""}function E(e){var t=e||{};this._debug=!0===t.debug,this._builder=new R}function A(){this._builder=new R}R.prototype={CRLF:"\r\n",append:function(e){this._str+=e+""},appendCRLF:function(){this._str+=this.CRLF},toString:function(){return this._str}},E.prototype={render:function(e){var t=this;return this.appendCRLF(),m(e.tables,e.columns,function(e,n){t._builder.append(l),t._builder.append("<thead><tr>"),t.appendCRLF(),m(e,null,function(e,n){t._builder.append(c),t._builder.append(n),t._builder.append(d)}),t.appendCRLF(),t._builder.append("</tr></thead>"),t._builder.append("<tbody>"),m(n.rows,null,function(e,n){t.appendCRLF(),t._builder.append(p),m(n,null,function(e,n){t._builder.append(h),t._builder.append(n),t._builder.append(g)}),t._builder.append(f)}),t.appendCRLF(),t._builder.append("</tbody>"),t._builder.append(u)}),this._builder.toString()},appendCRLF:function(){this._debug&&this._builder.appendCRLF()}},A.prototype={getSeperatorCharacter:function(e){var t="";switch(e){case"Semicolon":t=";";break;case"Comma":t=",";break;default:t=","}return t},renderHeaders:function(e,t){var n=e.length-1,i=this.getSeperatorCharacter(t);m(e,this,function(e,t,r){e._builder.append(_(t)),r!==n&&e._builder.append(i)}),this._builder.appendCRLF()},renderTables:function(e,t,n){var i=this,r=this.getSeperatorCharacter(n);m(e,null,function(e,t){m(t.rows,null,function(e,t){var n=t.length-1;m(t,null,function(e,t,o){i._builder.append(_(t)),o!==n&&i._builder.append(r)}),i._builder.appendCRLF()})})},render:function(e,t){return this._builder.append("\ufeff"),this.renderHeaders(e.columns,t),this.renderTables(e.tables,e.columns,t),this._builder.toString()}};var w={customizedColumnRenderers:{"ds6w:created":function(e){return S(e,"ds6w:created")},"ds6w:modified":function(e){return S(e,"ds6w:modified")},"ds6w:reserved":function(e){var n=e.options.grid["ds6w:reserved"];return n&&"true"===n.toLowerCase()?t.tooltip_reserved:t.tooltip_unreserved}},options:{columns_to_remove:["tree","find_in_ctx","hide_show","bi_color"],csv_base_file_name:t.csv_base_file_name}};return n.singleton({printHtml:function(e){var t=y(e.context,w.options.columns_to_remove.slice()),n=(new E).render(t);s.printhtml(n)},generateCsv:function(e){var t=e.context.getActiveDGV();e.csv_base_file_name&&(w.options.csv_base_file_name=e.csv_base_file_name);var n=t.getAsCSV();s.downloadfile(n,w.options.csv_base_file_name+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")},exportForRMC:function(e,t){require(["DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json"],function(t,n){var a=e;t.getAllStructure({securityContext:o.getSecurityContext(),pid:a,onComplete:function(e){var t=(e=UWA.is(e,"string")?JSON.parse(e):e).Seperator;e=e.ObjectArray;var i=JSON.parse(n).attributes_exportRMC,r={columns:[],tables:[]};for(var o in i)i.hasOwnProperty(o)&&r.columns.push(i[o]);var a={rows:[]};e.forEach(function(e){e.forEach(function(e){var t=[];for(var n in i){var r=n.replace("attribute_",""),o=document.createElement("textarea");o.innerHTML=e[r],e[r]=o.value.replace(/"/g,'""'),e.hasOwnProperty(r)?t.push(e[r]):t.push("")}a.rows.push(t)});a.rows.push([])}),r.tables.push(a);var l=(new A).render(r,t);s.downloadfile(l,w.options.csv_base_file_name+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")},onFailure:function(e,t){var n=r.getParseErrorMessage(e,t);i.errorAlert(n)},onTimeout:function(e){var t=r.getParseErrorMessage(e);i.errorAlert(t)}})})},generateRenderStruct:y})}),define("DS/RequirementStructureBrowser/components/RequirementContextualMenu",["UWA/Core","UWA/Class","DS/ApplicationFrame/CommandsManager","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/TraceableRequirementsUtils/REQClipboard","DS/WebappsUtils/WebappsUtils","DS/RichView/Command/CreateLinkAction","DS/RichView/Command/CtxMenu_StartLinkCmd","DS/RichView/Command/CtxMenu_EndLinkCmd","DS/RichView/Command/DeleteLinkAction","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOTRMApp","i18n!DS/CfgWebAppEffectivityUX/assets/nls/CfgEffectivityNLS","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils"],function(e,t,n,i,r,o,s,a,l,u,c,d,p,f,h){"use strict";var g=function(){};return g.prototype._getContextualMenu=function(e){var t=[],r=this;if(r.externalProviders=e.externalProviders,null!==e){"noExpandState"!==e._expandState&&(t.push({title:i.PAD_CMDExpandAll,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",type:"PushItem",action:{callback:r._expandAll.bind(r)}}),t.push({title:i.PAD_CMDCollapseAll,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",type:"PushItem",action:{callback:r._collapseAll.bind(r)}}),t.push({type:"SeparatorItem"}));var s=f.get(),a=s.getSelectedNodes(),l=s.getSetting("root_type");1==a.length&&l.indexOf(a[0].getKindOf())>-1&&r.CopyLink(t),t.push({title:i.PAD_CMDProperties,icon:"url("+o.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",action:{callback:r._editProperties.bind(r)}}),e.isRoot()||r.detachCommand(t);var u=h.getKindOf(e.options.reqKindOf)||e.options.reqKindOf;"Requirement"===u&&(e.options.externalObject?r.AddRequirementCommand(t):(e.isRoot()||r.Appendnewcommand(t),r.InsertnewcommandReq(t),r.CreateExternalRequirementCommand(t),r.InsertExternalRequirementCommand(t),r.InsertExistingRequirementCommand(t),r.insertParameterCommand(t),t.push({title:c.StartLink,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/DerivedRequirementStartLink.png")+")",type:"PushItem",action:{context:e,callback:r._startLink.bind(r)}}),t.push({title:c.EndLink,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/DerivedRequirementEndLink.png")+")",type:"PushItem",action:{context:e,callback:r._endLink.bind(r)}}),t.push({name:"linkManagement",title:d.ENOTRMApp_Cmd_DeleteLink,icon:"",data:"",type:"PushItem",action:{context:e,callback:r._linkManagement.bind(r)}}))),"Chapter"===u&&(r.Appendnewcommand(t),r.Insertnewcommand(t)),"Requirement Specification"!==u&&"DOCUMENTS"!==u||(e.isRoot()||r.AppendnewcommandSPF(t),r.Insertnewcommand(t)),"Requirement Group"===u&&(e.isRoot()||r.AppendnewcommandSPF(t),r.InsertnewcommandSPF(t),r.insertInsertExistingCommandSPF(t)),"Comment"===u&&r.Appendnewcommand(t),"Comment"!=u&&"Requirement"!=u&&"PlmParameter"!=u&&"PARParameter"!=u&&"Requirement Group"!=u&&r.insertInsertExistingCommand(t),"PlmParameter"!=u&&"PARParameter"!=u&&(t.push({type:"PushItem",title:c.CMDCopy,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_Copy.png")+")",state:n.getCommand("Copy")._isEnabled?"enabled":"disabled",action:{context:e,callback:function(){r._launchAction({command:"Copy"})}}}),t.push({type:"PushItem",title:c.CMDCut,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_Cut.png")+")",state:n.getCommand("Cut")._isEnabled?"enabled":"disabled",action:{context:e,callback:function(){r._launchAction({command:"Cut"})}}}),t.push({type:"PushItem",title:c.CMDPaste,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_Paste.png")+")",state:n.getCommand("Paste")._isEnabled?"enabled":"disabled",action:{context:e,callback:function(){r._launchAction({command:"Paste"})}}}),r.CopyPasteEffectiviy(t))}return t},g.prototype._startLink=function(e){var t=e.context;this._startLinkCmd=new a;var n={id:t.getID(),physicalId:t.getID(),type:t.options.type,kindof:t.options.reqKindOf,typeNls:t.options.grid["ds6w:type"],path:t.getOccurencePath(null,!0),title:t.options.label};this._startLinkCmd.execute(n)},g.prototype._endLink=function(e){var t=f.get().getSelectedNodes();if(this._endLinkCmd=new l({container:".pad_view_container"}),null!=t&&null!=t&&0!=t.length){for(var n=Array(),i=0;i<t.length;i++){var r=t[i],o="";r.options.hasOwnProperty("kindof")?o=r.options.kindof:r.options.hasOwnProperty("reqKindOf")&&(o=r.options.reqKindOf);r.getID();var s=r.getID(),a=r.options.grid["ds6w:type"],u={id:s,physicalId:s,type:r.options.type,typeNls:a,kindof:o,path:r.getOccurencePath(null,!0),title:r.options.label};n.push(u)}this._endLinkCmd.execute(n)}},g.prototype._linkManagement=function(e){var t=e.context;u._initialized||(this._deleteLinkAction=u.init({context:this,renderTo:".structure-details"}));var n={physicalid:t.getID(),type:t.options.type,name:t.options.label};this._deleteLinkAction.execute(n)},g.prototype.AddRequirementCommand=function(e){var t=this;e.push({title:c.AddRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewRequirement"})}}})},g.prototype.CreateExternalRequirementCommand=function(e){if(this.externalProviders){var t=this;e.push({type:"PushItem",title:c.InsertNewExtReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",submenu:[{type:"PushItem",title:c.ExternalSubReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"CreateExternalSubRequirement"})}}},{type:"PushItem",title:c.ExternalDerivedReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"CreateExternalDerRequirement"})}}}]})}},g.prototype.InsertExternalRequirementCommand=function(e){if(this.externalProviders){var t=this;e.push({type:"PushItem",title:c.InsertExistExtReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",submenu:[{type:"PushItem",title:c.ExternalSubReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"InsertExternalSubRequirement"})}}},{type:"PushItem",title:c.ExternalDerivedReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"InsertExternalDerRequirement"})}}}]})}},g.prototype.Appendnewcommand=function(e){var t=this;e.push({type:"PushItem",title:c.AddNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:c.AddComment,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewComment.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewComment"})}}},{title:c.AddChapter,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewChapter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewChapter"})}}},{title:c.AddRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewRequirement"})}}}]})},g.prototype.AppendnewcommandSPF=function(e){var t=this;e.push({type:"PushItem",title:c.AddNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:c.AddRequirementSpecification,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirementSpecification.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewRequirementSpecification"})}}},{title:c.AddSpecificationFolder,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewSpecificationFolder.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewSpecificationFolder"})}}}]})},g.prototype.InsertnewcommandReq=function(e){var t=this;e.push({type:"PushItem",title:c.InsertNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:c.InsertRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertRequirement"})}}}]})},g.prototype.Insertnewcommand=function(e){var t=this;e.push({type:"PushItem",title:c.InsertNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:c.InsertRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertRequirement"})}}},{title:c.InsertChapter,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubChapter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertChapter"})}}},{title:c.InsertComment,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubComment.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertComment"})}}}]})},g.prototype.InsertnewcommandSPF=function(e){var t=this;e.push({type:"PushItem",title:c.InsertNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:c.InsertRequirementSpecification,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubRequirementSpecification.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertRequirementSpecification"})}}},{title:c.InsertSpecificationFolder,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubSpecFolder.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertSpecificationFolder"})}}}]})},g.prototype.CopyPasteEffectiviy=function(e){var t=this;e.push({type:"PushItem",title:c.Copy_Paste_Effectivity,submenu:[{title:p.CFG_COPY_VARIANT_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Copy_Variant_Effectivity.png")+")",state:t._checkActionCmdState("CopyVariantEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"CopyVariantEffectivity"})}}},{title:p.CFG_PASTE_VARIANT_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Paste_Variant_Effectivity.png")+")",state:t._checkActionCmdState("PasteVariantEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"PasteVariantEffectivity"})}}},{title:p.CFG_COPY_EVOLUTION_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Copy_Evolution_Effectivity.png")+")",state:t._checkActionCmdState("CopyEvolutionEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"CopyEvolutionEffectivity"})}}},{title:p.CFG_PASTE_EVOLUTION_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Paste_Evolution_Effectivity.png")+")",state:t._checkActionCmdState("PasteEvolutionEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"PasteEvolutionEffectivity"})}}}]})},g.prototype.insertInsertExistingCommand=function(e){var t=this;e.push({title:c.InsertExisting,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingObject.png")+")",type:"PushItem",submenu:[{title:c.InsertExistingRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExisting.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingRequirement"})}}},{title:c.InsertExistingChapter,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingChapter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingChapter"})}}},{title:c.InsertExistingComment,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingComment.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingComment"})}}}]})},g.prototype.insertInsertExistingCommandSPF=function(e){var t=this;e.push({title:c.InsertExisting,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingObject.png")+")",type:"PushItem",submenu:[{title:c.InsertExistingRequirementSpecification,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingReqSpec.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingRequirementSpecification"})}}},{title:c.InsertExistingSpecificationFolder,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingSpecFolder.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingSpecificationFolder"})}}}]})},g.prototype.InsertExistingRequirementCommand=function(e){var t=this;e.push({title:c.InsertExisting,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingObject.png")+")",type:"PushItem",submenu:[{title:c.InsertExistingRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExisting.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingRequirement"})}}}]})},g.prototype.insertParameterCommand=function(e){var t=this;e.push({title:c.insertParameterCommand,icon:"url("+o.getWebappsAssetUrl("PARParameterCommands","icons/32/I_AddParameter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"ActionBar_Parameters"})}}})},g.prototype.detachCommand=function(e){var t=this;e.push({title:c.DetachCommand,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdDetach.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"Detach"})}}})},g.prototype._expandAll=function(){this._launchAction({command:"ExpandAll"})},g.prototype._collapseAll=function(){this._launchAction({command:"CollapseAll"})},g.prototype._editProperties=function(){this._launchAction({command:"ActionBar_Attributes"})},g.prototype._checkActionCmdState=function(e){var t="enable",i=n.getCommand(e);return null!=i&&(i._checkSelection(),0==i._isEnabled&&(t="disabled")),t},g.prototype._launchAction=function(e){var t=n.getCommand(e.command,widget);null==t&&(t=n.getCommand(e.command)),t&&t.begin()},g.prototype.CopyLink=function(e){var t=this;e.push({title:c.CopyLink,typeRepresentation:"functionIcon",icon:{iconName:"link",fontIconFamily:1},type:"PushItem",action:{callback:function(){t._launchAction({command:"CopyLink"})}}})},g}),define("DS/RequirementStructureBrowser/requirementServices/TRMPersistencyManager",["UWA/Core","UWA/Class","UWA/Class/Promise"],function(e,t,n){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){e.PersistencyManager=e.PersistencyManager=this,this.app=e,this._isWidgetRefreshing=null},saveUserSelectedNodes:function(e){var t,n=[];e.forEach(function(e){t=e.getID(),n.push(t)}),widget.setValue("selectedNodeIDs",n)},saveUserWorkingRootNodes:function(e){e=0===e.length?"":e.toString(),widget.setValue("workingNodeIDs",e)},addRecentItem:function(e){var t=this.getRecentItems(),n="";if(t&&(n=t.replace(new RegExp('"',"g"),"")),e&&!(e.length<3)&&0!==n.indexOf(e)){var i=this.updateRecentsList(n,e);i&&widget.setValue("UserRecentItem",i)}},updateRecentsList:function(t,n){if(!e.is(n))return console.log("error for recent id"),null;var i=null;for(i=t&&""!==t.trim()?t.trim().split(","):[];-1!==i.indexOf(n);){var r=i.indexOf(n);i.splice(r,1)}return i.length>=20?(i.pop(),i.unshift(n),i.join()):(i.unshift(n),i.join())},getUserSelectedNodeIDs:function(){return widget.getValue("selectedNodeIDs")},getRecentItems:function(){return widget.getValue("UserRecentItem")},getUserWorkingNodeIDs:function(){var e=widget.getValue("workingNodeIDs");return Array.isArray(e)||(e=e?e.split(","):""),e},setWidgetRefreshStatus:function(e){this._isWidgetRefreshing=e},getWidgetRefreshStatus:function(){return this._isWidgetRefreshing},getNGFilter:function(){return widget.getValue("NGFilter")},setNGFilter:function(e){widget.setValue("NGFilter",e)},resetNGFilter:function(){widget.deleteValue("NGFilter")}})}),define("DS/RequirementStructureBrowser/utils/TRMMask",["UWA/Core","DS/UIKIT/Spinner","i18n!DS/UIKIT/assets/nls/UIKIT"],function(e,t,n){"use strict";return{mask:function(i,r){var o;this.isMasked(i)&&this.unmask(i),i.addClassName("masked"),o=e.createElement("div",{class:"mask"}),r=e.is(r,"string")?r:n.loading,r=e.createElement("div",{class:"mask-wrapper",html:{tag:"div",class:"mask-content",html:[new t({visible:!0,animate:!0,spin:!0}),e.createElement("span",{class:"text",text:r})]}}).inject(o),o.inject(i)},unmask:function(e){var t=e.getElement(" > .mask");t&&t.destroy(),e.removeClassName("masked")},isMasked:function(e){return e.hasClassName("masked")}}}),define("DS/RequirementStructureBrowser/utils/UpdateSearchView",["UWA/Class","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils.json"],function(e,t,n,i){const r=function(e){let t=this;null!==t._pagerview&&("previous"==e.event&&(t._selectedIdx--,o.call(this)),"next"==e.event&&(t._selectedIdx++,o.call(this)),"selectAll"==e.event&&(t.select_on=!0,t._pagerview.elements.selectButton.addClassName("TRMSearchNavSelectButtonActive"),t._matchedNodes.forEach(function(e){let n=t.options.model.getNodesByRelId(e);(n=n||t.options.model.getNodesById(e))&&n.forEach(function(e){e.select()})})),"unSelectAll"==e.event&&(t.select_on=!1,t.getActiveDGV().unselectAll(),t._pagerview.elements.selectButton.removeClassName("TRMSearchNavSelectButtonActive"),o.call(this)))},o=function(){let e=this;-1===e._selectedIdx&&(e._selectedIdx=e._matchedNodes.length-1);let t=e._selectedIdx%e._matchedNodes.length;if(e._pagerview){let n=t+1+"/"+e._matchedNodes.length;e._pagerview.setLabel(n)}e.options.model.getSelectedNodes().forEach(function(e){e.unselect()});let n=e.options.model.getNodesByRelId(e._matchedNodes[t]);(n=n.length?n:e.options.model.getNodesById(e._matchedNodes[t]))&&n.forEach(function(t){t.select();let n=e.getActiveDGV(),i=n.layout.getRowPosition(t._rowID);n.setScrollerPosition({y:i})})};return e.singleton({executeViewUpdate:function(e){let s=this,a=[],l=e.searchResultsAll,u=l.sortedNodes;u&&l.matchedNodes&&l.matchedNodes.length?(u.forEach(e=>{t.traverseTree(e,l.matchedNodes,a)}),s.focusChange=r,s.reframeOn=o,e.maxLimitOfSearchReached&&n.warningAlert(i.SearchInWidget_maxLimitReached),a&&a.length?t.displayTRMSearchNav.call(s,a):(s._pagerview&&s._pagerview.hide(),n.notifyAlert(i.SearchWithInDashboard_OccurrenceNotFound))):(s._pagerview&&s._pagerview.hide(),n.notifyAlert(i.SearchWithInDashboard_OccurrenceNotFound))}})}),define("DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable",["UWA/Class","DS/Windows/ImmersiveFrame"],function(e,t){"use strict";var n;return e.singleton({getImmersiveFrame:function(){return n||this.createImmersiveFrame(),n},createImmersiveFrame:function(){n&&UWA.is(n.destroy,"function")&&(n.destroy(),n=void 0),n=new t({})}})}),define("DS/RequirementStructureBrowser/components/RequirementStatusInfos",["css!DS/RequirementStructureBrowser/RequirementStructureBrowser","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Drivers/Alone","DS/Logger/Logger","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","DS/UIKIT/Tooltip","DS/Controls/Loader","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADSession"],function(e,t,n,i,r,o,s,a,l,u,c){"use strict";var d=n.extend(i,{name:"pad_status",_logger:null,_tooltipInfo:null,init:function(e){this._logger=o.getLogger(d),this._logger.log("init"),this._parent(e),e.withProgress?(this.elements.container=UWA.createElement("div",{class:this.getClassNames()+" with_progress"}),this.elements.loaderContainer=UWA.createElement("div",{class:"pad_status_loader_div"}).inject(this.elements.container),this._loader=(new l).inject(this.elements.loaderContainer),this.elements.fonticonInfoContainer=UWA.createElement("div",{class:"pad_status_fonticon_info_div"}).inject(this.elements.container),this.elements.fonticonInfo=UWA.createElement("i",{class:"fonticon fonticon-info pad_status_span"}).inject(this.elements.fonticonInfoContainer),this._tooltipInfo=new a({className:this.getClassNames("_tooltipInfo"),target:this.elements.container,position:"top",trigger:"touch",events:e.events}),this.elements.fonticonAttentionContainer=UWA.createElement("div",{class:"pad_status_fonticon_attention_div"}).inject(this.elements.container),this.elements.fonticonAttention=UWA.createElement("i",{class:"fonticon fonticon-attention pad_status_span"}).inject(this.elements.fonticonAttentionContainer),this._tooltipAttention=new a({className:this.getClassNames("_tooltipAttention"),target:this.elements.fonticonAttention,position:"top left",trigger:"touch",events:e.events}),this.getOption("status")&&this._tooltipInfo.setBody(this.getOption("status")),this.getOption("renderTo")&&this.inject(this.getOption("renderTo")),this.getOption("attention")&&this._tooltipAttention.setBody(this.getOption("attention")),this.showLoader=function(e){if(e){var t=this;this._isloading=!0,t._loadingText=e.nlsTooltip,setTimeout(function(){!0===t._isloading&&t._loader&&(t._loader.on(),t.elements.fonticonInfoContainer.style.display="",t.elements.fonticonAttentionContainer.style.display="none",e.fonticon&&(t._replacedFonticon=e.fonticon,t.elements.fonticonInfo.removeClassName("fonticon-info"),t.elements.fonticonInfo.addClassName(e.fonticon)),t._addLoading(),!1===t._tooltipInfo.isVisible&&t._tooltipInfo.toggle())},e.timeout?e.timeout:0)}else this._loader&&(this._loader.on(),this.elements.fonticonInfoContainer.style.display="",this.elements.fonticonAttentionContainer.style.display="none")},this.hideLoader=function(e){this._isloading=!1,this._loader&&(this._loader.off(),e&&!0===e.memoryFull&&(this.elements.fonticonAttentionContainer.style.display="",this.elements.fonticonInfoContainer.style.display="none")),!0===this._tooltipInfo.isVisible&&this._tooltipInfo.toggle(),this.elements.fonticonInfo.addClassName("fonticon-info"),this.elements.fonticonInfo.removeClassName(this._replacedFonticon),this._removeLoading()},this.elements.fonticonAttentionContainer.style.display="none"):(this.elements.container=UWA.createElement("span",{class:this.getClassNames()+" fonticon fonticon-info"}),this._tooltipInfo=new a({className:this.getClassNames("_tooltipInfo"),target:this.elements.container,position:"top left",trigger:"touch",events:e.events}),this.getOption("status")&&this._tooltipInfo.setBody(this.getOption("status")),this.getOption("renderTo")&&this.inject(this.getOption("renderTo")))},setStatus:function(e){this._tooltipInfo.setBody(e),this._isloading&&this._addLoading()},_addLoading:function(){var e=this._tooltipInfo.getBody(),t=UWA.createElement("div",{id:"loadingTooltip",text:this._loadingText});null===e.querySelector("loadingTooltip")&&t.inject(e)},_removeLoading:function(){var e=this._tooltipInfo.getBody().querySelector("loadingTooltip");null!==e&&e.remove(e)}});return d.buildStatus=function(e){var t=UWA.createElement("div",{class:"pad_status_msg"});if(e.tree_content){if(!UWA.is(e.tree_content.nbObjectsSelected))throw new Error("Invalid status. Parameter nbObjectsSelected missing");void 0!==e.tree_content.nbObjectsInTree?e.tree_content.nbObjectsInTree>0?(1===e.tree_content.nbObjectsInTree?UWA.createElement("div",{text:s.REQStatusInfos_oneObjectInTree}).inject(t):UWA.createElement("div",{text:e.tree_content.nbObjectsInTree+s.REQStatusInfos_nbObjectsInTree}).inject(t),UWA.createElement("div",{text:e.tree_content.nbObjectsSelected+s.REQStatusInfos_nbObjectsSelected}).inject(t)):UWA.createElement("div",{text:s.REQStatusInfos_noObjectInTree}).inject(t):null!=e.tree_content.nbObjectsSelected?UWA.createElement("div",{text:e.tree_content.nbObjectsSelected+s.REQStatusInfos_nbObjectsSelected}).inject(t):UWA.createElement("div",{text:s.REQStatusInfos_noObjectInTree}).inject(t);var n=c.isAuthoring()?s.REQStatusInfos_authoringModeEnabled:s.REQStatusInfos_authoringModeDisabled;UWA.createElement("div",{text:n,style:"border-top: 1px;"}).inject(t)}var i=u.getTenantsPreference();return e.Tenant&&i.length>1&&UWA.createElement("div",{text:s.REQStatusInfos_Tenant+e.Tenant}).inject(t),t},d}),define("DS/RequirementStructureBrowser/utils/TRMModelEvent",["DS/CoreEvents/ModelEvents"],function(e){"use strict";var t=new e;return{getModelEvents:function(){return t},publish:function(e){return t.publish(e)},subscribe:function(e,n){return t.subscribe(e,n)},unsubscribe:function(e){return t.unsubscribe(e)},unsubscribeAll:function(e){return t.unsubscribeAll(e)}}}),define("DS/RequirementStructureBrowser/command/_Copy",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.copy()}}}),define("DS/RequirementStructureBrowser/utils/TRMPromiseUtils",["UWA/Promise"],function(e){"use strict";return{wrappedWithPromise:function(t){return new e(t)},allSettled:function(t){return e.allSettled(t)},all:function(t){return e.all(t)},getResilientPromise:function(t){return new e(function(n,i){e.cast(t.promise).then(function(e){n(e)}).catch(function(r){e.cast(t.getFallback()).then(function(e){t.onSuccessFallBack&&t.onSuccessFallBack(),n(e)}).catch(function(e){console.log("fail of callback %s",e),i(r)})})})}}}),define("DS/RequirementStructureBrowser/command/_Cut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.cut()}}}),define("DS/RequirementStructureBrowser/utils/RequirementAppConfig",[],function(){"use strict";var e={LEFT_PANEL_SIZE_EXPANDED:300,LEFT_PANEL_SIZE_COLLAPSED:40,MOBILE_BREAKPOINT:550,PATH_HOME:"home",PATH_LANDING_PAGE:"LandingPage",PATH_RECENTY_OPENED:"RecentlyOpened",PATH_MY_REQUIREMNTS:"MyRequirements",ROUTE_HOME:"home",ROUTE_LANDING_PAGE:"home.LandingPage",ROUTE_STRUCTURE_BROWSER:"home.RecentlyOpened",ROUTE_RECENTY_OPENED:"home.RecentlyOpened",ROUTE_MY_REQUIREMENTS:"home.MyRequirements"};return e.ROUTE_MY_REQUIREMENTS="home.MyReqSPec",e.DRAG_NODE_START=!1,e}),define("DS/RequirementStructureBrowser/command/_REQExport",[],function(){"use strict";return{execute:function(e){require(["DS/RequirementStructureBrowser/utils/REQExporter","DS/TraceableRequirementsUtils/Dictionary/TRMDictionaryAccess","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst"],function(t,n,i){switch(e.command_id){case"Print":t.printHtml({context:e.xnav_app});break;case"ExportCSV":e.xnav_app.beginBlockingTransaction(i.exportMask),n.updateNLSforexport(e.xnav_app.getPADTreeDocument()).then(function(){t.generateCsv({context:e.xnav_app}),e.xnav_app.endBlockingTransaction()}).catch(function(t){console.error(t),e.xnav_app.endBlockingTransaction()});break;case"PrintOptions":case"ExportCSVOptions":e.xnav_app.getPADTreeListView();break;case"ExportToRMC":var r=e.xnav_app.getSelectedNodes(),o="";r.forEach(function(e){"Requirement Specification"==e._options.reqKindOf&&(o+=e._options.resourceid,o+=",")}),o=(o=o.trim()).substring(0,o.length-1),t.exportForRMC(o,i)}setTimeout(function(){e.cmd&&e.cmd.enable()},500)})}}}),define("DS/RequirementStructureBrowser/utils/RequirementsConstant",["UWA/Core"],function(e){"use strict";return Object.freeze({TYPE_FILTER:"ENOStrRefinementSpecification",TYPE_REQUIREMENT:"Requirement",TYPE_REQUIREMENT_SPECIFICATION:"Requirement Specification",TYPE_REQUIREMENT_GROUP:"Requirement Group",TYPE_CHAPTER:"Chapter",TYPE_COMMENT:"Comment",TYPE_PARAMETER:"PlmParameter",CUSTOMIZED_TYPE:["Requirement","Chapter","Comment","Requirement Specification","Requirement Group"],MOBILE_BREAKPOINT:550,LEFT_PANEL_SIZE_EXPANDED:300,LEFT_PANEL_SIZE_COLLAPSED:40,ROUTE_HOME:"home",ROUTE_LANDING_PAGE:"home",EVENT_REFRESH_BY_IDS:"event-refresh-by-id",ACTIVE_VIEW:"Active_View",VIEW_STRUCTURE_BROWSER:"StructureEditor",EMPTY_STRUCTURE_BROWSER:"CleanStructureBrowser",BREADCUM_STRUCTURE_BROWSER_ID:"TRMBreadCrum",CREATE_ROOT_OBJECT:"create-trm-root-object",UPDATE_LIST_SELECTION:"update_list_selection",UPDATE_SELECTED_ROW:"update_selected_row",AFTER_ALL_SETTLED:"after_all_settled",PATH_ACCESS_YOUR_WORK:"AccessYourWork",PATH_START_NEW_ACTIVITY:"StartNewActivity",PATH_RECENTS:"Recents",PATH_OPEN_FILTER:"OpenFilters",PATH_OPEN_REQ:"OpenReq",PATH_OPEN_REQSPEC:"OpenReqSpec",PATH_OPEN_SPECFOLDER:"OpenSpecFolder",PATH_MY_REQ:"MyRequirements",PATH_MY_REQSPEC:"MyReqSPec",PATH_MY_SPECFOLDER:"MYSpecFolder",PATH_CREATE_REQ:"CreateReq",PATH_CREATE_REQSPEC:"CreateReqSpec",PATH_CREATE_SPECFOLDER:"CreateSpecFolder",STR_ORG_KEY:"organization:",STR_CURRENT_KEY:"current:",STR_OWNER:"owner:",STR_BACKSLASH_DBL_QUOTE:'"',STR_OR:"OR",STR_AND:"AND",LEFT_BRACKET:"(",RIGHT_BRACKET:")",STR_COLON:":",STR_SPACE:" ",COPY_MODE:"copy",MOVE_MODE:"move",REORDER_API_Version:2,POSITION_FIRSTCHILD:"firstChild",POSITION_LASTCHILD:"lastChild",POSITION_AFTERCHILD:"afterChild",WELCOME_PANEL_STATE:"welcome-panel-state",WELCOME_PANEL_COLLAPSE:"COLLAPSED",WELCOME_PANEL_EXPAND:"EXPANDED",EVENT_WELCOME_PANEL_COLLAPSE:"welcome-panel-collapse",EVENT_WELCOME_PANEL_EXPAND:"welcome-panel-expand"})}),define("DS/RequirementStructureBrowser/components/StructureRootNodes",["css!DS/PADServices/PADServices","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","DS/TraceableRequirementsUtils/Utils","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Tree/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils"],function(e,t,n,i,r,o,s){"use strict";function a(e){var t=this;t._context=e,this._broadcastSelect=!0,this._roots2add=[],this._root2select=[],this.elements={},this.elements.container=UWA.createElement("div",{class:"rootLst-main"}),this.options={grid:null,model:null},this.options.dgvOptions={selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},allowUnsafeHTMLContent:!1};var n=this.options.grid=new i(this.options.dgvOptions);n.onStatusbarIconPointerDown=function(e){var n=e.cellInfos,i=e.clickedIconIndex,r=n?n.cellModel:void 0;switch(i){case 0:t._removeTile({tile_id:r.options.resourceid});break;default:console.warn("RootListController: Unknown Icon")}},n.getContent().addEventListener("dragover",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.getContent().addEventListener("drop",this._onDropBlank.bind(this)),n.touchMode=!0;this.options.model=new r({shouldAcceptDrag:function(){return!1}}),this.options.model.id="rootListModel",this.options.model.getXSO().onPostAdd(function(e){if(t._broadcastSelect){var n=t.options.model.getSelectedNodes().map(function(e){return e.options.resourceid});t._context._localModelEvent.publish({event:"RequirementStructureBrowser-Root-select",data:{tile_ids:n}})}}),this.options.model.getXSO().onPostRemove(function(e){if(t._broadcastSelect){var n=t.options.model.getSelectedNodes().map(function(e){return e.options.resourceid});t._context._localModelEvent.publish({event:"RequirementStructureBrowser-Root-select",data:{tile_ids:n}})}}),this.options.model.getXSO().onEmpty(function(n){t._broadcastSelect&&e._localModelEvent.publish({event:"RequirementStructureBrowser-Root-select",data:{tile_ids:[]}})}),n.model=this.options.model,n.getContent().inject(t.elements.container),t._context._localModelEventsTokens.push(t._context._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-manage"},this._manageRoot.bind(this))),t._context._localModelEventsTokens.push(t._context._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-sync"},this._syncTitle.bind(this))),t._context._localModelEventsTokens.push(t._context._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-remove"},this._removeTiles.bind(this)))}return a.prototype.getContent=function(){return this.elements.container},a.prototype.getTabLabel=function(){return t.rootLstLabel},a.prototype.setVisible=function(e){e?this.elements.container.removeAttribute("hidden"):this.elements.container.setAttribute("hidden","")},a.prototype.selectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length?t[0].select():-1===this._root2select.indexOf(e.data.nodeModel.getID())&&this._root2select.push(e.data.nodeModel.getID()),this._broadcastSelect=!0},a.prototype.unselectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length&&t[0].unselect(),this._broadcastSelect=!0},a.prototype._addRootTiles=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(!0!==i.waiting4validation){var r={resourceid:i.resourceid,label:i.label,icons:UWA.clone(i.icons,!0),thumbnail:i.thumbnail?i.thumbnail:o.getWebappsAssetUrl("PADServices","icons/32/I_DefaultThumbnail.png"),statusbarIcons:["open wux-ui-3ds-flip-vertical"],statusbarIconsTooltips:[t.removeRoot],children:null,subLabel:i.grid["ds6w:responsible"],description:i.grid["ds6w:identifier"]};i.badges&&(r.badges=UWA.clone(i.badges)),r.icons[0]&&r.icons[0].badges&&delete r.icons[0].badges.topRight,delete r.contextualMenu,this._roots2add.push(r),this._realAddInWebUX(this._roots2add)}}},a.prototype._manageRoot=function(e){var t=void 0!==e.added_node?[e.added_node]:void 0!==e.added_nodes?e.added_nodes:[];if("boolean"!=typeof e.isremove||!0!==e.isremove){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=!1,s=this.options.model.getRoots();if(s&&s.length>0)for(var a=0;a<s.length;a++)if(s[a].options.resourceid===r.options.resourceid){o=!0;break}o||(n.push(r.options),r.onSelect(this.selectTile.bind(this)),r.onUnselect(this.unselectTile.bind(this)))}n.length&&this._addRootTiles(n)}},a.prototype._syncTitle=function(e){if(e.isRoot()){var t=e.getID?e.getID():"FakeTreeNode",n=this._search(t);if(1===n.length){var i=n[0],r=this.options.model,o=e.options.filtered;i.getLabel()===e.getLabel()&&i.options.subLabel===e.options.grid["ds6w:responsible"]&&i.options.filtered===o||(r.prepareUpdate(),i.setLabel(e.getLabel()||e.options.display),i.updateOptions({subLabel:e.options.grid["ds6w:responsible"],description:e.options.grid["ds6w:identifier"]}),i.options.filtered=o,!0===i.options.filtered?i.setBadges({bottomRight:"filter"}):i.setBadges({bottomRight:""}),r.pushUpdate(),this.options.grid.layout.invalidate())}}},a.prototype._search=function(e){return this.options.model.search({match:function(t){if(t.nodeModel.options.resourceid===e)return!0}})},a.prototype._removeTiles=function(e){for(var t=!0===e.all?this._getAllIDs():Array.isArray(e.pids)?e.pids:[],n=0;n<t.length;n++)this._removeTile({tile_id:t[n],noDispatch:e.noDispatch})},a.prototype._removeTile=function(e){var t=e.tile_id,n=this._search(t);if(1===n.length){var i=this;this.options.model.withTransactionUpdate(function(){i.options.model.removeRoot(n[0]);var r={tile_id:t};!0!==e.noDispatch&&i._context._localModelEvent.publish({event:"RequirementStructureBrowser-Root-removeTile",data:r})})}},a.prototype._realAddInWebUX=s.debounce(function(e){var t=[],n=[],i=[],r=[];r=e;for(var o=e.length-1;o>=0&&!(this._search(e[o].resourceid).length>0);o--)t.push(e[o]);for(var s=t.length-1;s>=0&&-1===i.indexOf(t[s].resourceid);s--)i.push(t[s].resourceid),n.push(t[s]);if(0!==(e=n).length){if(this.options.model.addRoot(e),r[0].resolve)for(var a=0;a<r.length;a++)r[a].resolve();this._roots2add=[],this._broadcastSelect=!1;for(var l=0;l<e.length;l++){var u=this._search(e[l].resourceid);1===u.length&&(e[l].nSelect||u[0].select(),e[l].isFiltered?u[0].setBadges({bottomRight:"filter"}):!1===e[l].isFiltered&&u[0].setBadges({bottomRight:""}))}this._broadcastSelect=!0}else if(r[0].resolve)for(var c=0;c<r.length;c++)r[c].resolve()},200),a.prototype._onDropBlank=function(e,t){var i=n.deserializeDroppedData(e);return GlobalModelEvents.publish({event:"RequirementStructureBrowser-Root-addTile",data:{unserializedData:i,behavior:"WITHOUT_CONTEXT"}}),!0},a.prototype._getAllIDs=function(){var e=[],t=this.options.model.getRoots();for(var n in t)e.push(t[n].options.resourceid);return e},a}),define("DS/RequirementStructureBrowser/components/ActionBar",["DS/Core/Core","DS/ApplicationFrame/FrameWindow","DS/RuntimeView/NLSManager","DS/ApplicationFrame/ActionBar","DS/CoreEvents/ModelEvents","css!DS/RequirementStructureBrowser/RequirementStructureBrowser.css"],function(e,t,n,i,r){"use strict";var o=function(e){this.options={action_bar:{file:"RequirementStructureBrowser.xml",module:"RequirementStructureBrowser",context:null,language:"en"},renderTo:null,callback:{onactionbarcb:null}}};return o.prototype.initializeActionBar=function(e,t){this.mediator=e.mediator,this._modelEvents1=new r,n.DEFAULT_LANGUAGE=widget.lang?widget.lang:widget.getValue("lang"),n.loadResource({resourceFile:"RequirementStructureBrowser/RequirementStructureBrowser"}),n.onResourceLoaded({resourceFile:"RequirementStructureBrowser/RequirementStructureBrowser",language:widget.lang?widget.lang:widget.getValue("lang")},function(){}),new i(this.options.action_bar).inject(t)},o}),define("DS/RequirementStructureBrowser/command/REQActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/Windows/Dialog","DS/Controls/Button","UWA/Controls/Web","DS/Controls/Find","DS/TraceableRequirementsUtils/Utils"],function(e,t,n,i,r,o,s,a,l){"use strict";var u=["Print","PrintOptions","ExportToRMC","ExportCSV","ExportCSVOptions"],c=["Print","PrintOptions","ExportToRMC","ExportCSV","ExportCSVOptions"],d=["Print","ExportCSV","ExportToRMC"],p=["ColumnVisibility"],f=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],h=["Copy","Cut"];function g(e,t){return-1!==e.indexOf(t)}return e.extend({init:function(e){this._parent(e);var i=this,r=(s=t.get()).options.model?s.options.model:s.getPADTreeDocument();if(n.isMobileDevice()&&-1!==f.indexOf(this.options.ID))this.disable();else if(-1!==u.indexOf(this.options.ID)){this._check_roots();var o=this._check_roots.bind(this);r.addEventListener("addChild",o),r.addEventListener("removeChild",o),g(c,this.options.ID)&&(this._check_roots(),s.addEvent("onRootsVisibility",this._check_roots.bind(this)))}else if(d.indexOf(this.options.ID)&&-1!==d.indexOf(this.options.ID)){this._parent(e);var s;r=(s=t.get()).options.model?s.options.model:s.getPADTreeDocument();this.disable(),s.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}else g(p,this.options.ID)&&(this._check_if_treeview(),UWA.is(s.addEvent,"function")&&s.addEvent("onToggleView",this._check_if_treeview.bind(this)));-1!==h.indexOf(this.options.ID)&&(this._check_select(),t.get().options.model.getXSO().onChange(this._check_select.bind(this))),"Paste"===this.options.ID&&require(["DS/TraceableRequirementsUtils/REQClipboard"],function(e){t.get().getPADTreeDocument().getXSO().onChange(i._activate_paste.bind(i)),e.addEvent("post_setData",i._activate_paste.bind(i)),e.addEvent("post_clear",i._activate_paste.bind(i)),i._activate_paste()})},execute:function(){var e=this,n=t.get(),i=n.options.model?n.options.model:n.getPADTreeDocument();switch(this.options.ID){case"Print":case"PrintOptions":case"ExportCSV":case"ExportCSVOptions":if("Print"===e.options.ID)return void n._applicationChannel.publish({event:"RequirementStructureBrowser-inject-print",data:null});e.disable(),require(["DS/RequirementStructureBrowser/command/_REQExport"],function(t){t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,model:i})});break;case"ExportToRMC":require(["DS/RequirementStructureBrowser/command/_REQExport"],function(t){t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,model:i})});break;case"ColumnVisibility":e.disable(),require(["DS/RequirementStructureBrowser/command/_REQColumnCusto"],function(t){var i=n.options.views?n.options.views.treelistview:n.getPADTreeListView();t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,tree:i})});break;case"Find":this.disable();var o=n.getActiveDGV(),s=new a({displayMatchCaseToggle:!0,displayClose:!1,relatedWidget:o,onFindRequest:o.setFindStr,onFindPreviousResult:o.goToPreviousMatchingCell,onFindNextResult:o.goToNextMatchingCell,onFindClose:o.closeFind}),l=new r({title:n.getNls("find_title"),content:s,immersiveFrame:n.getAppImmersiveFrame(),resizableFlag:!1});l._onCloseButtonClick=function(){s.close(),l.close(),e.enable()};break;case"Copy":require(["DS/RequirementStructureBrowser/command/_Copy"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Cut":require(["DS/RequirementStructureBrowser/command/_Cut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Paste":require(["DS/RequirementStructureBrowser/command/_Paste"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Uncut":require(["DS/RequirementStructureBrowser/command/_Uncut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;default:throw new Error("Unknown command")}e.enable()},_check_roots:function(){t.get().getPADTreeDocument().getRoots().length>0?this.enable():this.disable()},_check_added_roots:function(e){t.get().getPADTreeDocument();0===e.data.nb_root?this.disable():this.enable()},_check_select:function(){if(!0===!!t.get().getPADTreeDocument().getXSO().get().length){t.get().getPADTreeDocument().getXSO().get();g(h,this.options.ID)?this.enable():this.disable()}else this.disable()},_check_if_treeview:function(){switch(t.get().getPADTreeDocument().options.active_view){case"treelistview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}},_activate_paste:function(){var e=require("DS/TraceableRequirementsUtils/REQClipboard"),n=t.get().getPADTreeDocument().getXSO().get().length>0,i=t.get().getEditMode();!0!==e.isEmpty(e.OBJECT)&&!0===n&&!0===i?this.enable():this.disable()}})}),define("DS/RequirementStructureBrowser/command/_Uncut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.uncut()}}}),define("DS/RequirementStructureBrowser/treemodel/ReqTransactionManager",["UWA/Class","UWA/Class/Events"],function(e,t){"use strict";var n=function(e,t,n){this.getId=function(){return t},this.isNested=function(){return n};var i=this;this.end=function(){e(i)}};return e.extend(t,{_transactionStack:[],startTransaction:function(e){var t=Boolean(this._transactionStack.length>0),i=this;var r=new n(function(e){var t=i._transactionStack.indexOf(e),n=e.getId();if(t<0)throw new Error('This "'+n+'" transaction is not part of the transaction stack, may be it has already been ended');if(t!==i._transactionStack.length-1)throw new Error('Cannot end this "'+n+'" transaction as it is not the innermost transaction');i._transactionStack.pop();var r=e.isNested();i.dispatchEvent("onTransactionEnd",[n,r])},e,t);return this._transactionStack.push(r),t=r.isNested(),this.dispatchEvent("onTransactionStart",[e,t]),r},wrapInTransaction:function(e,t){var n=this.startTransaction(t);try{UWA.is(e,"function")&&e()}finally{n.end()}}})}),define("DS/RequirementStructureBrowser/command/StructureEditorInsertNewCommand",["DS/TraceableRequirementsUtils/Command/ActionBar_InsertNewCmd","DS/PADUtils/PADContext"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){this._context=t.get();let[e]=this._context.getModels().getSelectedNodes();e&&e.expand(),this.launchCreationDialog()}})}),define("DS/RequirementStructureBrowser/providers/ChangeContextColumn",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json"],function(e,t,n,i,r,o,s,a){function l(e){if(e.nodeModel)return"TRUE"!==e.nodeModel.options.grid.ChangeContext&&"FALSE"!==e.nodeModel.options.grid.ChangeContext?"string":"mandatory"}function u(e){if(e.nodeModel)return"TRUE"===e.nodeModel.options.grid.ChangeContext||"FALSE"===e.nodeModel.options.grid.ChangeContext}function c(t){var n={dataIndex:"ChangeContext",text:a["ds6w:realizedChangeAction"],width:180,minWidth:150,maxWidth:300,visibleFlag:!1,isAdditionalColumn:!0,editionPolicy:"EditionInPlace",getCellTypeRepresentation:l,getCellEditableState:u,setCellValue:function(t,n){!function(t,n){var a=["pid:"+t.nodeModel.options.resourceid],l={};l=1==n?{ObjectsListForSetChangeControl:a}:{ObjectsListForUnSetChangeControl:a},t.nodeModel.options.resourceid;let u={grid:{}};s.enforceWorkUnder({json:l,securityContext:o.getSecurityContext(),onComplete:function(n){"any"===((n=e.is(n,"string")?JSON.parse(n):n).objectListChangeControlled?n.objectListChangeControlled[0]:{}).changeControlValue&&(u.grid.ChangeContext="TRUE",t.nodeModel.updateProviderColumnValues(u))},onFailure:function(e,n){u.grid.ChangeContext="TRUE",t.nodeModel.updateProviderColumnValues(u);var o=r.getParseErrorMessage(e,n);i.errorAlert(o)},onTimeout:function(e){var t=r.getParseErrorMessage(e);i.errorAlert(t)}})}(t,n)},customisation:{dataIndex:"ChangeContext",exportable:{lock:!1,value:!0},layout:{removable:!1}}};d._columnDataIndex=["ChangeContext"],d._columnDefDGV={ChangeContext:n},t()}var d=t.singleton({_columnDataIndex:["ChangeContext"],_columnDefDGV:{},init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");c(function(){t(!0)})},getName:function(){return"ChangeContextColumn"},getManagedColumnNames:function(){return this._columnDataIndex},getAdditionalColumnsUXDGV:function(t){for(var n=[],i=0;i<t.length;i++)n.push(t[i].dataIndex);for(var r=0;r<this._columnDataIndex.length;r++){var o=this._columnDataIndex[r],s=e.clone(this._columnDefDGV[o]),a=n.indexOf(o);-1===a?t.push(s):(t[a]=e.extend(t[a],s,!0),t[a].text=nlsKeys[t[a].dataIndex])}},toBeUpdated:function(e,t){var n=!1;return"SyncModelRefresh"!==t&&"OnSyncModel"!==t||(n=!0),void 0!==e.ChangeContext&&""!==e.ChangeContext||(n=!0),n},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");setTimeout(function(){var l={pids:{},relids:{}},u=0;if(t.pids.length>0)for(u=0;u<t.pids.length;u++)l.pids[t.pids[u]]={ChangeContext:" "};for(var c="",d=0,p=d+100;t.pids.length>=d;)c=t.pids.slice(d,p),d+=100,p+=100,c.length>0&&s.getInfo({pid:c,authored:!0,selectables:"physicalid,interface[Change Control],attribute[Change Id]",onComplete:function(t){t=o.parseResponse(t),(t=(t=e.is(t,"string")?JSON.parse(t):t).results).forEach(function(e){var t=e["ds6w:realizedChangeAction"]?e["ds6w:realizedChangeAction"]:e["attribute[Change Id]"];l.pids[e.resourceid].ChangeContext=""===t?e["interface[Change Control]"]:"#DENIED!"==t?a.DENIED:t}),n(l)},onFailure:function(e){console.log("RequirementWebServices.getInfo = "+e);var t=r.getParseErrorMessage(e);i.errorAlert(t)},onTimeout:function(e){var t=r.getParseErrorMessage(e);i.errorAlert(t)}})},200)},registerReusableCellContent:function(e){e.getManager().registerReusableCellContent({id:"change_context_col_colloader",buildContent:function(){return n.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-reload wux-ui-3ds-spin"})}}),e.getManager().registerReusableCellContent({id:"change_context_col_value",buildContent:function(){return n.createElement("span")}});var t=JSON.stringify({mandatory:{stdTemplate:"switch"}});e.getTypeRepresentationFactory().registerTypeRepresentations(t)}});return d}),define("DS/RequirementStructureBrowser/treemodel/TreeNodeUpdateUtils",["DS/TraceableRequirementsUtils/utils/RequirementNlsMgt"],function(e){"use strict";let t=null;const n=Object.freeze({INSERT:"INSERT",DELETE:"DELETE"});let i=function(e,t){return e.options.relationOrder-t.options.relationOrder};const r=(e,i)=>{if(!e||!t)return;const r=e.getRelationID();let o=t.get(r)||[];if(r)switch(i){case n.INSERT:o.push(e),t.set(r,o);break;case n.DELETE:t.delete(r)}},o=(e,n)=>{e&&t&&(r(e,n),e.processDescendants({processNode:function(e){e&&e.nodeModel&&r(e.nodeModel,n)}}))};let s=function(e,r,a,c,d){let p=!1;d||(p=!0,d=[]),d.push(r);let f=[];a&&a.children&&a.children.forEach(function(a){let l=(e=>{if(t)return t.get(e)})(a.relationid);l&&l.length?function(e,t,n,i,r,o){t.forEach(function(t){-1==t.getRelationOrder()&&t.setRelationOrder(e.relationOrder),s(i,t,e,r,o),n.push(t)})}(a,l,f,e,c,d):function(e,t,r,a,l,u){if(a&&!a.options.childComputed)return;let c=a.addChild(e);o(c,n.INSERT),a.options.children.sort(i),s(r,c,e,l,u),t.push(c)}(a,f,e,r,c,d)}),l(r,f),u(p,e,d,c)},a=function(e,t,n,r,o){let s=!1;o||(s=!0,o=[]),o.push(t),n&&n.children&&n.children.forEach(function(n){let s=e.getNodesByRelId(n.relationid);s.length?function(e,t,n,i,r){t.forEach(function(t){-1==t.getRelationOrder()&&t.setRelationOrder(e.relationOrder),a(n,t,e,i,r)})}(n,s,e,r,o):function(e,t,n,r,o){let s=n.addChild(e);n.options.children.sort(i),a(t,s,e,r,o)}(n,e,t,r,o)}),u(s,e,o,r)},l=function(e,t){let i=e.getChildren(),r=[];i&&(r=i.filter(function(e){return-1===t.indexOf(e)})),r.forEach(function(t){e.removeChild(t),o(t,n.DELETE)})},u=function(t,n,i,r){t&&(n.prepareUpdate(),i.forEach(function(t){let n=r.get(t.getID());if(n){let i={grid:n.grid,label:n.label,cestamp:n.cestamp};t.updateOptions(i),e.updateNLS(t)}}),n.pushUpdate())};return{refreshTreeStructure:s,refreshTreeStructureForSearch:a,refreshTreeStructureExpand:function(e,t,n){n&&n.children&&n.children.forEach(function(n){let r=e.getNodesByRelId(n.relationid);r.length?r.forEach(e=>{-1==e.getRelationOrder()&&e.setRelationOrder(n.relationOrder)}):t.addChild(n),t.options.children.sort(i)})},setRelIdToNodeModelMap:e=>{e&&(t=e)}}}),define("DS/RequirementStructureBrowser/command/_Paste",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.paste()}}}),define("DS/RequirementStructureBrowser/providers/CoverRefineColumn",["UWA/Core","UWA/Class","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/LinkManager","DS/RequirementStructureBrowser/utils/RequirementsConstant","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json"],function(e,t,n,i,r,o){function s(e){if(e.nodeModel)return"tag"}var a=t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){var t={dataIndex:"ds6w:covers",text:o["ds6w:covers"],visibleFlag:!0,isAdditionalColumn:!0,getCellTypeRepresentation:s,customisation:{exportable:{lock:!0,value:!0},layout:{removableFromView:!0,removable:!0}}},n={dataIndex:"ds6w:refinedInto",text:o["ds6w:refinedInto"],visibleFlag:!0,isAdditionalColumn:!0,getCellTypeRepresentation:s,customisation:{exportable:{lock:!0,value:!0},layout:{removableFromView:!0,removable:!0}}};a._columnDataIndex=["ds6w:covers","ds6w:refinedInto"],a._columnDefDGV={"ds6w:covers":t,"ds6w:refinedInto":n},e()}(function(){t(!0)})},getName:function(){return"CoverRefineColumn"},getManagedColumnNames:function(){return this._columnDataIndex},getAdditionalColumnsUXDGV:function(t){for(var n=[],i=0;i<t.length;i++)n.push(t[i].dataIndex);for(var r=0;r<this._columnDataIndex.length;r++){var o=this._columnDataIndex[r],s=e.clone(this._columnDefDGV[o]),a=n.indexOf(o);-1===a?t.push(s):(t[a]=e.extend(t[a],s,!0),t[a].text=nlsKeys[t[a].dataIndex])}},toBeUpdated:function(e,t,i){var o=!1;if(i.getKindOf()===r.TYPE_REQUIREMENT){var s=n.determineAuthoredFlag();("SyncCoverRefine"===t||"SyncModelRefresh"===t&&s)&&(o=!0),e["ds6w:covers"]&&e["ds6w:refinedInto"]||"OnResize"===t||(o=!0)}return o},updateAttributes:function(e,t){if(!Array.isArray(t))throw new Error("The object ids to modify must be specify");setTimeout(function(){for(var n="",r=0,o=r+100;t.length>=r;)n=t.slice(r,o),r+=100,o+=100,n.length>0&&i.getLinkStatus(e,n)},200)}});return a}),define("DS/RequirementStructureBrowser/treemodel/RequirementNodeModel",["DS/TreeModel/TreeNodeModel","UWA/Core","DS/WebappsUtils/WebappsUtils","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst.json","DS/TraceableRequirementsUtils/Utils","DS/RequirementStructureBrowser/utils/RequirementsConstant"],function(e,t,n,i,r,o){"use strict";function s(t){if(this.options={matrixID:null,physicalID:null,cestamp:null,elementID:null,elementRV:null,type:"",kindof:"",title:"",name:"",revision:"",content:"",relationtype:"",relationid:null,parentID:"",attributes:[],level:0,editable:!0,isDocx:!1,format:"html",filteringContext:{isFilterOutByTagger:!1,isFilterOutBySearch:!1}},this.tenant=t.tenant,this.options=UWA.clone(t),t&&t.grid){this.options.subLabel=t.grid["ds6w:responsible"],this.options.description=t.grid["ds6w:identifier"];var n=t.grid["ds6w:reserved"]?t.grid["ds6w:reserved"]:t.padgrid&&t.padgrid["ds6w:reserved"]?t.padgrid["ds6w:reserved"]:null;if(null!==n)if("boolean"==typeof n?n:"TRUE"===n.toUpperCase())this._isLockedByMe(t)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips="Locked"):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips="Locked");else this.options.statusbarIcons=["lock-open"],this.options.statusbarIconsTooltips="Unlocked"}this.options=UWA.extend(this.options,t),this.options.relationOrder||(this.options.relationOrder=-1),this.options.grid||(this.options.grid={});this.options;e.call(this,this.options)}return s.prototype=Object.create(e.prototype),s.prototype.getType=function(){return this.options.type},s.prototype.getKindOf=function(){return this.options.reqKindOf?this.options.reqKindOf:this.options.type},s.prototype.setParentID=function(e){this.options.parentID=e},s.prototype.getParentID=function(){return this.options.parentID},s.prototype.getParentId=function(){return this.getParent().getID()},s.prototype.setLevel=function(e){this.options.level=e},s.prototype.getEffectivity=function(){return this.options.grid.Effectivity},s.prototype.getLoadingMode=function(){if(this.getType()===o.TYPE_PARAMETER)return this.options.plmparam.loadingMode},s.prototype.getParamContent=function(){if(this.getType()===o.TYPE_PARAMETER)return this.options.grid.paramContent},s.prototype.unMatch=function(e){if(!e)return!1;var t=e.toLowerCase();if((this.getCreatedDate()||"").toLowerCase().includes(t)||(this.getModifedDate()||"").toLowerCase().includes(t)||(this.getDescription()||"").toLowerCase().includes(t)||(this.getLabel()||"").toLowerCase().includes(t)||(this.getOwner()||"").toLowerCase().includes(t)||(this.getMaturity()||"").toLowerCase().includes(t))return!1;var n=!0;return(this.getAttributes()||[]).forEach(function(e){e.value.toLowerCase().includes(t)&&(n=!1)}),n},s.prototype.match=function(e,t){if(!e||""==e)return!1;for(var n=e.toLowerCase(),i=0;t.length>i;i++){if("ds6w:reserved"!=t[i].ds6w)if(t[i].kind&&-1!==["datetime","timestamp"].indexOf(t[i].kind.toLowerCase())){if((new Date(this.options.grid[t[i].ds6w]).toString()||"").toLowerCase().includes(n))return!0}else if("date"==t[i].kind.toLowerCase()){if((new Date(this.options.grid[t[i].ds6w]).toLocaleString("en",{month:"short",day:"numeric",year:"numeric"})||"").toLowerCase().includes(n))return!0}else if("tree"==t[i].dataIndex){if((this.options.grid.displayName||"").toLowerCase().includes(n))return!0}else if((this.options.grid[t[i].ds6w]||"").toLowerCase().includes(n))return!0}return!1},s.prototype.getColor=function(){return this.options.grid.bi_color},s.prototype.setColor=function(e){this.updateOptions({grid:{bi_color:e}})},s.prototype.resetColor=function(){this.updateOptions({grid:{bi_color:"rgba(0, 0, 0, 0)"}})},s.prototype.getOwner=function(){return this.options.grid["ds6w:responsible"]},s.prototype.getAttributes=function(){return this.options.attributes},s.prototype.getReqInterface=function(){return this.options.reqInterface},s.prototype.getMaturity=function(){return this.options.grid["ds6w:status"]},s.prototype.setMaturity=function(e){e&&e.length>0&&(this.options.grid["ds6w:status"]=e)},s.prototype.getLabel=function(){return this.options.grid["ds6w:label"]},s.prototype.getCreatedDate=function(){return this.options.grid["ds6w:created"]},s.prototype.getModifedDate=function(){return this.options.grid["ds6w:modified"]},s.prototype.getDescription=function(){return this.options.grid["ds6w:description"]},s.prototype.getLevel=function(){return this.options.level},s.prototype.setRelationOrder=function(e){this.options.relationOrder=e},s.prototype.getRelationOrder=function(){return this.options.relationOrder},s.prototype.getRelationType=function(){return this.options.relationtype},s.prototype.setRelationType=function(e){this.options.relationtype=e},s.prototype.setENOTRMAppElementID=function(e){this.options.elementID=e},s.prototype.getENOTRMAppElementID=function(){return this.options.elementID},s.prototype.setENOTRMAppElement=function(e){this.options.elementRV=e},s.prototype.getENOTRMAppElement=function(){return this.options.elementRV},s.prototype.applyFilters=function(){this.shouldBeVisible()?this.show():this.hide()},s.prototype.shouldBeVisible=function(e){return!this.isHiddenBySearch()&&!this.isHiddenByTagger()},s.prototype.isHiddenByTagger=function(){return this.options.filteringContext.isFilterOutByTagger},s.prototype.isHiddenBySearch=function(){return this.options.filteringContext.isFilterOutBySearch},s.prototype.setTaggerFilterState=function(e){this.options.filteringContext.isFilterOutByTagger=e},s.prototype.setSearchFilterState=function(e){this.options.filteringContext.isFilterOutBySearch=e},s.prototype.getNodesByRelId=function(e){var t={listOfFoundNodes:[],foundId:void 0};return this._getNodesByRelId(e,t),t.listOfFoundNodes},s.prototype.getDepth=function(){for(var e=this,t=0;!e.isRoot();)e=e.getParent(),t++;return t},s.prototype._getNodesByRelId=function(e,t){var n=this.options.relationid,i=this.getID();if(n===e)t.listOfFoundNodes.push(this),t.foundId=i;else if(i!==t.foundId){var r=this.getChildren();if(r)for(var o=0;o<r.length;o++)r[o]._getNodesByRelId(e,t)}},s.prototype.getNodeByPath=function(e,t,n,i){if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof n||n<0||n>=e.length)&&(n=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t!==n&&(this.isExpanded()||this.childComputed||void 0!==i&&!1!==i)){var r=e[t+1],o=this.getChildren();if(o&&0!==o.length){for(var s=null,a=0;a<o.length&&null===s;a++){var l=o[a];r===l.options.relationid&&(s=l)}return null===s?this:s.getNodeByPath(e,t+2,n,i)}return this}return this}},s.prototype.isDescendantOf=function(e){var t;if(t=e instanceof s?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var n=this.getParent();if(n)return n.isDescendantOf(t)}return!1},s.prototype.getChildById=function(e){var t,n=this.getChildren();if(n)for(var i=0;i<n.length;i++)if(n[i].getID()===e){t=n[i];break}return t},s.prototype._removeFilterInfo=function(){delete this.options._filterInfo},s.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},s.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},s.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},s.prototype.getViewType=function(){return this.options.viewType},s.prototype.isAttributePending=function(e){if(!t.is(e,"string"))return!1;return-1!==["#loading#","#queued#"].indexOf(this.getAttributeValue(e))},s.prototype.getOccurencePath=function(e,t){if(t=t||!1,UWA.is(e,"function")&&e(this),!this.isRoot()&&this.getParent()){var n=this.getParent().getOccurencePath(e,t);return 1==t?(n.push({resourceid:this.options.relationid,type:this.options.relationtype}),n.push({resourceid:this.options.resourceid,type:this.options.type})):(n.push(this.options.relationid),n.push(this.options.resourceid)),n}return 1==t?[{resourceid:this.options.resourceid,type:this.options.type}]:[this.options.resourceid]},s.prototype.getAttribute=function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},s.prototype.getID=function(){return this.options.resourceid},s.prototype.getRelationID=function(){return this.options.relationid},s.prototype.setRelationID=function(e,t){this.options.relationid=e,this.options.relationtype=t},s.prototype.getNodesById=function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},s.prototype._getNodesById=function(e,t){var n=!1;if(this.getID()===e)t.listOfFoundNodes.push(this),n=!0;else{var i=this.getChildren();if(i)for(var r=0;i&&r<i.length;r++)n=i[r]._getNodesById(e,t)||n}return n},s.prototype.updateOptions=function(t){if(t.custAtrValueConverted||(t.custAtrValueConverted=!1),t.grid){this.options.thumbnail||t.thumbnail||(t.thumbnail=n.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),t.subLabel=r.computeSubLabel(t),t.description=t.grid["ds6w:identifier"]?t.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"";var o=t.grid["ds6w:reserved"]?t.grid["ds6w:reserved"]:t.padgrid&&t.padgrid["ds6w:reserved"]?t.padgrid["ds6w:reserved"]:null;if(null!==o)if("boolean"==typeof o?o:"TRUE"===o.toUpperCase())this._isLockedByMe(t)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]);else t.statusbarIcons=["lock-open"],t.statusbarIconsTooltips=[i.tooltip_unreserved]}this.options.edit&&(t.edit=this.options.edit),e.prototype.updateOptions.call(this,t)},s.prototype.updateNLS=function(t){t.subLabel=r.computeSubLabel(t),t.description=t.grid["ds6w:identifier"]?t.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"",e.prototype.updateOptions.call(this,t)},s.prototype.updateProviderColumnValues=function(t){e.prototype.updateOptions.call(this,t)},s.prototype._isLockedByMe=function(e){var t=!0,n=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"",i=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",r=require("DS/TraceableRequirementsUtils/Utils"),o=r.getUserLogin()?r.getUserLogin():"",s=r.getUser()?r.getUser():"";(s.firstName||s.lastName)&&(s=s.firstName+" "+s.lastName);t=!0;return n.trim().length>0?(t=n.toUpperCase().trim()===o.toUpperCase().trim()||!1)||(t=n.toUpperCase().trim()===s.toUpperCase().trim()||!1):i.trim().length>0&&(t=s.toUpperCase().trim()===i.toUpperCase().trim()||!1),t},s}),define("DS/RequirementStructureBrowser/treemodel/RequirementModelParser",["DS/Logger/Logger","DS/RequirementStructureBrowser/treemodel/RequirementNodeModel","DS/TraceableRequirementsUtils/Utils","DS/WebappsUtils/WebappsUtils","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/RequirementStructureBrowser/treemodel/TreeNodeUpdateUtils","DS/TraceableRequirementsUtils/utils/RequirementNlsMgt","DS/RequirementStructureBrowser/utils/RequirementsConstant"],function(e,t,n,i,r,o,s,a){"use strict";e.getLogger("DS/RequirementStructureBrowser/treemodel/RequirementModelParser");var l={},u={},c=new Map,d=new Map,p=[],f=[],h=JSON.parse(r),g=function(e){let t=e=>isNaN(e)?e:parseFloat(e).toString();var n="",i=" < ",r=e.displayUnit?" "+e.displayUnit:"";if(""===r&&(r=UWA.is(e.unit)&&UWA.is(e.unit.displayName)?" "+e.unit.displayName:""),null!=e.minvalue&&""!=e.minvalue&&(e.minvalue=t(e.minvalue),"true"==e.mininclus&&(i=" <= "),null!=e.maxvalue&&""!=e.maxvalue?n=e.minvalue+r+i:(n=e.minvalue+r+i,r+=" < ... "),i=" < "),UWA.is(e.values,"array")&&e.values.length>0||e.multivalue&&e.multivalue.length>0){if(null!=e.value)if(""!==e.value&&"indexed"!==e.loadingMode||"indexed"===e.loadingMode&&e.multivalue.split(",").includes(e.value))e.value=t(e.value),n=n+e.value+r;else{e.multivalue&&(e.values=e.multivalue.split(","));let i="";for(let n=0;n<e.values.length;n++){e.values[n]=t(e.values[n]);let o=e.values[n].displayName?e.values[n].displayName:e.values[n];""!==(i=""===i?o:i+","+o)&&(i+=r)}n+=i}}else null!=e.value&&(""!=e.value?(e.value=t(e.value),n=n+e.value+r):n+="...");return null!=e.maxvalue&&""!=e.maxvalue&&(e.maxvalue=t(e.maxvalue),"true"==e.maxinclus&&(i=" <= "),n=null!=e.minvalue&&""!=e.minvalue?n+i+e.maxvalue+r:" ... < "+n+i+e.maxvalue+r,i=" < "),n};return u.parseNodes=function(e,t){var r={resourceid:"",useAsyncPreExpand:!0,children:[],state:"collapsed",subLabel:null,grid:{},filteringContext:{isFilterOutByTagger:!1,isFilterOutBySearch:!1}};let o=h.tileview_thumbnails,s=n.getAuthorizedTypesWithParent(),l={loadingMode:"not defined",maxinclus:"false",mininclus:"false",maxvalue:"",minvalue:"",value:"",minrangeprop:"",maxrangeprop:"",multivalue:""},u=Object.keys(e),c=u.length;if(c){for(var d=0;d<c;d++){let t=u[d],n=e[t];switch(t){case"resourceid":r.resourceid=n,r.physicalid=n;break;case"cestamp":r.cestamp=n;break;case"relationid":r.relationid=n;break;case"ds6w:identifier":r.name=n,r.grid[t]=n;break;case"ds6w:type":r.grid[t]=n,r.type=e.type&&UWA.is(e.type,"object")?e.type.value:n,r.kindof=s[r.type]?s[r.type]:r.type,r.reqKindOf=r.kindof;break;case"ds6w:label":r.label=n,r.grid[t]=n,r.req_label=n;break;case"ds6wg:revision":r.grid["ds6wg:revision"]=n,r.revision=n;break;case"icon":case"type_icon_url":void 0===r.icons&&(r.icons=[]);let i={iconPath:"url("+n+")",className:"dgv-icons"};r.icons.push(i),r.type_icon_url=n;break;case"thumbnails":case"preview_url":case"thumbnail":case"thumbnail_2d":r.thumbnail=n,r.grid.thumbnail=n;break;case"ds6w:covers":case"ds6w:refinedInto":r.grid[t]=n;break;case"interface":if(UWA.is(n))if(UWA.is(n.value)){let e=g(n);l.loadingMode="authored",r.plmparam=n,r.grid.paramContent=e}else r.reqInterface=n;break;case"plmparam.value":l.value=n;break;case"plmparam.multivalue":l.multivalue=n;break;case"plmparam.max":l.maxvalue=n;break;case"plmparam.min":l.minvalue=n;break;case"plmparam.displayunit":l.displayUnit=n;break;case"plmparam.itf":l["plmparam.itf"]=n,l.loadingMode="indexed";break;case"plmparam.maxrangeprop":l.maxrangeprop=n;break;case"plmparam.minrangeprop":l.minrangeprop=n;break;case"spec.TreeOrder":r.relationOrder=parseFloat(n),isNaN(r.relationOrder)&&(r.relationOrder=-1);break;case"from":r.from=n;break;default:UWA.is(n,"object")?r.grid[t]=n.displayName:r.grid[t]=n}}if(r.kindof===a.TYPE_PARAMETER&&!r.grid.paramContent){switch(l.minrangeprop){case"0":l.minvalue="";break;case"1":l.mininclus="true";break;case"2":l.mininclus="false"}switch(l.maxrangeprop){case"0":l.maxvalue="";break;case"1":l.maxinclus="true";break;case"2":l.maxinclus="false"}r.plmparam=l}}if(void 0===r.thumbnail){let e=i.getWebappsAssetUrl("RequirementStructureBrowser","icons/64/"+o[r.kindof]);r.thumbnail=e}if(widget&&!UWA.is(widget.displayNameSettings)){var p=sessionStorage.getItem("RMTPreferredDisplayName");widget.displayNameSettings=UWA.is(p,"string")?JSON.parse(p):p}if(UWA.is(r.name)&&UWA.is(widget.displayNameSettings[r.kindof])){let e=n.computeDisplayName({name:r.name,title:r.label,revision:r.grid["ds6wg:revision"]},widget.displayNameSettings[r.kindof]);r.grid.displayName=e,r.label=e}return r.subLabel=n.computeSubLabel(r),r},l={buildStructure:function(e){if(1===e.results.length&&e.refresh){let t=e.results[0],n=u.parseNodes(t,e.treeDoc);e.treeDoc.getNodesById(t.resourceid).forEach(function(e){var t={grid:n.grid,label:n.label};e.updateOptions(t),s.updateNLS(e)})}else{let t=[];for(let n=0;n<e.results.length;n++){let i=e.results[n],r=u.parseNodes(i,e.treeDoc);t.push(r),c.set(r.resourceid,r)}t.forEach(function(t){l.addChild(t.from,t,e)})}},processStructure:function(){function e(e,t){return e.relationOrder-t.relationOrder}for(let n=0;n<f.length;n++){var t=f[n];t.children&&t.children.length>1&&(t.children=t.children.sort(e))}},addChild:function(e,t,n){if(!e)return;let i=c.get(e);if(!i)return void console.log("Unknown parent");i.children||(i.children=[]);var r=UWA.clone(t);i.children.push(r);var o,s,a=d.get(r.resourceid);a||(a=[]),a.push(r),s=i,-1===(o=f).indexOf(s)&&o.push(s),d.set(r.resourceid,a);let l=c.get(r.resourceid);l&&!1===n.isAuthored&&(Array.isArray(r.children)&&0===r.children.length&&Array.isArray(l.children)&&l.children.length>0&&delete r.children,UWA.merge(r,l,!0)),c.set(r.resourceid,r)},prepareRelIdToNodeModelMap:function(e){const t=new Map;return UWA.is(e)?(e.getRelationID()&&t.set(e.getRelationID(),e),e.processDescendants({processNode:function(e){if(e&&e.nodeModel){const n=e.nodeModel,i=n.getRelationID();if(i){let e=t.get(i)||[];e.push(n),t.set(i,e)}}}}),t):t}},u.process={root:function(e,n){let i=u.parseNodes(e.data,e.treedocument);var r=new t(i);return s.updateNLS(r),r},createNode:function(e){var n=u.parseNodes(e.data,e.treedocument);return n.tenant=e.tenant,new t(n)},expand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"array"))throw new Error("Invalid input parameters");return new Promise(function(t,n){e.treedocument.withTransactionUpdate(function(){c=new Map,d=new Map,f=[],p=e.rootNodes,l.buildStructure({treeDoc:e.treedocument,results:e.response,expandLevel:e.expandLevel,isAuthored:e.authored,rootNodes:e.rootNodes}),l.processStructure(e);let t=-1===e.expandLevel;p.forEach(function(n){let i,r=c.get(n.options.resourceid);if(r&&n.hasChildren()){if(!t)return void o.refreshTreeStructureExpand(e.treedocument,n,r);n.removeChildren()}if(r&&r.children&&(i=r.children,delete r.children),s.updateNLS(n),n.isRoot()){let t=!!e.BIProxy&&e.BIProxy.HasFilter(n.getID());var a=UWA.clone(n.options.icons[0]);!0===t.hasFilter?(a.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},r&&n.updateOptions(r),n.updateOptions({icons:[a]})):(a.badges={bottomRight:null},n.updateOptions({icons:[a]}))}if(i){let t=e.treedocument;t.withTransactionUpdate(function(){t.loadModel(i,n)})}else n.updateOptions({children:null}),n.setState({state:"noChildren"})})}),t(p)})},displayPreferredUnitValues:function(e,t,n){e.getType()===a.TYPE_PARAMETER?this.displayPreferredParamValues(e,t):this.displayPreferredCustAttrValues(e,t,n)},displayPreferredCustAttrValues:function(e,t,n){let i=Object.keys(n);if(i.length>0){let r=0,o={grid:{},custAtrValueConverted:!0};for(let s of i){if(n[s].isMultivalued){let e=[];for(let i=r;i<=n[s].MultiValueCount;i++)e.push(parseFloat(t[i].ConvertedValues));r+=n[s].MultiValueCount,o.grid[s]=e.toString()}else{let e=t[r].ConvertedValues?parseFloat(t[r].ConvertedValues).toString():t[r].ConvertedValues;r+=1,o.grid[s]=e}e.updateOptions(o)}}},displayPreferredParamValues:function(e,t){let n=1,i=2,r={maxinclus:"false",mininclus:"false",maxvalue:"",minvalue:"",value:"",multivalue:""};if(UWA.is(e)){let o=e.options.plmparam;o.minvalue&&(r.mininclus=o.mininclus,r.minvalue=t.length?t[0].ConvertedValues:o.minvalue),o.value&&(n=o.minvalue?n:0,r.value=t.length?t[n].ConvertedValues:o.value),o.multivalue&&(r.multivalue=t.length?t[n].ConvertedValues:o.multivalue),o.maxvalue&&(i=o.minvalue&&o.value?i:o.minvalue||o.value?1:0,r.maxinclus=o.maxinclus,r.maxvalue=t.length?t[i].ConvertedValues:o.maxvalue),r.displayUnit=o.displayUnit,r.loadingMode=o.loadingMode;let s={grid:{paramContent:g(r)}};e.updateOptions(s)}},refresh:function(e){c=new Map,d=new Map,f=[],p=e.rootNodes;let t=e.treedocument;return new Promise(function(n,i){l.buildStructure({treeDoc:t,results:e.response,expandLevel:e.expandLevel,isAuthored:e.authored,rootNodes:e.rootNodes,refresh:!0});for(const e of p){let n=c.get(e.getID());const i=l.prepareRelIdToNodeModelMap(e);o.setRelIdToNodeModelMap(i),o.refreshTreeStructure(t,e,n,c,!1)}n(p)})},refresh_nodes:function(e){let n=e.response.results,i=e.treedocument,r=new Map;n.forEach(function(e){var t=u.parseNodes(e,i);r.set(t.resourceid,t)});r.forEach(function(n,r){if(e.refresh_data.created&&-1!==e.refresh_data.created.indexOf(r)){let e=new t(n);i.app.getSetting("root_type").indexOf(e.getKindOf())>-1&&(i.addRoot(e),i.getModelEvents().publish({event:"onRootAdded",data:{nb_root:i.getRoots().length,added_nodes:[e]}}))}if(e.refresh_data.modified&&-1!==e.refresh_data.modified.indexOf(r)){i.getRoots().forEach(function(e){let t=e.getNodesById(r);t.length&&t.forEach(function(e){delete n.children;var t={grid:n.grid,label:n.label,cestamp:n.cestamp};e.updateOptions(t)})});var o=i.searchRootById(r),s={grid:n.grid,label:n.label,cestamp:n.cestamp};o&&o.updateOptions(s),o&&i.getModelEvents().publish({event:"onRootAdded",data:{nb_root:i.getRoots().length,added_nodes:[o],isremove:!0}})}})},addRemainingStructure:function(e){c=new Map,d=new Map,f=[],l.buildStructure({treeDoc:e.treedocument,results:e.response,expandLevel:e.expandLevel,isAuthored:e.authored,rootNodes:e.rootNodes}),l.processStructure(e);for(const t of e.rootNodes){let n=t,i=c.get(n.getID());o.refreshTreeStructureForSearch(e.treedocument,n,i,c)}return e.rootNodes.map(e=>c.get(e.getID())?c.get(e.getID()):e.options)},updateNodeModel:function(e){s.updateNLS(e)}},u}),define("DS/RequirementStructureBrowser/treemodel/RequirementWSAccess",["UWA/Core","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSession","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","DS/PADUtils/PADContext","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/PADUtils/PADProbes","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/utils/TRMPromiseUtils"],function(e,t,n,i,r,o,s,a,l,u,c,d,p,f){var h={fetch:function(e){u.get();var t=require("DS/PADUtils/PADSettingsMgt");e.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getSetting("lang")},function(e){var t=u.get().columnManager.getDGVVisibleColumns();t=(t=t.join(",")).concat(",cestamp"),s.getInfo({securityContext:r.getSecurityContext(),pid:e.pids,selectables:t,onComplete:e.onComplete,onFailure:e.onFailure})}(e)},_fetchData:function(e){var n=u.get();return f.wrappedWithPromise(function(i,o){try{var s,a,l={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};s=h._getSearchQuery(e),a=n.getSetting("FETCH_PREDICATE");var u=UWA.merge(UWA.clone({}),{label:r.getRequestLabel(),with_indexing_date:!0,with_synthesis:!1,with_nls:!0,with_synthesis_attribute:!1,locale:r.getLanguage(),select_predicate:a,query:s,refine:{},order_by:"desc",order_field:"relevance",nresults:40,start:"0",source:["3dspace"],tenant:r.getTenant()});l.data=JSON.stringify(u),l.async=!1,l.onComplete=function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;let n=[];t.results&&t.results.forEach(function(e){let t={};if(e.attributes){e.attributes.forEach(function(e){let n=e.name,i=e.dispValue?e.dispValue:e.value;"ds6w:type"==n&&(i=e.value),"date"==e.type&&(i=new Date(e.value).toLocaleString()),t[n]=i}),n.push(t)}}),i(n)},l.onFailure=function(e){o(e)},l.onTimeout=function(e){o(e)};var c=r.getServiceSearchUrl()+"/search";c=r.appendTenantInUrl(c),t.authenticatedRequest(c,l)}catch(e){console.log("Exception occured while fetching data"+e.message)}})},getTenant:function(){return r.getPlatformId()},_getSearchQuery:function(e){var t,n;return n="types/"+e,t=p.STR_OWNER+p.STR_BACKSLASH_DBL_QUOTE+r.getUserLogin()+p.STR_BACKSLASH_DBL_QUOTE,p.LEFT_BRACKET+p.LEFT_BRACKET+"flattenedtaxonomies:"+p.STR_BACKSLASH_DBL_QUOTE+n+p.STR_BACKSLASH_DBL_QUOTE+p.RIGHT_BRACKET+p.STR_SPACE+p.STR_AND+p.STR_SPACE+t+p.RIGHT_BRACKET},_parseResponse:function(e){var t=[];if(e){var n=e.results;if(n&&n.length>0){for(var i=(new Date).getTime(),r=0,o=n.length;r<o;r++)if(n[r]&&n[r].attributes){for(var s=n[r].attributes,a={},l=0,u=s.length;l<u;l++)switch(s[l].name){case"ds6w:identifier":a.name=s[l].value;break;case"ds6w:label":s[l].dispValue?a["attribute[Title]"]=s[l].dispValue:a["attribute[Title]"]=s[l].value;break;case"ds6w:description":a.description=s[l].value;break;case"resourceid":a.physicalid=s[l].value;break;case"ds6w:what/ds6w:type":case"ds6w:type":UWA.is(s[l].displayName)||(s[l].displayName=s[l].dispValue?s[l].dispValue:s[l].value),a.type=s[l];break;case"ds6w:when/ds6w:modified":case"ds6w:when/ds6w:created":case"ds6w:modified":case"ds6w:created":try{if(s[l].dispValue){var c=new Date(s[l].dispValue).toLocaleString(this._currLang);"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=c:"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=c)}else{c=new Date(s[l].value).toLocaleString(this._currLang);"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=c:"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=c)}}catch(e){s[l].dispValue?"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=s[l].dispValue?s[l].dispValue:"":"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=s[l].dispValue?s[l].dispValue:""):"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=c:"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=c)}break;case"ds6wg:revision":a.revision=s[l].value;break;case"ds6w:what/ds6w:status":case"ds6w:status":var d=s[l].dispValue?s[l].dispValue:s[l].value;d&&(d.indexOf("Requirement Specification.")>-1||d.indexOf("Requirement Group.")>-1||d.indexOf("Requirement.")>-1)?a.current=d.slice(d.indexOf(".")+1):a.current=d||s[l].value;break;case"ds6w:who/ds6w:responsible":case"ds6w:responsible":s[l].dispValue?a.owner=s[l].dispValue:a.owner=s[l].value;break;case"ds6w:who/ds6w:responsible/ds6w:organizationResponsible":case"ds6w:organizationResponsible":s[l].dispValue?a.organization=s[l].dispValue:a.organization=s[l];break;case"ds6w:what/ds6w:status/ds6w:reserved":case"ds6w:reserved":s[l].dispValue?a.reserved=s[l].dispValue:a.reserved=s[l].value;break;case"ds6w:where/ds6w:context/ds6w:project":case"project":s[l].dispValue?a.project=s[l].dispValue:a.project=s[l].value;break;case"type_icon_url":a.type_icon_url=s[l].value}void 0===a.description&&(a.description=""),t.push(a)}console.log("for loop data in "+((new Date).getTime()-i)+"ms")}}return t}};return h}),define("DS/RequirementStructureBrowser/controllers/RootNodeController",["DS/Controls/TabBar","DS/RequirementStructureBrowser/components/StructureRootNodes"],function(e,t){"use strict";function n(n){var i=this;i.elements={},i.elements.container=UWA.createElement("div",{class:"enx-leftsidepanel"}),i.elements.leftHeaderdiv=document.createElement("div"),i.elements.leftHeaderdiv.classList.add("enx-left-header"),i.elements.container.appendChild(i.elements.leftHeaderdiv),i.elements.leftsidetabbar=new e({displayStyle:"strip"}),i.elements.leftsidetabbar.onContextualMenuEvent(function(){return Promise.resolve([])}),i.elements.leftsidetabbar.getContent().setStyle("width","calc(100% - 38px)"),i.elements.leftHeaderdiv.appendChild(i.elements.leftsidetabbar.getContent()),i.elements.leftContentdiv=document.createElement("div"),i.elements.leftContentdiv.classList.add("enx-left-content"),i.elements.container.appendChild(i.elements.leftContentdiv),i.elements.rootLst=new t(n),i.elements.leftsidetabbar.add({label:i.elements.rootLst.getTabLabel(),isSelected:!0,value:"rootlst",icon:{iconName:"list",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.elements.leftContentdiv.appendChild(i.elements.rootLst.getContent()),i.elements.leftsidetabbar.addEventListener("change",function(e){switch(e.dsModel.value[0]){case"rootlst":i.elements.rootLst.setVisible(!0)}})}return n.prototype.getContent=function(){return this.elements.container},n}),define("DS/RequirementStructureBrowser/requirementServices/ColumnMgtService",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","text!DS/RequirementStructureBrowser/assets/ColumnsMetas.json","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/TraceableRequirementsUtils/utils/LinkManager","DS/TraceableRequirementsUtils/Dictionary/TRMDictionaryAccess","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementNlsMgt"],function(e,t,n,i,r,o,s,a,l,u){"use strict";var c=JSON.parse(r),d=null,p=null,f=null;return t.singleton({init:function(e){this._parent(e)},initialize:function(e){d=e;return e.columnManager=this,this.loadedProviders=null,d.optionalStartup.push(this._fetchColumnNls()),this._loadColumnsProviders()},_fetchColumnNls:function(){var e=[];(this.getAvailableAttributes()||[]).forEach((t,n)=>e.push(t.ds6w));var t=a.getResourcesInfo(e);return new Promise(function(e,n){t.then(function(t){f=t.filter(e=>e.metaType).reduce((e,t)=>Object.assign(e,{[t.curi]:t.label}),{}),e()}).catch(function(t){console.log(t),f=[],e()})})},getVisibleAdditionalColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag&&e.isAdditionalColumn})},getVisibleColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag})},getAvailableColumnsWithNls:function(){var e=this.getAvailableColumns()||[];return Object.assign(f,this.getAllProvidedColumns().filter(e=>e.dataIndex).reduce((e,t)=>Object.assign(e,{[t.dataIndex]:t.text}),{})),e.map(function(e){return e.text=f[e.ds6w]?f[e.ds6w]:e.text?e.text:d.getNls(e.ds6w),e})},getColumnInfo:function(e){var t=this.getAvailableAttributes();return e=e.startsWith("attribute[")?e.substring(10,e.length-1):e,t.filter(function(t){return t.dataIndex===e||t.dbName===e})},getAvailableColumns:function(){var e=d.PrefService.getUserPreferences?d.PrefService.getUserPreferences().columns:[],t={};(e.forEach(function(e){t[e.dataIndex]=!0}),this.getAllProvidedColumns().forEach(function(n){switch(n.dataIndex){case"ds6w:refinedInto":case"ds6w:covers":let i=e.findIndex(e=>e.dataIndex==n.dataIndex);i>=0&&null==e[i].isAdditionalColumn&&(e[i].isAdditionalColumn=n.isAdditionalColumn,e[i].provider=n.provider);break;default:t[n.dataIndex]||e.push(n)}}),d.isAttributeManagmentEnabled())&&d.getCustomizedColumn().forEach(function(n){var i={dataIndex:"",dbName:"",text:"",kind:"",visibleFlag:!1},r=d.getDictionaryAttributes(n.dataIndex);r&&r.length>0&&(r=r[0]),t[r.sixWTag]||(i.dataIndex=r.sixWTag,i.dbName=r.attrName,i.text=r.attrNls,i.kind=r.type,i.visibleFlag=!!n&&!n.isHidden,e.push(i))});return t=null,e},getDGVVisibleColumns:function(e){let t=[],n=d.getSetting("defaultSelectors");e=e||l.determineAuthoredFlag();let i=this.getAvailableAttributes();return i&&(i=i.filter(function(e){return 1==e.visibleFlag})),!1===e?i.forEach(function(e){if("computed"!==e.nature){let n=e.ds6w;-1===t.indexOf(n)&&t.push(n)}else{let n=d.getSetting("computedIndex")[e.dataIndex];n?n.forEach(function(e){t.push(e)}):t.push(e.dataIndex)}}):(n=d.getSetting("defaultDBSelectors"),i.forEach(function(e){let n=e.dbName;switch(e.nature){case"attribute":n="attribute["+n+"]",-1===t.indexOf(n)&&t.push(n);break;case"computed":let i=d.getSetting("computedAuthor")[e.dataIndex];i&&i.forEach(function(e){t.push(e)});break;case"basic":n&&t.push(n)}})),(t=t.concat(n))&&(t=t.filter(function(e,t,n){return"attribute[covers]"!==e&&"attribute[refineInto]"!==e&&n.indexOf(e)===t})),t},getAvailableAttributeWithNls:function(){return(this.getAvailableAttributes()||[]).map(function(e){return e.text=e.text?e.text:d.getNls(e.ds6w),e})},getAvailableColumn:function(){var e=d.PrefService.getUserPreferences?d.PrefService.getUserPreferences().columns:[],t=[];return e.forEach(function(e){t.push(e.dataIndex)}),{available_columns:t}},getAvailableAttributes:function(){return(d.PrefService.getUserPreferences?d.PrefService.getUserPreferences().columns:[]).filter(function(e){return!e.isAdditionalColumn})},_getColumnsProvidersDefinitions:function(){return d.getColumnProviderSetting()},getAvailableAttributesForSearch:function(){let e=[];return this.getAvailableAttributes().filter(e=>e.visibleFlag).forEach(t=>{if("string"===t.kind||"enumString"===t.kind)if("computed"!==t.nature)e.push(t.ds6w);else{const n=d.getSetting("computedIndex")[t.dataIndex];n?n.forEach(t=>e.push(t)):e.push(t.ds6w)}}),e=e.filter(e=>e.indexOf(" ")<0)},getColumnsProviderWithMetas:function(e){var t=this._getColumnsProvidersDefinitions().find(function(t){return t.ID===e});return t&&this.loadedProviders?(t.instance=this.loadedProviders[e],t):null},getLoadedColumnProvidersAsArray:function(){var e=this;return this.getLoadedColumnProvidersIDAsArray().map(function(t){return e.getColumnsProviderWithMetas(t)})},_providerValidateAndRegister:function(e,t,n){return o.wrappedWithPromise(function(i,r){e.isAdditionalColumnsAvailable(function(r){!0===r&&(n[t||e.getName()]=e),i()})})},getLoadedColumnProvidersIDAsArray:function(){return this.loadedProviders?Object.keys(this.loadedProviders):[]},getAttributeMetas:function(e){return this.getAvailableAttributeWithNls().find(function(t){return t.dataIndex===e})},getAllProvidedColumns:function(){return this._retrieveProvidedColumns().map(function(e){return e})},getMappingOfAdditionalColumns:function(e){if(!e&&this._cachedAdditionalColumnsMapping)return this._cachedAdditionalColumnsMapping;var t={};return this._retrieveProvidedColumns().forEach(function(e){t[e.dataIndex]=e}),this._cachedAdditionalColumnsMapping=t},_retrieveProvidedColumns:function(){var e=[];return this.getLoadedColumnProvidersAsArray().forEach(function(t){if(t.instance&&"function"==typeof t.instance.getAdditionalColumnsUXDGV){var n=[];t.instance.getAdditionalColumnsUXDGV(n),e=e.concat(n.map(function(e){return e.provider=t.ID,e}))}}),e},retrieveAvailableColumnProviders:function(){var e=this;return o.wrappedWithPromise(function(t,n){e._loadColumnsProviders().finally(function(){try{var i=e.getLoadedColumnProvidersAsArray().filter(e._shouldLoadColumnProvider.bind(e));t(i)}catch(e){n(e)}})})},_shouldLoadColumnProvider:function(e){return"whole"===e.loadingPolicy||this.getVisibleAdditionalColumns().some(function(t){return t.provider===e.ID})},_getVisibleColumns:function(){var e=this.getVisibleColumns();return e.filter(function(e){return-1===["ChangeContext","Effectivity","VariantEffectivity","CurrentEvolutionEffectivity","ProjectedEvolutionEffectivity"].indexOf(e.ds6w)}),e},getAdditionalColumnDefinition:function(t){var n=this.getMappingOfAdditionalColumns()[t],i={};switch(t){case"ds6w:refinedInto":case"ds6w:covers":i=e.extend(n,s.getColumnDefinitions(n,t));break;default:i=e.extend(n,{getCellValue:function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid[t]},getCellValueForCopy:function(e){return e.cellModel.label}})}return i},_setCellValue:function(t,n,i){let r=this.getColumnInfo(n),o=r.length>0?r[0].dbName:null,s={grid:{}};d.DataService.updateAttribute(t,i,o).then(function(o){if(null!=o){"tree"===n&&(n=r[0].ds6w);let a=t.nodeModel.getKindOf();if(e.is(o.name)&&e.is(widget.displayNameSettings[a])){let e=l.computeDisplayName({name:o.name,title:l.decodeEntities(o["attribute[Title]"]),revision:o.revision},widget.displayNameSettings[a]);s.grid.displayName=e,s.label=e}s.grid[n]=l.decodeEntities(i),s.cestamp=o.cestamp,s.resourceid=o.physicalid,d.getModels().updateNodesByID({options:s})}})},_loadColumnsProviders:function(){var e=this;return e._cachedColProvPromise?e._cachedColProvPromise:o.wrappedWithPromise(function(t,n){if(e.loadedProviders)return t();e._cachedColProvPromise=d.loadFiles(e._getColumnsProvidersDefinitions().map(function(e){return e.loader})).then(function(){for(var n=arguments[0],i=[],r={},s=0;s<n.length;s++){var a=e._getColumnsProvidersDefinitions()[s],l=n[s];a&&l&&(i.push(e._providerValidateAndRegister(l,a.ID,r)),a.isInternal&&"function"==typeof l.bindApp&&l.bindApp(d))}o.allSettled(i).then(function(){e.loadedProviders=r,t(!0)})}).catch(function(e){n(e)})})},getDatagridViewColumns:function(){var t=this;t.getMappingOfAdditionalColumns(!0);var n=t._getVisibleColumns();return null==p&&(p=JSON.parse(JSON.stringify(d.defaultAttributeRange))),n.map(function(n){var i=n;return n.isAdditionalColumn?(i=t.getAdditionalColumnDefinition(n.dataIndex),e.extend(i,n)):i=t.getColumnDefinition(n),i}).filter(function(e){return e})},getColumnMetas:function(e){return c.common_column[e]&&c.common_column[e].options?c.common_column[e].options:{}},getColumnDefinition:function(t){var r=this,o=t.dataIndex;if(!o)return null;var s=r.getAttributeMetas(o),a=s.ds6wFrom&&"rel"===s.ds6wFrom?{iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}:void 0,l={};let c={...r.getColumnMetas(o)};switch(o){case"tree":l=e.extend(c,{text:s.text,icon:a,getCellKPIColor:function(e){if(e.nodeModel)return e.nodeModel.getColor()},getCellValue:function(e){return e&&e.nodeModel?this.isCellInEdition(e.cellID)?e.nodeModel.options.grid["ds6w:label"]:e.nodeModel.options.label:{}},setCellValue:function(e,t){if(0==t.length||""===t.trim())return i.warningAlert(d.getNls("Title_empty")),void e.nodeModel.updateOptions({});r._setCellValue(e,o,t)}});break;case"ds6wg:revision":l=e.extend(c,{text:s.text,icon:a,getCellValue:function(e){return e&&e.nodeModel?{label:e.nodeModel.options.grid[o]?e.nodeModel.options.grid[o]:"",url:"#UNEXISTANT_ID"}:{}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[o]},getCellValueForExport:function(e){if(e.nodeModel)return e.cellModel.label}});break;case"ds6w:reservedBy":case"ds6w:type":case"ds6w:identifier":l={text:s.text,dataIndex:o,icon:a};break;case"ds6w:reserved":l=e.extend(c,{text:s.text,icon:a,getCellValue:function(e){if(e&&e.nodeModel)return"FALSE"===e.nodeModel.options.grid[o]?n.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_CheckIn.png"):"TRUE"===e.nodeModel.options.grid[o]?n.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_lock.png"):"N/A"},getCellGroupingKey:function(e){return e.nodeModel.options.grid[o]},getCellValueForExport:function(e){if(e.nodeModel)return e.nodeModel.options.grid[o]}});break;case"ds6w:isLastRevision":l=e.extend(c,{text:s.text,icon:a,getCellValue:function(e){return e&&e.nodeModel?(!e.nodeModel.options.grid[o]||"false"!==e.nodeModel.options.grid[o].toString().toLowerCase())&&(!(!e.nodeModel.options.grid[o]||"true"!==e.nodeModel.options.grid[o].toString().toLowerCase())||{}):{}},getCellClassName:function(e){var t=[];return e.nodeModel&&(e.nodeModel.options.grid[o]&&"false"===e.nodeModel.options.grid[o].toString().toLowerCase()?t.push("dgv-isLastRevision-false"):e.nodeModel.options.grid[o]&&"true"===e.nodeModel.options.grid[o].toString().toLowerCase()&&t.push("dgv-isLastRevision-true")),t.join(" ")}});break;case"ds6w:status":case"ds6w:responsible":l=e.extend(c,{text:s.text,hyperlinkTarget:"_self",icon:a,getCellValue:function(e){return e&&e.nodeModel?{label:void 0===e.nodeModel.options.grid[o]?"":e.nodeModel.options.grid[o],url:"#UNEXISTANT_ID"}:{}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[o]},getCellValueForExport:function(e){if(e.nodeModel)return e.cellModel.label}});break;case"paramContent":l=e.extend(c,{text:d.getNls(o),typeRepresentation:"string",getCellValue:function(e){if(e&&e.nodeModel)return"PlmParameter"===e.nodeModel.options.reqKindOf||"PARParameter"===e.nodeModel.options.reqKindOf?e.nodeModel.options.grid.paramContent:void 0},getCellEditableState:function(e){return!1}});break;case"ds6w:description":l=e.extend(c,{text:s.text,typeRepresentation:"string",setCellValue:function(e,t){r._setCellValue(e,o,t)},getCellValue:function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid["ds6w:description"]},getCellEditableState:function(e){return!1}});break;case"ds6wg:Content Text":l=e.extend(c,{text:s.text,typeRepresentation:"string",getCellValue:function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid["ds6wg:Content Text"]},getCellTooltip:function(e){let t;if(null!=e.cellModel){if(e.cellModel.length<=206)t={shortHelp:e.cellModel.toString(),updateModel:!1};else{let n=e.cellModel.toString(),i=n.replace(/^(.{206}[^\s]*).*/,"$1");t={shortHelp:i,longHelp:n.replace(i,"").trim(),updateModel:!1}}return t}}});break;case"ds6wg:requirement category":l=e.extend(c,{text:d.getNls(o),typeRepresentation:"string",editionPolicy:"EditionOnDoubleClick",setCellValue:function(e,t){r._setCellValue(e,o,t)},getCellValue:function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid["ds6wg:requirement category"]}});break;case"ds6w:priority":case"ds6w:difficulty":case"ds6w:classification":case"ds6w:importance":return e.extend(c,{text:s.text,typeRepresentation:"enumString",setCellValue:function(e,t){t=p[s.dbName][t]?p[s.dbName][t]:t,r._setCellValue(e,o,t)},getCellSemantics:function(e){if("Requirement"===e.nodeModel.options.reqKindOf){var t=d.defaultAttributeRange[s.dbName];for(var n in t)t[n]=n;return{possibleValues:t}}return{possibleValues:[]}},getCellValue:function(e){if(e&&e.nodeModel){if("Requirement"===e.nodeModel.options.reqKindOf){var t=e.nodeModel.options.grid[o],n=p[s.dbName];return Object.keys(n).find(e=>n[e]===t)?Object.keys(n).find(e=>n[e]===t):t}return""}},getCellEditableState:function(e){if(e&&e.nodeModel&&"Requirement"===e.nodeModel.options.reqKindOf)return!0}});default:if(s){var f=d.getDictionaryAttributes(o);let t=f[0]?f[0]:s;f.length>1&&(t.isReadOnly=!0);let n="true"===t.isMultiValuated;t.attrNls&&!s.text&&(s.text=t.attrNls),"boolean"===s.kind&&(t.authorizedValues=["TRUE","FALSE"]);let i=t.preferredunitNls;if(f.length>0&&f[0].dimension){let e=Object.values(JSON.parse(localStorage.getItem("dimensionsMap"))[f[0].dimension].Units);for(let n of e)n.Name===t.preferredunitNls&&(i=n.NLSName)}l={text:s.text?i?s.text+" ("+i+")":s.text:i?d.getNls(o)+" ("+i+")":d.getNls(o),dataIndex:o,editionPolicy:"EditionOnDoubleClick"};let a=(t.authorizedValues?Object.keys(t.authorizedValues).length:0)>0;if(l.getCellTypeRepresentation=function(){let e=s.kind;if(t.dataType=e,n)return"string";if(a)e="enumString";else{if(-1!==["real","double"].indexOf(e.toLowerCase()))return"float";if(-1!==["datetime","timestamp"].indexOf(e.toLowerCase()))return"date"}return e},l.getCellValueForExport=function(e){if(e.nodeModel){let n=r._getCellValueToDisplay(e,t,o),i="";return n&&n.length>0?n.forEach(e=>{i=i?i+","+e:e}):i=n,i}},l.getCellValue=function(e){return r._getCellValueToDisplay(e,t,o)},l.setCellValue=function(n,i){if(-1!==["datetime","timestamp"].indexOf(s.kind.toLowerCase())&&null!==i&&(i=(i=new Date(i)).toGMTString()),t.authorizedValues){var a=t.authorizedValues;e.is(a)&&Object.keys(a).length>0&&(i=a[i])}t.dimension?d.DataService.getMKSValue(i,t.dimension,t.preferredunitNls).then(e=>{i=e.toString(),r._setCellValue(n,o,i)}):(i=i.toString(),r._setCellValue(n,o,i))},l.getCellEditableState=function(e){return!n&&r.getCellEditableState(e,t,o)},a)if(t.nlsCalculated)r._bindCellSemantics(l,o,t);else{let e={};e[t.sixWTag]=t.authorizedValues,u.retrieveNLS({nlsData:e}).then(function(e){r._updateCustoAttributeWithNlsRangeValues(e,t),r._bindCellSemantics(l,o,t)})}}}return l.kind=t.kind,l},getCellEditableState:function(e,t,n){if(!e.nodeModel)return!0;if("true"===t.isMultiValuated)return!1;try{var i=e.nodeModel,r=i.getType(),o=i.getReqInterface(),s=o||"",a=widget.getValue(r)?widget.getValue(r):[],l=t.extensionName;if(-1!==a.indexOf(l)||r===l||s.contains&&s.contains(l))return!1===t.isReadOnly}catch(e){return console.log(e),!1}return!1},_updateCustoAttributeWithNlsRangeValues:function(e,t){for(let n in e)if(e.hasOwnProperty(n)){let i=e[n],r={};for(let e in i)r[i[e]]=e;t.authorizedValues=r,t.nlsCalculated=!0}},_bindCellSemantics:function(t,n,i){let r=e.clone(i.authorizedValues);t.getCellSemantics=function(t){if(e.is(r)&&Object.keys(r).length>0){for(var i in r)r[i]=i;return void 0!==t.nodeModel.options.grid[n]?{possibleValues:r}:{possibleValues:[]}}}},_getCellValueToDisplay:function(t,n,i){var r=t.nodeModel.options.grid[i];if(""===(r=r||""))return"";var o=r.split(","),s=[];try{if(n.authorizedValues&&Object.keys(n.authorizedValues).length>0){Array.isArray(n.authorizedValues)&&(n.authorizedValues=n.authorizedValues.toString());var a=e.is(n.authorizedValues,"string")?JSON.parse(n.authorizedValues):n.authorizedValues;o.forEach(function(e){let t=Object.keys(a).find(t=>a[t]===e)?Object.keys(a).find(t=>a[t]===e):e;s.push(t)})}else if(-1!==["datetime","timestamp"].indexOf(n.dataType.toLowerCase())){for(var l=0;l<o.length;l++)if(""!==o[l]){isNaN(o[l])||(o[l]=parseInt(o[l]),o[l]=1e3*o[l]);let e=new Date(o[l]).toLocaleString("en",{month:"short",day:"numeric",year:"numeric"});s.push(e)}}else for(l=0;l<o.length;l++)s.push(o[l])}catch(e){for(l=0;l<o.length;l++)s.push(o[l]);console.log(e)}return s}})}),define("DS/RequirementStructureBrowser/components/RequirementCCP",["UWA/Class","DS/Logger/Logger","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/REQClipboard","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","DS/TraceableRequirementsUtils/utils/TRMReportPanel","DS/RequirementStructureBrowser/utils/RequirementsConstant","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(e,t,n,i,r,o,s,a,l,u,c,d,p){"use strict";var f=e.extend({init:function(){this._parent(arguments),this._acceptedNodes={},this._rejectedNodes={},this._relPattern=JSON.parse(p)},acceptNode:function(e){var t=!1,n=e.getPath(),i=n.length,r=n[0].getID();if(this._acceptedNodes.hasOwnProperty(r)){var o=this._acceptedNodes[r];if(o.depth<=i)o.nodes.push(e);else{var s=e.getFirstCommonAncestor(o.nodes[0]);o.nodes.length=0,o.nodes.push(s),o.depth=s.getPath().length,t=!0}}else this._acceptedNodes[r]={depth:i,nodes:[e]};return t},applyOnAcceptedNodes:function(e){var t=!0,n=!1,i=!1;for(var r in this._acceptedNodes)if(n=!0,UWA.is(r,"string"))for(var o=this._acceptedNodes[r].nodes,a=0;a<o.length;a++)e(o[a]);if(this._rejectedNodes.nonPSNodes)if(i=!0,1===this._rejectedNodes.nonPSNodes.nodes.length){var u=l.replace(l.copyNonPSNode,{label:this._rejectedNodes.nonPSNodes.nodes[0].getLabel()});s.warningAlert(u)}else if(this._rejectedNodes.nonPSNodes.nodes.length>=1){u=l.replace(l.copyNonPSNodes,{label:this._rejectedNodes.nonPSNodes.nodes.length});s.warningAlert(u)}return!0===i&&!1===n&&(t=!1),t}});function h(e){e.withBroadcastSelect(function(){var t=e.getXSO();if(!t.isEmpty()){var n=t.get(),i=!1;n.sort(function(e,t){var n=e.getDepth(),i=t.getDepth();return n===i?0:n<i?-1:n>i?1:void 0});var r=new f;if(n.forEach(function(e){i=r.acceptNode(e)||i}),i)e.unselectAll(),!0===r.applyOnAcceptedNodes(function(e){e.select()})&&s.warningAlert(l.reselectionFeedback)}})}function g(e,t){var n=e.getXSO();if(!n.isEmpty()){var i,o,a=n.get(),l={action:t,objects:[]},c=[];a.forEach(function(n){if(n.isVisible())if("PlmParameter"===(o=n.getType()))s.warningAlert(u.Requirement_Notif_CmdNotAvailable+" Selected object type: "+o);else{if(1===(i=n.getOccurencePath()).length&&t===d.MOVE_MODE)return s.warningAlert(u.Requirement_Notif_RootSelection),!1;l.objects.push({path:i,labelPath:n.buildPath()}),c.push(e.getNodeByOccurencePath(i))}}),0!=c.length&&(r.setData(r.OBJECT,l),t===d.MOVE_MODE&&v(c))}}var m=[];function v(e){m=e}function _(){return m}return e.extend({activeCutting:!1,activeNodes:[],getActiveNodes:function(){return _()},setStateCuttingNodes:function(e){e&&(this.activeCutting&&this.activeNodes.length>0&&this.setStateUncuttingNodes(this.activeNodes),e.forEach(function(e){e.updateOptions({isBeingCut:!0})}),this.activeCutting=!0,this.activeNodes=e)},setStateUncuttingNodes:function(e){e.length>0&&e.forEach(function(e){e.options.isBeingCut&&e.updateOptions({isBeingCut:!1})}),this.activeCutting=!1,this.activeNodes=[]},copy:function(){var e=this.getPADTreeDocument(),t=e.getSelectedNodes();this.uncut(),v([]),e.withBroadcastSelect(function(){e.withTransactionUpdate(function(){t.forEach(function(e){e.select()})})}),h(e),g(e,d.COPY_MODE)},cut:function(){var e=this.getPADTreeDocument();h(e),g(e,d.MOVE_MODE),this.options.model.setCuttingNodes(_()),this.setStateCuttingNodes(_())},uncut:function(){this.activeCutting&&(this.options.model.setCuttingNodes([]),this.setStateUncuttingNodes(this.activeNodes)),this.getPADTreeDocument().unselectAll(),r.isEmpty(r.OBJECT)||r.clear(r.OBJECT)},resetClipboard:function(){this.uncut()},_processTargets:function(e){var t,n=[],i=[];return e.forEach(function(e){e.isRoot()?n.push(e):(t=e.getID(),i.indexOf(t)<0&&(n.push(e),i.push(t)))}),n},_inputDataNew:function(e,t){var n=[],i=t[0].getID(),r=t[0].options.reqKindOf,o=this._relPattern[r];return e.forEach(function(e){var t=e.getKindOf(),s=e.getRelationID(),a=e.getID(),l=o[t]?o[t]:"";n.push({children:a,childrelationship:l,oldrelid:s,newparentID:i,newparenttype:r})}),n},_performInsertExting:function(e){var t={dataArray:[]};e.forEach(function(e){t.dataArray.push({pid:e.newparentID,id:e.children,relationship:e.childrelationship,previousSibling:{},nextSibling:{}})}),this.DataService.InsertExisting({json:t}),this.resetClipboard&&this.resetClipboard()},_performReorder:function(e,r){var l=this,p=o.get(),f=n.getSecurityContext(),h=[];e.forEach(function(e){h.push(e.oldrelid)});var g={version:d.REORDER_API_Version,target:{kind:"lastChild",parent:e[0].newparentID},rels:h,mode:r};i.reorder({securityContext:f,json:g,onComplete:function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;if("success"==t.status){var n=t.results,i=Object.keys(n),o=[];if(i.forEach(function(e){var t=l.getPADTreeDocument().getNodesByRelId(e)[0],i=l.DataService._createReorderResponce(e,t,g,n);o.push(i)}),o.length>0&&(r==d.COPY_MODE?l.refreshOnInsert(o,null,"insertExisting"):p.refreshOnDnD(o,!1),l.resetClipboard&&l.resetClipboard()),o.length>1)new c({title:"CutCopyPaste",reportData:{Success:o}});else if(o.length>0){var a=o[0],f=(UWA.is(a.type,"object")?a.type.displayName:a.type)+" "+a.name+" "+a.revision,h=u.CutCopyPaste_Success_msg;h=h.replace("{TNR}",f),s.sucessAlert(h)}}"error"==t.status&&s.errorAlert(t.message),l.endBlockingTransaction()},onFailure:function(e){var t=a.getParseErrorMessage(e);s.errorAlert(t),l.endBlockingTransaction()},onTimeout:function(e){t.warn("WS reorder.onTimeout");var n=a.getParseErrorMessage(e);s.errorAlert(n),l.endBlockingTransaction()}})},_distinguishInsertReparentCases:function(e,t){var n={insertExisting:[],reparent:[]};return e.forEach(function(e){!e.getRelationID()&&t===d.COPY_MODE?n.insertExisting.push(e):n.reparent.push(e)}),n},paste:function(){var e,t,n=this;this.setStateUncuttingNodes(_());var i=this.getPADTreeDocument(),o=0,a=0,c=i.getXSO();if(!c.isEmpty()){var p=c.get();if((a=(p=this._processTargets(p)).length)>1)return s.warningAlert(u.Requirement_Notif_MutliSelection),!1;if(!r.isEmpty(r.OBJECT)){var f=!1;_().length>0&&(f=!0);var h=r.consumeData(r.OBJECT,f),g=h.action;if(g&&(t=g===d.COPY_MODE?d.COPY_MODE:d.MOVE_MODE,e=function(e,t){var n=[];return e.objects.forEach(function(e){var i=t.getNodeByOccurencePath(e.path);if(i&&i.getOccurencePath().length===e.path.length)n.push(i);else{var r=e.labelPath.replace(/\/$/,"")+l.pasteObjectNotInView;s.errorAlertAlert(r)}}),n}(h,i)),function(e,t){var i=!1,r=(e[0].getID(),e[0].options.reqKindOf),o=n._relPattern[r];return t.forEach(function(e){var t=e.options.reqKindOf;o&&o[t]||(i=!0)}),i}(p,e))return s.warningAlert(u.Requirement_Notif_CmdNotAvailable),!1;if(e.length>0){var m=n._distinguishInsertReparentCases(e,g);o=e.length}if(a*o>1e3)return void s.errorAlert(u.limit_cut_paste);if(m.insertExisting.length>0){n.beginBlockingTransaction(l.composite);var v=n._inputDataNew(e,p);n._performInsertExting(v)}if(m.reparent.length>0){n.beginBlockingTransaction(l.composite);v=n._inputDataNew(e,p);var S=t;n._performReorder(v,S)}}}}})}),define("DS/RequirementStructureBrowser/treemodel/RequirementTreeDocument",["DS/Tree/TreeDocument","DS/PADUtils/PADSettingsMgt","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/RequirementStructureBrowser/treemodel/RequirementWSAccess","i18n!DS/PADUtils/assets/nls/PADUtils.json","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/TraceableRequirementsUtils/REQCommandProxy","DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","DS/RequirementStructureBrowser/treemodel/RequirementNodeModel","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/treemodel/ReqTransactionManager","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json"],function(e,t,n,i,r,o,s,a,l,u,c,d,p,f,h,g,m){"use strict";return e.extend(h,{name:"pad_treedocument",_insertFlag:!0,req_navigate_options:{},_selected_paths:[],_active_cutting_nodes:[],defaultOptions:{nodeModelClass:p},reroderSpecTypes:["Chapter","Comment","Requirement","Requirement Specification","Specification Folder"],externalTypes:["ProxyItem"],_relPattern:null,nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},init:function(e){var t=e||{};UWA.is(t.shouldAcceptDrop)||(t.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),UWA.is(t.shouldAcceptDrag)||(t.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),this._parent(t),this.getXSO().onPostAdd(this.selectionUpdated.bind(this)),this.getXSO().onPostRemove(this.selectionUpdated.bind(this)),this.onPreExpand(this.expand.bind(this)),this.reqCommandProxy=s.create(),this._relPattern=JSON.parse(l),this.req_navigate_options=JSON.parse(o),this.onNodeModelUpdate(this.onNodeModelUpdateRequirement),this.subscribeModelEvents(),this},initialize:function(e){this.app=e},subscribeModelEvents:function(){var e=this;e.getModelEvents().subscribe({event:"onRootAdded"},function(t){var n=t.data.added_nodes,i=e.getRoots(),r=[];i.forEach(function(e){r.push(e.getID())}),e.app.PersistencyManager.saveUserWorkingRootNodes(r),n&&n.forEach(function(t){e.app.PersistencyManager.addRecentItem(t.getID())}),n&&e.app._localModelEvent.publish({event:"RequirementStructureBrowser-Root-manage",data:{added_nodes:n}})}),e.getModelEvents().subscribe({event:"onRemoveRoot"},function(t){var n={pids:[t.data.pid]};e.app._localModelEvent.publish({event:"RequirementStructureBrowser-Root-remove",data:n})})},shouldAcceptDrag:function(e,t){return!0},selectionUpdated:function(e){this.getSelectedNodes();this.app.active_view!==f.VIEW_STRUCTURE_BROWSER||this.app.richViewDropIn||this.updateStructureEditorDGV(),this.app.richViewDropIn=!1},setFilterBIProxy:function(e){this.options.filterBI=e},onNodeModelUpdateRequirement:function(e){if(e&&!UWA.is(e,"function")){var t=e.data.nodeModel;n.process.updateNodeModel(t)}},expand:function(e){let t=this,n=e.data.expandAll,i=e.data,r=i.nodeModel,o=i.numberOfLevelsToExpand&&1!=i.expandAll?i.numberOfLevelsToExpand.toString():"-1",s=u.determineAuthoredFlag(),a=i.expandAll?-1:parseInt(o);if(t.expandRequired(r,n)){t.app.beginBlockingTransaction(),t.resetLocalFilters();let i=t.prepareExpandPayload(r,s,o,n);t.performExpand(i,s,r,a,n,e)}else e.target&&e.target.preExpandDone({preventExpandAll:!0})},expandRequired:function(e,t){return!(!this.app.getSelectedNodes().map(e=>e.getID()).includes(e.getID())&&t)&&!(e.options.childComputed&&!t)},performExpand:function(e,t,i,r,o,s){let a=this;a.app.DataService.getExpandData(e,function(e){e&&!e.results&&!t&&u.determineAuthoredFlag()&&a.expand(s),e.results&&n.process.expand({treedocument:a,BIProxy:a.options.filterBI,response:e.results,authored:t,rootNodes:[i],expandLevel:r}).then(function(){a.handleExpandResponse(i,o)}).catch(function(e){console.log(e)}),a.app.endBlockingTransaction(),setTimeout(()=>{t&&a.updateParameterValues([i])},100)})},handleExpandResponse:function(e,t){t?(this.changeStructureExpandedState(e,"expanded",!0),e.preExpandDone({preventExpandAll:!1})):(e.options.childComputed=!0,e.preExpandDone())},prepareExpandPayload:function(e,t,n,i){let r=this,o=r.app.getSetting("expand").cv_expand_data.folder_expand,s=UWA.extend({type_filter:o.type_filter_bo,rel_filter:o.type_filter_rel,object_selects:r.app.columnManager.getDGVVisibleColumns()});if(t)s.relationship_selects=["physicalid[connection]","attribute[TreeOrder]","from.physicalid"],s.withRoot=!0,s.root_physical_id=e.getID(),i||(s.level=n);else{let t=e.getID();s.select_relation=o.select_rel,s.paths=[t],s.rootID=t,s.expand_iter=n,s.BIProxy=r.options.filterBI}return s},expandToPath:function(e){let t=this,i=e[0],r=[],o=[],s=new Map;for(let t=2;t<e.length;t+=2)r.push(e[t]),o.push(e[t-1]);r.length>0&&t.app.DataService.getObjectInfo({physicalid:r}).then(function(e){let a=t.getRoots().find(e=>e.getID()===i);e.results.forEach(function(e){if(!s.get(e.resourceid)){let i=n.process.createNode({treedocument:t.app,data:e,tenant:u.getTenant()},t.externalTypes);s.set(i.getID(),i)}});let l=0;r.forEach(e=>{let t=s.get(e);t.setRelationID(o[l++]),a.addChild(t),a=t});let c=t.getRoots().find(e=>e.getID()===i);t.changeStructureExpandedState(c,"partiallyExpanded",!1),a.setState({state:"collapsed"}),a.select(),t.setScrollerPositionToNode(a)})},changeStructureExpandedState:function(e,t,n){if(e&&t)try{let i=this;i.prepareUpdate(),u.changeExpandStateForStructure(e,t,n),i.pushUpdate()}catch(e){console.error(e)}},setScrollerPositionToNode:function(e){if(!e)return;let t=this.app.getActiveDGV(),n=t.layout.getRowPosition(e._getRowID());t.setScrollerPosition({y:n})},refresh:function(e){let t=e&&e.roots;if(t||(t=this.getRoots()),0===t.length)return void c.notifyAlert(m.WIDGET_REFRESH_DONE);this.app.beginBlockingTransaction();let n=u.determineAuthoredFlag();this.performRefresh(e,t,n)},performRefresh:function(e,t,i){let r=this,o=0;t.forEach(function(s){let a=u.calculateMaxDepth(s)+1;a=i&&a<=0?"1":a.toString();let l=r.prepareExpandPayload(s,i,a,!1);r.app.DataService.getExpandData(l,function(l){l&&!l.results&&!i&&u.determineAuthoredFlag()?r.refresh(e):l.results?n.process.refresh({treedocument:r,BIProxy:r.options.filterBI,response:l.results,authored:i,rootNodes:[s],expandLevel:parseInt(a),refresh:!0}).then(function(){if(o==t.length-1){r.app.endBlockingTransaction();var e=r.app.getActiveDGV();e.requestDelayedModelData&&e.requestDelayedModelData("SyncModelRefresh"),setTimeout(()=>{!0===i&&r.updateParameterValues(t),c.notifyAlert(m.WIDGET_REFRESH_DONE)},100)}o++}):r.app.endBlockingTransaction()})})},updateParameterValues:function(e){var t=this;setTimeout(function(){let i=[];t.getIdsOfType(e,f.TYPE_PARAMETER,i);for(var r="",o=0,s=o+100;i.length>o;)r=i.slice(o,s),o+=100,s+=100,a.getInfo({pid:r,selectables:"attribute[Title],physicalid,physicalid[connection],interface,level,type.kindof,cestamp",onComplete:function(e){e=u.parseResponse(e);var r={modified:i};n.process.refresh_nodes({treedocument:t,response:e,refresh_data:r,BIProxy:t.options.filterBI})},onFailure:function(e){console.log("RequirementWebServices.updateParameterValues = "+e);var t=d.getParseErrorMessage(e);c.errorAlert(t)},onTimeout:function(e){var t=d.getParseErrorMessage(e);c.errorAlert(t)}})},200)},expandMultiSelect:function(e){for(var t=0;t<e.nodes2Expand.length;t++)e.nodes2Expand[t].expandAll()},setDnDBehavior:function(e){this._copyMode=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},updateStructureEditorDGV:function(){var e=this.app.getSelectedNodes()[0];if(e){var t=e.options,n=e.options.reqKindOf;if(e.isRoot()||n===f.TYPE_REQUIREMENT_SPECIFICATION||"DOCUMENTS"===n){var i={paths:[e.options.resourceid],appId:widget.getValue("appId")};this.reqCommandProxy.drop(i)}this.app._padCommandProxy.select(this._buildSelectData()),t=e.getRoot().options,this.app._applicationChannel.publish({event:"structure-editor-add-title",data:t})}this.app._onSelect()},_buildSelectData:function(){var e=[],n=this._selected_paths;!0===t.getSetting("add_objects_when_select")&&n.length&&this.getXSO().get().length?this.getRoots().forEach(function(t){for(var i=0;i<n.length;i++){var r=t.getNodeByPath(n[i],void 0,void 0,!0);r&&e.push(r)}}):e=this.getXSO().get();var i,r={paths:[],tenant:u.getPlatformId()};r.attributes={},r.version="1.1";i=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(r),r.paths=e.map(function(e){return e.getOccurencePath(i)});var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");try{r.changeControl=o.get()}catch(e){console.warn("No Change")}return this._currentApp=u.getSharedId(),r.sharedID=this._currentApp,null===this._pagerview&&!0!==this._focusOn?r.focusOn=!1:r.focusOn=!0,r},selectFromTagger:function(e){var t=this;let n=u.determineAuthoredFlag();if(n)return c.warningAlert(m.SelectFromTaggerAuthoringMode),void t.options.filterBI.setSelectStatus({status:!0});var i=t.getRoots(),r=e||null;r=UWA.is(r,"string")?JSON.parse(r):r,i.forEach(function(e){t.resetLocalFilters();let i=t.prepareExpandPayload(e,n,1,!0);i.tagger_select=r,i.format="entity_relation_occurrence",i.matching_lengths=1,t.performTaggerSelect(i,n,e,1,!0)})},performTaggerSelect:function(e,t,i,r,o){let s=this;s.app.DataService.getExpandData(e,function(e){if(e.results){try{let o=n.process.addRemainingStructure({treedocument:s,BIProxy:s.options.filterBI,response:e.results,authored:t,rootNodes:[i],expandLevel:r});if(o&&o.length>0)if("collapsed"==i.getState()&&i.setState({state:"partiallyExpanded"}),o.forEach(function(e){e.children.forEach(function(e){let t=s.getNodesById(e.physicalid)[0];s.changeStructureExpandedState(t,"partiallyExpanded",!0)})}),e.matchedNode&&e.matchedNode.length>0){e.matchedNode.forEach(function(e){s.getNodesById(e).forEach(function(e){e.select()})});let t=m.ObjectsSelected.replace("{Nb}",e.matchedNode.length);c.notifyAlert(t),s.app.reqCommandProxy.select(s._buildSelectData())}else{let e=m.NothingToSelect.replace("{TNR}",i.getLabel());c.warningAlert(e)}}catch(e){console.error(e)}s.options.filterBI.setSelectStatus({status:!0})}s.app.endBlockingTransaction()})},calculateColoredSubject:function(e,t){var n=new Map;return e.forEach(function(e){var i,r,o;if(e.attributes.forEach(function(e){"resourceid"==e.name&&(i=e.value),"ds6w_facet"==e.format&&(o=e)}),o&&"date"==o.type){let e=new Date(o.value),n=e.toLocaleString("en",{year:"numeric"});r=n,t.get(r)||(n=e.toLocaleString("en",{month:"numeric"}),r=r+"/"+String(n).padStart(2,0)),t.get(r)||(n=e.toLocaleString("en",{day:"numeric"}),r=r+"/"+String(n).padStart(2,0))}else if(o&&UWA.is(o.value,"array")){var s;o.value.forEach(function(e){s=s?s+"/"+e:e,t.get(s)&&(r=s)})}else o&&(r=o.value);n.set(i,t.get(r))}),n},applyColor:function(e){if(void 0!==e){var t=new Map;e.tagColors.forEach(function(e){t.set(e.object,e.color)});var n=e.tagColors[0].predicate.split("/"),i=n.length?n[n.length-1]:"";if(this.getRoots()){let e=this.getRoots();for(var r=0;r<e.length;r++)this.federatedSearch(e[r],t,i)}}else this.getRoots().forEach(function(e){e.resetColor(),e.getAllDescendants().forEach(function(e){e.resetColor()})})},federatedSearch:function(e,t,n,i){var r=this;a.fetchPredicateData({predicate:n,RootIDs:[e.getID()],next_start:i,query:"[ds6w:policy]:*Requirement* OR [ds6w:policy]:Comment OR [ds6w:policy]:Chapter OR [ds6w:policy]:ParameterAggregation",onComplete:function(i){var o,s=UWA.is(i,"string")?JSON.parse(i):i;s&&s.infos&&s.infos.nhits&&s.infos.next_start&&s.infos.nhits>s.infos.next_start.split(" ")[0]&&r.federatedSearch(e,t,n,s.infos.next_start),s&&s.results&&(o=r.calculateColoredSubject(s.results,t)),o.has(e.options.resourceid)&&e.setColor(o.get(e.options.resourceid)),e.getAllDescendants().forEach(function(e){o.has(e.options.resourceid)&&e.setColor(o.get(e.options.resourceid))})},onFailure:function(e,t){var n=d.getParseErrorMessage(e,t);c.errorAlert(n)},onTimeout:function(e){var t=d.getParseErrorMessage(e);c.errorAlert(t)}})},applyFilter:function(e){var t,n=this.getRoots(),i=[];if(null===e)for(e={},t=0;t<n.length;t++)i.push(n[t].getID());else e.root_physicalid&&i.push(e.root_physicalid);var r=!1;if(void 0!==e.filterRootIds){var o=this;o.resetLocalFilters(),this.withTransactionUpdate(function(){for(t=0;t<e.filterRootIds.length;t++){var n=o.searchRootById(e.filterRootIds[t]);if(n)if(!0===e.empty){if(delete n.options.filtered,n.options.CVQuery=null,n.options.sequence_filter=null,n.options.config_filter=null,n.options.icons&&n.options.icons.length)"string"==typeof(l=UWA.clone(n.options.icons[0]))&&(l={iconPath:"url("+l+")"}),l.badges={bottomRight:null},n.updateOptions({icons:[l]});n.options.childComputed=!1,n.options.children=[],n.collapseAll(),n.removeChildren(),n.setState({state:"collapsed"})}else{if(r=!0,n.options.filtered=!0,n.options.CVQuery=e.CVQuery,e.CVQuery&&e.CVQuery.union&&e.CVQuery.union.expand)for(var i=!0,s=0;s<e.CVQuery.union.expand.length&&i;s++){1===(a=e.CVQuery.union.expand[s].root_path_physicalid).length&&-1!==a[0].indexOf(n.getID())&&(n.options.sequence_filter=e.CVQuery.union.expand[s].sequence_filter,n.options.config_filter=e.CVQuery.union.expand[s].config_filter)}else if(e.CVQuery&&e.CVQuery.intersection&&e.CVQuery.intersection.expand)for(i=!0,s=0;s<e.CVQuery.intersection.expand.length&&i;s++){var a;1===(a=e.CVQuery.intersection.expand[s].root_path_physicalid).length&&-1!==a[0].indexOf(n.getID())&&(n.options.sequence_filter=e.CVQuery.intersection.expand[s].sequence_filter,n.options.config_filter=e.CVQuery.intersection.expand[s].config_filter)}else n.options.sequence_filter=null,n.options.config_filter=null;var l;if(n.collapseAll(),n.removeChildren(),n.options.children=[],n.setState({state:"collapsed"}),n.options.childComputed=!1,n.options.icons&&n.options.icons.length)"string"==typeof(l=UWA.clone(n.options.icons[0]))&&(l={iconPath:"url("+l+")"}),l.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},n.updateOptions({icons:[l]})}}})}else console.warn("Structure Editor: No filterRootIds properties");r&&this.showAppliedFilter(e)},showAppliedFilter:function(e){for(var t=0;t<e.filterRootIds.length;t++){var n=this.searchRootById(e.filterRootIds[t]);if(n){n.options.CVQuery=e.CVQuery,n.select();let t={data:{expandAll:!0,nodeModel:n,numberOfLevelsToExpand:"-1"}};this.expand(t)}}},searchRootById:function(e){var t,n=this.getRoots(!0);this.hasOwnProperty("detachedRoots")&&(n=n.concat(this.detachedRoots));for(var i=0;i<n.length;i++)if(n[i].options.resourceid===e){t=n[i];break}return t},checkIfRootAlreadyExist:function(e){var t=!1;this.getRoots(!0).forEach(function(n){if(e.includes(n.getID())){let i=e.indexOf(n.getID());e.splice(i,1),t=!0}}),1!=t||this.app.richViewDropIn||c.notifyAlert(m.rootExist),this.app.richViewDropIn=!1},_viewInsertExisting:function(e){if(!(e.modified&&e.inserted&&e.created))throw new Error("Invalid input parameters "+JSON.stringify(e));var o,s=[];for(o=0;o<e.modified.length;o++)s.push(this.getNodesById(e.modified[o]));var a=this;i.fetch({enopad_webapis:t.getSetting("enopad_webapis"),pids:e.inserted,authored:!0,onComplete:function(t){a.prepareUpdate(),a.invalidateViewPort();var i=UWA.is(t,"string")?JSON.parse(t):t;!i.results||i.results.length<e.inserted.length?c.errorAlert(r.object_not_found_in_db):i.results.length>e.inserted.length?c.errorAlert(r.tooManyResults):a.wrapInTransaction(function(){i.results.forEach(function(t){var i=e.inserted.indexOf(t.resourceid);t.relationid=e.created[i],a.externalTypes=["ProxyItem"];var r=n.process.createNode({treedocument:a.app,data:t,tenant:u.getTenant()},a.externalTypes);r.options.relationid=e.created[i],a.app.DataService.getExpandData(r).then(function(e){var t=s[i];t&&t.forEach(function(e){e.getChildById(r.options.resourceid)||(e.addChild(r),e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded")}),a.pushUpdate()}).catch(function(e){console.error(e)})})})},onFailure:function(){var t=d.getParseErrorMessage(null,null,r.generic_service_failure);c.errorAlert(t),e.callback&&e.callback.call()}})},_viewDetach:function(e){if(!e.deleted)throw new Error("Invalid input parameters "+JSON.stringify(e));var t=this;this.withTransactionUpdate(function(){for(var n=0;n<e.deleted.length;n++){t.getNodesByRelId(e.deleted[n]).forEach(function(e){e.getParent().removeChild(e)})}})},_viewReParent:function(e){this._viewInsertExisting(e),this._viewDetach(e)},removeRoot:function(e,t,n){var i=this;if(this.wrapInTransaction(function(){var r=i.hasOwnProperty("detachedRoots")?i.detachedRoots.indexOf(e):-1;if(r>=0)i.detachedRoots.splice(r,1);else if(i.invalidateViewPort(),i.getRoots().indexOf(e)>=0&&i._parent(e,t,n),(!UWA.is(n,"boolean")||!n)&&UWA.is(i._getChildrenFilterInfo,"function")){var o=i._getChildrenFilterInfo();if(o&&UWA.is(o.childrenBeforeFiltering,"array")){var s=o.childrenBeforeFiltering.indexOf(e);s>=0&&o.childrenBeforeFiltering.splice(s,1)}}}),!UWA.is(t,"boolean")||!t){var r=this.getRoots().length;0===r&&UWA.is(this.detachedRoots,"array")&&(r=this.detachedRoots.length),this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:e.getID(),remainingRoots:r}}),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:1===this.getRoots().length?this.getRoots()[0]:null,nb_root:r}}),this.getModelEvents().publish({event:"onReqAdded",data:{isremove:!0,added_node:1===this.getRoots().length?this.getRoots()[0]:null,nb_root:r}})}},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},updateNodesByID:function(e,t){var n=this,i={authored:{modified:[]}},r=e.options,o=r.resourceid,s=[];s=n.getNodesById(o);var a={grid:r.grid,label:r.label,cestamp:r.cestamp};s&&s.forEach(function(e){n.prepareUpdate(),e.updateOptions(a),n.pushUpdate()}),n.updateProviderColumns(s,"OnSyncModel"),t||(i.authored.modified.push(o),this.app._padCommandProxy.refresh(i))},updateProviderColumns:function(e,t){var n=this;n.app.columnManager.retrieveAvailableColumnProviders().then(function(i){if(i.length>0){var r={};n.buildProviderJson(e,i,r,t);for(var o=[],s=0;s<i.length;s++){let e=i[s].instance,t=e.getName();if(r[t])if("CoverRefineColumn"==t){var a=r[t].pids;e.updateAttributes(n,a)}else{var l=g.wrappedWithPromise(function(i,o){e.updateAttributes(r[t],function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;i(t),o("Error in Cfg_updateAttributes")},n)});o.push(l)}}o.length&&g.all(o).then(function(e){for(var t={},i=!1,r=0;r<e.length;r++){let n=e[r];if(!i){let e=Object.keys(n.pids),t=Object.keys(n.relids);i=e.length>0&&0===t.length}UWA.extend(t,e[r],!0)}for(var o=Object.getOwnPropertyNames(t.pids),s=Object.getOwnPropertyNames(t.relids),a=[],l=0;l<s.length;l++){(c=n.getNodesByRelId(s[l]))&&c.length&&c.forEach(e=>{var i=t.relids[s[l]];i&&(i.VariantEffectivity&&"function"==typeof i.VariantEffectivity.trim&&0===i.VariantEffectivity.trim().length&&(i.VariantEffectivity=n.app.getNls("Label_None")),i.CurrentEvolutionEffectivity&&"function"==typeof i.CurrentEvolutionEffectivity.trim&&0===i.CurrentEvolutionEffectivity.trim().length&&(i.CurrentEvolutionEffectivity=n.app.getNls("Label_None")),i.ProjectedEvolutionEffectivity&&"function"==typeof i.ProjectedEvolutionEffectivity.trim&&0===i.ProjectedEvolutionEffectivity.trim().length&&(i.ProjectedEvolutionEffectivity=n.app.getNls("Label_None")),e.updateProviderColumnValues({grid:i}));var r=e.getID();-1!==o.indexOf(r)&&a.push(r)})}i||a.length>0&&a.forEach(function(e){var t=o.indexOf(e);-1!==t&&o.splice(t,1)});for(var u=0;u<o.length;u++){var c;(c=n.getNodesById(o[u]))&&c.length&&c.forEach(e=>{let n=t.pids[o[u]];e.isRoot()?n&&e.updateProviderColumnValues({grid:n}):(n={ChangeContext:t.pids[o[u]].ChangeContext,ConfigurationContext:t.pids[o[u]].ConfigurationContext},e.updateProviderColumnValues({grid:n}))})}}).catch(e=>{console.log("An Error Occured")})}else console.info("No provider Columns Module")})},refreshNodeById:function(e){var t=[],i=this,r=[];return UWA.is(e.created)&&(t=t.concat(e.created)),g.wrappedWithPromise(function(o,s){if(UWA.is(e.modified)&&UWA.is(e.modified,"array")&&i.withTransactionUpdate(function(){e.modified.forEach(function(e){if(UWA.is(e,"object")){var n=e.physicalid;if(UWA.is(e.attributes,"array")){var o=i.getNodesById(n),s=i.app.columnManager.getVisibleColumns();o.forEach(function(t){t.updateAttributes(e.attributes,s)})}else t.push(n),r.push(n)}else t.push(e)})}),e.deleted&&e.deleted.length>0){var a=[],l=[];if(e.deleted.forEach(function(e){var t=i.getNodesById(e);t&&0!==t.length||(t=i.getNodesByRelId(e)),t.forEach(function(t){t.isRoot()?a.push(e):l.push(t)})}),l.length>0&&i.deleteNodes(l),a.length>0)require("DS/RequirementStructureBrowser/utils/TRMModelEvent").getModelEvents().publish({event:"TRMViews-WelcomePanel-clearAll",data:{item2remove:a}})}if(t.length>0){let r=u.getChunks(t,250),s=r.length;for(let t=0;t<s;t++)i.app.DataService.getObjectInfo(r[t]).then(function(t){n.process.refresh_nodes({treedocument:i,response:t,refresh_data:e,BIProxy:i.options.filterBI});let r=i.app.getActiveDGV();r.requestDelayedModelData&&r.requestDelayedModelData("SyncModelRefresh"),o(!0)})}else o(!0)})},resetLocalFilters:function(){const e=this.getFilterManager();if(e.isDataFiltered()){let t=Object.keys(e._listOfFilters);for(let n in t)e.resetPropertyFilterModel(t[n])}},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},deleteNodes:function(e,t){var n=this;this.wrapInTransaction(function(){n.withTransactionUpdate(function(){var i={detach:{deleted:[]}};e.forEach(function(e){if(e.isRoot())n.removeRoot(e);else{var t=e.getParent(),r=t.getState();e.remove(),i.detach.deleted.push(e.getID()),"partiallyExpanded"!==r||t.options.children||(t.options.children=[],t.setState({state:"collapsed"}))}}),!0===t&&n.reqCommandProxy.refresh(i)})})},insertNodes:function(e,t,n){var o=this,s=[];e.forEach(function(e){s.push(e.resourceid),s.push(e.parentID),e.oldParentID&&s.push(e.oldParentID)}),s=s.filter(function(e,t,n){return n.indexOf(e)===t}),this._beginBlockingTransaction("Inserting nodes..."),i.fetch({pids:s,authored:!0,onComplete:function(i){i=u.parseResponse(i);var r=UWA.is(i,"string")?JSON.parse(i):i;if(0===r.results.length)throw new Error("Cannot find object with the physicalid "+s);if(r.results.length!==s.length)throw new Error("More results than input objects");for(var a=0;a<e.length;a++)for(var l=0;l<r.results.length;l++){var c=r.results[l];e[a].resourceid===c.physicalid&&null!=e[a].treeOrder?c.relationOrder=e[a].treeOrder:c.relationOrder=n}g.wrappedWithPromise(function(){o.insert_nodes({treedocument:o,response:r,insert_parameters:e,beforeNode:t})},"insert_nodes"),o._endBlockingTransaction()},onFailure:function(e){var t=d.getParseErrorMessage(null,null,r.generic_service_failure);c.errorAlert(t),o._endBlockingTransaction()}})},insert_nodes:function(e){var t=this;if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.insert_parameters,"array"))throw new Error("Invalid input parameters");for(var i=0;i<e.insert_parameters.length;i++)for(var r=e.insert_parameters[i],o=0;o<e.response.results.length;o++){var s=e.response.results[o],a=[];e.treedocument.getRoots().forEach(function(e){a=a.concat(e.getNodesById(r.parentID))});var l=s;e.treedocument.withTransactionUpdate(function(){a.forEach(function(i){if(s.resourceid===r.resourceid){t.externalTypes=["ProxyItem"],l.relationid=r.relationid;var o=n.process.createNode({treedocument:e.treedocument.app,data:l,tenant:u.getTenant()},t.externalTypes);if(t.prepareUpdate(),UWA.is(e.beforeNode)&&null!=e.beforeNode)i.addChild(o,e.beforeNode+1);else if(UWA.is(r.treeOrder)&&null!=r.treeOrder){var a=i.getChildren(),c=r.treeOrder,d=0;if(a&&a.length>0)for(;d<a.length;){if(parseFloat(a[d].options.relationOrder)>parseFloat(c)){if(o.options.resourceid===a[d].options.resourceid){a[d].options.relationOrder=c;break}o.options.relationOrder=c,i.insertBefore(o,a[d]);break}if(d==a.length-1){o.options.relationOrder=c,i.addChild(o);break}d++}else o.options.relationOrder=c,i.addChild(o)}else i.addChild(o);t.pushUpdate();let s={data:{nodeModel:i,numberOfLevelsToExpand:"1"}};t.expand(s),i.expand(),t.getModelEvents().publish({event:"onChildAdded",data:o})}else if(s.resourceid===r.parentID||s.resourceid===r.oldParentID){let e=t.getNodesById(s.resourceid);var p={cestamp:s.cestamp};e[0].updateOptions(p),t.updateProviderColumns(e,"OnSyncModel")}})})}},_shouldAcceptDrop:function(e){return!0},_shouldAcceptDrag:function(e,t){return!0},getDefaultType:function(e){var t=e.replace(" ","_"),n=widget.getPreference("trm_types_"+t);return UWA.is(n)?widget.getValue("trm_types_"+t):e},getTenant:function(){return require("DS/TraceableRequirementsUtils/Utils").getTenant()},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[],n=this;n&&n.wrapInTransaction(function(){n.withTransactionUpdate(function(){n.addRoot(e);for(var i=0;i<e.length;i++)t.push(e[i].getID());n.getRoots().length;UWA.is(n.detachedRoots,"array")&&n.detachedRoots.length,n.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n.getRoots().length,added_nodes:e}})})})},multiselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.add(e),this.pushUpdate()},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){this.app.reqCommandProxy.select(this._buildSelectData()),this._doNotBroadcastSelect=!1},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},buildProviderJson:function(e,t,n,i){t.forEach(function(t){var r=t.instance,o=r.getManagedColumnNames(),s={},a=r.getName();e.forEach(function(e){for(var t=0;t<o.length;t++){var l=e.options.grid[o[t]];s[o[t]]=l}if(1==r.toBeUpdated(s,i,e)){void 0===n[a]&&(n[a]={pids:[],relids:[],pairs:{}});var u=e.getID();-1===n[a].pids.indexOf(u)&&n[a].pids.push(u);var c=e.getRelationID();c&&-1===n[a].relids.indexOf(c)&&!e.isRoot()&&(n[a].relids.push(c),n[a].pairs[u]=c)}})})},getIdsOfType:function(e,t,n){var i=this;e.forEach(function(e){if(e.options.type==t)-1==n.indexOf(e.options.resourceid)&&n.push(e.options.resourceid);else{var r=e.getChildren()?e.getChildren():[];i.getIdsOfType(r,t,n)}})},retrieveNodesByIdsInMultiStructure:function(e){var t=this,n=[];return e.forEach(function(e){t.getRoots().forEach(function(t){var i=t.getNodesById(e);n=n.concat(i)})}),n},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(n){var i=n.getNodesById(e);t=t.concat(i)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),n=0;n<t.length;n++){var i=t[n].getNodeByPath(e,void 0,void 0,!0);if(i)return i}},getNodesByRelId:function(e){var t=[];return this.getRoots().forEach(function(n){var i=n.getNodesByRelId(e);t=t.concat(i)}),t}})}),define("DS/RequirementStructureBrowser/views/TRMDataGridView",["UWA/Core","DS/DataGridView/DataGridView","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/ApplicationFrame/CommandsManager","DS/Core/PointerEvents","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","DS/RequirementStructureBrowser/components/RequirementContextualMenu","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","DS/RequirementStructureBrowser/utils/RequirementsConstant"],function(e,t,n,i,r,o,s,a,l,u,c){"use strict";function d(e){this.name="trm-dgv",this._version=.1,this.options={renderTo:null,context:null,viewMode:"",view_customization:null,modelEvents:null,subscribeTokens:[],dgv:null,dgvLayout:null,isActiveView:!1,clickEvent:{},doubleClickEvent:{},model:null},this.options=Object.assign(this.options,e)}return d.prototype.initialize=function(){this._ContextualMenu=new l;var i={};this.configureDataGridViewOptions(i);var r=e.clone(this.options.context.getSetting("dgvOptions"));this.options.viewMode=r.viewMode;var o=r.dgv?r.dgv:{};i=e.extend(o,i);var s=e.extend({identifier:"DataGridView-"+this.name+"-"+n.uid()},i);s.layoutOptions={},s.layoutOptions.layoutDensity=this.options.viewMode,s.treeDocument=this.options.model;var a=this.options.dgv=new t(s);a.setUseClipboardFlag(!1),this.options.context.views||(this.options.context.views={}),this.options.context.views.datagridview=a,this._registerTypeRepresenatation(),this._dgvEventManager(a),this._subscribeEvents()},d.prototype.getColumnManager=function(){return this.options.context.columnManager},d.prototype.configureDataGridViewOptions=function(e){var t=this.getColumnManager().getDatagridViewColumns();e.columns=t,e.onContextualEvent=this._getContextualMenu.bind(this),e.onDelayedModelDataRequest=this.updateVisibleNodesPresentation.bind(this),this._enableColumnFilter()},d.prototype._registerTypeRepresenatation=function(){var e=this.options.dgv,t=this.options.context.additionalColumnsProv;e.getTypeRepresentationFactory().registerTypeRepresentations(this._getCustomTypeRepresentation()),t.forEach(function(t){if(t.instance.getTypeRepresentations){var n=t.instance.getTypeRepresentations();e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(n))}})},d.prototype._getContextualMenu=function(e){var t=[];if(e&&e.collectionView&&e.cellInfos){e.cellInfos.columnID;var i=e.cellInfos.rowID;if(-1===i)t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!1,columnsManagement:!0,sizeColumnToFit:!0});else if(i>-1&&e.cellInfos.nodeModel){var r=e.cellInfos.nodeModel;this.options.context.externalProviders&&(r.externalProviders=this.options.context.externalProviders),r._defaultTypes=n.getAuthorizedTypesWithParent(),t=this._ContextualMenu._getContextualMenu(r)}}return t},d.prototype.preferredUnitValueConversion=function(e){var t=this;e&&e.length&&e.forEach(function(e){let n=e.getType(),i=e.getParamContent(),r=e.getLoadingMode();n!==c.TYPE_PARAMETER||i||"indexed"!==r||t.options.context.DataService.convertValuesToPreferredUnit(e),n!==c.TYPE_PARAMETER&&t.options.context.DataService.convertValuesToPreferredUnit(e)})},d.prototype.updateVisibleNodesPresentation=function(e){var t=e.displayNodesArray;if(void 0===t&&e&&e.collectionView&&e.collectionView.model){var n=e.collectionView;t=void 0!==e.startNodeIndex&&void 0!==e.endNodeIndex?n.model.slice(e.startNodeIndex,e.endNodeIndex+1):n.model}var i=this.options.context.additionalColumnsProv;if(i&&i.length&&this.options.model.updateProviderColumns(t,e.context),this.preferredUnitValueConversion(t),t&&t.length)for(var r=require("DS/TraceableRequirementsUtils/utils/RequirementNlsMgt"),o=0,s=t.length;o<s;o++)r.updateNLS(t[o])},d.prototype._getCustomTypeRepresentation=function(){var e={};return this.options.context.DataService.customerExtension.forEach(function(t){Array.isArray(t.authorizedValues)&&t.authorizedValues.length>0?e[t.alphaNumAttrName]={stdTemplate:"comboSelector",semantics:{possibleValues:t.authorizedValues}}:e[t.alphaNumAttrName]={string:{stdTemplate:"edit"}}}),e.mandatory={stdTemplate:"switch"},JSON.stringify(e)},d.prototype._dgvEventManager=function(t){var l=this;t.addEventListener(o.POINTERHIT,function(o,c){if(o.multipleHitCount>=2){let r=c.cellID;if(t.getCellEditableState(r)){let o=c.nodeModel.getID(),d=c.nodeModel.options.cestamp,p=["cestamp","current.access[modify]"];i.getInfo({pid:o,securityContext:n.getSecurityContext(),selectables:p,authored:!0,onComplete:function(i){i=n.parseResponse(i);let o=(i=e.is(i,"string")?JSON.parse(i):i).results[0];"FALSE"===o["current.access[modify]"]?(t._setEditionMode(r,!1),s.warningAlert(u.EditionModifyAccess)):"true"==l.options.context.DataService.isConcurrentEngineeringEnabled&&o.cestamp!=d&&(t._setEditionMode(r,!1),s.warningAlert(u.EditionNotUpToDate))},onFailure:function(e){var t=a.getParseErrorMessage(e);s.errorAlert(t)},onTimeout:function(e){var t=a.getParseErrorMessage(e);s.errorAlert(t)}})}}if(c){var d=o.target instanceof HTMLAnchorElement||o.target instanceof HTMLImageElement||o.target instanceof HTMLSpanElement,p=o.dsModel.layout.getDataIndexFromColumnIndex(c.columnID);if(d)if(c.nodeModel)if("ds6w:status"===p)r.getCommand("MaturityHdr").begin();else if("ds6wg:revision"===p){r.getCommand("HistoryHdr").begin()}else if("ds6w:responsible"===p){r.getCommand("ActionBar_ChangeOwner").begin()}else if("ds6w:reserved"===p){var f="ActionBar_ReserveCmd";"TRUE"===c.nodeModel.options.grid["ds6w:reserved"]&&(f="ActionBar_UnreserveCmd"),r.getCommand(f).begin()}else if(("ds6w:covers"===p||"ds6w:refinedInto"===p)&&e.is(c.nodeModel.options.getAttributeValueForFiltering(p))){var h={context:c.nodeModel};l._ContextualMenu._linkManagement(h)}if(l.options.context.additionalColumnsProv&&!0===o.dsModel.layout.getColumnOptionValue(c.columnID,"isAdditionalColumn"))for(var g=l.options.context.additionalColumnsProv,m=0;m<g.length;m++){let e=g[m],t=e.instance?e.instance.getOnCellClickCB:void 0;if(t){var v=t.call(e.instance,p);if(v){v(c);break}}}}}),l.customViewsManager(t)},d.prototype.reDrawColumns=function(e){var t=this,n=t.getColumnManager().getDatagridViewColumns(),i=t.options.dgv;if(Array.isArray(n)&&n.length>0){var r=(i.columns||[]).map(function(e){return e.dataIndex});i.prepareUpdateView(),r.forEach(function(t){var r=n.find(function(e){return e.dataIndex===t});"tree"===t||!e&&r||i.removeColumnOrGroup(t),i.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)});var o=0;n.forEach(function(n){var s=r.find(function(e){return n.dataIndex===e});"tree"===n.dataIndex||!e&&s||(i.addColumnOrGroup(n,o),t._enableColumnFilter(n)),o++})}},d.prototype.inject=function(){this.options.dgv.getContent().inject(this.options.renderTo)},d.prototype.customViewsManager=function(e){var t=this;e.subscribeOnceToAllCellsRendered(function(){var n=e.getCustomViewsManager();t.setCustomView(n),n.onCustomViewsSave=function(e,n){var i={};i["custom-view-identifier"]=n,i["custom-views"]=e,t.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"close",customViewsInfo:i}})}})},d.prototype.setCustomView=function(e){let t=this.options.context.PrefService.getUserPreferences().customViewsInfo;if(t){let n=t["custom-views"];for(let t in n)n&&n[t]&&e.addCustomView(n[t],!0);e.setCurrentCustomView(t["custom-view-identifier"])}},d.prototype.dndCallbackInit=function(e){var t=this.options.dgv;t.onDragStartRowHeader=e._onDragStartRowHeader.bind(e),t.onDragOverCell=e._onDragOverRowHeader.bind(e),t.onDragRowHeader=e._onDragRowHeader.bind(e),t.onDropRowHeader=e._onDropRowHeader.bind(e),t.onDragEndRowHeader=e._onDragEndRowHeader.bind(e),t.onDragStartColumnHeader=e._onDragStartColumnHeader.bind(e),t.onDragEndColumnHeader=e._onDragEndColumnHeader.bind(e),t.onDragStartCell=e._onDragStartRowHeader.bind(e),t.onDragOverCell=e._onDragOverRowHeader.bind(e),t.onDragCell=e._onDragRowHeader.bind(e),t.onDropCell=e._onDropRowHeader.bind(e),t.onDragEndCell=e._onDragEndRowHeader.bind(e)},d.prototype._enableColumnFilter=function(e){var t={};if(null==e){var n=this.getColumnManager().getVisibleColumns();for(let e in n)Object.assign(t,this.getLocalFilterModel(n[e]));this.options.model.setFilterModel(t)}else{if(Object.assign(t,this.getLocalFilterModel(e)),t[e.dataIndex])this.options.model.getFilterManager().setPropertyFilterModel(e.dataIndex,t[e.dataIndex])}},d.prototype.getLocalFilterModel=function(e){var t={},n=this.options.context.getSetting("defaultSetLocalFilterColumns"),i={filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:""}}};if(!this.options.context.getSetting("excludedLocalFilterColumns").includes(e.dataIndex)){var r=this.options.context.getDictionaryAttributes(e.dataIndex),o=!1;r.length>0&&r[0].authorizedValues&&(o=!0),"tree"==e.dataIndex?t.label=i:n.includes(e.dataIndex)||"enumString"==e.kind||"boolean"==e.kind||o?t[e.dataIndex]={filterId:"set"}:"string"!=e.kind&&"integer"!=e.kind&&"real"!=e.kind||(t[e.dataIndex]=i)}return t},d.prototype._subscribeEvents=function(){var e=this;e.options.modelEvents.subscribe({event:"RequirementStructureBrowser-inject-print"},function(){e.options.dgv.openPrintableViewWindow(!0)}),e.options.modelEvents.subscribe({event:"event-change-structure-view-changed"},function(t){e.options.modelEvents.publish({event:"columns-changed",updateExitingColumns:!0}),!0===t&&e.options.modelEvents.publish({event:"TRMViews-StructureEditor-update",data:t})}),e.options.modelEvents.subscribe({event:"columns-changed"},function(t){var n=!1;t&&t.updateExitingColumns&&(n=!0),e.reDrawColumns(n)})},d}),define("DS/RequirementStructureBrowser/requirementServices/DimensionsUnitMgtService",["UWA/Core","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","UWA/Class","UWA/Class/Options","DS/TraceableRequirementsUtils/Utils","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/utils/TRMPromiseUtils"],function(e,t,n,i,r,o,s,a,l,u){"use strict";return i.extend(r,{init:function(e){this._parent(e)},getAllDimension:()=>{if(!localStorage.getItem("dimensionsMap")){var e={};t.getAllDimentions({onComplete:function(t){JSON.parse(t).results.forEach(function(t){var n={};t.Units.forEach(function(e){n[e.label]={Name:e.Name,NLSName:e.NLSName}}),e[t.Name]={MKSUnit:t.MKSUnit,NLS:t.NLS,Units:n}}),localStorage.setItem("dimensionsMap",JSON.stringify(e))},onFailure:function(e,t){var i=n.getParseErrorMessage(e,t);a.errorAlert(i)},onTimeout:function(e){var t=n.getParseErrorMessage(e);a.errorAlert(t)}})}},convertValuesToPreferredUnit:function(i){if(e.is(i)){var r={Data:[]};let e,u=[];if(i.getType()===l.TYPE_PARAMETER)e=this.preparePayloadToConvertParamvalue(i);else{let t=this.preparePayloadCustAtrrConvesion(i);e=t.payloadData,u=t.custAttrWithDim}if(!e.length)return;r.Data=e.map(e=>e),t.convertValuesToPreferredUnits({payload:r,securityContext:o.getSecurityContext(),onComplete:function(e){e=JSON.parse(e),s.process.displayPreferredUnitValues(i,e.Response,u)},onFailure:function(e,t){var i=n.getParseErrorMessage(e,t);a.errorAlert(i)},onTimeout:function(e){var t=n.getParseErrorMessage(e);a.errorAlert(t)}})}},preparePayloadToConvertParamvalue:function(t){var n=[];if(e.is(t)){let u=t.options.plmparam,c=u["plmparam.itf"];var i,r;if(e.is(c)&&(i=c.replace("Parameter",""),r=this.getMKSAndPreferredUnit(i,u.displayUnit)),!r.preferredUnit)return s.process.displayPreferredParamValues(t,[]),n;var o=r.preferredUnit,a=r.MKSUnit;if(o===a)return s.process.displayPreferredParamValues(t,[]),n;var l={Value:"",Dimension:i,UnitTo:o,UnitFrom:a};if(u.minvalue){let t=e.clone(l);t.Value=u.minvalue,n.push(t)}if(u.value){let t=e.clone(l);t.Value=u.value,n.push(t)}if(u.maxvalue){let t=e.clone(l);t.Value=u.maxvalue,n.push(t)}}return n},preparePayloadCustAtrrConvesion:function(t){let n=Object.keys(t.options.grid),i=t.options,r={},o={},s=[],a={},l={Value:"",Dimension:"",UnitTo:"",UnitFrom:""};for(let t of n){let n="",o="";if(!i.custAtrValueConverted){let u=this.app.getAttributeInfo(t),c=i.grid[t];if(u.length>0&&u[0].attrDim&&c){if(n=u[0].attrDim,o=u[0].attrUnit,r[t]=this.getMKSAndPreferredUnit(n,o),!r[t].preferredUnit)continue;if(r[t].MKSUnit===r[t].preferredUnit)continue;if(void 0!==c&&(c=c.includes(",")?c.split(","):c),e.is(c,"array")){l.Dimension=n,l.UnitFrom=r[t].MKSUnit,l.UnitTo=r[t].preferredUnit,r[t].value=c;for(let t of c){let n=e.clone(l);n.Value=t,s.push(n)}a[t]={isMultivalued:!0,MultiValueCount:c.length}}else{let i=e.clone(l);i.Dimension=n,i.UnitFrom=r[t].MKSUnit,i.UnitTo=r[t].preferredUnit,r[t].value=c,i.Value=r[t].value,s.push(i),a[t]={isMultivalued:!1}}}}}return o.custAttrWithDim=a,o.payloadData=s,o},getMKSAndPreferredUnit:(t,n)=>{var i={},r=JSON.parse(localStorage.getItem("dimensionsMap"));if(e.is(r)&&e.is(t)&&e.is(n)){var o=r[t];o&&(i.MKSUnit=o.MKSUnit,o.Units[n]?i.preferredUnit=o.Units[n].Name:i.preferredUnit=n)}return i},getMKSValue:(i,r,s)=>{let l="",c={Value:"",Dimension:"",UnitTo:"",UnitFrom:""},d=[];return u.wrappedWithPromise(function(u,p){let f=JSON.parse(localStorage.getItem("dimensionsMap"));if(e.is(i)&&e.is(r)&&e.is(s)){var h=f[r];if(h)if(h.MKSUnit===s)l=i.toString(),u(l);else{let e=h.MKSUnit;c.Value=i.toString(),c.UnitFrom=s,c.UnitTo=e,c.Dimension=r,d.push(c);var g={Data:[]};g.Data=d.map(e=>e),t.convertValuesToPreferredUnits({payload:g,securityContext:o.getSecurityContext(),onComplete:function(e){e=JSON.parse(e),l=parseFloat(e.Response[0].ConvertedValues),u(l)},onFailure:function(e,t){var i=n.getParseErrorMessage(e,t);a.errorAlert(i)},onTimeout:function(e){var t=n.getParseErrorMessage(e);a.errorAlert(t)}})}}})}})}),define("DS/RequirementStructureBrowser/controllers/StructureEditorContoller",["DS/TraceableRequirementsUtils/Utils","DS/RequirementStructureBrowser/components/ActionBar","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/PlatformAPI/PlatformAPI","DS/RequirementStructureBrowser/controllers/RootNodeController","DS/RequirementStructureBrowser/utils/RequirementAppConfig","DS/ENOXTriptych/js/ENOXTriptych","DS/RequirementFrameUtils/components/topbaraction/TopbarActionWrapper","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","DS/TraceableRequirementsUtils/utils/TRMTypeManagement","DS/RequirementStructureBrowser/views/TRMDataGridView"],function(e,t,n,i,r,o,s,a,l,u,c,d,p,f,h,g){"use strict";var m=function(){};return m.prototype.init=function(t){this._applicationChannel=t._applicationChannel,this._triptychOptions={left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},this._topbarOpts={withInformationButton:!1,withWelcomePanelButton:!1,modelEvents:t._applicationChannel},this.app=t,this._model=t.options.model,this.opened_ids=[],this._isDestroyed=!1,this.mediator={},this.req_navigate_options=JSON.parse(n),e.mediator.installTo(this.mediator),this._unSubscribeEvents(),this._initDivs(),this._initDGV(),this._subscribeEvents()},m.prototype._initDivs=function(){var e=this;e.app._trmModelEvents;e.container=UWA.createElement("div",{class:"StructureEditor"}),e.container.inject(e.app.elements.container);var n=UWA.createElement("div",{class:"trm_viewmain"});this._topbarOpts.parentContainer=n,this._topbarAction=new c,this._topbarAction.init(this._topbarOpts),n.addClassName("withToolbar");var i=UWA.createElement("div",{class:"trm_Content"}).inject(n),r=UWA.createElement("div",{class:"trm_viewright rightSidePanel"});this.reqshell=new u,this._triptychOptions.container=e.container,this.reqshell.init(this._triptychOptions,e.createRootListSlidder(),n,r),e.reqshell.togglePanel=function(t){"left"===t?e.reqshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):e.reqshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"})},e.reqshell.openPanel=function(t){e.app.elements.openPanel._modelEvents.publish({event:"triptych-show-panel",data:t})},require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),this.getStatusInfo(this.container),this.action_bar=new t,this.action_bar.initializeActionBar(this.mediator,e.container),this._structure_container=UWA.createElement("div"),this._structure_container.classList.add("structure-details"),this._structure_container.inject(i)},m.prototype._initDGV=function(){var e={renderTo:this._structure_container,context:this.app,viewMode:"",modelEvents:this.app._applicationChannel,dgv:null,dgvLayout:null,model:this._model},t=new g(e);t.initialize(),this._dataGridView=t.options.dgv,t.dndCallbackInit(this),t.inject()},m.prototype.togglePanel=function(e,t){this.reqshell.togglePanel(e,t)},m.prototype.createRootListSlidder=function(){var e=this;return this.leftsidepanel=new a(e.app),e._model.onNodeModelUpdate(function(t){e.app._localModelEvent.publish({event:"RequirementStructureBrowser-Root-sync",data:t.data.nodeModel})}),e.app._localModelEventsTokens.push(e.app._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-select"},this._onTileSelect.bind(this))),e.app._localModelEventsTokens.push(e.app._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-removeTile"},this._onRemoveTile.bind(this))),this.leftsidepanel.getContent()},m.prototype._onTileSelect=function(e){if(!UWA.is(e.tile_ids,"array"))throw new Error("Invalid input param, no params.tile_ids defined");var t=this;t._model.unselectAll(),e.tile_ids.forEach(function(e){var n=t._model.searchRootById(e);n?(n.select(),t._applicationChannel.publish({event:"structure-editor-add-title",data:n.options})):console.log("Cannot find ["+e+"] in the TreeDocument")})},m.prototype._onRemoveTile=function(e){if(!UWA.is(e.tile_id))throw new Error("Invalid input parameter");var t=this._model.searchRootById(e.tile_id);return UWA.is(t)&&this._model.removeRoot(t),0===this._model.getRoots().length&&this.app._applicationChannel.publish({event:"breadcrumb-link-clicked",data:{linkID:r.EMPTY_STRUCTURE_BROWSER}}),!1},m.prototype.getStatusInfo=function(t){var n=this,i=new o.wrappedWithPromise(function(t){require(["DS/RequirementStructureBrowser/components/RequirementStatusInfos"],function(i){var r=new i({withProgress:!0,events:{onShow:function(){r.setStatus(i.buildStatus({Tenant:e.getPlatformId(),tree_content:{nbObjectsInTree:n.app.options.model.getAllDescendants().length,nbObjectsSelected:n.app.options.model.getSelectedNodes().length}}))}}});t(r)})});o.allSettled(i).then(function(e){"fullfilled"===e[0].state&&e[0].value&&e[0].value.getContent().inject(t)}).catch(function(e){console.error(e)})},m.prototype.inject=function(e){e.appendChild(this.container)},m.prototype._onDropRowHeader=function(e,t){this.performDnD(e,t),e.preventDefault()},m.prototype._loadData=function(e,t){let n=this;n._model.addRootNodes(e),t&&t.forEach(e=>{n._model.expandToPath(e)}),n.app._applicationChannel.publish({event:r.AFTER_ALL_SETTLED,data:e})},m.prototype._onDragStartRowHeader=function(e,t){var n=t.draggedNodes;e.dataTransfer.effectAllowed="all",l.DRAG_NODE_START=!0;var i=h.prepareDragData(n);return e.dataTransfer.setData("Text",i),!1},m.prototype._onDragEndRowHeader=function(e,t){l.DRAG_NODE_START=!1},m.prototype._onDragStartColumnHeader=function(e,t){return sessionStorage.setItem("isColumnHeader",!0),!0},m.prototype._onDragEndColumnHeader=function(e,t){return sessionStorage.setItem("isColumnHeader",""),!0},m.prototype._onDragOverRowHeader=function(e,t){return e.preventDefault(),!0},m.prototype._onDragRowHeader=function(e,t){},m.prototype._InterWidgetDnD=function(e,t){var n=this;n.app.beginBlockingTransaction(p.composite),h.retrieveAuthorizedObjects({dnd_event:e,isRootAuthorizations:!1,callback:function(e){var r,o={dataArray:[]},s=JSON.parse(d),a=e.authorized_objects?e.authorized_objects:[],l=t.dropPosition;r=t.nodeModel.isRoot()&&"bottom"===l?t.nodeModel:"top"===l||"bottom"===l?t.nodeModel.getParent():t.nodeModel;var u=n._getSiblingsRelID(r,l,t);if(a.length>0&&0==o.dataArray.length){r.options.resourceid;var c=s[r.options.reqKindOf]||s[r.options.type];a.forEach(function(e){var t=n._createInsertExistingInput(r,u,e,c);o.dataArray.push(t)})}e.unauthorized_objects.forEach(function(e){var t=n.app.getNls("unauthorizedType");t=t.replace("{type}",e.displayType),i.warningAlert(t)}),o.dataArray.length>0?n.app.DataService.InsertExisting({json:o}):n.app.endBlockingTransaction()}}),e.preventDefault()},m.prototype.performDnD=function(t,n){var r=this,o=h.retrieveDragWidgetId(t),s=n.droppedNodes,a={dataArray:[]},l={dataArray:[]};if(o==e.getWidgetId()){var u,c=n.dropPosition;if((u=n.nodeModel.isRoot()&&"bottom"===c?n.nodeModel:"top"===c||"bottom"===c?n.nodeModel.getParent():n.nodeModel).options.externalObject)i.errorAlert(p.Transaction_forbidden);else{var g=u.options.reqKindOf,m=JSON.parse(d)[g],v=[],_=r._getSiblingsRelID(u,c,n);s.forEach(function(e){var t=e.options.reqKindOf;if(m&&m[t])if(e.isRoot()){var n=r._createInsertExistingInput(u,_,e,m);l.dataArray.push(n)}else v.push(e.getRelationID());else i.warningAlert(r.app.getNls("INSERT_FAILED"))});var S=(a=r._createReorderInput(u,_,v)).rels.length,b=l.dataArray.length;S>0&&b>0?i.warningAlert(f.Requirement_Notif_RootAndLeafSelection):S>0?(r.app.beginBlockingTransaction(p.composite),r.app.DataService.reorder(a)):b>0&&(r.app.beginBlockingTransaction(p.composite),r.app.DataService.InsertExisting({json:l,droppedData:s}))}}else r._InterWidgetDnD(t,n)},m.prototype._createInsertExistingInput=function(t,n,r,o){var s=n.prevRelID,a=n.nextRelID,l="";let u=r.objectType?r.objectType:r.getType(),c=e.getKindOf(u);if(o&&o[c])return l=o[c],{id:r.objectId?r.objectId:r.getID(),pid:t.getID(),relationship:l,previousSibling:{relId:isNaN(s)?s:""},nextSibling:{relId:isNaN(a)?a:""}};i.warningAlert(this.app.getNls("INSERT_FAILED"))},m.prototype._createReorderInput=function(e,t,n,i){var o=null,s=null;t&&(o=t.prevRelID,s=t.nextRelID);var a="";a=null!=o&&null!=s?r.POSITION_AFTERCHILD:null!=s?r.POSITION_FIRSTCHILD:r.POSITION_LASTCHILD;var l={version:r.REORDER_API_Version,target:{kind:a,parent:e.getID()},rels:n,mode:i||r.MOVE_MODE};return a==r.POSITION_AFTERCHILD&&(l.target.rel=o),l},m.prototype._getSiblingsRelID=function(e,t,n){var i={prevRelID:null,nextRelID:null},r=e.getChildren();if("top"===t){if(i.nextRelID=n.nodeModel.getRelationID(),!r)return;var o=r.indexOf(n.nodeModel);o>0&&(i.prevRelID=r[o-1].getRelationID())}if("bottom"===t){if(i.prevRelID=n.nodeModel.getRelationID(),!r)return;var s=r.indexOf(n.nodeModel);s<r.length-1&&(i.nextRelID=r[s+1].getRelationID())}return i},m.prototype.getModels=function(){return this._model},m.prototype.UpdateModifiedNodes=function(e){var t=this;let n={physicalid:e};t.app.DataService.getObjectInfo(n).then(function(e){let n=e.results?e.results:[];console.log(n),n.forEach(function(e){t._model.getNodesById(e.resourceid).forEach(function(t){var n={grid:e};n.label=e["ds6w:label"],n.cestamp=e.cestamp,t.updateOptions(n)})})})},m.prototype.refresh=function(e,t,n){this.getModels().prepareUpdate();for(var i=0;i<e.length;i++)e[i].refreshByModel(t[i]);this.getModels().pushUpdate()},m.prototype._unSubscribeEvents=function(){var e=this;this._applicationChannel&&(e.app._structureEditorEventsTokens.forEach(function(t){e._applicationChannel.unsubscribe(t)}),e.app._structureEditorEventsTokens=[])},m.prototype._subscribeEvents=function(){var t=this,n="cfgEffectivityModifications_"+widget.id;s.subscribe(n,function(e){e=JSON.parse(e),t.app.refreshGridForSetEffectivities(e)}),s.subscribe("Lifecycle.Modification",function(n){let i=UWA.is(n,"object")?n:JSON.parse(n),r=i.Refresh,o=i.WidgetID===e.getWidgetId(),s=[],a=[],l=[];if(r&&o){let e=widget.getPreference("AddObjectOnReviseDuplicate").value;r.created.forEach(function(n){"object"==typeof n&&(["Revise","Duplicate"].indexOf(n.operation)>-1&&(!t._model.getNodesById(n.sourceObjectId)[0].getParent().isSelected()&&e&&l.push(n.physicalid),s.push(n.sourceObjectId)))}),r.deleted.forEach(function(e){"object"==typeof e&&a.push(e.physicalid)}),t._model.refreshNodeById({created:l,modified:s,deleted:a})}}),t._applicationChannel.subscribe({event:"structure-editor-manage-additionalColumn"},function(e){t._model.updateProviderColumns(e)}),t._applicationChannel.subscribe({event:"structure-editor-add-title"},function(e){var n={linkID:r.BREADCUM_STRUCTURE_BROWSER_ID,linkText:e.label,additionalData:e.resourceid};t._applicationChannel.publish({event:"breadcrumb-reset",data:null}),t._applicationChannel.publish({event:"breadcrumb-add-link",data:n})}),t.app._structureEditorEventsTokens.push(t._applicationChannel.subscribe({event:r.AFTER_ALL_SETTLED},function(e){var n={paths:[e[e.length-1].options.resourceid],appId:widget.getValue("appId")};t.app.reqCommandProxy.drop(n),t._applicationChannel.publish({event:"structure-editor-add-title",data:e[e.length-1].options})}))},m}),define("DS/RequirementStructureBrowser/requirementServices/StructureEditorDataService",["DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","UWA/Class/Promise","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","DS/TraceableRequirementsUtils/utils/TRMReportPanel","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","DS/PADUtils/PADSession","DS/TraceableRequirementsUtils/utils/RequirementNlsMgt","DS/Utilities/Utils","DS/RequirementStructureBrowser/requirementServices/DimensionsUnitMgtService"],function(e,t,n,i,r,o,s,a,l,u,c,d,p,f,h,g){var m=function(){};return h.applyMixin(m,g),m.prototype.init=function(e){this.app=e,this.req_navigate_options=JSON.parse(l),this.isChangeEnabled="false",this.isConcurrentEngineeringEnabled="false",this.customerAttributeToFetch=[],this.customerExtension=[];var t=this.loadListOfAttributes();e.optionalStartup.push(t),this.loadConfigurationSettings();var n=this.req_navigate_options.DefaultRangeAttribute;this.getAttributeRange(n),this.getAllDimension()},m.prototype.updateAttribute=function(t,s,a){var l=this,c=[];let d=t.nodeModel.options.resourceid,p=t.nodeModel.options.cestamp;return s=s.label?s.label:s,c.push({name:a,value:s}),e.wrappedWithPromise(function(e,t){0===c.length&&t("invalid input"),i.getInfo({securityContext:n.getSecurityContext(),authored:!0,pid:d,selectables:"cestamp,current.access[modify]",onComplete:function(s){s=n.parseResponse(s);var a=(UWA.is(s,"string")?JSON.parse(s):s).results[0];"FALSE"===a["current.access[modify]"]?(r.errorAlert(u.EditionModifyAccess),e()):"true"==l.isConcurrentEngineeringEnabled&&a.cestamp!=p?(r.errorAlert(u.EditionNotUpToDate),e()):i.edit({pid:d,json:{attributes:c},securityContext:n.getSecurityContext(),onComplete:function(t){l.app.author(!0);var n=(UWA.is(t,"string")?JSON.parse(t):t).results,i=(UWA.is(n.type,"object")?n.type.displayName:n.type)+" "+n.name+" "+n.revision,o=u.ENOTRMApp_Notif_ObjectUpdated;o=o.replace("{TNR}",i),r.sucessAlert(o),e(n)},onFailure:function(e,n){var i=o.getParseErrorMessage(e,n);r.errorAlert(i),t()},onTimeout:function(e){var n=o.getParseErrorMessage(e);r.errorAlert(n),t()}})},onFailure:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)},onTimeout:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)}})})},m.prototype.getAttributeRange=function(t){var s=this,a=((new Date).getTime(),[]);t.forEach(function(t){a.push(e.wrappedWithPromise(function(e,a){i.getAttributeRange({securityContext:n.getSecurityContext(),attributeName:t,onComplete:function(n){var i=(UWA.is(n,"string")?JSON.parse(n):n).results.toString();s.app.defaultAttributeRange[t]=JSON.parse(i),e(s.app.defaultAttributeRange.attrName)},onFailure:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)},onTimeout:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)}})}))})},m.prototype.updateConfigurationData=function(e){this.app.getModels().updateProviderColumns(e)},m.prototype.getTreeOrder=function(t){var s=t.physicalid;return e.wrappedWithPromise(function(e,a){i.getAttributeTreeOrder({securityContext:n.getSecurityContext(),pid:s,onComplete:function(n){n=(n=UWA.is(n,"string")?JSON.parse(n):n).results[0],n=UWA.extend(n,t),e(n)},onFailure:function(e,t){var n=o.getParseErrorMessage(e,t);r.errorAlert(n),a()},onTimeout:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t),a()}})})},m.prototype.getObjectInfo=function(t){var s=this,a=s.app.columnManager.getDGVVisibleColumns(),l=UWA.is(t.physicalid)?t.physicalid:t.resourceid;if(null!=l)return l=UWA.clone(l),e.wrappedWithPromise(function(e,c){i.getInfo({securityContext:n.getSecurityContext(),pid:l,selectables:a,onComplete:function(i){if(i=n.parseResponse(i),Array.isArray(l)||(l=l.split(",")),!i.results||i.results.length<l.length){let d={results:[]};if(i.results&&i.results.forEach(function(e){if(l.includes(e.resourceid)){let t=l.indexOf(e.resourceid);l.splice(t,1)}d.results.push(e)}),n.determineAuthoredFlag())r.notifyAlert(u.ENOTRMApp_Notif_LoadError),c(l);else if(i.infos&&i.infos.sources&&i.infos.sources.length>0&&i.infos.sources[0].error){var o=i.infos.sources[0],a=o.error.errorMessage||"An error has occurred in "+o.name;r.errorAlert(a)}else p.setAuthoringState(!0,u.disabling_index_object_not_found),t={physicalid:l},s.getObjectInfo(t).then(function(t){t.results.forEach(function(e){d.results.push(e)}),e(d)}).catch(function(){s.app.updateStoredObjects(l)}).finally(function(){d&&d.results.length>0&&e(d)})}else e(i)},onFailure:function(e,t){var n=o.getParseErrorMessage(e,t);r.errorAlert(n),c(l)},onTimeout:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)}})});console.log("physicalid is null")},m.prototype.getExpandData=function(e,t){var s=this,a=this.app.getModels();i.expand({json:e,securityContext:n.getSecurityContext(),onComplete:function(e){var i;if((e=n.parseResponse(e)).errors&&e.errors.length)s.app.endBlockingTransaction(),p.setAuthoringState(!0,u.disabling_index_object_not_found),t(e);else try{i=a.startTransaction();var o=UWA.is(e,"string")?JSON.parse(e):e;t(o)}catch(e){r.errorAlert(e)}finally{i&&i.end()}},onFailure:function(n,i){var a=o.getParseErrorMessage(i);r.errorAlert(a),t({results:[]}),s.app.updateStoredObjects([e.root_physical_id])},onTimeout:function(e,n){var i=o.getParseErrorMessage(e);r.errorAlert(i),t({results:[]})}})},m.prototype.getConfigSettings=function(){return Array.isArray(this.configSettings)?this.configSettings:[]},m.prototype.getEnforceSettings=function(){return this.isChangeEnabled},m.prototype.InsertExisting=function(e){var t=this,l=e.droppedData,u=e.json,p={Success:[],Failure:[]},f=function(e,t){var n,i,r=[],o=t;for(n=0,i=e.length;n<i;n+=o)r.push(e.slice(n,n+o));return r}(u.dataArray,10),h=0;t.app.beginBlockingTransaction(d.composite);for(var g=f.length,m=0;m<g;m++){var v=new s(function(e,s){var a={dataArray:f[m]};i.insertExisting({securityContext:n.getSecurityContext(),json:a,onComplete:function(n){h++;var i=(UWA.is(n,"string")?JSON.parse(n):n).results;i.Success.forEach(function(e){p.Success.push(e)}),i.Failure.forEach(function(e){p.Failure.push(e)}),i.Success.length>0&&(t.app.refreshOnInsert(i.Success,!1,"insertExisting"),void 0!==l&&l.length>0&&l.forEach(function(e){t.app.getModels().removeRoot(e)})),h===f.length&&e()},onFailure:function(n,i){h++;var s=o.getParseErrorMessage(n,i);r.errorAlert(s),t.app.endBlockingTransaction(),h===f.length&&e()},onTimeout:function(n){h++;var i=o.getParseErrorMessage(n);r.errorAlert(i),t.app.endBlockingTransaction(),h===f.length&&e()}})});s.allSettled(v).then(function(){if(u.dataArray.length>1)(p.Failure.length>0||p.Success.length>0)&&new c({title:"InsertExisting",reportData:p});else{if(p.Success.length>0){var e=p.Success[0],n=(UWA.is(e.type,"object")?e.type.displayName:e.type)+" "+e.name+" "+e.revision;i=(i=a.InsertExisting_Success_msg).replace("{TNR}",n),r.sucessAlert(i)}if(p.Failure.length>0){var i;e=p.Failure[0],n=(UWA.is(e.type,"object")?e.type.displayName:e.type)+" "+e.name+" "+e.revision;i=(i=a.InsertExisting_Failure_msg+" "+a.FailureReasons).replace("{TNR}",n),r.errorAlert(i)}}t.app.endBlockingTransaction()})}},m.prototype.reorder=function(e){var t=this;e=e;i.reorder({securityContext:n.getSecurityContext(),json:e,onComplete:function(n){var i=UWA.is(n,"string")?JSON.parse(n):n;if("success"==i.status){var o=i.results,s=Object.keys(o);s=(s=s.filter(e=>"internalImpacts"!==e)).filter(e=>"reset"!==e);var l=[];if(s.forEach(function(n){if("InternalImpacts"!=n||"reset"!=n)var i=t.app.getModels().getNodesByRelId(n)[0];var r=t._createReorderResponce(n,i,e,o);l.push(r)}),null!=o.internalImpacts){var u=Object.keys(o.internalImpacts)[0];t.app.getModels().getNodesByRelId(u)[0].options.relationOrder=o.internalImpacts[u]}if(o.reset){var d=e.target.parent;t.app.reqCommandProxy.resetTreeorder({appId:widget.getValue("appId"),id:d})}else t.app.refreshOnDnD(l,!1,"move");if(l.length>1)new c({title:"DragNDrop",reportData:{Success:l}});else if(l.length>0){var p=l[0],f=(UWA.is(p.type,"object")?p.type.displayName:p.type)+" "+p.name+" "+p.revision,h=a.DragNDrop_Success_msg;h=h.replace("{TNR}",f),r.sucessAlert(h)}}"error"==i.status&&r.warningAlert(i.message),t.app.endBlockingTransaction()},onFailure:function(e){var n=o.getParseErrorMessage(e);r.errorAlert(n),t.app.endBlockingTransaction()},onTimeout:function(e){var n=o.getParseErrorMessage(e);r.errorAlert(n),t.app.endBlockingTransaction()}})},m.prototype._createReorderResponce=function(e,t,n,i){var r={};return r["physicalid[connection]"]=i[e].result,r["attribute[TreeOrder]"]=i[e].order,r.status=i[e].status,r["from.physicalid[connection]"]=n.target.parent,r.physicalid=t.getID(),r.name=t.getLabel(),r.type=t.getType(),r.revision=t.options.revision,r["attribute[Title]"]=t.getLabel(),r["type.kindof"]=t.getKindOf(),r["old_physicalid[connection]"]=t.getRelationID(),r},m.prototype.getUserRecentsItems=function(e){var s=this,a=s.app.PersistencyManager.getRecentItems();if(a){var l=a.split(","),u=s.app.columnManager.getDGVVisibleColumns(!0);i.getInfo({pid:l,authored:!0,securityContext:n.getSecurityContext(),selectables:u,onComplete:function(i){i=n.parseResponse(i),(i=(i=UWA.is(i,"string")?JSON.parse(i):i).results).forEach(function(i){var r=t.process.createNode({treedocument:s.app,data:i,tenant:n.getTenant()},s.app.externalTypes);e.addRoot(r),f.updateNLS(r)}),e.getModelEvents().publish({event:"TRMViews-tile-model-update"})},onFailure:function(e,t){var n=o.getParseErrorMessage(e,t);r.errorAlert(n)},onTimeout:function(e,t){var n=o.getParseErrorMessage(e,t);r.errorAlert(n)}})}else a="",e.getModelEvents().publish({event:"TRMViews-tile-model-update"})},m.prototype.loadListOfAttributes=function(t){var n=this;return this._retrieveCustomerColumnsPromise?this._retrieveCustomerColumnsPromise:e.wrappedWithPromise(function(e,i){n._retrieveCustomerColumnsPromise=n.retrieveCustomerColumns(t).finally(function(){e(n._retrieveCustomerColumnsPromise)})})},m.prototype.retrieveCustomerColumns=function(t){var s=this;return e.wrappedWithPromise(function(e,t){var a={securityContext:n.getSecurityContext(),onComplete:function(t){(t=UWA.is(t,"string")?JSON.parse(t):t).results?(t.results=s._buildAuthorizedValuesArray(t.results),s._storeCustomerAttributes(t.results)):t.Dictionary&&s._filterAndStoreCustomerAttributes(t),e(s.customerExtension)},onFailure:function(t){var n=o.getParseErrorMessage(t);r.errorAlert(n),e(n)},onTimeout:function(t){var n=o.getParseErrorMessage(t);r.errorAlert(n),e(n)}},l=[];s.app.isAttributeManagmentEnabled()?(s.app.getCustomizedColumn().forEach(function(e){var t=e.dataIndex?e.dataIndex.substring(e.dataIndex.indexOf(":")+1,e.dataIndex.length):"";void 0!==t&&""!==t&&l.push(t)}),a.attributes=l.join(","),i.getAttributeInfo(a)):i.getDictionaryCUSTO(a)})},m.prototype._storeCustomerAttributes=function(e){var t=this;for(key in this.customerAttributes=e,t.customerExtension=[],e)e.hasOwnProperty(key)&&e[key].forEach(function(e){t.customerExtension.push(e)})},m.prototype._filterAndStoreCustomerAttributes=function(e){this.customerExtension=[],e=UWA.is(e,"string")?JSON.parse(e):e;let t=this.app.getCustomizedTypes(),n=this.app.getSetting("Customized_types"),i=e.Dictionary;for(spec in i)for(key in i[spec])if(i[spec].hasOwnProperty(key)&&i[spec][key].Attributes){let e=!1;if(i[spec][key].ScopeTypes&&i[spec][key].ScopeTypes.forEach(function(i){let r=t[i]?t[i]:i;n.indexOf(r)>-1&&(e=!0)}),i[spec][key].FirstOOTB){let t=i[spec][key].FirstOOTB;n.indexOf(t)>-1&&(e=!0)}if(e){let e=i[spec][key].Attributes;for(attrKey in e){let t=e[attrKey],n={};n.attrName=t.Name,"OtbERConfiguration"==i[spec][key].Package&&(n.attrName=i[spec][key].Name+"."+t.Name);var r=n.attrName;"Interfaces"===spec&&(t.Nature="attribute"),t.SixWPredicate?n.sixWTag=t.SixWPredicate:n.sixWTag="ds6wg:"+r,n.DBName="attribute["+r+"]",n.nature=spec==t.Nature.toLowerCase(),n.type=t.Type,n.extensionName=i[spec][key].Name,n.preferredunitNls=t.ManipulationUnit,t.UIAccess&&"readwrite"==t.UIAccess.toLowerCase()?n.isReadOnly=!1:n.isReadOnly=!0,n.dimension=t.Dimension,n.defaultValue=t.Default,t.AuthorizedValues&&(n.authorizedValues=t.AuthorizedValues,n.nlsCalculated=!1),t.MultiValuated&&"yes"==t.MultiValuated.toLowerCase()?n.isMultiValuated="true":n.isMultiValuated="false",t.Multiline&&"yes"==t.Multiline.toLowerCase()?n.isMultiline=!0:n.isMultiline=!1,this.customerExtension.push(n)}}}},m.prototype._buildAuthorizedValuesArray=function(e){for(var t in e)e[t].forEach(function(e){e.authorizedValues=e.authorizedValues?e.authorizedValues.split(","):[],e.attrName&&(e.alphaNumAttrName=e.attrName.replace(/[^a-zA-Z0-9 ]/g,""))});return e},m.prototype.getCustomerAttribute=function(e){for(var t=[],n=0;n<this.customerExtension.length;n++){e===(this.customerExtension[n].SixWPredicate?this.customerExtension[n].SixWPredicate:this.customerExtension[n].sixWTag)&&(this.customerAttributeToFetch.push(this.customerExtension[n]),t.push(this.customerExtension[n]))}return t},m.prototype.loadConfigurationSettings=function(){var t=this;return e.wrappedWithPromise(function(e,s){if(t.configSettingsIsLoaded)return e(t.getConfigSettings());i.getConfigSettings({securityContext:n.getSecurityContext(),json:{version:"1.0",settings:["DecoupleVariantEvolution"]},onComplete:function(n){t.configSettingsIsLoaded=!0,n=JSON.parse(n),Array.isArray(n.settings)&&(t.configSettings=n.settings),e(n)},onFailure:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)},onTimeout:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)}}),i.getReQConfigAuthManagement({onComplete:function(e){JSON.parse(e).family.forEach(function(e){"WorkUnderConfiguration"==e.id?e.parameter.forEach(function(e){"ReqECCEnabled"==e.id&&e.argument.forEach(function(e){"Enabled"===e.argValue&&(t.isChangeEnabled="true")})}):"ConcurrentEngineering"==e.id&&e.parameter.forEach(function(e){"ReqCEEnabled"==e.id&&e.argument.forEach(function(e){"Enabled"===e.argValue&&(t.isConcurrentEngineeringEnabled="true")})})})},onFailure:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)},onTimeout:function(e){var t=o.getParseErrorMessage(e);r.errorAlert(t)}})})},m}),define("DS/RequirementStructureBrowser/requirementServices/TRMUserPreferenceService",["UWA/Core","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils"],function(e,t,n,i){"use strict";var r=null;return{initialize:function(e){r=e;var t=this;e.PrefService=this;var n=this.retrieveUserPreferences();t.paramAttributes={},r._applicationChannel.subscribe({event:"ENXViews/AttributesCustomization/columnModification"},function(e){t._columnsModificationListener(e)}),e.optionalStartup.push(n)},_columnsModificationListener:function(e){if(e&&e.what)switch(e.what){case"close":this._updateUserPreferences(e);break;case"addRemoveColumns":break;case"reset":this._resetColumnsConfiguration();break;case"visibilityColumn":case"changeTitle":break;case"exportColumn":case"pinChange":default:console.warn("column modification intent is not handle "+e.what)}},getUserPreferences:function(){return this.userPreferences},_resetColumnsConfiguration:function(){var e=this._getDefaultAttributesPreferences();e.customViewsInfo=this._getCustomViewsPreferences(),this._persistPreferences(e)},_updateUserPreferences:function(e){var t=this.userPreferences,n=t.columns,i=t?t.customViewsInfo:{},r=void 0;e&&e.selectedAttributes?r=this._getFormattedAttributes(e.selectedAttributes):i=e.customViewsInfo,this.userPreferences={selectedTypes:e.selectedTypes?e.selectedTypes:t.selectedTypes,selectedExtensions:e.selectedExtensions?e.selectedExtensions:t.selectedExtensions,columns:r||n,customViewsInfo:i||{}},this._persistPreferences(this.userPreferences)},_persistPreferences:function(e){if(e&&e.columns&&e.selectedExtensions&&e.selectedTypes){this.userPreferences=e;var t=JSON.stringify(e);widget.setValue("ap_custo",t),n.setMyAppPreferences({preference_name:widget.getValue("x3dAppId")+"-"+i.getPlatformId(),value:t,onComplete:function(e){console.log(e)},onFailure:function(e){console.log(e)}})}},retrieveUserPreferences:function(){var e=this;return t.wrappedWithPromise(async(t,n)=>{if(e.userPreferences=await e._retrievePreferenceFromWidget(),!e.userPreferences)try{e.userPreferences=await e._retrievePreferencesFromCompass()}catch(t){e.userPreferences=e._getDefaultAttributesPreferences(),e.userPreferences.customViewsInfo=e._getCustomViewsPreferences()}t(e.userPreferences)})},_retrievePreferencesFromCompass:function(){var e=this;return t.wrappedWithPromise(function(t,r){n.getMyAppPreferences({preference_name:widget.getValue("x3dAppId")+"-"+i.getPlatformId(),onComplete:function(n){return n?"string"==typeof n&&""===n.trim()?r(null):("string"==typeof n&&(n=JSON.parse(n),e._checkObseleteColumnsMapping(n)),n.selectedTypes&&n.selectedExtensions&&n.columns?t(n):void r(null)):r(null)},onFailure:function(e){console.log(e),r(null)}})})},_checkObseleteColumnsMapping:function(e){var t=r.getSetting("basicAttrList");e.columns.forEach(function(e){"ds6wg:PLMReference.V_isLastVersion"===e.dataIndex&&(e.dataIndex="ds6w:isLastRevision",e.ds6w="ds6w:isLastRevision"),"ds6w:organization"===e.dataIndex&&(e.dataIndex="ds6w:organizationResponsible",e.ds6w="ds6w:organizationResponsible"),"ds6w:covers"===e.dataIndex&&(e.dbName="covers"),"ds6w:refinedInto"===e.dataIndex&&(e.dbName="refineInto"),t.indexOf(e.dataIndex)>-1?e.nature="basic":(e.nature="attribute","paramContent"==e.dataIndex&&(e.nature="computed"))}),this._persistPreferences(e)},_retrievePreferenceFromWidget:function(){var t={};try{t=JSON.parse(widget.getValue("ap_custo")||"{}")}catch(e){console.error(e)}return t&&t.selectedExtensions&&Array.isArray(t.columns)&&t.columns.length>0&&t.selectedTypes?e.extend({},{columns:t.columns,selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes,customViewsInfo:t.customViewsInfo?t.customViewsInfo:{}}):null},_getDefaultAttributesPreferences:function(){return{selectedTypes:r.getDefaultSelectedTypes("defaultSelectedTypes"),selectedExtensions:r.getDefaultSelectedExtensions("defaultSelectedExtensions"),columns:r.getDefaultAttributes("defaultAttributes")}},_getCustomViewsPreferences:function(){return this.userPreferences&&this.userPreferences.customViewsInfo?this.userPreferences.customViewsInfo:{}},_getFormattedAttributes:function(e){return e.map(function(e){var t={dataIndex:e.dataIndex,ds6w:e.ds6w,kind:e.kind,dbName:e.internalName,visibleFlag:e.attrVisible,text:e.text,nature:e.nature,pinned:e.pinContent};return e.ds6wFrom&&(t.ds6wFrom=e.ds6wFrom),e.isAdditionalColumn&&e.provider&&(t.isAdditionalColumn=e.isAdditionalColumn,t.provider=e.provider),e.customisation&&e.customisation.layout&&Object.keys(e.customisation.layout).length>0&&(e.customisation.layout.canBeGroup||delete e.customisation.layout.canBeGroup,t.customisation=e.customisation),e.attrDim&&e.attrDim.length>0&&(t.attrDim=e.attrDim,e.attrUnit&&e.attrUnit.length>0&&(t.attrUnit=e.attrUnit)),t})}}}),define("DS/RequirementStructureBrowser/RequirementAppContext",["DS/CoreEvents/ModelEvents","UWA/Class/Options","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/TraceableRequirementsUtils/mixins/_ReqBIFilter","UWA/Class/Promise","DS/PADUtils/PADContext","DS/PADUtils/PADSession","DS/PADUtils/PADCommandProxy","DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/views/DndController","DS/TraceableRequirementsUtils/utils/TRMConstant","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/REQCommandProxy","DS/RequirementStructureBrowser/controllers/StructureEditorContoller","DS/RequirementStructureBrowser/utils/TRMMask","DS/RequirementStructureBrowser/requirementServices/StructureEditorDataService","DS/RequirementStructureBrowser/requirementServices/ColumnMgtService","DS/RequirementStructureBrowser/requirementServices/TRMUserPreferenceService","DS/RequirementStructureBrowser/requirementServices/TRMPersistencyManager","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/TraceableRequirementsUtils/utils/TRMTypeManagement","DS/RequirementStructureBrowser/treemodel/RequirementTreeDocument","DS/RequirementStructureBrowser/components/RequirementCCP","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","DS/RequirementStructureBrowser/utils/TRMModelEvent","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable","DS/CfgBaseUX/scripts/CfgUtility","DS/TraceableRequirementsUtils/utils/SearchManager","DS/RequirementStructureBrowser/utils/UpdateSearchView","text!DS/RequirementStructureBrowser/assets/ENOREQ.2D.json","css!DS/RequirementStructureBrowser/RequirementStructureBrowser.css"],function(e,t,n,i,r,o,s,a,l,u,c,d,p,f,h,g,m,v,_,S,b,C,y,R,E,A,w,D,I,P,x,T,O,N,M,U,q,B,V,W){"use strict";var k=JSON.parse(x),L=JSON.parse(W);return i.extend(t,r,s,P,{init:function(t){var n=this;l.set(this),this._parent(t),this.options=UWA.extend(this.options,t,!0),this.elements.container=UWA.createElement("div",{class:"req_component"}),this._appContext=l.get(),n.mandatoryStartup=[],n.optionalStartup=[],this._initProxyEvents(),this._localModelEvent=new e,this._applicationChannel=new e,this._trmModelEvents=N.getModelEvents(),n.mandatoryStartup.push(R.initialize(n)),this.defaultAttributeRange={Priority:{},"User Requirement Importance":{},Difficulty:{},"Requirement Classification":{}},A.allSettled(n.mandatoryStartup).then(function(){E.initialize(n),n.options.model=new I,n.options.model.initialize(n),n.initializeBI(n),n.DataService=new C,n.DataService.init(n);var e=function(e){return new a(function(t,n){a.cast(y.initialize(e)).finally(function(){return e.additionalColumnsProv,y.getLoadedColumnProvidersAsArray&&(e.additionalColumnsProv=y.getLoadedColumnProvidersAsArray()),t(!0)})})}(n),t=A.allSettled(n.optionalStartup),i=A.allSettled(e);t.then(function(){i.finally(function(){n.initApp()}).catch(function(e){})})})},initApp:function(e){this.reqProxy=_,this._padCommandProxy=c.create(),this.reqCommandProxy=_.create(),this._applicationChannelTokens=[],this._localModelEventsTokens=[],this._structureEditorEventsTokens=[],this.externalTypes=["ProxyItem"],this.active_view="",this.previous_view="",this.buildStructureView(),this.subscribeEvents(),this.options.widget.dispatchEvent("onReady")},saveCSRF:function(e){this._csrf=e},getCSRF:function(e){return this._csrf},buildStructureView:function(){if(!this.structureEditor){this.structureEditor=new S,this.structureEditor.init(this);var e={container:this.elements.container,dragContainer:this.elements.container.getElementsByClassName("breadcrumb-container")[0],dropContext:[{id:h.OPENWITHCONTEXT,icon:"wux-ui-3ds-drag-drop",title:O.openWithContext},{id:h.OPEN,icon:"wux-ui-3ds-open",title:O.open},{id:h.FILTERANDOPEN,icon:"wux-ui-3ds-filter-open",title:O.filterAndOpen}],events:this._trmModelEvents};f.initializeDropArea.call(this,e)}},displayNotification:function(e){switch(e.eventID){case"warning":g.warningAlert(e.msg);break;default:g.notifyAlert(e.msg)}},getNls:function(e){return T.get(e)},getSetting:function(e){return n.is(e,"string")&&n.is(k[e])?k[e]:null},getAppImmersiveFrame:function(){return this.immersiveFrame||(this.immersiveFrame=U.getImmersiveFrame()),this.immersiveFrame},setDnDBehavior:function(e){this.getModels().setDnDBehavior()},setConfirmdDialog:function(e){this.options.model.setConfirmdDialog(e)},loadStruct:function(e,t){void 0!==e&&e.length>0&&(this.structureEditor._loadData(e,t),this._trmModelEvents.publish({event:"TRMViews-WelcomePanel-closeLandingPage"})),0===this.getModels().getRoots().length&&this.empty()},updateStoredObjects:function(e){if(Array.isArray(e)){e.length>0&&(this._trmModelEvents.publish({event:"TRMViews-WelcomePanel-updateStoredObjects",data:{item2remove:e}}),0===this.getModels().getRoots().length&&this.empty())}},retrievePhysicalId:async function(e){var t=this;return A.wrappedWithPromise(async(n,i)=>{var r=e;e||n(r={physicalid:t.PersistencyManager.getUserWorkingNodeIDs()});if(r.filteredObject&&r.physicalid){let e="fromDropOnFilter"===r.behavior;var o={filterObjectIds:r.physicalid,behavior:r.behavior,physicalid:[],processedFilterObj:[],filterInfo:[]};t.cleanProxy();for(let i=0;i<r.physicalid.length;i++){let s=[r.physicalid[i]],a=await t.retrieveFilter(s,e);a.rootId&&(o.physicalid.push(a.rootId),o.filterInfo.push(a)),o.processedFilterObj.push(a),t.checkIfAllFilterObjectsProcessed(o,n)}}else if(r.physicalid&&r.biProxyCtx){o={filterObjectIds:r.physicalid,physicalid:[],processedFilterObj:[],filterInfo:[]};for(let e=0;e<r.physicalid.length;e++){let i=r.physicalid[e],s=await t._shareFilterSpec(i,r.biProxyCtx);s.rootId&&(o.physicalid.push(s.rootId),o.filterInfo.push(s)),o.processedFilterObj.push(s),t.checkIfAllFilterObjectsProcessed(o,n)}}else r.physicalid&&(Array.isArray(r.physicalid)||(r.physicalid=r.physicalid.split(",")),n(r))})},checkIfAllFilterObjectsProcessed:function(e,t){e.processedFilterObj.length===e.filterObjectIds.length&&t(e)},launchStructureBrowser:function(e){var t=this;t.retrievePhysicalId(e).then(function(n){t.options.model.checkIfRootAlreadyExist(n.physicalid),n.physicalid.length>0?t.DataService.getObjectInfo(n).then(function(i){var r=[];i.results.forEach(function(e){var i=M.process.createNode({treedocument:t,data:e,tenant:t.getTenant()},t.externalTypes);if(-1!==t.getSetting("authorized_root_type").indexOf(i.getKindOf())){var o=n.physicalid.indexOf(i.getID());r[o]=i}else g.warningAlert(O.drop_unauthorizeRootType)}),0!=r.length&&(r=r.filter(function(e){return void 0!==e}),e?t.loadStruct(r,e.occurrencePath):t.loadStruct(r),(null!=n.behavior||n.filterInfo&&n.filterInfo.length>0)&&(p.determineAuthoredFlag()?g.warningAlert(O.filterInAuthoring):"fromDropOnFilter"===n.behavior?t.launchFilterCommand(n.physicalid[0]):t.applyFilterOnOpenAndDroppedFilterObject(n.filterInfo)))}).catch(function(e){t.updateStoredObjects(n.physicalid)}):t._trmModelEvents.publish({event:"TRMViews-WelcomePanel-closeLandingPage"})})},empty:function(){this._applicationChannel.publish({event:"breadcrumb-link-clicked",data:{linkID:w.EMPTY_STRUCTURE_BROWSER}})},search:function(e){var t="";e&&e.length>0&&(t=e),this._applicationChannel.publish({event:"search-in-current-dashboard",data:t})},getModels:function(){return this.options.model},getCustomizedTypes:function(){return p.getAuthorizedTypesWithParent()},getDictionaryAttributes:function(e){for(var t=[],n=0;n<this.DataService.customerExtension.length;n++){let i=this.DataService.customerExtension[n];e!==i.sixWTag&&e!==i.DBName||t.push(this.DataService.customerExtension[n])}return t},isIndexMode:function(){return!p.determineAuthoredFlag()},getActiveDGV:function(){return this.views.datagridview},_initWorkUnderChange:function(e){var t=this;UWA.is(t.CfgAuthoringContext)||require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(n){t.CfgAuthoringContext=n;n.initialize2(e,t.reqProxy.appId(),"show","bottom-right",function(e){t.options.widget.dispatchEvent("onAuthoringCtxAvailable",e),o.subscribe(t.CfgAuthoringContext.myAuthkey,function(e){setTimeout(function(){t._applicationChannel.publish("onRefresh")},1e3)}),o.subscribe("toggleDeActiveCA"+t.CfgAuthoringContext.myAuthkey,function(e){setTimeout(function(){t._applicationChannel.publish("onRefresh")},200)}),o.subscribe("removeAuthCtxEvent"+t.CfgAuthoringContext.myAuthkey,function(e){setTimeout(function(){t._applicationChannel.publish("onRefresh")},200)})},{isEvolution:!0})})},getAuthoringContextHeader:function(){var e;if(UWA.is(this.CfgAuthoringContext))try{var t=this.CfgAuthoringContext.get();t&&t.AuthoringContextHeader&&(e=t.AuthoringContextHeader)}catch(e){console.warn("CfgAuthoringContext throw an error")}return e},getAuthoringContextPID:function(){var e="";if(UWA.is(this.CfgAuthoringContext))try{var t=this.CfgAuthoringContext.get();e=UWA.is(t)&&UWA.is(t.change.id)?t.change.id:""}catch(e){console.warn("CfgAuthoringContext throw an error")}return e},getAuthoringContextName:function(){var e="";if(UWA.is(this.CfgAuthoringContext))try{var t=this.CfgAuthoringContext.get();e=UWA.is(t)&&UWA.is(t.change.name)?t.change.name:""}catch(e){console.warn("CfgAuthoringContext throw an error")}return e},isAttributeManagmentEnabled:function(){return!(!this.useENOREQ2D||"true"!==this.useENOREQ2D)},getCustomizedColumn:function(){return L.pad_columns?L.pad_columns:[]},getDefaultAttributes:function(){return this.getSetting("defaultAttributes")},getDefaultSelectedTypes:function(){return this.getSetting("defaultSelectedTypes")},getDefaultSelectedExtensions:function(){return this.getSetting("defaultSelectedExtensions")},getColumnProviderSetting:function(){return this.getSetting("columnsProviders")},isConfigAuthorized:function(){return!!this.isDecouplingActivated()},isDecouplingActivated:function(){for(var e=this.DataService.getConfigSettings(),t=null,n=0;n<e.length;n++)if("decoupleVariantEvolution"===e[n].settingName){t=e[n];break}return!(!t||"enabled"!=t.value)},getReqSpecRoot:function(e){return e.getRoot().getID()},refreshOnRevise:function(e){var t=this;this.author(!0);var n=[],i=[],r=[];new a(function(o){e.forEach(function(s){var l=t.options.model.getNodesByRelId(s.old_rel_id)[0],u=l.options.Effectivity,c=l.options.grid["ds6w:isLastRevision"],d=l.options.grid["ds6w:status"],p=l.getParent().getID();r.push(p);var f=t.getAuthoringContextPID();s.object.type_icon_url=l.options.type_icon_url;var h={parentID:p};new a(function(e){e(q.getConfiguredObjectInfo(h))}).then(function(r){r=r.contexts.content.results;l.getParent();if(i.push({resourceid:s.object.physicalid,relationid:s.object["physicalid[connection]"],treeOrder:s.object["attribute[TreeOrder]"],parentID:p}),""==f||null==f&&null==f||0==r||null==r){h=s.old_rel_id;n.push(h);var a=t.options.model.getNodesByRelId(s.old_rel_id)[0].getParent().getOccurencePath();a.push(s.object["physicalid[connection]"]),a.push(s.object.physicalid),t.reqCommandProxy.revise({data:s,newPath:a,selection:t.options.model.getNodesByRelId(s.old_rel_id)[0].getParent().getOccurencePath(),path:t.options.model.getNodesByRelId(s.old_rel_id)[0].getOccurencePath(),appId:widget.getValue("appId")})}else{if("Yes"==u&&"TRUE"==c&&"Released"!=d){var h=s.old_rel_id;n.push(h)}var g=[];g.push(s.old_object_id),t.structureEditor.UpdateModifiedNodes(g);var m=l.getParent().getOccurencePath();m.push(s.object["physicalid[connection]"]),m.push(s.object.physicalid);var v={appId:widget.getValue("appId"),object:s.object,path:m,selection:l.getOccurencePath(),mode:"insert"};t.reqCommandProxy.attach(v)}e.length==i.length&&o(i)})})}).then(function(e){t.getModels().refreshNodeById({deleted:n}),t.insertNodes(e),t._updateNodesOnTRMWidget(r)})},refreshOnRemove:function(e,t){this.author(!0);var n=e.path[e.path.length-2],i=this.getModels().getNodesByRelId(n)[0];if(null!=this.getAuthoringContextHeader()&&0==e.PhysicalDelete)this.getModels().updateProviderColumns([i],"OnSyncModel");else{var r=[],o=[];if(i){var s=i.getParentId();r.push(s)}n&&o.push(n),this._updateNodesOnTRMWidget(r),this.getModels().refreshNodeById({deleted:o,modified:r})}!0===t&&this.reqCommandProxy.detach({appId:widget.getValue("appId"),path:e.path,physicalid:e.physicalid,PhysicalDelete:e.PhysicalDelete})},refreshOnInsert:function(e,t,n){this.author(!0);var i,r=this,o=[],s=[],a=[];null==n&&(n="insert"),null===t&&(t="ENORETV_AP"),(UWA.is(e,"string")?JSON.parse(e):e).forEach(function(e){var l=e["from.physicalid[connection]"],u=e.oldParentID,c=UWA.is(e.resourceid)?e.resourceid:e.physicalid,d=e["physicalid[connection]"],p=e["attribute[TreeOrder]"];i=e.objectType;var f=r.options.model.getNodesById(l)[0];o.push({resourceid:c,relationid:d,parentID:l,treeOrder:p,oldParentID:u}),a.push(l);var h=f.getOccurencePath();h.push(e["physicalid[connection]"]),h.push(e.physicalid);var g={object:e,path:h,selection:h,mode:n};if("ENORERV_AP"!==t)if("DOCUMENTS"===e["type.kindof"]){var m={paths:[[c]],appId:widget.getValue("appId")};r.reqCommandProxy.drop(m)}else s.push(g);var v=r.getAuthoringContextName();v&&(f.options.grid["ds6w:realizedChangeAction"]=v,f.updateOptions(f.options))}),r.insertNodes(o),"ENORERV_AP"!==t&&i!=w.TYPE_PARAMETER&&r.reqCommandProxy.attach({appId:widget.getValue("appId"),eventData:s}),r._updateNodesOnTRMWidget(a)},_updateNodesOnTRMWidget:function(e){if(e.length>0){var t={authored:{modified:e},appId:widget.getValue("appId")};this._padCommandProxy.refresh(t)}},refreshOnReorder:function(e,t){var n=[],i=this,r=parseFloat(e.new_position.treeOrder);i.options.model.getRoots().forEach(function(t){var n=function(t,n){var i=t.getChildren(),o=0;if(i&&i.length>0)for(;o<i.length;){if(i[o].options.relationOrder>r){if(n.options.relationid===i[o].options.relationid){i[o].options.relationOrder=r,i[o].options.relationid=e.new_position.relid;break}n.options.relationOrder=r,n.options.relationid=e.new_position.relid,t.insertBefore(n,i[o]);break}if(o==i.length-1){n.options.relationOrder=r,n.options.relationid=e.new_position.relid,t.addChild(n);break}o++}else n.options.relationOrder=r,n.options.relationid=e.new_position.relid,t.addChild(n),t.expand()},o=t.getNodesById(e.new_position.path[e.new_position.path.length-1]);o&&o.forEach(e=>e.expand());for(var s=i.options.model.getNodesByRelId(e.old_position.relid),a=0;a<s.length;a++)o[a]&&n(o[a],s[a])}),n.push(e.id),n.push(e.old_position.id),n.push(e.new_position.id),i.getModels().refreshNodeById({modified:n}),i._updateNodesOnTRMWidget(n)},refreshOnDnD:function(e,t){var n=this,i=[];n.author(!0),(UWA.is(e,"string")?JSON.parse(e):e).forEach(function(e){var t=e["physicalid[connection]"],r=e["from.physicalid[connection]"],o=n.getModels().getNodesById(r),s=e["old_physicalid[connection]"],a=e["attribute[TreeOrder]"],l=s?n.options.model.getNodesByRelId(s):"",u=l?l[0].getOccurencePath():"",c=l?l[0].getParent().options.resourceid:r,d=e.physicalid,p=e.status;e.oldParentID=c,e.type_icon_url=l[0].options.type_icon_url;var f={id:d,appId:widget.getValue("appId"),new_position:{relid:t,path:o[0].getOccurencePath(),id:r,treeOrder:a},old_position:{relid:s||t,path:o[0].getOccurencePath(),id:c}};i.push(d),n.refreshOnInsert([e],null,"insertExisting"),"delete"==p&&(e.path=u,e.PhysicalDelete=!0,n.refreshOnRemove(e,!0)),n.reqCommandProxy.reorder(f)})},openPanel:function(e){this.elements.openPanel(e)},insertNodes:function(e,t,n){this.options.model.insertNodes(e,t,n)},refreshOnCreate:function(e,t,n){var i=this;i.active_view==w.VIEW_STRUCTURE_BROWSER?i.DataService.getObjectInfo(e).then(function(e){var r=e.results[0],o=M.process.createNode({treedocument:i,data:r,tenant:i.getTenant()},i.externalTypes);if(i.options.model.prepareUpdate(),i.options.model.addRootNodes([o]),i.options.model.pushUpdate(),!t){let e={data:{nodeModel:o,numberOfLevelsToExpand:"-1"}};i.options.model.expand(e),n&&i.options.model.removeRoot(n)}i._applicationChannel.publish({event:"RequirementStructureBrowser-Root-manage",data:{added_node:o}})}).catch(function(e){console.log(e)}):i._trmModelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:e})},refreshOnInsertSibling:function(e,t){this.author(!0);let n=this,i=[],r=this.getSelectedNode(),o=r.getParent().getID(),s=UWA.is(e,"string")?JSON.parse(e):e,a=s;Array.isArray(s)&&(a=s[0]);let l=a.resourceid,u=a["physicalid[connection]"],c=a["attribute[TreeOrder]"],d=[];d.push({resourceid:l,relationid:u,parentID:o}),i.push(o),n.insertNodes(d,t,c),n.options.model.prepareUpdate(),n.options.model.pushUpdate();let p=r.getOccurencePath(),f=r.getParent().getOccurencePath();f.push(a["physicalid[connection]"]),f.push(a.physicalid);let h={appId:widget.getValue("appId"),object:a,path:f,selection:p,mode:"append"},g=a["type.kindof"];g!==w.TYPE_REQUIREMENT_GROUP&&g!==w.TYPE_REQUIREMENT_SPECIFICATION&&n.reqCommandProxy.attach(h),n._updateNodesOnTRMWidget(i)},refreshGridForSetEffectivities:function(e){this.author(!0);var t=this,n=[],i=[],r=!1,o=UWA.is(e,"string")?JSON.parse(e):e;o.commandName;o=o.response.results?o.response.results:o.data;var s=[];o.pids?(o.pids=o.pids?o.pids:[],o.pids.forEach(function(e){var n=t.getModels().getNodesById(e)[0];s.push(n)})):o.forEach(function(e){if("SUCCESS"===e.status)if(e.existing&&!e.new){var a=t.getModels().getNodesByRelId(e.existing.pid);s.push(a[0])}else if(e.new){r=!0;var l=A.wrappedWithPromise(function(r,a){var l=t.getModels().getNodesByRelId(e.existing.pid)[0],u=l.options.resourceid,c=l.getParent().getID(),d=(c=l.getParent().getID(),{physicalid:e.new.pid});t._appContext.DataService.getTreeOrder(d).then(function(t){s.push(l);var a="";null==t["attribute[TreeOrder]"]&&""==t["attribute[TreeOrder]"]||(a=t["attribute[TreeOrder]"]),n.push({resourceid:u,relationid:e.new.pid,treeOrder:a,parentID:c});var d=l.getOccurencePath(),p=l.getParent().getOccurencePath();p.push(e.new.pid),p.push(u);var f={};f.displayName=l.options.type,f.value=l.options.type;var h=[],g={"attribute[Title]":l.options.req_label,"attribute[TreeOrder]":a,"from.physicalid[connection]":c,name:l.options.req_name,physicalid:u,"physicalid[connection]":e.new.pid,"type.kindof":l.options.reqKindOf,"type[connection]":l.options.relationtype,type:{displayName:l.options.grid["ds6w:type"],value:l.options.type},revision:l.options.grid["ds6wg:revision"]};h.push(g);var m={appId:widget.getValue("appId"),object:h[0],path:p,selection:d,mode:"append"};i.push(m),o.length==n.length&&r(n)}).catch(function(e){console.log(e)})});A.allSettled(l).then(function(e){"fullfilled"===e[0].state&&(t.insertNodes(e[0].value),t.getModels().updateProviderColumns(s,"OnSyncModel"),t.reqCommandProxy.attach({appId:widget.getValue("appId"),eventData:i}))})}}),s.length>0&&!1===r&&t.getModels().updateProviderColumns(s,"OnSyncModel")},getPADTreeDocument:function(){return this.options.model},getSelectedElement:function(){var e=this.getSelectedNodes();if(1!=e.length)return null;var t=e[0],n=t.getType();return{physicalid:t.getID(),type:n,path:t.getOccurencePath(),ParentLabel:t._parentNode.options.label,label:t.options.label,kindof:p.getKindOf(n)||n}},getSelectedElementList:function(){var e,t=this.getSelectedNodes(),n=[];if(t.length<1)return null;for(var i=0;i<t.length;i++){var r=t[i],o=r.getType();e={physicalid:r.getID(),type:o,path:r.getOccurencePath(),ParentLabel:r._parentNode.options.label,label:r.options.label,kindof:p.getKindOf(o)||o},n.push(e)}return n},author:function(e){u.setAuthoringState(e,T.disabling_index_authored_operation)},getAttributeInfo:function(e){return this.columnManager.getColumnInfo(e)},getSecurityContext:function(){return{SecurityContext:p.getSecurityContext()}},getTenant:function(){return p.getTenant()},getSelectedNodes:function(){var e=this,t=this.options.model.getSelectedNodes();return UWA.is(t)&&t.forEach(function(t){t.tenant=e.getTenant()}),t},getSelectedNode:function(){var e=this,t=this.options.model.getSelectedNodes();return UWA.is(t)&&t.forEach(function(t){t.tenant=e.getTenant()}),t[0]},getToAddSelectedElement:function(){var e=this.getSelectedNodes();if(e.length<1)return null;if(e.length>1)return null;var t=e[0],n=t.getParent(),i=n.getChildren(),r=i.indexOf(t),o={},s={id:t.options.resourceid,relId:t.options.relationid};i.length>r+1&&(o={id:i[r+1].options.resourceid,relId:i[r+1].options.relationid});var a=n.getType();return{physicalid:n.options.resourceid,type:a,path:e[0].getOccurencePath(),kindof:p.getKindOf(a)||a,nextSibling:o,previousSibling:s,previousNode:r}},getEditMode:function(){return!0},beginBlockingTransaction:function(e){b.mask(this.elements.container,e)},endBlockingTransaction:function(){b.unmask(this.elements.container)},addNodesFromContent:function(e,t){let n=this;D.retrieveAuthorizedObjects({X3DContentId:e,version:"2.0",callback:function(e){if(e){let t,i={filteredObject:!1};if(e.authorized_root_objects&&0!=e.authorized_root_objects.length){let n=[];e.authorized_root_objects.forEach(function(e){n.push(e.objectId)}),t={physicalid:n}}if(e.authorized_filter_objects&&e.authorized_filter_objects.length>0){i.filteredObject=!0;let n=[];e.authorized_filter_objects.forEach(function(e){n.push(e.objectId)}),t={physicalid:n}}i.physicalid=t.physicalid,n._trmModelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:i})}else e.unauthorized_objects.length>0&&e.unauthorized_objects.forEach(function(e){let t=n.getNls("unauthorizedRootType");t=t.replace("{type}",e.displayType),g.warningAlert(t)});t.callback()}})},createRootobjects:function(e){require(["DS/TraceableRequirementsUtils/Command/HomePage_CreateCmd"],function(t){new t(e).execute()})},_onWidgetRefresh:function(){var e={action:"refresh",appId:widget.getValue("appId")};this.reqCommandProxy.refresh(e)},_initProxyEvents:function(){var e=this;if(e.mandatoryStartup.push(A.wrappedWithPromise(function(t,n){v.getCustomTypes({type:"Requirement",selectables:"type,name,revision,attribute[Title]",onComplete:function(n){var i=UWA.is(n,"string")?JSON.parse(n):n;e.saveCSRF(i.csrf),e.useENOREQ2D=i.useENOREQ2D,t(e.useENOREQ2D)},onFailure:function(e){var t=m.getParseErrorMessage(e);g.errorAlert(t)}})})),"enopad_odt_wgd"!=widget.id)try{require(["text!DS/OSLCConsumer/assets/OSLCConfig.json"],function(t){e.OSLCProviders=JSON.parse(t),UWA.is(e.OSLCProviders)&&UWA.is(e.OSLCProviders.repositories)&&e.OSLCProviders.repositories.length>0&&(e.externalProviders=!0)})}catch(e){console.log("/OSLCConsumer/assets/OSLCConfig.json file not found")}try{require(["text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(t){e._relPattern=JSON.parse(t)})}catch(e){console.log("/OSLCConsumer/assets/OSLCConfig.json file not found")}UWA.is(this._padCommandProxy)||(e._padCommandProxy=c.create({events:{onRefresh:function(t){let n=UWA.is(t,"object")?t:JSON.parse(t);if("ENORETV_AP"===n.appId)return;let i=n.authored;i&&i.modified&&e.getModels().refreshNodeById({modified:i.modified})},onSelect:function(e,t){}}})),require(["DS/TraceableRequirementsUtils/REQCommandProxy"],function(t){e.reqCommandProxy=t.create({events:{onDrop:function(t){if("ENORETV_AP"!=t.appId){"new"===t.action&&e.author(!0);var n={pids:[t.id],id_to_detach:[]};e.richViewDropIn=!0,e.add(n)}},onReorder:function(t){if("ENORETV_AP"!==t.appId){var n=e.getAuthoringContextName(),i=e.getModels().getNodesByRelId(t.old_position.relid);if("keep"==t.status&&""!=n){e.getModels().updateProviderColumns(i,"OnSyncModel");var r=[];r.push({resourceid:t.id,relationid:t.new_position.relid,treeOrder:t.new_position.treeOrder,parentID:t.new_position.id}),e.insertNodes(r)}else e.refreshOnReorder(t)}},onResetTreeorder:function(t){e.author(!0);let n=e.getModels(),[i]=n.getNodesById(t.id),r={data:{nodeModel:i},numberOfLevelsToExpand:1};i.removeChildren(),i.options.childComputed=!1,n.expand(r)},onDetach:function(t){if("ENORETV_AP"!==t.appId){var n=e.options.model.getNodesById(t.path[t.path.length-1])[0];e.author(!0),n&&n.getID()===t.path[t.path.length-1]&&e.refreshOnRemove(t,!1)}},onTraceabilityAuthoring:function(t){e.author(!0);let n=[];t.objectIds.forEach(function(t){var i=e.getModels().getNodesById(t)[0];i&&n.push(i)}),n.length>0&&e.getModels().updateProviderColumns(n,"SyncCoverRefine")},onAttach:function(t,n){if("ENORETV_AP"!==t.appId){e.author(!0);var i=[];e.richView_node_id=t.selection[t.selection.length-1];var r=e.options.model.getNodesById(e.richView_node_id)[0];if("insert"===t.mode)r&&(i.push({resourceid:t.object.physicalid,relationid:t.object["physicalid[connection]"],parentID:r.getID()}),e.refreshOnInsert([t.object],"ENORERV_AP"));else{var o=r.getParent(),s=o.getChildren();if(o&&"expandState"!==o._expandState){var a=s.indexOf(r);i.push({resourceid:t.object.physicalid,relationid:t.object["physicalid[connection]"],parentID:o.getID()}),e.insertNodes(i,a)}}}},onReqSelect:function(t,n){if(!UWA.is(t.commandId)||"TVDeleteCommand"!==t.commandId)if("ENORETV_AP"!==t.appId){var i=e.options.model.getNodeByOccurencePath(t.paths[0]);UWA.is(i)&&(e.options.model.unselectAll(),setTimeout(function(){var t=e.getSelectedNode();UWA.is(t)||(e.richViewDropIn=!0),i.select();var n=e.getActiveDGV(),r=n.layout.getRowPosition(i._rowID);n.setScrollerPosition({y:r})},50))}else e.deleteCommand(t.data)},onPreferenceModification:function(e){if(UWA.is(e)&&UWA.is(e.appId)&&e.appId!==widget.getValue("appId")){var t=e.preferences;UWA.is(t)&&t.length>0&&t.forEach(function(e){(widget.hasPreference(e.name)?widget.setValue(e.name,e.value):"trm_security_ctx"===e.name&&widget.setValue("pad_security_ctx",e.value),"trm_security_ctx"===e.name&&p.setXPrefCredentials(widget,e.value),"useIndexAccleration"===e.name)&&require("DS/PADUtils/PADSession").setUseIndexPreference(e.value)})}},onRefresh:function(t){var n=function(n){var i=Object.getOwnPropertyNames(n);for(var r in i)"insertExisting"===i[r]?t.origin&&"CCP"===t.origin||e.getModels()._viewInsertExisting(n.insertExisting):"detach"===i[r]?e.getModels()._viewDetach(n.detach):"reParent"===i[r]&&e.getModels()._viewReParent(n.reParent)};if("refresh"==t.action){let t=e.getModels(),n=t.getRoots();t.refresh({roots:n})}else if(t.transactions)t.transactions.forEach(function(e){n(e)});else if(t.authored){var i={physicalid:t.authored.modified[0]};e.DataService.getObjectInfo(i).then(function(t){e.getModels().updateNodesByID(t,!0)}).catch(function(e){console.log(e),reject(e)})}else n(t)}}})}),o.subscribe("DS/PARParameterComponent/PlatformAPI/create",function(t){if(UWA.is(t.parentid)&&UWA.is(t.physicalid)&&UWA.is(t.relid)){var n=[{"from.physicalid[connection]":t.parentid,physicalid:t.physicalid,objectType:w.TYPE_PARAMETER,"physicalid[connection]":t.relid}];e.refreshOnInsert(n)}})},add:function(e,t,n){var i=e||{},r=[];switch(e.content){case"idslist":r=(i=e).pids;break;case"pathslist":for(var o=0;o<e.paths.length;o++)r.push(e.paths[o][0]);break;case"3DXContent":r=(i=_build3DXContentParams(e)).pids;break;default:if(!i.pids)throw new Error("Not supported content");r=i.pids}if(UWA.is(t,"function")&&(e.callback=t),!1===this.richViewDropIn){var s={paths:[i.pids],appId:widget.getValue("appId")};this.reqCommandProxy.drop(s)}this.launchStructureBrowser({physicalid:r})},_onSelect:function(e){if("enopad_odt_wgd"!=widget.id){var t=this.getSelectedNodes();if(d.clearObjects(),d.addAssignee([p.getUserLogin()]),t.length>0)for(var n=0;n<t.length;n++)d.addProposed([t[n].getID()]);else d.clearObjects()}},getEnforceSettings:function(){return this.DataService.isChangeEnabled},getSelectedExtensions:function(){return k.defaultSelectedExtensions},getBaseReferenceTypes:function(){return k.baseReferenceTypes},getBaseExtensions:function(){return k.baseExtentions},getBaseInstanceTypes:function(){return[]},getSelectedTypes:function(){return k.defaultSelectedTypes},_getDefaultAttributesPreferences:function(){return{selectedTypes:k.defaultSelectedTypes,selectedExtensions:k.defaultSelectedExtensions,columns:k.defaultAttributes}},subscribeEvents:function(){var e=this;e._applicationChannel.subscribe({event:"breadcrumb-link-clicked"},function(t){t.linkID===w.EMPTY_STRUCTURE_BROWSER&&e.deactivatedStructureBrowser(),e._trmModelEvents.publish({event:"TRMViews-WelcomePanel-activate"}),e._trmModelEvents.publish({event:w.EVENT_WELCOME_PANEL_EXPAND}),e.previous_view?t.id=e.previous_view:t.id=w.VIEW_RECENTLY_OPEN,e._trmModelEvents.publish({event:"welcome-panel-active-view",data:t})}),e._applicationChannel.subscribe({event:"search-in-current-dashboard"},function(t){if("StructureEditor"==e.active_view)if(t||!e._pagerview)if(p.determineAuthoredFlag())e._pagerview&&e._pagerview.hide(),g.notifyAlert(T.SearchAuthoringModeError);else{let n=e.options.model.getRoots();e.beginBlockingTransaction(),B.searchExecute(n,t).then(t=>{V.executeViewUpdate.call(e,t),e.endBlockingTransaction()}).catch(t=>{let n=m.getParseErrorMessage(t);g.errorAlert(n),e.endBlockingTransaction()})}else e._pagerview.hide()}),e._applicationChannel.subscribe({event:"TRMViews-StructureEditor-update"},function(t){setTimeout(function(){e._onWidgetRefresh(t)},500)})},deactivatedStructureBrowser:function(){var e=this.options.model.getRoots();this.cleanProxy(),this._pagerview&&this._pagerview.hide(),e&&e.length>0&&(this.options.model.removeRoots(),this._localModelEvent.publish({event:"RequirementStructureBrowser-Root-remove",data:{all:!0,noDispatch:!0}}),this.PersistencyManager.saveUserWorkingRootNodes([]))},loadFiles:function(e,t){return new a(function(t,n){var i=function(e){n(e)};Array.isArray(e)?require(e,function(){t(arguments)},i):i(e)})},getSelectedParentWithChild:function(e){if(null!=e&&e.length){for(var t=[],n=e.length,i=0;i<n;){for(var r=e[i],o=i+1;o<e.length;o++){for(var s=e[o],a=s.getParent(),l=!1;a;)r===a&&(l=!0,t.push({parent:r,child:s})),a=a.getParent();if(0==l)for(a=r.getParent();a;)s==a&&t.push({parent:r,child:s}),a=a.getParent()}i++}return t}return[]}})});