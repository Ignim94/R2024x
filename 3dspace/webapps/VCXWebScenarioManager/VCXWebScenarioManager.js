define("DS/VCXWebScenarioManager/VCXScenarioManager",["UWA/Utils","DS/CoreEvents/Events","UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebModifiables/VCXModifiableServer","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXKeyFramer/VCXKeyFramer","DS/VCXKeyFramer/VCXObjectAnimation","DS/VCXWebTracks/VCXTrack","DS/VCXWebTracks/VCXKey","DS/VCXWebProperties/VCXPropertyMap","DS/VCXKeyFramer/VCXScenario","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyInfo","DS/WebRBTree/WebRBIterator","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueList"],function(e,t,i,r,a,n,o,s,l,c,u,p,f,h,y,S,_){"use strict";var b=i.extend({getUpdatePriority:function(){return-10},init:function(){this._privateModifiableServer=null,this._callback=null,this._parameter=null,this._autoThumbnailUpdate=window&&window.localStorage&&"true"===window.localStorage.getItem("VCXAutoThumbnailUpdate")},initialize:function(){this._privateModifiableServer=new a,this._keyframer=new o(this._privateModifiableServer);var e=this._experienceBase.getManager("VCXContextManager");this._keyframer.SetContextMngr(e),this._CurrentScenarioID="",this._Scenarios={},this._FPS=30,this._interFramesMax=-1,this._startScenarioId="",this._startFrame=0,this._timeDelay=0,this._bIsPlaying=!1,this._bAutoKey=!1,this._bCameraAutoKey=!1,this._maxIndex=0,this._scenariosToPlay={},this._bIsBouncing=!1,this._previousFrame=0,this._speed=1,this._TransitionTime=1e3},unInitialize:function(){for(var e in this._WUXEventTokens)this._WUXEventTokens.hasOwnProperty(e)&&this._WUXEventTokens[e]&&(t.unsubscribe(this._WUXEventTokens[e]),this._WUXEventTokens[e]=null);this._CurrentScenarioID="",this.unInitializeScenario(),this._Scenarios={},this._FPS=30,this._startScenarioId="",this._bIsPlaying=!1,this._bAutoKey=!1,this._bCameraAutoKey=!1,this._maxIndex=0,this._scenariosLoadingPromises=null,this._scenariosToPlay={},this._keyframer&&(this._keyframer.unInitialize(),this._keyframer=null),this._privateModifiableServer&&(this._privateModifiableServer.unInitialize(),this._privateModifiableServer=null)},unInitializeScenario:function(){for(var e in this._Scenarios)this._Scenarios.hasOwnProperty(e)&&this._Scenarios[e].unInitialize()},postInitialize:function(){this._scenariosLoadingPromises={},this._WUXEventTokens={},this._WUXEventTokens.VCX_VOLATILE_PERSISTENT_POST=t.subscribe({event:"VCX_VOLATILE_PERSISTENT_POST"},e=>{var t=this.GetScenarios();for(var i in t)if(t.hasOwnProperty(i)){const a=t[i];if(a){var r=a.GetVisibility();r&&void 0!==r._visibilityMap[e.component.getPreviousComponentID()]&&(r._visibilityMap[e.component.GetID()]=r._visibilityMap[e.component.getPreviousComponentID()],delete r._visibilityMap[e.component.getPreviousComponentID()])}}})},SetAutoKey:function(e){this._bAutoKey!=e&&(this._bAutoKey=e,t.publish({event:"VCX_Timeline_AutoKey",data:this._bAutoKey}))},GetAutoKey:function(){return this._bAutoKey},SetCameraAutoKey:function(e){this._bCameraAutoKey!=e&&(this._bCameraAutoKey=e,t.publish({event:"VCX_Timeline_CameraAutoKey",data:this._bCameraAutoKey}))},GetCameraAutoKey:function(){return this._bCameraAutoKey},GetIsPlayingCurrentScenario:function(){return this._bIsPlaying},SetIsPlayingCurrentScenario:function(e){var t=this._Scenarios[this._CurrentScenarioID];if(t){var i=this._experienceBase.getManager("VCXVisuManager");if(e){if(t._bIsBouncing)if(t._bIsReverse)var r=-t.GetCurrentFrame();else r=2*this.GetMaxFrame(this._CurrentScenarioID)-t.GetCurrentFrame();else r=t.GetCurrentFrame();0===r&&t.ResetRangeCache(),i&&(i.CameraControlsViewpoint=!0),this.InitRestoreSetforPlay(),this.PlayScenario(t,r)}else i&&(i.CameraControlsViewpoint=!1),this.StopPlayingScenario(this._CurrentScenarioID);this._bIsPlaying=e}},SetIsBouncing:function(e){for(var t in this._scenariosToPlay){if(this._scenariosToPlay.hasOwnProperty(t))this._scenariosToPlay[t].scenario._bIsBouncing=e}},PlayScenario:function(t,i,a,n,o,s){if(t){var l=t.GetID();l||(l=e.getUUID());var c={};return c.scenario=t,c.clockMesure=new r.Clock,c.clockMesure.start(),c.timeDelay=0,c.lastRealElapsedTime=0,c.startFrame=i,c._fpsHistory={},this._scenariosToPlay[l]=c,void 0!==n&&c.scenario.SetIsBounce(n),void 0!==a&&c.scenario.SetIsLoop(a),void 0!==o&&c.scenario.SetIsReverse(o),void 0!==s&&c.scenario.SetSpeed(s),c.scenario._bIsReverse?c.startFrame=this.GetMaxFrame(l)-i:(t.InitForPlay(this._keyframer),this.UpdateProperties2(t,c.startFrame)),l}},StopPlayingScenario:function(e){if(this._scenariosToPlay[e]){var t=this._scenariosToPlay[e]._fpsHistory,i=0,r=0,a=-1;for(var n in t)t.hasOwnProperty(n)&&(a=n,r+=t[n],i++);if(-1!=a&&(r-=t[a],i--,delete t[a]),i>1){r/=i,console.log("[PERFO] fpsMoyenne "+r);var o=0;for(var n in t)t.hasOwnProperty(n)&&(o+=(t[n]-r)*(t[n]-r));o=Math.sqrt(o/(i-1)),console.log("[PERFO] fpsEcartType "+o)}delete this._scenariosToPlay[e]}var s=this._Scenarios[e];void 0!==s&&s.ClearVolatileKeys()},GetScenarios:function(){return this._Scenarios},GetScenariosFromType:function(e){var t={};for(var i in this._Scenarios)if(this._Scenarios.hasOwnProperty(i)){var r=this._Scenarios[i];r.GetScenarioType()===e&&(t[i]=r)}return t},SetDefaultInterpolator:function(e,t){this._keyframer.SetDefaultInterpolator(e,t)},GetDefaultInterpolator:function(e){return this._keyframer.GetDefaultInterpolator(e)},SetStartingScenarioId:function(e){this._startScenarioId=e},GetStartingScenarioId:function(){return this._startScenarioId},GetFPS:function(){return this._FPS},SetFPS:function(e){this._FPS=e},SetInterFramesMax:function(e){this._interFramesMax=e},GetInterFramesMax:function(){return this._interFramesMax},SetTransitionTime:function(e){this._TransitionTime=e},GetTransitionTime:function(){return this._TransitionTime},SetCurrentFrame:function(e){var t=this._Scenarios[this._CurrentScenarioID];t&&t.SetCurrentFrame(e)},GetCurrentFrame:function(){var e=this._Scenarios[this._CurrentScenarioID];return e?e.GetCurrentFrame():0},GetCurrentTime:function(){var e=this._Scenarios[this._CurrentScenarioID];return e?e.GetCurrentFrame()/this.GetFPS():0},AddScenario:function(e,t){t.SetID(e),this.AddScenario2(t)},AddScenario2:function(e){var t=e.GetID();t||(this._experienceBase.ComponentsMap.AddComponent(e),t=e.GetID());var i=e.GetPersistency();this._Scenarios[t]||0===i&&this._maxIndex++,this._Scenarios[t]=e;var r=e.QueryInterface("VCXIModifiable");this.ModifiableServer.AddModifiable(r)},RemoveScenario:function(e){this._CurrentScenarioID===e&&(this._CurrentScenarioID=""),delete this._Scenarios[e]},SetCurrentScenario:function(e){this._Scenarios[e]&&(this._CurrentScenarioID=e)},GetCurrentScenario:function(){return this._CurrentScenarioID},AddObjectAnimation:function(e,t,i){this.ModifiableServer.AddModifiable(e);var r=e.GetHashing();t.AddObjectAnimation(r,i)},RemoveObjectAnimation:function(e,t){t.RemoveObjectAnimation(e)},AddNeutrals:function(e,t){this._keyframer.AddNeutrals(e,t)},RemoveNeutrals:function(e){this._keyframer.RemoveNeutrals(e)},GetNeutrals:function(e){return this._keyframer.GetNeutrals(e)},RestoreNeutralPropertiesOneModifiable:function(e){this._keyframer.RestoreNeutralPropertiesOneModifiable(e)},RestoreNeutralProperties:function(){this._keyframer.RestoreNeutralProperties(null)},AddPropertyToRestoreSet:function(e,t){this._bIsPlaying||this._keyframer.AddPropertyToRestoreSet(e,t)},RemoveModifiableFromRestoreSet:function(e){var t=this.ModifiableServer.GetModifiableFromHashing(e);this._keyframer.EmptyRestoreSetOneModifiable(t)},InitRestoreSetFromNeutrals:function(e){this._keyframer.InitRestoreSetFromNeutrals(e)},InitRestoreSetforPlay:function(){var e=this._Scenarios[this._CurrentScenarioID];e&&this._keyframer.InitRestoreSetforPlay(e)},GetNewFrame:function(e){var t=e.clockMesure.getElapsedTime(),i=t-e.lastRealElapsedTime;e.lastRealElapsedTime=t;var r=0;if(!("true"==this._experienceBase.getManager("VCXContextManager").odtPerfo)&&-1!=this._interFramesMax){var a=this._interFramesMax/(this.GetFPS()*e.scenario._speed);i>a&&(r=i-a,e.timeDelay+=r)}var n=e.clockMesure.getElapsedTime()-e.timeDelay,o=e.startFrame+n*this.GetFPS()*(e.scenario._speed?e.scenario._speed:1),s=Math.floor(t);return void 0===e._fpsHistory[s]?e._fpsHistory[s]=1:e._fpsHistory[s]++,o},update:function(e){for(var i in this._scenariosToPlay)if(this._scenariosToPlay.hasOwnProperty(i)){var r=this._scenariosToPlay[i],a=this.GetNewFrame(r),n=r.scenario,o=n.GetMaxFrame();null!==n.GetSequenceMaxFrame()&&(o=n.GetSequenceMaxFrame()),n._bIsLoop?(n._bIsBounce&&n._bIsReverse&&r.startFrame>=o&&!n._bIsBouncing&&(a-=o),a>=o&&(n._bIsBounce?n._bIsBouncing?(o-a%o>this._previousFrame?(a%=o,n._bIsBouncing=!1):a=o-a%o,t.publish({event:"VCX_SCENARIO_PLAY_LOOP_START_REACHED",data:i})):(a%o<this._previousFrame?(a=o-a%o,n._bIsBouncing=!0):a%=o,t.publish({event:"VCX_SCENARIO_PLAY_LOOP_END_REACHED",data:i})):(a%=o,t.publish({event:"VCX_SCENARIO_PLAY_LOOP_END_REACHED",data:i}),t.publish({event:"VCX_SCENARIO_PLAY_LOOP_START_REACHED",data:i}))),this._previousFrame=a,n._bIsReverse&&(a=o-a%o),n.SetCurrentFrame(a),this.UpdateProperties2(n,a)):n._bIsBounce?(n._bIsReverse&&r.startFrame>=o&&!n._bIsBouncing&&(a-=o),a>=o?a>2*o-this._startFrame?(n._bIsReverse?(n.SetCurrentFrame(o),this.UpdateProperties2(n,o),n._bIsBouncing=!1):(n.SetCurrentFrame(0),this.UpdateProperties2(n,0),n._bIsBouncing=!1),this.StopPlayingScenario(i),n._bIsBouncing=!1,n.SetSequenceMaxFrame(null),i===this._CurrentScenarioID&&(this._bIsPlaying=!1,t.publish({event:"VCX_SCENARIO_END_REACHED"}),this._callback&&(this._callback(this._parameter),this._callback=null,this._parameter=null)),t.publish({event:"VCX_SCENARIO_PLAY_END_REACHED",data:i})):(a=o-a%o,n._bIsBouncing=!0,n._bIsReverse&&(a=o-a%o),n.SetCurrentFrame(a),this.UpdateProperties2(n,a)):(n._bIsReverse&&(a=o-a%o),n.SetCurrentFrame(a),this.UpdateProperties2(n,a))):n._bIsReverse&&r.startFrame>=o&&a>=2*o||n._bIsReverse&&r.startFrame<o&&a>=o||!n._bIsReverse&&a>=o?(n._bIsReverse?(n.SetCurrentFrame(0),this.UpdateProperties2(n,0)):(n.SetCurrentFrame(o),this.UpdateProperties2(n,o)),this.StopPlayingScenario(i),n._bIsBouncing=!1,n.SetSequenceMaxFrame(null),this._previousFrame=a,i===this._CurrentScenarioID&&(this._bIsPlaying=!1,t.publish({event:"VCX_SCENARIO_END_REACHED"}),this._callback&&(this._callback(this._parameter),this._callback=null,this._parameter=null)),t.publish({event:"VCX_SCENARIO_PLAY_END_REACHED",data:i})):(n._bIsReverse&&(a=o-a%o),n.SetCurrentFrame(a),this.UpdateProperties2(n,a))}},SetCallback:function(e,t){this._callback=e,this._parameter=t},UpdateProperties2:function(e,t){this._keyframer.UpdateProperties(e,t)},UpdateProperties:function(e,t){var i=this._Scenarios[this._CurrentScenarioID];i&&this._keyframer.UpdateProperties(i,this.GetCurrentFrame(),e,t)},UpdateProperty:function(e,t){var i=this._Scenarios[this._CurrentScenarioID];i&&this._keyframer.UpdateProperty(i,this.GetCurrentFrame(),e,t)},ApplyScenarioVisibility:function(e){var t=this._Scenarios[e];t&&this.ApplyVisibility(t)},ApplyVisibility:function(e){var i=e.GetVisibility();if(i){var r=[],a=[],o=i.GetMode(),s=this._experienceBase.ComponentsMap.GetComponentTable();for(var l in s){if(s.hasOwnProperty(l))if(y=s[l]){if(!y.IsKindOf("VCXWebComponentOccurrence"))continue;if(S=y.QueryInterface("VCXIVisibility")){var c=i.IsVisibleWithParents(y);0===o?1===c?(S.SetVisibility(f.EVisState.Visible),r.push(S.GetObject())):0===c&&(S.SetVisibility(f.EVisState.Hidden),a.push(S.GetObject())):1===o?1===c?(S.SetVisibility(f.EVisState.Visible),r.push(S.GetObject())):(S.SetVisibility(f.EVisState.Hidden),a.push(S.GetObject())):2===o&&(0===c?(S.SetVisibility(f.EVisState.Hidden),a.push(S.GetObject())):(S.SetVisibility(f.EVisState.Visible),r.push(S.GetObject())))}}}var u=this._experienceBase.getManager("VCXDressupManager");if(u){var p=u.getDressups();for(var h in p){var y,S;if(p.hasOwnProperty(h))if(y=p[h])if(S=y.QueryInterface("VCXIVisibility"))if(i.FindVisibleCollab(y.GetID())>=0){S.SetVisibility(f.EVisState.Visible);var _=y.QueryInterface("VCXIModifiable");if(_&&!e.GetIsTransition()){var b=new n;b.SetValue(1),_.OnChangeProperty("Actor.Visibility.Opacity",b),_.OnChangePropertiesEnd()}r.push(S.GetObject())}else(e.GetApplyNeutralAtGoToScenario()||e.GetIsTransition())&&(S.SetVisibility(f.EVisState.Hidden),a.push(S.GetObject()))}}r.length&&t.publish({event:"VCX_VISIBILITY_CHANGED",data:{components:r,visibility:f.EVisState.Visible}}),a.length&&t.publish({event:"VCX_VISIBILITY_CHANGED",data:{components:a,visibility:f.EVisState.Hidden}});var v=this._experienceBase.getManager("VCXContextManager");v&&(v.traverseGraphMustBePerformed=!0)}},CaptureDiffOfNeutrals:function(e,t){null===e&&(e=new u);var i=this._keyframer._restoreSet;for(var r in i)if(i.hasOwnProperty(r)){var a=this.ModifiableServer.GetModifiableFromHashing(r);if(t&&!1===a.IsLiving())continue;var n=a.GetRequiredPropertiesForTransition();if(n)for(var o in n){if(n.hasOwnProperty(o))(p=a.GetProperty(o))&&e.AddOrModifyProperty(r,p)}var s=this.GetNeutrals(r);if(s){var l=i[r];for(var c in l)if(l.hasOwnProperty(c)){var p,f=s.GetProperty(c);if(f)(p=a.GetProperty(c))&&p.GetPropertyInfo().GetBehaviorType()!==h.EBehaviorType.Singleton&&(p.GetPropertyValue().IsEqualTo(f.GetPropertyValue())||e.AddOrModifyProperty(r,p))}}}},CaptureInScenario:function(e,t,i,r){var a=this.ModifiableServer.GetHashTable();for(var n in a)if(a.hasOwnProperty(n)){var o=n,u=a[o];if(u.GetObject().IsKindOf("VCXScenario"))continue;if(!1===i&&(u.GetObject().IsKindOf("VCXWebComponentCamera")||u.GetObject().IsKindOf("CXPCameraActor_Spec")))continue;if(!1===r){var p=!1;if(1===u._type&&u._var._bIsCamera&&(p=!0),!p)continue}var f=e.GetObjectAnimation(o);null===f&&(f=new s,e.AddObjectAnimation(o,f));var h=u.GetProperties(!0),y=[];h.GetListPropertyNames(y);for(var S=0;S<y.length;S++){var _=y[S],b=h.GetProperty(_);if(b&&b.GetPropertyValue()){var v=b.GetPropertyValue();if(v){var d=f.GetTrack(_);null===d&&(d=new l,f.AddTrack(_,d));var m=new c;m.SetFrame(t),m.SetValue(v),d.AddKey(m)}}}}},CaptureInPropMap:function(e){null===e&&(e=new u);var t=this.ModifiableServer.GetHashTable();for(var i in t)if(t.hasOwnProperty(i)){var r=i,a=t[r].GetProperties(!0);if(a){var n=[];a.GetListPropertyNames(n);for(var o=0;o<n.length;o++){var s=n[o],l=a.GetProperty(s);l&&(!0===l.GetPropertyValue()._bUndefined||e.AddOrModifyProperty(r,l))}}}},GetMaxFrame:function(e){var t=0,i=this._Scenarios[e];return i&&(t=i.GetMaxFrame()),t},ConsiderNewComponent:function(e){var t=this.GetScenarios();for(var i in t)if(t.hasOwnProperty(i)){const s=t[i];if(s){var r=s.GetVisibility();if(r){var a=r.GetMode(),n=e.QueryInterface("VCXIVisibility");if(n){var o=n.GetVisibility();0===a?o!==f.EVisState.Hidden?r.AddVisible(e):r.AddInvisible(e):1===a?o!==f.EVisState.Hidden&&r.AddVisible(e):2===a&&o===f.EVisState.Hidden&&r.AddInvisible(e)}s.SetVisibility(r)}}}},CaptureCurrentVisibility:function(e){if(e){var t=e.GetVisibility();if(t){t.Empty();for(var i=t.GetMode(),r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),a=0;a<r.length;a++){if(c=r[a])if(u=c.QueryInterface("VCXIVisibility")){var n=u.GetVisibility();0===i?n!==f.EVisState.Hidden?t.AddVisible(c):t.AddInvisible(c):1===i?n!==f.EVisState.Hidden&&t.AddVisible(c):2===i&&n===f.EVisState.Hidden&&t.AddInvisible(c)}}var o=null,s=this._experienceBase.getManager("VCXDressupManager");for(var l in s&&(o=s.getDressups()),o){var c,u;if(o.hasOwnProperty(l))if(c=o[l])if(u=c.QueryInterface("VCXIVisibility"))(n=u.GetVisibility())!==f.EVisState.Hidden&&t.AddVisibleCollab(c)}e.SetVisibility(t)}}},ApplyView:function(e,t){t||this.ApplyVisibility(e),e._bApplyNeutralAtGoToScenario&&this._keyframer.RestoreNeutralProperties(e),this.UpdateProperties2(e,0)},CaptureCurrentView:function(e){var t=this._experienceBase.Factory.BuildComponent("VCXScenario"),i=p.EScenarioType.Scenario;e&&void 0!==e.scenarioType&&(i=e.scenarioType),t.SetScenarioType(i);var r=1;e&&void 0!==e.visibilityMode&&(r=e.visibilityMode),t.GetVisibility().SetMode(r);var a=2;e&&void 0!==e.persistency&&(a=e.persistency),t.SetPersistency(a);var n,o=!1;return e&&void 0!==e.bIsPartialView&&(o=e.bIsPartialView),o&&t.SetApplyNeutralAtGoToScenario(!1),this.CaptureCurrentVisibility(t),e&&void 0!==e.propMapDiffNeutrals&&(n=e.propMapDiffNeutrals),n||(n=new u),this.CaptureDiffOfNeutrals(n,!0),t.SetPropertyMapAtFrame(n,0),t},ChangeProperties:function(e){for(var t in e._map)if(e._map.hasOwnProperty(t)){var i=this.ModifiableServer.GetModifiableFromHashing(t),r=e.GetPropertySet(t);for(var a in r._map)if(r._map.hasOwnProperty(a)){var n=r._map[a];i.OnChangeProperty(a,n.GetPropertyValue())}i.OnChangePropertiesEnd()}},ChangePropertiesPropSet:function(e,t){for(var i in t._map)if(t._map.hasOwnProperty(i)){var r=t._map[i];e.OnChangeProperty(i,r.GetPropertyValue())}e.OnChangePropertiesEnd()},IsCurrentPropertyDifferentFromNeutral:function(e,t){if(!e)return!1;var i=this._keyframer._Neutrals,r=e.GetHashing(),a=i.GetPropertySet(r);if(!a)return!1;var n=a.GetProperty(t);if(!n)return!1;var o=n.GetPropertyValue();if(!o)return!1;var s=e.GetProperty(t);return!!s&&!s.GetPropertyValue().IsEqualTo(o)},SearchAllValuesForOneProperty:function(e,t,i){const r=this._experienceBase.getManager("VCXScenarioManager"),a=r._keyframer._Neutrals;for(let o in a._map){const s=r.ModifiableServer.GetModifiableFromHashing(o);if(s&&a._map.hasOwnProperty(o)){var n=a.GetPropertySet(o);if(n._map.hasOwnProperty(e))(v=n.GetProperty(e).GetPropertyValue()).GetValue()===t&&i&&i({type:"Neutrals",modifiable:s,propSet:n,propValue:v})}}const o=r.GetScenarios();for(var s in o)if(o.hasOwnProperty(s)){var l=o[s],c=l.GetVisibility(),u=[];l.GetListModifiables(u);for(var p=0;p<u.length;p++){let a=u[p];const n=r.ModifiableServer.GetModifiableFromHashing(a);if(n){let r=!1;c&&c.IsVisibleWithParents(n.GetObject());var f=l.GetObjectAnimation(a);if(f){var h=f.GetTrack(e);if(h)for(var S=h._treekeys,_=new y(S),b=_.next();null!==b;){var v;(v=b.GetValue()).GetValue()===t&&i&&i({type:"Track",modifiable:n,Frame:b.GetFrame(),Scenario:l,Easing:b.GetEasing(),visible:r}),b=_.next()}}}}}},SearchForImpactedProperty:function(e,t){const i=this._experienceBase.getManager("VCXScenarioManager"),r=i.GetScenarios();for(var a in r)if(r.hasOwnProperty(a)){var n=r[a],o=n.GetVisibility(),s=[];n.GetListModifiables(s),s.forEach(r=>{const a=i.ModifiableServer.GetModifiableFromHashing(r);if(o&&o.IsVisibleWithParents(a.GetObject())>0){let r=!0;const o={scenario:n};var s=i._keyframer.GetPropertiesOneModifiableAtTimeZero(n,a);s||(r=!1),o.property=s.GetProperty(e),o.property||(r=!1),r&&t&&t(o)}})}},SearchForVisibleComponent:function(e,t,i){if(e){const s=this._experienceBase.getManager("VCXScenarioManager"),l=s.GetScenarios();for(var r in l)if(l.hasOwnProperty(r)){var a=l[r],n=a.GetVisibility();if(n&&n.IsVisibleWithParents(e.GetObject())>0){let r=!0;const n={scenario:a};if(t){var o=s._keyframer.GetPropertiesOneModifiableAtTimeZero(a,e);o||(r=!1),n.property=o.GetProperty(t),n.property||(r=!1)}r&&i&&i(n)}}}},ResetLinksInPropertyValuetree:function(e,t,i,r,a){var n=!1;if("VCXPropertyValueLink"===e.GetType()){var o=e.GetValue();!0===t[o]&&(r?console.log("LINK FOUND : "+o):a?(e.SetValue(a),console.log("LINK REPLACED : ["+o+"] by ["+a+"]")):(e.SetValue(""),console.log("LINK REMOVED : "+o)),n=!0,i[o]=!0)}else if(e instanceof S)for(var s=0;s<e._value.length;s++){(l=e._value[s])&&this.ResetLinksInPropertyValuetree(l,t,i,r,a)&&(n=!0)}else if(e instanceof _)for(s=0;s<e._value.length;s++){var l;(l=e._value[s])&&this.ResetLinksInPropertyValuetree(l,t,i,r,a)&&(n=!0)}return n},ResetLinksTo:function(e,t,i,r,a){var n=this._keyframer._Neutrals;for(var o in n._map)if(n._map.hasOwnProperty(o)){var s=n.GetPropertySet(o);for(var l in s._map)if(s._map.hasOwnProperty(l)){var c=s.GetProperty(l).GetPropertyValue(),u={};if(this.ResetLinksInPropertyValuetree(c,e,u,r,a))if(r||(n._LinksCleaned=!0),G=this.ModifiableServer.GetModifiableFromHashing(o)){var p=G.GetObject().GetID();for(var f in void 0===t[p]&&(t[p]={}),t[p].neutral=u,u)u.hasOwnProperty(f)&&(void 0===i[f]&&(i[f]={}),void 0===i[f].neutral&&(i[f].neutral={}),i[f].neutral[p]=!0)}}}var h=this.GetScenarios();for(var S in h)if(h.hasOwnProperty(S)){var _=h[S],b=[];_.GetListModifiables(b);for(var v=0;v<b.length;v++){o=b[v];var d=_.GetObjectAnimation(o);if(d){var m=[];d.GetListTrackNames(m);for(var P=0;P<m.length;P++){l=m[P];for(var C=d.GetTrack(l)._treekeys,V=new y(C),I=V.next();null!==I;){var G;c=I.GetValue(),u={};if(this.ResetLinksInPropertyValuetree(c,e,u,r,a))if(r||_.SetBoostDirty(),G=this.ModifiableServer.GetModifiableFromHashing(o)){p=G.GetObject().GetID();for(var f in void 0===t[p]&&(t[p]={}),t[p][S]=u,u)u.hasOwnProperty(f)&&(void 0===i[f]&&(i[f]={}),void 0===i[f][S]&&(i[f][S]={}),i[f][S][p]=!0)}I=V.next()}}}}var M=_.GetVisibility();if(M)for(var g in e)if(e.hasOwnProperty(g)){var O=M._visibilityMap[g];void 0!==O&&(r?console.log("LINK FOUND in visibilityMap: "+g):(delete M._visibilityMap[g],a?(M._visibilityMap[a]=O,console.log("LINK REPLACED in visible : ["+g+"] by ["+a+"]")):console.log("LINK REMOVED from visible : "+g),_.SetBoostDirty())),void 0!==(O=M._visibilityMapCollab[g])&&(r?console.log("LINK FOUND in visibilityMapCollab: "+g):(delete M._visibilityMapCollab[g],a?(M._visibilityMapCollab[a]=O,console.log("LINK REPLACED in visibilityMapCollab : ["+g+"] by ["+a+"]")):console.log("LINK REMOVED from visibilityMapCollab: "+g),_.SetBoostDirty()))}}}});return Object.defineProperty(b.prototype,"AutoThumbnailUpdate",{enumerable:!0,get:function(){return this._autoThumbnailUpdate},set:function(e){this._autoThumbnailUpdate=e,window&&window.localStorage&&window.localStorage.setItem("VCXAutoThumbnailUpdate",this._autoThumbnailUpdate)}}),Object.defineProperty(b.prototype,"ModifiableServer",{enumerable:!0,get:function(){return this._privateModifiableServer}}),Object.defineProperty(b.prototype,"componentType",{enumerable:!0,get:function(){return"VCXScenarioManager"}}),b}),define("DS/VCXWebScenarioManager/VCXModifiableScenarioManager",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueInt"],function(e,t,i,r,a,n,o){"use strict";return e.extend({init:function(){this._parent()},OnChangeProperty:function(e,t){if("ScenarioManager.InterFramesMax"===e)this.GetObject().SetInterFramesMax(t.GetValue());else if("ScenarioManager.FPS"===e)this.GetObject().SetFPS(t.GetValue());else if("ScenarioManager.TransitionTime"===e)this.GetObject().SetTransitionTime(t.GetValue());else{if("ScenarioManager.startScenarioId"!==e)return console.log("property not found!"),!1;this.GetObject().SetStartingScenarioId(t.GetValue())}return!0},GetProperty:function(e){var t=null;if("ScenarioManager.FPS"===e)(c=new a).SetValue(this.GetObject().GetFPS()),t=new i(new r(e,2),c);else if("ScenarioManager.InterFramesMax"===e){var s=new o;s.SetValue(this.GetObject().GetInterFramesMax()),t=new i(new r(e,2),s)}else if("ScenarioManager.startScenarioId"===e){var l=new n;l.SetValue(this.GetObject().GetStartingScenarioId()),t=new i(new r(e,2),l)}else if("ScenarioManager.TransitionTime"===e){var c;(c=new a).SetValue(this.GetObject().GetTransitionTime()),t=new i(new r(e,2),c)}return t},GetProperties:function(){var e=new t;return e.AddOrModifyProperty(this.GetProperty("ScenarioManager.FPS")),e.AddOrModifyProperty(this.GetProperty("ScenarioManager.InterFramesMax")),e.AddOrModifyProperty(this.GetProperty("ScenarioManager.startScenarioId")),e.AddOrModifyProperty(this.GetProperty("ScenarioManager.TransitionTime")),e}})});