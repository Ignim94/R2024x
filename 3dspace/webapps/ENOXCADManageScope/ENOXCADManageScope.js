define("DS/ENOXCADManageScope/utils/URLHandler",[],function(){"use strict";return{init:function(e,t,o,n){this.url=e,this.xcadSvcUrl=t,this.tenant=o,this.sectx=n},setURL:function(e){this.url=e},getURL:function(){return this.url},setXCADsvcURL:function(e){this.xcadSvcUrl=e},getXCADsvcURL:function(){return this.xcadSvcUrl},setTenant:function(e){this.tenant=e},getTenant:function(){return this.tenant},setSeCtx:function(e){e.startsWith("ctx::")||(e="ctx::"+e),this.sectx=e},getSeCtx:function(){return this.sectx}}}),define("DS/ENOXCADManageScope/command/InfoPanelModule",["UWA/Class/View","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button"],function(e,t,o,n){"use strict";const i=["properties","relations","history"];var a;return e.extend({_nodes:null,_propertiesWdg:null,tagName:"div",className:"savescope-dialog",setup:function(e){this._nodes=e.nodes,this.launchInfoPanelDialog()},launchInfoPanelDialog:function(){var e=this;require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropWidget/constants/EditPropConstants"],function(i,s,l){e.EditPropUtils=s,e._propertiesWdg=new i({className:"enxpropertiestab",readOnly:!0,typeOfDisplay:l.ALL,selectionType:l.NO_SELECTION,actions:[]});let r=UWA.createElement("div",{id:"info-panel",class:"info-panel"}).inject(e.container);e._propertiesWdg.inject(r);let c=UWA.i18n("SaveScope.toolbar.action.info");1===e._nodes.length&&(c=c+" - "+e._nodes[0].getLabel());var d=new t({});(a=new o({immersiveFrame:d,title:c,content:r,domId:"savescope-modalDialog",identifier:"savescope-modalDialog",autoCloseFlag:!1,resizableFlag:!0,modalFlag:!0,position:{my:"top",at:"top"},height:"auto",width:"auto",buttons:{Close:new n({onClick:function(e){a.visibleFlag=!1,d.destroy()}})}})).addEventListener("close",function(){a.visibleFlag=!1,d.destroy()}),d.inject(document.getElementById("ScopeMainDiv")),e._selectionChange()})},_selectionChange:function(){var e=this;if(1==e._nodes.length){let t=e._propertiesWdg.controller.getUI()._lFacets;t=t.filter(e=>i.includes(e.facet.name));for(let e=0;e<t.length;e++)switch(t[e].facet.name){case"properties":break;default:t[e].alwaysVisible=!0}e._propertiesWdg.controller.getUI()._lFacets=t,e._propertiesWdg.controller.getUI().currentFacetName="properties";let o=e._nodes[0];"function"!=typeof o.getID&&(o.getID=function(){return o.options.grid.phid}),void 0===o.type&&(o.type=o.options.grid.type);let n=e.EditPropUtils.getModelFromSelectedNode(o);e._propertiesWdg.initDatas([n])}else console.warn("Cannot retrieve properties model")}})}),define("DS/ENOXCADManageScope/views/ToolBar",["DS/Handlebars/Handlebars","DS/Controls/TooltipModel","UWA/Class/View","text!DS/ENOXCADManageScope/assets/templates/scope.tbar.html"],function(e,t,o,n){return o.extend({tagName:"div",className:"savescope-tbar",setup:function(o){var i=this;let a=e.compile(n);i.container.setHTML(a(o));let s=o.actiondirection.flatMap(e=>e.actions);s&&s.forEach(e=>{if(null!=e&&e.icon){let o="wux-ui-3ds-"+e.icon,n=i.container.getElementsByClassName(o)[0];e.className&&n.classList.add(e.className),n.tooltipInfos=new t({title:e.label?e.label:"",shortHelp:e.sublabel?e.sublabel:""}),n&&n.addEventListener("click",e.handler?e.handler:i.performClick)}else if(null!=e&&e.className){let o=i.container.getElementsByClassName("wux-ui-3ds-")[0];o.classList.add(e.className),e.label&&(o.tooltipInfos=new t({shortHelp:e.sublabel}))}})},render:function(e){return this.getContent().inject(e.container),this}})}),define("DS/ENOXCADManageScope/helper/Notification",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t){"use strict";return{_notif_manager:null,init:function(o){null===this._notif_manager&&(this._notif_manager=e,t.setNotificationManager(this._notif_manager))},sucessMsg:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"success",message:e,sticky:!1})},infoMsg:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"info",message:e,sticky:!1})},warningMsg:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"warning",message:e,sticky:!1})},errorMsg:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"error",message:e,sticky:!1})},clearNotifications:function(){t.removeNotifications("","")}}}),define("DS/ENOXCADManageScope/utils/ScopeModelEvents",["DS/CoreEvents/ModelEvents"],function(e){"use strict";var t=new e;return{getModelEvents:function(){return t},publish:function(e){return t.publish(e)},subscribe:function(e,o){return t.subscribe(e,o)},unsubscribe:function(e){return t.unsubscribe(e)},unsubscribeAll:function(e){return t.unsubscribeAll(e)}}}),define("DS/ENOXCADManageScope/views/CreateScope",["DS/Utilities/Dom","DS/Handlebars/Handlebars","UWA/Class/View","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Popup","DS/Controls/Editor","text!DS/ENOXCADManageScope/assets/templates/scope.cscope.html","i18n!DS/ENOXCADManageScope/assets/nls/SaveScopeNLS"],function(e,t,o,n,i,a,s,l,r,c,d,u){const p=(e,t=0)=>{let o;return function(...n){clearTimeout(o),o=setTimeout(()=>e.apply(this,n),t)}},f=/^[A-Za-z0-9\s_]*$/;var g;return o.extend({tagName:"div",className:"scope-create",dialogBody:null,seCtxList:null,options:{},setup:function(e){this.dialogBody=new UWA.Element("div",{id:"create_scope_div",style:{height:"100%"}})},getSaveData:function(){var e=this;let t=e.options.comboBox.value;e.seCtxList.find(e=>e.value===t);return{action:"new",isEdiValEmpty:""===e.options.lineEditor.value.trim(),servicedata:{data:{title:e.options.lineEditor.value.trim(),desc:e.options.editor.value,action:"new",securitycontext:t}}}},closeView:function(){g.close()},renderDialog:function(e){this.seCtxList=e.seCtxList;let o=t.compile(d);this.dialogBody.setHTML(o({scope_label:u.scopeTextBoxLabel,credenatial_label:u.scopeCredentialLabel,desc_label:u.scopeDescriptionLabel}));var s=new n({});let l={Save:new a({label:u.btnSaveLabel}),Cancel:new a({label:u.btnCancelLabel,onClick:function(e){g.close()}})};l.Save.getContent().addEventListener("buttonclick",e.handler),(g=new i({domId:"create_scope_dialog",immersiveFrame:s,title:u.dialogLabel,content:this.dialogBody,modalFlag:!0,resizableFlag:!0,width:400,minWidth:300,minHeight:150,buttons:l})).addEventListener("close",function(e){s.destroy()}),s.inject(e.container),this.createView()},checkTitle:function(e){const t=document.querySelector("#scope_title_valid small"),o=document.querySelector("#create_scope_lineeditor");function n(e){t.textContent=e,t.classList.contains("warning")||t.classList.add("warning"),o.classList.contains("success")&&o.classList.remove("success"),o.classList.contains("warning")||o.classList.add("warning")}let i=!1;var a;return""===e?n(u["title.blank"]):(a=e,f.test(a)?(t.textContent="",t.classList.contains("warning")&&t.classList.remove("warning"),o.classList.contains("warning")&&o.classList.remove("warning"),o.classList.contains("success")||o.classList.add("success"),i=!0):n(u["title.invalid"])),i},createView:function(){var e=this;e.options.lineEditor=new s({domId:"create_scope_lineeditor",placeholder:u.lineEditorPlaceHolder,requiredFlag:!1,selectAllOnFocus:!0,displayClearFieldButtonFlag:!1}).inject(document.getElementById("scope_name_textbox")),e.options.lineEditor.addEventListener("uncommittedChange",p(function(t){e.checkTitle(e.options.lineEditor.valueToCommit.trim())},250)),e.options.comboBox=new l({domId:"create_scope_combo",elementsList:[e.seCtxList.find(e=>e.isDefault)],displayStyle:"normal",enableSearchFlag:!1,popupSizeAdjustPolicy:r.SizeAdjustPolicyEnum.AdjustToVisibleContents}).inject(document.getElementById("scope_credenatial_combo")),e.options.editor=new c({domId:"create_scope_editor",placeholder:u.lineEditorPlaceHolder,resizableFlag:"vertical",nbRows:4,newLineMode:"enter"}).inject(document.getElementById("scope_desc_textbox"))}})}),define("DS/ENOXCADManageScope/helper/SeCtxHelper",["UWA/Core"],function(e){"use strict";var t=" ",o="‚óè";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}function i(e,t,o){return"ctx::"+o+"."+t+"."+e}function a(e,n,i,a){return a?e+t+o+t+i:e+t+o+t+n+t+o+t+i}function s(e){let t="",o="",n="",i="";for(let a in e){let s=e[a];switch(a){case"organization":t=s.name,o=s.title?s.title:t;break;case"role":n=s.name,i=s.nls?s.nls:n}}return{org:t,orgTitle:o,role:n,roleNls:i}}return n.prototype.prepareSeContext=function(e){let t,o,n,l,r="ctx:",c=e.pid,d=[];for(let i in e.preferredcredentials){let a=e.preferredcredentials[i];switch(i){case"collabspace":t=a.name,o=a.title?a.title:t;break;case"organization":n=a.name;break;case"role":l=a.name}}r=i(t,n,l);let u=!1,p=function(e){let t=[];for(let o=0;o<e.collabspaces.length;o++){let n=e.collabspaces[o];for(let e=0;e<n.couples.length;e++){let o=s(n.couples[e]);-1===t.indexOf(o.org)&&t.push(o.org)}}return 1===t.length}(e);for(let t=0;t<e.collabspaces.length;t++){let o=e.collabspaces[t];for(let e=0;e<o.couples.length;e++){let t=s(o.couples[e]),n=i(o.name,t.org,t.role),l=o.title?o.title:o.name,c=a(l,t.orgTitle,t.roleNls,p),f={csName:l,orgName:t.org,label:c,value:n};r===n&&(f.isDefault=!0,u=!0),d.push(f)}}if(!u&&d.length){let e=d[0];e.isDefault=!0,r=e.value}return d.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),{userId:c,securityContext:r,cspaces:d}},new n}),define("DS/ENOXCADManageScope/views/ListScopeView",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/Find","DS/Tweakers/GeneratedToolbar","i18n!DS/ENOXCADManageScope/assets/nls/SaveScopeNLS"],function(e,t,o,n,i,a,s,l,r){"use strict";var c,d;return t.extend({tagName:"div",className:"listscope-gridview",_scopeList:null,leftToolbar:null,init:function(){this._scopeList=new Set,this.setupListView(),this.setupToolbar()},expandSelectScope:function(e){d.getTreeDocument().getAllDescendants()[0].isExpanded()||d.getTreeDocument().getAllDescendants()[0].expand(-1);let t=d.getTreeDocument().getAllDescendants().find(t=>t.getAttributeValue("scopeid")===e);d.selectNodeModel(t,!1,!1)},_getalphaIcon:function(e){let t=null!=e&&"alpha-sorting-a-z"===e.iconName?"desc":"asc";return d.sortModel=[{dataIndex:"tree",sort:t}],{nodeIcon:{iconName:"desc"==t?"alpha-sorting-a-z":"alpha-sorting-z-a",fontIconFamily:1},containerIcon:{iconName:"desc"==t?"alpha-sorting-z-a":"alpha-sorting-a-z",fontIconFamily:1}}},setupToolbar:function(){var t=this;let o={entries:[{id:"findInTree",dataElements:{typeRepresentation:"functionIcon",label:r.listScope["toolbar.searchscope"],icon:{iconName:"find",fontIconFamily:1},value:function(){t.findInGridEvent()},position:"far",category:"1",priority:2}},{id:"alphaSortingContainer",dataElements:{label:r.listScope["toolbar.sortby"],typeRepresentation:"functionMenuIcon",value:{menu:[{id:"alphaSort",type:"PushItem",title:r.listScope["toolbar.sorttitle"],icon:"alpha-sorting-a-z",action:{callback:function(){let e=t.leftToolbar.getNodeModelByID("alphaSortingContainer").options.icon,o=t._getalphaIcon(e);t.leftToolbar.updateNodeModel("alphaSort",{icon:o.nodeIcon}),t.leftToolbar.updateNodeModel("alphaSortingContainer",{icon:o.containerIcon})}}}]},priority:2,icon:{iconName:"sorting",fontIconFamily:1},position:"far",category:"1"}},{id:"wrong",dataElements:{typeRepresentation:"functionIcon",label:r.listScope["toolbar.close"],icon:{iconName:"wrong",fontIconFamily:1},value:function(){savescopeinfra.toggleCollapse()},priority:3,position:"far",category:"1"}}]},n=l.prototype.createTreeDocument(o);t.leftToolbar=new l({overflowManagement:"dropdown",direction:"horizontal",items:n});let i=e.createElement("div",{id:"leftToolBarDiv"});t.leftToolbar.inject(i),i.inject(document.querySelector("#scopeLeftDiv-Header"))},createNode:function(e,t,o){return new i({label:e,grid:{isparent:t,scopeid:o}})},addChildList:function(e){var t=this;let o=c.getRoots()[0],n=o.getAllDescendants().flatMap(e=>e.options.grid.scopeid);(e=e.filter(e=>!n.includes(e.sid))).forEach(e=>{let n=t.createNode(e.stitle,!1,e.sid);o.addChild(n)})},setupListView:function(){(c=new n).prepareUpdate();let t=this.createNode(r.listScope["root.node"],!0,0);c.addRoot(t),c.pushUpdate(),(d=new a({domId:"leftdiv-lisscope-datagrid",scrollable:!0,treeDocument:c,cellSelection:"none",rowSelection:"single",columnSelection:"none",sortableFlag:!0,showRowBorderFlag:!1,columns:[{text:"",dataIndex:"tree",typeRepresentation:"string",getCellSemantics:function(e){return{icon:"flow-branch-list"}}}],showContextualMenuColumnFlag:!1,onContextualEvent:function(t){let o=[];return t&&t.collectionView&&t.cellInfos&&t.cellInfos.rowID>-1&&(o=t.cellInfos.nodeModel.isRoot()?[{type:"PushItem",title:e.i18n("savescope.top.toolbar").AddLabel,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){savescopeinfra.createScope()}}}]:[{type:"PushItem",title:e.i18n("importdata"),icon:{iconName:"import-multiple",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){sessionStorage.setItem("SaveScopeIPVal",t.cellInfos.nodeModel.options.grid.scopeid),require(["DS/PADUtils/PADUtilsServices"],function(e){e.launchApp({appId:"ENXUIMP_AP",widgetId:e.getWidgetId()})})}}},{type:"PushItem",title:r.listScope["toolbar.refresh"],icon:{iconName:"reload",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){savescopeinfra.refreshScopeDetails(t.cellInfos.nodeModel.options.grid.scopeid)}}}]),o}}).inject(document.querySelector("#scopeLeftDiv-Body"))).layout.columnsHeader=!1,d.layout.rowsHeader=!1,d.setUseClipboardFlag(!1),d.showAlternateBackgroundFlag=!1,d.treeNodeCellOptions.depthIncrement=14,d.treeNodeCellOptions.buildLinks=!0,d.treeNodeCellOptions.expanderStyle="triangle",d.selectNextCellOnEnterFlag=!1,d.selectionBehavior.unselectAllOnEmptyArea=!1,d.getNodesXSO().onPostAdd(function(e){e.forEach(function(e){let t=document.querySelector(".wux-ui-3ds-collaborative-lifecycle-management");null!=t&&t.classList.contains("save-scope-lifecycle-active")&&(t.classList.remove("save-scope-lifecycle-active"),t.classList.add("save-scope-lifecycle-inactive")),document.querySelector(".save-scope-toggle-title").textContent=e.options.label,e.options.grid.isparent?savescopeinfra.changeCentreView(!0):(savescopeinfra.SELECTED_SCOPE_LABLE=e.getLabel(),savescopeinfra.changeCentreView(!1,e.options.grid.scopeid))})}),o.subscribe("XCADService/onRefresh/ScopeTab",function(){let e=d.getTreeDocument().getSelectedNodes();0===e.length||e[0].options.grid.isparent?savescopeinfra.changeCentreView(!0):savescopeinfra.changeCentreView(!1,e[0].options.grid.scopeid)})},findInGridEvent:function(){if(document.contains(document.querySelector("#lefttoolbar-find-div")))document.querySelector("#lefttoolbar-find-div").remove(),d.findWidget.close(),document.querySelector("#scopeLeftDiv-Body").style.height="92%";else{let t=e.createElement("div",{id:"lefttoolbar-find-div"}),o=new s({displayMatchCaseToggle:!1,relatedWidget:d,onFindRequest:function(e,t,o){let n=e.replace(/^\s+/,"");d.setFindStr(n,t,o)},onFindPreviousResult:d.goToPreviousMatchingCell,onFindNextResult:d.goToNextMatchingCell,onFindClose:d.closeFind,displayClose:!1}).inject(t);o.focus(),o.getContent().style.position="relative",o.getContent().style.width="unset",t.inject(document.querySelector("#scopeLeftDiv-Header")),document.querySelector("#scopeLeftDiv-Body").style.height="84%"}}})}),define("DS/ENOXCADManageScope/utils/SaveScopeWS",["UWA/Core","DS/WAFData/WAFData","DS/ENOXCADManageScope/utils/URLHandler"],function(e,t,o){let n=function(e,o,n){return new Promise(function(i,a){o.onComplete=function(e){let t=function(e){return"string"==typeof e?JSON.parse(e):e}(e);i(t)},o.onFailure=function(e){a(e)},o.onTimeout=function(e){a(e)},o.data&&(o.data=JSON.stringify(o.data)),null!=n&&n.addEventListener("abort",t=>{console.error("Abort Request >>> "+e),a("Abort")}),function(e,o,n){let i=null;i=t.authenticatedRequest(e,o)}(e,o)})};return{getSecurityContext:function(){let e=o.getURL()+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces&tenant="+o.getTenant(),t={method:"GET"};return t.headers={"Accept-Language":"undefined"!=typeof widget?widget.lang:"en",Accept:"application/json","Content-Type":"application/json"},n(e,t)},personSearch:function(e){let t=o.getURL()+"/resources/v2/e6w/service/PersonSearch?searchStr="+e.name,i={method:"GET"};return i.headers={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:o.getSeCtx()},n(t,i)},listScope:function(){console.log("--SaveScope calling listScope WS.......");let e=o.getURL()+"/resources/xcadfilesave/services/savescope?xrequestedwith=xmlhttprequest&tenant="+o.getTenant(),t={method:"GET"};return t.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.getSeCtx()},n(e,t)},updateScope:function(e){console.log("---SaveScope calling updateScope WS.......");let t=o.getURL()+"/resources/xcadfilesave/services/savescope?xrequestedwith=xmlhttprequest&tenant="+o.getTenant(),i={method:"POST"};return i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.getSeCtx()},i.data=e,n(t,i)},getScopeDetail:function(e){console.log("--SaveScope calling listScope WS.......");let t=o.getURL()+"/resources/xcadfilesave/services/savescope/"+e+"?xrequestedwith=xmlhttprequest&tenant="+o.getTenant(),i={method:"GET"};return i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.getSeCtx()},n(t,i)},deleteScope:function(e){console.log("---SaveScope calling deleteScope WS.......");let t=o.getURL()+"/resources/xcadfilesave/services/savescope/"+e+"?xrequestedwith=xmlhttprequest&tenant="+o.getTenant(),i={method:"POST"};return i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.getSeCtx()},n(t,i)},getScopeContent:function(e){console.log("---Listing of Content of Save Scope WS......");let t=o.getXCADsvcURL()+"/resources/v1/modeler/savescopecontent?tenant="+o.getTenant(),i={method:"POST"};return i.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang,SecurityContext:o.getSeCtx(),"X-Requested-With":"XMLHttpRequest"},i.data=e,n(t,i)},getTypesHierarchy:function(e){let t=o.getURL()+"/resources/enong/dico/gettypeshierarchy?tenant="+o.getTenant(),i={method:"POST"};return i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.getSeCtx()},i.data={types:e.types},n(t,i)},getDatafromIndexDB:function(e){let t=o.getURL()+"/cvservlet/fetch/v2?tenant="+o.getTenant(),i={method:"POST"};return i.headers={"Content-Type":"application/json",SecurityContext:o.getSeCtx()},i.data=e,n(t,i)}}}),define("DS/ENOXCADManageScope/views/PropetiesView",["UWA/Class/View","DS/ENOXCADManageScope/utils/ScopeModelEvents"],function(e,t){"use strict";const o=["properties","relations","history"];var n=[];return e.extend({_context:null,slideInfoPanel:"",_state:null,_propertiesWdg:null,tagName:"div",className:"scope-infopanel",setup:function(e){this.slideInfoPanel=UWA.createElement("div",{id:"savescope-slideInfoPanel",class:"savescope-slideInfo"}).inject(document.getElementById("scopeRightDiv")),this.launchInfoPanelDialog(e)},launchInfoPanelDialog:function(e){var t=this;savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-minwidth","20%"),require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropWidget/constants/EditPropConstants"],function(o,n,i){t.EditPropUtils=n,document.contains(document.querySelector(".scope-propertiestab"))&&document.querySelector(".scope-propertiestab").destroy(),t._propertiesWdg=new o({className:"scope-propertiestab",readOnly:!0,typeOfDisplay:i.ALL,selectionType:i.NO_SELECTION,actions:[{name:"action_close_panel",text:UWA.i18n("listScope")["toolbar.close"],icon:"close",handler:function(){t.destroyView()}}]}),t._selectionChange(e),t._propertiesWdg.inject(t.slideInfoPanel),savescopeinfra.renderResizer("rightDiv")})},_selectionChange:function(e){var t=this,i=e.get();document.contains(document.querySelector(".export-standalone-content"))&&document.querySelector(".export-standalone-content").destroy(),document.contains(document.querySelector(".export-infopanel-emptycontentmessage"))&&document.querySelector(".export-infopanel-emptycontentmessage").destroy();var a=new Promise(function(e){Promise.all(n).then(function(){var n=[];let a=[];1==i.length&&i.forEach(function(e){a.push(t.__defaultPropNodeModel(e));let n=t._propertiesWdg.controller.getUI()._lFacets;n=n.filter(e=>o.includes(e.facet.name));for(let e=0;e<n.length;e++)switch(n[e].facet.name){case"properties":break;default:n[e].alwaysVisible=!0}t._propertiesWdg.controller.getUI()._lFacets=n,t._propertiesWdg.controller.getUI().currentFacetName="properties"}),Promise.all(a).then(e=>{n=e,t._propertiesWdg.initDatas(n)}).catch(()=>{console.warn("Cannot retrieve properties model")}),e()})});n.push(a)},__defaultPropNodeModel:function(e){var t=this;return new Promise(o=>{"function"!=typeof e.getID&&(e.getID=function(){return e.options.grid.phid}),void 0===e.type&&(e.type=e.options.grid.type),o(t.EditPropUtils.getModelFromSelectedNode(e))})},destroyView:function(e){(null==e||e)&&(t.publish({event:"savescope-hide-panel",data:"hideright"}),savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-minwidth","0%"),document.querySelector("#scope-right-resizer").destroy()),document.getElementById("savescope-slideInfoPanel").remove(),this._propertiesWdg.remove()}})}),define("DS/ENOXCADManageScope/command/OpenWithMenuBuilder",["UWA/Core","DS/i3DXCompassPlatformServices/OpenWith","UWA/Promise","DS/ENOXCADManageScope/utils/SaveScopeWS","DS/ENOXCADManageScope/utils/URLHandler"],function(e,t,o,n,i){var a,s={types_hierarchies:{}};function l(t){return new o(o=>{var i={};t.forEach(function(e){let t=Object.assign({},e.options),o={type:e.options.grid.type};e.options=Object.assign(t,o),i[e.options.type]=!0}),function(t,o){for(var i={},a=[],l=0;l<t.length;l++)s.types_hierarchies[t[l]]?i[t[l]]=e.clone(s.types_hierarchies[t[l]]):a.push(t[l]);a.length>0?n.getTypesHierarchy({types:a}).then(function(t){(e.is(t,"string")?JSON.parse(t):t).types_hierarchies.forEach(function(e){void 0===s.types_hierarchies[e.type]&&(s.types_hierarchies[e.type]=e.hierarchy,s.types_hierarchies[e.type].push(e.type)),i[e.type]=e.hierarchy,i[e.type].push(e.type),o(i)})},function(e){console.warn("Cannot retrieve hierarchy"),a.forEach(function(e){i[e]=[e],o(i)})}):o(i)}(Object.keys(i),function(e){o(e)})})}function r(){}return r.prototype={build3DXContent:function(e){return new o(t=>{l(e).then(o=>{let n=null;o&&(n={protocol:"3DXContent",version:"1.1",source:"ENOXDPM_AP",widgetId:"undefined"!=typeof widget?widget.id:-1,data:{items:[]}},e.forEach(function(e){!0!==e.isGroupingNode&&n.data.items.push(function(e,t){let o=[e.options.grid.type];t&&t[e.options.grid.type]&&(o=t[e.options.grid.type]);let n=[{resourceid:e.options.grid.phid,type:e.options.grid.type}],a=i.getSeCtx();return-1==a.indexOf("ctx::")&&(a="ctx::"+a),{envId:i.getTenant(),serviceId:"3DSpace",contextId:a,objectId:e.options.grid.phid,objectType:e.options.grid.type,objectTaxonomies:o,displayName:e.options.grid.tree,displayType:e.options.grid.typenls,path:n}}(e,o))})),t(n)})})},openWithApps:function(n,i){return new o(async o=>{var a=await this.build3DXContent(n),s=new t;a&&e.is(s.retrieveCompatibleApps,"function")?(s.set3DXContent(a,!1),s.retrieveCompatibleApps(function(e){var t=[],n=[];if(e.forEach(function(e){var t={type:"PushItem",title:e.text,action:{callback:()=>{e.handler()}}};e.icon?t.icon="url("+e.icon+")":t.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS},n.push(t)}),n.length>0){var a=i.iconOpenWith;"string"==typeof i.iconOpenWith&&(a="url("+i.iconOpenWith+")");var s={type:"PushItem",icon:a,title:i.nlsOpenWith,submenu:n};t.push(s),t.push({type:"SeparatorItem"})}o(t)})):o([])})}},a||(a=new r),a}),define("DS/ENOXCADManageScope/command/ChangeMaturityCmd",["DS/ENOXCADManageScope/utils/URLHandler"],function(e){"use strict";return{lifeCycle:(t,o)=>(function(t,o){require(["DS/LifecycleCmd/MaturityCmd"],function(n){let i=new n({securitycontext:e.getSeCtx(),ID:"maturity_cmd_ID",context:{getSelectedNodes:()=>[{getID:()=>t}],getUUID:()=>widget.id},getUUID:()=>widget.id});i.executeAsync([{physicalid:t}]).then(()=>{let e=null!=i.maturityWidget?i.maturityWidget.model.objects[t].current:"";o(e)})})})(t,o)}}),define("DS/ENOXCADManageScope/views/FilterData",["UWA/Class/View","DS/Controls/Button","DS/Controls/DatePicker","DS/Controls/ComboBox","DS/ENOXCADManageScope/helper/Notification","DS/ENOXCADManageScope/utils/ScopeModelEvents"],function(e,t,o,n,i,a){return e.extend({setup:function(){this.filterPanel=UWA.createElement("div",{id:"filterPanel",class:"filterPanel"}).inject(document.getElementById("scopeRightDiv"))},renderView:function(e){savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-minwidth","20%"),sessionStorage&&(sessiondata=sessionStorage.getItem("key"));var i=this;savescopeinfra.renderResizer("rightDiv");let a=new UWA.Element("div",{id:"filterPanelHeader"}),s=new UWA.Element("div",{id:"filterPanelContent"}),l=new UWA.Element("div",{id:"filterPanelContentTop"}),r=new UWA.Element("div",{id:"filterPanelFooter"});new UWA.Element("div",{id:"Heading",html:UWA.i18n("savescope.filter.details").heading}).inject(a),new t({domId:"closeIcon",displayStyle:"lite",label:"close",icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,onClick:function(e){i.destroyView()}}).inject(a);var c=new n({domId:"dateTypePicker",elementsList:[{label:UWA.i18n("savescope.filter.details").cdt,value:"Creation Date"},{label:UWA.i18n("savescope.filter.details").mdt,value:"Modification Date"}],value:null!=sessiondata?JSON.parse(sessiondata).dateType:"Creation Date"});c.inject(l);var d=new n({domId:"datePickerDropDown",elementsList:[{label:UWA.i18n("savescope.filter.details").between,value:"between"},{label:UWA.i18n("savescope.filter.details").after,value:"after"},{label:UWA.i18n("savescope.filter.details").before,value:"before"}],enableSearchFlag:!1,actionOnClickFlag:!1,value:null!=sessiondata?JSON.parse(sessiondata).dropDown:"between"});d.inject(l),l.inject(s);var u=new UWA.Element("div",{class:"datePickerDiv"});let p=new UWA.Element("div",{id:"fromTymDiv"}),f=new UWA.Element("div",{id:"toTymDiv"}),g=new Date(2021,0,1,0,0,0);var m=new o({minValue:g,maxValue:new Date,timePickerFlag:!0,timePickerPrecision:"min"});m.addEventListener("change",()=>{m.maxValue=new Date});var v=new o({minValue:g,maxValue:new Date,timePickerFlag:!0,timePickerPrecision:"min"});v.addEventListener("change",()=>{v.maxValue=new Date}),d.addEventListener("change",()=>{m.maxValue=new Date,v.maxValue=new Date,S(!1)}),v.inject(p),m.inject(f),p.inject(u),f.inject(u);let h=new t({domId:"filterDataApply",label:UWA.i18n("savescope.filter.details").apply,emphasize:"primary",domId:"filterDataApply"}),y=new t({domId:"filterDataCancel",label:UWA.i18n("savescope.filter.details").cancel,domId:"filterDataCancel"});function S(e){"after"==d.value?(e&&(v.value=null!=sessiondata?JSON.parse(sessiondata).fromTym:new Date),document.querySelector("#fromTymDiv").style.display="block",document.querySelector("#toTymDiv").style.display="none"):"before"==d.value?(e&&(m.value=null!=sessiondata?new Date(JSON.parse(sessiondata).toTym):new Date),document.querySelector("#toTymDiv").style.display="block",document.querySelector("#fromTymDiv").style.display="none"):"between"==d.value&&(e&&(m.value=null!=sessiondata?new Date(JSON.parse(sessiondata).toTym):new Date,v.value=null!=sessiondata?JSON.parse(sessiondata).fromTym:new Date(m.value.getTime()-6048e5)),document.querySelector("#fromTymDiv").style.display="block",document.querySelector("#toTymDiv").style.display="block")}h.inject(r),y.inject(r),h.addEventListener("click",function(){i.handlefilterDataApplyButton()}),y.addEventListener("click",function(){i.destroyView()}),u.inject(s),a.inject(i.filterPanel),s.inject(i.filterPanel),r.inject(i.filterPanel),S(!0),i.fromTym=v,i.toTym=m,i._minValue=g,i.datePickerDropDown=d,i.dateTypePicker=c,i.callback=e},handlefilterDataApplyButton:function(){function e(e){return e%100==0?e%400==0:e%4==0}function t(e,t){return Math.round((t.getTime()-e.getTime())/864e5)}var o=this;datePickerDropDown=o.datePickerDropDown,dateTypePicker=o.dateTypePicker;const n=o.fromTym.value,a=o.toTym.value;let s={},l="Creation Date"===dateTypePicker.value?"cdt":"mdt";switch(s[l]={fromtime:"before"!=datePickerDropDown.value?n:"",totime:"after"!=datePickerDropDown.value?a:"",svalue:datePickerDropDown.value},sessionStorage.setItem("SCOPE_FILTER_DATA",JSON.stringify(s)),datePickerDropDown.value){case"between":n>a?(i.errorMsg(UWA.i18n("savescope.filter.details").errMsgFrom),sessionStorage.setItem("SCOPE_FILTER_DATA","")):function(o,n){let i=1,a=0;if(o.getFullYear()===n.getFullYear())i=t(o,n);else{let e=new Date(o.getFullYear(),11,31);i+=t(o,e),i+=t(new Date(n.getFullYear(),0,1),n)}return e(o.getFullYear())&&o<new Date(o.getFullYear(),1,29)&&++a,e(n.getFullYear())&&n>new Date(n.getFullYear(),1,29)&&++a,!(i-a<=365)}(n,a)&&(i.errorMsg(UWA.i18n("savescope.filter.details").errMsgDiff),sessionStorage.setItem("SCOPE_FILTER_DATA",""));break;case"before":let r=new Date(new Date(a).setFullYear(a.getFullYear()-1));r<o._minValue&&(r=o._minValue),s[l].fromtime=r,r.getDate()==a.getDate()&&n.getMonth()==a.getMonth()&&n.getFullYear()==a.getFullYear()&&r.getHours()==a.getHours()&&r.getMinutes()==a.getMinutes()&&r.getSeconds()==a.getSeconds()&&(a.setSeconds(a.getSeconds()+10),s[l].totime=a);break;case"after":let c=new Date(new Date(n).setFullYear(n.getFullYear()+1));c>new Date&&(c=new Date),s[l].totime=c}""!=sessionStorage.getItem("SCOPE_FILTER_DATA")&&o.callback(s),window.navigator.userAgent.toLowerCase().includes("mobi")&&o.destroyView()},destroyView:function(e){let t={dateType:this.dateTypePicker.value,dropDown:this.datePickerDropDown.value,fromTym:this.fromTym.value,toTym:this.toTym.value};sessionStorage.setItem("key",JSON.stringify(t)),(null==e||e)&&(a.publish({event:"savescope-hide-panel",data:"hideright"}),savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-minwidth","0%"),document.querySelector("#scope-right-resizer").destroy()),document.getElementById("filterPanel").remove()}})}),define("DS/ENOXCADManageScope/views/SaveScopeView",["UWA/Core","UWA/Class/View","DS/Utilities/Dom","DS/Controls/ModalContainer","DS/Controls/Label","DS/Controls/TooltipModel","DS/Controls/Loader","DS/Controls/Find","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/TreeModel/BaseFilter","DS/DataGridView/DataGridViewBaseFilterView","DS/ENOXCADManageScope/views/CreateScope","DS/ENOXCADManageScope/utils/SaveScopeWS","DS/ENOXCADManageScope/helper/SeCtxHelper","DS/ENOXCADManageScope/command/ChangeMaturityCmd","DS/ENOXCADManageScope/helper/Notification","i18n!DS/ENOXCADManageScope/assets/nls/SaveScopeNLS"],function(e,t,o,n,i,a,s,l,r,c,d,u,p,f,g,m,v,h,y,S,w,D){"use strict";const E="off";var C,b,M,x,T,O,L,A,P,I,_,N,R,V=g.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue("matstate");return!!(this.filterModel&&this.filterModel.allowedEntries&&this.filterModel.allowedEntries.length>0)&&-1===this.filterModel.allowedEntries.indexOf(t)},isEmpty:function(){return void 0===this.filterModel.allowedEntries}}),F=m.inherit({publishedProperties:{},buildContentView:function(){var t=this._popupContentDiv;let o=e.createElement("div",{id:"scopestate-pop-filter-div",styles:{background:"white",border:"1px solid #E2E4E3"}}).inject(t);P=new r({domId:"scopestate-togbtn-create",type:"checkbox",label:D.maturityState.Create,value:"Create",checkFlag:!1}),I=new r({domId:"job-togbtn-active",type:"checkbox",label:D.maturityState.Active,value:"Active",checkFlag:!1}),_=new r({domId:"job-togbtn-archive",type:"checkbox",label:D.maturityState.Archive,value:"Archive",checkFlag:!1}),A=new c({type:"checkbox",domId:"job-filter-toggle"}),N=Array.from(O),W(),A.addEventListener("buttonclick",function(e){U(A.value)}),A.inject(o),this.refreshContentView()},refreshContentView:function(){R=this.filter.filterModel;let e=[];(e=Array.from(O).length>N.length?Array.from(O).filter(e=>!N.includes(e)):N.filter(e=>!Array.from(O).includes(e))).length>0&&(N=Array.from(O),A.removeChild(P),A.removeChild(I),A.removeChild(_),W())}}),W=function(){let e=!1,t=!1,o=!1;for(let n of O)switch(n){case"Create":P.elements.container.id="scope-Create-color-active",P.elements.container.lastChild.style.color="white",null!=R&&R.allowedEntries.includes(P.label)&&(e=!0),P.checkFlag=e,A.addChild(P);break;case"Active":I.elements.container.id="scope-Active-color-active",I.elements.container.lastChild.style.color="white",null!=R&&R.allowedEntries.includes(I.label)&&(t=!0),I.checkFlag=t,A.addChild(I);break;case"Archive":_.elements.container.id="scope-Archive-color",null!=R&&R.allowedEntries.includes(_.label)&&(o=!0),_.checkFlag=o,A.addChild(_)}},U=function(e){M.setFilterModel({matstate:{filterId:"stateListFilter",filterModel:{allowedEntries:e}}})};return t.extend({tagName:"div",className:"savescope-listview",secCtxList:null,loader:null,init:function(){this._parent(),T=new Set,O=new Set,null==L&&(L=new Map),this.loader=new s,C=!0,this.createScopeView(),savescopeinfra.renderResizer("leftDiv")},createScopeView:function(){this.setupListView(),this.fetchScopeData()},getSaveScopeGrid:function(){return b},controlLoader:function(e){switch(e.loader){case"on":C=!1,this.loader.text=e.loadtxt,this.loader.on(),n.createModal(document.querySelector(".scope-grid-view .wux-layouts-datagridview"),this.loader.elements.container);break;case E:C=!0,this.loader.off(),n.removeModal(document.querySelector(".scope-grid-view .wux-layouts-datagridview"))}},fetchScopeData:function(){var e=this;x=new v,C&&e.controlLoader({loader:"on",loadtxt:D["savescope.computing"]}),h.listScope().then(function(t){e.fillScopeGridData(t)}).catch(t=>{C||e.controlLoader({loader:E}),b.placeholder=e.emptyContentView()})},createScope:function(){var e=this;h.getSecurityContext().then(function(t){let o=y.prepareSeContext(t);x.renderDialog({seCtxList:o.cspaces,container:document.getElementById("ScopeMainDiv"),handler:e.saveScope.bind(null,e)})})},saveScope:function(e){let t=x.getSaveData();x.checkTitle(t.servicedata.data.title.trim())&&(x.closeView(),T.has(t.servicedata.data.title)?w.errorMsg(D["SaveScope.TitleNotUnique"]):(C&&e.controlLoader({loader:"on",loadtxt:D["creating.savescope"]}),e.updateScope(t.servicedata,t.action)))},updateScope:function(e,t,o){var n=this;function i(e){if("update"===t){let e=null!=o?o:M.getSelectedNodes()[0];e.updateOptions({grid:{desc:e.options.grid.ref_desc}})}else C||n.controlLoader({loader:E});w.errorMsg(e)}h.updateScope(e).then(function(a){if("success"===a.status)if("new"===t)a.status=a.status_savescope,n.fillScopeGridData([a]),w.sucessMsg(D.applySuccessMessage);else{(null!=o?o:M.getSelectedNodes()[0]).updateOptions({grid:{ref_desc:e.data.desc}}),w.sucessMsg(D.applyUpdateMessage)}else i(D[a.errorcode])},function(e){i(D.scopeErrMsg)})},changeMaturity:function(){var e=M.getSelectedNodes();e.length>0&&S.lifeCycle(e[0].options.grid.id,function(t){e[0].getAttributeValue("matstate")!=t&&h.getScopeDetail(e[0].options.grid.id).then(function(t){"success"===t.status?e[0].updateOptions({grid:{status:t.status_savescope,matstate:t.current}}):w.errorMsg(D[t.errorcode])})})},setupListView:function(){var t=this;(M=new u({shouldBeSelected:function(e){return"Active"===e.getAttributeValue("status")}})).getFilterManager().registerFilter("stateListFilter",V);let n=e.createElement("div",{class:"scope-grid-view"}).inject(document.getElementById("scopeCentreDiv"));b=new f({scrollable:!0,treeDocument:M,cellSelection:"none",rowSelection:"single",placeholder:"",columns:[{text:D.saveScopeColumn.title,dataIndex:"title",typeRepresentation:"string",pinned:"left"},{text:D.saveScopeColumn.desc,dataIndex:"desc",typeRepresentation:"editor",editionPolicy:"EditionInPlace",getCellEditableState:function(e){return!e.nodeModel||"Inactive"!==e.nodeModel.getAttributeValue("status")},getCellClassName:function(e){return"scope-desc-class"}},{text:D.saveScopeColumn.owner,dataIndex:"owner",typeRepresentation:"user",getCellValue:function(e){return{label:e.nodeModel.getAttributeValue("owner")}},setCellValue:function(e,t){e.nodeModel&&e.nodeModel.updateOptions({grid:{owner:t.label}})},getCellValueAsStringForFind:function(e){return e.cellModel.label}},{text:D.saveScopeColumn.name,dataIndex:"name",typeRepresentation:"string"},{text:D.saveScopeColumn.matstate,dataIndex:"matstate",typeRepresentation:"string",onCellRequest:function(t){if(t.nodeModel){let o,n=new e.Element("div",{class:"statusview-div"}),s=t.nodeModel.getAttributeValue("matstate"),l=t.nodeModel.getAttributeValue("status");switch(s){case"Create":o="scope-Create-color-active","Inactive"===l&&(o="scope-Create-color-inactive");break;case"Active":o="scope-Active-color-active","Inactive"===l&&(o="scope-Active-color-inactive");break;case"Archive":o="scope-Archive-color"}new i({value:D.maturityState[s],domId:o,tooltipInfos:new a({shortHelp:D.maturityState[s]})}).inject(n),t.cellView.setReusableContent(n)}}},{text:D.saveScopeColumn.org,dataIndex:"org",typeRepresentation:"string"},{text:D.saveScopeColumn.cs,dataIndex:"cs",typeRepresentation:"string"}],showContextualMenuColumnFlag:!1,onContextualEvent:function(e){return[]},defaultColumnDef:{width:"auto",editableFlag:!1,resizableFlag:!0,sortableFlag:!0,filterFlag:!0},getCellTooltip:function(e){if(e.nodeModel)switch(e.columnID){case 2:return{shortHelp:e.nodeModel.getAttributeValue("owner"),updateModel:!1}}return{shortHelp:e.cellModel,updateModel:!1}}}).inject(n),o.addEventOnElement(b,b,"change",function(e,o){if(o&&o.nodeModel&&o.nodeModel.options.grid)switch(b.layout.getDataIndexFromColumnIndex(o.columnID)){case"desc":let e=o.cellModel,n={data:{id:o.nodeModel.options.grid.id,desc:e,action:"update"}};t.updateScope(n,"update",o.nodeModel)}}),b.addEventListener("dblclick",e=>{let t=b.getTreeDocument().getSelectedNodes()[0].getAttributeValue("id");savescopeinfra.selectListScope(t)}),b.getNodesXSO().onPostAdd(function(e){let t=document.getElementsByClassName("wux-ui-3ds-collaborative-lifecycle-management")[0];t.classList.contains("save-scope-lifecycle-inactive")&&(t.classList.remove("save-scope-lifecycle-inactive"),t.classList.add("save-scope-lifecycle-active"))}),b.getNodesXSO().onPostRemove(function(e){let t=document.getElementsByClassName("wux-ui-3ds-collaborative-lifecycle-management")[0];t.classList.contains("save-scope-lifecycle-active")&&(t.classList.remove("save-scope-lifecycle-active"),t.classList.add("save-scope-lifecycle-inactive"))}),t.customizeLayout(),t.setFindonGrid(),t._setScrollView()},customizeLayout:function(){b.showSelectionCheckBoxesFlag=!0,b.showRowIndexFlag=!1,b.layout.columnHeaderHeight=30,b.layout.cellHeight=30,b.layout.collectionView.showRowBorderFlag=!0,b.layout.rowsHeader=!1,b.getFilterViewManager().registerFilterView("stateListFilter",F)},_setScrollView:function(){savescopeinfra.createScrollToTopDiv(),b.elements.scroller.elements.container.onscroll=function(){savescopeinfra.scrollVisibility(b.getAllScrollers())}},emptyContentView:function(){let t=e.createElement("div",{class:"savescope-empty-content"}),o=e.createElement("div",{class:"empty-content-icon-div"}).inject(t);e.createElement("i",{class:"wux-ui-3ds  wux-ui-3ds-search empty-content-icon",styles:{color:"#b4b6ba","font-size":"72px"}}).inject(o),e.createElement("div",{class:"empty-content-text-div"}).inject(t).innerText=e.i18n("grid.placeholder");let n=e.createElement("div",{class:"empty-content-button-div"}).inject(t);return new d({label:e.i18n("grid.btn.label"),emphasize:"primary",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.5x"}}).inject(n).getContent().addEventListener("buttonclick",function(){savescopeinfra.createScope()}),t},fillScopeGridData:async function(e){var t=this;if(e.length>0){let o=[...new Set(e.map(e=>e.owner))];await t.personSearch(o),M.prepareUpdate(),e.forEach(e=>{T.add(e.title),O.add(e.current),M.addRoot(new p({grid:{id:e.id,type:e.type,name:e.name,rev:e.rev,title:e.title,desc:e.desc,ref_desc:e.desc,org:e.org,cs:e.cs,status:e.status,owner:null!=L.get(e.owner)?L.get(e.owner):e.owner,matstate:e.current}}))}),M.pushUpdate(),C||t.controlLoader({loader:E});let n=e.map(e=>({stitle:e.title,sid:e.id}));savescopeinfra.updateScopeList(n),t.filterOnColumnAction()}else C||t.controlLoader({loader:E}),b.placeholder=t.emptyContentView()},filterOnColumnAction:function(){O.size>1?M.setFilterModel({matstate:{filterId:"stateListFilter",filterModel:{allowedEntries:[]}}}):M.setFilterModel({})},personSearch:async function(t){var o=[];return new e.Promise(n=>{for(const n of t)o.push(new e.Promise((e,t)=>{L.has(n)?e():h.personSearch({name:n}).then(function(t){if(null!=t.data&&t.data.length>0){let e=t.data[0].dataelements.firstname+" "+t.data[0].dataelements.lastname;L.set(n,e)}e()}).catch(e=>{t(new Error("reject personsearch"))})}));e.Promise.all(o).then(function(){n()}).catch(e=>{console.error(e.message),n()})})},setFindonGrid:function(){new l({displayMatchCaseToggle:!0,relatedWidget:b,onFindRequest:b.setFindStr,onFindPreviousResult:b.goToPreviousMatchingCell,onFindNextResult:b.goToNextMatchingCell,onFindClose:b.closeFind})},adjust:function(){b.height=document.getElementsByClassName("facetviews")[1].clientHeight-90},destroy:function(){this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/ENOXCADManageScope/views/ScopeDetailsView",["UWA/Core","UWA/Class/View","DS/Controls/Popup","DS/Controls/Button","DS/Controls/Label","DS/Controls/TooltipModel","DS/TreeModel/DataSourceBase","DS/DataGridView/DataGridView","DS/ENOXCADManageScope/utils/SaveScopeWS","DS/ENOXCADManageScope/command/OpenWithMenuBuilder","DS/Controls/Loader","DS/Controls/ModalContainer","DS/ENOXCADManageScope/utils/URLHandler"],function(e,t,o,n,i,a,s,l,r,c,d,u,p){"use strict";const f=(e,t=0)=>{let o;return function(...n){clearTimeout(o),o=setTimeout(()=>e.apply(this,n),t)}};var g,m;return t.extend({tagName:"div",className:"scopedetails-gridview",_scopeList:null,leftToolbar:null,totalText:null,currentText:null,init:function(){this.loader=new d,this.setupListView(),this.setupInfoView(),savescopeinfra.renderResizer("leftDiv")},getDetailsScopeGrid:function(){return g},listScopeContent:function(e){m=e.scopeid;let t=new Date,o=new Date(t.getTime());t.setDate(t.getDate()-7);let n={utctimezonediff:savescopeinfra.getUTCtimezone(),limit:savescopeinfra.SCOPE_LIMIT,offset:"",savescope:e.scopeid,cdt_fromtime:t.toISOString(),cdt_totime:o.toISOString()};if(null!=e.cdt||null!=e.mdt){delete n.cdt_fromtime,delete n.cdt_totime;let t=null!=e.cdt?"cdt":"mdt";delete e[t].svalue,Object.entries(e[t]).forEach(e=>{if(""!=e[1]){let o=t+"_"+e[0];n[o]="string"!=typeof e[1]?e[1].toISOString():e[1]}})}let i=this.createDataSource(n);g.dataSource=i},createDataSource:function(t){var o=this;let n=new s;return n.numberOfRowsPerRequest=savescopeinfra.SCOPE_LIMIT,n.getModelItems=function(n){t.offset=n.request.startRow,0===n.request.startRow&&(g.getTreeDocument().empty(),g.placeholder=""),u.removeModal(document.querySelector(".scope-details-grid-view .wux-layouts-datagridview")),o.loader.text=e.i18n("savescope.computing"),o.loader.on(),u.createModal(document.querySelector(".scope-details-grid-view .wux-layouts-datagridview"),o.loader.elements.container),r.getScopeContent(t).then(function(e){Object.keys(e).length>0&&null!=e.data&&e.data.length>0&&null!=e.total?o.fillGridData(e,n):(0===n.request.startRow&&(g.placeholder=o.emptyContentView()),n.failCallback())}).catch(e=>{0===n.request.startRow&&(g.placeholder=o.emptyContentView()),n.failCallback()})},n},setupListView:function(){let t=e.createElement("div",{class:"scope-details-grid-view"}).inject(document.getElementById("scopeCentreDiv"));(g=new l({domId:"centrediv-scopedetails-datagrid",scrollable:!0,cellSelection:"none",rowSelection:"single",showRowBorderFlag:!0,showContextualMenuColumnFlag:!0,showNodeKPIColorFlag:!0,cellDragEnabledFlag:!0,columns:[{text:e.i18n("saveScopeColumn").title,dataIndex:"tree",typeRepresentation:"string",sortableFlag:!1},{text:e.i18n("saveScopeColumn").rev,dataIndex:"revision",typeRepresentation:"string",width:50,minWidth:20,sortableFlag:!1},{text:e.i18n("saveScopeColumn").filename,dataIndex:"filename",typeRepresentation:"string",pinned:"left",width:200,minWidth:80,sortableFlag:!1,getCellKPIColor:function(e){let t=e.nodeModel.getAttributeValue("relpath");if(null!=t&&""!=t)return"blue"}},{text:e.i18n("saveScopeColumn").type,dataIndex:"typenls",typeRepresentation:"string",sortableFlag:!1},{text:e.i18n("saveScopeColumn").owner,dataIndex:"owner",typeRepresentation:"user",sortableFlag:!1,getCellValue:function(e){if(e.nodeModel&&e.nodeModel.getAttributeValue("owner")){return{label:e.nodeModel.getAttributeValue("owner")}}},setCellValue:function(e,t){if(e.nodeModel){let o={grid:{}};t.hasOwnProperty("label")&&(o.grid.owner=t.label),e.nodeModel.updateOptions(o)}},getCellValueAsStringForFind:function(e){return e.cellModel.label},getCellValueForExport:function(e){return null!=e.nodeModel?e.nodeModel.getAttributeValue("owner"):e.cellModel}},{text:e.i18n("saveScopeColumn").name,dataIndex:"name",typeRepresentation:"string",sortableFlag:!1},{text:e.i18n("saveScopeColumn").islastrevision,dataIndex:"islastrevision",typeRepresentation:"boolean",width:50,minWidth:20,sortableFlag:!1},{text:e.i18n("saveScopeColumn").matstate,dataIndex:"matstate",typeRepresentation:"string",width:90,minWidth:30,sortableFlag:!1,onCellRequest:function(t){if(t.nodeModel&&t.nodeModel.getAttributeValue("matstate")){let o,n=new e.Element("div",{class:"statusview-scopedetails-div"}),s=t.nodeModel.getAttributeValue("matstate");switch(t.nodeModel.getAttributeValue("mstatus")){case"PRIVATE":o="scope-PRIVATE-color";break;case"IN_WORK":o="scope-INWORK-color";break;case"FROZEN":o="scope-FROZEN-color";break;case"RELEASED":o="scope-RELEASED-color";break;case"OBSOLETE":o="scope-OBSOLETE-color";break;case"EMPTY":o="scope-EMPTY-color"}"EMPTY"===s&&(s=""),new i({value:s,domId:o,tooltipInfos:new a({shortHelp:s})}).inject(n),t.cellView.setReusableContent(n)}},getCellValueForExport:function(e){let t=null!=e.nodeModel?e.nodeModel.getAttributeValue("matstate"):e.cellModel;return"EMPTY"===t&&(t=""),t}},{text:e.i18n("saveScopeColumn").cadmaster,dataIndex:"cadmastericon",typeRepresentation:"icon",width:50,minWidth:20,sortableFlag:!1,getCellValueForExport:function(e){return null!=e.nodeModel?e.nodeModel.getAttributeValue("cadmaster"):e.cellModel}},{text:e.i18n("saveScopeColumn").cs,dataIndex:"collabspace",typeRepresentation:"string",sortableFlag:!1},{text:e.i18n("saveScopeColumn").credate,dataIndex:"cre_date",typeRepresentation:"datetime",alignment:"near",sortableFlag:!1},{text:e.i18n("saveScopeColumn").lastmoddate,dataIndex:"lmo_date",typeRepresentation:"datetime",alignment:"near",sortableFlag:!1},{text:"",dataIndex:"ContextualMenuColumn",pinned:"right",sortableFlag:!1,hasCellValue:function(e){return!!e.nodeModel.getAttributeValue("isfileexist")},getCellValueForExport:function(e){return""}}],onContextualEvent:function(t){if(t&&t.collectionView&&t.cellInfos&&t.cellInfos.rowID>-1)return new Promise(function(t,o){var n=g.getTreeDocument().getSelectedNodes();n.length>0&&c.openWithApps(n,{iconOpenWith:{iconName:"open-menu-dot",fontIconFamily:1},nlsOpenWith:e.i18n("scopedetails.ctx.open.with")}).then(function(o){o.push({type:"PushItem",icon:{iconName:"info-open-in-a-new-window",fontIconFamily:1},title:e.i18n("SaveScope.toolbar.action.info"),action:{callback:function(){let e=g.getTreeDocument().getSelectedNodes();require(["DS/ENOXCADManageScope/command/InfoPanelModule"],function(t){new t({nodes:e})})}}}),t(o)})})},getCellTooltip:function(t){if(t.nodeModel){if(!t.nodeModel.getAttributeValue("isfileexist")){return{shortHelp:t.nodeModel.getAttributeValue("isfilenotindex")?e.i18n("saveScopeColumn").notindex:e.i18n("saveScopeColumn").isfileexist,updateModel:!1}}switch(t.columnID){case 2:let o=t.nodeModel.getAttributeValue("relpath");return{shortHelp:null!=o&&""!=o?e.i18n("saveScopeColumn").relpath+" : "+o:t.nodeModel.getAttributeValue("filename"),updateModel:!1};case 4:return{shortHelp:t.nodeModel.getAttributeValue("owner"),updateModel:!1};case 6:return{shortHelp:e.i18n("saveScopeColumn").islastrevision,updateModel:!1};case 8:let n=t.nodeModel.getAttributeValue("cadmaster");if(null!=n)return{shortHelp:n,updateModel:!1};break;case 12:return{shortHelp:"",updateModel:!1}}}return{shortHelp:t.cellModel,updateModel:!1}}}).inject(t)).showSelectionCheckBoxesFlag=!0,g.showRowIndexFlag=!1,g.layout.columnHeaderHeight=30,g.layout.cellHeight=30,g.layout.collectionView.showRowBorderFlag=!0,g.layout.rowsHeader=!1,g.onDragStartCell=function(e,t){if(t.draggedNodes.length>0){let o=p.getSeCtx();-1==o.indexOf("ctx::")&&(o="ctx::"+o);let n={protocol:"3DXContent",version:"1.1",source:"ENOXDPM_AP",widgetId:"undefined"!=typeof widget?widget.id:-1,data:{items:[]}};for(let e of t.draggedNodes)e.getAttributeValue("isfileexist")&&n.data.items.push({envId:p.getTenant(),serviceId:"3DSpace",contextId:o,objectId:e.getAttributeValue("phid"),objectType:e.getAttributeValue("type"),displayName:e.getAttributeValue("tree"),displayType:e.getAttributeValue("typenls"),scopeId:m});e.dataTransfer.setData("text",JSON.stringify(n))}return!1},g.onDragCell=function(e,t){return!1},g.onDragOverCell=function(e,t){return!0},g.onDragEndCell=function(e,t){return console.debug("end drag"),!1},g.onDragEnterCell=function(e,t){return!1},g.elements.scroller.elements.container.onscroll=f(function(){savescopeinfra.scrollVisibility(g.getAllScrollers())},250)},_nodeClickEvent:function(){var e=g.getNodesXSO();null!=e&&(e.onPostAdd(function(t){savescopeinfra.refreshPropView(e)}),e.onPostRemove(function(t){savescopeinfra.refreshPropView(e)}))},emptyContentView:function(){let t=e.createElement("div",{class:"scopedetails-empty-content"});e.createElement("div",{class:"scopedetails-empty-content-text-div"}).inject(t).innerText=e.i18n("scopedetails.grid.placeholder");let o=e.createElement("div",{class:"scopedetails-empty-content-button-div"}).inject(t);return new n({label:e.i18n("filter.fetch"),emphasize:"secondary"}).inject(o).getContent().addEventListener("buttonclick",function(){savescopeinfra.filterData()}),t},fillGridData:async function(t,o){var n=this;n.totalText.textContent=t.total+" "+e.i18n("savescope.info.details").total,n.currentText.textContent=g.model.length+t.data.length+" "+e.i18n("savescope.info.details").current;let i=t.data.filter(e=>"false"!=e.ex);await n.getTypeIconURL(i);let a=[];for(let e=0;e<t.data.length;e++){let o=t.data[e];if("false"!=o.ex&&null!=o.t&&null!=o.n&&null!=o.r){o.cdt=savescopeinfra.formatDate(o.cdt),o.mdt=savescopeinfra.formatDate(o.mdt),o.cadicon=savescopeinfra.getCadOriginIcon(o.cad);let e=null!=t.nls&&o.t?t.nls.find(e=>e.k===o.t):void 0;o.typenls=null!=e?e.v:o.t;let n=null!=t.nls&&o.cur?t.nls.find(e=>e.k===o.cur):void 0;o.curState=null!=n?n.v:void 0,a.push({tree:o.tit,icons:[{iconPath:o.type_icon_url}],isfileexist:!0,revision:o.r,filename:o.fil,owner:o.own,phid:o.id,islastrevision:o.isLR,relpath:o.rel,type:o.t,typenls:o.typenls,name:o.n,cadmaster:o.cad,cadmastericon:o.cadicon,collabspace:o.cs,matstate:o.curState,mstatus:o.cur.slice(o.cur.lastIndexOf(".")+1),cre_date:o.cdt,lmo_date:o.mdt})}else{let e=!!/true/.test(o.ex);a.push({phid:o.id,filename:o.fil,isfileexist:!1,isfilenotindex:e,matstate:"EMPTY",mstatus:"EMPTY"})}}let s=t.total<=o.request.endRow?t.total:-1;o.successCallback(a,s),n.loader.off(),u.removeModal(document.querySelector(".scope-details-grid-view .wux-layouts-datagridview")),n._nodeClickEvent()},getTypeIconURL:function(e){return new Promise(t=>{let o={physicalid:[],label:"XCADSvc-SaveScope-"+Math.floor(Date.now()/1e3).toString(),select_predicate:["ds6w:cadMaster","physicalid"]};e.forEach(e=>{o.physicalid.includes(e.id)||o.physicalid.push(e.id)}),r.getDatafromIndexDB(o).then(o=>{if(null!=o.results&&o.results.length>0){let t=new Map(o.results.map(e=>[e.attributes.find(e=>"physicalid"===e.name).value,e.attributes.find(e=>"type_icon_url"===e.name).value]));e.forEach(e=>{null!=t.get(e.id)&&(e.type_icon_url=t.get(e.id))})}t()}).catch(e=>{t()})})},setupInfoView:function(){let t=e.createElement("div",{class:"scope-details-info-status"}).inject(document.getElementById("scopeCentreDiv"));e.createElement("i",{class:"scope-details-status fonticon fonticon-info"}).inject(t);let n=e.createElement("div");this.totalText=e.createElement("small").inject(n),e.createElement("br").inject(n),this.currentText=e.createElement("small").inject(n),this.totalText.textContent="0 "+e.i18n("savescope.info.details").total,this.currentText.textContent="0 "+e.i18n("savescope.info.details").current,new o({target:t,position:"top",trigger:"click",overlap:!1,arrowBoxFlag:!0,constraint:"screen"}).setBody(n)},getNodesXso:function(){return g.getNodesXSO()}})}),define("DS/ENOXCADManageScope/utils/ManageScopeInfra",["DS/Core/PointerEvents","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/PlatformAPI/PlatformAPI","DS/ENOXCADManageScope/views/SaveScopeView","DS/ENOXCADManageScope/views/ListScopeView","DS/ENOXCADManageScope/views/ScopeDetailsView","DS/ENOXCADManageScope/views/PropetiesView","DS/ENOXCADManageScope/views/ToolBar","DS/ENOXCADManageScope/utils/URLHandler","DS/ENOXCADManageScope/utils/ScopeModelEvents","DS/ENOXCADManageScope/views/FilterData","text!DS/ENOXCADManageScope/assets/scopehelper.json","i18n!DS/ENOXCADManageScope/assets/nls/SaveScopeNLS","css!DS/ENOXCADManageScope/assets/styles/SaveScopeView"],function(e,t,o,n,i,a,s,l,r,c,d,u,p,f){var g,m,v,h,y,S,w,D,E,C,b,M;UWA.i18n(f),window.savescopeinfra={ROOT_ELEM:document.querySelector(":root"),HELPER_JSON:JSON.parse(p),SCOPE_LIMIT:500,SELECTED_SCOPE_LABLE:null,FILTER_DATA:null,get:function(e){return widget.getValue(e)},set:function(e,t){widget.setValue(e,t)},renderResizer:function(e){switch(e){case"leftDiv":document.contains(document.querySelector("#scope-left-resizer"))&&document.querySelector("#scope-left-resizer").destroy(),UWA.createElement("div",{id:"scope-left-resizer"}).inject(document.getElementById("scopeCentreDiv")),setTimeout(()=>{savescopeinfra.resizeLeftDivOnDrag()},1e3);break;case"rightDiv":document.contains(document.querySelector("#scope-right-resizer"))&&document.querySelector("#scope-right-resizer").destroy(),UWA.createElement("div",{id:"scope-right-resizer"}).inject(document.getElementById("scopeCentreDiv")),setTimeout(()=>{savescopeinfra.resizeRightDivOnDrag()},1e3)}},loadView:function(e){savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width","0%"),savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-minwidth","0%"),c.setURL(e.baseUrl),c.setXCADsvcURL(e.xcadServiceURL),c.setTenant(e.tenant),c.setSeCtx(e.sectx),savescopeinfra.createToolBar(),savescopeinfra.uiPanelController(),savescopeinfra.registerSearchEvent(),savescopeinfra.controlToolBarButtons(["save-scope-filter","save-scope-export-csv","save-scope-info"],!1),v=null,h=null,g=new i,m=new a,w=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--leftDiv-width"),S=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--rightDiv-width"),y=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--centreDiv-width"),savescopeinfra.mediaController()},registerSearchEvent:function(){n.subscribe("XDPMonitorTabView/Search",function(e){let t=null!=g?g.getSaveScopeGrid():h.getDetailsScopeGrid();t.getTreeDocument().getAllDescendants().length>0&&null!=t.findWidget&&(t.findWidget.findStr=e,t.findWidget.displayClose=!1,t.findWidget.displayMatchCaseToggle=!1,t.findWidget.inject(document.querySelector("#manage_tab_container .wux-controls-tabBar.wux-controls-tabbar-strip")),t.findWidget.visibleFlag=!0)}),n.subscribe("XDPMonitorTabView/resetSearch",function(){null!=g&&null!=g.getSaveScopeGrid().findWidget?g.getSaveScopeGrid().findWidget.close():null!=h.getDetailsScopeGrid().findWidget&&h.getDetailsScopeGrid().findWidget.close()})},selectListScope:function(e){m.expandSelectScope(e)},createToolBar:function(){savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width","20%"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width","80%"),new r({actiondirection:[{classdir:"tbar-actions-left",actions:[{icon:"expand-left",className:"save-scope-toggle-expand",sublabel:UWA.i18n("savescope.top.toolbar").collapse,hasAccess:!0,handler:savescopeinfra.toggleCollapse.bind(null)},{className:"save-scope-toggle-title",value:UWA.i18n("listScope")["root.node"],hasAccess:!0}]},{classdir:"tbar-actions-right",actions:[{icon:"plus",className:"save-scope-plus",label:UWA.i18n("savescope.top.toolbar").AddLabel,sublabel:UWA.i18n("savescope.top.toolbar").Add_subLabel,hasAccess:!0,handler:savescopeinfra.createScope.bind(null)},{icon:"collaborative-lifecycle-management",className:"save-scope-lifecycle-inactive",label:UWA.i18n("savescope.top.toolbar").ChangeMaturity,sublabel:UWA.i18n("savescope.top.toolbar").ChangeMaturity_sublabel,hasAccess:!0,handler:savescopeinfra.changeMaturity.bind(null)},{icon:"export-to-csv",className:"save-scope-export-csv",label:UWA.i18n("savescope.top.toolbar").exportcsv,sublabel:UWA.i18n("savescope.top.toolbar").exportcsv_desc,hasAccess:!0,handler:savescopeinfra.exportToCSV.bind(null)},{icon:"search-filter",className:"save-scope-filter",label:UWA.i18n("savescope.top.toolbar").filter,sublabel:UWA.i18n("savescope.top.toolbar").filter_desc,hasAccess:!0,handler:savescopeinfra.filterData.bind(null)},{icon:"info",className:"save-scope-info",sublabel:UWA.i18n("SaveScope.toolbar.action.info"),hasAccess:!0,handler:savescopeinfra.handleInfo.bind(null)}]}]}).render({container:document.getElementById("scopeTopDiv")})},controlToolBarButtons:function(e,t){let o;for(o of e){let e=document.getElementsByClassName(o)[0];t?e.style.removeProperty("display"):e.style.display="none"}},toggleCollapse:function(){let e=document.querySelector(".wux-ui-3ds-expand-left"),t=document.querySelector(".wux-ui-3ds-expand-right");null!=e?(e.classList.remove("wux-ui-3ds-expand-left"),e.classList.add("wux-ui-3ds-expand-right"),e.tooltipInfos.shortHelp=UWA.i18n("savescope.top.toolbar").expand,d.publish({event:"savescope-hide-panel",data:"hideleft"})):null!=t&&(t.classList.remove("wux-ui-3ds-expand-right"),t.classList.add("wux-ui-3ds-expand-left"),t.tooltipInfos.shortHelp=UWA.i18n("savescope.top.toolbar").collapse,d.publish({event:"savescope-show-panel",data:"showleft"}))},createScope:function(){g.createScope()},changeMaturity:function(){g.changeMaturity()},filterData:function(){document.contains(document.querySelector(".scope-propertiestab"))&&v.destroyView(!1),document.contains(document.querySelector(".filterPanel"))?C.destroyView():(d.publish({event:"savescope-show-panel",data:"showright"}),(C=new u).renderView(function(e){e.scopeid=D,h.listScopeContent(e)}))},updateScopeList:function(e){m.addChildList(e)},refreshScopeDetails:function(e){let t=null!=sessionStorage.getItem("SCOPE_FILTER_DATA")&&""!=sessionStorage.getItem("SCOPE_FILTER_DATA")?JSON.parse(sessionStorage.getItem("SCOPE_FILTER_DATA")):{};t.scopeid=e,h.listScopeContent(t)},exportToCSV:function(){let e=savescopeinfra.SELECTED_SCOPE_LABLE+"_Save Scope_Content_"+savescopeinfra.toolbarDate(new Date)+" "+savescopeinfra.formattedTime(new Date)+".csv",t=h.getDetailsScopeGrid().getAsCSV(),o=new Blob([t],{type:"text/csv"}),n=(window.URL||window.webkitURL).createObjectURL(o),i=UWA.createElement("a");i.style.display="none",i.href=n,i.download=e,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n)},handleInfo:function(){document.contains(document.querySelector(".filterPanel"))&&C.destroyView(!1);let e=h.getNodesXso();document.contains(document.querySelector(".scope-propertiestab"))?v.destroyView():(d.publish({event:"savescope-show-panel",data:"showright"}),v=new l(e))},refreshPropView:function(e){document.contains(document.querySelector(".scope-propertiestab"))&&v._selectionChange(e)},changeCentreView:function(e,t){if(null!=g&&null!=g.getSaveScopeGrid().findWidget?g.getSaveScopeGrid().findWidget.close():null!=h.getDetailsScopeGrid().findWidget&&h.getDetailsScopeGrid().findWidget.close(),document.contains(document.querySelector(".scope-propertiestab"))?v.destroyView():document.contains(document.querySelector(".filterPanel"))&&C.destroyView(),!e||null==g)if(e&&null==g)savescopeinfra.controlToolBarButtons(["save-scope-plus","wux-ui-3ds-collaborative-lifecycle-management"],!0),savescopeinfra.controlToolBarButtons(["save-scope-filter","save-scope-export-csv","save-scope-info"],!1),document.querySelector(".scope-details-status").destroy(),document.querySelector(".scope-details-grid-view").destroy(),h=null,g=new i;else{null==h&&(savescopeinfra.controlToolBarButtons(["save-scope-plus","wux-ui-3ds-collaborative-lifecycle-management"],!1),savescopeinfra.controlToolBarButtons(["save-scope-filter","save-scope-export-csv","save-scope-info"],!0),document.querySelector(".scope-grid-view").destroy(),g=null,h=new s),D=t;let e=null!=sessionStorage.getItem("SCOPE_FILTER_DATA")&&""!=sessionStorage.getItem("SCOPE_FILTER_DATA")?JSON.parse(sessionStorage.getItem("SCOPE_FILTER_DATA")):{};e.scopeid=t,h.listScopeContent(e)}},getCadOriginIcon:function(e){let t=savescopeinfra.HELPER_JSON.cadmastericon.find(t=>t.cadmaster===e);return null!=t?c.getURL()+t.iconPath:c.getURL()+"/snresources/images/icons/small/iconSmallDefault.gif"},getUTCtimezone:function(){return(new Date).getTimezoneOffset()},formatDate:function(e){return e?new Date(e).toLocaleString(WUX.currentLanguage,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""},formattedTime:function(e){return e?new Date(e).toLocaleTimeString(WUX.currentLanguage,{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):""},toolbarDate:function(e){return e?new Date(e).toLocaleString(WUX.currentLanguage,{month:"short",day:"numeric",year:"numeric"}):""},createScrollToTopDiv:function(){(E=UWA.createElement("div",{class:"savescope-scroll-to-top",html:{class:"fonticon fonticon-2x fonticon-move-to-top savescope-scroll-icon"}})).tooltipInfos=new o({shortHelp:UWA.i18n("savescope.scroll.gobacktotop")}),E.inject(document.getElementById("scopeCentreDiv")),t.addEventOnElement(this,E,e.POINTERHIT,function(e){(null!=g?g.getSaveScopeGrid():h.getDetailsScopeGrid()).setScrollerPosition({x:0,y:0})})},scrollVisibility:function(e){let t=e[0].elements.container.scrollTop;E.style.display=t>250?"block":"none"},uiPanelController:function(){"310",savescopeinfra.ROOT_ELEM=document.querySelector(":root"),d.subscribe({event:"savescope-hide-panel"},function(e){let t=document.querySelector("#scopeBodyDiv").offsetWidth,o=document.querySelector("#scopeLeftDiv").offsetWidth,n=document.querySelector("#scopeRightDiv").offsetWidth,i=document.querySelector("#scopeCentreDiv").offsetWidth;switch(e){case"hideleft":document.querySelector("#scope-left-resizer").style.setProperty("display","none");let a=Math.ceil(i/t*100)+Math.ceil(o/t*100)+"%";savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width","0%"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",a);break;case"hideright":let s=Number((i/t*100).toFixed(0))+Number((n/t*100).toFixed(0))+"%";savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width","0%"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",s)}M&&savescopeinfra.mediaController(e)}),d.subscribe({event:"savescope-show-panel"},function(e){let t=document.querySelector("#scopeBodyDiv").offsetWidth,o=document.querySelector("#scopeCentreDiv").offsetWidth;switch(e){case"showleft":if(document.querySelector("#scope-left-resizer").style.removeProperty("display"),M)savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width","100%"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width","0%");else if(""!=y&&""!=w)savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width",w),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",y);else{savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width","20%");let e=Number("20"),n=Math.ceil(o/t*100)-e+"%";savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",n)}break;case"showright":if(M)savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width","100%"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width","0%");else if(0===document.querySelector("#scopeRightDiv").offsetWidth)if(""!=y&&""!=S)savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width",S),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",y);else{savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width","310px");let e=Number("310"),t=Number(o)-e+"px";savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",t)}}M&&savescopeinfra.mediaController(e)})},resizeRightDivOnDrag:function(){let e,t,o,n=document.querySelector("#scopeRightDiv"),i=document.querySelector("#scope-right-resizer"),a=document.querySelector("#scopeCentreDiv");function s(i){e=i.clientX?i.clientX:i.touches&&i.touches[0]?i.touches[0].clientX:0,t=n.offsetWidth,o=a.offsetWidth,"touchstart"===i.type?(document.addEventListener("touchmove",l),document.addEventListener("touchend",r)):"mousedown"===i.type&&(document.addEventListener("mousemove",l),document.addEventListener("mouseup",r))}function l(n){let i=n.clientX?n.clientX:n.touches&&n.touches[0]?n.touches[0].clientX:0,a=t-i+e+"px",s=o+(i-e)+"px";savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width",a),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",s)}function r(e){"touchend"===e.type?(document.removeEventListener("touchmove",l),document.removeEventListener("touchend",r)):"mouseup"===e.type&&(document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",r)),S=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--rightDiv-width"),y=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--centreDiv-width")}i.addEventListener("mousedown",s),i.addEventListener("touchstart",s)},resizeLeftDivOnDrag:function(){let e,t,o,n=document.querySelector("#scopeLeftDiv"),i=document.querySelector("#scope-left-resizer"),a=document.querySelector("#scopeCentreDiv");function s(i){e=i.clientX?i.clientX:i.touches&&i.touches[0]?i.touches[0].clientX:0,t=n.offsetWidth,o=a.offsetWidth,"touchstart"===i.type?(document.addEventListener("touchmove",l),document.addEventListener("touchend",r)):"mousedown"===i.type&&(document.addEventListener("mousemove",l),document.addEventListener("mouseup",r))}function l(n){let i=n.clientX?n.clientX:n.touches&&n.touches[0]?n.touches[0].clientX:0,a=t+(i-e)+"px",s=o-i+e+"px";savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width",a),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",s)}function r(e){"touchend"===e.type?(document.removeEventListener("touchmove",l),document.removeEventListener("touchend",r)):"mouseup"===e.type&&(document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",r)),w=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--leftDiv-width"),y=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--centreDiv-width")}i.addEventListener("mousedown",s),i.addEventListener("touchstart",s)},mediaController:function(e){const t=window.matchMedia("screen and (max-device-width: 600px) and (orientation: portrait)");function o(t){console.log(window.innerWidth),M=t.matches;let o=""!=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--rightDiv-width")?parseInt(savescopeinfra.ROOT_ELEM.style.getPropertyValue("--rightDiv-width")):document.querySelector("#scopeRightDiv").offsetWidth,n=""!=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--leftDiv-width")?parseInt(savescopeinfra.ROOT_ELEM.style.getPropertyValue("--leftDiv-width")):document.querySelector("#scopeLeftDiv").offsetWidth;t.matches?(b=Math.min(window.innerWidth,document.documentElement.clientWidth),null==e&&n>0?savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width","100%"):"showright"===e&&savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width","100%"),n>0?(document.querySelector("#scopeTopDiv").style.setProperty("opacity","0.4"),document.querySelector("#scopeTopDiv").style.setProperty("pointerEvents","none"),document.querySelector("#scopeCentreDiv").style.setProperty("display","none"),o>0&&(null!=v?v.destroyView():C.destroyView())):(document.querySelector("#scopeTopDiv").style.removeProperty("opacity"),document.querySelector("#scopeTopDiv").style.removeProperty("pointerEvents"),document.querySelector("#scopeCentreDiv").style.removeProperty("display"),o>0&&(document.querySelector("#scopeCentreDiv").style.setProperty("display","none"),savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width","100%"))),null!=document.querySelector("#scope-left-resizer")&&document.querySelector("#scope-left-resizer").style.setProperty("display","none"),null!=document.querySelector("#scope-right-resizer")&&document.querySelector("#scope-right-resizer").style.setProperty("display","none")):(document.querySelector("#scopeTopDiv").style.removeProperty("opacity"),document.querySelector("#scopeTopDiv").style.removeProperty("pointerEvents"),document.querySelector("#scopeCentreDiv").style.removeProperty("display"),null!=document.querySelector("#scope-left-resizer")&&document.querySelector("#scope-left-resizer").style.removeProperty("display"),null!=document.querySelector("#scope-right-resizer")&&document.querySelector("#scope-right-resizer").style.removeProperty("display"),function(){let e=Math.min(window.innerWidth,document.documentElement.clientWidth);if(b!=e){b=e;let t=parseInt(e,10);if(document.contains(document.querySelector("#scope-right-resizer"))){let e=document.querySelector("#scopeRightDiv").offsetWidth,o=document.querySelector("#scopeCentreDiv").offsetWidth,n=o+e;if(n>t){let i=(n-t)/2;savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width",e-i+"px"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",o-i+"px")}else if(n<t){let i=(t-n)/2;savescopeinfra.ROOT_ELEM.style.setProperty("--rightDiv-width",e+i+"px"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",o+i+"px")}S=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--rightDiv-width"),y=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--centreDiv-width")}if(document.contains(document.querySelector("#scope-left-resizer"))){let e=document.querySelector("#scopeLeftDiv").offsetWidth,o=document.querySelector("#scopeCentreDiv").offsetWidth,n=o+e;if(n>t){let i=(n-t)/2;savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width",e-i+"px"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",o-i+"px")}else if(n<t){let i=(t-n)/2;savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width",e+i+"px"),savescopeinfra.ROOT_ELEM.style.setProperty("--centreDiv-width",o+i+"px")}else{let e=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--centreDiv-width");""!=e&&savescopeinfra.ROOT_ELEM.style.setProperty("--leftDiv-width",100-parseInt(e)+"%")}w=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--leftDiv-width"),y=savescopeinfra.ROOT_ELEM.style.getPropertyValue("--centreDiv-width")}}}())}o(t),t.addEventListener("change",function(e,t){let o,n=t||100;return function(t){o&&clearTimeout(o),o=setTimeout(e,n,t)}}(o,180))}}}),define("DS/ENOXCADManageScope/ENOXCADManageScope",["DS/ENOXCADManageScope/utils/ManageScopeInfra"],e=>{return{loadView:function(e){savescopeinfra.loadView(e)}}});