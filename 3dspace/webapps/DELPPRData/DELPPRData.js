define("DS/DELPPRData/Buildup/BuildUpSessionManager",["UWA/Core","DS/DELPXPProcessBuildUp/DELPXPProcessBuildUpAPI","DS/DELPXPSessionManager/DELPXPSessionManager"],function(e,t,n){"use strict";return function(e){let r={},i=e.getOption("logger");return{create:async function(e){i.debug("DynamicBuildupOnCloud::creating session");let r=e||n.createPXPSession(),o=await t.connectProcessBuildUp(r);return this.set(r,o),i.debug(`DynamicBuildupOnCloud::session created with session id: ${r}`),{id:r,session:o}},set:function(e,t){e&&(r[e]={session:t||null})},get:function(e){return r[e]},getNodeSessionInstance:function(e){let t=r[e]?r[e]:null;return t&&t.session?t.session:null},remove:function(e){delete r[e]},reset:function(){r={}}}}}),define("DS/DELPPRData/Buildup/BuildUpSettings",["UWA/Core","DS/Logger/Logger","text!DS/DELPPRData/assets/json/BuildUpCategoriesMap.json"],function(e,t,n){"use strict";var r,i=function(){const r=JSON.parse(n),i="Color",o="WithTransparency",s="TransparencyCoefficient",a="IsDisplayed",u="WithColor",l="TRUE",c="FALSE",p="resource",d="all",f="all_onlyassignedresources",g="capableresource";return{getParsedBuildUpSettings:function(t){var n,r,o,s={};if(e.is(t,"object"))for(r in(n={...t}).DisplayOptions)n.DisplayOptions.hasOwnProperty(r)&&(o=r.toLowerCase(),e.is(s[o],"object")||(s[o]={}),s[o].visibility=n.DisplayOptions[r].IsDisplayed===l,s[o].opacity=n.DisplayOptions[r].WithTransparency===l?Number(n.DisplayOptions[r].TransparencyCoefficient):255,s[o].color=n.DisplayOptions[r].WithColor===l&&n.ColorOptions.WithColor===l?n.ColorOptions[i+r]:null,s[o].withColor=n.DisplayOptions[r].WithColor===l,s[o].filter=n.DisplayOptions[r].Filter?n.DisplayOptions[r].Filter:null);return s},getGraphicProperties:function(t,n){var r;return e.is(t,"object")&&n&&(r=n===d||n===f||n===g?t[p]:t[n]),r},getCategory:function(e){return e&&e===d||e===f||e===g?p:e},isBuildUpColorsEnabled:function(e){let t=!1;return e&&e.ColorOptions&&(t=e.ColorOptions.WithColor===l),t},getCategoryColor:function(e,t){if(e&&e.ColorOptions)return e.ColorOptions[`${i}${r[t]}`]},updateBuildUpColorSettings:function(e,t){return e&&e.ColorOptions&&(e.ColorOptions.WithColor=t?l:c),e},updateBuildUpDisplayCategorySettings:function(e,t,n){return e&&t&&n&&Object.keys(n).forEach(p=>{let d=r[t];if(d)switch(p){case"color":e.ColorOptions&&(e.ColorOptions[`${i}${d}`]=n[p]);break;case"opacity":e.DisplayOptions[`${d}`]&&(e.DisplayOptions[`${d}`][o]=l,e.DisplayOptions[`${d}`][s]=n[p]);break;case"visibility":e.DisplayOptions[`${d}`]&&(e.DisplayOptions[`${d}`][a]=n[p]?l:c);break;case"withColor":e.DisplayOptions[`${d}`]&&(e.DisplayOptions[`${d}`][u]=n[p]?l:c)}}),e},isValidSettings:function(n){let r=!1;try{r=e.is(JSON.stringify(n))}catch(e){t.error(e),r=!1}return r}}};return e.is(r)||(r=new i),r}),define("DS/DELPPRData/WKIModelService",["UWA/Core"],function(e){"use strict";return function(t,n){const r="StepViewInfo";var i=n.getOption("mappingKeys"),o={getWKIContentPromise:function(r,o){return new e.Promise(function(s,a){e.is(r,"array")&&r.length>0&&o?t.getFileNameFromIndex(r,o).then(function(r){e.is(r,"string")?t.getFileContent(r,i.READERTYPE.TEXT).then(s).fail(a):i.FILETYPES.WKICONTENT===o?s(null):a(n.getNLSValue("FileNotFound",{fileType:o},"Error","Message"))}).fail(a):a(n.getNLSValue("Error.Message.InvalidInput"))})},getCurrentStepViewInfo:function(){return t.get(r)},setCurrentStepViewInfo:function(e={}){e.viewInfo&&t.set(r,e.viewInfo)},getViewInfo:function(t){let n;if(t&&t.viewUUID){let r=o.getCurrentStepViewInfo();e.is(r,"array")&&(n=r.find(e=>e.UUID===t.viewUUID))}return n},reset:function(){t.set(r)},destroy:function(){o.reset(),i=null}};return o}}),define("DS/DELPPRData/WebService",["UWA/Core","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","DS/WAFData/WAFData","DS/Logger/Logger","DS/DELWebViewerUtils/Utils","text!DS/DELPPRData/assets/json/Webservices.json"],function(e,t,n,r,i,o){"use strict";var s,a=function(){return{request:function(o){return new e.Promise(function(s,a){var u,l={Accept:"application/json, text/plain, application/octet-stream",SecurityContext:t.getSetting("pad_security_ctx")?t.getSetting("pad_security_ctx"):"preferred","Content-Type":"application/json"};e.is(o,"object")?(e.is(o.headers)&&Object.assign(l,o.headers),(u=new URL(o.url)).searchParams.set("tenant",i.getPlatformId()),n.authenticatedRequest(u.toString(),{method:o.method?o.method:"",type:o.dataType?o.dataType:"",data:o.payload?e.Json.encode(o.payload):"",headers:l,timeout:t.getSetting("webapi_timeout"),proxy:"none",onComplete:function(e){s(e)},onTimeout:function(e,t){r.error("WebService Call failed due to - "+e),a(t)},onFailure:function(e,t){r.error("WebService Call failed due to - "+e),a(t)}})):(r.error("WebService Request Input not found."),a("Error.InvalidInput.Message"))})},getPublishedRepDocument:async function(e){let t,n=JSON.parse(o).getPublishedRepDocument;return e&&(n.payload.batch.expands[0].root.physical_id=e,n.url=i.get3DSpaceUrl()+n.url,t=await s.request(n)),t}}};return e.is(s)||(s=new a),s}),define("DS/DELPPRData/facets/DELWkiInstructionsFacetModel",["UWA/Core","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","text!DS/DELPPRData/assets/json/Webservices.json"],function(e,t,n,r){"use strict";return function(){return{getData:async function(i){var o,s,a;return"businessobject"!==i.get("metatype")&&"bus"!==i.get("metatype")||(o=i.get("objectId"),s=await async function(r){var i=null,o=`${n.get3DSpaceUrl()}/cvservlet/fetch/v2`,s={label:"Fetch-V2-"+Date.now(),physicalid:[r],locale:"en",select_predicate:["ds6w:type"]},a=await t.request({url:o,method:"POST",dataType:"json",payload:s});return a&&e.is(a.results,"array")&&a.results.forEach(t=>{e.is(t.attributes,"array")&&t.attributes.forEach(e=>{"ds6w:type"===e.name&&(i=e.value)})}),i}(o),a=await async function(e,i){var o,s,a=JSON.parse(r).WorkInstructionsTypes;return a[i]&&(o=`${n.get3DSpaceUrl()}`+`${a[i].url.replace("{ID}",e)}`,s=await t.request({url:o,method:"GET",dataType:"json"})),{response:s,type:i}}(o,s)),a}}}}),define("DS/DELPPRData/Buildup/BaseBuildup",["UWA/Core","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","DS/DELPPRData/Buildup/BuildUpSettings","DS/DELWebOERCommonUtils/utils/CommonUtils","text!DS/DELPPRData/assets/json/GlobalBuildupSettings.json"],function(e,t,n,r,i,o){"use strict";return function(s,a){var u=a.getOption("mappingKeys"),l=a.getOption("logger"),c=a.getOption("eventCollection").getModelCtrlEventHnd(),p=[];const d="CapRsc",f="BuildUpGlobalSettings";let g=function(){p.forEach(e=>{c.unSubscribe(e)}),p.push(c.subscribe(c.events.onSetBuildUpGlobalSettingsComplete,function(e){e&&widget.setValue(f,JSON.stringify(e))}))},P=function(e={}){if(!e.settings||!r.isValidSettings(e.settings))throw l.log("property settings is not available/ or is not a valid settings, please check the input"),new Error(a.getNLSValue("Error.InvalidInput.Message"));s.set(f,e.settings)},D=function(e={}){var t,n;return a.getOption("persistBuildUpSettings")&&(g(),e.clear&&widget.setValue(f),(n=widget.getValue(f))&&(t=JSON.parse(n))),t||(t=JSON.parse(o)[u.BUILDUPKEYS.BUILDUPSETTINGS]),P({settings:t}),t};return{getBuildUpVersion:async function(){var t,n="V2";try{(t=await i.fetchMePreferences([{Repository:"3DOperationsViewerRepository",PreferenceNames:["DELOER_DYNAMIC_BUILDUP_VERSION_V2"]}]))&&e.is(t.repositories,"array")&&t.repositories.length>0&&t.repositories.forEach(function(t){t&&e.is(t.preferences,"array")&&t.preferences.length>0&&t.preferences.forEach(function(e){e&&"DELOER_DYNAMIC_BUILDUP_VERSION_V2"===e.name&&(n="true"===e.value?"V2":"V1")})})}catch(e){l.warn("Mepreference call failed due to -",e)}return n},activateBuildUpPersistence:g,updateBuildUpSettings:function(e){return D(e)},getBuildUpContext:function(e){let r=`${n.get3DSpaceUrl()}/resources/v1/delviewerservices/private/invoke/getBuildUpContext`;return t.request({url:r,method:"POST",dataType:"json",payload:e}).then(function(e){return e&&e.results&&e.results.mfgContext&&s.set("buildupContext",e.results.mfgContext),e&&e.results&&e.results.resourceContext&&s.set("resourceContext",e.results.resourceContext),e})},getPayload:function(e){var t={"dsprcs:MfgProcess":{id:e.processId},"dsprcs:Mfg":{id:e.mfgId},"dsprcs:Resource":{}};return e.installPath&&(t["dsprcs:Mfg"].installPath=e.installPath),e.resourceId&&(t["dsprcs:Resource"].id=e.resourceId),e.filter&&(t.filter=e.filter),t},initialize:function(r){let i=this,o=2===a.getOption("viewerType");return o&&s.loadProcess(r).fail(e=>{l.warn(e)}),e.Promise.all([async function(){let e=await i.getBuildUpVersion();return function(e,n){return t.request({url:e,method:"POST",dataType:"json",payload:n})}(`${n.get3DSpaceUrl()}/resources/v0/dsprcs/private/invoke/buildup?version=${e}`,i.getPayload(r)).then(function(e){return s.set("buildupContent",e),e})}(),i.getBuildUpContext(i.getPayload(r))]).then(function(){return D()})},getPredecessors:function(){let e=[],t=this.getProcessInfo();return t&&t.installPath&&t.predecessors&&t.predecessors.length>0&&t.predecessors.forEach(function(t){e.push({path:t,category:"previousfromprevioussystem",position:""})}),e},getContext:function(t){var n=s.get("buildupContext")||[];return e.is(t,"array")&&t.length>0&&(n=[],t.forEach(function(t){e.is(t,"array")&&t.length>0&&n.push({[u.BUILDUPKEYS.PATH]:t,[u.BUILDUPKEYS.CATEGORY]:u.BUILDUPCATEGORY.Context})})),n},parseBuildupContent:function(t,n){var r=s.get("process")||{},i=r&&r.installPath&&r.installPath.length>0?r.installPath.slice(0,r.installPath.length-1):[],o=[],a=[],l=this.getContext(n),c=this.getPredecessors()||[],p=function(t,n){let r=[];return e.is(t,"array")&&t.length>0&&t.forEach(function(e){var t={},o=u.BUILDUPCATEGORY[e.bucategory];t[u.BUILDUPKEYS.PATH]=o===d?e.objectinstancepath:i.concat(e.objectinstancepath),o&&(t[u.BUILDUPKEYS.CATEGORY]=o),t[u.GRAPHICPROPERTIES.VISIBILITY]=n,t[u.GRAPHICPROPERTIES.VISIBILITYFREE]=!n,r.push(t)}),r};return t&&(o=p(t[u.BUILDUPKEYS.OBJECTSTOSHOW],!0),a=p(t[u.BUILDUPKEYS.OBJECTSTOHIDE],!1)),a.concat((s.get("resourceContext")||[]).map(function(e){return{path:e.path,visibility:!1,visibilityFree:!0}}),l,c,o)},getBuildUp:function(t){var n,r=[],i=t.path;return e.is(i,"array")&&i.length>0&&(n=s.get("buildupContent")[i.join("/")],r=this.parseBuildupContent(n,t.context)),r},getMFGAndResourcePaths:function(){return[]},isObjectAvailable:function(){return!1},reset:function(){s.set("buildupContext",null),s.set("buildupContent",null)},destroy:function(){this.reset()},getBuildUpGlobalSettings:function(){let e=s.get(f);return e||D()},setBuildUpGlobalSettings:P,getProcessInfo:function(){return s.get("process")}}}}),define("DS/DELPPRData/Zip",["UWA/Core","DS/ZipJS/zip-fs","DS/VisuUnstreamers/FileInZipStreamObject","DS/DELWebViewerUtils/Utils","DS/Logger/Logger","DS/DELPPRData/WebService"],function(e,t,n,r,i,o){"use strict";var s,a=function(){var s,a,u=function(){return new e.Promise(function(e,t){s?e():t("Error.ZipNotInit.Message")})};return{init:function(e){var t=e.getOption("mappingKeys");t&&(s=t.DOCUMENTKEYS),a=e.getOption("logger")},fetchProcessData:function(t={}){var n=this,i=t.processId,l=r.get3DSpaceUrl(),c=function(){return`timestamp=${(new Date).getTime()}`},p=function(){let n,r=t.publishedRepId;return n=r?e.Promise.resolve(r):o.getPublishedRepDocument(i).then(function(t){let n,r;return e.is(t,"object")&&e.is(t.results,"array")&&t.results.length>0&&(r=t.results.find(e=>e.type===s.DOCUMENTTYPE))&&(n=r.resourceid),n})},d=function(t){return new e.Promise(function(n,r){var i;e.is(t)?(i=`${l}/resources/v1/modeler/documents/${t}/files/DownloadTicket?${c()}`,function(){var e=`${l}/resources/v1/application/CSRF?${c()}`;return o.request({url:e,method:"GET",dataType:"json"})}().then(function(e){return o.request({url:i,method:"PUT",dataType:"json",headers:{ENO_CSRF_TOKEN:e.csrf.value}})}).then(n).fail(r)):(a.debug("Document id not found. Ensure workplan is published correctly."),r("Error.PublishedContentNotFound.Message"))})},f=function(t){return new e.Promise(function(r,i){e.is(t)&&e.is(t.data,"array")&&e.is(t.data[0].dataelements.ticketURL)?o.request({url:t.data[0].dataelements.ticketURL,method:"GET",dataType:"blob"}).then(function(o){var u;e.is(t.data[0].dataelements.fileNames,"array")?(u=t.data[0].dataelements.fileNames.find(function(e){return-1!==e.indexOf(s.FILETYPE)}),e.is(u)?n.getFileNameFromZipBlob(o,u).then(function(e){n.getFileContent(o,e,"BLOB").then(r).fail(i)}).fail(i):(a.debug("Viewer Zip content file not found. Ensure workplan is published correctly."),i("Error.PublishedContentNotFound.Message"))):(a.debug("File names not found. Ensure workplan is published correctly."),i("Error.PublishedContentNotFound.Message"))}).fail(i):(a.debug("FCS URL not found. Ensure workplan is published correctly."),i("Error.PublishedContentNotFound.Message"))})},g=function(t){return new e.Promise(function(r,i){e.is(t)&&t.size>0?n.getFileNameFromZipBlob(t,s.INDEXFILESUFFIX).then(function(r){var i;return r?i=n.getFileContent(t,r,"TEXT"):(a.debug("Index file is invalid in published content. Ensure workplan is published correctly."),i=e.Promise.reject("Error.PublishedContentNotFound.Message")),i}).then(function(n){e.is(n)?r({zipBlob:t,indexFile:n}):(a.debug("Index file is invalid in published content. Ensure workplan is published correctly."),i("Error.PublishedContentNotFound.Message"))}).fail(i):(a.debug("Published content not found for given workplan. Ensure workplan is published correctly"),i("Error.PublishedContentNotFound.Message"))})};return new e.Promise(function(e,t){i?u().then(p).then(d).then(f).then(g).then(e).fail(t):t("Error.InvalidInput.Message")})},getFileContent:function(t,r,o){var s={BLOB:function(e,t){e.readAsBlob(t)},TEXT:function(e,t){e.readAsText(t)}};return new e.Promise(function(a,l){u().then(function(){var u,c=s[o];c?(c(u=new n(t,r),function(t){try{"TEXT"===o&&(t=JSON.parse(t)),e.is(t)?a(t):l("Error.FileContentNotFound.Message")}catch(e){i.error("File content extraction failed due to - "+e),l("Error.FileContentExtractionFailed.Message")}}),u.close()):l("Error.InvalidReaderType.Message")}).fail(l)})},getFileNameFromZipBlob:function(n,r){return new e.Promise(function(i,o){u().then(function(){n&&r?t.createReader(new t.BlobReader(n),function(t){t.getEntries(function(t){t.length>0?i(function(t,n){var r,i;for(r=0;r<t.length;++r)if(e.is(t[r].filename)&&(t[r].filename===n.trim()||t[r].filename.indexOf(n)>0)){i=t[r].filename;break}return i}(t,r)):o("Error.NoEntriesInZipBlob.Message")})},o):o("Error.FilenameNotFound.Message")}).fail(o)})},getFileName:function(t,n,r){return new e.Promise(function(i,o){u().then(function(){var o,s,a,u,l;if(e.is(t,"object")&&e.is(n,"array")&&n.length>0&&r&&(o=t.occurrences,e.is(o,"array")))for(s=0;s<o.length;s++)if(e.Array.equals(o[s].pathIds,n)){for(l=o[s].files,a=0;a<l.length;a++)if(l[a].type===r){u=l[a].name;break}break}i(u)}).fail(o)})},getOperationPath:function(t,n){return new e.Promise(function(e,r){u().then(function(){var i;t&&n&&(i=t.occurrences.find(function(e){return!!(e.pathIds&&e.pathIds.length>1)&&(e.pathIds[e.pathIds.length-1]===n||e.pathIds[e.pathIds.length-2]===n)})),i?e(i.pathIds):r("Error.StepPathInvalid.Message")}).fail(r)})},dispose:function(){s=a=null}}};return e.is(s)||(s=new a),s}),define("DS/DELPPRData/Buildup/PublishedBuildup",["UWA/Core","DS/DELPPRData/Buildup/BaseBuildup"],function(e,t){"use strict";return function(n,r){var i,o=[],s=r.getOption("logger"),a=r.getOption("mappingKeys"),u=a.BUILDUPKEYS.BUILDUPDEFKEYS,l=a.GRAPHICPROPERTIES,c=new t(n,r),p=async function(e={}){var t,i=e.processId,o=r.getOption("persistBuildUpSettings");if(t=await c.updateBuildUpSettings(e),!o||e.clear){let e,o=await n.getFileNameFromIndex([i],a.FILETYPES.BUILDUPSETTINGS);if(!o)throw new Error(r.getNLSValue("FileNotFound",{fileType:a.FILETYPES.BUILDUPSETTINGS},"Error","Message"));t=(e=await n.getFileContent(o,a.READERTYPE.TEXT))[a.BUILDUPKEYS.BUILDUPSETTINGS],c.setBuildUpGlobalSettings({settings:t})}return t};return Object.assign({},c,{updateBuildUpSettings:function(e){return p(e)},initialize:function(t={}){return e.is(n)?n.loadProcess(t).then(function(){return new e.Promise(function(t,o){n.getFileNameFromZipBlob(a.FILENAMES.BUILDUPDEF+".").then(function(t){return t?n.getFileContent(t,a.READERTYPE.TEXT):e.Promise.reject(r.getNLSValue("FileNotFound",{fileType:a.FILENAMES.BUILDUPDEF},"Error","Message"))}).then(function(n){var u;e.is(n,"object")?(i=n,t(n)):(u=r.getNLSValue("FileContentNotFound",{fileContentType:a.FILENAMES.BUILDUPDEF+"Content"},"Error","Message"),s.error(u),o(u))}).fail(function(e){s.error(e),o(e)})})}).then(function(t){return new e.Promise(function(i,o){n.getFileNameFromZipBlob(a.FILETYPES.BUILDUPCONTEXT+".").then(function(t){return t?n.getFileContent(t,a.READERTYPE.TEXT):e.Promise.reject(r.getNLSValue("FileNotFound",{fileType:a.FILETYPES.BUILDUPCONTEXT},"Error","Message"))}).then(function(l){var c,p=[];e.is(l,"object")?(l.mfgItemsBuildUp.forEach(function(e){var n=e.Id?e.Id:"",r={};r[a.BUILDUPKEYS.PATH]=t[u.MFGITEMS][n][a.BUILDUPKEYS.PATHIDS],r[a.BUILDUPKEYS.CATEGORY]=e[a.BUILDUPKEYS.CATEGORY],p.push(r)}),n.set("buildupContext",p),i(p)):(c=r.getNLSValue("FileContentNotFound",{fileContentType:a.FILETYPES.BUILDUPCONTEXT+"Content"},"Error","Message"),s.error(c),o(c))}).fail(function(e){s.error(e),o(e)})})}).then(function(){return p(t)}):e.Promise.reject(r.getNLSValue("Error.DataManagerNotFound.Message"))},getMFGAndResourcePaths:function(){var t,n,r=[];if(i)for(t in i)if(i.hasOwnProperty(t)&&e.is(i[t],"object"))for(n of Object.values(i[t]))e.is(n[a.BUILDUPKEYS.PATHIDS],"array")&&n[a.BUILDUPKEYS.PATHIDS].length>0&&r.push(n[a.BUILDUPKEYS.PATHIDS].toString());return r},getBuildUp:function(t){let c=this,p=function(t){return new e.Promise(function(e){let n=t||[],r=[],i=t.map(e=>e[a.BUILDUPKEYS.PATH].toString());0===o.length&&(o=c.getMFGAndResourcePaths()),o.forEach(function(e){var t={};i.find(function(t){return e.indexOf(t)>-1||t.indexOf(e)>-1})||(t[a.BUILDUPKEYS.PATH]=e.split(","),t[l.VISIBILITY]=!1,t[l.VISIBILITYFREE]=!0,r.push(t))}),e(r.concat(n))})},d=function(t){return new e.Promise(function(n){var r,i,o=[],s=c.getContext(),l=c.getPredecessors()||[];if(e.is(t.buildUp,"object")){for(r in u)u.hasOwnProperty(r)&&(i=u[r]+a.BUILDUPKEYS.BUILDUP,e.is(t.buildUp[i],"array")&&t.buildUp[i].length>0&&t.buildUp[i].forEach(function(e){var n=e.Id?e.Id:"",i={};n&&(i[a.BUILDUPKEYS.PATH]=t.buildUpDef[u[r]][n][a.BUILDUPKEYS.PATHIDS],i[a.BUILDUPKEYS.CATEGORY]=e[a.BUILDUPKEYS.CATEGORY],i[a.BUILDUPKEYS.POSITION]=e[a.BUILDUPKEYS.MODEL.POSITION],i[a.BUILDUPKEYS.TYPE]=u[r],o.push(i))}));n(s.concat(l,o))}})};return new e.Promise(function(o,u){var l;(l=i,new e.Promise(function(i,o){var u,c=t.path;e.is(c,"array")&&c.length>0&&n.getFileNameFromIndex(c,a.FILETYPES.BUILDUPCONTENT).then(function(t){e.is(t,"string")?n.getFileContent(t,a.READERTYPE.TEXT).then(function(e){i({buildUp:e,buildUpDef:l})}).fail(o):(u=r.getNLSValue("FileNotFound",{fileType:a.FILETYPES.BUILDUPCONTENT},"Error","Message"),s.error(u),o(u))}).fail(o)})).then(d).then(p).then(o).fail(u)})},isObjectAvailable:function(e){return!!(i&&i[e]&&Object.keys(i[e]).length>0)},reset:function(){i=null,o=[],c.reset()}})}}),define("DS/DELPPRData/Buildup/DynamicBuildupOnPremise",["DS/DELPPRData/Buildup/BaseBuildup"],function(e){"use strict";return function(t,n){return new e(t,n)}}),define("DS/DELPPRData/DataManager",["UWA/Core","DS/DELPPRData/Zip"],function(e,t){"use strict";return function(n){var r={zip:{}},i=n.getOption("eventCollection").getModelCtrlEventHnd();return t.init(n),{get:function(e){return r[e]?r[e]:null},set:function(t,n){e.is(t)&&(r[t]=n,i.publish(`onSet${t}Complete`,n))},reset:function(){r={zip:{}}},destroy:function(){r={zip:{}},t.dispose()},loadProcess:function(i={}){return new e.Promise(function(e,o){t.fetchProcessData(i).then(function(t){r.zip=t,e(t)}).fail(function(e){o(n.getNLSValue(e))})})},getFileNameFromIndex:function(i,o){return new e.Promise(function(e,s){t.getFileName(r.zip.indexFile,i,o).then(e).fail(function(e){s(n.getNLSValue(e))})})},getFileNameFromZipBlob:function(i){return new e.Promise(function(e,o){return t.getFileNameFromZipBlob(r.zip.zipBlob,i).then(e).fail(function(e){o(n.getNLSValue(e))})})},getFileContent:function(i,o){return new e.Promise(function(e,s){t.getFileContent(r.zip.zipBlob,i,o).then(e).fail(function(e){s(n.getNLSValue(e))})})},getOperationPath:function(i){return new e.Promise(function(e,o){r&&r.zip?t.getOperationPath(r.zip.indexFile,i).then(e).fail(function(e){o(n.getNLSValue(e))}):o(n.getNLSValue("Error.ProcessNotSet.Message"))})}}}}),define("DS/DELPPRData/Buildup/DynamicBuildupOnCloud",["UWA/Core","DS/DELPPRData/Buildup/BaseBuildup","DS/DELPXPProcessBuildUp/DELPXPProcessBuildUpAPI","DS/DELPXPMfgModelers/DELPXPMfgModelersAPI","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","DS/DELPPRData/Buildup/BuildUpSessionManager"],function(e,t,n,r,i,o,s){"use strict";return function(a,u){var l=new s(u),c=u.getOption("logger"),p=new n.DELPXPBuildUpParams,d=new t(a,u);return p.setDiffOperator(!0),p.setPositionSolver(!0),Object.assign({},d,{initialize:function(t){var n=this,s=this.getProcessInfo(),a=n.getPayload(t);return c.debug("DynamicBuildupOnCloud::initialize method invoked with parameters : ",t),e.Promise.all([n.getBuildUpContext(a),async function(){let e=await n.getBuildUpVersion(),t=`${o.get3DSpaceUrl()}/resources/v1/delviewerservices/private/invoke/initBuildup?version=${e}`;return i.request({url:t,method:"POST",dataType:"json",payload:a})}()]).then(async function(t){let n,i,o;return e.is(t,"array")&&t.length>0&&(o=JSON.stringify(t[1]),n=await l.create(),i=r.GetMfgModelers(n.session),s.sesssionId=n.id,c.debug(`DynamicBuildupOnCloud::initialize build up using ${o}`),await i.load(o),c.debug("DynamicBuildupOnCloud::Build up initialized")),n})},getBuildUp:async function(t){let r,i,o,s=t||{},a=t.id,u=t.scopedMfg&&t.scopedMfg.id?t.scopedMfg.id:null,c=s.session&&s.session.id?s.session.id:null,d=s&&e.is(s.path,"array")?s.path:[],f=l.getNodeSessionInstance(c);f||(f=(await l.create(c)).session),o=n.GetProcessBuildUpAPI(f),r=new n.DELPXPBuildUpSelection([d],a,u,"");try{i=await o.queryBuildUpSelection(r,p)}catch(e){throw l.remove(c),e.code="DELVIEWER_E003",e}return this.parseBuildupContent(i,t.context)},reset:function(){l.reset(),d.reset()}})}}),define("DS/DELPPRData/BuildUpModelService",["UWA/Core","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","DS/DELPPRData/Buildup/DynamicBuildupOnCloud","DS/DELPPRData/Buildup/DynamicBuildupOnPremise","DS/DELPPRData/Buildup/PublishedBuildup"],function(e,t,n,r,i,o){"use strict";return function(e,t){var s,a=t.getOption("dynamicBuildUp"),u=[],l=t.getOption("eventCollection").getViewerCtrlEventHnd(),c=function(){var a=t.getOption("dynamicBuildUp")?n.isCloud()?r:i:o;return s=null,new a(e,t)},p=function(e){t.getOption("dynamicBuildUp")!==a&&(s=c(),a=e.data.dynamicBuildUp)};return function(){if(l){let e=[{name:l.events.onUpdateOptions,callback:p,handler:l}];for(let t of e)u.push({handler:t.handler,token:t.handler.subscribe(t.name,t.callback)})}}(),s=c(),{getBuildUpSettings:function(e){return s.getBuildUpSettings(e)},initialize:async function(e){return await s.initialize(e)},set:e.set,get:e.get,updateBuildUpSettings:async function(e={}){let n,r={...e,persistBuildUpSettings:t.getOption("persistBuildUpSettings")};return n=await s.updateBuildUpSettings(r)},reset:function(){s&&s.reset()},destroy:function(){this.reset()},getMFGAndResourcePaths:function(){return s.getMFGAndResourcePaths()},getBuildUp:function(e){return s.getBuildUp(e)},getBuildUpGlobalSettings:function(e){let t;return s&&(t=s.getBuildUpGlobalSettings(e)),t},setBuildUpGlobalSettings:function(e){s&&s.setBuildUpGlobalSettings(e)},getProcessInfo:function(){let e;return s&&(e=s.getProcessInfo()),e},isObjectAvailable:function(e){return s.isObjectAvailable(e)}}}}),define("DS/DELPPRData/ModelFactory",["UWA/Core","DS/DELPPRData/DataManager"],function(e,t){"use strict";return function(n){var r,i={},o="ModelService",s={BuildUpBehavior:"DS/DELPPRData/BuildUpModelService",WorkInstructionBehavior:"DS/DELPPRData/WKIModelService"};return{getCreatePromise:function(a){return new e.Promise(function(u){var l,c={};r=e.is(a,"array")&&a.length>0?new t(n):null,l=[null,r,n].concat(Array.prototype.slice.call(arguments,1)),e.is(a,"array")&&a.length>0?(a.forEach(e=>{s[e]&&(c[e]=s[e])}),require(Object.values(c),function(){var e=Array.prototype.slice.call(arguments),t=Object.keys(c);e.length>0&&e.forEach(function(e,n){i[t[n]+o]=new(Function.prototype.bind.apply(e,l))}),u(i)})):u(i)})},getInstance:function(e){return e&&i[e]?i[e]:null},getDataManager:function(){return r},destroy:function(){r&&r.destroy(),i=o=r=null}}}}),define("DS/DELPPRData/ModelInterface",["UWA/Core","DS/DELPPRData/ModelFactory","DS/DELPPRData/WebService","DS/DELWebViewerUtils/Utils","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","text!DS/DELPPRData/assets/json/DrillPayloads.json","text!DS/DELPPRData/assets/json/Webservices.json"],function(e,t,n,r,i,o,s){"use strict";return function(a){var u="resourceid",l="ds6w:label",c="ds6w:type",p="matrixtxt",d="ds6w:globalType",f="Path",g="ds6w:Instance",P="boundingbox",D="taxonomies",E="resultingProductLink",h="pathsr",S="DELFmiProcessOutputPrereqMaterializationCnx",U=Object.freeze({PROCESS:"PROCESS",RESOURCE:"RESOURCE",PRODUCT:"PRODUCT",MBOM:"MBOM"}),y=Object.freeze({DELLmiPPRSystemReference:U.PROCESS,DELFmiFunctionReference:U.MBOM,"interfaces/Resource":U.RESOURCE,VPMReference:U.PRODUCT,DELLmiPPRHeaderProcessReferenceAbstract:U.PROCESS}),m=new t(a),I=a.getOption("logger");return{getCreatePromise:function(e){return m.getCreatePromise(e)},getInstance:function(e){return m.getInstance(e)},getOperationPath:function(t){var n=m.getDataManager();return n?n.getOperationPath(t):e.Promise.reject(a.getNLSValue("Error.DataManagerNotFound.Message"))},getIndexingDate:function(t){var o={select_service:[t]};return new e.Promise(function(e,t){var s=i.getSetting("pad_security_ctx")?i.getSetting("pad_security_ctx"):"preferred",a=`${r.get3DSpaceUrl()}/cvservlet/indexingdate?SecurityContext=${s}`;n.request({url:a,method:"POST",dataType:"json",payload:o}).then(function(t){e(t)}).fail(t)})},getProgressiveExpandData:function(t){var i=r.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson";return new e.Promise(function(e,r){n.request({url:i,method:"POST",dataType:"json",payload:t}).then(function(t){e(t)}).fail(r)})},getInstallContext:function(t){var i,o,u,l=JSON.parse(s).getMfgItemInstallDependencies;if(a&&t.installPath&&t.installPath.length>1){o=t.installPath[0],u=t.installPath[1];let s=`${r.get3DSpaceUrl()}${l.url}`,c=l.method,p=l.payload;p.assemblyid=o,p.installinstids=[u],t.filter&&(p.config=r.getObjectHavingProperty(t.filter,"config_filter")),i=n.request({url:s,method:c,dataType:"json",payload:p}).then(t=>{let n;return t&&(t.status&&I.error(JSON.stringify(t)),n=t[u]),n||e.Promise.reject(a.getNLSValue("Error.WebServiceCallFailed.Message"))})}else i=e.Promise.reject(a.getNLSValue("Error.InvalidInput.Message"));return i},getAttributeForIds:function(t,i,o){var s,a,u=function(t,i,o){return new e.Promise((s,a)=>{n.request({url:r.get3DSpaceUrl()+"/cvservlet/fetch/v2",method:"POST",dataType:"json",payload:function(e,t,n){return{label:"DrillAttributes-"+Date.now(),physicalid:e,locale:"en",select_predicate:t,select_file:n}}(t,i,o)}).then(function(t){t&&e.is(t.error)?a(t.error.errorMessage):s(t)}).fail(function(e){a(e)})})},l=[],c=[];return e.is(t,"array")&&e.is(i,"array")?new e.Promise(function(n,r){if(t.length>1e4)for(s=0,a=t.length;s<a;s+=1e4)l=t.slice(s,s+1e4),c.push(u(l,i,o));else c.push(u(t,i,o));e.Promise.all(c).then(function(t){var r={};t.forEach(t=>{Object.assign(r,function(t){var n="string"==typeof t?JSON.parse(t).results:t.results,r={};return e.is(n,"array")&&n.forEach(t=>{var n=null,i={};e.is(t.attributes,"array")&&(t.attributes.forEach(t=>{"resourceid"===t.name?n=t.value:i[t.name]?(e.is(i[t.name],"array")||(i[t.name]=[i[t.name]]),i[t.name].push(t.value)):i[t.name]=t.value}),r[n]=i)}),r}(t))}),n(r)}).fail(r)}):e.Promise.reject("Invalid Input Provided")},getTaxonomies:function(t){return this.getAttributeForIds(t,["taxonomies"]).then(function(t){var n={};if(t)for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]&&e.is(t[r].taxonomies,"array")?t[r].taxonomies.join("/"):t[r].taxonomies);return n})},getPPRType:function(t){var n;if(t){t=e.is(t,"array")?t.join("/"):t;for(const e of Object.keys(y))if(t.contains(e)){n=y[e];break}}return n},getDrillData:function(t){var n=this,r=JSON.parse(o),i=function(e,t,n){return e.batch.expands[0].root.physical_id=t,n&&(e.batch.expands[0].filter={and:{filters:[n]}}),e};return t&&t.id?new e.Promise((o,s)=>{e.Promise.all([function(e){return n.getProgressiveExpandData(i(r.drills,e,t.filter))}(t.id),function(e){return n.getProgressiveExpandData(i(r.resultingProduct,e,t.filter))}(t.id)]).then(function(t){var n,r,i=(n=t[0],r={references:{},instances:{},paths:[]},n&&e.is(n.results,"array")&&n.results.forEach(e=>{e[f]?r.paths.push(e[f]):e[d]===g?r.instances[e[u]]={instanceId:e[u],label:e[l],type:e[c],matrixtxt:e[p]?e[p]:null,pathsr:e[h]?e[h]:""}:r.references[e[u]]={referenceId:e[u],label:e[l],type:e[c],taxonomies:e[D],boundingbox:e[P]}}),r),s=function(t,n){var r=[];return t&&e.is(t.results,"array")&&t.results.forEach(e=>{e[d]===g&&e[c]===S&&n.references[e.from]&&(n.references[e.from][E]=!0,r.push(e.from))}),r}(t[1],i),a=function(t,n){var r={resultingProductDrillPaths:[],drillPaths:[]};return e.is(t,"array")&&t.length>0&&t.forEach(function(e){-1!==n.indexOf(e[e.length-1])?r.resultingProductDrillPaths.push(e):r.drillPaths.push(e)}),r}(i.paths,s);o(e.merge(i,a))}).fail(s)}):e.Promise.reject("Invalid Input Provided")},getRequirements:async function(e){let t=JSON.parse(s).getRequirements;return t.payload.input_physical_ids=e,t.url=r.get3DSpaceUrl()+t.url,await n.request(t)},getDataManager:function(){return m.getDataManager()},reset:function(){var e=this.getDataManager();e&&e.reset()},destroy:function(){m&&m.destroy(),m=null}}}});