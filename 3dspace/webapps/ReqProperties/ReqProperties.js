define("DS/ReqProperties/facets/RichAttribute/RichContentController",["UWA/Core","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/RichView/RichContentEditor","DS/CKEditor/CKEditor","UWA/Class","UWA/Controls/Abstract","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/RequirementErrorManager","i18n!DS/ReqProperties/assets/nls/ReqProperties","css!DS/ReqProperties/ReqProperties.css"],function(e,t,n,i,r,a,s,o,c,l,d){"use strict";var m=null,h=require("DS/EditPropWidget/facets/Common/FacetsBase");require("DS/EditPropWidget/constants/EditPropConstants");return a.extend(s,h,{init:function(n){m=this,t.set(this),this._parent.apply(this,arguments),this.elements.container||(this.elements.container=e.createElement("div",{styles:{height:"100%","overflow-y":"scroll"},class:"proxy_container"}),this.elements.myControl=new e.Element("label",{html:"<h4>"+d.rich_attr_head+"</h4>",styles:{margin:"10px"}}),this.elements.firstLevel=e.createElement("div",{styles:{height:"100%"},class:"content-data",id:"mainContainer"}),this.elements.myControl.inject(this.elements.container),this.elements.firstLevel.inject(this.elements.container)),console.log("Printing from Rich View Controller"),m=this},onError:function(e){console.log(e)},updateFacet:function(){var e=this;document.getElementById("mainContainer").innerHTML="";var t=this.getModel();t&&("relationship"===t.get("metatype")&&t._attributes.selReferenceID?e.objectId=t.get("selReferenceID"):e.objectId=t.get("objectId")),o.app_initialization(function(){console.log("Hello from utils AppInit")}),e.objectId&&n.getRichContentWithStreaming({id:e.objectId,onComplete:function(t){var n,r,a,s=0;e.options.data=e.objectId,JSON.parse(t).forEach(function(t){for(var i in t)if("csrf"==i&&(e.csrf=t.csrf),"csrf"!=i){for(var o=0;o<t.length;o++)n=t[o].Value,r=t[o].Name,a=t[o].displayName,s++,e._buildView(n,r,s,a);break}}),e._objectRichEditor=new i({selector:".rich-object",target:".content-data",richView:e}),e._objectRichEditor.startEditionForAll(),e._objectRichEditor.defaultEditorOptions.data={objectId:e.objectId,csrf:e.csrf,Property:".PropertyTab"};for(var o=1;o<=s;o++){var c=CKEDITOR.instances["editor"+o];void 0!==c&&c.destroy(),CKEDITOR.inline("editor"+o,e._objectRichEditor.defaultEditorOptions)}},onFailure:function(e,t){var n=l.getParseErrorMessage(null,null,RichViewNls.RichView_Notif_FatalError);c.errorAlert(n)},onTimeout:function(e){var t=l.getParseErrorMessage(e);c.errorAlert(t)}})},_buildView:function(t,n,i,r){m.elements.attrHead=e.createElement("div",{class:"rich-object  right-border","data-physicalid":m.objectId}),m.elements.headingMainDiv=e.createElement("div",{class:"rich-object-header"}),m.elements.attrHead.inject(m.elements.firstLevel),m.elements.spanHead=e.createElement("span"),e.createElement("div",{class:"rich-object-title-editable",Title:n,html:r}).inject(m.elements.spanHead),m.elements.spanHead.inject(m.elements.headingMainDiv),m.elements.bar=e.createElement("div",{class:"rich-object-info",styles:{visibility:"visible"}}),m.elements.bar.inject(m.elements.attrHead),m.elements.headingMainDiv.inject(m.elements.attrHead),m.elements.contentDataDiv=e.createElement("div",{class:"rich-object-body",styles:{width:"100%"}}),m.elements.contentContainer=e.createElement("div",{id:"richcontentid",class:"rich-object-content"}),m.elements.contentManager=e.createElement("div",{class:"rich-object-manager",styles:{width:"100%",display:"flex","flex-direction":"column"}}),m.elements.contentManager.inject(m.elements.attrHead),e.createElement("textarea",{html:t,styles:{width:"50%",display:"inline-block"},id:"editor"+i}).inject(m.elements.contentContainer),m.elements.bar.inject(m.elements.contentDataDiv),m.elements.contentContainer.inject(m.elements.contentDataDiv),m.elements.headingMainDiv.inject(m.elements.contentManager),m.elements.contentDataDiv.inject(m.elements.contentManager)},destroyComponent:function(){e.is(this.destroy,"function")&&this.destroy()}})}),define("DS/ReqProperties/facets/ReqDoc/ReqDocFacet",["UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXAttachmentsUX/AttachmentsPane","DS/TraceableRequirementsUtils/Utils"],function(e,t,n,i,r,a){"use strict";return n.extend(t,i,{_docList:null,init:function(e){this._parent(e),this._initUI()},_initUI:function(){this.elements.container=e.createElement("div",{class:"relatedDocumentsv2"}),this.attachmentsPane=null},updateFacet:function(){var e=this,t=function(t){if(t)if(null===e.attachmentsPane)a.app_initialization(function(){var n=a.getTenantIndex();null==n&&(n=0);var i={parentObject:{parentId:t},connectorOptions:{credentialsPrefName:"trm_security_ctx",fetchSecurityContext:function(){return a.getSecurityContextForProperties()},platformUrls:a.getPlatformServices()[n]}};e.attachmentsPane=new r(i),e.attachmentsPane.inject(e.elements.container)});else{if(!t)return;const n={parentId:t};e.attachmentsPane&&(e.attachmentsPane.show(),e.attachmentsPane.options.parentObject.parentId!==t&&e.attachmentsPane.setParentObject(n))}},n=this.getModel();n.isMergedModel()?t():"relationship"===n.get("metatype")?this.getOccurrence().addEventOnce("onChange:properties",function(){var n=e.getModel();t(n.get("objectId"))}):t(n.get("objectId"))},onRefresh:function(){this.updateFacet()}})});