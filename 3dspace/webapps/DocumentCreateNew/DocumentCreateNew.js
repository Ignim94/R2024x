define("DS/DocumentCreateNew/PLMNewFilesTab/ContextMenu",["UWA/Core","DS/DocumentCreateNew/PLMNewFilesTab/Commands","DS/Menu/Menu"],function(e,t,n){"use strict";return e.Class.extend({init:function(i){var o=this;o.ctrl=i,n.hide();var s=o.options={fetchSecurityContext:function(){return o.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getWorkUnderHeaders:function(){return{}},getSelectedNodes:function(){return o.ctrl.controller.files.treeDocument.getSelectedNodes()},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId,widgetId:widget.id,component:"contextmenu"}},platformUrls:o.ctrl.options.platformServices,events:o.ctrl.events,isFromContextMenu:!0,ctrl:o.ctrl,uaSource:"PLMNewFilesTab"};o.commands=new t(s);var a=o.commands.commands;o.rawItems=[a.RemoveFile]},rawItems:[],selectionChanged:function(){this.promise=this.commands.getWebUXContextMenuItemsForCurrentSelection(this.rawItems,!0)}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/views/Toolbar",["UWA/Core","DS/Tweakers/GeneratedToolbar","DS/DocumentCreateNew/PLMNewFilesTab/Commands","DS/Utilities/Utils"],function(e,t,n,i){"use strict";return e.Class.extend({init:function(e){var t=this;t.ctrl=e,e.toolbar=this,t.selectionChanged=i.debounce(function(){t.commands.selectionChangedForWebUXToolbar(t.GeneratedToolbar)},10),t.ctrl.events.subscribe({event:"selection-add"},function(){t.selectionChanged()}),t.ctrl.events.subscribe({event:"selection-remove"},function(){t.selectionChanged()})},build:function(i){var o=this;let s,a={entries:[]};var r={fetchSecurityContext:function(){return o.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getWorkUnderHeaders:function(){return{}},getSelectedNodes:function(){return o.ctrl.controller.files.treeDocument.getSelectedNodes()},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId,widgetId:widget.id,component:"toolbar"}},platformUrls:o.ctrl.options.platformServices,events:o.ctrl.events,ctrl:o.ctrl,uaSource:"PLMNewFilesTab"};o.commands=new n(r);var l=o.commands.commands;a.entries=[l.RemoveFile,l.UploadFile,l.ViewSwitcher],s=o.ToolbarTreeDocument=t.prototype.createTreeDocument(a);let c=o.GeneratedToolbar=new t({items:s,direction:"horizontal",overflowManagement:"dropdown",executionContext:{}});return o.commands.connectToWebUXToolbar(c),c.inject(i),c},selectionChanged:void 0})}),define("DS/DocumentCreateNew/PLMNewFilesTab/actions/UploadFile",["i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e){"use strict";var t=function(n){return{id:"UploadFile",dataElements:{docV2Private:!0,typeRepresentation:"functionIcon",icon:{iconName:"upload",fontIconFamily:1},label:e.get("Upload"),tooltip:e.get("Upload"),position:"far",category:"fileAction",value:function(e){e.options=n,t.execute(e)},visibleFlag:!0,priority:10},updateForSelection:function(e,t){return!0},execute:function(){t.execute({options:n})}}};return t.execute=function(e){e.options.events.publish({event:"user-wants-filePicker-for-upload",data:void 0})},t}),define("DS/DocumentCreateNew/PLMNewFilesTab/utils/ExtensionUtils",["DS/DocumentFiles/utils/ExtensionUtils"],function(e){"use strict";return{getThumbnail:function(t){return e.getThumbnail(t)},getIcon:function(t){return e.getIcon(t)}}}),define("DS/DocumentCreateNew/PLMNewFilesTab/actions/RemoveFile",["UWA/Core","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t){"use strict";var n=function(i){return{id:"RemoveFile",dataElements:{docV2Private:!0,typeRepresentation:"functionIcon",icon:{iconName:"remove",fontIconFamily:1},label:t.get("Remove"),tooltip:t.get("Remove"),position:"far",category:"fileAction",value:function(e){e.options=i,n.execute(e)},visibleFlag:!1,priority:10},updateForSelection:function(t,n){return new e.Promise(function(e){t({visibleFlag:i.getSelectedNodes().length>0}),e(!0)})},execute:function(){n.execute({options:i})}}};return n.execute=function(e){e.options.getSelectedNodes().forEach(t=>{e.options.ctrl.controller.files.treeDocument.removeRoot(t)})},n}),define("DS/DocumentCreateNew/Utils/TypesUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dictionarys:{},getTypeInfos:function(e){var o=this;return o.Dictionarys[e.tenantUrl]?o.Dictionarys[e.tenantUrl].ready:(o.Dictionarys[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/Dictionary?lang="+widget.lang,{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang,SecurityContext:e.securityContext},timeout:18e4,type:"json",onComplete:function(t){try{o.Dictionarys[e.tenantUrl]._typeInfos=o.formatResult(t.Dictionary.Types,t.Dictionary.Interfaces,t.DictionaryNLS),o.Dictionarys[e.tenantUrl].ready.resolve(o.Dictionarys[e.tenantUrl]._typeInfos),console.info("Dictionary loaded")}catch(t){console.error("Unexpected error when fetching types infos"),console.error(t),o.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("TYPE_INFORMATION_IS_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete o.Dictionarys[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get types infos : "),console.error(t),o.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_TYPE_INFORMATION"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete o.Dictionarys[e.tenantUrl]}}),o.Dictionarys[e.tenantUrl].ready)},formatResult:function(e,t,n){console.time("formatResult");var i=this,o={},s=[];for(var a in e){var r=e[a];if("Document"==r.FirstOOTB&&"Yes"==r.Specialization&&null==r.Deprecated){o[a]||(o[a]={nls:n["Type."+a]||r.Name,icon:r.IconName,parent:r.Parent,childs:[],abstract:r.Abstract,attributes:[],interfaces:{}},s.includes(a)||s.push(a));let t=r.Parent;t&&t.trim().length>0&&(o[t]?o[t].childs.push(a):(o[t]={nls:n["Type."+t]||e[t].Name,icon:e[t].IconName,parent:e[t].Parent,childs:[a],abstract:e[t].Abstract,attributes:[],interfaces:{}},s.includes(t)||s.push(t)));var l=r.Attributes?r.Attributes:{};o[a].attributes=i.extractAttributeDef(l,n,null)}}for(var c in null==o.Document&&(o.Document={nls:n["Type.Document"]||e.Document.Name,icon:e.Document.IconName,parent:e.Document.Parent,childs:[],abstract:e.Document.Abstract,attributes:[],interfaces:{}},s.includes("Document")||s.push("Document")),o.Document.attributes=[],t){var d=n["Interface."+c];"Yes"==t[c].Automatic&&t[c].ScopeTypes&&s.forEach(e=>{t[c].ScopeTypes.includes(e)&&(console.log(e,c),o[e].interfaces[d]=i.extractAttributeDef(t[c].Attributes,n,c))})}return console.timeEnd("formatResult"),o},extractAttributeDef:function(e,t,n){var i=[];for(var o in e){var s=e[o],a={Name:o,nls_Name:null==n?t["Attribute."+o]:t["Attribute."+n+"."+o]||t["Attribute."+o],Type:s.Type,MaxLength:s.MaxLength,MultiValuated:s.MultiValuated,MultiLine:s.MultiLine,Default:s.Default};s.Dimension&&(a.Dimension=s.Dimension),"Yes"==s.HasRangeDefined&&(a.AuthorizedValues=s.AuthorizedValues.map(e=>({label:t["Range."+o+"."+e]?t["Range."+o+"."+e]:e,value:e}))),i.push(a)}return i}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Data",["UWA/Core"],function(e){"use strict";return e.Class.extend({init:function(e){this.ctrl=e}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/views/TilePane",["UWA/Core","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewTreeDocumentModelProvider"],function(e,t,n){"use strict";return e.Controls.Abstract.extend({name:"enox-plmNewFilesTab-tilepane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.tilePane=this,this._parent({})},build:function(i){var o=this;o.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});let s=n.inherit({name:"FileTileViewTreeDocumentModelProvider",getPropertyValue:function(e,t){return"subLabel"===t?e.options.subLabel.cloneNode(!0):this._parent(e,t)}});o.rcv=this.ctrl.tilesRCV=new t({model:o.ctrl.controller.files.treeDocument,useDragAndDrop:!1,shouldCellAllowUnsafeHTMLContentAt:function(e,t){return["subtitle","description"].includes(t)},displayedOptionalCellProperties:["contextualMenu","description","activeFlag"],onDropBlank:function(e,t){e.preventDefault(),e.stopPropagation(),o.ctrl.dndManager.handleDrop(e),this.onDropBlankDefault(e,t)},displayPropertiesTooltip:!1}).inject(o.elements.container),o.rcv.modelProvider=new s,o.rcv.getContextualMenu=function(e,t,n){return[""]},o.rcv.onContextualEvent={callback:function(e){return e&&e.cellInfos?(o.ctrl.contextMenu.selectionChanged(),o.ctrl.contextMenu.promise):(e.cellCtxMenuRequired,[])}},o.rcv.onSelectionAdd(function(e,t){o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-add",data:e}),o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:e})}),o.rcv.onSelectionRemove(function(e,t){o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-remove",data:e}),o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:e})}),o.inject(i)}})}),define("DS/DocumentCreateNew/Utils/DimensionUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dimensions:{},getDimensions:function(e){var o=this;return o.Dimensions[e.tenantUrl]?o.Dimensions[e.tenantUrl].ready:(o.Dimensions[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/dimensions",{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:e.securityContext},timeout:18e4,type:"json",onComplete:function(t){try{var n={};t.results.forEach(function(e){e.Units.forEach(function(t){e.MKSUnit==t.Name&&(n[e.Name]=t.NLSName)})}),o.Dimensions[e.tenantUrl]._dimensions=n,o.Dimensions[e.tenantUrl].ready.resolve(o.Dimensions[e.tenantUrl]._dimensions),console.info("Dimensions loaded")}catch(t){console.error("Unexpected error when fetching dimensions"),console.error(t),o.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("DIMENSIONAL_ATTRIBUTES_ARE_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete o.Dimensions[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get dimensions : "),console.error(t),o.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete o.Dimensions[e.tenantUrl]}}),o.Dimensions[e.tenantUrl].ready)}})}),define("DS/DocumentCreateNew/Utils/Credentials",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.Class.singleton({init:function(){},credentials:{},getCredentialsList:function(e){var o=this;if(o.credentials[e.tenantUrl+e.tenant])return o.credentials[e.tenantUrl+e.tenant].ready;o.credentials[e.tenantUrl+e.tenant]={ready:t.deferred()};var s=[],a=e.tenantUrl+"/resources/modeler/pno/person?current=true";return a+="&select=preferredcredentials&select=collabspaces",a+="&tenant="+e.tenant,n.authenticatedRequest(a,{method:"GET",type:"json",onComplete:function(t){s=[],[];var n=!1;if(t.collabspaces&&t.collabspaces.length>0)for(var i=void 0,a=0;a<t.collabspaces.length;a++)for(var r=0;r<t.collabspaces[a].couples.length;r++){var l=t.collabspaces[a].couples[r];null==i&&(i=l.organization.name),i!=l.organization.name&&(n=!0);var c=l.role.name+"."+l.organization.name+"."+t.collabspaces[a].name;t.collabspaces[a].title||(t.collabspaces[a].title=t.collabspaces[a].name),l.organization.title||(l.organization.title=l.organization.name),l.role.nls||(l.role.nls=l.role.name);var d=t.collabspaces[a].title+" ● "+l.organization.title+" ● "+l.role.nls,u=t.collabspaces[a].title+" ● "+l.role.nls;s.push({value:c,withorg_nls:d,withoutorg_nls:u,collabspaceTitle:t.collabspaces[a].title})}o.credentials[e.tenantUrl+e.tenant].ready.resolve(s.sort(function(e,t){return n?e.withorg_nls<t.withorg_nls?-1:e.withorg_nls>t.withorg_nls?1:0:e.withoutorg_nls<t.withoutorg_nls?-1:e.withoutorg_nls>t.withoutorg_nls?1:0}).map(function(e){return{label:n?e.withorg_nls:e.withoutorg_nls,value:e.value}})),console.info("Credentials loaded")},onFailure:function(t){console.error("Failed to get credentials:",t),o.credentials[e.tenantUrl+e.tenant].ready.reject({subtitle:i.get("FAILED_TO_FETCH_CREDENTIALS"),message:err.message||err,error:err})}}),o.credentials[e.tenantUrl+e.tenant].ready},addCredentialList:function(e,n){this.credentials[e.tenantUrl+e.tenant]={ready:t.deferred()},this.credentials[e.tenantUrl+e.tenant].ready.resolve(n)}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/EventHandler",["UWA/Core"],function(e){"use strict";return e.Class.extend({init:function(e){this.ctrl=e},connect:function(e,t,n,i){var o=this;this.ctrl.events.addEventListener("user-dropped-files",function(e){for(var n=e.files.length>0?e.files:[],i=[],o=0;o<n.length;o++)i.push(n[o]);t.files.addFiles(i,"PLMNewFilesTab")}),this.ctrl.events.addEventListener("user-selects-files-for-upload",function(e){t.files.addFiles(e.files,"PLMNewFilesTab")}),this.ctrl.events.addEventListener("user-wants-filePicker-for-upload",function(t){require(["DS/DocumentCommands/V2/FileActions/UploadFile"],function(t){(new t).filesProvider(e,e=>{for(var t=e.target.files.length>0?e.target.files:e.dataTransfer.files,n=[],i=0;i<t.length;i++)n.push(t[i]);o.ctrl.events.publish({event:"user-selects-files-for-upload",data:{cancelled:!1,files:n}})})})}),this.ctrl.events.addEventListener("docv2-show-notification",function(e){t.helper.showNotification(e.level,e.title,e.subtitle,e.message,e.sticky,e.allowUnsafeHTML)}),this.ctrl.events.addEventListener("enox-plmNewFilesTab-collection-count-changed",function(e){t.switchView(t.view)}),this.ctrl.events.addEventListener("enox-plmNewFilesTab-node-selection-changed",function(e){n.selectionChanged()}),this.ctrl.events.addEventListener("enox-plmNewFilesTab-switch-view",function(e){t.switchView(e)})}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/utils/DnDManager",["DS/DataDragAndDrop/DataDragAndDrop"],function(e){"use strict";return function(t){var n={init:function(t){this.ctrl=t;var i=t.uploadPane.elements.container,o=t.gridPane.elements.container,s=t.getClassNames("-drag-over"),a={drop:function(e,i,o){t.options.readonly||(t.elements.content.removeClassName(s),n.handleDrop(o))},enter:function(e,n){t.options.readonly||t.elements.content.addClassName(s)},over:function(e,n){t.options.readonly||t.elements.content.addClassName(s)},leave:function(e,n){t.options.readonly||t.elements.content.removeClassName(s)}};e.droppable(i,a),e.droppable(o,a),t.dndManager=this},handleDrop:function(e){t.options.readonly||e.dataTransfer.files&&e.dataTransfer.files.length>0&&t.events.publish({event:"user-dropped-files",data:{cancelled:!1,files:e.dataTransfer.files}})}};return n.init(t),n}}),define("DS/DocumentCreateNew/PLMNewDocumentCmd",["UWA/Core","DS/ENONewWidget/command/NewContentCommandBase","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return t.extend({defaults:{type:"Document"},init:function(e){this._parent(e)},getType(){return this.defaults.type},execute:function(){this.launchCreationDialog()},launchCreationDialog:function(){var e=this.getCreateOptions({});this.launchCreateNew(e)},getHeaders:function(t){let i={},o=n.get();var s=e.is(o)&&e.is(o.change.id)?o.change.id:null;return i=""!=s?{SecurityContext:t,"DS-Change-Authoring-Context":"pid:"+s}:{SecurityContext:t}},getOptions:function(e){return console.log(e),{options:{typeName:"Document",preferedType:this.options.preferedType},context:{serviceBaseUrl:this.options.serviceBaseUrl,tenant:this.options.tenant,header:this.getHeaders(this.options.securityContext),getENONewContext:function(){return{}}},events:this.options.callbacks,viewType:"tabView",labelTopBar:i.get("NewDocument"),facets:[{name:"filesFacet",facetoptions:{}},{name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}],notification:!1}}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Columns",["UWA/Core","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t){"use strict";return e.Class.extend({ready:void 0,predefinedColumns:[{name:"title",includeAlways:!0,typeRepresentation:"string",dataIndex:"tree",pinned:"left"},{name:"comments",typeRepresentation:"string",includeAlways:!0,readonly:"false",editableFlag:!0}],predefinedColumnsDictionary:void 0,customColumnsSelectableDictionary:void 0,customColumnsDictionary:void 0,customColumns:void 0,init:function(n){var i=this;i.ready=e.Promise.deferred(),i.predefinedColumnsDictionary={},i.customColumnsSelectableDictionary={},i.customColumnsDictionary={},i.customColumns=[],i.predefinedColumnsDictionary={},i.predefinedColumns.forEach(e=>{e.text=t.get("e6wFileField."+e.name),e.typeRepresentation&&(null==e.dataIndex&&(e.dataIndex=e.name),i.predefinedColumnsDictionary[e.name]=e)})},getColumns:function(){return[...this.predefinedColumns.filter(e=>e.typeRepresentation)]}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/views/UploadPane",["UWA/Core","UWA/Controls/Abstract","DS/Utilities/Dom","DS/Controls/Button","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i,o){"use strict";return t.extend({name:"enox-plmNewFilesTab-upload-pane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.uploadPane=this,this._parent({})},build:function(t){var s=this;this.elements.container=e.createElement("div",{class:s.ctrl.getClassNames("-uploadpane")});var a=e.createElement("div",{class:s.ctrl.getClassNames("-uploadpane-center")});(a.inject(this.elements.container),s.ctrl.options.readonly)?e.createElement("span",{class:s.ctrl.getClassNames("-uploadpane-center-msg"),text:o.get("NO_FILES_ATTACHED")}).inject(a):(n.generateIcon({iconName:"drag-drop",fontIconSize:"2x"}).inject(a),e.createElement("span",{class:s.ctrl.getClassNames("-uploadpane-center-msg"),text:o.get("DROP_A_FILE_OR")}).inject(a),s.uploadButton=new i({label:o.get("UPLOAD_FILE"),emphasize:"primary"}),s.uploadButton.addEventListener("buttonclick",function(){s.ctrl.events.publish({event:"user-wants-filePicker-for-upload",data:void 0})}),s.uploadButton.inject(a));s.inject(t)},show:function(){this.elements.container.show()},hide:function(){this.elements.container.hide()}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/utils/Helper",["UWA/Core","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return function(o){var s={showNotification:function(e,i,s,a,r,l){var c={level:e,title:i,subtitle:s,message:a,sticky:r,allowUnsafeHTML:l||!1};o.notifs||(o.notifs=n,t.setNotificationManager(o.notifs),t.setStackingPolicy(5)),o.notifs.addNotif(c)},debounce:function(e,t,n){var i=null,o=[];return function(){if(n){for(var s=[],a=0;a<arguments.length;++a)s.push(arguments[a]);o.push(s)}i&&clearTimeout(i);var r=arguments;i=setTimeout(function(){t.apply(n?{data:o}:null,r),o=[],i=null},e)}},getUniqueToken:function(){return(new Date).getTime()+Math.random().toString(36).substring(2,10)},ensureUploadCompletion:function(e,t,n){return t&&0!=t.length?0==(t=t.filter(e=>e.name!=n.dataelements.title)).length&&e.resolve():e.resolve(),t},ensureUniqueFiles:function(e,t){return e.filter(e=>{const n=t.some(t=>t.options.grid.title==e.name);return n&&o.alert.add({className:"error",message:i.get("File_Exist_Error",{fileName:e.name})}),!n})},saveViewMode:function(t){var n=localStorage.getItem("ENOXPLMNewFilesUXViewMode");(n=e.Json.isJson(n)?JSON.parse(n):{})["PLMNewFilesTab_"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)]=t,localStorage.setItem("ENOXPLMNewFilesUXViewMode",JSON.stringify(n))},loadViewMode:function(){var t=localStorage.getItem("ENOXPLMNewFilesUXViewMode");if(e.Json.isJson(t)){var n=(t=JSON.parse(t))["PLMNewFilesTab_"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)];return"tile"==n||"grid"==n?n:"tile"}return"tile"}};return s.ctrl=o,o.helper=s,s}}),define("DS/DocumentCreateNew/PLMNewFilesTab/actions/ViewSwitcher",["DS/Tweakers/TypeEnums","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t){"use strict";var n=function(n){var i=n.ctrl.controller.view,o=e.Layout.SmallTile;return"grid"==i?o=e.Layout.DataGridView:"tile"==i&&(o=e.Layout.SmallTile),{id:"ViewSwitcher",dataElements:{docV2Private:!0,typeRepresentation:"layout",tooltip:t.get("SwitchView"),value:o,possibleValues:[e.Layout.DataGridView,e.Layout.SmallTile],position:"far",category:"stable area",visibleFlag:!0,priority:10},updateForSelection:function(e,t){return!0},onNodeUpdate:function(t){var i="",o=t.getAttributeValue("data").value;o===e.Layout.DataGridView.value?i="grid":o===e.Layout.SmallTile.value&&(i="tile"),n.events.publish({event:"enox-plmNewFilesTab-switch-view",data:i})},extend:function(e,t){}}};return n.execute=function(e,t){},n}),define("DS/DocumentCreateNew/Views/CreateForm",["UWA/Core","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/FilePicker","DS/Controls/Accordeon","DS/DataGridView/DataGridView","DS/Tweakers/TweakerArray","DS/Tweakers/TweakerNumber","DS/Tweakers/TweakerDate","DS/Tweakers/TweakerBoolean","DS/Tweakers/TweakerString","DS/Controls/TooltipModel","DS/Controls/SelectionChipsEditor","DS/Controls/Popup","DS/Windows/ImmersiveFrame","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,m,g,f,h){"use strict";var w=e.Controls.Abstract.extend({init:function(e){this._parent(e),this.buildSkeleton()},buildSkeleton:function(){var e=this,t=this.options.fields;w.doctypesList=this.options.doctypes,w.dimensions=this.options.dimensions,w.elements={},w.events=this.options.events,t.forEach(function(t){"header"==t.type?e.buildHeader(t):"accordeon"==t.type?e.buildAccordeon(t):"grid"==t.type?e.buildGrid(t):e.createInputField(t,e.options.container)})},createInputField:function(s,a){var g=e.createElement("div",{class:"form-group",styles:{display:s.display}}).inject(a),f=e.createElement("label",{text:s.label,attributes:{for:s.settings.domId},styles:{display:s.display}}).inject(g);s.settings.requiredFlag&&e.createElement("span",{class:"label-field-required"}).inject(f).setHTML(' <i class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-required "></i>');var h=null;if("block"==s.display){switch(s.type){case"text":h=new n(s.settings).inject(g);break;case"combobox":h=new i(s.settings).inject(g);break;case"textarea":h=new t(s.settings).inject(g);break;case"file":h=new o(s.settings).inject(g);break;case"multi":s.settings&&"string"==s.settings.valueType?h=new m({value:[],placeholder:"Type a unique value",uniqueValue:!0,maxLength:s.settings.maxLength}).inject(g):s.settings&&"date"==s.settings.valueType?(s.settings.allowMultipleValuesFlag=!0,(h=new c(s.settings).inject(g)).getContent().setAttribute("id",s.settings.domId)):(h=new r(s.settings).inject(g)).getContent().setAttribute("id",s.settings.domId);break;case"multirange":s.settings&&(h=new u({value:[],allowMultipleValuesFlag:!0,possibleValues:s.settings.possibleValues}).inject(g));break;case"number":h=new l(s.settings).inject(g);break;case"date":h=new c(s.settings).inject(g);break;case"boolean":h=new d(s.settings).inject(g)}if(null!=h){var v=h.elements.container.dsModel.value;if(e.is(h.elements.container.dsModel.selectedIndex,"number")&&(v=h.elements.container.dsModel.currentLabel),h.tooltipInfos=new p({shortHelp:v}),w.elements[s.settings.domId]=h.elements.container.dsModel,s.additionalAttributes)for(var D in s.additionalAttributes)"combobox"==s.type||"text"==s.type||"multirange"==s.type?h.getContent().setAttribute(D,s.additionalAttributes[D]):h.getContent().children&&h.getContent().children[0]&&h.getContent().children[0].setAttribute(D,s.additionalAttributes[D]);if(s.events){for(var D in s.events)h.addEventListener(D,s.events[D]);"file"==s.type&&(h.value=s.settings.blob)}}}},buildHeader:function(t){e.createElement("p",t).inject(this.options.container)},buildAccordeon:function(t){var n=this,i={style:t.styles,exclusive:t.exclusive,domId:t.domId},o=[];t.items.forEach(function(e){o.push(n.buildItem(e.id,e.header,e.content))}),i.items=o;var a=e.createElement("div",{class:"attribute-accordeon",styles:{display:t.display}}).inject(this.options.container),r=new s(i).inject(a);r.addEventListener("expand",function(e){e.dsModel.updateItem(0,{header:h.get("Show_less")})}),r.addEventListener("collapse",function(e){e.dsModel.updateItem(0,{header:h.get("Show_more")})}),w.elements[t.domId]=r,this.appendDynamicAttributes(w.elements.ENOX_Document_Type.value,r)},buildGrid:function(t){let n=t.treeDocument.getRoots().length;n>9&&(n=9);var i=e.createElement("div",{class:"multifile-grid",styles:{display:t.display,height:24*n+"px"}}).inject(this.options.container),o=new a(t),s=new f;s.setContentInBackgroundLayer(o.getContent()),s.reactToPointerEventsFlag=!1,s.inject(i)},buildItem:function(t,n,i){var o=this,s=e.createElement("div",{class:"item-sections",id:t}),a={header:n};return i.forEach(function(e){o.createInputField(e,s)}),a.content=s,a},getFielfDef:function(t){var n={settings:{},additionalAttributes:{},events:{}};return n.label=t.nls_Name,n.display="block",n.settings.domId=t.Name.replace(" ","_"),t.Default&&(n.settings.value=t.Default),n.additionalAttributes.Style="width:100%;",n.events=w.events,t.requiredFlag&&(n.settings.requiredFlag=t.requiredFlag),t.pattern&&(n.settings.pattern=t.pattern),t.AuthorizedValues&&"No"==t.MultiValuated?(n.type="combobox",n.settings.elementsList=t.AuthorizedValues,n.settings.enableSearchFlag=!0,n.settings.popupSizeAdjustPolicy=g.SizeAdjustPolicyEnum.AdjustToVisibleContents):t.AuthorizedValues&&"Yes"==t.MultiValuated?(n.type="multirange",n.settings.valueType=t.Type.toLowerCase(),n.settings.possibleValues=t.AuthorizedValues.filter(e=>""!=e.value)):"Yes"==t.MultiValuated?(n.type="multi",n.settings.itemEditionTrigger="in place",n.settings.valueType=t.Type.toLowerCase(),isNaN(parseInt(t.MaxLength))||(n.settings.maxLength=parseInt(t.MaxLength)),t.Dimension&&(n.label+=" (in "+w.dimensions[t.Dimension]+")")):"Integer"==t.Type||"Double"==t.Type||"Real"==t.Type?(n.type="number","Integer"==t.Type&&(n.settings.stepValue=1),t.Dimension&&(n.settings.units=w.dimensions[t.Dimension])):"Date"==t.Type?(n.type="date",e.is(t.Default,"string")&&""!=t.Default?n.settings.value=new Date(1e3*t.Default):""==t.Default&&(n.settings.value=void 0)):"Boolean"==t.Type?(n.type="boolean",null==n.settings.value&&(n.settings.value=!1)):t.MultiLine&&"Yes"==t.MultiLine?(n.type="textarea",n.settings.newLineMode="enter",n.settings.nbRows=5,n.settings.maxLength=t.MaxLength):(n.type="text",n.settings.selectAllOnFocus=!0,n.settings.displayClearFieldButtonFlag=!0,isNaN(parseInt(t.MaxLength))||(n.settings.maxLength=parseInt(t.MaxLength))),n}});return w.prototype.appendInheritedAttributes=function(e,t){if(w.doctypesList[e]&&"DOCUMENTS"!=w.doctypesList[e]){var n=w.doctypesList[e].attributes;n&&n.length>0&&n.forEach(function(e){t.attributes.unshift(e)});var i=w.doctypesList[e].interfaces;if(i)for(const e in i)if(Object.hasOwnProperty.call(i,e)){const n=i[e];t.attributes.push(...n)}this.appendInheritedAttributes(w.doctypesList[e].parent,t)}},w.prototype.appendDynamicAttributes=function(t,n){var i=this,o={attributes:[]};n.updateItem(0,{header:h.get("Show_more")}),i.appendInheritedAttributes(t,o);var s=n.items[n.items.length-1];if(o.attributes.length>0){var a=e.createElement("div",{class:"item-sections",id:"DCN_CustomAttributes"}).inject(s.content);w.elements.DCN_CustomAttributes=a,o.attributes.forEach(function(e){var t=i.getFielfDef(e);i.createInputField(t,a)})}n.clear(),n.addItem(s)},w}),define("DS/DocumentCreateNew/PLMNewFilesTab/views/Topbar",["UWA/Core","DS/DocumentCreateNew/PLMNewFilesTab/views/Toolbar"],function(e,t){"use strict";return e.Controls.Abstract.extend({name:"enox-plmNewFilesTab-topbar",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this._parent({})},build:function(n){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.elements.toolbar=new t(this.ctrl),this.elements.toolbar.build(this.elements.container),this.elements.container.inject(n)},updateToolbar:function(){this.elements.toolbar.selectionChanged()}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/Commands",["UWA/Core","DS/DocumentCreateNew/PLMNewFilesTab/actions/RemoveFile","DS/DocumentCreateNew/PLMNewFilesTab/actions/UploadFile","DS/DocumentCreateNew/PLMNewFilesTab/actions/ViewSwitcher","DS/DocumentCommands/V2/ConvertCmdToWebUX"],function(e,t,n,i,o){"use strict";return e.Class.extend({init:function(e){this.commands={RemoveFile:new t(e),UploadFile:new n(e),ViewSwitcher:new i(e)}},commands:[],connectToWebUXToolbar:function(e){e.items.prepareUpdate(),e.items.getRoots().forEach(e=>{e.options.docV2Private&&e.options.extend&&e.options.extend(e)}),e.items.pushUpdate()},selectionChangedForWebUXToolbar:function(e){e.items.getRoots().forEach(e=>{e.options.docV2Private&&(e.options.grid.action=e,e.options.updateForSelection&&e.options.updateForSelection(function(t){e.updateOptions(t)}))})},getWebUXContextMenuItemsForCurrentSelection:function(t,n){return new e.Promise(function(i,s){var a=[],r=t[0].dataElements.category,l=[!0];t.forEach(t=>{if(t.updateForSelection){var n=t.updateForSelection(function(n){t.dataElements=e.extend(t.dataElements,n,!0)});l.push(n)}else l.push(!0)}),e.Promise.all(l).then(function(e){t.forEach(e=>{e.dataElements.visibleFlag&&(n&&r!=e.dataElements.category&&a.push({type:"SeparatorItem"}),a.push(o([e])[0]),r=e.dataElements.category)}),i(a)})})}})}),define("DS/DocumentCreateNew/CreateNew",["UWA/Core","DS/UIKIT/Mask","DS/DocumentManagement/DocumentManagement","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/DocumentCreateNew/Views/CreateForm","DS/DocumentCreateNew/Utils/TypesUtils","DS/DocumentCreateNew/Utils/DimensionUtils","DS/DocumentCreateNew/Utils/Credentials","DS/Controls/Loader","DS/Controls/ModalContainer","UWA/Promise","DS/DocumentCommonInfra/TrackerAPI","DS/DocumentFiles/data/Model","css!DS/DocumentCreateNew/DocumentCreateNew"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,m,g,f,h,w){"use strict";var v={},D=e.Controls.Abstract.extend({name:"doco-create-new2",options:{className:""},init:function(t){var n=this;this._parent(t),widget&&widget.app&&widget.app.jobs&&"doco-jobs"==widget.app.jobs.name&&widget.app.progressPane&&"doco-progress"==widget.app.progressPane.name?(v=widget.app).jobs.MAX_PARALLEL_JOBS=1:(null==v.jobs&&require(["DS/DocumentCommands/Jobs"],function(e){null==v.jobs&&(v.jobs=new e(v),v.jobs.MAX_PARALLEL_JOBS=1)}),null==v.progressPane&&require(["DS/DocumentCommands/ProgressPane"],function(e){null==v.progressPane&&(v.progressPane=new e(v),v.progressPane.inject(widget.body))})),D.selectedFiles=[],null==t.credentialsPrefName&&(t.credentialsPrefName="credentials"),null==this.options.containerToOverlay&&(this.options.containerToOverlay=widget.body),t.securityContext&&t.securityContext.startsWith("ctx::")&&(this.options.securityContext=t.securityContext.replace("ctx::",""));var i=widget.getPreference(t.credentialsPrefName);i?(D.credentials=i.options.map(function(e){return{label:e.label,value:e.value.startsWith("ctx::")?e.value.replace("ctx::",""):e.value}}),p.addCredentialList(t,D.credentials)):p.getCredentialsList(t).promise.then(function(e){D.credentials=e}),window.documentDictionaryLoadStart=new Date,u.getDimensions(t).promise.then(function(e){D.dimensions=e},function(e){console.error("CreateNew: Failed to load Dimensions",e)}),d.getTypeInfos(t).promise.then(function(e){D.docTypesList=e},function(e){console.error("CreateNew: Failed to load Types",e)}),this.elements.container=e.createElement("div",{class:this.getClassNames()}),n.loader=new m({text:s.get("LOADING"),showButtonFlag:!0}),n.loader.canceller=f.deferred(),n.loader.elements.stopButton.addEventListener("buttonclick",function(e){n.loader.canceller.reject("usercancelled")})},generateForm:function(){var e=this;this.startLoading();var t=D.selectedFiles.length>1,n=function(t){e.valueChanged(t,e)};new c({doctypes:D.docTypesList,dimensions:D.dimensions,container:this.elements.container,events:{change:n},fields:[{type:"header",class:"header1",text:s.get("Head_Info_1").replace("{nbFiles}",D.selectedFiles.length),styles:{display:t?"block":"none"}},{type:"header",class:"header2",text:s.get("Head_Info_2"),styles:{display:t?"block":"none"}},{type:"text",label:s.get("Title"),display:t?"none":"block",settings:{domId:"Title",selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,requiredFlag:!0,pattern:".*\\S+.*"},additionalAttributes:{Style:"width:100%;"},events:{change:n,uncommittedChange:n}},{type:"combobox",label:s.get("Document_Type"),display:"block",settings:{domId:"ENOX_Document_Type",elementsList:e.filteredTypes,selectedIndex:widget.getPreference("lastSelected")?widget.getPreference("lastSelected").defaultValue:0,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:function(t){e.docTypeChanged(t,e)}}},{type:"file",label:s.get("File"),display:t?"none":"block",settings:{domId:"file",blob:D.selectedFiles[0],width:"100%",requiredFlag:!0},events:{change:e.fileChanged}},{type:"combobox",label:s.get("Credentials"),display:"block",settings:{domId:"credentials",elementsList:D.credentials,selectedIndex:0,value:e.options.securityContext,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"accordeon",items:[{doctypeDefault:"Document",id:"ShowMore",header:s.get("Show_more"),content:[{type:"textarea",display:t?"none":"block",label:s.get("Description"),settings:{domId:"Description",newLineMode:"enter",nbRows:5},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"text",display:t?"none":"block",label:s.get("Collaborative_Policy"),settings:{domId:"Policy",value:s.get("Policy_Name"),disabled:!0},additionalAttributes:{Style:"width:100%;"}}]}],styles:"simple",exclusive:!1,domId:"accordeon",display:t?"none":"block"},{type:"grid",display:t?"block":"none",identifier:"selectedFilesListId",treeDocument:e.generategridTree(D.selectedFiles),columns:[{text:s.get("Title"),dataIndex:"name",typeRepresentation:"string",alignment:"near",width:"100%",minWidth:"30",height:"150",alwaysVisibleFlag:!0,editableFlag:!1}],cellSelection:"none",rowSelection:"none",selectionBehavior:{selectNodeModelOnCellSelection:!1},showBackgroundFlag:!0,columnDragEnabledFlag:!1,showSelectionCheckBoxesFlag:!1,defaultColumnDef:{minWidth:30,width:"auto",sortableFlag:!0},layoutOptions:{columnsHeader:!0,rowsHeader:!1}}]}),e.finishLoading()},startLoading:function(){t.mask(this.elements.container)},finishLoading:function(){t.unmask(this.elements.container)},docTypeChanged:function(e,t){try{t.valueChanged(e,t);var n=c.elements.DCN_CustomAttributes;n&&n.remove(),c.prototype.appendDynamicAttributes(e.dsModel.value,c.elements.accordeon),widget.addPreference({name:"lastSelected",type:"hidden",defaultValue:e.dsModel.selectedIndex})}catch(e){console.error(e)}},fileChanged:function(e){let t=e.dsModel.value,n=t.name;D.selectedFiles.length=0,D.selectedFiles.push(t),n=-1==n.indexOf(".")?n:n.substring(0,n.lastIndexOf(".")),c.elements.Title&&(c.elements.Title.value.length>0?c.elements.Title.value=n:(c.elements.Title.value=n,c.elements.Title._giveFocus()))},generategridTree:function(){var e=new i;e.prepareUpdate();for(var t=0;t<D.selectedFiles.length;t++){var n=D.selectedFiles[t];e.addRoot(new o({label:n.name,grid:{name:n.name}}))}return e.expandAll(),e.pushUpdate(),e},addChilds:function(e,t,n,i){var o=this,s=D.docTypesList[e].childs;s&&s.forEach(function(s){var a={label:D.docTypesList[s].nls,icon:D.docTypesList[s].icon,value:s};t.includes(s)||i.includes(e)||"No"!=D.docTypesList[e].abstract||(n.unshift(a),i.push(e),o.addChilds(s,t,n,i))})},filterTypes:function(){var e=[],t=this.options.supportedTypes;if(!t||!t.includedTypes&&!t.excludedTypes){Object.keys(D.docTypesList).forEach(function(t){"No"==D.docTypesList[t].abstract&&e.unshift({label:D.docTypesList[t].nls,icon:D.docTypesList[t].icon,value:t})});var n=e.findIndex(e=>"Document"===e.value);if(n>0){var i=e.splice(n,1);e.unshift(i[0])}return e}var o=[];for(var s in D.docTypesList){var a={label:D.docTypesList[s].nls,icon:D.docTypesList[s].icon,value:s};!t.includedTypes.includes("*")&&!t.includedTypes.includes(s)||t.excludedTypes.includes(s)||o.includes(s)||"No"!=D.docTypesList[s].abstract||(e.unshift(a),o.push(s),this.addChilds(s,t.excludedTypes,e,o))}return e},appendInheritedAttributes:function(t,n){if(D.docTypesList[t]){var i=D.docTypesList[t].attributes;i&&i.length>0&&i.forEach(function(e){n.attributes.unshift(e)});var o=D.docTypesList[t].interfaces;o&&e.merge(n.deploy_interfaces,o),this.appendInheritedAttributes(D.docTypesList[t].parent,n)}},formatInputValues:function(e){var t=void 0;if(Array.isArray(e)){var n=[];e.forEach(function(e){n.push(e instanceof Date?e:e.toString())}),n.length>0&&(t=n)}else null!=e&&(t=e instanceof Date?e:e.toString());return t},createAndUpload:function(e){var t=this,n=D.selectedFiles.length>1;if(n||!n&&c.elements.Title&&c.elements.Title.value.trim().length>0){var i=c.elements.ENOX_Document_Type.value,o={},s={attributes:[]};c.prototype.appendInheritedAttributes(i,s),s.attributes.forEach(function(e){var n=t.formatInputValues(c.elements[e.Name.replace(" ","_")].value);n&&(o[e.Name]=n)}),D.selectedFiles.length>0?D.selectedFiles.forEach(e=>{var s={title:n?-1==e.name.indexOf(".")?e.name:e.name.substring(0,e.name.lastIndexOf(".")):c.elements.Title.value,type:i,description:n?"":c.elements.Description.value,custom_attributes:o,fileInfo:{file:e}};t.options.connector?(t.options.parentObject.parentId&&(s.relInfo={parentId:t.options.parentObject.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.options.connector.uploadAttachment(s,t.options.parentObject,c.elements.credentials.value)):(t.options.parentId&&(s.relInfo={parentId:t.options.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.uploadDocument(s,{tenant:t.options.tenant,securityContext:c.elements.credentials.value,documentType:c.elements.ENOX_Document_Type.value,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders}))}):this.uploadDocument({title:n?"":c.elements.Title.value,description:n?"":c.elements.Description.value},{tenant:t.options.tenant,securityContext:c.elements.credentials.value,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders}),e.close(),e.destroy(),t.options.onUploadStart&&t.options.onUploadStart()}else n||0!=c.elements.Title.value.trim().length||c.elements.Title.getContent().getParent().addClassName("has-error"),0==D.selectedFiles.length&&widget.getElement("#DCN_uploadBtn").dsModel.getContent().addClassName("has-error")},create:function(t){var n=this;g.createModal(n.options.containerToOverlay,this.loader.elements.container),n.loader.on(s.get("LOADING"));for(var i=0;i<t.length;i++)D.selectedFiles.push(t[i]);var o=new e.Promise(function(t,i){e.Promise.all([p.getCredentialsList(n.options).promise,d.getTypeInfos(n.options).promise,u.getDimensions(n.options).promise]).then(function(e){t(e)},function(e){i(e)})}),c=this.loader.canceller.promise;e.Promise.race([o,c]).then(function(e){var i,o,c=new Date-window.documentDictionaryLoadStart;if(n.options.connector?n.options.parentObject.parentId&&(i=n.options.parentObject.parentId,o=n.options.parentRelName):n.options.parentId&&(i=n.options.parentId,o=n.options.parentRelName),h.sendTrackerPageEvent({category:"docm.document.upload.ready",action:"click/drop",label:"Document Upload Ready",pd:{parentId:i,parentRelName:o},pv:{totalTimeTaken:c,success:1}}),n.loader.on(s.get("LOADING")),g.removeModal(n.options.containerToOverlay),D.credentials=e[0],D.docTypesList=e[1],D.dimensions=e[2],console.log(D.docTypesList),n.filteredTypes=n.filterTypes(),0==n.filteredTypes.length)n.options.onError&&n.options.onError({subtitle:s.get("INVALID_CONFIGURATION"),message:s.get("NO_DOCUMENT_TYPES_ALLOWED")});else{var d=!1;n.generateForm(),n.dialog=new a({title:s.get("Upload")+(t.length>1?" "+t.length+" - "+s.get("files"):""),content:n.getContent(),immersiveFrame:n.options.immersiveFrame,resizableFlag:!0,width:"500",modalFlag:!0,buttons:{Cancel:new r({label:s.get("Cancel"),onClick:function(e){e.dsModel.dialog.close(),e.dsModel.dialog.destroy(),n.options.onCancel&&n.options.onCancel()},tooltipInfos:new l({title:s.get("Cancel"),mouseRelativePosition:!1})}),Ok:new r({label:s.get("Upload"),emphasize:"primary",domId:"DCN_uploadBtn",onClick:function(e){d=!0,n.createAndUpload(e.dsModel.dialog)},tooltipInfos:new l({title:s.get("Upload"),mouseRelativePosition:!1})})}}),n.dialog.elements._modalDiv.addClassName("document-createNew-modal"),n.dialog.addEventListener("close",function(){d||n.options.onCancel()})}},function(e){var t,i,o=new Date-window.documentDictionaryLoadStart;n.options.connector?n.options.parentObject.parentId&&(t=n.options.parentObject.parentId,i=n.options.parentRelName):n.options.parentId&&(t=n.options.parentId,i=n.options.parentRelName),h.sendTrackerPageEvent({category:"docm.document.upload.ready",action:"click/drop",label:"Document Upload Ready",pd:{parentId:t,parentRelName:i},pv:{totalTimeTaken:o,failure:0}}),n.options.onError&&"usercancelled"!=e&&n.options.onError(e),n.options.onCancel&&"usercancelled"==e&&n.options.onCancel(),g.removeModal(n.options.containerToOverlay)})},selectFilesAndCreate:function(){var t=this,n=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(e){var i=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;t.create(i),n.destroy()}}}).inject(document.body);n.click()},valueChanged:function(t,n){var i=t.dsModel.value;(e.is(t.dsModel.selectedIndex,"number")&&(i=t.dsModel.currentLabel),t.dsModel.tooltipInfos.shortHelp=i,t.dsModel._properties)&&(t.dsModel._properties.requiredFlag&&n.validateInputs(t))},validateInputs:function(t){if(this.dialog&&this.dialog.buttons&&this.dialog.buttons.Ok&&this.dialog.buttons.Ok.getModel()){var n=this.dialog.buttons.Ok.getModel();n.disabled=!1;for(var i=0,o=Object.keys(c.elements),s=0;0==i&&s<o.length;s++){var a=c.elements[o[s]];if(a.requiredFlag)a.requiredFlag&&(e.is(a.valueToCommit,"string")?a.valueToCommit&&0!=a.valueToCommit.trim().length||i++:a.value&&0!=a.value.length||i++)}i>0&&(n.disabled=!0)}}});return D.prototype.uploadDocument=function(t,i){var o=this,a={tenant:i.tenantId,securityContext:i.securityContext,tenantUrl:i.tenantUrl,additionalHeaders:e.is(i.getWorkUnderHeaders,"function")?i.getWorkUnderHeaders():{},onFailure:function(e){var n=new Date-l.documentUploadStart;h.sendTrackerPageEvent({category:"docm.document.upload.complete",action:"click",label:"Document Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:i.securityContext,docType:t.type,fileType:w.getFileExtension(t.fileInfo.file.name),filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,failure:0}}),v.jobs.finishJob(l,"failed"),o.options.onError&&(e.internalError.contains("No create access")?o.options.onError({title:s.get("DOCUMENT_CANNOT_BE_CREATED_X",{type:i.documentType}),subtitle:s.get("Document_Create_Error_Subtitle"),message:s.get("Document_Create_Error_Message")}):o.options.onError({title:s.get("DOCUMENT_CANNOT_BE_CREATED"),message:e&&e.error||s.get("X_CANNOT_BE_CREATED",{title:t.title})}))},onProgress:function(e){l.update(e)},onComplete:function(e){var n=new Date-l.documentUploadStart;h.sendTrackerPageEvent({category:"docm.document.upload.complete",action:"click",label:"Document Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:i.securityContext,docType:t.type,fileType:w.getFileExtension(t.fileInfo.file.name),filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,success:1}});e.data;if(v.jobs.finishJob(l),o.options.onDocumentUpload){var a={notification:{title:s.get("DOCUMENT_CREATED"),subtitle:s.get("X_HAS_BEEN_CREATED_SUCCESSFULLY",{title:t.title})},documents:e.data};t.relInfo&&(a.relInfo=t.relInfo),o.options.onDocumentUpload(a)}},customDocumentObject:t.custom_attributes?{dataelements:t.custom_attributes}:void 0,preProcess:function(e){console.log("docJson"),console.log(e)}},r=t.title;t.fileInfo&&(r=t.fileInfo.file.name);var l={title:s.get("UPLOADING_X",{title:r}),ui:!!t.fileInfo,process:function(){l.documentUploadStart=new Date,l.xhr=n.createDocument(t,a)}};v.jobs.addJob(l)},D}),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Model",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/DocumentCreateNew/PLMNewFilesTab/utils/ExtensionUtils"],function(e,t,n,i){"use strict";var o=new n;function s(e,t,n){var o={data:e,grid:{name:e.name,tree:e.name,label:e.name,title:e.name,comments:e.comments?e.comments:"",fileExtension:r(e.name)},name:e.name,label:e.name,title:e.name,lowercase:{label:e.name.toLowerCase()}};return e.file?o.file=e.file:o.file=e,e.grid&&e.grid.comments&&(o.grid.comments=e.grid.comments),e.icons?o.icons=e.icons:o.icons=[t.platformServices["3DSpace"]+"/"+i.getIcon(r(e.name))],e.thumbnail?o.thumbnail=e.thumbnail:o.thumbnail=t.platformServices["3DSpace"]+"/"+i.getThumbnail(r(e.name)),e.user?(o.user=e.user,o.grid.owner=e.grid.owner):t.user&&(o.user=t.user,o.grid.owner={label:o.user.firstname+" "+o.user.lastname,username:o.user.id},t.platformServices&&t.platformServices["3DSwym"]&&(o.grid.owner.icon=t.platformServices["3DSwym"]+"/api/user/getpicture/login/"+o.user.id+"/format/mini")),o.subLabel=a(o),o.description=o.grid.comments,o}function a(t){var n=e.createElement("div",{class:"NameAndComment"});return o.generateView(t.grid.owner,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(n)}}),n}function r(e){return e.substring(e.lastIndexOf(".")+1,e.length)||e}var l=function(e,n){var i=s(e,n);i.updateData=function(e){o.updateOptions(s(e,n))},i.updateNameAndComment=function(e){e.updateOptions({subLabel:a({grid:{owner:e.options.grid.owner,comments:e.options.grid.comments}}),description:e.options.grid.comments})};var o=new t(i);return i.getAttributeValue=o.getAttributeValue.bind(o),o};return l.getFileExtension=r,l}),define("DS/DocumentCreateNew/PLMNewFilesTab/views/GridPane",["UWA/Core","DS/DataGridView/DataGridView","DS/Tweakers/TypeRepresentationFactory","DS/DocumentCreateNew/PLMNewFilesTab/data/Columns"],function(e,t,n,i){"use strict";new n;return e.Controls.Abstract.extend({name:"enox-plmNewFilesTab-gridpane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.gridPane=this,this._parent({})},build:function(n){var o=this;o.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});var s=(new i).getColumns(),a="enox-plmNewFilesTab-"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)+"-gridview",r=window.localStorage.getItem("wux-collectionView-dataGridView");null!=r&&(r=JSON.parse(r))[a]&&(delete r[a].columnsSortModel,window.localStorage.setItem("wux-collectionView-dataGridView",JSON.stringify(r))),o.datagridview=new t({identifier:a,treeDocument:o.ctrl.controller.files.treeDocument,columns:s,autoRowHeightFlag:!0,rowDragEnabledFlag:!1,cellDragEnabledFlag:!1,rowGroupingEnabledFlag:!1,defaultColumnDef:{editableFlag:!1,resizableFlag:!0,sortableFlag:!0,typeRepresentation:"string"},selectionMode:"row",showContextualMenuColumnFlag:!0,rowSelection:"multiple",cellSelection:"none",showSelectionCheckBoxesFlag:!0,showRowIndexFlag:!1,sortModel:[o.ctrl.controller.files.sortModel],onContextualEvent:function(e){if(e&&e.collectionView)return e.cellInfos&&e.cellInfos.nodeModel?(o.ctrl.contextMenu.selectionChanged(),o.ctrl.contextMenu.promise):e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!0})},onDragStartCell:function(e,t){}}).inject(o.elements.container),o.datagridview.getTreeDocument().onNodeModelUpdate(e=>{if(e.data.previousAttributes&&e.data.previousAttributes.hasOwnProperty("comments")){var t=e.data.nodeModel;t.options.updateNameAndComment(t)}}),this.ctrl.events.addEventListener("applySortModel",function(e){o.datagridview.sortModel=e}),this.ctrl.events.addEventListener("enox-plmNewFilesTab-data-needs-sorting",function(e){o.datagridview.reapplySortModel()}),o.ctrl.events.subscribe({event:"enox-plmNewFilesTab-flash-row-added"},function(e){e.forEach(e=>{var t=e._getRowID();o.datagridview._flashEffectOnRow("ui-modified",t)})}),console.log(o.datagridview.getCustomViewsManager().getCurrentCustomView()),o.datagridview.getCustomViewsManager().onCustomViewsSave=function(e,t){console.log(e),console.log(t)},o.inject(n)}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Collection",["DS/TreeModel/TreeDocument","DS/DocumentCreateNew/PLMNewFilesTab/data/Model"],function(e,t){"use strict";return function(n){var i={ctrl:n,options:n.options,count:0,treeDocument:new e({useAsyncPreExpand:!0,shouldAcceptDrag:function(e,t){return!1},shouldAcceptDrop:function(e,t){return!0}}),sortModel:{sortAttribute:"modified",sort:"desc",dataIndex:"modified"},clear:function(){return i.treeDocument.removeRoots(),n.options.requestId=(new Date).getTime()},addFiles:function(e,o){i.treeDocument.getAllDescendants().length>0&&(e=n.helper.ensureUniqueFiles(e,i.treeDocument.getAllDescendants())),i.treeDocument.prepareUpdate(),console.log(o+" Prepare Update");var s=[];return e.forEach(function(e){s.push(i.treeDocument.addRoot(new t(e,n.options)))}),i.treeDocument.pushUpdate(),console.log(o+" PushUpdate"),n.options.events.publish({event:"enox-plmNewFilesTab-data-needs-sorting"}),s},removeFilesByIds:function(e){i.treeDocument.getRoots().forEach(t=>{e.includes(t.options.data.id)&&setTimeout(()=>{t.remove()},1)})},getFilesFromNodes:function(){var e=[];return i.treeDocument.getAllDescendants().forEach(t=>{t.options.file.comment=t.options.grid.comments?t.options.grid.comments:"",e.push(t.options.file)}),e}};return i.treeDocument.getModelEvents().subscribe({event:"addChild"},function(e,t,o){i.count++,n.events.publish({event:"enox-plmNewFilesTab-collection-count-changed",data:i.count})}),i.treeDocument.getModelEvents().subscribe({event:"removeChild"},function(e,t,o){i.count--,n.events.publish({event:"enox-plmNewFilesTab-collection-count-changed",data:i.count})}),n.options.events.subscribe({event:"enox-files-node-selection-add"},function(e){var t=i.treeDocument.getSelectedNodes();n.options.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:t})}),n.options.events.subscribe({event:"enox-plmNewFilesTab-node-selection-remove"},function(e){i.treeDocument.getSelectedNodes();n.options.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:i.treeDocument.getSelectedNodes()})}),i}}),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Controller",["UWA/Core","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentCreateNew/PLMNewFilesTab/data/Collection","DS/DocumentCreateNew/PLMNewFilesTab/data/Data","DS/DocumentCreateNew/PLMNewFilesTab/utils/Helper"],function(e,t,n,i,o){"use strict";return e.Class.extend({init:function(s){var a=this;s.controller=this,this.ctrl=s,this.controller=this,this.files=new n(s),this.data=new i(s),this.helper=new o(s),this.ready=e.Promise.deferred(),this.getPlatformServicesPromise=new e.Promise(function(e,n){t.getPlatformServices({platformId:s.options.tenant,onComplete:function(t){console.log(t),t.length&&(console.error("getPlatformServices returned an array"),t=t[0]),s.options.platformServices=t,console.log("getPlatformServices resolved"),e(t)},onFailure:function(e){console.error("Failed to get platform services",e),n(e)}})}),this.getCurrentUserPromise=new e.Promise(function(e,n){t.getUser({platformId:s.options.tenant,onComplete:function(t){s.options.user=t,e(t)},onFailure:function(e){console.error("Failed to get current user for files",e),n(e)}})}),this.getJobsProcessorPromise=s.options.getJobsProcessorPromise||new e.Promise(function(e,t){var n={};window.widget&&window.widget.app&&window.widget.app.jobs&&"doco-jobs"==window.widget.app.jobs.name&&window.widget.app.progressPane&&"doco-progress"==window.widget.app.progressPane.name?(n=window.widget.app,e(n.jobs)):(console.warn("FileController had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],function(t,i){null==n.jobs&&(n.jobs=new t(n)),null==n.progressPane&&(n.progressPane=new i(n),window.widget&&window.widget.body?n.progressPane.inject(window.widget.body):n.progressPane.inject(document.body)),e(n.jobs)}))}),e.Promise.all([this.getPlatformServicesPromise,this.getCurrentUserPromise,this.getJobsProcessorPromise]).then(function(){a.ready.resolve(!0)}),this.view=this.helper.loadViewMode()},loadFiles:function(){new Date;this.ready.promise.then(function(){})},clearAll:function(){this.files.clear()},switchView:function(e){this.files.count>0?"grid"==e?(this.ctrl.tilePane.hide(),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.show(),this.view=e,this.helper.saveViewMode(e)):"tile"!=e&&null!=e||(this.ctrl.uploadPane.hide(),this.ctrl.gridPane.hide(),this.ctrl.tilePane.show(),this.view="tile",this.helper.saveViewMode(this.view)):("grid"!=e&&"tile"!=e||(this.view=e,this.helper.saveViewMode(this.view)),this.ctrl.gridPane.hide(),this.ctrl.tilePane.hide(),this.ctrl.uploadPane.show())}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesPane",["UWA/Core","UWA/Controls/Abstract","DS/CoreEvents/ModelEvents","DS/DocumentCreateNew/PLMNewFilesTab/data/Controller","DS/DocumentCreateNew/PLMNewFilesTab/views/Topbar","DS/DocumentCreateNew/PLMNewFilesTab/views/UploadPane","DS/DocumentCreateNew/PLMNewFilesTab/views/GridPane","DS/DocumentCreateNew/PLMNewFilesTab/views/TilePane","DS/DocumentCreateNew/PLMNewFilesTab/ContextMenu","DS/DocumentCreateNew/PLMNewFilesTab/EventHandler","DS/DocumentCreateNew/PLMNewFilesTab/utils/DnDManager","DS/UIKIT/Alert","DS/Controls/Loader","DS/Controls/ModalContainer","css!DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesTab"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,m){"use strict";return t.extend({name:"enox-plmNewFilesTab",options:{className:""},_options:{},modelEvents:void 0,init:function(e){e.plmNewFilesPane=this,this.events=e.events||new n,delete e.events,this._parent(e),this.options.events=this.events,e.events=this.events,this.options.tenant=this.options.PlmNewOptions?this.options.PlmNewOptions.tenant:void 0,this.events._pubsub._spyEvents=function(e,t){console.log("PLMNewFilesTab:",e,t,this)},this.buildSkeleton()},buildSkeleton:function(){var t=this;this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.elements.container.addEvent("resize",function(e,t,n){console.log(e),console.log(e.target.clientWidth),console.log(e.target.clientHeight)}),this.elements.container.dsModel=this,this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.loader=new p,this.alert=new u({closable:!0,visible:!0,maximumVisibleMessages:1,closeOnClick:!0}).inject(this.elements.content),this.startLoading(),new i(this),this.controller.ready.promise.then(function(){new o(t).build(t.elements.content),t.buildContentPanes(),t.contextMenu=new l(t),new c(t).connect(t.elements.content,t.controller,t.toolbar,t.contextMenu)})},buildContentPanes:function(){this.elements.panes=e.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new s(this).build(this.elements.panes),new a(this).build(this.elements.panes),new r(this).build(this.elements.panes),new d(this),this.finishLoading()},getUI:function(){return this.elements.container},startLoading:function(){this.isLoadingInProgress=!0,this.loader.on(),m.createModal(this.elements.container,this.loader.elements.container)},finishLoading:function(){this.isLoadingInProgress=!1,this.loader.off(),m.removeModal(this.elements.container)}})}),define("DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesTab",["UWA/Core","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase","UWA/Class/Options","UWA/Class/Events","DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesPane"],function(e,t,n,i,o){return t.extend(n,i,{name:"PLMNewFilesTab",securityContext:null,init:function(e){var t=this;this._parent(e),t.paneOptions=t.getOptions(e),this.plmNewFilesPane=new o(t.paneOptions),this.elements.container=this.plmNewFilesPane.getUI(),e.ODT||this.listenToPublishedInfo(function(e,n){if("currentSecurityContext"===e){let e=n.value;t.options.securityContext=e}})},getOptions:function(t){return{PlmNewOptions:e.clone(t,!0)}},plmNewContextProvider:function(){return this.options.securityContext},getUI:function(e){return this.elements.container},postCreation:function(t){var n=this;if(n.uploadCompletionPromise=e.Promise.deferred(),n.filesArray=void 0,n.filesArray=n.plmNewFilesPane.controller.files.getFilesFromNodes(),n.filesArray.length>0){n.filesArrayCopy=n.filesArray,n.token=void 0,n.token=n.plmNewFilesPane.controller.helper.getUniqueToken();var i={getParentDocument:function(){return t[0].identifier},fetchSecurityContext:function(){return n.plmNewContextProvider()},token:n.token,getJobsProcessorPromise:n.plmNewFilesPane.controller.getJobsProcessorPromise._promise,files:n.plmNewFilesPane.controller.files.getFilesFromNodes(),platformUrls:n.plmNewFilesPane.options.platformServices,events:n.plmNewFilesPane.events,source:"PLMNewFilesTab"};n.fileUploadEventInstance&&(n.plmNewFilesPane.events.unsubscribe(n.attachUrlCompleteEventToken),n.fileUploadEventInstance=void 0),require(["DS/DocumentCommands/V2/FileActions/UploadFile"],function(e){new e(i).execute(n.filesArray),n.uploadCompletionPromise.resolve()})}else n.uploadCompletionPromise.resolve();return new Promise(e=>{n.uploadCompletionPromise.promise.then(()=>{e({level:"success",title:"Files Upload.",subtitle:"Files Upload Started...",allowUnsafeHTML:!1,code:"200"})})})},destroy:function(){this.options.onDestroyCallback(this.options.tabId),this._parent()}})});